From 0a2ffa4f47ac0320adaf6f59be74773475496b13 Mon Sep 17 00:00:00 2001
From: Paul Gortmaker <paul.gortmaker@windriver.com>
Date: Tue, 17 Jun 2014 09:41:52 -0400
Subject: [PATCH] lttng: delete block_rq_complete tracepoint that conflicts
 with mainline
MIME-Version: 1.0
Content-Type: text/plain; charset=UTF-8
Content-Transfer-Encoding: 8bit

To fix the following build failure:

In file included from drivers/staging/lttng/probes/../instrumentation/events/lttng-module/../../../probes/define_trace.h:110:0,
                 from drivers/staging/lttng/probes/../instrumentation/events/lttng-module/rcu.h:721,
                 from drivers/staging/lttng/probes/lttng-probe-rcu.c:40:
drivers/staging/lttng/probes/../instrumentation/events/lttng-module/../../../probes/../instrumentation/events/lttng-module/rcu.h:711:0: warning: "trace_rcu_torture_read" redefined [enabled by default]
 #define trace_rcu_torture_read(rcutorturename, rhp) do { } while (0)
 ^
In file included from drivers/staging/lttng/probes/lttng-probe-rcu.c:31:0:
include/trace/events/rcu.h:676:0: note: this is the location of the previous definition
 #define trace_rcu_torture_read(rcutorturename, rhp, secs, c_old, c) \
 ^
In file included from drivers/staging/lttng/probes/../instrumentation/events/lttng-module/../../../probes/define_trace.h:117:0,
                 from drivers/staging/lttng/probes/../instrumentation/events/lttng-module/block.h:729,
                 from drivers/staging/lttng/probes/lttng-probe-block.c:41:
drivers/staging/lttng/probes/../instrumentation/events/lttng-module/../../../probes/lttng-events.h:93:6: error: conflicting types for ‘trace_block_rq_complete’
 void trace_##_name(_proto);
      ^
drivers/staging/lttng/probes/../instrumentation/events/lttng-module/../../../probes/../instrumentation/events/lttng-module/block.h:183:1: note: in expansion of macro ‘DEFINE_EVENT’
 DEFINE_EVENT(block_rq_with_error, block_rq_complete,
 ^
In file included from include/linux/module.h:18:0,
                 from drivers/staging/lttng/probes/lttng-probe-block.c:23:
include/linux/tracepoint.h:152:21: note: previous definition of ‘trace_block_rq_complete’ was here
  static inline void trace_##name(proto)    \
                     ^
include/linux/tracepoint.h:257:3: note: in expansion of macro ‘__DECLARE_TRACE’
   __DECLARE_TRACE(name, PARAMS(proto), PARAMS(args), 1, \
   ^
include/linux/tracepoint.h:387:2: note: in expansion of macro ‘DECLARE_TRACE’
  DECLARE_TRACE(name, PARAMS(proto), PARAMS(args))
  ^
include/trace/events/block.h:92:1: note: in expansion of macro ‘TRACE_EVENT’
 TRACE_EVENT(block_rq_complete,
 ^
make[4]: *** [drivers/staging/lttng/probes/lttng-probe-block.o] Error 1
make[4]: *** Waiting for unfinished jobs....
make[3]: *** [drivers/staging/lttng/probes] Error 2
make[2]: *** [drivers/staging/lttng] Error 2
make[1]: *** [drivers/staging] Error 2
make: *** [drivers] Error 2

Signed-off-by: Paul Gortmaker <paul.gortmaker@windriver.com>

diff --git a/drivers/staging/lttng2/instrumentation/events/lttng-module/block.h b/drivers/staging/lttng2/instrumentation/events/lttng-module/block.h
index f3b8bff..d882847 100644
--- a/drivers/staging/lttng2/instrumentation/events/lttng-module/block.h
+++ b/drivers/staging/lttng2/instrumentation/events/lttng-module/block.h
@@ -221,24 +221,6 @@ DEFINE_EVENT(block_rq_with_error, block_rq_requeue,
 	TP_ARGS(q, rq)
 )
 
-/**
- * block_rq_complete - block IO operation completed by device driver
- * @q: queue containing the block operation request
- * @rq: block operations request
- *
- * The block_rq_complete tracepoint event indicates that some portion
- * of operation request has been completed by the device driver.  If
- * the @rq->bio is %NULL, then there is absolutely no additional work to
- * do for the request. If @rq->bio is non-NULL then there is
- * additional work required to complete the request.
- */
-DEFINE_EVENT(block_rq_with_error, block_rq_complete,
-
-	TP_PROTO(struct request_queue *q, struct request *rq),
-
-	TP_ARGS(q, rq)
-)
-
 DECLARE_EVENT_CLASS(block_rq,
 
 	TP_PROTO(struct request_queue *q, struct request *rq),
-- 
1.8.2.3

