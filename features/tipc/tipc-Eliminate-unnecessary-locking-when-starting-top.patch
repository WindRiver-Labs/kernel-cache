From f8e9485749a313371b05d3b425f7ecdb8b2339fc Mon Sep 17 00:00:00 2001
From: Allan Stephens <allan.stephens@windriver.com>
Date: Mon, 8 Nov 2010 17:17:23 -0500
Subject: [PATCH 13/32] tipc: Eliminate unnecessary locking when starting topology service

commit 43c391cf0d07ee9cc120d9d030f28909819f11b9 from
git://tipc.cslab.ericsson.net/pub/git/people/allan/tipc.git

Modifies the initialization code for TIPC's topology service to
avoid taking the spinlock protecting the subscriber list, since
there is no need to do this.

Signed-off-by: Allan Stephens <allan.stephens@windriver.com>
Integrated-by: Howard Xu <hao.xu@windriver.com>
---
 net/tipc/tipc_topsrv.c |    7 +------
 1 files changed, 1 insertions(+), 6 deletions(-)

diff --git a/net/tipc/tipc_topsrv.c b/net/tipc/tipc_topsrv.c
index 3381b1f..f534797 100644
--- a/net/tipc/tipc_topsrv.c
+++ b/net/tipc/tipc_topsrv.c
@@ -550,12 +550,9 @@ int tipc_subscr_start(void)
 	spin_lock_init(&topsrv.lock);
 	INIT_LIST_HEAD(&topsrv.subscriber_list);
 
-	spin_lock_bh(&topsrv.lock);
 	res = tipc_attach(&topsrv.user_ref, NULL, NULL);
-	if (res) {
-		spin_unlock_bh(&topsrv.lock);
+	if (res)
 		return res;
-	}
 
 	res = tipc_createport(topsrv.user_ref,
 			      NULL,
@@ -575,14 +572,12 @@ int tipc_subscr_start(void)
 	if (res)
 		goto failed;
 
-	spin_unlock_bh(&topsrv.lock);
 	return 0;
 
 failed:
 	err("Failed to create subscription service\n");
 	tipc_detach(topsrv.user_ref);
 	topsrv.user_ref = 0;
-	spin_unlock_bh(&topsrv.lock);
 	return res;
 }
 
-- 
1.7.0

