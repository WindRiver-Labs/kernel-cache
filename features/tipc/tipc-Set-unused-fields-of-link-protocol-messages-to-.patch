From 9dbf24d3854d655a320383bf260ace09825490b0 Mon Sep 17 00:00:00 2001
From: Allan Stephens <allan.stephens@windriver.com>
Date: Wed, 10 Nov 2010 22:22:15 -0800
Subject: [PATCH 09/22] tipc: Set unused fields of link protocol messages to defined values

commit e038982136c78efe0d58b3dda4b128dde3e6709f
http://tipc.cslab.ericsson.net/cgi-bin/gitweb.cgi?p=people/allan/tipc.git;a=shortlog;h=tipc1.7

Ensures that a link reset or activate message has a "probe" field
of zero, and that a link state messages has a "stop" field of zero.
(These fields are currently unused in these situations, but this
could potentially change in future versions of TIPC.)

Signed-off-by: Allan Stephens <allan.stephens@windriver.com>
Integrated-by: Howard Xu <Hao.Xu@windriver.com>
---
 net/tipc/tipc_link.c |    2 ++
 1 files changed, 2 insertions(+), 0 deletions(-)

diff --git a/net/tipc/tipc_link.c b/net/tipc/tipc_link.c
index fd664c0..1922fe6 100644
--- a/net/tipc/tipc_link.c
+++ b/net/tipc/tipc_link.c
@@ -2158,6 +2158,7 @@ void tipc_link_send_proto_msg(struct link *l_ptr, u32 msg_typ, int probe_msg,
 		msg_set_linkprio(msg, priority);
 		msg_set_max_pkt(msg, ack_mtu);
 		msg_set_ack(msg, mod(l_ptr->next_in_no - 1));
+		msg_set_stop(msg, 0);
 		msg_set_probe(msg, probe_msg != 0);
 		if (probe_msg) {
 			u32 mtu = l_ptr->max_pkt;
@@ -2182,6 +2183,7 @@ void tipc_link_send_proto_msg(struct link *l_ptr, u32 msg_typ, int probe_msg,
 		msg_set_seq_gap(msg, 0);
 		msg_set_next_sent(msg, 1);
 		msg_set_stop(msg, stop);
+		msg_set_probe(msg, 0);
 		msg_set_link_tolerance(msg, l_ptr->tolerance);
 		msg_set_linkprio(msg, l_ptr->priority);
 		msg_set_max_pkt(msg, l_ptr->max_pkt_target);
-- 
1.6.5.2

