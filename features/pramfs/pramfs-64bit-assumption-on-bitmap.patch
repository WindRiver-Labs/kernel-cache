From 6830793b489ce948fa7ad42acbde4f6aac123f44 Mon Sep 17 00:00:00 2001
From: Ivar Holmqvist <ivar.holmqvist@windriver.com>
Date: Wed, 17 Mar 2010 06:28:05 -0700
Subject: [PATCH 2/5] pramfs: 64bit assumption on bitmap

removed assumption the the underlying data is 64bit when
initialising the bitmap.

Signed-off-by: Ivar Holmqvist <ivar.holmqvist@windriver.com>
---
 fs/pramfs/balloc.c |   14 ++++----------
 1 files changed, 4 insertions(+), 10 deletions(-)

diff --git a/fs/pramfs/balloc.c b/fs/pramfs/balloc.c
index 3c277d6..e21f22c 100644
--- a/fs/pramfs/balloc.c
+++ b/fs/pramfs/balloc.c
@@ -26,18 +26,12 @@
 void pram_init_bitmap(struct super_block *sb)
 {
 	struct pram_super_block *ps = pram_get_super(sb);
-	u64 *bitmap = pram_get_bitmap(sb);
+	void *bitmap = pram_get_bitmap(sb);
 	int blocks = be32_to_cpu(ps->s_bitmap_blocks);
+	int tot_blocks = be32_to_cpu(ps->s_blocks_count);
 
-	memset(bitmap, 0, blocks<<sb->s_blocksize_bits);
-
-	while (blocks >= 64) {
-		*bitmap++ = (u64)ULLONG_MAX;
-		blocks -= 64;
-	}
-
-	if (blocks)
-		*bitmap = (1<<blocks) - 1;
+	bitmap_zero(bitmap, tot_blocks);
+	bitmap_fill(bitmap, blocks);
 }
 
 
-- 
1.6.5.2

