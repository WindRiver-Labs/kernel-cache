From fc83451157d93d475db5d8652ffb53e31643a38d Mon Sep 17 00:00:00 2001
From: Kevin Hao <kexin.hao@windriver.com>
Date: Wed, 16 Oct 2013 13:10:36 +0800
Subject: [PATCH 5/5] ocf: include <linux/irqreturn.h> in ocf-compat.h

In order to be compatible with the old kernel, the ocf-compat.h will
define the IRQ_NONE and IRQ_RETVAL to NULL if they are not defined
in other header files. So we should make sure that the file in which
these macros are defined must be included before this check. The file
"linux/irqreturn.h" was introduced only after v2.6.17, so also add
a kernel version check for this inclusion as what it did in other
part of this file.

Signed-off-by: Kevin Hao <kexin.hao@windriver.com>
---
 crypto/ocf/ocf-compat.h | 3 +++
 1 file changed, 3 insertions(+)

diff --git a/crypto/ocf/ocf-compat.h b/crypto/ocf/ocf-compat.h
index 4ad1223..3b54435 100644
--- a/crypto/ocf/ocf-compat.h
+++ b/crypto/ocf/ocf-compat.h
@@ -205,6 +205,9 @@ struct ocf_device {
 /* older kernels don't have these */
 
 #include <asm/irq.h>
+#if LINUX_VERSION_CODE > KERNEL_VERSION(2, 6, 17)
+#include <linux/irqreturn.h>
+#endif
 #if !defined(IRQ_NONE) && !defined(IRQ_RETVAL)
 #define IRQ_NONE
 #define IRQ_HANDLED
-- 
1.8.4.93.g57e4c17

