From 28c569508c4891516c18ba8f3cb82b19b46df19e Mon Sep 17 00:00:00 2001
From: Xufeng Zhang <xufeng.zhang@windriver.com>
Date: Thu, 10 Nov 2011 13:44:43 +0800
Subject: [PATCH 2/2] crypto/ocf: zero input buffers during allocation

Crypto input buffer is expanded to a cleartext+authsize length,
but the part of authsize buffer is not initialized when hashing,
so the same cleartext won't get the same hash value because of
the rubbish data.
Replacing kmalloc by kzalloc when allocating crypto input buffer
to resolve this problem.

Signed-off-by: Xufeng Zhang <xufeng.zhang@windriver.com>
---
 crypto/ocf/cryptodev.c |    2 +-
 1 files changed, 1 insertions(+), 1 deletions(-)

diff --git a/crypto/ocf/cryptodev.c b/crypto/ocf/cryptodev.c
index 0bbb4c0..d434d88 100644
--- a/crypto/ocf/cryptodev.c
+++ b/crypto/ocf/cryptodev.c
@@ -193,7 +193,7 @@ cryptodev_op(struct csession *cse, struct crypt_op *cop)
 	cse->uio.uio_iov[0].iov_len = cop->len;
 	if (cse->info.authsize)
 		cse->uio.uio_iov[0].iov_len += cse->info.authsize;
-	cse->uio.uio_iov[0].iov_base = kmalloc(cse->uio.uio_iov[0].iov_len,
+	cse->uio.uio_iov[0].iov_base = kzalloc(cse->uio.uio_iov[0].iov_len,
 			GFP_KERNEL);
 
 	if (cse->uio.uio_iov[0].iov_base == NULL) {
-- 
1.7.0.4

