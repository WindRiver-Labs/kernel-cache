From e61b377f98318406071b0503bc23ebf95f4ebf12 Mon Sep 17 00:00:00 2001
From: Dario Faggioli <raistlin@linux.it>
Date: Wed, 11 Apr 2012 11:19:53 +0200
Subject: [PATCH 07/15] sched: SCHED_DEADLINE avg_update accounting.

Taken from:
git://github.com/jlelli/sched-deadline.git:sched-dl-V5
commit 9cad484695782250e27191bfd4f66d1ccc7390c9

Make the core scheduler and load balancer aware of the load
produced by -deadline tasks, by updating the moving average
like for sched_rt.

Signed-off-by: Dario Faggioli <raistlin@linux.it>
Signed-off-by: Juri Lelli <juri.lelli@gmail.com>
Integrated-by: Yang Shi <yang.shi@windriver.com>
---
 kernel/sched/dl.c |    2 ++
 1 file changed, 2 insertions(+)

diff --git a/kernel/sched/dl.c b/kernel/sched/dl.c
index 9bc48a0..0262c16 100644
--- a/kernel/sched/dl.c
+++ b/kernel/sched/dl.c
@@ -554,6 +554,8 @@ static void update_curr_dl(struct rq *rq)
 	curr->se.exec_start = rq->clock_task;
 	cpuacct_charge(curr, delta_exec);
 
+	sched_rt_avg_update(rq, delta_exec);
+
 	dl_se->runtime -= delta_exec;
 	if (dl_runtime_exceeded(rq, dl_se)) {
 		__dequeue_task_dl(rq, curr, 0);
-- 
1.7.9.7

