From 3c966f6aa28c99f278a04a67458d4f5fa25ae436 Mon Sep 17 00:00:00 2001
From: Xin Ouyang <Xin.Ouyang@windriver.com>
Date: Mon, 20 May 2013 13:37:50 +0800
Subject: [PATCH] msa: fix conflicting variable naming for macro expanding

In cputime_msa.h, cputime_div() macro will pass a variable __x to do_div().
While do_div()'s arm implementation also has a same named local variable __x.

  #define cputime_div(__a, __n) ({ u64 __x = (__a);do_div(__x, __n);...})
  #define do_div(n, base)       ({ ... { unsigned long long __x, __n = n;...})

This will cause variable collision, and the __x passed by cputime_div() will
be overrided by the local __x. Because cputime_div will be expanded as:

  unsigned long long __x, __n = __x;

This would cause build failures.

KERNELPATH/grsecurity/gracl.c: In function 'gr_acl_handle_psacct':
KERNELPATH/grsecurity/gracl.c:3851:12: error: '__x' may be used
uninitialized in this function [-Werror=uninitialized]

So, rename __x in cputime_div() to avoid this.

Signed-off-by: Xin Ouyang <Xin.Ouyang@windriver.com>
---
 include/asm-generic/cputime_msa.h |    2 +-
 1 files changed, 1 insertions(+), 1 deletions(-)

diff --git a/include/asm-generic/cputime_msa.h b/include/asm-generic/cputime_msa.h
index be7083b..04e8361 100644
--- a/include/asm-generic/cputime_msa.h
+++ b/include/asm-generic/cputime_msa.h
@@ -16,7 +16,7 @@ typedef u64 cputime_t;
 #define cputime_max			((~((cputime_t)0) >> 1) - 1)
 #define cputime_add(__a, __b)		((__a) +  (__b))
 #define cputime_sub(__a, __b)		((__a) -  (__b))
-#define cputime_div(__a, __n)		({ u64 __x = (__a); do_div(__x, __n); __x; })
+#define cputime_div(__a, __n)		({ u64 __tmpx = (__a); do_div(__tmpx, __n); __tmpx; })
 #define cputime_halve(__a)		((__a) >> 1)
 #define cputime_eq(__a, __b)		((__a) == (__b))
 #define cputime_gt(__a, __b)		((__a) >  (__b))
-- 
1.7.5.4

