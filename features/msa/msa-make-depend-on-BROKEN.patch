From 79d5e0c37ea83161ae0f2694f85f5e1072e53b94 Mon Sep 17 00:00:00 2001
From: Michel Thebeau <michel.thebeau@windriver.com>
Date: Wed, 22 May 2013 09:27:48 -0400
Subject: [PATCH] msa: make depend on BROKEN

Feature isol introduces changes that are not compatible with msa.  This
results in breakage when msa is configured:

kernel/sched/cputime.c:151:6: error: redefinition of 'account_user_time'
include/linux/kernel_stat.h:127:20: note: previous definition of 'account_user_time' was here
kernel/sched/cputime.c:227:6: error: redefinition of 'account_system_time'
include/linux/kernel_stat.h:129:20: note: previous definition of 'account_system_time' was here
kernel/sched/cputime.c:262:6: error: redefinition of 'account_idle_time'
include/linux/kernel_stat.h:131:20: note: previous definition of 'account_idle_time' was here
kernel/sched/cputime.c: In function 'cputime_adjust':
kernel/sched/cputime.c:598:2: error: implicit declaration of function 'nsecs_to_cputime' [-Werror=implicit-function-declaration]
kernel/sched/cputime.c: In function 'task_cputime_adjusted':
kernel/sched/cputime.c:637:29: error: 'struct task_struct' has no member named 'prev_cputime'

Additionally, during review it was noted:
"the accounting code has been changed significantly in order to do the
no hertz stuff, and I don't see trying to reconcile the two as
[valuable]"

Force msa to be disabled on the ovp kernel.

Signed-off-by: Michel Thebeau <michel.thebeau@windriver.com>
---
 arch/arm/Kconfig.debug  |    2 +-
 arch/mips/Kconfig.debug |    2 +-
 arch/x86/Kconfig.debug  |    2 +-
 3 files changed, 3 insertions(+), 3 deletions(-)

diff --git a/arch/arm/Kconfig.debug b/arch/arm/Kconfig.debug
index 9e81e99..ece7b18 100644
--- a/arch/arm/Kconfig.debug
+++ b/arch/arm/Kconfig.debug
@@ -342,7 +342,7 @@ config ARM_KPROBES_TEST
 
 config MICROSTATE_ACCT
 	bool "Microstate accounting"
-	depends on !PREEMPT_RT_BASE
+	depends on !PREEMPT_RT_BASE && BROKEN
 	help
 	  This option causes the kernel to keep very accurate track of
 	  how long your threads spend on the runqueues, running, or asleep or
diff --git a/arch/mips/Kconfig.debug b/arch/mips/Kconfig.debug
index 983a811..e4aed44 100644
--- a/arch/mips/Kconfig.debug
+++ b/arch/mips/Kconfig.debug
@@ -130,7 +130,7 @@ config SPINLOCK_TEST
 
 config MICROSTATE_ACCT
 	bool "Microstate accounting"
-	depends on !PREEMPT_RT_BASE
+	depends on !PREEMPT_RT_BASE && BROKEN
 	help
 	  This option causes the kernel to keep very accurate track of
 	  how long your threads spend on the runqueues, running, or asleep or
diff --git a/arch/x86/Kconfig.debug b/arch/x86/Kconfig.debug
index 50e3229..d9556a5 100644
--- a/arch/x86/Kconfig.debug
+++ b/arch/x86/Kconfig.debug
@@ -7,7 +7,7 @@ source "lib/Kconfig.debug"
 
 config MICROSTATE_ACCT
 	bool "Microstate accounting"
-	depends on !PREEMPT_RT_BASE
+	depends on !PREEMPT_RT_BASE && BROKEN
 	help
 	  This option causes the kernel to keep very accurate track of
 	  how long your threads spend on the runqueues, running, or asleep or
-- 
1.7.9.7

