From 089a4e4c0c97b7e9252b41b0ecf1b1a5bfbac85d Mon Sep 17 00:00:00 2001
From: Corey Minyard <cminyard@mvista.com>
Date: Tue, 16 Oct 2012 11:00:42 -0500
Subject: [PATCH 15/18] msa-mips: Add MSA info to schedule_ipi()

From the upstream project:
git://microstate.git.sourceforge.net/gitroot/microstate/linux-msa

Signed-off-by: Corey Minyard <cminyard@mvista.com>
---
 arch/mips/kernel/smp-bmips.c |    4 ++--
 arch/mips/kernel/smtc.c      |    2 +-
 2 files changed, 3 insertions(+), 3 deletions(-)

diff --git a/arch/mips/kernel/smp-bmips.c b/arch/mips/kernel/smp-bmips.c
index 3046e29..13a009e 100644
--- a/arch/mips/kernel/smp-bmips.c
+++ b/arch/mips/kernel/smp-bmips.c
@@ -243,7 +243,7 @@ static irqreturn_t bmips_ipi_interrupt(int irq, void *dev_id)
 	write_c0_brcm_action(ACTION_CLR_IPI(smp_processor_id(), action));
 
 	if (action == 0)
-		scheduler_ipi();
+		scheduler_ipi(SCHED_IPI_PARMSET(irq, msa_get_reg()));
 	else
 		smp_call_function_interrupt();
 
@@ -288,7 +288,7 @@ static irqreturn_t bmips_ipi_interrupt(int irq, void *dev_id)
 	spin_unlock_irqrestore(&ipi_lock, flags);
 
 	if (action & SMP_RESCHEDULE_YOURSELF)
-		scheduler_ipi();
+		scheduler_ipi(SCHED_IPI_PARMSET(irq, msa_get_reg()));
 	if (action & SMP_CALL_FUNCTION)
 		smp_call_function_interrupt();
 
diff --git a/arch/mips/kernel/smtc.c b/arch/mips/kernel/smtc.c
index 9c077d1..b791bd1 100644
--- a/arch/mips/kernel/smtc.c
+++ b/arch/mips/kernel/smtc.c
@@ -928,7 +928,7 @@ static void post_direct_ipi(int cpu, struct smtc_ipi *pipi)
 
 static void ipi_resched_interrupt(void)
 {
-	scheduler_ipi();
+	scheduler_ipi(SCHED_IPI_PARMSET(IPI0_IRQ, msa_get_reg()));
 }
 
 static void ipi_call_interrupt(void)
-- 
1.7.9.7

