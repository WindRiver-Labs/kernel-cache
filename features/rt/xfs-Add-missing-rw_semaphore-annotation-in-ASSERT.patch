From c7908e47e7bf3ebf00f1fb741900f87e8218f67c Mon Sep 17 00:00:00 2001
From: Alessio Igor Bogani <abogani@texware.it>
Date: Mon, 22 Feb 2010 22:33:42 +0100
Subject: [PATCH] xfs: Add missing rw_semaphore annotation in ASSERT
MIME-Version: 1.0
Content-Type: text/plain; charset=UTF-8
Content-Transfer-Encoding: 8bit

commit 4e99db3861388e6bb49a84cf6aa599cbe1e4804d in tip.

fs/xfs/linux-2.6/xfs_super.c: In function ‘xfs_fs_clear_inode’:
fs/xfs/linux-2.6/xfs_super.c:1113: error: ‘struct rw_anon_semaphore’ has no member named ‘lock’
make[2]: *** [fs/xfs/linux-2.6/xfs_super.o] Error 1

Signed-off-by: Alessio Igor Bogani <abogani@texware.it>
LKML-Reference: <1266874422-3200-1-git-send-email-abogani@texware.it>
Signed-off-by: Thomas Gleixner <tglx@linutronix.de>
Signed-off-by: Paul Gortmaker <paul.gortmaker@windriver.com>
---
 fs/xfs/linux-2.6/xfs_super.c |    2 +-
 1 files changed, 1 insertions(+), 1 deletions(-)

diff --git a/fs/xfs/linux-2.6/xfs_super.c b/fs/xfs/linux-2.6/xfs_super.c
index 29f1edc..49dcf3b 100644
--- a/fs/xfs/linux-2.6/xfs_super.c
+++ b/fs/xfs/linux-2.6/xfs_super.c
@@ -1159,7 +1159,7 @@ xfs_fs_clear_inode(
 	 * (and basically indicate what we are doing), we explicitly
 	 * re-init the iolock here.
 	 */
-	ASSERT(!rwsem_is_locked(&ip->i_iolock.mr_lock));
+	ASSERT(!anon_rwsem_is_locked(&ip->i_iolock.mr_lock));
 	mrlock_init(&ip->i_iolock, MRLOCK_BARRIER, "xfsio", ip->i_ino);
 
 	xfs_inactive(ip);
-- 
1.7.0.4

