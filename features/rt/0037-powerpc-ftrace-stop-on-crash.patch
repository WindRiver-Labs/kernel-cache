From 269e37485ef97c82747cccb32bb3d0109051f6e6 Mon Sep 17 00:00:00 2001
From: Thomas Gleixner <tglx@linutronix.de>
Date: Fri, 5 Sep 2008 00:22:30 -0400
Subject: [PATCH] powerpc: ftrace stop on crash
 Date: Sun, 27 Jul 2008 09:42:36 +0200
 Stop tracing, when we run into an oops/bug. That way we can see what
 led to that.

Signed-off-by: Thomas Gleixner <tglx@linutronix.de>
---
 arch/powerpc/kernel/traps.c |    3 +++
 1 files changed, 3 insertions(+), 0 deletions(-)

diff --git a/arch/powerpc/kernel/traps.c b/arch/powerpc/kernel/traps.c
index 81ccb8d..868b46d 100644
--- a/arch/powerpc/kernel/traps.c
+++ b/arch/powerpc/kernel/traps.c
@@ -34,6 +34,7 @@
 #include <linux/backlight.h>
 #include <linux/bug.h>
 #include <linux/kdebug.h>
+#include <linux/ftrace.h>
 
 #include <asm/pgtable.h>
 #include <asm/uaccess.h>
@@ -111,6 +112,8 @@ int die(const char *str, struct pt_regs *regs, long err)
 	if (debugger(regs))
 		return 1;
 
+	ftrace_stop();
+
 	oops_enter();
 
 	if (die.lock_owner != raw_smp_processor_id()) {
-- 
1.6.0.90.g436ed

