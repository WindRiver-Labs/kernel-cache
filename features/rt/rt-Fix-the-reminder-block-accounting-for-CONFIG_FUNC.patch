From 3c73e0d89908a303e2f76f587d337712a8e983e1 Mon Sep 17 00:00:00 2001
From: John Kacur <jkacur@redhat.com>
Date: Thu, 29 Apr 2010 22:07:32 +0200
Subject: [PATCH] rt: Fix the reminder block accounting for CONFIG_FUNCTION_TRACER

commit 4c8acb4123ce8dadfc12011613469a5eded09aed in tip.

Make the accounting for CONFIG_FUNCTION_TRACER in DEBUG_COUNT
match that in the reminder block reporting.

Signed-off-by: John Kacur <jkacur@redhat.com>
Cc: Steven Rostedt <rostedt@goodmis.org>
Cc: Clark Williams <williams@redhat.com>
LKML-Reference: <1272571652-5719-1-git-send-email-jkacur@redhat.com>
Signed-off-by: Thomas Gleixner <tglx@linutronix.de>
Signed-off-by: Paul Gortmaker <paul.gortmaker@windriver.com>
---
 init/main.c |   22 ++++++++++++----------
 1 files changed, 12 insertions(+), 10 deletions(-)

diff --git a/init/main.c b/init/main.c
index 627f4c7..ee05de3 100644
--- a/init/main.c
+++ b/init/main.c
@@ -926,15 +926,17 @@ static int __init kernel_init(void * unused)
 	WARN_ON(irqs_disabled());
 #endif
 
-#define DEBUG_COUNT	(defined(CONFIG_DEBUG_RT_MUTEXES) +	\
-			defined(CONFIG_IRQSOFF_TRACER) +	\
-			defined(CONFIG_PREEMPT_TRACER) +	\
-			defined(CONFIG_FUNCTION_TRACER) +	\
-			defined(CONFIG_INTERRUPT_OFF_HIST) +	\
-			defined(CONFIG_PREEMPT_OFF_HIST) +	\
-			defined(CONFIG_DEBUG_SLAB) +		\
-			defined(CONFIG_PREEMPT_OFF_HIST) +	\
-			defined(CONFIG_LOCKDEP))
+#define DEBUG_COUNT	(				\
+		defined(CONFIG_DEBUG_RT_MUTEXES) +	\
+		defined(CONFIG_IRQSOFF_TRACER) +	\
+		defined(CONFIG_PREEMPT_TRACER) +	\
+		defined(CONFIG_INTERRUPT_OFF_HIST) +	\
+		defined(CONFIG_PREEMPT_OFF_HIST) +	\
+		defined(CONFIG_DEBUG_SLAB) +		\
+		defined(CONFIG_PREEMPT_OFF_HIST) +	\
+		defined(CONFIG_LOCKDEP) +		\
+		(defined(CONFIG_FUNCTION_TRACER) -	\
+		 defined(CONFIG_FTRACE_MCOUNT_RECORD)))
 
 #if DEBUG_COUNT > 0
 	printk(KERN_ERR "*****************************************************************************\n");
@@ -954,7 +956,7 @@ static int __init kernel_init(void * unused)
 #ifdef CONFIG_PREEMPT_TRACER
 	printk(KERN_ERR "*        CONFIG_PREEMPT_TRACER                                              *\n");
 #endif
-#if defined(CONFIG_FTRACE) && !defined(CONFIG_FTRACE_MCOUNT_RECORD)
+#if defined(CONFIG_FUNCTION_TRACER) && !defined(CONFIG_FTRACE_MCOUNT_RECORD)
 	printk(KERN_ERR "*        CONFIG_FUNCTION_TRACER                                              *\n");
 #endif
 #ifdef CONFIG_INTERRUPT_OFF_HIST
-- 
1.7.0.4

