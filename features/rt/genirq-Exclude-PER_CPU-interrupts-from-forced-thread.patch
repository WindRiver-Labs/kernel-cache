From ab37f770fe648156cf43a57e342be0d5070a08a3 Mon Sep 17 00:00:00 2001
From: Thomas Gleixner <tglx@linutronix.de>
Date: Wed, 19 Aug 2009 09:18:43 +0200
Subject: [PATCH] genirq: Exclude PER_CPU interrupts from forced threading

commit 6d97e6acc354bc9b69a33a41d74fa7a601dd8122 in tip.

Signed-off-by: Thomas Gleixner <tglx@linutronix.de>
Signed-off-by: Paul Gortmaker <paul.gortmaker@windriver.com>
---
 kernel/irq/manage.c |    2 +-
 1 files changed, 1 insertions(+), 1 deletions(-)

diff --git a/kernel/irq/manage.c b/kernel/irq/manage.c
index a9bbb3d..f92ba84 100644
--- a/kernel/irq/manage.c
+++ b/kernel/irq/manage.c
@@ -477,7 +477,7 @@ static irqreturn_t irq_nested_primary_handler(int irq, void *dev_id)
  */
 static void preempt_hardirq_setup(struct irqaction *new)
 {
-	if (new->thread_fn || (new->flags & IRQF_NODELAY))
+	if (new->thread_fn || (new->flags & (IRQF_NODELAY | IRQF_PERCPU)))
 		return;
 
 	new->flags |= IRQF_ONESHOT;
-- 
1.7.0.4

