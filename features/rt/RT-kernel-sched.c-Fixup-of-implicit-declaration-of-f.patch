From a1b52bf64d4373dc4a72c449f09517aa9227ad06 Mon Sep 17 00:00:00 2001
From: Wu Zhangjin <wuzhangjin@gmail.com>
Date: Thu, 17 Sep 2009 11:44:30 +0800
Subject: [PATCH] RT: kernel/sched.c: Fixup of "implicit declaration of function '_finish_arch_switch'"

commit 605b0999f333b2e5a6361207173725b2bfa2df52 in tip.

This patch fixes the following error:

kernel/sched.c: In function 'finish_task_switch':
kernel/sched.c:2979: error: implicit declaration of function
'_finish_arch_switch'

The following archs have defined their finish_arch_switch:

$ grep finish_arch_switch -ur arch/
arch/s390/include/asm/system.h:#define finish_arch_switch(prev)
arch/sh/include/asm/system_32.h:#define finish_arch_switch(prev
arch/avr32/include/asm/system.h:#define finish_arch_switch(prev)
arch/mips/include/asm/system.h:#define finish_arch_switch(prev)

Signed-off-by: Wu Zhangjin <wuzhangjin@gmail.com>
Signed-off-by: Paul Gortmaker <paul.gortmaker@windriver.com>
---
 kernel/sched.c |    2 ++
 1 files changed, 2 insertions(+), 0 deletions(-)

diff --git a/kernel/sched.c b/kernel/sched.c
index 73ec77a..33c4166 100644
--- a/kernel/sched.c
+++ b/kernel/sched.c
@@ -891,6 +891,8 @@ static inline u64 global_rt_runtime(void)
 #endif
 #ifndef finish_arch_switch
 # define _finish_arch_switch(prev)	do { } while (0)
+#else
+# define _finish_arch_switch		finish_arch_switch
 #endif
 
 static inline int task_current(struct rq *rq, struct task_struct *p)
-- 
1.7.0.4

