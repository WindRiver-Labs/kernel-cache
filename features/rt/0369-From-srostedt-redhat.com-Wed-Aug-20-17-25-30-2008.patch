From 79d56f68abb71d254226235a907acc132e9c5539 Mon Sep 17 00:00:00 2001
From: Steven Rostedt <srostedt@redhat.com>
Date: Fri, 5 Sep 2008 00:24:07 -0400
Subject: [PATCH] From srostedt@redhat.com Wed Aug 20 17:25:30 2008
 Date: Wed, 20 Aug 2008 17:22:34 -0400
 To: Steven Rostedt <rostedt@goodmis.org>
 Subject: [Fwd: [PATCH 2/2] ftrace: fix elevated preempt_count in wakeup-tracer]
     [ The following text is in the "utf-8" character set. ]
     [ Your display is set for the "ANSI_X3.4-1968" character set.  ]
     [ Some characters may be displayed incorrectly. ]

-------- Original Message --------
Subject: 	[PATCH 2/2] ftrace: fix elevated preempt_count in wakeup-tracer
Date: 	Wed, 20 Aug 2008 14:28:25 -0400
To: 	srostedt@redhat.com
References: 	<20080820182819.15463.4146.stgit@dev.haskins.net>


Suggested by Steve Rostedt to fix an observed "+1" in the preempt-count

Signed-off-by: Gregory Haskins <ghaskins@novell.com>
---
 kernel/trace/trace_sched_wakeup.c |    2 ++
 1 files changed, 2 insertions(+), 0 deletions(-)

diff --git a/kernel/trace/trace_sched_wakeup.c b/kernel/trace/trace_sched_wakeup.c
index b3c5699..227eabc 100644
--- a/kernel/trace/trace_sched_wakeup.c
+++ b/kernel/trace/trace_sched_wakeup.c
@@ -70,7 +70,9 @@ wakeup_tracer_call(unsigned long ip, unsigned long parent_ip)
 	if (task_cpu(wakeup_task) != cpu)
 		goto unlock;
 
+	preempt_enable_no_resched_notrace();
 	trace_function(tr, data, ip, parent_ip, flags);
+	preempt_disable_notrace();
 
  unlock:
 	__raw_spin_unlock(&wakeup_lock);
-- 
1.6.0.90.g436ed

