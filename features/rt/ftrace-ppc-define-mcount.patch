---
 arch/powerpc/kernel/Makefile |    4 +---
 arch/powerpc/kernel/ftrace.c |    5 +++++
 2 files changed, 6 insertions(+), 3 deletions(-)

diff --git a/arch/powerpc/kernel/Makefile b/arch/powerpc/kernel/Makefile
index 946daea..2b9b20d 100644
--- a/arch/powerpc/kernel/Makefile
+++ b/arch/powerpc/kernel/Makefile
@@ -18,10 +18,8 @@ CFLAGS_REMOVE_cputable.o = -pg -mno-sched-epilog
 CFLAGS_REMOVE_prom_init.o = -pg -mno-sched-epilog
 CFLAGS_REMOVE_btext.o = -pg -mno-sched-epilog
 
-ifdef CONFIG_DYNAMIC_FTRACE
 # dynamic ftrace setup.
 CFLAGS_REMOVE_ftrace.o = -pg -mno-sched-epilog
-endif
 
 endif
 
@@ -91,7 +89,7 @@ obj-$(CONFIG_KEXEC)		+= machine_kexec.o crash.o \
 obj-$(CONFIG_AUDIT)		+= audit.o
 obj64-$(CONFIG_AUDIT)		+= compat_audit.o
 
-obj-$(CONFIG_DYNAMIC_FTRACE)	+= ftrace.o
+obj-$(CONFIG_FTRACE)		+= ftrace.o
 
 obj-$(CONFIG_8XX_MINIMAL_FPEMU) += softemu8xx.o
 
diff --git a/arch/powerpc/kernel/ftrace.c b/arch/powerpc/kernel/ftrace.c
index 3855ceb..92e3857 100644
--- a/arch/powerpc/kernel/ftrace.c
+++ b/arch/powerpc/kernel/ftrace.c
@@ -11,12 +11,16 @@
 #include <linux/hardirq.h>
 #include <linux/ftrace.h>
 #include <linux/percpu.h>
+#include <linux/module.h>
 #include <linux/init.h>
 #include <linux/list.h>
 
 #include <asm/cacheflush.h>
 #include <asm/ftrace.h>
 
+EXPORT_SYMBOL(_mcount);
+
+#ifdef CONFIG_DYNAMIC_FTRACE
 
 static unsigned int ftrace_nop = 0x60000000;
 
@@ -152,3 +156,4 @@ int __init ftrace_dyn_arch_init(void *data)
 	return 0;
 }
 
+#endif /* CONFIG_DYNAMIC_FTRACE */
