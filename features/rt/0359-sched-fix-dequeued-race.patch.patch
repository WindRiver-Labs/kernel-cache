From 353148755281a247a96e8ed3add0f08f0e98da47 Mon Sep 17 00:00:00 2001
From: Thomas Gleixner <tglx@linutronix.de>
Date: Tue, 30 Sep 2008 17:02:29 -0400
Subject: [PATCH] sched-fix-dequeued-race.patch
 Date: Thu, 24 Jul 2008 16:14:31 +0200
 Signed-off-by: Thomas Gleixner <tglx@linutronix.de>

---
 kernel/sched.c |    3 ++-
 1 files changed, 2 insertions(+), 1 deletions(-)

diff --git a/kernel/sched.c b/kernel/sched.c
index b2c32b5..9faeaf1 100644
--- a/kernel/sched.c
+++ b/kernel/sched.c
@@ -4441,7 +4441,8 @@ void scheduler_tick(void)
 	spin_lock(&rq->lock);
 	update_rq_clock(rq);
 	update_cpu_load(rq);
-	curr->sched_class->task_tick(rq, curr, 0);
+	if (curr != rq->idle && curr->se.on_rq)
+		curr->sched_class->task_tick(rq, curr, 0);
 	spin_unlock(&rq->lock);
 
 #ifdef CONFIG_SMP
-- 
1.6.0.90.g436ed

