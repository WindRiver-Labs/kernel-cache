From 7f9ddc13b8a045207c8c70544ca0f6d439976e0a Mon Sep 17 00:00:00 2001
From: Paul Gortmaker <paul.gortmaker@windriver.com>
Date: Tue, 30 Sep 2008 16:57:24 -0400
Subject: [PATCH] patch preempt-realtime-ftrace.patch

---
 kernel/trace/ftrace.c             |    2 +-
 kernel/trace/trace.c              |    2 +-
 kernel/trace/trace_hist.c         |    2 +-
 kernel/trace/trace_irqsoff.c      |    2 +-
 kernel/trace/trace_sched_wakeup.c |    4 ++--
 5 files changed, 6 insertions(+), 6 deletions(-)

diff --git a/kernel/trace/ftrace.c b/kernel/trace/ftrace.c
index fe7a0d6..1b9d344 100644
--- a/kernel/trace/ftrace.c
+++ b/kernel/trace/ftrace.c
@@ -42,7 +42,7 @@ static int last_ftrace_enabled;
  */
 static int ftrace_disabled __read_mostly;
 
-static DEFINE_SPINLOCK(ftrace_lock);
+static DEFINE_RAW_SPINLOCK(ftrace_lock);
 static DEFINE_MUTEX(ftrace_sysctl_lock);
 
 static struct ftrace_ops ftrace_list_end __read_mostly =
diff --git a/kernel/trace/trace.c b/kernel/trace/trace.c
index 244c060..70bc941 100644
--- a/kernel/trace/trace.c
+++ b/kernel/trace/trace.c
@@ -673,7 +673,7 @@ static unsigned map_pid_to_cmdline[PID_MAX_DEFAULT+1];
 static unsigned map_cmdline_to_pid[SAVED_CMDLINES];
 static char saved_cmdlines[SAVED_CMDLINES][TASK_COMM_LEN];
 static int cmdline_idx;
-static DEFINE_SPINLOCK(trace_cmdline_lock);
+static DEFINE_RAW_SPINLOCK(trace_cmdline_lock);
 
 /* temporary disable recording */
 atomic_t trace_record_cmdline_disabled __read_mostly;
diff --git a/kernel/trace/trace_hist.c b/kernel/trace/trace_hist.c
index aef4385..896866b 100644
--- a/kernel/trace/trace_hist.c
+++ b/kernel/trace/trace_hist.c
@@ -416,7 +416,7 @@ int tracing_wakeup_hist __read_mostly = 1;
 static unsigned wakeup_prio = (unsigned)-1 ;
 static struct task_struct *wakeup_task;
 static cycle_t wakeup_start;
-static DEFINE_SPINLOCK(wakeup_lock);
+static DEFINE_RAW_SPINLOCK(wakeup_lock);
 
 notrace void tracing_hist_wakeup_start(struct task_struct *p,
 				       struct task_struct *curr)
diff --git a/kernel/trace/trace_irqsoff.c b/kernel/trace/trace_irqsoff.c
index 2b10717..1638d1f 100644
--- a/kernel/trace/trace_irqsoff.c
+++ b/kernel/trace/trace_irqsoff.c
@@ -24,7 +24,7 @@ static int				tracer_enabled __read_mostly;
 
 static DEFINE_PER_CPU(int, tracing_cpu);
 
-static DEFINE_SPINLOCK(max_trace_lock);
+static DEFINE_RAW_SPINLOCK(max_trace_lock);
 
 enum {
 	TRACER_IRQS_OFF		= (1 << 1),
diff --git a/kernel/trace/trace_sched_wakeup.c b/kernel/trace/trace_sched_wakeup.c
index 105b1b0..b3c5699 100644
--- a/kernel/trace/trace_sched_wakeup.c
+++ b/kernel/trace/trace_sched_wakeup.c
@@ -26,8 +26,8 @@ static struct task_struct	*wakeup_task;
 static int			wakeup_cpu;
 static unsigned			wakeup_prio = -1;
 
-static raw_spinlock_t wakeup_lock =
-	(raw_spinlock_t)__RAW_SPIN_LOCK_UNLOCKED;
+static __raw_spinlock_t wakeup_lock =
+	(__raw_spinlock_t)__RAW_SPIN_LOCK_UNLOCKED;
 
 static void __wakeup_reset(struct trace_array *tr);
 
-- 
1.6.0.90.g436ed

