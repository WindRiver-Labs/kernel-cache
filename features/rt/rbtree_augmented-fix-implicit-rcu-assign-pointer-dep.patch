From 6ee4821ca926e1f922f479acec9e93bd9471e79e Mon Sep 17 00:00:00 2001
From: Paul Gortmaker <paul.gortmaker@windriver.com>
Date: Mon, 5 Sep 2016 12:42:47 -0400
Subject: [PATCH] rbtree_augmented: fix implicit rcu assign pointer dependency
MIME-Version: 1.0
Content-Type: text/plain; charset=UTF-8
Content-Transfer-Encoding: 8bit

To fix:

In file included from include/linux/interval_tree_generic.h:22:0,
                 from lib/interval_tree.c:2:
include/linux/rbtree_augmented.h: In function ‘__rb_change_child_rcu’:
include/linux/rbtree_augmented.h:139:4: error: implicit declaration of function ‘rcu_assign_pointer’ [-Werror=implicit-function-declaration]
    rcu_assign_pointer(parent->rb_left, new);

...which shows up on some -rt builds once the rb_replace_node_rcu was
added.  Since rcu_assign_pointer is clearly used, just add the header
for it to the file in question.

Fixes: c1adf20052d80 ("Introduce rb_replace_node_rcu()")
Cc: David Howells <dhowells@redhat.com>
Cc: Peter Zijlstra (Intel) <peterz@infradead.org>
Signed-off-by: Paul Gortmaker <paul.gortmaker@windriver.com>

diff --git a/include/linux/rbtree_augmented.h b/include/linux/rbtree_augmented.h
index d076183e49be..36bfb4dd57ae 100644
--- a/include/linux/rbtree_augmented.h
+++ b/include/linux/rbtree_augmented.h
@@ -26,6 +26,7 @@
 
 #include <linux/compiler.h>
 #include <linux/rbtree.h>
+#include <linux/rcupdate.h>
 
 /*
  * Please note - only struct rb_augment_callbacks and the prototypes for
-- 
2.5.0

