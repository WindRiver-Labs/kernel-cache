From 525081d5ce21e05c0b451da8ac3b52b7d56c5e2e Mon Sep 17 00:00:00 2001
From: Jeremy McNicoll <jeremy.mcnicoll@windriver.com>
Date: Fri, 1 May 2009 11:22:21 -0400
Subject: [PATCH] Disallow interrupt controller to run in threaded context

Messages such as:
  BUG: sleeping function called from invalid context at
kernel/rtmutex.c:683

would fill the kernel log buffer.

The root interrupt controller and/or a cascaded interrupt
controller should not be run as a threaded interrupt.
Revert the interrupt controller back to the traditional
behaviour such that critical sections are non-preemptible
and *_irq operations really disable hardware interrupts.

Signed-off-by: Jeremy McNicoll <jeremy.mcnicoll@windriver.com>
---
 arch/powerpc/sysdev/uic.c |    2 +-
 1 files changed, 1 insertions(+), 1 deletions(-)

diff --git a/arch/powerpc/sysdev/uic.c b/arch/powerpc/sysdev/uic.c
index d35405c..7add4a9 100644
--- a/arch/powerpc/sysdev/uic.c
+++ b/arch/powerpc/sysdev/uic.c
@@ -49,7 +49,7 @@ struct uic {
 	int index;
 	int dcrbase;
 
-	spinlock_t lock;
+	raw_spinlock_t lock;
 
 	/* The remapper for this UIC */
 	struct irq_host	*irqhost;
-- 
1.6.0.4

