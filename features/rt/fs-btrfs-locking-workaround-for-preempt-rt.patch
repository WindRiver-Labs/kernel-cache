From: Ingo Molnar <mingo@elte.hu>
Date: Fri, 3 Jul 2009 08:30:28 -0500
Subject: fs: btrfs locking workaround for preempt -rt

- btrfs_path_lock_waiting() looks rather dubious and there's no
  spin_is_contended() method on PREEMPT_RT - so exclude this for now

=> needs a proper fix later. Either this code gets zapped from btrfs
   upstream, or we add spin_is_contended() to PREEMPT_RT too.

Signed-off-by: Ingo Molnar <mingo@elte.hu>
Signed-off-by: Thomas Gleixner <tglx@linutronix.de>

---
 fs/btrfs/locking.c |    2 ++
 1 file changed, 2 insertions(+)

Index: linux-2.6/fs/btrfs/locking.c
===================================================================
--- linux-2.6.orig/fs/btrfs/locking.c
+++ linux-2.6/fs/btrfs/locking.c
@@ -93,6 +93,7 @@ static int btrfs_spin_on_block(struct ex
  */
 int btrfs_try_spin_lock(struct extent_buffer *eb)
 {
+#ifndef CONFIG_PREEMPT_RT_FULL
 	int i;
 
 	if (btrfs_spin_on_block(eb)) {
@@ -112,6 +113,7 @@ int btrfs_try_spin_lock(struct extent_bu
 			return 1;
 		spin_unlock(&eb->lock);
 	}
+#endif
 	return 0;
 }
 
