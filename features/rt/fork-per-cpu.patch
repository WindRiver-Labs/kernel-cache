Date:	Thu, 20 Nov 2008 12:19:26 -0200
From:	Arnaldo Carvalho de Melo <acme@redhat.com>
To:	Alessio Igor Bogani <abogani@texware.it>
Cc:	Paul Gortmaker <paul.gortmaker@windriver.com>,
	linux-rt-users@vger.kernel.org
Subject: Re: 2.6.27.5 RT patch status (26rt11)


Em Thu, Nov 20, 2008 at 02:43:09PM +0100, Alessio Igor Bogani escreveu:
> Dear Sir Carvalho de Melo,
>
> 2008/11/20 Arnaldo Carvalho de Melo <acme@redhat.com>:
> [...]
> >> I hit one, DELL PE1900, dual dual core xeon, megasas disk controler,
> [...]
> >> BUG: unable to handle kernel NULL pointer dereference at 0000000000000008
> [...]
>
> Could you try this patch, please?
>
> Thanks!
>
> Ciao,
> Alessio
>
> Index: linux-source-2.6.27/kernel/fork.c
> ===================================================================
> --- linux-source-2.6.27.orig/kernel/fork.c  2008-11-11 10:50:21.000000000 +0100
> +++ linux-source-2.6.27/kernel/fork.c   2008-11-11 10:50:40.000000000 +0100
> @@ -229,7 +229,7 @@
>     init_task.signal->rlim[RLIMIT_SIGPENDING] =
>         init_task.signal->rlim[RLIMIT_NPROC];
>
> -   for (i = 0; i < NR_CPUS; i++)
> +   for (i = 0; i < nr_cpu_ids; i++)
>         INIT_LIST_HEAD(&per_cpu(delayed_drop_list, i));
>  }

Wouldn't it be better to use for_each_possible_cpu()? But yes, it fixes
this problem.

[PG: should fold into parent preempt-realtime-mmdrop-delayed.patch]

---
 kernel/fork.c |    2 +-
 1 files changed, 1 insertions(+), 1 deletions(-)

diff --git a/kernel/fork.c b/kernel/fork.c
index adbd357..293cc7f 100644
--- a/kernel/fork.c
+++ b/kernel/fork.c
@@ -229,7 +229,7 @@ void __init fork_init(unsigned long mempages)
 	init_task.signal->rlim[RLIMIT_SIGPENDING] =
 		init_task.signal->rlim[RLIMIT_NPROC];
 
-	for (i = 0; i < NR_CPUS; i++)
+	for_each_possible_cpu(i)
 		INIT_LIST_HEAD(&per_cpu(delayed_drop_list, i));
 }
 
