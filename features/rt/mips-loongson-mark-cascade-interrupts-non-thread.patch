From: Wu Zhangjin <wuzhangjin@gmail.com>
Date: Wed, 10 Mar 2010 02:03:26 +0800
Subject: MIPS: Loongson: Mark cascade interrupts IRQF_NO_THREAD

There are two cascade interrupts in Loongson machines, one for bonito
northbridge, another for the 8259A controller in the southbridge. Both
want to be non threaded.

Signed-off-by: Wu Zhangjin <wuzhangjin@gmail.com>
Signed-off-by: Thomas Gleixner <tglx@linutronix.de>

---
 arch/mips/loongson/fuloong-2e/irq.c |    1 +
 arch/mips/loongson/lemote-2f/irq.c  |    3 ++-
 2 files changed, 3 insertions(+), 1 deletion(-)

Index: linux-2.6-tip/arch/mips/loongson/fuloong-2e/irq.c
===================================================================
--- linux-2.6-tip.orig/arch/mips/loongson/fuloong-2e/irq.c
+++ linux-2.6-tip/arch/mips/loongson/fuloong-2e/irq.c
@@ -42,6 +42,7 @@ asmlinkage void mach_irq_dispatch(unsign
 static struct irqaction cascade_irqaction = {
 	.handler = no_action,
 	.name = "cascade",
+	.flags = IRQF_NO_THREAD,
 };
 
 void __init mach_init_irq(void)
Index: linux-2.6-tip/arch/mips/loongson/lemote-2f/irq.c
===================================================================
--- linux-2.6-tip.orig/arch/mips/loongson/lemote-2f/irq.c
+++ linux-2.6-tip/arch/mips/loongson/lemote-2f/irq.c
@@ -96,12 +96,13 @@ static irqreturn_t ip6_action(int cpl, v
 struct irqaction ip6_irqaction = {
 	.handler = ip6_action,
 	.name = "cascade",
-	.flags = IRQF_SHARED,
+	.flags = IRQF_SHARED | IRQF_NO_THREAD,
 };
 
 struct irqaction cascade_irqaction = {
 	.handler = no_action,
 	.name = "cascade",
+	.flags = IRQF_NO_THREAD,
 };
 
 void __init mach_init_irq(void)
