From c25dc02f28e088b2269cbce342b119cbc7c3600c Mon Sep 17 00:00:00 2001
From: Thomas Gleixner <tglx@linutronix.de>
Date: Mon, 12 Aug 2013 09:16:09 +0200
Subject: [PATCH] mm: disable slab on rt


diff --git a/init/Kconfig b/init/Kconfig
index 6417f4c77a98..c3cf2a465841 100644
--- a/init/Kconfig
+++ b/init/Kconfig
@@ -1542,6 +1542,7 @@ choice
 
 config SLAB
 	bool "SLAB"
+	depends on !PREEMPT_RT_FULL
 	help
 	  The regular slab allocator that is established and known to work
 	  well in all environments. It organizes cache hot objects in
diff --git a/mm/slab.h b/mm/slab.h
index 4d6d836247dd..fc3c0976e664 100644
--- a/mm/slab.h
+++ b/mm/slab.h
@@ -247,7 +247,11 @@ static inline struct kmem_cache *cache_from_obj(struct kmem_cache *s, void *x)
  * The slab lists for all objects.
  */
 struct kmem_cache_node {
+#ifdef CONFIG_SLAB
 	spinlock_t list_lock;
+#else
+	raw_spinlock_t list_lock;
+#endif
 
 #ifdef CONFIG_SLAB
 	struct list_head slabs_partial;	/* partial list first, better asm code */
-- 
2.1.0

