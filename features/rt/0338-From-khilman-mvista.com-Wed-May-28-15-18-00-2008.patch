From 106d8a20de1fdcf908e2d1c65204c5dd472403d0 Mon Sep 17 00:00:00 2001
From: Kevin Hilman <khilman@mvista.com>
Date: Tue, 30 Sep 2008 17:02:08 -0400
Subject: [PATCH] From khilman@mvista.com Wed May 28 15:18:00 2008
 Date: Tue, 20 May 2008 15:45:50 -0700
 To: linux-rt-users@vger.kernel.org
 Cc: linux-omap@vger.kernel.org, Kevin Hilman <khilman@mvista.com>
 Subject: [PATCH 5/5] ARM: OMAP: remove unnecessary locking in clk_get_rate()
 The locking in the get_rate() hook is unnecessary, and causes problems
 when used with the -rt patch, since it may be called recursively.

Signed-off-by: Kevin Hilman <khilman@mvista.com>
---
 arch/arm/plat-omap/clock.c |    3 ---
 1 files changed, 0 insertions(+), 3 deletions(-)

diff --git a/arch/arm/plat-omap/clock.c b/arch/arm/plat-omap/clock.c
index 197974d..eaf4014 100644
--- a/arch/arm/plat-omap/clock.c
+++ b/arch/arm/plat-omap/clock.c
@@ -133,15 +133,12 @@ EXPORT_SYMBOL(clk_get_usecount);
 
 unsigned long clk_get_rate(struct clk *clk)
 {
-	unsigned long flags;
 	unsigned long ret = 0;
 
 	if (clk == NULL || IS_ERR(clk))
 		return 0;
 
-	spin_lock_irqsave(&clockfw_lock, flags);
 	ret = clk->rate;
-	spin_unlock_irqrestore(&clockfw_lock, flags);
 
 	return ret;
 }
-- 
1.6.0.90.g436ed

