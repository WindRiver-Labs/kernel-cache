From 840a16552f39af265ee5bd5181b93924d108dde1 Mon Sep 17 00:00:00 2001
From: Harry Ciao <qingtao.cao@windriver.com>
Date: Mon, 29 Dec 2008 10:15:34 +0800
Subject: [PATCH] EDAC: release vMC sensor LUN number

EDAC module should release the LUN number it used during removal,
this way it could have a chance to pick up the same number if it's
re-installed again. The benefit of doing so is that if there are more
than one EDAC modules and one of them gets removed and then re-installed,
it's expected that they could still get different LUN numbers.

Signed-off-by: Harry Ciao <qingtao.cao@windriver.com>
---
 drivers/edac/amd8111_edac.c |    2 ++
 drivers/edac/amd8131_edac.c |    2 ++
 drivers/edac/cpc925_edac.c  |    2 ++
 drivers/edac/e7xxx_edac.c   |    2 ++
 drivers/edac/mv64x60_edac.c |    2 ++
 5 files changed, 10 insertions(+), 0 deletions(-)

diff --git a/drivers/edac/amd8111_edac.c b/drivers/edac/amd8111_edac.c
index 52d299a..738117f 100644
--- a/drivers/edac/amd8111_edac.c
+++ b/drivers/edac/amd8111_edac.c
@@ -80,6 +80,8 @@ static void uninit_vmc_sensors(void)
 	vmc_sensor_uninit(VMC_MEM_LIMIT_STA, amd8111_vmc_lun);
 	vmc_sensor_uninit(VMC_MEM_LIMIT_MDPE, amd8111_vmc_lun);
 	vmc_sensor_uninit(VMC_IO_CTRL_1_LPC_ERR, amd8111_vmc_lun);
+
+	vmc_release_lun(amd8111_vmc_lun);
 }
 
 
diff --git a/drivers/edac/amd8131_edac.c b/drivers/edac/amd8131_edac.c
index c3c8c4e..6732b75 100644
--- a/drivers/edac/amd8131_edac.c
+++ b/drivers/edac/amd8131_edac.c
@@ -252,6 +252,8 @@ static void uninit_vmc_sensors(void)
 	vmc_sensor_uninit(VMC_SOUTH_B_MEM_LIMIT_RTA, amd8131_vmc_lun);
 	vmc_sensor_uninit(VMC_SOUTH_B_MEM_LIMIT_STA, amd8131_vmc_lun);
 	vmc_sensor_uninit(VMC_SOUTH_B_MEM_LIMIT_MDPE, amd8131_vmc_lun);
+
+	vmc_release_lun(amd8131_vmc_lun);
 }
 #endif /* CONFIG_EDAC_VMC */
 
diff --git a/drivers/edac/cpc925_edac.c b/drivers/edac/cpc925_edac.c
index 431c870..d330af7 100644
--- a/drivers/edac/cpc925_edac.c
+++ b/drivers/edac/cpc925_edac.c
@@ -108,6 +108,8 @@ static void uninit_vmc_sensors(void)
 	vmc_sensor_uninit(VMC_PROCINT_ADDR1_MASK, cpc925_vmc_lun);
 
 	vmc_sensor_uninit(VMC_HT_FLT, cpc925_vmc_lun);
+
+	vmc_release_lun(cpc925_vmc_lun);
 }
 
 #endif /* CONFIG_EDAC_VMC */
diff --git a/drivers/edac/e7xxx_edac.c b/drivers/edac/e7xxx_edac.c
index f2d5753..88d84e3 100644
--- a/drivers/edac/e7xxx_edac.c
+++ b/drivers/edac/e7xxx_edac.c
@@ -1098,6 +1098,8 @@ static void uninit_vmc_sensors(void)
 	vmc_sensor_uninit(HIB_FLT, e7xxx_vmc_lun);
 	vmc_sensor_uninit(HIC_FLT, e7xxx_vmc_lun);
 	vmc_sensor_uninit(HID_FLT, e7xxx_vmc_lun);
+
+	vmc_release_lun(e7xxx_vmc_lun);
 }
 
 #endif /* CONFIG_EDAC_VMC */
diff --git a/drivers/edac/mv64x60_edac.c b/drivers/edac/mv64x60_edac.c
index e99a49d..9ca3da5 100644
--- a/drivers/edac/mv64x60_edac.c
+++ b/drivers/edac/mv64x60_edac.c
@@ -101,6 +101,8 @@ static void uninit_vmc_sensors(void)
 	vmc_sensor_uninit(VMC_COMM, mv64x60_vmc_lun);
 	vmc_sensor_uninit(VMC_ETH, mv64x60_vmc_lun);
 	vmc_sensor_uninit(VMC_DMA, mv64x60_vmc_lun);
+
+	vmc_release_lun(mv64x60_vmc_lun);
 }
 
 #endif /* CONFIG_EDAC_VMC */
-- 
1.6.0.3

