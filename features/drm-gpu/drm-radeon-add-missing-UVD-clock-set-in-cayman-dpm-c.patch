From 267a8facdebf3f452b5c95fcfc633b869e1b1155 Mon Sep 17 00:00:00 2001
From: Alex Deucher <alexander.deucher@amd.com>
Date: Mon, 11 Feb 2013 13:27:23 -0500
Subject: [PATCH 504/886] drm/radeon: add missing UVD clock set in cayman dpm
 code

commit a5b91af2e2e36e6031296675cf0c060879268032 upstream

Signed-off-by: Alex Deucher <alexander.deucher@amd.com>
---
 drivers/gpu/drm/radeon/ni_dpm.c |    3 +++
 1 file changed, 3 insertions(+)

diff --git a/drivers/gpu/drm/radeon/ni_dpm.c b/drivers/gpu/drm/radeon/ni_dpm.c
index d91e887..7530ee9 100644
--- a/drivers/gpu/drm/radeon/ni_dpm.c
+++ b/drivers/gpu/drm/radeon/ni_dpm.c
@@ -3681,9 +3681,11 @@ int ni_dpm_set_power_state(struct radeon_device *rdev)
 {
 	struct evergreen_power_info *eg_pi = evergreen_get_pi(rdev);
 	struct radeon_ps *new_ps = &eg_pi->requested_rps;
+	struct radeon_ps *old_ps = &eg_pi->current_rps;
 	int ret;
 
 	ni_restrict_performance_levels_before_switch(rdev);
+	rv770_set_uvd_clock_before_set_eng_clock(rdev, new_ps, old_ps);
 	ni_enable_power_containment(rdev, new_ps, false);
 	ni_enable_smc_cac(rdev, new_ps, false);
 	rv770_halt_smc(rdev);
@@ -3698,6 +3700,7 @@ int ni_dpm_set_power_state(struct radeon_device *rdev)
 	ni_populate_smc_tdp_limits(rdev, new_ps);
 	rv770_resume_smc(rdev);
 	rv770_set_sw_state(rdev);
+	rv770_set_uvd_clock_after_set_eng_clock(rdev, new_ps, old_ps);
 	ni_enable_smc_cac(rdev, new_ps, true);
 	ni_enable_power_containment(rdev, new_ps, true);
 
-- 
1.7.9.5

