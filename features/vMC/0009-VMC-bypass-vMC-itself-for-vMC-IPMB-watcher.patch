From d115dc8e3c55e2a6ab1863530e36977351ea22d2 Mon Sep 17 00:00:00 2001
From: Harry Ciao <qingtao.cao@windriver.com>
Date: Thu, 5 Feb 2009 18:33:18 +0800
Subject: [PATCH] VMC: bypass vMC itself for vMC IPMB watcher

Since multiple vMCs are supported, comparing vMC's intf_num with 1 would
no longer be applicable. However, we could fall back on vMC's driver name
to bypass all vMCs and register smi_watcher for BMC SMI.

Signed-off-by: Harry Ciao <qingtao.cao@windriver.com>
---
 drivers/char/ipmi/vmc_ipmb.c |    4 ++--
 1 files changed, 2 insertions(+), 2 deletions(-)

diff --git a/drivers/char/ipmi/vmc_ipmb.c b/drivers/char/ipmi/vmc_ipmb.c
index 5c2b5f5..5501f3a 100644
--- a/drivers/char/ipmi/vmc_ipmb.c
+++ b/drivers/char/ipmi/vmc_ipmb.c
@@ -150,8 +150,8 @@ void ipmi_new_smi(int if_num, struct device *device)
 	struct bmc_private *bmc_priv;
 	int rc;
 
-	/* Ignore if_num=1 as vMC should be on that interface */
-	if (if_num == 1) {
+	/* Bypass vMC itself */
+	if (strcmp(device->driver->name, VMC_DEVICE_NAME) == 0) {
 		if (vmcDebug) {
 			printk(KERN_INFO "vMC: Ignoring registration of IPMI " \
 				"interface number %d\n", if_num);
-- 
1.6.0.3

