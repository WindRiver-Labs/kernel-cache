From 99ccbfe4ca282e1fc777f34e830a4232f1a271af Mon Sep 17 00:00:00 2001
From: Zumeng Chen <zumeng.chen@windriver.com>
Date: Fri, 5 Mar 2010 16:51:42 +0800
Subject: [PATCH] kmemcheck: fix compiling error for other arches

kmemcheck is not supported by others arches.

Signed-off-by: Zumeng Chen <zumeng.chen@windriver.com>
---
 include/linux/kmemcheck.h |    2 +-
 kernel/sysctl.c           |    2 +-
 mm/kmemcheck.c            |    2 ++
 3 files changed, 4 insertions(+), 2 deletions(-)

diff --git a/include/linux/kmemcheck.h b/include/linux/kmemcheck.h
index b1b195e..140ee7d 100644
--- a/include/linux/kmemcheck.h
+++ b/include/linux/kmemcheck.h
@@ -4,7 +4,7 @@
 #include <linux/mm_types.h>
 #include <linux/types.h>
 
-#ifdef CONFIG_KMEMCHECK
+#if defined(CONFIG_KMEMCHECK) && (defined(CONFIG_X86) || defined(CONFIG_ARM))
 extern int kmemcheck_enabled;
 
 /* The slab-related functions. */
diff --git a/kernel/sysctl.c b/kernel/sysctl.c
index 2b8183c..d079b1f 100644
--- a/kernel/sysctl.c
+++ b/kernel/sysctl.c
@@ -851,7 +851,7 @@ static struct ctl_table kern_table[] = {
 		.proc_handler   = &proc_dointvec,
 	},
 #endif
-#ifdef CONFIG_KMEMCHECK
+#if defined(CONFIG_KMEMCHECK) && (defined(CONFIG_X86) || defined(CONFIG_ARM))
 	{
 		.ctl_name	= CTL_UNNUMBERED,
 		.procname	= "kmemcheck",
diff --git a/mm/kmemcheck.c b/mm/kmemcheck.c
index fd814fd..ee19e5c 100644
--- a/mm/kmemcheck.c
+++ b/mm/kmemcheck.c
@@ -4,6 +4,7 @@
 #include <linux/slab.h>
 #include <linux/kmemcheck.h>
 
+#if defined(CONFIG_X86) || defined(CONFIG_ARM)
 void kmemcheck_alloc_shadow(struct page *page, int order, gfp_t flags, int node)
 {
 	struct page *shadow;
@@ -120,3 +121,4 @@ void kmemcheck_pagealloc_alloc(struct page *page, unsigned int order,
 	else
 		kmemcheck_mark_uninitialized_pages(page, pages);
 }
+#endif /*#if defined(CONFIG_X86) || defined(CONFIG_ARM)*/
-- 
1.6.0.3

