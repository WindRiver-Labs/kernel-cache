From af6af834f9d53f4ae9bd76f4fc1081279bb6ca88 Mon Sep 17 00:00:00 2001
From: Amy Fong <amy.fong@windriver.com>
Date: Fri, 15 Jul 2011 13:42:07 -0400
Subject: [PATCH] lxc: cgl: introduce lxc namespace functionality

Note: This contains the cgl parts of the lxc patches needed to enable
lxc namespace functionality needed for lxc-attach userspace tool.
These cgl parts a different from the base part because they won't patch
onto a standard kernel.

Signed-off-by: Amy Fong <amy.fong@windriver.com>
---
 fs/namespace.c |    2 +-
 1 files changed, 1 insertions(+), 1 deletions(-)

diff --git a/fs/namespace.c b/fs/namespace.c
index 115c3ed..ec6a96b 100644
--- a/fs/namespace.c
+++ b/fs/namespace.c
@@ -2413,7 +2413,7 @@ static int mntns_install(struct nsproxy *nsproxy, void *ns)
 	struct mnt_namespace *mnt_ns = ns;
 	struct path root;
 
-	if (fs->users != 1)
+	if (atomic_read(&fs->users) != 1)
 		return -EINVAL;
 
 	get_mnt_ns(mnt_ns);
-- 
1.7.0.4

