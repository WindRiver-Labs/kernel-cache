From 481524becfe199eb53c003252ff6212b110fae07 Mon Sep 17 00:00:00 2001
From: Bruce Ashfield <bruce.ashfield@windriver.com>
Date: Tue, 25 May 2010 13:51:26 -0400
Subject: [PATCH] drm: cgl: atomic access to dev->open_count

Access to dev->open_count needs to be atomic to match the changes
introduced by pax / grsec.

Signed-off-by: Bruce Ashfield <bruce.ashfield@windriver.com>
---
 drivers/gpu/drm/radeon/radeon_device.c |    2 +-
 1 files changed, 1 insertions(+), 1 deletions(-)

diff --git a/drivers/gpu/drm/radeon/radeon_device.c b/drivers/gpu/drm/radeon/radeon_device.c
index 7b629e3..077c5be 100644
--- a/drivers/gpu/drm/radeon/radeon_device.c
+++ b/drivers/gpu/drm/radeon/radeon_device.c
@@ -560,7 +560,7 @@ static bool radeon_switcheroo_can_switch(struct pci_dev *pdev)
 	bool can_switch;
 
 	spin_lock(&dev->count_lock);
-	can_switch = (dev->open_count == 0);
+	can_switch = (atomic_read(&dev->open_count) == 0);
 	spin_unlock(&dev->count_lock);
 	return can_switch;
 }
-- 
1.7.0

