From 66b11fee6711c047b630d3bbb717c8114877b850 Mon Sep 17 00:00:00 2001
From: Haiying Wang <Haiying.wang@freescale.com>
Date: Sat, 8 Aug 2015 07:26:32 -0400
Subject: [PATCH 213/214] vfio/fsl_mc: use caccheable non-shareable memory for
 cena

QBMan CENA portal memory needs to be cacheable and non-shareable.

Signed-off-by: Haiying Wang <Haiying.wang@freescale.com>
[Original patch extracted from FSL LS2085 SDK EAR5.0,
Layerscape2-SDK-SOURCE-20150828-yocto.iso]
Signed-off-by: Jiang Lu <lu.jiang@windriver.com>
---
 drivers/vfio/fsl-mc/vfio_fsl_mc.c | 2 +-
 1 file changed, 1 insertion(+), 1 deletion(-)

diff --git a/drivers/vfio/fsl-mc/vfio_fsl_mc.c b/drivers/vfio/fsl-mc/vfio_fsl_mc.c
index 18f263c..20ae567 100644
--- a/drivers/vfio/fsl-mc/vfio_fsl_mc.c
+++ b/drivers/vfio/fsl-mc/vfio_fsl_mc.c
@@ -279,7 +279,7 @@ static int vfio_fsl_mc_mmap(void *device_data, struct vm_area_struct *vma)
 
 #define QBMAN_SWP_CENA_BASE 0x818000000ULL
 	if ((addr & 0xFFF000000) == QBMAN_SWP_CENA_BASE)
-		vma->vm_page_prot = pgprot_cached(vma->vm_page_prot);
+		vma->vm_page_prot = pgprot_cached_ns(vma->vm_page_prot);
 	else
 		vma->vm_page_prot = pgprot_noncached(vma->vm_page_prot);
 
-- 
2.5.3

