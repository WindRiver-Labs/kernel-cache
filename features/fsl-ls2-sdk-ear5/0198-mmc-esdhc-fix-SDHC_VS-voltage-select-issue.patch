From 995dde98cd6db18c3a4dca44718315671f876b4e Mon Sep 17 00:00:00 2001
From: Yangbo Lu <yangbo.lu@freescale.com>
Date: Tue, 21 Apr 2015 14:30:32 +0800
Subject: [PATCH 198/214] mmc: esdhc: fix SDHC_VS voltage select issue

The eSDHC don't have a standard power control register, so when
writing this register the eSDHC should do nothing in case of
incorrect operation.

Signed-off-by: Yangbo Lu <yangbo.lu@freescale.com>
Change-Id: Ifd4842bcb1147d10dfe2aaebc742893785873b6a
Reviewed-on: http://git.am.freescale.net:8181/35447
Tested-by: Review Code-CDREVIEW <CDREVIEW@freescale.com>
Reviewed-by: Xiaobo Xie <X.Xie@freescale.com>
Reviewed-by: Stuart Yoder <stuart.yoder@freescale.com>
[Original patch extracted from FSL LS2085 SDK EAR5.0,
Layerscape2-SDK-SOURCE-20150828-yocto.iso]
Signed-off-by: Jiang Lu <lu.jiang@windriver.com>
---
 drivers/mmc/host/sdhci-of-esdhc.c | 5 +++++
 1 file changed, 5 insertions(+)

diff --git a/drivers/mmc/host/sdhci-of-esdhc.c b/drivers/mmc/host/sdhci-of-esdhc.c
index 7eeb1a2..a9436b1 100644
--- a/drivers/mmc/host/sdhci-of-esdhc.c
+++ b/drivers/mmc/host/sdhci-of-esdhc.c
@@ -137,6 +137,11 @@ static void esdhc_writew(struct sdhci_host *host, u16 val, int reg)
 static void esdhc_writeb(struct sdhci_host *host, u8 val, int reg)
 {
 	/*
+	 * Don't have a standard power control register, exit this function
+	 */
+	if (reg == SDHCI_POWER_CONTROL)
+		return;
+	/*
 	 * "DMA select" location is offset 0x28 in SD specification, but on
 	 * P5020 or P3041, it's located at 0x29.
 	 */
-- 
2.5.3

