From 7aafd8e4169580f1b7fb8eea0a19eb79c82c61cd Mon Sep 17 00:00:00 2001
From: Razvan Stefanescu <razvan.stefanescu@freescale.com>
Date: Tue, 2 Jun 2015 11:03:27 +0300
Subject: [PATCH 120/214] staging: fsl-dpaa2: evb: Rebasing onto kernel 4.0

Signed-off-by: Razvan Stefanescu <razvan.stefanescu@freescale.com>
Change-Id: If64621d0aa4a4154e320ffc3f45218562d49a863
Reviewed-on: http://git.am.freescale.net:8181/37255
Tested-by: Review Code-CDREVIEW <CDREVIEW@freescale.com>
Reviewed-by: Alexandru Marginean <Alexandru.Marginean@freescale.com>
Reviewed-by: Stuart Yoder <stuart.yoder@freescale.com>
[Original patch extracted from FSL LS2085 SDK EAR5.0,
Layerscape2-SDK-SOURCE-20150828-yocto.iso]
Signed-off-by: Jiang Lu <lu.jiang@windriver.com>
---
 drivers/staging/fsl-dpaa2/evb/evb.c | 11 ++++++++---
 1 file changed, 8 insertions(+), 3 deletions(-)

diff --git a/drivers/staging/fsl-dpaa2/evb/evb.c b/drivers/staging/fsl-dpaa2/evb/evb.c
index 3679584..a077554 100644
--- a/drivers/staging/fsl-dpaa2/evb/evb.c
+++ b/drivers/staging/fsl-dpaa2/evb/evb.c
@@ -278,7 +278,9 @@ static int evb_setlink_af_spec(struct net_device *netdev,
 	return 0;
 }
 
-static int evb_setlink(struct net_device *netdev, struct nlmsghdr *nlh)
+static int evb_setlink(struct net_device *netdev,
+		       struct nlmsghdr *nlh,
+		       u16 flags)
 {
 	struct evb_port_priv	*port_priv = netdev_priv(netdev);
 	struct evb_priv		*evb_priv = port_priv->evb_priv;
@@ -478,14 +480,17 @@ static int evb_getlink(struct sk_buff *skb, u32 pid, u32 seq,
 			goto nla_put_err;
 	}
 
-	return nlmsg_end(skb, nlh);
+	nlmsg_end(skb, nlh);
+	return skb->len;
 
 nla_put_err:
 	nlmsg_cancel(skb, nlh);
 	return -EMSGSIZE;
 }
 
-static int evb_dellink(struct net_device *netdev, struct nlmsghdr *nlh)
+static int evb_dellink(struct net_device *netdev,
+		       struct nlmsghdr *nlh,
+		       u16 flags)
 {
 	struct nlattr		*tb[IFLA_BRIDGE_MAX+1];
 	struct nlattr		*spec;
-- 
2.5.3

