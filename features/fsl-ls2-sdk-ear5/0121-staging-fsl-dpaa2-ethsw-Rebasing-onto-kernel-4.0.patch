From 2441ec95c035569f6eb0741eef4c7e294f8ecbc6 Mon Sep 17 00:00:00 2001
From: Razvan Stefanescu <razvan.stefanescu@freescale.com>
Date: Tue, 2 Jun 2015 11:03:52 +0300
Subject: [PATCH 121/214] staging: fsl-dpaa2: ethsw: Rebasing onto kernel 4.0

Signed-off-by: Razvan Stefanescu <razvan.stefanescu@freescale.com>
Change-Id: I4e674fef42173ce04e6a226fd996c8f0684cd239
Reviewed-on: http://git.am.freescale.net:8181/37256
Tested-by: Review Code-CDREVIEW <CDREVIEW@freescale.com>
Reviewed-by: Alexandru Marginean <Alexandru.Marginean@freescale.com>
Reviewed-by: Stuart Yoder <stuart.yoder@freescale.com>
[Original patch extracted from FSL LS2085 SDK EAR5.0,
Layerscape2-SDK-SOURCE-20150828-yocto.iso]
Signed-off-by: Jiang Lu <lu.jiang@windriver.com>
---
 drivers/staging/fsl-dpaa2/ethsw/switch.c | 11 ++++++++---
 1 file changed, 8 insertions(+), 3 deletions(-)

diff --git a/drivers/staging/fsl-dpaa2/ethsw/switch.c b/drivers/staging/fsl-dpaa2/ethsw/switch.c
index ac886c3..28deb79 100644
--- a/drivers/staging/fsl-dpaa2/ethsw/switch.c
+++ b/drivers/staging/fsl-dpaa2/ethsw/switch.c
@@ -426,7 +426,9 @@ static int ethsw_setlink_protinfo(struct net_device *netdev,
 	return 0;
 }
 
-static int ethsw_setlink(struct net_device *netdev, struct nlmsghdr *nlh)
+static int ethsw_setlink(struct net_device *netdev,
+			 struct nlmsghdr *nlh,
+			 u16 flags)
 {
 	struct nlattr	*attr;
 	struct nlattr	*tb[(IFLA_BRIDGE_MAX > IFLA_BRPORT_MAX) ?
@@ -647,7 +649,8 @@ static int ethsw_getlink(struct sk_buff *skb, u32 pid, u32 seq,
 			goto nla_put_err;
 	}
 
-	return nlmsg_end(skb, nlh);
+	nlmsg_end(skb, nlh);
+	return skb->len;
 
 nla_put_err:
 	nlmsg_cancel(skb, nlh);
@@ -720,7 +723,9 @@ static int ethsw_dellink_port(struct ethsw_dev_priv *priv,
 	return 0;
 }
 
-static int ethsw_dellink(struct net_device *netdev, struct nlmsghdr *nlh)
+static int ethsw_dellink(struct net_device *netdev,
+			 struct nlmsghdr *nlh,
+			 u16 flags)
 {
 	struct nlattr		*tb[IFLA_BRIDGE_MAX+1];
 	struct nlattr		*spec;
-- 
2.5.3

