From 0de4977b62e0524b203171cda9e3454e8157a3a1 Mon Sep 17 00:00:00 2001
From: Haiying Wang <Haiying.Wang@freescale.com>
Date: Tue, 12 May 2015 12:15:12 -0400
Subject: [PATCH 206/214] fsl-vfio: use cacheable memory for CENA SWP memory

Signed-off-by: Haiying Wang <Haiying.Wang@freescale.com>
Change-Id: Iaeafc2f686b825a3d28f7a174da812e211aed7dc
Reviewed-on: http://git.am.freescale.net:8181/36993
Tested-by: Review Code-CDREVIEW <CDREVIEW@freescale.com>
Reviewed-by: Bharat Bhushan <Bharat.Bhushan@freescale.com>
Reviewed-by: Roy Pledge <roy.pledge@freescale.com>
Reviewed-by: Bhupesh Sharma <bhupesh.sharma@freescale.com>
Tested-by: Bhupesh Sharma <bhupesh.sharma@freescale.com>
(cherry picked from commit 7f2a820dba8ff3e4a07c20e7a65f1ed33ccb0509)
[Original patch extracted from FSL LS2085 SDK EAR5.0,
Layerscape2-SDK-SOURCE-20150828-yocto.iso]
Signed-off-by: Jiang Lu <lu.jiang@windriver.com>
---
 drivers/vfio/fsl-mc/vfio_fsl_mc.c | 2 +-
 1 file changed, 1 insertion(+), 1 deletion(-)

diff --git a/drivers/vfio/fsl-mc/vfio_fsl_mc.c b/drivers/vfio/fsl-mc/vfio_fsl_mc.c
index c600cc8..dcd9380 100644
--- a/drivers/vfio/fsl-mc/vfio_fsl_mc.c
+++ b/drivers/vfio/fsl-mc/vfio_fsl_mc.c
@@ -205,7 +205,7 @@ static int vfio_fsl_mc_mmap(void *device_data, struct vm_area_struct *vma)
 
 #define QBMAN_SWP_CENA_BASE 0x818000000ULL
 	if ((addr & 0xFFF000000) == QBMAN_SWP_CENA_BASE)
-		vma->vm_page_prot = pgprot_writecombine(vma->vm_page_prot);
+		vma->vm_page_prot = pgprot_cached(vma->vm_page_prot);
 	else
 		vma->vm_page_prot = pgprot_noncached(vma->vm_page_prot);
 
-- 
2.5.3

