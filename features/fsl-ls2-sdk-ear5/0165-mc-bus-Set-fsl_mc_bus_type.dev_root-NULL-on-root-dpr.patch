From 86aa88e3cfdf86ac22d777327f0308c4183c4b54 Mon Sep 17 00:00:00 2001
From: Bharat Bhushan <Bharat.Bhushan@freescale.com>
Date: Thu, 16 Jul 2015 14:41:50 +0530
Subject: [PATCH 165/214] mc-bus: Set fsl_mc_bus_type.dev_root NULL on root
 dprc remove

We were not setting fsl_mc_bus_type.dev_root to NULL when
root DPRC unbound. If we do not do make this NULL
then we will not be able to bind the device again.

Signed-off-by: Bharat Bhushan <Bharat.Bhushan@freescale.com>
[Original patch extracted from FSL LS2085 SDK EAR5.0,
Layerscape2-SDK-SOURCE-20150828-yocto.iso]
Signed-off-by: Jiang Lu <lu.jiang@windriver.com>
---
 drivers/staging/fsl-mc/bus/dprc-driver.c | 3 +++
 1 file changed, 3 insertions(+)

diff --git a/drivers/staging/fsl-mc/bus/dprc-driver.c b/drivers/staging/fsl-mc/bus/dprc-driver.c
index 05afa9f..7630b0c 100644
--- a/drivers/staging/fsl-mc/bus/dprc-driver.c
+++ b/drivers/staging/fsl-mc/bus/dprc-driver.c
@@ -1025,6 +1025,9 @@ static int dprc_remove(struct fsl_mc_device *mc_dev)
 	if (fsl_mc_interrupts_supported())
 		fsl_mc_cleanup_irq_pool(mc_bus);
 
+	if (&mc_dev->dev == fsl_mc_bus_type.dev_root)
+		fsl_mc_bus_type.dev_root = NULL;
+
 	dev_info(&mc_dev->dev, "DPRC device unbound from driver");
 	return 0;
 }
-- 
2.5.3

