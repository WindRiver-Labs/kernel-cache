From 06bc2e8baa5837443f9b10d7b328bf6939f1f8fa Mon Sep 17 00:00:00 2001
From: Yangbo Lu <yangbo.lu@freescale.com>
Date: Tue, 5 May 2015 17:37:04 +0800
Subject: [PATCH 199/214] mmc: sdhci-pltfm: remove
 SDHCI_QUIRK_BROKEN_CARD_DETECTION for ls2085a

Use interrupt mode to check card instead of polling mode.
This can improve r/w performance and avoid call trace caused by
polling card status.

Signed-off-by: Yangbo Lu <yangbo.lu@freescale.com>
Change-Id: I78740eb6d987726d5b6b47aac9215aacf709b695
Reviewed-on: http://git.am.freescale.net:8181/35945
Tested-by: Review Code-CDREVIEW <CDREVIEW@freescale.com>
Reviewed-by: Stuart Yoder <stuart.yoder@freescale.com>
[Original patch extracted from FSL LS2085 SDK EAR5.0,
Layerscape2-SDK-SOURCE-20150828-yocto.iso]
Signed-off-by: Jiang Lu <lu.jiang@windriver.com>
---
 drivers/mmc/host/sdhci-pltfm.c | 3 +++
 1 file changed, 3 insertions(+)

diff --git a/drivers/mmc/host/sdhci-pltfm.c b/drivers/mmc/host/sdhci-pltfm.c
index 7ef1dcb..c2e5eee 100644
--- a/drivers/mmc/host/sdhci-pltfm.c
+++ b/drivers/mmc/host/sdhci-pltfm.c
@@ -92,6 +92,9 @@ void sdhci_get_of_property(struct platform_device *pdev)
 	if (of_get_property(np, "no-1-8-v", NULL))
 		host->quirks2 |= SDHCI_QUIRK2_NO_1_8_V;
 
+	if (of_device_is_compatible(np, "fsl,ls2085a-esdhc"))
+		host->quirks &= ~SDHCI_QUIRK_BROKEN_CARD_DETECTION;
+
 	if (of_device_is_compatible(np, "fsl,p2020-rev1-esdhc"))
 		host->quirks |= SDHCI_QUIRK_BROKEN_DMA;
 
-- 
2.5.3

