From 83af7925fdb229466e6dd105487f035de62667f0 Mon Sep 17 00:00:00 2001
From: Stuart Yoder <stuart.yoder@nxp.com>
Date: Tue, 26 Jan 2016 13:36:06 -0600
Subject: [PATCH 439/452] Revert "dmaengine: fsl-qdma: remove device_control"

This reverts commit 049a1610043eef5d7b8d7cf77d54eaf877275667.

(reverting legacy qdma, which is not supported in the hardware)

Signed-off-by: Stuart Yoder <stuart.yoder@nxp.com>
[Xulin: Original patch taken from FSL LS2085 SDK EAR6.0,
LS2085A-SDK-SOURCE-20160304-yocto.iso]
Signed-off-by: Xulin Sun <xulin.sun@windriver.com>
---
 drivers/dma/fsl-qdma.c |    7 +++++++
 1 files changed, 7 insertions(+), 0 deletions(-)

diff --git a/drivers/dma/fsl-qdma.c b/drivers/dma/fsl-qdma.c
index 96bb7b1..0844fa1 100644
--- a/drivers/dma/fsl-qdma.c
+++ b/drivers/dma/fsl-qdma.c
@@ -280,6 +280,12 @@ fsl_qdma_prep_memcpy(struct dma_chan *chan, dma_addr_t dst,
 	return vchan_tx_prep(&fsl_chan->vchan, &fsl_desc->vdesc, flags);
 }
 
+static int fsl_qdma_control(struct dma_chan *chan, enum dma_ctrl_cmd cmd,
+		unsigned long arg)
+{
+	return -ENXIO;
+}
+
 static enum dma_status fsl_qdma_tx_status(struct dma_chan *chan,
 		dma_cookie_t cookie, struct dma_tx_state *txstate)
 {
@@ -428,6 +434,7 @@ static int fsl_qdma_probe(struct platform_device *pdev)
 	fsl_qdma->dma_dev.device_free_chan_resources
 		= fsl_qdma_free_chan_resources;
 	fsl_qdma->dma_dev.device_tx_status = fsl_qdma_tx_status;
+	fsl_qdma->dma_dev.device_control = fsl_qdma_control;
 	fsl_qdma->dma_dev.device_prep_dma_memcpy = fsl_qdma_prep_memcpy;
 	fsl_qdma->dma_dev.device_issue_pending = fsl_qdma_issue_pending;
 
-- 
1.7.5.4

