From 60eeecf5f060810c37a957e68d4dda0d2c7686eb Mon Sep 17 00:00:00 2001
From: Ioana Radulescu <ruxandra.radulescu@freescale.com>
Date: Thu, 7 Jan 2016 15:53:40 +0200
Subject: [PATCH 407/452] dpaa2-eth: Fix DMA mapping bug

During hashing/flow steering configuration via ethtool, we were
doing a DMA unmap from the wrong address. Fix the issue by using
the DMA address that was initially mapped.

Signed-off-by: Ioana Radulescu <ruxandra.radulescu@freescale.com>
[Xulin: Original patch taken from FSL LS2085 SDK EAR6.0,
LS2085A-SDK-SOURCE-20160304-yocto.iso]
Signed-off-by: Xulin Sun <xulin.sun@windriver.com>
---
 drivers/staging/fsl-dpaa2/ethernet/dpaa2-ethtool.c |    2 +-
 1 files changed, 1 insertions(+), 1 deletions(-)

diff --git a/drivers/staging/fsl-dpaa2/ethernet/dpaa2-ethtool.c b/drivers/staging/fsl-dpaa2/ethernet/dpaa2-ethtool.c
index c5a8848..37c7586 100644
--- a/drivers/staging/fsl-dpaa2/ethernet/dpaa2-ethtool.c
+++ b/drivers/staging/fsl-dpaa2/ethernet/dpaa2-ethtool.c
@@ -697,7 +697,7 @@ static int dpaa2_do_cls(struct net_device *net_dev,
 		err = dpni_remove_fs_entry(priv->mc_io, 0, priv->mc_token, 0,
 					   &rule_cfg);
 
-	dma_unmap_single(net_dev->dev.parent, rule_cfg.mask_iova,
+	dma_unmap_single(net_dev->dev.parent, rule_cfg.key_iova,
 			 rule_cfg.key_size * 2, DMA_TO_DEVICE);
 	if (err) {
 		netdev_err(net_dev, "dpaa2_add_cls() error %d\n", err);
-- 
1.7.5.4

