From 70055948313a20f89097890e5538e25c1536f559 Mon Sep 17 00:00:00 2001
From: Ying Zhang <b40530@freescale.com>
Date: Mon, 11 Jan 2016 17:23:34 +0800
Subject: [PATCH 416/452] =?UTF-8?q?drivers:=20i2c:=20I2C=20device=20on=20bus?=
 =?UTF-8?q?=201=20can=E2=80=99t=20claim=20irq?=
MIME-Version: 1.0
Content-Type: text/plain; charset=UTF-8
Content-Transfer-Encoding: 8bit

I2C device on bus 1 can’t claim irq on LS2085

===================================
imx-i2c 2010000.i2c: can’t claim irq 14
imx-i2c: probe of 2010000.i2c failed with error -16
====================================

Because I2C1&2, 3&4 share interrupts but the flag is not set
when requesting IRQ.

Signed-off-by: Ying Zhang <b40530@freescale.com>
[Xulin: Original patch taken from FSL LS2085 SDK EAR6.0,
LS2085A-SDK-SOURCE-20160304-yocto.iso]
Signed-off-by: Xulin Sun <xulin.sun@windriver.com>
---
 drivers/i2c/busses/i2c-imx.c |    2 +-
 1 files changed, 1 insertions(+), 1 deletions(-)

diff --git a/drivers/i2c/busses/i2c-imx.c b/drivers/i2c/busses/i2c-imx.c
index f46c9c7..6e3d411 100644
--- a/drivers/i2c/busses/i2c-imx.c
+++ b/drivers/i2c/busses/i2c-imx.c
@@ -1031,7 +1031,7 @@ static int i2c_imx_probe(struct platform_device *pdev)
 		return ret;
 	}
 	/* Request IRQ */
-	ret = devm_request_irq(&pdev->dev, irq, i2c_imx_isr, 0,
+	ret = devm_request_irq(&pdev->dev, irq, i2c_imx_isr, IRQF_SHARED,
 				pdev->name, i2c_imx);
 	if (ret) {
 		dev_err(&pdev->dev, "can't claim irq %d\n", irq);
-- 
1.7.5.4

