From c13d44d827479cd8a9a59e29763b3296fa35c091 Mon Sep 17 00:00:00 2001
From: Bogdan Hamciuc <bogdan.hamciuc@freescale.com>
Date: Sat, 26 Sep 2015 11:35:50 +0300
Subject: [PATCH 250/452] dts/ls2085a-rdb: Fix DPMAC connectivity to AQR PHYs
 on emdio1

Put the DTS in sync with the current DPMAC driver implementation, by
explicitly referring external PHYs from within the respective DPMAC nodes.

This configuration refers to SerDes 0x2a_0x41, which at the moment is the
only supported on RDB; this being the reason why the dts filename itself
bears no reference to the SerDes number.

Signed-off-by: Bogdan Hamciuc <bogdan.hamciuc@freescale.com>
[Xulin: Original patch taken from FSL LS2085 SDK EAR6.0,
LS2085A-SDK-SOURCE-20160304-yocto.iso]
Signed-off-by: Xulin Sun <xulin.sun@windriver.com>
---
 arch/arm64/boot/dts/freescale/fsl-ls2085a-rdb.dts |   49 +++++++++++++++------
 1 files changed, 36 insertions(+), 13 deletions(-)

diff --git a/arch/arm64/boot/dts/freescale/fsl-ls2085a-rdb.dts b/arch/arm64/boot/dts/freescale/fsl-ls2085a-rdb.dts
index 3837b22..2555a3d 100644
--- a/arch/arm64/boot/dts/freescale/fsl-ls2085a-rdb.dts
+++ b/arch/arm64/boot/dts/freescale/fsl-ls2085a-rdb.dts
@@ -130,25 +130,20 @@
 };
 
 &emdio1 {
-	/* FIXME: Same dirty (and hopefully temporary) HACK about the
-	   PHY names as on the QDS board.
-	   This has to be changed. On emdio2 as well.
-	 */
-
 	/* CS4340 PHYs */
-	mdio0_phy0: mdio_phy0@10 {
+	mdio1_phy1: emdio1_phy@1 {
 		reg = <0x10>;
 		phy-connection-type = "xfi";
 	};
-	mdio0_phy1: mdio_phy1@11 {
+	mdio1_phy2: emdio1_phy@2 {
 		reg = <0x11>;
 		phy-connection-type = "xfi";
 	};
-	mdio0_phy2: mdio_phy2@12 {
+	mdio1_phy3: emdio1_phy@3 {
 		reg = <0x12>;
 		phy-connection-type = "xfi";
 	};
-	mdio0_phy3: mdio_phy3@13 {
+	mdio1_phy4: emdio1_phy@4 {
 		reg = <0x13>;
 		phy-connection-type = "xfi";
 	};
@@ -156,24 +151,52 @@
 
 &emdio2 {
 	/* AQR405 PHYs */
-	mdio1_phy0: mdio_phy4@0 {
+	mdio2_phy1: emdio2_phy@1 {
 		compatible = "ethernet-phy-ieee802.3-c45";
 		reg = <0x0>;
 		phy-connection-type = "xfi";
 	};
-	mdio1_phy1: mdio_phy5@1 {
+	mdio2_phy2: emdio2_phy@2 {
 		compatible = "ethernet-phy-ieee802.3-c45";
 		reg = <0x1>;
 		phy-connection-type = "xfi";
 	};
-	mdio1_phy2: mdio_phy6@2 {
+	mdio2_phy3: emdio2_phy@3 {
 		compatible = "ethernet-phy-ieee802.3-c45";
 		reg = <0x2>;
 		phy-connection-type = "xfi";
 	};
-	mdio1_phy3: mdio_phy7@3 {
+	mdio2_phy4: emdio2_phy@4 {
 		compatible = "ethernet-phy-ieee802.3-c45";
 		reg = <0x3>;
 		phy-connection-type = "xfi";
 	};
 };
+
+/* Update DPMAC connections to external PHYs, under the assumption of
+ * SerDes 0x2a_0x41. This is currently the only SerDes supported on the board.
+ */
+&dpmac1 {
+	phy-handle = <&mdio1_phy1>;
+};
+&dpmac2 {
+	phy-handle = <&mdio1_phy2>;
+};
+&dpmac3 {
+	phy-handle = <&mdio1_phy3>;
+};
+&dpmac4 {
+	phy-handle = <&mdio1_phy4>;
+};
+&dpmac5 {
+	phy-handle = <&mdio2_phy1>;
+};
+&dpmac6 {
+	phy-handle = <&mdio2_phy2>;
+};
+&dpmac7 {
+	phy-handle = <&mdio2_phy3>;
+};
+&dpmac8 {
+	phy-handle = <&mdio2_phy4>;
+};
-- 
1.7.5.4

