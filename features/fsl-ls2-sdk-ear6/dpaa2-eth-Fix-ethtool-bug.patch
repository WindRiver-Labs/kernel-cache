From c0c7a12d9e5e74cb0c44950be3c16670265f6c59 Mon Sep 17 00:00:00 2001
From: Bogdan Hamciuc <bogdan.hamciuc@freescale.com>
Date: Thu, 23 Apr 2015 19:22:26 +0300
Subject: [PATCH 140/452] dpaa2-eth: Fix ethtool bug

We were writing beyond the end of the allocated data area for ethtool
statistics.

Signed-off-by: Ioana Radulescu <ruxandra.radulescu@freescale.com>
Change-Id: I6b77498a78dad06970508ebbed7144be73854f7f
Reviewed-on: http://git.am.freescale.net:8181/35583
Reviewed-by: Bogdan Hamciuc <bogdan.hamciuc@freescale.com>
Tested-by: Review Code-CDREVIEW <CDREVIEW@freescale.com>
Reviewed-by: Stuart Yoder <stuart.yoder@freescale.com>
[Xulin: Original patch taken from FSL LS2085 SDK EAR6.0,
LS2085A-SDK-SOURCE-20160304-yocto.iso]
Signed-off-by: Xulin Sun <xulin.sun@windriver.com>
---
 drivers/staging/fsl-dpaa2/ethernet/ldpaa_ethtool.c |    8 ++++----
 1 files changed, 4 insertions(+), 4 deletions(-)

diff --git a/drivers/staging/fsl-dpaa2/ethernet/ldpaa_ethtool.c b/drivers/staging/fsl-dpaa2/ethernet/ldpaa_ethtool.c
index 8061ead..15cf4b9 100644
--- a/drivers/staging/fsl-dpaa2/ethernet/ldpaa_ethtool.c
+++ b/drivers/staging/fsl-dpaa2/ethernet/ldpaa_ethtool.c
@@ -244,10 +244,10 @@ static void ldpaa_get_ethtool_stats(struct net_device *net_dev,
 			bcnt_rx_total += bcnt;
 		}
 	}
-	*(data + i++ + DPNI_CNT_NUM_STATS) = fcnt_rx_total;
-	*(data + i++ + DPNI_CNT_NUM_STATS) = bcnt_rx_total;
-	*(data + i++ + DPNI_CNT_NUM_STATS) = fcnt_tx_total;
-	*(data + i++ + DPNI_CNT_NUM_STATS) = bcnt_tx_total;
+	*(data + i++) = fcnt_rx_total;
+	*(data + i++) = bcnt_rx_total;
+	*(data + i++) = fcnt_tx_total;
+	*(data + i++) = bcnt_tx_total;
 #endif
 }
 
-- 
1.7.5.4

