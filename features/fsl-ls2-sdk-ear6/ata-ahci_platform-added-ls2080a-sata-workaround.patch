From 1b87c3c08f1db28f910aff3a92ba67935e075a97 Mon Sep 17 00:00:00 2001
From: Tang Yuantian <Yuantian.Tang@freescale.com>
Date: Mon, 16 Nov 2015 15:34:37 +0800
Subject: [PATCH 330/452] ata: ahci_platform: added ls2080a sata workaround

There is a erratum on ls2080a platform which is:
A-008473: Critical data loss if queue depth is more than one.
This patch disabled the native command queue feature as a workaround.

Signed-off-by: Tang Yuantian <Yuantian.Tang@freescale.com>
[Xulin: Original patch taken from FSL LS2085 SDK EAR6.0,
LS2085A-SDK-SOURCE-20160304-yocto.iso]
Signed-off-by: Xulin Sun <xulin.sun@windriver.com>
---
 drivers/ata/ahci_platform.c |    3 +++
 1 files changed, 3 insertions(+), 0 deletions(-)

diff --git a/drivers/ata/ahci_platform.c b/drivers/ata/ahci_platform.c
index 19372b7..8f48ae4 100644
--- a/drivers/ata/ahci_platform.c
+++ b/drivers/ata/ahci_platform.c
@@ -52,6 +52,9 @@ static int ahci_probe(struct platform_device *pdev)
 	if (of_device_is_compatible(dev->of_node, "hisilicon,hisi-ahci"))
 		hpriv->flags |= AHCI_HFLAG_NO_FBS | AHCI_HFLAG_NO_NCQ;
 
+	if (of_device_is_compatible(dev->of_node, "fsl,ls1021a-ahci"))
+		hpriv->flags |= AHCI_HFLAG_NO_NCQ;
+
 	rc = ahci_platform_init_host(pdev, hpriv, &ahci_port_info,
 				     &ahci_platform_sht);
 	if (rc)
-- 
1.7.5.4

