From 159e8248221de2fdc8e5de453278867a13f5f865 Mon Sep 17 00:00:00 2001
From: Liu Gang <Gang.Liu@freescale.com>
Date: Mon, 27 Apr 2015 15:24:01 +0800
Subject: [PATCH 034/452] LS2085A/GPIO: Add GPIO IP block support for LS2085A

LS2085A has the same GPIO IP block as GPIO on PowerPC
and LS1021A. So just update the drivers/gpio/gpio-mpc8xxx.c
to support the LS2085A GPIO IP block.

Signed-off-by: Liu Gang <Gang.Liu@freescale.com>
Change-Id: Ib302ce671b5301ce09cbc304388e0c43723781cc
Reviewed-on: http://git.am.freescale.net:8181/35673
Tested-by: Review Code-CDREVIEW <CDREVIEW@freescale.com>
Reviewed-by: Stuart Yoder <stuart.yoder@freescale.com>
[Xulin: Original patch taken from FSL LS2085 SDK EAR6.0,
LS2085A-SDK-SOURCE-20160304-yocto.iso]
Signed-off-by: Xulin Sun <xulin.sun@windriver.com>
---
 arch/arm64/include/asm/irq.h |    8 ++++++++
 drivers/gpio/Kconfig         |    6 +++---
 drivers/gpio/gpio-mpc8xxx.c  |    1 +
 3 files changed, 12 insertions(+), 3 deletions(-)

diff --git a/arch/arm64/include/asm/irq.h b/arch/arm64/include/asm/irq.h
index bbb251b..4e6961a 100644
--- a/arch/arm64/include/asm/irq.h
+++ b/arch/arm64/include/asm/irq.h
@@ -7,6 +7,14 @@
 
 struct pt_regs;
 
+/*
+ * Use this value to indicate lack of interrupt
+ * capability
+ */
+#ifndef NO_IRQ
+#define NO_IRQ	((unsigned int)(-1))
+#endif
+
 extern void migrate_irqs(void);
 extern void set_handle_irq(void (*handle_irq)(struct pt_regs *));
 
diff --git a/drivers/gpio/Kconfig b/drivers/gpio/Kconfig
index caefe80..d7721a2 100644
--- a/drivers/gpio/Kconfig
+++ b/drivers/gpio/Kconfig
@@ -265,12 +265,12 @@ config GPIO_MPC5200
 	depends on PPC_MPC52xx
 
 config GPIO_MPC8XXX
-	bool "MPC512x/MPC8xxx GPIO support"
+	bool "MPC512x/MPC8xxx/Layerscape GPIO support"
 	depends on PPC_MPC512x || PPC_MPC831x || PPC_MPC834x || PPC_MPC837x || \
-		   FSL_SOC_BOOKE || PPC_86xx
+		   FSL_SOC_BOOKE || PPC_86xx || SOC_LS1021A || ARCH_FSL_LS2085A
 	help
 	  Say Y here if you're going to use hardware that connects to the
-	  MPC512x/831x/834x/837x/8572/8610 GPIOs.
+	  MPC512x/831x/834x/837x/8572/8610/LS1021A/LS2085A GPIOs.
 
 config GPIO_MSM_V2
 	tristate "Qualcomm MSM GPIO v2"
diff --git a/drivers/gpio/gpio-mpc8xxx.c b/drivers/gpio/gpio-mpc8xxx.c
index 55a019d..be4954a 100644
--- a/drivers/gpio/gpio-mpc8xxx.c
+++ b/drivers/gpio/gpio-mpc8xxx.c
@@ -354,6 +354,7 @@ static struct of_device_id mpc8xxx_gpio_ids[] = {
 	{ .compatible = "fsl,pq3-gpio",     },
 	{ .compatible = "fsl,qoriq-gpio",   },
 	{ .compatible = "fsl,ls1021a-gpio",   },
+	{ .compatible = "fsl,ls2085a-gpio",   },
 	{}
 };
 
-- 
1.7.5.4

