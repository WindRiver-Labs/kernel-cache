From 309ad54797893f5276396250723dfcea5ef488ad Mon Sep 17 00:00:00 2001
From: Bruce Ashfield <bruce.ashfield@windriver.com>
Date: Thu, 27 Jan 2011 20:30:58 -0500
Subject: [PATCH] wrhv/virtio: #ifdef duart intialization checks

Now that the duart code is out of arch/powerpc/kernel/vbi/wrhv.c we
can't blindly check its variables. To allows builds with the duart
to work, we #ifdef the remaining references.

Signed-off-by: Bruce Ashfield <bruce.ashfield@windriver.com>
---
 arch/powerpc/kernel/vbi/wrhv.c |    6 ++++++
 1 files changed, 6 insertions(+), 0 deletions(-)

diff --git a/arch/powerpc/kernel/vbi/wrhv.c b/arch/powerpc/kernel/vbi/wrhv.c
index ffd408d..a1f6bd8 100644
--- a/arch/powerpc/kernel/vbi/wrhv.c
+++ b/arch/powerpc/kernel/vbi/wrhv.c
@@ -341,7 +341,11 @@ void wrhv_power_save(void)
 	 * duart mode, we need core 0 to handle interrupt from hypervisor. In this
 	 * case we do not allow core 0 to go into idle.
 	 */
+#ifdef CONFIG_WRHV_DUART
 	if ((wrhv_dir_irq) || (is_wrhv_duart_inited)) {
+#else
+	if (wrhv_dir_irq) {
+#endif
 		/* running in direct irq or using duart */
 		if (smp_processor_id())
 			vbi_idle(1);
@@ -1840,8 +1844,10 @@ void wrhv_duart_init(void);
 void wrhv_udbg_init_uart(void __iomem *comport, unsigned int speed,
 		unsigned int clock)
 {
+#ifdef CONFIG_WRHV_DUART
 	/* initialize hypervisor duart serial device driver */
 	wrhv_duart_init();
+#endif
 }
 
 void wrhv_init(void)
-- 
1.6.5.2

