From b3b5dee89b9dd84c50fa598a9abb5ed7a0aaee62 Mon Sep 17 00:00:00 2001
From: Jeremy McNicoll <jeremy.mcnicoll@windriver.com>
Date: Thu, 27 May 2010 15:25:37 -0400
Subject: [PATCH 03/11] WRHV: use correct VBI to flush cache

The semantics of "vb__flush_icache_range" should be the same
as "native__flush_icache_range":

  Write any modified data cache blocks out to memory
  and invalidate the corresponding instruction cache blocks.

But vbi_flush_icache can't implement it. vbi_flush_icache only
flushes instruction cache. Replace with "vbi_update_text_cache":

  flush data cache then invalidate instruction cache

Signed-off-by: Liming Wang <liming.wang@windriver.com>
Integrated-by: Jeremy McNicoll <jeremy.mcnicoll@windriver.com>
---
 arch/powerpc/kernel/vbi/util.c |    2 +-
 1 files changed, 1 insertions(+), 1 deletions(-)

diff --git a/arch/powerpc/kernel/vbi/util.c b/arch/powerpc/kernel/vbi/util.c
index 62d84cb..9c7ba61 100644
--- a/arch/powerpc/kernel/vbi/util.c
+++ b/arch/powerpc/kernel/vbi/util.c
@@ -128,7 +128,7 @@ void vb_flush_dcache_range(unsigned long start, unsigned long stop)
 
 void vb__flush_icache_range(unsigned long start, unsigned long stop)
 {
-	vbi_flush_icache((void *) start, (stop - start + 1));
+	vbi_update_text_cache((void *) start, (stop - start + 1));
 }
 
 void vb__flush_dcache_icache_phys(unsigned long physaddr)
-- 
1.6.5.2

