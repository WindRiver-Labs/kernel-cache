From f9527f83f7fbfb05a02feaa3b35bb9e27322ee29 Mon Sep 17 00:00:00 2001
From: Thomas Tai <thomas.tai@windriver.com>
Date: Thu, 8 Apr 2010 21:49:47 -0400
Subject: [PATCH 4/9] paravirtualize standard mmu functions

8641d use standard MMU functions, paravirtualize standard
mmu functions instead of using native functions.

Signed-off-by: Thomas Tai <thomas.tai@windriver.com>
---
 arch/powerpc/mm/ppc_mmu_32.c |   17 +++++++++++++++++
 1 files changed, 17 insertions(+), 0 deletions(-)

diff --git a/arch/powerpc/mm/ppc_mmu_32.c b/arch/powerpc/mm/ppc_mmu_32.c
index 49b195e..13184ca 100644
--- a/arch/powerpc/mm/ppc_mmu_32.c
+++ b/arch/powerpc/mm/ppc_mmu_32.c
@@ -72,8 +72,17 @@ unsigned long p_mapped_by_bats(phys_addr_t pa)
 	return 0;
 }
 
+
+unsigned long paravirt_mmu_mapin_ram(void)
+	__attribute__((weak, alias("native_mmu_mapin_ram")));
+
 unsigned long __init mmu_mapin_ram(void)
 {
+	return paravirt_mmu_mapin_ram();
+}
+
+unsigned long __init native_mmu_mapin_ram(void)
+{
 #ifdef CONFIG_POWER4
 	return 0;
 #else
@@ -182,8 +191,16 @@ void hash_preload(struct mm_struct *mm, unsigned long ea,
 /*
  * Initialize the hash table and patch the instructions in hashtable.S.
  */
+void paravirt_MMU_init_hw(void)
+	__attribute__((weak, alias("native_MMU_init_hw")));
+
 void __init MMU_init_hw(void)
 {
+	paravirt_MMU_init_hw();
+}
+
+void __init native_MMU_init_hw(void)
+{
 	unsigned int hmask, mb, mb2;
 	unsigned int n_hpteg, lg_n_hpteg;
 
-- 
1.6.5.2

