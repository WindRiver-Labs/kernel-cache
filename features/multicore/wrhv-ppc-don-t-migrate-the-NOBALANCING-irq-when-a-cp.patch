From 028037db9b8b4a809d68fdf3b092f4eb96a722c9 Mon Sep 17 00:00:00 2001
From: Kevin Hao <kexin.hao@windriver.com>
Date: Wed, 13 Apr 2011 09:52:48 +0800
Subject: [PATCH] wrhv/ppc: don't migrate the NOBALANCING irq when a cpu down

When a cpu is down we will migrate the irq on it to other cpu.
But if an irq is explicitly set with IRQF_NOBALANCING flag,
it mean that we don't want this irq to be handled on other cpu.
So just leave it as is.

Signed-off-by: Kevin Hao <kexin.hao@windriver.com>
---
 kernel/vbi/wrhv.c |    2 +-
 1 files changed, 1 insertions(+), 1 deletions(-)

diff --git a/kernel/vbi/wrhv.c b/kernel/vbi/wrhv.c
index 2dbc700..2186fb3 100644
--- a/kernel/vbi/wrhv.c
+++ b/kernel/vbi/wrhv.c
@@ -306,7 +306,7 @@ void __weak wrhv_fixup_irqs(int cpu)
 		if (!desc)
 			continue;
 
-		if (desc->status & IRQ_PER_CPU)
+		if (desc->status & (IRQ_PER_CPU | IRQ_NO_BALANCING))
 			continue;
 
 		raw_spin_lock(&desc->lock);
-- 
1.6.5.2

