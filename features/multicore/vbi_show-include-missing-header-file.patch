From c2069448da9db19463c7f02169ed959c71d60e36 Mon Sep 17 00:00:00 2001
From: Thomas Tai <thomas.tai@windriver.com>
Date: Wed, 23 Mar 2011 11:04:04 -0400
Subject: [PATCH] vbi_show: include missing header file

cert_hyp: Added missing #include <linux/kernel.h> which cause
compile error, the header file is required for printk purpose.
Alos stub out vbi_show_cfg function, which only exists
in commerical and debug version of certifiable hypervisor.

Signed-off-by: Thomas Tai <thomas.tai@windriver.com>
---
 include/vbi/stats.h |    3 +++
 kernel/vbi/show.c   |    7 +++++++
 2 files changed, 10 insertions(+), 0 deletions(-)

diff --git a/include/vbi/stats.h b/include/vbi/stats.h
index 0cd7676..af3e365 100644
--- a/include/vbi/stats.h
+++ b/include/vbi/stats.h
@@ -3,6 +3,9 @@
 
 #ifndef _ASMLANGUAGE
 
+/* header file required by the printk, which is used in VBISTAT_VERBOSE */
+#include <linux/kernel.h>
+
 /* api statistic structure */
 struct vbi_api_stats{
 	/* functions implemented in vbi.h */
diff --git a/kernel/vbi/show.c b/kernel/vbi/show.c
index 4d03dd0..778092d 100644
--- a/kernel/vbi/show.c
+++ b/kernel/vbi/show.c
@@ -295,6 +295,13 @@ void vbi_show_config_page_map()
 void vbi_show_cfg(void)
 {
 	struct vb_config *p = VBI_CONFIG_ADDR_GET();
+
+	/* standard certifiable hypervisor does not support this function */
+	if (cert_hyp_version == CERT_HYP_VER_STD) {
+		VBISTAT_VERBOSE(vbistat_count.vbi_show_cfg, "vbi_show_cfg");
+		return;
+	}
+
 	printk("VB config data: 0x%p\n", p);
 
 	printk("pid:                %d\n", p->pid);
-- 
1.6.5.2

