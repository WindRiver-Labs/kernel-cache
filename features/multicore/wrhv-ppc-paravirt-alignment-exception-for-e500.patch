From 0db317d27813a9fa8bf8133a4c0b53a667be096e Mon Sep 17 00:00:00 2001
From: Liang Li <liang.li@windriver.com>
Date: Thu, 2 Sep 2010 02:56:57 -0700
Subject: [PATCH] wrhv/ppc: paravirt alignment exception for e500

The right thing would be paravirt alignment exception entry point
for e500 GOS. e500-mc has no such issue.

Signed-off-by: Liang Li <liang.li@windriver.com>
---
 arch/powerpc/kernel/head_wrhv.h |    9 +++++++++
 1 files changed, 9 insertions(+), 0 deletions(-)

diff --git a/arch/powerpc/kernel/head_wrhv.h b/arch/powerpc/kernel/head_wrhv.h
index 9f25c5e..0929a7e 100644
--- a/arch/powerpc/kernel/head_wrhv.h
+++ b/arch/powerpc/kernel/head_wrhv.h
@@ -135,6 +135,15 @@ label:
         li      r5,0;                   /* Pass zero as arg3 */               \
 	EXC_XFER_EE_LITE(0x0400, handle_page_fault)
 
+#undef ALIGNMENT_EXCEPTION
+#define ALIGNMENT_EXCEPTION							\
+	START_EXCEPTION(Alignment)						\
+	NORMAL_EXCEPTION_PROLOG;						\
+	lwz r5,VB_STATUS_DEAR(r10);						\
+	stw r5,_DEAR(r11);							\
+	addi r3,r1,STACK_FRAME_OVERHEAD;					\
+	EXC_XFER_EE(0x0600, alignment_exception)
+
 #undef PROGRAM_EXCEPTION
 #define PROGRAM_EXCEPTION						      \
 	START_EXCEPTION(Program)					      \
-- 
1.6.5.2

