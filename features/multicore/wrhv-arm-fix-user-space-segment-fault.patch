From d153b006ba3ee68f417560ca8e6c8a63e9becd50 Mon Sep 17 00:00:00 2001
From: Weiwei Wang <weiwei.wang@windriver.com>
Date: Mon, 26 Sep 2011 15:22:56 +0800
Subject: [PATCH 1/2] wrhv/arm: fix user space segment fault

hardware tlb instructions can be broadcast among cpus in armv7,
but vtlb can't. So ipi needs to be used to operate other cpus' vtlb.

Signed-off-by: Weiwei Wang <weiwei.wang@windriver.com>
---
 arch/arm/include/asm/smp_plat.h |    4 ++++
 1 files changed, 4 insertions(+), 0 deletions(-)

diff --git a/arch/arm/include/asm/smp_plat.h b/arch/arm/include/asm/smp_plat.h
index e621530..39bc801 100644
--- a/arch/arm/include/asm/smp_plat.h
+++ b/arch/arm/include/asm/smp_plat.h
@@ -10,7 +10,11 @@
 /* all SMP configurations have the extended CPUID registers */
 static inline int tlb_ops_need_broadcast(void)
 {
+#ifdef CONFIG_WRHV
+	return 1;
+#else
 	return ((read_cpuid_ext(CPUID_EXT_MMFR3) >> 12) & 0xf) < 2;
+#endif
 }
 
 static inline int cache_ops_need_broadcast(void)
-- 
1.7.0.4

