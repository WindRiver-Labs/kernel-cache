From 0a152c194773b69bc96d5c8c9a053a83b5a9b09e Mon Sep 17 00:00:00 2001
From: Paul Gortmaker <paul.gortmaker@windriver.com>
Date: Mon, 19 Apr 2010 18:31:24 -0400
Subject: [PATCH] WRHV: make debug files conditionally compiled.

There is an arch generic show.c and a ppc specific derivative.
Neither is required for day to day use, and they don't export
any symbols.  So there is no need to compile them in all the
time.

Signed-off-by: Paul Gortmaker <paul.gortmaker@windriver.com>
---
 arch/powerpc/kernel/vbi/Makefile |    3 ++-
 init/Kconfig.wrhv                |    6 ++++++
 kernel/vbi/Makefile              |    3 ++-
 3 files changed, 10 insertions(+), 2 deletions(-)

diff --git a/arch/powerpc/kernel/vbi/Makefile b/arch/powerpc/kernel/vbi/Makefile
index a02358c..997b6e4 100644
--- a/arch/powerpc/kernel/vbi/Makefile
+++ b/arch/powerpc/kernel/vbi/Makefile
@@ -2,7 +2,8 @@
 # Makefile for the vbi ppc.
 #
 
-obj-y		+= util.o wrhv.o vmmu_display.o show.o
+obj-y		+= util.o wrhv.o vmmu_display.o
+obj-$(CONFIG_WRHV_DEBUG) += show.o
 ifeq ($(CONFIG_WRHV_MILS),y)
 obj-y		+= vdk_syscalls.o
 else
diff --git a/init/Kconfig.wrhv b/init/Kconfig.wrhv
index 3ac41ca..e05cfcc 100644
--- a/init/Kconfig.wrhv
+++ b/init/Kconfig.wrhv
@@ -8,6 +8,12 @@ config WRHV
 	select SERIAL_CORE
 	select SERIAL_CORE_CONSOLE
 
+config WRHV_DEBUG
+	bool "Wind River Hypervisor Debug"
+	default n
+	depends on WRHV
+	help
+	  This enables access to some extra in-kernel status dump functions.
 
 config WRHV_MILS
 	bool "MILS grade Hypervisor"
diff --git a/kernel/vbi/Makefile b/kernel/vbi/Makefile
index 368791d..675742f 100644
--- a/kernel/vbi/Makefile
+++ b/kernel/vbi/Makefile
@@ -2,7 +2,8 @@
 # Makefile for the vbi goodies.
 #
 
-obj-y := wrhv.o paddr.o lib.o shmem.o show.o version.o interrupt.o
+obj-y := wrhv.o paddr.o lib.o shmem.o version.o interrupt.o
+obj-$(CONFIG_WRHV_DEBUG) += show.o
 ifeq ($(CONFIG_WRHV_MILS),y)
 obj-y += vdk_interrupt.o vdk_syscalls.o
 else
-- 
1.6.5.2

