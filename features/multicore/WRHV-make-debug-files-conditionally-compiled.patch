From d7f31b8b61bd1d64b7fe26ff0fadfaad75b4e324 Mon Sep 17 00:00:00 2001
From: Paul Gortmaker <paul.gortmaker@windriver.com>
Date: Mon, 19 Apr 2010 18:31:24 -0400
Subject: [PATCH] WRHV: make debug files conditionally compiled.

There is an arch generic show.c and a ppc specific derivative.
Neither is required for day to day use, and they don't export
any symbols.  So there is no need to compile them in all the
time.

Signed-off-by: Paul Gortmaker <paul.gortmaker@windriver.com>
---
 arch/powerpc/kernel/vbi/Makefile |    3 ++-
 init/Kconfig.wrhv                |    7 +++++++
 kernel/vbi/Makefile              |    3 ++-
 3 files changed, 11 insertions(+), 2 deletions(-)

diff --git a/arch/powerpc/kernel/vbi/Makefile b/arch/powerpc/kernel/vbi/Makefile
index daac59f..678f83a 100644
--- a/arch/powerpc/kernel/vbi/Makefile
+++ b/arch/powerpc/kernel/vbi/Makefile
@@ -2,4 +2,5 @@
 # Makefile for the vbi ppc.
 #
 
-obj-y		+= syscalls.o util.o wrhv.o vmmu_display.o show.o
+obj-y		+= syscalls.o util.o wrhv.o vmmu_display.o
+obj-$(CONFIG_WRHV_DEBUG) += show.o
diff --git a/init/Kconfig.wrhv b/init/Kconfig.wrhv
index 5cc80a8..0fe8bc3 100644
--- a/init/Kconfig.wrhv
+++ b/init/Kconfig.wrhv
@@ -8,6 +8,13 @@ config WRHV
 	select SERIAL_CORE
 	select SERIAL_CORE_CONSOLE
 
+config WRHV_DEBUG
+	bool "Wind River Hypervisor Debug"
+	default n
+	depends on WRHV
+	help
+	  This enables access to some extra in-kernel status dump functions.
+
 config DEBUG_VIRTUAL_IRQS
 	bool "Debug VIOAPIC with software IRQ"
 	default n
diff --git a/kernel/vbi/Makefile b/kernel/vbi/Makefile
index 2d0af85..f4dae34 100644
--- a/kernel/vbi/Makefile
+++ b/kernel/vbi/Makefile
@@ -3,4 +3,5 @@
 #
 
 obj-y     = shmem.o wrhv.o interrupt.o paddr.o idle.o io_apic.o lib.o \
-	    version.o msg.o ns.o show.o
+	    version.o msg.o ns.o
+obj-$(CONFIG_WRHV_DEBUG) += show.o
-- 
1.7.0

