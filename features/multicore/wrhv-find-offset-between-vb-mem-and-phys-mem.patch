From 1c9ac6f01a27180f22eb583a24849087fb47f2dc Mon Sep 17 00:00:00 2001
From: Liang Li <liang.li@windriver.com>
Date: Thu, 14 Jul 2011 17:44:47 +0800
Subject: [PATCH] wrhv: find offset between vb mem and phys mem

The offset between VB phys mem 0x0 and Machine mem 0x0 is needed by
misc driver code to fixup DMA setup code hence export it for
convenience.

Signed-off-by: Liang Li <liang.li@windriver.com>
---
 kernel/vbi/wrhv.c |    4 ++++
 1 files changed, 4 insertions(+), 0 deletions(-)

diff --git a/kernel/vbi/wrhv.c b/kernel/vbi/wrhv.c
index 1d40dc8..9d7d1f2 100644
--- a/kernel/vbi/wrhv.c
+++ b/kernel/vbi/wrhv.c
@@ -794,6 +794,9 @@ int wrhv_get_vb_config(const int vb, struct vb_config *config)
 }
 EXPORT_SYMBOL(wrhv_get_vb_config);
 
+u64 wrhv_phys_offset;
+EXPORT_SYMBOL(wrhv_phys_offset);
+
 int __init wrhv_late_init(void)
 {
 	wrhv_arch_late_init();
@@ -803,6 +806,7 @@ int __init wrhv_late_init(void)
 	wrhv_init_debugfs();
 	wrhv_hysh_init_sysfs();
 	wrhv_register_reboot_notifier();
+	vbi_guest_phys_to_phys(0, &wrhv_phys_offset);
 	return 0;
 }
 late_initcall(wrhv_late_init);
-- 
1.7.0.2

