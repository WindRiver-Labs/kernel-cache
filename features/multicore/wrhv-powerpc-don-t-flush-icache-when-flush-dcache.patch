From 6f94199662776c4b5f6847f66c90a56c4fffd62e Mon Sep 17 00:00:00 2001
From: Liang Li <liang.li@windriver.com>
Date: Fri, 20 Aug 2010 13:25:57 +0800
Subject: [PATCH 1/2] wrhv/powerpc: don't flush icache when flush dcache

In paravirt flush_dcache function, we just call vbi to flush dcache
would be fulfill the same semantic.

Signed-off-by: Liang Li <liang.li@windriver.com>
---
 arch/powerpc/kernel/vbi/wrhv.c |    3 ++-
 1 files changed, 2 insertions(+), 1 deletions(-)

diff --git a/arch/powerpc/kernel/vbi/wrhv.c b/arch/powerpc/kernel/vbi/wrhv.c
index 127dc28..bcffc5e 100644
--- a/arch/powerpc/kernel/vbi/wrhv.c
+++ b/arch/powerpc/kernel/vbi/wrhv.c
@@ -976,7 +976,8 @@ void wrhv_flush_dcache_page(struct page *page)
 	/* avoid an atomic op if possible */
 	if (test_bit(PG_arch_1, &page->flags))
 		clear_bit(PG_arch_1, &page->flags);
-	__flush_dcache_icache_phys(page_to_pfn(page) << PAGE_SHIFT);
+
+	vbi_flush_dcache(page_to_pfn(page) << PAGE_SHIFT, PAGE_SIZE);
 }
 
 void set_context(unsigned long contextid, pgd_t *pgd) 
-- 
1.6.5.2

