From d7e7ac99374a9b46f217d6501cb5e4b7f9411ceb Mon Sep 17 00:00:00 2001
From: Thomas Tai <thomas.tai@windriver.com>
Date: Thu, 8 Apr 2010 21:49:48 -0400
Subject: [PATCH] mask debug code for !E500

wrhv_DebugException contains E500 specific register bit field
which are not avaiable for 60x. Follows native trap.c to
add #ifdef from compiling the body for 60x cpu.

Signed-off-by: Thomas Tai <thomas.tai@windriver.com>
---
 arch/powerpc/kernel/vbi/wrhv.c |    6 ++++++
 1 files changed, 6 insertions(+), 0 deletions(-)

diff --git a/arch/powerpc/kernel/vbi/wrhv.c b/arch/powerpc/kernel/vbi/wrhv.c
index 30bb72c..08634b7 100644
--- a/arch/powerpc/kernel/vbi/wrhv.c
+++ b/arch/powerpc/kernel/vbi/wrhv.c
@@ -1144,6 +1144,7 @@ out:
 }
 
 /* arch/powerpc/kernel/traps.c */
+#if defined(CONFIG_40x) || defined(CONFIG_BOOKE)
 void __kprobes wrhv_DebugException(struct pt_regs *regs, unsigned long debug_status)
 {
 	uint32_t emsr;
@@ -1188,6 +1189,7 @@ void __kprobes wrhv_DebugException(struct pt_regs *regs, unsigned long debug_sta
 		do_dabr(regs, mfspr(SPRN_DAC1), debug_status);
 	}
 }
+#endif
 
 /* arch/powerpc/kernel/kgdb.c */
 int wrhv_kgdb_arch_handle_exception(int vector, int signo, int err_code,
@@ -1198,8 +1200,10 @@ int wrhv_kgdb_arch_handle_exception(int vector, int signo, int err_code,
 	unsigned long addr;
 
 	switch (remcom_in_buffer[0]) {
+#if defined(CONFIG_40x) || defined(CONFIG_BOOKE)
 		uint32_t dbcr;
 		uint32_t emsr;
+#endif
 		/*
 		 * sAA..AA   Step one instruction from AA..AA
 		 * This will return an error to gdb ..
@@ -1273,7 +1277,9 @@ void wrhv_init(void)
 
 	pv_cpu_ops.get_pvr = wrhv_get_pvr;
 	pv_cpu_ops.gfar_of_init =  wrhv_gfar_of_init;
+#if defined(CONFIG_40x) || defined(CONFIG_BOOKE)
 	pv_cpu_ops.DebugException = wrhv_DebugException;
+#endif
 	pv_cpu_ops.kgdb_arch_handle_exception =
 		wrhv_kgdb_arch_handle_exception;
 	pv_cpu_ops.ppc_proc_freq =
-- 
1.6.5.2

