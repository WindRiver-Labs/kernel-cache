From 32791a6a86f3c189726bf8ea22adee6ad1fc5575 Mon Sep 17 00:00:00 2001
From: Weiwei Wang <weiwei.wang@windriver.com>
Date: Mon, 31 May 2010 19:18:40 +0800
Subject: [PATCH] x86: mask hypervisor timer irq when hrtimer enabled

when hrtimer is enabled, hypervisor provided timer
interrupt is not used by guest os, so mask it to stop
hypervisor injecting the irq to guest.

Signed-off-by: Weiwei Wang <weiwei.wang@windriver.com>
---
 arch/x86/kernel/vbi/wrhv.c |    1 +
 1 files changed, 1 insertions(+), 0 deletions(-)

diff --git a/arch/x86/kernel/vbi/wrhv.c b/arch/x86/kernel/vbi/wrhv.c
index 75d5a0b..98d5452 100644
--- a/arch/x86/kernel/vbi/wrhv.c
+++ b/arch/x86/kernel/vbi/wrhv.c
@@ -1288,6 +1288,7 @@ void __init wrhv_setup_timer_irq(void)
 		printk(KERN_INFO "WRHV: HRTIMER is NOT present.\n");
 	} else {
 		enable_hrtimer = 1;
+		wrhv_mask_timer_for_vcore();
 		set_irq_chip_and_handler_name(TIMER_INT_NUM, &wrhv_irq_chip,
 					      handle_edge_irq, "edge");
 		printk(KERN_INFO "WRHV: HRTIMER is present.\n");
-- 
1.6.0.4

