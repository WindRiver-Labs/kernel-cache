From f9609c38c88db0bb99ed8ce421c0b0a17f76fa99 Mon Sep 17 00:00:00 2001
From: Weiwei Wang <weiwei.wang@windriver.com>
Date: Sun, 11 Jul 2010 22:02:29 -0700
Subject: [PATCH] x86 guest: fix smp reboot failure

Clean VBI_VBMGMT_RESET_CLEAR when do vb reset, since
it will clear ap initial stack info and finally cause
smp guest os reboot failure.

Signed-off-by: Weiwei Wang <weiwei.wang@windriver.com>
---
 arch/x86/kernel/vbi/wrhv.c |    3 +--
 1 files changed, 1 insertions(+), 2 deletions(-)

diff --git a/arch/x86/kernel/vbi/wrhv.c b/arch/x86/kernel/vbi/wrhv.c
index 0e0bffe..044a27b 100644
--- a/arch/x86/kernel/vbi/wrhv.c
+++ b/arch/x86/kernel/vbi/wrhv.c
@@ -1471,8 +1471,7 @@ void wrhv_restart(void)
 
 	ret = vbi_vb_reset(VBI_BOARD_ID_GET(), VBI_VB_CORES_ALL,
 		VBI_VBMGMT_RESET_AND_START_CORE0 |
-		VBI_VBMGMT_RESET_DOWNLOAD |
-		VBI_VBMGMT_RESET_CLEAR
+		VBI_VBMGMT_RESET_DOWNLOAD
 		);
 
 	if (unlikely(ret != 0))
-- 
1.6.5.2

