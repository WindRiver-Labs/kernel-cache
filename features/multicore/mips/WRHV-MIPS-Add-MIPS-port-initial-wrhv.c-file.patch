From c968ef2827795e6143715b6a63888ee740f76a51 Mon Sep 17 00:00:00 2001
From: Yang Shi <yang.shi@windriver.com>
Date: Tue, 30 Nov 2010 10:56:50 +0800
Subject: [PATCH 09/38] WRHV: MIPS: Add MIPS port initial wrhv.c file

Add wrhv.c file for MIPS port. Introduce early_init function to
do wrhv and paravirt initialization.

Signed-off-by: Yang Shi <yang.shi@windriver.com>
---
 arch/mips/kernel/vbi/Makefile |    2 +-
 arch/mips/kernel/vbi/wrhv.c   |   41 +++++++++++++++++++++++++++++++++++++++++
 2 files changed, 42 insertions(+), 1 deletions(-)
 create mode 100644 arch/mips/kernel/vbi/wrhv.c

diff --git a/arch/mips/kernel/vbi/Makefile b/arch/mips/kernel/vbi/Makefile
index 98d494b..df31cc5 100644
--- a/arch/mips/kernel/vbi/Makefile
+++ b/arch/mips/kernel/vbi/Makefile
@@ -1,4 +1,4 @@
 #
 # Makefile for the vbi MIPS64.
 #
-obj-y		+= syscalls.o
+obj-y		+= syscalls.o wrhv.o
diff --git a/arch/mips/kernel/vbi/wrhv.c b/arch/mips/kernel/vbi/wrhv.c
new file mode 100644
index 0000000..b829104
--- /dev/null
+++ b/arch/mips/kernel/vbi/wrhv.c
@@ -0,0 +1,41 @@
+/*
+ *  This program is free software; you can redistribute it and/or modify it
+ *  under the terms of the GNU General Public License as published by the
+ *  Free Software Foundation; either version 2, or (at your option) any
+ *  later version.
+ *
+ *  This program is distributed in the hope that it will be useful, but
+ *  WITHOUT ANY WARRANTY; without even the implied warranty of
+ *  MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the GNU
+ *  General Public License for more details.
+ *
+ *  Copyright (C) 2010 Wind River Systems, Inc.
+ */
+
+#include <linux/init.h>
+#include <linux/types.h>
+#include <vbi/vbi.h>
+
+struct vb_config *wr_config;
+
+void __init wrhv_init(void)
+{
+	/* initialize wr_config so that we can access
+	 * vbi configuration. The vbi configuration space
+	 * is defined in Hypervisor linux.xml
+	 */
+	wr_config = (struct vb_config *)0xFFFFFFFFD0000000;
+
+	vbi_init(wr_config);
+}
+
+#ifdef CONFIG_PARAVIRT
+extern void paravirt_init(void);
+#endif
+
+void __init early_init(void)
+{
+#ifdef CONFIG_PARAVIRT
+	paravirt_init();
+#endif
+}
-- 
1.6.5.2

