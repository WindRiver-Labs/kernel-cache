From 311fdb54a7e842e3c3717e9f3e7aa2baacd35803 Mon Sep 17 00:00:00 2001
From: Bruce Ashfield <bruce.ashfield@windriver.com>
Date: Thu, 18 Nov 2010 00:09:34 -0500
Subject: [PATCH] wrhv: account for UP guest OSs

wrhv_reset_all_irqs doesn't make sense with respect to affinity
settings on a UP guest OS. So the entire function can be protected
by CONFIG_SMP.

Signed-off-by: Bruce Ashfield <bruce.ashfield@windriver.com>
---
 kernel/vbi/wrhv.c |    2 ++
 1 files changed, 2 insertions(+), 0 deletions(-)

diff --git a/kernel/vbi/wrhv.c b/kernel/vbi/wrhv.c
index dac176d..5ceddb1 100644
--- a/kernel/vbi/wrhv.c
+++ b/kernel/vbi/wrhv.c
@@ -583,6 +583,7 @@ static int wrhv_hysh_init_sysfs(void)
 static int wrhv_reset_all_irqs(struct notifier_block *self,
 		unsigned long code, void *t)
 {
+#ifdef CONFIG_SMP
 	unsigned int    irq;
 	struct irq_desc *desc;
 
@@ -613,6 +614,7 @@ static int wrhv_reset_all_irqs(struct notifier_block *self,
 
 		raw_spin_unlock(&desc->lock);
 	}
+#endif
 	return 0;
 }
 
-- 
1.6.5.2

