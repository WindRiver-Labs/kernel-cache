From b175f0ef3a070880afa7bf780c3eb20c27a9ef6a Mon Sep 17 00:00:00 2001
From: Liang Li <liang.li@windriver.com>
Date: Tue, 13 Sep 2011 10:59:35 +0800
Subject: [PATCH 2/2] wrhv: vbi: unify negative IRQ numbers to VBI_INVALID_IRQ

In vbi_find_irq function, we find irq numbers by irqname from
a specific list that is provided by hyp. We'd better do an extra
check to make sure VBI_INVALID_IRQ will be returned if we get an
invalid IRQ number from the list.

Signed-off-by: Liang Li <liang.li@windriver.com>
---
 kernel/vbi/interrupt.c |    5 ++++-
 1 files changed, 4 insertions(+), 1 deletions(-)

diff --git a/kernel/vbi/interrupt.c b/kernel/vbi/interrupt.c
index 5cd4863..27ce660 100644
--- a/kernel/vbi/interrupt.c
+++ b/kernel/vbi/interrupt.c
@@ -57,7 +57,10 @@ int32_t vbi_find_irq(char *irq_name, int32_t irq_dir)
 		if (!strncmp((char *)irq_name, (char *)info->irq_name,
 					VB_NAMELEN)) {
 			/* Found */
-			return (int32_t)info->irq_num;
+			if ((int32_t)info->irq_num < 0)
+				return VBI_INVALID_IRQ;
+			else
+				return (int32_t)info->irq_num;
 		}
 	}
 	return VBI_INVALID_IRQ; /* no match */
-- 
1.7.0.4

