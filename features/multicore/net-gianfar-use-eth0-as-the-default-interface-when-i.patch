From 588f058a2b952bea86a0b123730e7504f1380f8f Mon Sep 17 00:00:00 2001
From: Kevin Hao <kexin.hao@windriver.com>
Date: Mon, 13 Jun 2011 13:45:40 +0800
Subject: [PATCH] net/gianfar: use eth0 as the default interface when ifname is not set

Use the eth0 as the default interface when ifname is not set.
Otherwise we will overwrite the stack frame when copying the
content of wrhv_net_name to a local variable because we use
"strlen(wrhv_net_name) - 1" as the length of the string.
Also add a check to validate the mac address we set in
command line.

Signed-off-by: Kevin Hao <kexin.hao@windriver.com>
---
 drivers/net/gianfar.c |    5 +++++
 1 files changed, 5 insertions(+), 0 deletions(-)

diff --git a/drivers/net/gianfar.c b/drivers/net/gianfar.c
index b59a118..0cf6ba1 100644
--- a/drivers/net/gianfar.c
+++ b/drivers/net/gianfar.c
@@ -1113,6 +1113,11 @@ static int gfar_probe(struct of_device *ofdev,
 		char net_sub_name[NIC_STR_LEN]; /* eth on most platforms except
 		on cavium they call there network devices mgmtX */
 
+		if (!is_valid_ether_addr(wrhv_macaddr))
+				break;
+		else if (!wrhv_net_name[0])
+			strcpy(wrhv_net_name, "eth0");
+
 		/* eth0 --> we only want the eth part so we
 		   Simply append to the ifname the nic number */
 
-- 
1.7.0.4

