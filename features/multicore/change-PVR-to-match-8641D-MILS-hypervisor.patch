From 11ee402e59d4538b62953f301f237de4cb8b2463 Mon Sep 17 00:00:00 2001
From: Thomas Tai <thomas.tai@windriver.com>
Date: Thu, 8 Apr 2010 21:49:48 -0400
Subject: [PATCH 5/9] change PVR to match 8641D MILS hypervisor

Add 8641 pvr value for MILS hypervisor, also added #error if
user selected unsupported CPU.

Signed-off-by: Thomas Tai <thomas.tai@windriver.com>
---
 arch/powerpc/kernel/vbi/wrhv.c |   11 ++++++++---
 1 files changed, 8 insertions(+), 3 deletions(-)

diff --git a/arch/powerpc/kernel/vbi/wrhv.c b/arch/powerpc/kernel/vbi/wrhv.c
index 7055d91..ba1c6cf 100644
--- a/arch/powerpc/kernel/vbi/wrhv.c
+++ b/arch/powerpc/kernel/vbi/wrhv.c
@@ -578,12 +578,15 @@ unsigned int wrhv_irq_of_parse_and_map(struct device_node *dev, int index)
 
 unsigned int wrhv_get_pvr(void)
 {
+#if defined(CONFIG_E500)
        return 0x80200000;
+#elif defined(CONFIG_6xx)
+       return 0x80040000;
+#else
+#error unsupported CPU family
+#endif
 }
 
-
-
-
 /* arch/powerpc/kernel/time.c */
 #define HWTIMER_USE_JIFFY 1
 static void wrhv_set_mode(enum clock_event_mode mode,
@@ -1146,6 +1149,7 @@ out:
 /* arch/powerpc/kernel/traps.c */
 void __kprobes wrhv_DebugException(struct pt_regs *regs, unsigned long debug_status)
 {
+#ifdef CONFIG_E500
 	uint32_t emsr;
 
 	debug_status = get_dbsr();
@@ -1187,6 +1191,7 @@ void __kprobes wrhv_DebugException(struct pt_regs *regs, unsigned long debug_sta
 		/* Setup and send the trap to the handler */
 		do_dabr(regs, mfspr(SPRN_DAC1), debug_status);
 	}
+#endif
 }
 
 /* arch/powerpc/kernel/kgdb.c */
-- 
1.6.5.2

