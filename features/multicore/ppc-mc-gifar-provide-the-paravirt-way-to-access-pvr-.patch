From 10a9b3804f8fb922e54344c92990e6962b80eecf Mon Sep 17 00:00:00 2001
From: Tiejun Chen <tiejun.chen@windriver.com>
Date: Wed, 4 Aug 2010 09:23:50 +0800
Subject: [PATCH 2/2] ppc-mc/gifar: provide the paravirt way to access pvr/svr register

Here re-code the place that want to read directly these privileged
registers, pvr and svr, on gifar driver to go our paravirt path.

Signed-off-by: Tiejun Chen <tiejun.chen@windriver.com>
---
 drivers/net/gianfar.c |    6 ++++--
 1 files changed, 4 insertions(+), 2 deletions(-)

diff --git a/drivers/net/gianfar.c b/drivers/net/gianfar.c
index 06e9e1d..2aa98d3 100644
--- a/drivers/net/gianfar.c
+++ b/drivers/net/gianfar.c
@@ -862,11 +862,13 @@ static void gfar_init_filer_table(struct gfar_private *priv)
 	}
 }
 
+extern unsigned int get_pvr(void);
+extern unsigned int get_svr(void);
 static void gfar_detect_errata(struct gfar_private *priv)
 {
 	struct device *dev = &priv->ofdev->dev;
-	unsigned int pvr = mfspr(SPRN_PVR);
-	unsigned int svr = mfspr(SPRN_SVR);
+	unsigned int pvr = get_pvr();
+	unsigned int svr = get_svr();
 	unsigned int mod = (svr >> 16) & 0xfff6; /* w/o E suffix */
 	unsigned int rev = svr & 0xffff;
 
-- 
1.6.5.2

