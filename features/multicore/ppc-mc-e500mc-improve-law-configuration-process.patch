From b6e98dcfeea58b85292aa40aefb66f049944033b Mon Sep 17 00:00:00 2001
From: Tiejun Chen <tiejun.chen@windriver.com>
Date: Wed, 3 Nov 2010 00:15:30 -0700
Subject: [PATCH] ppc-mc/e500mc: improve law configuration process

Looks the law register offset is different platform so define one variable
for this given case. And it's safe to invalid those address space which are
same as PCIE space so provide the newbie to check if we reuse the same space
then invalid them.

Signed-off-by: Tiejun Chen <tiejun.chen@windriver.com>
---
 arch/powerpc/kernel/vbi/wrhv.c |    7 ++++++-
 1 files changed, 6 insertions(+), 1 deletions(-)

diff --git a/arch/powerpc/kernel/vbi/wrhv.c b/arch/powerpc/kernel/vbi/wrhv.c
index 25eec50..b44b71f 100644
--- a/arch/powerpc/kernel/vbi/wrhv.c
+++ b/arch/powerpc/kernel/vbi/wrhv.c
@@ -379,7 +379,7 @@ unsigned int law_offset = 0x10;
 unsigned char *law_base;
 int law_num;
 int law_prepare_done;
-int ppc_prepare_law_setup(void)
+int ppc_prepare_law_setup(void, unsigned long long addr)
 {
 	struct device_node *dev;
 	const int *prop;
@@ -445,6 +445,11 @@ int ppc_search_free_law(int target_id, unsigned long long addr)
 
 	ppc_prepare_law_setup();
 
+	/* Get the law register offset for setting law address */
+	prop = of_get_property(dev, "offset", NULL);
+	if (prop)
+		law_offset = *prop;
+
 	if ((!ppc_md.set_law_attr) || (!ppc_md.set_law_base) || (!ppc_md.get_law_attr))
 		return -1;
 
-- 
1.6.0.3

