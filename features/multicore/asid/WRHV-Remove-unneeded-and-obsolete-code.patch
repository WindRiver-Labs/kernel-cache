From 0f08a6c020389cf461c7da6586b8d1852dfcc343 Mon Sep 17 00:00:00 2001
From: Jeremy McNicoll <jeremy.mcnicoll@windriver.com>
Date: Tue, 15 Feb 2011 01:15:45 -0500
Subject: [PATCH 04/10] WRHV: Remove unneeded and obsolete code

No longer used and obsoleted in the HV many moons ago.

This commit should be merged into this:

--------------------
commit 3916ed22ec5c0d31ab6ced4dbb86cd5326934c91
Author: WRS Support <support@windriver.com>
Date:   Tue Apr 27 15:22:48 2010 +0800

    powerpc wrhv: introduce powerpc specifics of WR guest

    These powerpc specific additons are the Linux specific
    additions that were not a part of the reference VBI
    implemenation.

    Signed-off-by: Paul Gortmaker <paul.gortmaker@windriver.com>
    Signed-off-by: Bruce Ashfield <bruce.ashfield@windriver.com>

--------------------

Signed-off-by: Jeremy McNicoll <jeremy.mcnicoll@windriver.com>
---
 arch/powerpc/kernel/wrhv_entry_32.S |   14 +-------------
 1 files changed, 1 insertions(+), 13 deletions(-)

diff --git a/arch/powerpc/kernel/wrhv_entry_32.S b/arch/powerpc/kernel/wrhv_entry_32.S
index 27d4d16..2d33f57 100644
--- a/arch/powerpc/kernel/wrhv_entry_32.S
+++ b/arch/powerpc/kernel/wrhv_entry_32.S
@@ -180,18 +180,9 @@ paravirt_transfer_to_handler_cont:
 
 	WRHV_LOAD_MSR(r10,r9,r11)
 
-#ifdef VMMU
-        /* re-enable vmmu */
-
-	lis	r0,VBI_SYS_ctx_load_vmmu@h
-	ori	r0,r0,VBI_SYS_ctx_load_vmmu@l
-	sc
-
-#else
 	lis	r0,VBI_SYS_ctx_load@h
 	ori	r0,r0,VBI_SYS_ctx_load@l
 	sc
-#endif /* VMMU */
 
 #if defined (CONFIG_6xx) || defined(CONFIG_E500)
 4:	rlwinm	r12,r12,0,~_TLF_NAPPING
@@ -470,9 +461,6 @@ paravirt_restore:
 	stw	r0,VB_CONTROL_SRR0(r4)
 	lwz	r0,_LINK(r1)
 	mtlr	r0
-#if 0
-	stw	r0,VB_CONTROL_LR(r4)
-#endif
 	lwz	r0,_XER(r1)
 	mtspr	SPRN_XER,r0
 	lwz	r0,_CTR(r1)
@@ -516,8 +504,8 @@ paravirt_restore:
 	lwz	r1,GPR1(r1)
 	lis	r0,VBI_SYS_ctx_load@h
 	ori	r0,r0,VBI_SYS_ctx_load@l
-#endif  /* VMMU */
 	sc
+#endif  /* VMMU */
 
 	/* Never back from here */
 #endif /* CONFIG_WRHV */
-- 
1.6.5.2

