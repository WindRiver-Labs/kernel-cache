From 7bcd24db7a8432beb1843c4276150d2eaea0e0e7 Mon Sep 17 00:00:00 2001
From: Tiejun Chen <tiejun.chen@windriver.com>
Date: Wed, 12 May 2010 16:39:49 +0800
Subject: [PATCH 08/14] WRHV/PPC: smp disable tlbsync

Now tlbsync is a privileged instruction so hypervisor will do that.
So this is nothing on guest OS.

Signed-off-by: Tiejun Chen <tiejun.chen@windriver.com>
---
 arch/powerpc/include/asm/ppc_asm.h |    3 ++-
 1 files changed, 2 insertions(+), 1 deletions(-)

diff --git a/arch/powerpc/include/asm/ppc_asm.h b/arch/powerpc/include/asm/ppc_asm.h
index 498fe09..0127eb4 100644
--- a/arch/powerpc/include/asm/ppc_asm.h
+++ b/arch/powerpc/include/asm/ppc_asm.h
@@ -339,7 +339,8 @@ END_FTR_SECTION_NESTED(CPU_FTR_CELL_TB_BUG, CPU_FTR_CELL_TB_BUG, 96)
 #define MFTB(dest)			mftb dest
 #endif
 
-#ifndef CONFIG_SMP
+#if !defined(CONFIG_SMP) || defined(CONFIG_WRHV)
+/* The hypervisor will do that. */
 #define TLBSYNC
 #else /* CONFIG_SMP */
 /* tlbsync is not implemented on 601 */
-- 
1.6.5.2

