From 21cb016faf103a84a779a9f94d79bb2a96ce746b Mon Sep 17 00:00:00 2001
From: Bruce Ashfield <bruce.ashfield@windriver.com>
Date: Fri, 27 May 2011 00:39:05 -0400
Subject: [PATCH] whrv/virtual serial: convert intrDeviceChannelBuffer to intr_device_channel_buffer

The vbi update for hypervisor 1.3 changes intrDeviceChannelBuffer to
intr_device_channel_buffer. So the virtual serial drivers must be
updated.

Note: this commit can be dropped in the future and merged with the
virtual serial drivers themselves.

Signed-off-by: Bruce Ashfield <bruce.ashfield@windriver.com>
---
 drivers/wrhv/wrhv_devices.c |    2 +-
 drivers/wrhv/wrhv_devices.h |    4 ++--
 drivers/wrhv/wrhv_duart.c   |    2 +-
 drivers/wrhv/wrhv_serial.c  |    4 ++--
 4 files changed, 6 insertions(+), 6 deletions(-)

diff --git a/drivers/wrhv/wrhv_devices.c b/drivers/wrhv/wrhv_devices.c
index 5fc841e..6d5571c 100644
--- a/drivers/wrhv/wrhv_devices.c
+++ b/drivers/wrhv/wrhv_devices.c
@@ -274,7 +274,7 @@ static irqreturn_t wrhv_interrupt(int irq, void *_vq)
 int wrhv_init_vq(struct wrhv_device *vdev, unsigned int index,
 			struct wrhv_virtqueue *vq)
 {
-	struct intrDeviceChannelBuffer *idc = vdev->idc;
+	struct intr_device_channel_buffer *idc = vdev->idc;
 
 	/* index 0 should be rx queue, index 1 should be tx queue */
 	switch (index) {
diff --git a/drivers/wrhv/wrhv_devices.h b/drivers/wrhv/wrhv_devices.h
index 54e3b5e..2f9efe2 100644
--- a/drivers/wrhv/wrhv_devices.h
+++ b/drivers/wrhv/wrhv_devices.h
@@ -60,7 +60,7 @@ struct wrhv_virtqueue;
 
 struct wrhv_device_ops {
 	int (*init_dev)(struct wrhv_device *vdev);
-	struct intrDeviceChannelBuffer *(*alloc_idc)(struct wrhv_device *vdev);
+	struct intr_device_channel_buffer *(*alloc_idc)(struct wrhv_device *vdev);
 	int (*init_idc)(struct wrhv_device *vdev, unsigned int index,
 			struct wrhv_virtqueue *vq);
 };
@@ -71,7 +71,7 @@ struct wrhv_device {
 	unsigned int mode;
 	struct virtio_device vdev;
 	struct wrhv_device_desc *desc;
-	struct intrDeviceChannelBuffer *idc;
+	struct intr_device_channel_buffer *idc;
 	vbi_pdc_handle	pdc_handle;
 	struct wrhv_device_ops *ops;
 };
diff --git a/drivers/wrhv/wrhv_duart.c b/drivers/wrhv/wrhv_duart.c
index 7e2514e..b84d473 100644
--- a/drivers/wrhv/wrhv_duart.c
+++ b/drivers/wrhv/wrhv_duart.c
@@ -35,7 +35,7 @@ char wrhv_duart_name[256];
 vbi_pdc_handle duart_pdc;
 int is_wrhv_duart_inited;
 
-struct intrDeviceChannelBuffer idc = {
+struct intr_device_channel_buffer idc = {
 	.rxBuf = (void *)rxBuf,
 	.rxBufLen = WRHV_DUART_RX_SIZE,
 	.rxBufWrPtr = (size_t)0,
diff --git a/drivers/wrhv/wrhv_serial.c b/drivers/wrhv/wrhv_serial.c
index a2388b9..7eef360 100644
--- a/drivers/wrhv/wrhv_serial.c
+++ b/drivers/wrhv/wrhv_serial.c
@@ -33,7 +33,7 @@
 static struct hrtimer *wrhv_serial_timer;
 
 extern vbi_pdc_handle duart_pdc;
-extern struct intrDeviceChannelBuffer idc;
+extern struct intr_device_channel_buffer idc;
 extern char wrhv_duart_name[];
 
 #ifdef CONFIG_WRHV_VIRTIO_SERIAL_CONSOLE
@@ -162,7 +162,7 @@ static int wrhv_serial_init_device(struct wrhv_device *vdev)
 	return wrhv_init_device(vdev);
 }
 
-static struct intrDeviceChannelBuffer *wrhv_serial_alloc_idc(struct wrhv_device *vdev)
+static struct intr_device_channel_buffer *wrhv_serial_alloc_idc(struct wrhv_device *vdev)
 {
 	if (is_console_device(vdev))
 		vdev->idc = &idc;
-- 
1.6.5.2

