From ecf4b8f07b5e3acd98415146b4c3c4549979dff1 Mon Sep 17 00:00:00 2001
From: Paul Gortmaker <paul.gortmaker@windriver.com>
Date: Thu, 15 May 2014 14:53:58 -0400
Subject: [PATCH 5/5] sched/rt: add warnings if runtime checking has been
 disabled.

We added some for the RT_GROUP_SCHED case, so lets add the same
for the !RT_GROUP_SCHED case as well.

Signed-off-by: Paul Gortmaker <paul.gortmaker@windriver.com>
---
 kernel/sched/core.c | 7 +++++++
 1 file changed, 7 insertions(+)

diff --git a/kernel/sched/core.c b/kernel/sched/core.c
index 4deb5359dc29..5b135123f931 100644
--- a/kernel/sched/core.c
+++ b/kernel/sched/core.c
@@ -7809,6 +7809,13 @@ static int sched_rt_global_constraints(void)
 	unsigned long flags;
 	int i, ret = 0;
 
+	if (sysctl_sched_rt_runtime < 0) {
+		pr_warn("WARNING: RT throttling checks have been manually disabled.\n");
+		pr_warn("WARNING: misbehaving RT tasks can starve softirq, cause RCU stalls, etc.\n");
+		if (sysctl_sched_rt_runtime != -31337)
+			add_taint(TAINT_WARN, LOCKDEP_STILL_OK);
+	}
+
 	raw_spin_lock_irqsave(&def_rt_bandwidth.rt_runtime_lock, flags);
 	for_each_possible_cpu(i) {
 		struct rt_rq *rt_rq = &cpu_rq(i)->rt;
-- 
2.1.4

