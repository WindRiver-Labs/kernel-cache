From f1ce9664e97388f4d8281e739217d405a7ce6d68 Mon Sep 17 00:00:00 2001
From: fupan li <fupan.li@windriver.com>
Date: Mon, 10 Nov 2014 10:07:04 +0800
Subject: [PATCH 2/7] perf: No need to test the irqs_disabled in hrtimer
 callback function on RT kernel

The hrtimer callback function run in irq context, and the irq is disabled
by default on no-RT kernel; but on RT kernel, it is called with irq enabled
intentionally by the commit of 3bfea97eeb5745b794d898551fc644edca690ba2,
"hrtimer: fixup hrtimer callback changes for preempt-rt", so there is no need
to test the irqs_disabled in hrtimer callback function.

Signed-off-by: fupan li <fupan.li@windriver.com>
---
 kernel/events/core.c | 2 +-
 1 file changed, 1 insertion(+), 1 deletion(-)

diff --git a/kernel/events/core.c b/kernel/events/core.c
index e05d1dd..4fd9b73 100644
--- a/kernel/events/core.c
+++ b/kernel/events/core.c
@@ -753,7 +753,7 @@ static enum hrtimer_restart perf_cpu_hrtimer_handler(struct hrtimer *hr)
 	enum hrtimer_restart ret = HRTIMER_NORESTART;
 	int rotations = 0;
 
-	WARN_ON(!irqs_disabled());
+	WARN_ON_NONRT(!irqs_disabled());
 
 	cpuctx = container_of(hr, struct perf_cpu_context, hrtimer);
 
-- 
2.0.2

