From 847bfd254399eebc8752d39f43628e6c1baac076 Mon Sep 17 00:00:00 2001
From: "Paul E. McKenney" <paulmck@linux.vnet.ibm.com>
Date: Sat, 28 Sep 2013 18:44:11 -0700
Subject: [PATCH] rcutorture: Add datestamp argument to kvm.sh

commit 847bfd254399eebc8752d39f43628e6c1baac076 upstream.

Allow datestamp to be specified to allow tests to be broken up and run
in parallel.

Signed-off-by: Paul E. McKenney <paulmck@linux.vnet.ibm.com>
Cc: Greg KH <gregkh@linuxfoundation.org>

diff --git a/tools/testing/selftests/rcutorture/bin/kvm.sh b/tools/testing/selftests/rcutorture/bin/kvm.sh
index 46c75ee..9fcceed 100644
--- a/tools/testing/selftests/rcutorture/bin/kvm.sh
+++ b/tools/testing/selftests/rcutorture/bin/kvm.sh
@@ -50,11 +50,13 @@ configs=" sysidleY.2013.06.19a \
 	  PT2-NH \
 	  NT1-nh \
 	  NT3-NH"
+ds=`date +%Y.%m.%d-%H:%M:%S`
 
 usage () {
 	echo "Usage: $scriptname optional arguments:"
 	echo "       --builddir absolute-pathname"
 	echo "       --configs \"config-file list\""
+	echo "       --datestamp string"
 	echo "       --duration minutes"
 	echo "       --rcu-kvm absolute-pathname"
 	echo "       --results absolute-pathname"
@@ -98,6 +100,11 @@ do
 		configs="$2"
 		shift
 		;;
+	--datestamp)
+		checkarg --datestamp "(relative pathname)" "$#" "$2" '^[^/]*$' '^--'
+		ds=$2
+		shift
+		;;
 	--duration)
 		checkarg --duration "(minutes)" $# "$2" '^[0-9]*$' error
 		dur=$2
@@ -147,13 +154,12 @@ if test -z "$resdir"
 then
 	resdir=$KVM/res
 	mkdir $resdir || :
-	ds=`date +%Y.%m.%d-%H:%M:%S`
-	mkdir $resdir/$ds
-	echo Datestamp: $ds
 else
-	mkdir -p "$resdir"
-	ds=""
+	mkdir -p "$resdir" || :
 fi
+mkdir $resdir/$ds
+echo Datestamp: $ds
+
 pwd > $resdir/$ds/testid.txt
 if test -d .git
 then
-- 
1.8.2.3

