From 9c023a492176b5cc52df60d27f3bafcfe105f429 Mon Sep 17 00:00:00 2001
From: "Paul E. McKenney" <paulmck@linux.vnet.ibm.com>
Date: Tue, 15 Oct 2013 09:22:48 -0700
Subject: [PATCH] rcutorture: Add --qemu-args argument to kvm.sh

commit e9ce640001c681a1ec01a996dfae2f8fa5d1cfba upstream.

This commits adds the --qemu-args argument to kvm.sh that is required
to pass boot devices down through to qemu.

Signed-off-by: Paul E. McKenney <paulmck@linux.vnet.ibm.com>
Cc: Greg KH <gregkh@linuxfoundation.org>
Signed-off-by: Paul Gortmaker <paul.gortmaker@windriver.com>

diff --git a/tools/testing/selftests/rcutorture/bin/kvm.sh b/tools/testing/selftests/rcutorture/bin/kvm.sh
index 2fb91d4..7d6ca33 100644
--- a/tools/testing/selftests/rcutorture/bin/kvm.sh
+++ b/tools/testing/selftests/rcutorture/bin/kvm.sh
@@ -49,6 +49,7 @@ usage () {
 	echo "       --interactive"
 	echo "       --kversion vN.NN"
 	echo "       --mac nn:nn:nn:nn:nn:nn"
+	echo "       --qemu-args qemu-system-..."
 	echo "       --qemu-cmd qemu-system-..."
 	echo "       --results absolute-pathname"
 	echo "       --relbuilddir relative-pathname"
@@ -85,7 +86,7 @@ do
 		shift
 		;;
 	--builddir)
-		checkarg --builddir "(absolute pathname)" "$#" "$2" '^/' error
+		checkarg --builddir "(absolute pathname)" "$#" "$2" '^/' '^error'
 		builddir=$2
 		gotbuilddir=1
 		shift
@@ -104,7 +105,7 @@ do
 		shift
 		;;
 	--duration)
-		checkarg --duration "(minutes)" $# "$2" '^[0-9]*$' error
+		checkarg --duration "(minutes)" $# "$2" '^[0-9]*$' '^error'
 		dur=$2
 		shift
 		;;
@@ -112,7 +113,7 @@ do
 		RCU_QEMU_INTERACTIVE=1; export RCU_QEMU_INTERACTIVE
 		;;
 	--kversion)
-		checkarg --kversion "(kernel version)" $# "$2" '^v[0-9.]*$' error
+		checkarg --kversion "(kernel version)" $# "$2" '^v[0-9.]*$' '^error'
 		kversion=$2
 		shift
 		;;
@@ -121,6 +122,11 @@ do
 		RCU_QEMU_MAC=$2; export RCU_QEMU_MAC
 		shift
 		;;
+	--qemu-args)
+		checkarg --qemu-args "-qemu args" $# "$2" '^-' '^error'
+		RCU_QEMU_ARG="$2"
+		shift
+		;;
 	--qemu-cmd)
 		checkarg --qemu-cmd "(qemu-system-...)" $# "$2" 'qemu-system-' '^--'
 		RCU_QEMU_CMD="$2"; export RCU_QEMU_CMD
@@ -134,7 +140,7 @@ do
 		shift
 		;;
 	--results)
-		checkarg --results "(absolute pathname)" "$#" "$2" '^/' error
+		checkarg --results "(absolute pathname)" "$#" "$2" '^/' '^error'
 		resdir=$2
 		shift
 		;;
@@ -189,6 +195,6 @@ do
 	rd=$resdir/$ds/$CF
 	mkdir $rd || :
 	echo Results directory: $rd
-	kvm-test-1-rcu.sh $CONFIGFRAG/$kversion/$CF $builddir $rd $dur "-nographic" "rcutorture.test_no_idle_hz=1 rcutorture.verbose=1 $RCU_BOOTARGS"
+	kvm-test-1-rcu.sh $CONFIGFRAG/$kversion/$CF $builddir $rd $dur "-nographic $RCU_QEMU_ARG" "rcutorture.test_no_idle_hz=1 rcutorture.verbose=1 $RCU_BOOTARGS"
 done
 # Tracing: trace_event=rcu:rcu_nocb_grace_period,rcu:rcu_grace_period,rcu:rcu_grace_period_init,rcu:rcu_quiescent_state_report,rcu:rcu_fqs,rcu:rcu_callback,rcu:rcu_torture_read,rcu:rcu_invoke_callback,rcu:rcu_fqs,rcu:rcu_dyntick,rcu:rcu_unlock_preempted_task
-- 
1.8.2.3

