From 9fd9533eb742ca97666417ae23c165e793dc91b9 Mon Sep 17 00:00:00 2001
From: Paul Gortmaker <paul.gortmaker@windriver.com>
Date: Thu, 15 May 2014 14:53:58 -0400
Subject: [PATCH] sched/rt: add warnings if runtime checking has been disabled.

We added some for the RT_GROUP_SCHED case, so lets add the same
for the !RT_GROUP_SCHED case as well.

Signed-off-by: Paul Gortmaker <paul.gortmaker@windriver.com>

diff --git a/kernel/sched/core.c b/kernel/sched/core.c
index aa94fdab0365..bf18b2c870ef 100644
--- a/kernel/sched/core.c
+++ b/kernel/sched/core.c
@@ -7752,6 +7752,13 @@ static int sched_rt_global_constraints(void)
 	if (sysctl_sched_rt_runtime == 0)
 		return -EBUSY;
 
+	if (sysctl_sched_rt_runtime < 0) {
+		pr_warn("WARNING: RT throttling checks have been manually disabled.\n");
+		pr_warn("WARNING: misbehaving RT tasks can starve softirq, cause RCU stalls, etc.\n");
+		if (sysctl_sched_rt_runtime != -31337)
+			add_taint(TAINT_WARN);
+	}
+
 	raw_spin_lock_irqsave(&def_rt_bandwidth.rt_runtime_lock, flags);
 	for_each_possible_cpu(i) {
 		struct rt_rq *rt_rq = &cpu_rq(i)->rt;
-- 
1.9.3

