From fa38904b07f01dfe02df943d27b4d8a351b2f58f Mon Sep 17 00:00:00 2001
From: "Paul E. McKenney" <paulmck@linux.vnet.ibm.com>
Date: Mon, 30 Sep 2013 15:16:14 -0700
Subject: [PATCH] rcutorture: Eliminate duplicate .config-check code

commit 50d48a1d154ef9ece016512817dbbd33c598f162 upstream.

The commit uses configcheck.sh from within configinit.sh, replacing the
imperfect inline expansion that was there before.

Signed-off-by: Paul E. McKenney <paulmck@linux.vnet.ibm.com>
Cc: Greg KH <gregkh@linuxfoundation.org>
Signed-off-by: Paul Gortmaker <paul.gortmaker@windriver.com>

diff --git a/tools/testing/selftests/rcutorture/bin/configinit.sh b/tools/testing/selftests/rcutorture/bin/configinit.sh
index 926fbd3..939c16c 100755
--- a/tools/testing/selftests/rcutorture/bin/configinit.sh
+++ b/tools/testing/selftests/rcutorture/bin/configinit.sh
@@ -51,31 +51,6 @@ cp $builddir/.config $builddir/.config.new
 yes '' | make $buildloc oldconfig > $builddir/Make.modconfig.out 2>&1
 
 # verify new config matches specification.
+configcheck.sh $builddir/.config $c
 
-sed -e 's/"//g' < $c > $T/c
-sed -e 's/"//g' < $builddir/.config > $T/.config
-sed -e 's/\(.*\)=n/# \1 is not set/' -e 's/^#CHECK#//' < $c |
-awk	'
-	{
-		print "if grep -q \"" $0 "\" < '"$T/.config"'";
-		print "then";
-		print "\t:";
-		print "else";
-		if ($1 == "#") {
-			print "\tif grep -q \"" $2 "\" < '"$T/.config"'";
-			print "\tthen";
-			print "\t\techo \":" $2 ": improperly set\"";
-			print "\telse";
-			print "\t\t:";
-			print "\tfi";
-		} else {
-			print "\techo \":" $0 ": improperly set\"";
-		}
-		print "fi";
-	}' | sh > $T/diagnostics
-if test -s $T/diagnostics
-then
-	cat $T/diagnostics
-	exit 1
-fi
 exit 0
-- 
1.8.2.3

