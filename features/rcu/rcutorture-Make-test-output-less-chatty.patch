From 2febf8028ca20d742f721ad780d47e86459c2aec Mon Sep 17 00:00:00 2001
From: "Paul E. McKenney" <paulmck@linux.vnet.ibm.com>
Date: Mon, 30 Sep 2013 14:49:43 -0700
Subject: [PATCH] rcutorture: Make test output less chatty

commit 330a76f15651a715a54bc2022586a7be151c9963 upstream.

This commit drops no-longer-needed diagnostics from the output.  Some of
them are retained in logfiles, in case they are ever needed.

Signed-off-by: Paul E. McKenney <paulmck@linux.vnet.ibm.com>
Cc: Greg KH <gregkh@linuxfoundation.org>
Signed-off-by: Paul Gortmaker <paul.gortmaker@windriver.com>

diff --git a/tools/testing/selftests/rcutorture/bin/configinit.sh b/tools/testing/selftests/rcutorture/bin/configinit.sh
index 1f09d59..926fbd3 100755
--- a/tools/testing/selftests/rcutorture/bin/configinit.sh
+++ b/tools/testing/selftests/rcutorture/bin/configinit.sh
@@ -14,8 +14,6 @@
 # for example, "O=/tmp/foo".  If this argument is omitted, the .config
 # file will be generated directly in the current directory.
 
-echo configinit.sh $*
-
 T=/tmp/configinit.sh.$$
 trap 'rm -rf $T' 0
 mkdir $T
diff --git a/tools/testing/selftests/rcutorture/bin/kvm-test-1-rcu.sh b/tools/testing/selftests/rcutorture/bin/kvm-test-1-rcu.sh
index 618aa4d..5526550 100755
--- a/tools/testing/selftests/rcutorture/bin/kvm-test-1-rcu.sh
+++ b/tools/testing/selftests/rcutorture/bin/kvm-test-1-rcu.sh
@@ -62,7 +62,7 @@ then
 fi
 cp $config_template $resdir/ConfigFragment
 echo ' ---' `date`: Starting build
-echo ' ---' Kconfig fragment at: $config_template
+echo ' ---' Kconfig fragment at: $config_template >> $resdir/log
 cat << '___EOF___' >> $T
 CONFIG_RCU_TORTURE_TEST=y
 ___EOF___
diff --git a/tools/testing/selftests/rcutorture/bin/kvm.sh b/tools/testing/selftests/rcutorture/bin/kvm.sh
index 92f726b..bf6d68e 100644
--- a/tools/testing/selftests/rcutorture/bin/kvm.sh
+++ b/tools/testing/selftests/rcutorture/bin/kvm.sh
@@ -28,6 +28,7 @@
 # Authors: Paul E. McKenney <paulmck@linux.vnet.ibm.com>
 
 scriptname=$0
+args="$*"
 
 dur=30
 KVM=`pwd`/tools/testing/selftests/rcutorture; export KVM
@@ -73,7 +74,6 @@ checkarg () {
 
 while test $# -gt 0
 do
-	echo ":$1:"
 	case "$1" in
 	--builddir)
 		checkarg --builddir "(absolute pathname)" "$#" "$2" '^/' error
@@ -133,11 +133,6 @@ do
 	shift
 done
 
-echo "builddir=$builddir"
-echo "dur=$dur"
-echo "KVM=$KVM"
-echo "resdir=$resdir"
-
 PATH=${KVM}/bin:$PATH; export PATH
 CONFIGFRAG=${KVM}/configs; export CONFIGFRAG
 KVPATH=${CONFIGFRAG}/$kversion; export KVPATH
@@ -150,12 +145,19 @@ fi
 if test -z "$resdir"
 then
 	resdir=$KVM/res
-	mkdir $resdir || :
+	if ! test -e $resdir
+	then
+		mkdir $resdir || :
+	fi
 else
-	mkdir -p "$resdir" || :
+	if ! test -e $resdir
+	then
+		mkdir -p "$resdir" || :
+	fi
 fi
 mkdir $resdir/$ds
-echo Datestamp: $ds
+touch $resdir/$ds/log
+echo $scriptname $args >> $resdir/$ds/log
 
 pwd > $resdir/$ds/testid.txt
 if test -d .git
@@ -164,7 +166,10 @@ then
 	git rev-parse HEAD >> $resdir/$ds/testid.txt
 fi
 builddir=$KVM/b1
-mkdir $builddir || :
+if ! test -e $builddir
+then
+	mkdir $builddir || :
+fi
 
 for CF in $configs
 do
-- 
1.8.2.3

