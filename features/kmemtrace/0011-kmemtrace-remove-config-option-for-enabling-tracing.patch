From a581138ebe398c18014454e0f204e34a943cf376 Mon Sep 17 00:00:00 2001
From: Pekka Enberg <penberg@cs.helsinki.fi>
Date: Fri, 10 Oct 2008 11:02:59 +0300
Subject: [PATCH] kmemtrace: remove config option for enabling tracing at boot

Users can pass kmemtrace.enabled=yes as a kernel parameter to enable kmemtrace
at boot so remove the useless CONFIG_KMEMTRACE_DEFAULT_ENABLED config option.

Cc: Eduard - Gabriel Munteanu <eduard.munteanu@linux360.ro>
Signed-off-by: Pekka Enberg <penberg@cs.helsinki.fi>
---
 Documentation/vm/kmemtrace.txt |    2 +-
 lib/Kconfig.debug              |    8 --------
 mm/kmemtrace.c                 |    8 +++-----
 3 files changed, 4 insertions(+), 14 deletions(-)

diff --git a/Documentation/vm/kmemtrace.txt b/Documentation/vm/kmemtrace.txt
index f656cac..a956d9b 100644
--- a/Documentation/vm/kmemtrace.txt
+++ b/Documentation/vm/kmemtrace.txt
@@ -61,7 +61,7 @@ III. Quick usage guide
 ======================
 
 1) Get a kernel that supports kmemtrace and build it accordingly (i.e. enable
-CONFIG_KMEMTRACE and CONFIG_KMEMTRACE_DEFAULT_ENABLED).
+CONFIG_KMEMTRACE).
 
 2) Get the userspace tool and build it:
 $ git-clone git://repo.or.cz/kmemtrace-user.git		# current repository
diff --git a/lib/Kconfig.debug b/lib/Kconfig.debug
index 78d669b..b5417e2 100644
--- a/lib/Kconfig.debug
+++ b/lib/Kconfig.debug
@@ -823,14 +823,6 @@ config KMEMTRACE
 
 	  If unsure, say N.
 
-config KMEMTRACE_DEFAULT_ENABLED
-	bool "Enabled by default at boot"
-	depends on KMEMTRACE
-	help
-	  Say Y here to enable kmemtrace at boot-time by default. Whatever
-	  the choice, the behavior can be overridden by a kernel parameter,
-	  as described in documentation.
-
 menuconfig BUILD_DOCSRC
 	bool "Build targets in Documentation/ tree"
 	depends on HEADERS_CHECK
diff --git a/mm/kmemtrace.c b/mm/kmemtrace.c
index f7a49c0..f7704f5 100644
--- a/mm/kmemtrace.c
+++ b/mm/kmemtrace.c
@@ -19,11 +19,9 @@ static struct rchan *kmemtrace_chan;
 static u32 kmemtrace_buf_overruns;
 
 static unsigned int kmemtrace_n_subbufs;
-#ifdef CONFIG_KMEMTRACE_DEFAULT_ENABLED
-static unsigned int kmemtrace_enabled = 1;
-#else
-static unsigned int kmemtrace_enabled = 0;
-#endif
+
+/* disabled by default */
+static unsigned int kmemtrace_enabled;
 
 /*
  * The sequence number is used for reordering kmemtrace packets
-- 
1.6.0.90.g436ed

