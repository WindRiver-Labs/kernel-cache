From 6f2a3f1287d757d3ead11ac746ca5c863b965adf Mon Sep 17 00:00:00 2001
From: Arron Wang <arron.wang@intel.com>
Date: Tue, 30 Jul 2013 14:40:05 +0200
Subject: [PATCH 31/44] NFC: Update secure element state

The secure element state was not updated from the enable/disable ops,
leaving the SE state to disabled for ever.

Signed-off-by: Arron Wang <arron.wang@intel.com>
Signed-off-by: Samuel Ortiz <sameo@linux.intel.com>
(cherry picked from commit d81e712910a19defe5eacd7c6708a9484568f2ba)
---
 net/nfc/core.c | 4 ++++
 1 file changed, 4 insertions(+)

diff --git a/net/nfc/core.c b/net/nfc/core.c
index ee1fe66..e92923c 100644
--- a/net/nfc/core.c
+++ b/net/nfc/core.c
@@ -589,6 +589,8 @@ int nfc_enable_se(struct nfc_dev *dev, u32 se_idx)
 	}
 
 	rc = dev->ops->enable_se(dev, se_idx);
+	if (rc >= 0)
+		se->state = NFC_SE_ENABLED;
 
 error:
 	device_unlock(&dev->dev);
@@ -632,6 +634,8 @@ int nfc_disable_se(struct nfc_dev *dev, u32 se_idx)
 	}
 
 	rc = dev->ops->disable_se(dev, se_idx);
+	if (rc >= 0)
+		se->state = NFC_SE_DISABLED;
 
 error:
 	device_unlock(&dev->dev);
-- 
1.8.4.93.g57e4c17

