From 5fb658a7ecdcedebc936acd05fb9415535c5e902 Mon Sep 17 00:00:00 2001
From: Tero Kristo <t-kristo@ti.com>
Date: Fri, 29 Aug 2014 16:17:11 +0300
Subject: [PATCH 1103/1587] ARM: AM43xx: PM: disable DCOLDO DPLL PER force
 active to allow suspend

This register is currently not properly restored by rtc-only resume, thus
force write its contents.

Signed-off-by: Tero Kristo <t-kristo@ti.com>
[zou: Original patch taken from
ti-sdk-am335x-evm-08.00.00.00-Linux-x86-Install.bin]
Signed-off-by: Cao Zou <cao.zou@windriver.com>
---
 arch/arm/mach-omap2/pm33xx.c |    5 +++++
 1 files changed, 5 insertions(+), 0 deletions(-)

diff --git a/arch/arm/mach-omap2/pm33xx.c b/arch/arm/mach-omap2/pm33xx.c
index a75183a..e250e19 100644
--- a/arch/arm/mach-omap2/pm33xx.c
+++ b/arch/arm/mach-omap2/pm33xx.c
@@ -190,6 +190,11 @@ static void am43xx_restore_context(void)
 	common_restore_context();
 	am43xx_control_restore_context();
 	am43xx_push_sram_idle();
+	/*
+	 * HACK: restore dpll_per_clkdcoldo register contents, to avoid
+	 * breaking suspend-resume
+	 */
+	writel_relaxed(0x0, AM33XX_L4_WK_IO_ADDRESS(0x44df2e14));
 }
 
 int am33xx_rtc_only_idle(long unsigned int unused)
-- 
1.7.5.4

