From bc9c4de6d74f251b0dee29a45eb21c800276da68 Mon Sep 17 00:00:00 2001
From: Benoit Parrot <bparrot@ti.com>
Date: Mon, 10 Nov 2014 12:14:18 -0600
Subject: [PATCH 1327/1587] media: ti-vpe: vip: Fix enuminput error

v4l2-compliance: enum_input test failing

Fix enuminput, but ultimately disabled it until get/set input fucntions are also provided.
Disabled vidioc_expbuf as it is not supported at this time.

Signed-off-by: Benoit Parrot <bparrot@ti.com>
[zou: Original patch taken from
ti-sdk-am335x-evm-08.00.00.00-Linux-x86-Install.bin]
Signed-off-by: Cao Zou <cao.zou@windriver.com>
---
 drivers/media/platform/ti-vpe/vip.c |    9 ++++++---
 1 files changed, 6 insertions(+), 3 deletions(-)

diff --git a/drivers/media/platform/ti-vpe/vip.c b/drivers/media/platform/ti-vpe/vip.c
index c3990ab..7c3c292 100644
--- a/drivers/media/platform/ti-vpe/vip.c
+++ b/drivers/media/platform/ti-vpe/vip.c
@@ -1184,10 +1184,14 @@ static int vip_querycap(struct file *file, void *priv,
 static int vip_enuminput(struct file *file, void *priv,
 				struct v4l2_input *inp)
 {
-	if (inp->index != 0)
+	struct vip_stream *stream = file2stream(file);
+
+	if (inp->index)
 		return -EINVAL;
-	strncpy(inp->name, VIP_INPUT_NAME, sizeof(inp->name) - 1);
+
 	inp->type = V4L2_INPUT_TYPE_CAMERA;
+	sprintf(inp->name, "camera %u", stream->vfd->num);
+
 	return 0;
 }
 
@@ -1530,7 +1534,6 @@ static long vip_ioctl_default(struct file *file, void *fh, bool valid_prio,
 
 static const struct v4l2_ioctl_ops vip_ioctl_ops = {
 	.vidioc_querycap	= vip_querycap,
-	.vidioc_enum_input	= vip_enuminput,
 
 	.vidioc_enum_fmt_vid_cap = vip_enum_fmt_vid_cap,
 	.vidioc_g_fmt_vid_cap	= vip_g_fmt_vid_cap,
-- 
1.7.5.4

