From bb2004bc85a5fdc1f54e6ee4f8395f46f618a1d9 Mon Sep 17 00:00:00 2001
From: Dave Gerlach <d-gerlach@ti.com>
Date: Mon, 15 Sep 2014 18:30:34 -0500
Subject: [PATCH 1211/1587] ARM: OMAP2: sleep43xx: Use correct address for MPU
 Clockdomain

Patch 95306a5: ARM: OMAP2: sleep43xx: Set MPU Clockdomain to HW_AUTO
after suspend attempted to set MPU clockdomain to HW_AUTO but was
writing to the virtual address rather than physical address after
resume. Correct code to use physical address as the MMU has not yet been
turned on.

Signed-off-by: Dave Gerlach <d-gerlach@ti.com>
[zou: Original patch taken from
ti-sdk-am335x-evm-08.00.00.00-Linux-x86-Install.bin]
Signed-off-by: Cao Zou <cao.zou@windriver.com>
---
 arch/arm/mach-omap2/sleep43xx.S |    5 ++++-
 1 files changed, 4 insertions(+), 1 deletions(-)

diff --git a/arch/arm/mach-omap2/sleep43xx.S b/arch/arm/mach-omap2/sleep43xx.S
index f1ed8e5..dde628b 100644
--- a/arch/arm/mach-omap2/sleep43xx.S
+++ b/arch/arm/mach-omap2/sleep43xx.S
@@ -382,7 +382,7 @@ ENTRY(am43xx_resume_offset)
 
 ENTRY(am43xx_resume_from_deep_sleep)
 	/* Set MPU CLKSTCTRL to HW AUTO so that CPUidle works properly */
-	ldr	r1, am43xx_virt_mpu_clkstctrl
+	ldr	r1, am43xx_phys_mpu_clkstctrl
 	mov	r2, #AM43XX_CM_CLKSTCTRL_CLKTRCTRL_HW_AUTO
 	str	r2, [r1]
 
@@ -569,6 +569,9 @@ am43xx_virt_mpu_pwrstctrl:
 	.word	(AM43XX_PM_MPU_PWRSTCTRL)
 am43xx_virt_mpu_clkstctrl:
 	.word	(AM43XX_CM_MPU_CLKSTCTRL)
+am43xx_phys_mpu_clkstctrl:
+	.word	(AM43XX_CM_BASE + AM43XX_CM_MPU_INST + \
+		 AM43XX_CM_MPU_MPU_CDOFFS)
 am43xx_virt_mpu_clkctrl:
 	.word	(AM43XX_CM_MPU_MPU_CLKCTRL)
 am43xx_virt_emif_clkctrl:
-- 
1.7.5.4

