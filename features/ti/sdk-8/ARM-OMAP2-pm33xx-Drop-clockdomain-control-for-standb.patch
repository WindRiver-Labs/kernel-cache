From 6831075bda4740109a61600966e75b103ef47c2f Mon Sep 17 00:00:00 2001
From: Dave Gerlach <d-gerlach@ti.com>
Date: Fri, 8 Aug 2014 16:55:38 -0500
Subject: [PATCH 0956/1587] ARM: OMAP2+: pm33xx: Drop clockdomain control for
 standby

Certain clockdomains needed to be activated before going in to standby
mode for MPU to be properly woken up. This clockdomain control is now
handled in the CM3 firmware so remove it from the pm33xx code.

Signed-off-by: Dave Gerlach <d-gerlach@ti.com>
[zou: Original patch taken from
ti-sdk-am335x-evm-08.00.00.00-Linux-x86-Install.bin]
Signed-off-by: Cao Zou <cao.zou@windriver.com>
---
 arch/arm/mach-omap2/pm33xx.c |   15 +++------------
 1 files changed, 3 insertions(+), 12 deletions(-)

diff --git a/arch/arm/mach-omap2/pm33xx.c b/arch/arm/mach-omap2/pm33xx.c
index a13c517..85d2b15 100644
--- a/arch/arm/mach-omap2/pm33xx.c
+++ b/arch/arm/mach-omap2/pm33xx.c
@@ -50,7 +50,6 @@
 static void __iomem *scu_base;
 static struct powerdomain *cefuse_pwrdm, *gfx_pwrdm, *per_pwrdm, *mpu_pwrdm;
 static struct clockdomain *gfx_l4ls_clkdm;
-static struct clockdomain *l3s_clkdm, *l4fw_clkdm, *clk_24mhz_clkdm;
 #endif /* CONFIG_SUSPEND */
 
 #ifdef CONFIG_CPU_PM
@@ -356,13 +355,9 @@ static int am33xx_suspend_init(void)
 	u32 temp;
 
 	gfx_l4ls_clkdm = clkdm_lookup("gfx_l4ls_gfx_clkdm");
-	l3s_clkdm = clkdm_lookup("l3s_clkdm");
-	l4fw_clkdm = clkdm_lookup("l4fw_clkdm");
-	clk_24mhz_clkdm = clkdm_lookup("clk_24mhz_clkdm");
 
-	if ((!gfx_l4ls_clkdm) || (!l3s_clkdm) || (!l4fw_clkdm) ||
-	    (!clk_24mhz_clkdm)) {
-		pr_err("PM: Cannot lookup clockdomains\n");
+	if (!gfx_l4ls_clkdm) {
+		pr_err("PM: Cannot lookup gfx_l4ls_clkdm clockdomains\n");
 		return -ENODEV;
 	}
 
@@ -415,11 +410,7 @@ static int am43xx_suspend_init(void)
 
 static void am33xx_pre_suspend(unsigned int state)
 {
-	if (state == PM_SUSPEND_STANDBY) {
-		clkdm_wakeup(l3s_clkdm);
-		clkdm_wakeup(l4fw_clkdm);
-		clkdm_wakeup(clk_24mhz_clkdm);
-	}
+	return;
 }
 
 static void am43xx_pre_suspend(unsigned int state)
-- 
1.7.5.4

