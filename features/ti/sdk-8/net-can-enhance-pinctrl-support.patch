From a635624c87b13911f76e623b9e220a0328644d40 Mon Sep 17 00:00:00 2001
From: Dave Gerlach <d-gerlach@ti.com>
Date: Mon, 11 Aug 2014 16:45:03 -0500
Subject: [PATCH 1036/1587] net: can: enhance pinctrl support

Update c_can_platform driver to set the state of the pins to:
- "sleep" on suspend
- "default" on resume

By optionally putting the pins into default/sleep state in the
suspend callback we can accomplish two things.
- minimize current leakage from pins and thus save power,
- prevent the IP from driving pins output in an uncontrolled manner,
   which may happen if the power domain drops the domain regulator.

Signed-off-by: Dave Gerlach <d-gerlach@ti.com>
Signed-off-by: Sekhar Nori <nsekhar@ti.com>
[zou: Original patch taken from
ti-sdk-am335x-evm-08.00.00.00-Linux-x86-Install.bin]
Signed-off-by: Cao Zou <cao.zou@windriver.com>
---
 drivers/net/can/c_can/c_can_platform.c |    4 ++++
 1 files changed, 4 insertions(+), 0 deletions(-)

diff --git a/drivers/net/can/c_can/c_can_platform.c b/drivers/net/can/c_can/c_can_platform.c
index 902fe20..fdc222d 100644
--- a/drivers/net/can/c_can/c_can_platform.c
+++ b/drivers/net/can/c_can/c_can_platform.c
@@ -357,6 +357,8 @@ static int c_can_suspend(struct platform_device *pdev, pm_message_t state)
 
 	priv->can.state = CAN_STATE_SLEEPING;
 
+	pinctrl_pm_select_sleep_state(&pdev->dev);
+
 	return 0;
 }
 
@@ -371,6 +373,8 @@ static int c_can_resume(struct platform_device *pdev)
 		return 0;
 	}
 
+	pinctrl_pm_select_default_state(&pdev->dev);
+
 	ret = c_can_power_up(ndev);
 	if (ret) {
 		netdev_err(ndev, "Still in power down mode\n");
-- 
1.7.5.4

