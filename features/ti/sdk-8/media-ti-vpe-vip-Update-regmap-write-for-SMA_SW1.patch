From d420a527546f0789bbe644733cc4df78f8aadb7d Mon Sep 17 00:00:00 2001
From: Nikhil Devshatwar <nikhil.nd@ti.com>
Date: Tue, 9 Dec 2014 18:50:07 +0000
Subject: [PATCH 1572/1587] media: ti-vpe: vip: Update regmap write for
 SMA_SW1

The syscon property specifies the base address of the control module block.
Parse the correct propery from device tree.
Update the regmap write to add the offset for SMA_SW1

Signed-off-by: Nikhil Devshatwar <nikhil.nd@ti.com>
Signed-off-by: Jyri Sarha <jsarha@ti.com>
[zou: Original patch taken from
ti-sdk-am335x-evm-08.00.00.00-Linux-x86-Install.bin]
Signed-off-by: Cao Zou <cao.zou@windriver.com>
---
 drivers/media/platform/ti-vpe/vip.c |    5 +++--
 1 files changed, 3 insertions(+), 2 deletions(-)

diff --git a/drivers/media/platform/ti-vpe/vip.c b/drivers/media/platform/ti-vpe/vip.c
index 3382cef..68c0591 100644
--- a/drivers/media/platform/ti-vpe/vip.c
+++ b/drivers/media/platform/ti-vpe/vip.c
@@ -75,6 +75,7 @@ MODULE_PARM_DESC(debug, "debug level (0-8)");
 #define vip_info(dev, fmt, arg...)	\
 		v4l2_info(&dev->v4l2_dev, fmt, ##arg)
 
+#define CTRL_CORE_SMA_SW_1      0x534
 /*
  * The srce_info structure contains per-srce data.
  */
@@ -542,7 +543,7 @@ static void vip_set_pclk_polarity(struct vip_port *port, int polarity)
 			BUG();
 
 		ret = regmap_update_bits(port->dev->syscon,
-			0, 1 << offset, 1 << offset);
+			CTRL_CORE_SMA_SW_1, 1 << offset, 1 << offset);
 	}
 
 	if (port->port_id == 0 && port->dev->slice_id == VIP_SLICE1) {
@@ -2558,7 +2559,7 @@ static int vip_of_probe(struct platform_device *pdev, struct vip_dev *dev)
 
 	parent = pdev->dev.of_node;
 
-	syscon_np = of_parse_phandle(pdev->dev.of_node, "syscon-smasw", 0);
+	syscon_np = of_parse_phandle(pdev->dev.of_node, "syscon", 0);
 	dev->syscon = syscon_node_to_regmap(syscon_np);
 	of_node_put(syscon_np);
 
-- 
1.7.5.4

