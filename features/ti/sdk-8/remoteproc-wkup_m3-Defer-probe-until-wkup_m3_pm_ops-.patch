From 42746ebcecc959e4c424d55d4f870880f1d8ce85 Mon Sep 17 00:00:00 2001
From: "J, KEERTHY" <j-keerthy@ti.com>
Date: Wed, 3 Dec 2014 10:55:27 +0000
Subject: [PATCH 1559/1587] remoteproc: wkup_m3: Defer probe until
 wkup_m3_pm_ops are populated

Defer probe till remowkup_m3_pm_ops are populated. This is to ensure
that wkup_m3 is probed after the wkup_m3_pm_ops are populated by the
mach-omap2 init call. This ensures clean initialization of m3.

Signed-off-by: Keerthy <j-keerthy@ti.com>
Acked-by: Dave Gerlach <d-gerlach@ti.com>
[zou: Original patch taken from
ti-sdk-am335x-evm-08.00.00.00-Linux-x86-Install.bin]
Signed-off-by: Cao Zou <cao.zou@windriver.com>
---
 drivers/remoteproc/wkup_m3_rproc.c |    3 +++
 1 files changed, 3 insertions(+), 0 deletions(-)

diff --git a/drivers/remoteproc/wkup_m3_rproc.c b/drivers/remoteproc/wkup_m3_rproc.c
index ed39a79..3ae0b21 100644
--- a/drivers/remoteproc/wkup_m3_rproc.c
+++ b/drivers/remoteproc/wkup_m3_rproc.c
@@ -389,6 +389,9 @@ static int wkup_m3_rproc_probe(struct platform_device *pdev)
 	struct resource *res;
 	struct task_struct *task;
 
+	if (!wkup_m3_pm_ops)
+		return -EPROBE_DEFER;
+
 	pm_runtime_enable(&pdev->dev);
 
 	ret = pm_runtime_get_sync(&pdev->dev);
-- 
1.7.5.4

