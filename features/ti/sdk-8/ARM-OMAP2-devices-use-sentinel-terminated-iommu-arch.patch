From 30f198ede642ff4696d892216f6d73280f94eed0 Mon Sep 17 00:00:00 2001
From: Suman Anna <s-anna@ti.com>
Date: Thu, 6 Mar 2014 18:10:07 -0600
Subject: [PATCH 1006/1587] ARM: OMAP2+: devices: use sentinel terminated
 iommu archdata for ISP

A client user of an IOMMU is tied to use a single IOMMU at the moment,
and both of them are bound together through the client user device's
archdata field. The archdata field is expected to be defined as a
single element currently.

Update the OMAP3 ISP device to use a sentinel terminated iommu archdata
array. This sentinel form allows the OMAP IOMMU driver core to be adapted
to recognize multiple IOMMUs without having to change the iommu archdata
structure. OMAP3 ISP will still use only one MMU device, but this form
allows the OMAP3 ISP driver to work properly both before and after the
OMAP IOMMU driver is enhanced to program multiple IOMMUs together.

Signed-off-by: Suman Anna <s-anna@ti.com>
[zou: Original patch taken from
ti-sdk-am335x-evm-08.00.00.00-Linux-x86-Install.bin]
Signed-off-by: Cao Zou <cao.zou@windriver.com>
---
 arch/arm/mach-omap2/devices.c |    9 +++++----
 1 files changed, 5 insertions(+), 4 deletions(-)

diff --git a/arch/arm/mach-omap2/devices.c b/arch/arm/mach-omap2/devices.c
index 4114bd7..c43e886f 100644
--- a/arch/arm/mach-omap2/devices.c
+++ b/arch/arm/mach-omap2/devices.c
@@ -223,17 +223,18 @@ static struct platform_device omap3isp_device = {
 	.resource	= omap3isp_resources,
 };
 
-static struct omap_iommu_arch_data omap3_isp_iommu = {
-	.name = "mmu_isp",
+static struct omap_iommu_arch_data omap3_isp_iommu[] = {
+	{ .name = "mmu_isp", },
+	{ .name = NULL, },
 };
 
 int omap3_init_camera(struct isp_platform_data *pdata)
 {
 	if (of_have_populated_dt())
-		omap3_isp_iommu.name = "480bd400.mmu";
+		omap3_isp_iommu[0].name = "480bd400.mmu";
 
 	omap3isp_device.dev.platform_data = pdata;
-	omap3isp_device.dev.archdata.iommu = &omap3_isp_iommu;
+	omap3isp_device.dev.archdata.iommu = omap3_isp_iommu;
 
 	return platform_device_register(&omap3isp_device);
 }
-- 
1.7.5.4

