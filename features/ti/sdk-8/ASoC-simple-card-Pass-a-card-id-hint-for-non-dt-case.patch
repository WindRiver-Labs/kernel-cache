From b0884ce4d7bd87bf01d066b1ddff23413a3c5492 Mon Sep 17 00:00:00 2001
From: Misael Lopez Cruz <misael.lopez@ti.com>
Date: Fri, 7 Nov 2014 14:37:43 +0200
Subject: [PATCH] ASoC: simple-card: Pass a card id hint for non-dt case

The card id hint for the DT case is covered by ASoC core, so
id hint for the non-DT case has to be explicitly handled by
the simple card driver.

Signed-off-by: Misael Lopez Cruz <misael.lopez@ti.com>
[zou: Original patch taken from
ti-sdk-am335x-evm-08.00.00.00-Linux-x86-Install.bin]
Signed-off-by: Cao Zou <cao.zou@windriver.com>

diff --git a/include/sound/simple_card.h b/include/sound/simple_card.h
index 1dcaaf3259d6..a250a2718de0 100644
--- a/include/sound/simple_card.h
+++ b/include/sound/simple_card.h
@@ -29,6 +29,7 @@ struct asoc_simple_card_info {
 	const char *codec;
 	const char *platform;
 
+	int id_hint;
 	unsigned int daifmt;
 	struct asoc_simple_dai cpu_dai;
 	struct asoc_simple_dai codec_dai;
diff --git a/sound/soc/generic/simple-card.c b/sound/soc/generic/simple-card.c
index 6f92e6d794b1..91298bd2a179 100644
--- a/sound/soc/generic/simple-card.c
+++ b/sound/soc/generic/simple-card.c
@@ -14,6 +14,7 @@
 #include <linux/platform_device.h>
 #include <linux/string.h>
 #include <sound/simple_card.h>
+#include <sound/initval.h>
 
 static int __asoc_simple_card_dai_init(struct snd_soc_dai *dai,
 				       struct asoc_simple_dai *set,
@@ -275,6 +276,8 @@ static int asoc_simple_card_probe(struct platform_device *pdev)
 	    !(cinfo->cpu_dai.name	|| of_cpu)) {
 		dev_err(dev, "insufficient asoc_simple_card_info settings\n");
 		return -EINVAL;
+		priv->snd_card.id_hint	= (cinfo->id_hint >= 0) ?
+					cinfo->id_hint : SNDRV_DEFAULT_IDX1;
 	}
 
 	/*
-- 
2.1.0

