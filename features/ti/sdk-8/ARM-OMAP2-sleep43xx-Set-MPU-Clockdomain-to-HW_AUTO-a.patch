From 62018b0c05cae6f6e5801c50838dbd0294d6d7bd Mon Sep 17 00:00:00 2001
From: Dave Gerlach <d-gerlach@ti.com>
Date: Mon, 25 Aug 2014 18:18:38 -0500
Subject: [PATCH 1100/1587] ARM: OMAP2: sleep43xx: Set MPU Clockdomain to
 HW_AUTO after suspend

Configure MPU CLKSTCTRL to HW_AUTO so that cpuidle is able to
automatically gate the mpu clock during WFI for additional power
savings.

Signed-off-by: Dave Gerlach <d-gerlach@ti.com>
[zou: Original patch taken from
ti-sdk-am335x-evm-08.00.00.00-Linux-x86-Install.bin]
Signed-off-by: Cao Zou <cao.zou@windriver.com>
---
 arch/arm/mach-omap2/sleep43xx.S |    5 +++++
 1 files changed, 5 insertions(+), 0 deletions(-)

diff --git a/arch/arm/mach-omap2/sleep43xx.S b/arch/arm/mach-omap2/sleep43xx.S
index e4b122d..f1ed8e5 100644
--- a/arch/arm/mach-omap2/sleep43xx.S
+++ b/arch/arm/mach-omap2/sleep43xx.S
@@ -381,6 +381,11 @@ ENTRY(am43xx_resume_offset)
 	.word . - am43xx_do_wfi
 
 ENTRY(am43xx_resume_from_deep_sleep)
+	/* Set MPU CLKSTCTRL to HW AUTO so that CPUidle works properly */
+	ldr	r1, am43xx_virt_mpu_clkstctrl
+	mov	r2, #AM43XX_CM_CLKSTCTRL_CLKTRCTRL_HW_AUTO
+	str	r2, [r1]
+
 	/* For AM43xx, use EMIF power down until context is restored */
 	ldr	r2, am43xx_phys_emif_poweroff
 	mov	r1, #AM43XX_EMIF_POWEROFF_ENABLE
-- 
1.7.5.4

