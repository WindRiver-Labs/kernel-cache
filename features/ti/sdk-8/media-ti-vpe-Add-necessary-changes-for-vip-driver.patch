From 31ddb8870d4861d5f519a53dc7e1b70add1d0479 Mon Sep 17 00:00:00 2001
From: Benoit Parrot <bparrot@ti.com>
Date: Thu, 28 Aug 2014 03:40:16 +0000
Subject: [PATCH 1166/1587] media: ti-vpe: Add necessary changes for vip
 driver

Including breaking out vpdma helper library as its own module

Signed-off-by: Benoit Parrot <bparrot@ti.com>
Signed-off-by: Darren Etheridge <detheridge@ti.com>
[zou: Original patch taken from
ti-sdk-am335x-evm-08.00.00.00-Linux-x86-Install.bin]
Signed-off-by: Cao Zou <cao.zou@windriver.com>
---
 drivers/media/platform/Kconfig         |   21 +++++++++++++++++++++
 drivers/media/platform/ti-vpe/Makefile |    6 +++++-
 2 files changed, 26 insertions(+), 1 deletions(-)

diff --git a/drivers/media/platform/Kconfig b/drivers/media/platform/Kconfig
index 8d78354..f3e78e1 100644
--- a/drivers/media/platform/Kconfig
+++ b/drivers/media/platform/Kconfig
@@ -120,6 +120,16 @@ source "drivers/media/platform/exynos4-is/Kconfig"
 source "drivers/media/platform/s5p-tv/Kconfig"
 source "drivers/media/platform/ti-vpfe/Kconfig"
 
+config VIDEO_TI_VIP
+	tristate "TI Video Input Port"
+	default n
+	depends on VIDEO_DEV && VIDEO_V4L2 && SOC_DRA7XX
+	select VIDEO_TI_VPDMA_HELPER
+	---help---
+	Driver support for VIP module on certain TI SoC's
+	VIP = Video Input Port.
+
+
 endif # V4L_PLATFORM_DRIVERS
 
 menuconfig V4L_MEM2MEM_DRIVERS
@@ -221,6 +231,7 @@ config VIDEO_TI_VPE
 	depends on VIDEO_DEV && VIDEO_V4L2 && SOC_DRA7XX
 	select VIDEOBUF2_DMA_CONTIG
 	select V4L2_MEM2MEM_DEV
+	select VIDEO_TI_VPDMA_HELPER
 	default n
 	---help---
 	  Support for the TI VPE(Video Processing Engine) block
@@ -234,6 +245,16 @@ config VIDEO_TI_VPE_DEBUG
 
 endif # V4L_MEM2MEM_DRIVERS
 
+config VIDEO_TI_VPDMA_HELPER
+       tristate "TI VPDMA helper module"
+       depends on VIDEO_TI_VIP || VIDEO_TI_VPE
+       default n
+       ---help---
+       Video Port Direct Memory Access
+       Used with VIP and VPE on some TI SoC's (e.g. DRA7xx)
+       it provides a mem2mem, mem2device, device2mem DMA specifically
+       for transfering and manipulating video data.
+
 menuconfig V4L_TEST_DRIVERS
 	bool "Media test drivers"
 	depends on MEDIA_CAMERA_SUPPORT
diff --git a/drivers/media/platform/ti-vpe/Makefile b/drivers/media/platform/ti-vpe/Makefile
index be680f8..98d8e63 100644
--- a/drivers/media/platform/ti-vpe/Makefile
+++ b/drivers/media/platform/ti-vpe/Makefile
@@ -1,5 +1,9 @@
 obj-$(CONFIG_VIDEO_TI_VPE) += ti-vpe.o
+obj-$(CONFIG_VIDEO_TI_VIP) += ti-vip.o
+obj-$(CONFIG_VIDEO_TI_VPDMA_HELPER) += ti-vpdma.o
 
-ti-vpe-y := vpe.o sc.o csc.o vpdma.o
+ti-vpe-y := vpe.o sc.o csc.o
+ti-vip-y := vip.o
+ti-vpdma-y := vpdma.o
 
 ccflags-$(CONFIG_VIDEO_TI_VPE_DEBUG) += -DDEBUG
-- 
1.7.5.4

