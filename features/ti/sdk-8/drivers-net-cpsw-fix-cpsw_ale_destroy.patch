From 9c86d224f5ae54934505975d9c67436ce4319a48 Mon Sep 17 00:00:00 2001
From: Subramaniam Chanderashekarapuram <subramaniam.ca@ti.com>
Date: Mon, 17 Nov 2014 11:50:14 +0530
Subject: [PATCH 1370/1587] drivers: net: cpsw: fix cpsw_ale_destroy

When cpsw is used as a module, and the ethernet device is
not opened (for eg: dhcpcd is not running yet),
there is a deadlock if the module is unloaded (delete
the timer). This is because the destory function tries
to delete a timer thats not initialized. The timer is
stopped in cpsw_ndo_stop, and hence cpsw_ale_stop need
not be called in destroy.

Signed-off-by: Subramaniam Chanderashekarapuram <subramaniam.ca@ti.com>
Reviewed-by: Mugunthan V N <mugunthanvnm@ti.com>
Signed-off-by: Sekhar Nori <nsekhar@ti.com>
[zou: Original patch taken from
ti-sdk-am335x-evm-08.00.00.00-Linux-x86-Install.bin]
Signed-off-by: Cao Zou <cao.zou@windriver.com>
---
 drivers/net/ethernet/ti/cpsw_ale.c |    1 -
 1 files changed, 0 insertions(+), 1 deletions(-)

diff --git a/drivers/net/ethernet/ti/cpsw_ale.c b/drivers/net/ethernet/ti/cpsw_ale.c
index 0579b22..5338f85 100644
--- a/drivers/net/ethernet/ti/cpsw_ale.c
+++ b/drivers/net/ethernet/ti/cpsw_ale.c
@@ -756,7 +756,6 @@ int cpsw_ale_destroy(struct cpsw_ale *ale)
 {
 	if (!ale)
 		return -EINVAL;
-	cpsw_ale_stop(ale);
 	cpsw_ale_control_set(ale, 0, ALE_ENABLE, 0);
 	kfree(ale);
 	return 0;
-- 
1.7.5.4

