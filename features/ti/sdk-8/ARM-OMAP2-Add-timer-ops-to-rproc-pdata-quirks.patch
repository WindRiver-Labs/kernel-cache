From b3c1d90aa5794e2b6bac4b9d909b5d80db5ca8ac Mon Sep 17 00:00:00 2001
From: Suman Anna <s-anna@ti.com>
Date: Mon, 4 Aug 2014 15:43:46 -0500
Subject: [PATCH 1057/1587] ARM: OMAP2+: Add timer ops to rproc pdata quirks

The OMAP remoteproc driver needs DMTimers to provide advanced
device management features, such as clock auto-gating to the
processor subsystem or remote processor suspend/resume.

The OMAP DMTimer API is limited to only the OMAP machine layers
in arch/arm/, so any DMTimer API needed by the OMAP remoteproc
driver should have to be accessed through some OMAP rproc specific
platform ops. Add the required timer ops to both the IPU and DSP
platform data through pdata quirks.

Signed-off-by: Suman Anna <s-anna@ti.com>
[zou: Original patch taken from
ti-sdk-am335x-evm-08.00.00.00-Linux-x86-Install.bin]
Signed-off-by: Cao Zou <cao.zou@windriver.com>
---
 arch/arm/mach-omap2/pdata-quirks.c |    9 +++++++++
 1 files changed, 9 insertions(+), 0 deletions(-)

diff --git a/arch/arm/mach-omap2/pdata-quirks.c b/arch/arm/mach-omap2/pdata-quirks.c
index 1c8a38c..8514953 100644
--- a/arch/arm/mach-omap2/pdata-quirks.c
+++ b/arch/arm/mach-omap2/pdata-quirks.c
@@ -213,15 +213,24 @@ static void __init omap4_panda_legacy_init(void)
 	legacy_init_wl12xx(WL12XX_REFCLOCK_38, 0, 53);
 }
 
+static struct omap_rproc_timer_ops omap_rproc_dmtimer_ops = {
+	.request_timer = omap_rproc_request_timer,
+	.release_timer = omap_rproc_release_timer,
+	.start_timer = omap_rproc_start_timer,
+	.stop_timer = omap_rproc_stop_timer,
+};
+
 static struct omap_rproc_pdata omap4_ipu_pdata = {
 	.device_enable = omap_rproc_device_enable,
 	.device_shutdown = omap_rproc_device_shutdown,
+	.timer_ops = &omap_rproc_dmtimer_ops,
 };
 
 static struct omap_rproc_pdata omap4_dsp_pdata = {
 	.device_enable = omap_rproc_device_enable,
 	.device_shutdown = omap_rproc_device_shutdown,
 	.set_bootaddr = omap_ctrl_write_dsp_boot_addr,
+	.timer_ops = &omap_rproc_dmtimer_ops,
 };
 #endif
 
-- 
1.7.5.4

