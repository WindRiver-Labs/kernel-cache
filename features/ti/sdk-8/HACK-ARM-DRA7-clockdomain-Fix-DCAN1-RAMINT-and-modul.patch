From 5df5c547ef8820208838e67930fa9e175db14ac9 Mon Sep 17 00:00:00 2001
From: Roger Quadros <rogerq@ti.com>
Date: Fri, 14 Nov 2014 19:04:56 +0200
Subject: [PATCH 1394/1587] HACK: ARM: DRA7: clockdomain: Fix DCAN1 RAMINT and
 module OFF

Disable HW_AUTO for L4CFG and WKUPAON clockdomains.
Without this the DCAN1 RAMINIT.DONE bit never gets set after the
RAMINIT start sequence.

This also fixes DCAN1 module being stuck in transition.

Signed-off-by: Roger Quadros <rogerq@ti.com>
[zou: Original patch taken from
ti-sdk-am335x-evm-08.00.00.00-Linux-x86-Install.bin]
Signed-off-by: Cao Zou <cao.zou@windriver.com>
---
 arch/arm/mach-omap2/clockdomains7xx_data.c |    4 ++--
 1 files changed, 2 insertions(+), 2 deletions(-)

diff --git a/arch/arm/mach-omap2/clockdomains7xx_data.c b/arch/arm/mach-omap2/clockdomains7xx_data.c
index bc9905c..6e571fb 100644
--- a/arch/arm/mach-omap2/clockdomains7xx_data.c
+++ b/arch/arm/mach-omap2/clockdomains7xx_data.c
@@ -492,7 +492,7 @@ static struct clockdomain l4cfg_7xx_clkdm = {
 	.cm_inst	  = DRA7XX_CM_CORE_CORE_INST,
 	.clkdm_offs	  = DRA7XX_CM_CORE_CORE_L4CFG_CDOFFS,
 	.dep_bit	  = DRA7XX_L4CFG_STATDEP_SHIFT,
-	.flags		  = CLKDM_CAN_HWSUP,
+	.flags		  = CLKDM_CAN_DISABLE_AUTO,
 };
 
 static struct clockdomain dma_7xx_clkdm = {
@@ -677,7 +677,7 @@ static struct clockdomain wkupaon_7xx_clkdm = {
 	.cm_inst	  = DRA7XX_PRM_WKUPAON_CM_INST,
 	.clkdm_offs	  = DRA7XX_PRM_WKUPAON_CM_WKUPAON_CDOFFS,
 	.dep_bit	  = DRA7XX_WKUPAON_STATDEP_SHIFT,
-	.flags		  = CLKDM_CAN_FORCE_WAKEUP | CLKDM_CAN_HWSUP,
+	.flags		  = CLKDM_CAN_FORCE_WAKEUP | CLKDM_CAN_DISABLE_AUTO,
 };
 
 static struct clockdomain eve1_7xx_clkdm = {
-- 
1.7.5.4

