From 92251f5b53a856ffc5f00b7f8b9b010dfe920282 Mon Sep 17 00:00:00 2001
From: Jyri Sarha <jsarha@ti.com>
Date: Fri, 5 Dec 2014 15:59:52 +0200
Subject: [PATCH 1476/1587] Revert "v4l: ti-vpe: vip: fix vip_set_clock_enable
 for multi slice"

This reverts commit 57f0db1e3e6e58f8e5430711270bf3754ba7e904.

Signed-off-by: Jyri Sarha <jsarha@ti.com>
[zou: Original patch taken from
ti-sdk-am335x-evm-08.00.00.00-Linux-x86-Install.bin]
Signed-off-by: Cao Zou <cao.zou@windriver.com>
---
 drivers/media/platform/ti-vpe/vip.c |   18 ++++--------------
 1 files changed, 4 insertions(+), 14 deletions(-)

diff --git a/drivers/media/platform/ti-vpe/vip.c b/drivers/media/platform/ti-vpe/vip.c
index e966d2e..44d1cca 100644
--- a/drivers/media/platform/ti-vpe/vip.c
+++ b/drivers/media/platform/ti-vpe/vip.c
@@ -365,23 +365,13 @@ static void vip_set_clock_enable(struct vip_dev *dev, bool on)
 {
 	u32 val = 0;
 
-	val = read_vreg(dev, VIP_CLK_ENABLE);
 	if (on) {
-		val |= VIP_VPDMA_CLK_ENABLE;
 		if (dev->slice_id == VIP_SLICE1)
-			val |= VIP_VIP1_DATA_PATH_CLK_ENABLE;
+			val = VIP_VIP1_DATA_PATH_CLK_ENABLE |
+				VIP_VPDMA_CLK_ENABLE;
 		else
-			val |= VIP_VIP2_DATA_PATH_CLK_ENABLE;
-	} else {
-		if (dev->slice_id == VIP_SLICE1)
-			val &= ~VIP_VIP1_DATA_PATH_CLK_ENABLE;
-		else
-			val &= ~VIP_VIP2_DATA_PATH_CLK_ENABLE;
-
-		/* Both VIP are disabled then shutdown VPDMA also */
-		if (!(val & (VIP_VIP1_DATA_PATH_CLK_ENABLE|
-			     VIP_VIP2_DATA_PATH_CLK_ENABLE)))
-			val = 0;
+			val = VIP_VIP2_DATA_PATH_CLK_ENABLE |
+				VIP_VPDMA_CLK_ENABLE;
 	}
 
 	write_vreg(dev, VIP_CLK_ENABLE, val);
-- 
1.7.5.4

