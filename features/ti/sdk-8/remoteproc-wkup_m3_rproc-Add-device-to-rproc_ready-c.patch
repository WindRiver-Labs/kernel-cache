From d92a8e3feb9631a1b68a9afce3cc964121c8cb68 Mon Sep 17 00:00:00 2001
From: Dave Gerlach <d-gerlach@ti.com>
Date: Thu, 28 Aug 2014 14:18:50 -0500
Subject: [PATCH 1105/1587] remoteproc: wkup_m3_rproc: Add device to
 rproc_ready callback

Pass wkup_m3 device to the rproc_ready callback so that the driver user
can have a reference to the wkup_m3.

Signed-off-by: Dave Gerlach <d-gerlach@ti.com>
[zou: Original patch taken from
ti-sdk-am335x-evm-08.00.00.00-Linux-x86-Install.bin]
Signed-off-by: Cao Zou <cao.zou@windriver.com>
---
 arch/arm/mach-omap2/pm33xx.c       |    2 +-
 drivers/remoteproc/wkup_m3_rproc.c |    4 ++--
 include/linux/wkup_m3.h            |    2 +-
 3 files changed, 4 insertions(+), 4 deletions(-)

diff --git a/arch/arm/mach-omap2/pm33xx.c b/arch/arm/mach-omap2/pm33xx.c
index e250e19..9171a80 100644
--- a/arch/arm/mach-omap2/pm33xx.c
+++ b/arch/arm/mach-omap2/pm33xx.c
@@ -405,7 +405,7 @@ static void am33xx_txev_handler(void)
 	}
 }
 
-static void am33xx_m3_ready_cb(void)
+static void am33xx_m3_ready_cb(struct device *m3_dev)
 {
 	am33xx_pm->ver = wkup_m3_fw_version_read();
 
diff --git a/drivers/remoteproc/wkup_m3_rproc.c b/drivers/remoteproc/wkup_m3_rproc.c
index 81da3a5..8cf3999 100644
--- a/drivers/remoteproc/wkup_m3_rproc.c
+++ b/drivers/remoteproc/wkup_m3_rproc.c
@@ -193,7 +193,7 @@ static int wkup_m3_rproc_start(struct rproc *rproc)
 
 	if (wkup_m3_pm_ops && wkup_m3_pm_ops->rproc_ready &&
 	    !m3_rproc_static->is_rtc_only)
-		wkup_m3_pm_ops->rproc_ready();
+		wkup_m3_pm_ops->rproc_ready(&m3_rproc_static->pdev->dev);
 
 	m3_rproc_static->is_active = 1;
 
@@ -256,7 +256,7 @@ void wkup_m3_set_ops(struct wkup_m3_ops *ops)
 
 	if (m3_rproc_static && m3_rproc_static->is_active &&
 	    wkup_m3_pm_ops && wkup_m3_pm_ops->rproc_ready)
-		wkup_m3_pm_ops->rproc_ready();
+		wkup_m3_pm_ops->rproc_ready(&m3_rproc_static->pdev->dev);
 }
 
 /**
diff --git a/include/linux/wkup_m3.h b/include/linux/wkup_m3.h
index 48a7fcc..eca9e62 100644
--- a/include/linux/wkup_m3.h
+++ b/include/linux/wkup_m3.h
@@ -29,7 +29,7 @@
 
 struct wkup_m3_ops {
 	void (*txev_handler)(void);
-	void (*rproc_ready)(void);
+	void (*rproc_ready)(struct device *dev);
 };
 
 struct wkup_m3_wakeup_src {
-- 
1.7.5.4

