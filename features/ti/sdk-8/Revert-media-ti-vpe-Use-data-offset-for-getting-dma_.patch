From 8edd2a55db8c3351add81afa1841fc5dd813c1df Mon Sep 17 00:00:00 2001
From: Jyri Sarha <jsarha@ti.com>
Date: Fri, 5 Dec 2014 16:00:22 +0200
Subject: [PATCH 1492/1587] Revert "media: ti-vpe: Use data offset for getting
 dma_addr for a plane"

This reverts commit 4de2fc769ab57e766f75249568ddd8da07dd69f4.

Signed-off-by: Jyri Sarha <jsarha@ti.com>
[zou: Original patch taken from
ti-sdk-am335x-evm-08.00.00.00-Linux-x86-Install.bin]
Signed-off-by: Cao Zou <cao.zou@windriver.com>
---
 drivers/media/platform/ti-vpe/vpe.c |   12 ++----------
 1 files changed, 2 insertions(+), 10 deletions(-)

diff --git a/drivers/media/platform/ti-vpe/vpe.c b/drivers/media/platform/ti-vpe/vpe.c
index e59eb81..0ae19ee 100644
--- a/drivers/media/platform/ti-vpe/vpe.c
+++ b/drivers/media/platform/ti-vpe/vpe.c
@@ -495,14 +495,6 @@ struct vpe_mmr_adb {
 
 #define VPE_SET_MMR_ADB_HDR(ctx, hdr, regs, offset_a)	\
 	VPDMA_SET_MMR_ADB_HDR(ctx->mmr_adb, vpe_mmr_adb, hdr, regs, offset_a)
-
-static inline dma_addr_t vb2_dma_addr_plus_data_offset(struct vb2_buffer *vb,
-	unsigned int plane_no)
-{
-	return vb2_dma_contig_plane_dma_addr(vb, plane_no) +
-		vb->v4l2_planes[plane_no].data_offset;
-}
-
 /*
  * Set the headers for all of the address/data block structures.
  */
@@ -1010,7 +1002,7 @@ static void add_out_dtd(struct vpe_ctx *ctx, int port)
 		int plane = fmt->coplanar ? p_data->vb_part : 0;
 
 		vpdma_fmt = fmt->vpdma_fmt[plane];
-		dma_addr = vb2_dma_addr_plus_data_offset(vb, plane);
+		dma_addr = vb2_dma_contig_plane_dma_addr(vb, plane);
 		if (!dma_addr) {
 			vpe_err(ctx->dev,
 				"acquiring output buffer(%d) dma_addr failed\n",
@@ -1050,7 +1042,7 @@ static void add_in_dtd(struct vpe_ctx *ctx, int port)
 
 		vpdma_fmt = fmt->vpdma_fmt[plane];
 
-		dma_addr = vb2_dma_addr_plus_data_offset(vb, plane);
+		dma_addr = vb2_dma_contig_plane_dma_addr(vb, plane);
 		if (!dma_addr) {
 			vpe_err(ctx->dev,
 				"acquiring input buffer(%d) dma_addr failed\n",
-- 
1.7.5.4

