From 3df67dc637627913f3794a3827564a2a6aaaaf04 Mon Sep 17 00:00:00 2001
From: Dave Gerlach <d-gerlach@ti.com>
Date: Tue, 8 Jul 2014 02:07:16 +0000
Subject: [PATCH 0789/1587] PM / Voltagedomain: core: Do not skip registration
 if regulator is found

Currently voltage domain core will not register a notifier with a
regulator obtained through regulator_get_optional in voltdm_get
because any value besides -EPROBE_DEFER causes registration to be
skipped, including the success return value of 0. Change so that
both 0 or -EPROBE_DEFER are acceptable return values from
regulator_get_optional for registering a voltage notifier.

Signed-off-by: Dave Gerlach <d-gerlach@ti.com>
Acked-by: Nishanth Menon <nm@ti.com>
[zou: Original patch taken from
ti-sdk-am335x-evm-08.00.00.00-Linux-x86-Install.bin]
Signed-off-by: Cao Zou <cao.zou@windriver.com>
---
 drivers/power/voltdm/core.c |    2 +-
 1 files changed, 1 insertions(+), 1 deletions(-)

diff --git a/drivers/power/voltdm/core.c b/drivers/power/voltdm/core.c
index 332d02b..c7b176e 100644
--- a/drivers/power/voltdm/core.c
+++ b/drivers/power/voltdm/core.c
@@ -182,7 +182,7 @@ static int voltdm_get(struct voltdm_scale_data *vsd, struct device_node *np,
 		if (IS_ERR(vsd->reg))
 			ret = PTR_ERR(vsd->reg);
 		/* Regulator is not mandatory */
-		if (ret != -EPROBE_DEFER) {
+		if (ret && ret != -EPROBE_DEFER) {
 			ret = 0;
 			*skip_reg = true;
 			dev_dbg(dev, "%s: Failed to get %s regulator:%d\n",
-- 
1.7.5.4

