From 47ff2e6f73428658f4243b65737106c6706e16bc Mon Sep 17 00:00:00 2001
From: Nikhil Devshatwar <nikhil.nd@ti.com>
Date: Thu, 28 Aug 2014 03:40:11 +0000
Subject: [PATCH 1163/1587] v4l: of: New property to specify number of
 channels

For time multiplexed video signal, number of channels multiplexed
is specified by adding a new property 'num-channels' to the endpoint

Signed-off-by: Nikhil Devshatwar <nikhil.nd@ti.com>
Signed-off-by: Benoit Parrot <bparrot@ti.com>
Signed-off-by: Darren Etheridge <detheridge@ti.com>
[zou: Original patch taken from
ti-sdk-am335x-evm-08.00.00.00-Linux-x86-Install.bin]
Signed-off-by: Cao Zou <cao.zou@windriver.com>
---
 .../devicetree/bindings/media/video-interfaces.txt |    2 ++
 drivers/media/v4l2-core/v4l2-of.c                  |    3 +++
 include/media/v4l2-of.h                            |    1 +
 3 files changed, 6 insertions(+), 0 deletions(-)

diff --git a/Documentation/devicetree/bindings/media/video-interfaces.txt b/Documentation/devicetree/bindings/media/video-interfaces.txt
index ce719f8..3810fc7 100644
--- a/Documentation/devicetree/bindings/media/video-interfaces.txt
+++ b/Documentation/devicetree/bindings/media/video-interfaces.txt
@@ -86,6 +86,8 @@ Optional endpoint properties
   synchronization may be required, where supported.
 - data-active: similar to HSYNC and VSYNC, specifies data line polarity.
 - field-even-active: field signal level during the even field data transmission.
+- num-channels: for time multiplexed multi channel video signal, this property
+  specifies number of channels multiplexed.
 - pclk-sample: sample data on rising (1) or falling (0) edge of the pixel clock
   signal.
 - sync-on-green-active: active state of Sync-on-green (SoG) signal, 0/1 for
diff --git a/drivers/media/v4l2-core/v4l2-of.c b/drivers/media/v4l2-core/v4l2-of.c
index b4ed9a9..9e20cb9 100644
--- a/drivers/media/v4l2-core/v4l2-of.c
+++ b/drivers/media/v4l2-core/v4l2-of.c
@@ -104,6 +104,9 @@ static void v4l2_of_parse_parallel_bus(const struct device_node *node,
 		flags |= v ? V4L2_MBUS_VIDEO_SOG_ACTIVE_HIGH :
 			V4L2_MBUS_VIDEO_SOG_ACTIVE_LOW;
 
+	if (!of_property_read_u32(node, "num-channels", &v))
+		bus->num_channels = v;
+
 	bus->flags = flags;
 
 }
diff --git a/include/media/v4l2-of.h b/include/media/v4l2-of.h
index 70fa7b7..8794378 100644
--- a/include/media/v4l2-of.h
+++ b/include/media/v4l2-of.h
@@ -47,6 +47,7 @@ struct v4l2_of_bus_parallel {
 	unsigned int flags;
 	unsigned char bus_width;
 	unsigned char data_shift;
+	unsigned int num_channels;
 };
 
 /**
-- 
1.7.5.4

