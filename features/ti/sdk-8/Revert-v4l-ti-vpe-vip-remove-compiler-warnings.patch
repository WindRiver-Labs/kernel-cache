From 8f2b0a70699902a80c5d6f3adbf4d5699bf9c5b3 Mon Sep 17 00:00:00 2001
From: Jyri Sarha <jsarha@ti.com>
Date: Fri, 5 Dec 2014 15:59:55 +0200
Subject: [PATCH 1478/1587] Revert "v4l: ti-vpe: vip: remove compiler
 warnings"

This reverts commit 3d9309aca4206d584a00a03735b56bb2b3cdcca7.

Signed-off-by: Jyri Sarha <jsarha@ti.com>
[zou: Original patch taken from
ti-sdk-am335x-evm-08.00.00.00-Linux-x86-Install.bin]
Signed-off-by: Cao Zou <cao.zou@windriver.com>
---
 drivers/media/platform/ti-vpe/vip.c |   24 ++++++++++++++++++------
 drivers/media/platform/ti-vpe/vip.h |    6 +++---
 2 files changed, 21 insertions(+), 9 deletions(-)

diff --git a/drivers/media/platform/ti-vpe/vip.c b/drivers/media/platform/ti-vpe/vip.c
index 44d1cca..dc519f8 100644
--- a/drivers/media/platform/ti-vpe/vip.c
+++ b/drivers/media/platform/ti-vpe/vip.c
@@ -2,11 +2,11 @@
  * TI VIP capture driver
  *
  * Copyright (C) 2013 - 2014 Texas Instruments, Inc.
- * David Griego, <dagriego@biglakesoftware.com>
- * Dale Farnsworth, <dale@farnsworth.org>
- * Nikhil Devshatwar, <nikhil.nd@ti.com>
  * Benoit Parrot, <bparrot@ti.com>
  *
+ * Based on original work by Dale Farnsworth.
+ * Dale Farnsworth, <dale@farnsworth.org>
+ *
  * This program is free software; you can redistribute it and/or modify
  * it under the terms of the GNU General Public License version 2 as
  * published by the Free Software Foundation.
@@ -932,6 +932,21 @@ static void vip_set_slice_path(struct vip_dev *dev,
 	}
 }
 
+/* This are unused function for now.
+ * Just declare them to quiet down the compiler.
+ */
+struct dfn_holder {
+	void (*reset_port)(struct vip_port *port);
+	void (*xtra_set_repack_sel)(struct vip_port *port, int repack_mode);
+	void (*set_actvid_hsync_n)(struct vip_port *port, int enable);
+};
+
+static const struct dfn_holder s_dfn = {
+	.reset_port = vip_reset_port,
+	.xtra_set_repack_sel = vip_xtra_set_repack_sel,
+	.set_actvid_hsync_n = vip_set_actvid_hsync_n,
+};
+
 /*
  * Return the vip_stream structure for a given struct file
  */
@@ -1983,7 +1998,6 @@ static int vip_setup_parser(struct vip_port *port)
 	int sync_type;
 	unsigned int flags;
 
-	vip_reset_port(port);
 	vip_set_port_enable(port, 1);
 
 	if (endpoint->bus_type == V4L2_MBUS_BT656) {
@@ -2041,8 +2055,6 @@ static int vip_setup_parser(struct vip_port *port)
 			vip_set_pclk_polarity(port,
 				flags & V4L2_MBUS_PCLK_SAMPLE_RISING ? 1 : 0);
 
-		vip_xtra_set_repack_sel(port, 0);
-		vip_set_actvid_hsync_n(port, 0);
 		vip_set_actvid_polarity(port, 1);
 		vip_set_discrete_basic_mode(port);
 
diff --git a/drivers/media/platform/ti-vpe/vip.h b/drivers/media/platform/ti-vpe/vip.h
index ee610cb..711c11a 100644
--- a/drivers/media/platform/ti-vpe/vip.h
+++ b/drivers/media/platform/ti-vpe/vip.h
@@ -2,11 +2,11 @@
  * TI VIP capture driver
  *
  * Copyright (C) 2013 - 2014 Texas Instruments, Inc.
- * David Griego, <dagriego@biglakesoftware.com>
- * Dale Farnsworth, <dale@farnsworth.org>
- * Nikhil Devshatwar, <nikhil.nd@ti.com>
  * Benoit Parrot, <bparrot@ti.com>
  *
+ * Based on original work by Dale Farnsworth.
+ * Dale Farnsworth, <dale@farnsworth.org>
+ *
  * This program is free software; you can redistribute it and/or modify
  * it under the terms of the GNU General Public License version 2 as
  * published by the Free Software Foundation.
-- 
1.7.5.4

