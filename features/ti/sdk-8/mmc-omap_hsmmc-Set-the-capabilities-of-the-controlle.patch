From 1d987a4ca79aac3c6b8640b05684f2a67f7a7806 Mon Sep 17 00:00:00 2001
From: Kishon Vijay Abraham I <kishon@ti.com>
Date: Fri, 5 Dec 2014 20:26:15 +0530
Subject: [PATCH 1519/1587] mmc: omap_hsmmc: Set the capabilities of the
 controller from dt properties

Set the controller capability to SDR12, SDR25, SDR50, SDR104, DDR50 and HS200
depending on the dt property.

Signed-off-by: Kishon Vijay Abraham I <kishon@ti.com>
Signed-off-by: Sekhar Nori <nsekhar@ti.com>
[zou: Original patch taken from
ti-sdk-am335x-evm-08.00.00.00-Linux-x86-Install.bin]
Signed-off-by: Cao Zou <cao.zou@windriver.com>
---
 drivers/mmc/host/omap_hsmmc.c |   15 +++++++++++++++
 1 files changed, 15 insertions(+), 0 deletions(-)

diff --git a/drivers/mmc/host/omap_hsmmc.c b/drivers/mmc/host/omap_hsmmc.c
index 4691593..1753c9d 100644
--- a/drivers/mmc/host/omap_hsmmc.c
+++ b/drivers/mmc/host/omap_hsmmc.c
@@ -1850,6 +1850,8 @@ static int omap_hsmmc_probe(struct platform_device *pdev)
 {
 	struct omap_mmc_platform_data *pdata = pdev->dev.platform_data;
 	struct mmc_host *mmc;
+	struct device *dev = &pdev->dev;
+	struct device_node *np = dev->of_node;
 	struct omap_hsmmc_host *host = NULL;
 	struct resource *res;
 	int ret, irq;
@@ -1981,6 +1983,19 @@ static int omap_hsmmc_probe(struct platform_device *pdev)
 
 	mmc->pm_caps = mmc_slot(host).pm_caps;
 
+	if (of_property_read_bool(np, "sd-uhs-sdr12"))
+		mmc->caps |= MMC_CAP_UHS_SDR12;
+	if (of_property_read_bool(np, "sd-uhs-sdr25"))
+		mmc->caps |= MMC_CAP_UHS_SDR25;
+	if (of_property_read_bool(np, "sd-uhs-sdr50"))
+		mmc->caps |= MMC_CAP_UHS_SDR50;
+	if (of_property_read_bool(np, "sd-uhs-sdr104"))
+		mmc->caps |= MMC_CAP_UHS_SDR104;
+	if (of_property_read_bool(np, "sd-uhs-ddr50"))
+		mmc->caps |= MMC_CAP_UHS_DDR50;
+	if (of_property_read_bool(np, "mmc-hs200-1_8v"))
+		mmc->caps2 |= MMC_CAP2_HS200_1_8V_SDR;
+
 	omap_hsmmc_conf_bus_power(host);
 
 	if (!pdev->dev.of_node) {
-- 
1.7.5.4

