From 25025b70a168fe0a49cfcbda22d9b25d0d8bd5d5 Mon Sep 17 00:00:00 2001
From: Jyri Sarha <jsarha@ti.com>
Date: Fri, 5 Dec 2014 16:00:20 +0200
Subject: [PATCH 1491/1587] Revert "media: ti-vpe: Use line average
 de-interlacing for first 2 frames"

This reverts commit 22198af3a0d3fca29d5005904c8ae3e87a8e23cd.

Signed-off-by: Jyri Sarha <jsarha@ti.com>
[zou: Original patch taken from
ti-sdk-am335x-evm-08.00.00.00-Linux-x86-Install.bin]
Signed-off-by: Cao Zou <cao.zou@windriver.com>
---
 drivers/media/platform/ti-vpe/vpe.c |   31 +------------------------------
 1 files changed, 1 insertions(+), 30 deletions(-)

diff --git a/drivers/media/platform/ti-vpe/vpe.c b/drivers/media/platform/ti-vpe/vpe.c
index 22d7c25..e59eb81 100644
--- a/drivers/media/platform/ti-vpe/vpe.c
+++ b/drivers/media/platform/ti-vpe/vpe.c
@@ -139,7 +139,7 @@ struct vpe_dei_regs {
  */
 static const struct vpe_dei_regs dei_regs = {
 	0x020C0804u,
-	0x0118100Cu,
+	0x0118100Fu,
 	0x08040200u,
 	0x1010100Cu,
 	0x10101010u,
@@ -806,23 +806,6 @@ static void set_dei_shadow_registers(struct vpe_ctx *ctx)
 	ctx->load_mmrs = true;
 }
 
-static void config_edi_input_mode(struct vpe_ctx *ctx, int mode)
-{
-	struct vpe_mmr_adb *mmr_adb = ctx->mmr_adb.addr;
-	u32 *edi_config_reg = &mmr_adb->dei_regs[3];
-
-	if (mode & 0x2)
-		write_field(edi_config_reg, 1, 1, 2);	/* EDI_ENABLE_3D */
-
-	if (mode & 0x3)
-		write_field(edi_config_reg, 1, 1, 3);	/* EDI_CHROMA_3D  */
-
-	write_field(edi_config_reg, mode, VPE_EDI_INP_MODE_MASK,
-		VPE_EDI_INP_MODE_SHIFT);
-
-	ctx->load_mmrs = true;
-}
-
 /*
  * Set the shadow registers whose values are modified when either the
  * source or destination format is changed.
@@ -1135,15 +1118,6 @@ static void device_run(void *priv)
 	ctx->dst_vb = v4l2_m2m_dst_buf_remove(ctx->m2m_ctx);
 	WARN_ON(ctx->dst_vb == NULL);
 
-	if (ctx->deinterlacing) {
-		/*
-		 * we have output the first 2 frames through line average, we
-		 * now switch to EDI de-interlacer
-		 */
-		if (ctx->sequence == 2)
-			config_edi_input_mode(ctx, 0x3); /* EDI (Y + UV) */
-	}
-
 	/* config descriptors */
 	if (ctx->dev->loaded_mmrs != ctx->mmr_adb.dma_addr || ctx->load_mmrs) {
 		vpdma_map_desc_buf(ctx->dev->vpdma, &ctx->mmr_adb);
@@ -1805,9 +1779,6 @@ static int vpe_streamon(struct file *file, void *priv, enum v4l2_buf_type type)
 {
 	struct vpe_ctx *ctx = file2ctx(file);
 
-	if (ctx->deinterlacing)
-		config_edi_input_mode(ctx, 0x0);
-
 	return v4l2_m2m_streamon(file, ctx->m2m_ctx, type);
 }
 
-- 
1.7.5.4

