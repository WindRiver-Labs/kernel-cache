From 7c78ceaf84f897a87ec3fdfe0add4c6eccf785e8 Mon Sep 17 00:00:00 2001
From: Dave Gerlach <d-gerlach@ti.com>
Date: Mon, 6 Oct 2014 16:47:18 -0500
Subject: [PATCH 1280/1587] ARM: OMAP2: sleep43xx: Access registers to avoid
 TLB miss

Access the three registers that we need to access after EMIF is placed
in DDR to make sure they are present in TLB to avoid a miss and walk of
page table in DDR, which is not possible once DDR is shut off and will
lead to a hang in suspend path if attempted.

Signed-off-by: Dave Gerlach <d-gerlach@ti.com>
[zou: Original patch taken from
ti-sdk-am335x-evm-08.00.00.00-Linux-x86-Install.bin]
Signed-off-by: Cao Zou <cao.zou@windriver.com>
---
 arch/arm/mach-omap2/sleep43xx.S |    9 +++++++++
 1 files changed, 9 insertions(+), 0 deletions(-)

diff --git a/arch/arm/mach-omap2/sleep43xx.S b/arch/arm/mach-omap2/sleep43xx.S
index 9444fd4..d7fbbec 100644
--- a/arch/arm/mach-omap2/sleep43xx.S
+++ b/arch/arm/mach-omap2/sleep43xx.S
@@ -218,6 +218,15 @@ sync:
 	bne	sync
 #endif
 
+	ldr	r1, am43xx_virt_mpu_clkctrl
+	ldr	r2, [r1]
+
+	ldr	r1, am43xx_virt_mpu_clkstctrl
+	ldr	r2, [r1]
+
+	ldr	r1, am43xx_virt_emif_clkctrl
+	ldr	r2, [r1]
+
 	ldr	r0, emif_addr_virt
 	/* Put SDRAM in self-refresh */
 	ldr	r1, [r0, #EMIF_POWER_MANAGEMENT_CONTROL]
-- 
1.7.5.4

