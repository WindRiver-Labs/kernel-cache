From 234c776f1c39f1e6ab1587bd2530c6f9380171f4 Mon Sep 17 00:00:00 2001
From: Matt Fleming <matt.fleming@intel.com>
Date: Sun, 16 Mar 2014 17:46:46 +0000
Subject: [PATCH 15/29] x86/efi: Restore 'attr' argument to
 query_variable_info()

commit 9a11040ff962304c1838aa9a9f33be78784eae47 upstream.

In the thunk patches the 'attr' argument was dropped to
query_variable_info(). Restore it otherwise the firmware will return
EFI_INVALID_PARAMETER.

Signed-off-by: Matt Fleming <matt.fleming@intel.com>
Signed-off-by: Pengyu Ma <pengyu.ma@windriver.com>
---
 arch/x86/platform/efi/efi_64.c | 2 +-
 1 file changed, 1 insertion(+), 1 deletion(-)

diff --git a/arch/x86/platform/efi/efi_64.c b/arch/x86/platform/efi/efi_64.c
index 7e7f195..290d397 100644
--- a/arch/x86/platform/efi/efi_64.c
+++ b/arch/x86/platform/efi/efi_64.c
@@ -567,7 +567,7 @@ efi_thunk_query_variable_info(u32 attr, u64 *storage_space,
 	phys_remaining = virt_to_phys(remaining_space);
 	phys_max = virt_to_phys(max_variable_size);
 
-	status = efi_thunk(query_variable_info, phys_storage,
+	status = efi_thunk(query_variable_info, attr, phys_storage,
 			   phys_remaining, phys_max);
 
 	return status;
-- 
2.0.2

