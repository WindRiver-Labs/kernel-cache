From 138f7a10f9d682b6689e677cdff50e39e600d4e7 Mon Sep 17 00:00:00 2001
From: Rob Herring <robh@kernel.org>
Date: Wed, 30 Apr 2014 19:48:29 -0500
Subject: [PATCH 390/430] tty/serial: fix generic earlycon option parsing

Commit 9aac5887595 (tty/serial: add generic serial earlycon) moved
console option parsing from 8250_early.c and converted to kstrto*
functions from simple_strtoul along the way. However, kstrto* functions
are not equivalent in that they do not allow non-convertible characters
at the end such as "115200n8". Fix this by changing back to
simple_strtoul and ignore what checkpatch.pl says.

Reported-by: Yinghai Lu <yinghai@kernel.org>
Cc: Jiri Slaby <jslaby@suse.cz>
Cc: linux-serial@vger.kernel.org

Signed-off-by: Greg Kroah-Hartman <gregkh@linuxfoundation.org>
(cherry picked from commit e26f1db9b8d74617519e50b41749900d0a257406)
Signed-off-by: Zumeng Chen <zumeng.chen@windriver.com>
---
 drivers/tty/serial/earlycon.c |   18 +++++-------------
 1 files changed, 5 insertions(+), 13 deletions(-)

diff --git a/drivers/tty/serial/earlycon.c b/drivers/tty/serial/earlycon.c
index 73bf1e2..c92e830 100644
--- a/drivers/tty/serial/earlycon.c
+++ b/drivers/tty/serial/earlycon.c
@@ -53,7 +53,7 @@ static int __init parse_options(struct earlycon_device *device,
 				char *options)
 {
 	struct uart_port *port = &device->port;
-	int mmio, mmio32, length, ret;
+	int mmio, mmio32, length;
 	unsigned long addr;
 
 	if (!options)
@@ -64,25 +64,19 @@ static int __init parse_options(struct earlycon_device *device,
 	if (mmio || mmio32) {
 		port->iotype = (mmio ? UPIO_MEM : UPIO_MEM32);
 		options += mmio ? 5 : 7;
-		ret = kstrtoul(options, 0, &addr);
-		if (ret)
-			return ret;
+		addr = simple_strtoul(options, NULL, 0);
 		port->mapbase = addr;
 		if (mmio32)
 			port->regshift = 2;
 	} else if (!strncmp(options, "io,", 3)) {
 		port->iotype = UPIO_PORT;
 		options += 3;
-		ret = kstrtoul(options, 0, &addr);
-		if (ret)
-			return ret;
+		addr = simple_strtoul(options, NULL, 0);
 		port->iobase = addr;
 		mmio = 0;
 	} else if (!strncmp(options, "0x", 2)) {
 		port->iotype = UPIO_MEM;
-		ret = kstrtoul(options, 0, &addr);
-		if (ret)
-			return ret;
+		addr = simple_strtoul(options, NULL, 0);
 		port->mapbase = addr;
 	} else {
 		return -EINVAL;
@@ -93,9 +87,7 @@ static int __init parse_options(struct earlycon_device *device,
 	options = strchr(options, ',');
 	if (options) {
 		options++;
-		ret = kstrtouint(options, 0, &device->baud);
-		if (ret)
-			return ret;
+		device->baud = simple_strtoul(options, NULL, 0);
 		length = min(strcspn(options, " ") + 1,
 			     (size_t)(sizeof(device->options)));
 		strlcpy(device->options, options, length);
-- 
1.7.5.4

