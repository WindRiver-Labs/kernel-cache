From 60d5c3bd4317d528e4ba64c3e3c3bddff76ece2c Mon Sep 17 00:00:00 2001
From: Tirumalesh Chalamarla <tchalamarla@cavium.com>
Date: Wed, 14 May 2014 11:32:38 +0530
Subject: [PATCH 176/430] ITS: Fix size calculation mapd command

The commit comes from
  git://git.kernel.org/pub/scm/linux/kernel/git/rric/linux.git

Fixed mapd command in gic-its driver to send proper size value.

Signed-off-by: Tirumalesh Chalamarla <tchalamarla@cavium.com>
Signed-off-by: Robert Richter <rrichter@cavium.com>
(cherry picked from commit 8fe95c1abadb79b0e20843e5b6dc351232aa18a6)
Signed-off-by: Zumeng Chen <zumeng.chen@windriver.com>
---
 drivers/irqchip/irq-gic-v3-its.c |    2 +-
 1 files changed, 1 insertions(+), 1 deletions(-)

diff --git a/drivers/irqchip/irq-gic-v3-its.c b/drivers/irqchip/irq-gic-v3-its.c
index 73cbd7c..f3bc84c 100644
--- a/drivers/irqchip/irq-gic-v3-its.c
+++ b/drivers/irqchip/irq-gic-v3-its.c
@@ -239,7 +239,7 @@ static struct its_collection *its_build_mapd_cmd(struct its_cmd_block *cmd,
 						 struct its_cmd_desc *desc)
 {
 	unsigned long itt_addr;
-	u8 size = order_base_2(desc->its_mapd_cmd.dev->nr_ites);
+	u8 size = max(order_base_2(desc->its_mapd_cmd.dev->nr_ites), 1);
 
 	itt_addr = virt_to_phys(desc->its_mapd_cmd.dev->itt);
 	itt_addr = ALIGN(itt_addr, ITS_ITT_ALIGN);
-- 
1.7.5.4

