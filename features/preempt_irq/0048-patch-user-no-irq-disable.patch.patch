From 0557a4664ec944b8fa7d522361a100b81abfdbe4 Mon Sep 17 00:00:00 2001
From: Paul Gortmaker <paul.gortmaker@windriver.com>
Date: Wed, 8 Oct 2008 14:53:22 -0400
Subject: [PATCH] [PATCH] patch user-no-irq-disable.patch

From 0948ffc4d571f65e9912fba5301b1d25bcab8800 Mon Sep 17 00:00:00 2001
Subject: [PATCH] patch user-no-irq-disable.patch
---
 kernel/user.c |    4 ++--
 1 files changed, 2 insertions(+), 2 deletions(-)

diff --git a/kernel/user.c b/kernel/user.c
index 865ecf5..e32ec62 100644
--- a/kernel/user.c
+++ b/kernel/user.c
@@ -289,14 +289,14 @@ static void remove_user_sysfs_dir(struct work_struct *w)
 	 */
 	uids_mutex_lock();
 
-	local_irq_save(flags);
+	local_irq_save_nort(flags);
 
 	if (atomic_dec_and_lock(&up->__count, &uidhash_lock)) {
 		uid_hash_remove(up);
 		remove_user = 1;
 		spin_unlock_irqrestore(&uidhash_lock, flags);
 	} else {
-		local_irq_restore(flags);
+		local_irq_restore_nort(flags);
 	}
 
 	if (!remove_user)
-- 
1.5.5.1

