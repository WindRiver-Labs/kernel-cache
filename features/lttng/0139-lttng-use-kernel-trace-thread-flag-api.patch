From 86c2d62055576753aa0b22324ca1ede834a064e1 Mon Sep 17 00:00:00 2001
From: Mathieu Desnoyers <mathieu.desnoyers@polymtl.ca>
Date: Thu, 2 Oct 2008 14:36:33 -0400
Subject: [PATCH] lttng-use-kernel-trace-thread-flag-api

LTTng use kernel trace thread flag api

Make LTTng aware of syscall tracing enable.

Signed-off-by: Mathieu Desnoyers <mathieu.desnoyers@polymtl.ca>
---
 ltt/ltt-tracer.c |    2 ++
 1 files changed, 2 insertions(+), 0 deletions(-)

diff --git a/ltt/ltt-tracer.c b/ltt/ltt-tracer.c
index 273a107..12cc000 100644
--- a/ltt/ltt-tracer.c
+++ b/ltt/ltt-tracer.c
@@ -328,6 +328,7 @@ static int _ltt_trace_create(char *trace_name,	enum trace_mode mode,
 #endif
 		mod_timer(&ltt_async_wakeup_timer,
 				jiffies + LTT_PERCPU_TIMER_INTERVAL);
+		set_kernel_trace_flag_all_tasks();
 	}
 	list_add_rcu(&new_trace->list, &ltt_traces.head);
 	synchronize_sched();
@@ -581,6 +582,7 @@ static int _ltt_trace_destroy(struct ltt_trace_struct	*trace)
 	list_del_rcu(&trace->list);
 	synchronize_sched();
 	if (list_empty(&ltt_traces.head)) {
+		clear_kernel_trace_flag_all_tasks();
 		/*
 		 * We stop the asynchronous delivery of reader wakeup, but
 		 * we must make one last check for reader wakeups pending
-- 
1.5.5.1

