From 1706f4028f386a88b46dbf2555f5bb7301b05087 Mon Sep 17 00:00:00 2001
From: Yang Shi <yang.shi@windriver.com>
Date: Thu, 9 Aug 2012 10:27:47 -0700
Subject: [PATCH] lttng: omap: Remove PMU reserving in trace clock

lttng 1.x doesn't use PMU at all, so it's not necessary to reserve
PMU before starting trace. So, remove PMU reserve/release code in
trace clock.

Signed-off-by: Yang Shi <yang.shi@windriver.com>
---
 arch/arm/mach-omap2/trace-clock.c |    9 ---------
 1 file changed, 9 deletions(-)

diff --git a/arch/arm/mach-omap2/trace-clock.c b/arch/arm/mach-omap2/trace-clock.c
index 8b5a5b0..95412f4 100644
--- a/arch/arm/mach-omap2/trace-clock.c
+++ b/arch/arm/mach-omap2/trace-clock.c
@@ -42,8 +42,6 @@ static int trace_clock_refcount;
 
 static int print_info_done;
 
-static int reserved_pmu;
-
 static u32 get_mul_fact(u64 max_freq, u64 cur_freq)
 {
 	u64 rem;
@@ -545,11 +543,6 @@ int get_trace_clock(void)
 	spin_lock(&trace_clock_lock);
 	if (trace_clock_refcount)
 		goto end;
-	reserved_pmu = reserve_pmu(ARM_PMU_DEVICE_CPU);
-	if (reserved_pmu) {
-		ret = -EBUSY;
-		goto end;
-	}
 	trace_clock_refcount++;
 	_start_trace_clock();
 end:
@@ -565,8 +558,6 @@ void put_trace_clock(void)
 	if (trace_clock_refcount != 1)
 		goto end;
 	_stop_trace_clock();
-	if (reserved_pmu)
-		release_pmu(ARM_PMU_DEVICE_CPU);
 end:
 	trace_clock_refcount--;
 	spin_unlock(&trace_clock_lock);
-- 
1.7.9.7

