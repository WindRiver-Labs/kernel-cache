From 7686005d7485b7af09c00bed0e4cf29516afe223 Mon Sep 17 00:00:00 2001
From: Yang Shi <yang.shi@windriver.com>
Date: Thu, 10 May 2012 13:58:26 -0700
Subject: [PATCH 173/248] idle-notifier-x86_32-fix

idle notifier x86_32 fix

- Comment cleanup
- Fix apm.c for 32-bit. Need to include asm/idle.h and need __exit_idle symbol.
  Therefore, x86 64 __exit_idle must become non-static too.

Signed-off-by: Mathieu Desnoyers <mathieu.desnoyers@polymtl.ca>
---
 arch/x86/include/asm/idle.h |    1 +
 arch/x86/kernel/apm_32.c    |    9 ++++++---
 2 files changed, 7 insertions(+), 3 deletions(-)

diff --git a/arch/x86/include/asm/idle.h b/arch/x86/include/asm/idle.h
index 22a60b1..2fe89cc 100644
--- a/arch/x86/include/asm/idle.h
+++ b/arch/x86/include/asm/idle.h
@@ -2,6 +2,7 @@
 #define _ASM_X86_IDLE_H
 
 void enter_idle(void);
+void __exit_idle(void);
 void exit_idle(void);
 
 void amd_e400_remove_cpu(int cpu);
diff --git a/arch/x86/kernel/apm_32.c b/arch/x86/kernel/apm_32.c
index 736b132..d3553d3 100644
--- a/arch/x86/kernel/apm_32.c
+++ b/arch/x86/kernel/apm_32.c
@@ -237,6 +237,7 @@
 #include <asm/olpc.h>
 #include <asm/paravirt.h>
 #include <asm/reboot.h>
+#include <asm/idle.h>
 
 #if defined(CONFIG_APM_DISPLAY_BLANK) && defined(CONFIG_VT)
 extern int (*console_blank_hook)(int);
@@ -954,9 +955,11 @@ recalc:
 			original_pm_idle();
 		else
 			default_idle();
-		/* In many cases the interrupt that ended idle
-		   has already called exit_idle. But some idle
-		   loops can be woken up without interrupt. */
+		/*
+		 * In many cases the interrupt that ended idle
+		 * has already called exit_idle. But some idle
+		 * loops can be woken up without interrupt.
+		 */
 		__exit_idle();
 		local_irq_disable();
 		jiffies_since_last_check = jiffies - last_jiffies;
-- 
1.7.0.4

