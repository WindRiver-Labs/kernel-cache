From 4a2a3d54acd0b21e9cbc5c29d99328721e5d6d3a Mon Sep 17 00:00:00 2001
From: Mathieu Desnoyers <mathieu.desnoyers@polymtl.ca>
Date: Thu, 2 Oct 2008 14:36:11 -0400
Subject: [PATCH] immediate-values-architecture-independent-code-use-psrwlock

Immediate Values Use psrwlock

Adapt to module.c use of psrwlock.

Signed-off-by: Mathieu Desnoyers <mathieu.desnoyers@polymtl.ca>
---
 kernel/module.c |    8 ++++----
 1 files changed, 4 insertions(+), 4 deletions(-)

diff --git a/kernel/module.c b/kernel/module.c
index 5f6a9c4..af7c46a 100644
--- a/kernel/module.c
+++ b/kernel/module.c
@@ -2888,7 +2888,7 @@ int module_get_iter_tracepoints(struct tracepoint_iter *iter)
  * _module_imv_update - update all immediate values in the kernel
  *
  * Iterate on the kernel core and modules to update the immediate values.
- * Module_mutex must be held be the caller.
+ * module_psrwlock read lock must be held by the caller.
  */
 void _module_imv_update(void)
 {
@@ -2907,13 +2907,13 @@ EXPORT_SYMBOL_GPL(_module_imv_update);
  * module_imv_update - update all immediate values in the kernel
  *
  * Iterate on the kernel core and modules to update the immediate values.
- * Takes module_mutex.
+ * Takes module_psrwlock read lock.
  */
 void module_imv_update(void)
 {
-	mutex_lock(&module_mutex);
+	psread_lock(&module_psrwlock);
 	_module_imv_update();
-	mutex_unlock(&module_mutex);
+	psread_unlock(&module_psrwlock);
 }
 EXPORT_SYMBOL_GPL(module_imv_update);
 #endif
-- 
1.5.5.1

