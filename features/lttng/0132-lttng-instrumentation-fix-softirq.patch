From cf7e1d34954ab2b47d0c496d92cf8c817261889c Mon Sep 17 00:00:00 2001
From: Mathieu Desnoyers <mathieu.desnoyers@efficios.com>
Date: Wed, 18 May 2011 18:42:18 -0400
Subject: [PATCH 132/248] lttng-instrumentation-fix-softirq

LTTng instrumentation fix softirq

Fix softirq instrumentation mismatch, caused by changes in trace_event softirq
event name.

Signed-off-by: Mathieu Desnoyers <mathieu.desnoyers@polymtl.ca>
---
 include/trace/irq.h |   11 ++---------
 kernel/softirq.c    |    5 +++--
 2 files changed, 5 insertions(+), 11 deletions(-)

diff --git a/include/trace/irq.h b/include/trace/irq.h
index 1d89916..da53828 100644
--- a/include/trace/irq.h
+++ b/include/trace/irq.h
@@ -2,6 +2,7 @@
 #define _LTTNG_TRACE_IRQ_H
 
 #include <linux/kdebug.h>
+#include <linux/interrupt.h>
 
 /*
  * action can be NULL if not available.
@@ -27,15 +28,7 @@ DECLARE_TRACE(irq_tasklet_high_exit,
 	TP_PROTO(struct tasklet_struct *t),
 		TP_ARGS(t));
 
-#if 0
-DECLARE_TRACE(irq_softirq_entry,
-	TP_PROTO(struct softirq_action *h, struct softirq_action *softirq_vec),
-		TP_ARGS(h, softirq_vec));
-DECLARE_TRACE(irq_softirq_exit,
-	TP_PROTO(struct softirq_action *h, struct softirq_action *softirq_vec),
-		TP_ARGS(h, softirq_vec));
-#endif
-DECLARE_TRACE(irq_softirq_raise,
+DECLARE_TRACE(softirq_raise,
 	TP_PROTO(unsigned int nr),
 		TP_ARGS(nr));
 
diff --git a/kernel/softirq.c b/kernel/softirq.c
index 1e24a60..0ea80fd 100644
--- a/kernel/softirq.c
+++ b/kernel/softirq.c
@@ -26,6 +26,7 @@
 #include <linux/marker.h>
 #include <linux/kallsyms.h>
 #include <linux/tick.h>
+#include <trace/irq.h>
 
 #define CREATE_TRACE_POINTS
 #include <trace/events/irq.h>
@@ -226,7 +227,7 @@ EXPORT_SYMBOL(local_bh_enable_ip);
  */
 #define MAX_SOFTIRQ_RESTART 10
 
-DEFINE_TRACE(irq_softirq_raise);
+DEFINE_TRACE(softirq_raise);
 
 asmlinkage void __do_softirq(void)
 {
@@ -375,7 +376,7 @@ void irq_exit(void)
  */
 inline void raise_softirq_irqoff(unsigned int nr)
 {
-	trace_irq_softirq_raise(nr);
+	trace_softirq_raise(nr);
 	__raise_softirq_irqoff(nr);
 
 	/*
-- 
1.7.0.4

