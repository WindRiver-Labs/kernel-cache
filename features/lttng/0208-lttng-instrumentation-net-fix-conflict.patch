From 140ea77982e6a495f1df0e2b8eaa6ae77f097b89 Mon Sep 17 00:00:00 2001
From: Yang Shi <yang.shi@windriver.com>
Date: Fri, 11 May 2012 16:00:50 -0700
Subject: [PATCH 208/248] lttng-instrumentation-net-fix-conflict

lttng instrumentation net fix conflict

Signed-off-by: Mathieu Desnoyers <mathieu.desnoyers@efficios.com>
---
 include/trace/net.h |    8 ++++----
 net/core/dev.c      |   14 ++++++++------
 2 files changed, 12 insertions(+), 10 deletions(-)

diff --git a/include/trace/net.h b/include/trace/net.h
index 5e774eb..91a0f02 100644
--- a/include/trace/net.h
+++ b/include/trace/net.h
@@ -1,13 +1,13 @@
-#ifndef _TRACE_NET_H
-#define _TRACE_NET_H
+#ifndef _TRACE_LTTNG_NET_H
+#define _TRACE_LTTNG_NET_H
 
 #include <linux/tracepoint.h>
 
 struct sk_buff;
-DECLARE_TRACE(net_dev_xmit,
+DECLARE_TRACE(lttng_net_dev_xmit,
 	TP_PROTO(struct sk_buff *skb),
 	TP_ARGS(skb));
-DECLARE_TRACE(net_dev_receive,
+DECLARE_TRACE(lttng_net_dev_receive,
 	TP_PROTO(struct sk_buff *skb),
 	TP_ARGS(skb));
 DECLARE_TRACE(net_tcpv4_rcv,
diff --git a/net/core/dev.c b/net/core/dev.c
index f6b4897..00c0f00 100644
--- a/net/core/dev.c
+++ b/net/core/dev.c
@@ -207,8 +207,8 @@ static inline void dev_base_seq_inc(struct net *net)
 	while (++net->dev_base_seq == 0);
 }
 
-DEFINE_TRACE(net_dev_xmit);
-DEFINE_TRACE(net_dev_receive);
+DEFINE_TRACE(lttng_net_dev_xmit);
+DEFINE_TRACE(lttng_net_dev_receive);
 DEFINE_TRACE(net_napi_schedule);
 DEFINE_TRACE(net_napi_poll);
 DEFINE_TRACE(net_napi_complete);
@@ -2243,8 +2243,9 @@ int dev_hard_start_xmit(struct sk_buff *skb, struct net_device *dev,
 		}
 
 		skb_len = skb->len;
+
 		rc = ops->ndo_start_xmit(skb, dev);
-		trace_net_dev_xmit(skb, rc, dev, skb_len);
+		trace_lttng_net_dev_xmit(skb);
 		if (rc == NETDEV_TX_OK)
 			txq_trans_update(txq);
 		return rc;
@@ -2265,8 +2266,9 @@ gso:
 			skb_dst_drop(nskb);
 
 		skb_len = nskb->len;
+
 		rc = ops->ndo_start_xmit(nskb, dev);
-		trace_net_dev_xmit(nskb, rc, dev, skb_len);
+		trace_lttng_net_dev_xmit(nskb);
 		if (unlikely(rc != NETDEV_TX_OK)) {
 			if (rc & ~NETDEV_TX_MASK)
 				goto out_kfree_gso_skb;
@@ -2937,7 +2939,7 @@ int netif_rx(struct sk_buff *skb)
 	if (netpoll_rx(skb))
 		return NET_RX_DROP;
 
-	trace_net_dev_receive(skb);
+	trace_lttng_net_dev_receive(skb);
 
 	net_timestamp_check(netdev_tstamp_prequeue, skb);
 
@@ -3306,7 +3308,7 @@ int netif_receive_skb(struct sk_buff *skb)
 	if (skb_defer_rx_timestamp(skb))
 		return NET_RX_SUCCESS;
 
-	trace_net_dev_receive(skb);
+	trace_lttng_net_dev_receive(skb);
 
 #ifdef CONFIG_RPS
 	if (static_key_false(&rps_needed)) {
-- 
1.7.0.4

