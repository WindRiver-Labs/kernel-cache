From 380deb6d3e7b56cab1c35c2b9221c441e1113f2d Mon Sep 17 00:00:00 2001
From: Zumeng Chen <zumeng.chen@windriver.com>
Date: Mon, 21 Jun 2010 17:45:08 -0700
Subject: [PATCH] lttng: fix error offset due to different struct pointer

The result type of macro _va is void pointer, so the offset
is not right, which introduces not proper pgd is processed,
and the expected pgd will never be touched, data exception
will be triggered always at the same place too. So redefine
it with (pgd_t *).

Signed-off-by: Zumeng Chen <zumeng.chen@windriverc.com>
---
 arch/x86/mm/fault.c |    2 +-
 1 files changed, 1 insertions(+), 1 deletions(-)

diff --git a/arch/x86/mm/fault.c b/arch/x86/mm/fault.c
index 83e0492..9a17d39 100644
--- a/arch/x86/mm/fault.c
+++ b/arch/x86/mm/fault.c
@@ -382,7 +382,7 @@ static noinline __kprobes int vmalloc_fault(unsigned long address)
 	 * case just flush:
 	 */
 	pgd_paddr = read_cr3();
-	pgd = __va(pgd_paddr) + pgd_index(address);
+	pgd = (pgd_t * )__va(pgd_paddr) + pgd_index(address);
 	pgd_ref = pgd_offset_k(address);
 	if (pgd_none(*pgd_ref))
 		return -1;
-- 
1.6.0.3

