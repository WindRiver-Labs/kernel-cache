From d0a771cbd0e120a4f23a045a78ae2e04fc06ef97 Mon Sep 17 00:00:00 2001
From: Mathieu Desnoyers <mathieu.desnoyers@efficios.com>
Date: Wed, 18 May 2011 18:42:27 -0400
Subject: [PATCH 153/248] mips-fix-trace-clock-32

MIPS fix trace clock 32

trace clock for mips 32 64-cmpxchg (based on irq off and spinlock) was buggy.

Signed-off-by: Mathieu Desnoyers <mathieu.desnoyers@polymtl.ca>
---
 arch/mips/kernel/trace-clock.c |    2 +-
 1 files changed, 1 insertions(+), 1 deletions(-)

diff --git a/arch/mips/kernel/trace-clock.c b/arch/mips/kernel/trace-clock.c
index cff5e23..ed509e8 100644
--- a/arch/mips/kernel/trace-clock.c
+++ b/arch/mips/kernel/trace-clock.c
@@ -65,7 +65,7 @@ static inline u64 trace_clock_cmpxchg64(u64 *ptr, u64 old, u64 new)
 
 	val = *ptr;
 	if (likely(val == old))
-		*ptr = val = new;
+		*ptr = new;
 	return val;
 }
 
-- 
1.7.0.4

