From f1fb05c768e9ad6f33c5ebc134f7d27270119303 Mon Sep 17 00:00:00 2001
From: Mathieu Desnoyers <mathieu.desnoyers@efficios.com>
Date: Thu, 13 May 2010 19:27:17 -0400
Subject: [PATCH 225/390] lttng-transport-header-selection

LTTng transport header selection

Signed-off-by: Mathieu Desnoyers <mathieu.desnoyers@polymtl.ca>
---
 ltt/ltt-relay-select.h    |   12 ++++++++++++
 ltt/ltt-serialize.c       |    6 +-----
 ltt/ltt-type-serializer.c |    6 +-----
 3 files changed, 14 insertions(+), 10 deletions(-)
 create mode 100644 ltt/ltt-relay-select.h

diff --git a/ltt/ltt-relay-select.h b/ltt/ltt-relay-select.h
new file mode 100644
index 0000000..d614ca8
--- /dev/null
+++ b/ltt/ltt-relay-select.h
@@ -0,0 +1,12 @@
+#ifndef _LTT_LTT_RELAY_SELECT_H
+#define _LTT_LTT_RELAY_SELECT_H
+
+#ifdef CONFIG_LTT_RELAY_LOCKLESS
+#include "ltt-relay-lockless.h"
+#elif defined(CONFIG_LTT_RELAY_LOCKED)
+#include "ltt-relay-locked.h"
+#else
+#error "At least one LTTng relay transport should be selected."
+#endif
+
+#endif /* _LTT_LTT_RELAY_SELECT_H */
diff --git a/ltt/ltt-serialize.c b/ltt/ltt-serialize.c
index 3c9d532..dc5a46a 100644
--- a/ltt/ltt-serialize.c
+++ b/ltt/ltt-serialize.c
@@ -17,11 +17,7 @@
 #include <linux/module.h>
 #include <linux/ltt-tracer.h>
 
-#ifdef CONFIG_LTT_RELAY_LOCKLESS
-#include "ltt-relay-lockless.h"
-#else
-#include "ltt-relay-locked.h"
-#endif
+#include "ltt-relay-select.h"
 
 enum ltt_type {
 	LTT_TYPE_SIGNED_INT,
diff --git a/ltt/ltt-type-serializer.c b/ltt/ltt-type-serializer.c
index eda69fb..e94b3b1 100644
--- a/ltt/ltt-type-serializer.c
+++ b/ltt/ltt-type-serializer.c
@@ -10,11 +10,7 @@
 #include <linux/module.h>
 #include <linux/ltt-type-serializer.h>
 
-#ifdef CONFIG_LTT_RELAY_LOCKLESS
-#include "ltt-relay-lockless.h"
-#else
-#include "ltt-relay-locked.h"
-#endif
+#include "ltt-relay-select.h"
 
 notrace void _ltt_specialized_trace(const struct marker *mdata,
 		void *probe_data,
-- 
1.6.5.2

