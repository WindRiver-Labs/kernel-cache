From 8ed528e2a3d736d96d13ad8ed8a68ebfd8aae7f8 Mon Sep 17 00:00:00 2001
From: Zumeng Chen <zumeng.chen@windriver.com>
Date: Tue, 22 Jun 2010 08:45:08 +0800
Subject: [PATCH] lttng: fix error offset due to different struct pointer

The result type of macro _va is void pointer, so the offset
is not right, which introduces not proper pgd is processed,
and the expected pgd will never be touched, data exception
will be triggered always at the same place too. So redefine
it with (pgd_t *).

Signed-off-by: Zumeng Chen <zumeng.chen@windriverc.com>
---
 arch/x86/mm/fault.c |    2 +-
 1 files changed, 1 insertions(+), 1 deletions(-)

diff --git a/arch/x86/mm/fault.c b/arch/x86/mm/fault.c
index 0e4ed69..3cbd563 100644
--- a/arch/x86/mm/fault.c
+++ b/arch/x86/mm/fault.c
@@ -538,7 +538,7 @@ static int vmalloc_fault(unsigned long address)
 	   case just flush. */
 
 	pgd_paddr = read_cr3();
-	pgd = __va(pgd_paddr) + pgd_index(address);
+	pgd = (pgd_t *)__va(pgd_paddr) + pgd_index(address);
 
 	pgd_ref = pgd_offset_k(address);
 	if (pgd_none(*pgd_ref))
-- 
1.7.0.4

