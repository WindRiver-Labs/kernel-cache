From a778d11448d0f411b1ca09f9979060f632f8d503 Mon Sep 17 00:00:00 2001
From: Mathieu Desnoyers <mathieu.desnoyers@polymtl.ca>
Date: Thu, 30 Oct 2008 23:27:23 -0400
Subject: [PATCH] lttng-use-kernel-trace-thread-flag-api

LTTng use kernel trace thread flag api

Make LTTng aware of syscall tracing enable.

Signed-off-by: Mathieu Desnoyers <mathieu.desnoyers@polymtl.ca>
---
 ltt/ltt-tracer.c |    2 ++
 1 files changed, 2 insertions(+), 0 deletions(-)

diff --git a/ltt/ltt-tracer.c b/ltt/ltt-tracer.c
index eb75ebe..e4358cf 100644
--- a/ltt/ltt-tracer.c
+++ b/ltt/ltt-tracer.c
@@ -283,6 +283,7 @@ static int _ltt_trace_create(const char *trace_name, enum trace_mode mode,
 		probe_id_defrag();
 		mod_timer(&ltt_async_wakeup_timer,
 				jiffies + LTT_PERCPU_TIMER_INTERVAL);
+		set_kernel_trace_flag_all_tasks();
 	}
 	list_add_rcu(&new_trace->list, &ltt_traces.head);
 	synchronize_sched();
@@ -520,6 +521,7 @@ static int _ltt_trace_destroy(struct ltt_trace_struct	*trace)
 	list_del_rcu(&trace->list);
 	synchronize_sched();
 	if (list_empty(&ltt_traces.head)) {
+		clear_kernel_trace_flag_all_tasks();
 		/*
 		 * We stop the asynchronous delivery of reader wakeup, but
 		 * we must make one last check for reader wakeups pending
-- 
1.5.5.1

