From 4260043249b4254962c69032c675a3575e84c034 Mon Sep 17 00:00:00 2001
From: auto commit <unknown@unknown>
Date: Tue, 9 Sep 2008 22:54:39 -0400
Subject: [PATCH] THis patch is based on Zumeng's patch.

This patch addes initialization of mips_hpt_frequency
into sb1250/time.c, the ltt_init_synthetic_tsc() work
properly.

Signed-off-by: Jack Tan <jack.tan@windriver.com>
---
 arch/mips/sibyte/sb1250/time.c |   13 +++++++++++++
 1 files changed, 13 insertions(+), 0 deletions(-)

diff --git a/arch/mips/sibyte/sb1250/time.c b/arch/mips/sibyte/sb1250/time.c
index 68337bf..1212cd8 100644
--- a/arch/mips/sibyte/sb1250/time.c
+++ b/arch/mips/sibyte/sb1250/time.c
@@ -20,8 +20,21 @@
 extern void sb1250_clocksource_init(void);
 extern void sb1250_clockevent_init(void);
 
+#ifdef CONFIG_SIMULATION
+#define BCM1250_HPT_VALUE       50000
+#else
+#define BCM1250_HPT_VALUE       1000000
+#endif
+
+extern unsigned int mips_hpt_frequency;
+ 
 void __init plat_time_init(void)
 {
 	sb1250_clocksource_init();
 	sb1250_clockevent_init();
+
+	/* To initialize mips_hpt_frequency used by ltt_frequency
+	 *  otherwise there is div/zero when boot. 
+	 */
+	mips_hpt_frequency = BCM1250_HPT_VALUE;
 }
-- 
1.5.5.1

