From d98d8683fc84054a6eee4b8f726d25b00ef7c143 Mon Sep 17 00:00:00 2001
From: Mathieu Desnoyers <mathieu.desnoyers@efficios.com>
Date: Thu, 13 May 2010 19:26:08 -0400
Subject: [PATCH 101/391] lttng-instrumentation/lttng-instrumentation-ipc-tracepoints-probes

LTTng instrumentation ipc tracepoint probes

Create a module which declares ipc tracepoint probes, using markers.

Signed-off-by: Mathieu Desnoyers <mathieu.desnoyers@polymtl.ca>
CC: Alexander Viro <viro@zeniv.linux.org.uk>
CC: 'Peter Zijlstra' <peterz@infradead.org>
CC: "Frank Ch. Eigler" <fche@redhat.com>
CC: 'Ingo Molnar' <mingo@elte.hu>
CC: 'Hideo AOKI' <haoki@redhat.com>
CC: Takashi Nishiie <t-nishiie@np.css.fujitsu.com>
CC: 'Steven Rostedt' <rostedt@goodmis.org>
CC: Masami Hiramatsu <mhiramat@redhat.com>
---
 ltt/probes/Makefile    |    4 +++-
 ltt/probes/ipc-trace.c |   39 +++++++++++++++++++++++++++++++++++++++
 2 files changed, 42 insertions(+), 1 deletions(-)
 create mode 100644 ltt/probes/ipc-trace.c

diff --git a/ltt/probes/Makefile b/ltt/probes/Makefile
index 4c925fa..b138a2e 100644
--- a/ltt/probes/Makefile
+++ b/ltt/probes/Makefile
@@ -4,9 +4,11 @@ ifdef CONFIG_FTRACE
 CFLAGS_REMOVE_kernel-trace.o = -pg
 CFLAGS_REMOVE_mm-trace.o = -pg
 CFLAGS_REMOVE_fs-trace.o = -pg
+CFLAGS_REMOVE_ipc-trace.o = -pg
 endif
 
-obj-$(CONFIG_LTT_TRACEPROBES)	+= kernel-trace.o mm-trace.o fs-trace.o
+obj-$(CONFIG_LTT_TRACEPROBES)	+= kernel-trace.o mm-trace.o fs-trace.o \
+				ipc-trace.o
 
 ifeq ($(CONFIG_NET),y)
 ifdef CONFIG_FTRACE
diff --git a/ltt/probes/ipc-trace.c b/ltt/probes/ipc-trace.c
new file mode 100644
index 0000000..128900c
--- /dev/null
+++ b/ltt/probes/ipc-trace.c
@@ -0,0 +1,39 @@
+/*
+ * ltt/probes/ipc-trace.c
+ *
+ * IPC tracepoint probes.
+ *
+ * (C) Copyright 2009 - Mathieu Desnoyers <mathieu.desnoyers@polymtl.ca>
+ * Dual LGPL v2.1/GPL v2 license.
+ */
+
+#include <linux/module.h>
+#include <trace/ipc.h>
+
+void probe_ipc_msg_create(long id, int flags)
+{
+	trace_mark_tp(ipc_msg_create, ipc_msg_create, probe_ipc_msg_create,
+		"id %ld flags %d", id, flags);
+}
+
+void probe_ipc_sem_create(long id, int flags)
+{
+	trace_mark_tp(ipc_sem_create, ipc_sem_create, probe_ipc_sem_create,
+		"id %ld flags %d", id, flags);
+}
+
+void probe_ipc_shm_create(long id, int flags)
+{
+	trace_mark_tp(ipc_shm_create, ipc_shm_create, probe_ipc_shm_create,
+		"id %ld flags %d", id, flags);
+}
+
+void probe_ipc_call(unsigned int call, unsigned int first)
+{
+	trace_mark_tp(ipc_call, ipc_call, probe_ipc_call,
+		"call %u first %d", call, first);
+}
+
+MODULE_LICENSE("GPL and additional rights");
+MODULE_AUTHOR("Mathieu Desnoyers");
+MODULE_DESCRIPTION("IPC Tracepoint Probes");
-- 
1.6.5.2

