From 1045fd2d723fda40d26c7ec65be2f034e9b85e25 Mon Sep 17 00:00:00 2001
From: Yang Shi <yang.shi@windriver.com>
Date: Fri, 1 Jun 2012 16:05:33 -0700
Subject: [PATCH 2/3] lttng: omap: Get clocksource from clocksource_mmio

Due to commit 354a183f536a8edf6cb80ee3e3f393736e278810
[Convert OMAPs 32kHz clocksource implementation to use the generic MMIO
clocksource support], clocksource struct is not used directly, so get
clocksource from clocksource_mmio.

Signed-off-by: Yang Shi <yang.shi@windriver.com>
---
 arch/arm/plat-omap/counter_32k.c |   11 ++++++++++-
 1 file changed, 10 insertions(+), 1 deletion(-)

diff --git a/arch/arm/plat-omap/counter_32k.c b/arch/arm/plat-omap/counter_32k.c
index 82d0903..01efea3 100644
--- a/arch/arm/plat-omap/counter_32k.c
+++ b/arch/arm/plat-omap/counter_32k.c
@@ -27,9 +27,16 @@
 
 #include <plat/clock.h>
 
+struct clocksource_mmio {
+	void __iomem *reg;
+	struct clocksource clksrc;
+};
+
+static struct clocksource_mmio *clocksource_32k = NULL;
+
 struct clocksource *get_clocksource_32k(void)
 {
-	return &clocksource_32k;
+	return &clocksource_32k->clksrc;
 }
 
 /*
@@ -120,6 +127,8 @@ int __init omap_init_clocksource_32k(void)
 					  clocksource_mmio_readl_up))
 			printk(err, "32k_counter");
 
+		clocksource_32k = (struct clocksource_mmio *)base;
+
 		setup_sched_clock(omap_32k_read_sched_clock, 32, 32768);
 	}
 	return 0;
-- 
1.7.9.7

