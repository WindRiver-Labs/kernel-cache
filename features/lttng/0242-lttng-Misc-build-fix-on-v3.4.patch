From 4e7dbf0d3b5a0a2c28f2aec6dd4cbf790b3ac184 Mon Sep 17 00:00:00 2001
From: Yang Shi <yang.shi@windriver.com>
Date: Thu, 24 May 2012 16:20:28 -0700
Subject: [PATCH 242/248] lttng: Misc build fix on v3.4

Fix some misc build erros for v3.4 kernel

Signed-off-by: Yang Shi <yang.shi@windriver.com>
---
 arch/mips/kernel/syscall.c         |    3 +++
 arch/powerpc/mm/fault.c            |    2 +-
 arch/x86/include/asm/trace-clock.h |    1 -
 arch/x86/kernel/nmi.c              |    7 +------
 arch/x86/kernel/traps.c            |    1 +
 include/trace/irq.h                |    1 +
 mm/swapfile.c                      |    1 +
 7 files changed, 8 insertions(+), 8 deletions(-)

diff --git a/arch/mips/kernel/syscall.c b/arch/mips/kernel/syscall.c
index 0a0d68f..6736233 100644
--- a/arch/mips/kernel/syscall.c
+++ b/arch/mips/kernel/syscall.c
@@ -28,6 +28,9 @@
 #include <linux/elf.h>
 #include <linux/ipc.h>
 #include <linux/kallsyms.h>
+#include <linux/module.h>
+#include <linux/marker.h>
+#include <trace/syscall.h>
 
 #include <asm/asm.h>
 #include <asm/branch.h>
diff --git a/arch/powerpc/mm/fault.c b/arch/powerpc/mm/fault.c
index 2c1256e..9a445d6 100644
--- a/arch/powerpc/mm/fault.c
+++ b/arch/powerpc/mm/fault.c
@@ -423,7 +423,7 @@ good_area:
 	 */
 	trace_page_fault_entry(regs, regs->trap, mm, vma, address, is_write);
 	fault = handle_mm_fault(mm, vma, address, flags);
-	trace_page_fault_exit(ret);
+	trace_page_fault_exit(fault);
 	if (unlikely(fault & (VM_FAULT_RETRY|VM_FAULT_ERROR))) {
 		int rc = mm_fault_error(regs, address, fault);
 		if (rc >= MM_FAULT_RETURN)
diff --git a/arch/x86/include/asm/trace-clock.h b/arch/x86/include/asm/trace-clock.h
index 8ca7332..7fc38e1 100644
--- a/arch/x86/include/asm/trace-clock.h
+++ b/arch/x86/include/asm/trace-clock.h
@@ -12,7 +12,6 @@
 
 #include <linux/timex.h>
 #include <linux/time.h>
-#include <asm/system.h>
 #include <asm/processor.h>
 #include <asm/atomic.h>
 
diff --git a/arch/x86/kernel/nmi.c b/arch/x86/kernel/nmi.c
index e849bc0..e87041b 100644
--- a/arch/x86/kernel/nmi.c
+++ b/arch/x86/kernel/nmi.c
@@ -18,6 +18,7 @@
 #include <linux/hardirq.h>
 #include <linux/slab.h>
 #include <linux/export.h>
+#include <trace/trap.h>
 
 #include <linux/mca.h>
 
@@ -75,12 +76,6 @@ int unknown_nmi_panic;
  */
 static DEFINE_RAW_SPINLOCK(nmi_reason_lock);
 
-/*
- * Also used in arch/x86/kernel/traps.c.
- */
-DEFINE_TRACE(trap_entry);
-DEFINE_TRACE(trap_exit);
-
 static int __init setup_unknown_nmi_panic(char *str)
 {
 	unknown_nmi_panic = 1;
diff --git a/arch/x86/kernel/traps.c b/arch/x86/kernel/traps.c
index c3fcc35..db704d1 100644
--- a/arch/x86/kernel/traps.c
+++ b/arch/x86/kernel/traps.c
@@ -67,6 +67,7 @@
 #else
 #include <asm/processor-flags.h>
 #include <asm/setup.h>
+#include <asm/asm-offsets.h>
 
 asmlinkage int system_call(void);
 
diff --git a/include/trace/irq.h b/include/trace/irq.h
index 58d5063..dcf3d63 100644
--- a/include/trace/irq.h
+++ b/include/trace/irq.h
@@ -3,6 +3,7 @@
 
 #include <linux/kdebug.h>
 #include <linux/interrupt.h>
+#include <linux/tracepoint.h>
 
 /*
  * action can be NULL if not available.
diff --git a/mm/swapfile.c b/mm/swapfile.c
index 5008847..58bb1e0 100644
--- a/mm/swapfile.c
+++ b/mm/swapfile.c
@@ -31,6 +31,7 @@
 #include <linux/memcontrol.h>
 #include <linux/poll.h>
 #include <linux/oom.h>
+#include <linux/marker.h>
 #include <trace/swap.h>
 
 #include <asm/pgtable.h>
-- 
1.7.0.4

