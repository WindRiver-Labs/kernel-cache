From 99ae3b12c8e246e8b369e9c5e58292de43655054 Mon Sep 17 00:00:00 2001
From: Bruce Ashfield <bruce.ashfield@windriver.com>
Date: Sun, 30 May 2010 22:57:10 -0400
Subject: [PATCH] lttng: x86-64 build fixes

To properly build on x86-64, we need to explicitly include
kmemcheck/kmemtrace* when using the kmalloc_trace marker.
We also need to rely on the generic sys_ipc tracing and
not a ia32 specific one.

Signed-off-by: Bruce Ashfield <bruce.ashfield@windriver.com>
---
 arch/x86/ia32/ipc32.c |    2 --
 lib/kernel_lock.c     |    3 +++
 2 files changed, 3 insertions(+), 2 deletions(-)

diff --git a/arch/x86/ia32/ipc32.c b/arch/x86/ia32/ipc32.c
index 3351933..1063842 100644
--- a/arch/x86/ia32/ipc32.c
+++ b/arch/x86/ia32/ipc32.c
@@ -19,8 +19,6 @@ asmlinkage long sys32_ipc(u32 call, int first, int second, int third,
 	version = call >> 16; /* hack for backward compatibility */
 	call &= 0xffff;
 
-	trace_ipc_call(call, first);
-
 	switch (call) {
 	case SEMOP:
 		/* struct sembuf is the same on 32 and 64bit :)) */
diff --git a/lib/kernel_lock.c b/lib/kernel_lock.c
index 5354922..3dfa8b9 100644
--- a/lib/kernel_lock.c
+++ b/lib/kernel_lock.c
@@ -5,6 +5,9 @@
  * relegated to obsolescence, but used by various less
  * important (or lazy) subsystems.
  */
+
+#include <linux/kmemtrace.h>
+#include <linux/kmemcheck.h>
 #include <linux/module.h>
 #include <linux/kallsyms.h>
 #include <linux/semaphore.h>
-- 
1.6.5.2

