From 2053765789c15068200ed78a527c5f1a4a95fa46 Mon Sep 17 00:00:00 2001
From: Bruce Ashfield <bruce.ashfield@windriver.com>
Date: Mon, 3 Nov 2008 09:37:19 -0500
Subject: [PATCH] 64bit powerpc compilation fixes

There are several includes in powerpc 64 that eventually
lead to nested includes looking for defines that are not
processed. Moving a #define and an include fixes the
problem. This is fragile by nature, but is the smallest
footprint fix.

Signed-off-by: Bruce Ashfield <bruce.ashfield@windriver.com>
---
 arch/powerpc/include/asm/timex.h |    4 ++--
 include/linux/timer.h            |    3 ++-
 2 files changed, 4 insertions(+), 3 deletions(-)

diff --git a/arch/powerpc/include/asm/timex.h b/arch/powerpc/include/asm/timex.h
index 23b41ae..71ec286 100644
--- a/arch/powerpc/include/asm/timex.h
+++ b/arch/powerpc/include/asm/timex.h
@@ -40,12 +40,12 @@ static inline unsigned long long gethrtime(void)
  * PowerPC architecture timex specifications
  */
 
+#define CLOCK_TICK_RATE	1024000 /* Underlying HZ */
+
 #include <asm/cputable.h>
 #include <asm/reg.h>
 #include <asm/time.h>
 
-#define CLOCK_TICK_RATE	1024000 /* Underlying HZ */
-
 typedef unsigned long cycles_t;
 
 static inline cycles_t get_cycles(void)
diff --git a/include/linux/timer.h b/include/linux/timer.h
index 9989ff0..f9f38fb 100644
--- a/include/linux/timer.h
+++ b/include/linux/timer.h
@@ -2,7 +2,6 @@
 #define _LINUX_TIMER_H
 
 #include <linux/list.h>
-#include <linux/ktime.h>
 #include <linux/stddef.h>
 #include <linux/debugobjects.h>
 
@@ -178,6 +177,8 @@ static inline void add_timer(struct timer_list *timer)
 
 #define del_singleshot_timer_sync(t) del_timer_sync(t)
 
+#include <linux/ktime.h>
+
 extern void init_timers(void);
 extern void run_local_timers(void);
 struct hrtimer;
-- 
1.5.5.1

