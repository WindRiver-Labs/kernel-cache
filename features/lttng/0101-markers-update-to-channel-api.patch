From 45d7f4d38e4dd9f2fbdaa767662aa0e35e1fc2be Mon Sep 17 00:00:00 2001
From: Mathieu Desnoyers <mathieu.desnoyers@efficios.com>
Date: Wed, 18 May 2011 18:42:01 -0400
Subject: [PATCH 101/248] markers-update-to-channel-api

Markers update to new channel API

Update marker users accordingly.

Signed-off-by: Mathieu Desnoyers <mathieu.desnoyers@polymtl.ca>
---
 arch/x86/kernel/syscall_64.c |    3 ++-
 arch/x86/kernel/traps.c      |    4 ++--
 drivers/input/input.c        |    3 ++-
 kernel/module.c              |    2 +-
 kernel/softirq.c             |    2 +-
 mm/swapfile.c                |    2 +-
 6 files changed, 9 insertions(+), 7 deletions(-)

diff --git a/arch/x86/kernel/syscall_64.c b/arch/x86/kernel/syscall_64.c
index db1b90a..b6528b9 100644
--- a/arch/x86/kernel/syscall_64.c
+++ b/arch/x86/kernel/syscall_64.c
@@ -42,7 +42,8 @@ void ltt_dump_sys_call_table(void *call_data)
 
 	for (i = 0; i < __NR_syscall_max + 1; i++) {
 		sprint_symbol(namebuf, (unsigned long)sys_call_table[i]);
-		__trace_mark(0, statedump_sys_call_table, call_data,
+		__trace_mark(0, syscall_state, sys_call_table,
+			call_data,
 			"id %d address %p symbol %s",
 			i, (void*)sys_call_table[i], namebuf);
 	}
diff --git a/arch/x86/kernel/traps.c b/arch/x86/kernel/traps.c
index 7b3afb8..c3fcc35 100644
--- a/arch/x86/kernel/traps.c
+++ b/arch/x86/kernel/traps.c
@@ -485,7 +485,7 @@ void ltt_dump_sys_call_table(void *call_data)
 
 	for (i = 0; i < NR_syscalls; i++) {
 		sprint_symbol(namebuf, sys_call_table[i]);
-		__trace_mark(0, statedump_sys_call_table, call_data,
+		__trace_mark(0, syscall_state, sys_call_table, call_data,
 			"id %d address %p symbol %s",
 			i, (void*)sys_call_table[i], namebuf);
 	}
@@ -625,7 +625,7 @@ void ltt_dump_idt_table(void *call_data)
 	for (i = 0; i < IDT_ENTRIES; i++) {
 		unsigned long address = gate_offset(idt_table[i]);
 		sprint_symbol(namebuf, address);
-		__trace_mark(0, statedump_idt_table, call_data,
+		__trace_mark(0, irq_state, idt_table, call_data,
 			"irq %d address %p symbol %s",
 			i, (void *)address, namebuf);
 	}
diff --git a/drivers/input/input.c b/drivers/input/input.c
index 42eec5b..663737f 100644
--- a/drivers/input/input.c
+++ b/drivers/input/input.c
@@ -218,7 +218,8 @@ static void input_handle_event(struct input_dev *dev,
 {
 	int disposition = INPUT_IGNORE_EVENT;
 
-	trace_mark(input_event, "type %u code %u value %d", type, code, value);
+	trace_mark(input, input_event,
+		   "type %u code %u value %d", type, code, value);
 
 	switch (type) {
 
diff --git a/kernel/module.c b/kernel/module.c
index 3064c7b..35063c0 100644
--- a/kernel/module.c
+++ b/kernel/module.c
@@ -3445,7 +3445,7 @@ void list_modules(void *call_data)
 #ifdef CONFIG_MODULE_UNLOAD
 		refcount = module_refcount(mod);
 #endif
-		__trace_mark(0, list_module, call_data,
+		__trace_mark(0, module_state, list_module, call_data,
 				"name %s state %d refcount %lu",
 				mod->name, mod->state, refcount);
 	}
diff --git a/kernel/softirq.c b/kernel/softirq.c
index dc2f3c2..1e24a60 100644
--- a/kernel/softirq.c
+++ b/kernel/softirq.c
@@ -63,7 +63,7 @@ void ltt_dump_softirq_vec(void *call_data)
 
 	for (i = 0; i < 32; i++) {
 		sprint_symbol(namebuf, (unsigned long)softirq_vec[i].action);
-		__trace_mark(0, statedump_softirq_vec, call_data,
+		__trace_mark(0, softirq_state, softirq_vec, call_data,
 			"id %d address %p symbol %s",
 			i, softirq_vec[i].action, namebuf);
 	}
diff --git a/mm/swapfile.c b/mm/swapfile.c
index aaa657a..5008847 100644
--- a/mm/swapfile.c
+++ b/mm/swapfile.c
@@ -2531,7 +2531,7 @@ void ltt_dump_swap_files(void *call_data)
 		p = swap_info[type];
 		if (!(p->flags & SWP_WRITEOK))
 			continue;
-		__trace_mark(0, statedump_swap_files, call_data,
+		__trace_mark(0, swap_state, statedump_swap_files, call_data,
 			"filp %p vfsmount %p dname %s",
 			p->swap_file, p->swap_file->f_vfsmnt,
 			p->swap_file->f_dentry->d_name.name);
-- 
1.7.0.4

