From e1162edc98a62dc08f9d1e51705b1e47b4598259 Mon Sep 17 00:00:00 2001
From: Mathieu Desnoyers <mathieu.desnoyers@efficios.com>
Date: Thu, 13 May 2010 19:27:47 -0400
Subject: [PATCH 280/390] trace-clock-fix-usage-of-trace-clock-freq-scale-as-a-multiplier

Trace clock - Fix usage of trace_clock_freq_scale() as a multiplier

According to http://www.lttng.org/svn/trunk/lttv, svn revision 3150 commit
log: freq scale is now a divisor

From: Benjamin Poirier <benjamin.poirier@polymtl.ca>
Signed-off-by: Mathieu Desnoyers <mathieu.desnoyers@polymtl.ca>
---
 kernel/trace/trace-clock-32-to-64.c |    8 ++++----
 1 files changed, 4 insertions(+), 4 deletions(-)

diff --git a/kernel/trace/trace-clock-32-to-64.c b/kernel/trace/trace-clock-32-to-64.c
index b1fdceb..701aeb1 100644
--- a/kernel/trace/trace-clock-32-to-64.c
+++ b/kernel/trace/trace-clock-32-to-64.c
@@ -158,10 +158,10 @@ static int __init precalc_stsc_interval(void)
 	u64 rem_freq, rem_interval;
 
 	precalc_expire =
-		__iter_div_u64_rem(HW_BITMASK,
-		 ((__iter_div_u64_rem(trace_clock_frequency(), HZ, &rem_freq)
-		     * trace_clock_freq_scale())
-		    << 1)
+		__iter_div_u64_rem(HW_BITMASK, (
+		  __iter_div_u64_rem(trace_clock_frequency(),
+		  HZ * trace_clock_freq_scale(), &rem_freq) << 1
+		 )
 		 - 1
 		 - (TC_EXPECTED_INTERRUPT_LATENCY * HZ / 1000), &rem_interval)
 		>> 1;
-- 
1.6.5.2

