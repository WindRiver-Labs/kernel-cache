From a8830584b07a6b10cc873b9e1b5716ea23eb5915 Mon Sep 17 00:00:00 2001
From: Mathieu Desnoyers <mathieu.desnoyers@efficios.com>
Date: Thu, 13 May 2010 19:27:16 -0400
Subject: [PATCH 222/391] rculist-add-for-each-entry-without-prefetch

rculist add for_each_entry without prefetch

Useful for iteration on small lists, where prefetch is slower.

Signed-off-by: Mathieu Desnoyers <mathieu.desnoyers@polymtl.ca>
---
 include/linux/rculist.h |    5 +++++
 1 files changed, 5 insertions(+), 0 deletions(-)

diff --git a/include/linux/rculist.h b/include/linux/rculist.h
index 2c9b46c..a23c511 100644
--- a/include/linux/rculist.h
+++ b/include/linux/rculist.h
@@ -229,6 +229,11 @@ static inline void list_splice_init_rcu(struct list_head *list,
 		pos != (head); \
 		pos = rcu_dereference_raw(pos->next))
 
+#define __list_for_each_entry_rcu(pos, head, member) \
+	for (pos = list_entry(rcu_dereference((head)->next), typeof(*pos), member); \
+		&pos->member != (head); \
+		pos = list_entry(rcu_dereference(pos->member.next), typeof(*pos), member))
+
 /**
  * list_for_each_entry_rcu	-	iterate over rcu list of given type
  * @pos:	the type * to use as a loop cursor.
-- 
1.6.5.2

