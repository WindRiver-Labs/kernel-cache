From d43b567dac6255ee56ac56da14c693187bb1c23f Mon Sep 17 00:00:00 2001
From: Yang Shi <yang.shi@windriver.com>
Date: Thu, 10 May 2012 14:33:27 -0700
Subject: [PATCH 194/248] markers-align-on-128-bytes

Ensure the compiler (happily aligning the marker structure on the struct size)
and the linker scripts are in sync.

Signed-off-by: Mathieu Desnoyers <mathieu.desnoyers@efficios.com>
---
 include/asm-generic/vmlinux.lds.h |    2 +-
 include/linux/marker.h            |    7 ++++++-
 2 files changed, 7 insertions(+), 2 deletions(-)

diff --git a/include/asm-generic/vmlinux.lds.h b/include/asm-generic/vmlinux.lds.h
index b8dcb57..e349920 100644
--- a/include/asm-generic/vmlinux.lds.h
+++ b/include/asm-generic/vmlinux.lds.h
@@ -168,7 +168,7 @@
 	MEM_KEEP(init.data)						\
 	MEM_KEEP(exit.data)						\
 	*(.data.unlikely)						\
-	. = ALIGN(8);							\
+	. = ALIGN(128);							\
 	VMLINUX_SYMBOL(__start___markers) = .;				\
 	*(__markers)							\
 	VMLINUX_SYMBOL(__stop___markers) = .;				\
diff --git a/include/linux/marker.h b/include/linux/marker.h
index 0a6d53f..440692f 100644
--- a/include/linux/marker.h
+++ b/include/linux/marker.h
@@ -58,7 +58,12 @@ struct marker {
 	struct marker_probe_array *multi;
 	const char *tp_name;	/* Optional tracepoint name */
 	void *tp_cb;		/* Optional tracepoint callback */
-} __attribute__((aligned(8)));
+} __attribute__((aligned(128)));	/*
+					 * Aligned on 128 bytes because it is
+					 * globally visible and gcc happily
+					 * align these on the structure size.
+					 * Keep in sync with vmlinux.lds.h.
+					 */
 
 #ifdef CONFIG_MARKERS
 
-- 
1.7.0.4

