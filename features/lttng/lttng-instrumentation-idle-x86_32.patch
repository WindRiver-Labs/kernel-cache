From 6016bc559223633a3fa2771b3c28e454b027f1df Mon Sep 17 00:00:00 2001
From: Mathieu Desnoyers <mathieu.desnoyers@efficios.com>
Date: Thu, 13 May 2010 19:28:00 -0400
Subject: [PATCH 306/391] lttng-instrumentation-idle-x86_32

lttng instrumentation idle x86_32

Signed-off-by: Mathieu Desnoyers <mathieu.desnoyers@efficios.com>
---
 arch/x86/kernel/process_32.c |    6 ++++++
 1 files changed, 6 insertions(+), 0 deletions(-)

diff --git a/arch/x86/kernel/process_32.c b/arch/x86/kernel/process_32.c
index 0b2716a..b9a72d3 100644
--- a/arch/x86/kernel/process_32.c
+++ b/arch/x86/kernel/process_32.c
@@ -40,6 +40,7 @@
 #include <linux/kdebug.h>
 #include <linux/notifier.h>
 #include <linux/idle.h>
+#include <trace/pm.h>
 
 #include <asm/pgtable.h>
 #include <asm/system.h>
@@ -62,11 +63,15 @@
 
 asmlinkage void ret_from_fork(void) __asm__("ret_from_fork");
 
+DEFINE_TRACE(pm_idle_exit);
+DEFINE_TRACE(pm_idle_entry);
+
 static DEFINE_PER_CPU(unsigned char, is_idle);
 
 void enter_idle(void)
 {
 	percpu_write(is_idle, 1);
+	trace_pm_idle_entry();
 	notify_idle(IDLE_START);
 }
 
@@ -75,6 +80,7 @@ static void __exit_idle(void)
 	if (x86_test_and_clear_bit_percpu(0, is_idle) == 0)
 		return;
 	notify_idle(IDLE_END);
+	trace_pm_idle_exit();
 }
 
 /* Called from interrupts to signify idle end */
-- 
1.6.5.2

