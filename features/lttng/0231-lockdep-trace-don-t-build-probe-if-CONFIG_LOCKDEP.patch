From db104ce9ff8a1e46e9b1dce8f7c8ae046710d658 Mon Sep 17 00:00:00 2001
From: Mathieu Desnoyers <mathieu.desnoyers@polymtl.ca>
Date: Thu, 17 Mar 2011 09:09:10 -0400
Subject: [PATCH 231/248] lockdep trace: don't build probe if !CONFIG_LOCKDEP

Signed-off-by: Mathieu Desnoyers <mathieu.desnoyers@efficios.com>
---
 ltt/probes/Makefile |   10 ++++++++--
 1 files changed, 8 insertions(+), 2 deletions(-)

diff --git a/ltt/probes/Makefile b/ltt/probes/Makefile
index bb3aca7..c6f762b 100644
--- a/ltt/probes/Makefile
+++ b/ltt/probes/Makefile
@@ -5,16 +5,22 @@ CFLAGS_REMOVE_kernel-trace.o = -pg
 CFLAGS_REMOVE_mm-trace.o = -pg
 CFLAGS_REMOVE_fs-trace.o = -pg
 CFLAGS_REMOVE_ipc-trace.o = -pg
-CFLAGS_REMOVE_lockdep-trace.o = -pg
 CFLAGS_REMOVE_rcu-trace.o = -pg
 CFLAGS_REMOVE_syscall-trace.o = -pg
 CFLAGS_REMOVE_trap-trace.o = -pg
 CFLAGS_REMOVE_pm-trace.o = -pg
 endif
 
-obj-m += kernel-trace.o mm-trace.o fs-trace.o ipc-trace.o lockdep-trace.o \
+obj-m += kernel-trace.o mm-trace.o fs-trace.o ipc-trace.o \
 	 rcu-trace.o syscall-trace.o trap-trace.o pm-trace.o
 
+ifdef CONFIG_LOCKDEP
+ifdef CONFIG_FTRACE
+CFLAGS_REMOVE_lockdep-trace.o = -pg
+endif
+obj-m += lockdep-trace.o
+endif
+
 ifeq ($(CONFIG_NET),y)
 ifdef CONFIG_FTRACE
 CFLAGS_REMOVE_net-trace.o = -pg
-- 
1.7.0.4

