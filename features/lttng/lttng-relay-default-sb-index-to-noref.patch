From d89cd5a0e818169f69546d2c0b7b422d92d9c1a6 Mon Sep 17 00:00:00 2001
From: Mathieu Desnoyers <mathieu.desnoyers@efficios.com>
Date: Thu, 13 May 2010 19:27:44 -0400
Subject: [PATCH 273/390] lttng-relay-default-sb-index-to-noref

LTTng relay default sb index to noref

Signed-off-by: Mathieu Desnoyers <mathieu.desnoyers@polymtl.ca>
---
 ltt/ltt-relay-alloc.c |    2 ++
 1 files changed, 2 insertions(+), 0 deletions(-)

diff --git a/ltt/ltt-relay-alloc.c b/ltt/ltt-relay-alloc.c
index ae00c20..ef9f78e 100644
--- a/ltt/ltt-relay-alloc.c
+++ b/ltt/ltt-relay-alloc.c
@@ -107,6 +107,7 @@ static int relay_alloc_buf(struct rchan_buf *buf, size_t *size,
 			buf->rchan_wsb[i].pages[j].page = pages[page_idx];
 			page_idx++;
 		}
+		RCHAN_SB_SET_NOREF(buf->rchan_wsb[i].pages);
 	}
 
 	if (extra_reader_sb) {
@@ -116,6 +117,7 @@ static int relay_alloc_buf(struct rchan_buf *buf, size_t *size,
 			buf->rchan_rsb.pages[j].page = pages[page_idx];
 			page_idx++;
 		}
+		RCHAN_SB_SET_NOREF(buf->rchan_rsb.pages);
 	}
 
 	/*
-- 
1.6.5.2

