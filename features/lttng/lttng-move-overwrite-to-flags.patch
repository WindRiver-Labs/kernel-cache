From 8a727421c1958f1bffc287bab7bd6a9c28209283 Mon Sep 17 00:00:00 2001
From: Mathieu Desnoyers <mathieu.desnoyers@polymtl.ca>
Date: Fri, 9 Jan 2009 10:00:22 -0500
Subject: [PATCH] lttng-move-overwrite-to-flags

So we can save many attribute bits in it.
For support new "ENABLED" bit.

Signed-off-by: Zhao lei <zhaolei@cn.fujitsu.com>
---
 include/linux/ltt-tracer.h |    5 ++++-
 ltt/ltt-tracer.c           |   10 ++++++++--
 2 files changed, 12 insertions(+), 3 deletions(-)

diff --git a/include/linux/ltt-tracer.h b/include/linux/ltt-tracer.h
index 9ae8a35..0d8a317 100644
--- a/include/linux/ltt-tracer.h
+++ b/include/linux/ltt-tracer.h
@@ -217,6 +217,9 @@ enum ltt_channels {
 
 enum trace_mode { LTT_TRACE_NORMAL, LTT_TRACE_FLIGHT, LTT_TRACE_HYBRID };
 
+#define CHANNEL_FLAG_ENABLE	(1U<<0)
+#define CHANNEL_FLAG_OVERWRITE	(1U<<1)
+
 /* Per-trace information - each trace/flight recorder represented by one */
 struct ltt_trace_struct {
 	/* First 32 bytes cache-hot cacheline */
@@ -239,7 +242,7 @@ struct ltt_trace_struct {
 		struct {
 			unsigned subbuf_size;
 			unsigned subbuf_cnt;
-			unsigned overwrite;
+			unsigned flags;
 		} channels[NR_LTT_CHANNELS];
 	} setting;
 	u32 freq_scale;
diff --git a/ltt/ltt-tracer.c b/ltt/ltt-tracer.c
index 16ffccc..dd0dc57 100644
--- a/ltt/ltt-tracer.c
+++ b/ltt/ltt-tracer.c
@@ -568,7 +568,12 @@ int ltt_trace_set_channel_overwrite(const char *trace_name,
 		goto traces_error;
 	}
 
-	trace->setting.channels[channel].overwrite = !!overwrite;
+	if (overwrite)
+		trace->setting.channels[channel].flags |=
+			CHANNEL_FLAG_OVERWRITE;
+	else
+		trace->setting.channels[channel].flags &=
+			~CHANNEL_FLAG_OVERWRITE;
 
 traces_error:
 	ltt_unlock_traces();
@@ -649,7 +654,8 @@ int ltt_trace_alloc(const char *trace_name)
 				+ chan_infos[chan].channel_index),
 				subbuf_size,
 				subbuf_cnt,
-				trace->setting.channels[chan].overwrite);
+				trace->setting.channels[chan].flags
+					& CHANNEL_FLAG_OVERWRITE);
 		if (err != 0) {
 			printk(KERN_ERR	"LTT : Can't create channel %s.\n",
 				chan_infos[chan].name);
-- 
1.6.0.4

