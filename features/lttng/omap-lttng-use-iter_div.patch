From e31993721dea105e91f6ebefbaf861e130652e2c Mon Sep 17 00:00:00 2001
From: Mathieu Desnoyers <mathieu.desnoyers@efficios.com>
Date: Thu, 13 May 2010 19:26:50 -0400
Subject: [PATCH 176/390] omap-lttng-use-iter_div

omap lttng use iter div

ARM does no seem to like u64 div in math64.h. Use the "iter" version.

Signed-off-by: Mathieu Desnoyers <mathieu.desnoyers@polymtl.ca>
---
 kernel/trace/trace-clock-32-to-64.c |    8 +++++---
 1 files changed, 5 insertions(+), 3 deletions(-)

diff --git a/kernel/trace/trace-clock-32-to-64.c b/kernel/trace/trace-clock-32-to-64.c
index 3134e47..11d961d 100644
--- a/kernel/trace/trace-clock-32-to-64.c
+++ b/kernel/trace/trace-clock-32-to-64.c
@@ -153,13 +153,15 @@ static void tsc_timer_fct(unsigned long data)
  */
 static int __init precalc_stsc_interval(void)
 {
+	u64 rem_freq, rem_interval;
+
 	precalc_expire =
-		div_u64(HW_BITMASK,
-		 ((div_u64(trace_clock_frequency(), HZ)
+		__iter_div_u64_rem(HW_BITMASK,
+		 ((__iter_div_u64_rem(trace_clock_frequency(), HZ, &rem_freq)
 		     * trace_clock_freq_scale())
 		    << 1)
 		 - 1
-		 - (EXPECTED_INTERRUPT_LATENCY * HZ / 1000))
+		 - (EXPECTED_INTERRUPT_LATENCY * HZ / 1000), &rem_interval)
 		>> 1;
 	WARN_ON(precalc_expire == 0);
 	printk(KERN_DEBUG "Synthetic TSC timer will fire each %u jiffies.\n",
-- 
1.6.5.2

