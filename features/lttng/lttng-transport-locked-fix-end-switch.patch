From e07acabd696a386e37fc3be43fd477132121ee58 Mon Sep 17 00:00:00 2001
From: Mathieu Desnoyers <mathieu.desnoyers@efficios.com>
Date: Thu, 13 May 2010 19:27:17 -0400
Subject: [PATCH 224/391] lttng-transport-locked-fix-end-switch

LTTng relay locked switch offset use same as lockless

Signed-off-by: Mathieu Desnoyers <mathieu.desnoyers@polymtl.ca>
---
 ltt/ltt-relay-locked.c |    2 +-
 1 files changed, 1 insertions(+), 1 deletions(-)

diff --git a/ltt/ltt-relay-locked.c b/ltt/ltt-relay-locked.c
index 2c2e389..f7a89db 100644
--- a/ltt/ltt-relay-locked.c
+++ b/ltt/ltt-relay-locked.c
@@ -1195,7 +1195,7 @@ static void ltt_reserve_switch_new_subbuf(
 	ltt_buf->commit_count[beginidx] += ltt_subbuffer_header_size();
 	offsets->commit_count = ltt_buf->commit_count[beginidx];
 	/* Check if the written buffer has to be delivered */
-	if (unlikely((BUFFER_TRUNC(offsets->end - 1, rchan)
+	if (unlikely((BUFFER_TRUNC(offsets->begin, rchan)
 			>> ltt_channel->n_subbufs_order)
 			- ((offsets->commit_count - rchan->subbuf_size)
 			   & ltt_channel->commit_count_mask) == 0))
-- 
1.6.5.2

