From 3c915f1696fea4166292faeb61f6f6c94e4387aa Mon Sep 17 00:00:00 2001
From: Thomas Gleixner <tglx@linutronix.de>
Date: Sun, 19 Jul 2009 11:10:50 +0200
Subject: [PATCH 04/22] genirq: use spin_lock_irqsave instead of open coding it.

commit 8fefc0fb875f65ec701e8c817dd91c1c6788860e from linux-2.6-git

Signed-off-by: Thomas Gleixner <tglx@linutronix.de>
[raw_* instead of atomic_* changes]
Integrated-by: Mark Asselstine <mark.asselstine@windriver.com>
---
 kernel/irq/spurious.c |    3 +--
 1 files changed, 1 insertions(+), 2 deletions(-)

diff --git a/kernel/irq/spurious.c b/kernel/irq/spurious.c
index 89fb90a..0674644 100644
--- a/kernel/irq/spurious.c
+++ b/kernel/irq/spurious.c
@@ -54,9 +54,8 @@ static int try_one_irq(int irq, struct irq_desc *desc)
 		}
 		action = action->next;
 	}
-	local_irq_disable();
 	/* Now clean up the flags */
-	raw_spin_lock(&desc->lock);
+	raw_spin_lock_irq(&desc->lock);
 	action = desc->action;
 
 	/*
-- 
1.7.0

