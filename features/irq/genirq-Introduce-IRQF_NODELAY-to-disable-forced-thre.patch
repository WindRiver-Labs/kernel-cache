From d4311ab29bf0d22e422286289a5c4d50fbcbe2f5 Mon Sep 17 00:00:00 2001
From: Thomas Gleixner <tglx@linutronix.de>
Date: Fri, 24 Jul 2009 12:58:11 +0200
Subject: [PATCH 01/22] genirq: Introduce IRQF_NODELAY to disable forced threading for an irq

commit 73a269a0cfccbb16c4926ec9f8f6414177424596 from linux-2.6-tip

Add the IRQF_NODELAY flag and implicitely mark all timer interrupts
IRQF_NODELAY by redefining IRQF_TIMER.

Signed-off-by: Thomas Gleixner <tglx@linutronix.de>
[Adjusted offset as IRQF_ONESHOT has been introduced since 2.6.33]
Integrated-by: Mark Asselstine <mark.asselstine@windriver.com>
---
 include/linux/interrupt.h |    6 +++++-
 1 files changed, 5 insertions(+), 1 deletions(-)

diff --git a/include/linux/interrupt.h b/include/linux/interrupt.h
index 75f3f00..29ab25d 100644
--- a/include/linux/interrupt.h
+++ b/include/linux/interrupt.h
@@ -52,16 +52,20 @@
  * IRQF_ONESHOT - Interrupt is not reenabled after the hardirq handler finished.
  *                Used by threaded interrupts which need to keep the
  *                irq line disabled until the threaded handler has been run.
+ * IRQF_NODELAY - Interrupt is not force threaded
  */
 #define IRQF_DISABLED		0x00000020
 #define IRQF_SAMPLE_RANDOM	0x00000040
 #define IRQF_SHARED		0x00000080
 #define IRQF_PROBE_SHARED	0x00000100
-#define IRQF_TIMER		0x00000200
+#define __IRQF_TIMER		0x00000200
 #define IRQF_PERCPU		0x00000400
 #define IRQF_NOBALANCING	0x00000800
 #define IRQF_IRQPOLL		0x00001000
 #define IRQF_ONESHOT		0x00002000
+#define IRQF_NODELAY		0x00004000
+
+#define IRQF_TIMER		(__IRQF_TIMER | IRQF_NODELAY)
 
 /*
  * Bits used by threaded handlers:
-- 
1.7.0

