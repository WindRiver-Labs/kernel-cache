From 04273711886c914fb826f4bd4ec727e84f7d71b7 Mon Sep 17 00:00:00 2001
From: Mark Asselstine <mark.asselstine@windriver.com>
Date: Tue, 6 Jul 2010 13:13:08 -0700
Subject: [PATCH 2/4] genirq: cavium octeon_cn56xx: prevent threading of interrupts

Various irq handlers have been shown to not function correctly when
handled in threads. Add IRQF_NODELAY to prevent threading.

Signed-off-by: Mark Asselstine <mark.asselstine@windriver.com>
---
 drivers/i2c/busses/i2c-octeon.c  |    2 +-
 drivers/net/octeon/octeon_mgmt.c |    2 +-
 2 files changed, 2 insertions(+), 2 deletions(-)

diff --git a/drivers/i2c/busses/i2c-octeon.c b/drivers/i2c/busses/i2c-octeon.c
index 0e9f85d..5cf1bbd 100644
--- a/drivers/i2c/busses/i2c-octeon.c
+++ b/drivers/i2c/busses/i2c-octeon.c
@@ -561,7 +561,7 @@ static int __devinit octeon_i2c_probe(struct platform_device *pdev)
 
 	i2c->irq = irq;
 
-	result = request_irq(i2c->irq, octeon_i2c_isr, 0, DRV_NAME, i2c);
+	result = request_irq(i2c->irq, octeon_i2c_isr, IRQF_NODELAY, DRV_NAME, i2c);
 	if (result < 0) {
 		dev_err(i2c->dev, "failed to attach interrupt\n");
 		goto fail_irq;
diff --git a/drivers/net/octeon/octeon_mgmt.c b/drivers/net/octeon/octeon_mgmt.c
index 8aadc8e..e21e4a8 100644
--- a/drivers/net/octeon/octeon_mgmt.c
+++ b/drivers/net/octeon/octeon_mgmt.c
@@ -821,7 +821,7 @@ static int octeon_mgmt_open(struct net_device *netdev)
 	/* Clear any pending interrupts */
 	cvmx_write_csr(CVMX_MIXX_ISR(port), cvmx_read_csr(CVMX_MIXX_ISR(port)));
 
-	if (request_irq(p->irq, octeon_mgmt_interrupt, 0, netdev->name,
+	if (request_irq(p->irq, octeon_mgmt_interrupt, IRQF_NODELAY, netdev->name,
 			netdev)) {
 		dev_err(p->dev, "request_irq(%d) failed.\n", p->irq);
 		goto err_noirq;
-- 
1.6.5.2

