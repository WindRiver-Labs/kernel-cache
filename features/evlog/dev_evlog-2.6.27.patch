From 1b07571939a83016a797e2f1aef253db0f827ce2 Mon Sep 17 00:00:00 2001
From: Yongli He <yongli.he@windriver.com>
Date: Mon, 25 Aug 2008 16:56:26 +0800
Subject: [PATCH] dev evlog for 2.6.27

let dev_printk use the event log facility.

Integrated-by: Yongli he   <yongli.he@windriver.com>
Signed-off-by: MacDonald, Joe <Joe.MacDonald@windriver.com>
---
 include/linux/device.h |   10 ++++++++++
 1 files changed, 10 insertions(+), 0 deletions(-)

diff --git a/include/linux/device.h b/include/linux/device.h
index be80aaa..cb2060b 100644
--- a/include/linux/device.h
+++ b/include/linux/device.h
@@ -520,9 +520,19 @@ extern void sysdev_shutdown(void);
 
 /* debugging and troubleshooting/diagnostic helpers. */
 extern const char *dev_driver_string(const struct device *dev);
+#ifdef CONFIG_EVLOG
+#include <linux/evlog.h>
+#define dev_printk(level, dev, format, arg...)  \
+	do { \
+		printk(level "%s %s: " format , dev_driver_string(dev) , (dev)->bus_id , ## arg); \
+		evl_printk(dev_driver_string(dev) , 0, (level[1]-'0') , \
+		"%s %s: " format , dev_driver_string(dev) , (dev)->bus_id , ## arg); \
+	} while (0)
+#else
 #define dev_printk(level, dev, format, arg...)	\
 	printk(level "%s %s: " format , dev_driver_string(dev) , \
 	       dev_name(dev) , ## arg)
+#endif
 
 #define dev_emerg(dev, format, arg...)		\
 	dev_printk(KERN_EMERG , dev , format , ## arg)
-- 
1.5.5.1

