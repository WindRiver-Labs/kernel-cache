From 94ecf889a5e438ced913d12d464df4dd1815f9f3 Mon Sep 17 00:00:00 2001
From: Denis Oliver Kropp <dok@shizo.zion.home>
Date: Sun, 12 Aug 2007 16:45:40 +0200
Subject: [PATCH] Show total number of dispatches in stat.

---
 drivers/char/fusion/fusiondev.c |    5 +++--
 drivers/char/fusion/fusiondev.h |    1 +
 drivers/char/fusion/reactor.c   |    2 ++
 3 files changed, 6 insertions(+), 2 deletions(-)

diff --git a/drivers/char/fusion/fusiondev.c b/drivers/char/fusion/fusiondev.c
index aa4d409..223e0da 100644
--- a/drivers/char/fusion/fusiondev.c
+++ b/drivers/char/fusion/fusiondev.c
@@ -142,7 +142,7 @@ fusiondev_stat_read_proc(char *buf, char **start, off_t offset,
      int        written = 0;
 
      written += snprintf( buf, len,
-                          "lease/purchase   cede      attach     detach      "
+                          "lease/purchase   cede      attach     detach   dispatch      "
                           "ref up   ref down  prevail/swoop dismiss\n" );
      if (written < offset) {
           offset -= written;
@@ -151,11 +151,12 @@ fusiondev_stat_read_proc(char *buf, char **start, off_t offset,
 
      if (written < len) {
           written += snprintf( buf+written, len - written,
-                               "%10d %10d  %10d %10d  %10d %10d  %10d %10d\n",
+                               "%10d %10d  %10d %10d %10d  %10d %10d  %10d %10d\n",
                                dev->stat.property_lease_purchase,
                                dev->stat.property_cede,
                                dev->stat.reactor_attach,
                                dev->stat.reactor_detach,
+                               dev->stat.reactor_dispatch,
                                dev->stat.ref_up,
                                dev->stat.ref_down,
                                dev->stat.skirmish_prevail_swoop,
diff --git a/drivers/char/fusion/fusiondev.h b/drivers/char/fusion/fusiondev.h
index 73c972f..c61c9f0 100644
--- a/drivers/char/fusion/fusiondev.h
+++ b/drivers/char/fusion/fusiondev.h
@@ -41,6 +41,7 @@ struct __Fusion_FusionDev {
 
           int reactor_attach;
           int reactor_detach;
+          int reactor_dispatch;
 
           int ref_up;
           int ref_down;
diff --git a/drivers/char/fusion/reactor.c b/drivers/char/fusion/reactor.c
index 0a75232..3d59cb8 100644
--- a/drivers/char/fusion/reactor.c
+++ b/drivers/char/fusion/reactor.c
@@ -352,6 +352,8 @@ fusion_reactor_dispatch (FusionDev *dev, int id, int channel, Fusionee *fusionee
 
      reactor->dispatch_count++;
 
+     dev->stat.reactor_dispatch++;
+
      fusion_list_foreach (l, reactor->nodes) {
           ReactorNode *node = (ReactorNode *) l;
 
-- 
1.7.3.3

