From b27a6f651feee12048b004ecb1e08ae4cf71e328 Mon Sep 17 00:00:00 2001
From: Denis Oliver Kropp <dok@directfb.org>
Date: Wed, 18 Aug 2004 14:09:42 +0000
Subject: [PATCH] Added FUSION_ASSUME(exp) to use instead of FUSION_ASSERT(exp) at some places.

---
 drivers/char/fusion/entries.c   |    8 ++++----
 drivers/char/fusion/fusiondev.h |    1 +
 2 files changed, 5 insertions(+), 4 deletions(-)

diff --git a/drivers/char/fusion/entries.c b/drivers/char/fusion/entries.c
index 70b9b13..9654f6d 100644
--- a/drivers/char/fusion/entries.c
+++ b/drivers/char/fusion/entries.c
@@ -197,7 +197,7 @@ fusion_entry_lock( FusionEntries  *entries,
           return -EINVAL;
      }
 
-     FUSION_ASSERT( entry->lock_pid != current->pid );
+     FUSION_ASSUME( entry->lock_pid != current->pid );
 
      /* Move the entry to the front of all entries. */
      fusion_list_move_to_front( &entries->list, &entry->link );
@@ -224,7 +224,7 @@ void
 fusion_entry_unlock( FusionEntry *entry )
 {
      FUSION_ASSERT( entry != NULL );
-     FUSION_ASSERT( entry->lock_pid == current->pid );
+     FUSION_ASSUME( entry->lock_pid == current->pid );
 
      entry->lock_pid = 0;
 
@@ -242,7 +242,7 @@ fusion_entry_wait( FusionEntry *entry, long *timeout )
 
      FUSION_ASSERT( entry != NULL );
      FUSION_ASSERT( entry->entries != NULL );
-     FUSION_ASSERT( entry->lock_pid == current->pid );
+     FUSION_ASSUME( entry->lock_pid == current->pid );
 
      id      = entry->id;
      entries = entry->entries;
@@ -272,7 +272,7 @@ void
 fusion_entry_notify( FusionEntry *entry, bool all )
 {
      FUSION_ASSERT( entry != NULL );
-     FUSION_ASSERT( entry->lock_pid == current->pid );
+     FUSION_ASSUME( entry->lock_pid == current->pid );
 
      if (all)
           wake_up_interruptible_all( &entry->wait );
diff --git a/drivers/char/fusion/fusiondev.h b/drivers/char/fusion/fusiondev.h
index a5979d5..8d17fe3 100644
--- a/drivers/char/fusion/fusiondev.h
+++ b/drivers/char/fusion/fusiondev.h
@@ -21,6 +21,7 @@
 #include "list.h"
 
 #define FUSION_ASSERT(exp)    if (!(exp)) BUG()
+#define FUSION_ASSUME(exp)    if (!(exp)) printk( KERN_ERR "fusiondev: assumption '" #exp "' failed!\n" )
 
 typedef struct {
      int refs;
-- 
1.7.3.3

