From 220dbea2cd7d50a3cec4c416dd468933309c7d32 Mon Sep 17 00:00:00 2001
From: Denis Oliver Kropp <dok@directfb.org>
Date: Wed, 1 Mar 2006 04:16:37 +0000
Subject: [PATCH] Added FusionCallExecFlags featuring FCEF_ONEWAY which makes the caller return immediately after queueing the messages, not waiting for any response, making the call asynchronous, like a dispatch via a reactor.

---
 drivers/char/fusion/call.c |    2 +-
 include/linux/fusion.h     |   10 +++++++++-
 2 files changed, 10 insertions(+), 2 deletions(-)

diff --git a/drivers/char/fusion/call.c b/drivers/char/fusion/call.c
index b2c0c9a..1644a5e 100644
--- a/drivers/char/fusion/call.c
+++ b/drivers/char/fusion/call.c
@@ -233,7 +233,7 @@ fusion_call_execute (FusionDev *dev, int fusion_id, FusionCallExecute *execute)
 
      call->count++;
 
-     if (fusion_id) {
+     if (fusion_id && !(execute->flags & FCEF_ONEWAY)) {
           /* TODO: implement timeout */
           fusion_sleep_on (&execution->wait, &call->lock, 0);
 
diff --git a/include/linux/fusion.h b/include/linux/fusion.h
index ea525c9..f6b9e8b 100644
--- a/include/linux/fusion.h
+++ b/include/linux/fusion.h
@@ -7,7 +7,7 @@
 /*
  * Fusion Kernel Device API Version
  */
-#define FUSION_API_MAJOR      2         /* Increased if backward compatibility is dropped. */
+#define FUSION_API_MAJOR      3         /* Increased if backward compatibility is dropped. */
 #define FUSION_API_MINOR      0         /* Increased if new features are added. */
 
 /*
@@ -81,6 +81,12 @@ typedef struct {
      void               *ctx;           /* optional handler context */
 } FusionCallNew;
 
+typedef enum {
+     FCEF_NONE   = 0x00000000,
+     FCEF_ONEWAY = 0x00000001,
+     FCEF_ALL    = 0x00000001
+} FusionCallExecFlags;
+
 typedef struct {
      int                 ret_val;       /* return value of the call */
 
@@ -88,6 +94,8 @@ typedef struct {
 
      int                 call_arg;      /* optional int argument */
      void               *call_ptr;      /* optional pointer argument (shared memory) */
+
+     FusionCallExecFlags flags;         /* execution flags */
 } FusionCallExecute;
 
 typedef struct {
-- 
1.7.3.3

