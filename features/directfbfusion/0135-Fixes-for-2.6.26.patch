From b7d47b969a1f72d3c194d78b0974315b77fa54a2 Mon Sep 17 00:00:00 2001
From: Denis Oliver Kropp <dok@shark.directfb.home>
Date: Sat, 31 May 2008 17:01:51 +0200
Subject: [PATCH] Fixes for 2.6.26.

---
 drivers/char/fusion/entries.h   |    2 ++
 drivers/char/fusion/fusiondev.c |   11 +++++++++--
 2 files changed, 11 insertions(+), 2 deletions(-)

diff --git a/drivers/char/fusion/entries.h b/drivers/char/fusion/entries.h
index 37296c5..7025f94 100644
--- a/drivers/char/fusion/entries.h
+++ b/drivers/char/fusion/entries.h
@@ -15,6 +15,8 @@
 #ifndef __FUSION__ENTRIES_H__
 #define __FUSION__ENTRIES_H__
 
+#include <linux/semaphore.h>
+
 #include "types.h"
 #include "list.h"
 
diff --git a/drivers/char/fusion/fusiondev.c b/drivers/char/fusion/fusiondev.c
index b87f3a6..b818386 100644
--- a/drivers/char/fusion/fusiondev.c
+++ b/drivers/char/fusion/fusiondev.c
@@ -1094,7 +1094,12 @@ register_devices(void)
 #endif
 
      for (i=0; i<NUM_MINORS; i++) {
-#if LINUX_VERSION_CODE >= KERNEL_VERSION(2, 6, 15)
+#if LINUX_VERSION_CODE >= KERNEL_VERSION(2, 6, 26)
+          device_create (fusion_class,
+                         NULL,
+                         MKDEV(FUSION_MAJOR, i),
+                         "fusion%d", i);
+#elif LINUX_VERSION_CODE >= KERNEL_VERSION(2, 6, 15)
           class_device_create (fusion_class,
                                NULL,
                                MKDEV(FUSION_MAJOR, i),
@@ -1169,7 +1174,9 @@ deregister_devices(void)
 
      for (i=0; i<NUM_MINORS; i++) {
 #if LINUX_VERSION_CODE >= KERNEL_VERSION(2, 6, 2)
-#if LINUX_VERSION_CODE >= KERNEL_VERSION(2, 6, 13)
+#if LINUX_VERSION_CODE >= KERNEL_VERSION(2, 6, 26)
+          device_destroy (fusion_class, MKDEV(FUSION_MAJOR, i));
+#elif LINUX_VERSION_CODE >= KERNEL_VERSION(2, 6, 13)
           class_device_destroy (fusion_class, MKDEV(FUSION_MAJOR, i));
 #else
           class_simple_device_remove (MKDEV(FUSION_MAJOR, i));
-- 
1.7.3.3

