From 73bdd8838f87a67d1726610b16cf44925da668e9 Mon Sep 17 00:00:00 2001
From: Niels Roest <niels@directfb.org>
Date: Fri, 10 Oct 2008 15:45:29 +0200
Subject: [PATCH] changes for 2.6.27-rc8 kernel

---
 drivers/char/fusion/fusiondev.c |    7 ++++++-
 drivers/char/fusion/shmpool.c   |    1 +
 2 files changed, 7 insertions(+), 1 deletions(-)

diff --git a/drivers/char/fusion/fusiondev.c b/drivers/char/fusion/fusiondev.c
index b818386..341917b 100644
--- a/drivers/char/fusion/fusiondev.c
+++ b/drivers/char/fusion/fusiondev.c
@@ -1094,7 +1094,12 @@ register_devices(void)
 #endif
 
      for (i=0; i<NUM_MINORS; i++) {
-#if LINUX_VERSION_CODE >= KERNEL_VERSION(2, 6, 26)
+#if LINUX_VERSION_CODE >= KERNEL_VERSION(2, 6, 27)
+          device_create (fusion_class,
+                         NULL,
+                         MKDEV(FUSION_MAJOR, i),
+                         NULL, "fusion%d", i);
+#elif LINUX_VERSION_CODE >= KERNEL_VERSION(2, 6, 26)
           device_create (fusion_class,
                          NULL,
                          MKDEV(FUSION_MAJOR, i),
diff --git a/drivers/char/fusion/shmpool.c b/drivers/char/fusion/shmpool.c
index 4295889..9e96b1d 100644
--- a/drivers/char/fusion/shmpool.c
+++ b/drivers/char/fusion/shmpool.c
@@ -20,6 +20,7 @@
 #include <linux/slab.h>
 #include <linux/smp_lock.h>
 #include <linux/sched.h>
+#include <linux/mm.h>
 
 #include <linux/fusion.h>
 
-- 
1.7.3.3

