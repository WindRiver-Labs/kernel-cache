From 50a661f6f4e807c9d42029f141efb29810b60160 Mon Sep 17 00:00:00 2001
From: Hong H. Pham <hong.pham@windriver.com>
Date: Wed, 5 Nov 2008 18:55:07 -0500
Subject: [PATCH] fix serial poll api warning

Fix a compile warning when CONFIG_SERIAL_POLL_API is not defined, which
results in an error due to -Werror being specified.

This fix could be "folded" in to 0008-serial-direct-user-interface.patch

Signed-off-by: Vu Tran <vu.tran@windriver.com>
Signed-off-by: Hong H. Pham <hong.pham@windriver.com>
---
 include/linux/serial_core.h |   16 +++++++++-------
 1 files changed, 9 insertions(+), 7 deletions(-)

diff --git a/include/linux/serial_core.h b/include/linux/serial_core.h
index a66e074..ddb19a9 100644
--- a/include/linux/serial_core.h
+++ b/include/linux/serial_core.h
@@ -704,24 +704,25 @@ uart_handle_cts_change(struct uart_port *port, unsigned int status)
 
 #include <linux/tty_flip.h>
 
 static inline void
 uart_insert_char(struct uart_port *port, unsigned int status,
 		 unsigned int overrun, unsigned int ch, unsigned int flag)
 {
 	struct tty_struct *tty = port->info->port.tty;
-	struct uart_info *info = port->info;
 
 #ifdef CONFIG_SERIAL_POLL_API
-   if (info->direct) {
-      if (info->direct->handle_char)
-         info->direct->handle_char(port, status, overrun,
-                    ch, flag);
-      return;
+	struct uart_info *info = port->info;
+
+	if (info->direct) {
+		if (info->direct->handle_char)
+			info->direct->handle_char(port, status, overrun,
+			                          ch, flag);
+		return;
    }
 #endif
 
 	if (!tty)
 		return;
 
 	if ((status & port->ignore_status_mask & ~overrun) == 0)
 		tty_insert_flip_char(tty, ch, flag);
@@ -733,19 +734,20 @@ uart_insert_char(struct uart_port *port, unsigned int status,
 	if (status & ~port->ignore_status_mask & overrun)
 		tty_insert_flip_char(tty, 0, TTY_OVERRUN);
 }
 
 static inline void
 uart_push(struct uart_port *port)
 {
 	struct tty_struct *tty = port->info->port.tty;
-	struct uart_info *info = port->info;
 
 #ifdef CONFIG_SERIAL_POLL_API
+	struct uart_info *info = port->info;
+
 	if (info->direct) {
 		if (info->direct->push)
 			info->direct->push(port);
 		return;
 	}
 #endif
 
 	if (!tty)
-- 
1.5.5.1

