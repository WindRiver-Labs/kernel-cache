From af943b02ede321d444cb4227d2304f805c2109bd Mon Sep 17 00:00:00 2001
From: "Roy.Li" <rongqing.li@windriver.com>
Date: Tue, 29 Jan 2013 14:40:25 +0800
Subject: [PATCH] mlock: change do_mlock return code

GRSecurity patch adds a check whether mlock end address is bigger
than TASK_SIZE in do_mlock(), if true, it return -EINVAL which broke
mlock conformance test which expect that mlock/munlock() function
sets errno = ENOMEM if some or all of the address range specified
by the addr and len arguments does not correspond to valid mapped
pages in the address space of the process.

Signed-off-by: Roy.Li <rongqing.li@windriver.com>
---
 mm/mlock.c | 2 +-
 1 file changed, 1 insertion(+), 1 deletion(-)

diff --git a/mm/mlock.c b/mm/mlock.c
index 091d154..55c22d6 100644
--- a/mm/mlock.c
+++ b/mm/mlock.c
@@ -617,7 +617,7 @@ static int do_mlock(unsigned long start, size_t len, int on)
 	if (end == start)
 		return 0;
 	if (end > TASK_SIZE)
-		return -EINVAL;
+		return -ENOMEM;
 
 	vma = find_vma(current->mm, start);
 	if (!vma || vma->vm_start > start)
-- 
2.0.2

