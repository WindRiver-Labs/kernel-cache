From 3b7706c69d0c8f2f4e9c16ba7d1dac621e30d514 Mon Sep 17 00:00:00 2001
From: "Roy.Li" <rongqing.li@windriver.com>
Date: Tue, 29 Jan 2013 14:40:25 +0800
Subject: [PATCH 10/16] mlock: change do_mlock return code

GRSecurity patch adds a check whether mlock end address is bigger
than TASK_SIZE in do_mlock(), if true, it return -EINVAL which broke
mlock conformance test which expect that mlock/munlock() function
sets errno = ENOMEM if some or all of the address range specified
by the addr and len arguments does not correspond to valid mapped
pages in the address space of the process.

Signed-off-by: Roy.Li <rongqing.li@windriver.com>
---
 mm/mlock.c |    2 +-
 1 file changed, 1 insertion(+), 1 deletion(-)

diff --git a/mm/mlock.c b/mm/mlock.c
index 9944291..33e0434 100644
--- a/mm/mlock.c
+++ b/mm/mlock.c
@@ -345,7 +345,7 @@ static int do_mlock(unsigned long start, size_t len, int on)
 	if (end == start)
 		return 0;
 	if (end > TASK_SIZE)
-		return -EINVAL;
+		return -ENOMEM;
 
 	vma = find_vma(current->mm, start);
 	if (!vma || vma->vm_start > start)
-- 
1.7.9.5

