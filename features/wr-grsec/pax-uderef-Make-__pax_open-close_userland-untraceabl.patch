From dd75f71ce315c909625040cb4e41c762e39ac23c Mon Sep 17 00:00:00 2001
From: Yang Shi <yang.shi@windriver.com>
Date: Thu, 15 May 2014 15:18:59 -0700
Subject: [PATCH] pax: uderef: Make __pax_open/close_userland untraceable

According to the comment in arch/x86/mm/uderef_64.c, __pax_open/close_userland
must remain leaf functions under all configurations, if function tracer is
enabled, this condition is not true anymore since they will call mcount to do
function trace.

So, make them untraceable to fulfill the leaf function requirement so that
ftrace could work with PAX_UDEREF at the mean time.

Signed-off-by: Yang Shi <yang.shi@windriver.com>
---
 arch/x86/mm/uderef_64.c | 4 ++--
 1 file changed, 2 insertions(+), 2 deletions(-)

diff --git a/arch/x86/mm/uderef_64.c b/arch/x86/mm/uderef_64.c
index dace51c..89557ba 100644
--- a/arch/x86/mm/uderef_64.c
+++ b/arch/x86/mm/uderef_64.c
@@ -7,7 +7,7 @@
  * - remain leaf functions under all configurations,
  * - never be called directly, only dereferenced from the wrappers.
  */
-void __pax_open_userland(void)
+void notrace __pax_open_userland(void)
 {
 	unsigned int cpu;
 
@@ -21,7 +21,7 @@ void __pax_open_userland(void)
 }
 EXPORT_SYMBOL(__pax_open_userland);
 
-void __pax_close_userland(void)
+void notrace __pax_close_userland(void)
 {
 	unsigned int cpu;
 
-- 
2.0.2

