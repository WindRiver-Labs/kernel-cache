From cfa4a9f12ad33292511869079fdb7efa78f0bf80 Mon Sep 17 00:00:00 2001
From: "Roy.Li" <rongqing.li@windriver.com>
Date: Wed, 14 Jan 2015 14:56:04 -0800
Subject: [PATCH] Define GRSEC_ALLOW_VMCORE

Define GRSEC_ALLOW_VMCORE to allow user to enable VMCORE
when GRSEC is enabled

Signed-off-by: Roy.Li <rongqing.li@windriver.com>
[Adjust context for 3.14 kernel]
Signed-off-by: Yang Shi <yang.shi@windriver.com>
---
 fs/proc/Kconfig | 10 +++++++++-
 1 file changed, 9 insertions(+), 1 deletion(-)

diff --git a/fs/proc/Kconfig b/fs/proc/Kconfig
index 3c32a98..c9ba48b 100644
--- a/fs/proc/Kconfig
+++ b/fs/proc/Kconfig
@@ -36,9 +36,17 @@ config PROC_KCORE
 	  be read with gdb and other ELF tools.  No modifications can be
 	  made using this mechanism.
 
+config GRSEC_ALLOW_VMCORE
+	bool "force /proc/vmcore support when grsec is on"
+	depends on GRKERNSEC
+	default n
+	help
+	/proc/vmcore is normally disabled by the GRSecurity kernel hardening
+	policy. Unless you know you need this feature, you should say N here.
+
 config PROC_VMCORE
 	bool "/proc/vmcore support"
-	depends on PROC_FS && CRASH_DUMP && !GRKERNSEC
+	depends on PROC_FS && CRASH_DUMP && (!GRKERNSEC || GRSEC_ALLOW_VMCORE)
 	default n
         help
         Exports the dump image of crashed kernel in ELF format.
-- 
2.0.2

