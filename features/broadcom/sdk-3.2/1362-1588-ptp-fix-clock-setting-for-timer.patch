From bc916e1502a201c582222a20bb96ab902fc489fa Mon Sep 17 00:00:00 2001
From: Vikas Gupta <vikas.gupta@broadcom.com>
Date: Mon, 21 May 2012 12:57:06 +0530
Subject: [PATCH 1362/1532] 1588-ptp: fix clock setting for timer.

[Based on SDK 3.2]
Signed-off-by: Quanyang Wang <quanyang.wang@windriver.com>
---
 drivers/net/ethernet/broadcom/nae/xlp_nae.c | 7 ++++++-
 1 file changed, 6 insertions(+), 1 deletion(-)

diff --git a/drivers/net/ethernet/broadcom/nae/xlp_nae.c b/drivers/net/ethernet/broadcom/nae/xlp_nae.c
index cd16cb5..ca83cc1 100755
--- a/drivers/net/ethernet/broadcom/nae/xlp_nae.c
+++ b/drivers/net/ethernet/broadcom/nae/xlp_nae.c
@@ -1257,7 +1257,12 @@ static void nlm_xlp_nae_init(void)
 				 priv->cycles.read = nlm_1588_read_clock3;
 
 			priv->cycles.mask = CLOCKSOURCE_MASK(64);
-			priv->cycles.mult = 0x3; /*333MHz*/
+			
+			if(is_nlm_xlp3xx())
+				priv->cycles.mult = 1000/XLP3XX_MAX_NAE_FREQUENCY; /*freq are in Mhz*/
+			else
+				priv->cycles.mult = 0x2; /*500 Mhz*/
+			
 			priv->cycles.shift = 0; 
 		
 			timecounter_init(&priv->clock, &priv->cycles, ktime_to_ns(ktime_get_real()));
-- 
1.9.1

