From aded8804247fb566726f09453cd2503a36de287d Mon Sep 17 00:00:00 2001
From: Vikas Gupta <vikas.gupta@broadcom.com>
Date: Mon, 17 Jun 2013 16:32:23 -0700
Subject: [PATCH 1409/1532] fmn: registering handler according to outputq
 number.

[Based on SDK 3.2]
Signed-off-by: Quanyang Wang <quanyang.wang@windriver.com>
---
 drivers/net/ethernet/broadcom/nae/xlpge_rx.c | 27 ++++++++++++++++++++++++++-
 1 file changed, 26 insertions(+), 1 deletion(-)

diff --git a/drivers/net/ethernet/broadcom/nae/xlpge_rx.c b/drivers/net/ethernet/broadcom/nae/xlpge_rx.c
index 9d0e0df..ced0fec 100644
--- a/drivers/net/ethernet/broadcom/nae/xlpge_rx.c
+++ b/drivers/net/ethernet/broadcom/nae/xlpge_rx.c
@@ -975,13 +975,38 @@ int nlm_xlp_enable_napi(void)
 		return 0;
 	}
 
-	printk("Registering nae msgring handler\n");
+	printk("Registering  poe0->cpu msgring handler\n");
+	if (register_xlp_msgring_handler(XLP_MSG_HANDLE_POE_0,
+		nlm_xlp_nae_msgring_handler, NULL)) {
+		printk("Fatal error! Can't register msgring handler "
+		       "for XLP_MSG_HANDLE_NAE_0\n");
+		return -1;
+	}
+	printk("Registering nae-0 FB msgring handler\n");
 	if (register_xlp_msgring_handler(XLP_MSG_HANDLE_NAE_0,
 		nlm_xlp_nae_msgring_handler, NULL)) {
 		printk("Fatal error! Can't register msgring handler "
 		       "for XLP_MSG_HANDLE_NAE_0\n");
 		return -1;
 	}
+
+	if(is_nlm_xlp9xx()){
+		printk("Registering  poe1->cpu msgring handler\n");
+		if (register_xlp_msgring_handler(XLP_MSG_HANDLE_POE_1,
+			nlm_xlp_nae_msgring_handler, NULL)) {
+			printk("Fatal error! Can't register msgring handler "
+			       "for XLP_MSG_HANDLE_NAE_0\n");
+			return -1;
+		}
+		printk("Registering nae-1 FB msgring handler\n");
+		if (register_xlp_msgring_handler(XLP_MSG_HANDLE_NAE_1,
+			nlm_xlp_nae_msgring_handler, NULL)) {
+			printk("Fatal error! Can't register msgring handler "
+		       	"for XLP_MSG_HANDLE_NAE_0\n");
+			return -1;
+		}
+	}
+
 #ifdef CONFIG_INET_LRO
 	if (enable_lro) {
 		printk("Registering napi final handler\n");
-- 
1.9.1

