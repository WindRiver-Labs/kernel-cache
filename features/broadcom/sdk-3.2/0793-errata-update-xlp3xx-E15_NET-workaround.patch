From 2d45841c528dc40a3bc0a7a8e8279728443185fc Mon Sep 17 00:00:00 2001
From: Lakshan Dias <ldias@broadcom.com>
Date: Fri, 9 Aug 2013 10:01:37 -0700
Subject: [PATCH 0793/1532] errata: update xlp3xx E15_NET workaround

apply workaround for all xlp3xx revisions

remove unnecessary function call for xlp8xx
[Based on SDK 3.2]
Signed-off-by: Quanyang Wang <quanyang.wang@windriver.com>
---
 arch/mips/netlogic/lib/netlib/include/netsoc_nae.h | 2 +-
 arch/mips/netlogic/lib/netlib/src/netsoc_pcs.c     | 3 +--
 arch/mips/netlogic/lib/netlib/src/nlm_hal_nae.c    | 3 +--
 3 files changed, 3 insertions(+), 5 deletions(-)

diff --git a/arch/mips/netlogic/lib/netlib/include/netsoc_nae.h b/arch/mips/netlogic/lib/netlib/include/netsoc_nae.h
index 0448aac..b272d16 100644
--- a/arch/mips/netlogic/lib/netlib/include/netsoc_nae.h
+++ b/arch/mips/netlogic/lib/netlib/include/netsoc_nae.h
@@ -554,7 +554,7 @@ static inline void __netsoc_PMFF_ALL_workaround(nae_t *nae, int block, int lane_
 {
         volatile int val = 0;
 
-        if (is_nlm_xlp3xx_ax() || is_nlm_xlp3xx_b0()) {
+        if (is_nlm_xlp3xx()) {
                 val = __netsoc_read_pma_reg(nae, block, lane_ctrl, SER_GEN1_PWR_DOWN);
                 val = val | SERDES_PMFF_ALL_SET;
                 __netsoc_write_pma_reg(nae, block, lane_ctrl, SER_GEN1_PWR_DOWN, val);
diff --git a/arch/mips/netlogic/lib/netlib/src/netsoc_pcs.c b/arch/mips/netlogic/lib/netlib/src/netsoc_pcs.c
index 6ecc6f0..5a89313 100644
--- a/arch/mips/netlogic/lib/netlib/src/netsoc_pcs.c
+++ b/arch/mips/netlogic/lib/netlib/src/netsoc_pcs.c
@@ -107,7 +107,7 @@ static inline void nlm_hal_PMFF_ALL_workaround(nae_t *nae, int block, int lane_c
 {
         volatile int val = 0;
 
-        if (is_nlm_xlp3xx_ax() || is_nlm_xlp3xx_b0()) {
+        if (is_nlm_xlp3xx()) {
                 val =__netsoc_read_pma_reg(nae, block, lane_ctrl, SER_GEN1_PWR_DOWN);
                 val = val | SERDES_PMFF_ALL_SET;
                 __netsoc_write_pma_reg(nae, block, lane_ctrl, SER_GEN1_PWR_DOWN, val);
@@ -898,7 +898,6 @@ static void __netsoc_xlp_nae_config_lane_gmac(nae_t *nae, int cplx_mask)
                 {
                         if (is_nlm_xlp8xx_bx()) {
                                 xlp3xx_8xxb0_lane_reset_txpll(nae, block, lane_ctrl, PHYMODE_SGMII);
-                                nlm_hal_PMFF_ALL_workaround(nae, block, lane_ctrl);
                         } else {
                                 xlp8xx_ax_lane_reset_txpll(nae, block, lane_ctrl, PHYMODE_SGMII);
                         }
diff --git a/arch/mips/netlogic/lib/netlib/src/nlm_hal_nae.c b/arch/mips/netlogic/lib/netlib/src/nlm_hal_nae.c
index 0dea189..ff61680 100644
--- a/arch/mips/netlogic/lib/netlib/src/nlm_hal_nae.c
+++ b/arch/mips/netlogic/lib/netlib/src/nlm_hal_nae.c
@@ -1185,7 +1185,6 @@ static void xlp_nae_config_lane_gmac(int node, int cplx_mask)
 		{
 			if (is_nlm_xlp8xx_bx()) {
 				xlp3xx_8xxb0_nae_lane_reset_txpll(node, block, lane_ctrl, PHYMODE_SGMII);
-				nlm_hal_PMFF_ALL_workaround(node, block, lane_ctrl);
 			} else {
 				xlp8xx_ax_nae_lane_reset_txpll(node, block, lane_ctrl, PHYMODE_SGMII);
 			}
@@ -4921,7 +4920,7 @@ static inline void nlm_hal_PMFF_ALL_workaround(int node, int block, int lane_ctr
 {
 	volatile int val = 0;
 
-	if (is_nlm_xlp3xx_ax() || is_nlm_xlp3xx_b0()) {
+	if (is_nlm_xlp3xx()) {
 		val = nlm_hal_read_pma_reg(node, block, lane_ctrl, SER_GEN1_PWR_DOWN);
 		val = val | SERDES_PMFF_ALL_SET;
 		nlm_hal_write_pma_reg(node, block, lane_ctrl, SER_GEN1_PWR_DOWN, val);
-- 
1.9.1

