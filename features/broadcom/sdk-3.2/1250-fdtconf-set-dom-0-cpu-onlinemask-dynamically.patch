From 4e8672588eeff24b89da81d9fd0c3f1c62972eed Mon Sep 17 00:00:00 2001
From: Tanmay Jagdale <tanmayj@broadcom.com>
Date: Fri, 17 Oct 2014 11:18:16 +0530
Subject: [PATCH 1250/1532] fdtconf: set dom-0 cpu onlinemask dynamically

If the dom-0 cpu onlinemask is zero or not specified then set the mask
to linux boot up cpu mask.
[Based on SDK 3.2]
Signed-off-by: Quanyang Wang <quanyang.wang@windriver.com>
---
 drivers/misc/netlogic/fdtconf/fdtconf.c | 16 ++++++++++++++++
 1 file changed, 16 insertions(+)

diff --git a/drivers/misc/netlogic/fdtconf/fdtconf.c b/drivers/misc/netlogic/fdtconf/fdtconf.c
index b4ce006..1e4d417 100644
--- a/drivers/misc/netlogic/fdtconf/fdtconf.c
+++ b/drivers/misc/netlogic/fdtconf/fdtconf.c
@@ -96,6 +96,22 @@ static void parse_and_fill_kern_params(void)
 		if (err)
 			dev_err(&fdtdev->dev, "Couldn't set cpumask\n");
 
+		/*
+		 * Set the DOM-0 cpu onlinemask property if not already set.
+		 */
+		node = fdt_path_offset(fdt, "/doms/dom@0/cpu");
+		if (node < 0)
+			return;
+
+		prop = fdt_getprop(fdt, node, "onlinemask", &plen);
+		if ((prop == NULL) || (*prop == 0)) {
+			err = fdt_setprop(fdt, node, "onlinemask", mask,
+					sizeof(mask));
+			if (err)
+				dev_err(&fdtdev->dev, "Could not set dom-0"
+					"onlinemask");
+		}
+
 	} else
 		dev_err(&fdtdev->dev, "kernel-params section missing in fdt\n");
 
-- 
1.9.1

