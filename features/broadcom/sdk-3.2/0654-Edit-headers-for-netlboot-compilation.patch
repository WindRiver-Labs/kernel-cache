From bf5027393a065d66e959730e31d97b7824526f3b Mon Sep 17 00:00:00 2001
From: Nebu Philips <nphilips@netlogicmicro.com>
Date: Tue, 12 Oct 2010 16:45:21 -0700
Subject: [PATCH 0654/1532] Edit headers for netlboot compilation.

[Based on SDK 3.2]
Signed-off-by: Quanyang Wang <quanyang.wang@windriver.com>
---
 libfdt/libfdt_env.h | 19 +++++++++++++------
 1 file changed, 13 insertions(+), 6 deletions(-)

diff --git a/libfdt/libfdt_env.h b/libfdt/libfdt_env.h
index 26c31fb..cede416 100644
--- a/libfdt/libfdt_env.h
+++ b/libfdt/libfdt_env.h
@@ -1,28 +1,35 @@
 #ifndef _LIBFDT_ENV_H
 #define _LIBFDT_ENV_H
 
-#ifdef __XEN__
+#if defined(__XEN__)
 #include <xen/types.h>
 #include <xen/string.h>
+#elif defined(NLM_HAL_NETLBOOT)
+/* NetlBoot uses libfdt, but std includes
+ * conflict with the ones in newlib
+ */
+#include <stddef.h>
+#include <types.h>
+#include <string.h>
 #else
 #include <stddef.h>
 #include <stdint.h>
 #include <string.h>
 #endif
 
-#define _B(n)	((unsigned long long)((uint8_t *)&x)[n])
+#define _BYT(n)	((unsigned long long)((uint8_t *)&x)[n])
 static inline uint32_t fdt32_to_cpu(uint32_t x)
 {
-	return (_B(0) << 24) | (_B(1) << 16) | (_B(2) << 8) | _B(3);
+	return (_BYT(0) << 24) | (_BYT(1) << 16) | (_BYT(2) << 8) | _BYT(3);
 }
 #define cpu_to_fdt32(x) fdt32_to_cpu(x)
 
 static inline uint64_t fdt64_to_cpu(uint64_t x)
 {
-	return (_B(0) << 56) | (_B(1) << 48) | (_B(2) << 40) | (_B(3) << 32)
-		| (_B(4) << 24) | (_B(5) << 16) | (_B(6) << 8) | _B(7);
+	return (_BYT(0) << 56) | (_BYT(1) << 48) | (_BYT(2) << 40) | (_BYT(3) << 32)
+		| (_BYT(4) << 24) | (_BYT(5) << 16) | (_BYT(6) << 8) | _BYT(7);
 }
 #define cpu_to_fdt64(x) fdt64_to_cpu(x)
-#undef _B
+#undef _BYT
 
 #endif /* _LIBFDT_ENV_H */
-- 
1.9.1

