From b7852cadb64bd1e2ae335803f6c78feeab5acd16 Mon Sep 17 00:00:00 2001
From: PUNYA BHEEMESH <bheemesh@broadcom.com>
Date: Fri, 25 Jul 2014 10:52:56 +0530
Subject: [PATCH 0995/1532] netlig: added API to netlib for setting lifo's mask
 for each port which is considered when a packet is received

[Based on SDK 3.2]
Signed-off-by: Quanyang Wang <quanyang.wang@windriver.com>
---
 arch/mips/netlogic/lib/netlib/include/export_sym.h      | 1 +
 arch/mips/netlogic/lib/netlib/include/netsoc_libiface.h | 1 +
 arch/mips/netlogic/lib/netlib/src/netsoc_nae.c          | 6 ++++++
 3 files changed, 8 insertions(+)

diff --git a/arch/mips/netlogic/lib/netlib/include/export_sym.h b/arch/mips/netlogic/lib/netlib/include/export_sym.h
index e434b2d..a361da6 100644
--- a/arch/mips/netlogic/lib/netlib/include/export_sym.h
+++ b/arch/mips/netlogic/lib/netlib/include/export_sym.h
@@ -18,6 +18,7 @@ EXPORT_SYMBOL(netsoc_disable_flow_control);
 EXPORT_SYMBOL(netsoc_flow_control_status);
 EXPORT_SYMBOL(netsoc_set_framesize);
 
+EXPORT_SYMBOL(netsoc_map_interface_to_lifo);
 EXPORT_SYMBOL(netsoc_open_port);
 EXPORT_SYMBOL(netsoc_close_port);
 EXPORT_SYMBOL(netsoc_restart_ucore);
diff --git a/arch/mips/netlogic/lib/netlib/include/netsoc_libiface.h b/arch/mips/netlogic/lib/netlib/include/netsoc_libiface.h
index cc82297..670a90f 100644
--- a/arch/mips/netlogic/lib/netlib/include/netsoc_libiface.h
+++ b/arch/mips/netlogic/lib/netlib/include/netsoc_libiface.h
@@ -557,6 +557,7 @@ extern int netsoc_mac_disable(net_port_t *netport);
 extern int netsoc_mac_enable(net_port_t *netport);
 extern int netsoc_close_port(net_port_t *netport);
 extern net_port_t *netsoc_open_port(nae_t *nae, uint32_t port);
+extern void netsoc_map_interface_to_lifo(nae_t *nae,  int hw_port_id, uint32_t lifo_mask);
 extern int netsoc_set_framesize(net_port_t *netport, uint32_t size);
 extern void netsoc_read_mac_statistics(net_port_t *netport, dev_stat_t *dev_stat);
 
diff --git a/arch/mips/netlogic/lib/netlib/src/netsoc_nae.c b/arch/mips/netlogic/lib/netlib/src/netsoc_nae.c
index 8d63d12..f4531b4 100644
--- a/arch/mips/netlogic/lib/netlib/src/netsoc_nae.c
+++ b/arch/mips/netlogic/lib/netlib/src/netsoc_nae.c
@@ -1593,6 +1593,12 @@ void  __netsoc_setparser_seq_thold(nae_t *nae , int thrs)
 
 }
 
+void netsoc_map_interface_to_lifo(nae_t *nae,  int hw_port_id, uint32_t lifo_mask)
+{
+	if(is_nlm_xlp9xx())
+		netsoc_write_nae_reg(nae->nae_base, UCORE_IFACE_MASK_CFG, ((0x1U << 31) | (0x1U<<24) | ((lifo_mask & 0xffff)  << 8) | (hw_port_id & 0x1f)));
+}
+
 void __netsoc_set_frequency(nae_t *nae, uint32_t frequency)
 {
         const uint64_t mhz = 1000000;
-- 
1.9.1

