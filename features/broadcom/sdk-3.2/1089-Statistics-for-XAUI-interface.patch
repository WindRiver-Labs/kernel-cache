From e972ea9eee046fd8ef9b3a293797d426167c5a89 Mon Sep 17 00:00:00 2001
From: Hareesh Ramachandran <hareesh@london.(none)>
Date: Mon, 7 Nov 2011 06:25:26 -0800
Subject: [PATCH 1089/1532] Statistics for XAUI interface

[Based on SDK 3.2]
Signed-off-by: Quanyang Wang <quanyang.wang@windriver.com>
---
 drivers/misc/netlogic/nae-perf/xlp_hw.c | 34 ++++++++++++++++++++++++++++++---
 1 file changed, 31 insertions(+), 3 deletions(-)

diff --git a/drivers/misc/netlogic/nae-perf/xlp_hw.c b/drivers/misc/netlogic/nae-perf/xlp_hw.c
index 1d6c178..2772576 100755
--- a/drivers/misc/netlogic/nae-perf/xlp_hw.c
+++ b/drivers/misc/netlogic/nae-perf/xlp_hw.c
@@ -326,14 +326,42 @@ static void xlp_get_strings (struct net_device *dev, u32 stringset, u8 *buf)
 void xlp_get_mac_stats(struct net_device *dev, struct net_device_stats *stats)
 {
 	struct dev_data *priv = netdev_priv(dev);
-
-	if (priv->type != SGMII_IF)
-		return;
+	unsigned long long val;
+
+	stats->tx_packets = nlm_hal_read_mac_reg( priv->block, priv->index, TX_PACKET_COUNTER);
+#ifdef CONFIG_64BIT
+	val = nlm_hal_read_mac_reg( priv->block, priv->index, 0x1f);
+	stats->tx_packets |= ( val << 32);
+#endif
+
+	stats->rx_packets = nlm_hal_read_mac_reg( priv->block, priv->index, RX_PACKET_COUNTER);
+#ifdef CONFIG_64BIT
+	val = nlm_hal_read_mac_reg( priv->block, priv->index, 0x1f);
+	stats->rx_packets |= ( val << 32);
+#endif
+
+	stats->tx_bytes = nlm_hal_read_mac_reg( priv->block, priv->index, TX_BYTE_COUNTER);
+#ifdef CONFIG_64BIT
+	val = nlm_hal_read_mac_reg( priv->block, priv->index, 0x1f);
+	stats->tx_bytes |= ( val << 32);
+#endif
+
+	stats->rx_bytes = nlm_hal_read_mac_reg( priv->block, priv->index, RX_BYTE_COUNTER);
+#ifdef CONFIG_64BIT
+	val = nlm_hal_read_mac_reg( priv->block, priv->index, 0x1f);
+	stats->rx_bytes |= ( val << 32);
+#endif
 
 	stats->tx_errors = nlm_hal_read_mac_reg( priv->block, priv->index, TX_FCS_ERROR_COUNTER);
 	stats->rx_dropped = nlm_hal_read_mac_reg( priv->block, priv->index, RX_DROP_PACKET_COUNTER);
 	stats->tx_dropped = nlm_hal_read_mac_reg( priv->block, priv->index, TX_DROP_FRAME_COUNTER);
+
 	stats->multicast = nlm_hal_read_mac_reg( priv->block, priv->index, RX_MULTICAST_PACKET_COUNTER);
+#ifdef CONFIG_64BIT
+	val = nlm_hal_read_mac_reg( priv->block, priv->index, 0x1f);
+	stats->multicast |= ( val << 32);
+#endif
+
 	stats->collisions = nlm_hal_read_mac_reg( priv->block, priv->index, TX_TOTAL_COLLISION_COUNTER);
 	stats->rx_length_errors = nlm_hal_read_mac_reg( priv->block, priv->index, RX_FRAME_LENGTH_ERROR_COUNTER);
 	stats->rx_over_errors = nlm_hal_read_mac_reg( priv->block, priv->index, RX_DROP_PACKET_COUNTER);
-- 
1.9.1

