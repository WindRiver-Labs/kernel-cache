From 3454c617726bad6d2f33e7173878ff857ea79f95 Mon Sep 17 00:00:00 2001
From: Yonghong Song <ysong@broadcom.com>
Date: Fri, 19 Jul 2013 10:27:06 -0700
Subject: [PATCH 1168/1532] HEv2: dma_dp: use onlinemask and dtre local vc in
 the dtb file in the application

[Based on SDK 3.2]
Adjust the code because the modification in the patch
"0094-HEv2-fmn_dp-add-a-fmn_dp-for-FMN-datapath-driver.patch"

Signed-off-by: Quanyang Wang <quanyang.wang@windriver.com>
---
 drivers/misc/netlogic/fmn_dp/fmn_main.c | 4 +++-
 1 file changed, 3 insertions(+), 1 deletion(-)

diff --git a/drivers/misc/netlogic/fmn_dp/fmn_main.c b/drivers/misc/netlogic/fmn_dp/fmn_main.c
index 09dafba..5e13f22 100644
--- a/drivers/misc/netlogic/fmn_dp/fmn_main.c
+++ b/drivers/misc/netlogic/fmn_dp/fmn_main.c
@@ -74,8 +74,10 @@ static long fmn_ioctl(struct file *filp, unsigned int cmd, unsigned long data)
 	}
 	case GET_RECV_QUEUE:
 	{
+		uint64_t host_cpuid;
+		host_cpuid = __cpu_logical_map[param->u.recv_q.cpu_id];
 		param->u.recv_q.queue_id =
-			(param->u.recv_q.cpu_id << 2) + param->u.recv_q.local_queue_id;
+			(host_cpuid << 2) + param->u.recv_q.local_queue_id;
 		break;
 	}
 	default:
-- 
1.9.1

