From 3348e0995cc0fbafe90d367a32c7d75cb926392c Mon Sep 17 00:00:00 2001
From: Virendra Pathak <vpathak@broadcom.com>
Date: Fri, 7 Feb 2014 11:36:49 +0530
Subject: [PATCH 0510/1532] xlp5xx: added xlp5xx linux dts

[Based on SDK 3.2]
Signed-off-by: Quanyang Wang <quanyang.wang@windriver.com>
---
 arch/mips/boot/dts/xlp5xx-linux-tmpl.dts | 231 +++++++++++++++++++++++++++++++
 arch/mips/boot/dts/xlp5xx-linux.dts      | 203 +++++++++++++++++++++++++++
 arch/mips/boot/dts/xlp5xx-tiny.dts       | 153 ++++++++++++++++++++
 3 files changed, 587 insertions(+)
 create mode 100644 arch/mips/boot/dts/xlp5xx-linux-tmpl.dts
 create mode 100644 arch/mips/boot/dts/xlp5xx-linux.dts
 create mode 100644 arch/mips/boot/dts/xlp5xx-tiny.dts

diff --git a/arch/mips/boot/dts/xlp5xx-linux-tmpl.dts b/arch/mips/boot/dts/xlp5xx-linux-tmpl.dts
new file mode 100644
index 0000000..daa5d01
--- /dev/null
+++ b/arch/mips/boot/dts/xlp5xx-linux-tmpl.dts
@@ -0,0 +1,231 @@
+/*
+ * XLP5XX Device Tree Source for GVP boards
+ */
+
+/dts-v1/;
+/ {
+	model = "netlogic,XLP-GVP";
+	compatible = "netlogic,xlp";
+	#address-cells = <2>;
+	#size-cells = <2>;
+
+	memory {
+		device_type = "memory";
+		reg =  <0 0x00100000 0 0x0FF00000	// 255M at 1M
+			0 0x20000000 0 0xa0000000>;	// 2560M at 512M
+	};
+
+	soc {
+		#address-cells = <2>;
+		#size-cells = <1>;
+		compatible = "simple-bus";
+		ranges = <0 0  0 0x18000000  0x04000000   // PCIe CFG
+			  1 0  0 0x16000000  0x02000000>; // GBU chipselects
+
+		serial0: serial@30000 {
+			device_type = "serial";
+			compatible = "ns16550";
+			reg = <0 0x112100 0x20>;
+			reg-shift = <2>;
+			reg-io-width = <4>;
+			clock-frequency = <125000000>;
+			interrupt-parent = <&pic>;
+			interrupts = <17>;
+		};
+		serial1: serial@31000 {
+			device_type = "serial";
+			compatible = "ns16550";
+			reg = <0 0x112120 0x20>;
+			reg-shift = <2>;
+			reg-io-width = <4>;
+			clock-frequency = <125000000>;
+			interrupt-parent = <&pic>;
+			interrupts = <18>;
+		};
+		pic: pic@11000 {
+			interrupt-controller;
+			#address-cells = <0>;
+			#interrupt-cells = <1>;
+			reg = <0 0x110000 0x200>;
+		};
+
+		i2c0: i2c@113100 {
+			/*compatible = "netlogic,xlp9xx-i2c";*/
+			#address-cells = <1>;
+			#size-cells = <0>;
+			reg = <0 0x113100 0x100>;
+			clock-frequency = <133000000>;
+		};
+		i2c1: i2c@113300 {
+			/*compatible = "netlogic,xlp9xx-i2c";*/
+			#address-cells = <1>;
+			#size-cells = <0>;
+			reg = <0 0x113300 0x100>;
+			clock-frequency = <133000000>;
+
+			rtc@68 {
+				compatible = "dallas,ds1374";
+				reg = <0x68>;
+			};
+
+			dtt@2c {
+                                compatible = "max6653";
+                                reg = <0x2c>;
+			};
+
+			eeprom@57 {
+                                compatible = "xlpge_eeprom";
+                                reg = <0x57>;
+                        };
+
+		};
+		i2c2: i2c@113500 {
+			/*compatible = "netlogic,xlp9xx-i2c";*/
+			#address-cells = <1>;
+			#size-cells = <0>;
+			reg = <0 0x113500 0x100>;
+			clock-frequency = <133000000>;
+		};
+		i2c3: i2c@113700 {
+			/*compatible = "netlogic,xlp9xx-i2c";*/
+			#address-cells = <1>;
+			#size-cells = <0>;
+			reg = <0 0x113700 0x100>;
+			clock-frequency = <133000000>;
+		};
+
+		spi: xlp_spi@13a000 {
+			compatible = "netlogic,xlp-spi";
+			#address-cells = <1>;
+			#size-cells = <0>;
+			reg = <0 0x13a000 0x100>;
+
+			interrupts = <34>;
+			interrupt-parent = <&pic>;
+
+			spi_nor@1 {
+				compatible = "micron,n25q128";
+				#address-cells = <1>;
+				#size-cells = <1>;
+
+				reg = <1>;		/* Chip Select */
+
+				spi-max-frequency = <40000000>;
+
+				partition@0 {
+					label = "x-loader";
+					reg = <0x0 0x200000>; /* 2M */
+					read-only;
+				};
+
+				partition@200000 {
+					label = "kernel";
+					reg = <0x200000 0x500000>; /* 5M */
+				};
+
+				partition@700000 {
+					label = "rootfs";
+					reg = <0x700000 0x800000>; /* 8M */
+				};
+
+				partition@f00000 {
+					label = "env";
+					reg = <0xf00000 0x100000>; /* 1M */
+					read-only;
+				};
+			};
+			spi_nand@2 {
+				compatible = "spinand,mt29f";
+				#address-cells = <1>;
+				#size-cells = <1>;
+				reg = <2>;	/* SPI NAND CS */
+				spi-max-frequency = <50000000>;
+
+				partition@0 {
+					label = "firmware";
+					reg = <0x0 0x1c00000>;
+				};
+
+				partition@1 {
+					label = "kernel";
+					reg = <0x1c00000 0x0>;
+				};
+			};
+		};
+
+		nand_flash@0,0 {
+			/*compatible = "brcm,xlp9xx-nand";*/
+			#address-cells = <1>;
+			#size-cells = <1>;
+			reg = <0 0x139000 0x1000>;
+
+			nand-ecc-mode = "hw";
+
+			partition@0 {
+				label = "firmware";
+				reg = <0x0 0x20000000>;
+			};
+
+			partition@1 {
+				label = "kernel";
+				reg = <0x20000000 0x20000000>;
+			};
+
+			partition@2 {
+				label = "user";
+				reg = <0x40000000 0x0>;
+			};
+		};
+
+		nor_flash@1,0 {
+			compatible = "cfi-flash";
+			#address-cells = <1>;
+			#size-cells = <1>;
+			bank-width = <2>;
+			reg = <1 0 0x1000000>;
+
+			partition@0 {
+				label = "x-loader";
+				reg = <0x0 0x100000>; /* 1M */
+				read-only;
+			};
+
+			partition@100000 {
+				label = "u-boot";
+				reg = <0x100000 0x100000>; /* 1M */
+			};
+
+			partition@200000 {
+				label = "kernel";
+				reg = <0x200000 0x500000>; /* 5M */
+			};
+
+			partition@700000 {
+				label = "rootfs";
+				reg = <0x700000 0x800000>; /* 8M */
+			};
+
+			partition@f00000 {
+				label = "env";
+				reg = <0xf00000 0x100000>; /* 1M */
+				read-only;
+			};
+		};
+
+		gpio: xlp_gpio@114000 {
+			compatible = "netlogic,xlp-gpio";
+			reg = <0 0x114100 0x1000>;
+			#gpio-cells = <2>;
+			gpio-controller;
+
+			#interrupt-cells = <1>;
+			interrupt-parent = <&pic>;
+			interrupts = <39>;
+			interrupt-controller;
+		};
+	};
+
+	chosen {
+		bootargs = "console=ttyS0,115200 rdinit=/sbin/init";
+	};
+};
diff --git a/arch/mips/boot/dts/xlp5xx-linux.dts b/arch/mips/boot/dts/xlp5xx-linux.dts
new file mode 100644
index 0000000..35eb9cc
--- /dev/null
+++ b/arch/mips/boot/dts/xlp5xx-linux.dts
@@ -0,0 +1,203 @@
+/* XLP9XX Device Tree Source
+ *
+ */
+
+/dts-v1/;
+/ {
+	model = "netlogic,XLP-GVP";
+        compatible = "netlogic,xlp";
+        #address-cells = <2>;
+        #size-cells = <2>;
+
+        memory {
+                device_type = "memory";
+                reg =  <0 0x00000000 0 0x0FF00000       // 255M at 1M
+                        0 0x20000000 0 0xa0000000>;     // 2560M at 512M
+        };
+
+        /* memory range for HEv2 pkt mem. Only one contig memory per node supported */
+        pktmem {
+                device_type = "pktmem";
+
+                /* format: node number, 64-bit addr, 64-bit size */
+                reg = <0 0x0 0xe0000000 0x0 0x20000000
+                       1 0x0 0x0 0x0 0x0
+                       2 0x0 0x0 0x0 0x0
+                       3 0x0 0x0 0x0 0x0>;
+        };
+
+	hypervisor {
+		hypervisor-name = "Xen";
+		alloc_dom0_memory = <0>;
+		bootargs = "ncores=8 dom0_loadaddr=0x72000000 dom0_size=0x1c000000 dom0_cpumask=0xffffffff -- ";
+		domain_heap = <0x80000000 0x20000000>;
+	};
+	doms {
+		#address-cells = <1>;
+		#size-cells = <1>;
+		dom@0 {
+			device_type = "domain";
+			os = "linux";
+
+			#address-cells = <1>;
+			#size-cells = <1>;
+			#nodes = <1>;
+			#cpumask-cells=<3>;
+
+			cpu {
+				onlinemask = <0x1>; /* */
+                                nae-rx-vc = <0>;
+                                nae-fb-vc = <1>;
+				napi-vc-mask = <0xb>;
+				sae-rx-vc = <0>; /* sharing with nae */
+				sae-rx-sync-vc  = <2>; /* should be exclusive */
+				ipsec-async-vc  = <3>;
+				ipsec-sync-vc   = <2>;
+
+			};
+			uart {
+				id = <0>;
+				owner = <1>;
+				sharedcfg = <0x1f000000>;
+			};
+                        fmn {
+				node_0_vc_mask = <0xbbbbbbbb 0xbbbbbbbb 0xbbbbbbbb 0xbbbbbbbb >;
+				node_1_vc_mask = <0xbbbbbbbb 0xbbbbbbbb 0xbbbbbbbb 0xbbbbbbbb >;
+				node_2_vc_mask = <0xbbbbbbbb 0xbbbbbbbb 0xbbbbbbbb 0xbbbbbbbb >;
+				node_3_vc_mask = <0xbbbbbbbb 0xbbbbbbbb 0xbbbbbbbb 0xbbbbbbbb >;
+				node_4_vc_mask = <0xbbbbbbbb 0xbbbbbbbb 0xbbbbbbbb 0xbbbbbbbb >;
+				node_5_vc_mask = <0xbbbbbbbb 0xbbbbbbbb 0xbbbbbbbb 0xbbbbbbbb >;
+				node_6_vc_mask = <0xbbbbbbbb 0xbbbbbbbb 0xbbbbbbbb 0xbbbbbbbb >;
+				node_7_vc_mask = <0xbbbbbbbb 0xbbbbbbbb 0xbbbbbbbb 0xbbbbbbbb >;
+                        };
+			pic {
+			};
+			nae-0 {
+				/* Example for different values of nae-rx-cpu-mask
+				 * for 80 CPUs: nae-rx-cpu-mask = <0xffff 0xffffffff 0xffffffff>;
+				 * for 64 CPUs: nae-rx-cpu-mask = <0xffffffff 0xffffffff>;
+				 * for 32 CPUs: nae-rx-cpu-mask = <0xffffffff>;
+				 */
+				nae-rx-cpu-mask = <>;
+				freein-fifo-mask = <0xffff 0 0 0>;
+				/* node offsets and size */
+				vfbtbl-sw-offset = <0 0 0 0>;
+				vfbtbl-sw-nentries = <80 32 32 80>;
+				/* hw entries */
+				vfbtbl-hw-offset = <80 32 32 80>;
+				vfbtbl-hw-nentries = <20 20 20 20>;
+				dummy-pktdata-addr = <0x0 0x0ff00000>; // 255 MB
+			};
+			owner-config {
+				nae = <0x1>;   // currently for node 0
+				sae = <0x1>;
+				rsa = <0x1>;
+				fmn = <0x1>;
+			};
+			resource-allocation {
+                                net@0 {
+                                        port-mask = <0x4 0 0 0>;
+                                        frinlifo-mask = <0xffff 0 0 0>;
+                                        frinlifo-shared-mode = <0 0 0 0>;
+                                        vfbid-sw-offset = <0 0 0 0>;
+                                        vfbid-sw-entries = <0 0 0 0>;
+                                        ucore-mask = <0x1 0 0 0>;
+                                        sram-off = <0 0 0 0>;
+                                };
+                        };
+		};
+		dom@1 {
+			device_type = "domain";
+
+			cpu {   
+                                onlinemask = <0x01>; 
+                                nae-rx-vc = <2>;
+			};
+
+			resource-allocation {
+				net@0 {
+					port-mask = <0x3 0 0 0>;
+					frinlifo-mask = <0xff 0 0 0>;
+					frinlifo-shared-mode = <0 0 0 0>;
+					vfbid-sw-offset = <0 0 0 0>;
+					vfbid-sw-entries = <0 0 0 0>;
+					ucore-mask = <0x2 0 0 0>;
+					sram-off = <0 0 0 0>;
+				};
+			};
+			app-param{
+                                onlinemask = <0x01>;
+			};
+		};
+                dom@2 { 
+                        device_type = "domain";
+
+                        cpu {   
+                                onlinemask = <0x1>;
+                                nae-rx-vc = <2>;
+                        };
+
+                        resource-allocation {
+                                net@0 { 
+                                        port-mask = <0x0 0 0 0>;
+                                        frinlifo-mask = <0x00 0 0 0>;
+                                        frinlifo-shared-mode = <0 0 0 0>;
+                                        vfbid-sw-offset = <0 0 0 0>;
+                                        vfbid-sw-entries = <0 0 0 0>;
+                                        ucore-mask = <0x0 0 0 0>;
+                                        sram-off = <0 0 0 0>;
+					max-l3rules = <0 0 0 0>;
+					max-l4rules = <0 0 0 0>;
+                                };
+                        };
+			app-param{
+                                onlinemask = <0x1>;
+                        };
+
+                };
+
+
+	};
+	chosen {
+		/* examples for different core/thread models.
+		 * 8core: netlogic,cpumask=<0xffffffff>
+		 */
+		netlogic,cpumask = <0x1>;
+		bootargs = " console=ttyS0,115200  rhash_entries=1048576";
+		/*linux,initrd-start=<0x00c00000>;
+		linux,initrd-end=<0x02c00000>;*/
+	};
+
+	/* These binaries are downloaded at the resp physical memory locations
+	 * by their corresponding bootstrapping loaders. For example,
+	 * u-boot is loaded by x-load at 193M, sysconfig is loaded by u-boot
+	 * at 1M, hypervisor by u-boot hypervisor at 136M.
+	 * On simulator all these binaries are pre-loaded by using '-F' option
+	 * for convenience. On silicon, they will be loaded by their corresponding
+	 * temporary download locations the stage-1/stage-2 firmware
+	 */
+	firmware-download {
+		u-boot        = <0x0c100000 0x3f00000>;  /* 63M @ 193M */
+		sysconfig     = <0x00100000 0x00100000>; /* 1M @ 1M */
+		hypervisor    = <0x08800000 0x00800000>; /* 8M @ 136M */
+		dom0          = <0x09000000 0x03000000>; /* 48M @ 144M */
+		domU-ramdisk  = <0x60000000 0x60800000>; /* 8M @ 1536M */
+	};
+
+	soc {
+		nodes {
+			num-nodes = <1>;
+		};
+
+	};
+
+        frequency-config {
+                nae = <500>;
+                sae = <767>;
+                rsa = <767>;
+                dtre = <250>;
+                cde = <250>;
+        };
+
+};
+
diff --git a/arch/mips/boot/dts/xlp5xx-tiny.dts b/arch/mips/boot/dts/xlp5xx-tiny.dts
new file mode 100644
index 0000000..1da0cf6
--- /dev/null
+++ b/arch/mips/boot/dts/xlp5xx-tiny.dts
@@ -0,0 +1,153 @@
+/* XLP5XX Device Tree Source
+ *
+ */
+
+/dts-v1/;
+/ {
+	model = "netlogic,XLP-GVP";
+	compatible = "netlogic,xlp";
+	#address-cells = <1>;
+	#size-cells = <1>;
+	doms {
+		#address-cells = <1>;
+		#size-cells = <1>;
+		dom@0 {
+			device_type = "domain";
+			heap-size = <0x0 0x4000000>;
+			shared-mem = <0x0 0x80000000 0x0 0x20000000>;
+			#address-cells = <1>;
+			#size-cells = <1>;
+			cpu {
+				onlinemask = <0xf>;
+				nae-rx-vc = <0>;
+				nae-fb-vc = <3>;
+			};
+			uart {
+				id = <0>;
+			};
+			memory {
+				reg = <0x00100000 0x0FF00000	// 255M at 1M
+					   0x20000000 0x20000000>;  // 512M at 512M
+			};
+			pic {
+			};
+			owner-config {
+				nae = <0x1>;
+				fmn = <0x1>;
+				sae = <0x1>;
+				rsa = <0x1>;
+			};
+		};
+	};
+
+	chosen {
+		bootargs = " console=ttyS0,115200 ";
+	};
+
+	soc {
+		net@node-0 {
+			compatible = "XLP5XX";
+			version = <1>;
+
+			ale-0 {
+				enable = <0>;
+				cpu-threshold = <32>;
+				nae-threshold = <80>;
+				data-base {
+
+				};
+			};
+
+			nae-0 {
+				frequency = <667>;
+				ale-bypass = <1>;         /* 0 = enable ALE, 1 = bypass ALE */
+
+				/include/ "ucore.dts"
+
+				vfbid-config {
+					vfbid-map = <
+						0    0    1   1   2   2   3   3
+						>;
+				};
+				complex@0 {
+					mode = "xgmac"; 
+					cpld = "yes";
+				      	xgmac {                          /* valid when mode = xaui, rxaui or xfi */
+
+						loopback = <0>;             /* loopback = 0 or 1 */
+						num-channels = <1>;         /* num-channels = 1 to 8 */
+						num-free-descs = <150>;     /* Number of free descriptors, per port, if free in lifo is not in shared mode*/
+						free-desc-size = <2048>;    /* descriptor size */
+						higig-mode = <0>;           /* 0=NO_HIGIG, 1=HIGIG, 2=HIGIG2 */
+						xgmii-speed = <10>;         /* 10=10G , 12=12G, 16=16G */
+						vlan-pri-en = <0x0>;        /* VLAN priority enable = 0 or 1 */
+
+						/* rxaui specific params*/
+						submode  = <2>;             /* 0:xaui 1:rxaui.xaui 2:rxaui.broadcom 3:rxaui.marvell */
+						scrambler  = <0>;           /* scrambler disable = 0, enable = 1 */
+
+					};
+				};
+
+				complex@1 {
+					mode = "xgmac"; 
+					cpld = "yes";
+				      	xgmac {                          /* valid when mode = xaui, rxaui or xfi */
+
+						loopback = <0>;             /* loopback = 0 or 1 */
+						num-channels = <1>;         /* num-channels = 1 to 8 */
+						num-free-descs = <150>;     /* Number of free descriptors, per port, if free in lifo is not in shared mode*/
+						free-desc-size = <2048>;    /* descriptor size */
+						higig-mode = <0>;           /* 0=NO_HIGIG, 1=HIGIG, 2=HIGIG2 */
+						xgmii-speed = <10>;         /* 10=10G , 12=12G, 16=16G */
+						vlan-pri-en = <0x0>;        /* VLAN priority enable = 0 or 1 */
+
+						/* rxaui specific params*/
+						submode  = <2>;             /* 0:xaui 1:rxaui.xaui 2:rxaui.broadcom 3:rxaui.marvell */
+						scrambler  = <0>;           /* scrambler disable = 0, enable = 1 */
+
+					};
+				};
+
+
+				complex@2 {
+					mode = "sgmii"; 
+					sgmii {
+						loopback = <0>;                   /* loopback = 0 or 1 */
+						mgmt-port = <1>;                  /* num-channels = 1 to 8 */
+						ext-phy-addr = <0>;               /* phy address for each port */
+						ext-phy-bus = <0>;                /* phy bus numbers */
+						num-channels = <1>;               /* num-channels = 1 to 8 */
+						num-free-descs = <52>;            /* Number of free descriptors, per port, if free in lifo is not in shared mode*/
+						free-desc-size = <2048>;          /* descriptor size */
+					};
+				};
+			};	
+
+
+			poe-0{
+				distribution-enable = <0>;
+				dist-drop-enable = <0>;                     /* 16 bit mask */
+				class-map-mode = <0>;                       /* 0:All NAE, 1:Class 7-4 reserved for CPU, 2:Class 7-5 reserved for CPU, 3:Class 7-6 reserved for CPU,
+										4:Class 7 reserved for CPU */
+				class-drop-enable = <0>;                    /* 8 bit mask */
+				drop-timer = <0>;                           /* Drop timer */
+				dest-threshold = <0xa>;                     
+				dist-threshold = <0xa 0xa 0xa 0xa>;         /* Dist threshold group 0..3 */
+				statistics-enable = <0>;                    
+
+				poe-spill-address = <0 0>;  /*  <0xec00000>  */ 
+				poe-spill-length =  <0>;  /*  <0x1000000>  */
+
+				din-spill-address = <0 0>;
+				/*TODO: Need to verify*/
+				din-spill-size = <0x0>;
+
+				distribution {
+					default-thread-sel = <0>;    /* Valid values: Thread Select 0..3 */
+				};
+			};
+		};
+	};
+};
+
-- 
1.9.1

