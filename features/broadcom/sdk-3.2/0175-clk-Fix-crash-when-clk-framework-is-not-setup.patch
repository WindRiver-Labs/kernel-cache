From 3b9387dee408d4c9e030529271ce8c521db50472 Mon Sep 17 00:00:00 2001
From: Prem Mallappa <pmallapp@broadcom.com>
Date: Fri, 12 Dec 2014 15:00:36 +0530
Subject: [PATCH 0175/1532] clk: Fix crash when clk framework is not setup

Check the return value clk_get() correctly so that it exits gracefully
when clk framework is not in use.
[Based on SDK 3.2]
Signed-off-by: Quanyang Wang <quanyang.wang@windriver.com>
---
 drivers/cpufreq/xlp-cpufreq.c | 2 +-
 1 file changed, 1 insertion(+), 1 deletion(-)

diff --git a/drivers/cpufreq/xlp-cpufreq.c b/drivers/cpufreq/xlp-cpufreq.c
index d87bcfc..ca828d4 100644
--- a/drivers/cpufreq/xlp-cpufreq.c
+++ b/drivers/cpufreq/xlp-cpufreq.c
@@ -104,7 +104,7 @@ static int __init build_xlp_freq_table(struct cpufreq_frequency_table *tbl)
 	XLP_MAKE_CORE_CLK_NAME(name, sizeof(name), 0, 0);
 
 	clk = clk_get(NULL, name);
-	if (!clk) {
+	if (IS_ERR(clk)) {
 		pr_crit("Unable to find Clock source for core0\n");
 		return -1;
 	}
-- 
1.9.1

