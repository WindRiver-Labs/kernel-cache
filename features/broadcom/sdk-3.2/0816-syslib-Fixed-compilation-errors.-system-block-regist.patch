From 06d554318d8d89afbb6d097beac89b074a206f9a Mon Sep 17 00:00:00 2001
From: Jayanthi A <jayanthi.annadurai@broadcom.com>
Date: Wed, 23 Oct 2013 18:06:27 -0700
Subject: [PATCH 0816/1532] syslib: Fixed compilation errors. system block
 registers are defined in uboot and libraries.

[Based on SDK 3.2]
Signed-off-by: Quanyang Wang <quanyang.wang@windriver.com>
---
 .../netlogic/lib/netlib/include/netsoc_haliface.h  |   6 +-
 arch/mips/netlogic/lib/netlib/include/netsoc_nae.h |   6 +-
 arch/mips/netlogic/lib/netlib/src/netsoc_nae.c     |   7 +-
 .../netlogic/lib/syslib/include/nlm_hal_xlp_dev.h  |   4 +
 arch/mips/netlogic/lib/syslib/include/xlp9xx_sys.h | 108 ++++++++++-----------
 arch/mips/netlogic/lib/syslib/src/nlm_hal.c        |   4 +-
 6 files changed, 63 insertions(+), 72 deletions(-)

diff --git a/arch/mips/netlogic/lib/netlib/include/netsoc_haliface.h b/arch/mips/netlogic/lib/netlib/include/netsoc_haliface.h
index 644d22e..d70e9f9 100644
--- a/arch/mips/netlogic/lib/netlib/include/netsoc_haliface.h
+++ b/arch/mips/netlogic/lib/netlib/include/netsoc_haliface.h
@@ -32,11 +32,6 @@
 #define __BRCM_NETSOC_HALIFACE_H
 
 #include "nlm_hal.h"
-#ifndef NLM_HAL_UBOOT
-#include "xlp9xx_sys.h"
-#else
-#include <asm/arch/xlp_sys.h>
-#endif
 #include "netsoc_dev.h"
 #include "nlm_nae.h"
 #include "nlm_hal_nae.h"
@@ -47,6 +42,7 @@
 #include "netsoc_common.h"
 #include "ext_phy.h"
 #include "nlm_hal_fmn.h"
+#include "xlp9xx_sys.h"
 
 extern uint32_t socnet_version_v0;
 extern struct netsoc_info *current_netsoc;
diff --git a/arch/mips/netlogic/lib/netlib/include/netsoc_nae.h b/arch/mips/netlogic/lib/netlib/include/netsoc_nae.h
index 51f4d76..e55ad10 100644
--- a/arch/mips/netlogic/lib/netlib/include/netsoc_nae.h
+++ b/arch/mips/netlogic/lib/netlib/include/netsoc_nae.h
@@ -36,6 +36,8 @@
 
 #define CONTEXT_NUMBER_INSEQ	1
 
+#define XLP9XX_SYSDEVICERESET     0x3c
+
 extern struct netsoc_info *current_netsoc;
 
 enum netv1_nae_reg{
@@ -193,9 +195,9 @@ static inline void __netsoc_reset_nae(nae_t *nae)
                     reset_bit = 21;
                 else
                     reset_bit = 22;
-		nlm_hal_write_sys_reg(nae->node, SYS_SYSDEVICERESET, (1 << reset_bit));
+		nlm_hal_write_sys_reg(nae->node, XLP9XX_SYSDEVICERESET, (1 << reset_bit));
 		nlm_mdelay(1);
-		nlm_hal_write_sys_reg(nae->node, SYS_SYSDEVICERESET, 0);
+		nlm_hal_write_sys_reg(nae->node, XLP9XX_SYSDEVICERESET, 0);
 		nlm_mdelay(1);
         }
 	else {
diff --git a/arch/mips/netlogic/lib/netlib/src/netsoc_nae.c b/arch/mips/netlogic/lib/netlib/src/netsoc_nae.c
index 5f9de06..9ffb07c 100644
--- a/arch/mips/netlogic/lib/netlib/src/netsoc_nae.c
+++ b/arch/mips/netlogic/lib/netlib/src/netsoc_nae.c
@@ -35,11 +35,6 @@
 #include "netsoc_haliface.h"
 #include "netsoc_libiface.h"
 #include "ext_phy.h"
-#ifndef NLM_HAL_UBOOT
-#include "xlp9xx_sys.h"
-#else
-#include <asm/arch/xlp_sys.h>
-#endif
 
 static unsigned int ucore_shared_scratch[NLM_MAX_NODES][XLP9XX_MAX_NAE_PERNODE][256];
 static unsigned int ucore_shared_scratch_words[NLM_MAX_NODES][XLP9XX_MAX_NAE_PERNODE];
@@ -1495,7 +1490,7 @@ void __netsoc_set_frequency(nae_t *nae, uint32_t frequency)
 		return;
 	}
 	else if (is_nlm_xlp9xx()) {
-		set_soc_frequency(nae->node, XLP9XX_CLKDEV_NET, (frequency * mhz));
+		xlp9xx_set_soc_frequency(nae->node, XLP9XX_CLKDEV_NET, (frequency * mhz));
 	}
 	else{
         	/* Note that the DFS sets the NAE 2X frequency.
diff --git a/arch/mips/netlogic/lib/syslib/include/nlm_hal_xlp_dev.h b/arch/mips/netlogic/lib/syslib/include/nlm_hal_xlp_dev.h
index 9015c18..da42e13 100644
--- a/arch/mips/netlogic/lib/syslib/include/nlm_hal_xlp_dev.h
+++ b/arch/mips/netlogic/lib/syslib/include/nlm_hal_xlp_dev.h
@@ -501,6 +501,10 @@ extern int is_nlm_xlp(unsigned int chipid, unsigned int rev,  unsigned int ext);
 #define XLP9XX_SYS_DEVICE		0x6
 #define XLP9XX_SYS_FUNC			0x0
 
+#define XLP9XX_SYS_FUNC_CLKDEV  2
+
+#define XLP9XX_SYS_CLKDEV_BASE(node)   (KSEG1 +0x18000000 + (XLP9XX_SYS_BUS << 20) + (((node * XLP_MAXDEV_PERNODE) + XLP9XX_SYS_DEVICE) << 15) + (XLP9XX_SYS_FUNC_CLKDEV << 12))
+
 #define XLP_MAXDEV_PERNODE		8
 
 #define XLP9XX_SAE_RSA_BUS_NUM		(1<<20)
diff --git a/arch/mips/netlogic/lib/syslib/include/xlp9xx_sys.h b/arch/mips/netlogic/lib/syslib/include/xlp9xx_sys.h
index 92dbcae..70e12c8 100644
--- a/arch/mips/netlogic/lib/syslib/include/xlp9xx_sys.h
+++ b/arch/mips/netlogic/lib/syslib/include/xlp9xx_sys.h
@@ -39,49 +39,49 @@
 #include "nlm_hal.h"
 
 #ifndef __ASSEMBLY__
-enum processor_sys
+enum xlp9xx_processor_sys
 {
-        SYS_POWERONRESETCFG    = 0x0,
-        SYS_CHIPRESET          = 0x1,
-        SYS_CPURESET           = 0x2,
-        SYS_CPUNONCOHERENTMODE = 0x3,
-        SYS_CPUTHREADEN0       = 0x4,
-        SYS_CPUTHREADEN1       = 0x5,
-        SYS_SYSDISCFG0         = 0x25,
-        SYS_SYSDISCFG1         = 0x26,
-        SYS_SYSDISCFG2         = 0x27,
-        SYS_SYSDISCFG3         = 0x28,
-        SYS_SYSDISCFG4         = 0x29,
-        SYS_SYSDISCFG5         = 0x2a,
-        SYS_SYSDISCFG6         = 0x2b,
-        SYS_SYSDISCFG7         = 0x2c,
-        SYS_SYSDEVICEDIS       = 0x34,
-        SYS_SYSDEVICERESET     = 0x3c,
-        SYS_SYSRESETCFG        = 0x3d,
-        SYS_BYTESWAP           = 0x45,
-        SYS_SYSCTRL            = 0x46,
-        SYS_TIMEOUTBSI         = 0x47,
-        SYS_BISTRESET          = 0x48,
-        SYS_SYSCFG             = 0x49,
-        SYS_SYSHOTPLUGWAITOUT  = 0x4a,
-        SYS_SYSHOTPLUGWAITIN   = 0x4b,
-        SYS_SYSHOTPLUGDONE     = 0x4c,
-        SYS_SYSSCRATCH         = 0x69,
-        SYS_SYSCOUNTER         = 0x71,
-        SYS_SYSSTATUS          = 0x91,
-        SYS_SYSINTSTATUS       = 0x92,
-        SYS_SYSINTENABLE0      = 0x93,
-        SYS_SYSINTENABLE1      = 0x94,
-        SYS_MONITORCTRL        = 0x9c,
-        SYS_CPUMONITOR         = 0xa4,
-        SYS_DDRMONITOR         = 0x1a4,
-        SYS_SOCMONITOR         = 0x1ac,
-        SYS_MEMBISTGO          = 0x1c0,
-        SYS_MEMSTAT            = 0x200
+        XLP9XX_SYS_POWERONRESETCFG    = 0x0,
+        XLP9XX_SYS_CHIPRESET          = 0x1,
+        XLP9XX_SYS_CPURESET           = 0x2,
+        XLP9XX_SYS_CPUNONCOHERENTMODE = 0x3,
+        XLP9XX_SYS_CPUTHREADEN0       = 0x4,
+        XLP9XX_SYS_CPUTHREADEN1       = 0x5,
+        XLP9XX_SYS_SYSDISCFG0         = 0x25,
+        XLP9XX_SYS_SYSDISCFG1         = 0x26,
+        XLP9XX_SYS_SYSDISCFG2         = 0x27,
+        XLP9XX_SYS_SYSDISCFG3         = 0x28,
+        XLP9XX_SYS_SYSDISCFG4         = 0x29,
+        XLP9XX_SYS_SYSDISCFG5         = 0x2a,
+        XLP9XX_SYS_SYSDISCFG6         = 0x2b,
+        XLP9XX_SYS_SYSDISCFG7         = 0x2c,
+        XLP9XX_SYS_SYSDEVICEDIS       = 0x34,
+        XLP9XX_SYS_SYSDEVICERESET     = 0x3c,
+        XLP9XX_SYS_SYSRESETCFG        = 0x3d,
+        XLP9XX_SYS_BYTESWAP           = 0x45,
+        XLP9XX_SYS_SYSCTRL            = 0x46,
+        XLP9XX_SYS_TIMEOUTBSI         = 0x47,
+        XLP9XX_SYS_BISTRESET          = 0x48,
+        XLP9XX_SYS_SYSCFG             = 0x49,
+        XLP9XX_SYS_SYSHOTPLUGWAITOUT  = 0x4a,
+        XLP9XX_SYS_SYSHOTPLUGWAITIN   = 0x4b,
+        XLP9XX_SYS_SYSHOTPLUGDONE     = 0x4c,
+        XLP9XX_SYS_SYSSCRATCH         = 0x69,
+        XLP9XX_SYS_SYSCOUNTER         = 0x71,
+        XLP9XX_SYS_SYSSTATUS          = 0x91,
+        XLP9XX_SYS_SYSINTSTATUS       = 0x92,
+        XLP9XX_SYS_SYSINTENABLE0      = 0x93,
+        XLP9XX_SYS_SYSINTENABLE1      = 0x94,
+        XLP9XX_SYS_MONITORCTRL        = 0x9c,
+        XLP9XX_SYS_CPUMONITOR         = 0xa4,
+        XLP9XX_SYS_DDRMONITOR         = 0x1a4,
+        XLP9XX_SYS_SOCMONITOR         = 0x1ac,
+        XLP9XX_SYS_MEMBISTGO          = 0x1c0,
+        XLP9XX_SYS_MEMSTAT            = 0x200
 };
 
 //Device -6 , function - 2
-enum dev_sys {
+enum xlp9xx_dev_sys {
         PLL_CLKCTRL             = 0x41,
         CLK_CHOPCTRL            = 0x45,
         CPU_CLKCHOPEN           = 0x46,
@@ -91,10 +91,10 @@ enum dev_sys {
         CPU_PLLCTRL_2_0         = 0x142,
         CPU_PLLCTRL_3_0         = 0x143,
 
-        SYS_PLLCTRL_0           = 0x184,
-        SYS_PLLCTRL_1           = 0x185,
-        SYS_PLLCTRL_2           = 0x186,
-        SYS_PLLCTRL_3           = 0x187,
+        XLP9XX_SYS_PLLCTRL_0           = 0x184,
+        XLP9XX_SYS_PLLCTRL_1           = 0x185,
+        XLP9XX_SYS_PLLCTRL_2           = 0x186,
+        XLP9XX_SYS_PLLCTRL_3           = 0x187,
 
         DEV_PLLCTRL_0           = 0x188,
         DEV_PLLCTRL_1           = 0x189,
@@ -102,7 +102,7 @@ enum dev_sys {
         DEV_PLLCTRL_3           = 0x18b,
 
         CPU_PLLCHG_CTRL         = 0x1c8,
-        SYS_PLLCHG_CTRL         = 0x1c9,
+        XLP9XX_SYS_PLLCHG_CTRL         = 0x1c9,
         CLK_DEVDIS              = 0x1ca,
         CLK_DEVSEL              = 0x1cb,
         CLK_DEVDIV              = 0x1cd,
@@ -133,12 +133,6 @@ enum dev_clk{
 
 #endif //__ASSEMBLY__
 
-#define SYS_BUS		1
-#define SYS_DEV		6
-#define SYS_FUNC_CLKDEV	2
-
-#define SYS_CLKDEV_BASE(node)   (0x18000000 + (SYS_BUS << 20) + (((node * XLP_MAXDEV_PERNODE) + SYS_DEV) << 15) + (SYS_FUNC_CLKDEV << 12))
-
 #define syssoc_write_reg(base, reg, val)	nlm_hal_write_32bit_reg(base, reg, val)
 #define syssoc_read_reg(base, reg)		nlm_hal_read_32bit_reg(base, reg)
 
@@ -160,7 +154,7 @@ static inline uint64_t get_nae_frequency(int node)
 {
     uint32_t sel, div, pll_out, dev_shift = XLP9XX_CLKDEV_NET * 2;
     uint32_t clk_freq;
-    uint64_t sys_base = SYS_CLKDEV_BASE(node); 
+    uint64_t sys_base = XLP9XX_SYS_CLKDEV_BASE(node); 
 
     sel = (syssoc_read_reg(sys_base, CLK_DEVSEL) >> dev_shift) & 0x3;
     div = (syssoc_read_reg(sys_base, CLK_DEVDIV) >> dev_shift) & 0x3;
@@ -184,13 +178,13 @@ static inline uint64_t get_nae_frequency(int node)
 }
 
 
-static inline int set_nae_frequency(int node, uint64_t freq)
+static inline int xlp9xx_set_nae_frequency(int node, uint64_t freq)
 {
     int sel, div, dev_shift, i;
     const uint64_t mhz = 1000000;
     int dev_freq = freq / mhz;
     uint32_t val, dev_id = XLP9XX_CLKDEV_NET;
-    uint64_t sys_base = SYS_CLKDEV_BASE(node);
+    uint64_t sys_base = XLP9XX_SYS_CLKDEV_BASE(node);
 
     nlm_print("NAE frequency %lld MHz\n",get_nae_frequency(node) / mhz);
 		
@@ -256,7 +250,7 @@ static inline uint64_t get_crypto_block_frequency(int node, int dev_id)
 {
     uint32_t sel, div, pll_out, dev_shift;
     uint32_t clk_freq;
-    uint64_t sys_base = SYS_CLKDEV_BASE(node);
+    uint64_t sys_base = XLP9XX_SYS_CLKDEV_BASE(node);
 
     if (dev_id == XLP9XX_CLKDEV_SEC) 
         dev_shift = XLP9XX_CLKDEV_SEC * 2;
@@ -291,7 +285,7 @@ static inline int set_crypto_block_frequency(int node, int dev_id, uint64_t freq
     const uint64_t mhz = 1000000;
     int dev_freq = freq / mhz;
     uint32_t val;
-    uint64_t sys_base = SYS_CLKDEV_BASE(node);
+    uint64_t sys_base = XLP9XX_SYS_CLKDEV_BASE(node);
     char* block_name;
 
     if (dev_id == XLP9XX_CLKDEV_SEC)
@@ -353,12 +347,12 @@ static inline int set_crypto_block_frequency(int node, int dev_id, uint64_t freq
 }
 
 
-static inline int set_soc_frequency(int node, int dev_id, uint64_t freq)
+static inline int xlp9xx_set_soc_frequency(int node, int dev_id, uint64_t freq)
 {
 
 	switch(dev_id) {
 		case XLP9XX_CLKDEV_NET:
-			set_nae_frequency(node, freq);
+			xlp9xx_set_nae_frequency(node, freq);
 			break;
                 case XLP9XX_CLKDEV_SEC:
 		case XLP9XX_CLKDEV_RSA:
diff --git a/arch/mips/netlogic/lib/syslib/src/nlm_hal.c b/arch/mips/netlogic/lib/syslib/src/nlm_hal.c
index 43cfbc5..7d5ccb7 100644
--- a/arch/mips/netlogic/lib/syslib/src/nlm_hal.c
+++ b/arch/mips/netlogic/lib/syslib/src/nlm_hal.c
@@ -1002,7 +1002,7 @@ void nlm_hal_set_sae_freq(int node, int freq)
 	if(is_nlm_xlp2xx()) {
 		nlm_hal_xlp2xx_set_clkdev_frq(node, XLP2XX_CLKDEVICE_SAE, freq * mhz);
 	} else if (is_nlm_xlp9xx()) {
-            set_soc_frequency(node, XLP9XX_CLKDEV_SEC, freq * mhz);
+            xlp9xx_set_soc_frequency(node, XLP9XX_CLKDEV_SEC, freq * mhz);
         } else {
 		uint64_t set_freq = nlm_hal_set_soc_freq(node, DFS_DEVICE_SAE, freq * mhz);
 		NLM_HAL_DO_DIV(set_freq, mhz);
@@ -1028,7 +1028,7 @@ void nlm_hal_set_rsa_freq(int node, int freq)
 	if(is_nlm_xlp2xx()) {
 		nlm_hal_xlp2xx_set_clkdev_frq(node, XLP2XX_CLKDEVICE_RSA, freq * mhz);
 	} if (is_nlm_xlp9xx()) {
-            set_soc_frequency(node, XLP9XX_CLKDEV_RSA, freq*mhz);
+            xlp9xx_set_soc_frequency(node, XLP9XX_CLKDEV_RSA, freq*mhz);
         } else {
 		uint64_t set_freq = nlm_hal_set_soc_freq(0, DFS_DEVICE_RSA, freq * mhz);
 		NLM_HAL_DO_DIV(set_freq, mhz);
-- 
1.9.1

