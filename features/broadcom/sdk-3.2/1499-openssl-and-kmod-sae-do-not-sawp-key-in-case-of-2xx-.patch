From f9eac6e2019990a2065695100ab809c5805e12af Mon Sep 17 00:00:00 2001
From: reshmic <reshmic@broadcom.com>
Date: Fri, 5 Oct 2012 18:05:46 +0530
Subject: [PATCH 1499/1532] openssl and kmod sae: do not sawp key in case of
 2xx chip

[Based on SDK 3.2]
Signed-off-by: Quanyang Wang <quanyang.wang@windriver.com>
---
 drivers/crypto/sae/nlm_aead.c | 15 ++++++++++-----
 1 file changed, 10 insertions(+), 5 deletions(-)

diff --git a/drivers/crypto/sae/nlm_aead.c b/drivers/crypto/sae/nlm_aead.c
index 7f6ad2e..ec3ccd03 100755
--- a/drivers/crypto/sae/nlm_aead.c
+++ b/drivers/crypto/sae/nlm_aead.c
@@ -428,12 +428,17 @@ static int  xlp_3des_setkey(struct crypto_aead *tfm, u8 *key, unsigned int keyle
 		 cipher_keylen, auth_key, auth_keylen);
 	
 	nlm_ctx->stat = TDES_CBC_STAT | h_stat << 8;;
-	memcpy(d_key,&cipher_key[16],8);
-        memcpy(&d_key[1],&cipher_key[8],8);
-        memcpy(&d_key[2],&cipher_key[0],8);
+	if( CHIP_SUPPORTS(DES3_KEY_SWAP) ) {
+		memcpy((uint8_t *)d_key,cipher_key,24);
+	}
+	else {
+		memcpy(d_key,&cipher_key[16],8);
+		memcpy(&d_key[1],&cipher_key[8],8);
+		memcpy(&d_key[2],&cipher_key[0],8);
+	}
 	ret =  nlm_crypto_fill_pkt_ctrl(&nlm_ctx->ctrl, hmac, hash,
-		mode, cipher_alg, NLM_CIPHER_MODE_CBC, 0, ( unsigned char * )d_key,
-		cipher_keylen, auth_key, auth_keylen);
+			mode, cipher_alg, NLM_CIPHER_MODE_CBC, 0, ( unsigned char * )d_key,
+			cipher_keylen, auth_key, auth_keylen);
 	#ifdef NLM_CRYPTO_DEBUG 
 	print_buf("ENC_KEY:", cipher_key, cipher_keylen);
 	print_buf("AUTH_KEY:", auth_key, auth_keylen);
-- 
1.9.1

