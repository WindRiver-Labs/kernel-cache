From f8340e3da3fecdae58ea012bdbd64f785e2fe367 Mon Sep 17 00:00:00 2001
From: Vikas Gupta <vikas.gupta@broadcom.com>
Date: Tue, 11 Mar 2014 16:24:02 +0530
Subject: [PATCH 0906/1532] xlp9xx: Fix on chip LIFO configuration in
 port-fifo-mode for RXAUI.

[Based on SDK 3.2]
Signed-off-by: Quanyang Wang <quanyang.wang@windriver.com>
---
 arch/mips/netlogic/lib/netlib/src/netsoc_nae.c | 12 ++++++++++++
 1 file changed, 12 insertions(+)

diff --git a/arch/mips/netlogic/lib/netlib/src/netsoc_nae.c b/arch/mips/netlogic/lib/netlib/src/netsoc_nae.c
index 17990e9..ad714b0 100644
--- a/arch/mips/netlogic/lib/netlib/src/netsoc_nae.c
+++ b/arch/mips/netlogic/lib/netlib/src/netsoc_nae.c
@@ -3983,6 +3983,18 @@ static int __netsoc_config_freein_fifo(nae_t *nae)
                         }
                 }
 		if (is_nlm_xlp9xx()) {
+			/*rxaui has two physical ports in a quad*/
+			blk_cmplx_map = nae->rxaui_complex_map;
+			for(i = 0; blk_cmplx_map; i++) {
+                               if(!(blk_cmplx_map & 0x1))  {
+                                       blk_cmplx_map = blk_cmplx_map >> 1;
+                                       continue;
+                               }
+                               blk_cmplx_map = blk_cmplx_map >> 1;
+                               sfifo = i * MAX_PORTS_PERBLOCK;
+                               nae->freein_fifo_onchip_num_descs[sfifo] = nae->freein_fifo_onchip_num_descs[sfifo+2] = nae->freein_fifo_onchip_num_descs[sfifo]/2;             
+			}
+                       /*rest make them zero*/
 			sfifo = current_netsoc->max_ports;
 			for(fifo = sfifo; fifo < freein_fifo_total_queues; fifo++) {
                                 nae->freein_fifo_onchip_num_descs[fifo] = 0;
-- 
1.9.1

