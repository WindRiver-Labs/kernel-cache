From 96a1bd16bc3bbc06f824662e3dd0ac0c848b0fbc Mon Sep 17 00:00:00 2001
From: Subhendu Sekhar Behera <sbehera@broadcom.com>
Date: Wed, 19 Mar 2014 13:34:39 +0530
Subject: [PATCH 0494/1532] hpc: add FMN config and update cpumask, #nodes in
 dts.

[Based on SDK 3.2]
Signed-off-by: Quanyang Wang <quanyang.wang@windriver.com>
---
 arch/mips/boot/dts/mn4xlp8xx-helinux-nae.dts        | 11 ++++++-----
 arch/mips/boot/dts/mn4xlp8xx-helinux-nat.dts        | 11 ++++++-----
 arch/mips/boot/dts/mn4xlp8xx-hybrid-nae-helinux.dts | 11 ++++++-----
 arch/mips/boot/dts/mn4xlp8xx-linux.dts              | 17 +++++++++--------
 4 files changed, 27 insertions(+), 23 deletions(-)

diff --git a/arch/mips/boot/dts/mn4xlp8xx-helinux-nae.dts b/arch/mips/boot/dts/mn4xlp8xx-helinux-nae.dts
index c95f80b..0ec2e3d 100644
--- a/arch/mips/boot/dts/mn4xlp8xx-helinux-nae.dts
+++ b/arch/mips/boot/dts/mn4xlp8xx-helinux-nae.dts
@@ -32,11 +32,11 @@
 
 			#address-cells = <1>;
 			#size-cells = <1>;
-			#nodes = <2>;
-			#cpumask-cells=<2>;
+			#nodes = <4>;
+			#cpumask-cells=<4>;
 
 			cpu {
-				onlinemask = <0xffffffff 0xffffffff>;
+				onlinemask = <0xffffffff 0xffffffff 0xffffffff 0xffffffff>;
 				nae-rx-vc = <0>;
 				nae-fb-vc = <1>;
 				napi-vc-mask = <0x3>;
@@ -122,7 +122,7 @@
 			nae {
 			};
 			owner-config {
-				nae = <0x3>;   // currently for node0 and node1
+				nae = <0xf>;   // for node0, node1, node2 & node3
 				sae = <0x1>;   // for node0
 				rsa = <0x1>;
 				fmn = <0xf>;
@@ -165,6 +165,7 @@
 
 	chosen {
 		bootargs = " console=ttyS0,115200";
+		netlogic,cpumask = <0xffffffff 0xffffffff 0xffffffff 0xffffffff>;
 	};
 
 	/* These binaries are downloaded at the resp physical memory locations
@@ -185,7 +186,7 @@
 
 	soc {
 		nodes {
-			num-nodes = <2>;
+			num-nodes = <4>;
 		};
 	};
 	frequency-config {
diff --git a/arch/mips/boot/dts/mn4xlp8xx-helinux-nat.dts b/arch/mips/boot/dts/mn4xlp8xx-helinux-nat.dts
index d0c0b85..7cc32b2 100644
--- a/arch/mips/boot/dts/mn4xlp8xx-helinux-nat.dts
+++ b/arch/mips/boot/dts/mn4xlp8xx-helinux-nat.dts
@@ -24,11 +24,11 @@
 
 			#address-cells = <1>;
 			#size-cells = <1>;
-			#nodes = <2>;
-			#cpumask-cells=<2>;
+			#nodes = <4>;
+			#cpumask-cells=<4>;
 
 			cpu {
-				onlinemask = <0xffffffff 0xffffffff>;
+				onlinemask = <0xffffffff 0xffffffff 0xffffffff 0xffffffff>;
                                 nae-rx-vc = <0>;
                                 nae-fb-vc = <1>;
                                 napi-vc-mask = <0x3>;
@@ -58,7 +58,7 @@
 				vfbtbl-hw-nentries = <0 0 0 0>;
 			};
 			owner-config {
-				nae = <0x3>;   // currently for node0 and node1
+				nae = <0xf>;   // for node0, node1, node2 & node3
 				sae = <0x1>;   // for node0
 				rsa = <0x1>;
 				fmn = <0xf>;
@@ -191,6 +191,7 @@
 
 	chosen {
 		bootargs = " console=ttyS0,115200 ";
+		netlogic,cpumask = <0xffffffff 0xffffffff 0xffffffff 0xffffffff>;
 	};
 
 	/* These binaries are downloaded at the resp physical memory locations
@@ -211,7 +212,7 @@
 
 	soc {
 		nodes {
-			num-nodes = <2>;
+			num-nodes = <4>;
 		};
 
 	};
diff --git a/arch/mips/boot/dts/mn4xlp8xx-hybrid-nae-helinux.dts b/arch/mips/boot/dts/mn4xlp8xx-hybrid-nae-helinux.dts
index dcbdd83..a05c148 100644
--- a/arch/mips/boot/dts/mn4xlp8xx-hybrid-nae-helinux.dts
+++ b/arch/mips/boot/dts/mn4xlp8xx-hybrid-nae-helinux.dts
@@ -32,11 +32,11 @@
 
 			#address-cells = <1>;
 			#size-cells = <1>;
-			#nodes = <2>;
-			#cpumask-cells=<2>;
+			#nodes = <4>;
+			#cpumask-cells=<4>;
 
 			cpu {
-				onlinemask = <0xffffffff 0xffffffff>;
+				onlinemask = <0xffffffff 0xffffffff 0xffffffff 0xffffffff>;
 				nae-rx-vc = <0>;
 				nae-fb-vc = <1>;
 				napi-vc-mask = <0x3>;
@@ -63,7 +63,7 @@
 				vfbtbl-hw-nentries = <0 0 0 0>;
 			};
 			owner-config {
-				nae = <0x3>;   // currently for node0 and node1
+				nae = <0xf>;   // for node0, node1, node2 and node3
 				sae = <0x1>;   // for node0
 				rsa = <0x1>;
 				fmn = <0xf>;
@@ -199,6 +199,7 @@
 
 	chosen {
 		bootargs = " console=ttyS0,115200 ";
+		netlogic,cpumask = <0xffffffff 0xffffffff 0xffffffff 0xffffffff>;
 	};
 
 	/* These binaries are downloaded at the resp physical memory locations
@@ -219,7 +220,7 @@
 
 	soc {
 		nodes {
-			num-nodes = <2>;
+			num-nodes = <4>;
 		};
 	};
 	frequency-config {
diff --git a/arch/mips/boot/dts/mn4xlp8xx-linux.dts b/arch/mips/boot/dts/mn4xlp8xx-linux.dts
index e665a32..026c54c 100644
--- a/arch/mips/boot/dts/mn4xlp8xx-linux.dts
+++ b/arch/mips/boot/dts/mn4xlp8xx-linux.dts
@@ -40,11 +40,11 @@
 
 			#address-cells = <1>;
 			#size-cells = <1>;
-			#nodes = <2>;
-			#cpumask-cells=<2>;
+			#nodes = <4>;
+			#cpumask-cells=<4>;
 
 			cpu {
-				onlinemask = <0xffffffff 0xffffffff>;
+				onlinemask = <0xffffffff 0xffffffff 0xffffffff 0xffffffff>;
                                 nae-rx-vc = <0>;
                                 nae-fb-vc = <1>;
                                 napi-vc-mask = <0xb>;
@@ -65,16 +65,16 @@
                                 node_3_vc_mask = <0xbbbbbbbb 0xbbbbbbbb 0xbbbbbbbb 0xbbbbbbbb>;
 			};
 			nae {
-				freein-fifo-mask = <0xffff 0xffff 0 0>;
+				freein-fifo-mask = <0x3ffff 0x3ffff 0x3ffff 0x3ffff>;
 				/* node offsets and size */
 				vfbtbl-sw-offset = <0 0 0 0>;
 				vfbtbl-sw-nentries = <32 32 32 32>;
-				/* hw entries 40 for 2 nodes , 20 fifos each */
+				/* hw entries 80 for 4 nodes , 20 fifos each */
 				vfbtbl-hw-offset = <32 32 32 32>;
-				vfbtbl-hw-nentries = <40 40 40 40>;
+				vfbtbl-hw-nentries = <80 80 80 80>;
 			};
 			owner-config {
-				nae = <0x3>;   // currently for node0 and node1
+				nae = <0xf>;   // for node0, node1, node2 & node3
 				sae = <0x1>;   // for node0
 				rsa = <0x1>;
 				fmn = <0xf>;
@@ -87,6 +87,7 @@
 		bootargs = " console=ttyS0,115200";
 		/*linux,initrd-start=<0x00c00000>;
 		linux,initrd-end=<0x02c00000>;*/
+		netlogic,cpumask = <0xffffffff 0xffffffff 0xffffffff 0xffffffff>;
 	};
 
 	/* These binaries are downloaded at the resp physical memory locations
@@ -107,7 +108,7 @@
 
 	soc {
 		nodes {
-			num-nodes = <2>;
+			num-nodes = <4>;
 		};
 
 	};
-- 
1.9.1

