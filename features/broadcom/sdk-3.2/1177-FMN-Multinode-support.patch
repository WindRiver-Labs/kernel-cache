From 01d5bcfa3abea3b64ad11dd4a9de83d85f734df4 Mon Sep 17 00:00:00 2001
From: Prasanna Mumbai <prasanna.mumbai@broadcom.com>
Date: Thu, 29 Aug 2013 16:43:11 +0530
Subject: [PATCH 1177/1532] FMN: Multinode support

[Based on SDK 3.2]
Signed-off-by: Quanyang Wang <quanyang.wang@windriver.com>
---
 drivers/misc/netlogic/soc_interface/on_chip.c | 8 ++++++--
 1 file changed, 6 insertions(+), 2 deletions(-)

diff --git a/drivers/misc/netlogic/soc_interface/on_chip.c b/drivers/misc/netlogic/soc_interface/on_chip.c
index 9694377..8acd91d 100644
--- a/drivers/misc/netlogic/soc_interface/on_chip.c
+++ b/drivers/misc/netlogic/soc_interface/on_chip.c
@@ -1085,11 +1085,15 @@ static long fmn_config(void *arg)
 static int __init nlm_fmn_init(void)
 {
         int node, rv;
-	int node_exist[4] = {1, 0, 0, 0};
+	int node_exist[8] = {1, 0, 0, 0, 0, 0, 0, 0};
+	int max_nodes = NLM_MAX_NODES;
+
+	if(is_nlm_xlp9xx())
+		max_nodes = NLM_MAX_CPU_NODE_9XX;
 
         /* Better to do node level fmn initialization */
         if(get_dom_fmn_node_ownership(fdt, 0)) {
-                for(node = 0; node < NLM_MAX_NODES; node++) {
+                for(node = 0; node < max_nodes; node++) {
                         if(!node_exist[node])
                                 continue;
                         rv = work_on_cpu(node_exist[node] >> 16, fmn_config, (void *)(long)node);
-- 
1.9.1

