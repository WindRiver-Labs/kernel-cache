From 070f8d9d642b66d68349e95fa96958d3546a2b8d Mon Sep 17 00:00:00 2001
From: Rahul Jain <rajain@netlogicmicro.com>
Date: Sat, 10 Dec 2011 21:44:49 +0530
Subject: [PATCH 0273/1532] Vuart fixes for LinuxLoader

[Based on SDK 3.2]
Signed-off-by: Quanyang Wang <quanyang.wang@windriver.com>
---
 arch/mips/boot/dts/linux-loader.dts | 21 +++++++++++++++------
 arch/mips/boot/dts/multi-os.dts     |  8 ++++----
 2 files changed, 19 insertions(+), 10 deletions(-)

diff --git a/arch/mips/boot/dts/linux-loader.dts b/arch/mips/boot/dts/linux-loader.dts
index f565d89..c421af8 100644
--- a/arch/mips/boot/dts/linux-loader.dts
+++ b/arch/mips/boot/dts/linux-loader.dts
@@ -39,12 +39,12 @@
 			};
 			memory {
 				reg = <0x01000000 0x0B000000	// 176M at 16M
-					0x20000000 0x10000000>;  // 256M at 512M
+					0x10000000 0xa0000000>;  // 2586M at 256M
 			};
 			linuxloader{
 				loadermask = <0xfffffff0>;
 				memory = <0x00000002 0x00000000
-							0x00000000 0x80000000>;		//2G @ 8G
+					  0x00000000 0x80000000>; //2G @ 8G
 			};
 			pic {
 			};
@@ -70,7 +70,7 @@
 				location = "/tmp/xen/netos.elf";
 
 				/* Domain destroy currently doesn't work with hyperexec */
-				dom_destroy_hack = <1>;
+				dom_destroy_hack = <0>;
 			};
 
 			cpu {
@@ -85,6 +85,9 @@
 			memory {
 				reg = <0x50000000 0x10000000>;  // 1280M -> 1536M (256M)
 			};
+			nae{
+				owner = <0>;
+			};
 		};
 		dom@2 {
 			device_type = "domain";
@@ -111,12 +114,12 @@
 			};
 
 			cpu {
-				onlinemask = <0xfffffff0>;
+				onlinemask = <0xf00>;
                                 nae-rx-vc = <0>;
                                 nae-fb-vc = <1>;
                                 /* Setting this to '1' makes NAE driver to skip buf alloction and initial
                                    sending of packet buffers*/
-                                nae-buf-alloc-by-app = <0>; 
+                                nae-buf-alloc-by-app = <0>;
 			};
 			uart {
 				id = <0>;
@@ -125,6 +128,9 @@
 			memory {
 				reg = <0x60000000 0x30000000>;  // 1536M -> 2304M (768M)
 			};
+			nae{
+				owner = <0>;
+			};
 		};
 		dom@3 {
 			device_type = "domain";
@@ -151,7 +157,7 @@
 			};
 
 			cpu {
-				loadermask = <0xfffffff0>;
+				onlinemask = <0xfffff000>;
                                 nae-rx-vc = <0>;
                                 nae-fb-vc = <1>;
 			};
@@ -162,6 +168,9 @@
 			memory {
 				reg = <0x90000000 0x30000000>;  // 2304M -> 3072M (768MB)
 			};
+			nae{
+				owner = <0>;
+			};
 		};
 	};
 
diff --git a/arch/mips/boot/dts/multi-os.dts b/arch/mips/boot/dts/multi-os.dts
index f2078e2..8e89e1a 100644
--- a/arch/mips/boot/dts/multi-os.dts
+++ b/arch/mips/boot/dts/multi-os.dts
@@ -38,9 +38,9 @@
 				sharedcfg = <0x1f000000>;
 			};
 			memory {
-				reg = <0x01000000 0x0F000000	// 240M at 16M
-				       0x20000000 0x10000000    // 256M at 512M
-					   0x80000000 0x10000000>;  // 256M at 2G
+				reg = <	0x01000000 0x0F000000	// 240M at 16M
+				       	0x20000000 0x10000000    // 256M at 512M
+				  	0x80000000 0x10000000>;  // 256M at 2G
 			};
 			pic {
 			};
@@ -66,7 +66,7 @@
 				location = "/tmp/xen/netos.elf";
 
 				/* Domain destroy currently doesn't work with hyperexec */
-				dom_destroy_hack = <1>;
+				dom_destroy_hack = <0>;
 			};
 
 			cpu {
-- 
1.9.1

