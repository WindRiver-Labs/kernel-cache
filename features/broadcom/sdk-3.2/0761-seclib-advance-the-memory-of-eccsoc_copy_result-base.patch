From 5d468b518a74efb5aefd0527875583e124980b80 Mon Sep 17 00:00:00 2001
From: reshmic <reshmic@broadcom.com>
Date: Mon, 22 Jul 2013 10:32:41 +0530
Subject: [PATCH 0761/1532] seclib: advance the memory of eccsoc_copy_result
 based on blksz_in_bits. Added my_cpu_id()

[Based on SDK 3.2]
Signed-off-by: Quanyang Wang <quanyang.wang@windriver.com>
---
 arch/mips/netlogic/lib/seclib/eccsoc_lib.h |  1 +
 arch/mips/netlogic/lib/seclib/saesoc_lib.h | 12 ++++++++++++
 2 files changed, 13 insertions(+)

diff --git a/arch/mips/netlogic/lib/seclib/eccsoc_lib.h b/arch/mips/netlogic/lib/seclib/eccsoc_lib.h
index c295664..cf5c4bf 100644
--- a/arch/mips/netlogic/lib/seclib/eccsoc_lib.h
+++ b/arch/mips/netlogic/lib/seclib/eccsoc_lib.h
@@ -1502,6 +1502,7 @@ static inline int eccsoc_copy_result(struct eccsoc_request_desc *req_desc, int r
 		return -CRYPTOSOC_EINVAL;
 
 	if(dpriv->req_info[req_num].rylen_in_bits) {
+		blk = dpriv->req_info[req_num].blksz_in_bits/8;
 		rmem += blk;
 		if(rsa_ecc_soc_result_copy_1(dpriv->req_info[req_num].out_data_fmt,
 					dpriv->req_info[req_num].out_word_bigendian,
diff --git a/arch/mips/netlogic/lib/seclib/saesoc_lib.h b/arch/mips/netlogic/lib/seclib/saesoc_lib.h
index 7aea02e..546c3a6 100644
--- a/arch/mips/netlogic/lib/seclib/saesoc_lib.h
+++ b/arch/mips/netlogic/lib/seclib/saesoc_lib.h
@@ -1927,8 +1927,20 @@ send_req:
 	}
 }
 
+static inline int my_cpu_id(void)
+{
+	unsigned int pid = 0;
 
+	__asm__ volatile (".set push\n"
+			".set noreorder\n"
+			".set arch=xlp\n"
+			"rdhwr %0, $0\n"
+			".set pop\n"
+			: "=r" (pid)
+			:);
 
+	return pid;
+}
 
 #endif
 
-- 
1.9.1

