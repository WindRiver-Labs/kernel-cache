From fcadce4ccdd8c854f66d23ec1f7985ccfd70be74 Mon Sep 17 00:00:00 2001
From: Alok Agrawat <alok@broadcom.com>
Date: Wed, 7 Nov 2012 04:19:00 -0800
Subject: [PATCH 1129/1532] CDE: Add CDE support for Linux 3.0

[Based on SDK 3.2]
Signed-off-by: Quanyang Wang <quanyang.wang@windriver.com>
---
 drivers/misc/netlogic/nlm_cde/nlm_cde.c | 15 +++++++++++----
 1 file changed, 11 insertions(+), 4 deletions(-)

diff --git a/drivers/misc/netlogic/nlm_cde/nlm_cde.c b/drivers/misc/netlogic/nlm_cde/nlm_cde.c
index e852f8c..cdebb27 100644
--- a/drivers/misc/netlogic/nlm_cde/nlm_cde.c
+++ b/drivers/misc/netlogic/nlm_cde/nlm_cde.c
@@ -32,7 +32,7 @@
 #include <linux/ioport.h>	/* for request_region */
 #include <linux/delay.h>	/* for loops_per_jiffy */
 #include <linux/sched.h>
-#include <linux/smp_lock.h>	/* cycle_kernel_lock() */
+#include <linux/ioctl.h>	
 #include <asm/io.h>		/* for inb_p, outb_p, inb, outb, etc. */
 #include <asm/uaccess.h>	/* for get_user, etc. */
 #include <linux/init.h>		/* for __init, module_{init,exit} */
@@ -54,10 +54,17 @@
 #define L3_CACHELINE_MASK 0x3fULL
 #define VC_MODE_ROUND_ROBIN 1
 
+struct msgrng_msg {
+  __u64 msg0;
+  __u64 msg1;
+  __u64 msg2;
+  __u64 msg3;
+};
+
 static int xlp_cde_major;
 int xlp_cde_open(struct inode *, struct file *);
 int xlp_cde_release(struct inode *, struct file *);
-int xlp_cde_ioctl(struct inode *inode, struct file *fptr, unsigned int type, unsigned long val);
+int xlp_cde_ioctl(struct file *fptr, unsigned int type, unsigned long val);
 ssize_t xlp_cde_read(struct file *filp, char __user *buf, size_t count, loff_t *f_pos);
 ssize_t xlp_cde_write(struct file *filp, const char __user *buf, size_t count, loff_t *f_pos);
 static int xlp_cde_mmap(struct file * filp, struct vm_area_struct * vma);
@@ -155,7 +162,7 @@ static const struct file_operations xlp_cde_fops = {
     .open = xlp_cde_open,
     .read = xlp_cde_read,
     .write = xlp_cde_write,
-    .ioctl = xlp_cde_ioctl,
+    .compat_ioctl = xlp_cde_ioctl,
     .mmap = xlp_cde_mmap,
     .release = xlp_cde_release,
 };
@@ -845,7 +852,7 @@ ssize_t xlp_cde_write(struct file *filp, const char __user *buf,
 }
 
 
-int xlp_cde_ioctl(struct inode *inode, struct file *filp,
+int xlp_cde_ioctl(struct file *filp,
 	      unsigned int cmd, unsigned long arg)
 {
   int err = 0, i = 0;
-- 
1.9.1

