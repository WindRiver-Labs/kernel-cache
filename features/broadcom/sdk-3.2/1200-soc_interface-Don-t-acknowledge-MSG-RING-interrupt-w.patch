From 28a1e233a9acddedf86bc6526d1bd06103f5cd0d Mon Sep 17 00:00:00 2001
From: Deepak Jangid <deepak.jangid@broadcom.com>
Date: Tue, 17 Dec 2013 02:57:01 -0800
Subject: [PATCH 1200/1532] soc_interface: Don't acknowledge MSG RING interrupt
 when interrupt handler returns 1. This is needed for drivers that have their
 own NAPI handlers.

[Based on SDK 3.2]
Signed-off-by: Quanyang Wang <quanyang.wang@windriver.com>
---
 drivers/misc/netlogic/soc_interface/on_chip.c | 6 +++++-
 1 file changed, 5 insertions(+), 1 deletion(-)

diff --git a/drivers/misc/netlogic/soc_interface/on_chip.c b/drivers/misc/netlogic/soc_interface/on_chip.c
index 4606002..e86e7aa 100644
--- a/drivers/misc/netlogic/soc_interface/on_chip.c
+++ b/drivers/misc/netlogic/soc_interface/on_chip.c
@@ -839,7 +839,11 @@ void nlm_xlp_msgring_int_handler(unsigned int irq, struct pt_regs *regs)
 			for(vc = 0; vc < 4; vc++) {
 				if(!(vcmask & (1<<vc)))
 					continue;
-				xlp_intr_vc_handler(vc);
+				/*Don't acknowledge MSG RING interrupt when 
+				  intr_vc_handler returns 1*/
+				if(xlp_intr_vc_handler(vc) == 1){
+					pop_vc_mask = pop_vc_mask & ~(1<<vc);
+				}
 			}
 		}
 
-- 
1.9.1

