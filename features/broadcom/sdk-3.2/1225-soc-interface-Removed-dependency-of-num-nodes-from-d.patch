From 44ea3901d7f76c2288d77d55779666404b8a02ab Mon Sep 17 00:00:00 2001
From: Debayan Ghosh <debayan.ghosh@broadcom.com>
Date: Tue, 29 Apr 2014 01:28:52 +0530
Subject: [PATCH 1225/1532] soc interface: Removed dependency of num-nodes from
 dts file, use runtime value instead

[Based on SDK 3.2]
Signed-off-by: Quanyang Wang <quanyang.wang@windriver.com>
---
 drivers/misc/netlogic/soc_interface/on_chip.c | 7 ++-----
 1 file changed, 2 insertions(+), 5 deletions(-)

diff --git a/drivers/misc/netlogic/soc_interface/on_chip.c b/drivers/misc/netlogic/soc_interface/on_chip.c
index 19933d3..86341da 100644
--- a/drivers/misc/netlogic/soc_interface/on_chip.c
+++ b/drivers/misc/netlogic/soc_interface/on_chip.c
@@ -1498,11 +1498,10 @@ int ipsec_async_vc = -1, ipsec_sync_vc = -1;
 static void parse_fdt_sae_vc_config(void)
 {
 	void *node;
-	void * valid_node;
 	int i;
 	int num_nodes = 1;
 	extern uint32_t nlm_cpu_vc_mask[NLM_MAX_CPU_NODE_9XX*NLM_MAX_CPU_PER_NODE_9XX];
-
+	
 	node = finddevice("/doms/dom@0/cpu");
 	if(node) {
 		if (getprop(node, "nae-rx-vc", &nae_rx_vc, 4) > 0)
@@ -1526,10 +1525,8 @@ static void parse_fdt_sae_vc_config(void)
 		if (getprop(node, "ipsec-sync-vc", &ipsec_sync_vc, 4) > 0)
 			ipsec_sync_vc = fdt32_to_cpu(ipsec_sync_vc);
 
-		valid_node  = finddevice("/soc/nodes");
 
-		if (getprop(valid_node, "num-nodes", &num_nodes, 4) > 0 )
-			num_nodes = fdt32_to_cpu(num_nodes);
+		num_nodes = nlm_hal_get_num_nodes();
 
 		for(i =0 ; i < num_nodes*NLM_MAX_CPU_PER_NODE; i++) {
 			if(nlm_cpu_vc_mask[i] & (1 << ipsec_sync_vc)) {
-- 
1.9.1

