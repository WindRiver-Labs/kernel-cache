From dc4a903c91e5fe4341a5adcd6a51478dc8d2ee26 Mon Sep 17 00:00:00 2001
From: Subhendu Sekhar Behera <sbehera@broadcom.com>
Date: Wed, 2 Apr 2014 16:03:39 +0530
Subject: [PATCH 0922/1532] XLP9xx: Detect XLAUI through CPLD.

Just check the board type & return the interface type
[Based on SDK 3.2]
Signed-off-by: Quanyang Wang <quanyang.wang@windriver.com>
---
 arch/mips/netlogic/lib/syslib/src/nlm_evp_cpld.c | 10 ++++++++++
 1 file changed, 10 insertions(+)

diff --git a/arch/mips/netlogic/lib/syslib/src/nlm_evp_cpld.c b/arch/mips/netlogic/lib/syslib/src/nlm_evp_cpld.c
index 1ac3b40..db6ffd7 100644
--- a/arch/mips/netlogic/lib/syslib/src/nlm_evp_cpld.c
+++ b/arch/mips/netlogic/lib/syslib/src/nlm_evp_cpld.c
@@ -117,6 +117,12 @@ int nlm_xlp_cpldver(void)
 	return nlm_hal_cpld_read_16(2, 0);
 }
 
+int nlm_xlp_gvp_rev(void)
+{
+	uint16_t data = nlm_hal_cpld_read_16(2, 5);
+	return (data >> 2) & 0x7;
+}
+
 int is_xlp_evp1(void)
 {
 #ifndef CONFIG_N511
@@ -181,6 +187,10 @@ int nlm_get_interface_type(int node, int slot)
 		return DC_NOT_PRSNT;
 #endif
 
+	if (is_nlm_xlp9xx())
+		if (nlm_xlp_gvp_rev() == 3)
+			return DC_XLAUI;
+
 	data = nlm_hal_cpld_read_16(2, 6);
 	nlm_print("Slot present status 0x%x\n", (data & 0xFF));
         if (slot == 4)
-- 
1.9.1

