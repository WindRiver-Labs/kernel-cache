From 441a073676413e7d36395924e933b173ddf3c70d Mon Sep 17 00:00:00 2001
From: Alok Agrawat <alok@lc-blr-619.ban.broadcom.com>
Date: Mon, 4 Aug 2014 16:17:32 +0530
Subject: [PATCH 1000/1532] nae: No Interlaken support on XLP5xx Lite.

[Based on SDK 3.2]
Signed-off-by: Quanyang Wang <quanyang.wang@windriver.com>
---
 arch/mips/netlogic/lib/syslib/src/nlm_evp_cpld.c | 16 ++++++++--------
 1 file changed, 8 insertions(+), 8 deletions(-)

diff --git a/arch/mips/netlogic/lib/syslib/src/nlm_evp_cpld.c b/arch/mips/netlogic/lib/syslib/src/nlm_evp_cpld.c
index 4032f9e..28425a0 100644
--- a/arch/mips/netlogic/lib/syslib/src/nlm_evp_cpld.c
+++ b/arch/mips/netlogic/lib/syslib/src/nlm_evp_cpld.c
@@ -60,7 +60,7 @@ static nlm_xlp_nor_t xlp_nor_dev[8] = {
 
 static inline uint32_t nlm_hal_nor_read(uint32_t reg)
 {
-	if(!IS_NLM_XLP9XX_FAMILY)
+	if(!(is_nlm_xlp9xx() || is_nlm_xlp5xx_B(XLP_REVISION_ANY)))
        		return nlm_hal_read_32bit_reg(NLM_NOR_CFG_BASE, reg);
 	else
        		return nlm_hal_read_32bit_reg(NLM_NOR_CFG_BASE_9XX, reg);
@@ -68,7 +68,7 @@ static inline uint32_t nlm_hal_nor_read(uint32_t reg)
 
 static inline void nlm_hal_nor_write(uint32_t reg, uint32_t val)
 {
-	if(!IS_NLM_XLP9XX_FAMILY)
+	if(!(is_nlm_xlp9xx() || is_nlm_xlp5xx_B(XLP_REVISION_ANY)))
         	nlm_hal_write_32bit_reg(NLM_NOR_CFG_BASE, reg, val);
 	else
         	nlm_hal_write_32bit_reg(NLM_NOR_CFG_BASE_9XX, reg, val);
@@ -78,7 +78,7 @@ uint16_t nlm_hal_cpld_read_16(int cs, uint16_t reg)
 {
 #ifndef CONFIG_N511
         uint16_t val;
-	if(!IS_NLM_XLP9XX_FAMILY)
+	if(!(is_nlm_xlp9xx() || is_nlm_xlp5xx_B(XLP_REVISION_ANY)))
 	{
 		if ((cs == 3) || (cs ==4))
 			nlm_hal_nor_write(XLP_NOR_DEVPARAM + cs , 0x2f84);
@@ -95,7 +95,7 @@ void nlm_hal_cpld_write_16(int cs, uint16_t val, uint16_t reg)
 {
 #ifndef CONFIG_N511
         uint16_t data = xlp_nor_dev[cs].swap ? cpu_to_le16(val): cpu_to_be16(val);
-	if(!IS_NLM_XLP9XX_FAMILY)
+	if(!(is_nlm_xlp9xx() || is_nlm_xlp5xx_B(XLP_REVISION_ANY)))
 	{
 		if ((cs == 3) || (cs ==4))
 	        	nlm_hal_nor_write(XLP_NOR_DEVPARAM + cs , 0x2d84);
@@ -187,7 +187,7 @@ int nlm_get_interface_type(int node, int slot)
 		return DC_NOT_PRSNT;
 #endif
 
-	if (IS_NLM_XLP9XX_FAMILY)
+	if ((is_nlm_xlp9xx() || is_nlm_xlp5xx_B(XLP_REVISION_ANY)))
 		if (nlm_xlp_gvp_rev() == 3)
 			return DC_XLAUI;
 
@@ -218,7 +218,7 @@ int xlp_cpld_init(uint32_t cs)
 		return -1;
 	if(cs == 3)
 	{
-		if(IS_NLM_XLP9XX_FAMILY)
+		if((is_nlm_xlp9xx() || is_nlm_xlp5xx_B(XLP_REVISION_ANY)))
 		{
 			/* In xlp9xx CS 3 is used by Interlaken,
 			 * need to change the devparam for Interlaken.
@@ -245,7 +245,7 @@ void set_gbu_frequency(int node, int frequency)
 		set_freq = nlm_hal_xlp2xx_set_clkdev_frq(node, XLP2XX_CLKDEVICE_GBU, frequency * mhz);
 		NLM_HAL_DO_DIV(set_freq,mhz);
 	}
-	else if(IS_NLM_XLP9XX_FAMILY)
+	else if((is_nlm_xlp9xx() || is_nlm_xlp5xx_B(XLP_REVISION_ANY)))
 	{
 		set_freq = xlp9xx_set_soc_frequency(node, XLP9XX_CLKDEV_GBU, frequency * mhz);
 		NLM_HAL_DO_DIV(set_freq,mhz);
@@ -262,7 +262,7 @@ void nlm_hal_cpld_init(int node)
 #if !defined(XLP_SIM) || defined(NLM_BOARD)
 	int i;
 #if defined(NLM_CORTINA_SUPPORT)
-	if(IS_NLM_XLP9XX_FAMILY)
+	if((is_nlm_xlp9xx() || is_nlm_xlp5xx_B(XLP_REVISION_ANY)))
 		set_gbu_frequency(node, NLM_GBU_FREQ_ILK_9XX);
 	else
 		set_gbu_frequency(node, NLM_GBU_FREQ_ILK);
-- 
1.9.1

