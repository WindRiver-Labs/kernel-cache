From 6a835db56c254b2f85dcbe79fa6f0badcfa34317 Mon Sep 17 00:00:00 2001
From: Hareesh R <hareeshr@broadcom.com>
Date: Wed, 20 Nov 2013 15:43:17 +0530
Subject: [PATCH 0856/1532] seclib:Removed 3des key swapping done flag

[Based on SDK 3.2]
Signed-off-by: Quanyang Wang <quanyang.wang@windriver.com>
---
 arch/mips/netlogic/lib/seclib/saesoc_defs.h |  3 +--
 arch/mips/netlogic/lib/seclib/saesoc_lib.h  | 12 +-----------
 arch/mips/netlogic/lib/syslib/src/nlm_hal.c |  2 +-
 3 files changed, 3 insertions(+), 14 deletions(-)

diff --git a/arch/mips/netlogic/lib/seclib/saesoc_defs.h b/arch/mips/netlogic/lib/seclib/saesoc_defs.h
index 5b4ce21..fc522aa 100644
--- a/arch/mips/netlogic/lib/seclib/saesoc_defs.h
+++ b/arch/mips/netlogic/lib/seclib/saesoc_defs.h
@@ -123,7 +123,7 @@
 	   	SAESOC_FF_TAG_LOC_EOP_SUPPORT | SAESOC_FF_TAGIN_OFF_SUPPORT | \
 		SAESOC_FF_TRUNC_TAG_SUPPORT | SAESOC_FF_EXPLICIT_IV_SUPPORT | \
 		SAESOC_FF_HASHMUTE_SUPPORT | SAESOC_FF_NAAD_SUPPORT | \
-		SAESOC_FF_DIS_WR_FRAG_SUPPORT)
+		SAESOC_FF_DIS_WR_FRAG_SUPPORT | SAESOC_FF_3DES_KEY_SWAP_SUPPORT)
 
 /**
 * defines per_pkt_update_flags : Per packet modifiable parameters. These are the apis which differs 
@@ -212,7 +212,6 @@ enum saesoc_ddesc_reset_op {
 *	Valid only if CIPHER_PAD in the feature flag is set
 * @SAESOC_CF_ARC4_KEY_INIT: Arc4 key is initted for the first time, for the next
 *	from next time init key has to be reseted to 0.
-* @SAESOC_CF_DES3_KEYSWAP_DONE: DES3 key swap is already done by the application
 */
 
 /*!defines ciph_init_flags < */
diff --git a/arch/mips/netlogic/lib/seclib/saesoc_lib.h b/arch/mips/netlogic/lib/seclib/saesoc_lib.h
index 668f73b..7f71b96 100644
--- a/arch/mips/netlogic/lib/seclib/saesoc_lib.h
+++ b/arch/mips/netlogic/lib/seclib/saesoc_lib.h
@@ -652,17 +652,7 @@ static inline int saesoc_new_session(
 			if(initp->cipher.mode == SAESOC_CIPHER_MODE_CFB) {
 				saesoc_gen1_set_cfbmask(sd->descs[0],initp->cipher.cfb_mask);
 			}	
-			if ( (saesoc_gen1_cipher_table_map[initp->cipher.type] == 0x2) && 
-					!(initp->cipher.flags & SAESOC_CF_ENCRYPT) &&
-					!(initp->cipher.flags & SAESOC_CF_DES3_KEYSWAP_DONE) )
-			{	
-				unsigned long long  * key = (unsigned long long  *)initp->cipher.key;
-				sd->descs[keyidx] = key[2];
-				sd->descs[keyidx+1] = key[1];
-				sd->descs[keyidx+2] = key[0];
-			}
-			else
-				memcpy((char *)(long)&sd->descs[keyidx],initp->cipher.key, 
+			memcpy((char *)(long)&sd->descs[keyidx],initp->cipher.key, 
 					initp->cipher.key_len);
 			spriv->cipher_key_len_in_dw = 	((cryptosoc_roundup(initp->cipher.key_len,
 							sizeof(_uint64_t))) / sizeof(_uint64_t)); 
diff --git a/arch/mips/netlogic/lib/syslib/src/nlm_hal.c b/arch/mips/netlogic/lib/syslib/src/nlm_hal.c
index 7d5ccb7..06891ec 100644
--- a/arch/mips/netlogic/lib/syslib/src/nlm_hal.c
+++ b/arch/mips/netlogic/lib/syslib/src/nlm_hal.c
@@ -1027,7 +1027,7 @@ void nlm_hal_set_rsa_freq(int node, int freq)
 	nlm_print("--RSA Frequency set to %d\n", freq);
 	if(is_nlm_xlp2xx()) {
 		nlm_hal_xlp2xx_set_clkdev_frq(node, XLP2XX_CLKDEVICE_RSA, freq * mhz);
-	} if (is_nlm_xlp9xx()) {
+	} else if (is_nlm_xlp9xx()) {
             xlp9xx_set_soc_frequency(node, XLP9XX_CLKDEV_RSA, freq*mhz);
         } else {
 		uint64_t set_freq = nlm_hal_set_soc_freq(0, DFS_DEVICE_RSA, freq * mhz);
-- 
1.9.1

