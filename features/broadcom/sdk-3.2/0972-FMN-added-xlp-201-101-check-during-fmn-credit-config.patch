From 33b6712f40366bee2c24715deb5bd443b1f07b0a Mon Sep 17 00:00:00 2001
From: Kevin Joseph James <kevinj@broadcom.com>
Date: Wed, 7 May 2014 02:55:44 -0700
Subject: [PATCH 0972/1532] FMN: added xlp 201/101 check during fmn credit
 configuration

[Based on SDK 3.2]
Signed-off-by: Quanyang Wang <quanyang.wang@windriver.com>
---
 arch/mips/netlogic/lib/fmnlib/nlm_hal_fmn_config.c     | 18 ++++++++++++++----
 .../mips/netlogic/lib/syslib/include/nlm_hal_xlp_dev.h |  1 +
 2 files changed, 15 insertions(+), 4 deletions(-)

diff --git a/arch/mips/netlogic/lib/fmnlib/nlm_hal_fmn_config.c b/arch/mips/netlogic/lib/fmnlib/nlm_hal_fmn_config.c
index 37190e0..2a2a3c8 100644
--- a/arch/mips/netlogic/lib/fmnlib/nlm_hal_fmn_config.c
+++ b/arch/mips/netlogic/lib/fmnlib/nlm_hal_fmn_config.c
@@ -1097,7 +1097,7 @@ static void nlm_hal_write_fmn_credit(int node, int max_nodes)
 			fmn_modify_qsize_credit_config(node, XLP_MSG_BLK_CPU, 3, XLP_CPU0_VC_BASE, XLP_CPU2_VC_LIMIT);
 		}
 		else if(is_nlm_xlp308() || is_nlm_xlp208() || is_nlm_xlp108()){
-			nlm_print(" XLP308/208 FMN configuration \n");
+			nlm_print(" XLP308/208/108 FMN configuration \n");
 			fmn_config = (is_nlm_xlp308())? &xlp3xx_fmn_config[0] : &xlp2xx_fmn_config[0];
 			fmn_config += XLP_MSG_HANDLE_CPU2;
 			for(hndl = 0; hndl<2; hndl++){
@@ -1106,10 +1106,9 @@ static void nlm_hal_write_fmn_credit(int node, int max_nodes)
 				fmn_config++;
 			}
 			fmn_modify_qsize_credit_config(node, XLP_MSG_BLK_CPU, 2, XLP_CPU0_VC_BASE, XLP_CPU1_VC_LIMIT);
-
 		}
 		else if(is_nlm_xlp304() || is_nlm_xlp204() || is_nlm_xlp104()){
-			nlm_print(" XLP304/204 FMN configuration \n");
+			nlm_print(" XLP304/204/104 FMN configuration \n");
 			fmn_config = (is_nlm_xlp304())? &xlp3xx_fmn_config[0] : &xlp2xx_fmn_config[0];
 			fmn_config += XLP_MSG_HANDLE_CPU1;
 			for(hndl = 0; hndl<3; hndl++){
@@ -1117,9 +1116,20 @@ static void nlm_hal_write_fmn_credit(int node, int max_nodes)
 				fmn_config->vc_limit =0;
 				fmn_config++;
 			}
-
 			fmn_modify_qsize_credit_config(node, XLP_MSG_BLK_CPU, 1, XLP_CPU0_VC_BASE, XLP_CPU0_VC_LIMIT);
 		}
+                else if(is_nlm_xlp201() || is_nlm_xlp101()){
+                        nlm_print(" XLP201/101 FMN configuration \n");
+                        fmn_config = (is_nlm_xlp304())? &xlp3xx_fmn_config[0] : &xlp2xx_fmn_config[0];
+                        fmn_config += XLP_MSG_HANDLE_CPU1;
+                        for(hndl = 0; hndl<3; hndl++){
+                                fmn_config->base_vc = XLP_3XX_INVALID_STATION,
+                                fmn_config->vc_limit =0;
+                                fmn_config++;
+                        }
+                        fmn_modify_qsize_credit_config(node, XLP_MSG_BLK_CPU, 1, XLP_CPU0_VC_BASE, XLP_THREAD0_VC_LIMIT);
+                }
+
 		else { }
 
 		if (is_nlm_xlp3xx()) {
diff --git a/arch/mips/netlogic/lib/syslib/include/nlm_hal_xlp_dev.h b/arch/mips/netlogic/lib/syslib/include/nlm_hal_xlp_dev.h
index 46bfeb9..3faad78 100644
--- a/arch/mips/netlogic/lib/syslib/include/nlm_hal_xlp_dev.h
+++ b/arch/mips/netlogic/lib/syslib/include/nlm_hal_xlp_dev.h
@@ -293,6 +293,7 @@ extern int is_nlm_xlp(unsigned int chipid, unsigned int rev,  unsigned int ext);
 #define XLP_POPQ_VC_LIMIT	255
 
 #define XLP_CPU0_VC_BASE	0
+#define XLP_THREAD0_VC_LIMIT    3
 #define XLP_CPU0_VC_LIMIT       15
 #define XLP_CPU1_VC_LIMIT       31
 #define XLP_CPU2_VC_LIMIT       47
-- 
1.9.1

