From 5b4ec8009d0adef46828bb530158955ad3ea2321 Mon Sep 17 00:00:00 2001
From: Quanyang Wang <quanyang.wang@windriver.com>
Date: Fri, 3 Apr 2015 13:47:00 +0800
Subject: [PATCH 1/2] bcm-xlp: fix nae promisc mode issue

When using tcpdump to test nae's promisc mode, nae driver
will call __netsoc_promisc_enable first and call
__netsoc_promisc_disable when quit promisc mode. In function
__netsoc_promisc_disable, it will write 0x1 to MAC_FILTER_CONFIG,
it means only MAC0 can work, but when enter promisc mode, its
value is 0xf which means 4 macaddr is used. So delete this
operation to be consistent with enable function.

Signed-off-by: Quanyang Wang <quanyang.wang@windriver.com>
---
 arch/mips/netlogic/lib/netlib/src/netsoc_nae.c |    4 ++--
 1 files changed, 2 insertions(+), 2 deletions(-)

diff --git a/arch/mips/netlogic/lib/netlib/src/netsoc_nae.c b/arch/mips/netlogic/lib/netlib/src/netsoc_nae.c
index 41e10f5..25d91cb 100644
--- a/arch/mips/netlogic/lib/netlib/src/netsoc_nae.c
+++ b/arch/mips/netlogic/lib/netlib/src/netsoc_nae.c
@@ -3300,7 +3300,7 @@ void __netsoc_promisc_disable(net_port_t *netport)
 
                                 netsoc_write_mac_reg(mac_base, MAC_ADDR0_MASK_LO, 0xffffffff);
                                 netsoc_write_mac_reg(mac_base, MAC_ADDR0_MASK_HI, 0xffff0000);
-                                netsoc_write_mac_reg(mac_base, MAC_FILTER_CONFIG, 0x1); 	/* MAC0 Valid */
+				/* netsoc_write_mac_reg(mac_base, MAC_FILTER_CONFIG, 0x1); */	/* MAC0 Valid */
                                 reg_val = netsoc_read_mac_reg(mac_base, NETIOR_VLANTYPE_FILTER);
                                 reg_val |= (1<<17);
                                 netsoc_write_mac_reg(mac_base, NETIOR_VLANTYPE_FILTER, reg_val);
@@ -3313,7 +3313,7 @@ void __netsoc_promisc_disable(net_port_t *netport)
 
                                 netsoc_write_mac_reg(mac_base, MAC_ADDR0_MASK_LO, 0xffffffff);
                                 netsoc_write_mac_reg(mac_base, MAC_ADDR0_MASK_HI, 0xffff0000);
-                                netsoc_write_mac_reg(mac_base, MAC_FILTER_CONFIG, 0x1); 	/* MAC0 Valid */
+				/* netsoc_write_mac_reg(mac_base, MAC_FILTER_CONFIG, 0x1); */	/* MAC0 Valid */
                                 reg_val = netsoc_read_mac_reg(mac_base, NETIOR_VLANTYPE_FILTER);
                                 reg_val &= ~(1<<16);
                                 netsoc_write_mac_reg(mac_base, NETIOR_VLANTYPE_FILTER, reg_val);
-- 
1.7.5.4

