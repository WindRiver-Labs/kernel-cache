From ba5189b8bb2f5a347898f5b9d72b70771ef75fbc Mon Sep 17 00:00:00 2001
From: Sreenidhi B R <sreenira@broadcom.com>
Date: Mon, 27 May 2013 09:29:33 +0530
Subject: [PATCH 0701/1532] fmnlib: update changed stationIDs for xlp9xx.

[Based on SDK 3.2]
Signed-off-by: Quanyang Wang <quanyang.wang@windriver.com>
---
 arch/mips/netlogic/lib/fmnlib/nlm_hal_fmn.h        |  2 ++
 arch/mips/netlogic/lib/fmnlib/nlm_hal_fmn_config.c | 12 ++++++++++++
 2 files changed, 14 insertions(+)

diff --git a/arch/mips/netlogic/lib/fmnlib/nlm_hal_fmn.h b/arch/mips/netlogic/lib/fmnlib/nlm_hal_fmn.h
index 4f061bd..5dbe2d9 100644
--- a/arch/mips/netlogic/lib/fmnlib/nlm_hal_fmn.h
+++ b/arch/mips/netlogic/lib/fmnlib/nlm_hal_fmn.h
@@ -62,6 +62,7 @@ enum FMN_MSG_BLKS {
         XLP_MSG_BLK_PCIE2,
         XLP_MSG_BLK_PCIE3,
 	XLP_MSG_BLK_GDX,
+	XLP_MSG_BLK_GDX1,
 	XLP_MSG_BLK_RSA_ECC,
 	XLP_MSG_BLK_CRYPTO,
 	XLP_MSG_BLK_CMP,
@@ -69,6 +70,7 @@ enum FMN_MSG_BLKS {
 	XLP_MSG_BLK_NAE,
 	XLP_MSG_BLK_REGX,
 	XLP_MSG_BLK_SRIO,
+	XLP_MSG_BLK_LZS,
 	XLP_MSG_BLK_MAX
 };
 
diff --git a/arch/mips/netlogic/lib/fmnlib/nlm_hal_fmn_config.c b/arch/mips/netlogic/lib/fmnlib/nlm_hal_fmn_config.c
index 201644c..be5de5f 100644
--- a/arch/mips/netlogic/lib/fmnlib/nlm_hal_fmn_config.c
+++ b/arch/mips/netlogic/lib/fmnlib/nlm_hal_fmn_config.c
@@ -226,6 +226,7 @@ static struct fmn_qsize_credit_config fmn_qsize_credit_cfg[XLP_MSG_BLK_MAX] = {
         [XLP_MSG_BLK_PCIE2] =    { "pcie2",   XLP_PCIE2_VC_BASE,     XLP_PCIE2_VC_LIMIT,     1, 1 },
         [XLP_MSG_BLK_PCIE3] =    { "pcie3",   XLP_PCIE3_VC_BASE,     XLP_PCIE3_VC_LIMIT,     1, 1 },
 	[XLP_MSG_BLK_GDX]  =    { "gdx",    XLP_GDX_VC_BASE,       XLP_GDX_VC_LIMIT,       1, 1 },
+	[XLP_MSG_BLK_GDX1]  =    { "gdx1", XLP_9XX_GDX1_VC_BASE, XLP_9XX_GDX1_VC_LIMIT,       1, 1 },
 	[XLP_MSG_BLK_RSA_ECC] = { "rsa",    XLP_RSA_ECC_VC_BASE,   XLP_RSA_ECC_VC_LIMIT,   1, 1 },
 	[XLP_MSG_BLK_CRYPTO] =  { "crypto", XLP_CRYPTO_VC_BASE,    XLP_CRYPTO_VC_LIMIT,    1, 1 },
 	[XLP_MSG_BLK_CMP] =     { "cmp",    XLP_CMP_VC_BASE,       XLP_CMP_VC_LIMIT,       1, 1 },
@@ -233,6 +234,7 @@ static struct fmn_qsize_credit_config fmn_qsize_credit_cfg[XLP_MSG_BLK_MAX] = {
 	[XLP_MSG_BLK_NAE] =     { "nae",    XLP_NET_VC_BASE,       XLP_NET_VC_LIMIT,       1, 1 },
 	[XLP_MSG_BLK_REGX] =    { "regx",   XLP_3XX_REGEX_VC_BASE, XLP_3XX_REGEX_VC_LIMIT, 1, 1 },
 	[XLP_MSG_BLK_SRIO] =    { "srio",   XLP_3XX_SRIO_VC_BASE,  XLP_3XX_SRIO_VC_LIMIT,  1, 1 },
+	[XLP_MSG_BLK_LZS] =    { "lzs",   XLP_9XX_LZS_VC_BASE,  XLP_9XX_LZS_VC_LIMIT,  1, 1 },
 };
 
 int station_exist_in_2xx(int qid)
@@ -463,6 +465,9 @@ static void fmn_update_credit(int node, int b_stid, int dst_node)
 	}
 	if(credits == NULL) {
 		nlm_print("ERROR in Credit config: Station id not found, configuring default credit\n");
+#ifdef FMN_DEBUG
+		nlm_print("b_stid %d, dst_node %d.\n", b_stid, dst_node);
+#endif
 		return;
 	}
 
@@ -726,6 +731,13 @@ static void nlm_hal_write_fmn_credit(int node, int max_nodes)
 		nlm_print(" XLP9XX/XLP7XX FMN credit configuration \n");
 
 		fmn_config = &xlp9xx_fmn_config[0];
+
+		fmn_modify_qsize_credit_config(node, XLP_MSG_BLK_GDX, 1, XLP_9XX_GDX0_VC_BASE, XLP_9XX_GDX0_VC_LIMIT);
+		fmn_modify_qsize_credit_config(node, XLP_MSG_BLK_REGX, 1, XLP_9XX_RGX_VC_BASE, XLP_9XX_RGX_VC_LIMIT);
+		fmn_modify_qsize_credit_config(node, XLP_MSG_BLK_CMP, 1, XLP_9XX_CMP_VC_BASE, XLP_9XX_CMP_VC_LIMIT);
+		fmn_modify_qsize_credit_config(node, XLP_MSG_BLK_RSA_ECC, 1, XLP_9XX_RSA_VC_BASE, XLP_9XX_RSA_VC_LIMIT);
+		fmn_modify_qsize_credit_config(node, XLP_MSG_BLK_CRYPTO, 1, XLP_9XX_SEC_VC_BASE, XLP_9XX_SEC_VC_LIMIT);
+
 		/* go through each valid station */
 		for(hndl = 0; hndl < XLP_MSG_HANDLE_MAX; hndl++) {
 			int base_vc = fmn_config->base_vc;
-- 
1.9.1

