From f0ca2b2a4336919b5edfaa383c337f2bca731a2e Mon Sep 17 00:00:00 2001
From: Hareesh R <hareeshr@broadcom.com>
Date: Wed, 2 May 2012 12:07:33 +0530
Subject: [PATCH 1356/1532] nae : Replenish all the unused fifos

For shared nae to work, need to replenish all the unused fifos
with dummy buffers.
[Based on SDK 3.2]
Signed-off-by: Quanyang Wang <quanyang.wang@windriver.com>
---
 drivers/net/ethernet/broadcom/nae/init_nae.c | 6 +++++-
 1 file changed, 5 insertions(+), 1 deletion(-)

diff --git a/drivers/net/ethernet/broadcom/nae/init_nae.c b/drivers/net/ethernet/broadcom/nae/init_nae.c
index a4b02ce..bcb4173 100644
--- a/drivers/net/ethernet/broadcom/nae/init_nae.c
+++ b/drivers/net/ethernet/broadcom/nae/init_nae.c
@@ -23,7 +23,11 @@ static unsigned int lnx_jumbo_mask;
 extern int num_descs_per_normalq; 	
 extern int num_descs_per_jumboq; 	
 
+/* This strucutre has been referenced in templates/hybrid_nae and ucore/hybrid_nae. 
+ So whenever you modify, modify the above places also. */
+
 struct nlm_nae_linux_shinfo {
+	/* valid along with up and down status, ucore checks only for non-domain 0 */
 	int valid;
 	int rxvc;
 	int domid;
@@ -56,7 +60,7 @@ static int init_dummy_entries_for_port_fifos(int node, nlm_nae_config_ptr nae_cf
 	msg = (unsigned long long)nae_cfg->dummy_pktdata_addr & 0xffffffffffULL;
 
 	msgrng_access_enable(mflags);
-	for(i = 0; i < nae_cfg->frin_total_queue; i += 4) {
+	for(i = 0; i < nae_cfg->frin_total_queue; i++) {
 		/* nothing to do, if it is owned by linux */
 		if((1 << i) & nae_cfg->freein_fifo_dom_mask) 
 			continue;
-- 
1.9.1

