From 6cd111728bf115121627b05ea8ce11de0f138146 Mon Sep 17 00:00:00 2001
From: Sreenidhi B R <sreenira@broadcom.com>
Date: Fri, 8 Feb 2013 11:57:05 +0530
Subject: [PATCH 0351/1532] nae: adding XAUI support to u-boot, related changed
 in tiny.dts files.

[Based on SDK 3.2]
Signed-off-by: Quanyang Wang <quanyang.wang@windriver.com>
---
 arch/mips/boot/dts/xlp2xx-tiny.dts | 76 +++++++++++++++++++++++-----------
 arch/mips/boot/dts/xlp3xx-tiny.dts | 85 +++++++++++++++++++++++++-------------
 arch/mips/boot/dts/xlp8xx-tiny.dts | 58 ++++++++++++++++++++++++++
 3 files changed, 165 insertions(+), 54 deletions(-)

diff --git a/arch/mips/boot/dts/xlp2xx-tiny.dts b/arch/mips/boot/dts/xlp2xx-tiny.dts
index 440543a..af9a8f0 100644
--- a/arch/mips/boot/dts/xlp2xx-tiny.dts
+++ b/arch/mips/boot/dts/xlp2xx-tiny.dts
@@ -90,36 +90,62 @@
         	        };
 	        };
 
-	        complex@0 {
-        	        device_type = "nae-complex";
-                	mode = "sgmii";
-
-        	        sgmii {
-                	        loopback = <0 0 0 0>;
-
-                        	// Max ingress fifo size 256 units (size of one unit is 64 byte)
-	                        iface-fifo-size = <13 13 13 13>;
+		/* if xaui functionality on complex@0 is required,
+		   then enable xaui and update mode = xaui/sgmii parameter, as appropriate */
+		complex@0 {
+			device_type = "nae-complex";
+			mode = "sgmii";
+			/*
+			xaui {
+				loopback = <0>;
+
+				// Max ingress fifo size 256 units (size of one unit is 64 byte)
+				iface-fifo-size = <55>;
+
+				// Max parser sequence fifo size 1024 packets
+				// (if 1588 Timestamp is not required, then max size increases to 2048)
+				parser-sequence-fifo-size = <225>;
+
+				// Since rx_buffer is per context, the buffer size given here will be divided by num-channels
+				num-channels = <1>;
+				rx-buffer-size = <944>;
+
+				// Max available descriptors are 1024  (across all complexes).
+				// Per port num_free_descriptors must be even number
+				num-free-descs = <150>;
+				free-desc-size = <2048>;
+				higig-mode = <0>;
+				xgmii-speed = <10>;
+				// In xlp3xx number of ucores available is 8. so, ucore_mask for xlp3xx is (ucore-mask & 0xFF)
+				ucore-mask = <0xffff>;
+				vlan-pri-en = <0x0>;
+				// To enable change it to  <1>
+				msec-port-enable  = <0>;
+			};
+			*/
+			sgmii {
+				loopback = <0 0 0 0>;
+				mgmt-port = <0 0 0 0>;
+				// Max ingress fifo size 256 units (size of one unit is 64 byte)
+				iface-fifo-size = <13 13 13 13>;
 
 				ext-phy-addr = <4 7 6 5>;
-                	        ext-phy-bus = <0 0 0 0>;
-
-                        	// Max parser sequence fifo size 1024 packets
-	                        // (if 1588 Timestamp is not required, then max size increases to 2048)
-        	                num-channels = <1 1 1 1>;
-                	        parser-sequence-fifo-size = <30 30 30 30>;
+				ext-phy-bus = <0 0 0 0>;
 
-                        	// Since rx_buffer is per context, we can have a few different ways
-	                        //  to populate the operand
-        	                rx-buffer-size = <128 128 128 128>;
+				// Max parser sequence fifo size 1024 packets
+				// (if 1588 Timestamp is not required, then max size increases to 2048)
+				num-channels = <1 1 1 1>;
+				parser-sequence-fifo-size = <30 30 30 30>;
 
+				rx-buffer-size = <128 128 128 128>;
 
-                	        // Max available descriptors are 1024 (across all complexes).
-                        	// Per port num_free_descriptors must be even number
-	                        num-free-descs = <52 52 52 52>;
-        	                free-desc-size = <2048 2048 2048 2048>;
-                	        ucore-mask = <0xff 0xff 0xff 0xff>;
-	                };
-        	};
+				// Max available descriptors are 1024 (across all complexes).
+				// Per port num_free_descriptors must be even number
+				num-free-descs = <52 52 52 52>;
+				free-desc-size = <2048 2048 2048 2048>;
+				ucore-mask = <0xff 0xff 0xff 0xff>;
+			};
+		};
 		complex@1 {
         	        device_type = "nae-complex";
                 	mode = "sgmii";
diff --git a/arch/mips/boot/dts/xlp3xx-tiny.dts b/arch/mips/boot/dts/xlp3xx-tiny.dts
index 8d714e1..36dd871 100644
--- a/arch/mips/boot/dts/xlp3xx-tiny.dts
+++ b/arch/mips/boot/dts/xlp3xx-tiny.dts
@@ -90,35 +90,62 @@
         	        };
 	        };
 
-	        complex@0 {
-        	        device_type = "nae-complex";
-                	mode = "sgmii";
-
-        	        sgmii {
-                	        loopback = <0 0 0 0>;
-
-                        	// Max ingress fifo size 256 units (size of one unit is 64 byte)
-	                        iface-fifo-size = <13 13 13 13>;
-
-        	                ext-phy-addr = <4 7 6 5>;
-                	        ext-phy-bus = <0 0 0 0>;
-                        	// Max parser sequence fifo size 1024 packets
-	                        // (if 1588 Timestamp is not required, then max size increases to 2048)
-        	                num-channels = <1 1 1 1>;
-                	        parser-sequence-fifo-size = <30 30 30 30>;
-
-                        	// Since rx_buffer is per context, we can have a few different ways
-	                        //  to populate the operand
-        	                rx-buffer-size = <128 128 128 128>;
-
-
-                	        // Max available descriptors are 1024 (across all complexes).
-                        	// Per port num_free_descriptors must be even number
-	                        num-free-descs = <52 52 52 52>;
-        	                free-desc-size = <2048 2048 2048 2048>;
-                	        ucore-mask = <0xff 0xff 0xff 0xff>;
-	                };
-        	};
+		/* if xaui functionality on complex@0 is required,
+		   then enable xaui and update mode = xaui/sgmii parameter, as appropriate */
+		complex@0 {
+			device_type = "nae-complex";
+			mode = "sgmii";
+			/*
+			xaui {
+				loopback = <0>;
+
+				// Max ingress fifo size 256 units (size of one unit is 64 byte)
+				iface-fifo-size = <55>;
+
+				// Max parser sequence fifo size 1024 packets
+				// (if 1588 Timestamp is not required, then max size increases to 2048)
+				parser-sequence-fifo-size = <225>;
+
+				// Since rx_buffer is per context, the buffer size given here will be divided by num-channels
+				num-channels = <1>;
+				rx-buffer-size = <944>;
+
+				// Max available descriptors are 1024  (across all complexes).
+				// Per port num_free_descriptors must be even number
+				num-free-descs = <150>;
+				free-desc-size = <2048>;
+				higig-mode = <0>;
+				xgmii-speed = <10>;
+				// In xlp3xx number of ucores available is 8. so, ucore_mask for xlp3xx is (ucore-mask & 0xFF)
+				ucore-mask = <0xffff>;
+				vlan-pri-en = <0x0>;
+				// To enable change it to  <1>
+				msec-port-enable  = <0>;
+			};
+			*/
+			sgmii {
+				loopback = <0 0 0 0>;
+				mgmt-port = <0 0 0 0>;
+				// Max ingress fifo size 256 units (size of one unit is 64 byte)
+				iface-fifo-size = <13 13 13 13>;
+
+				ext-phy-addr = <4 7 6 5>;
+				ext-phy-bus = <0 0 0 0>;
+
+				// Max parser sequence fifo size 1024 packets
+				// (if 1588 Timestamp is not required, then max size increases to 2048)
+				num-channels = <1 1 1 1>;
+				parser-sequence-fifo-size = <30 30 30 30>;
+
+				rx-buffer-size = <128 128 128 128>;
+
+				// Max available descriptors are 1024 (across all complexes).
+				// Per port num_free_descriptors must be even number
+				num-free-descs = <52 52 52 52>;
+				free-desc-size = <2048 2048 2048 2048>;
+				ucore-mask = <0xff 0xff 0xff 0xff>;
+			};
+		};
 	        complex@1 {
         	        device_type = "nae-complex";
                 	mode = "sgmii";
diff --git a/arch/mips/boot/dts/xlp8xx-tiny.dts b/arch/mips/boot/dts/xlp8xx-tiny.dts
index f985e9b..1688147 100644
--- a/arch/mips/boot/dts/xlp8xx-tiny.dts
+++ b/arch/mips/boot/dts/xlp8xx-tiny.dts
@@ -91,6 +91,64 @@
                                      dv15 = <0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0>;
                         };
                 };
+		/* if xaui/sgmii functionality on complex@0 is required,
+		   then enable complex@0 and update mode = xaui/sgmii parameter, as appropriate */
+		/*
+		complex@0 {
+			device_type = "nae-complex";
+			mode = "sgmii";
+			xaui {
+				loopback = <0>;
+
+				// Max ingress fifo size 256 units (size of one unit is 64 byte)
+				iface-fifo-size = <55>;
+
+				// Max parser sequence fifo size 1024 packets
+				// (if 1588 Timestamp is not required, then max size increases to 2048)
+				parser-sequence-fifo-size = <225>;
+
+				// Since rx_buffer is per context, the buffer size given here will be divided by num-channels
+				num-channels = <1>;
+				rx-buffer-size = <944>;
+
+				// Max available descriptors are 1024  (across all complexes).
+				// Per port num_free_descriptors must be even number
+				num-free-descs = <150>;
+				free-desc-size = <2048>;
+				higig-mode = <0>;
+				xgmii-speed = <10>;
+				// In xlp3xx number of ucores available is 8. so, ucore_mask for xlp3xx is (ucore-mask & 0xFF)
+				ucore-mask = <0xffff>;
+				vlan-pri-en = <0x0>;
+				// To enable change it to  <1>
+				msec-port-enable  = <0>;
+			};
+			sgmii {
+				loopback = <0 0 0 0>;
+				mgmt-port = <0 0 0 0>;
+				// Max ingress fifo size 256 units (size of one unit is 64 byte)
+				iface-fifo-size = <13 13 13 13>;
+
+				ext-phy-addr = <4 7 6 5>;
+				ext-phy-bus = <1 1 1 1>;
+
+				// Max parser sequence fifo size 1024 packets
+				// (if 1588 Timestamp is not required, then max size increases to 2048)
+				num-channels = <1 1 1 1>;
+				parser-sequence-fifo-size = <62 62 62 62>;
+
+				rx-buffer-size = <128 128 128 128>;
+
+				// Max available descriptors are 1024 (across all complexes).
+				// Per port num_free_descriptors must be even number
+				num-free-descs = <52 52 52 52>;
+				free-desc-size = <2048 2048 2048 2048>;
+				ucore-mask = <0xffff 0xffff 0xffff 0xffff>;
+				// To enable change it to  <0xf> . 0xf = 1111, enable 4 ports in one complex
+				msec-port-enable  = <0x0>;
+			};
+		};
+		*/
                 complex@4 {
                         device_type = "nae-complex";
                         mode = "sgmii";
-- 
1.9.1

