From 2115112e9191d5436739263de74398722854c038 Mon Sep 17 00:00:00 2001
From: Prasanna Mumbai <prasanna.mumbai@broadcom.com>
Date: Thu, 8 Nov 2012 16:24:33 +0530
Subject: [PATCH 1128/1532] Frequency: read the frequency from fdt file and set
 for CDE block.

modify CDE init function to check & set for frequency for the block
from the DTB file

Signed-off-by: Prasanna Mumbai <prasanna.mumbai@broadcom.com>
[Based on SDK 3.2]
Signed-off-by: Quanyang Wang <quanyang.wang@windriver.com>
---
 drivers/misc/netlogic/nlm_cde/nlm_cde.c | 6 ++++++
 drivers/misc/netlogic/nlm_cde/nlm_cde.h | 2 ++
 2 files changed, 8 insertions(+)

diff --git a/drivers/misc/netlogic/nlm_cde/nlm_cde.c b/drivers/misc/netlogic/nlm_cde/nlm_cde.c
index 9ea6bee..e852f8c 100644
--- a/drivers/misc/netlogic/nlm_cde/nlm_cde.c
+++ b/drivers/misc/netlogic/nlm_cde/nlm_cde.c
@@ -964,6 +964,9 @@ static int __init xlp_cde_init(void)
 {
   int i =0;
   unsigned int ret;
+  int frequency = 0;
+  int node = 0;
+
   for(i = 0; i < num_cde_engine; i++)
   {
     ret = nlm_hal_read_cde_reg(CMP_REG_RESET_REG(i));
@@ -980,6 +983,9 @@ static int __init xlp_cde_init(void)
       break;
     } while (1);
 
+    frequency = nlm_hal_get_fdt_freq(fdt, NLM_CDE);
+    nlm_hal_set_cde_freq(node, frequency);
+
     nlm_hal_write_cde_reg(CMP_REG_RESET_REG(i), 0x01);
     nlm_hal_write_cde_reg(CMP_REG_RESET_REG(i), 0x00);
   }  
diff --git a/drivers/misc/netlogic/nlm_cde/nlm_cde.h b/drivers/misc/netlogic/nlm_cde/nlm_cde.h
index a60d582..f1f7356 100644
--- a/drivers/misc/netlogic/nlm_cde/nlm_cde.h
+++ b/drivers/misc/netlogic/nlm_cde/nlm_cde.h
@@ -59,6 +59,8 @@ THE POSSIBILITY OF SUCH DAMAGE.
 #define SCRATCH_SIZE    (8*1024)
 #define MAX_NUM_MESSAGES 100
 
+extern void *fdt;
+
 unsigned char src_gz_data[] = {"edc13101000000c2a0f54f6d085fa000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000003e03"};
 
 typedef struct cmp_data_structure {
-- 
1.9.1

