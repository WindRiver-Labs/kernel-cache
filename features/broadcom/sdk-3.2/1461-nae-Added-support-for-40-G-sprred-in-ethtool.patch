From f3de7cbe7da1ef226409a0a270ca9b3976a34efa Mon Sep 17 00:00:00 2001
From: kopal <kopal@broadcom.com>
Date: Fri, 5 Sep 2014 12:04:03 +0530
Subject: [PATCH 1461/1532] nae: Added support for 40 G sprred in ethtool.

[Based on SDK 3.2]
Signed-off-by: Quanyang Wang <quanyang.wang@windriver.com>
---
 drivers/net/ethernet/broadcom/nae/xlpge.h         |  3 +++
 drivers/net/ethernet/broadcom/nae/xlpge_ethtool.c | 33 ++++++++++++++++-------
 2 files changed, 27 insertions(+), 9 deletions(-)

diff --git a/drivers/net/ethernet/broadcom/nae/xlpge.h b/drivers/net/ethernet/broadcom/nae/xlpge.h
index f48eb91..30e524430 100644
--- a/drivers/net/ethernet/broadcom/nae/xlpge.h
+++ b/drivers/net/ethernet/broadcom/nae/xlpge.h
@@ -78,6 +78,9 @@
 #define	RX_PPAD_EN			0
 #define	RX_PPAD_SZ			3
 #endif
+#ifndef SPEED_40000
+#define SPEED_40000			40000
+#endif
 
 
 /* TODO XXX: default enable prepad */
diff --git a/drivers/net/ethernet/broadcom/nae/xlpge_ethtool.c b/drivers/net/ethernet/broadcom/nae/xlpge_ethtool.c
index c425dcf..ab53f1d 100644
--- a/drivers/net/ethernet/broadcom/nae/xlpge_ethtool.c
+++ b/drivers/net/ethernet/broadcom/nae/xlpge_ethtool.c
@@ -77,15 +77,30 @@ static int xlp_get_settings(struct net_device *dev, struct ethtool_cmd *cmd)
 	struct dev_data *priv = netdev_priv(dev);
 	net_port_t* nae_port = priv->nae_port;
 	if (priv->type != SGMII_IF) {
-		cmd->supported = SUPPORTED_FIBRE | SUPPORTED_10000baseT_Full;
-		cmd->advertising = SUPPORTED_FIBRE | SUPPORTED_10000baseT_Full;
-		cmd->speed = SPEED_10000;
-		cmd->port = PORT_FIBRE;
-		cmd->duplex = DUPLEX_FULL;
-		cmd->phy_address = priv->port;
-		cmd->autoneg = AUTONEG_DISABLE;
-		cmd->maxtxpkt = 0;
-		cmd->maxrxpkt = 0;
+		if(priv->type == XLAUI_IF) {
+			cmd->supported = SUPPORTED_FIBRE;
+			cmd->advertising = SUPPORTED_FIBRE;
+			cmd->speed = SPEED_40000;
+			cmd->port = PORT_FIBRE;
+			cmd->duplex = DUPLEX_FULL;
+			cmd->phy_address = priv->port;
+			cmd->autoneg = AUTONEG_DISABLE;
+			cmd->maxtxpkt = 0;
+			cmd->maxrxpkt = 0;
+		}
+	
+		else {
+		
+			cmd->supported = SUPPORTED_FIBRE | SUPPORTED_10000baseT_Full;
+			cmd->advertising = SUPPORTED_FIBRE | SUPPORTED_10000baseT_Full;
+			cmd->speed = SPEED_10000;
+			cmd->port = PORT_FIBRE;
+			cmd->duplex = DUPLEX_FULL;
+			cmd->phy_address = priv->port;
+			cmd->autoneg = AUTONEG_DISABLE;
+			cmd->maxtxpkt = 0;
+			cmd->maxrxpkt = 0;
+		}
 
 		return 0;
 	}
-- 
1.9.1

