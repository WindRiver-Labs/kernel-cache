From 44f2e75d99a64edbfdd8d10657469e6999729201 Mon Sep 17 00:00:00 2001
From: Deepak Jangid <deepak.jangid@broadcom.com>
Date: Tue, 26 Nov 2013 21:15:22 -0800
Subject: [PATCH 0455/1532] snort : added Firefly snort dts file. edited Eagle
 snort dts for netlogic,cpumask. edited Griffin snort dts for netlogic,
 cpumask. edited snort ucore for varialble CPUs support.

[Based on SDK 3.2]
Signed-off-by: Quanyang Wang <quanyang.wang@windriver.com>
---
 arch/mips/boot/dts/xlp2xx-helinux-snort.dts | 251 ++++++++++++++++++++++++++++
 arch/mips/boot/dts/xlp8xx-helinux-snort.dts |   1 +
 arch/mips/boot/dts/xlp9xx-helinux-snort.dts |   6 +
 3 files changed, 258 insertions(+)
 create mode 100644 arch/mips/boot/dts/xlp2xx-helinux-snort.dts

diff --git a/arch/mips/boot/dts/xlp2xx-helinux-snort.dts b/arch/mips/boot/dts/xlp2xx-helinux-snort.dts
new file mode 100644
index 0000000..9b3a247
--- /dev/null
+++ b/arch/mips/boot/dts/xlp2xx-helinux-snort.dts
@@ -0,0 +1,251 @@
+/* XLP2XX Device Tree Source
+ *
+ */
+
+/dts-v1/;
+/ {
+	model = "netlogic,XLP-FVP";
+        compatible = "netlogic,xlp";
+        #address-cells = <2>;
+        #size-cells = <2>;
+	/*memory range for linux. This will not appear in dom0*/
+        memory {
+                device_type = "memory";
+                reg =  <0 0x01000000 0 0x0B000000   
+                        0x0 0x80000000 0x0 0xE2F80000>;
+        };
+
+	/* memory range for HEv2 pkt mem. Only one contig memory per node supported */
+	pktmem {
+		device_type = "pktmem";
+
+		/* format: node number, 64-bit addr, 64-bit size */
+		reg = <0 0x0 0x40000000 0x0 0x08000000
+		       1 0x0 0x0 0x0 0x0
+		       2 0x0 0x0 0x0 0x0
+		       3 0x0 0x0 0x0 0x0>;
+	};
+
+	hypervisor {
+		hypervisor-name = "Xen";
+		alloc_dom0_memory = <0>;
+		bootargs = "ncores=4 dom0_loadaddr=0x72000000 dom0_size=0x1c000000 dom0_cpumask=0xffffffff -- ";
+		domain_heap = <0x80000000 0x20000000>;
+	};
+	doms {
+		#address-cells = <1>;
+		#size-cells = <1>;
+		dom@0 {
+			device_type = "domain";
+			os = "linux";
+
+			#address-cells = <1>;
+			#size-cells = <1>;
+
+			cpu {
+				onlinemask = <0xff>;
+                                nae-rx-vc = <1>;
+                                nae-fb-vc = <1>;
+				sae-rx-vc = <1>; /* sharing with nae */
+				sae-rx-sync-vc = <3>; /* should be exclusive */
+                                napi-vc-mask = <0x2>;
+
+			};
+			uart {
+				id = <0>;
+				owner = <1>;
+				sharedcfg = <0x1f000000>;
+			};
+                        fmn {
+                                node_0_vc_mask = <0x00000000>;
+                        };
+			owner-config {
+				nae = <0x0>;
+				sae = <0x0>;
+				rsa = <0x0>;
+				fmn = <0x0>;
+			};
+		};
+
+		dom@1 {
+			device_type = "domain";
+			os = "netos";
+
+			#address-cells = <1>;
+			#size-cells = <1>;
+
+			kernel {
+				/* Kernel Memory allocated from xen domain-heap */
+				size = <0x02000000>;  // 32M
+
+				/* Location in Dom0 ramdisk */
+				location = "/tmp/xen/netos.elf";
+
+				/* Domain destroy currently doesn't work with hyperexec */
+				dom_destroy_hack = <0>;
+			};
+
+			cpu {
+				onlinemask = <0xff>;
+				nae-rx-vc = <0>;
+				nae-fb-vc = <3>;
+				sae-rx-vc = <0>; /* sharing with nae */
+				sae-rx-sync-vc = <0>;  /* sharing with nae */
+				/* helinux, as only 1 thread per cpu, it should poll for both nae and sae 
+				   responses. Also there is no other vc as linux is using other 2 vcs */
+				/* Setting this to '1' makes NAE driver to skip buf alloction and initial
+				   sending of packet buffers*/
+				nae-buf-alloc-by-app = <1>; 
+			};
+			uart {
+				id = <0>;
+			};
+			app-param {
+				onlinemask = <0xff>;
+			};
+			nae {
+			};
+
+			fmn {
+				node_0_vc_mask = <0x99999999 0x99999999 0x99999999 0x99999999>;
+				node_1_vc_mask = <0x99999999 0x99999999 0x99999999 0x99999999>;
+				node_2_vc_mask = <0x99999999 0x99999999 0x99999999 0x99999999>;
+				node_3_vc_mask = <0x99999999 0x99999999 0x99999999 0x99999999>;
+			};
+			kbp {
+				/* distribute total of 4096 buffer id across cpus. required only for cpus sending requests.
+				 * note : KBP compare/search instructions must use even-numbered buffers. i.e. (buffer_id & 0x1 == 0) is True
+				 */
+				buffers-cpuid-offset-quantity = <  0    0   64
+					1   64   64
+					2  128   64
+					3  192   64
+					4  256   64
+					5  320   64
+					6  384   64
+					7  448   64
+					8  512   64
+					9  576   64
+					10  640   64
+					11  704   64
+					12  768   64
+					13  832   64
+					14  896   64
+					15  960   64
+					16 1024   64
+					17 1088   64
+					18 1152   64
+					19 1216   64
+					20 1280   64
+					21 1344   64
+					22 1408   64
+					23 1472   64
+					24 1536   64
+					25 1600   64
+					26 1664   64
+					27 1728   64
+					28 1792   64
+					29 1856   64
+					30 1920   64
+					31 1984   64>;
+				/* starting address for KBP Driver Data. two 32-bit unsigned integers forms one 64-bit memory address.
+				 * kbp driver requires 2 MBytes of dedicated memory space to store data */
+				memory-offsethigh-offsetlow = <0x00000001 0x00000000>;
+			};
+			owner-config {
+				nae = <0x1>;
+				sae = <0x0>;
+				rsa = <0x0>;
+				fmn = <0x1>;
+			};
+		};
+
+		dom@2 {
+			device_type = "domain";
+			os = "netos";
+
+			heap-size = <0x0 0x8000000>; // 128M
+			shared-mem = <0x0 0x48000000 0x0 0x10000000>; // 128M @ 1152Mb
+
+			#address-cells = <1>;
+			#size-cells = <1>;
+
+			app-bootcmd = "smpload";
+			app-loadaddr = "0xf0000000"; // 3.75GB
+
+			kernel {
+				/* Kernel Memory allocated from xen domain-heap */
+				size = <0x02000000>;  // 32M
+
+				/* Location in Dom0 ramdisk */
+				location = "/tmp/xen/netos.elf";
+
+				/* Domain destroy currently doesn't work with hyperexec */
+				dom_destroy_hack = <0>;
+			};
+
+			cpu {
+				onlinemask = <0xff>;
+                                nae-rx-vc = <0>;
+                                nae-fb-vc = <3>;
+                                /* Setting this to '1' makes NAE driver to skip buf alloction and initial
+                                   sending of packet buffers*/
+                                nae-buf-alloc-by-app = <1>; 
+			};
+			uart {
+				id = <0>;
+			};
+			memory {
+				reg = <0xE0000000 0x60000000>;  // 1.5Gb @ 3584Mb
+			};
+			app-param{
+				onlinemask = <0xff>;
+			};
+			nae{
+			};
+
+                        fmn {
+                                node_0_vc_mask = <0x99999999 0x99999999 0x99999999 0x99999999>;
+                                node_1_vc_mask = <0x99999999 0x99999999 0x99999999 0x99999999>;
+                                node_2_vc_mask = <0x99999999 0x99999999 0x99999999 0x99999999>;
+                                node_3_vc_mask = <0x99999999 0x99999999 0x99999999 0x99999999>;
+                        };
+		};
+	};
+
+	chosen {
+		netlogic,cpumask = <0xff>;
+		bootargs = " console=ttyS0,115200 ";
+	};
+
+	/* These binaries are downloaded at the resp physical memory locations
+	 * by their corresponding bootstrapping loaders. For example,
+	 * u-boot is loaded by x-load at 193M, sysconfig is loaded by u-boot
+	 * at 1M, hypervisor by u-boot hypervisor at 136M.
+	 * On simulator all these binaries are pre-loaded by using '-F' option
+	 * for convenience. On silicon, they will be loaded by their corresponding
+	 * temporary download locations the stage-1/stage-2 firmware
+	 */
+	firmware-download {
+		u-boot        = <0x0c100000 0x3f00000>;  /* 63M @ 193M */
+		sysconfig     = <0x00100000 0x00100000>; /* 1M @ 1M */
+		hypervisor    = <0x08800000 0x00800000>; /* 8M @ 136M */
+		dom0          = <0x09000000 0x03000000>; /* 48M @ 144M */
+		domU-ramdisk  = <0x60000000 0x60800000>; /* 8M @ 1536M */
+	};
+
+	soc {
+		nodes {
+			num-nodes = <1>;
+		};
+
+	};
+	frequency-config {
+		nae = <500>;
+		sae = <500>;
+		rsa = <500>;
+		dtre = <250>;
+		cde = <250>;
+	};
+};
+
diff --git a/arch/mips/boot/dts/xlp8xx-helinux-snort.dts b/arch/mips/boot/dts/xlp8xx-helinux-snort.dts
index 36900f2..3a12d66 100644
--- a/arch/mips/boot/dts/xlp8xx-helinux-snort.dts
+++ b/arch/mips/boot/dts/xlp8xx-helinux-snort.dts
@@ -222,6 +222,7 @@
 	};
 
 	chosen {
+		netlogic,cpumask = <0xffffffff>;
 		bootargs = " console=ttyS0,115200 ";
 	};
 
diff --git a/arch/mips/boot/dts/xlp9xx-helinux-snort.dts b/arch/mips/boot/dts/xlp9xx-helinux-snort.dts
index ba621e8..cc89e29 100644
--- a/arch/mips/boot/dts/xlp9xx-helinux-snort.dts
+++ b/arch/mips/boot/dts/xlp9xx-helinux-snort.dts
@@ -282,6 +282,12 @@
 	};
 
 	chosen {
+		/* examples for different core/thread models.
+		 * 16core: netlogic,cpumask=<0xffffffff 0xffffffff>
+		 * 20core: netlogic,cpumask=<0xffff 0xffffffff 0xffffffff>
+		 * 15 core, skipping core #5: netlogic,cpumask=<0xffffffff 0xff0fffff>
+		 */
+		netlogic,cpumask = <0xffffffff>;
 		bootargs = " console=ttyS0,115200 ";
 	};
 
-- 
1.9.1

