From 7e5a82105d4ebc98ee060e94aef10e98b39be66c Mon Sep 17 00:00:00 2001
From: ajesh <ajesh@broadcom.com>
Date: Thu, 21 Nov 2013 17:57:13 +0530
Subject: [PATCH 0857/1532] Interlaken: Modify CPLD devparam for xlp9xx

On XLP9xx Evaluation Boards, CS3 is used by Interlaken where as on some other Boards,
CS3 is used by SMSC. These two interfaces require different Devparams.
[Based on SDK 3.2]
Signed-off-by: Quanyang Wang <quanyang.wang@windriver.com>
---
 arch/mips/netlogic/lib/syslib/src/nlm_evp_cpld.c | 13 +++++++++++--
 1 file changed, 11 insertions(+), 2 deletions(-)

diff --git a/arch/mips/netlogic/lib/syslib/src/nlm_evp_cpld.c b/arch/mips/netlogic/lib/syslib/src/nlm_evp_cpld.c
index 09c4ff96..afba70d 100644
--- a/arch/mips/netlogic/lib/syslib/src/nlm_evp_cpld.c
+++ b/arch/mips/netlogic/lib/syslib/src/nlm_evp_cpld.c
@@ -51,7 +51,7 @@ static nlm_xlp_nor_t xlp_nor_dev[8] = {
 { 0x16000000, SIZE_16MB, 0, 0x2e00 },
 { 0xffffffff, 0, 0, 0 },
 { 0x17000000, SIZE_1MB , 1, 0x2C00 },
-{ 0x17200000, SIZE_1MB , 0, 0x2f84 },
+{ 0x17200000, SIZE_1MB , 0, 0x2C00 },
 { 0x17300000, SIZE_1MB , 0, 0x2f84 },
 { 0xffffffff, 0, 0, 0 },
 { 0xffffffff, 0, 0, 0 },
@@ -207,7 +207,16 @@ int xlp_cpld_init(uint32_t cs)
 
 	if (cs > NLM_XLP_MAX_CS)
 		return -1;
-
+	if(cs == 3)
+	{
+		if(is_nlm_xlp9xx())
+		{
+			/* In xlp9xx CS 3 is used by Interlaken,
+			 * need to change the devparam for Interlaken.
+			 CS3 is otherwise used as SMSC */
+			xlp_nor_dev[cs].devparam = 0x2f84;
+		}
+	}
 	nlm_hal_nor_write(XLP_NOR_CS_BASE + cs , (base >> 8));
 	nlm_hal_nor_write(XLP_NOR_CS_LIMIT + cs , (limit >> 8));
 
-- 
1.9.1

