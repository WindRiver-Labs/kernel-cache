From f8e312fb22959c08fae7af864feb0bba3a44d5fa Mon Sep 17 00:00:00 2001
From: johuang <john.huang@broadcom.com>
Date: Tue, 27 May 2014 16:51:38 -0700
Subject: [PATCH 0950/1532] xlp5xx: Access config register using API.

Direct access to the register causes segmentation fault
in linux-userspace application.
[Based on SDK 3.2]
Signed-off-by: Quanyang Wang <quanyang.wang@windriver.com>
---
 arch/mips/netlogic/lib/syslib/src/nlm_hal_cpu_info.c | 4 ++--
 1 file changed, 2 insertions(+), 2 deletions(-)

diff --git a/arch/mips/netlogic/lib/syslib/src/nlm_hal_cpu_info.c b/arch/mips/netlogic/lib/syslib/src/nlm_hal_cpu_info.c
index bcb4bb3..f8f0db1 100644
--- a/arch/mips/netlogic/lib/syslib/src/nlm_hal_cpu_info.c
+++ b/arch/mips/netlogic/lib/syslib/src/nlm_hal_cpu_info.c
@@ -362,8 +362,8 @@ static inline int is_xlp5xx(uint8_t num_cores, uint8_t num_threads, uint32_t rev
 	if( pid == CHIP_PROCESSOR_ID_XLP_5XX )
 	{
 		volatile uint32_t *fuse_mmio = xlp9xx_cpu_io_mmio(-1, XLP5XX_PCIE_DEV_BASE(XLP5XX_EFUSE));
-		volatile uint32_t cfg3 = fuse_mmio[0xc3];
-		volatile uint32_t cfg6 = fuse_mmio[0xc6];
+		volatile uint32_t cfg3 = nlm_hal_read_32bit_reg((uint64_t)fuse_mmio & 0x1fffffff, 0xc3);
+		volatile uint32_t cfg6 = nlm_hal_read_32bit_reg((uint64_t)fuse_mmio & 0x1fffffff, 0xc6);
 
 		epid = (uint8_t) ((cfg3 >>27) & 0x7);
 		ncores   = (8 - bitcount(cfg6 & 0xFF));
-- 
1.9.1

