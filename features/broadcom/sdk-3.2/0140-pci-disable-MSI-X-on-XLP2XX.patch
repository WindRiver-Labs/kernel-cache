From 44dbd0a8aa06052e4cbd45faca346834f016b53e Mon Sep 17 00:00:00 2001
From: Jayachandran C <jchandra@broadcom.com>
Date: Wed, 30 Jul 2014 10:50:27 +0530
Subject: [PATCH 0140/1532] pci: disable MSI-X on XLP2XX

MSI-X interrupt delivery does not work on 2XX yet, disable this.
[Based on SDK 3.2]
Signed-off-by: Quanyang Wang <quanyang.wang@windriver.com>
---
 arch/mips/pci/msi-xlp.c | 4 ++++
 1 file changed, 4 insertions(+)

diff --git a/arch/mips/pci/msi-xlp.c b/arch/mips/pci/msi-xlp.c
index 83e8b75..7506840 100644
--- a/arch/mips/pci/msi-xlp.c
+++ b/arch/mips/pci/msi-xlp.c
@@ -447,6 +447,10 @@ int arch_setup_msi_irq(struct pci_dev *dev, struct msi_desc *desc)
 	uint64_t lnkbase;
 	int node, link, slot;
 
+	/* HW issues, disable MSI-X on xlp2xx for now */
+	if (desc->msi_attrib.is_msix && cpu_is_xlp2xx())
+		return 1;
+
 	lnkdev = xlp_get_pcie_link(dev);
 	if (lnkdev == NULL) {
 		dev_err(&dev->dev, "Could not find bridge\n");
-- 
1.9.1

