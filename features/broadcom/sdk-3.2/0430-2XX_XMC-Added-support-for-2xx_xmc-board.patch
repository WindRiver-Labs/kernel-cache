From 97cb0bd931764c523b7e9636c8ddcd2e7f79b628 Mon Sep 17 00:00:00 2001
From: Subhendu Sekhar Behera <sbehera@broadcom.com>
Date: Tue, 22 Oct 2013 10:57:03 +0530
Subject: [PATCH 0430/1532] 2XX_XMC: Added support for 2xx_xmc board

[Based on SDK 3.2]
Signed-off-by: Quanyang Wang <quanyang.wang@windriver.com>
---
 arch/mips/boot/dts/xlp2xx-xmc-linux-tmpl.dts | 245 +++++++++++++++++++++++++++
 arch/mips/boot/dts/xlp2xx-xmc-linux.dts      | 112 ++++++++++++
 arch/mips/boot/dts/xlp2xx-xmc-tiny.dts       | 159 +++++++++++++++++
 3 files changed, 516 insertions(+)
 create mode 100644 arch/mips/boot/dts/xlp2xx-xmc-linux-tmpl.dts
 create mode 100644 arch/mips/boot/dts/xlp2xx-xmc-linux.dts
 create mode 100644 arch/mips/boot/dts/xlp2xx-xmc-tiny.dts

diff --git a/arch/mips/boot/dts/xlp2xx-xmc-linux-tmpl.dts b/arch/mips/boot/dts/xlp2xx-xmc-linux-tmpl.dts
new file mode 100644
index 0000000..eef37cb
--- /dev/null
+++ b/arch/mips/boot/dts/xlp2xx-xmc-linux-tmpl.dts
@@ -0,0 +1,245 @@
+/*
+ * XLP2XX Device Tree Source for FVP boards
+ */
+
+/dts-v1/;
+/ {
+	model = "netlogic,XLP-FVP";
+	compatible = "netlogic,xlp";
+	#address-cells = <2>;
+	#size-cells = <2>;
+
+	memory {
+		device_type = "memory";
+		reg =  <0 0x00100000 0 0x0FF00000	// 255M at 1M
+			0 0x20000000 0 0xa0000000>;	// 2560M at 512M
+	};
+
+	soc {
+		#address-cells = <2>;
+		#size-cells = <1>;
+		compatible = "simple-bus";
+		ranges = <0 0  0 0x18000000  0x04000000   // PCIe CFG
+			  1 0  0 0x16000000  0x02000000>; // GBU chipselects
+
+		serial0: serial@30000 {
+			device_type = "serial";
+			compatible = "ns16550";
+			reg = <0 0x30100 0xa00>;
+			reg-shift = <2>;
+			reg-io-width = <4>;
+			clock-frequency = <133333333>;
+			interrupt-parent = <&pic>;
+			interrupts = <17>;
+		};
+		serial1: serial@31000 {
+			device_type = "serial";
+			compatible = "ns16550";
+			reg = <0 0x31100 0xa00>;
+			reg-shift = <2>;
+			reg-io-width = <4>;
+			clock-frequency = <133333333>;
+			interrupt-parent = <&pic>;
+			interrupts = <18>;
+		};
+		i2c0: ocores@37100 {
+			compatible = "opencores,i2c-ocores";
+			#address-cells = <1>;
+			#size-cells = <0>;
+			reg = <0 0x37100 0x20>;
+			reg-shift = <2>;
+			reg-io-width = <4>;
+			clock-frequency = <32000000>;
+			interrupt-parent = <&pic>;
+			interrupts = <30>;
+		};
+		i2c1: ocores@37120 {
+			compatible = "opencores,i2c-ocores";
+			#address-cells = <1>;
+			#size-cells = <0>;
+			reg = <0 0x37120 0x20>;
+			reg-shift = <2>;
+			reg-io-width = <4>;
+			clock-frequency = <32000000>;
+			interrupt-parent = <&pic>;
+			interrupts = <31>;
+
+			rtc@68 {
+				compatible = "dallas,ds1374";
+				reg = <0x68>;
+			};
+
+			dtt@4c {
+				compatible = "national,lm90";
+				reg = <0x4c>;
+			};
+
+			eeprom@57 {
+                                compatible = "xlpge_eeprom";
+                                reg = <0x57>;
+                        };
+		};
+		pic: pic@4000 {
+			interrupt-controller;
+			#address-cells = <0>;
+			#interrupt-cells = <1>;
+			reg = <0 0x4000 0x200>;
+		};
+
+		nor_flash@1,0 {
+			compatible = "cfi-flash";
+			#address-cells = <1>;
+			#size-cells = <1>;
+			bank-width = <2>;
+			reg = <1 0 0x1000000>;
+
+			partition@0 {
+				label = "x-loader";
+				reg = <0x0 0x100000>; /* 1M */
+				read-only;
+			};
+
+			partition@100000 {
+				label = "u-boot";
+				reg = <0x100000 0x100000>; /* 1M */
+			};
+
+			partition@200000 {
+				label = "kernel";
+				reg = <0x200000 0x500000>; /* 5M */
+			};
+
+			partition@700000 {
+				label = "rootfs";
+				reg = <0x700000 0x800000>; /* 8M */
+			};
+
+			partition@f00000 {
+				label = "env";
+				reg = <0xf00000 0x100000>; /* 1M */
+				read-only;
+			};
+		};
+
+		nand_flash@0,0 {
+			compatible = "netlogic,xlp-nand";
+			#address-cells = <1>;
+			#size-cells = <1>;
+			reg = <0 0x39000 0x1000>;
+
+			interrupts = <43>;
+			interrupt-parent = <&pic>;
+			nand-ecc-mode = "hw";
+
+			partition@0 {
+				label = "x-loader";
+				reg = <0x0 0x80000>;
+			};
+
+			partition@1 {
+				label = "u-boot";
+				reg = <0x80000 0x100000>;
+			};
+
+			partition@2 {
+				label = "u-boot env";
+				reg = <0x180000 0x020000>;
+			};
+			partition@3 {
+				label = "u-boot env copy";
+				reg = <0x1a0000 0x020000>;
+			};
+			partition@4 {
+				label = "sysconfig";
+				reg = <0x1c0000 0x040000>;
+			};
+			partition@5 {
+				label = "user";
+				reg = <0x200000 0x1fe00000>;
+			};
+		};
+
+		spi: xlp_spi@13a000 {
+			compatible = "netlogic,xlp-spi";
+			#address-cells = <1>;
+			#size-cells = <0>;
+			reg = <0 0x3a000 0x100>;
+
+			spi_nor@1 {
+				compatible = "spansion,s25sl12801";
+				#address-cells = <1>;
+				#size-cells = <1>;
+
+				reg = <1>;		/* Chip Select */
+				spi-max-frequency = <40000000>;
+
+				partition@0 {
+					label = "x-loader";
+					reg = <0x0 0x200000>; /* 2M */
+					read-only;
+				};
+
+				partition@200000 {
+					label = "kernel";
+					reg = <0x200000 0x500000>; /* 5M */
+				};
+
+				partition@700000 {
+					label = "rootfs";
+					reg = <0x700000 0x800000>; /* 8M */
+				};
+
+				partition@f00000 {
+					label = "env";
+					reg = <0xf00000 0x100000>; /* 1M */
+					read-only;
+				};
+			};
+			spi_nand@2 {
+				compatible = "spinand,mt29f";
+				#address-cells = <1>;
+				#size-cells = <1>;
+				reg = <2>;	/* SPI NAND CS */
+				spi-max-frequency = <50000000>;
+
+				partition@0 {
+					label = "firmware";
+					reg = <0x0 0x1c00000>;
+				};
+
+				partition@1 {
+					label = "kernel";
+					reg = <0x1c00000 0x0>;
+				};
+			};
+
+		};
+		gpio: xlp_gpio@34000 {
+			compatible = "netlogic,xlp-gpio";
+			reg = <0 0x34000 0x1000>;
+			#gpio-cells = <2>;
+			gpio-controller;
+
+			#interrupt-cells = <1>;
+			interrupt-parent = <&pic>;
+			interrupts = <39>;
+			interrupt-controller;
+		};
+		ethernet@2,0 {
+		        compatible = "smsc,lan9115";
+		        reg = <1 0x01200000 0x100000>;
+			reg-io-width = <4>;
+
+		        interrupts = <39>;
+		        interrupt-parent = <&gpio>;
+
+		        phy-mode = "mii";
+		        mac-address = [00 11 22 33 44 55];
+			smsc,irq-push-pull;
+		};
+	};
+
+	chosen {
+		bootargs = "console=ttyS0,115200 rdinit=/sbin/init";
+	};
+};
diff --git a/arch/mips/boot/dts/xlp2xx-xmc-linux.dts b/arch/mips/boot/dts/xlp2xx-xmc-linux.dts
new file mode 100644
index 0000000..efc7839
--- /dev/null
+++ b/arch/mips/boot/dts/xlp2xx-xmc-linux.dts
@@ -0,0 +1,112 @@
+/* XLP2XX Device Tree Source
+ *
+ */
+
+/dts-v1/;
+/ {
+
+	model = "netlogic,XLP-FVP";
+        compatible = "netlogic,xlp";
+        #address-cells = <2>;
+        #size-cells = <2>;
+	/*memory range for linux. This will not appear in dom0*/
+        memory {
+                device_type = "memory";
+                reg =  <0 0x01000000 0 0x0B000000
+                        0 0x20000000 0 0x68a00000>;
+        };
+
+	hypervisor {
+		hypervisor-name = "Xen";
+		alloc_dom0_memory = <0>;
+		bootargs = "ncores=4 dom0_loadaddr=0x72000000 dom0_size=0x1c000000 dom0_cpumask=0xffff -- ";
+		domain_heap = <0x80000000 0x20000000>;
+	};
+	doms {
+		#address-cells = <1>;
+		#size-cells = <1>;
+		dom@0 {
+			device_type = "domain";
+			os = "linux";
+
+			#address-cells = <1>;
+			#size-cells = <1>;
+
+			cpu {
+				onlinemask = <0x1>;
+                                nae-rx-vc = <0>;
+                                nae-fb-vc = <1>;
+				napi-vc-mask = <0xb>;
+				sae-rx-vc = <0>; /*  */
+				sae-rx-sync-vc  = <3>; /* should be exclusive */
+				ipsec-async-vc  = <3>;
+				ipsec-sync-vc   = <2>;
+
+			};
+			uart {
+				id = <0>;
+				owner = <1>;
+				sharedcfg = <0x1f000000>;
+			};
+                        fmn {
+				/* make the node mask to 0xffffffff for SRIO */
+                                node_0_vc_mask = <0xbbbbbbbb 0xbbbbbbbb 0xbbbbbbbb 0xbbbbbbbb>;
+                        };
+			nae {
+				freein-fifo-mask = <0xff 0 0 0>;
+				/* node offsets and size */
+				vfbtbl-sw-offset = <0 0 0 0>;
+				vfbtbl-sw-nentries = <32 32 32 32>;
+				/* hw entries */
+				vfbtbl-hw-offset = <32 32 32 32>;
+				vfbtbl-hw-nentries = <20 20 20 20>;
+			};
+			owner-config {
+				nae = <0x1>;   // currently for node 0
+				sae = <0x1>;
+				rsa = <0x1>;
+				fmn = <0x1>;
+			};
+
+
+		};
+	};
+
+	chosen {
+		netlogic,cpumask = <0x01>;
+		bootargs = " console=ttyS0,115200  rhash_entries=1048576";
+		/*linux,initrd-start=<0x00c00000>;
+		linux,initrd-end=<0x02c00000>;*/
+	};
+
+	/* These binaries are downloaded at the resp physical memory locations
+	 * by their corresponding bootstrapping loaders. For example,
+	 * u-boot is loaded by x-load at 193M, sysconfig is loaded by u-boot
+	 * at 1M, hypervisor by u-boot hypervisor at 136M.
+	 * On simulator all these binaries are pre-loaded by using '-F' option
+	 * for convenience. On silicon, they will be loaded by their corresponding
+	 * temporary download locations the stage-1/stage-2 firmware
+	 */
+	firmware-download {
+		u-boot        = <0x0c100000 0x3f00000>;  /* 63M @ 193M */
+		sysconfig     = <0x00100000 0x00100000>; /* 1M @ 1M */
+		hypervisor    = <0x08800000 0x00800000>; /* 8M @ 136M */
+		dom0          = <0x09000000 0x03000000>; /* 48M @ 144M */
+		domU-ramdisk  = <0x60000000 0x60800000>; /* 8M @ 1536M */
+	};
+
+	soc {
+		nodes {
+			num-nodes = <1>;
+		};
+
+	};
+	frequency-config {
+		nae = <250>;
+		sae = <500>;
+		rsa = <500>;
+		dtre = <333>;  /* sub-multiple of 667 */
+		cde = <250>;
+	};
+};
+
diff --git a/arch/mips/boot/dts/xlp2xx-xmc-tiny.dts b/arch/mips/boot/dts/xlp2xx-xmc-tiny.dts
new file mode 100644
index 0000000..f73388f
--- /dev/null
+++ b/arch/mips/boot/dts/xlp2xx-xmc-tiny.dts
@@ -0,0 +1,159 @@
+/* XLP2XX Device Tree Source
+ *
+ */
+
+/dts-v1/;
+/ {
+	model = "MIPS,XLP2XX";
+	compatible = "NETL,XLP2XX_A0";
+	#address-cells = <1>;
+	#size-cells = <1>;
+	doms {
+		#address-cells = <1>;
+		#size-cells = <1>;
+		dom@0 {
+			device_type = "domain";
+			heap-size = <0x0 0x4000000>;
+			shared-mem = <0x0 0x80000000 0x0 0x20000000>;
+			#address-cells = <1>;
+			#size-cells = <1>;
+			cpu {
+				onlinemask = <0xf>;
+				nae-rx-vc = <0>;
+				nae-fb-vc = <3>;
+			};
+			uart {
+				id = <0>;
+			};
+			memory {
+				reg = <0x00100000 0x0FF00000	// 255M at 1M
+					   0x20000000 0x20000000>;  // 512M at 512M
+			};
+			pic {
+			};
+			owner-config {
+				nae = <0x1>;
+				fmn = <0x1>;
+			};
+		};
+	};
+
+	chosen {
+		bootargs = " console=ttyS0,115200 ";
+	};
+
+	soc {
+	    nae@node-0 {
+        	model = "MIPS,XLP2XX NAE CFG";
+	        compatible = "NETL,XLP2XX_A0";
+        	#address-cells = <1>;
+	        #size-cells = <1>;
+        	frequency = <250>;
+
+	        /include/ "ucore.dts"
+
+	        // VFBID MAP: Upto 127 entries
+        	// (each entry is a pair of (vfbid , dest-vc)
+	        // Legal range: (vfbid (0 - 126), dest-vc (0 - 4095))
+        	vfbid-config {
+                	vfbid-map = <
+	                     0    0    1   1   2   2   3   3
+        	        >;
+	        };
+
+        	// Packet Ordering Engine (POE)
+	        poe {
+
+        	        mode = "bypass";
+
+                	// Each vector is 512 bit with masb indicating vc 512 and lsb indicating vc 0
+	                // Format : 512-bit-vector is specified as 16 32-bit words
+        	        // Left most word has the vc range 511-479 right most word has vc range 31 - 0
+                	// Each word has the MSB select higer vc number and LSB select lower vc num
+	                distribution_vectors {
+                                     dv0  = <0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0x1>;
+                                     dv1  = <0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0>;
+                                     dv2  = <0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0>;
+                                     dv3  = <0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0>;
+                                     dv4  = <0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0>;
+                                     dv5  = <0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0>;
+                                     dv6  = <0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0>;
+                                     dv7  = <0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0>;
+                                     dv8  = <0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0>;
+                                     dv9  = <0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0>;
+                                     dv10 = <0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0>;
+                                     dv11 = <0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0>;
+                                     dv12 = <0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0>;
+                                     dv13 = <0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0>;
+                                     dv14 = <0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0>;
+                                     dv15 = <0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0>;
+        	        };
+	        };
+
+		/* if xaui functionality on complex@0 is required,
+		   then enable xaui and update mode = xaui/sgmii parameter, as appropriate */
+		complex@0 {
+			device_type = "nae-complex";
+			mode = "sgmii";
+			cpld = "no";
+			/*
+			xaui {
+				loopback = <0>;
+
+				// Max ingress fifo size 256 units (size of one unit is 64 byte)
+				iface-fifo-size = <55>;
+
+				// Max parser sequence fifo size 1024 packets
+				// (if 1588 Timestamp is not required, then max size increases to 2048)
+				parser-sequence-fifo-size = <225>;
+
+				// Since rx_buffer is per context, the buffer size given here will be divided by num-channels
+				num-channels = <1>;
+				rx-buffer-size = <944>;
+
+				// Max available descriptors are 1024  (across all complexes).
+				// Per port num_free_descriptors must be even number
+				num-free-descs = <150>;
+				free-desc-size = <2048>;
+				higig-mode = <0>;
+				xgmii-speed = <10>;
+				// In xlp3xx number of ucores available is 8. so, ucore_mask for xlp3xx is (ucore-mask & 0xFF)
+				ucore-mask = <0xffff>;
+				vlan-pri-en = <0x0>;
+				// To enable change it to  <1>
+				msec-port-enable  = <0>;
+			};
+			*/
+			sgmii {
+				loopback = <0 0 0 0>;
+				mgmt-port = <0 0 0 0>;
+				// Max ingress fifo size 256 units (size of one unit is 64 byte)
+				iface-fifo-size = <13 13 13 13>;
+
+				ext-phy-addr = <1 7 6 5>;
+				ext-phy-bus = <0 0 0 0>;
+
+				// Max parser sequence fifo size 1024 packets
+				// (if 1588 Timestamp is not required, then max size increases to 2048)
+				num-channels = <1 1 1 1>;
+				parser-sequence-fifo-size = <30 30 30 30>;
+
+				rx-buffer-size = <128 128 128 128>;
+
+				// Max available descriptors are 1024 (across all complexes).
+				// Per port num_free_descriptors must be even number
+				num-free-descs = <52 52 52 52>;
+				free-desc-size = <2048 2048 2048 2048>;
+				ucore-mask = <0xff 0xff 0xff 0xff>;
+			};
+		};
+	};
+   };	
+	frequency-config {
+		nae = <250>;
+		sae = <500>;
+		rsa = <500>;
+		dtre = <250>;  /* sub-multiple of 667 */
+		cde = <250>;
+	};
+};
-- 
1.9.1

