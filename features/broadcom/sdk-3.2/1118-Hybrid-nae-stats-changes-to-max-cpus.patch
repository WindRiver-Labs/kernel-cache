From 6dfcc1c9515b5710e2c182fa83352d64168c0ab0 Mon Sep 17 00:00:00 2001
From: Hareesh R <hareeshr@broadcom.com>
Date: Tue, 10 Apr 2012 11:44:40 +0530
Subject: [PATCH 1118/1532] Hybrid nae stats changes to max cpus

[Based on SDK 3.2]
Signed-off-by: Quanyang Wang <quanyang.wang@windriver.com>
---
 drivers/misc/netlogic/nae-perf/xlp_nae.c | 5 ++++-
 1 file changed, 4 insertions(+), 1 deletion(-)

diff --git a/drivers/misc/netlogic/nae-perf/xlp_nae.c b/drivers/misc/netlogic/nae-perf/xlp_nae.c
index 20268a1..cfeee3d 100755
--- a/drivers/misc/netlogic/nae-perf/xlp_nae.c
+++ b/drivers/misc/netlogic/nae-perf/xlp_nae.c
@@ -124,6 +124,7 @@ static struct pci_device_id soc_pci_table[] __devinitdata = {
          PCI_ANY_ID, PCI_ANY_ID, 0},
         {}
 };
+static uint64_t dummy_pktdata_addr[NLM_MAX_NODES];
 static uint64_t dbg_tcp_rx_cons[NR_CPUS * 8] __cacheline_aligned;
 static uint64_t p2p_dynamic_alloc_cnt[NR_CPUS * 8] __cacheline_aligned;
 static struct p2p_desc_mem p2p_desc_mem[NR_CPUS] __cacheline_aligned;
@@ -743,7 +744,7 @@ static int xlp_poll_lower(int budget, int cpu)
 			continue;
 		}
 
-		if ( (addr >= (192<<20)) && (addr < (256 << 20))){
+		if (addr == dummy_pktdata_addr[node]){
 			printk("Dropping firmware RX packet (addr=%llx)!\n", addr);
 			continue;
 		}
@@ -1086,6 +1087,8 @@ static void nlm_xlp_nae_init(void)
 			dev_mac[node][i] = dev;
 			xlp_mac_setup_hwaddr(priv);
 
+			dummy_pktdata_addr[node] = nae_cfg->dummy_pktdata_addr;
+
 			for(cpu = 0; cpu<NR_CPUS; cpu++){
 				per_cpu_netdev[node][cpu][i] = dev;
 			}
-- 
1.9.1

