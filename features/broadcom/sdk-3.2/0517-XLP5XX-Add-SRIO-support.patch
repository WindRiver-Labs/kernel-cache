From 8de0f563be09bb3f8cae111e0de2b2f5de41a6e3 Mon Sep 17 00:00:00 2001
From: Anurag <anurag.gopinath@broadcom.com>
Date: Tue, 11 Mar 2014 06:43:33 +0530
Subject: [PATCH 0517/1532] XLP5XX : Add SRIO support

[Based on SDK 3.2]
Signed-off-by: Quanyang Wang <quanyang.wang@windriver.com>
---
 arch/mips/boot/dts/xlp5xx-linux-tmpl.dts |  3 +++
 arch/mips/boot/dts/xlp5xx-linux.dts      | 20 ++++++++++++++++++--
 2 files changed, 21 insertions(+), 2 deletions(-)

diff --git a/arch/mips/boot/dts/xlp5xx-linux-tmpl.dts b/arch/mips/boot/dts/xlp5xx-linux-tmpl.dts
index b5a6517..b6fa45d7 100644
--- a/arch/mips/boot/dts/xlp5xx-linux-tmpl.dts
+++ b/arch/mips/boot/dts/xlp5xx-linux-tmpl.dts
@@ -235,6 +235,9 @@
 		        mac-address = [00 11 22 33 44 55];
 		        smsc,irq-push-pull;
 		};
+                rio: xlp_rio@2c000 {
+                        compatible = "netlogic,xlp-rio";
+                };
 	};
 
 	chosen {
diff --git a/arch/mips/boot/dts/xlp5xx-linux.dts b/arch/mips/boot/dts/xlp5xx-linux.dts
index 421d465..5f75665 100644
--- a/arch/mips/boot/dts/xlp5xx-linux.dts
+++ b/arch/mips/boot/dts/xlp5xx-linux.dts
@@ -61,7 +61,8 @@
 				sharedcfg = <0x1f000000>;
 			};
                         fmn {
-				node_0_vc_mask = <0xbbbbbbbb 0xbbbbbbbb 0xbbbbbbbb 0xbbbbbbbb >;
+				/*node_0_vc_mask = <0xbbbbbbbb 0xbbbbbbbb 0xbbbbbbbb 0xbbbbbbbb >;*/
+				node_0_vc_mask = <0xffffffff 0xffffffff 0xffffffff 0xffffffff >;
                         };
 			pic {
 			};
@@ -181,7 +182,22 @@
 		nodes {
 			num-nodes = <1>;
 		};
-
+               srio@node-0{
+                       /* type = "master" or "device". master is responsible for enumeration*/
+                       type = "master";
+                       /* SRIO_MODE_x1 = 1(not supported), SRIO_MODE_x4 = 2 */
+                       mode = <2>;
+                       /* BAUD_1250M = 1 (1.25G)
+                          BAUD_2500M = 2 (25.G)
+                          BAUD_3125M = 3 (3.125G)
+                          BAUD_5000M = 4 (5G)
+                          BAUD_6250M = 5 (6.25G) */
+                       baud-rate = <5>;
+                       rxvc = <2>;
+                       msgdstid = <2>;
+                       /* sys-size = 1 for 16bit device id, 0 for 8 bit device id */
+                       sys-size = <1>;
+               };
 	};
 
         frequency-config {
-- 
1.9.1

