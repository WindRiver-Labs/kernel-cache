From 077d71eee1ef291520fbfc088790c12cdcacf614 Mon Sep 17 00:00:00 2001
From: Subhendu Sekhar Behera <sbehera@broadcom.com>
Date: Wed, 7 May 2014 20:53:00 +0530
Subject: [PATCH 0967/1532] nae: Ignore invalid phy addr if mentioned in dts

phy addr greater than 31 or less than 0 is invalid.
[Based on SDK 3.2]
Signed-off-by: Quanyang Wang <quanyang.wang@windriver.com>
---
 arch/mips/netlogic/lib/netlib/src/netsoc_fdt.c | 6 +++++-
 1 file changed, 5 insertions(+), 1 deletion(-)

diff --git a/arch/mips/netlogic/lib/netlib/src/netsoc_fdt.c b/arch/mips/netlogic/lib/netlib/src/netsoc_fdt.c
index b8a5ec4..21646b8 100644
--- a/arch/mips/netlogic/lib/netlib/src/netsoc_fdt.c
+++ b/arch/mips/netlogic/lib/netlib/src/netsoc_fdt.c
@@ -1113,8 +1113,11 @@ static int fdt_parse_port_config(void *fdt, nae_t *nae_cfg, struct netsoc_lib_pa
                 nae_cfg->msec_port_enable, block, cmplx_cfg.msec_port_enable);
 #endif
 
-                for(offset = 0; offset < num_ports; offset++, port++) {
+                for(offset = 0; offset < num_ports; offset++) {
                         nae_port = &nae_cfg->ports[port];
+			nae_port->ext_phy_addr = cmplx_cfg.ext_phy_addr[offset];
+			if (nae_port->ext_phy_addr < 0 || nae_port->ext_phy_addr > 31)
+				continue;
                         nae_port->hw_port_id = get_intf_hw_port_id(block, intf_type, offset);
                         nae_port->txq = txq;
                         nae_port->rxq = nae_cfg->frin_queue_base + nae_port->hw_port_id;
@@ -1154,6 +1157,7 @@ static int fdt_parse_port_config(void *fdt, nae_t *nae_cfg, struct netsoc_lib_pa
                                 return -1;
                         rx_slots += nae_port->rx_slots_reqd;
                         txq += nae_port->num_channels;
+			port++;
 			netsoc_api_print(NETSOC_APIDBG_FDT,"intf_fifo %d prsr_seq_ %d rx_buf %d\n",nae_port->intf_fifo_size, nae_port->prsr_seq_fifo_size, nae_port->rx_buf_size);
                 }
                 if (intf_type == INTERLAKEN_IF)
-- 
1.9.1

