From 026dfea43fe306193cc40aafc7cb86d494b6eb77 Mon Sep 17 00:00:00 2001
From: Quanyang Wang <quanyang.wang@windriver.com>
Date: Fri, 28 Aug 2015 03:14:17 +0000
Subject: [PATCH] kgdboc: acp34xx: rx polling hook for the acp34xx driver

The RX polling hook allows the debugger to hook character input so
as to allow entry to the kernel debugger with a control-c as an
example.

Signed-off-by: Quanyang Wang <quanyang.wang@windriver.com>
---
 drivers/tty/serial/lsi_acp_serial.c |    5 ++++-
 1 files changed, 4 insertions(+), 1 deletions(-)

diff --git a/drivers/tty/serial/lsi_acp_serial.c b/drivers/tty/serial/lsi_acp_serial.c
index 58b34cd..666bed7 100644
--- a/drivers/tty/serial/lsi_acp_serial.c
+++ b/drivers/tty/serial/lsi_acp_serial.c
@@ -293,7 +293,10 @@ acp_serial_rx_chars(struct uart_acp_port *uap)
 			else if (ch & UART011_DR_FE)
 				flag = TTY_FRAME;
 		}
-
+#ifdef CONFIG_CONSOLE_POLL
+		if (uap->port.poll_rx_cb && uap->port.poll_rx_cb(ch & 255))
+			goto ignore_char;
+#endif
 		if (uart_handle_sysrq_char(&uap->port, ch & 255))
 			goto ignore_char;
 
-- 
1.7.5.4

