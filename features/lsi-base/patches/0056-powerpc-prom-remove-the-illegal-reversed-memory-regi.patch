From 39bdc27ca64a79869aa3e2a6a5287c38d261ca36 Mon Sep 17 00:00:00 2001
From: Wei Yang <Wei.Yang@windriver.com>
Date: Tue, 20 Nov 2012 14:40:40 +0800
Subject: [PATCH 56/82] powerpc/prom: remove the illegal reversed memory region

commit 39bdc27ca64a79869aa3e2a6a5287c38d261ca36 from
git://git.yoctoproject.org/linux-yocto-3.14

When the MEMORY_START is larger than 0 we need to ensure that kernel
does not reserve the range from 0 to MEMORY_START in memblock. Because
the range is out of the available memory.

Signed-off-by: Wei Yang <Wei.Yang@windriver.com>
---
 arch/powerpc/kernel/prom.c | 6 ++++++
 1 file changed, 6 insertions(+)

diff --git a/arch/powerpc/kernel/prom.c b/arch/powerpc/kernel/prom.c
index 8dd5a09..675d1d2 100644
--- a/arch/powerpc/kernel/prom.c
+++ b/arch/powerpc/kernel/prom.c
@@ -721,6 +721,12 @@ void __init early_init_devtree(void *params)
 #endif
 		reserve_crashkernel();
 	early_reserve_mem();
+	/*
+	 * The range of reserved memory region is out of memory
+	 * while MEMORY_START is larger than 0.
+	 * so we should remove it.
+	 */
+	memblock_free(0, MEMORY_START);
 
 	/*
 	 * Ensure that total memory size is page-aligned, because otherwise
-- 
1.9.1

