From 576e3ad799f5abc82d4094cceb024a8bca51508e Mon Sep 17 00:00:00 2001
From: Jiang Lu <lu.jiang@windriver.com>
Date: Fri, 29 Nov 2013 13:18:21 +0800
Subject: [PATCH] lsi-dma:Add workround for ACP platform

According to LSI code it has to be set GEN_CONFIG register twice in
soft_reset() of lsi-dma driver. It is necessary for ACP platform,
or it won't generate interrupt on after issued DMA transfer.

Signed-off-by: Jiang Lu <lu.jiang@windriver.com>
Signed-off-by: Quanyang Wang <quanyang.wang@windriver.com>
---
 drivers/dma/lsi-dma32.c | 7 +++++++
 1 file changed, 7 insertions(+)

diff --git a/drivers/dma/lsi-dma32.c b/drivers/dma/lsi-dma32.c
index b16df68..ec3ea42 100644
--- a/drivers/dma/lsi-dma32.c
+++ b/drivers/dma/lsi-dma32.c
@@ -111,6 +111,13 @@ static void soft_reset(struct gpdma_engine *engine)
 		engine_dbg(engine, "Using edge-triggered interrupts\n");
 	}
 	writel(cfg, engine->gbase + GEN_CONFIG);
+#ifdef CONFIG_ACP
+	/*
+	 *  Yep! According to LSI code it has to be done twice,
+	 *  should be a workround for ACP platform.
+	 */
+	writel(cfg, engine->gbase + GEN_CONFIG);
+#endif
 	engine_dbg(engine, "engine->desc.phys & 0xfff00000 == %llx\n",
 		   (engine->pool.phys & 0xfff00000));
 
-- 
1.9.1

