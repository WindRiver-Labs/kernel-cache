From 8388e469043d9c2c8ef7f5f37112d3a7ab7aa932 Mon Sep 17 00:00:00 2001
From: SangeethaRao <sangeetha.rao@intel.com>
Date: Thu, 11 Jun 2015 16:47:15 +0300
Subject: [PATCH 36/82] arch/arm/mach-axxia: Updated Axxia 55xx PCIe driver to
 use correct Doorbell interrupt IRQs

commit 8388e469043d9c2c8ef7f5f37112d3a7ab7aa932 from
git://git.yoctoproject.org/linux-yocto-3.14

Signed-off-by: SangeethaRao <sangeetha.rao@intel.com>
Signed-off-by: Bruce Ashfield <bruce.ashfield@windriver.com>
---
 arch/arm/mach-axxia/pci.c | 15 +++++++--------
 1 file changed, 7 insertions(+), 8 deletions(-)

diff --git a/arch/arm/mach-axxia/pci.c b/arch/arm/mach-axxia/pci.c
index 722ac7c..46727ed 100644
--- a/arch/arm/mach-axxia/pci.c
+++ b/arch/arm/mach-axxia/pci.c
@@ -658,14 +658,6 @@ static int axxia_pcie_setup(int portno, struct pci_sys_data *sys)
 		goto fail;
 	}
 
-	/* MSI interrupts */
-	for (i = 1; i <= 16; i++) {
-		port->irq[i] = irq_of_parse_and_map(port->node, i);
-		if (!port->irq[i])
-			break;
-		irq_set_chained_handler(port->irq[i], pcie_msi_irq_handler);
-	}
-
 	/* Setup as root complex */
 	pci_config = readl(port->regs + PCIE_CONFIG);
 	pci_status = readl(port->regs + PCIE_STATUS);
@@ -726,6 +718,13 @@ static int axxia_pcie_setup(int portno, struct pci_sys_data *sys)
 		}
 	}
 
+	/* MSI interrupts */
+	for (i = 2; i <= 17; i++) {
+		port->irq[i] = irq_of_parse_and_map(port->node, i);
+		if (!port->irq[i])
+			break;
+		irq_set_chained_handler(port->irq[i], pcie_msi_irq_handler);
+	}
 	/*
 	 * Setup outbound PCI Memory Window
 	 */
-- 
1.9.1

