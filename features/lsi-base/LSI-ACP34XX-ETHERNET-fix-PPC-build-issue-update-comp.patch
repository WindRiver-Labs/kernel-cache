From 3e80e144dbf02b189ee6652f25b71755b9478982 Mon Sep 17 00:00:00 2001
From: David Mercado <david.mercado@windriver.com>
Date: Wed, 20 Nov 2013 16:32:15 -0500
Subject: [PATCH 146/159] LSI ACP34XX: ETHERNET: fix PPC build issue, update
 "compatible" list

git.yoctoproject.org/git/linux-yocto-3.10
commit 1b6ae00cd97bbe2a6d5137ffbb52ceed3a3c0d72 standard/axxia/base.

Remove use of ARM specific header file, which is causing a build
error on PPC.

Some bootloaders use "acp-femac" instead of "lsi,acp-femac" in their
fdt to denote the onboard ethernet device.  Add "acp-femac" to the list
of compatible device ids.  The table must also be null terminated.

Original fix by Charlie Paul <Charlie.Paul@windriver.com>, with
modifications.

Signed-off-by: Hong H. Pham <hong.pham@windriver.com>
---
 drivers/net/ethernet/lsi/lsi_acp_net.c |    6 ++++--
 drivers/net/ethernet/lsi/lsi_acp_net.h |    3 +++
 2 files changed, 7 insertions(+), 2 deletions(-)

diff --git a/drivers/net/ethernet/lsi/lsi_acp_net.c b/drivers/net/ethernet/lsi/lsi_acp_net.c
index c868797..03bb287 100644
--- a/drivers/net/ethernet/lsi/lsi_acp_net.c
+++ b/drivers/net/ethernet/lsi/lsi_acp_net.c
@@ -86,7 +86,6 @@
 #include <linux/uaccess.h>
 #include <linux/io.h>
 #include <asm/dma.h>
-#include <asm/lsi/acp_ncr.h>
 
 #include "lsi_acp_net.h"
 #include "../../../misc/lsi-ncr.h"
@@ -1991,7 +1990,10 @@ static int appnic_drv_remove(struct platform_device *pdev)
 }
 
 static const struct of_device_id appnic_dt_ids[] = {
-	{ .compatible = "lsi,acp-femac", }
+	{ .compatible = "lsi,acp-femac", },
+	{ .compatible = "acp-femac", },
+	{ /* end of list */ },
+
 };
 MODULE_DEVICE_TABLE(of, appnic_dt_ids);
 
diff --git a/drivers/net/ethernet/lsi/lsi_acp_net.h b/drivers/net/ethernet/lsi/lsi_acp_net.h
index 7b6f2b3..238af6e 100644
--- a/drivers/net/ethernet/lsi/lsi_acp_net.h
+++ b/drivers/net/ethernet/lsi/lsi_acp_net.h
@@ -26,6 +26,9 @@
 extern int ubootenv_get(const char *, char *);
 #endif
 
+extern int acp_mdio_read(unsigned long, unsigned long, unsigned short *, int);
+extern int acp_mdio_write(unsigned long, unsigned long, unsigned short, int);
+
 /*
  * This is the maximum number of packets to be received every
  * NAPI poll
-- 
1.7.5.4

