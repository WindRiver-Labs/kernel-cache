From b113d78d85180e92afd7f4769d4d25b2a985ba10 Mon Sep 17 00:00:00 2001
From: Li Wang <li.wang@windriver.com>
Date: Wed, 26 Aug 2015 10:40:54 +0800
Subject: [PATCH 61/68] arch/arm/mach-axxia: Updated Axxia 55xx PCIe driver to
 use correct Doorbell interrupt IRQs

the patch comes from:
git://git.yoctoproject.org/linux-yocto-3.10
commit 948332b1ba42e0133b6d683274a29ce4dedefa65 upstream

Signed-off-by: SangeethaRao <sangeetha.rao@intel.com>
Signed-off-by: Bruce Ashfield <bruce.ashfield@windriver.com>
Signed-off-by: Li Wang <li.wang@windriver.com>
---
 arch/arm/mach-axxia/pci.c |   15 +++++++--------
 1 files changed, 7 insertions(+), 8 deletions(-)

diff --git a/arch/arm/mach-axxia/pci.c b/arch/arm/mach-axxia/pci.c
index 2e2a02a..d4dc235 100644
--- a/arch/arm/mach-axxia/pci.c
+++ b/arch/arm/mach-axxia/pci.c
@@ -659,14 +659,6 @@ static int axxia_pcie_setup(int portno, struct pci_sys_data *sys)
 		goto fail;
 	}
 
-	/* MSI interrupts */
-	for (i = 1; i <= 16; i++) {
-		port->irq[i] = irq_of_parse_and_map(port->node, i);
-		if (!port->irq[i])
-			break;
-		irq_set_chained_handler(port->irq[i], pcie_msi_irq_handler);
-	}
-
 	/* Setup as root complex */
 	pci_config = readl(port->regs + PCIE_CONFIG);
 	pci_status = readl(port->regs + PCIE_STATUS);
@@ -727,6 +719,13 @@ static int axxia_pcie_setup(int portno, struct pci_sys_data *sys)
 		}
 	}
 
+	/* MSI interrupts */
+	for (i = 2; i <= 17; i++) {
+		port->irq[i] = irq_of_parse_and_map(port->node, i);
+		if (!port->irq[i])
+			break;
+		irq_set_chained_handler(port->irq[i], pcie_msi_irq_handler);
+	}
 	/*
 	 * Setup outbound PCI Memory Window
 	 */
-- 
1.7.5.4

