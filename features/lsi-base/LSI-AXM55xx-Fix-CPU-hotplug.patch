From 9a000b8ec28d6f0dcead169791dbf62d9d043a53 Mon Sep 17 00:00:00 2001
From: David Mercado <david.mercado@windriver.com>
Date: Mon, 31 Mar 2014 13:19:42 -0400
Subject: [PATCH 58/71] LSI AXM55xx: Fix CPU hotplug

git://git.yoctoproject.org/linux-yocto-3.10 standard/axxia/base
commit 4a4cb4de00a97456c8fdf235f12295783f7691fe

The platform CPU die routine was not being called. Added hook to
axxia_platform_cpu_die().

Signed-off-by: David Mercado <david.mercado@windriver.com>
Signed-off-by: Zhong Hongbo <hongbo.zhong@windriver.com>
---
 arch/arm/mach-axxia/axxia.h   |    1 +
 arch/arm/mach-axxia/hotplug.c |    2 +-
 arch/arm/mach-axxia/platsmp.c |    5 +++++
 3 files changed, 7 insertions(+), 1 deletions(-)

diff --git a/arch/arm/mach-axxia/axxia.h b/arch/arm/mach-axxia/axxia.h
index 3393d37..156c6e0 100644
--- a/arch/arm/mach-axxia/axxia.h
+++ b/arch/arm/mach-axxia/axxia.h
@@ -2,6 +2,7 @@
 
 void axxia_init_clocks(int is_sim);
 void axxia_ddr_retention_init(void);
+void axxia_platform_cpu_die(unsigned int cpu);
 
 extern struct smp_operations axxia_smp_ops;
 
diff --git a/arch/arm/mach-axxia/hotplug.c b/arch/arm/mach-axxia/hotplug.c
index d919bff..fb5ec90 100644
--- a/arch/arm/mach-axxia/hotplug.c
+++ b/arch/arm/mach-axxia/hotplug.c
@@ -114,7 +114,7 @@ int platform_cpu_kill(unsigned int cpu)
  *
  * Called with IRQs disabled
  */
-void platform_cpu_die(unsigned int cpu)
+void axxia_platform_cpu_die(unsigned int cpu)
 {
 	int spurious = 0;
 
diff --git a/arch/arm/mach-axxia/platsmp.c b/arch/arm/mach-axxia/platsmp.c
index 946cddd..5ac214f 100644
--- a/arch/arm/mach-axxia/platsmp.c
+++ b/arch/arm/mach-axxia/platsmp.c
@@ -22,6 +22,7 @@
 #include <asm/mach/map.h>
 #include <asm/virt.h>
 
+#include "axxia.h"
 #include <mach/axxia-gic.h>
 
 extern void axxia_secondary_startup(void);
@@ -249,4 +250,8 @@ struct smp_operations axxia_smp_ops __initdata = {
 	.smp_prepare_cpus	= axxia_smp_prepare_cpus,
 	.smp_secondary_init	= axxia_secondary_init,
 	.smp_boot_secondary	= axxia_boot_secondary,
+#ifdef CONFIG_HOTPLUG_CPU
+	.cpu_die		= axxia_platform_cpu_die,
+#endif
+
 };
-- 
1.7.5.4

