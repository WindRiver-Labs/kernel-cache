From 23b74111e50b75f73f1c3fff3ca33a5601939d7f Mon Sep 17 00:00:00 2001
From: Li Wang <li.wang@windriver.com>
Date: Fri, 24 Apr 2015 15:24:29 +0800
Subject: [PATCH 6/9] arch/powerpc/kernel: Address IBM PPC476 erratum 47

git://git.yoctoproject.org/linux-yocto-3.4
commit 922ec049c06a03b20c0182c64581f501a2214677

Disable the BTAC in order to prevent errors in circumstances described
by IBM PPC476 erratum 47.

Signed-off-by: Sangeetha Rao <sangeetha.rao@intel.com>
Signed-off-by: Bruce Ashfield <bruce.ashfield@windriver.com>
Signed-off-by: Li Wang <li.wang@windriver.com>
---
 arch/powerpc/kernel/head_44x.S |    3 +++
 1 files changed, 3 insertions(+), 0 deletions(-)

diff --git a/arch/powerpc/kernel/head_44x.S b/arch/powerpc/kernel/head_44x.S
index ac36884..82c1623 100644
--- a/arch/powerpc/kernel/head_44x.S
+++ b/arch/powerpc/kernel/head_44x.S
@@ -1248,9 +1248,12 @@ clear_utlb_entry:
 	/* We configure icbi to invalidate 128 bytes at a time since the
 	 * current 32-bit kernel code isn't too happy with icache != dcache
 	 * block size
+	 * We also disable the BTAC as this can cause errors in some
+	 * circumstances (see IBM Erratum 47).
 	 */
 	mfspr	r3,SPRN_CCR0
 	oris	r3,r3,0x0020
+	ori	r3,r3,0x0040
 	mtspr	SPRN_CCR0,r3
 	isync
 
-- 
1.7.5.4

