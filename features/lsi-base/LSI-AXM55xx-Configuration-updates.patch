From be939045e1456ed10824644533d75785394b36bc Mon Sep 17 00:00:00 2001
From: Michael Bringmann <michael.bringmann@lsi.com>
Date: Thu, 30 Jan 2014 15:12:50 -0600
Subject: [PATCH 25/71] LSI AXM55xx: Configuration updates

git://git.yoctoproject.org/linux-yocto-3.10 standard/axxia/base
commit 989b30432b422f6cfb6a11fe5a91b2a6be05e994

Update the powerpc FDT settings for the latest AXXIA RIO code.

Signed-off-by: Michael Bringmann <michael.bringmann@lsi.com>
Signed-off-by: Zhong Hongbo <hongbo.zhong@windriver.com>
---
 arch/powerpc/boot/dts/acp25xx.dts |   49 ++++++++++++----------------
 arch/powerpc/boot/dts/acp342x.dts |   37 +++++++++------------
 arch/powerpc/boot/dts/acp344x.dts |   63 +++++++++++++++++--------------------
 arch/powerpc/boot/dts/acp35xx.dts |   25 +++++++++-----
 4 files changed, 82 insertions(+), 92 deletions(-)

diff --git a/arch/powerpc/boot/dts/acp25xx.dts b/arch/powerpc/boot/dts/acp25xx.dts
index 4db67df..02f6a28 100644
--- a/arch/powerpc/boot/dts/acp25xx.dts
+++ b/arch/powerpc/boot/dts/acp25xx.dts
@@ -90,7 +90,7 @@
                         clock-frequency = <0>; // Filled in by zImage
                         UART0: serial@00404000 {
                                 device_type = "serial";
-                                compatible = "acp-uart0";
+                                compatible = "lsi,acp-uart0";
                                 enabled = <1>;
                                 reg = <0x00404000 0x1000>;
                                 clock-reg = <0x00408040 0x20>;
@@ -101,7 +101,7 @@
                         };
                         UART1: serial@00405000 {
                                 device_type = "serial";
-                                compatible = "acp-uart1";
+                                compatible = "lsi,acp-uart1";
                                 enabled = <0>;
                                 reg = <0x00405000 0x1000>;
                                 clock-reg = <0x00408060 0x20>;
@@ -112,21 +112,21 @@
                         };
                         USB0: usb@004a4000 {
                                 device_type = "usb";
-                                compatible = "acp-usb";
+                                compatible = "lsi,acp-usb";
                                 enabled = <0>;
                                 reg = <0x004a4000 0x00020000>;
                                 interrupt-parent = <&MPIC>;
                                 interrupts = <31>;
                         };
                         I2C: i2c@00403000 {
-                                compatible = "acp-i2c";
+                                compatible = "lsi,acp-i2c";
                                 enabled = <0>;
                                 reg = <0x00403000 0x00001000>;
                                 interrupt-parent = <&MPIC>;
                                 interrupts = <21>;
                         };
                         SSP: ssp@00402000 {
-                                compatible = "acp-ssp";
+                                compatible = "arm,acp-ssp";
                                 enabled = <0>;
                                 reg = <0x00402000 0x00001000>;
                                 interrupt-parent = <&MPIC>;
@@ -134,14 +134,14 @@
                         };
                         NAND: nand@00440000 {
                                 device_type = "nand";
-                                compatible = "acp-nand";
+                                compatible = "lsi,acp-nand";
                                 enabled = <1>;
                                 reg = <0x00440000 0x20000
                                        0x0040c000 0x1000>;
                         };
                         FEMAC: femac@00480000 {
                                 device_type = "network";
-                                compatible = "acp-femac";
+                                compatible = "lsi,acp-femac";
                                 enabled = <1>;
                                 reg = <0x00480000 0x1000
                                        0x00481000 0x1000
@@ -283,27 +283,20 @@
                 >;
         };
 
-        rio0: rapidio@f0020000 {
-                compatible = "acp,rapidio-delta";
+        rio0: rapidio@0x2100000000 {
+                index = <0>;
+                status = "okay";
+                #address-cells = <2>;
+                #size-cells = <2>;
+                compatible = "axxia,rapidio-delta";
                 device_type = "rapidio";
-                enabled = <0>;
-                #size = <0>;    /* 0 = (256, small system)
-                                 * 1 = (65536, large system) */
-/*
-                #host-device-id = <1>;
-*/
-                                /* >=0 for enum; < 0 for disc */
-/*
-                num-dme = <1 0 1>;
-*/
-                                /* (#outb-mseg>, <#outb-sseg>, <#inb> */
-/*
-                num-odme-mseg-desc = <2 128 128>;
-                num-odme-sseg-desc = <1 256>;
-                num-idme-desc = <1 512>;
-*/
-                reg = <0xf0020000 0x20000 0x1000>; /* SRIO Conf region */
-                interrupt-parent = <&MPIC>;
-                interrupts = <30 0x2 /* NCP_INTR_MPIC_SRC_AXIS_SRIO */>;
+                reg = <0x0020 0x00560000 0x0 0x1000>; /* SRIO Conf 0 region */
+                ranges = <0x0 0x0 0x0021 0x00000000 0x0 0x40000000>;
+                linkdown-reset = <0x0200 0x100 0x0020 0x00430000 0x0 0x000010000>;
+		interrupt-parent = <&MPIC>;
+                interrupts = <30 2>;
+                outb-dmes = <2 0x00000003 1 0x00000001>;
+		enable_ds = <1>;
         };
+
 };
diff --git a/arch/powerpc/boot/dts/acp342x.dts b/arch/powerpc/boot/dts/acp342x.dts
index f5cf3a6..34f76eb 100644
--- a/arch/powerpc/boot/dts/acp342x.dts
+++ b/arch/powerpc/boot/dts/acp342x.dts
@@ -284,27 +284,22 @@
                 >;
         };
 
-        rio0: rapidio@f0020000 {
-                compatible = "lsi,rapidio-delta";
+        rio0: rapidio@0x2080000000 {
+                index = <0>;
+                status = "okay";
+                #address-cells = <2>;
+                #size-cells = <2>;
+                compatible = "axxia,rapidio-delta";
                 device_type = "rapidio";
-                enabled = <0>;
-                #size = <0>;    /* 0 = (256, small system)
-                                 * 1 = (65536, large system) */
-/*
-                #host-device-id = <1>;
-*/
-                                /* >=0 for enum; < 0 for disc */
-/*
-                num-dme = <1 0 1>;
-*/
-                                /* (#outb-mseg>, <#outb-sseg>, <#inb> */
-/*
-                num-odme-mseg-desc = <2 128 128>;
-                num-odme-sseg-desc = <1 256>;
-                num-idme-desc = <1 512>;
-*/
-                reg = <0xf0020000 0x20000 0x1000>; /* SRIO Conf region */
-                interrupt-parent = <&MPIC>;
-                interrupts = <30 0x2 /* NCP_INTR_MPIC_SRC_AXIS_SRIO */>;
+                reg = <0x0020 0x00420000 0x0 0x1000>; /* SRIO Conf 0 region */
+                ranges = <0x0 0x0 0x0020 0x80000000 0x0 0x40000000>;
+		/*
+                linkdown-reset = <0x0200 0x100 0x0020 0x00430000 0x0 0x000010000>;
+		*/
+		interrupt-parent = <&MPIC>;
+                interrupts = <30 2>;
+                outb-dmes = <2 0x00000003 1 0x00000001>;
+		enable_ds = <1>;
         };
+
 };
diff --git a/arch/powerpc/boot/dts/acp344x.dts b/arch/powerpc/boot/dts/acp344x.dts
index b851788..51fa547 100644
--- a/arch/powerpc/boot/dts/acp344x.dts
+++ b/arch/powerpc/boot/dts/acp344x.dts
@@ -90,64 +90,64 @@
                         clock-frequency = <0>; // Filled in by zImage
                         UART0: serial@00404000 {
                                 device_type = "serial";
-                                compatible = "acp-uart0";
+                                compatible = "lsi,acp-uart0";
                                 enabled = <1>;
                                 reg = <0x00404000 0x1000>;
                                 clock-reg = <0x00408040 0x20>;
                                 clock-frequency = <0xbebc200>;
                                 current-speed = <9600>;
                                 interrupt-parent = <&MPIC>;
-                                interrupts = <22 4>;
+                                interrupts = <22>;
                         };
                         UART1: serial@00405000 {
                                 device_type = "serial";
-                                compatible = "acp-uart1";
+                                compatible = "lsi,acp-uart1";
                                 enabled = <0>;
                                 reg = <0x00405000 0x1000>;
                                 clock-reg = <0x00408060 0x20>;
                                 clock-frequency = <200000000>;
                                 current-speed = <9600>;
                                 interrupt-parent = <&MPIC>;
-                                interrupts = <23 4>;
+                                interrupts = <23>;
                         };
                         USB0: usb@004a4000 {
                                 device_type = "usb";
-                                compatible = "acp-usb";
+                                compatible = "lsi,acp-usb";
                                 enabled = <0>;
                                 reg = <0x004a4000 0x00020000>;
                                 interrupt-parent = <&MPIC>;
-                                interrupts = <31 4>;
+                                interrupts = <31>;
                         };
                         I2C: i2c@00403000 {
-                                compatible = "acp-i2c";
+                                compatible = "lsi,acp-i2c";
                                 enabled = <0>;
                                 reg = <0x00403000 0x00001000>;
                                 interrupt-parent = <&MPIC>;
-                                interrupts = <21 4>;
+                                interrupts = <21>;
                         };
                         SSP: ssp@00402000 {
-                                compatible = "acp-ssp";
+                                compatible = "arm,acp-ssp";
                                 enabled = <0>;
                                 reg = <0x00402000 0x00001000>;
                                 interrupt-parent = <&MPIC>;
-                                interrupts = <20 4>;
+                                interrupts = <20>;
                         };
                         NAND: nand@00440000 {
                                 device_type = "nand";
-                                compatible = "acp-nand";
+                                compatible = "lsi,acp-nand";
                                 enabled = <1>;
                                 reg = <0x00440000 0x20000
                                        0x0040c000 0x1000>;
                         };
                         FEMAC: femac@00480000 {
                                 device_type = "network";
-                                compatible = "acp-femac";
+                                compatible = "lsi,acp-femac";
                                 enabled = <1>;
                                 reg = <0x00480000 0x1000
                                        0x00481000 0x1000
                                        0x00482000 0x1000>;
                                 interrupt-parent = <&MPIC>;
-                                interrupts = <33 4>;
+                                interrupts = <33>;
                                 mdio-reg = <0x00409000 0x1000>;
                                 // The following will get filled in by
                                 // the boot loader.
@@ -283,27 +283,22 @@
                 >;
         };
 
-        rio0: rapidio@f0020000 {
-                compatible = "acp,rapidio-delta";
+        rio0: rapidio@0x2080000000 {
+                index = <0>;
+                status = "okay";
+                #address-cells = <2>;
+                #size-cells = <2>;
+                compatible = "axxia,rapidio-delta";
                 device_type = "rapidio";
-                enabled = <0>;
-                #size = <0>;    /* 0 = (256, small system)
-                                 * 1 = (65536, large system) */
-/*
-                #host-device-id = <1>;
-*/
-                                /* >=0 for enum; < 0 for disc */
-/*
-                num-dme = <1 0 1>;
-*/
-                                /* (#outb-mseg>, <#outb-sseg>, <#inb> */
-/*
-                num-odme-mseg-desc = <2 128 128>;
-                num-odme-sseg-desc = <1 256>;
-                num-idme-desc = <1 512>;
-*/
-                reg = <0xf0020000 0x20000 0x1000>; /* SRIO Conf region */
-                interrupt-parent = <&MPIC>;
-                interrupts = <30 0x2 /* NCP_INTR_MPIC_SRC_AXIS_SRIO */>;
+                reg = <0x0020 0x00420000 0x0 0x1000>; /* SRIO Conf 0 region */
+                ranges = <0x0 0x0 0x0020 0x80000000 0x0 0x40000000>;
+		/*
+                linkdown-reset = <0x0200 0x100 0x0020 0x00430000 0x0 0x000010000>;
+		*/
+		interrupt-parent = <&MPIC>;
+                interrupts = <30 2>;
+                outb-dmes = <2 0x00000003 1 0x00000001>;
+		enable_ds = <1>;
         };
+
 };
diff --git a/arch/powerpc/boot/dts/acp35xx.dts b/arch/powerpc/boot/dts/acp35xx.dts
index a6686fd..de9c827 100644
--- a/arch/powerpc/boot/dts/acp35xx.dts
+++ b/arch/powerpc/boot/dts/acp35xx.dts
@@ -27,7 +27,7 @@
 		serial0   = &UART0;
 		serial1   = &UART1;
 		ethernet0 = &FEMAC;
-		rapidio0  = &SRIO0;
+		rapidio0  = &rio0;
 	};
 
 	cpus {
@@ -393,14 +393,21 @@
                         0000 0 0 4 &MPIC 55 2
                 >;
         };
-	SRIO0: srio0 {
-		compatible = "acp,rapidio-delta";
+
+        rio0: rapidio@0x2100000000 {
+                index = <0>;
+                status = "okay";
+                #address-cells = <2>;
+                #size-cells = <2>;
+                compatible = "axxia,rapidio-delta";
                 device_type = "rapidio";
-		enabled = <0>;
-		#size = <0>;    /* 0 = (256, small system)
-				 * 1 = (65536, large system) */
-		reg = <0xf0020000 0x20000 0x1000>; /* SRIO Conf region */
+                reg = <0x0020 0x00560000 0x0 0x1000>; /* SRIO Conf 0 region */
+                ranges = <0x0 0x0 0x0021 0x00000000 0x0 0x40000000>;
+                linkdown-reset = <0x0200 0x100 0x0020 0x0040A000 0x0 0x000010000>;
 		interrupt-parent = <&MPIC>;
-		interrupts = <56 0x2 /* NCP_INTR_MPIC_SRC_AXIS_SRIO */>;
-	};
+                interrupts = <56 2>;
+                outb-dmes = <2 0x00000003 1 0x00000001>;
+		enable_ds = <1>;
+        };
+
 };
-- 
1.7.5.4

