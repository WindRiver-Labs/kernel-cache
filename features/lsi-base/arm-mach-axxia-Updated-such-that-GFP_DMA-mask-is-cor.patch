From d653938f6bb6f8e3b5a76ee695e696944e109baa Mon Sep 17 00:00:00 2001
From: SangeethaRao <sangeetha.rao@lsi.com>
Date: Thu, 5 Sep 2013 12:18:14 -0500
Subject: [PATCH 085/159] arm/mach-axxia: Updated such that GFP_DMA mask is
 correctly set to 32 bits for AXM55xx

git.yoctoproject.org/git/linux-yocto-3.10
commit 02df03af53f70764aeee4cfad7ad44dd079a7828 standard/axxia/base.

instead of current 64 bits. Also increased the coherent dma pool size to 1M
instead of existing 256Kb which was leading to error message about DMA coherent
pool being too small with USB support

Signed-off-by: SangeethaRao <sangeetha.rao@lsi.com>
---
 arch/arm/Kconfig            |    1 +
 arch/arm/mach-axxia/axxia.c |    4 ++++
 2 files changed, 5 insertions(+), 0 deletions(-)

diff --git a/arch/arm/Kconfig b/arch/arm/Kconfig
index 66e356f..4fdef59 100644
--- a/arch/arm/Kconfig
+++ b/arch/arm/Kconfig
@@ -362,6 +362,7 @@ config ARCH_AXXIA
 	select ARM_TIMER_SP804
 	select ICST
 	select NEED_MACH_IO_H
+	select ZONE_DMA
 	select PCI
 	select PCI_DOMAINS if PCI
 	select ARCH_SUPPORTS_MSI if PCI
diff --git a/arch/arm/mach-axxia/axxia.c b/arch/arm/mach-axxia/axxia.c
index 5d4f586..cd9d08c 100644
--- a/arch/arm/mach-axxia/axxia.c
+++ b/arch/arm/mach-axxia/axxia.c
@@ -65,6 +65,7 @@ void __init axxia_dt_map_io(void)
 
 void __init axxia_dt_init_early(void)
 {
+	 init_dma_coherent_pool_size(SZ_1M);
 }
 
 static struct of_device_id axxia_irq_match[] __initdata = {
@@ -258,4 +259,7 @@ DT_MACHINE_START(AXXIA_DT, "LSI Axxia")
 	.init_machine	= axxia_dt_init,
 	.handle_irq	= axxia_gic_handle_irq,
 	.restart	= axxia_restart,
+#if defined(CONFIG_ZONE_DMA) && defined(CONFIG_ARM_LPAE)
+ 	.dma_zone_size	= (4ULL * SZ_1G),
+#endif
 MACHINE_END
-- 
1.7.5.4

