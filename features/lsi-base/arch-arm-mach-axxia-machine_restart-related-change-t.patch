From b8e02811e813c554b3e100a03d489e56b529f968 Mon Sep 17 00:00:00 2001
From: Li Wang <li.wang@windriver.com>
Date: Tue, 25 Aug 2015 14:53:07 +0800
Subject: [PATCH 18/68] arch/arm/mach-axxia: machine_restart() related change
 to axxia_restart()

the patch comes from:
git://git.yoctoproject.org/linux-yocto-3.10
commit be9f7663cb4fab1315cab7a1042cd9011e10d910 upstream

Signed-off-by: SangeethaRao <sangeetha.rao@lsi.com>
Signed-off-by: Bruce Ashfield <bruce.ashfield@windriver.com>
Signed-off-by: Li Wang <li.wang@windriver.com>
---
 arch/arm/mach-axxia/axxia.c |    7 +++----
 1 files changed, 3 insertions(+), 4 deletions(-)

diff --git a/arch/arm/mach-axxia/axxia.c b/arch/arm/mach-axxia/axxia.c
index 16689da..08e071f 100644
--- a/arch/arm/mach-axxia/axxia.c
+++ b/arch/arm/mach-axxia/axxia.c
@@ -61,6 +61,8 @@ static const char *axxia_dt_match[] __initconst = {
 	NULL
 };
 
+static void __iomem *base;
+
 #ifdef CONFIG_KEXEC
 
 static void __iomem *dickens;
@@ -199,6 +201,7 @@ static struct notifier_block axxia_amba_nb = {
 
 void __init axxia_dt_init(void)
 {
+	base = ioremap(0x2010000000, 0x40000);
 #ifdef CONFIG_KEXEC
 	if (!of_find_compatible_node(NULL, NULL, "lsi,axm5516-sim")) {
 		dickens = ioremap(0x2000000000, SZ_4M);
@@ -223,10 +226,6 @@ void __init axxia_dt_init(void)
 
 static void axxia_restart(char str, const char *cmd)
 {
-	void __iomem *base;
-
-	base = ioremap(0x2010000000, 0x40000);
-
 	writel(0x000000ab, base + 0x31000); /* Access Key */
 	writel(0x00000040, base + 0x31004); /* Intrnl Boot, 0xffff0000 Target */
 	writel(0x80000000, base + 0x3180c); /* Set ResetReadDone */
-- 
1.7.5.4

