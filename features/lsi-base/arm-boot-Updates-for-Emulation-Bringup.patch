From 4075af9a85dc97c48ea9b1686da6734e474db56f Mon Sep 17 00:00:00 2001
From: John Jacques <john.jacques@lsi.com>
Date: Thu, 28 Mar 2013 08:23:07 -0500
Subject: [PATCH 014/159] arm/boot: Updates for Emulation Bringup.

git.yoctoproject.org/git/linux-yocto-3.10
commit 05b97df2aeb09344541c3a3e8f8343cdee48b6ba standard/axxia/base.

Added exception "handlers" (just loop at an offset).

Added configuration of L2ACTLR and ACTLR (board specific).

Signed-off-by: John Jacques <john.jacques@lsi.com>
Signed-off-by: Paul Butler <paul.butler@windriver.com>
---
 arch/arm/boot/emuboot/emuboot.S |   48 +++++++++++++++++++++++++++++++++++++++
 1 files changed, 48 insertions(+), 0 deletions(-)

diff --git a/arch/arm/boot/emuboot/emuboot.S b/arch/arm/boot/emuboot/emuboot.S
index a71a412..075cf40 100644
--- a/arch/arm/boot/emuboot/emuboot.S
+++ b/arch/arm/boot/emuboot/emuboot.S
@@ -12,6 +12,30 @@
 	.syntax	unified
 	.text
 
+reset_exception:
+	b	_start
+
+undefined_exception:
+	b	undefined_exception
+
+supervisor_exception:
+	b	supervisor_exception
+
+prefetch_abort:
+	b	prefetch_abort
+
+data_abort:
+	b	data_abort
+
+unused_exception:
+	b	unused_exception
+
+irq_exception:
+	b	irq_exception
+
+fiq_exception:
+	b	fiq_exception
+
 	.globl	_start
 _start:
 	@
@@ -31,6 +55,30 @@ _start:
 	ldr	r0, =6250000			@ 6.25 MHz timer frequency
 	mcr	p15, 0, r0, c14, c0, 0		@ CNTFRQ
 1:
+
+	@
+	@ Set the L2ACTLR
+	@
+	mrc	p15, 1, r0, c15, c0, 0		@ L2ACTLR
+	@ Set bit 3 - disable clean/evict push to external
+	orr	r0, r0, #(0x1 << 3)
+	@ Set bit 12 - disable multiple outstanding
+	@ WriteClean/WriteBack/Evicts using same AWID
+	orr	r0, r0, #(0x1 << 12)
+	@ Set bit 13 - disable SharedClean data transfers
+	orr	r0, r0, #(0x1 << 13)
+	@ Set bit 14 - enable UniqueClena evictions with data
+	orr	r0, r0, #(0x1 << 14)
+	mcr	p15, 1, r0, c15, c0, 0
+
+	@
+	@ Set the ACTLR2
+	@
+	mrc	p15, 1, r0, c15, c0, 4
+	@ Set bit 0 - execute data cache clean as data cache clean/invalidate
+	orr	r0, r0, #(0x1 << 0)
+	mcr	p15, 1, r0, c15, c0, 4
+
 	@
 	@ CPU initialisation
 	@
-- 
1.7.5.4

