From 259b3ffbbb987d713fc4292e6d5a36c87d3f8ce4 Mon Sep 17 00:00:00 2001
From: John Jacques <john.jacques@lsi.com>
Date: Wed, 9 Oct 2013 10:16:49 -0500
Subject: [PATCH 120/175] arm/mach-axxia: L3 Cache is not available in simulation!

git.yoctoproject.org/git/linux-yocto-3.10
commit 7215b5f6b666e26d5afdfe3f2114508c2f80c12d standard/axxia/base.

Signed-off-by: John Jacques <john.jacques@lsi.com>
---
 arch/arm/mach-axxia/axxia.c |    4 +++-
 1 files changed, 3 insertions(+), 1 deletions(-)

diff --git a/arch/arm/mach-axxia/axxia.c b/arch/arm/mach-axxia/axxia.c
index 4d3b476..df63dbd 100644
--- a/arch/arm/mach-axxia/axxia.c
+++ b/arch/arm/mach-axxia/axxia.c
@@ -232,7 +232,7 @@ l3_set_pstate(void __iomem *l3ctrl, unsigned int req, unsigned int act)
 
 		if (0 == retries)
 			return -ENODEV;
-
+	}
 
 	return 0;
 }
@@ -243,6 +243,7 @@ void __init axxia_dt_init(void)
 	int rc;
 
 	/* Enable L3-cache */
+#ifndef CONFIG_ARCH_AXXIA_SIM
 	l3ctrl = ioremap(0x2000000000ULL, SZ_4M);
 	if (l3ctrl) {
 		rc = l3_set_pstate(l3ctrl, 0x3, 0xc);
@@ -252,6 +253,7 @@ void __init axxia_dt_init(void)
 	} else {
 		pr_warn("axxia: Failed to map L3-cache control regs\n");
 	}
+#endif
 
 	of_platform_populate(NULL, of_default_bus_match_table,
 			     axxia_auxdata_lookup, NULL);
-- 
1.7.1

