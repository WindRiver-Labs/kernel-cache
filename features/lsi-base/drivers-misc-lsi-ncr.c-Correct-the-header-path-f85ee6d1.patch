From 2e0922c3d2938805b4bb1cecf6cf1daadf284493 Mon Sep 17 00:00:00 2001
From: Li Wang <li.wang@windriver.com>
Date: Thu, 18 May 2017 14:38:31 +0800
Subject: [PATCH 1/7] drivers/misc/lsi-ncr.c: Correct the header path

the patch comes from:
http://git.yoctoproject.org/cgit/cgit.cgi/linux-yocto-3.14/commit/?h=standard/axxia/base&id=eb6c019f112df3abdb9ffbd2175fc8ba2fcebfaa

After the following commit, local library <mach/ncr.h> was removed
in a cleanup effort and it will be use the one from include/linux.
     837f4f4cbe47ee2cd2f54b4c9e0f2623bbb00954
     axxia: Clean Up Axxia NCR Driver

Also remove the references to AXXIA_NCR_RESET_CHECK as long as it's
not used from the following commit:
     6e41280fbeb60c0dd1791cb5eedc6e01bb24273f
     axxia: Remove References to AXXIA_NCR_RESET_CHECK

Signed-off-by: Daniel Dragomir <daniel.dragomir@windriver.com>
Signed-off-by: Li Wang <li.wang@windriver.com>
---
 arch/arm/mach-axxia/axxia.c               |    6 +-----
 arch/arm/mach-axxia/ddr_retention.c       |    9 +--------
 arch/arm/mach-axxia/perf_event_platform.c |    2 +-
 arch/arm/mach-axxia/rapidio.c             |    2 +-
 arch/arm/mach-axxia/smon.c                |    2 +-
 5 files changed, 5 insertions(+), 16 deletions(-)

diff --git a/arch/arm/mach-axxia/axxia.c b/arch/arm/mach-axxia/axxia.c
index b807ed8..12d4a9a 100644
--- a/arch/arm/mach-axxia/axxia.c
+++ b/arch/arm/mach-axxia/axxia.c
@@ -50,7 +50,7 @@
 #include <mach/timers.h>
 #include <mach/axxia-gic.h>
 #include <linux/irqchip/arm-gic.h>
-#include <mach/ncr.h>
+#include <linux/lsi-ncr.h>
 #include "axxia.h"
 #include "pci.h"
 #ifdef CONFIG_AXXIA_RIO
@@ -213,10 +213,6 @@ void __init axxia_dt_init(void)
 	}
 #endif
 
-#ifdef AXXIA_NCR_RESET_CHECK
-	ncr_reset_active = 0;
-#endif
-
 	bus_register_notifier(&platform_bus_type, &axxia_platform_nb);
 	bus_register_notifier(&amba_bustype, &axxia_amba_nb);
 
diff --git a/arch/arm/mach-axxia/ddr_retention.c b/arch/arm/mach-axxia/ddr_retention.c
index b1645b9..d4370aa 100644
--- a/arch/arm/mach-axxia/ddr_retention.c
+++ b/arch/arm/mach-axxia/ddr_retention.c
@@ -31,7 +31,7 @@
 #include <linux/of.h>
 #include <asm/io.h>
 #include <asm/cacheflush.h>
-#include <mach/ncr.h>
+#include <linux/lsi-ncr.h>
 #include "axxia.h"
 
 static void __iomem *nca;
@@ -273,13 +273,6 @@ initiate_retention_reset(void)
 	if (NULL == nca || NULL == apb || NULL == dickens)
 		BUG();
 
-	/*
-	 * If the axxia device is in reset then DDR retention is not
-	 * possible. Just do an emergency_restart instead.
-	 */
-	if (ncr_reset_active)
-		emergency_restart();
-
 	preempt_disable();
 	cpu_id = smp_processor_id();
 
diff --git a/arch/arm/mach-axxia/perf_event_platform.c b/arch/arm/mach-axxia/perf_event_platform.c
index 538fd1a..0210ebd 100644
--- a/arch/arm/mach-axxia/perf_event_platform.c
+++ b/arch/arm/mach-axxia/perf_event_platform.c
@@ -47,7 +47,7 @@
 
 #include <linux/io.h>
 #include <asm/cacheflush.h>
-#include <../../../drivers/misc/lsi-ncr.h>
+#include <linux/lsi-ncr.h>
 
 #include "perf_event_platform.h"
 
diff --git a/arch/arm/mach-axxia/rapidio.c b/arch/arm/mach-axxia/rapidio.c
index 4de8787..58524e8 100644
--- a/arch/arm/mach-axxia/rapidio.c
+++ b/arch/arm/mach-axxia/rapidio.c
@@ -32,7 +32,7 @@
 #include <linux/io.h>
 #include <linux/signal.h>
 
-#include <mach/ncr.h>
+#include <linux/lsi-ncr.h>
 #include <mach/rio.h>
 
 /**
diff --git a/arch/arm/mach-axxia/smon.c b/arch/arm/mach-axxia/smon.c
index 313a3ce..16bf413 100644
--- a/arch/arm/mach-axxia/smon.c
+++ b/arch/arm/mach-axxia/smon.c
@@ -22,7 +22,7 @@
  */
 #include <linux/io.h>
 
-#include <../../../drivers/misc/lsi-ncr.h>
+#include <linux/lsi-ncr.h>
 
 #include "smon.h"
 
-- 
1.7.5.4

