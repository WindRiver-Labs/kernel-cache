From 997b3cd4963f7e87a9b4f8802fb5f6d85aa63e0b Mon Sep 17 00:00:00 2001
From: David Mercado <david.mercado@windriver.com>
Date: Tue, 19 Nov 2013 18:22:42 -0500
Subject: [PATCH 137/159] LSI AXM55XX: Disable use of wfe/sev in arch spinlock

git.yoctoproject.org/git/linux-yocto-3.10
commit 664b3272f313c7c87ad5cd08ed5b6196e0b7e671 standard/axxia/base.

Disable use of wfe/sev in arch-specific spinlock routines for AXM55xx.
The propagation of sev between clusters is not currently enabled on
this platform.

Signed-off-by: David Mercado <david.mercado@windriver.com>
---
 arch/arm/include/asm/spinlock.h |    5 +++++
 1 files changed, 5 insertions(+), 0 deletions(-)

diff --git a/arch/arm/include/asm/spinlock.h b/arch/arm/include/asm/spinlock.h
index 6220e9f..38d6e27 100644
--- a/arch/arm/include/asm/spinlock.h
+++ b/arch/arm/include/asm/spinlock.h
@@ -37,6 +37,9 @@
 						\
 	"nop.w"					\
 )
+#elif CONFIG_ARCH_AXXIA || CONFIG_ARCH_AXXIA_SIM
+#define SEV
+#define WFE(cond)
 #else
 #define SEV		ALT_SMP("sev", "nop")
 #define WFE(cond)	ALT_SMP("wfe" cond, "nop")
@@ -88,7 +91,9 @@ static inline void arch_spin_lock(arch_spinlock_t *lock)
 	: "cc");
 
 	while (lockval.tickets.next != lockval.tickets.owner) {
+#if !CONFIG_ARCH_AXXIA && !CONFIG_ARCH_AXXIA_SIM
 		wfe();
+#endif
 		lockval.tickets.owner = ACCESS_ONCE(lock->tickets.owner);
 	}
 
-- 
1.7.5.4

