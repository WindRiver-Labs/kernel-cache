From 06a4b04732cbfb1c0a5ca36ae1334d99a7b07b22 Mon Sep 17 00:00:00 2001
From: Li Wang <li.wang@windriver.com>
Date: Tue, 25 Aug 2015 19:18:26 +0800
Subject: [PATCH 44/68] tty: serial: Updated Baud Rate Calcualtion

the patch comes from:
git://git.yoctoproject.org/linux-yocto-3.10
commit 5e108f9fee66f5cb3131f71b7c8990383fb5f51f upstream

The baud rate calculation was truncating instead of rounding. This
caused, in some cases, the initial baud rate to be set incorrectly.

Updated to use DIV_ROUND_CLOSEST().

Signed-off-by: John Jacques <john.jacques@lsi.com>
Signed-off-by: Bruce Ashfield <bruce.ashfield@windriver.com>
Signed-off-by: Li Wang <li.wang@windriver.com>
---
 drivers/tty/serial/amba-pl011.c |    3 ++-
 1 files changed, 2 insertions(+), 1 deletions(-)

diff --git a/drivers/tty/serial/amba-pl011.c b/drivers/tty/serial/amba-pl011.c
index 22688bf..2d9c831 100644
--- a/drivers/tty/serial/amba-pl011.c
+++ b/drivers/tty/serial/amba-pl011.c
@@ -1991,7 +1991,8 @@ pl011_console_get_options(struct uart_amba_port *uap, int *baud,
 		ibrd = readw(uap->port.membase + UART011_IBRD);
 		fbrd = readw(uap->port.membase + UART011_FBRD);
 
-		*baud = uap->port.uartclk * 4 / (64 * ibrd + fbrd);
+		*baud = DIV_ROUND_CLOSEST(uap->port.uartclk * 4,
+					  64 * ibrd + fbrd);
 
 		if (uap->vendor->oversampling) {
 			if (readw(uap->port.membase + UART011_CR)
-- 
1.7.5.4

