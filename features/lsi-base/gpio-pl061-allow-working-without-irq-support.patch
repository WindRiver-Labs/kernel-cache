From 9fbb3ec33290ac5c34030303f460d1ff10fb95eb Mon Sep 17 00:00:00 2001
From: Jiang Lu <lu.jiang@windriver.com>
Date: Wed, 18 Dec 2013 09:39:59 +0000
Subject: [PATCH 7/9] gpio:pl061:allow working without irq support

Allow pl061 driver working without irq support.

Signed-off-by: Jiang Lu <lu.jiang@windriver.com>
---
 drivers/gpio/gpio-pl061.c |   13 +++++++------
 1 files changed, 7 insertions(+), 6 deletions(-)

diff --git a/drivers/gpio/gpio-pl061.c b/drivers/gpio/gpio-pl061.c
index 0c33c42..4ca8b9a 100644
--- a/drivers/gpio/gpio-pl061.c
+++ b/drivers/gpio/gpio-pl061.c
@@ -283,8 +283,6 @@ static int pl061_probe(struct device *dev,
 	if (pdata) {
 		chip->gc.base = pdata->gpio_base;
 		irq_base = pdata->irq_base;
-		if (irq_base <= 0)
-			return -ENODEV;
 	} else if (dev->of_node) {
 		chip->gc.base = -1;
 		irq_base = 0;
@@ -308,11 +306,12 @@ static int pl061_probe(struct device *dev,
 			*retchip = NULL;
 		return -ENOMEM;
 	}
-
-	chip->domain = irq_domain_add_simple(dev->of_node, PL061_GPIO_NR,
+	if (irq_base > 0) {
+		chip->domain = irq_domain_add_simple(dev->of_node, PL061_GPIO_NR,
 					     irq_base, &pl061_domain_ops, chip);
-	if (!chip->domain)
-		return -ENODEV;
+		if (!chip->domain)
+			return -ENODEV;
+	}
 
 	spin_lock_init(&chip->lock);
 
@@ -341,6 +340,8 @@ static int pl061_probe(struct device *dev,
 	/*
 	 * irq_chip support
 	 */
+	if (irq_base <= 0)
+		return 0;
 	writeb(0, chip->base + GPIOIE); /* disable irqs */
 	if (irq < 0) {
 		if (retchip)
-- 
1.7.5.4

