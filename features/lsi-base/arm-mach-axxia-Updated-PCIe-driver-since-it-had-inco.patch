From da5aaf49eb0b47cf730ac7a769d33f16feae1b66 Mon Sep 17 00:00:00 2001
From: SangeethaRao <sangeetha.rao@lsi.com>
Date: Tue, 17 Sep 2013 18:09:01 -0500
Subject: [PATCH 104/159] arm/mach-axxia: Updated PCIe driver since it had
 incorrect PEI log info

git.yoctoproject.org/git/linux-yocto-3.10
commit c3c974188c022b810b5cf517565124291dcf3b40 standard/axxia/base.

and also updated DTS with correct PCIe address for PEI0/PEI1

Signed-off-by: SangeethaRao <sangeetha.rao@lsi.com>
---
 arch/arm/boot/dts/axm55xx.dts |    4 ++--
 arch/arm/mach-axxia/pci.c     |    2 +-
 2 files changed, 3 insertions(+), 3 deletions(-)

diff --git a/arch/arm/boot/dts/axm55xx.dts b/arch/arm/boot/dts/axm55xx.dts
index 14d2470..aac791d 100644
--- a/arch/arm/boot/dts/axm55xx.dts
+++ b/arch/arm/boot/dts/axm55xx.dts
@@ -259,7 +259,7 @@
                 0x20 0x20120000 0x0 0x00008000 >;
                 /* Outbound ranges */
                 /* < <3-cell PCI addr> <2-cell CPU (PLB) addr> <2-cell size> >*/
-                ranges = <0x03000000 0x00000000 0xa0000000
+                ranges = <0x03000000 0x00000000 0x80000000
                           0x30 0x00000000
                           0x00 0x20000000>;
                 /* Inbound ranges */
@@ -299,7 +299,7 @@
                        0x20 0x20130000 0x0 0x00008000 >;
                 /* Outbound ranges */
                 /* < <3-cell PCI addr> <2-cell CPU (PLB) addr> <2-cell size> > */
-                ranges = <0x03000000 0x00000000 0xa0000000
+                ranges = <0x03000000 0x00000000 0xc0000000
                           0x30 0x80000000
                           0x00 0x20000000>;
                 /* Inbound ranges */
diff --git a/arch/arm/mach-axxia/pci.c b/arch/arm/mach-axxia/pci.c
index 97488f3..b0ddab6 100644
--- a/arch/arm/mach-axxia/pci.c
+++ b/arch/arm/mach-axxia/pci.c
@@ -622,7 +622,7 @@ static int axxia_pcie_setup(int portno, struct pci_sys_data *sys)
 
 	/* make sure the ACP device is configured as PCI Root Complex */
 	if ((pci_status & 0x18) != 0x18) {
-		pr_err("PCIE%d: Device is not Root Complex\n", portno);
+		pr_err("PCIE%d: Device is not Root Complex\n", port->index);
 		goto fail;
 	}
 
-- 
1.7.5.4

