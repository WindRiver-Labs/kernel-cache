From f4e996619bf1f5234937fe319135eade5628a85d Mon Sep 17 00:00:00 2001
From: Brian Cavagnolo <brian@cozybit.com>
Date: Mon, 22 Sep 2008 14:43:06 -0700
Subject: [PATCH] ftrace: make number of saved command lines a config variable

128 saved command lines is not enough when profiling highly active periods,
like userspace initialization.

Signed-off-by: Brian Cavagnolo <brian@cozybit.com>
Signed-off-by: Bruce Ashfield <bruce.ashfield@windriver.com>

---
 kernel/trace/Kconfig |   10 ++++++++++
 kernel/trace/trace.c |    2 +-
 2 files changed, 11 insertions(+), 1 deletions(-)

diff --git a/kernel/trace/Kconfig b/kernel/trace/Kconfig
index 5f87b81..c868726 100644
--- a/kernel/trace/Kconfig
+++ b/kernel/trace/Kconfig
@@ -143,3 +143,13 @@ config FTRACE_STARTUP_TEST
 	  a series of tests are made to verify that the tracer is
 	  functioning properly. It will do tests on all the configured
 	  tracers of ftrace.
+
+config TRACE_SAVED_CMDLINES
+	int "Set max number of traced command lines"
+	default 128
+	depends on TRACING
+	help
+	  When tracing context switches, ftrace stores the names of the command
+	  lines.  By default, it saves up to 128 command lines.  For traces in
+	  which many processes are spawned, such as the userspace init, this may be
+	  insufficient.  Tune this number if necessary.
diff --git a/kernel/trace/trace.c b/kernel/trace/trace.c
index 8f3fb3d..dcff179 100644
--- a/kernel/trace/trace.c
+++ b/kernel/trace/trace.c
@@ -662,7 +662,7 @@ void tracing_reset(struct trace_array_cpu *data)
 	data->trace_tail_idx = 0;
 }
 
-#define SAVED_CMDLINES 128
+#define SAVED_CMDLINES CONFIG_TRACE_SAVED_CMDLINES
 static unsigned map_pid_to_cmdline[PID_MAX_DEFAULT+1];
 static unsigned map_cmdline_to_pid[SAVED_CMDLINES];
 static char saved_cmdlines[SAVED_CMDLINES][TASK_COMM_LEN];
-- 
1.5.5.1

