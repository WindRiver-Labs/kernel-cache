From: Liming Wang <liming.wang@windriver.com>
Subject: ftrace: make early trace depend on !dynamic_ftrace

When enable dynamic ftrace, early trace can't trace all init
function for "notrace" attribute. Because early trace shouldn't
co-exist with dynamic ftrace, we remove "notrace" when enable
dynamic ftrace.

Signed-off-by: Liming Wang <liming.wang@windriver.com>
---
 include/linux/init.h |    4 ++++
 kernel/trace/Kconfig |    2 +-
 2 files changed, 5 insertions(+), 1 deletions(-)

diff --git a/include/linux/init.h b/include/linux/init.h
index 27f61f6..38c811c 100644
--- a/include/linux/init.h
+++ b/include/linux/init.h
@@ -40,7 +40,11 @@
 
 /* These are for everybody (although not all archs will actually
    discard it in modules) */
+#ifdef CONFIG_DYNAMIC_FTRACE
 #define __init		__section(.init.text) __cold notrace
+#else
+#define __init		__section(.init.text) __cold
+#endif
 #define __initdata	__section(.init.data)
 #define __initconst	__section(.init.rodata)
 #define __exitdata	__section(.exit.data)
diff --git a/kernel/trace/Kconfig b/kernel/trace/Kconfig
index d21ab42..489555b 100644
--- a/kernel/trace/Kconfig
+++ b/kernel/trace/Kconfig
@@ -144,7 +144,7 @@ config DYNAMIC_FTRACE
 config FTRACE_EARLY
 	bool "Early tracing (Experimental)"
 	default n
-	depends on HAVE_FTRACE
+	depends on HAVE_FTRACE && !DYNAMIC_FTRACE
 	select TRACING
 	help
 	  This option enables static tracing of the early boot sequence.
