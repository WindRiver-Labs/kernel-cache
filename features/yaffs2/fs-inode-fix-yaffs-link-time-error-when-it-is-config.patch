From 0561a5dfd27da0b8e4df3579a683e12c100b5907 Mon Sep 17 00:00:00 2001
From: Wenlin Kang <wenlin.kang@windriver.com>
Date: Thu, 15 Jan 2015 10:20:33 +0800
Subject: [PATCH] fs/inode: fix yaffs link time error when it is configured as
 module

This issue was introduced by "Yaffs: fix softlockup cauesed by inode
deleted when scanning s_inodes list",the error information is the follow:

|   LD [M]  fs/yaffs2/yaffs.o
|   Building modules, stage 2.
|   MODPOST 179 modules
| ERROR: "__iget" [fs/yaffs2/yaffs.ko] undefined!
| ERROR: "inode_sb_list_lock" [fs/yaffs2/yaffs.ko] undefined!
| make[3]: *** [__modpost] Error 1
| make[2]: *** [modules] Error 2
| make[1]: *** [sub-make] Error 2
| make: *** [all] Error 2
| ERROR: oe_runmake failed

The cause is that it used symbol "__iget" and "inode_sb_list_lock" which
aren't exported by linux kernel, to fix this issue, we export them.

Signed-off-by: Wenlin Kang <wenlin.kang@windriver.com>
---
 fs/inode.c |    2 ++
 1 files changed, 2 insertions(+), 0 deletions(-)

diff --git a/fs/inode.c b/fs/inode.c
index 9be9630..25940d0 100644
--- a/fs/inode.c
+++ b/fs/inode.c
@@ -56,6 +56,7 @@ static struct hlist_head *inode_hashtable __read_mostly;
 static __cacheline_aligned_in_smp DEFINE_SPINLOCK(inode_hash_lock);
 
 __cacheline_aligned_in_smp DEFINE_SPINLOCK(inode_sb_list_lock);
+EXPORT_SYMBOL_GPL(inode_sb_list_lock);
 
 /*
  * Empty aops. Can be used for the cases where the user does not
@@ -387,6 +388,7 @@ void __iget(struct inode *inode)
 {
 	atomic_inc(&inode->i_count);
 }
+EXPORT_SYMBOL_GPL(__iget);
 
 /*
  * get additional reference to inode; caller must already hold one.
-- 
1.7.5.4

