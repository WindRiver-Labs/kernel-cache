From a8880414840bcfa0494b69c7d583f04a3d9a7835 Mon Sep 17 00:00:00 2001
From: Zhang Xiao <xiao.zhang@windriver.com>
Date: Mon, 25 Aug 2014 10:12:02 +0800
Subject: [PATCH] yaffs: Avoid setting any ACL releated xattr

YAFFS doesn't sopport ACL yet, it must refuse any related settings.

Signed-off-by: Zhang Xiao <xiao.zhang@windriver.com>
---
 fs/yaffs2/yaffs_vfs.c |   10 +++++++++-
 1 files changed, 9 insertions(+), 1 deletions(-)

diff --git a/fs/yaffs2/yaffs_vfs.c b/fs/yaffs2/yaffs_vfs.c
index f564652..a98be55 100644
--- a/fs/yaffs2/yaffs_vfs.c
+++ b/fs/yaffs2/yaffs_vfs.c
@@ -559,11 +559,19 @@ static int yaffs_setxattr(struct dentry *dentry, const char *name,
 
 	yaffs_trace(YAFFS_TRACE_OS, "yaffs_setxattr of object %d", obj->obj_id);
 
+	/* Currently we don't support posix ACL so never accept any settings
+	 * start with "system.posix_acl_".
+	 */
+	if (strncmp(name, "system.posix_acl_", 17)) {
+		error = -EOPNOTSUPP;
+		goto out;
+	}
+
 	dev = obj->my_dev;
 	yaffs_gross_lock(dev);
 	error = yaffs_set_xattrib(obj, name, value, size, flags);
 	yaffs_gross_unlock(dev);
-
+out:
 	yaffs_trace(YAFFS_TRACE_OS, "yaffs_setxattr done returning %d", error);
 
 	return error;
-- 
1.7.5.4

