From 45f8e9f07b54829740822df33d66441c597b9460 Mon Sep 17 00:00:00 2001
From: Zhang Xiao <xiao.zhang@windriver.com>
Date: Mon, 25 Aug 2014 10:28:21 +0800
Subject: [PATCH] yaffs: Avoid setting any ACL releated xattr

YAFFS doesn't sopport ACL yet, it must refuse any related settings.

Signed-off-by: Zhang Xiao <xiao.zhang@windriver.com>
---
 fs/yaffs2/yaffs_vfs.c |    6 ++++++
 1 files changed, 6 insertions(+), 0 deletions(-)

diff --git a/fs/yaffs2/yaffs_vfs.c b/fs/yaffs2/yaffs_vfs.c
index c3b7368..6893f7b 100644
--- a/fs/yaffs2/yaffs_vfs.c
+++ b/fs/yaffs2/yaffs_vfs.c
@@ -931,6 +931,12 @@ static int yaffs_setxattr(struct dentry *dentry, const char *name,
 
 	yaffs_trace(YAFFS_TRACE_OS, "yaffs_setxattr of object %d", obj->obj_id);
 
+	/* Currently we don't support posix ACL so never accept any settings
+	 * start with "system.posix_acl_".
+	 */
+	if (strncmp(name, "system.posix_acl_", 17))
+		error = -EOPNOTSUPP;
+
 	if (error == 0) {
 		int result;
 		dev = obj->my_dev;
-- 
1.7.5.4

