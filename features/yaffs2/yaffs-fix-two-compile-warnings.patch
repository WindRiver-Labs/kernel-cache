From e4e81bfa3b533c133d2d7909dae7f1fc2de503e1 Mon Sep 17 00:00:00 2001
From: Yanjiang Jin <yanjiang.jin@windriver.com>
Date: Fri, 3 Apr 2015 15:49:00 +0800
Subject: [PATCH] yaffs: fix two compile warnings

The warnings are shown below:

fs/yaffs2/yaffs_vfs.c: In function 'yaffs_do_sync_fs':
include/linux/list.h:22:2: warning: ISO C90 forbids mixed declarations and code [-Wdeclaration-after-statement]
  struct list_head name = LIST_HEAD_INIT(name)
  ^
fs/yaffs2/yaffs_vfs.c:2627:2: note: in expansion of macro 'LIST_HEAD'
  LIST_HEAD(delayed_iput_list);
  ^

Signed-off-by: Yanjiang Jin <yanjiang.jin@windriver.com>
---
 fs/yaffs2/yaffs_vfs.c |    4 ++--
 1 files changed, 2 insertions(+), 2 deletions(-)

diff --git a/fs/yaffs2/yaffs_vfs.c b/fs/yaffs2/yaffs_vfs.c
index 8b4777e..c32770b 100644
--- a/fs/yaffs2/yaffs_vfs.c
+++ b/fs/yaffs2/yaffs_vfs.c
@@ -2307,6 +2307,7 @@ struct mutex yaffs_context_lock;
 
 static void yaffs_put_super(struct super_block *sb)
 {
+	LIST_HEAD(delayed_iput_list);
 	struct yaffs_dev *dev = yaffs_super_to_dev(sb);
 	struct mtd_info *mtd = yaffs_dev_to_mtd(dev);
 
@@ -2319,7 +2320,6 @@ static void yaffs_put_super(struct super_block *sb)
 	yaffs_trace(YAFFS_TRACE_OS | YAFFS_TRACE_BACKGROUND,
 		"yaffs background thread shut down");
 
-	LIST_HEAD(delayed_iput_list);
 	yaffs_gross_lock(dev);
 
 	yaffs_flush_super(sb, 1, &delayed_iput_list); 
@@ -2611,6 +2611,7 @@ static int yaffs_statfs(struct super_block *sb, struct statfs *buf)
 static int yaffs_do_sync_fs(struct super_block *sb, int request_checkpoint)
 {
 
+	LIST_HEAD(delayed_iput_list);
 	struct yaffs_dev *dev = yaffs_super_to_dev(sb);
 	unsigned int oneshot_checkpoint = (yaffs_auto_checkpoint & 4);
 	unsigned gc_urgent = yaffs_bg_gc_urgency(dev);
@@ -2624,7 +2625,6 @@ static int yaffs_do_sync_fs(struct super_block *sb, int request_checkpoint)
 		request_checkpoint ? "checkpoint requested" : "no checkpoint",
 		oneshot_checkpoint ? " one-shot" : "");
 
-	LIST_HEAD(delayed_iput_list);
 	yaffs_gross_lock(dev);
 	do_checkpoint = ((request_checkpoint && !gc_urgent) ||
 			 oneshot_checkpoint) && !dev->is_checkpointed;
-- 
1.7.5.4

