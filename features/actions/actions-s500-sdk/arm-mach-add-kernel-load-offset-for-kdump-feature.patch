From e037b71d3b15c78d27068e00c41a0d6b3f666f10 Mon Sep 17 00:00:00 2001
From: Limeng <Meng.Li@windriver.com>
Date: Thu, 3 Nov 2016 18:42:05 +0800
Subject: [PATCH 2/2] arm: mach: add kernel load offset for kdump feature

add a configure OWL_LOAD_OFFSET for setting kernel load address.
To generate the second kernel, please set OWL_LOAD_OFFSET, which
value is equal to the value of crashkernel parameter, and then compile
the whole kernel again.

Signed-off-by: Meng Li <Meng.Li@windriver.com>
---
 arch/arm/mach-owl/Kconfig       |    5 +++++
 arch/arm/mach-owl/Makefile.boot |    6 +++---
 2 files changed, 8 insertions(+), 3 deletions(-)

diff --git a/arch/arm/mach-owl/Kconfig b/arch/arm/mach-owl/Kconfig
index 4ffa728..bacf10b 100755
--- a/arch/arm/mach-owl/Kconfig
+++ b/arch/arm/mach-owl/Kconfig
@@ -27,6 +27,11 @@ config MACH_OWL
 
 endchoice
 
+config OWL_LOAD_OFFSET
+	hex "kernel load address offset"
+	depends on ARCH_OWL
+	default 0x00000000
+
 config OWL_DEBUG_IRQ_STACK
 	boolean "Enable Actions irq stack debugger"
 	depends on ARCH_OWL
diff --git a/arch/arm/mach-owl/Makefile.boot b/arch/arm/mach-owl/Makefile.boot
index ff0a4b5..32cf7ed 100755
--- a/arch/arm/mach-owl/Makefile.boot
+++ b/arch/arm/mach-owl/Makefile.boot
@@ -1,4 +1,4 @@
-   zreladdr-y	+= 0x00008000
-params_phys-y	:= 0x00000100
-initrd_phys-y	:= 0x00800000
+   zreladdr-y	+= $(shell printf "0x%x" $$(( ${CONFIG_KERNEL_LOAD_OFFSET} + 0x00008000 )) )
+params_phys-y	:= $(shell printf "0x%x" $$(( ${CONFIG_KERNEL_LOAD_OFFSET} + 0x00000100 )) )
+initrd_phys-y	:= $(shell printf "0x%x" $$(( ${CONFIG_KERNEL_LOAD_OFFSET} + 0x00800000 )) )
 
-- 
1.7.5.4

