From 93f9bc9c33ba432704c884b0d78e265ef640d296 Mon Sep 17 00:00:00 2001
From: =?UTF-8?q?=E8=B0=A2=E5=8F=8C=E5=8F=8C?= <xieshsh@srv-pad-compile2.actions.com.cn>
Date: Fri, 11 Dec 2015 15:57:57 +0800
Subject: [PATCH 34/62] display: lcd: add lcd 1024x600 for lemaker board

commit c8247de40862e7f0f149eb89363a56d190707192 from
https://github.com/xapp-le/kernel.git

Change-Id: Ice1ac9a043be4747826151b67ca705c5f3ed2452
---
 arch/arm/boot/dts/actduino_lemaker_guitar.dts  |   16 ++++++++--------
 drivers/video/fbdev/owl/displays/lcdc/lcdchw.c |    3 ++-
 2 files changed, 10 insertions(+), 9 deletions(-)

diff --git a/arch/arm/boot/dts/actduino_lemaker_guitar.dts b/arch/arm/boot/dts/actduino_lemaker_guitar.dts
index c6618c6..0257af8 100755
--- a/arch/arm/boot/dts/actduino_lemaker_guitar.dts
+++ b/arch/arm/boot/dts/actduino_lemaker_guitar.dts
@@ -1109,13 +1109,13 @@ lcd0: lcd0@b02a0000 {
 			xres = <1024>;
 			yres = <600>;
 			/*in pico second, 0.000 000 000 001s*/
-			pixclock = <20000>;
-			left_margin = <56>;
-			right_margin = <60>;
-			upper_margin = <13>;
-			lower_margin = <18>;
-			hsync_len = <4>;
-			vsync_len = <4>;
+			pixclock = <18348>;
+			left_margin = <100>;
+			right_margin = <100>;
+			upper_margin = <30>;
+			lower_margin = <30>;
+			hsync_len = <120>;
+			vsync_len = <30>;
 			/*0: FB_VMODE_NONINTERLACED, 1:FB_VMODE_INTERLACED*/
 			vmode = <0>;
 		};
@@ -1176,7 +1176,7 @@ lcd0: lcd0@b02a0000 {
 		/*1.pwm num; 2. period in ns; */
 		/*3.plarity, 0: high active, 1: low active*/
 		//backlight_en_gpios = <&gpio 124 0>; /*S500 GPIOD28*/ 
-		pwms = <&pwm 0 50000 1>;
+		pwms = <&pwm 0 50000 0>;
 		total_steps = <1024>;
 		min_brightness = <250>;
 		max_brightness = <1000>;
diff --git a/drivers/video/fbdev/owl/displays/lcdc/lcdchw.c b/drivers/video/fbdev/owl/displays/lcdc/lcdchw.c
index c550cb8..1138d8d 100755
--- a/drivers/video/fbdev/owl/displays/lcdc/lcdchw.c
+++ b/drivers/video/fbdev/owl/displays/lcdc/lcdchw.c
@@ -36,6 +36,7 @@
 #include <linux/slab.h>
 #include <linux/of.h>
 #include <linux/of_gpio.h>
+#include <linux/fb.h>
 
 #include <mach/hardware.h>
 
@@ -600,7 +601,7 @@ void owl_lcdc_select_video_timings(struct owl_dss_device *dssdev, u32 num,
 
     timings->x_res          = mode->xres;
     timings->y_res          = mode->yres;
-    timings->pixel_clock    = mode->pixclock;
+    timings->pixel_clock    = PICOS2KHZ(mode->pixclock);
     timings->hfp            = mode->left_margin;
     timings->hbp            = mode->right_margin;
     timings->vfp            = mode->upper_margin;
-- 
1.7.5.4

