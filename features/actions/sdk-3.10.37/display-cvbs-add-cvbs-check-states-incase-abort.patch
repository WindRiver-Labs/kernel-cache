From ad3b51bc6c1dc44434c566dae0253393a0c27691 Mon Sep 17 00:00:00 2001
From: =?UTF-8?q?=E8=B0=A2=E5=8F=8C=E5=8F=8C?= <xieshsh@srv-pad-compile2.actions.com.cn>
Date: Wed, 30 Dec 2015 21:20:05 +0800
Subject: [PATCH 54/62] display: cvbs: add cvbs check states incase abort

commit 28e5aa8d328053a2b33cb3796f6c69fde0a46500 from
https://github.com/xapp-le/kernel.git

Change-Id: Ic5cdd6d68eda3c7af577e99953840b48b00b35e2
---
 drivers/video/fbdev/owl/displays/cvbs/cvbs.c |   15 ++++++++++++++-
 1 files changed, 14 insertions(+), 1 deletions(-)

diff --git a/drivers/video/fbdev/owl/displays/cvbs/cvbs.c b/drivers/video/fbdev/owl/displays/cvbs/cvbs.c
index b8a6074..36928b3 100755
--- a/drivers/video/fbdev/owl/displays/cvbs/cvbs.c
+++ b/drivers/video/fbdev/owl/displays/cvbs/cvbs.c
@@ -338,8 +338,21 @@ static void cvbs_check_status (struct work_struct *work)
 		auto_detect_bit(CVBS_IN);
 		cvbs_irq_enable(CVBS_IN,true);
 	}
+	
 
-
+	if(cvbs_read_reg( TVOUT_EN) && cvbs_state ==CVBS_IN )
+	{
+			set_cvbs_status(&cdev, 1);
+			DEBUG_CVBS("set_cvbs_status is IN");
+	}
+	if(!(cvbs_read_reg( TVOUT_EN)) && cvbs_state ==CVBS_OUT )
+	{
+			set_cvbs_status(&cdev, 0);
+			DEBUG_CVBS("set_cvbs_status is OUT");
+	}
+		
+	queue_delayed_work(cvbs.wq, &cvbs_check_work,
+				msecs_to_jiffies(2000));
 }
 
 
-- 
1.7.5.4

