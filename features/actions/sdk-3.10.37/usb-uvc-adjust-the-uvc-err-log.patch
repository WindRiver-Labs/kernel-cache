From b0657b094fc2594468e8d265a9040e57f621c897 Mon Sep 17 00:00:00 2001
From: liyuan <liyuan@actions-semi.com>
Date: Mon, 28 Dec 2015 13:37:10 +0800
Subject: [PATCH 50/62] usb: uvc: adjust the uvc err log

commit acc4ad03ef243ab9d1868cb1be1e0daf318cf4ef from
https://github.com/xapp-le/kernel.git

Change-Id: I0d5bf33fb2196abcbf4ca9654ff257d4d184b117
---
 drivers/media/usb/uvc/uvc_queue.c |    2 ++
 drivers/media/usb/uvc/uvc_video.c |    5 -----
 2 files changed, 2 insertions(+), 5 deletions(-)

diff --git a/drivers/media/usb/uvc/uvc_queue.c b/drivers/media/usb/uvc/uvc_queue.c
index e8693e5..9678d33 100755
--- a/drivers/media/usb/uvc/uvc_queue.c
+++ b/drivers/media/usb/uvc/uvc_queue.c
@@ -482,6 +482,8 @@ struct uvc_buffer *uvc_queue_next_buffer(struct uvc_video_queue *queue,
 	      queue->framestodrop > 0) {
 		if(queue->framestodrop > 0)
 			queue->framestodrop--;
+		if(buf->error)
+		    uvc_trace(UVC_TRACE_FRAME_ERR, "## Frame Error dropped. errno:%d, buf:%p\n",buf->error,buf);
 		queue->framesdropped++;
 		buf->error = 0;
 		buf->state = UVC_BUF_STATE_QUEUED;
diff --git a/drivers/media/usb/uvc/uvc_video.c b/drivers/media/usb/uvc/uvc_video.c
index b561a9b..3763d7d 100755
--- a/drivers/media/usb/uvc/uvc_video.c
+++ b/drivers/media/usb/uvc/uvc_video.c
@@ -1009,7 +1009,6 @@ static int uvc_video_decode_start(struct uvc_streaming *stream,
 			  "set).\n");
 		/*added for one frame split to two parts, or one frame with err data problems, ActionsCode(author:liyuan, change_code)*/	  
 		buf->error = UVC_BUF_ERR_ISOFRAM_ERR;
-		uvc_trace(UVC_TRACE_FRAME_ERR, "## USB isochronous frame err .\n");
 	}
 
 	/* Synchronize to the input stream by waiting for the FID bit to be
@@ -1067,7 +1066,6 @@ static int uvc_video_decode_start(struct uvc_streaming *stream,
 		if((buf->bytesused != buf->length) &&
 		   !(stream->cur_format->flags & UVC_FMT_FLAG_COMPRESSED)){
 			buf->error = UVC_BUF_ERR_NOTFULL;
-			uvc_trace(UVC_TRACE_FRAME_ERR, "## Frame complete (not full).\n");
 		}
 		return -EAGAIN;
 	}
@@ -1100,7 +1098,6 @@ static void uvc_video_decode_data(struct uvc_streaming *stream,
 
 	/* Complete the current frame if the buffer size was exceeded. */
 	if (len > maxlen) {
-		uvc_trace(UVC_TRACE_FRAME_ERR, "## Frame complete (overflow).\n");
 		buf->state = UVC_BUF_STATE_READY;
 		/*added for one frame split to two parts, or one frame with err data problems, ActionsCode(author:liyuan, change_code)*/
 		buf->error = UVC_BUF_ERR_OVERFLOW;
@@ -1174,7 +1171,6 @@ static void uvc_video_validate_buffer(const struct uvc_streaming *stream,
 	    !(stream->cur_format->flags & UVC_FMT_FLAG_COMPRESSED)) {
 		/*added for one frame split to two parts, or one frame with err data problems, ActionsCode(author:liyuan, change_code)*/  
 		buf->error = UVC_BUF_ERR_NOTFULL;
-		uvc_trace(UVC_TRACE_FRAME_ERR, "## Frame complete (not full).\n");
 	}
 }
 
@@ -1195,7 +1191,6 @@ static void uvc_video_decode_isoc(struct urb *urb, struct uvc_streaming *stream,
 			if (buf != NULL){
 			        /*added for one frame split to two parts, or one frame with err data problems, ActionsCode(author:liyuan, change_code)*/
 				buf->error = UVC_BUF_ERR_ISOFRAM_LOST;
-				uvc_trace(UVC_TRACE_FRAME_ERR, "## USB isochronous frame lost .\n");
 			}
 			continue;
 		}
-- 
1.7.5.4

