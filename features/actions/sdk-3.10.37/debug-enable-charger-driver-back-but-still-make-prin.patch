From cb900b9e32c8619491dc30cab1018b88147b93eb Mon Sep 17 00:00:00 2001
From: Yixun Lan <yixun.lan@gmail.com>
Date: Fri, 14 Aug 2015 13:29:10 +0000
Subject: [PATCH 30/62] debug: enable charger driver back, but still make
 print info quiet

commit c9b34fbfa5ea9881be657302e73fc0351720afe1 from
https://github.com/xapp-le/kernel.git

this is follow-up patch with 68d6bebc2b743f753008d5765895360a623e0076
instead of disable CONFIG_CHARGER_DRV_ATC206X, we still enable it back
since it's the default option from upstream,
though we use printk_ratelimited to limite printk info

Signed-off-by: Yixun Lan <yixun.lan@gmail.com>
---
 drivers/power/atc260x_power/atc260x_power_main.c |    1 +
 drivers/usb/monitor/umonitor_hal.c               |    2 ++
 2 files changed, 3 insertions(+), 0 deletions(-)

diff --git a/drivers/power/atc260x_power/atc260x_power_main.c b/drivers/power/atc260x_power/atc260x_power_main.c
index 823bc86..300bf53 100755
--- a/drivers/power/atc260x_power/atc260x_power_main.c
+++ b/drivers/power/atc260x_power/atc260x_power_main.c
@@ -1052,6 +1052,7 @@ static void update_battery_state(struct atc260x_charger *charger)
 		charger->bat_mv = data;
 	}else{
 		/*pr_info("we do not get bat_mv from gauge\n");*/
+		pr_warn_once("we do not get bat_mv from gauge\n");
 		charger->bat_mv = charger->read_adc(charger->atc260x, "BATV");
 	}
 
diff --git a/drivers/usb/monitor/umonitor_hal.c b/drivers/usb/monitor/umonitor_hal.c
index b170509..9f9aa3d 100755
--- a/drivers/usb/monitor/umonitor_hal.c
+++ b/drivers/usb/monitor/umonitor_hal.c
@@ -66,11 +66,13 @@ static int usb_monitor_vbus_power(usb_hal_monitor_t * pdev, int is_on)
 {
  	 MONITOR_PRINTK("usb_monitor_vbus_power %04x\n", is_on);
 	if(is_on){
+		atc260x_enable_vbusotg(is_on);
         	if(pdev->config->power_switch_gpio_no !=0xffff)
 			gpio_set_value_cansleep(pdev->config->power_switch_gpio_no, pdev->config->power_switch_active_level);
 	}else{
 		if(pdev->config->power_switch_gpio_no !=0xffff)
 			gpio_set_value_cansleep(pdev->config->power_switch_gpio_no, !pdev->config->power_switch_active_level);
+		atc260x_enable_vbusotg(is_on);
 	}	
 	
 	return 0;
-- 
1.7.5.4

