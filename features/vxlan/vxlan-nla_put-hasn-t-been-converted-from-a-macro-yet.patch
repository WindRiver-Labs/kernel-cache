From d33db9134bec0ea3dd9866bc4e10ac8b1a57e3fa Mon Sep 17 00:00:00 2001
From: Michel Thebeau <michel.thebeau@windriver.com>
Date: Fri, 26 Apr 2013 09:19:33 -0400
Subject: [PATCH 36/39] vxlan: nla_put hasn't been converted from a macro yet

An upstream commit that preceeds vxlan removes NLA_PUT macros.  That
hasn't happened yet in our kernel, so use the macros instead.

Signed-off-by: Michel Thebeau <michel.thebeau@windriver.com>
---
 drivers/net/vxlan.c |   66 ++++++++++++++++++++++++---------------------------
 1 file changed, 31 insertions(+), 35 deletions(-)

diff --git a/drivers/net/vxlan.c b/drivers/net/vxlan.c
index ae62917..c5ed2a6 100644
--- a/drivers/net/vxlan.c
+++ b/drivers/net/vxlan.c
@@ -186,19 +186,18 @@ static int vxlan_fdb_info(struct sk_buff *skb, struct vxlan_dev *vxlan,
 	ndm->ndm_flags = NTF_SELF;
 	ndm->ndm_type = NDA_DST;
 
-	if (send_eth && nla_put(skb, NDA_LLADDR, ETH_ALEN, &fdb->eth_addr))
-		goto nla_put_failure;
+	if (send_eth)
+		NLA_PUT(skb, NDA_LLADDR, ETH_ALEN, &fdb->eth_addr);
 
-	if (send_ip && nla_put_be32(skb, NDA_DST, fdb->remote_ip))
-		goto nla_put_failure;
+	if (send_ip)
+		NLA_PUT_BE32(skb, NDA_DST, fdb->remote_ip);
 
 	ci.ndm_used	 = jiffies_to_clock_t(now - fdb->used);
 	ci.ndm_confirmed = 0;
 	ci.ndm_updated	 = jiffies_to_clock_t(now - fdb->updated);
 	ci.ndm_refcnt	 = 0;
 
-	if (nla_put(skb, NDA_CACHEINFO, sizeof(ci), &ci))
-		goto nla_put_failure;
+	NLA_PUT(skb, NDA_CACHEINFO, sizeof(ci), &ci);
 
 	return nlmsg_end(skb, nlh);
 
@@ -1410,35 +1409,32 @@ static int vxlan_fill_info(struct sk_buff *skb, const struct net_device *dev)
 		.high = htons(vxlan->port_max),
 	};
 
-	if (nla_put_u32(skb, IFLA_VXLAN_ID, vxlan->vni))
-		goto nla_put_failure;
-
-	if (vxlan->gaddr && nla_put_be32(skb, IFLA_VXLAN_GROUP, vxlan->gaddr))
-		goto nla_put_failure;
-
-	if (vxlan->link && nla_put_u32(skb, IFLA_VXLAN_LINK, vxlan->link))
-		goto nla_put_failure;
-
-	if (vxlan->saddr && nla_put_be32(skb, IFLA_VXLAN_LOCAL, vxlan->saddr))
-		goto nla_put_failure;
-
-	if (nla_put_u8(skb, IFLA_VXLAN_TTL, vxlan->ttl) ||
-	    nla_put_u8(skb, IFLA_VXLAN_TOS, vxlan->tos) ||
-	    nla_put_u8(skb, IFLA_VXLAN_LEARNING,
-			!!(vxlan->flags & VXLAN_F_LEARN)) ||
-	    nla_put_u8(skb, IFLA_VXLAN_PROXY,
-			!!(vxlan->flags & VXLAN_F_PROXY)) ||
-	    nla_put_u8(skb, IFLA_VXLAN_RSC, !!(vxlan->flags & VXLAN_F_RSC)) ||
-	    nla_put_u8(skb, IFLA_VXLAN_L2MISS,
-			!!(vxlan->flags & VXLAN_F_L2MISS)) ||
-	    nla_put_u8(skb, IFLA_VXLAN_L3MISS,
-			!!(vxlan->flags & VXLAN_F_L3MISS)) ||
-	    nla_put_u32(skb, IFLA_VXLAN_AGEING, vxlan->age_interval) ||
-	    nla_put_u32(skb, IFLA_VXLAN_LIMIT, vxlan->addrmax))
-		goto nla_put_failure;
-
-	if (nla_put(skb, IFLA_VXLAN_PORT_RANGE, sizeof(ports), &ports))
-		goto nla_put_failure;
+	NLA_PUT_U32(skb, IFLA_VXLAN_ID, vxlan->vni);
+
+	if (vxlan->gaddr)
+		NLA_PUT_BE32(skb, IFLA_VXLAN_GROUP, vxlan->gaddr);
+
+	if (vxlan->link)
+		NLA_PUT_U32(skb, IFLA_VXLAN_LINK, vxlan->link);
+
+	if (vxlan->saddr)
+		NLA_PUT_BE32(skb, IFLA_VXLAN_LOCAL, vxlan->saddr);
+
+	NLA_PUT_U8(skb, IFLA_VXLAN_TTL, vxlan->ttl);
+	NLA_PUT_U8(skb, IFLA_VXLAN_TOS, vxlan->tos);
+	NLA_PUT_U8(skb, IFLA_VXLAN_LEARNING,
+			!!(vxlan->flags & VXLAN_F_LEARN));
+	NLA_PUT_U8(skb, IFLA_VXLAN_PROXY,
+			!!(vxlan->flags & VXLAN_F_PROXY));
+	NLA_PUT_U8(skb, IFLA_VXLAN_RSC, !!(vxlan->flags & VXLAN_F_RSC));
+	NLA_PUT_U8(skb, IFLA_VXLAN_L2MISS,
+			!!(vxlan->flags & VXLAN_F_L2MISS));
+	NLA_PUT_U8(skb, IFLA_VXLAN_L3MISS,
+			!!(vxlan->flags & VXLAN_F_L3MISS));
+	NLA_PUT_U32(skb, IFLA_VXLAN_AGEING, vxlan->age_interval);
+	NLA_PUT_U32(skb, IFLA_VXLAN_LIMIT, vxlan->addrmax);
+
+	NLA_PUT(skb, IFLA_VXLAN_PORT_RANGE, sizeof(ports), &ports);
 
 	return 0;
 
-- 
1.7.9.7

