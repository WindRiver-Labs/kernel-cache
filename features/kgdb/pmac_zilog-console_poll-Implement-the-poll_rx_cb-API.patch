From a7895a2332ca1fb3d09c204dcff2fcd7e23ba56b Mon Sep 17 00:00:00 2001
From: Jason Wessel <jason.wessel@windriver.com>
Date: Fri, 10 Aug 2012 12:23:15 -0500
Subject: [PATCH 29/29] pmac_zilog,console_poll: Implement the poll_rx_cb API

The poll receive call back (AKA poll_rx_cb) allows for snooping the
UART driver to look for a break character in order to enter the kernel
debug core.

Cc: Alan Cox <alan@linux.intel.com>
Cc: Greg Kroah-Hartman <gregkh@linuxfoundation.org>
Cc: <stable@vger.kernel.org>
Signed-off-by: Jason Wessel <jason.wessel@windriver.com>
---
 drivers/tty/serial/pmac_zilog.c | 4 ++++
 1 file changed, 4 insertions(+)

diff --git a/drivers/tty/serial/pmac_zilog.c b/drivers/tty/serial/pmac_zilog.c
index b1785f5..a1a6628 100644
--- a/drivers/tty/serial/pmac_zilog.c
+++ b/drivers/tty/serial/pmac_zilog.c
@@ -259,6 +259,10 @@ static bool pmz_receive_chars(struct uart_pmac_port *uap)
 		}
 
 #if defined(CONFIG_MAGIC_SYSRQ) && defined(CONFIG_SERIAL_CORE_CONSOLE)
+#ifdef CONFIG_CONSOLE_POLL
+		if (uap->port.poll_rx_cb && uap->port.poll_rx_cb(ch))
+			goto next_char;
+#endif
 #ifdef USE_CTRL_O_SYSRQ
 		/* Handle the SysRq ^O Hack */
 		if (ch == '\x0f') {
-- 
1.8.4.93.g57e4c17

