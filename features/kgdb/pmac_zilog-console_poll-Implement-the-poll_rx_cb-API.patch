From f5c0cdf118f46ad6bea53474551548beccfd5861 Mon Sep 17 00:00:00 2001
From: Jason Wessel <jason.wessel@windriver.com>
Date: Fri, 10 Aug 2012 12:23:15 -0500
Subject: [PATCH 25/28] pmac_zilog,console_poll: Implement the poll_rx_cb API

The poll receive call back (AKA poll_rx_cb) allows for snooping the
UART driver to look for a break character in order to enter the kernel
debug core.

Cc: Alan Cox <alan@linux.intel.com>
Cc: Greg Kroah-Hartman <gregkh@linuxfoundation.org>
Cc: <stable@vger.kernel.org>
Signed-off-by: Jason Wessel <jason.wessel@windriver.com>
Signed-off-by: He Zhe <zhe.he@windriver.com>
---
 drivers/tty/serial/pmac_zilog.c | 4 ++++
 1 file changed, 4 insertions(+)

diff --git a/drivers/tty/serial/pmac_zilog.c b/drivers/tty/serial/pmac_zilog.c
index e156e39..5aecedd 100644
--- a/drivers/tty/serial/pmac_zilog.c
+++ b/drivers/tty/serial/pmac_zilog.c
@@ -261,6 +261,10 @@ static bool pmz_receive_chars(struct uart_pmac_port *uap)
 		}
 
 #if defined(CONFIG_MAGIC_SYSRQ) && defined(CONFIG_SERIAL_CORE_CONSOLE)
+#ifdef CONFIG_CONSOLE_POLL
+		if (uap->port.poll_rx_cb && uap->port.poll_rx_cb(ch))
+			goto next_char;
+#endif
 #ifdef USE_CTRL_O_SYSRQ
 		/* Handle the SysRq ^O Hack */
 		if (ch == '\x0f') {
-- 
2.0.2

