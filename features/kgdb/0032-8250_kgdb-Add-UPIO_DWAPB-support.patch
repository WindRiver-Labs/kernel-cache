From 4796f780a7739bfe95ffba757c007b4ff8477d5c Mon Sep 17 00:00:00 2001
From: Shinya Kuribayashi <shinya.kuribayashi@necel.com>
Date: Tue, 21 Apr 2009 12:47:04 +0900
Subject: [PATCH] 8250_kgdb: Add UPIO_DWAPB support

This introduces DWAPB UART support to 8250_kgdb.c.

Signed-off-by: Jack Tan <jack.tan@windriver.com>
Signed-off-by: Chunbo Luo <chunbo.luo@windriver.com>
Signed-off-by: Shinya Kuribayashi <shinya.kuribayashi@necel.com>
---
 drivers/serial/8250_kgdb.c |    7 +++++--
 1 files changed, 5 insertions(+), 2 deletions(-)

diff --git a/drivers/serial/8250_kgdb.c b/drivers/serial/8250_kgdb.c
index 84d8d33..f5430b0 100644
--- a/drivers/serial/8250_kgdb.c
+++ b/drivers/serial/8250_kgdb.c
@@ -331,6 +331,7 @@ static int kgdb8250_early_init(void)
 	/* Internal driver setup. */
 	switch (kgdb8250_port.iotype) {
 	case UPIO_MEM:
+	case UPIO_DWAPB:
 		kgdb8250_needs_request_mem_region = 0;
 		if (kgdb8250_port.mapbase)
 			kgdb8250_needs_request_mem_region = 1;
@@ -383,7 +384,8 @@ static int kgdb8250_late_init(void)
 	kgdb8250_uart_init();
 
 	/* Request memory/io regions that we use. */
-	if (kgdb8250_port.iotype == UPIO_MEM) {
+	if (kgdb8250_port.iotype == UPIO_MEM ||
+	    kgdb8250_port.iotype == UPIO_DWAPB) {
 		if (kgdb8250_needs_request_mem_region &&
 			!request_mem_region(kgdb8250_port.mapbase,
 					8 << kgdb8250_port.regshift, "kgdb"))
@@ -445,7 +447,8 @@ static void kgdb8250_cleanup(void)
 
 	fully_initialized = 0;
 
-	if (kgdb8250_port.iotype == UPIO_MEM) {
+	if (kgdb8250_port.iotype == UPIO_MEM ||
+	    kgdb8250_port.iotype == UPIO_DWAPB) {
 		if (kgdb8250_port.flags & UPF_IOREMAP)
 			iounmap(kgdb8250_port.membase);
 		if (kgdb8250_needs_request_mem_region)
-- 
1.6.0.4

