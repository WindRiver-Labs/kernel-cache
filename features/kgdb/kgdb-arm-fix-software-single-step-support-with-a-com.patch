From 1592558a7540a96d8fdb88301b1dd88bf38d8ff5 Mon Sep 17 00:00:00 2001
From: Deng, Dongdong <Dongdong.Deng@windriver.com>
Date: Mon, 2 Nov 2009 19:27:38 -0800
Subject: [PATCH] kgdb arm: fix software single step support with a compiledbreakpoint

When a breakpoint has been hard compiled into the kernel, both soft
single step, and the continue operation need to increment the pc by 4.

Signed-off-by: Jason Wessel <jason.wessel@windriver.com>
Integrated-by: Dongdong Deng <dongdong.deng@windriver.com>
---
 arch/arm/kernel/kgdb.c |    6 ++++++
 1 files changed, 6 insertions(+), 0 deletions(-)

diff --git a/arch/arm/kernel/kgdb.c b/arch/arm/kernel/kgdb.c
index ee8b1e5..cb92ad4 100644
--- a/arch/arm/kernel/kgdb.c
+++ b/arch/arm/kernel/kgdb.c
@@ -172,6 +172,12 @@ int kgdb_arch_handle_exception(int exception_vector, int signo,
 		uint32_t *next_addr;
 		uint32_t currentInst;
 
+		/* For a compiled break, advance the PC */
+		if (compiled_break == 1) {
+			linux_regs->ARM_pc += 4;
+			compiled_break = 0;
+		}
+
 		/*
 		 * Do a software step. We assume that the host
 		 * debuuger has already REMOVED the breakpoint, so if
-- 
1.6.5.2

