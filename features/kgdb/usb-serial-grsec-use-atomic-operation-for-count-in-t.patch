From 11bb108a9fbca9e7dd8c2c85bd11d8c1d9fd7c1d Mon Sep 17 00:00:00 2001
From: Yang Shi <yang.shi@windriver.com>
Date: Thu, 29 Jan 2015 12:55:21 -0800
Subject: [PATCH] usb-serial/grsec: use atomic operation for count in tty_port

grsec patch change port field in tty_port to atomic variable, so manipulate it
with atomic operation.

And, remvoe return value to void function in order to fix build warning.

Signed-off-by: Yang Shi <yang.shi@windriver.com>
---
 drivers/usb/serial/usb-serial.c | 4 ++--
 1 file changed, 2 insertions(+), 2 deletions(-)

diff --git a/drivers/usb/serial/usb-serial.c b/drivers/usb/serial/usb-serial.c
index 1d5205f..4dbeee2 100644
--- a/drivers/usb/serial/usb-serial.c
+++ b/drivers/usb/serial/usb-serial.c
@@ -1283,7 +1283,7 @@ static void serial_poll_put_char(struct tty_driver *driver, int line, char ch)
 
 	port = usb_serial_port_get_by_minor(line);
 	if (!port)
-		return -1;
+		return;
 
 	serial = port->serial;
 	if (!serial)
@@ -1292,7 +1292,7 @@ static void serial_poll_put_char(struct tty_driver *driver, int line, char ch)
 	if (serial->dev->state == USB_STATE_NOTATTACHED)
 		return;
 
-	if (!port->port.count)
+	if (atomic_read(&port->port.count) == 0)
 		return;
 
 	buf[0] = ch;
-- 
2.0.2

