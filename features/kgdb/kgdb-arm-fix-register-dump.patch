From 2c8c6440acc24600f398ff78c877e30922d447ff Mon Sep 17 00:00:00 2001
From: Dongdong Deng <dongdong.deng@windriver.com>
Date: Tue, 21 Dec 2010 17:29:38 +0800
Subject: [PATCH 8/9] kgdb,arm: fix register dump

commit 834b2964b7ab047610da038e42d61dc8dac6339a upstream

DBG_MAX_REG_NUM incorrectly had the number of indices in the GDB regs
array rather than the number of registers, leading to an oops when the
"rd" command is used in KDB.

Cc: stable@kernel.org
Signed-off-by: Rabin Vincent <rabin@rab.in>
Signed-off-by: Jason Wessel <jason.wessel@windriver.com>
Integrated-by: Dongdong Deng <dongdong.deng@windriver.com>
---
 arch/arm/include/asm/kgdb.h |    8 ++------
 1 files changed, 2 insertions(+), 6 deletions(-)

diff --git a/arch/arm/include/asm/kgdb.h b/arch/arm/include/asm/kgdb.h
index 66ab961..48066ce 100644
--- a/arch/arm/include/asm/kgdb.h
+++ b/arch/arm/include/asm/kgdb.h
@@ -71,10 +71,11 @@ extern int kgdb_fault_expected;
 #define _FP_REGS		8
 #define _EXTRA_REGS		2
 #define GDB_MAX_REGS		(_GP_REGS + (_FP_REGS * 3) + _EXTRA_REGS)
+#define DBG_MAX_REG_NUM		(_GP_REGS + _FP_REGS + _EXTRA_REGS)
 
 #define KGDB_MAX_NO_CPUS	1
 #define BUFMAX			400
-#define NUMREGBYTES		(GDB_MAX_REGS << 2)
+#define NUMREGBYTES		(DBG_MAX_REG_NUM << 2)
 #define NUMCRITREGBYTES		(32 << 2)
 
 #define _R0			0
@@ -95,11 +96,6 @@ extern int kgdb_fault_expected;
 #define _PC			15
 #define _CPSR			(GDB_MAX_REGS - 1)
 
-#define DBG_MAX_REG_NUM		26
-#define DBG_FP_REG_NUM		_FP
-#define DBG_SP_REG_NUM		_SPT
-#define DBG_PC_REG_NUM		_PC
-
 /*
  * So that we can denote the end of a frame for tracing,
  * in the simple case:
-- 
1.7.0

