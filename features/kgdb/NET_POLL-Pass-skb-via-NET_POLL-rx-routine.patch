From 66280ffc5e35ff052bfd94e2bec9e8c3103a68f6 Mon Sep 17 00:00:00 2001
From: Jason Wessel <jason.wessel@windriver.com>
Date: Tue, 28 Jul 2009 13:31:44 -0500
Subject: [PATCH 1/4] NET_POLL: Pass skb via NET_POLL rx routine

This patch is a change to the NET POLL api so that the MAC address or
IP frame information can be parsed by the driver that wishes to use
it.  Speficially for kgdboe, it is used to automatically collect the
MAC address of the GDB host.

Signed-off-by: Jason Wessel <jason.wessel@windriver.com>
Acked-by: Matt Mackall <mpm@selenic.com>
---
 include/linux/netpoll.h |    2 +-
 net/core/netpoll.c      |    3 ++-
 2 files changed, 3 insertions(+), 2 deletions(-)

diff --git a/include/linux/netpoll.h b/include/linux/netpoll.h
index a765ea8..fcbb0d2 100644
--- a/include/linux/netpoll.h
+++ b/include/linux/netpoll.h
@@ -16,7 +16,7 @@ struct netpoll {
 	struct net_device *dev;
 	char dev_name[IFNAMSIZ];
 	const char *name;
-	void (*rx_hook)(struct netpoll *, int, char *, int);
+	void (*rx_hook)(struct netpoll *, int, char *, int, struct sk_buff *);
 
 	__be32 local_ip, remote_ip;
 	u16 local_port, remote_port;
diff --git a/net/core/netpoll.c b/net/core/netpoll.c
index d4ec38f..333580f 100644
--- a/net/core/netpoll.c
+++ b/net/core/netpoll.c
@@ -589,7 +589,8 @@ int __netpoll_rx(struct sk_buff *skb)
 
 		np->rx_hook(np, ntohs(uh->source),
 			       (char *)(uh+1),
-			       ulen - sizeof(struct udphdr));
+			       ulen - sizeof(struct udphdr),
+		    skb);
 		hits++;
 	}
 
-- 
1.6.5.2

