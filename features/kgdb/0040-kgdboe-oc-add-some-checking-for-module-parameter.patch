From acad201864fe0f3e867e2e6bf1bcd26d04b0a994 Mon Sep 17 00:00:00 2001
From: DDD <Dongdong.deng@windriver.com>
Date: Sat, 10 Oct 2009 16:26:59 +0800
Subject: [PATCH] kgdboe/oc: add some checking for module parameter

add some checking for module parameter when we insert those module.

Signed-off-by: Dongdong Deng <dongdong.deng@windriver.com>
---
 drivers/net/kgdboe.c    |    9 +++++++--
 drivers/serial/kgdboc.c |    7 ++++++-
 2 files changed, 13 insertions(+), 3 deletions(-)

diff --git a/drivers/net/kgdboe.c b/drivers/net/kgdboe.c
index 6537e00..a16a527 100644
--- a/drivers/net/kgdboe.c
+++ b/drivers/net/kgdboe.c
@@ -223,10 +223,15 @@ static void cleanup_kgdboe(void)
 static int param_set_kgdboe_var(const char *kmessage, struct kernel_param *kp)
 {
 	char kmessage_save[MAX_CONFIG_LEN];
-	int len = strlen(kmessage);
+	int len;
+
+	if (!kmessage || !(len = strlen(kmessage))) {
+		printk(KERN_ERR "kgdboe: config string too short\n");
+		return -ENOSPC;
+	}
 
 	if (len >= MAX_CONFIG_LEN) {
-		printk(KERN_ERR "kgdboc: config string too long\n");
+		printk(KERN_ERR "kgdboe: config string too long\n");
 		return -ENOSPC;
 	}
 
diff --git a/drivers/serial/kgdboc.c b/drivers/serial/kgdboc.c
index b96ce1d..98bcd1d 100644
--- a/drivers/serial/kgdboc.c
+++ b/drivers/serial/kgdboc.c
@@ -210,7 +210,12 @@ static void kgdboc_put_char(u8 chr)
 
 static int param_set_kgdboc_var(const char *kmessage, struct kernel_param *kp)
 {
-	int len = strlen(kmessage);
+	int len;
+
+	if (!kmessage || !(len = strlen(kmessage))) {
+		printk(KERN_ERR "kgdboc: config string too short\n");
+		return -ENOSPC;
+	}
 
 	if (len >= MAX_CONFIG_LEN) {
 		printk(KERN_ERR "kgdboc: config string too long\n");
-- 
1.6.3.3

