From b2aad8b13b9adaf0ec4878f421470aae806da186 Mon Sep 17 00:00:00 2001
From: Ivar Holmqvist <ivar.holmqvist@windriver.com>
Date: Wed, 17 Mar 2010 06:28:04 -0700
Subject: [PATCH] ramconsole: kbuild support

Add Kbuild hooks for ramconsole.

Signed-off-by: Bruce Ashfield <bruce.ashfield@windriver.com>
---
 drivers/misc/Kconfig  |   58 +++++++++++++++++++++++++++++++++++++++++++++++++
 drivers/misc/Makefile |    1 +
 2 files changed, 59 insertions(+), 0 deletions(-)

diff --git a/drivers/misc/Kconfig b/drivers/misc/Kconfig
index 0d0d625..3f4093a 100644
--- a/drivers/misc/Kconfig
+++ b/drivers/misc/Kconfig
@@ -332,4 +332,62 @@ source "drivers/misc/eeprom/Kconfig"
 source "drivers/misc/cb710/Kconfig"
 source "drivers/misc/iwmc3200top/Kconfig"
 
+config RAM_CONSOLE
+        bool "RAM buffer console"
+        default n
+
+config RAM_CONSOLE_ENABLE_VERBOSE
+        bool "Enable verbose console messages"
+        default y
+        depends on RAM_CONSOLE
+
+menuconfig RAM_CONSOLE_ERROR_CORRECTION
+        bool "Enable error correction"
+        default n
+        depends on RAM_CONSOLE
+        depends on !RAM_CONSOLE_EARLY_INIT
+        select REED_SOLOMON
+        select REED_SOLOMON_ENC8
+        select REED_SOLOMON_DEC8
+
+if RAM_CONSOLE_ERROR_CORRECTION
+
+config RAM_CONSOLE_ERROR_CORRECTION_DATA_SIZE
+        int "Data data size"
+        default 128
+        help
+          Must be a power of 2.
+
+config RAM_CONSOLE_ERROR_CORRECTION_ECC_SIZE
+        int "ECC size"
+        default 16
+
+config RAM_CONSOLE_ERROR_CORRECTION_SYMBOL_SIZE
+        int "Symbol size"
+        default 8
+config RAM_CONSOLE_ERROR_CORRECTION_POLYNOMIAL
+        hex "Polynomial"
+        default 0x19 if (RAM_CONSOLE_ERROR_CORRECTION_SYMBOL_SIZE = 4)
+        default 0x29 if (RAM_CONSOLE_ERROR_CORRECTION_SYMBOL_SIZE = 5)
+        default 0x61 if (RAM_CONSOLE_ERROR_CORRECTION_SYMBOL_SIZE = 6)
+        default 0x89 if (RAM_CONSOLE_ERROR_CORRECTION_SYMBOL_SIZE = 7)
+        default 0x11d if (RAM_CONSOLE_ERROR_CORRECTION_SYMBOL_SIZE = 8)
+
+endif #RAM_CONSOLE_ERROR_CORRECTION
+
+config RAM_CONSOLE_EARLY_INIT
+        bool "Start ram console early"
+        default n
+        depends on RAM_CONSOLE
+
+config RAM_CONSOLE_EARLY_ADDR
+        hex "RAM console virtual address"
+        default 0
+        depends on RAM_CONSOLE_EARLY_INIT
+
+config RAM_CONSOLE_EARLY_SIZE
+        hex "RAM console buffer size"
+        default 0
+        depends on RAM_CONSOLE_EARLY_INIT
+
 endif # MISC_DEVICES
diff --git a/drivers/misc/Makefile b/drivers/misc/Makefile
index 7b6f7ee..240f6c1 100644
--- a/drivers/misc/Makefile
+++ b/drivers/misc/Makefile
@@ -30,3 +30,4 @@ obj-$(CONFIG_IWMC3200TOP)      += iwmc3200top/
 obj-y				+= eeprom/
 obj-y				+= cb710/
 obj-$(CONFIG_VMWARE_BALLOON)	+= vmware_balloon.o
+obj-$(CONFIG_RAM_CONSOLE)	+= ram_console.o
-- 
1.6.5.2

