From 586f150e798df135a8773fd7dace1330a3c082ab Mon Sep 17 00:00:00 2001
From: Bruce Ashfield <bruce.ashfield@windriver.com>
Date: Mon, 2 Feb 2009 12:01:02 -0500
Subject: [PATCH] ocd: powerpc hooks

Enable debug by turning on MSR debug enable (DE) bit. Not having
the DE bit set will result in hardware breakpoints and other
advanced debug register features to not work correctly.

Signed-off-by: Bruce Ashfield <bruce.ashfield@windriver.com>
Signed-off-by: Mark Asselstine <mark.asselstine@windriver.com>
---
 arch/powerpc/include/asm/reg_booke.h |    8 ++++++--
 1 files changed, 6 insertions(+), 2 deletions(-)

diff --git a/arch/powerpc/include/asm/reg_booke.h b/arch/powerpc/include/asm/reg_booke.h
index a37254f..0d96997 100644
--- a/arch/powerpc/include/asm/reg_booke.h
+++ b/arch/powerpc/include/asm/reg_booke.h
@@ -35,8 +35,12 @@
 #define MSR_KERNEL	(MSR_ME|MSR_RI|MSR_IR|MSR_DR|MSR_CE)
 #define MSR_USER	(MSR_KERNEL|MSR_PR|MSR_EE)
 #else
-#define MSR_KERNEL	(MSR_ME|MSR_RI|MSR_CE)
-#define MSR_USER	(MSR_KERNEL|MSR_PR|MSR_EE)
+#ifdef CONFIG_WR_OCD_DEBUG
+#define MSR_KERNEL	(MSR_ME|MSR_RI|MSR_CE|MSR_DE)
+#else
+#define MSR_KERNEL     (MSR_ME|MSR_RI|MSR_CE)
+#endif	/* OCD */
+#define MSR_USER       (MSR_KERNEL|MSR_PR|MSR_EE)
 #endif
 
 /* Special Purpose Registers (SPRNs)*/
-- 
1.7.5.4

