From 33cdfac8d69a8682f80e6deff301063c4963664f Mon Sep 17 00:00:00 2001
From: Kevin Hao <kexin.hao@windriver.com>
Date: Thu, 23 Jul 2015 15:25:55 +0800
Subject: [PATCH] PCI: imx: mark the msi cascade handler IRQF_NO_THREAD

The cascade handler must run in hard interrupt context, otherwise
it will cause call trace since the force threading of all interrupt
handler in rt kernel.

Signed-off-by: Kevin Hao <kexin.hao@windriver.com>
---
 drivers/pci/host/pci-imx6.c |    3 ++-
 1 files changed, 2 insertions(+), 1 deletions(-)

diff --git a/drivers/pci/host/pci-imx6.c b/drivers/pci/host/pci-imx6.c
index 1c781f9..7897922 100644
--- a/drivers/pci/host/pci-imx6.c
+++ b/drivers/pci/host/pci-imx6.c
@@ -671,7 +671,8 @@ static int __init imx6_add_pcie_port(struct pcie_port *pp,
 
 		ret = devm_request_irq(&pdev->dev, pp->msi_irq,
 		                       imx6_pcie_msi_handler,
-		                       IRQF_SHARED, "mx6-pcie-msi", pp);
+				       IRQF_SHARED | IRQF_NO_THREAD,
+				       "mx6-pcie-msi", pp);
 		if (ret) {
 			dev_err(&pdev->dev, "failed to request MSI irq\n");
 			return -ENODEV;
-- 
1.7.5.4

