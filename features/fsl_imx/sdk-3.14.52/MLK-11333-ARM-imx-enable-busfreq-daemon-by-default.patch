From b08b7706ce296e83b662176b4a844dc2773ad52d Mon Sep 17 00:00:00 2001
From: Anson Huang <b20788@freescale.com>
Date: Fri, 7 Aug 2015 19:07:59 +0800
Subject: [PATCH 1000/1221] MLK-11333 ARM: imx: enable busfreq daemon by
 default

By default, busfreq mode is set to high bus mode,
if there is no high speed device enabled, system
should be able to enter low bus mode, that is why
we have a daemon thread created to handle such
scenario, this daemon should be enabled after busfreq
driver probed.

However, we missed to enable it before, this patch
enables it.

Signed-off-by: Anson Huang <b20788@freescale.com>
[zou:Original patch taken from
git.freescale.com/imx/fsl-arm-yocto-bsp.git-b imx-3.14.52-1.1.0_ga]
Signed-off-by: zou cao <cao.zou@windriver.com>
---
 arch/arm/mach-imx/busfreq-imx.c |    4 ++++
 1 files changed, 4 insertions(+), 0 deletions(-)

diff --git a/arch/arm/mach-imx/busfreq-imx.c b/arch/arm/mach-imx/busfreq-imx.c
index ae69f0b..69d596b 100644
--- a/arch/arm/mach-imx/busfreq-imx.c
+++ b/arch/arm/mach-imx/busfreq-imx.c
@@ -1276,6 +1276,10 @@ static int busfreq_probe(struct platform_device *pdev)
 	register_pm_notifier(&imx_bus_freq_pm_notifier);
 	register_reboot_notifier(&imx_busfreq_reboot_notifier);
 
+	/* enter low bus mode if no high speed device enabled */
+	schedule_delayed_work(&bus_freq_daemon,
+		msecs_to_jiffies(10000));
+
 	/*
 	 * Need to make sure to an entry for the ddr freq change code address in the IRAM page table.
 	 * This is only required if the DDR freq code and suspend/idle code are in different OCRAM spaces.
-- 
1.7.5.4

