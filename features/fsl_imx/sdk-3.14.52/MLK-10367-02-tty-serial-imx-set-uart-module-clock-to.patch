From 95148c30670d31f54d5aa107f4ec04a3de9ae24b Mon Sep 17 00:00:00 2001
From: Fugang Duan <b38611@freescale.com>
Date: Mon, 9 Mar 2015 10:08:13 +0800
Subject: [PATCH 0139/1221] MLK-10367-02 tty: serial: imx: set uart module
 clock to 80Mhz

When UART module clock is great than 80Mhz, there may have risk after
confirming with IC owner. So set the maximum module clock to 80Mhz.
(The patch just fix the first part that push un-correct patch version
by mistake)

Signed-off-by: Fugang Duan <B38611@freescale.com>
[zou:Original patch taken from
git.freescale.com/imx/fsl-arm-yocto-bsp.git-b imx-3.14.52-1.1.0_ga]
Signed-off-by: zou cao <cao.zou@windriver.com>
---
 drivers/tty/serial/imx.c |    3 ++-
 1 files changed, 2 insertions(+), 1 deletions(-)

diff --git a/drivers/tty/serial/imx.c b/drivers/tty/serial/imx.c
index 3737e82..20cd489 100644
--- a/drivers/tty/serial/imx.c
+++ b/drivers/tty/serial/imx.c
@@ -2110,7 +2110,8 @@ static int serial_imx_probe(struct platform_device *pdev)
 		return ret;
 	}
 
-	if (sport->clk_per > IMX_MODULE_MAX_CLK_RATE)
+	sport->port.uartclk = clk_get_rate(sport->clk_per);
+	if (sport->port.uartclk > IMX_MODULE_MAX_CLK_RATE)
 		clk_set_rate(sport->clk_per, IMX_MODULE_MAX_CLK_RATE);
 	sport->port.uartclk = clk_get_rate(sport->clk_per);
 
-- 
1.7.5.4

