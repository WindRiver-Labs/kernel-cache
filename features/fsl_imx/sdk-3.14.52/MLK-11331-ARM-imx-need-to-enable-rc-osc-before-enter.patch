From 717d9ea2698b2849b5fcd086fc56d1629798d085 Mon Sep 17 00:00:00 2001
From: Anson Huang <b20788@freescale.com>
Date: Fri, 7 Aug 2015 17:44:49 +0800
Subject: [PATCH 0997/1221] MLK-11331 ARM: imx: need to enable rc-osc before
 entering low power idle

On i.MX7D, RC-OSC must be enabled before entering low power idle,
otherwise, system will fail as 24MHz XTAL is power down during
low power idle and RC-OSC is used instead.

Signed-off-by: Anson Huang <b20788@freescale.com>
[zou:Original patch taken from
git.freescale.com/imx/fsl-arm-yocto-bsp.git-b imx-3.14.52-1.1.0_ga]
Signed-off-by: zou cao <cao.zou@windriver.com>
---
 arch/arm/mach-imx/cpuidle-imx7d.c |    2 ++
 1 files changed, 2 insertions(+), 0 deletions(-)

diff --git a/arch/arm/mach-imx/cpuidle-imx7d.c b/arch/arm/mach-imx/cpuidle-imx7d.c
index 13364b9..c5bc81c 100644
--- a/arch/arm/mach-imx/cpuidle-imx7d.c
+++ b/arch/arm/mach-imx/cpuidle-imx7d.c
@@ -254,6 +254,8 @@ int __init imx7d_cpuidle_init(void)
 	cpuidle_pm_info->src_base.vbase =
 		(void __iomem *)IMX_IO_P2V(MX7D_SRC_BASE_ADDR);
 
+	imx7d_enable_rcosc();
+
 	/* code size should include cpuidle_pm_info size */
 	imx7d_wfi_in_iram_fn = (void *)fncpy(wfi_iram_base +
 		sizeof(*cpuidle_pm_info),
-- 
1.7.5.4

