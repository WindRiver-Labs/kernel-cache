From d16d5198027f009674431335654330951b38aff6 Mon Sep 17 00:00:00 2001
From: czou <cao.zou@windriver.com>
Date: Wed, 25 May 2016 17:57:35 +0800
Subject: [PATCH] video: mxsfb: release the timimgs after init fb information

We should free the memory of timings which is malloced by
of_get_display_timings, otherwise kmemleake will ba caused as follow:

unreferenced object 0x888e0640 (size 64):
  comm "swapper/0", pid 1, jiffies 4294937701 (age 1232.480s)
  hex dump (first 32 bytes):
    01 00 00 00 00 00 00 00 80 06 8e 88 00 00 00 00 ................
    00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 ................
  backtrace:
    [<8012dd7c>] kmem_cache_alloc_trace+0x1e8/0x2f4
    [<8042dab8>] of_get_display_timings+0x68/0x208
    [<8042c520>] mxsfb_init_fbinfo_dt+0x144/0x254
    [<8042cf10>] mxsfb_probe+0x220/0x8ac
    [<8048dbfc>] platform_drv_probe+0x58/0xa8
    [<8048c1d4>] driver_probe_device+0xcc/0x214
    [<8048c3e8>] __driver_attach+0x78/0x9c
    [<8048a670>] bus_for_each_dev+0x7c/0xa0
    [<8048bce0>] driver_attach+0x28/0x30
    [<8048b908>] bus_add_driver+0xf4/0x1dc
    [<8048cad4>] driver_register+0xac/0xf0
    [<8048db18>] __platform_driver_register+0x58/0x6c
    [<80b80d0c>] mxsfb_driver_init+0x18/0x20
    [<80008844>] do_one_initcall+0xa4/0x140
    [<80b41d70>] kernel_init_freeable+0x1b4/0x2ac
    [<807db22c>] kernel_init+0x1c/0xf4

Signed-off-by: czou <cao.zou@windriver.com>
---
 drivers/video/mxsfb.c |    1 +
 1 files changed, 1 insertions(+), 0 deletions(-)

diff --git a/drivers/video/mxsfb.c b/drivers/video/mxsfb.c
index ff02dc8..14166dd 100644
--- a/drivers/video/mxsfb.c
+++ b/drivers/video/mxsfb.c
@@ -1196,6 +1196,7 @@ static int mxsfb_init_fbinfo_dt(struct mxsfb_info *host)
 
 put_timings_node:
 	of_node_put(timings_np);
+	display_timings_release(timings);
 put_display_node:
 	of_node_put(display_np);
 	return ret;
-- 
1.7.5.4

