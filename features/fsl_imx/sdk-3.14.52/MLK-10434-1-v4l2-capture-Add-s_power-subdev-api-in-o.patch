From 9d509bffeb0ed52ba6a188c2de82d3f2b61dcb18 Mon Sep 17 00:00:00 2001
From: Sandor Yu <R01008@freescale.com>
Date: Mon, 30 Mar 2015 16:18:44 +0800
Subject: [PATCH 0276/1221] MLK-10434-1: v4l2 capture: Add s_power subdev api
 in open/close

Add s_power subdev api in vl42 capture open and close function.

Signed-off-by: Sandor Yu <R01008@freescale.com>
[zou:Original patch taken from
git.freescale.com/imx/fsl-arm-yocto-bsp.git-b imx-3.14.52-1.1.0_ga]
Signed-off-by: zou cao <cao.zou@windriver.com>
---
 drivers/media/platform/mxc/subdev/mx6s_capture.c |    4 ++++
 1 files changed, 4 insertions(+), 0 deletions(-)

diff --git a/drivers/media/platform/mxc/subdev/mx6s_capture.c b/drivers/media/platform/mxc/subdev/mx6s_capture.c
index f7b910f1..e1bced5 100644
--- a/drivers/media/platform/mxc/subdev/mx6s_capture.c
+++ b/drivers/media/platform/mxc/subdev/mx6s_capture.c
@@ -1041,6 +1041,7 @@ static irqreturn_t mx6s_csi_irq_handler(int irq, void *data)
 static int mx6s_csi_open(struct file *file)
 {
 	struct mx6s_csi_dev *csi_dev = video_drvdata(file);
+	struct v4l2_subdev *sd = csi_dev->sd;
 	struct vb2_queue *q = &csi_dev->vb2_vidq;
 	int ret = 0;
 
@@ -1070,6 +1071,7 @@ static int mx6s_csi_open(struct file *file)
 
 	request_bus_freq(BUS_FREQ_HIGH);
 
+	v4l2_subdev_call(sd, core, s_power, 1);
 	mx6s_csi_init(csi_dev);
 
 	mutex_unlock(&csi_dev->lock);
@@ -1085,12 +1087,14 @@ unlock:
 static int mx6s_csi_close(struct file *file)
 {
 	struct mx6s_csi_dev *csi_dev = video_drvdata(file);
+	struct v4l2_subdev *sd = csi_dev->sd;
 
 	mutex_lock(&csi_dev->lock);
 
 	vb2_queue_release(&csi_dev->vb2_vidq);
 
 	mx6s_csi_deinit(csi_dev);
+	v4l2_subdev_call(sd, core, s_power, 0);
 
 	vb2_dma_contig_cleanup_ctx(csi_dev->alloc_ctx);
 	mutex_unlock(&csi_dev->lock);
-- 
1.7.5.4

