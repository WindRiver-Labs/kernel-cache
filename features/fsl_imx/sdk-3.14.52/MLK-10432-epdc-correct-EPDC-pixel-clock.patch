From 567d757eca0348551eb652a8aa652880a7c83f22 Mon Sep 17 00:00:00 2001
From: Robby Cai <r63905@freescale.com>
Date: Mon, 16 Mar 2015 21:15:06 +0800
Subject: [PATCH 0191/1221] MLK-10432 epdc: correct EPDC pixel clock

Need enable the epdc pixel rate after call clk_set_rate since there's
CLK_SET_RATE_GATE flag for the clock, otherwise clk_set_rate call may fail.

Signed-off-by: Robby Cai <r63905@freescale.com>
[zou:Original patch taken from
git.freescale.com/imx/fsl-arm-yocto-bsp.git-b imx-3.14.52-1.1.0_ga]
Signed-off-by: zou cao <cao.zou@windriver.com>
---
 drivers/video/mxc/mxc_epdc_v2_fb.c |    5 +++--
 1 files changed, 3 insertions(+), 2 deletions(-)

diff --git a/drivers/video/mxc/mxc_epdc_v2_fb.c b/drivers/video/mxc/mxc_epdc_v2_fb.c
index cb92c1a..a44b302 100644
--- a/drivers/video/mxc/mxc_epdc_v2_fb.c
+++ b/drivers/video/mxc/mxc_epdc_v2_fb.c
@@ -4703,8 +4703,6 @@ static void mxc_epdc_fb_fw_handler(const struct firmware *fw,
 	clk_prepare_enable(fb_data->epdc_clk_axi);
 
 	target_pix_clk = fb_data->cur_mode->vmode->pixclock;
-	/* Enable pix clk for EPDC */
-	clk_prepare_enable(fb_data->epdc_clk_pix);
 
 	rounded_pix_clk = clk_round_rate(fb_data->epdc_clk_pix, target_pix_clk);
 
@@ -4730,6 +4728,9 @@ static void mxc_epdc_fb_fw_handler(const struct firmware *fw,
 
 	clk_set_rate(fb_data->epdc_clk_pix, rounded_pix_clk);
 
+	/* Enable pix clk for EPDC */
+	clk_prepare_enable(fb_data->epdc_clk_pix);
+
 	epdc_init_sequence(fb_data);
 
 	/* Disable clocks */
-- 
1.7.5.4

