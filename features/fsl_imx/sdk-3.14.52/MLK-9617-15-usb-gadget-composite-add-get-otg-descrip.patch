From 2d42e5d62f1fcc2ef5d9d3c0bc8ea6944edcc69d Mon Sep 17 00:00:00 2001
From: Li Jun <b47624@freescale.com>
Date: Thu, 16 Oct 2014 22:17:52 +0800
Subject: [PATCH 0677/1221] MLK-9617-15 usb: gadget: composite: add get otg
 descriptor request handling

This patch adds response to getting OTG descriptor request from host.

Signed-off-by: Li Jun <b47624@freescale.com>
(cherry picked from commit 560690f1b24448b94806f390add9d91d602e3ef4)
[zou:Original patch taken from
git.freescale.com/imx/fsl-arm-yocto-bsp.git-b imx-3.14.52-1.1.0_ga]
Signed-off-by: zou cao <cao.zou@windriver.com>
---
 drivers/usb/gadget/composite.c |   13 +++++++++++++
 1 files changed, 13 insertions(+), 0 deletions(-)

diff --git a/drivers/usb/gadget/composite.c b/drivers/usb/gadget/composite.c
index 66de2a0..9cf244f 100644
--- a/drivers/usb/gadget/composite.c
+++ b/drivers/usb/gadget/composite.c
@@ -1286,6 +1286,19 @@ composite_setup(struct usb_gadget *gadget, const struct usb_ctrlrequest *ctrl)
 			if (value >= 0)
 				value = min(w_length, (u16) value);
 			break;
+		case USB_DT_OTG:
+			if (gadget_is_otg(gadget)) {
+				struct usb_configuration *config;
+
+				config = list_first_entry(&cdev->configs,
+						struct usb_configuration, list);
+				if (!config)
+					goto done;
+
+				value = sizeof(struct usb_otg_descriptor);
+				memcpy(req->buf, config->descriptors[0], value);
+			}
+			break;
 		case USB_DT_BOS:
 			if (gadget_is_superspeed(gadget)) {
 				value = bos_desc(cdev);
-- 
1.7.5.4

