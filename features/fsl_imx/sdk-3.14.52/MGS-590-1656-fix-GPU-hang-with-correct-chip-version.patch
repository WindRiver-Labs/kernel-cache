From 2a0d30dda0090e4d4362a1922c35a299632edcf1 Mon Sep 17 00:00:00 2001
From: Xianzhong <b07117@freescale.com>
Date: Fri, 3 Apr 2015 18:32:52 +0800
Subject: [PATCH 0337/1221] MGS-590 [#1656] fix GPU hang with correct chip
 version

Vivante use gc3000 version for specific chip configuration,
the chip version is modified as gc2000 for FSL special request,
this patch correct chip version to gc3000 for the detected gc2000+.
also use gc3000 version for the axi bus cache atrribute setting.

Date: Apr 07, 2015
Signed-off-by: Xianzhong <b07117@freescale.com>
[zou:Original patch taken from
git.freescale.com/imx/fsl-arm-yocto-bsp.git-b imx-3.14.52-1.1.0_ga]
Signed-off-by: zou cao <cao.zou@windriver.com>
---
 .../hal/kernel/arch/gc_hal_kernel_hardware.c       |   10 +++++++++-
 1 files changed, 9 insertions(+), 1 deletions(-)

diff --git a/drivers/mxc/gpu-viv/hal/kernel/arch/gc_hal_kernel_hardware.c b/drivers/mxc/gpu-viv/hal/kernel/arch/gc_hal_kernel_hardware.c
index ffb8925..c5759a1 100644
--- a/drivers/mxc/gpu-viv/hal/kernel/arch/gc_hal_kernel_hardware.c
+++ b/drivers/mxc/gpu-viv/hal/kernel/arch/gc_hal_kernel_hardware.c
@@ -150,6 +150,12 @@ _IdentifyHardware(
                                  0x00024,
                                  &Identity->chipRevision));
 
+        if ((Identity->chipModel == gcv2000) && (Identity->chipRevision & 0xffff0000) == 0xffff0000)
+        {
+            Identity->chipModel = gcv3000;
+            Identity->chipRevision &= 0xffff;
+        }
+
         if ((Identity->chipModel    == gcv300)
         &&  (Identity->chipRevision == 0x2201)
         )
@@ -1312,6 +1318,8 @@ gckHARDWARE_InitializeHardware(
                                      0x00024,
                                      &chipRev));
 
+    chipRev &= 0xffff;
+
     if (chipRev != Hardware->identity.chipRevision)
     {
         /* Chip is not there! */
@@ -1604,7 +1612,7 @@ gckHARDWARE_InitializeHardware(
     }
 
     if (_IsHardwareMatch(Hardware, gcv2000, 0x5108)
-     || _IsHardwareMatch(Hardware, gcv2000, 0xffff5450)
+     || _IsHardwareMatch(Hardware, gcv3000, 0x5450)
      || _IsHardwareMatch(Hardware, gcv320, 0x5007)
      || _IsHardwareMatch(Hardware, gcv320, 0x5303)
      || _IsHardwareMatch(Hardware, gcv880, 0x5106)
-- 
1.7.5.4

