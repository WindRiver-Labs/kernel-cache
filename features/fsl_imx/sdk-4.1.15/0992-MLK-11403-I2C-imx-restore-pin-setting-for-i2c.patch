From 740855765ff913945dc7d7c02c14d371e25b6b0a Mon Sep 17 00:00:00 2001
From: Gao Pan <b54642@freescale.com>
Date: Tue, 25 Aug 2015 14:00:32 +0800
Subject: [PATCH 0992/1691] MLK-11403: I2C: imx: restore pin setting for i2c

commit 740855765ff913945dc7d7c02c14d371e25b6b0a from
git://git.freescale.com/imx/linux-2.6-imx.git imx_4.1.15_1.0.0_ga

restore pin setting for i2c in suspend/resume

Signed-off-by: Gao Pan <gaopan@freescale.com>
---
 drivers/i2c/busses/i2c-imx.c | 23 ++++++++++++++++++++++-
 1 file changed, 22 insertions(+), 1 deletion(-)

diff --git a/drivers/i2c/busses/i2c-imx.c b/drivers/i2c/busses/i2c-imx.c
index fcc6378..97dd038 100644
--- a/drivers/i2c/busses/i2c-imx.c
+++ b/drivers/i2c/busses/i2c-imx.c
@@ -1096,12 +1096,33 @@ static int i2c_imx_remove(struct platform_device *pdev)
 	return 0;
 }
 
+#ifdef CONFIG_PM_SLEEP
+static int i2c_imx_suspend(struct device *dev)
+{
+	pinctrl_pm_select_sleep_state(dev);
+	return 0;
+}
+
+static int i2c_imx_resume(struct device *dev)
+{
+	pinctrl_pm_select_default_state(dev);
+	return 0;
+}
+
+static SIMPLE_DEV_PM_OPS(imx_i2c_pm, i2c_imx_suspend, i2c_imx_resume);
+#define IMX_I2C_PM	(&imx_i2c_pm)
+#else
+#define IMX_I2C_PM	NULL
+#endif
+
 static struct platform_driver i2c_imx_driver = {
 	.probe = i2c_imx_probe,
 	.remove = i2c_imx_remove,
 	.driver	= {
-		.name	= DRIVER_NAME,
+		.name = DRIVER_NAME,
+		.owner = THIS_MODULE,
 		.of_match_table = i2c_imx_dt_ids,
+		.pm = IMX_I2C_PM,
 	},
 	.id_table	= imx_i2c_devtype,
 };
-- 
1.9.1

