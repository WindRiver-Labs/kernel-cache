From 790de808868962e038e0d510fd550b8032b3c731 Mon Sep 17 00:00:00 2001
From: czou <cao.zou@windriver.com>
Date: Tue, 10 May 2016 17:22:57 +0800
Subject: [PATCH 3/5] I2C: imx6: add i2c version check for ls1/ls2 ERR010027
 workround

imx6ul don't support the read/write i2c register before enabling
control, here add a check for ls1/ls2 ERR010027 workround.

Signed-off-by: czou <cao.zou@windriver.com>
---
 drivers/i2c/busses/i2c-imx.c |   13 ++++++++++---
 1 files changed, 10 insertions(+), 3 deletions(-)

diff --git a/drivers/i2c/busses/i2c-imx.c b/drivers/i2c/busses/i2c-imx.c
index 3cc49ef..4b0ab19 100644
--- a/drivers/i2c/busses/i2c-imx.c
+++ b/drivers/i2c/busses/i2c-imx.c
@@ -267,6 +267,11 @@ static inline int is_imx1_i2c(struct imx_i2c_struct *i2c_imx)
 	return i2c_imx->hwdata->devtype == IMX1_I2C;
 }
 
+static inline int is_vf610_i2c(struct imx_i2c_struct *i2c_imx)
+{
+	return i2c_imx->hwdata->devtype == VF610_I2C;
+}
+
 static inline void imx_i2c_write_reg(unsigned int val,
 		struct imx_i2c_struct *i2c_imx, unsigned int reg)
 {
@@ -898,9 +903,11 @@ static int i2c_imx_xfer(struct i2c_adapter *adapter,
 	/* workround for ERR010027: ensure that the I2C BUS is idle
 	 * before switching to master mode and attempting a Start cycle
 	 */
-	result = i2c_imx_bus_busy(i2c_imx, 0);
-	if (result)
-		goto fail0;
+	if (is_vf610_i2c(i2c_imx)) {
+		result = i2c_imx_bus_busy(i2c_imx, 0);
+		if (result)
+			goto fail0;
+	}
 
 	/* Start I2C transfer */
 	result = i2c_imx_start(i2c_imx);
-- 
1.7.5.4

