From 27113e8db47eeb11d1f3cd7bdf2157dd577b3fd4 Mon Sep 17 00:00:00 2001
From: Robin Gong <b38343@freescale.com>
Date: Tue, 10 Feb 2015 09:43:25 +0800
Subject: [PATCH 0802/1691] MLK-10238-4: power: domain: add
 suspend_noirq/resume_noirq in power domain

commit 27113e8db47eeb11d1f3cd7bdf2157dd577b3fd4 from
git://git.freescale.com/imx/linux-2.6-imx.git imx_4.1.15_1.0.0_ga

Since some driver which use power domain may use suspend_noirq/resume_noirq
we need implement it in power domain framework.

Signed-off-by: Robin Gong <b38343@freescale.com>
(cherry picked from commit f797469507178ddf7f41de913c79f3b709c72872)
---
 drivers/base/power/domain.c | 9 ++++++++-
 1 file changed, 8 insertions(+), 1 deletion(-)

diff --git a/drivers/base/power/domain.c b/drivers/base/power/domain.c
index 2327613..1c99b09 100644
--- a/drivers/base/power/domain.c
+++ b/drivers/base/power/domain.c
@@ -1048,6 +1048,8 @@ static int pm_genpd_suspend_noirq(struct device *dev)
 	    || (dev->power.wakeup_path && genpd_dev_active_wakeup(genpd, dev)))
 		return 0;
 
+	pm_generic_suspend_noirq(dev);
+
 	genpd_stop_dev(genpd, dev);
 
 	/*
@@ -1070,6 +1072,7 @@ static int pm_genpd_suspend_noirq(struct device *dev)
 static int pm_genpd_resume_noirq(struct device *dev)
 {
 	struct generic_pm_domain *genpd;
+	int ret;
 
 	dev_dbg(dev, "%s()\n", __func__);
 
@@ -1089,7 +1092,11 @@ static int pm_genpd_resume_noirq(struct device *dev)
 	pm_genpd_sync_poweron(genpd);
 	genpd->suspended_count--;
 
-	return genpd_start_dev(genpd, dev);
+	ret = genpd_start_dev(genpd, dev);
+
+	pm_generic_resume_noirq(dev);
+
+	return ret;
 }
 
 /**
-- 
1.9.1

