From 1d46ca7dd704dd03dadac70d4bd53cf984f65586 Mon Sep 17 00:00:00 2001
From: Shengjiu Wang <shengjiu.wang@freescale.com>
Date: Thu, 27 Aug 2015 13:59:39 +0800
Subject: [PATCH 0601/1691] MLK-11429-27: ASoC: fsl_ssi: fix issue in
 fsl_ssi_set_bclk

commit 1d46ca7dd704dd03dadac70d4bd53cf984f65586 from
git://git.freescale.com/imx/linux-2.6-imx.git imx_4.1.15_1.0.0_ga

Hardware limitaion is for bclk, but clkrate is the system clock.
So the condition shoud use the afreq, which is bit clock.

Signed-off-by: Shengjiu Wang <shengjiu.wang@freescale.com>
---
 sound/soc/fsl/fsl_ssi.c | 8 ++++----
 1 file changed, 4 insertions(+), 4 deletions(-)

diff --git a/sound/soc/fsl/fsl_ssi.c b/sound/soc/fsl/fsl_ssi.c
index 93aed64..443410e 100644
--- a/sound/soc/fsl/fsl_ssi.c
+++ b/sound/soc/fsl/fsl_ssi.c
@@ -705,16 +705,16 @@ static int fsl_ssi_set_bclk(struct snd_pcm_substream *substream,
 		else
 			clkrate = clk_round_rate(ssi_private->baudclk, tmprate);
 
+		clkrate /= factor;
+		afreq = clkrate / (i + 1);
+
 		/*
 		 * Hardware limitation: The bclk rate must be
 		 * never greater than 1/5 IPG clock rate
 		 */
-		if (clkrate * 5 > clk_get_rate(ssi_private->clk))
+		if (afreq * 5 > clk_get_rate(ssi_private->clk))
 			continue;
 
-		clkrate /= factor;
-		afreq = clkrate / (i + 1);
-
 		if (freq == afreq)
 			sub = 0;
 		else if (freq / afreq == 1)
-- 
1.9.1

