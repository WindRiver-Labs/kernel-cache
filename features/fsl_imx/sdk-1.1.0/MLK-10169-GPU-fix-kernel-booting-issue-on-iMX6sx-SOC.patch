From c0954a3c03f58c3ae89e015717b2e2b039f4f826 Mon Sep 17 00:00:00 2001
From: Shawn Xiao <b49994@freescale.com>
Date: Wed, 28 Jan 2015 16:39:16 +0800
Subject: [PATCH 0559/1074] MLK-10169 GPU: fix kernel booting issue on iMX6sx
 SOC without GPU

Add checking GPU module logic in qos init. This prevents kernel
booting issue in the iMX6sx SOC where there is no GPU module.

Signed-off-by: Shawn Xiao <b49994@freescale.com>
(cherry picked from commit bf3a8eeaa655a6d3642739bd5e78f70a18c7b45b)
[Original patch taken from git://git.freescale.com/imx/linux-2.6-imx.git]
Signed-off-by: Biyao Zhai <biyao.zhai@windriver.com>
---
 arch/arm/mach-imx/mach-imx6sx.c |    6 +++++-
 1 files changed, 5 insertions(+), 1 deletions(-)

diff --git a/arch/arm/mach-imx/mach-imx6sx.c b/arch/arm/mach-imx/mach-imx6sx.c
index c8da127..3e6afa1 100644
--- a/arch/arm/mach-imx/mach-imx6sx.c
+++ b/arch/arm/mach-imx/mach-imx6sx.c
@@ -1,5 +1,5 @@
 /*
- * Copyright (C) 2014 Freescale Semiconductor, Inc.
+ * Copyright (C) 2014-2015 Freescale Semiconductor, Inc.
  *
  * This program is free software; you can redistribute it and/or modify
  * it under the terms of the GNU General Public License version 2 as
@@ -165,6 +165,10 @@ static inline void imx6sx_qos_init(void)
 	struct device_node *np;
 	void __iomem *src_base;
 
+	np = of_find_compatible_node(NULL, NULL, "fsl,imx6sx-gpu");
+	if (!np || !of_device_is_available(np))
+		return;
+
 	np = of_find_compatible_node(NULL, NULL, "fsl,imx6sx-qosc");
 	if (!np)
 		return;
-- 
1.7.5.4

