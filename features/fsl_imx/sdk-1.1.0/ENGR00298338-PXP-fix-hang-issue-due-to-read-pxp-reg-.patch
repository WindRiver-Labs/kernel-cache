From 94b6d928834455e9cfd39a8b3a32105ad3829b6b Mon Sep 17 00:00:00 2001
From: Fancy Fang <chen.fang@freescale.com>
Date: Mon, 10 Feb 2014 15:10:31 +0800
Subject: [PATCH 0713/1074] ENGR00298338 PXP: fix hang issue due to read pxp
 reg when clk disabled

The function dump_pxp_reg() may be called when the pxp
clock is disabled. So this will cause system hang issue.
Now add clock enable/disable pair to this function call.

Signed-off-by: Fancy Fang <chen.fang@freescale.com>
[Original patch taken from git://git.freescale.com/imx/linux-2.6-imx.git]
Signed-off-by: Biyao Zhai <biyao.zhai@windriver.com>
---
 drivers/dma/pxp/pxp_dma_v2.c |    2 ++
 1 files changed, 2 insertions(+), 0 deletions(-)

diff --git a/drivers/dma/pxp/pxp_dma_v2.c b/drivers/dma/pxp/pxp_dma_v2.c
index 382ceff..0c0f9d6 100644
--- a/drivers/dma/pxp/pxp_dma_v2.c
+++ b/drivers/dma/pxp/pxp_dma_v2.c
@@ -1780,7 +1780,9 @@ static int pxp_probe(struct platform_device *pdev)
 	}
 
 	device_create_file(&pdev->dev, &dev_attr_block_size);
+	pxp_clk_enable(pxp);
 	dump_pxp_reg(pxp);
+	pxp_clk_disable(pxp);
 
 	INIT_WORK(&pxp->work, clkoff_callback);
 	init_timer(&pxp->clk_timer);
-- 
1.7.5.4

