From 15f92d3a22108c26776b99e6cf08687c5da8004d Mon Sep 17 00:00:00 2001
From: Fancy Fang <chen.fang@freescale.com>
Date: Mon, 20 Oct 2014 17:09:38 +0800
Subject: [PATCH 0944/1074] MLK-6304 IPUv3 device: Enable IC task when
 cropping is needed.

For the case that, the input and output size are both 640x480,
but the video20's related framebuffer resolution is 1024x768,
so the output should be cropped. In this situation, the ipu
task should be set to IC_MODE to avoid 'IPU_CHECK_ERR_PROC_NO_NEED'
error reporting.

Signed-off-by: Fancy Fang <chen.fang@freescale.com>
[Original patch taken from git://git.freescale.com/imx/linux-2.6-imx.git]
Signed-off-by: Biyao Zhai <biyao.zhai@windriver.com>
---
 drivers/mxc/ipu3/ipu_device.c |    7 +++++++
 1 files changed, 7 insertions(+), 0 deletions(-)

diff --git a/drivers/mxc/ipu3/ipu_device.c b/drivers/mxc/ipu3/ipu_device.c
index f1f6ad1..e26b673 100644
--- a/drivers/mxc/ipu3/ipu_device.c
+++ b/drivers/mxc/ipu3/ipu_device.c
@@ -1104,6 +1104,13 @@ static int check_task(struct ipu_task_entry *t)
 			need_csc(t->input.format, t->output.format))
 		t->set.mode |= IC_MODE;
 
+	/*need cropping?*/
+	if ((t->input.crop.w != t->input.width)       ||
+		(t->input.crop.h != t->input.height)  ||
+		(t->output.crop.w != t->output.width) ||
+		(t->output.crop.h != t->output.height))
+		t->set.mode |= IC_MODE;
+
 	/*need flip?*/
 	if ((t->set.mode == NULL_MODE) && (t->output.rotate > IPU_ROTATE_NONE))
 		t->set.mode |= IC_MODE;
-- 
1.7.5.4

