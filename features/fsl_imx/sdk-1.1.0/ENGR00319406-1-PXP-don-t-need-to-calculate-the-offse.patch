From 2fbb9af779c47f0a4f44f247a70931ffa30e4fd0 Mon Sep 17 00:00:00 2001
From: Fancy Fang <chen.fang@freescale.com>
Date: Thu, 19 Jun 2014 09:23:56 +0800
Subject: [PATCH 0866/1074] ENGR00319406-1 PXP: don't need to calculate the
 offset for output buffer

The original copy operation done by PXP can be replaced by
alpha blending + colorkey. And this is more reasonable in
the view of PXP hardware.

Signed-off-by: Fancy Fang <chen.fang@freescale.com>
[Original patch taken from git://git.freescale.com/imx/linux-2.6-imx.git]
Signed-off-by: Biyao Zhai <biyao.zhai@windriver.com>
---
 drivers/dma/pxp/pxp_dma_v2.c |   24 ++++--------------------
 1 files changed, 4 insertions(+), 20 deletions(-)

diff --git a/drivers/dma/pxp/pxp_dma_v2.c b/drivers/dma/pxp/pxp_dma_v2.c
index 3802dd2..fed1c46 100644
--- a/drivers/dma/pxp/pxp_dma_v2.c
+++ b/drivers/dma/pxp/pxp_dma_v2.c
@@ -407,25 +407,15 @@ static void pxp_set_outbuf(struct pxps *pxp)
 
 	__raw_writel(out_params->paddr, pxp->base + HW_PXP_OUT_BUF);
 
-	if (proc_data->rotate == 90 || proc_data->rotate == 270) {
-		if (proc_data->rot_pos == 1)
-			__raw_writel(BF_PXP_OUT_LRC_X(proc_data->drect.height - 1) |
-					BF_PXP_OUT_LRC_Y(proc_data->drect.width - 1),
-					pxp->base + HW_PXP_OUT_LRC);
-		else
-			__raw_writel(BF_PXP_OUT_LRC_X(proc_data->drect.width - 1) |
-					BF_PXP_OUT_LRC_Y(proc_data->drect.height - 1),
-					pxp->base + HW_PXP_OUT_LRC);
-	} else
-		__raw_writel(BF_PXP_OUT_LRC_X(proc_data->drect.width - 1) |
-				BF_PXP_OUT_LRC_Y(proc_data->drect.height - 1),
-				pxp->base + HW_PXP_OUT_LRC);
+	__raw_writel(BF_PXP_OUT_LRC_X(out_params->width - 1) |
+			BF_PXP_OUT_LRC_Y(out_params->height - 1),
+			pxp->base + HW_PXP_OUT_LRC);
 
 	if (out_params->pixel_fmt == PXP_PIX_FMT_RGB24) {
 		__raw_writel(out_params->stride * 3,
 				pxp->base + HW_PXP_OUT_PITCH);
 	} else if (out_params->pixel_fmt == PXP_PIX_FMT_BGRA32 ||
-		 out_params->pixel_fmt == PXP_PIX_FMT_RGB32) {
+		out_params->pixel_fmt == PXP_PIX_FMT_RGB32) {
 		__raw_writel(out_params->stride << 2,
 				pxp->base + HW_PXP_OUT_PITCH);
 	} else if (out_params->pixel_fmt == PXP_PIX_FMT_RGB565) {
@@ -589,12 +579,6 @@ static void pxp_set_s0param(struct pxps *pxp)
 	struct pxp_layer_param *out_params = &pxp_conf->out_param;
 	u32 s0param;
 
-	if (proc_data->drect.left != 0 || proc_data->drect.top != 0) {
-		out_params->paddr += (proc_data->drect.top * out_params->stride +
-				proc_data->drect.left) * 2;
-		proc_data->drect.left = proc_data->drect.top = 0;
-	}
-
 	/* Since user apps always pass the rotated drect
 	 * to this driver, we need to first swap the width
 	 * and height which is used to calculate the scale
-- 
1.7.5.4

