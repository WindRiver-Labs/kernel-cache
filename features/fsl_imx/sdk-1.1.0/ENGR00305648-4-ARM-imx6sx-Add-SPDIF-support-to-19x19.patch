From 9139e71c2d793b68bdf2089569ab1091ee12835a Mon Sep 17 00:00:00 2001
From: Nicolin Chen <Guangyu.Chen@freescale.com>
Date: Wed, 26 Mar 2014 11:18:18 +0800
Subject: [PATCH 0364/1074] ENGR00305648-4 ARM: imx6sx: Add SPDIF support to
 19x19 arm2 board

Add SPDIF support to 19x19 arm2 board and create a new dts for it due to
pin conflict.

Acked-by: Wang Shengjiu <b02247@freescale.com>
Signed-off-by: Nicolin Chen <Guangyu.Chen@freescale.com>
[Original patch taken from git://git.freescale.com/imx/linux-2.6-imx.git]
Signed-off-by: Biyao Zhai <biyao.zhai@windriver.com>
---
 arch/arm/boot/dts/Makefile                    |    1 +
 arch/arm/boot/dts/imx6sx-17x17-arm2-spdif.dts |   18 ++++++++++++++++++
 arch/arm/boot/dts/imx6sx-17x17-arm2.dts       |   15 +++++++++++++++
 3 files changed, 34 insertions(+), 0 deletions(-)
 create mode 100644 arch/arm/boot/dts/imx6sx-17x17-arm2-spdif.dts

diff --git a/arch/arm/boot/dts/Makefile b/arch/arm/boot/dts/Makefile
index 327c64f..14195c8 100644
--- a/arch/arm/boot/dts/Makefile
+++ b/arch/arm/boot/dts/Makefile
@@ -183,6 +183,7 @@ dtb-$(CONFIG_ARCH_MXC) += \
 	imx6sl-evk-ldo.dtb \
 	imx6sl-evk-pf200.dtb \
 	imx6sx-17x17-arm2.dtb \
+	imx6sx-17x17-arm2-spdif.dtb \
 	imx6sx-19x19-arm2.dtb \
 	imx6sx-19x19-arm2-lcdif1.dtb \
 	imx6sx-sdb.dtb \
diff --git a/arch/arm/boot/dts/imx6sx-17x17-arm2-spdif.dts b/arch/arm/boot/dts/imx6sx-17x17-arm2-spdif.dts
new file mode 100644
index 0000000..c69db8b
--- /dev/null
+++ b/arch/arm/boot/dts/imx6sx-17x17-arm2-spdif.dts
@@ -0,0 +1,18 @@
+/*
+ * Copyright (C) 2014 Freescale Semiconductor, Inc.
+ *
+ * This program is free software; you can redistribute it and/or modify
+ * it under the terms of the GNU General Public License version 2 as
+ * published by the Free Software Foundation.
+ */
+
+#include "imx6sx-17x17-arm2.dts"
+
+&audmux {
+	/* pin conflict with spdif */
+	status = "disabled";
+};
+
+&spdif {
+	status = "okay";
+};
diff --git a/arch/arm/boot/dts/imx6sx-17x17-arm2.dts b/arch/arm/boot/dts/imx6sx-17x17-arm2.dts
index af21fbd..ebed132 100644
--- a/arch/arm/boot/dts/imx6sx-17x17-arm2.dts
+++ b/arch/arm/boot/dts/imx6sx-17x17-arm2.dts
@@ -110,6 +110,15 @@
 		spi-max-frequency = <20000000>;
 		reg = <0>;
 	};
+
+	sound-spdif {
+		compatible = "fsl,imx-audio-spdif",
+			   "fsl,imx-sabreauto-spdif";
+		model = "imx-spdif";
+		spdif-controller = <&spdif>;
+		spdif-in;
+		spdif-out;
+	};
 };
 
 &fec1 {
@@ -405,6 +414,12 @@
 	};
 };
 
+&spdif {
+	pinctrl-names = "default";
+	pinctrl-0 = <&pinctrl_spdif_1>;
+	status = "disabled";
+};
+
 &uart1 {
 	pinctrl-names = "default";
 	pinctrl-0 = <&pinctrl_uart1_1>;
-- 
1.7.5.4

