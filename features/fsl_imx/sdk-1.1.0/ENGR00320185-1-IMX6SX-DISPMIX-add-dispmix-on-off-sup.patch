From fa2e35997e2e029338982da8e4634c6a1ab8c740 Mon Sep 17 00:00:00 2001
From: Fancy Fang <chen.fang@freescale.com>
Date: Thu, 8 May 2014 11:33:45 +0800
Subject: [PATCH 0426/1074] ENGR00320185-1 IMX6SX/DISPMIX: add dispmix on/off
 support for 6SX platform

Add the required clocks for the dispmix on/off operation.
This include clocks definition and initialization.

Signed-off-by: Fancy Fang <chen.fang@freescale.com>
[Original patch taken from git://git.freescale.com/imx/linux-2.6-imx.git]
Signed-off-by: Biyao Zhai <biyao.zhai@windriver.com>
---
 arch/arm/boot/dts/imx6sx.dtsi |    8 ++++++--
 arch/arm/mach-imx/gpc.c       |   10 +++++++++-
 2 files changed, 15 insertions(+), 3 deletions(-)

diff --git a/arch/arm/boot/dts/imx6sx.dtsi b/arch/arm/boot/dts/imx6sx.dtsi
index 3f3e1a6..0f3ee99 100644
--- a/arch/arm/boot/dts/imx6sx.dtsi
+++ b/arch/arm/boot/dts/imx6sx.dtsi
@@ -331,8 +331,12 @@
 				compatible = "fsl,imx6q-gpc";
 				reg = <0x020dc000 0x4000>;
 				interrupts = <0 89 0x04>;
-				clocks = <&clks IMX6SX_CLK_GPU>, <&clks IMX6SX_CLK_IPG>;
-				clock-names = "gpu3d_core", "ipg";
+				clocks = <&clks IMX6SX_CLK_GPU>, <&clks IMX6SX_CLK_IPG>,
+					<&clks IMX6SX_CLK_PXP_AXI>, <&clks IMX6SX_CLK_DISPLAY_AXI>,
+					<&clks IMX6SX_CLK_LCDIF1_PIX>, <&clks IMX6SX_CLK_LCDIF_APB>,
+					<&clks IMX6SX_CLK_LCDIF2_PIX>, <&clks IMX6SX_CLK_CSI>;
+				clock-names = "gpu3d_core", "ipg", "pxp_axi", "disp_axi", "lcdif1_pix",
+						"lcdif_axi", "lcdif2_pix", "csi_mclk";
 				pu-supply = <&pu_dummy>;
 				fsl,mf-mix-wakeup-irq = <0x7c00000 0x3d00 0x0 0x400200>;
 			};
diff --git a/arch/arm/mach-imx/gpc.c b/arch/arm/mach-imx/gpc.c
index 1a89df8..6ab2337 100644
--- a/arch/arm/mach-imx/gpc.c
+++ b/arch/arm/mach-imx/gpc.c
@@ -61,6 +61,7 @@ static u32 gpc_saved_imrs[IMR_NUM];
 static struct clk *gpu3d_clk, *gpu3d_shader_clk, *gpu2d_clk, *gpu2d_axi_clk;
 static struct clk *lcd_axi_clk, *lcd_pix_clk, *epdc_axi_clk, *epdc_pix_clk;
 static struct clk *pxp_axi_clk;
+static struct clk *disp_axi_clk, *lcdif_axi_clk, *lcdif1_pix_clk, *lcdif2_pix_clk, *csi_mclk;
 static struct clk *openvg_axi_clk, *vpu_clk, *ipg_clk;
 static struct device *gpc_dev;
 static struct regulator *pu_reg;
@@ -547,7 +548,14 @@ static int imx_gpc_probe(struct platform_device *pdev)
 	} else if (cpu_is_imx6sx()) {
 		gpu3d_clk = devm_clk_get(gpc_dev, "gpu3d_core");
 		ipg_clk = devm_clk_get(gpc_dev, "ipg");
-		if (IS_ERR(gpu3d_clk) || IS_ERR(ipg_clk)) {
+		pxp_axi_clk = devm_clk_get(gpc_dev, "pxp_axi");
+		disp_axi_clk = devm_clk_get(gpc_dev, "disp_axi");
+		lcdif1_pix_clk = devm_clk_get(gpc_dev, "lcdif1_pix");
+		lcdif_axi_clk = devm_clk_get(gpc_dev, "lcdif_axi");
+		lcdif2_pix_clk = devm_clk_get(gpc_dev, "lcdif2_pix");
+		csi_mclk = devm_clk_get(gpc_dev, "csi_mclk");
+		if (IS_ERR(gpu3d_clk) || IS_ERR(ipg_clk) || IS_ERR(pxp_axi_clk) || IS_ERR(disp_axi_clk) ||
+			IS_ERR(lcdif1_pix_clk) || IS_ERR(lcdif_axi_clk) || IS_ERR(lcdif2_pix_clk) || IS_ERR(csi_mclk)) {
 			dev_err(gpc_dev, "failed to get clk!\n");
 			return -ENOENT;
 		}
-- 
1.7.5.4

