From b55fbce771ebc04133292b80e2fc4e8930ee2b87 Mon Sep 17 00:00:00 2001
From: Richard Zhu <r65037@freescale.com>
Date: Wed, 9 Jul 2014 16:40:13 +0800
Subject: [PATCH 0892/1074] ENGR00322021-2 pcie:can't access pcie dbi register

fixed the but that the pcie dbi reg can't be accessed
on the 2014.04 version.
rootcause:
pcie phy test power down is set in 2014.04 version uboot.

solution:
clear the pcie phy test power down in the kernel pcie
driver initialization.

Signed-off-by: Richard Zhu <r65037@freescale.com>
[Original patch taken from git://git.freescale.com/imx/linux-2.6-imx.git]
Signed-off-by: Biyao Zhai <biyao.zhai@windriver.com>
---
 drivers/pci/host/pci-imx6.c |    3 +++
 1 files changed, 3 insertions(+), 0 deletions(-)

diff --git a/drivers/pci/host/pci-imx6.c b/drivers/pci/host/pci-imx6.c
index 9f809c4..5ee5a62 100644
--- a/drivers/pci/host/pci-imx6.c
+++ b/drivers/pci/host/pci-imx6.c
@@ -271,6 +271,9 @@ static int imx6_pcie_deassert_core_reset(struct pcie_port *pp)
 
 
 	if (is_imx6sx_pcie(imx6_pcie)) {
+		regmap_update_bits(imx6_pcie->iomuxc_gpr, IOMUXC_GPR12,
+				IMX6Q_GPR12_PCIE_TEST_PD, 0 << 30);
+
 		ret = clk_prepare_enable(imx6_pcie->dis_axi);
 		if (ret) {
 			dev_err(pp->dev, "unable to enable dis_axi\n");
-- 
1.7.5.4

