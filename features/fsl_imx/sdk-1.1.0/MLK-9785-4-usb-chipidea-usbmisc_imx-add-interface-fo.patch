From 8a37605ad1bf4c472ea1e3c66e73e07879b6b709 Mon Sep 17 00:00:00 2001
From: Peter Chen <peter.chen@freescale.com>
Date: Wed, 5 Nov 2014 14:54:28 +0800
Subject: [PATCH 0961/1074] MLK-9785-4 usb: chipidea: usbmisc_imx: add
 interface for common imx6 init

Add interface usbmisc_imx6_init for common imx6 initializations

Acked-by: Li Jun <b47624@freescale.com>
Signed-off-by: Peter Chen <peter.chen@freescale.com>
[Original patch taken from git://git.freescale.com/imx/linux-2.6-imx.git]
Signed-off-by: Biyao Zhai <biyao.zhai@windriver.com>
---
 drivers/usb/chipidea/usbmisc_imx.c |   24 +++++++++++++-----------
 1 files changed, 13 insertions(+), 11 deletions(-)

diff --git a/drivers/usb/chipidea/usbmisc_imx.c b/drivers/usb/chipidea/usbmisc_imx.c
index 6b8d610..dcf240c 100644
--- a/drivers/usb/chipidea/usbmisc_imx.c
+++ b/drivers/usb/chipidea/usbmisc_imx.c
@@ -176,14 +176,11 @@ static int usbmisc_imx53_init(struct imx_usbmisc_data *data)
 	return 0;
 }
 
-static int usbmisc_imx6q_init(struct imx_usbmisc_data *data)
+static void usbmisc_imx6_init(struct imx_usbmisc_data *data)
 {
 	unsigned long flags;
 	u32 val;
 
-	if (data->index > 3)
-		return -EINVAL;
-
 	if (data->disable_oc) {
 		spin_lock_irqsave(&usbmisc->lock, flags);
 		val = readl(usbmisc->base + data->index * 4);
@@ -191,6 +188,17 @@ static int usbmisc_imx6q_init(struct imx_usbmisc_data *data)
 			usbmisc->base + data->index * 4);
 		spin_unlock_irqrestore(&usbmisc->lock, flags);
 	}
+}
+
+static int usbmisc_imx6q_init(struct imx_usbmisc_data *data)
+{
+	unsigned long flags;
+	u32 val;
+
+	if (data->index > 3)
+		return -EINVAL;
+
+	usbmisc_imx6_init(data);
 
 	/* For HSIC controller */
 	if (data->index == 2 || data->index == 3) {
@@ -228,13 +236,7 @@ static int usbmisc_imx6sx_init(struct imx_usbmisc_data *data)
 	if (data->index > 2)
 		return -EINVAL;
 
-	if (data->disable_oc) {
-		spin_lock_irqsave(&usbmisc->lock, flags);
-		val = readl(usbmisc->base + data->index * 4);
-		writel(val | MX6_BM_OVER_CUR_DIS,
-			usbmisc->base + data->index * 4);
-		spin_unlock_irqrestore(&usbmisc->lock, flags);
-	}
+	usbmisc_imx6_init(data);
 
 	/* For HSIC controller */
 	if (data->index == 2) {
-- 
1.7.5.4

