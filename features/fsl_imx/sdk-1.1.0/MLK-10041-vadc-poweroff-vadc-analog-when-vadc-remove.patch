From 97892c14fdb31f6571780021abf0cb01de0783a3 Mon Sep 17 00:00:00 2001
From: Sandor Yu <R01008@freescale.com>
Date: Fri, 19 Dec 2014 16:59:42 +0800
Subject: [PATCH 0991/1074] MLK-10041 : vadc: poweroff vadc analog when vadc
 remove

Poweroff vadc analog and ext power when module remove.

Signed-off-by: Sandor Yu <R01008@freescale.com>
[Original patch taken from git://git.freescale.com/imx/linux-2.6-imx.git]
Signed-off-by: Biyao Zhai <biyao.zhai@windriver.com>
---
 drivers/media/platform/mxc/capture/mxc_vadc.c |   10 ++++++++++
 1 files changed, 10 insertions(+), 0 deletions(-)

diff --git a/drivers/media/platform/mxc/capture/mxc_vadc.c b/drivers/media/platform/mxc/capture/mxc_vadc.c
index 6b3d5f6..4756b40 100644
--- a/drivers/media/platform/mxc/capture/mxc_vadc.c
+++ b/drivers/media/platform/mxc/capture/mxc_vadc.c
@@ -397,6 +397,15 @@ static void vadc_power_up(struct vadc_data *vadc)
 	reg32setbit(gpc_regbase + GPC_CNTR, 18);
 }
 
+static void vadc_power_down(struct vadc_data *vadc)
+{
+     /* Power down vadc analog */
+     reg32setbit(gpc_regbase + GPC_CNTR, 17);
+
+     /* Power down vadc ext power */
+     reg32clrbit(gpc_regbase + GPC_CNTR, 18);
+}
+
 static void vadc_init(struct vadc_data *vadc)
 {
 	pr_debug("%s\n", __func__);
@@ -977,6 +986,7 @@ static int vadc_remove(struct platform_device *pdev)
 	clk_disable_unprepare(vadc->sen.sensor_clk);
 	clk_disable_unprepare(vadc->vadc_clk);
 
+	vadc_power_down(vadc);
 	return true;
 }
 
-- 
1.7.5.4

