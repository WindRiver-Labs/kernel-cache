From d54bee5ad13b818ea04ac310861f574fae2fed58 Mon Sep 17 00:00:00 2001
From: Oliver Brown <oliver.brown@freescale.com>
Date: Wed, 12 Mar 2014 11:21:02 -0500
Subject: [PATCH 0775/1074] ENGR00303200 [IPU Split] - Vertical line in
 downsaled image with ratio less 2

The optimal resize ratio should be used if the downscaler is not needed. This
will fix a vertical line in the center for some scaling ratios.

Signed-off-by: Oliver Brown <oliver.brown@freescale.com>
[Original patch taken from git://git.freescale.com/imx/linux-2.6-imx.git]
Signed-off-by: Biyao Zhai <biyao.zhai@windriver.com>
---
 drivers/mxc/ipu3/ipu_calc_stripes_sizes.c |    7 +++++--
 1 files changed, 5 insertions(+), 2 deletions(-)

diff --git a/drivers/mxc/ipu3/ipu_calc_stripes_sizes.c b/drivers/mxc/ipu3/ipu_calc_stripes_sizes.c
index 27abb06..c466ea9 100644
--- a/drivers/mxc/ipu3/ipu_calc_stripes_sizes.c
+++ b/drivers/mxc/ipu3/ipu_calc_stripes_sizes.c
@@ -388,8 +388,11 @@ int ipu_calc_stripes_sizes(const unsigned int input_frame_width,
 						     &resize_coeff,
 						     &downsize_coeff) < 0)
 				return -EINVAL;
-			left->irr = right->irr =
-				(downsize_coeff << 14) | resize_coeff;
+
+			if (downsize_coeff > 0) {
+				left->irr = right->irr =
+					(downsize_coeff << 14) | resize_coeff;
+			}
 		}
 		pr_debug("inw %d, onw %d, ilw %d, ilc %d, olw %d,"
 			 " irw %d, irc %d, orw %d, orc %d, "
-- 
1.7.5.4

