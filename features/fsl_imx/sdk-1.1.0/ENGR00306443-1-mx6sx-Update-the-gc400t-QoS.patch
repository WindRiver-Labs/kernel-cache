From c7f5ec5a7b2ff9d2a517604264d895a03c2acd77 Mon Sep 17 00:00:00 2001
From: Loren HUANG <b02279@freescale.com>
Date: Wed, 2 Apr 2014 17:15:12 +0800
Subject: [PATCH 0375/1074] ENGR00306443-1 mx6sx:Update the gc400t QoS

Per SoC team recommandation, update the gc400t QoS value to write 2
and Read 8. It can improve gpu performance in most case.

3d fill: 165->172Mpixel/s
2d fill: 190->228Mpixel/s

Signed-off-by: Loren HUANG <b02279@freescale.com>
[Original patch taken from git://git.freescale.com/imx/linux-2.6-imx.git]
Signed-off-by: Biyao Zhai <biyao.zhai@windriver.com>
---
 arch/arm/mach-imx/mach-imx6sx.c |   19 +++++++++++++++++++
 1 files changed, 19 insertions(+), 0 deletions(-)

diff --git a/arch/arm/mach-imx/mach-imx6sx.c b/arch/arm/mach-imx/mach-imx6sx.c
index 21c5184..da7b5e2 100644
--- a/arch/arm/mach-imx/mach-imx6sx.c
+++ b/arch/arm/mach-imx/mach-imx6sx.c
@@ -86,6 +86,24 @@ static inline void imx6sx_enet_init(void)
 	imx6sx_enet_clk_sel();
 }
 
+static inline void imx6sx_qos_init(void)
+{
+	struct device_node *np;
+	void __iomem *src_base;
+
+	np = of_find_compatible_node(NULL, NULL, "fsl,imx6sx-qosc");
+	if (!np)
+		return;
+	src_base = of_iomap(np, 0);
+	WARN_ON(!src_base);
+	writel_relaxed(0, src_base); /* Disable clkgate & soft_rst */
+	writel_relaxed(0, src_base+0x60); /* Enable all masters */
+	writel_relaxed(0, src_base+0x1400); /* Disable clkgate & soft_rst for gpu */
+	writel_relaxed(0x0f000222, src_base+0x1400+0xd0); /* Set Write QoS 2 for gpu */
+	writel_relaxed(0x0f000822, src_base+0x1400+0xe0); /* Set Read QoS 8 for gpu */
+	return;
+}
+
 static void __init imx6sx_init_machine(void)
 {
 	struct device *parent;
@@ -101,6 +119,7 @@ static void __init imx6sx_init_machine(void)
 	imx6sx_enet_init();
 	imx_anatop_init();
 	imx6q_pm_init();
+	imx6sx_qos_init();
 }
 
 static void __init imx6sx_map_io(void)
-- 
1.7.5.4

