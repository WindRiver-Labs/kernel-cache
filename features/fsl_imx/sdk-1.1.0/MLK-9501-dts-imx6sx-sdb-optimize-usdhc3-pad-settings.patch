From 9ffe7489882725799ec4b3abbc5174b43a205f65 Mon Sep 17 00:00:00 2001
From: Dong Aisheng <b29396@freescale.com>
Date: Tue, 18 Nov 2014 16:03:55 +0800
Subject: [PATCH 0532/1074] MLK-9501 dts: imx6sx-sdb: optimize usdhc3 pad
 settings

Detailed reproduce steps:
1. boot-up to Linux command prompt .
2. Plug SD3.0 UHS-I SD Card into SD3 Connector (make sure SD Card running
   at SD3.0 DDR50/1.8V).
2. write data to SD3 using "dd" command (SD3_CLK running at 1.8V/50MHz).
3. capture the SD3_CLK, SD3_DATA, SD3_CMD waveforms during data write using
   FET probe (>=1GHz)
4. CLK waveforms like triangular wave are observed.

HW team found that the pad setting of the SD3_CLK, SD3_DATA, SD3_CMD signal pins are
not optimized. In existing BSP, when running at SD3.0/DDR50/1.8V, SPEED/DSE/SRE
= 01/011/1 is used. They propose change it to -
 SD3_CLK: SPEED/DSE/SRE = 01/110/1.
 SD3_DATA/SD3_CMD: SPEED/DSE/SRE = 01/101/1.

SDHC high speed cards also had such issue(refer to MLK-9500).

We only changed the default state (<50Mhz) pad setting, for ultra high speed
state like 100Mhz and 200Mhz, it does not have such issue since they already
set to the maximum Drive Strength value.

Signed-off-by: Dong Aisheng <b29396@freescale.com>
[Original patch taken from git://git.freescale.com/imx/linux-2.6-imx.git]
Signed-off-by: Biyao Zhai <biyao.zhai@windriver.com>
---
 arch/arm/boot/dts/imx6sx-sdb.dts |   19 ++++++++++++++++++-
 1 files changed, 18 insertions(+), 1 deletions(-)

diff --git a/arch/arm/boot/dts/imx6sx-sdb.dts b/arch/arm/boot/dts/imx6sx-sdb.dts
index 8c011cf..79c1b70 100644
--- a/arch/arm/boot/dts/imx6sx-sdb.dts
+++ b/arch/arm/boot/dts/imx6sx-sdb.dts
@@ -385,6 +385,23 @@
 	pinctrl-names = "default";
 	pinctrl-0 = <&pinctrl_hog &pinctrl_can_gpios>;
 
+	usdhc3 {
+		pinctrl_usdhc3_1_sdb: usdhc3grp-1-sdb {
+			fsl,pins = <
+				MX6SX_PAD_SD3_CMD__USDHC3_CMD	  0x17069
+				MX6SX_PAD_SD3_CLK__USDHC3_CLK	  0x10071
+				MX6SX_PAD_SD3_DATA0__USDHC3_DATA0 0x17069
+				MX6SX_PAD_SD3_DATA1__USDHC3_DATA1 0x17069
+				MX6SX_PAD_SD3_DATA2__USDHC3_DATA2 0x17069
+				MX6SX_PAD_SD3_DATA3__USDHC3_DATA3 0x17069
+				MX6SX_PAD_SD3_DATA4__USDHC3_DATA4 0x17069
+				MX6SX_PAD_SD3_DATA5__USDHC3_DATA5 0x17069
+				MX6SX_PAD_SD3_DATA6__USDHC3_DATA6 0x17069
+				MX6SX_PAD_SD3_DATA7__USDHC3_DATA7 0x17069
+			>;
+		};
+	};
+
 	usdhc4 {
 		pinctrl_usdhc4_gpios: usdhc4-gpios {
 			fsl,pins = <
@@ -488,7 +505,7 @@
 
 &usdhc3 {
 	pinctrl-names = "default", "state_100mhz", "state_200mhz";
-	pinctrl-0 = <&pinctrl_usdhc3_1>;
+	pinctrl-0 = <&pinctrl_usdhc3_1_sdb>;
 	pinctrl-1 = <&pinctrl_usdhc3_1_100mhz>;
 	pinctrl-2 = <&pinctrl_usdhc3_1_200mhz>;
 	bus-width = <8>;
-- 
1.7.5.4

