From 057e2bd87b6d0c40102ff868791c0bf33c8e2f64 Mon Sep 17 00:00:00 2001
From: Dong Aisheng <b29396@freescale.com>
Date: Wed, 5 Mar 2014 16:57:27 +0800
Subject: [PATCH 0304/1074] ENGR00302227-4 dts: imx6sx-sdb: SD4 update

Add CD/WP support and fix pinctrl setting that SD4 slot on SDB board
is 4 bit, not 8 bit.

Signed-off-by: Dong Aisheng <b29396@freescale.com>
[Original patch taken from git://git.freescale.com/imx/linux-2.6-imx.git]
Signed-off-by: Biyao Zhai <biyao.zhai@windriver.com>
---
 arch/arm/boot/dts/imx6sx-sdb.dts |    8 +++++---
 arch/arm/boot/dts/imx6sx.dtsi    |   12 ++++++++++++
 2 files changed, 17 insertions(+), 3 deletions(-)

diff --git a/arch/arm/boot/dts/imx6sx-sdb.dts b/arch/arm/boot/dts/imx6sx-sdb.dts
index 1447787..5ff862d 100644
--- a/arch/arm/boot/dts/imx6sx-sdb.dts
+++ b/arch/arm/boot/dts/imx6sx-sdb.dts
@@ -241,6 +241,8 @@
 				MX6SX_PAD_KEY_COL0__GPIO2_IO_10	0x17059
 				MX6SX_PAD_KEY_ROW0__GPIO2_IO_15	0x17059
 				MX6SX_PAD_KEY_COL1__GPIO2_IO_11	0x17059
+				MX6SX_PAD_SD4_DATA7__GPIO6_IO_21 0x17059
+				MX6SX_PAD_SD4_DATA6__GPIO6_IO_20 0x17059
 			>;
 		};
 	};
@@ -274,10 +276,10 @@
 
 &usdhc4 {
 	pinctrl-names = "default";
-	pinctrl-0 = <&pinctrl_usdhc4_1>;
+	pinctrl-0 = <&pinctrl_usdhc4_2>;
 	bus-width = <8>;
-	non-removable;
-	/* need hw rework to enable signal voltage switch */
+	cd-gpios = <&gpio6 21 0>;
+	wp-gpios = <&gpio6 20 0>;
 	no-1-8-v;
 	status = "okay";
 };
diff --git a/arch/arm/boot/dts/imx6sx.dtsi b/arch/arm/boot/dts/imx6sx.dtsi
index 74c7ea3..59cf2e3 100644
--- a/arch/arm/boot/dts/imx6sx.dtsi
+++ b/arch/arm/boot/dts/imx6sx.dtsi
@@ -982,5 +982,17 @@
 					MX6SX_PAD_SD4_DATA7__USDHC4_DATA7 0x17059
 				>;
 			};
+
+			pinctrl_usdhc4_2: usdhc4grp-2 {
+				fsl,pins = <
+					MX6SX_PAD_SD4_CMD__USDHC4_CMD     0x17059
+					MX6SX_PAD_SD4_CLK__USDHC4_CLK     0x10059
+					MX6SX_PAD_SD4_DATA0__USDHC4_DATA0 0x17059
+					MX6SX_PAD_SD4_DATA1__USDHC4_DATA1 0x17059
+					MX6SX_PAD_SD4_DATA2__USDHC4_DATA2 0x17059
+					MX6SX_PAD_SD4_DATA3__USDHC4_DATA3 0x17059
+				>;
+			};
+
 	};
 };
-- 
1.7.5.4

