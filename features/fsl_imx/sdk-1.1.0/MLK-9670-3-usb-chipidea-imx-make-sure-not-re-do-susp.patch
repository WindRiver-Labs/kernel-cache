From 3696556dd4642c7943a828515b96e37b9cc2acaa Mon Sep 17 00:00:00 2001
From: Peter Chen <peter.chen@freescale.com>
Date: Thu, 9 Oct 2014 19:36:27 +0800
Subject: [PATCH 0936/1074] MLK-9670-3 usb: chipidea: imx: make sure not re-do
 suspend/resume operation

In case the other code (common or fsl internal) has bug in very rare
situations, the imx usb code makes sure it does not re-do
suspend/resume operation.

Signed-off-by: Peter Chen <peter.chen@freescale.com>
[Original patch taken from git://git.freescale.com/imx/linux-2.6-imx.git]
Signed-off-by: Biyao Zhai <biyao.zhai@windriver.com>
---
 drivers/usb/chipidea/ci_hdrc_imx.c |    6 ++++++
 1 files changed, 6 insertions(+), 0 deletions(-)

diff --git a/drivers/usb/chipidea/ci_hdrc_imx.c b/drivers/usb/chipidea/ci_hdrc_imx.c
index 9af016a..4c1886f 100644
--- a/drivers/usb/chipidea/ci_hdrc_imx.c
+++ b/drivers/usb/chipidea/ci_hdrc_imx.c
@@ -480,6 +480,9 @@ static int imx_controller_resume(struct device *dev)
 
 	WARN_ON(!data->in_lpm);
 
+	if (!data->in_lpm)
+		return 0;
+
 	ret = clk_prepare_enable(data->clk);
 	if (ret)
 		return ret;
@@ -571,6 +574,9 @@ static int ci_hdrc_imx_runtime_suspend(struct device *dev)
 
 	WARN_ON(data->in_lpm);
 
+	if (data->in_lpm)
+		return 0;
+
 	if (data->usbmisc_data) {
 		ret = imx_usbmisc_set_wakeup(data->usbmisc_data, true);
 		if (ret) {
-- 
1.7.5.4

