From 54bb35d92b3bcc72115d09b3d5268e3779a6b5e7 Mon Sep 17 00:00:00 2001
From: Robby Cai <R63905@freescale.com>
Date: Thu, 22 Aug 2013 14:39:42 +0800
Subject: [PATCH 0105/1074] ENGR00275031-2 ARM: dts: add lcdif and backlight
 support

Add dts for lcdif, backlight(pwm).
- use display timing dts bindings for lcd timing setting.
- add an axi clock node for mx23/mx28 to accommadate the change in driver

Signed-off-by: Robby Cai <R63905@freescale.com>
[Original patch taken from git://git.freescale.com/imx/linux-2.6-imx.git]
Signed-off-by: Biyao Zhai <biyao.zhai@windriver.com>
---
 arch/arm/boot/dts/imx23.dtsi     |    3 +-
 arch/arm/boot/dts/imx28.dtsi     |    3 +-
 arch/arm/boot/dts/imx6sl-evk.dts |   54 ++++++++++++++++++++++++++++++++++++++
 arch/arm/boot/dts/imx6sl.dtsi    |   54 ++++++++++++++++++++++++++++++++++++++
 4 files changed, 112 insertions(+), 2 deletions(-)

diff --git a/arch/arm/boot/dts/imx23.dtsi b/arch/arm/boot/dts/imx23.dtsi
index 581b754..d63de51 100644
--- a/arch/arm/boot/dts/imx23.dtsi
+++ b/arch/arm/boot/dts/imx23.dtsi
@@ -363,7 +363,8 @@
 				compatible = "fsl,imx23-lcdif";
 				reg = <0x80030000 2000>;
 				interrupts = <46 45>;
-				clocks = <&clks 38>;
+				clocks = <&clks 38>, <&clks 38>;
+				clock-names = "pix", "axi";
 				status = "disabled";
 			};
 
diff --git a/arch/arm/boot/dts/imx28.dtsi b/arch/arm/boot/dts/imx28.dtsi
index f8e9b20..f34d469 100644
--- a/arch/arm/boot/dts/imx28.dtsi
+++ b/arch/arm/boot/dts/imx28.dtsi
@@ -840,7 +840,8 @@
 				compatible = "fsl,imx28-lcdif";
 				reg = <0x80030000 0x2000>;
 				interrupts = <38>;
-				clocks = <&clks 55>;
+				clocks = <&clks 55>, <&clks 55>;
+				clock-names = "pix", "axi";
 				dmas = <&dma_apbh 13>;
 				dma-names = "rx";
 				status = "disabled";
diff --git a/arch/arm/boot/dts/imx6sl-evk.dts b/arch/arm/boot/dts/imx6sl-evk.dts
index 16717f8..5a62812 100644
--- a/arch/arm/boot/dts/imx6sl-evk.dts
+++ b/arch/arm/boot/dts/imx6sl-evk.dts
@@ -38,6 +38,20 @@
 			gpio = <&gpio4 2 0>;
 			enable-active-high;
 		};
+
+		reg_lcd_3v3: lcd-3v3 {
+			compatible = "regulator-fixed";
+			regulator-name = "lcd-3v3";
+			gpio = <&gpio4 3 0>;
+			enable-active-high;
+		};
+	};
+
+	backlight {
+		compatible = "pwm-backlight";
+		pwms = <&pwm1 0 5000000>;
+		brightness-levels = <0 4 8 16 32 64 128 255>;
+		default-brightness-level = <6>;
 	};
 };
 
@@ -107,11 +121,51 @@
 				MX6SL_PAD_FEC_TX_CLK__GPIO4_IO21  0x80000000
 				MX6SL_PAD_KEY_COL4__GPIO4_IO00	0x80000000
 				MX6SL_PAD_KEY_COL5__GPIO4_IO02	0x80000000
+				MX6SL_PAD_KEY_ROW5__GPIO4_IO03	  0x80000000
 			>;
 		};
 	};
 };
 
+&lcdif {
+	pinctrl-names = "default";
+	pinctrl-0 = <&pinctrl_lcdif_dat_0
+		     &pinctrl_lcdif_ctrl_0>;
+	lcd-supply = <&reg_lcd_3v3>;
+	display = <&display>;
+	status = "okay";
+
+	display: display {
+		bits-per-pixel = <16>;
+		bus-width = <24>;
+
+		display-timings {
+			native-mode = <&timing0>;
+			timing0: timing0 {
+				clock-frequency = <33500000>;
+				hactive = <800>;
+				vactive = <480>;
+				hback-porch = <89>;
+				hfront-porch = <164>;
+				vback-porch = <23>;
+				vfront-porch = <10>;
+				hsync-len = <10>;
+				vsync-len = <10>;
+				hsync-active = <0>;
+				vsync-active = <0>;
+				de-active = <1>;
+				pixelclk-active = <0>;
+			};
+		};
+	};
+};
+
+&pwm1 {
+	pinctrl-names = "default";
+	pinctrl-0 = <&pinctrl_pwm1_0>;
+	status = "okay";
+};
+
 &uart1 {
 	pinctrl-names = "default";
 	pinctrl-0 = <&pinctrl_uart1_1>;
diff --git a/arch/arm/boot/dts/imx6sl.dtsi b/arch/arm/boot/dts/imx6sl.dtsi
index 1b702b6..c32a3e5 100644
--- a/arch/arm/boot/dts/imx6sl.dtsi
+++ b/arch/arm/boot/dts/imx6sl.dtsi
@@ -794,6 +794,55 @@
 						>;
 					};
 				};
+
+				lcdif {
+					pinctrl_lcdif_dat_0: lcdifdatgrp-0 {
+						fsl,pins = <
+							MX6SL_PAD_LCD_DAT0__LCD_DATA00 0x1b0b0
+							MX6SL_PAD_LCD_DAT1__LCD_DATA01 0x1b0b0
+							MX6SL_PAD_LCD_DAT2__LCD_DATA02 0x1b0b0
+							MX6SL_PAD_LCD_DAT3__LCD_DATA03 0x1b0b0
+							MX6SL_PAD_LCD_DAT4__LCD_DATA04 0x1b0b0
+							MX6SL_PAD_LCD_DAT5__LCD_DATA05 0x1b0b0
+							MX6SL_PAD_LCD_DAT6__LCD_DATA06 0x1b0b0
+							MX6SL_PAD_LCD_DAT7__LCD_DATA07 0x1b0b0
+							MX6SL_PAD_LCD_DAT8__LCD_DATA08 0x1b0b0
+							MX6SL_PAD_LCD_DAT9__LCD_DATA09 0x1b0b0
+							MX6SL_PAD_LCD_DAT10__LCD_DATA10 0x1b0b0
+							MX6SL_PAD_LCD_DAT11__LCD_DATA11 0x1b0b0
+							MX6SL_PAD_LCD_DAT12__LCD_DATA12 0x1b0b0
+							MX6SL_PAD_LCD_DAT13__LCD_DATA13 0x1b0b0
+							MX6SL_PAD_LCD_DAT14__LCD_DATA14 0x1b0b0
+							MX6SL_PAD_LCD_DAT15__LCD_DATA15 0x1b0b0
+							MX6SL_PAD_LCD_DAT16__LCD_DATA16 0x1b0b0
+							MX6SL_PAD_LCD_DAT17__LCD_DATA17 0x1b0b0
+							MX6SL_PAD_LCD_DAT18__LCD_DATA18 0x1b0b0
+							MX6SL_PAD_LCD_DAT19__LCD_DATA19 0x1b0b0
+							MX6SL_PAD_LCD_DAT20__LCD_DATA20 0x1b0b0
+							MX6SL_PAD_LCD_DAT21__LCD_DATA21 0x1b0b0
+							MX6SL_PAD_LCD_DAT22__LCD_DATA22 0x1b0b0
+							MX6SL_PAD_LCD_DAT23__LCD_DATA23 0x1b0b0
+						>;
+					};
+
+					pinctrl_lcdif_ctrl_0: lcdifctrlgrp-0 {
+						fsl,pins = <
+							MX6SL_PAD_LCD_CLK__LCD_CLK 0x1b0b0
+							MX6SL_PAD_LCD_ENABLE__LCD_ENABLE 0x1b0b0
+							MX6SL_PAD_LCD_HSYNC__LCD_HSYNC 0x1b0b0
+							MX6SL_PAD_LCD_VSYNC__LCD_VSYNC 0x1b0b0
+							MX6SL_PAD_LCD_RESET__LCD_RESET 0x1b0b0
+						>;
+					};
+				};
+
+				pwm1 {
+					pinctrl_pwm1_0: pwm1grp-0 {
+						fsl,pins = <
+							MX6SL_PAD_PWM1__PWM1_OUT 0x110b0
+						>;
+					};
+				};
 			};
 
 			csi: csi@020e4000 {
@@ -833,8 +882,13 @@
 			};
 
 			lcdif: lcdif@020f8000 {
+				compatible = "fsl,imx6sl-lcdif", "fsl,imx28-lcdif";
 				reg = <0x020f8000 0x4000>;
 				interrupts = <0 39 0x04>;
+				clocks = <&clks IMX6SL_CLK_LCDIF_PIX>,
+					 <&clks IMX6SL_CLK_LCDIF_AXI>;
+				clock-names = "pix", "axi";
+				status = "disabled";
 			};
 
 			dcp: dcp@020fc000 {
-- 
1.7.5.4

