From 0492f74e5ea07d37a8ca6c248a4315e3c277d65b Mon Sep 17 00:00:00 2001
From: Richard Zhu <r65037@freescale.com>
Date: Fri, 29 Aug 2014 16:21:32 +0800
Subject: [PATCH 0917/1074] ENGR00329337 mfd: fix one compile warning in
 syscon

The function "hook_fault_code" is the __init type function.
There would be the following warning if the syscon_probe
is static int.
solution:
 move the hook_fault_code from syscon_probe to syscon_init.
Logs:
 Section mismatch in reference from the variable syscon_driver to the
 function .init.text:syscon_probe()
 The variable syscon_driver references
 the function __init syscon_probe()
 If the reference is valid then annotate the
 variable with __init* or __refdata (see linux/init.h) or name the
 variable:
 *_template, *_timer, *_sht, *_ops, *_probe, *_probe_one, *_console

Acked-by: Peter Chen <peter.chen@freescale.com>
Signed-off-by: Richard Zhu <r65037@freescale.com>
[Original patch taken from git://git.freescale.com/imx/linux-2.6-imx.git]
Signed-off-by: Biyao Zhai <biyao.zhai@windriver.com>
---
 drivers/mfd/syscon.c |   14 +++++++++-----
 1 files changed, 9 insertions(+), 5 deletions(-)

diff --git a/drivers/mfd/syscon.c b/drivers/mfd/syscon.c
index 48427af..14158f3 100644
--- a/drivers/mfd/syscon.c
+++ b/drivers/mfd/syscon.c
@@ -157,10 +157,6 @@ static int syscon_probe(struct platform_device *pdev)
 		return PTR_ERR(syscon->regmap);
 	}
 
-	/* Added for imprecise external abort handling */
-	hook_fault_code(16 + 6, syscon_regmap_abort_handler, SIGBUS, 0,
-		"imprecise external abort");
-
 	platform_set_drvdata(pdev, syscon);
 
 	dev_info(dev, "regmap %pR registered\n", res);
@@ -185,7 +181,15 @@ static struct platform_driver syscon_driver = {
 
 static int __init syscon_init(void)
 {
-	return platform_driver_register(&syscon_driver);
+	int ret;
+
+	ret = platform_driver_register(&syscon_driver);
+	if (ret == 0)
+		/* Added for imprecise external abort handling */
+		hook_fault_code(16 + 6, syscon_regmap_abort_handler, SIGBUS, 0,
+			"imprecise external abort");
+
+	return ret;
 }
 postcore_initcall(syscon_init);
 
-- 
1.7.5.4

