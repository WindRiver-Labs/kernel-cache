From 5588c907057d971a0e9f2da155957e62057e85e1 Mon Sep 17 00:00:00 2001
From: Fugang Duan <b38611@freescale.com>
Date: Wed, 9 Jul 2014 17:03:35 +0800
Subject: [PATCH 1066/1074] ENGR00322050 net: fec: remove the nonstandard
 performance optimaztion

The previous patch is to increase imx6sx enet performance, and then replace
wmb() with dmb(), whitch can get more 80Mbps improvement,  and don't find
any impact.

Now enet support TSO feature, remove the nonstandard performance optimaztion.

Signed-off-by: Fugang Duan <B38611@freescale.com>
[Original patch taken from git://git.freescale.com/imx/linux-2.6-imx.git]
Signed-off-by: Biyao Zhai <biyao.zhai@windriver.com>
---
 drivers/net/ethernet/freescale/fec_main.c |   13 ++++---------
 1 files changed, 4 insertions(+), 9 deletions(-)

diff --git a/drivers/net/ethernet/freescale/fec_main.c b/drivers/net/ethernet/freescale/fec_main.c
index 71705be..57e901e 100644
--- a/drivers/net/ethernet/freescale/fec_main.c
+++ b/drivers/net/ethernet/freescale/fec_main.c
@@ -542,10 +542,8 @@ static int fec_enet_txq_submit_skb(struct fec_enet_priv_tx_q *txq,
 		!__raw_readl(fep->hwp + FEC_X_DES_ACTIVE(queue)) ||
 		!__raw_readl(fep->hwp + FEC_X_DES_ACTIVE(queue)) ||
 		!__raw_readl(fep->hwp + FEC_X_DES_ACTIVE(queue)) ||
-		!__raw_readl(fep->hwp + FEC_X_DES_ACTIVE(queue))) {
-		dmb();
-		__raw_writel(0, fep->hwp + FEC_X_DES_ACTIVE(queue));
-	}
+		!__raw_readl(fep->hwp + FEC_X_DES_ACTIVE(queue)))
+		writel(0, fep->hwp + FEC_X_DES_ACTIVE(queue));
 
 	return 0;
 }
@@ -742,15 +740,12 @@ static int fec_enet_txq_submit_tso(struct fec_enet_priv_tx_q *txq,
 	txq->cur_tx = bdp;
 
 	/* Trigger transmission start */
-	/* Trigger transmission start */
 	if (!(id_entry->driver_data & FEC_QUIRK_TKT210582) ||
 		!__raw_readl(fep->hwp + FEC_X_DES_ACTIVE(queue)) ||
 		!__raw_readl(fep->hwp + FEC_X_DES_ACTIVE(queue)) ||
 		!__raw_readl(fep->hwp + FEC_X_DES_ACTIVE(queue)) ||
-		!__raw_readl(fep->hwp + FEC_X_DES_ACTIVE(queue))) {
-		dmb();
-		__raw_writel(0, fep->hwp + FEC_X_DES_ACTIVE(queue));
-	}
+		!__raw_readl(fep->hwp + FEC_X_DES_ACTIVE(queue)))
+		writel(0, fep->hwp + FEC_X_DES_ACTIVE(queue));
 
 	return 0;
 
-- 
1.7.5.4

