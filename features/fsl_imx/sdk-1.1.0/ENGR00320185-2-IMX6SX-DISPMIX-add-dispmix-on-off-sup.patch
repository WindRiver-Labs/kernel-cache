From d43394e9e4d56506bbed65b288c6022e3ca9ec99 Mon Sep 17 00:00:00 2001
From: Fancy Fang <chen.fang@freescale.com>
Date: Thu, 8 May 2014 17:20:43 +0800
Subject: [PATCH 0427/1074] ENGR00320185-2 IMX6SX/DISPMIX: add dispmix on/off
 support for 6SX platform

Modify the dispmix on/off interfaces to add
specific support for 6sx platform.

Signed-off-by: Fancy Fang <chen.fang@freescale.com>
[Original patch taken from git://git.freescale.com/imx/linux-2.6-imx.git]
Signed-off-by: Biyao Zhai <biyao.zhai@windriver.com>
---
 arch/arm/mach-imx/gpc.c |   50 +++++++++++++++++++++++++++++++---------------
 1 files changed, 34 insertions(+), 16 deletions(-)

diff --git a/arch/arm/mach-imx/gpc.c b/arch/arm/mach-imx/gpc.c
index 6ab2337..61a862e 100644
--- a/arch/arm/mach-imx/gpc.c
+++ b/arch/arm/mach-imx/gpc.c
@@ -79,25 +79,43 @@ static int pu_dummy_enable;
 
 static void imx_disp_clk(bool enable)
 {
-	if (enable) {
-		clk_prepare_enable(lcd_axi_clk);
-		clk_prepare_enable(lcd_pix_clk);
-		clk_prepare_enable(epdc_axi_clk);
-		clk_prepare_enable(epdc_pix_clk);
-		clk_prepare_enable(pxp_axi_clk);
-	} else {
-		clk_disable_unprepare(lcd_axi_clk);
-		clk_disable_unprepare(lcd_pix_clk);
-		clk_disable_unprepare(epdc_axi_clk);
-		clk_disable_unprepare(epdc_pix_clk);
-		clk_disable_unprepare(pxp_axi_clk);
+	if (cpu_is_imx6sl()) {
+		if (enable) {
+			clk_prepare_enable(lcd_axi_clk);
+			clk_prepare_enable(lcd_pix_clk);
+			clk_prepare_enable(epdc_axi_clk);
+			clk_prepare_enable(epdc_pix_clk);
+			clk_prepare_enable(pxp_axi_clk);
+		} else {
+			clk_disable_unprepare(lcd_axi_clk);
+			clk_disable_unprepare(lcd_pix_clk);
+			clk_disable_unprepare(epdc_axi_clk);
+			clk_disable_unprepare(epdc_pix_clk);
+			clk_disable_unprepare(pxp_axi_clk);
+		}
+	} else if (cpu_is_imx6sx()) {
+		if (enable) {
+			clk_prepare_enable(lcdif_axi_clk);
+			clk_prepare_enable(lcdif1_pix_clk);
+			clk_prepare_enable(lcdif2_pix_clk);
+			clk_prepare_enable(pxp_axi_clk);
+			clk_prepare_enable(csi_mclk);
+			clk_prepare_enable(disp_axi_clk);
+		} else {
+			clk_disable_unprepare(lcdif_axi_clk);
+			clk_disable_unprepare(lcdif1_pix_clk);
+			clk_disable_unprepare(lcdif2_pix_clk);
+			clk_disable_unprepare(pxp_axi_clk);
+			clk_disable_unprepare(csi_mclk);
+			clk_disable_unprepare(disp_axi_clk);
+		}
 	}
 }
 
 static void imx_gpc_dispmix_on(void)
 {
-	if (cpu_is_imx6sl() &&
-		imx_get_soc_revision() >= IMX_CHIP_REVISION_1_2) {
+	if ((cpu_is_imx6sl() &&
+		imx_get_soc_revision() >= IMX_CHIP_REVISION_1_2) || cpu_is_imx6sx()) {
 		imx_disp_clk(true);
 
 		writel_relaxed(0x0, gpc_base + GPC_PGC_DISP_PGCR_OFFSET);
@@ -112,8 +130,8 @@ static void imx_gpc_dispmix_on(void)
 
 static void imx_gpc_dispmix_off(void)
 {
-	if (cpu_is_imx6sl() &&
-		imx_get_soc_revision() >= IMX_CHIP_REVISION_1_2) {
+	if ((cpu_is_imx6sl() &&
+		imx_get_soc_revision() >= IMX_CHIP_REVISION_1_2) || cpu_is_imx6sx()) {
 		imx_disp_clk(true);
 
 		writel_relaxed(0xFFFFFFFF,
-- 
1.7.5.4

