From 0ef615b9f21cbbd38e3f637c08629984365b2b2e Mon Sep 17 00:00:00 2001
From: "Ye.Li" <B37916@freescale.com>
Date: Mon, 1 Dec 2014 17:28:47 +0800
Subject: [PATCH 0548/1074] MLK-9920 mtd: qspi: Add ddrsmp parameter to device
 tree

Since QSPI internal DDR sample point is relevant with board layout,
we can't use same value for all boards. Add ddrsmp parameter to device
tree for i.MX6SX Sabreauto/Sabresd board.

DDRSMP value:
[Original patch taken from git://git.freescale.com/imx/linux-2.6-imx.git]
Signed-off-by: Biyao Zhai <biyao.zhai@windriver.com>
0 ---- i.MX6SX Sabresd board (RevB and RevA)
2 ---- i.MX6SX Sabreauto board

The Sabresd RevA board also needs to reduce clock to 29Mhz according to
the Spansion spec.

Signed-off-by: Ye.Li <B37916@freescale.com>
(cherry picked from commit c9115cc22d836b5b980ca20932a005ea61b20082)
---
 arch/arm/boot/dts/imx6sx-sabreauto.dts |    1 +
 arch/arm/boot/dts/imx6sx-sdb-reva.dts  |    5 +++--
 arch/arm/boot/dts/imx6sx-sdb.dts       |    2 ++
 3 files changed, 6 insertions(+), 2 deletions(-)

diff --git a/arch/arm/boot/dts/imx6sx-sabreauto.dts b/arch/arm/boot/dts/imx6sx-sabreauto.dts
index 59f305d..23ea6f0 100644
--- a/arch/arm/boot/dts/imx6sx-sabreauto.dts
+++ b/arch/arm/boot/dts/imx6sx-sabreauto.dts
@@ -635,6 +635,7 @@
 	/* only map 128MB */
 	reg = <0x021e0000 0x4000>, <0x60000000 0x8000000>;
 	status = "okay";
+	ddrsmp=<2>;
 
 	flash0: n25q256a@0 {
 		#address-cells = <1>;
diff --git a/arch/arm/boot/dts/imx6sx-sdb-reva.dts b/arch/arm/boot/dts/imx6sx-sdb-reva.dts
index 1107e34..3308105 100644
--- a/arch/arm/boot/dts/imx6sx-sdb-reva.dts
+++ b/arch/arm/boot/dts/imx6sx-sdb-reva.dts
@@ -65,12 +65,13 @@
 	pinctrl-names = "default";
 	pinctrl-0 = <&pinctrl_qspi2_1>;
 	status = "okay";
+	ddrsmp=<0>;
 
 	flash0: s25fl128s@0 {
 		#address-cells = <1>;
 		#size-cells = <1>;
 		compatible = "spansion,s25fl128s";
-		spi-max-frequency = <66000000>;
+		spi-max-frequency = <29000000>;
 		reg = <0>;
 	};
 
@@ -78,7 +79,7 @@
 		#address-cells = <1>;
 		#size-cells = <1>;
 		compatible = "spansion,s25fl128s";
-		spi-max-frequency = <66000000>;
+		spi-max-frequency = <29000000>;
 		reg = <1>;
 	};
 };
diff --git a/arch/arm/boot/dts/imx6sx-sdb.dts b/arch/arm/boot/dts/imx6sx-sdb.dts
index 46061e1..0133f88 100644
--- a/arch/arm/boot/dts/imx6sx-sdb.dts
+++ b/arch/arm/boot/dts/imx6sx-sdb.dts
@@ -630,6 +630,8 @@
 	status = "okay";
 
 #ifndef SPANSIONFLASH
+	ddrsmp=<0>;
+
 	flash0: n25q256a@0 {
 		#address-cells = <1>;
 		#size-cells = <1>;
-- 
1.7.5.4

