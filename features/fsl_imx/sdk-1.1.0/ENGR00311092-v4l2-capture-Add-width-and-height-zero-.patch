From 59d62228aa911179b6520394a0a3cb8369c32bfb Mon Sep 17 00:00:00 2001
From: Sandor Yu <R01008@freescale.com>
Date: Wed, 30 Apr 2014 17:06:27 +0800
Subject: [PATCH 0819/1074] ENGR00311092 v4l2 capture: Add width and height
 zero check

Add width and height zero check to avoid kernel dump by the error
"Division by zero in kernel" when user application call the s_fmt api
with zero height and width

Signed-off-by: Sandor Yu <R01008@freescale.com>
[Original patch taken from git://git.freescale.com/imx/linux-2.6-imx.git]
Signed-off-by: Biyao Zhai <biyao.zhai@windriver.com>
---
 .../media/platform/mxc/capture/csi_v4l2_capture.c  |    6 ++++++
 1 files changed, 6 insertions(+), 0 deletions(-)

diff --git a/drivers/media/platform/mxc/capture/csi_v4l2_capture.c b/drivers/media/platform/mxc/capture/csi_v4l2_capture.c
index 6072906..98c9f21 100644
--- a/drivers/media/platform/mxc/capture/csi_v4l2_capture.c
+++ b/drivers/media/platform/mxc/capture/csi_v4l2_capture.c
@@ -916,6 +916,12 @@ static int csi_v4l2_s_fmt(cam_data *cam, struct v4l2_format *f)
 			height = &f->fmt.pix.height;
 		}
 
+		if (*width == 0 || *height == 0) {
+			pr_err("ERROR: csi v4l2 capture: width or height"
+				" too small.\n");
+			return -EINVAL;
+		}
+
 		if ((cam->crop_bounds.width / *width > 8) ||
 		    ((cam->crop_bounds.width / *width == 8) &&
 		     (cam->crop_bounds.width % *width))) {
-- 
1.7.5.4

