From 5da77349544031476f645f96b67f72c355eb4b7b Mon Sep 17 00:00:00 2001
From: Peter Chen <peter.chen@freescale.com>
Date: Thu, 27 Mar 2014 15:23:02 +0800
Subject: [PATCH 0355/1074] ENGR00305549 ARM: imx6sx-sdb: enable USB function

usbotg1 is for dual-role function, usbotg2 is dedicated
to host function.

Signed-off-by: Peter Chen <peter.chen@freescale.com>
[Original patch taken from git://git.freescale.com/imx/linux-2.6-imx.git]
Signed-off-by: Biyao Zhai <biyao.zhai@windriver.com>
---
 arch/arm/boot/dts/imx6sx-sdb.dts     |   32 ++++++++++++++++++++++++++++++++
 arch/arm/boot/dts/imx6sx-sdb.dts.rej |   10 ++++++++++
 2 files changed, 42 insertions(+), 0 deletions(-)
 create mode 100644 arch/arm/boot/dts/imx6sx-sdb.dts.rej

diff --git a/arch/arm/boot/dts/imx6sx-sdb.dts b/arch/arm/boot/dts/imx6sx-sdb.dts
index aff68d3..514ff92 100644
--- a/arch/arm/boot/dts/imx6sx-sdb.dts
+++ b/arch/arm/boot/dts/imx6sx-sdb.dts
@@ -72,6 +72,25 @@
 			regulator-min-microvolt = <3300000>;
 			regulator-max-microvolt = <3300000>;
 		};
+
+		reg_usb_otg1_vbus: usb_otg1_vbus {
+			compatible = "regulator-fixed";
+			regulator-name = "usb_otg1_vbus";
+			regulator-min-microvolt = <5000000>;
+			regulator-max-microvolt = <5000000>;
+			gpio = <&gpio1 9 0>;
+			enable-active-high;
+		};
+
+		reg_usb_otg2_vbus: usb_otg2_vbus {
+			compatible = "regulator-fixed";
+			regulator-name = "usb_otg2_vbus";
+			regulator-min-microvolt = <5000000>;
+			regulator-max-microvolt = <5000000>;
+			gpio = <&gpio1 12 0>;
+			enable-active-high;
+		};
+
 	};
 
 	csi1_v4l2_cap {
@@ -340,6 +359,19 @@
 	status = "okay";
 };
 
+&usbotg1 {
+	vbus-supply = <&reg_usb_otg1_vbus>;
+	pinctrl-names = "default";
+	pinctrl-0 = <&pinctrl_usbotg1_1>;
+	status = "okay";
+};
+
+&usbotg2 {
+	vbus-supply = <&reg_usb_otg2_vbus>;
+	dr_mode = "host";
+	status = "okay";
+};
+
 &usdhc2 {
 	pinctrl-names = "default";
 	pinctrl-0 = <&pinctrl_usdhc2_1>;
diff --git a/arch/arm/boot/dts/imx6sx-sdb.dts.rej b/arch/arm/boot/dts/imx6sx-sdb.dts.rej
new file mode 100644
index 0000000..e3db081
--- /dev/null
+++ b/arch/arm/boot/dts/imx6sx-sdb.dts.rej
@@ -0,0 +1,10 @@
+--- arch/arm/boot/dts/imx6sx-sdb.dts
++++ arch/arm/boot/dts/imx6sx-sdb.dts
+@@ -97,6 +97,7 @@
+ 			"IN3R", "AMIC";
+ 		mux-int-port = <2>;
+ 		mux-ext-port = <6>;
++		hp-det-gpios = <&gpio1 17 1>;
+ 	};
+ 
+ 	csi1_v4l2_cap {
-- 
1.7.5.4

