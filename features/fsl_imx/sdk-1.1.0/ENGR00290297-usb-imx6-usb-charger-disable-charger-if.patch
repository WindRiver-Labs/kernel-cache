From aa63db176d7498156b1c4534ec6526923bf12478 Mon Sep 17 00:00:00 2001
From: Peter Chen <peter.chen@freescale.com>
Date: Thu, 28 Nov 2013 16:06:44 +0800
Subject: [PATCH 0646/1074] ENGR00290297 usb: imx6-usb-charger: disable
 charger if it has not configurated

If the user set imx6-usb-charger-detection at dts, but not enable
CONFIG_IMX6_USB_CHARGER, the imx6_usb_create_charger will return
-ENODEV, and the controlller probe will fail, it is not we want,
what we expect is the charger detection has disabled, but controller
function should not be affected.

Signed-off-by: Peter Chen <peter.chen@freescale.com>
[Original patch taken from git://git.freescale.com/imx/linux-2.6-imx.git]
Signed-off-by: Biyao Zhai <biyao.zhai@windriver.com>
---
 drivers/usb/chipidea/ci_hdrc_imx.c |    5 +++--
 1 files changed, 3 insertions(+), 2 deletions(-)

diff --git a/drivers/usb/chipidea/ci_hdrc_imx.c b/drivers/usb/chipidea/ci_hdrc_imx.c
index ddaeb97..f77fbfa 100644
--- a/drivers/usb/chipidea/ci_hdrc_imx.c
+++ b/drivers/usb/chipidea/ci_hdrc_imx.c
@@ -239,9 +239,10 @@ static int ci_hdrc_imx_probe(struct platform_device *pdev)
 		data->charger.dev = &pdev->dev;
 		ret = imx6_usb_create_charger(&data->charger,
 			"imx6_usb_charger");
-		if (ret)
+		if (ret && ret != -ENODEV)
 			goto err_clk;
-		dev_dbg(&pdev->dev, "USB Charger is created\n");
+		if (!ret)
+			dev_dbg(&pdev->dev, "USB Charger is created\n");
 	}
 
 	data->ci_pdev = ci_hdrc_add_device(&pdev->dev,
-- 
1.7.5.4

