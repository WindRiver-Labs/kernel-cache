From f146e4f258bfaf34e631120b0dfffa82c73b2fbb Mon Sep 17 00:00:00 2001
From: Luwei Zhou <b45643@freescale.com>
Date: Mon, 24 Feb 2014 10:44:40 +0800
Subject: [PATCH 0282/1074] ENGR00299593-2 ARM: dts: imx6sx-17X17-arm2: add
 max7322 gpio regulator dts support

FEC on imx6sx-17X17arm2 needs to make PHY work in 1.8v power supply.
The 1.8v power supply is controlled by max7322 output0 pin.Enable
max7322 dts support and phy regulator on imx6sx-17x17-arm2 platform
in this patch.

Signed-off-by: Luwei Zhou <b45643@freescale.com>
[Original patch taken from git://git.freescale.com/imx/linux-2.6-imx.git]
Signed-off-by: Biyao Zhai <biyao.zhai@windriver.com>
---
 arch/arm/boot/dts/imx6sx-17x17-arm2.dts |   44 +++++++++++++++++++++++++++++++
 1 files changed, 44 insertions(+), 0 deletions(-)

diff --git a/arch/arm/boot/dts/imx6sx-17x17-arm2.dts b/arch/arm/boot/dts/imx6sx-17x17-arm2.dts
index f6af9ad..829120c 100644
--- a/arch/arm/boot/dts/imx6sx-17x17-arm2.dts
+++ b/arch/arm/boot/dts/imx6sx-17x17-arm2.dts
@@ -21,6 +21,13 @@
 		default-brightness-level = <6>;
 	};
 
+	max7322_reset: max7322-reset {
+		compatible = "gpio-reset";
+		reset-gpios = <&gpio4 22 GPIO_ACTIVE_LOW>;
+		reset-delay-us = <1>;
+		#reset-cells = <0>;
+	};
+
 	pxp_v4l2_out {
 		compatible = "fsl,imx6sx-pxp-v4l2", "fsl,imx6sl-pxp-v4l2";
 		status = "okay";
@@ -29,6 +36,21 @@
 	memory {
 		reg = <0x80000000 0x40000000>;
 	};
+
+	regulators {
+		compatible = "simple-bus";
+		#address-cells = <1>;
+		#size-cells = <0>;
+
+		reg_rgmii_1v8: regulator@0 {
+			compatible = "regulator-fixed";
+			regulator-name = "vcc_rgmii_1v8_io";
+			regulator-min-microvolt = <1800000>;
+			regulator-max-microvolt = <1800000>;
+			gpio = <&max7322 0 0>;
+			enable-active-high;
+		};
+	};
 };
 
 &fec1 {
@@ -37,6 +59,7 @@
 	phy-mode = "rgmii";
 	fsl,num_tx_queues=<3>;
 	fsl,num_rx_queues=<3>;
+	phy-supply = <&reg_rgmii_1v8>;
 	status = "okay";
 };
 
@@ -69,6 +92,14 @@
         pinctrl-names = "default";
         pinctrl-0 = <&pinctrl_i2c2_1>;
         status = "okay";
+
+	max7322: gpio@68 {
+		compatible = "maxim,max7322";
+		reg = <0x68>;
+		gpio-controller;
+		#gpio-cells = <2>;
+		resets = <&max7322_reset>;
+	};
 };
 
 
@@ -86,6 +117,19 @@
         status = "okay";
 };
 
+&iomuxc {
+	pinctrl-names = "default";
+	pinctrl-0 = <&pinctrl_hog_1>;
+
+	hog {
+		pinctrl_hog_1: hoggrp-1 {
+			fsl,pins = <
+				MX6SX_PAD_QSPI1A_SS0_B__GPIO4_IO_22     0x80000000
+			 >;
+		};
+	};
+};
+
 &lcdif1 {
 	pinctrl-names = "default";
 	pinctrl-0 = <&pinctrl_lcdif_dat_0
-- 
1.7.5.4

