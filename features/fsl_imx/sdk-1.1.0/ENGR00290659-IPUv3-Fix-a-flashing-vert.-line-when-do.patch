From b5148ec67c51f3c5bd7649cee4fd91c16867f559 Mon Sep 17 00:00:00 2001
From: Oliver Brown <oliver.brown@freescale.com>
Date: Wed, 19 Feb 2014 17:32:48 -0600
Subject: [PATCH 0720/1074] ENGR00290659 IPUv3: Fix a flashing vert. line when
 downsizing 1080i to 300x400.

When split mode deinterlacing is the ipu_calc_stripes_sizes() was failing due
to an unnecessary test. Added logic to use the maximal_stripe_width only if
the flag parameter has the bit 0 clear for not equal stripe sizes.

Signed-off-by: Oliver Brown <oliver.brown@freescale.com>
[Original patch taken from git://git.freescale.com/imx/linux-2.6-imx.git]
Signed-off-by: Biyao Zhai <biyao.zhai@windriver.com>
---
 drivers/mxc/ipu3/ipu_calc_stripes_sizes.c |    5 +++--
 1 files changed, 3 insertions(+), 2 deletions(-)

diff --git a/drivers/mxc/ipu3/ipu_calc_stripes_sizes.c b/drivers/mxc/ipu3/ipu_calc_stripes_sizes.c
index ea54707..27abb06 100644
--- a/drivers/mxc/ipu3/ipu_calc_stripes_sizes.c
+++ b/drivers/mxc/ipu3/ipu_calc_stripes_sizes.c
@@ -1,5 +1,5 @@
 /*
- * Copyright 2009-2013 Freescale Semiconductor, Inc. All Rights Reserved.
+ * Copyright 2009-2014 Freescale Semiconductor, Inc. All Rights Reserved.
  */
 
 /*
@@ -295,7 +295,8 @@ int ipu_calc_stripes_sizes(const unsigned int input_frame_width,
 	    || ((((u64)output_frame_width) << 32) <
 		(2 * ((((u64)output_f) << 32) + (input_f * rr_opt))))
 	    || (maximal_stripe_width < output_f)
-	    || (output_frame_width <= maximal_stripe_width)
+	    || ((output_frame_width <= maximal_stripe_width)
+		&& (equal_stripes == 0))
 	    || ((2 * maximal_stripe_width) < output_frame_width))
 		return 1;
 
-- 
1.7.5.4

