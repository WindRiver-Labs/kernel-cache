From 821445a7637e31cb488c0c12145ef5672592742e Mon Sep 17 00:00:00 2001
From: Robby Cai <r63905@freescale.com>
Date: Mon, 24 Nov 2014 17:05:37 +0800
Subject: [PATCH 0541/1074] MLK-9906 imx6sl: make epdc pixel clock derive from
 PLL2_PFD1

Previously the pixel clock for LCDIF and EPDC shares the same parent clock
PLL5_VIDEO. This will bring the following error boot message:

clk_pllv3_av_set_rate: cannot configure divider when PLL is powered on

The reason is the dual-display case breaks the rule added by the
patch "93a9e3d0b88203cb523dd92e85590683d6a85fdf ENGR00318063-6:
ARM: imx6: add CLK_SET_RATE_GATE flag for PLL clocks" which adds the
requirement "the clock must be gated across rate change"

After LCDIF pixel clock is configured and enabled, EPDC pixel clock
need to be configured also but the parent PLL is already enabled by
LCDIF driver thus the configuration will fail.

On i.MX6SL, we need support LCD display and EPDC display simultaneously,
then we cannot disable the PLL clock when LCD or EPDC is working already.
So we switch the parent for EPDC pixel clock to PLL2_PFD1.

Signed-off-by: Robby Cai <r63905@freescale.com>
(cherry picked from commit 8aa38347f486124f0bcec767b721a820fbae7010)
[Original patch taken from git://git.freescale.com/imx/linux-2.6-imx.git]
Signed-off-by: Biyao Zhai <biyao.zhai@windriver.com>
---
 arch/arm/mach-imx/clk-imx6sl.c |    2 +-
 1 files changed, 1 insertions(+), 1 deletions(-)

diff --git a/arch/arm/mach-imx/clk-imx6sl.c b/arch/arm/mach-imx/clk-imx6sl.c
index 9e7b3fa..1432df6 100644
--- a/arch/arm/mach-imx/clk-imx6sl.c
+++ b/arch/arm/mach-imx/clk-imx6sl.c
@@ -349,7 +349,7 @@ static void __init imx6sl_clocks_init(struct device_node *ccm_node)
 	clk_set_rate(clks[IMX6SL_CLK_SPDIF0_PODF], 227368421);
 
 	clk_set_parent(clks[IMX6SL_CLK_EPDC_PIX_SEL],
-			clks[IMX6SL_CLK_PLL5_VIDEO_DIV]);
+			clks[IMX6SL_CLK_PLL2_PFD1]);
 
 	clk_set_parent(clks[IMX6SL_CLK_EPDC_AXI_SEL], clks[IMX6SL_CLK_PLL2_PFD2]);
 	clk_set_rate(clks[IMX6SL_CLK_EPDC_AXI], 200000000);
-- 
1.7.5.4

