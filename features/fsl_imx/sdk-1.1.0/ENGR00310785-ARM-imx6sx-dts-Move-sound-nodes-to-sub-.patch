From 5180b95a0532eb30f74622b6000a29395a717ac5 Mon Sep 17 00:00:00 2001
From: Nicolin Chen <Guangyu.Chen@freescale.com>
Date: Mon, 28 Apr 2014 15:04:16 +0800
Subject: [PATCH 0398/1074] ENGR00310785 ARM: imx6sx: dts: Move sound nodes to
 sub-dts for arm2 boards

We disable spdif and sai in imx6sx-*-arm2.dts and only enable them
in their sub-dts like imx6sx-17x17-arm2-spdif.dts while we haven't
put the sound nodes into the sub-dts because the dependancy between
sound and spdif/sai. This would result people get the frequent -517
probe error everytime they insert a new device or module.

So this patch puts them to the sub-dts.

Signed-off-by: Nicolin Chen <Guangyu.Chen@freescale.com>
[Original patch taken from git://git.freescale.com/imx/linux-2.6-imx.git]
Signed-off-by: Biyao Zhai <biyao.zhai@windriver.com>
---
 arch/arm/boot/dts/imx6sx-17x17-arm2-spdif.dts |   11 +++++++++++
 arch/arm/boot/dts/imx6sx-17x17-arm2.dts       |    9 ---------
 arch/arm/boot/dts/imx6sx-19x19-arm2-sai.dts   |   13 +++++++++++++
 arch/arm/boot/dts/imx6sx-19x19-arm2.dts       |   11 -----------
 4 files changed, 24 insertions(+), 20 deletions(-)

diff --git a/arch/arm/boot/dts/imx6sx-17x17-arm2-spdif.dts b/arch/arm/boot/dts/imx6sx-17x17-arm2-spdif.dts
index c69db8b..9f2843c 100644
--- a/arch/arm/boot/dts/imx6sx-17x17-arm2-spdif.dts
+++ b/arch/arm/boot/dts/imx6sx-17x17-arm2-spdif.dts
@@ -8,6 +8,17 @@
 
 #include "imx6sx-17x17-arm2.dts"
 
+/ {
+	sound-spdif {
+		compatible = "fsl,imx-audio-spdif",
+			   "fsl,imx-sabreauto-spdif";
+		model = "imx-spdif";
+		spdif-controller = <&spdif>;
+		spdif-in;
+		spdif-out;
+	};
+};
+
 &audmux {
 	/* pin conflict with spdif */
 	status = "disabled";
diff --git a/arch/arm/boot/dts/imx6sx-17x17-arm2.dts b/arch/arm/boot/dts/imx6sx-17x17-arm2.dts
index 50d1e08..6963d98 100644
--- a/arch/arm/boot/dts/imx6sx-17x17-arm2.dts
+++ b/arch/arm/boot/dts/imx6sx-17x17-arm2.dts
@@ -110,15 +110,6 @@
 		spi-max-frequency = <20000000>;
 		reg = <0>;
 	};
-
-	sound-spdif {
-		compatible = "fsl,imx-audio-spdif",
-			   "fsl,imx-sabreauto-spdif";
-		model = "imx-spdif";
-		spdif-controller = <&spdif>;
-		spdif-in;
-		spdif-out;
-	};
 };
 
 &fec1 {
diff --git a/arch/arm/boot/dts/imx6sx-19x19-arm2-sai.dts b/arch/arm/boot/dts/imx6sx-19x19-arm2-sai.dts
index f0f2326..51754d3 100644
--- a/arch/arm/boot/dts/imx6sx-19x19-arm2-sai.dts
+++ b/arch/arm/boot/dts/imx6sx-19x19-arm2-sai.dts
@@ -8,6 +8,19 @@
 
 #include "imx6sx-19x19-arm2.dts"
 
+/ {
+	sound-sgtl5000 {
+		compatible = "fsl,imx6sx-arm2-sgtl5000",
+			   "fsl,imx-audio-sgtl5000";
+		model = "imx6sx-arm2-sgtl5000";
+		cpu-dai = <&sai1>;
+		audio-codec = <&sgtl5000>;
+		audio-routing =
+			"LINE_IN", "Line In Jack",
+			"Headphone Jack", "HP_OUT";
+	};
+};
+
 &esai {
 	/* pin conflict with sai */
 	status = "disabled";
diff --git a/arch/arm/boot/dts/imx6sx-19x19-arm2.dts b/arch/arm/boot/dts/imx6sx-19x19-arm2.dts
index 1125e94..e7abb2a 100644
--- a/arch/arm/boot/dts/imx6sx-19x19-arm2.dts
+++ b/arch/arm/boot/dts/imx6sx-19x19-arm2.dts
@@ -87,17 +87,6 @@
 		asrc-controller = <&asrc_p2p>;
 		audio-codec = <&cs42888>;
 	};
-
-	sound-sgtl5000 {
-		compatible = "fsl,imx6sx-arm2-sgtl5000",
-			   "fsl,imx-audio-sgtl5000";
-		model = "imx6sx-arm2-sgtl5000";
-		cpu-dai = <&sai1>;
-		audio-codec = <&sgtl5000>;
-		audio-routing =
-			"LINE_IN", "Line In Jack",
-			"Headphone Jack", "HP_OUT";
-	};
 };
 
 &esai {
-- 
1.7.5.4

