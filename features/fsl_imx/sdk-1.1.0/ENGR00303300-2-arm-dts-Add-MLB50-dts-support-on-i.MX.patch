From 19278bd2dee41d8e0f76c8d2b9704749b8f3aba2 Mon Sep 17 00:00:00 2001
From: Luwei Zhou <b45643@freescale.com>
Date: Thu, 13 Mar 2014 16:51:25 +0800
Subject: [PATCH 0321/1074] ENGR00303300-2 arm: dts: Add MLB50 dts support on
 i.MX6SX-17x17-arm2 board.

Add MLB50 devicetree support on i.MX6SX-17x17-arm2 platform. Since the MLB50 has
pin conflict with usdhc2 on i.MX6SX-17x17-arm2 board, add an extra dts file to
enable mlb and disable usdhc2.

Signed-off-by: Luwei Zhou <b45643@freescale.com>
[Original patch taken from git://git.freescale.com/imx/linux-2.6-imx.git]
Signed-off-by: Biyao Zhai <biyao.zhai@windriver.com>
---
 arch/arm/boot/dts/imx6sx-17x17-arm2-mlb.dts |   18 ++++++++++++++++++
 arch/arm/boot/dts/imx6sx-17x17-arm2.dts     |    6 ++++++
 arch/arm/boot/dts/imx6sx.dtsi               |   20 ++++++++++++++++++++
 3 files changed, 44 insertions(+), 0 deletions(-)
 create mode 100644 arch/arm/boot/dts/imx6sx-17x17-arm2-mlb.dts

diff --git a/arch/arm/boot/dts/imx6sx-17x17-arm2-mlb.dts b/arch/arm/boot/dts/imx6sx-17x17-arm2-mlb.dts
new file mode 100644
index 0000000..1a64bec
--- /dev/null
+++ b/arch/arm/boot/dts/imx6sx-17x17-arm2-mlb.dts
@@ -0,0 +1,18 @@
+/*
+ * Copyright (C) 2014 Freescale Semiconductor, Inc.
+ *
+ * This program is free software; you can redistribute it and/or modify
+ * it under the terms of the GNU General Public License version 2 as
+ * published by the Free Software Foundation.
+ */
+
+#include "imx6sx-17x17-arm2.dts"
+
+&mlb {
+	status = "okay";
+};
+
+&usdhc2 {
+	/* pin conflict with mlb */
+	status = "disabled";
+};
diff --git a/arch/arm/boot/dts/imx6sx-17x17-arm2.dts b/arch/arm/boot/dts/imx6sx-17x17-arm2.dts
index b111bae..8f4dfd8 100644
--- a/arch/arm/boot/dts/imx6sx-17x17-arm2.dts
+++ b/arch/arm/boot/dts/imx6sx-17x17-arm2.dts
@@ -335,6 +335,12 @@
 	};
 };
 
+&mlb {
+	pinctrl-names = "default";
+	pinctrl-0 = <&pinctrl_mlb_1>;
+	status = "disabled";/* pin conflict with usdhc2*/
+};
+
 &pwm3 {
 	pinctrl-names = "default";
 	pinctrl-0 = <&pinctrl_pwm3_0>;
diff --git a/arch/arm/boot/dts/imx6sx.dtsi b/arch/arm/boot/dts/imx6sx.dtsi
index d70e6d9..7eb22fd 100644
--- a/arch/arm/boot/dts/imx6sx.dtsi
+++ b/arch/arm/boot/dts/imx6sx.dtsi
@@ -414,6 +414,16 @@
 				status = "disabled";
                         };
 
+			mlb: mlb@0218c000 {
+				compatible = "fsl,imx6sx-mlb50";
+				reg = <0x0218c000 0x4000>;
+				interrupts = <0 53 0x04 0 117 0x04 0 126 0x04>;
+				clocks = <&clks IMX6SX_CLK_MLB>;
+				clock-names = "mlb";
+				iram = <&ocram>;
+				status = "disabled";
+			};
+
 			fec2: ethernet@021b4000 {
 				compatible = "fsl,imx6sx-fec";
 				reg = <0x021b4000 0x4000>;
@@ -827,6 +837,16 @@
 		};
 	};
 
+	mlb {
+		pinctrl_mlb_1: mlbgrp-1 {
+			fsl,pins = <
+				MX6SX_PAD_SD2_DATA3__MLB_DATA	0x31
+				MX6SX_PAD_SD2_CLK__MLB_SIG	0x31
+				MX6SX_PAD_SD2_CMD__MLB_CLK	0x31
+			>;
+		};
+	};
+
 	pwm3 {
 		pinctrl_pwm3_0: pwm3grp-0 {
 			fsl,pins = <
-- 
1.7.5.4

