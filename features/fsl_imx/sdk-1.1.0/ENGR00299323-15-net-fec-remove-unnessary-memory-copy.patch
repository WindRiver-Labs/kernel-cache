From 2b9aef08299fd0ed8f5bbd6e2d7bed11ef979c5e Mon Sep 17 00:00:00 2001
From: Fugang Duan <B38611@freescale.com>
Date: Thu, 16 Jan 2014 12:54:36 +0800
Subject: [PATCH 1035/1074] ENGR00299323-15 net:fec: remove unnessary memory
 copy for address alignment in .xmit()

i.MX6SX enet-avb IP support buffer address byte alignment for tx DMA
transfer, so remove the unnessary memory copy for the enet avb IP.

Signed-off-by: Fugang Duan <B38611@freescale.com>
[Original patch taken from git://git.freescale.com/imx/linux-2.6-imx.git]
Signed-off-by: Biyao Zhai <biyao.zhai@windriver.com>
---
 drivers/net/ethernet/freescale/fec_main.c |    3 ++-
 1 files changed, 2 insertions(+), 1 deletions(-)

diff --git a/drivers/net/ethernet/freescale/fec_main.c b/drivers/net/ethernet/freescale/fec_main.c
index 5066783..54544c2 100644
--- a/drivers/net/ethernet/freescale/fec_main.c
+++ b/drivers/net/ethernet/freescale/fec_main.c
@@ -377,7 +377,8 @@ fec_enet_start_xmit(struct sk_buff *skb, struct net_device *ndev)
 	else
 		index = bdp - txq->tx_bd_base;
 
-	if (((unsigned long) bufaddr) & FEC_ALIGNMENT) {
+	if (!(id_entry->driver_data & FEC_QUIRK_HAS_AVB) &&
+		((unsigned long) bufaddr) & FEC_ALIGNMENT) {
 		memcpy(txq->tx_bounce[index], skb->data, skb->len);
 		bufaddr = txq->tx_bounce[index];
 	}
-- 
1.7.5.4

