From b3f7dbb5ed2bc1fcc99f284b06b7ba6b0a3d28a8 Mon Sep 17 00:00:00 2001
From: Fugang Duan <B38611@freescale.com>
Date: Mon, 4 Nov 2013 17:37:05 +0800
Subject: [PATCH 0220/1074] ENGR00286060 arm: imx6q/dl: fix 1588 clock init
 fail

Bug log during kernel boot:
...
failed to find fsl,imx6q-iomux-gpr regmap
...

The issue is imx6q_1588_init() is called before of_platform_populate().

of_platform_populate() walks the device tree and creates devices from
nodes. imx6q_1588_init() call syscon_regmap_lookup_by_compatible() to
get the device base on the given device node, since the device cannot
created for the node, so it is failed.

So, move the 1588 init function to behind of of_platform_populate().

Signed-off-by: Fugang Duan  <B38611@freescale.com>
[Original patch taken from git://git.freescale.com/imx/linux-2.6-imx.git]
Signed-off-by: Biyao Zhai <biyao.zhai@windriver.com>
---
 arch/arm/mach-imx/mach-imx6q.c |    3 +--
 1 files changed, 1 insertions(+), 2 deletions(-)

diff --git a/arch/arm/mach-imx/mach-imx6q.c b/arch/arm/mach-imx/mach-imx6q.c
index a3fdf38..449f7c4 100644
--- a/arch/arm/mach-imx/mach-imx6q.c
+++ b/arch/arm/mach-imx/mach-imx6q.c
@@ -345,10 +345,9 @@ static void __init imx6q_init_machine(void)
 	if (parent == NULL)
 		pr_warn("failed to initialize soc device\n");
 
-	imx6q_enet_init();
-
 	of_platform_populate(NULL, of_default_bus_match_table, NULL, parent);
 
+	imx6q_enet_init();
 	imx_anatop_init();
 	imx6q_pm_init();
 	imx6q_csi_mux_init();
-- 
1.7.5.4

