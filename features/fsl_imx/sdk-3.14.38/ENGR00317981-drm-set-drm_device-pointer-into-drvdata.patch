From 932a0713cd062ce141bb2ca7151f725ded1196e9 Mon Sep 17 00:00:00 2001
From: Shawn Guo <shawn.guo@freescale.com>
Date: Fri, 13 Jun 2014 16:02:58 +0800
Subject: [PATCH 0011/1594] ENGR00317981: drm: set drm_device pointer into
 drvdata

commit 2cef4fb1d12e537466ecd6eaf0187a5c71662d71 from
git://git.freescale.com/imx/linux-2.6-imx.git

If drvdata is not used by platform driver, let's set drm_device
pointer into it.  We take this as the default usage of drvdata,
and platform driver is free to overwrite it later as needed.

Signed-off-by: Shawn Guo <shawn.guo@freescale.com>
---
 drivers/gpu/drm/drm_platform.c |    8 ++++++++
 1 files changed, 8 insertions(+), 0 deletions(-)

diff --git a/drivers/gpu/drm/drm_platform.c b/drivers/gpu/drm/drm_platform.c
index 5314c9d..5a2a614 100644
--- a/drivers/gpu/drm/drm_platform.c
+++ b/drivers/gpu/drm/drm_platform.c
@@ -53,6 +53,14 @@ static int drm_get_platform_dev(struct platform_device *platdev,
 
 	dev->platformdev = platdev;
 
+	/*
+	 * If drvdata is not used by platform driver, let's set drm_device
+	 * pointer into it.  We take this as the default usage of drvdata,
+	 * and platform driver is free to overwrite it later as needed.
+	 */
+	if (platform_get_drvdata(platdev) == NULL)
+		platform_set_drvdata(platdev, dev);
+
 	ret = drm_dev_register(dev, 0);
 	if (ret)
 		goto err_free;
-- 
1.7.5.4

