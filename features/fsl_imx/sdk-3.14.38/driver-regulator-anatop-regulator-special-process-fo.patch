From 6b78dcf7f39de2054b8d663bef15bb8438db1abe Mon Sep 17 00:00:00 2001
From: Limeng <Meng.Li@windriver.com>
Date: Thu, 11 Feb 2016 20:47:15 +0800
Subject: [PATCH 1582/1594] driver: regulator: anatop-regulator: special
 process for some regulators

When probe anatop regulator device, code read REGx_TARG field of register
PMU_REG_CORE(0x020c8140) to check selected target voltage for one module.
If default voltage selector value in REGx_TARG field is
0x1f(sreg->sel == 0), original code will not register current anatop
regulator device. So, anatop regulator "vddarm","vddpcie-phy" and
"vddsoc" will not be registered. But this these 3 regulators are used
in gpc, pcie and cpu0 node in dts file and code will get these 3
regulators when parse gpc, pcie and cpu0 node. Therefore, modify code
to register regulator "vddarm", "vddpcie-phy" and "vddsoc" evenif
they don't have a valid default voltage selector.

Signed-off-by: Meng Li <Meng.Li@windriver.com>
---
 drivers/regulator/anatop-regulator.c |    4 +++-
 1 files changed, 3 insertions(+), 1 deletions(-)

diff --git a/drivers/regulator/anatop-regulator.c b/drivers/regulator/anatop-regulator.c
index 705ed02..1216b26 100644
--- a/drivers/regulator/anatop-regulator.c
+++ b/drivers/regulator/anatop-regulator.c
@@ -349,7 +349,9 @@ static int anatop_regulator_probe(struct platform_device *pdev)
 		if (!sreg->sel && !strcmp(sreg->name, "vddpu"))
 			sreg->sel = 22;
 
-		if (!sreg->sel) {
+		if (!sreg->sel && strcmp(sreg->name, "vddarm")
+			&& strcmp(sreg->name, "vddpcie-phy")
+			&& strcmp(sreg->name, "vddsoc")) {
 			dev_err(&pdev->dev, "Failed to read a valid default voltage selector.\n");
 			return -EINVAL;
 		}
-- 
1.7.5.4

