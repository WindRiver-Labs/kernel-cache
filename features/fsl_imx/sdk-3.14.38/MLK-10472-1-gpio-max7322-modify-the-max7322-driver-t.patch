From 8a5fddbe2fedcfd04ab04a3e39c758fb9310216b Mon Sep 17 00:00:00 2001
From: Fugang Duan <b38611@freescale.com>
Date: Thu, 26 Mar 2015 15:26:18 +0800
Subject: [PATCH 0898/1594] MLK-10472-1 gpio: max7322: modify the max7322
 driver to support device tree interface.

commit 44658286e3ce1d23f74f520a69628e916144c7f6 from
git://git.freescale.com/imx/linux-2.6-imx.git

The max7322 driver can only support platform data interface. This patch
modify drvier to also support device tree interface.

(cherry-picked from commit: e0954ca10fbce4a820e7882b3f87cb78907fd987)

Signed-off-by: Luwei Zhou <b45643@freescale.com>
Signed-off-by: Fugang Duan <B38611@freescale.com>
---
 drivers/gpio/gpio-max732x.c |    5 +++++
 1 files changed, 5 insertions(+), 0 deletions(-)

diff --git a/drivers/gpio/gpio-max732x.c b/drivers/gpio/gpio-max732x.c
index 0fa4543..1f19a38 100644
--- a/drivers/gpio/gpio-max732x.c
+++ b/drivers/gpio/gpio-max732x.c
@@ -21,6 +21,7 @@
 #include <linux/interrupt.h>
 #include <linux/i2c.h>
 #include <linux/i2c/max732x.h>
+#include <linux/reset.h>
 #include <linux/of.h>
 
 
@@ -640,6 +641,10 @@ static int max732x_probe(struct i2c_client *client,
 		return -ENOMEM;
 	chip->client = client;
 
+	ret = device_reset(&client->dev);
+	if (ret == -ENODEV)
+		return -EPROBE_DEFER;
+
 	nr_port = max732x_setup_gpio(chip, id, pdata->gpio_base);
 	chip->gpio_chip.dev = &client->dev;
 
-- 
1.7.5.4

