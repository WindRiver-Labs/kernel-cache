From 50d5f4bea8e612956d80887e41601f63431a6c6c Mon Sep 17 00:00:00 2001
From: Fugang Duan <b38611@freescale.com>
Date: Wed, 4 Mar 2015 15:26:59 +0800
Subject: [PATCH 0133/1594] MLK-10367 tty: serial: imx: set uart module clock
 to 80Mhz

commit 330a1245cb91583d9bc916bbb6d8c7d2c86b26f3 from
git://git.freescale.com/imx/linux-2.6-imx.git

When UART module clock is great than 80Mhz, there may have risk after
confirming with IC owner. So set the maximum module clock to 80Mhz.

Signed-off-by: Fugang Duan <B38611@freescale.com>
---
 drivers/tty/serial/imx.c |    3 +++
 1 files changed, 3 insertions(+), 0 deletions(-)

diff --git a/drivers/tty/serial/imx.c b/drivers/tty/serial/imx.c
index a3d0ef8..d5ac815 100644
--- a/drivers/tty/serial/imx.c
+++ b/drivers/tty/serial/imx.c
@@ -180,6 +180,7 @@
 
 #define UART_NR 8
 #define IMX_RXBD_NUM 20
+#define IMX_MODULE_MAX_CLK_RATE	80000000
 
 /* i.MX21 type uart runs on all i.mx except i.MX1 and i.MX6q */
 enum imx_uart_type {
@@ -2069,6 +2070,8 @@ static int serial_imx_probe(struct platform_device *pdev)
 		return ret;
 	}
 
+	if (sport->clk_per > IMX_MODULE_MAX_CLK_RATE)
+		clk_set_rate(sport->clk_per, IMX_MODULE_MAX_CLK_RATE);
 	sport->port.uartclk = clk_get_rate(sport->clk_per);
 
 	/*
-- 
1.7.5.4

