From 6614f06e6a19b85f77f1c9b9649a344e8c98e6b6 Mon Sep 17 00:00:00 2001
From: Anson Huang <b20788@freescale.com>
Date: Wed, 18 Jun 2014 11:21:45 +0800
Subject: [PATCH 0064/1594] ENGR00318913-2 thermal: imx: make thermal trip
 temp changeable

commit f49b4d9c7fac73ab133db01c0a57ce23e9e572d9 from
git://git.freescale.com/imx/linux-2.6-imx.git

Make all thermal trips' temp changeable:

1. Different users may have different definitions about the
   trip temp;
2. For testing purpose, if we want to test cooling device's
   function, it is easy to change trip temp to cheat the cooling
   device to active, otherwise, need to test it using heating box
   which is very inconvenient

Signed-off-by: Anson Huang <b20788@freescale.com>
---
 drivers/thermal/imx_thermal.c |   13 +++++++------
 1 files changed, 7 insertions(+), 6 deletions(-)

diff --git a/drivers/thermal/imx_thermal.c b/drivers/thermal/imx_thermal.c
index 2ccbc07..e646dc2 100644
--- a/drivers/thermal/imx_thermal.c
+++ b/drivers/thermal/imx_thermal.c
@@ -286,15 +286,16 @@ static int imx_set_trip_temp(struct thermal_zone_device *tz, int trip,
 {
 	struct imx_thermal_data *data = tz->devdata;
 
-	if (trip == IMX_TRIP_CRITICAL)
-		return -EPERM;
-
 	if (temp > IMX_TEMP_PASSIVE)
 		return -EINVAL;
 
-	data->temp_passive = temp;
+	if (trip == IMX_TRIP_CRITICAL)
+		data->temp_critical = temp;
+	if (trip == IMX_TRIP_PASSIVE)
+		data->temp_passive = temp;
 
-	imx_set_alarm_temp(data, temp);
+	if (trip == IMX_TRIP_PASSIVE)
+		imx_set_alarm_temp(data, temp);
 
 	return 0;
 }
@@ -546,7 +547,7 @@ static int imx_thermal_probe(struct platform_device *pdev)
 
 	data->tz = thermal_zone_device_register("imx_thermal_zone",
 						IMX_TRIP_NUM,
-						BIT(IMX_TRIP_PASSIVE), data,
+						(1 << IMX_TRIP_NUM) - 1, data,
 						&imx_tz_ops, NULL,
 						IMX_PASSIVE_DELAY,
 						IMX_POLLING_DELAY);
-- 
1.7.5.4

