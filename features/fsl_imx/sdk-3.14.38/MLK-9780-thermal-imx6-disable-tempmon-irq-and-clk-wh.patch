From 5b6f44fa2e2b39b244546cb60664680473959855 Mon Sep 17 00:00:00 2001
From: Bai Ping <b51503@freescale.com>
Date: Fri, 31 Oct 2014 17:01:04 +0800
Subject: [PATCH 0411/1594] MLK-9780 thermal: imx6: disable tempmon irq and
 clk when thermal driver suspend

commit 2583498592ae26f9a26215bc613ea7b97bfa3bef from
git://git.freescale.com/imx/linux-2.6-imx.git

When the thermal driver doing suspend, disable the tempmon alarm irq
and clk, after the system resume, re-enable the irq and clk.

Signed-off-by: Bai Ping <b51503@freescale.com>
---
 drivers/thermal/imx_thermal.c |    3 +++
 1 files changed, 3 insertions(+), 0 deletions(-)

diff --git a/drivers/thermal/imx_thermal.c b/drivers/thermal/imx_thermal.c
index d0fbd68..9c87383 100644
--- a/drivers/thermal/imx_thermal.c
+++ b/drivers/thermal/imx_thermal.c
@@ -645,6 +645,7 @@ static int imx_thermal_suspend(struct device *dev)
 	regmap_write(map, TEMPSENSE0 + REG_CLR, TEMPSENSE0_MEASURE_TEMP);
 	regmap_write(map, TEMPSENSE0 + REG_SET, TEMPSENSE0_POWER_DOWN);
 	data->mode = THERMAL_DEVICE_DISABLED;
+	disable_irq(data->irq);
 	clk_disable_unprepare(data->thermal_clk);
 
 	return 0;
@@ -660,6 +661,8 @@ static int imx_thermal_resume(struct device *dev)
 	regmap_write(map, TEMPSENSE0 + REG_CLR, TEMPSENSE0_POWER_DOWN);
 	regmap_write(map, TEMPSENSE0 + REG_SET, TEMPSENSE0_MEASURE_TEMP);
 	data->mode = THERMAL_DEVICE_ENABLED;
+	clk_prepare_enable(data->thermal_clk);
+	enable_irq(data->irq);
 
 	return 0;
 }
-- 
1.7.5.4

