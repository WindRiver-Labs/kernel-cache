From d35d614ac60dde45a59b70f7b18e6d56a8fb0a32 Mon Sep 17 00:00:00 2001
From: Limeng <Meng.Li@windriver.com>
Date: Sun, 31 Jan 2016 21:09:37 +0800
Subject: [PATCH 1576/1594] ENGR00318931-2 Enable VPU driver on kernel 3.14

commit 98158cac5813043e2974d4545ffb316de7ffa9f5 from
git://git.freescale.com/imx/linux-2.6-imx.git

- Add vpu node
- Add "power-domains" property instead of "pu-supply"

Signed-off-by: Hongzhang Yang <Hongzhang.Yang@freescale.com>
---
 arch/arm/boot/dts/imx6dl.dtsi  |    4 ----
 arch/arm/boot/dts/imx6q.dtsi   |    4 ----
 arch/arm/boot/dts/imx6qdl.dtsi |   18 +++++++++++-------
 3 files changed, 11 insertions(+), 15 deletions(-)

diff --git a/arch/arm/boot/dts/imx6dl.dtsi b/arch/arm/boot/dts/imx6dl.dtsi
index f13741d..a0fd52d 100644
--- a/arch/arm/boot/dts/imx6dl.dtsi
+++ b/arch/arm/boot/dts/imx6dl.dtsi
@@ -220,7 +220,3 @@
 		      "ldb_di0_div_7", "ldb_di1_div_7",
 		      "ldb_di0_div_sel", "ldb_di1_div_sel";
 };
-
-&vpu {
-	compatible = "fsl,imx6dl-vpu", "cnm,coda960";
-};
diff --git a/arch/arm/boot/dts/imx6q.dtsi b/arch/arm/boot/dts/imx6q.dtsi
index 64ba0c5..15eb740 100644
--- a/arch/arm/boot/dts/imx6q.dtsi
+++ b/arch/arm/boot/dts/imx6q.dtsi
@@ -407,7 +407,3 @@
 		};
 	};
 };
-
-&vpu {
-	compatible = "fsl,imx6q-vpu", "cnm,coda960";
-};
diff --git a/arch/arm/boot/dts/imx6qdl.dtsi b/arch/arm/boot/dts/imx6qdl.dtsi
index 2a860f6..a1a3af8 100644
--- a/arch/arm/boot/dts/imx6qdl.dtsi
+++ b/arch/arm/boot/dts/imx6qdl.dtsi
@@ -418,16 +418,20 @@
 			};
 
 			vpu: vpu@02040000 {
-				compatible = "cnm,coda960";
+				compatible = "fsl,imx6-vpu";
 				reg = <0x02040000 0x3c000>;
-				interrupts = <0 12 IRQ_TYPE_LEVEL_HIGH>,
-					     <0 3 IRQ_TYPE_LEVEL_HIGH>;
-				interrupt-names = "bit", "jpeg";
+				reg-names = "vpu_regs";
+				interrupts = <0 3 IRQ_TYPE_EDGE_RISING>,
+					     <0 12 IRQ_TYPE_LEVEL_HIGH>;
+				interrupt-names = "vpu_jpu_irq", "vpu_ipi_irq";
 				clocks = <&clks IMX6QDL_CLK_VPU_AXI>,
-					 <&clks IMX6QDL_CLK_MMDC_CH0_AXI>;
-				clock-names = "per", "ahb";
-				resets = <&src 1>;
+					 <&clks IMX6QDL_CLK_MMDC_CH0_AXI>,
+					 <&clks IMX6QDL_CLK_OCRAM>;
+				clock-names = "vpu_clk", "mmdc_ch0_axi", "ocram";
+				iramsize = <0x21000>;
 				iram = <&ocram>;
+				resets = <&src 1>;
+				power-domains = <&gpc 1>;
 			};
 
 			aipstz@0207c000 { /* AIPSTZ1 */
-- 
1.7.5.4

