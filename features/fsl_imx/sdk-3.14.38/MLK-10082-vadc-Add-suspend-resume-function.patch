From 4e04349f5bf2f40aecca635e5c1f59d09c9f814d Mon Sep 17 00:00:00 2001
From: Sandor Yu <R01008@freescale.com>
Date: Fri, 9 Jan 2015 16:55:59 +0800
Subject: [PATCH 0778/1594] MLK-10082: vadc: Add suspend/resume function

commit bcf4893ba49a8bb3a2a8cabc742c9d224c9efedd from
git://git.freescale.com/imx/linux-2.6-imx.git

Add suspend/resume function in vadc driver.

Signed-off-by: Sandor Yu <R01008@freescale.com>
---
 drivers/media/platform/mxc/subdev/mxc_vadc.c |   38 +++++++++++++++++++++++---
 1 files changed, 34 insertions(+), 4 deletions(-)

diff --git a/drivers/media/platform/mxc/subdev/mxc_vadc.c b/drivers/media/platform/mxc/subdev/mxc_vadc.c
index 6b9c29b..b96735c 100644
--- a/drivers/media/platform/mxc/subdev/mxc_vadc.c
+++ b/drivers/media/platform/mxc/subdev/mxc_vadc.c
@@ -1,5 +1,5 @@
 /*
- * Copyright (C) 2014 Freescale Semiconductor, Inc. All Rights Reserved.
+ * Copyright (C) 2014-2015 Freescale Semiconductor, Inc. All Rights Reserved.
  */
 
 /*
@@ -758,11 +758,41 @@ static int vadc_remove(struct platform_device *pdev)
 	return true;
 }
 
+static int vadc_suspend(struct device *dev)
+{
+	struct platform_device *pdev = to_platform_device(dev);
+	struct vadc_state *state = platform_get_drvdata(pdev);
+
+	clk_disable(state->csi_clk);
+	clk_disable(state->vadc_clk);
+
+	vadc_power_down(state);
+
+	return 0;
+}
+
+static int vadc_resume(struct device *dev)
+{
+	struct platform_device *pdev = to_platform_device(dev);
+	struct vadc_state *state = platform_get_drvdata(pdev);
+
+	clk_enable(state->csi_clk);
+	clk_enable(state->vadc_clk);
+
+	vadc_init(state);
+	return 0;
+}
+
+static const struct dev_pm_ops vadc_pm_ops = {
+	SET_SYSTEM_SLEEP_PM_OPS(vadc_suspend, vadc_resume)
+};
+
 static struct platform_driver vadc_driver = {
 	.driver = {
-		   .name = "fsl_vadc",
-		   .of_match_table = of_match_ptr(fsl_vadc_dt_ids),
-		   },
+		.name = "fsl_vadc",
+		.of_match_table = of_match_ptr(fsl_vadc_dt_ids),
+		.pm	= &vadc_pm_ops,
+	},
 	.probe = vadc_probe,
 	.remove = vadc_remove,
 };
-- 
1.7.5.4

