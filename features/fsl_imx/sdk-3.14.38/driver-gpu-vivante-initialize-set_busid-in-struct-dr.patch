From a1f877ee71497d499c868e3492913f2c8d2a53b5 Mon Sep 17 00:00:00 2001
From: Limeng <Meng.Li@windriver.com>
Date: Wed, 9 Mar 2016 11:37:15 +0800
Subject: [PATCH] driver: gpu: vivante: initialize set_busid in struct
 drm_driver
MIME-Version: 1.0
Content-Type: text/plain; charset=UTF-8
Content-Transfer-Encoding: 8bit

In GPU driver, original code doesnâ€™t initialize set_busid field of
struct drm_driver. So, in function drm_set_busid(), code will enter
else case and output warning trace.

Detail info as below:
------------[ cut here ]------------
WARNING: CPU: 3 PID: 510 at drivers/gpu/drm/drm_ioctl.c:144 drm_setversion)
No drm_driver.set_busid() implementation provided by 0x80cde18c.
Use drm_dev_set_unique() to set the unique name explicitly.
Modules linked in: nls_iso8859_1 nls_cp437 ov5640_camera_int ov5640_camera_mipi_int softdog
CPU: 3 PID: 510 Comm: Xorg Not tainted 4.1.18-WR8.0.0.0_standard #1
Hardware name: Freescale i.MX6 Quad/DualLite (Device Tree)
[<800191f0>] (unwind_backtrace) from [<80013644>] (show_stack+0x20/0x24)
[<80013644>] (show_stack) from [<80875528>] (dump_stack+0x80/0xa0)
[<80875528>] (dump_stack) from [<80038a38>] (warn_slowpath_common+0x98/0xc4)
[<80038a38>] (warn_slowpath_common) from [<80038aa4>] (warn_slowpath_fmt+0x40/0x48)
[<80038aa4>] (warn_slowpath_fmt) from [<8044f850>] (drm_setversion+0xd4/0x16c)
[<8044f850>] (drm_setversion) from [<8044f418>] (drm_ioctl+0x258/0x3a0)
[<8044f418>] (drm_ioctl) from [<80161bf4>] (do_vfs_ioctl+0x500/0x5c0)
[<80161bf4>] (do_vfs_ioctl) from [<80161d10>] (SyS_ioctl+0x5c/0x84)
[<80161d10>] (SyS_ioctl) from [<8000f320>] (ret_fast_syscall+0x0/0x3c)
[---[ end trace 5c081047a46dcd4a ]---

In order to fix this issue, add code to initialize set_busid field.

Signed-off-by: Meng Li <Meng.Li@windriver.com>
---
 drivers/gpu/drm/vivante/vivante_drv.c |    1 +
 1 files changed, 1 insertions(+), 0 deletions(-)

diff --git a/drivers/gpu/drm/vivante/vivante_drv.c b/drivers/gpu/drm/vivante/vivante_drv.c
index a285b33..b922b8b 100644
--- a/drivers/gpu/drm/vivante/vivante_drv.c
+++ b/drivers/gpu/drm/vivante/vivante_drv.c
@@ -76,6 +76,7 @@ static struct drm_driver driver = {
 	.major = DRIVER_MAJOR,
 	.minor = DRIVER_MINOR,
 	.patchlevel = DRIVER_PATCHLEVEL,
+	.set_busid = drm_platform_set_busid,
 };
 
 static int __init vivante_init(void)
-- 
1.7.5.4

