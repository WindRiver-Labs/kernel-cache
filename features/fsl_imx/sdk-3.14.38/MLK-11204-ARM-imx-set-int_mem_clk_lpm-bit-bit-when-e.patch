From 1405937faa308b2a55ab2c6abad0356421be3bf7 Mon Sep 17 00:00:00 2001
From: Bai Ping <b51503@freescale.com>
Date: Wed, 1 Jul 2015 01:19:14 +0800
Subject: [PATCH 1262/1594] MLK-11204 ARM: imx: set int_mem_clk_lpm bit bit
 when entering wait mode on 6ul

commit 31ebd3ecb83c540be2760339d00eeb24f99cabe1 from
git://git.freescale.com/imx/linux-2.6-imx.git

This bit is used to keep the ARM Platform memory clocks enabled if
an interrupt is pending when entering low power mode. This bit should
always bet set when the CCM_CLPCR_LPM bits are set to 01(WAIT Mode) or
10 (STOP mode) without power gating.

Signed-off-by: Bai Ping <b51503@freescale.com>
---
 arch/arm/mach-imx/cpuidle-imx6ul.c |    3 +++
 arch/arm/mach-imx/pm-imx6.c        |    3 ++-
 2 files changed, 5 insertions(+), 1 deletions(-)

diff --git a/arch/arm/mach-imx/cpuidle-imx6ul.c b/arch/arm/mach-imx/cpuidle-imx6ul.c
index 3fee294..3cbc766 100644
--- a/arch/arm/mach-imx/cpuidle-imx6ul.c
+++ b/arch/arm/mach-imx/cpuidle-imx6ul.c
@@ -178,5 +178,8 @@ int __init imx6ul_cpuidle_init(void)
 	imx6ul_wfi_in_iram_fn = (void *)fncpy(wfi_iram_base + sizeof(*cpuidle_pm_info),
 		&imx6ul_low_power_idle, wfi_code_size);
 #endif
+
+	imx6q_set_int_mem_clk_lpm(true);
+
 	return cpuidle_register(&imx6ul_cpuidle_driver, NULL);
 }
diff --git a/arch/arm/mach-imx/pm-imx6.c b/arch/arm/mach-imx/pm-imx6.c
index 7c87810..2ab6662 100644
--- a/arch/arm/mach-imx/pm-imx6.c
+++ b/arch/arm/mach-imx/pm-imx6.c
@@ -480,7 +480,8 @@ void imx6q_set_int_mem_clk_lpm(bool enable)
 	if ((cpu_is_imx6q() && imx_get_soc_revision() >
 		IMX_CHIP_REVISION_1_1) ||
 		(cpu_is_imx6dl() && imx_get_soc_revision() >
-		IMX_CHIP_REVISION_1_0) || cpu_is_imx6sx()) {
+		IMX_CHIP_REVISION_1_0) || cpu_is_imx6sx() ||
+		cpu_is_imx6ul()) {
 		u32 val;
 
 		val = readl_relaxed(ccm_base + CGPR);
-- 
1.7.5.4

