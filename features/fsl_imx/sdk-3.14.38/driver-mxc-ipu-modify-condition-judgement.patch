From ff04392c55baaf85e31ada817dc53432ab88de50 Mon Sep 17 00:00:00 2001
From: Limeng <Meng.Li@windriver.com>
Date: Thu, 18 Feb 2016 10:46:17 +0800
Subject: [PATCH 1584/1594] driver: mxc: ipu: modify condition judgement

Because clock architecture change, clk_get() function will not return
the clk structure pointer that are created when register. Therefore,
it is wrong to compare clocks with pointer to judge whether they are
the same one. Change code to compare clocks with their name to judge
whether they are the same one.

Signed-off-by: Meng Li <Meng.Li@windriver.com>
---
 drivers/mxc/ipu3/ipu_disp.c |    4 +++-
 1 files changed, 3 insertions(+), 1 deletions(-)

diff --git a/drivers/mxc/ipu3/ipu_disp.c b/drivers/mxc/ipu3/ipu_disp.c
index 75f9161..9bca78c 100644
--- a/drivers/mxc/ipu3/ipu_disp.c
+++ b/drivers/mxc/ipu3/ipu_disp.c
@@ -1087,7 +1087,9 @@ int32_t ipu_init_sync_panel(struct ipu_soc *ipu, int disp, uint32_t pixel_clk,
 		return PTR_ERR(ldb_di1_clk);
 	}
 
-	if (ldb_di0_clk == di_parent || ldb_di1_clk == di_parent) {
+	if (__clk_get_name(di_parent) &&
+		((__clk_get_name(ldb_di0_clk) && (!strcmp(__clk_get_name(ldb_di0_clk), __clk_get_name(di_parent))))
+		|| (__clk_get_name(ldb_di1_clk) && (!strcmp(__clk_get_name(ldb_di1_clk), __clk_get_name(di_parent)))))) {
 		/* if di clk parent is tve/ldb, then keep it;*/
 		dev_dbg(ipu->dev, "use special clk parent\n");
 		ret = clk_set_parent(ipu->pixel_clk_sel[disp], ipu->di_clk[disp]);
-- 
1.7.5.4

