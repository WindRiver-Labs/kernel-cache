From a2cc498a85b358521fa54de93eeaa2b4444595bc Mon Sep 17 00:00:00 2001
From: Bai Ping <b51503@freescale.com>
Date: Thu, 16 Jul 2015 18:48:48 +0800
Subject: [PATCH 1276/1594] MLK-11252-01 ARM: imx: dts: add gpio regulator to
 control the dc-dc voltage on imx6ul evk board

commit b2352a71bd1b6ab97a5a64fe7cf919b22911dacb from
git://git.freescale.com/imx/linux-2.6-imx.git

For the i.MX6UL EVK board, according to the latest schematic, use a GPIO pin along with
the 'PMIC_STBY_REQ' pin to control the DC-DC voltage output. the possible voltage output
as below:

PMIC_STBY_REQ = 0, GPIO_DVFS = 0, output is 1.4V (1.375V + 25mV) <Default>
PMIC_STBY_REQ = 0, GPIO_DVFS = 1, output is 1.3V (1.275V + 25mV)
PMIC_STBY_REQ = 1, GPIO_DVFS = 0, output is 0.925V (0.9V + 25mV)

In normal run mode, the voltage output should be changed using the 'GPIO_DVFS' pin,
so add gpio regulator to control it.

Signed-off-by: Bai Ping <b51503@freescale.com>
(cherry picked from commit 4517cf404b4e0cfb805a9d0c412b2f2839400d9b)
---
 arch/arm/boot/dts/imx6ul-14x14-evk.dts |   18 ++++++++++++++++++
 1 files changed, 18 insertions(+), 0 deletions(-)

diff --git a/arch/arm/boot/dts/imx6ul-14x14-evk.dts b/arch/arm/boot/dts/imx6ul-14x14-evk.dts
index caa7a01..91c2ec0 100644
--- a/arch/arm/boot/dts/imx6ul-14x14-evk.dts
+++ b/arch/arm/boot/dts/imx6ul-14x14-evk.dts
@@ -59,6 +59,17 @@
 			enable-active-high;
 		};
 
+		reg_gpio_dvfs: regulator-gpio {
+			compatible = "regulator-gpio";
+			pinctrl-names = "default";
+			pinctrl-0 = <&pinctrl_dvfs>;
+			regulator-min-microvolt = <1300000>;
+			regulator-max-microvolt = <1400000>;
+			regulator-name = "gpio_dvfs";
+			regulator-type = "voltage";
+			gpios = <&gpio5 3 GPIO_ACTIVE_HIGH>;
+			states = <1300000 0x1 1400000 0x0>;
+		};
 	};
 
 	sound {
@@ -125,6 +136,7 @@
 &cpu0 {
 	arm-supply = <&reg_arm>;
 	soc-supply = <&reg_soc>;
+	dc-supply = <&reg_gpio_dvfs>;
 };
 
 &clks {
@@ -645,5 +657,11 @@
 				MX6UL_PAD_SNVS_TAMPER8__GPIO5_IO08	0x80000000
 			>;
 		};
+
+		pinctrl_dvfs: dvfsgrp {
+			fsl,pins = <
+				MX6UL_PAD_SNVS_TAMPER3__GPIO5_IO03	0x79
+			>;
+		};
 	};
 };
-- 
1.7.5.4

