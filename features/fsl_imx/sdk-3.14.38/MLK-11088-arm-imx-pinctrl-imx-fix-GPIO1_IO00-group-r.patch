From 8b801b5a471c59b9413ea3798f8da98547a0c31b Mon Sep 17 00:00:00 2001
From: Adrian Alonso <aalonso@freescale.com>
Date: Mon, 8 Jun 2015 17:25:13 -0500
Subject: [PATCH 1239/1594] MLK-11088: arm: imx: pinctrl-imx: fix GPIO1_IO00
 group register

commit 9ec35a860b5c5439d6b4840ccfefe8f806304a0a from
git://git.freescale.com/imx/linux-2.6-imx.git

* Fix GPIO1_IO00 pin group register, add ZERO_OFFSET_VALID to
  iomuxc-lpsr as GPIO1_IO00 mux_reg offset is Zero.
  ---
  302c0000.iomuxc-lpsr: failed to get pin(12) name
  302c0000.iomuxc-lpsr: maps: function hog group hoggrp-2 num 4
  pinctrl core: add 4 pinmux maps
  pinconfig core: failed to register map default (3): no group/pin given
  ---
* Fix debug info use pin_id to get the corresponding pad name.

Signed-off-by: Adrian Alonso <aalonso@freescale.com>
Signed-off-by: Robin Gong <b38343@freescale.com>
---
 drivers/pinctrl/freescale/pinctrl-imx.c   |    6 +++++-
 drivers/pinctrl/freescale/pinctrl-imx.h   |    1 +
 drivers/pinctrl/freescale/pinctrl-imx7d.c |    2 +-
 3 files changed, 7 insertions(+), 2 deletions(-)

diff --git a/drivers/pinctrl/freescale/pinctrl-imx.c b/drivers/pinctrl/freescale/pinctrl-imx.c
index 664bfb6..012397a 100644
--- a/drivers/pinctrl/freescale/pinctrl-imx.c
+++ b/drivers/pinctrl/freescale/pinctrl-imx.c
@@ -558,7 +558,11 @@ static int imx_pinctrl_parse_groups(struct device_node *np,
 				conf_reg = -1;
 		}
 
-		pin_id = mux_reg ? mux_reg / 4 : conf_reg / 4;
+		if (info->flags & ZERO_OFFSET_VALID)
+			pin_id = mux_reg / 4;
+		else
+			pin_id = mux_reg ? mux_reg / 4 : conf_reg / 4;
+
 		pin_reg = &info->pin_regs[pin_id];
 		pin->pin = pin_id;
 		grp->pin_ids[i] = pin_id;
diff --git a/drivers/pinctrl/freescale/pinctrl-imx.h b/drivers/pinctrl/freescale/pinctrl-imx.h
index 65d1479..460141a 100644
--- a/drivers/pinctrl/freescale/pinctrl-imx.h
+++ b/drivers/pinctrl/freescale/pinctrl-imx.h
@@ -86,6 +86,7 @@ struct imx_pinctrl_soc_info {
 
 #define SHARE_MUX_CONF_REG	0x1
 #define SHARE_INPUT_SELECT_REG 0x2
+#define ZERO_OFFSET_VALID	0x4
 
 #define NO_MUX		0x0
 #define NO_PAD		0x0
diff --git a/drivers/pinctrl/freescale/pinctrl-imx7d.c b/drivers/pinctrl/freescale/pinctrl-imx7d.c
index a2001c2..ed2dc8f 100644
--- a/drivers/pinctrl/freescale/pinctrl-imx7d.c
+++ b/drivers/pinctrl/freescale/pinctrl-imx7d.c
@@ -361,7 +361,7 @@ static struct imx_pinctrl_soc_info imx7d_pinctrl_info = {
 static struct imx_pinctrl_soc_info imx7d_lpsr_pinctrl_info = {
 	.pins = imx7d_lpsr_pinctrl_pads,
 	.npins = ARRAY_SIZE(imx7d_lpsr_pinctrl_pads),
-	.flags = SHARE_INPUT_SELECT_REG,
+	.flags = SHARE_INPUT_SELECT_REG | ZERO_OFFSET_VALID,
 };
 
 static struct of_device_id imx7d_pinctrl_of_match[] = {
-- 
1.7.5.4

