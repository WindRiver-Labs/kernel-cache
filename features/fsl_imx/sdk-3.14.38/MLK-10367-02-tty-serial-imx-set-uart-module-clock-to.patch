From b4f38bb4952dc4e1d4e824b03d9d3e008cc23338 Mon Sep 17 00:00:00 2001
From: Fugang Duan <b38611@freescale.com>
Date: Mon, 9 Mar 2015 10:08:13 +0800
Subject: [PATCH 0134/1594] MLK-10367-02 tty: serial: imx: set uart module
 clock to 80Mhz

commit de250f6fb2e49504b839d2723ac289893475dbac from
git://git.freescale.com/imx/linux-2.6-imx.git

When UART module clock is great than 80Mhz, there may have risk after
confirming with IC owner. So set the maximum module clock to 80Mhz.
(The patch just fix the first part that push un-correct patch version
by mistake)

Signed-off-by: Fugang Duan <B38611@freescale.com>
---
 drivers/tty/serial/imx.c |    3 ++-
 1 files changed, 2 insertions(+), 1 deletions(-)

diff --git a/drivers/tty/serial/imx.c b/drivers/tty/serial/imx.c
index d5ac815..dff500c 100644
--- a/drivers/tty/serial/imx.c
+++ b/drivers/tty/serial/imx.c
@@ -2070,7 +2070,8 @@ static int serial_imx_probe(struct platform_device *pdev)
 		return ret;
 	}
 
-	if (sport->clk_per > IMX_MODULE_MAX_CLK_RATE)
+	sport->port.uartclk = clk_get_rate(sport->clk_per);
+	if (sport->port.uartclk > IMX_MODULE_MAX_CLK_RATE)
 		clk_set_rate(sport->clk_per, IMX_MODULE_MAX_CLK_RATE);
 	sport->port.uartclk = clk_get_rate(sport->clk_per);
 
-- 
1.7.5.4

