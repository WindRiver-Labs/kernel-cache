From 05c2b68a45a6c0096217e6e8c15aa355f322a8f8 Mon Sep 17 00:00:00 2001
From: czou <cao.zou@windriver.com>
Date: Tue, 7 Jun 2016 14:16:57 +0800
Subject: [PATCH 2/3] imx:imx6ul: gpc init some resources for imx6u interrupt
 controller

the interrupt controller of imx6ul need gpu to init some resource,
here modify the soc interrupt parent to gpc, so gpc can prepare the
resource before the imx6ul interrupt controller

Signed-off-by: czou <cao.zou@windriver.com>
(cherry picked from commit 19ec8c54dd3b49819d3d56579685b13d8106e5c4
git://git.freescale.com/imx/linux-2.6-imx.git imx_4.1.15_1.0.0_ga
)
---
 arch/arm/boot/dts/imx6ul.dtsi   |    5 ++++-
 arch/arm/mach-imx/mach-imx6ul.c |    1 +
 2 files changed, 5 insertions(+), 1 deletions(-)

diff --git a/arch/arm/boot/dts/imx6ul.dtsi b/arch/arm/boot/dts/imx6ul.dtsi
index 72fb004..8ab5c7f 100644
--- a/arch/arm/boot/dts/imx6ul.dtsi
+++ b/arch/arm/boot/dts/imx6ul.dtsi
@@ -131,7 +131,7 @@
 		#address-cells = <1>;
 		#size-cells = <1>;
 		compatible = "simple-bus";
-		interrupt-parent = <&intc>;
+		interrupt-parent = <&gpc>;
 		ranges;
 
 		busfreq {
@@ -709,7 +709,10 @@
 			gpc: gpc@020dc000 {
 				compatible = "fsl,imx6ul-gpc", "fsl,imx6q-gpc";
 				reg = <0x020dc000 0x4000>;
+				interrupt-controller;
+				#interrupt-cells = <3>;
 				interrupts = <GIC_SPI 89 IRQ_TYPE_LEVEL_HIGH>;
+				interrupt-parent = <&intc>;
 				fsl,mf-mix-wakeup-irq = <0x7c00000 0x7d00 0x0 0x1400640>;
 			};
 
diff --git a/arch/arm/mach-imx/mach-imx6ul.c b/arch/arm/mach-imx/mach-imx6ul.c
index f43de43..d9bf0bd 100644
--- a/arch/arm/mach-imx/mach-imx6ul.c
+++ b/arch/arm/mach-imx/mach-imx6ul.c
@@ -84,6 +84,7 @@ static void __init imx6ul_init_machine(void)
 
 static void __init imx6ul_init_irq(void)
 {
+	imx_gpc_check_dt();
 	imx_init_revision_from_anatop();
 	imx_src_init();
 	irqchip_init();
-- 
1.7.5.4

