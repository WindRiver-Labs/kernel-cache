From a480378fd5d521ea0bfe022e3188c87952d23f3c Mon Sep 17 00:00:00 2001
From: Sandor Yu <R01008@freescale.com>
Date: Thu, 17 Jul 2014 20:41:14 +0800
Subject: [PATCH 0717/1594] ENGR00321817-02 fbcon: System hang when calling
 fb_new_modelist()

commit 355ed627d742b19084c6645941c6be42f365918f from
git://git.freescale.com/imx/linux-2.6-imx.git

System will hang if calling fb_new_modelist() function from mxc_hdmi
driver.

In the function of fbcon_new_modelist(), pointer variable vc is missing
null pointer check, add null pointer check vc to fix the issue.

Signed-off-by: Sandor Yu <R01008@freescale.com>
(cherry picked from commit 3bea30ff471c8fc1e546be26a8625e6aa425d5aa)
(cherry picked from commit ddfd6b989071e38955855351556f518b1600944d)
---
 drivers/video/console/fbcon.c |    2 ++
 1 files changed, 2 insertions(+), 0 deletions(-)

diff --git a/drivers/video/console/fbcon.c b/drivers/video/console/fbcon.c
index b972106..f53fc15 100644
--- a/drivers/video/console/fbcon.c
+++ b/drivers/video/console/fbcon.c
@@ -3199,6 +3199,8 @@ static void fbcon_new_modelist(struct fb_info *info)
 		if (!fb_display[i].mode)
 			continue;
 		vc = vc_cons[i].d;
+		if (!vc)
+			continue;
 		display_to_var(&var, &fb_display[i]);
 		mode = fb_find_nearest_mode(fb_display[i].mode,
 					    &info->modelist);
-- 
1.7.5.4

