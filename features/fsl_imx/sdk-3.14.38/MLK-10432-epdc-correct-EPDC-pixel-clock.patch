From d809b76576d0e86ec85da60fab8325c43537ccc4 Mon Sep 17 00:00:00 2001
From: Robby Cai <r63905@freescale.com>
Date: Mon, 16 Mar 2015 21:15:06 +0800
Subject: [PATCH 0416/1594] MLK-10432 epdc: correct EPDC pixel clock

commit ce7b0157af06435a24644af8d8ae0b77f7572f54 from
git://git.freescale.com/imx/linux-2.6-imx.git

Need enable the epdc pixel rate after call clk_set_rate since there's
CLK_SET_RATE_GATE flag for the clock, otherwise clk_set_rate call may fail.

Signed-off-by: Robby Cai <r63905@freescale.com>
---
 drivers/video/fbdev/mxc/mxc_epdc_v2_fb.c |    5 +++--
 1 files changed, 3 insertions(+), 2 deletions(-)

diff --git a/drivers/video/fbdev/mxc/mxc_epdc_v2_fb.c b/drivers/video/fbdev/mxc/mxc_epdc_v2_fb.c
index cb92c1a..a44b302 100644
--- a/drivers/video/fbdev/mxc/mxc_epdc_v2_fb.c
+++ b/drivers/video/fbdev/mxc/mxc_epdc_v2_fb.c
@@ -4703,8 +4703,6 @@ static void mxc_epdc_fb_fw_handler(const struct firmware *fw,
 	clk_prepare_enable(fb_data->epdc_clk_axi);
 
 	target_pix_clk = fb_data->cur_mode->vmode->pixclock;
-	/* Enable pix clk for EPDC */
-	clk_prepare_enable(fb_data->epdc_clk_pix);
 
 	rounded_pix_clk = clk_round_rate(fb_data->epdc_clk_pix, target_pix_clk);
 
@@ -4730,6 +4728,9 @@ static void mxc_epdc_fb_fw_handler(const struct firmware *fw,
 
 	clk_set_rate(fb_data->epdc_clk_pix, rounded_pix_clk);
 
+	/* Enable pix clk for EPDC */
+	clk_prepare_enable(fb_data->epdc_clk_pix);
+
 	epdc_init_sequence(fb_data);
 
 	/* Disable clocks */
-- 
1.7.5.4

