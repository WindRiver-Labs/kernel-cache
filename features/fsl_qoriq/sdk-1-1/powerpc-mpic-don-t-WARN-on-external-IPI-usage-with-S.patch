From 06c2e1b9967abce576e5ae26299dd57a62737b47 Mon Sep 17 00:00:00 2001
From: Tiejun Chen <tiejun.chen@windriver.com>
Date: Mon, 23 Apr 2012 13:58:49 +0800
Subject: [PATCH 06/38] powerpc/mpic: don't WARN on external IPI usage with SMP

Extracted from QorIQ-DPAA-SDK-v1.1-20111026-systembuilder.iso

Not all SMP implementations make use of the MPIC IPIs (some
use doorbells, or you could be booting an SMP kernel on a system
with only one CPU visible to this instance of Linux).  So don't
condition the ability to mask the IPI on CONFIG_SMP.

Signed-off-by: Scott Wood <scottwood@freescale.com>
---
 arch/powerpc/sysdev/mpic.c |    8 --------
 1 files changed, 0 insertions(+), 8 deletions(-)

diff --git a/arch/powerpc/sysdev/mpic.c b/arch/powerpc/sysdev/mpic.c
index 08dcd2f..22461ee 100644
--- a/arch/powerpc/sysdev/mpic.c
+++ b/arch/powerpc/sysdev/mpic.c
@@ -785,20 +785,12 @@ static void mpic_mask_ipi(struct irq_data *d)
 	 * you need to be careful to only use one CPU per IPI, as the
 	 * mask bit is not per-CPU.
 	 */
-#ifdef CONFIG_SMP
-	/*
-	 * FIXME if the kernel's normal IPI use is reduced to the point
-	 * where some IPIs could be spared for other use
-	 */
-	WARN_ON_ONCE(1);
-#else
 	struct mpic *mpic = mpic_from_irq_data(d);
 	unsigned int src = virq_to_hw(d->irq) - mpic->ipi_vecs[0];
 
 	DBG("%s: disable_ipi: %d (ipi %d)\n", mpic->name, d->irq, src);
 	mpic_ipi_write(src, mpic_ipi_read(src) | MPIC_VECPRI_MASK);
 	mpic_ipi_read(src);
-#endif
 }
 
 static void mpic_end_ipi(struct irq_data *d)
-- 
1.7.0.4

