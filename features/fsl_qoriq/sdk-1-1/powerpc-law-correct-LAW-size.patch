From f5abf8dd1ecb4c8aa0c1e09b13757d1c090c3659 Mon Sep 17 00:00:00 2001
From: Tiejun Chen <tiejun.chen@windriver.com>
Date: Wed, 27 Jun 2012 16:18:57 +0800
Subject: [PATCH] powerpc/law: correct LAW size

The size field, SIZE, of LAWAR dentifies the size of the window from
the starting address. Window size is 2^(SIZE+1) bytes.

So the size really should be calculated as 1ULL << (size + 1).

{
This should be squashed into 87820ec8cbe6a706390ade8fff2172e55c7f95ae

Add a work-around for erratum A-004510 in the Freescale PAMU device driver
}

Signed-off-by: Tiejun Chen <tiejun.chen@windriver.com>
---
 arch/powerpc/sysdev/fsl_pamu.c |    2 +-
 1 file changed, 1 insertion(+), 1 deletion(-)

diff --git a/arch/powerpc/sysdev/fsl_pamu.c b/arch/powerpc/sysdev/fsl_pamu.c
index cf5f6d3..5930304 100644
--- a/arch/powerpc/sysdev/fsl_pamu.c
+++ b/arch/powerpc/sysdev/fsl_pamu.c
@@ -471,7 +471,7 @@ static int __init create_csd(phys_addr_t phys, size_t size)
 
 			law_start = make64(law[i].lawbarh, law[i].lawbarl);
 			law_end = law_start +
-				(1ULL << (law[i].lawar & LAWAR_SIZE_MASK));
+				(1ULL << ((law[i].lawar & LAWAR_SIZE_MASK) + 1));
 
 			if (law_start <= phys && phys < law_end) {
 				law_target = law[i].lawar & LAWAR_TARGET_MASK;
-- 
1.7.9.7

