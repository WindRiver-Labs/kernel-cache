From 3927f11906af6d0789fb10b5e4eb1503c72f6c35 Mon Sep 17 00:00:00 2001
From: Kevin Hao <kexin.hao@windriver.com>
Date: Wed, 6 Mar 2013 20:09:18 +0800
Subject: [PATCH 08/12] fman: don't reset the two bmi configuration registers when kexec enabled

These two registers are initialized by hardware with the required
value and we still need these values in the kexec boot kernel.
So don't reset them when kexec is enabled.

Signed-off-by: Kevin Hao <kexin.hao@windriver.com>
---
 .../freescale/dpa/NetCommSw/Peripherals/FM/fm.c    |    2 ++
 1 files changed, 2 insertions(+), 0 deletions(-)

diff --git a/drivers/net/ethernet/freescale/dpa/NetCommSw/Peripherals/FM/fm.c b/drivers/net/ethernet/freescale/dpa/NetCommSw/Peripherals/FM/fm.c
index b40e08e..24fd395 100644
--- a/drivers/net/ethernet/freescale/dpa/NetCommSw/Peripherals/FM/fm.c
+++ b/drivers/net/ethernet/freescale/dpa/NetCommSw/Peripherals/FM/fm.c
@@ -4455,8 +4455,10 @@ t_Error FM_Free(t_Handle h_Fm)
     WRITE_UINT32(p_Fm->p_FmQmiRegs->fmqm_gc, 0);
 
     /* release BMI resources */
+#ifndef CONFIG_KEXEC
     WRITE_UINT32(p_Fm->p_FmBmiRegs->fmbm_cfg2, 0);
     WRITE_UINT32(p_Fm->p_FmBmiRegs->fmbm_cfg1, 0);
+#endif
 
     /* disable ECC */
     WRITE_UINT32(p_Fm->p_FmFpmRegs->fm_rcr, 0);
-- 
1.7.0

