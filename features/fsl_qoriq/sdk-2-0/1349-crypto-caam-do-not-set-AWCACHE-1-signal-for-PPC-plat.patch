From 4a8b8fd52b5c19182aca01def2a193fe7ca4e867 Mon Sep 17 00:00:00 2001
From: Alex Porosanu <alexandru.porosanu@nxp.com>
Date: Tue, 10 May 2016 11:49:02 +0300
Subject: [PATCH 1349/1383] crypto: caam - do not set AWCACHE[1] signal for PPC
 platforms

PPC/CoreNet based SoC's do not utilize the bus master's A(W|R)CACHE[1] signal
to flag and control coherency; this function is accomplished by the
PAMU translation record content.
Still, experimental results show about 3% performance degradation
when the AWCACHE[1] signal is asserted on PPC platforms
As such, revert to the previous functionality for PPC platforms, where
only AWCACHE[0] is being asserted.

Signed-off-by: Alex Porosanu <alexandru.porosanu@nxp.com>
[Original patch taken from QorIQ-SDK-V2.0-20160527-yocto]
Signed-off-by: Yanjiang Jin <yanjiang.jin@windriver.com>
---
 drivers/crypto/caam/ctrl.c | 6 ++++++
 1 file changed, 6 insertions(+)

diff --git a/drivers/crypto/caam/ctrl.c b/drivers/crypto/caam/ctrl.c
index 93ea6e3..3bbc225 100644
--- a/drivers/crypto/caam/ctrl.c
+++ b/drivers/crypto/caam/ctrl.c
@@ -628,9 +628,15 @@ static int caam_probe(struct platform_device *pdev)
 	 * Enable DECO watchdogs and, if this is a PHYS_ADDR_T_64BIT kernel,
 	 * long pointers in master configuration register
 	 */
+#ifdef CONFIG_PPC
+	clrsetbits_32(&ctrl->mcr, MCFGR_AWCACHE_MASK, MCFGR_AWCACHE_BUFF |
+		      MCFGR_WDENABLE | MCFGR_LARGE_BURST |
+		      (sizeof(dma_addr_t) == sizeof(u64) ? MCFGR_LONG_PTR : 0));
+#else
 	clrsetbits_32(&ctrl->mcr, MCFGR_AWCACHE_MASK, MCFGR_AWCACHE_CACH |
 		      MCFGR_AWCACHE_BUFF | MCFGR_WDENABLE | MCFGR_LARGE_BURST |
 		      (sizeof(dma_addr_t) == sizeof(u64) ? MCFGR_LONG_PTR : 0));
+#endif
 
 	/*
 	 *  Read the Compile Time paramters and SCFGR to determine
-- 
2.8.1

