From fbc4dc0b633137a6f7d5ea357adae4631d55e4bd Mon Sep 17 00:00:00 2001
From: "J. German Rivera" <German.Rivera@freescale.com>
Date: Thu, 26 Mar 2015 11:35:01 -0500
Subject: [PATCH 0474/1429] staging: fsl-mc: DPRC interrupt handler needs to
 handle all object events

dprc_irq0_handler_thread() was handling only:
- DPRC_IRQ_EVENT_OBJ_ADDED
- DPRC_IRQ_EVENT_OBJ_REMOVED

It also needs to handle:
- DPRC_IRQ_EVENT_CONTAINER_DESTROYED
- DPRC_IRQ_EVENT_OBJ_DESTROYED
- DPRC_IRQ_EVENT_OBJ_CREATED

Signed-off-by: J. German Rivera <German.Rivera@freescale.com>
Change-Id: Ibac82b9823e9cbd7e03998e15e6ecf5426dc55d3
Reviewed-on: http://git.am.freescale.net:8181/33627
Tested-by: Review Code-CDREVIEW <CDREVIEW@freescale.com>
Reviewed-by: Stuart Yoder <stuart.yoder@freescale.com>
[Original patch taken from QorIQ-SDK-V2.0-20160527-yocto]
Signed-off-by: Yanjiang Jin <yanjiang.jin@windriver.com>
---
 drivers/staging/fsl-mc/bus/dprc-driver.c |    6 +++++-
 1 files changed, 5 insertions(+), 1 deletions(-)

diff --git a/drivers/staging/fsl-mc/bus/dprc-driver.c b/drivers/staging/fsl-mc/bus/dprc-driver.c
index 8ddd9d7..8531ba8 100644
--- a/drivers/staging/fsl-mc/bus/dprc-driver.c
+++ b/drivers/staging/fsl-mc/bus/dprc-driver.c
@@ -426,7 +426,11 @@ static irqreturn_t dprc_irq0_handler_thread(int irq_num, void *arg)
 		goto out;
 	}
 
-	if (status & (DPRC_IRQ_EVENT_OBJ_ADDED | DPRC_IRQ_EVENT_OBJ_REMOVED)) {
+	if (status & (DPRC_IRQ_EVENT_OBJ_ADDED |
+		      DPRC_IRQ_EVENT_OBJ_REMOVED |
+		      DPRC_IRQ_EVENT_CONTAINER_DESTROYED |
+		      DPRC_IRQ_EVENT_OBJ_DESTROYED |
+		      DPRC_IRQ_EVENT_OBJ_CREATED)) {
 		unsigned int irq_count;
 
 		error = dprc_scan_objects(mc_dev, &irq_count);
-- 
1.7.5.4

