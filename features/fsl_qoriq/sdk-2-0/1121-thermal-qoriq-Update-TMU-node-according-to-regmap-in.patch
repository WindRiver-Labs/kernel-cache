From bbf87a4fb0f3545fbf9ac99934fd9f34da12cffa Mon Sep 17 00:00:00 2001
From: Jia Hongtao <hongtao.jia@freescale.com>
Date: Tue, 2 Feb 2016 17:49:07 +0800
Subject: [PATCH 1121/1383] thermal: qoriq: Update TMU node according to regmap
 interface

Two things updated on T102x/T104x/LS1021A platforms:
1. Add TMU endianness property.
2. Add SoC compatible string to indicate TMU sensor id.

Signed-off-by: Jia Hongtao <hongtao.jia@freescale.com>
[Original patch taken from QorIQ-SDK-V2.0-20160527-yocto]
Signed-off-by: Yanjiang Jin <yanjiang.jin@windriver.com>
---
 arch/arm/boot/dts/ls1021a.dtsi              | 7 ++++---
 arch/powerpc/boot/dts/fsl/t1023si-post.dtsi | 7 ++++---
 arch/powerpc/boot/dts/fsl/t1040si-post.dtsi | 7 ++++---
 3 files changed, 12 insertions(+), 9 deletions(-)

diff --git a/arch/arm/boot/dts/ls1021a.dtsi b/arch/arm/boot/dts/ls1021a.dtsi
index be26364..8f085ec 100644
--- a/arch/arm/boot/dts/ls1021a.dtsi
+++ b/arch/arm/boot/dts/ls1021a.dtsi
@@ -264,7 +264,7 @@
 		};
 
 		tmu: tmu@1f00000 {
-			compatible = "fsl,qoriq-tmu";
+			compatible = "fsl,qoriq-tmu", "fsl,ls1021a-tmu";
 			reg = <0x0 0x1f00000 0x0 0x10000>;
 			interrupts = <GIC_SPI 61 IRQ_TYPE_LEVEL_HIGH>;
 			fsl,tmu-range = <0xb0000 0xa0026 0x80048 0x30061>;
@@ -307,7 +307,8 @@
 					       0x00030001 0x0000000d
 					       0x00030002 0x00000019
 					       0x00030003 0x00000024>;
-			#thermal-sensor-cells = <0>;
+			big-endian;
+			#thermal-sensor-cells = <1>;
 		};
 
 		thermal-zones {
@@ -315,7 +316,7 @@
 				polling-delay-passive = <1000>;
 				polling-delay = <5000>;
 
-				thermal-sensors = <&tmu>;
+				thermal-sensors = <&tmu 0>;
 
 				trips {
 					cpu_alert: cpu-alert {
diff --git a/arch/powerpc/boot/dts/fsl/t1023si-post.dtsi b/arch/powerpc/boot/dts/fsl/t1023si-post.dtsi
index 3d50c7a..38706bc2 100644
--- a/arch/powerpc/boot/dts/fsl/t1023si-post.dtsi
+++ b/arch/powerpc/boot/dts/fsl/t1023si-post.dtsi
@@ -471,7 +471,7 @@
 	};
 
 	tmu: tmu@f0000 {
-		compatible = "fsl,qoriq-tmu";
+		compatible = "fsl,qoriq-tmu", "fsl,t102x-tmu";
 		reg = <0xf0000 0x1000>;
 		interrupts = <18 2 0 0>;
 		fsl,tmu-range = <0xb0000 0xa0026 0x80048 0x30061>;
@@ -514,7 +514,8 @@
 				       0x00030001 0x0000000d
 				       0x00030002 0x00000019
 				       0x00030003 0x00000024>;
-		#thermal-sensor-cells = <0>;
+		little-endian;
+		#thermal-sensor-cells = <1>;
 	};
 
 	thermal-zones {
@@ -522,7 +523,7 @@
 			polling-delay-passive = <1000>;
 			polling-delay = <5000>;
 
-			thermal-sensors = <&tmu>;
+			thermal-sensors = <&tmu 0>;
 
 			trips {
 				cpu_alert: cpu-alert {
diff --git a/arch/powerpc/boot/dts/fsl/t1040si-post.dtsi b/arch/powerpc/boot/dts/fsl/t1040si-post.dtsi
index a44b56d9..3383f93 100644
--- a/arch/powerpc/boot/dts/fsl/t1040si-post.dtsi
+++ b/arch/powerpc/boot/dts/fsl/t1040si-post.dtsi
@@ -516,7 +516,7 @@
 	};
 
 	tmu: tmu@f0000 {
-		compatible = "fsl,qoriq-tmu";
+		compatible = "fsl,qoriq-tmu", "fsl,t104x-tmu";
 		reg = <0xf0000 0x1000>;
 		interrupts = <18 2 0 0>;
 		fsl,tmu-range = <0xa0000 0x90026 0x8004a 0x1006a>;
@@ -555,7 +555,8 @@
 
 				       0x00030000 0x00000012
 				       0x00030001 0x0000001d>;
-		#thermal-sensor-cells = <0>;
+		little-endian;
+		#thermal-sensor-cells = <1>;
 	};
 
 	thermal-zones {
@@ -563,7 +564,7 @@
 			polling-delay-passive = <1000>;
 			polling-delay = <5000>;
 
-			thermal-sensors = <&tmu>;
+			thermal-sensors = <&tmu 2>;
 
 			trips {
 				cpu_alert: cpu-alert {
-- 
2.8.1

