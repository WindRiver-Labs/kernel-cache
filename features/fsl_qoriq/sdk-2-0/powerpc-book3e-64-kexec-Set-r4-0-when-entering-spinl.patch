From 41a74c625104cc1518a1a0b93d2480df16cd54c5 Mon Sep 17 00:00:00 2001
From: Scott Wood <scottwood@freescale.com>
Date: Tue, 6 Oct 2015 22:48:21 -0500
Subject: [PATCH 1092/1429] powerpc/book3e-64/kexec: Set "r4 = 0" when
 entering spinloop

commit ae73e4ccbc91853259d730fd8c5089bdf06a4fa3 upstream

book3e_secondary_core_init will only create a TLB entry if r4 = 0,
so do so.

Signed-off-by: Scott Wood <scottwood@freescale.com>
Signed-off-by: Yanjiang Jin <yanjiang.jin@windriver.com>
---
 arch/powerpc/kernel/misc_64.S |    4 ++++
 1 files changed, 4 insertions(+), 0 deletions(-)

diff --git a/arch/powerpc/kernel/misc_64.S b/arch/powerpc/kernel/misc_64.S
index c5915f0..ff578f9 100644
--- a/arch/powerpc/kernel/misc_64.S
+++ b/arch/powerpc/kernel/misc_64.S
@@ -476,6 +476,10 @@ _GLOBAL(kexec_wait)
 #ifdef CONFIG_KEXEC		/* use no memory without kexec */
 	lwz	r4,0(r5)
 	cmpwi	0,r4,0
+#ifndef CONFIG_PPC_BOOK3S_64
+	/* Create TLB entry in book3e_secondary_core_init */
+	li	r4,0
+#endif
 	bnea	0x60
 #endif
 	b	99b
-- 
1.7.5.4

