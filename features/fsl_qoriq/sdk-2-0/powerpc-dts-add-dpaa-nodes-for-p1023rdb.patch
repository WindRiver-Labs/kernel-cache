From 1bfd52a1acbd280a604cdaf512ac6e7fbc016efb Mon Sep 17 00:00:00 2001
From: Shaohui Xie <Shaohui.Xie@freescale.com>
Date: Wed, 3 Feb 2016 11:52:38 +0800
Subject: [PATCH 0887/1429] powerpc: dts: add dpaa nodes for p1023rdb

Signed-off-by: Shaohui Xie <Shaohui.Xie@freescale.com>
[Original patch taken from QorIQ-SDK-V2.0-20160527-yocto]
Signed-off-by: Yanjiang Jin <yanjiang.jin@windriver.com>
---
 arch/powerpc/boot/dts/fsl/p1023rdb.dts      |   51 ++++++++
 arch/powerpc/boot/dts/fsl/p1023si-post.dtsi |  166 +++++++++++++++++++++++++++
 arch/powerpc/boot/dts/fsl/p1023si-pre.dtsi  |    4 +
 3 files changed, 221 insertions(+), 0 deletions(-)

diff --git a/arch/powerpc/boot/dts/fsl/p1023rdb.dts b/arch/powerpc/boot/dts/fsl/p1023rdb.dts
index 13dc349..9001a9d 100644
--- a/arch/powerpc/boot/dts/fsl/p1023rdb.dts
+++ b/arch/powerpc/boot/dts/fsl/p1023rdb.dts
@@ -43,6 +43,11 @@
 	#size-cells = <2>;
 	interrupt-parent = <&mpic>;
 
+	aliases {
+		ethernet0 = &enet0;
+		ethernet1 = &enet1;
+	};
+
 	memory {
 		device_type = "memory";
 	};
@@ -56,12 +61,24 @@
 			size = <0 0x1000000>;
 			alignment = <0 0x1000000>;
 		};
+		qman_fqd: qman-fqd {
+			size = <0 0x400000>;
+			alignment = <0 0x400000>;
+		};
+		qman_pfdr: qman-pfdr {
+			size = <0 0x2000000>;
+			alignment = <0 0x2000000>;
+		};
 	};
 
 	bportals: bman-portals@ff200000 {
 		ranges = <0x0 0xf 0xff200000 0x200000>;
 	};
 
+	qportals: qman-portals@ff000000 {
+		ranges = <0x0 0xf 0xff000000 0x200000>;
+	};
+
 	soc: soc@ff600000 {
 		ranges = <0x0 0x0 0xff600000 0x200000>;
 
@@ -81,6 +98,25 @@
 			dr_mode = "host";
 			phy_type = "ulpi";
 		};
+
+		fman0: fman@100000 {
+			enet0: ethernet@e0000 {
+				phy-handle = <&phy0>;
+				phy-connection-type = "rgmii";
+			};
+			enet1: ethernet@e2000 {
+				phy-handle = <&phy1>;
+				phy-connection-type = "rgmii";
+			};
+			mdio0: mdio@e1120 {
+				phy0: ethernet-phy@1 {
+					reg = <0x01>;
+				};
+				phy1: ethernet-phy@2 {
+					reg = <0x02>;
+				};
+			};
+		};
 	};
 
 	lbc: localbus@ff605000 {
@@ -243,6 +279,21 @@
 				  0x0 0x100000>;
 		};
 	};
+
+	fsl,dpaa {
+		compatible = "fsl,p1023-dpaa", "fsl,dpaa";
+
+		ethernet@0 {
+			compatible = "fsl,p1023-dpa-ethernet", "fsl,dpa-ethernet";
+			fsl,fman-mac = <&enet0>;
+		};
+		ethernet@1 {
+			compatible = "fsl,p1023-dpa-ethernet", "fsl,dpa-ethernet";
+			fsl,fman-mac = <&enet1>;
+		};
+	};
 };
 
 /include/ "p1023si-post.dtsi"
+
+/include/ "qoriq-dpaa-res2.dtsi"
diff --git a/arch/powerpc/boot/dts/fsl/p1023si-post.dtsi b/arch/powerpc/boot/dts/fsl/p1023si-post.dtsi
index 7780f21..50ece91 100644
--- a/arch/powerpc/boot/dts/fsl/p1023si-post.dtsi
+++ b/arch/powerpc/boot/dts/fsl/p1023si-post.dtsi
@@ -37,6 +37,16 @@
 	alloc-ranges = <0 0 0x10 0>;
 };
 
+&qman_fqd {
+	compatible = "fsl,qman-fqd";
+	alloc-ranges = <0 0 0x10 0>;
+};
+
+&qman_pfdr {
+	compatible = "fsl,qman-pfdr";
+	alloc-ranges = <0 0 0x10 0>;
+};
+
 &lbc {
 	#address-cells = <2>;
 	#size-cells = <1>;
@@ -124,6 +134,35 @@
 	};
 };
 
+&qportals {
+	#address-cells = <1>;
+	#size-cells = <1>;
+	compatible = "simple-bus";
+	qportal0: qman-portal@0 {
+		cell-index = <0>;
+		compatible = "fsl,qman-portal";
+		reg = <0x0 0x4000 0x100000 0x1000>;
+		interrupts = <29 2 0 0>;
+		fsl,qman-channel-id = <0>;
+	};
+
+	qportal1: qman-portal@4000 {
+		cell-index = <1>;
+		compatible = "fsl,qman-portal";
+		reg = <0x4000 0x4000 0x101000 0x1000>;
+		interrupts = <31 2 0 0>;
+		fsl,qman-channel-id = <1>;
+	};
+
+	qportal2: qman-portal@8000 {
+		cell-index = <2>;
+		compatible = "fsl,qman-portal";
+		reg = <0x8000 0x4000 0x102000 0x1000>;
+		interrupts = <33 2 0 0>;
+		fsl,qman-channel-id = <2>;
+	};
+};
+
 &soc {
 	#address-cells = <1>;
 	#size-cells = <1>;
@@ -248,6 +287,14 @@
 /include/ "pq3-mpic.dtsi"
 /include/ "pq3-mpic-timer-B.dtsi"
 
+	qman: qman@88000 {
+		compatible = "fsl,qman";
+		reg = <0x88000 0x1000>;
+		interrupts = <16 2 0 0>;
+		fsl,qman-portals = <&qportals>;
+		memory-region = <&qman_fqd &qman_pfdr>;
+	};
+
 	bman: bman@8a000 {
 		compatible = "fsl,bman";
 		reg = <0x8a000 0x1000>;
@@ -261,4 +308,123 @@
 		reg = <0xe0000 0x1000>;
 		fsl,has-rstcr;
 	};
+
+	fman0: fman@100000 {
+		#address-cells = <1>;
+		#size-cells = <1>;
+		cell-index = <0>;
+		compatible = "fsl,fman", "simple-bus";
+		ranges = <0 0x100000 0x100000>;
+		reg = <0x100000 0x100000>;
+		clock-frequency = <0>;
+		interrupts = <
+			24 2 0 0
+			16 2 0 0>;
+		cc@0 {
+			compatible = "fsl,fman-cc";
+		};
+		muram@0 {
+			compatible = "fsl,fman-muram";
+			reg = <0x0 0x10000>;
+		};
+		bmi@80000 {
+			compatible = "fsl,fman-bmi";
+			reg = <0x80000 0x400>;
+		};
+		qmi@80400 {
+			compatible = "fsl,fman-qmi";
+			reg = <0x80400 0x400>;
+		};
+		policer@c0000 {
+			compatible = "fsl,fman-policer";
+			reg = <0xc0000 0x1000>;
+		};
+		keygen@c1000 {
+			compatible = "fsl,fman-keygen";
+			reg = <0xc1000 0x1000>;
+		};
+		dma@c2000 {
+			compatible = "fsl,fman-dma";
+			reg = <0xc2000 0x1000>;
+		};
+		fpm@c3000 {
+			compatible = "fsl,fman-fpm";
+			reg = <0xc3000 0x1000>;
+		};
+		parser@c7000 {
+			compatible = "fsl,fman-parser";
+			reg = <0xc7000 0x1000>;
+		};
+		fman0_rx0: port@88000 {
+			cell-index = <0>;
+			compatible = "fsl,fman-port-1g-rx";
+			reg = <0x88000 0x1000>;
+		};
+		fman0_rx1: port@89000 {
+			cell-index = <1>;
+			compatible = "fsl,fman-port-1g-rx";
+			reg = <0x89000 0x1000>;
+		};
+		fman0_tx0: port@a8000 {
+			cell-index = <0>;
+			compatible = "fsl,fman-port-1g-tx";
+			reg = <0xa8000 0x1000>;
+			fsl,qman-channel-id = <0x40>;
+		};
+		fman0_tx1: port@a9000 {
+			cell-index = <1>;
+			compatible = "fsl,fman-port-1g-tx";
+			reg = <0xa9000 0x1000>;
+			fsl,qman-channel-id = <0x41>;
+		};
+		fman0_oh1: port@82000 {
+			cell-index = <1>;
+			compatible = "fsl,fman-port-oh";
+			reg = <0x82000 0x1000>;
+			fsl,qman-channel-id = <0x43>;
+		};
+		fman0_oh2: port@83000 {
+			cell-index = <2>;
+			compatible = "fsl,fman-port-oh";
+			reg = <0x83000 0x1000>;
+			fsl,qman-channel-id = <0x44>;
+		};
+		fman0_oh3: port@84000 {
+			cell-index = <3>;
+			compatible = "fsl,fman-port-oh";
+			reg = <0x84000 0x1000>;
+			fsl,qman-channel-id = <0x45>;
+		};
+		fman0_oh4: port@85000 {
+			cell-index = <4>;
+			compatible = "fsl,fman-port-oh";
+			reg = <0x85000 0x1000>;
+			fsl,qman-channel-id = <0x46>;
+		};
+		enet0: ethernet@e0000 {
+			cell-index = <0>;
+			compatible = "fsl,fman-1g-mac";
+			reg = <0xe0000 0x1000>;
+			fsl,port-handles = <&fman0_rx0 &fman0_tx0>;
+			ptimer-handle = <&ptp_timer0>;
+		};
+		enet1: ethernet@e2000 {
+			cell-index = <1>;
+			compatible = "fsl,fman-1g-mac";
+			reg = <0xe2000 0x1000>;
+			fsl,port-handles = <&fman0_rx1 &fman0_tx1>;
+			ptimer-handle = <&ptp_timer0>;
+		};
+		mdio0: mdio@e1120 {
+			#address-cells = <1>;
+			#size-cells = <0>;
+			compatible = "fsl,fman-mdio";
+			reg = <0xe1120 0xee0>;
+			interrupts = <26 1 0 0>;
+		};
+		ptp_timer0: rtc@fe000 {
+			compatible = "fsl,fman-rtc";
+			reg = <0xfe000 0x1000>;
+		};
+	};
 };
diff --git a/arch/powerpc/boot/dts/fsl/p1023si-pre.dtsi b/arch/powerpc/boot/dts/fsl/p1023si-pre.dtsi
index 132a152..0ec85e5 100644
--- a/arch/powerpc/boot/dts/fsl/p1023si-pre.dtsi
+++ b/arch/powerpc/boot/dts/fsl/p1023si-pre.dtsi
@@ -58,6 +58,10 @@
 		rtic_b = &rtic_b;
 		rtic_c = &rtic_c;
 		rtic_d = &rtic_d;
+
+		qman = &qman;
+		bman = &bman;
+		fman0 = &fman0;
 	};
 
 	cpus {
-- 
1.7.5.4

