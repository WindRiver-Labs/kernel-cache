From 968ca44b3b3ba84735a3806019e6a61c0fb4f3da Mon Sep 17 00:00:00 2001
From: Yanjiang Jin <yanjiang.jin@windriver.com>
Date: Mon, 12 Sep 2016 14:35:37 +0800
Subject: [PATCH] RT: DPAA: Workaround: set NAPI weight to 2048

In RT kernel, when 10G ports run at line speed, it will eat almost all
CPU resources, so that other threads can't be scheduled.
So change DPA_GENERIC_NAPI_WEIGHT to 2048 as a workaround.

Signed-off-by: Yanjiang Jin <yanjiang.jin@windriver.com>
---
 .../ethernet/freescale/sdk_dpaa/dpaa_eth_generic.c |    4 ++++
 1 files changed, 4 insertions(+), 0 deletions(-)

diff --git a/drivers/net/ethernet/freescale/sdk_dpaa/dpaa_eth_generic.c b/drivers/net/ethernet/freescale/sdk_dpaa/dpaa_eth_generic.c
index 3464313..3b8f4da 100644
--- a/drivers/net/ethernet/freescale/sdk_dpaa/dpaa_eth_generic.c
+++ b/drivers/net/ethernet/freescale/sdk_dpaa/dpaa_eth_generic.c
@@ -45,7 +45,11 @@
 
 #define DPA_DEFAULT_TX_HEADROOM		64
 #define DPA_GENERIC_SKB_COPY_MAX_SIZE	256
+#ifdef CONFIG_PREEMPT_RT_FULL
+#define DPA_GENERIC_NAPI_WEIGHT		2048
+#else
 #define DPA_GENERIC_NAPI_WEIGHT		64
+#endif
 #define DPA_GENERIC_DESCRIPTION "FSL DPAA Generic Ethernet driver"
 #define DPA_GENERIC_BUFFER_QUOTA       	4
 
-- 
1.7.5.4

