From 6fd1f0ec43e61134e2ac6662932694eb9bfc7960 Mon Sep 17 00:00:00 2001
From: Madalin Bucur <madalin.bucur@freescale.com>
Date: Wed, 23 Mar 2016 19:58:50 +0200
Subject: [PATCH 1233/1383] powerpc/dts: align to the new clocking model

Signed-off-by: Madalin Bucur <madalin.bucur@freescale.com>
[Original patch taken from QorIQ-SDK-V2.0-20160527-yocto]
Signed-off-by: Yanjiang Jin <yanjiang.jin@windriver.com>
---
 arch/powerpc/boot/dts/fsl/qoriq-clockgen1.dtsi | 4 ++--
 arch/powerpc/boot/dts/fsl/qoriq-clockgen2.dtsi | 3 ++-
 arch/powerpc/boot/dts/fsl/qoriq-fman-0.dtsi    | 8 ++++----
 arch/powerpc/boot/dts/fsl/qoriq-fman-1.dtsi    | 8 ++++----
 arch/powerpc/boot/dts/fsl/qoriq-fman3-0.dtsi   | 8 ++++----
 arch/powerpc/boot/dts/fsl/qoriq-fman3-1.dtsi   | 8 ++++----
 6 files changed, 20 insertions(+), 19 deletions(-)

diff --git a/arch/powerpc/boot/dts/fsl/qoriq-clockgen1.dtsi b/arch/powerpc/boot/dts/fsl/qoriq-clockgen1.dtsi
index 4ece1ed..3237d7c 100644
--- a/arch/powerpc/boot/dts/fsl/qoriq-clockgen1.dtsi
+++ b/arch/powerpc/boot/dts/fsl/qoriq-clockgen1.dtsi
@@ -32,13 +32,13 @@
  * SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.
  */
 
-global-utilities@e1000 {
+clockgen: global-utilities@e1000 {
 	compatible = "fsl,qoriq-clockgen-1.0";
-	ranges = <0x0 0xe1000 0x1000>;
 	reg = <0xe1000 0x1000>;
 	clock-frequency = <0>;
 	#address-cells = <1>;
 	#size-cells = <1>;
+	#clock-cells = <2>;
 
 	sysclk: sysclk {
 		#clock-cells = <0>;
diff --git a/arch/powerpc/boot/dts/fsl/qoriq-clockgen2.dtsi b/arch/powerpc/boot/dts/fsl/qoriq-clockgen2.dtsi
index 48e0b6e..6dfd7c5 100644
--- a/arch/powerpc/boot/dts/fsl/qoriq-clockgen2.dtsi
+++ b/arch/powerpc/boot/dts/fsl/qoriq-clockgen2.dtsi
@@ -32,12 +32,13 @@
  * SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.
  */
 
-global-utilities@e1000 {
+clockgen: global-utilities@e1000 {
 	compatible = "fsl,qoriq-clockgen-2.0";
 	ranges = <0x0 0xe1000 0x1000>;
 	reg = <0xe1000 0x1000>;
 	#address-cells = <1>;
 	#size-cells = <1>;
+	#clock-cells = <2>;
 
 	sysclk: sysclk {
 		#clock-cells = <0>;
diff --git a/arch/powerpc/boot/dts/fsl/qoriq-fman-0.dtsi b/arch/powerpc/boot/dts/fsl/qoriq-fman-0.dtsi
index b074d13..6b4246f 100644
--- a/arch/powerpc/boot/dts/fsl/qoriq-fman-0.dtsi
+++ b/arch/powerpc/boot/dts/fsl/qoriq-fman-0.dtsi
@@ -39,10 +39,10 @@ fman0: fman@400000 {
 	compatible = "fsl,fman", "simple-bus";
 	ranges = <0 0x400000 0x100000>;
 	reg = <0x400000 0x100000>;
-	clock-frequency = <0>;
-	interrupts = <
-		96 2 0 0
-		16 2 1 1>;
+	interrupts = <96 2 0 0>, <16 2 1 1>;
+	clocks = <&clockgen 3 0>;
+	clock-names = "fmanclk";
+	fsl,qman-channel-range = <0x40 0xc>;
 
 	cc {
 		compatible = "fsl,fman-cc";
diff --git a/arch/powerpc/boot/dts/fsl/qoriq-fman-1.dtsi b/arch/powerpc/boot/dts/fsl/qoriq-fman-1.dtsi
index d94f6cc..24737cf 100644
--- a/arch/powerpc/boot/dts/fsl/qoriq-fman-1.dtsi
+++ b/arch/powerpc/boot/dts/fsl/qoriq-fman-1.dtsi
@@ -39,10 +39,10 @@ fman1: fman@500000 {
 	compatible = "fsl,fman", "simple-bus";
 	ranges = <0 0x500000 0x100000>;
 	reg = <0x500000 0x100000>;
-	clock-frequency = <0>;
-	interrupts = <
-		97 2 0 0
-		16 2 1 0>;
+	interrupts = <97 2 0 0>, <16 2 1 0>;
+	clocks = <&clockgen 3 1>;
+	clock-names = "fmanclk";
+	fsl,qman-channel-range = <0x60 0xc>;
 
 	cc {
 		compatible = "fsl,fman-cc";
diff --git a/arch/powerpc/boot/dts/fsl/qoriq-fman3-0.dtsi b/arch/powerpc/boot/dts/fsl/qoriq-fman3-0.dtsi
index 28f38b9..8641c89 100644
--- a/arch/powerpc/boot/dts/fsl/qoriq-fman3-0.dtsi
+++ b/arch/powerpc/boot/dts/fsl/qoriq-fman3-0.dtsi
@@ -39,10 +39,10 @@ fman0: fman@400000 {
 	compatible = "fsl,fman", "simple-bus";
 	ranges = <0 0x400000 0x100000>;
 	reg = <0x400000 0x100000>;
-	clock-frequency = <0>;
-	interrupts = <
-		96 2 0 0
-		16 2 1 1>;
+	interrupts = <96 2 0 0>, <16 2 1 1>;
+	clocks = <&clockgen 3 0>;
+	clock-names = "fmanclk";
+	fsl,qman-channel-range = <0x800 0x10>;
 
 	cc {
 		compatible = "fsl,fman-cc";
diff --git a/arch/powerpc/boot/dts/fsl/qoriq-fman3-1.dtsi b/arch/powerpc/boot/dts/fsl/qoriq-fman3-1.dtsi
index 4eeb060..bd482d6 100644
--- a/arch/powerpc/boot/dts/fsl/qoriq-fman3-1.dtsi
+++ b/arch/powerpc/boot/dts/fsl/qoriq-fman3-1.dtsi
@@ -39,10 +39,10 @@ fman1: fman@500000 {
 	compatible = "fsl,fman", "simple-bus";
 	ranges = <0 0x500000 0x100000>;
 	reg = <0x500000 0x100000>;
-	clock-frequency = <0>;
-	interrupts = <
-		97 2 0 0
-		16 2 1 0>;
+	interrupts = <97 2 0 0>, <16 2 1 0>;
+	clocks = <&clockgen 3 1>;
+	clock-names = "fmanclk";
+	fsl,qman-channel-range = <0x820 0x10>;
 
 	cc {
 		compatible = "fsl,fman-cc";
-- 
2.8.1

