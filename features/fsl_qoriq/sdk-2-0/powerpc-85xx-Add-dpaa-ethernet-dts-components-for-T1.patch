From c3582a469b07c8cfccb6355671784041fbe257d4 Mon Sep 17 00:00:00 2001
From: Priyanka Jain <Priyanka.Jain@freescale.com>
Date: Fri, 5 Feb 2016 15:21:18 +0530
Subject: [PATCH 0912/1429] powerpc/85xx: Add dpaa ethernet dts components for
 T104xRDB, T104xQDS

Signed-off-by: Priyanka Jain <Priyanka.Jain@freescale.com>
[Original patch taken from QorIQ-SDK-V2.0-20160527-yocto]
Signed-off-by: Yanjiang Jin <yanjiang.jin@windriver.com>
---
 arch/powerpc/boot/dts/fsl/t1040qds.dts  |    1 +
 arch/powerpc/boot/dts/fsl/t1040rdb.dts  |   98 ++++++++++++++
 arch/powerpc/boot/dts/fsl/t1042rdb.dts  |   75 +++++++++++
 arch/powerpc/boot/dts/fsl/t104xqds.dtsi |  213 +++++++++++++++++++++++++++++++
 arch/powerpc/boot/dts/fsl/t104xrdb.dtsi |   13 ++
 5 files changed, 400 insertions(+), 0 deletions(-)

diff --git a/arch/powerpc/boot/dts/fsl/t1040qds.dts b/arch/powerpc/boot/dts/fsl/t1040qds.dts
index 5f76edc..e08cf13 100644
--- a/arch/powerpc/boot/dts/fsl/t1040qds.dts
+++ b/arch/powerpc/boot/dts/fsl/t1040qds.dts
@@ -44,3 +44,4 @@
 };
 
 #include "t1040si-post.dtsi"
+/include/ "qoriq-dpaa-res3.dtsi"
diff --git a/arch/powerpc/boot/dts/fsl/t1040rdb.dts b/arch/powerpc/boot/dts/fsl/t1040rdb.dts
index d52b011..57908e1 100644
--- a/arch/powerpc/boot/dts/fsl/t1040rdb.dts
+++ b/arch/powerpc/boot/dts/fsl/t1040rdb.dts
@@ -38,6 +38,12 @@
 / {
 	model = "fsl,T1040RDB";
 	compatible = "fsl,T1040RDB";
+	aliases {
+		phy_rgmii_0 = &phy_rgmii_0;
+		phy_rgmii_1 = &phy_rgmii_1;
+		phy_sgmii_2 = &phy_sgmii_2;
+	};
+
 	ifc: localbus@ffe124000 {
 		cpld@3,0 {
 			compatible = "fsl,t1040rdb-cpld";
@@ -52,7 +58,99 @@
 				spi-max-frequency = <2000000>; /* input clock */
 			};
 		};
+		fman0: fman@400000 {
+
+			enet0: ethernet@e0000 {
+				fixed-link = <0 1 1000 0 0>;
+				phy-connection-type = "sgmii";
+			};
+
+			enet1: ethernet@e2000 {
+				fixed-link = <1 1 1000 0 0>;
+				phy-connection-type = "sgmii";
+			};
+
+			enet2: ethernet@e4000 {
+				phy-handle = <&phy_sgmii_2>;
+				phy-connection-type = "sgmii";
+			};
+
+			enet3: ethernet@e6000 {
+				phy-handle = <&phy_rgmii_0>;
+				phy-connection-type = "rgmii";
+			};
+
+			enet4: ethernet@e8000 {
+				phy-handle = <&phy_rgmii_1>;
+				phy-connection-type = "rgmii";
+			};
+
+			mdio0: mdio@fc000 {
+				phy_sgmii_2: ethernet-phy@03 {
+					reg = <0x03>;
+				};
+				phy_rgmii_0: ethernet-phy@01 {
+					reg = <0x01>;
+				};
+				phy_rgmii_1: ethernet-phy@02 {
+					reg = <0x02>;
+				};
+				phy_qsgmii_0: ethernet-phy@04 {
+					reg = <0x04>;
+				};
+				phy_qsgmii_1: ethernet-phy@05 {
+					reg = <0x05>;
+				};
+				phy_qsgmii_2: ethernet-phy@06 {
+					reg = <0x06>;
+				};
+				phy_qsgmii_3: ethernet-phy@07 {
+					reg = <0x07>;
+				};
+				phy_qsgmii_4: ethernet-phy@08 {
+					reg = <0x08>;
+				};
+				phy_qsgmii_5: ethernet-phy@09 {
+					reg = <0x09>;
+				};
+				phy_qsgmii_6: ethernet-phy@0a {
+					reg = <0x0a>;
+				};
+				phy_qsgmii_7: ethernet-phy@0b {
+					reg = <0x0b>;
+				};
+			};
+		};
+	};
+	fsl,dpaa {
+		compatible = "fsl,t1040-dpaa", "fsl,dpaa";
+		ethernet@0 {
+			compatible = "fsl,t1040-dpa-ethernet",
+					"fsl,dpa-ethernet";
+			fsl,fman-mac = <&enet0>;
+		};
+		ethernet@1 {
+			compatible = "fsl,t1040-dpa-ethernet",
+					"fsl,dpa-ethernet";
+			fsl,fman-mac = <&enet1>;
+		};
+		ethernet@2 {
+			compatible = "fsl,t1040-dpa-ethernet",
+					"fsl,dpa-ethernet";
+			fsl,fman-mac = <&enet2>;
+		};
+		ethernet@3 {
+			compatible = "fsl,t1040-dpa-ethernet",
+					"fsl,dpa-ethernet";
+			fsl,fman-mac = <&enet3>;
+		};
+		ethernet@4 {
+			compatible = "fsl,t1040-dpa-ethernet",
+					"fsl,dpa-ethernet";
+			fsl,fman-mac = <&enet4>;
+		};
 	};
 };
 
 #include "t1040si-post.dtsi"
+/include/ "qoriq-dpaa-res3.dtsi"
diff --git a/arch/powerpc/boot/dts/fsl/t1042rdb.dts b/arch/powerpc/boot/dts/fsl/t1042rdb.dts
index 8d908e7..16127db 100644
--- a/arch/powerpc/boot/dts/fsl/t1042rdb.dts
+++ b/arch/powerpc/boot/dts/fsl/t1042rdb.dts
@@ -38,11 +38,86 @@
 / {
 	model = "fsl,T1042RDB";
 	compatible = "fsl,T1042RDB";
+	aliases {
+		phy_rgmii_0 = &phy_rgmii_0;
+		phy_rgmii_1 = &phy_rgmii_1;
+		phy_sgmii_2 = &phy_sgmii_2;
+	};
+
 	ifc: localbus@ffe124000 {
 		cpld@3,0 {
 			compatible = "fsl,t1042rdb-cpld";
 		};
 	};
+	soc: soc@ffe000000 {
+		fman0: fman@400000 {
+
+			enet0: ethernet@e0000 {
+				status = "disabled";
+			};
+
+			enet1: ethernet@e2000 {
+				status = "disabled";
+			};
+
+			enet2: ethernet@e4000 {
+				phy-handle = <&phy_sgmii_2>;
+				phy-connection-type = "sgmii";
+			};
+
+			enet3: ethernet@e6000 {
+				phy-handle = <&phy_rgmii_0>;
+				phy-connection-type = "rgmii";
+			};
+
+			enet4: ethernet@e8000 {
+				phy-handle = <&phy_rgmii_1>;
+				phy-connection-type = "rgmii";
+			};
+
+			mdio0: mdio@fc000 {
+				phy_sgmii_2: ethernet-phy@03 {
+					reg = <0x03>;
+				};
+				phy_rgmii_0: ethernet-phy@01 {
+					reg = <0x01>;
+				};
+				phy_rgmii_1: ethernet-phy@02 {
+					reg = <0x02>;
+				};
+			};
+		};
+
+	};
+	fsl,dpaa {
+		compatible = "fsl,t1040-dpaa", "fsl,dpaa";
+		ethernet@0 {
+			compatible = "fsl,t1040-dpa-ethernet",
+					"fsl,dpa-ethernet";
+			fsl,fman-mac = <&enet0>;
+		};
+		ethernet@1 {
+			compatible = "fsl,t1040-dpa-ethernet",
+					"fsl,dpa-ethernet";
+			fsl,fman-mac = <&enet1>;
+		};
+		ethernet@2 {
+			compatible = "fsl,t1040-dpa-ethernet",
+					"fsl,dpa-ethernet";
+			fsl,fman-mac = <&enet2>;
+		};
+		ethernet@3 {
+			compatible = "fsl,t1040-dpa-ethernet",
+					"fsl,dpa-ethernet";
+			fsl,fman-mac = <&enet3>;
+		};
+		ethernet@4 {
+			compatible = "fsl,t1040-dpa-ethernet",
+					"fsl,dpa-ethernet";
+			fsl,fman-mac = <&enet4>;
+		};
+	};
 };
 
 #include "t1042si-post.dtsi"
+/include/ "qoriq-dpaa-res3.dtsi"
diff --git a/arch/powerpc/boot/dts/fsl/t104xqds.dtsi b/arch/powerpc/boot/dts/fsl/t104xqds.dtsi
index a5392c4..2c81703 100644
--- a/arch/powerpc/boot/dts/fsl/t104xqds.dtsi
+++ b/arch/powerpc/boot/dts/fsl/t104xqds.dtsi
@@ -38,6 +38,33 @@
 	#size-cells = <2>;
 	interrupt-parent = <&mpic>;
 
+	aliases {
+		emi1_rgmii0 = &t1040mdio0;
+		emi1_rgmii1 = &t1040mdio1;
+		emi1_slot3 = &t1040mdio3;
+		emi1_slot5 = &t1040mdio5;
+		emi1_slot6 = &t1040mdio6;
+		emi1_slot7 = &t1040mdio7;
+		rgmii_phy1 = &rgmii_phy1;
+		rgmii_phy2 = &rgmii_phy2;
+		phy_s3_01 = &phy_s3_01;
+		phy_s3_02 = &phy_s3_02;
+		phy_s3_03 = &phy_s3_03;
+		phy_s3_04 = &phy_s3_04;
+		phy_s5_01 = &phy_s5_01;
+		phy_s5_02 = &phy_s5_02;
+		phy_s5_03 = &phy_s5_03;
+		phy_s5_04 = &phy_s5_04;
+		phy_s6_01 = &phy_s6_01;
+		phy_s6_02 = &phy_s6_02;
+		phy_s6_03 = &phy_s6_03;
+		phy_s6_04 = &phy_s6_04;
+		phy_s7_01 = &phy_s7_01;
+		phy_s7_02 = &phy_s7_02;
+		phy_s7_03 = &phy_s7_03;
+		phy_s7_04 = &phy_s7_04;
+	};
+
 	reserved-memory {
 		#address-cells = <2>;
 		#size-cells = <2>;
@@ -47,6 +74,14 @@
 			size = <0 0x1000000>;
 			alignment = <0 0x1000000>;
 		};
+		qman_fqd: qman-fqd {
+			size = <0 0x400000>;
+			alignment = <0 0x400000>;
+		};
+		qman_pfdr: qman-pfdr {
+			size = <0 0x2000000>;
+			alignment = <0 0x2000000>;
+		};
 	};
 
 	ifc: localbus@ffe124000 {
@@ -77,6 +112,120 @@
 			#size-cells = <1>;
 			compatible = "fsl,fpga-qixis";
 			reg = <3 0 0x300>;
+			mdio-mux-emi1 {
+				compatible = "mdio-mux-mmioreg", "mdio-mux";
+				mdio-parent-bus = <&mdio0>;
+				#address-cells = <1>;
+				#size-cells = <0>;
+				reg = <0x54 1>;    /* BRDCFG4 */
+				mux-mask = <0xe0>; /* EMI1 */
+
+				/* On-board RGMII1 PHY */
+				t1040mdio0: mdio@0 {
+					reg = <0x00>;
+					#address-cells = <1>;
+					#size-cells = <0>;
+					status = "disabled";
+
+					rgmii_phy1: ethernet-phy@1 { /* MAC3 */
+						reg = <0x1>;
+					};
+				};
+
+				/* On-board RGMII2 PHY */
+				t1040mdio1: mdio@20 {
+					reg = <0x20>;
+					#address-cells = <1>;
+					#size-cells = <0>;
+					status = "disabled";
+
+					rgmii_phy2: ethernet-phy@2 { /* MAC4 */
+						reg = <0x2>;
+					};
+				};
+
+				/* Slot 3 */
+				t1040mdio3: mdio@60 {
+					reg = <0x60>;
+					#address-cells = <1>;
+					#size-cells = <0>;
+					status = "disabled";
+
+					phy_s3_01: ethernet-phy@1c {
+						reg = <0x1c>;
+					};
+					phy_s3_02: ethernet-phy@1d {
+						reg = <0x1d>;
+					};
+					phy_s3_03: ethernet-phy@1e {
+						reg = <0x1e>;
+					};
+					phy_s3_04: ethernet-phy@1f {
+						reg = <0x1f>;
+					};
+				};
+
+				/* Slot 5 */
+				t1040mdio5: mdio@a0 {
+					reg = <0xa0>;
+					#address-cells = <1>;
+					#size-cells = <0>;
+
+					phy_s5_01: ethernet-phy@1c {
+						reg = <0x14>;
+					};
+					phy_s5_02: ethernet-phy@1d {
+						reg = <0x15>;
+					};
+					phy_s5_03: ethernet-phy@1e {
+						reg = <0x16>;
+					};
+					phy_s5_04: ethernet-phy@1f {
+						reg = <0x17>;
+					};
+				};
+
+				/* Slot 6 */
+				t1040mdio6: mdio@c0 {
+					reg = <0xc0>;
+					#address-cells = <1>;
+					#size-cells = <0>;
+
+					phy_s6_01: ethernet-phy@1c {
+						reg = <0x18>;
+					};
+					phy_s6_02: ethernet-phy@1d {
+						reg = <0x19>;
+					};
+					phy_s6_03: ethernet-phy@1e {
+						reg = <0x1a>;
+					};
+					phy_s6_04: ethernet-phy@1f {
+						reg = <0x1b>;
+					};
+				};
+
+				/* Slot 7 */
+				t1040mdio7: mdio@e0 {
+					reg = <0xe0>;
+					#address-cells = <1>;
+					#size-cells = <0>;
+					status = "disabled";
+
+					phy_s7_01: ethernet-phy@1c {
+						reg = <0x1c>;
+					};
+					phy_s7_02: ethernet-phy@1d {
+						reg = <0x1d>;
+					};
+					phy_s7_03: ethernet-phy@1e {
+						reg = <0x1e>;
+					};
+					phy_s7_04: ethernet-phy@1f {
+						reg = <0x1f>;
+					};
+				};
+			};
 		};
 	};
 
@@ -92,6 +241,10 @@
 		ranges = <0x0 0xf 0xf4000000 0x2000000>;
 	};
 
+	qportals: qman-portals@ff6000000 {
+		ranges = <0x0 0xf 0xf6000000 0x2000000>;
+	};
+
 	soc: soc@ffe000000 {
 		ranges = <0x00000000 0xf 0xfe000000 0x1000000>;
 		reg = <0xf 0xfe000000 0 0x00001000>;
@@ -117,6 +270,66 @@
 				interrupts = <0x1 0x1 0 0>;
 			};
 		};
+
+		fman0: fman@400000 {
+
+			enet0: ethernet@e0000 {
+				fixed-link = <0 1 1000 0 0>;
+				phy-connection-type = "sgmii";
+			};
+
+			enet1: ethernet@e2000 {
+				fixed-link = <1 1 1000 0 0>;
+				phy-connection-type = "sgmii";
+			};
+
+			enet2: ethernet@e4000 {
+				phy-handle = <&phy_s7_03>;
+				phy-connection-type = "sgmii";
+			};
+
+			enet3: ethernet@e6000 {
+				phy-handle = <&rgmii_phy1>;
+				phy-connection-type = "rgmii";
+			};
+
+			enet4: ethernet@e8000 {
+				phy-handle = <&rgmii_phy2>;
+				phy-connection-type = "rgmii";
+			};
+
+			mdio0: mdio@fc000 {
+			};
+		};
+	};
+
+	fsl,dpaa {
+		compatible = "fsl,t1040-dpaa", "fsl,dpaa";
+		ethernet@0 {
+			compatible = "fsl,t1040-dpa-ethernet",
+					"fsl,dpa-ethernet";
+			fsl,fman-mac = <&enet0>;
+		};
+		ethernet@1 {
+			compatible = "fsl,t1040-dpa-ethernet",
+					"fsl,dpa-ethernet";
+			fsl,fman-mac = <&enet1>;
+		};
+		ethernet@2 {
+			compatible = "fsl,t1040-dpa-ethernet",
+					"fsl,dpa-ethernet";
+			fsl,fman-mac = <&enet2>;
+		};
+		ethernet@3 {
+			compatible = "fsl,t1040-dpa-ethernet",
+					"fsl,dpa-ethernet";
+			fsl,fman-mac = <&enet3>;
+		};
+		ethernet@4 {
+			compatible = "fsl,t1040-dpa-ethernet",
+					"fsl,dpa-ethernet";
+			fsl,fman-mac = <&enet4>;
+		};
 	};
 
 	pci0: pcie@ffe240000 {
diff --git a/arch/powerpc/boot/dts/fsl/t104xrdb.dtsi b/arch/powerpc/boot/dts/fsl/t104xrdb.dtsi
index 4ba39ca..34c810d 100644
--- a/arch/powerpc/boot/dts/fsl/t104xrdb.dtsi
+++ b/arch/powerpc/boot/dts/fsl/t104xrdb.dtsi
@@ -42,6 +42,14 @@
 			size = <0 0x1000000>;
 			alignment = <0 0x1000000>;
 		};
+		qman_fqd: qman-fqd {
+			size = <0 0x400000>;
+			alignment = <0 0x400000>;
+		};
+		qman_pfdr: qman-pfdr {
+			size = <0 0x2000000>;
+			alignment = <0 0x2000000>;
+		};
 	};
 
 	ifc: localbus@ffe124000 {
@@ -83,6 +91,11 @@
 		ranges = <0x0 0xf 0xf4000000 0x2000000>;
 	};
 
+	qportals: qman-portals@ff6000000 {
+		#address-cells = <1>;
+		ranges = <0x0 0xf 0xf6000000 0x2000000>;
+	};
+
 	soc: soc@ffe000000 {
 		ranges = <0x00000000 0xf 0xfe000000 0x1000000>;
 		reg = <0xf 0xfe000000 0 0x00001000>;
-- 
1.7.5.4

