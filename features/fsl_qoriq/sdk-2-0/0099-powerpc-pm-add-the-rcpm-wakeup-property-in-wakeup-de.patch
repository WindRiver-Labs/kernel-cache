From bfe33196fc1101c60fe0a77b70206d311927dc22 Mon Sep 17 00:00:00 2001
From: Chenhui Zhao <chenhui.zhao@nxp.com>
Date: Tue, 19 Jan 2016 16:49:32 +0800
Subject: [PATCH 0099/1383] powerpc/pm: add the rcpm-wakeup property in wakeup
 device nodes

Each device with wakeup capability is correspond to one bit in the
IPPDEXPCR (IP Powerdown Exception Control Register). The bit can
determine if the wakeup device is enabled during sleep or deep sleep.

The bit mask is placed in the rcpm-wakeup property of wakeup device
node, such as eSDHC, GPIO, USB1 and USB2.

Signed-off-by: Chenhui Zhao <chenhui.zhao@nxp.com>
[Original patch taken from QorIQ-SDK-V2.0-20160527-yocto]
Signed-off-by: Yanjiang Jin <yanjiang.jin@windriver.com>
---
 arch/powerpc/boot/dts/fsl/t1023rdb.dts      | 10 +++++-----
 arch/powerpc/boot/dts/fsl/t1023si-post.dtsi |  8 ++++----
 arch/powerpc/boot/dts/fsl/t1024rdb.dts      | 10 +++++-----
 arch/powerpc/boot/dts/fsl/t102xqds.dtsi     | 10 +++++-----
 arch/powerpc/boot/dts/fsl/t1040si-post.dtsi |  6 ++++++
 arch/powerpc/boot/dts/fsl/t2081si-post.dtsi |  6 ++++++
 arch/powerpc/boot/dts/fsl/t4240si-post.dtsi |  6 ++++++
 7 files changed, 37 insertions(+), 19 deletions(-)

diff --git a/arch/powerpc/boot/dts/fsl/t1023rdb.dts b/arch/powerpc/boot/dts/fsl/t1023rdb.dts
index 4961f92..2b7e3eb 100644
--- a/arch/powerpc/boot/dts/fsl/t1023rdb.dts
+++ b/arch/powerpc/boot/dts/fsl/t1023rdb.dts
@@ -121,28 +121,28 @@
 		};
 
 		fman0: fman@400000 {
-			sleep = <&rcpm 0x00000008>;
+			rcpm-wakeup = <&rcpm 0x00000008>;
 
 			fm1mac1: ethernet@e0000 {
 				phy-handle = <&sgmii_rtk_phy2>;
 				phy-connection-type = "sgmii";
-				sleep = <&rcpm 0x80000000>;
+				rcpm-wakeup = <&rcpm 0x80000000>;
 			};
 
 			fm1mac2: ethernet@e2000 {
-				sleep = <&rcpm 0x40000000>;
+				rcpm-wakeup = <&rcpm 0x40000000>;
 			};
 
 			fm1mac3: ethernet@e4000 {
 				phy-handle = <&sgmii_aqr_phy3>;
 				phy-connection-type = "sgmii-2500";
-				sleep = <&rcpm 0x20000000>;
+				rcpm-wakeup = <&rcpm 0x20000000>;
 			};
 
 			fm1mac4: ethernet@e6000 {
 				phy-handle = <&rgmii_rtk_phy1>;
 				phy-connection-type = "rgmii";
-				sleep = <&rcpm 0x10000000>;
+				rcpm-wakeup = <&rcpm 0x10000000>;
 			};
 
 			mdio0: mdio@fc000 {
diff --git a/arch/powerpc/boot/dts/fsl/t1023si-post.dtsi b/arch/powerpc/boot/dts/fsl/t1023si-post.dtsi
index 37e20a7..68c3b02 100644
--- a/arch/powerpc/boot/dts/fsl/t1023si-post.dtsi
+++ b/arch/powerpc/boot/dts/fsl/t1023si-post.dtsi
@@ -472,7 +472,7 @@
 		fsl,iommu-parent = <&pamu0>;
 		fsl,liodn-reg = <&guts 0x530>; /* eSDHCLIODNR */
 		sdhci,auto-cmd12;
-		sleep = <&rcpm 0x00000080>;
+		rcpm-wakeup = <&rcpm 0x00000080>;
 	};
 /include/ "qoriq-i2c-0.dtsi"
 /include/ "qoriq-i2c-1.dtsi"
@@ -480,7 +480,7 @@
 /include/ "qoriq-duart-1.dtsi"
 /include/ "qoriq-gpio-0.dtsi"
 	gpio@130000 {
-		sleep = <&rcpm 0x00000040>;
+		rcpm-wakeup = <&rcpm 0x00000040>;
 	};
 /include/ "qoriq-gpio-1.dtsi"
 /include/ "qoriq-gpio-2.dtsi"
@@ -491,7 +491,7 @@
 			fsl,iommu-parent = <&pamu0>;
 			fsl,liodn-reg = <&guts 0x520>; /* USB1LIODNR */
 			phy_type = "utmi";
-			sleep = <&rcpm 0x00000020>;
+			rcpm-wakeup = <&rcpm 0x00000020>;
 			port0;
 		};
 /include/ "qoriq-usb2-dr-0.dtsi"
@@ -501,7 +501,7 @@
 			fsl,liodn-reg = <&guts 0x524>; /* USB2LIODNR */
 			dr_mode = "host";
 			phy_type = "utmi";
-			sleep = <&rcpm 0x00000010>;
+			rcpm-wakeup = <&rcpm 0x00000010>;
 		};
 /include/ "qoriq-sata2-0.dtsi"
 sata@220000 {
diff --git a/arch/powerpc/boot/dts/fsl/t1024rdb.dts b/arch/powerpc/boot/dts/fsl/t1024rdb.dts
index 53b14d2..ec5048a 100644
--- a/arch/powerpc/boot/dts/fsl/t1024rdb.dts
+++ b/arch/powerpc/boot/dts/fsl/t1024rdb.dts
@@ -155,28 +155,28 @@
 		};
 
 		fman0: fman@400000 {
-			sleep = <&rcpm 0x00000008>;
+			rcpm-wakeup = <&rcpm 0x00000008>;
 
 			fm1mac1: ethernet@e0000 {
 				phy-handle = <&xg_aqr105_phy3>;
 				phy-connection-type = "xgmii";
-				sleep = <&rcpm 0x80000000>;
+				rcpm-wakeup = <&rcpm 0x80000000>;
 			};
 
 			fm1mac2: ethernet@e2000 {
-				sleep = <&rcpm 0x40000000>;
+				rcpm-wakeup = <&rcpm 0x40000000>;
 			};
 
 			fm1mac3: ethernet@e4000 {
 				phy-handle = <&rgmii_phy2>;
 				phy-connection-type = "rgmii";
-				sleep = <&rcpm 0x20000000>;
+				rcpm-wakeup = <&rcpm 0x20000000>;
 			};
 
 			fm1mac4: ethernet@e6000 {
 				phy-handle = <&rgmii_phy1>;
 				phy-connection-type = "rgmii";
-				sleep = <&rcpm 0x10000000>;
+				rcpm-wakeup = <&rcpm 0x10000000>;
 			};
 
 			mdio0: mdio@fc000 {
diff --git a/arch/powerpc/boot/dts/fsl/t102xqds.dtsi b/arch/powerpc/boot/dts/fsl/t102xqds.dtsi
index ab7980d..0262e84 100644
--- a/arch/powerpc/boot/dts/fsl/t102xqds.dtsi
+++ b/arch/powerpc/boot/dts/fsl/t102xqds.dtsi
@@ -327,30 +327,30 @@
 		};
 
 		fman0: fman@400000 {
-			sleep = <&rcpm 0x00000008>;
+			rcpm-wakeup = <&rcpm 0x00000008>;
 
 			fm1mac1: ethernet@e0000 {
 				phy-handle = <&sgmii_aqr105_phy_s5>;
 				phy-connection-type = "sgmii";
-				sleep = <&rcpm 0x80000000>;
+				rcpm-wakeup = <&rcpm 0x80000000>;
 			};
 
 			fm1mac2: ethernet@e2000 {
 				phy-handle = <&sgmii_aqr105_phy_s4>;
 				phy-connection-type = "sgmii";
-				sleep = <&rcpm 0x40000000>;
+				rcpm-wakeup = <&rcpm 0x40000000>;
 			};
 
 			fm1mac3: ethernet@e4000 {
 				phy-handle = <&sgmii_vsc8234_phy_s3>;
 				phy-connection-type = "sgmii";
-				sleep = <&rcpm 0x20000000>;
+				rcpm-wakeup = <&rcpm 0x20000000>;
 			};
 
 			fm1mac4: ethernet@e6000 {
 				phy-handle = <&rgmii_phy1>;
 				phy-connection-type = "rgmii";
-				sleep = <&rcpm 0x10000000>;
+				rcpm-wakeup = <&rcpm 0x10000000>;
 			};
 
 			mdio0: mdio@fc000 {
diff --git a/arch/powerpc/boot/dts/fsl/t1040si-post.dtsi b/arch/powerpc/boot/dts/fsl/t1040si-post.dtsi
index e724d95..49231ec 100644
--- a/arch/powerpc/boot/dts/fsl/t1040si-post.dtsi
+++ b/arch/powerpc/boot/dts/fsl/t1040si-post.dtsi
@@ -420,12 +420,16 @@
 		fsl,iommu-parent = <&pamu0>;
 		fsl,liodn-reg = <&guts 0x530>; /* eSDHCLIODNR */
 		sdhci,auto-cmd12;
+		rcpm-wakeup = <&rcpm 0x00000080>;
 	};
 /include/ "qoriq-i2c-0.dtsi"
 /include/ "qoriq-i2c-1.dtsi"
 /include/ "qoriq-duart-0.dtsi"
 /include/ "qoriq-duart-1.dtsi"
 /include/ "qoriq-gpio-0.dtsi"
+	gpio@130000 {
+		rcpm-wakeup = <&rcpm 0x00000040>;
+	};
 /include/ "qoriq-gpio-1.dtsi"
 /include/ "qoriq-gpio-2.dtsi"
 /include/ "qoriq-gpio-3.dtsi"
@@ -435,6 +439,7 @@
 			fsl,iommu-parent = <&pamu0>;
 			fsl,liodn-reg = <&guts 0x520>; /* USB1LIODNR */
 			phy_type = "utmi";
+			rcpm-wakeup = <&rcpm 0x00000020>;
 			port0;
 		};
 /include/ "qoriq-usb2-dr-0.dtsi"
@@ -444,6 +449,7 @@
 			fsl,liodn-reg = <&guts 0x524>; /* USB2LIODNR */
 			dr_mode = "host";
 			phy_type = "utmi";
+			rcpm-wakeup = <&rcpm 0x00000010>;
 		};
 
 	display@180000 {
diff --git a/arch/powerpc/boot/dts/fsl/t2081si-post.dtsi b/arch/powerpc/boot/dts/fsl/t2081si-post.dtsi
index 86bdaf6..e66d4ca 100644
--- a/arch/powerpc/boot/dts/fsl/t2081si-post.dtsi
+++ b/arch/powerpc/boot/dts/fsl/t2081si-post.dtsi
@@ -476,12 +476,16 @@
 		fsl,iommu-parent = <&pamu1>;
 		fsl,liodn-reg = <&guts 0x530>; /* SDMMCLIODNR */
 		sdhci,auto-cmd12;
+		rcpm-wakeup = <&rcpm 0x00000080>;
 	};
 /include/ "qoriq-i2c-0.dtsi"
 /include/ "qoriq-i2c-1.dtsi"
 /include/ "qoriq-duart-0.dtsi"
 /include/ "qoriq-duart-1.dtsi"
 /include/ "qoriq-gpio-0.dtsi"
+	gpio@130000 {
+		rcpm-wakeup = <&rcpm 0x00000040>;
+	};
 /include/ "qoriq-gpio-1.dtsi"
 /include/ "qoriq-gpio-2.dtsi"
 /include/ "qoriq-gpio-3.dtsi"
@@ -491,6 +495,7 @@
 		fsl,iommu-parent = <&pamu1>;
 		fsl,liodn-reg = <&guts 0x520>; /* USB1LIODNR */
 		phy_type = "utmi";
+		rcpm-wakeup = <&rcpm 0x00000020>;
 		port0;
 	};
 /include/ "qoriq-usb2-dr-0.dtsi"
@@ -500,6 +505,7 @@
 		fsl,liodn-reg = <&guts 0x524>; /* USB1LIODNR */
 		dr_mode = "host";
 		phy_type = "utmi";
+		rcpm-wakeup = <&rcpm 0x00000010>;
 	};
 /include/ "qoriq-sec5.2-0.dtsi"
 /include/ "qoriq-bman1.dtsi"
diff --git a/arch/powerpc/boot/dts/fsl/t4240si-post.dtsi b/arch/powerpc/boot/dts/fsl/t4240si-post.dtsi
index 4d4f258..8668f87 100644
--- a/arch/powerpc/boot/dts/fsl/t4240si-post.dtsi
+++ b/arch/powerpc/boot/dts/fsl/t4240si-post.dtsi
@@ -724,12 +724,16 @@
 	sdhc@114000 {
 		compatible = "fsl,t4240-esdhc", "fsl,esdhc";
 		sdhci,auto-cmd12;
+		rcpm-wakeup = <&rcpm 0x00000080>;
 	};
 /include/ "qoriq-i2c-0.dtsi"
 /include/ "qoriq-i2c-1.dtsi"
 /include/ "qoriq-duart-0.dtsi"
 /include/ "qoriq-duart-1.dtsi"
 /include/ "qoriq-gpio-0.dtsi"
+	gpio@130000 {
+		rcpm-wakeup = <&rcpm 0x00000040>;
+	};
 /include/ "qoriq-gpio-1.dtsi"
 /include/ "qoriq-gpio-2.dtsi"
 /include/ "qoriq-gpio-3.dtsi"
@@ -737,6 +741,7 @@
 		usb0: usb@210000 {
 			compatible = "fsl-usb2-mph-v2.5", "fsl-usb2-mph";
 			phy_type = "utmi";
+			rcpm-wakeup = <&rcpm 0x00000020>;
 			port0;
 		};
 /include/ "qoriq-usb2-dr-0.dtsi"
@@ -744,6 +749,7 @@
 			compatible = "fsl-usb2-dr-v2.5", "fsl-usb2-dr";
 			dr_mode = "host";
 			phy_type = "utmi";
+			rcpm-wakeup = <&rcpm 0x00000010>;
 		};
 /include/ "qoriq-sata2-0.dtsi"
 /include/ "qoriq-sata2-1.dtsi"
-- 
2.8.1

