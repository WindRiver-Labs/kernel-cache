From 85790fa80dc63ee49bceedfedb536ddab17a0cc6 Mon Sep 17 00:00:00 2001
From: Roy Pledge <roy.pledge@nxp.com>
Date: Tue, 26 Apr 2016 11:01:15 -0400
Subject: [PATCH 1323/1429] fsl_usdpaa: Make sure tlbcam entry is loaded
 during special page fault

Ensure the TLB is updated when a USDPAA memory fault occurs

Signed-off-by: Roy Pledge <roy.pledge@nxp.com>
[Original patch taken from QorIQ-SDK-V2.0-20160527-yocto]
Signed-off-by: Yanjiang Jin <yanjiang.jin@windriver.com>
---
 arch/powerpc/mm/mem.c |    1 +
 1 files changed, 1 insertions(+), 0 deletions(-)

diff --git a/arch/powerpc/mm/mem.c b/arch/powerpc/mm/mem.c
index 60430a3..9e76f49 100644
--- a/arch/powerpc/mm/mem.c
+++ b/arch/powerpc/mm/mem.c
@@ -499,6 +499,7 @@ static inline void hook_usdpaa_tlb1(struct vm_area_struct *vma,
 		flush_tlb_mm(vma->vm_mm);
 		settlbcam(tlb_idx, va, phys_addr, size, pte_val(*ptep),
 			  mfspr(SPRN_PID));
+		loadcam_entry(tlb_idx);
 	}
 }
 #else
-- 
1.7.5.4

