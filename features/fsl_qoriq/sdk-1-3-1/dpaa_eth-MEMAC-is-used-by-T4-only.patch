From f5ca5cc26e1a53dff534467640b1b7aaa89148c0 Mon Sep 17 00:00:00 2001
From: Madalin Bucur <madalin.bucur@freescale.com>
Date: Fri, 5 Oct 2012 19:13:22 +0300
Subject: [PATCH 091/227] dpaa_eth: MEMAC is used by T4 only

Include MEMAC related code only for T4 builds.

Signed-off-by: Madalin Bucur <madalin.bucur@freescale.com>
[Kevin: Original patch taken from fsl sdk 1.3.1
QorIQ-SDK-V1.3.1-SOURCE-20121220-yocto.iso.]
Signed-off-by: Kevin Hao <kexin.hao@windriver.com>
---
 drivers/net/ethernet/freescale/dpa/mac-api.c |    8 ++++++++
 drivers/net/ethernet/freescale/dpa/mac.c     |    2 ++
 2 files changed, 10 insertions(+)

diff --git a/drivers/net/ethernet/freescale/dpa/mac-api.c b/drivers/net/ethernet/freescale/dpa/mac-api.c
index 6de411d..d3afec7 100644
--- a/drivers/net/ethernet/freescale/dpa/mac-api.c
+++ b/drivers/net/ethernet/freescale/dpa/mac-api.c
@@ -62,7 +62,9 @@ const char	*mac_driver_description __initconst = MAC_DESCRIPTION;
 const size_t	 mac_sizeof_priv[] __devinitconst = {
 	[DTSEC] = sizeof(struct mac_priv_s),
 	[XGMAC] = sizeof(struct mac_priv_s),
+#ifdef CONFIG_FMAN_T4240
 	[MEMAC] = sizeof(struct mac_priv_s)
+#endif
 };
 
 static const e_EnetMode _100[] __devinitconst =
@@ -237,6 +239,7 @@ _return:
 	return _errno;
 }
 
+#ifdef CONFIG_FMAN_T4240
 static int __devinit __cold memac_init(struct mac_device *mac_dev)
 {
 	int			_errno;
@@ -298,6 +301,7 @@ _return_fm_mac_free:
 _return:
 	return _errno;
 }
+#endif
 
 static int __cold start(struct mac_device *mac_dev)
 {
@@ -813,6 +817,7 @@ static void __devinit __cold setup_xgmac(struct mac_device *mac_dev)
 	mac_dev->uninit		= uninit;
 }
 
+#ifdef CONFIG_FMAN_T4240
 static void __devinit __cold setup_memac(struct mac_device *mac_dev)
 {
 	mac_dev->init_phy	= xgmac_init_phy;
@@ -824,9 +829,12 @@ static void __devinit __cold setup_memac(struct mac_device *mac_dev)
 	mac_dev->set_multi      = set_multi;
 	mac_dev->uninit		= uninit;
 }
+#endif
 
 void (*const mac_setup[])(struct mac_device *mac_dev) __devinitconst = {
 	[DTSEC] = setup_dtsec,
 	[XGMAC] = setup_xgmac,
+#ifdef CONFIG_FMAN_T4240
 	[MEMAC] = setup_memac
+#endif
 };
diff --git a/drivers/net/ethernet/freescale/dpa/mac.c b/drivers/net/ethernet/freescale/dpa/mac.c
index a00524db..74e183e 100644
--- a/drivers/net/ethernet/freescale/dpa/mac.c
+++ b/drivers/net/ethernet/freescale/dpa/mac.c
@@ -123,9 +123,11 @@ static const struct of_device_id mac_match[] __devinitconst = {
 	[XGMAC] = {
 		.compatible	= "fsl,fman-10g-mac"
 	},
+#ifdef CONFIG_FMAN_T4240
 	[MEMAC] = {
 		.compatible	= "fsl,fman-memac"
 	},
+#endif
 	{}
 };
 MODULE_DEVICE_TABLE(of, mac_match);
-- 
1.7.9.7

