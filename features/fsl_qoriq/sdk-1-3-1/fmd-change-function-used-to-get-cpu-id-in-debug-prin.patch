From 5caa6f72edbc0a7a8b963a90f954d7c345649c80 Mon Sep 17 00:00:00 2001
From: Madalin Bucur <madalin.bucur@freescale.com>
Date: Wed, 21 Nov 2012 19:01:44 +0200
Subject: [PATCH 179/227] fmd: change function used to get cpu id in debug
 prints

Changed smp_processor_id() with raw_smp_processor_id() in the fmd
debug prints.

Signed-off-by: Madalin Bucur <madalin.bucur@freescale.com>
[Kevin: Original patch taken from fsl sdk 1.3.1
QorIQ-SDK-V1.3.1-SOURCE-20121220-yocto.iso. Remove the parts for
xx_linux.c since we already fix them.]
Signed-off-by: Kevin Hao <kexin.hao@windriver.com>
---
 .../dpa/NetCommSw/src/inc/wrapper/fsl_fman_test.h  |    8 ++++----
 .../src/wrapper/lnxwrp_ioctls_fm_compat.h          |    8 ++++----
 .../freescale/dpa/NetCommSw/src/xx/xx_linux.c      |    2 +-
 3 files changed, 9 insertions(+), 9 deletions(-)

diff --git a/drivers/net/ethernet/freescale/dpa/NetCommSw/src/inc/wrapper/fsl_fman_test.h b/drivers/net/ethernet/freescale/dpa/NetCommSw/src/inc/wrapper/fsl_fman_test.h
index 0b1a526..0466a47 100644
--- a/drivers/net/ethernet/freescale/dpa/NetCommSw/src/inc/wrapper/fsl_fman_test.h
+++ b/drivers/net/ethernet/freescale/dpa/NetCommSw/src/inc/wrapper/fsl_fman_test.h
@@ -40,13 +40,13 @@
 #define __FSL_FMAN_TEST_H
 
 #include <linux/types.h>
-#include <linux/smp.h>  /* smp_processor_id() */
+#include <linux/smp.h>  /* raw_smp_processor_id() */
 
 //#define FMT_K_DBG
 //#define FMT_K_DBG_RUNTIME
 
 #define _fmt_prk(stage, format, arg...)	\
-	printk(stage "fmt (cpu:%u): " format, smp_processor_id(), ##arg)
+	printk(stage "fmt (cpu:%u): " format, raw_smp_processor_id(), ##arg)
 
 #define _fmt_inf(format, arg...) _fmt_prk(KERN_INFO, format, ##arg)
 #define _fmt_wrn(format, arg...) _fmt_prk(KERN_WARNING, format, ##arg)
@@ -60,7 +60,7 @@
 #if defined(FMT_K_DBG)
 	#define _fmt_dbg(format, arg...) \
 		printk("fmt [%s:%u](cpu:%u) - " format,	\
-			__func__, __LINE__, smp_processor_id(), ##arg)
+			__func__, __LINE__, raw_smp_processor_id(), ##arg)
 #else
 #	define _fmt_dbg(arg...)
 #endif
@@ -69,7 +69,7 @@
 #if defined(FMT_K_DBG_RUNTIME)
 	#define _fmt_dbgr(format, arg...) \
 		printk("fmt [%s:%u](cpu:%u) - " format, \
-			__func__, __LINE__, smp_processor_id(), ##arg)
+			__func__, __LINE__, raw_smp_processor_id(), ##arg)
 #else
 #	define _fmt_dbgr(arg...)
 #endif
diff --git a/drivers/net/ethernet/freescale/dpa/NetCommSw/src/wrapper/lnxwrp_ioctls_fm_compat.h b/drivers/net/ethernet/freescale/dpa/NetCommSw/src/wrapper/lnxwrp_ioctls_fm_compat.h
index 9ed38ed..91e60a1 100644
--- a/drivers/net/ethernet/freescale/dpa/NetCommSw/src/wrapper/lnxwrp_ioctls_fm_compat.h
+++ b/drivers/net/ethernet/freescale/dpa/NetCommSw/src/wrapper/lnxwrp_ioctls_fm_compat.h
@@ -60,7 +60,7 @@
 /*#define FM_COMPAT_DBG*/
 
 #define _fm_cpt_prk(stage, format, arg...)	\
-	printk(stage "fm_cpt (cpu:%u): " format, smp_processor_id(), ##arg)
+	printk(stage "fm_cpt (cpu:%u): " format, raw_smp_processor_id(), ##arg)
 
 #define _fm_cpt_inf(format, arg...) _fm_cpt_prk(KERN_INFO, format, ##arg)
 #define _fm_cpt_wrn(format, arg...) _fm_cpt_prk(KERN_WARNING, format, ##arg)
@@ -72,13 +72,13 @@
 		do{ \
 			if (from == COMPAT_US_TO_K) \
 				printk("fm_cpt to KS [%s:%u](cpu:%u) - " format,	\
-					__func__, __LINE__, smp_processor_id(), ##arg); \
+					__func__, __LINE__, raw_smp_processor_id(), ##arg); \
 			else if (from == COMPAT_K_TO_US) \
 				printk("fm_cpt to US [%s:%u](cpu:%u) - " format,	\
-					__func__, __LINE__, smp_processor_id(), ##arg); \
+					__func__, __LINE__, raw_smp_processor_id(), ##arg); \
             else \
                 printk("fm_cpt [%s:%u](cpu:%u) - " format,    \
-                    __func__, __LINE__, smp_processor_id(), ##arg); \
+                    __func__, __LINE__, raw_smp_processor_id(), ##arg); \
 		}while(0)
 #else
 #	define _fm_cpt_dbg(arg...)
diff --git a/drivers/net/ethernet/freescale/dpa/NetCommSw/src/xx/xx_linux.c b/drivers/net/ethernet/freescale/dpa/NetCommSw/src/xx/xx_linux.c
index ea914fd..b365dd3 100644
--- a/drivers/net/ethernet/freescale/dpa/NetCommSw/src/xx/xx_linux.c
+++ b/drivers/net/ethernet/freescale/dpa/NetCommSw/src/xx/xx_linux.c
@@ -186,7 +186,7 @@ void XX_Fprint(void *file, char *str, ...)
 #ifdef CONFIG_SMP
     if (vsnprintf (buf, BUF_SIZE, str, args) >= BUF_SIZE)
         printk(KERN_WARNING "Illegal string to print!\n    more than %d characters.\n\tString was not printed completelly.\n", BUF_SIZE);
-    printk (KERN_CRIT "cpu%d/%d: %s",hard_smp_processor_id(), smp_processor_id(), buf);
+    printk (KERN_CRIT "cpu%d: %s",raw_smp_processor_id(), buf);
 #else
     vprintk(str, args);
 #endif /* CONFIG_SMP */
-- 
1.7.9.7

