From 254fe7860d19a201188f2186c42bc728a07aba85 Mon Sep 17 00:00:00 2001
From: Andy Fleming <afleming@freescale.com>
Date: Fri, 13 Jul 2012 14:47:16 -0500
Subject: [PATCH 008/227] dpaa_eth: Set number of tx queues to NR_CPUS

The TX code for dpaa_eth relies on having one tx queue for each
cpu in the system. The problem is that we hard-coded the number
of TX queues to be 8, which was "fine" when we only had up to 8
cores, but problematic when we have 24. NR_CPUS will ensure that
we never have fewer queues than cores.

Signed-off-by: Andy Fleming <afleming@freescale.com>
[Kevin: Original patch taken from fsl sdk 1.3.1
QorIQ-SDK-V1.3.1-SOURCE-20121220-yocto.iso.]
Signed-off-by: Kevin Hao <kexin.hao@windriver.com>
---
 drivers/net/ethernet/freescale/dpa/dpaa_eth.h |    2 +-
 1 file changed, 1 insertion(+), 1 deletion(-)

diff --git a/drivers/net/ethernet/freescale/dpa/dpaa_eth.h b/drivers/net/ethernet/freescale/dpa/dpaa_eth.h
index e9d743b..88f27e2 100644
--- a/drivers/net/ethernet/freescale/dpa/dpaa_eth.h
+++ b/drivers/net/ethernet/freescale/dpa/dpaa_eth.h
@@ -74,7 +74,7 @@
 #define DPA_RX_PRIV_DATA_SIZE   (DPA_TX_PRIV_DATA_SIZE + \
 					dpa_get_rx_extra_headroom())
 /* number of Tx queues to FMan */
-#define DPAA_ETH_TX_QUEUES	8
+#define DPAA_ETH_TX_QUEUES	NR_CPUS
 #define DPAA_ETH_RX_QUEUES	128
 
 #if defined(CONFIG_DPAA_FMAN_UNIT_TESTS)
-- 
1.7.9.7

