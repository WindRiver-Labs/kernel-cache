From e849758c2b0480154440d59ef1f0a96062683711 Mon Sep 17 00:00:00 2001
From: Madalin Bucur <madalin.bucur@freescale.com>
Date: Thu, 15 Nov 2012 00:15:21 +0000
Subject: [PATCH 146/227] fmd: fix total fifo size for T4/B4

LLD code relies on the hardware default value found in fmbm_cfg1 for
the default total fifo size. The fmbm_cfg1 value is changed by u-boot,
resulting in an incorrect value for T4/B4 platforms. Imposing a default
value in FMD to avoid this vulnerability.

Signed-off-by: Madalin Bucur <madalin.bucur@freescale.com>
Signed-off-by: Andy Fleming <afleming@freescale.com>
[Kevin: Original patch taken from fsl sdk 1.3.1
QorIQ-SDK-V1.3.1-SOURCE-20121220-yocto.iso.]
Signed-off-by: Kevin Hao <kexin.hao@windriver.com>
---
 .../dpa/NetCommSw/src/wrapper/lnxwrp_fm.c          |    3 +++
 1 file changed, 3 insertions(+)

diff --git a/drivers/net/ethernet/freescale/dpa/NetCommSw/src/wrapper/lnxwrp_fm.c b/drivers/net/ethernet/freescale/dpa/NetCommSw/src/wrapper/lnxwrp_fm.c
index 59504a3..dfdcd4f 100644
--- a/drivers/net/ethernet/freescale/dpa/NetCommSw/src/wrapper/lnxwrp_fm.c
+++ b/drivers/net/ethernet/freescale/dpa/NetCommSw/src/wrapper/lnxwrp_fm.c
@@ -792,6 +792,9 @@ static t_Error InitFmDev(t_LnxWrpFmDev  *p_LnxWrpFmDev)
 #elif defined(CONFIG_FMAN_RESOURCE_ALLOCATION_ALGORITHM) && defined(CONFIG_FMAN_P1023)
     FM_ConfigTotalFifoSize(p_LnxWrpFmDev->h_Dev, 48*KILOBYTE);
 #endif
+#if (DPAA_VERSION >= 11)
+    FM_ConfigTotalFifoSize(p_LnxWrpFmDev->h_Dev, 256*KILOBYTE);
+#endif /* (DPAA_VERSION >= 11) */
 
     if (FM_Init(p_LnxWrpFmDev->h_Dev) != E_OK)
         RETURN_ERROR(MAJOR, E_INVALID_STATE, ("FM"));
-- 
1.7.9.7

