From e9c4a1155ad21807dc2b759d10681a742d5b56f8 Mon Sep 17 00:00:00 2001
From: Madalin Bucur <madalin.bucur@freescale.com>
Date: Tue, 30 Oct 2012 20:04:55 +0200
Subject: [PATCH 119/227] fmd: fixed issue in compat_copy_fm_port_pcd_kg()

Pointer direct_scheme_id value is valid only when direct_scheme
is true.

Signed-off-by: Madalin Bucur <madalin.bucur@freescale.com>
[Kevin: Original patch taken from fsl sdk 1.3.1
QorIQ-SDK-V1.3.1-SOURCE-20121220-yocto.iso.]
Signed-off-by: Kevin Hao <kexin.hao@windriver.com>
---
 .../src/wrapper/lnxwrp_ioctls_fm_compat.c          |    3 ++-
 1 file changed, 2 insertions(+), 1 deletion(-)

diff --git a/drivers/net/ethernet/freescale/dpa/NetCommSw/src/wrapper/lnxwrp_ioctls_fm_compat.c b/drivers/net/ethernet/freescale/dpa/NetCommSw/src/wrapper/lnxwrp_ioctls_fm_compat.c
index 4edf928..f844a2e 100644
--- a/drivers/net/ethernet/freescale/dpa/NetCommSw/src/wrapper/lnxwrp_ioctls_fm_compat.c
+++ b/drivers/net/ethernet/freescale/dpa/NetCommSw/src/wrapper/lnxwrp_ioctls_fm_compat.c
@@ -765,7 +765,8 @@ void compat_copy_fm_port_pcd_kg(
             param->scheme_ids[k] = compat_pcd_id2ptr(compat_param->scheme_ids[k]);
 
         param->direct_scheme = compat_param->direct_scheme;
-        param->direct_scheme_id = compat_pcd_id2ptr(compat_param->direct_scheme_id);
+        if (param->direct_scheme)
+            param->direct_scheme_id = compat_pcd_id2ptr(compat_param->direct_scheme_id);
     }
 }
 
-- 
1.7.9.7

