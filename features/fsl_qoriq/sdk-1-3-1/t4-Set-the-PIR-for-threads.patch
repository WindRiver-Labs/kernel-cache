From 4d1870b4784d657881f4616215510ead97790c76 Mon Sep 17 00:00:00 2001
From: Andy Fleming <afleming@freescale.com>
Date: Thu, 14 Jun 2012 14:50:12 -0500
Subject: [PATCH 033/227] t4: Set the PIR for threads

The PIR is used in a few places in the kernel to deal with messaging.
The threads come up in Linux, so we need to set the PIR in Linux for
the threads.

Signed-off-by: Andy Fleming <afleming@freescale.com>
[Kevin: Original patch taken from fsl sdk 1.3.1
QorIQ-SDK-V1.3.1-SOURCE-20121220-yocto.iso.]
Signed-off-by: Kevin Hao <kexin.hao@windriver.com>
---
 arch/powerpc/kernel/head_64.S |    1 +
 1 file changed, 1 insertion(+)

diff --git a/arch/powerpc/kernel/head_64.S b/arch/powerpc/kernel/head_64.S
index 5d81da0..ca6d988 100644
--- a/arch/powerpc/kernel/head_64.S
+++ b/arch/powerpc/kernel/head_64.S
@@ -177,6 +177,7 @@ _GLOBAL(fsl_secondary_thread_init)
 
 	mfspr	r3, SPRN_PIR
 	rlwimi	r3, r3, 30, 2, 30
+	mtspr	SPRN_PIR, r3
 #endif
 
 _GLOBAL(generic_secondary_thread_init)
-- 
1.7.9.7

