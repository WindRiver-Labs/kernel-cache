From d5e5c5f63071a45961522d422e8d464cbe7d9f57 Mon Sep 17 00:00:00 2001
From: Vakul Garg <vakul@freescale.com>
Date: Tue, 27 Nov 2012 16:11:03 +0000
Subject: [PATCH 187/227] dts/qman: Increased number of FQs in QMAN dynamic
 FQID allocator.

Currently only 256 FQs are available in QMAN dynamic FQID allocator. This is a
very small number. Other mechanisms such as SEC-QI need many FQs per crypto
session. These FQs are allocated from QMAN dynamic FQID allocator. To support
at least 1K IPSEC tunnels, we need to subtantially increase the number of FQIDs
in QMAN dynamic FQID allocator. The present default kernel configuration
supports 32K FQs in total. Most of this is already in use by applications using
static FQID allocations. With this patch, we increase the total number of FQIDs
supported to 64K. Out of this, the range 32K to (64K-1) is added to dynamic
FQID allocator. The existing static FQID allocations remain unchanged.

Signed-off-by: Vakul Garg <vakul@freescale.com>
Signed-off-by: Andy Fleming <afleming@freescale.com>
[Kevin: Original patch taken from fsl sdk 1.3.1
QorIQ-SDK-V1.3.1-SOURCE-20121220-yocto.iso.]
Signed-off-by: Kevin Hao <kexin.hao@windriver.com>
---
 arch/powerpc/boot/dts/fsl/qoriq-dpaa-res1.dtsi |    4 ++++
 arch/powerpc/boot/dts/fsl/qoriq-dpaa-res2.dtsi |    4 ++++
 arch/powerpc/boot/dts/fsl/qoriq-dpaa-res3.dtsi |    4 ++++
 drivers/staging/fsl_qbman/Kconfig              |    5 +++--
 4 files changed, 15 insertions(+), 2 deletions(-)

diff --git a/arch/powerpc/boot/dts/fsl/qoriq-dpaa-res1.dtsi b/arch/powerpc/boot/dts/fsl/qoriq-dpaa-res1.dtsi
index 09ddb81..6c6f7d7 100644
--- a/arch/powerpc/boot/dts/fsl/qoriq-dpaa-res1.dtsi
+++ b/arch/powerpc/boot/dts/fsl/qoriq-dpaa-res1.dtsi
@@ -69,6 +69,10 @@
 		compatible = "fsl,fqid-range";
 		fsl,fqid-range = <256 256>;
 	};
+	qman-fqids@1 {
+		compatible = "fsl,fqid-range";
+		fsl,fqid-range = <32768 32768>;
+	};
 	qman-pools@0 {
 		compatible = "fsl,pool-channel-range";
 		fsl,pool-channel-range = <0x21 0xf>;
diff --git a/arch/powerpc/boot/dts/fsl/qoriq-dpaa-res2.dtsi b/arch/powerpc/boot/dts/fsl/qoriq-dpaa-res2.dtsi
index 71875d8..73ee049 100644
--- a/arch/powerpc/boot/dts/fsl/qoriq-dpaa-res2.dtsi
+++ b/arch/powerpc/boot/dts/fsl/qoriq-dpaa-res2.dtsi
@@ -48,6 +48,10 @@
 		compatible = "fsl,fqid-range";
 		fsl,fqid-range = <256 256>;
 	};
+	qman-fqids@1 {
+		compatible = "fsl,fqid-range";
+		fsl,fqid-range = <32768 32768>;
+	};
 	qman-pools@0 {
 		compatible = "fsl,pool-channel-range";
 		fsl,pool-channel-range = <0x21 0x3>;
diff --git a/arch/powerpc/boot/dts/fsl/qoriq-dpaa-res3.dtsi b/arch/powerpc/boot/dts/fsl/qoriq-dpaa-res3.dtsi
index 6574aa8..1bc5af9 100644
--- a/arch/powerpc/boot/dts/fsl/qoriq-dpaa-res3.dtsi
+++ b/arch/powerpc/boot/dts/fsl/qoriq-dpaa-res3.dtsi
@@ -69,6 +69,10 @@
 		compatible = "fsl,fqid-range";
 		fsl,fqid-range = <256 512>;
 	};
+	qman-fqids@1 {
+		compatible = "fsl,fqid-range";
+		fsl,fqid-range = <32768 32768>;
+	};
 	qman-pools@0 {
 		compatible = "fsl,pool-channel-range";
 		fsl,pool-channel-range = <0x401 0xf>;
diff --git a/drivers/staging/fsl_qbman/Kconfig b/drivers/staging/fsl_qbman/Kconfig
index 6896605..ebf6dd3 100644
--- a/drivers/staging/fsl_qbman/Kconfig
+++ b/drivers/staging/fsl_qbman/Kconfig
@@ -165,10 +165,11 @@ config FSL_QMAN_DEBUGFS
 # H/w settings that can be hard-coded for now.
 config FSL_QMAN_FQD_SZ
 	int "size of Frame Queue Descriptor region"
-	default 9
+	default 10
 	---help---
 	  This is the size of the FQD region defined as: PAGE_SIZE * (2^value)
-	  ex: 9 => PAGE_SIZE * (2^9)
+	  ex: 10 => PAGE_SIZE * (2^10)
+	  Note: Default device-trees now require minimum Kconfig setting of 10.
 
 # Corenet initiator settings. Stash request queues are 4-deep to match cores'
 # ability to snart. Stash priority is 3, other priorities are 2.
-- 
1.7.9.7

