From fe54253ee77704e6b4053708f0697c7fb527798a Mon Sep 17 00:00:00 2001
From: Scott Wood <scottwood@freescale.com>
Date: Wed, 5 Dec 2012 18:36:17 -0600
Subject: [PATCH 218/227] powerpc/e6500: fsl_enable_threads: move blr outside
 feature section

Even if we don't have CPU_FTR_SMT, we still would like to return
to the caller rather than fall into init_thread_book3e.

Signed-off-by: Scott Wood <scottwood@freescale.com>
Signed-off-by: Andy Fleming <afleming@freescale.com>
[Kevin: Original patch taken from fsl sdk 1.3.1
QorIQ-SDK-V1.3.1-SOURCE-20121220-yocto.iso.]
Signed-off-by: Kevin Hao <kexin.hao@windriver.com>
---
 arch/powerpc/kernel/exceptions-64e.S |    2 +-
 1 file changed, 1 insertion(+), 1 deletion(-)

diff --git a/arch/powerpc/kernel/exceptions-64e.S b/arch/powerpc/kernel/exceptions-64e.S
index 9a19a8c..fe21862 100644
--- a/arch/powerpc/kernel/exceptions-64e.S
+++ b/arch/powerpc/kernel/exceptions-64e.S
@@ -1393,9 +1393,9 @@ BEGIN_FTR_SECTION
 	/* Release the other thread. It will spin until kick_cpu is called */
 	li	r3, 2
 	mtspr	SPRN_TENS, r3
+END_FTR_SECTION_IFSET(CPU_FTR_SMT)
 
 	blr
-END_FTR_SECTION_IFSET(CPU_FTR_SMT)
 
 _STATIC(init_thread_book3e)
 	lis	r3,(SPRN_EPCR_ICM | SPRN_EPCR_GICM)@h
-- 
1.7.9.7

