From bb8755673ea270acadee5da3c2768a805eb35ed0 Mon Sep 17 00:00:00 2001
From: Hai-Ying Wang <Haiying.Wang@freescale.com>
Date: Wed, 13 Jun 2012 22:11:41 +0000
Subject: [PATCH 038/227] fsl_pamu: change the of_find_ for guts_node

Signed-off-by: Haiying Wang <Haiying.Wang@freescale.com>
Signed-off-by: Andy Fleming <afleming@freescale.com>
[Kevin: Original patch taken from fsl sdk 1.3.1
QorIQ-SDK-V1.3.1-SOURCE-20121220-yocto.iso.]
Signed-off-by: Kevin Hao <kexin.hao@windriver.com>
---
 arch/powerpc/sysdev/fsl_pamu.c |   13 +++++++++++--
 1 file changed, 11 insertions(+), 2 deletions(-)

diff --git a/arch/powerpc/sysdev/fsl_pamu.c b/arch/powerpc/sysdev/fsl_pamu.c
index 2bad955..8baff2b4 100644
--- a/arch/powerpc/sysdev/fsl_pamu.c
+++ b/arch/powerpc/sysdev/fsl_pamu.c
@@ -1027,6 +1027,16 @@ static const struct {
 
 #define SVR_SECURITY	0x80000	/* The Security (E) bit */
 
+static struct of_device_id qoriq_device_config[] = {
+	{
+		.compatible = "fsl,qoriq-device-config-1.0",
+	},
+	{
+		.compatible = "fsl,t4240-device-config",
+	},
+	{}
+};
+
 static int __init fsl_pamu_probe(struct platform_device *pdev)
 {
 	void __iomem *pamu_regs = NULL;
@@ -1082,8 +1092,7 @@ static int __init fsl_pamu_probe(struct platform_device *pdev)
 		goto error;
 	}
 
-	guts_node = of_find_compatible_node(NULL, NULL,
-			"fsl,qoriq-device-config-1.0");
+	guts_node = of_find_matching_node(NULL, qoriq_device_config);
 	if (!guts_node) {
 		dev_err(&pdev->dev, "could not find GUTS node %s\n",
 			pdev->dev.of_node->full_name);
-- 
1.7.9.7

