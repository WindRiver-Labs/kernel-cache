From 77e0334219f283ee5901c4609cf3935ed7eaa84d Mon Sep 17 00:00:00 2001
From: Madalin Bucur <madalin.bucur@freescale.com>
Date: Mon, 22 Oct 2012 12:15:46 +0300
Subject: [PATCH 107/227] fmd: introduce function compat_obj_delete

Several different functions are doing the exact same operations.
Replaced all of them with the new added function compat_obj_delete().

Signed-off-by: Madalin Bucur <madalin.bucur@freescale.com>
[Kevin: Original patch taken from fsl sdk 1.3.1
QorIQ-SDK-V1.3.1-SOURCE-20121220-yocto.iso.]
Signed-off-by: Kevin Hao <kexin.hao@windriver.com>
---
 .../dpa/NetCommSw/src/wrapper/lnxwrp_ioctls_fm.c   |   12 +--
 .../src/wrapper/lnxwrp_ioctls_fm_compat.c          |   79 ++------------------
 .../src/wrapper/lnxwrp_ioctls_fm_compat.h          |   34 +--------
 3 files changed, 18 insertions(+), 107 deletions(-)

diff --git a/drivers/net/ethernet/freescale/dpa/NetCommSw/src/wrapper/lnxwrp_ioctls_fm.c b/drivers/net/ethernet/freescale/dpa/NetCommSw/src/wrapper/lnxwrp_ioctls_fm.c
index d767806..d2a6664 100644
--- a/drivers/net/ethernet/freescale/dpa/NetCommSw/src/wrapper/lnxwrp_ioctls_fm.c
+++ b/drivers/net/ethernet/freescale/dpa/NetCommSw/src/wrapper/lnxwrp_ioctls_fm.c
@@ -923,7 +923,7 @@ Status: feature not supported
                 if (copy_from_user(&compat_id, (ioc_compat_fm_obj_t *) compat_ptr(arg), sizeof(ioc_compat_fm_obj_t)))
                     RETURN_ERROR(MINOR, E_WRITE_FAILED, NO_MSG);
 
-                compat_copy_fm_net_env_delete(&compat_id, &id, COMPAT_US_TO_K);
+                compat_obj_delete(&compat_id, &id);
             }
             else
 #endif
@@ -1051,7 +1051,7 @@ Status: feature not supported
                 if (copy_from_user(&compat_id, (ioc_compat_fm_obj_t *) compat_ptr(arg), sizeof(ioc_compat_fm_obj_t)))
                     RETURN_ERROR(MINOR, E_WRITE_FAILED, NO_MSG);
 
-                compat_copy_fm_pcd_scheme_delete(&compat_id, &id, COMPAT_US_TO_K);
+                compat_obj_delete(&compat_id, &id);
             }
             else
 #endif
@@ -1232,7 +1232,7 @@ Status: feature not supported
                 if (copy_from_user(&compat_id, (ioc_compat_fm_obj_t *) compat_ptr(arg), sizeof(ioc_compat_fm_obj_t)))
                     RETURN_ERROR(MINOR, E_WRITE_FAILED, NO_MSG);
 
-                compat_copy_fm_pcd_cc_delete_node(&compat_id, &id, COMPAT_US_TO_K);
+                compat_obj_delete(&compat_id, &id);
             }
             else
 #endif
@@ -1360,7 +1360,7 @@ Status: feature not supported
                 if (copy_from_user(&compat_id, (ioc_compat_fm_obj_t *) compat_ptr(arg), sizeof(ioc_compat_fm_obj_t)))
                     RETURN_ERROR(MINOR, E_WRITE_FAILED, NO_MSG);
 
-                compat_copy_fm_pcd_cc_delete_tree(&compat_id, &id, COMPAT_US_TO_K);
+                compat_obj_delete(&compat_id, &id);
             }
             else
 #endif
@@ -1544,7 +1544,7 @@ invalid_port_id:
                 if (copy_from_user(&compat_id, (ioc_compat_fm_obj_t *) compat_ptr(arg), sizeof(ioc_compat_fm_obj_t)))
                     RETURN_ERROR(MINOR, E_WRITE_FAILED, NO_MSG);
 
-                compat_copy_fm_pcd_plcr_del_profile(&compat_id, &id, COMPAT_US_TO_K);
+                compat_obj_delete(&compat_id, &id);
             }
             else
 #endif
@@ -2571,7 +2571,7 @@ invalid_port_id:
                 if (copy_from_user(&compat_id, (ioc_compat_fm_obj_t *) compat_ptr(arg), sizeof(ioc_compat_fm_obj_t)))
                     RETURN_ERROR(MINOR, E_WRITE_FAILED, NO_MSG);
 
-                compat_copy_fm_pcd_manip_delete_node(&compat_id, &id, COMPAT_US_TO_K);
+                compat_obj_delete(&compat_id, &id);
             }
             else
 #endif
diff --git a/drivers/net/ethernet/freescale/dpa/NetCommSw/src/wrapper/lnxwrp_ioctls_fm_compat.c b/drivers/net/ethernet/freescale/dpa/NetCommSw/src/wrapper/lnxwrp_ioctls_fm_compat.c
index aba2246..9e03eaa 100644
--- a/drivers/net/ethernet/freescale/dpa/NetCommSw/src/wrapper/lnxwrp_ioctls_fm_compat.c
+++ b/drivers/net/ethernet/freescale/dpa/NetCommSw/src/wrapper/lnxwrp_ioctls_fm_compat.c
@@ -164,6 +164,14 @@ void *compat_get_id2ptr(compat_uptr_t comp, enum fm_map_node_type node_type)
 EXPORT_SYMBOL(compat_get_id2ptr);
 /* } maping kernel pointers w/ UserSpace id's  */
 
+void compat_obj_delete(
+	ioc_compat_fm_obj_t *compat_id,
+	ioc_fm_obj_t *id)
+{
+	id->obj = compat_pcd_id2ptr(compat_id->obj);
+	compat_del_ptr2id(id->obj, FM_MAP_TYPE_PCD_NODE);
+}
+
 static inline void compat_copy_fm_pcd_plcr_next_engine(
         ioc_compat_fm_pcd_plcr_next_engine_params_u *compat_param,
         ioc_fm_pcd_plcr_next_engine_params_u        *param,
@@ -291,18 +299,6 @@ void compat_copy_fm_pcd_plcr_profile(
     _fm_cpt_dbg (compat, " ...->}\n");
 }
 
-void compat_copy_fm_pcd_plcr_del_profile(
-        ioc_compat_fm_obj_t *compat_id,
-        ioc_fm_obj_t *id,
-        uint8_t compat)
-{
-    if (compat == COMPAT_US_TO_K)
-    {
-        id->obj = compat_pcd_id2ptr(compat_id->obj);
-        compat_del_ptr2id(id->obj, FM_MAP_TYPE_PCD_NODE);
-    }
-}
-
 static inline void compat_copy_fm_pcd_cc_next_kg(
         ioc_compat_fm_pcd_cc_next_kg_params_t   *compat_param,
         ioc_fm_pcd_cc_next_kg_params_t          *param,
@@ -593,18 +589,6 @@ void compat_copy_fm_pcd_cc_tree(
     _fm_cpt_dbg (compat, " ...->}\n");
 }
 
-void compat_copy_fm_pcd_cc_delete_tree(
-        ioc_compat_fm_obj_t *compat_id,
-        ioc_fm_obj_t *id,
-        uint8_t compat)
-{
-    if (compat == COMPAT_US_TO_K)
-    {
-        id->obj = compat_pcd_id2ptr(compat_id->obj);
-        compat_del_ptr2id(id->obj, FM_MAP_TYPE_PCD_NODE);
-    }
-}
-
 void compat_fm_pcd_prs_sw(
         ioc_compat_fm_pcd_prs_sw_params_t *compat_param,
         ioc_fm_pcd_prs_sw_params_t *param,
@@ -731,18 +715,6 @@ void compat_copy_fm_pcd_kg_scheme(
     _fm_cpt_dbg(compat," ...->}\n");
 }
 
-void compat_copy_fm_pcd_scheme_delete(
-        ioc_compat_fm_obj_t *compat_id,
-        ioc_fm_obj_t *id,
-        uint8_t compat)
-{
-    if (compat == COMPAT_US_TO_K)
-    {
-        id->obj = compat_pcd_id2ptr(compat_id->obj);
-        compat_del_ptr2id(id->obj, FM_MAP_TYPE_PCD_NODE);
-    }
-}
-
 void compat_copy_fm_pcd_kg_scheme_select(
         ioc_compat_fm_pcd_kg_scheme_select_t *compat_param,
         ioc_fm_pcd_kg_scheme_select_t *param,
@@ -862,18 +834,6 @@ void compat_copy_fm_pcd_net_env(
     }
 }
 
-void compat_copy_fm_net_env_delete(
-        ioc_compat_fm_obj_t *compat_id,
-        ioc_fm_obj_t *id,
-        uint8_t compat)
-{
-    if (compat == COMPAT_US_TO_K)
-    {
-        id->obj = compat_pcd_id2ptr(compat_id->obj);
-        compat_del_ptr2id(id->obj, FM_MAP_TYPE_PCD_NODE);
-    }
-}
-
 void compat_copy_fm_pcd_cc_node_modify_key(
         ioc_compat_fm_pcd_cc_node_modify_key_params_t   *compat_param,
         ioc_fm_pcd_cc_node_modify_key_params_t          *param,
@@ -974,18 +934,6 @@ void compat_copy_fm_pcd_cc_node(
     _fm_cpt_dbg(compat," ...->}\n");
 }
 
-void compat_copy_fm_pcd_cc_delete_node(
-    ioc_compat_fm_obj_t *compat_id,
-    ioc_fm_obj_t *id,
-    uint8_t compat)
-{
-    if (compat == COMPAT_US_TO_K)
-    {
-        id->obj = compat_pcd_id2ptr(compat_id->obj);
-        compat_del_ptr2id(id->obj, FM_MAP_TYPE_PCD_NODE);
-    }
-}
-
 void compat_fm_pcd_manip_set_node(
         ioc_compat_fm_pcd_manip_params_t *compat_param,
         ioc_fm_pcd_manip_params_t *param,
@@ -1074,14 +1022,3 @@ void compat_fm_pcd_manip_set_node(
     }
 }
 
-void compat_copy_fm_pcd_manip_delete_node(
-        ioc_compat_fm_obj_t *compat_id,
-        ioc_fm_obj_t *id,
-        uint8_t compat)
-{
-    if (compat == COMPAT_US_TO_K)
-    {
-        id->obj = compat_pcd_id2ptr(compat_id->obj);
-        compat_del_ptr2id(id->obj, FM_MAP_TYPE_PCD_NODE);
-    }
-}
diff --git a/drivers/net/ethernet/freescale/dpa/NetCommSw/src/wrapper/lnxwrp_ioctls_fm_compat.h b/drivers/net/ethernet/freescale/dpa/NetCommSw/src/wrapper/lnxwrp_ioctls_fm_compat.h
index 9b0a9ed..acaba3f 100644
--- a/drivers/net/ethernet/freescale/dpa/NetCommSw/src/wrapper/lnxwrp_ioctls_fm_compat.h
+++ b/drivers/net/ethernet/freescale/dpa/NetCommSw/src/wrapper/lnxwrp_ioctls_fm_compat.h
@@ -452,6 +452,10 @@ typedef struct ioc_compat_fm_pcd_manip_params_t {
 
 /* } pcd compat structures */
 
+void compat_obj_delete(
+        ioc_compat_fm_obj_t *compat_id,
+        ioc_fm_obj_t *id);
+
 /* pcd compat functions { */
 void compat_copy_fm_pcd_plcr_profile(
         ioc_compat_fm_pcd_plcr_profile_params_t *compat_param,
@@ -548,40 +552,10 @@ void compat_fm_pcd_manip_set_node(
         ioc_fm_pcd_manip_params_t *param,
         uint8_t compat);
 
-void compat_copy_fm_net_env_delete(
-        ioc_compat_fm_obj_t *compat_id,
-        ioc_fm_obj_t *id,
-        uint8_t compat);
-
-void compat_copy_fm_pcd_cc_delete_node(
-    ioc_compat_fm_obj_t *compat_id,
-    ioc_fm_obj_t *id,
-    uint8_t compat);
-
-void compat_copy_fm_pcd_cc_delete_tree(
-        ioc_compat_fm_obj_t *compat_id,
-        ioc_fm_obj_t *id,
-        uint8_t compat);
-
 void compat_copy_fm_port_pcd_modify_tree(
         ioc_compat_fm_obj_t *compat_id,
         ioc_fm_obj_t *id,
         uint8_t compat);
 
-void compat_copy_fm_pcd_manip_delete_node(
-        ioc_compat_fm_obj_t *compat_id,
-        ioc_fm_obj_t *id,
-        uint8_t compat);
-
-void compat_copy_fm_pcd_scheme_delete(
-        ioc_compat_fm_obj_t *compat_id,
-        ioc_fm_obj_t *id,
-        uint8_t compat);
-
-void compat_copy_fm_pcd_plcr_del_profile(
-        ioc_compat_fm_obj_t *compat_id,
-        ioc_fm_obj_t *id,
-        uint8_t compat);
-
 /* } pcd compat functions */
 #endif
-- 
1.7.9.7

