From 6acda809130aa204889c96af659692f887b746e5 Mon Sep 17 00:00:00 2001
From: Madalin Bucur <madalin.bucur@freescale.com>
Date: Tue, 4 Dec 2012 19:45:54 +0200
Subject: [PATCH 214/227] fmd: resource allocation disabled for FMan v3

FMan resource allocation algorithm is not available for FMan v3
platforms. Avoid running the code on these platforms and issue
a compilation warning.

Signed-off-by: Madalin Bucur <madalin.bucur@freescale.com>
[Kevin: Original patch taken from fsl sdk 1.3.1
QorIQ-SDK-V1.3.1-SOURCE-20121220-yocto.iso.]
Signed-off-by: Kevin Hao <kexin.hao@windriver.com>
---
 .../dpa/NetCommSw/src/wrapper/lnxwrp_fm_port.c     |    4 ++++
 1 file changed, 4 insertions(+)

diff --git a/drivers/net/ethernet/freescale/dpa/NetCommSw/src/wrapper/lnxwrp_fm_port.c b/drivers/net/ethernet/freescale/dpa/NetCommSw/src/wrapper/lnxwrp_fm_port.c
index 2e10cef..9918cab 100644
--- a/drivers/net/ethernet/freescale/dpa/NetCommSw/src/wrapper/lnxwrp_fm_port.c
+++ b/drivers/net/ethernet/freescale/dpa/NetCommSw/src/wrapper/lnxwrp_fm_port.c
@@ -554,6 +554,9 @@ static t_Error InitFmPortDev(t_LnxWrpFmPortDev *p_LnxWrpFmPortDev)
 	}
 
 #if defined(CONFIG_FMAN_RESOURCE_ALLOCATION_ALGORITHM)
+#if (DPAA_VERSION >= 11)
+#warning The resource allocation algorithm is not available for FMan v3 platforms
+#else
 	/* even if these functions return w/ error, do not crash kernel.
 	   Do not return anything because the container function is not
 	   linux complient (it should return -EIO). */
@@ -561,6 +564,7 @@ static t_Error InitFmPortDev(t_LnxWrpFmPortDev *p_LnxWrpFmPortDev)
 	fm_config_precalculate_open_dma(p_LnxWrpFmPortDev);
 	fm_config_precalculate_tnums(p_LnxWrpFmPortDev);
 #endif
+#endif
 
 	if (FM_PORT_Init(p_LnxWrpFmPortDev->h_Dev) != E_OK)
 		RETURN_ERROR(MAJOR, E_INVALID_STATE, NO_MSG);
-- 
1.7.9.7

