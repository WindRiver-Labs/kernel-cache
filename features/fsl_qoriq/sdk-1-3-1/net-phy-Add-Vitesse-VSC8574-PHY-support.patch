From 579c74944d8658d0d14a214b118c196e50fa44df Mon Sep 17 00:00:00 2001
From: shaohui xie <Shaohui.Xie@freescale.com>
Date: Wed, 28 Nov 2012 16:34:27 +0000
Subject: [PATCH 190/227] net/phy: Add Vitesse VSC8574 PHY support

The VSC8574 is a quad-port Gigabit Ethernet transceiver with four SerDes
interfaces for quad-port dual media capability.

Signed-off-by: Shaohui Xie <Shaohui.Xie@freescale.com>
Signed-off-by: Andy Fleming <afleming@freescale.com>
[Kevin: Original patch taken from fsl sdk 1.3.1
QorIQ-SDK-V1.3.1-SOURCE-20121220-yocto.iso.]
Signed-off-by: Kevin Hao <kexin.hao@windriver.com>
---
 drivers/net/phy/vitesse.c |   22 ++++++++++++++++++++++
 1 file changed, 22 insertions(+)

diff --git a/drivers/net/phy/vitesse.c b/drivers/net/phy/vitesse.c
index a5d68bb..d9bddc5 100644
--- a/drivers/net/phy/vitesse.c
+++ b/drivers/net/phy/vitesse.c
@@ -62,6 +62,7 @@
 #define PHY_ID_VSC8244			0x000fc6c0
 #define PHY_ID_VSC8221			0x000fc550
 #define PHY_ID_VSC8662			0x00070660
+#define PHY_ID_VSC8574			0x000704a0
 
 MODULE_DESCRIPTION("Vitesse PHY driver");
 MODULE_AUTHOR("Kriston Carson");
@@ -126,6 +127,7 @@ static int vsc82xx_config_intr(struct phy_device *phydev)
 	if (phydev->interrupts == PHY_INTERRUPT_ENABLED)
 		err = phy_write(phydev, MII_VSC8244_IMASK,
 			((phydev->drv->phy_id == PHY_ID_VSC8234) ||
+			 (phydev->drv->phy_id == PHY_ID_VSC8574) ||
 			 (phydev->drv->phy_id == PHY_ID_VSC8244)) ?
 				MII_VSC8244_IMASK_MASK :
 				MII_VSC8221_IMASK_MASK);
@@ -234,6 +236,21 @@ static struct phy_driver vsc8234_driver = {
 	.driver 	= { .owner = THIS_MODULE,},
 };
 
+/* Vitesse 8574 */
+static struct phy_driver vsc8574_driver = {
+	.phy_id		= PHY_ID_VSC8574,
+	.name		= "Vitesse VSC8574",
+	.phy_id_mask	= 0x000ffff0,
+	.features	= PHY_GBIT_FEATURES,
+	.flags		= PHY_HAS_INTERRUPT,
+	.config_init	= &vsc824x_config_init,
+	.config_aneg	= &vsc82x4_config_aneg,
+	.read_status	= &genphy_read_status,
+	.ack_interrupt	= &vsc824x_ack_interrupt,
+	.config_intr	= &vsc82xx_config_intr,
+	.driver		= { .owner = THIS_MODULE,},
+};
+
 /* Vitesse 866x */
 static struct phy_driver vsc8662_driver = {
 	.phy_id		= PHY_ID_VSC8662,
@@ -292,8 +309,13 @@ static int __init vsc82xx_init(void)
 	err = phy_driver_register(&vsc8662_driver);
 	if (err < 0)
 		goto err_vsc8662;
+	err = phy_driver_register(&vsc8574_driver);
+	if (err < 0)
+		goto err_vsc8574;
 	return 0;
 
+err_vsc8574:
+	phy_driver_unregister(&vsc8662_driver);
 err_vsc8662:
 	phy_driver_unregister(&vsc8234_driver);
 err_vsc8234:
-- 
1.7.9.7

