From fde7e7a57386b6fadbbdb1e01fc7512de097aaf1 Mon Sep 17 00:00:00 2001
From: Madalin Bucur <madalin.bucur@freescale.com>
Date: Mon, 26 Nov 2012 18:53:47 +0200
Subject: [PATCH 182/227] fmd: FMD18.1.2 integration

Add FMD18.1.2 integration changes.
This new version is compatible with microcode version 106.x.6.

Signed-off-by: Madalin Bucur <madalin.bucur@freescale.com>
[Kevin: Original patch taken from fsl sdk 1.3.1
QorIQ-SDK-V1.3.1-SOURCE-20121220-yocto.iso.]
Signed-off-by: Kevin Hao <kexin.hao@windriver.com>
---
 .../dpa/NetCommSw/Peripherals/FM/Pcd/fm_manip.c    |   26 ++--
 .../dpa/NetCommSw/Peripherals/FM/Pcd/fm_prs.h      |  146 ++++++++++----------
 .../dpa/NetCommSw/Peripherals/FM/Pcd/fm_replic.c   |    6 +
 .../dpa/NetCommSw/Peripherals/FM/Port/fm_port.c    |   22 +--
 .../dpa/NetCommSw/Peripherals/FM/Port/fm_port.h    |    2 +-
 include/linux/fmd/Peripherals/fm_ioctls.h          |    2 +-
 6 files changed, 99 insertions(+), 105 deletions(-)

diff --git a/drivers/net/ethernet/freescale/dpa/NetCommSw/Peripherals/FM/Pcd/fm_manip.c b/drivers/net/ethernet/freescale/dpa/NetCommSw/Peripherals/FM/Pcd/fm_manip.c
index 8eb3951..b81de93 100644
--- a/drivers/net/ethernet/freescale/dpa/NetCommSw/Peripherals/FM/Pcd/fm_manip.c
+++ b/drivers/net/ethernet/freescale/dpa/NetCommSw/Peripherals/FM/Pcd/fm_manip.c
@@ -3790,6 +3790,18 @@ t_Handle FM_PCD_ManipNodeSet(t_Handle h_FmPcd, t_FmPcdManipParams *p_ManipParams
     p_Manip =  ManipOrStatsSetNode(h_FmPcd, (t_Handle)p_ManipParams, FALSE);
     if (!p_Manip)
         return NULL;
+
+    if (((p_Manip->opcode == HMAN_OC_IP_REASSEMBLY) ||
+         (p_Manip->opcode == HMAN_OC_IP_FRAGMENTATION) ||
+         (p_Manip->opcode == HMAN_OC_MV_INT_FRAME_HDR_FROM_FRM_TO_BUFFER_PREFFIX) ||
+         (p_Manip->opcode == HMAN_OC) ||
+         (p_Manip->opcode == HMAN_OC_IPSEC_MANIP)) &&
+        (!FmPcdIsAdvancedOffloadSupported(p_FmPcd)))
+    {
+        REPORT_ERROR(MAJOR, E_INVALID_STATE, ("Advanced-offload must be enabled"));
+        XX_Free(p_Manip);
+        return NULL;
+    }
     p_Manip->h_Spinlock = XX_InitSpinlock();
     if (!p_Manip->h_Spinlock)
     {
@@ -3805,24 +3817,12 @@ t_Handle FM_PCD_ManipNodeSet(t_Handle h_FmPcd, t_FmPcdManipParams *p_ManipParams
         case (HMAN_OC_IP_REASSEMBLY):
             /* IpReassembly */
             err = IpReassembly(&p_ManipParams->u.reassem, p_Manip);
-            if (err)
-            {
-                REPORT_ERROR(MAJOR, E_INVALID_VALUE, ("UNSUPPORTED HEADER MANIPULATION TYPE"));
-                ReleaseManipHandler(p_Manip, p_FmPcd);
-                XX_Free(p_Manip);
-                return NULL;
-            }
             break;
        case (HMAN_OC_IP_FRAGMENTATION):
             /* IpFragmentation */
             err = IpFragmentation(&p_ManipParams->u.frag.u.ipFrag ,p_Manip);
             if (err)
-            {
-                REPORT_ERROR(MAJOR, E_INVALID_VALUE, ("UNSUPPORTED HEADER MANIPULATION TYPE"));
-                ReleaseManipHandler(p_Manip, p_FmPcd);
-                XX_Free(p_Manip);
-                return NULL;
-            }
+                break;
             err = IPManip(p_Manip);
             break;
         case (HMAN_OC_IPSEC_MANIP) :
diff --git a/drivers/net/ethernet/freescale/dpa/NetCommSw/Peripherals/FM/Pcd/fm_prs.h b/drivers/net/ethernet/freescale/dpa/NetCommSw/Peripherals/FM/Pcd/fm_prs.h
index 04e4362..ca3f09e 100644
--- a/drivers/net/ethernet/freescale/dpa/NetCommSw/Peripherals/FM/Pcd/fm_prs.h
+++ b/drivers/net/ethernet/freescale/dpa/NetCommSw/Peripherals/FM/Pcd/fm_prs.h
@@ -47,7 +47,7 @@
 /***********************************************************************/
 
 #if (DPAA_VERSION == 10)
-/* Version: 106.1.8 */
+/* Version: 106.1.9 */
 #define SW_PRS_IP_FRAG_PATCH                           \
 {                                                      \
     0x31,0x52,0x00,0xDA,0x0A,0x00,0x00,0x00,0x00,0x00, \
@@ -60,42 +60,41 @@
     0x00,0x01,0x1B,0xFE,0x31,0x52,0x00,0xDA,0x06,0x00, \
     0x00,0x00,0x00,0x00,0x00,0x00,0x43,0x2F,0x00,0x00, \
     0x00,0x01,0x1B,0xFE,0x31,0x52,0x00,0xDA,0x00,0x40, \
-    0x00,0x00,0x00,0x00,0x00,0x00,0x53,0x96,0x00,0x00, \
-    0x32,0xC1,0x00,0x55,0x00,0x06,0x28,0x23,0x00,0x00, \
-    0x9B,0x8F,0x2F,0x0F,0x32,0xC1,0x00,0x55,0x00,0x28, \
-    0x28,0x43,0x30,0x7E,0x43,0x49,0x00,0x00,0x30,0x7E, \
-    0x43,0x49,0x00,0x3C,0x1B,0x63,0x32,0x11,0x28,0x23, \
-    0x32,0x11,0x32,0xC0,0x00,0x4F,0x00,0x81,0x00,0x00, \
-    0x83,0x8F,0x2F,0x0F,0x06,0x00,0x32,0x11,0x32,0xC0, \
-    0x00,0x4F,0x00,0x55,0x00,0x01,0x00,0x81,0x32,0x11, \
-    0x00,0x00,0x83,0x8E,0x00,0x50,0x00,0x01,0x01,0x04, \
-    0x00,0x4D,0x28,0x43,0x06,0x00,0x1B,0x42,0x30,0x7E, \
-    0x53,0x79,0x00,0x2B,0x32,0x11,0x28,0x23,0x32,0x11, \
+    0x00,0x00,0x00,0x00,0x00,0x00,0x53,0x95,0x00,0x00, \
+    0x00,0x00,0x9B,0x8F,0x2F,0x0F,0x32,0xC1,0x00,0x55, \
+    0x00,0x28,0x28,0x43,0x30,0x7E,0x43,0x45,0x00,0x00, \
+    0x30,0x7E,0x43,0x45,0x00,0x3C,0x1B,0x5D,0x32,0x11, \
+    0x32,0xC0,0x00,0x4F,0x00,0x81,0x00,0x00,0x83,0x8F, \
+    0x2F,0x0F,0x06,0x00,0x32,0x11,0x32,0xC0,0x00,0x4F, \
+    0x00,0x55,0x00,0x01,0x00,0x81,0x32,0x11,0x00,0x00, \
+    0x83,0x8E,0x00,0x50,0x00,0x01,0x01,0x04,0x00,0x4D, \
+    0x28,0x43,0x06,0x00,0x1B,0x3E,0x30,0x7E,0x53,0x79, \
+    0x00,0x2B,0x32,0x11,0x32,0xC0,0x00,0x4F,0x00,0x81, \
+    0x00,0x00,0x87,0x8F,0x28,0x23,0x06,0x00,0x32,0x11, \
     0x32,0xC0,0x00,0x4F,0x00,0x55,0x00,0x01,0x00,0x81, \
     0x32,0x11,0x00,0x00,0x83,0x8E,0x00,0x50,0x00,0x01, \
     0x01,0x04,0x00,0x4D,0x28,0x43,0x06,0x00,0x00,0x01, \
-    0x1B,0xFE,0x00,0x00,0x9B,0x8E,0x53,0x8D,0x00,0x00, \
-    0x32,0xC1,0x00,0x55,0x00,0x28,0x28,0x23,0x06,0x29, \
-    0x31,0x11,0x00,0x00,0x83,0x8E,0x00,0x50,0x00,0x01, \
-    0x01,0x04,0x00,0x4D,0x28,0x43,0x06,0x00,0x00,0x01, \
-    0x1B,0xFE,0x32,0xC1,0x00,0x55,0x00,0x06,0x28,0x23, \
-    0x32,0xC1,0x00,0x55,0x00,0x28,0x28,0x43,0x1B,0xCE, \
-    0x32,0xC1,0x00,0x55,0x00,0x06,0x28,0x23,0x00,0x00, \
+    0x1B,0xFE,0x00,0x00,0x9B,0x8E,0x53,0x90,0x00,0x00, \
+    0x06,0x29,0x00,0x00,0x83,0x8F,0x28,0x23,0x06,0x00, \
+    0x06,0x29,0x32,0xC1,0x00,0x55,0x00,0x28,0x00,0x00, \
+    0x83,0x8E,0x00,0x50,0x00,0x01,0x01,0x04,0x00,0x4D, \
+    0x28,0x43,0x06,0x00,0x00,0x01,0x1B,0xFE,0x32,0xC1, \
+    0x00,0x55,0x00,0x28,0x28,0x43,0x1B,0xCF,0x00,0x00, \
     0x9B,0x8F,0x2F,0x0F,0x32,0xC1,0x00,0x55,0x00,0x28, \
-    0x28,0x43,0x30,0x7E,0x43,0xBE,0x00,0x2C,0x32,0x11, \
-    0x28,0x23,0x32,0x11,0x32,0xC0,0x00,0x4F,0x00,0x81, \
-    0x00,0x00,0x83,0x8F,0x2F,0x0F,0x06,0x00,0x32,0x11, \
-    0x32,0xC0,0x00,0x4F,0x00,0x55,0x00,0x01,0x00,0x81, \
-    0x32,0x11,0x00,0x00,0x83,0x8E,0x00,0x50,0x00,0x01, \
-    0x01,0x04,0x00,0x4D,0x28,0x43,0x06,0x00,0x1B,0xA1, \
-    0x33,0xF1,0x00,0xF9,0x00,0x01,0x00,0x00,0x00,0x00, \
-    0x00,0x00,0x28,0x7F,0x00,0x03,0x00,0x02,0x00,0x00, \
-    0x00,0x01,0x32,0xF1,0x32,0xC0,0x00,0x4F,0x00,0x81, \
-    0x1F,0xFF,0x00,0x01,0x1B,0xFE,                     \
+    0x28,0x43,0x30,0x7E,0x43,0xBF,0x00,0x2C,0x32,0x11, \
+    0x32,0xC0,0x00,0x4F,0x00,0x81,0x00,0x00,0x87,0x8F, \
+    0x28,0x23,0x06,0x00,0x32,0x11,0x32,0xC0,0x00,0x4F, \
+    0x00,0x81,0x00,0x00,0x83,0x8F,0x2F,0x0F,0x06,0x00, \
+    0x32,0x11,0x32,0xC0,0x00,0x4F,0x00,0x55,0x00,0x01, \
+    0x00,0x81,0x32,0x11,0x00,0x00,0x83,0x8E,0x00,0x50, \
+    0x00,0x01,0x01,0x04,0x00,0x4D,0x28,0x43,0x06,0x00, \
+    0x1B,0x9C,0x33,0xF1,0x00,0xF9,0x00,0x01,0x00,0x00, \
+    0x00,0x00,0x00,0x00,0x28,0x7F,0x00,0x03,0x00,0x02, \
+    0x00,0x00,0x00,0x01,0x32,0xC1,0x32,0xF0,0x00,0x4A, \
+    0x00,0x80,0x1F,0xFF,0x00,0x01,0x1B,0xFE,           \
 }
-
 #else
-/* version: 106.3.11 */
+/* version: 106.3.13 */
 #define SW_PRS_IP_FRAG_PATCH                           \
 {                                                      \
     0x31,0x52,0x00,0xDA,0x0E,0x4F,0x00,0x00,0x00,0x00, \
@@ -106,52 +105,53 @@
     0x00,0x00,0x00,0x00,0x00,0x00,0x43,0x00,0x00,0x00, \
     0x00,0x01,0x1B,0xFE,0x00,0x00,0x99,0x00,0x53,0x09, \
     0x00,0x00,0x00,0x00,0x9F,0x98,0x53,0x09,0x00,0x00, \
-    0x1B,0x21,0x09,0x4F,0x00,0x20,0x00,0x00,0x34,0xB7, \
-    0x00,0xF9,0x00,0x00,0x01,0x00,0x00,0x00,0x00,0x00, \
-    0x2B,0x97,0x31,0xB3,0x29,0x8F,0x33,0xF1,0x00,0xF9, \
-    0x00,0x01,0x00,0x00,0x00,0x00,0x00,0x00,0x28,0x7F, \
-    0x00,0x03,0x00,0x02,0x00,0x00,0x00,0x01,0x1B,0xFE, \
-    0x00,0x01,0x1B,0xFE,0x31,0x52,0x00,0xDA,0x0E,0x4F, \
-    0x00,0x00,0x00,0x00,0x00,0x00,0x53,0x39,0x04,0x4B, \
-    0x31,0x53,0x00,0xFB,0xFF,0xF0,0x00,0x00,0x00,0x00, \
-    0x00,0x00,0x29,0x2B,0x33,0xF1,0x00,0xFB,0x00,0xDF, \
-    0x00,0x00,0x00,0x00,0x00,0x00,0x28,0x7F,0x31,0x52, \
-    0x00,0xDA,0x06,0x00,0x00,0x00,0x00,0x00,0x00,0x00, \
-    0x43,0x43,0x00,0x00,0x00,0x01,0x1B,0xFE,0x31,0x52, \
-    0x00,0xDA,0x00,0x40,0x00,0x00,0x00,0x00,0x00,0x00, \
-    0x53,0xAA,0x00,0x00,0x32,0xC1,0x00,0x55,0x00,0x06, \
-    0x28,0x23,0x00,0x00,0x9B,0x8F,0x2F,0x0F,0x32,0xC1, \
-    0x00,0x55,0x00,0x28,0x28,0x43,0x30,0x7E,0x43,0x5D, \
-    0x00,0x00,0x30,0x7E,0x43,0x5D,0x00,0x3C,0x1B,0x77, \
-    0x32,0x11,0x28,0x23,0x32,0x11,0x32,0xC0,0x00,0x4F, \
+    0x1B,0x24,0x09,0x5F,0x00,0x20,0x00,0x00,0x09,0x4F, \
+    0x00,0x20,0x00,0x00,0x34,0xB7,0x00,0xF9,0x00,0x00, \
+    0x01,0x00,0x00,0x00,0x00,0x00,0x2B,0x97,0x31,0xB3, \
+    0x29,0x8F,0x33,0xF1,0x00,0xF9,0x00,0x01,0x00,0x00, \
+    0x00,0x00,0x00,0x00,0x28,0x7F,0x00,0x03,0x00,0x02, \
+    0x00,0x00,0x00,0x01,0x1B,0xFE,0x00,0x01,0x1B,0xFE, \
+    0x31,0x52,0x00,0xDA,0x0E,0x4F,0x00,0x00,0x00,0x00, \
+    0x00,0x00,0x53,0x3C,0x04,0x4B,0x31,0x53,0x00,0xFB, \
+    0xFF,0xF0,0x00,0x00,0x00,0x00,0x00,0x00,0x29,0x2B, \
+    0x33,0xF1,0x00,0xFB,0x00,0xDF,0x00,0x00,0x00,0x00, \
+    0x00,0x00,0x28,0x7F,0x31,0x52,0x00,0xDA,0x06,0x00, \
+    0x00,0x00,0x00,0x00,0x00,0x00,0x43,0x46,0x00,0x00, \
+    0x00,0x01,0x1B,0xFE,0x31,0x52,0x00,0xDA,0x00,0x40, \
+    0x00,0x00,0x00,0x00,0x00,0x00,0x53,0xAC,0x00,0x00, \
+    0x00,0x00,0x9B,0x8F,0x2F,0x0F,0x32,0xC1,0x00,0x55, \
+    0x00,0x28,0x28,0x43,0x30,0x7E,0x43,0x5C,0x00,0x00, \
+    0x30,0x7E,0x43,0x5C,0x00,0x3C,0x1B,0x74,0x32,0x11, \
+    0x32,0xC0,0x00,0x4F,0x00,0x81,0x00,0x00,0x83,0x8F, \
+    0x2F,0x0F,0x06,0x00,0x32,0x11,0x32,0xC0,0x00,0x4F, \
+    0x00,0x55,0x00,0x01,0x00,0x81,0x32,0x11,0x00,0x00, \
+    0x83,0x8E,0x00,0x50,0x00,0x01,0x01,0x04,0x00,0x4D, \
+    0x28,0x43,0x06,0x00,0x1B,0x55,0x30,0x7E,0x53,0x90, \
+    0x00,0x2B,0x32,0x11,0x32,0xC0,0x00,0x4F,0x00,0x81, \
+    0x00,0x00,0x87,0x8F,0x28,0x23,0x06,0x00,0x32,0x11, \
+    0x32,0xC0,0x00,0x4F,0x00,0x55,0x00,0x01,0x00,0x81, \
+    0x32,0x11,0x00,0x00,0x83,0x8E,0x00,0x50,0x00,0x01, \
+    0x01,0x04,0x00,0x4D,0x28,0x43,0x06,0x00,0x00,0x01, \
+    0x1B,0xFE,0x00,0x00,0x9B,0x8E,0x53,0xA7,0x00,0x00, \
+    0x06,0x29,0x00,0x00,0x83,0x8F,0x28,0x23,0x06,0x00, \
+    0x06,0x29,0x32,0xC1,0x00,0x55,0x00,0x28,0x00,0x00, \
+    0x83,0x8E,0x00,0x50,0x00,0x01,0x01,0x04,0x00,0x4D, \
+    0x28,0x43,0x06,0x00,0x00,0x01,0x1B,0xFE,0x32,0xC1, \
+    0x00,0x55,0x00,0x28,0x28,0x43,0x1B,0xF1,0x00,0x00, \
+    0x9B,0x8F,0x2F,0x0F,0x32,0xC1,0x00,0x55,0x00,0x28, \
+    0x28,0x43,0x30,0x7E,0x43,0xD6,0x00,0x2C,0x32,0x11, \
+    0x32,0xC0,0x00,0x4F,0x00,0x81,0x00,0x00,0x87,0x8F, \
+    0x28,0x23,0x06,0x00,0x32,0x11,0x32,0xC0,0x00,0x4F, \
     0x00,0x81,0x00,0x00,0x83,0x8F,0x2F,0x0F,0x06,0x00, \
     0x32,0x11,0x32,0xC0,0x00,0x4F,0x00,0x55,0x00,0x01, \
     0x00,0x81,0x32,0x11,0x00,0x00,0x83,0x8E,0x00,0x50, \
     0x00,0x01,0x01,0x04,0x00,0x4D,0x28,0x43,0x06,0x00, \
-    0x1B,0x56,0x30,0x7E,0x53,0x8D,0x00,0x2B,0x32,0x11, \
-    0x28,0x23,0x32,0x11,0x32,0xC0,0x00,0x4F,0x00,0x55, \
-    0x00,0x01,0x00,0x81,0x32,0x11,0x00,0x00,0x83,0x8E, \
-    0x00,0x50,0x00,0x01,0x01,0x04,0x00,0x4D,0x28,0x43, \
-    0x06,0x00,0x00,0x01,0x1B,0xFE,0x00,0x00,0x9B,0x8E, \
-    0x53,0xA1,0x00,0x00,0x32,0xC1,0x00,0x55,0x00,0x28, \
-    0x28,0x23,0x06,0x29,0x31,0x11,0x00,0x00,0x83,0x8E, \
-    0x00,0x50,0x00,0x01,0x01,0x04,0x00,0x4D,0x28,0x43, \
-    0x06,0x00,0x00,0x01,0x1B,0xFE,0x32,0xC1,0x00,0x55, \
-    0x00,0x06,0x28,0x23,0x32,0xC1,0x00,0x55,0x00,0x28, \
-    0x28,0x43,0x1B,0xEA,0x32,0xC1,0x00,0x55,0x00,0x06, \
-    0x28,0x23,0x00,0x00,0x9B,0x8F,0x2F,0x0F,0x32,0xC1, \
-    0x00,0x55,0x00,0x28,0x28,0x43,0x30,0x7E,0x43,0xD2, \
-    0x00,0x2C,0x32,0x11,0x28,0x23,0x32,0x11,0x32,0xC0, \
-    0x00,0x4F,0x00,0x81,0x00,0x00,0x83,0x8F,0x2F,0x0F, \
-    0x06,0x00,0x32,0x11,0x32,0xC0,0x00,0x4F,0x00,0x55, \
-    0x00,0x01,0x00,0x81,0x32,0x11,0x00,0x00,0x83,0x8E, \
-    0x00,0x50,0x00,0x01,0x01,0x04,0x00,0x4D,0x28,0x43, \
-    0x06,0x00,0x1B,0xB5,0x09,0x4F,0x00,0x20,0x00,0x00, \
-    0x34,0xB7,0x00,0xF9,0x00,0x00,0x01,0x00,0x00,0x00, \
-    0x00,0x00,0x2B,0x97,0x31,0xB3,0x29,0x8F,0x33,0xF1, \
-    0x00,0xF9,0x00,0x01,0x00,0x00,0x00,0x00,0x00,0x00, \
-    0x28,0x7F,0x00,0x03,0x00,0x02,0x00,0x00,0x00,0x01, \
-    0x1B,0xFE,0x00,0x01,0x1B,0xFE,                     \
+    0x1B,0xB3,0x09,0x5F,0x00,0x20,0x00,0x00,0x09,0x4F, \
+    0x00,0x20,0x00,0x00,0x34,0xB7,0x00,0xF9,0x00,0x00, \
+    0x01,0x00,0x00,0x00,0x00,0x00,0x2B,0x97,0x31,0xB3, \
+    0x29,0x8F,0x33,0xF1,0x00,0xF9,0x00,0x01,0x00,0x00, \
+    0x00,0x00,0x00,0x00,0x28,0x7F,0x00,0x03,0x00,0x02, \
+    0x00,0x00,0x00,0x01,0x1B,0xFE,0x00,0x01,0x1B,0xFE, \
 }
 #endif /* (DPAA_VERSION == 10) */
 
diff --git a/drivers/net/ethernet/freescale/dpa/NetCommSw/Peripherals/FM/Pcd/fm_replic.c b/drivers/net/ethernet/freescale/dpa/NetCommSw/Peripherals/FM/Pcd/fm_replic.c
index ba8d807..c69965a 100644
--- a/drivers/net/ethernet/freescale/dpa/NetCommSw/Peripherals/FM/Pcd/fm_replic.c
+++ b/drivers/net/ethernet/freescale/dpa/NetCommSw/Peripherals/FM/Pcd/fm_replic.c
@@ -690,6 +690,12 @@ t_Handle FM_PCD_FrmReplicSetGroup(t_Handle                    h_FmPcd,
     SANITY_CHECK_RETURN_VALUE(h_FmPcd, E_INVALID_HANDLE, NULL);
     SANITY_CHECK_RETURN_VALUE(p_ReplicGroupParam, E_INVALID_HANDLE, NULL);
 
+    if (!FmPcdIsAdvancedOffloadSupported(h_FmPcd))
+    {
+        REPORT_ERROR(MAJOR, E_INVALID_STATE, ("Advanced-offload must be enabled"));
+        return NULL;
+    }
+
     err = CheckParams(h_FmPcd, p_ReplicGroupParam);
     if (err)
     {
diff --git a/drivers/net/ethernet/freescale/dpa/NetCommSw/Peripherals/FM/Port/fm_port.c b/drivers/net/ethernet/freescale/dpa/NetCommSw/Peripherals/FM/Port/fm_port.c
index 335da8f..556e205 100644
--- a/drivers/net/ethernet/freescale/dpa/NetCommSw/Peripherals/FM/Port/fm_port.c
+++ b/drivers/net/ethernet/freescale/dpa/NetCommSw/Peripherals/FM/Port/fm_port.c
@@ -4923,24 +4923,12 @@ t_Error FM_PORT_SetPCD(t_Handle h_FmPort, t_FmPortPcdParams *p_PcdParam)
             p_FmPort->savedBmiNia |= (NIA_FM_CTL_AC_POST_BMI_FETCH | NIA_ENG_FM_CTL);
 
             /* Set pre-bmi-fetch nia */
-            fmPortGetSetCcParams.getCcParams.type = GET_NIA_PNDN;
-            if ((err = FmPortGetSetCcParams(p_FmPort, &fmPortGetSetCcParams)) != E_OK)
-            {
-                DeletePcd(p_FmPort);
-                if (p_FmPort->h_IpReassemblyTree)
-                {
-                    FM_PCD_CcRootDelete(p_FmPort->h_IpReassemblyTree);
-                    p_FmPort->h_IpReassemblyTree = NULL;
-                }
-                FmPcdLockUnlockAll(p_FmPort->h_FmPcd);
-                RELEASE_LOCK(p_FmPort->lock);
-                RETURN_ERROR(MINOR, err, NO_MSG);
-            }
             fmPortGetSetCcParams.setCcParams.type = UPDATE_NIA_PNDN;
-            if (fmPortGetSetCcParams.getCcParams.nia == (NIA_ENG_BMI | NIA_BMI_AC_FETCH))
-                fmPortGetSetCcParams.setCcParams.nia = (NIA_FM_CTL_AC_PRE_BMI_FETCH_HEADER | NIA_ENG_FM_CTL);
-            else
-                fmPortGetSetCcParams.setCcParams.nia = (NIA_FM_CTL_AC_PRE_BMI_FETCH_FULL_FRAME | NIA_ENG_FM_CTL);
+#if (DPAA_VERSION >= 11)
+            fmPortGetSetCcParams.setCcParams.nia = (NIA_FM_CTL_AC_PRE_BMI_FETCH_FULL_FRAME | NIA_ENG_FM_CTL);
+#else
+            fmPortGetSetCcParams.setCcParams.nia = (NIA_FM_CTL_AC_PRE_BMI_FETCH_HEADER | NIA_ENG_FM_CTL);
+#endif /* (DPAA_VERSION >= 11) */
             if ((err = FmPortGetSetCcParams(p_FmPort, &fmPortGetSetCcParams)) != E_OK)
             {
                 DeletePcd(p_FmPort);
diff --git a/drivers/net/ethernet/freescale/dpa/NetCommSw/Peripherals/FM/Port/fm_port.h b/drivers/net/ethernet/freescale/dpa/NetCommSw/Peripherals/FM/Port/fm_port.h
index f10ea97..c455131 100644
--- a/drivers/net/ethernet/freescale/dpa/NetCommSw/Peripherals/FM/Port/fm_port.h
+++ b/drivers/net/ethernet/freescale/dpa/NetCommSw/Peripherals/FM/Port/fm_port.h
@@ -174,7 +174,7 @@ typedef uint32_t fmPcdEngines_t; /**< options as defined below: */
 #define IP_FRAG_SW_PATCH_IPv4_SIZE              0x025
 #else
 #define IP_FRAG_SW_PATCH_IPv4_LABEL             0x2E0
-#define IP_FRAG_SW_PATCH_IPv4_SIZE              0x043
+#define IP_FRAG_SW_PATCH_IPv4_SIZE              0x046
 #endif /* (DPAA_VERSION == 10) */
 #define IP_FRAG_SW_PATCH_IPv6_LABEL             \
     (IP_FRAG_SW_PATCH_IPv4_LABEL + IP_FRAG_SW_PATCH_IPv4_SIZE)
diff --git a/include/linux/fmd/Peripherals/fm_ioctls.h b/include/linux/fmd/Peripherals/fm_ioctls.h
index 1c45f6d..5c24646 100644
--- a/include/linux/fmd/Peripherals/fm_ioctls.h
+++ b/include/linux/fmd/Peripherals/fm_ioctls.h
@@ -621,6 +621,6 @@ typedef struct ioc_fm_ctrl_mon_counters_params_t {
 
 #define FMD_API_VERSION_MAJOR 18
 #define FMD_API_VERSION_MINOR 1
-#define FMD_API_VERSION_RESPIN 1
+#define FMD_API_VERSION_RESPIN 2
 
 #endif /* __FM_IOCTLS_H */
-- 
1.7.9.7

