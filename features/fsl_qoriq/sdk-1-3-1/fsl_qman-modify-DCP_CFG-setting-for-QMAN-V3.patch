From 4857dee814d54ff938b611aab5cbd23982937dde Mon Sep 17 00:00:00 2001
From: Hai-Ying Wang <Haiying.Wang@freescale.com>
Date: Tue, 13 Nov 2012 21:39:15 +0000
Subject: [PATCH 143/227] fsl_qman: modify DCP_CFG setting for QMAN V3

The SERND and ED fields are changed in DCP_CFG register in QMAN V3 because of
the increasement of portal number.

Signed-off-by: Haiying Wang <Haiying.Wang@freescale.com>
Signed-off-by: Andy Fleming <afleming@freescale.com>
[Kevin: Original patch taken from fsl sdk 1.3.1
QorIQ-SDK-V1.3.1-SOURCE-20121220-yocto.iso.]
Signed-off-by: Kevin Hao <kexin.hao@windriver.com>
---
 drivers/staging/fsl_qbman/qman_config.c |    5 ++++-
 1 file changed, 4 insertions(+), 1 deletion(-)

diff --git a/drivers/staging/fsl_qbman/qman_config.c b/drivers/staging/fsl_qbman/qman_config.c
index c1ec438..8b16ca4 100644
--- a/drivers/staging/fsl_qbman/qman_config.c
+++ b/drivers/staging/fsl_qbman/qman_config.c
@@ -380,7 +380,10 @@ static void qm_set_dc(struct qman *qm, enum qm_dc_portal portal,
 {
 	DPA_ASSERT(!ed || (portal == qm_dc_portal_fman0) ||
 			(portal == qm_dc_portal_fman1));
-	qm_out(DCP_CFG(portal), (ed ? 0x100 : 0) | (sernd & 0x1f));
+	if ((qman_ip_rev & 0xFF00) >= QMAN_REV30)
+		qm_out(DCP_CFG(portal), (ed ? 0x1000 : 0) | (sernd & 0x3ff));
+	else
+		qm_out(DCP_CFG(portal), (ed ? 0x100 : 0) | (sernd & 0x1f));
 }
 
 static void qm_set_wq_scheduling(struct qman *qm, enum qm_wq_class wq_class,
-- 
1.7.9.7

