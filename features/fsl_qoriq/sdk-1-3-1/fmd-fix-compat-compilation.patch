From 0cbfed854291c148bc424f4554d3ba822b9a6a4c Mon Sep 17 00:00:00 2001
From: Madalin Bucur <madalin.bucur@freescale.com>
Date: Thu, 6 Dec 2012 11:24:14 +0200
Subject: [PATCH 223/227] fmd: fix compat compilation

Function compat_copy_fm_port_vsp_alloc_params() must be compiled
only for (DPAA_VERSION >= 11). DPAA_VERSION checks cleanup.

Signed-off-by: Madalin Bucur <madalin.bucur@freescale.com>
[Kevin: Original patch taken from fsl sdk 1.3.1
QorIQ-SDK-V1.3.1-SOURCE-20121220-yocto.iso.]
Signed-off-by: Kevin Hao <kexin.hao@windriver.com>
---
 .../dpa/NetCommSw/src/wrapper/lnxwrp_ioctls_fm.c   |    2 +-
 .../src/wrapper/lnxwrp_ioctls_fm_compat.c          |    2 ++
 .../src/wrapper/lnxwrp_ioctls_fm_compat.h          |    7 ++++---
 include/linux/fmd/Peripherals/fm_ioctls.h          |    4 +++-
 include/linux/fmd/Peripherals/fm_pcd_ioctls.h      |    1 -
 include/linux/fmd/Peripherals/fm_port_ioctls.h     |    2 +-
 6 files changed, 11 insertions(+), 7 deletions(-)

diff --git a/drivers/net/ethernet/freescale/dpa/NetCommSw/src/wrapper/lnxwrp_ioctls_fm.c b/drivers/net/ethernet/freescale/dpa/NetCommSw/src/wrapper/lnxwrp_ioctls_fm.c
index 01b9a68..02d9726 100644
--- a/drivers/net/ethernet/freescale/dpa/NetCommSw/src/wrapper/lnxwrp_ioctls_fm.c
+++ b/drivers/net/ethernet/freescale/dpa/NetCommSw/src/wrapper/lnxwrp_ioctls_fm.c
@@ -4107,7 +4107,6 @@ t_Error LnxwrpFmPortIOCTL(t_LnxWrpFmPortDev *p_LnxWrpFmPortDev, unsigned int cmd
             break;
         }
 
-#if (DPAA_VERSION >= 11)
         case FM_PORT_IOC_CONFIG_BUFFER_PREFIX_CONTENT:
         {
             ioc_fm_buffer_prefix_content_t *param;
@@ -4136,6 +4135,7 @@ t_Error LnxwrpFmPortIOCTL(t_LnxWrpFmPortDev *p_LnxWrpFmPortDev, unsigned int cmd
             break;
         }
 
+#if (DPAA_VERSION >= 11)
 #if defined(CONFIG_COMPAT)
         case FM_PORT_IOC_VSP_ALLOC_COMPAT:
 #endif
diff --git a/drivers/net/ethernet/freescale/dpa/NetCommSw/src/wrapper/lnxwrp_ioctls_fm_compat.c b/drivers/net/ethernet/freescale/dpa/NetCommSw/src/wrapper/lnxwrp_ioctls_fm_compat.c
index a3da35c..c4c6a35 100644
--- a/drivers/net/ethernet/freescale/dpa/NetCommSw/src/wrapper/lnxwrp_ioctls_fm_compat.c
+++ b/drivers/net/ethernet/freescale/dpa/NetCommSw/src/wrapper/lnxwrp_ioctls_fm_compat.c
@@ -815,6 +815,7 @@ void compat_copy_fm_port_pcd_modify_tree(
         id->obj = compat_pcd_id2ptr(compat_id->obj);
 }
 
+#if (DPAA_VERSION >= 11)
 void compat_copy_fm_port_vsp_alloc_params(
         ioc_compat_fm_port_vsp_alloc_params_t *compat_param,
         ioc_fm_port_vsp_alloc_params_t *param,
@@ -829,6 +830,7 @@ void compat_copy_fm_port_vsp_alloc_params(
         param->p_fm_tx_port = compat_pcd_id2ptr(compat_param->p_fm_tx_port);
     }
 }
+#endif /* (DPAA_VERSION >= 11) */
 
 void compat_copy_fm_pcd_net_env(
         ioc_compat_fm_pcd_net_env_params_t *compat_param,
diff --git a/drivers/net/ethernet/freescale/dpa/NetCommSw/src/wrapper/lnxwrp_ioctls_fm_compat.h b/drivers/net/ethernet/freescale/dpa/NetCommSw/src/wrapper/lnxwrp_ioctls_fm_compat.h
index 6a42c1f..e8e6677 100644
--- a/drivers/net/ethernet/freescale/dpa/NetCommSw/src/wrapper/lnxwrp_ioctls_fm_compat.h
+++ b/drivers/net/ethernet/freescale/dpa/NetCommSw/src/wrapper/lnxwrp_ioctls_fm_compat.h
@@ -460,7 +460,7 @@ typedef struct ioc_compat_fm_pcd_manip_params_t {
     compat_uptr_t                                 id;
 } ioc_compat_fm_pcd_manip_params_t;
 
-#if DPAA_VERSION >= 11
+#if (DPAA_VERSION >= 11)
 typedef struct ioc_compat_fm_pcd_frm_replic_group_params_t {
 	uint8_t                     max_num_of_entries;
 	uint8_t                     num_of_entries;
@@ -494,7 +494,6 @@ typedef struct ioc_compat_fm_vsp_params_t {
     compat_uptr_t       id;                 /**< return value */
 } ioc_compat_fm_vsp_params_t;
 
-
 typedef struct ioc_compat_fm_buf_pool_depletion_params_t {
     compat_uptr_t p_fm_vsp;
     ioc_fm_buf_pool_depletion_t fm_buf_pool_depletion;
@@ -514,7 +513,7 @@ typedef struct ioc_compat_fm_vsp_prs_result_params_t {
     compat_uptr_t p_fm_vsp;
     compat_uptr_t p_data;
 } ioc_compat_fm_vsp_prs_result_params_t;
-#endif /* DPAA_VERSION >= 11 */
+#endif /* (DPAA_VERSION >= 11) */
 
 typedef struct ioc_compat_fm_ctrl_mon_counters_params_t {
     uint8_t     fm_ctrl_index;
@@ -598,10 +597,12 @@ void compat_copy_fm_port_pcd(
         ioc_fm_port_pcd_params_t *param,
         uint8_t compat);
 
+#if (DPAA_VERSION >= 11)
 void compat_copy_fm_port_vsp_alloc_params(
         ioc_compat_fm_port_vsp_alloc_params_t *compat_param,
         ioc_fm_port_vsp_alloc_params_t *param,
         uint8_t compat);
+#endif /* (DPAA_VERSION >= 11) */
 
 void compat_copy_fm_pcd_net_env(
         ioc_compat_fm_pcd_net_env_params_t *compat_param,
diff --git a/include/linux/fmd/Peripherals/fm_ioctls.h b/include/linux/fmd/Peripherals/fm_ioctls.h
index 5c24646..d1b779b 100644
--- a/include/linux/fmd/Peripherals/fm_ioctls.h
+++ b/include/linux/fmd/Peripherals/fm_ioctls.h
@@ -279,12 +279,13 @@ typedef struct ioc_fm_buf_pool_depletion_t {
 #endif /* (DPAA_VERSION >= 11) */
 } ioc_fm_buf_pool_depletion_t;
 
+#if (DPAA_VERSION >= 11)
 typedef struct ioc_fm_buf_pool_depletion_params_t {
     void        *p_fm_vsp;
     ioc_fm_buf_pool_depletion_t fm_buf_pool_depletion;
 } ioc_fm_buf_pool_depletion_params_t;
+#endif /* (DPAA_VERSION >= 11) */
 
-#if (DPAA_VERSION >= 11)
 typedef struct ioc_fm_buffer_prefix_content_t {
     uint16_t    priv_data_size;       /**< Number of bytes to be left at the beginning
                                          of the external buffer; Note that the private-area will
@@ -314,6 +315,7 @@ typedef struct ioc_fm_buffer_prefix_content_params_t {
     ioc_fm_buffer_prefix_content_t fm_buffer_prefix_content;
 } ioc_fm_buffer_prefix_content_params_t;
 
+#if (DPAA_VERSION >= 11)
 typedef struct ioc_fm_vsp_config_no_sg_params_t {
     void        *p_fm_vsp;
     bool        no_sg;
diff --git a/include/linux/fmd/Peripherals/fm_pcd_ioctls.h b/include/linux/fmd/Peripherals/fm_pcd_ioctls.h
index c7d2afd..113feb1 100644
--- a/include/linux/fmd/Peripherals/fm_pcd_ioctls.h
+++ b/include/linux/fmd/Peripherals/fm_pcd_ioctls.h
@@ -2112,7 +2112,6 @@ typedef struct ioc_fm_pcd_frm_replic_member_params_t {
     ioc_fm_pcd_frm_replic_member_t member;
     ioc_fm_pcd_cc_next_engine_params_t next_engine_params;
 } ioc_fm_pcd_frm_replic_member_params_t;
-
 #endif /* DPAA_VERSION >= 11 */
 
 /**************************************************************************//**
diff --git a/include/linux/fmd/Peripherals/fm_port_ioctls.h b/include/linux/fmd/Peripherals/fm_port_ioctls.h
index 4f9de8e..a357662 100644
--- a/include/linux/fmd/Peripherals/fm_port_ioctls.h
+++ b/include/linux/fmd/Peripherals/fm_port_ioctls.h
@@ -852,7 +852,6 @@ typedef struct ioc_fm_port_mac_statistics_t {
 *//***************************************************************************/
 #define FM_PORT_IOC_GET_MAC_STATISTICS        _IOR(FM_IOC_TYPE_BASE, FM_PORT_IOC_NUM(41), ioc_fm_port_mac_statistics_t)
 
-#if (DPAA_VERSION >= 11)
 /**************************************************************************//**
  @Function      FM_PORT_ConfigBufferPrefixContent
 
@@ -880,6 +879,7 @@ typedef struct ioc_fm_port_mac_statistics_t {
 *//***************************************************************************/
 #define FM_PORT_IOC_CONFIG_BUFFER_PREFIX_CONTENT _IOW(FM_IOC_TYPE_BASE, FM_PORT_IOC_NUM(39), ioc_fm_buffer_prefix_content_t)
 
+#if (DPAA_VERSION >= 11)
 typedef struct ioc_fm_port_vsp_alloc_params_t {
     uint8_t     num_of_profiles;          /**< Number of Virtual Storage Profiles */
     uint8_t     dflt_relative_id;         /**< The default Virtual-Storage-Profile-id dedicated to Rx/OP port
-- 
1.7.9.7

