From 25bc01dd26ab5ed033c5ee0a3056aba0ecefa67c Mon Sep 17 00:00:00 2001
From: Kevin Hao <kexin.hao@windriver.com>
Date: Mon, 7 Jan 2013 10:48:30 +0800
Subject: [PATCH 001/227] powerpc: apply the mfcrf workaround to all the
 embedded ppc64 cores

The patch (powerpc: update compilation flags to support e5500
instructions) introduces a workaround for the toolchain mfcrf issue
for the fsl e5500 core. But this issue apples to all the embedded ppc64
cores. So make the kernel option name more general and enable it for
all the book3e 64 cores.

Signed-off-by: Kevin Hao <kexin.hao@windriver.com>
---
 arch/powerpc/Makefile               |    2 +-
 arch/powerpc/platforms/85xx/Kconfig |    6 +++---
 2 files changed, 4 insertions(+), 4 deletions(-)

diff --git a/arch/powerpc/Makefile b/arch/powerpc/Makefile
index 311e6c0..48a2666 100644
--- a/arch/powerpc/Makefile
+++ b/arch/powerpc/Makefile
@@ -133,7 +133,7 @@ endif
 cpu-as-$(CONFIG_4xx)		+= -Wa,-m405
 cpu-as-$(CONFIG_ALTIVEC)	+= -Wa,-maltivec
 cpu-as-$(CONFIG_E500)		+= -Wa,-me500
-cpu-as-$(CONFIG_WORKAROUND_E5500_MFCR) += -mno-mfcrf
+cpu-as-$(CONFIG_WORKAROUND_BOOK3E_64_MFCR) += -mno-mfcrf
 cpu-as-$(CONFIG_E200)		+= -Wa,-me200
 
 KBUILD_AFLAGS += $(cpu-as-y)
diff --git a/arch/powerpc/platforms/85xx/Kconfig b/arch/powerpc/platforms/85xx/Kconfig
index 94e35a4..e669294 100644
--- a/arch/powerpc/platforms/85xx/Kconfig
+++ b/arch/powerpc/platforms/85xx/Kconfig
@@ -287,12 +287,12 @@ config P5020_DS
 	select HAS_FSL_QBMAN
 	select HAS_FSL_PME
 	select FSL_HYDRA_DS_MDIO if PHYLIB
-	select WORKAROUND_E5500_MFCR
 	help
 	  This option enables support for the P5020 DS board
 
-config WORKAROUND_E5500_MFCR
-	bool
+config WORKAROUND_BOOK3E_64_MFCR
+	def_bool y
+	depends on PPC_BOOK3E_64
 
 config P5040_DS
 	bool "Freescale P5040 DS"
-- 
1.7.9.7

