From 8dc47391f698700bae6288578209459b383fce0a Mon Sep 17 00:00:00 2001
From: Stefan Szabo <szbs001@freescale.com>
Date: Thu, 25 Oct 2012 18:58:01 +0300
Subject: [PATCH 115/227] Sync'ed ioctls w/ changes in NCSW *_ext.h headers

Signed-off-by: Stefan Szabo <szbs001@freescale.com>
[Kevin: Original patch taken from fsl sdk 1.3.1
QorIQ-SDK-V1.3.1-SOURCE-20121220-yocto.iso.]
Signed-off-by: Kevin Hao <kexin.hao@windriver.com>
---
 .../dpa/NetCommSw/inc/Peripherals/fm_pcd_ext.h     |    2 +-
 .../dpa/NetCommSw/src/wrapper/lnxwrp_ioctls_fm.c   |    4 --
 include/linux/fmd/Peripherals/fm_ioctls.h          |   71 --------------------
 include/linux/fmd/Peripherals/fm_pcd_ioctls.h      |   36 ++++++----
 include/linux/fmd/Peripherals/fm_port_ioctls.h     |   43 +-----------
 include/linux/fmd/net_ioctls.h                     |   11 +++
 6 files changed, 37 insertions(+), 130 deletions(-)

diff --git a/drivers/net/ethernet/freescale/dpa/NetCommSw/inc/Peripherals/fm_pcd_ext.h b/drivers/net/ethernet/freescale/dpa/NetCommSw/inc/Peripherals/fm_pcd_ext.h
index a21fbe0..47a2bd1 100644
--- a/drivers/net/ethernet/freescale/dpa/NetCommSw/inc/Peripherals/fm_pcd_ext.h
+++ b/drivers/net/ethernet/freescale/dpa/NetCommSw/inc/Peripherals/fm_pcd_ext.h
@@ -2195,7 +2195,7 @@ typedef struct t_FmPcdManipFragIpParams {
                                                              If disabled, the Scatter/Gather buffer will be allocated from the same pool as the
                                                              received frame's buffer. */
     uint8_t                     sgBpid;                 /**< Scatter/Gather buffer pool id;
-                                                             This parameters is relevant when 'sgBpidEn=TRUE';
+                                                             This parameter is relevant when 'sgBpidEn=TRUE';
                                                              Same LIODN number is used for these buffers as for the received frames buffers, so buffers
                                                              of this pool need to be allocated in the same memory area as the received buffers.
                                                              If the received buffers arrive from different sources, the Scatter/Gather BP id should be
diff --git a/drivers/net/ethernet/freescale/dpa/NetCommSw/src/wrapper/lnxwrp_ioctls_fm.c b/drivers/net/ethernet/freescale/dpa/NetCommSw/src/wrapper/lnxwrp_ioctls_fm.c
index a411a65..886e508 100644
--- a/drivers/net/ethernet/freescale/dpa/NetCommSw/src/wrapper/lnxwrp_ioctls_fm.c
+++ b/drivers/net/ethernet/freescale/dpa/NetCommSw/src/wrapper/lnxwrp_ioctls_fm.c
@@ -148,10 +148,6 @@
 #endif
 #endif
 
-#if CMP_IOC_DEFINE(FM_PCD_MAX_NUM_OF_CC_NODES)
-#error Error: please synchronize IOC_ defines!
-#endif
-
 #if CMP_IOC_DEFINE(FM_PCD_MAX_NUM_OF_CC_TREES)
 #error Error: please synchronize IOC_ defines!
 #endif
diff --git a/include/linux/fmd/Peripherals/fm_ioctls.h b/include/linux/fmd/Peripherals/fm_ioctls.h
index 437eb10..975bb41 100644
--- a/include/linux/fmd/Peripherals/fm_ioctls.h
+++ b/include/linux/fmd/Peripherals/fm_ioctls.h
@@ -82,77 +82,6 @@ typedef enum ioc_fm_port_type {
 
 
 /**************************************************************************//**
- @Collection   FM Frame descriptor macros
-*//***************************************************************************/
-#define FM_FD_CMD_FCO                   0x80000000  /**< Frame queue Context Override */
-#define FM_FD_CMD_RPD                   0x40000000  /**< Read Prepended Data */
-#define FM_FD_CMD_UPD                   0x20000000  /**< Update Prepended Data */
-#define FM_FD_CMD_DTC                   0x10000000  /**< Do L4 Checksum */
-#define FM_FD_CMD_DCL4C                 0x10000000  /**< Didn't calculate L4 Checksum */
-#define FM_FD_CMD_CFQ                   0x00ffffff  /**< Confirmation Frame Queue */
-
-#define FM_FD_ERR_UNSUPPORTED_FORMAT    0x04000000  /**< Not for Rx-Port! Unsupported Format */
-#define FM_FD_ERR_LENGTH                0x02000000  /**< Not for Rx-Port! Length Error */
-#define FM_FD_ERR_DMA                   0x01000000  /**< DMA Data error */
-
-#define FM_FD_IPR                       0x00000001  /**< IPR frame (not error) */
-
-#define FM_FD_ERR_IPR_NCSP              (0x00100000 | FM_FD_IPR)    /**< IPR non-consistent-sp */
-#define FM_FD_ERR_IPR                   (0x00200000 | FM_FD_IPR)    /**< IPR error */
-#define FM_FD_ERR_IPR_TO                (0x00300000 | FM_FD_IPR)    /**< IPR timeout */
-
-#ifdef FM_CAPWAP_SUPPORT
-#define FM_FD_ERR_CRE                   0x00200000
-#define FM_FD_ERR_CHE                   0x00100000
-#endif /* FM_CAPWAP_SUPPORT */
-
-#define FM_FD_ERR_PHYSICAL              0x00080000  /**< Rx FIFO overflow, FCS error, code error, running disparity
-                                                         error (SGMII and TBI modes), FIFO parity error. PHY
-                                                         Sequence error, PHY error control character detected. */
-#define FM_FD_ERR_SIZE                  0x00040000  /**< Frame too long OR Frame size exceeds max_length_frame  */
-#define FM_FD_ERR_CLS_DISCARD           0x00020000  /**< classification discard */
-#define FM_FD_ERR_EXTRACTION            0x00008000  /**< Extract Out of Frame */
-#define FM_FD_ERR_NO_SCHEME             0x00004000  /**< No Scheme Selected */
-#define FM_FD_ERR_KEYSIZE_OVERFLOW      0x00002000  /**< Keysize Overflow */
-#define FM_FD_ERR_COLOR_RED             0x00000800  /**< Frame color is red */
-#define FM_FD_ERR_COLOR_YELLOW          0x00000400  /**< Frame color is yellow */
-#define FM_FD_ERR_ILL_PLCR              0x00000200  /**< Illegal Policer Profile selected */
-#define FM_FD_ERR_PLCR_FRAME_LEN        0x00000100  /**< Policer frame length error */
-#define FM_FD_ERR_PRS_TIMEOUT           0x00000080  /**< Parser Time out Exceed */
-#define FM_FD_ERR_PRS_ILL_INSTRUCT      0x00000040  /**< Invalid Soft Parser instruction */
-#define FM_FD_ERR_PRS_HDR_ERR           0x00000020  /**< Header error was identified during parsing */
-#define FM_FD_ERR_BLOCK_LIMIT_EXCEEDED  0x00000008  /**< Frame parsed beyind 256 first bytes */
-
-#define FM_FD_TX_STATUS_ERR_MASK        (FM_FD_ERR_UNSUPPORTED_FORMAT   | \
-                                         FM_FD_ERR_LENGTH               | \
-                                         FM_FD_ERR_DMA) /**< TX Error FD bits */
-
-#define FM_FD_RX_STATUS_ERR_MASK        (FM_FD_ERR_UNSUPPORTED_FORMAT   | \
-                                         FM_FD_ERR_LENGTH               | \
-                                         FM_FD_ERR_DMA                  | \
-                                         FM_FD_ERR_IPR                  | \
-                                         FM_FD_ERR_IPR_TO               | \
-                                         FM_FD_ERR_IPR_NCSP             | \
-                                         FM_FD_ERR_PHYSICAL             | \
-                                         FM_FD_ERR_SIZE                 | \
-                                         FM_FD_ERR_CLS_DISCARD          | \
-                                         FM_FD_ERR_COLOR_RED            | \
-                                         FM_FD_ERR_COLOR_YELLOW         | \
-                                         FM_FD_ERR_ILL_PLCR             | \
-                                         FM_FD_ERR_PLCR_FRAME_LEN       | \
-                                         FM_FD_ERR_EXTRACTION           | \
-                                         FM_FD_ERR_NO_SCHEME            | \
-                                         FM_FD_ERR_KEYSIZE_OVERFLOW     | \
-                                         FM_FD_ERR_PRS_TIMEOUT          | \
-                                         FM_FD_ERR_PRS_ILL_INSTRUCT     | \
-                                         FM_FD_ERR_PRS_HDR_ERR          | \
-                                         FM_FD_ERR_BLOCK_LIMIT_EXCEEDED) /**< RX Error FD bits */
-
-#define FM_FD_RX_STATUS_ERR_NON_FM      0x00400000  /**< non Frame-Manager error */
-/* @} */
-
-
-/**************************************************************************//**
  @Group         lnx_ioctl_FM_lib_grp FM library
 
  @Description   FM API functions, definitions and enums
diff --git a/include/linux/fmd/Peripherals/fm_pcd_ioctls.h b/include/linux/fmd/Peripherals/fm_pcd_ioctls.h
index 2d437a1..c90d8fb 100644
--- a/include/linux/fmd/Peripherals/fm_pcd_ioctls.h
+++ b/include/linux/fmd/Peripherals/fm_pcd_ioctls.h
@@ -416,7 +416,6 @@ TODO: unused IOCTL
  @Collection    Definitions of coarse classification parameters as required by KeyGen
                 (when coarse classification is the next engine after this scheme).
 *//***************************************************************************/
-#define IOC_FM_PCD_MAX_NUM_OF_CC_NODES              255
 #define IOC_FM_PCD_MAX_NUM_OF_CC_TREES              8
 #define IOC_FM_PCD_MAX_NUM_OF_CC_GROUPS             16
 #define IOC_FM_PCD_MAX_NUM_OF_CC_UNITS              4
@@ -786,10 +785,10 @@ typedef enum ioc_fm_pcd_manip_hdr_custom_ip_replace {
  @Description   Enumeration type for selecting type of header removal
 *//***************************************************************************/
 typedef enum ioc_fm_pcd_manip_hdr_rmv_by_hdr_type {
+    e_IOC_FM_PCD_MANIP_RMV_BY_HDR_SPECIFIC_L2 = 0       /**< Specific L2 fields removal */
 #ifdef FM_CAPWAP_SUPPORT
     e_IOC_FM_PCD_MANIP_RMV_BY_HDR_FROM_START,           /**< Locate from data that is not the header */
 #endif /* FM_CAPWAP_SUPPORT */
-    e_IOC_FM_PCD_MANIP_RMV_BY_HDR_SPECIFIC_L2           /**< Specific L2 fields removal */
 } ioc_fm_pcd_manip_hdr_rmv_by_hdr_type;
 
 /**************************************************************************//**
@@ -849,9 +848,13 @@ typedef enum ioc_fm_pcd_cc_stats_mode {
                 is larger than MTU but its DF (Don't Fragment) bit is set.
 *//***************************************************************************/
 typedef enum ioc_fm_pcd_manip_dont_frag_action {
-    e_IOC_FM_PCD_MANIP_ENQ_TO_ERR_Q_OR_DISCARD_PACKET = 0,  /**< Discard packet */
-    e_IOC_FM_PCD_MANIP_FRAGMENT_PACKECT,                    /**< Fragment packet and continue normal processing */
-    e_IOC_FM_PCD_MANIP_CONTINUE_WITHOUT_FRAG                /**< Continue normal processing without fragmenting the packet */
+    e_IOC_FM_PCD_MANIP_DISCARD_PACKET = 0,      /**< Discard packet */
+    e_IOC_FM_PCD_MANIP_ENQ_TO_ERR_Q_OR_DISCARD_PACKET =  e_IOC_FM_PCD_MANIP_DISCARD_PACKET,
+                                                /**< Obsolete, cannot enqueue to error queue;
+                                                     In practice, selects to discard packets;
+                                                     Will be removed in the future */
+    e_IOC_FM_PCD_MANIP_FRAGMENT_PACKECT,        /**< Fragment packet and continue normal processing */
+    e_IOC_FM_PCD_MANIP_CONTINUE_WITHOUT_FRAG    /**< Continue normal processing without fragmenting the packet */
 } ioc_fm_pcd_manip_dont_frag_action;
 
 /**************************************************************************//**
@@ -882,6 +885,7 @@ typedef union ioc_fm_pcd_fields_u {
     ioc_header_field_llc_snap_t         llc_snap;       /**< LLC SNAP               */
     ioc_header_field_pppoe_t            pppoe;          /**< PPPoE                  */
     ioc_header_field_mpls_t             mpls;           /**< MPLS                   */
+    ioc_header_field_ip_t               ip;             /**< IP                     */
     ioc_header_field_ipv4_t             ipv4;           /**< IPv4                   */
     ioc_header_field_ipv6_t             ipv6;           /**< IPv6                   */
     ioc_header_field_udp_t              udp;            /**< UDP                    */
@@ -1326,7 +1330,7 @@ typedef struct ioc_fm_pcd_cc_next_engine_params_t {
     void                                        *manip_id;      /**< Handle to Manipulation object.
                                                                      Relevant if next engine is of type result
                                                                      (e_IOC_FM_PCD_PLCR, e_IOC_FM_PCD_KG, e_IOC_FM_PCD_DONE) */
-    bool                                        statistics_en;   /**< If TRUE, statistics counters are incremented
+    bool                                        statistics_en;  /**< If TRUE, statistics counters are incremented
                                                                       for each frame passing through this
                                                                       Coarse Classification entry. */
 } ioc_fm_pcd_cc_next_engine_params_t;
@@ -1373,11 +1377,16 @@ typedef struct ioc_keys_params_t {
                                                      initial keys do not contain masks, or if the node was initialized
                                                      as 'empty' (without keys); this will allow user to add keys with
                                                      masks at runtime. */
-    ioc_fm_pcd_cc_stats_mode    statistics_mode;/**< If not e_IOC_FM_PCD_CC_STATS_MODE_NONE, the required structures for
-                                                     the requested statistics mode will be allocated according to 'max_num_of_keys'. */
+    ioc_fm_pcd_cc_stats_mode    statistics_mode;/**< Determines the supported statistics mode for all node's keys.
+                                                     To enable statistics gathering, statistics should be enabled per
+                                                     every key, using 'statistics_en' in next engine parameters structure
+                                                     of that key;
+                                                     If 'max_num_of_keys' is set, all required structures will be
+                                                     preallocated for all keys. */
 #if (DPAA_VERSION >= 11)
     uint16_t                    frame_length_ranges[IOC_FM_PCD_CC_STATS_MAX_NUM_OF_FLR];
-                                                /**< Relevant only for 'e_IOC_FM_PCD_CC_STATS_MODE_RMON' statistics mode.
+                                                /**< Relevant only for 'RMON' statistics mode
+                                                     (this feature is supported only on B4860 device);
                                                      Holds a list of programmable thresholds. For each received frame,
                                                      its length in bytes is examined against these range thresholds and
                                                      the appropriate counter is incremented by 1. For example, to belong
@@ -1559,9 +1568,10 @@ typedef struct ioc_fm_pcd_plcr_profile_params_t {
     ioc_fm_pcd_engine                           next_engine_on_red;         /**< Next engine for red-colored frames */
     ioc_fm_pcd_plcr_next_engine_params_u        params_on_red;              /**< Next engine parameters for red-colored frames  */
 
-    bool                                        trap_profile_on_flow_A;     /**< Trap on flow A */
-    bool                                        trap_profile_on_flow_B;     /**< Trap on flow B */
-    bool                                        trap_profile_on_flow_C;     /**< Trap on flow C */
+    bool                                        trap_profile_on_flow_A;     /**< Obsolete - do not use */
+    bool                                        trap_profile_on_flow_B;     /**< Obsolete - do not use */
+    bool                                        trap_profile_on_flow_C;     /**< Obsolete - do not use */
+
     void                                        *id;                        /**< output parameter; Returns the profile Id to be used */
 } ioc_fm_pcd_plcr_profile_params_t;
 
@@ -1675,6 +1685,7 @@ typedef struct ioc_fm_pcd_manip_frag_ip_params_t {
                                                                  If disabled, the Scatter/Gather buffer will be allocated from the same pool as the
                                                                  received frame's buffer. */
     uint8_t                     sg_bpid;                    /**< Scatter/Gather buffer pool id;
+                                                                 This parameter is relevant when 'sg_bpid_en=TRUE';
                                                                  Same LIODN number is used for these buffers as for the received frames buffers, so buffers
                                                                  of this pool need to be allocated in the same memory area as the received buffers.
                                                                  If the received buffers arrive from different sources, the Scatter/Gather BP id should be
@@ -1700,6 +1711,7 @@ typedef struct ioc_fm_pcd_manip_reassem_ip_params_t {
     uint8_t                         relative_scheme_id[2];    /**< Partition relative scheme id:
                                                                  relativeSchemeId[0] -  Relative scheme ID for IPV4 Reassembly manipulation;
                                                                  relativeSchemeId[1] -  Relative scheme ID for IPV6 Reassembly manipulation;
+                                                                 NOTE: The following comment is relevant only for FMAN v2 devices:
                                                                  Relative scheme ID for IPv4/IPv6 Reassembly manipulation must be smaller than
                                                                  the user schemes id to ensure that the reassembly's schemes will be first match.
                                                                  The remaining schemes, if defined, should have higher relative scheme ID. */
diff --git a/include/linux/fmd/Peripherals/fm_port_ioctls.h b/include/linux/fmd/Peripherals/fm_port_ioctls.h
index 926d26b..226f3fc 100644
--- a/include/linux/fmd/Peripherals/fm_port_ioctls.h
+++ b/include/linux/fmd/Peripherals/fm_port_ioctls.h
@@ -112,52 +112,11 @@ typedef enum ioc_fm_port_pcd_support {
 } ioc_fm_port_pcd_support;
 
 
-
-/**************************************************************************//**
- @Collection    General FM Port defines
-*//***************************************************************************/
-
-/* @} */
-
 /**************************************************************************//**
  @Collection   FM Frame error
 *//***************************************************************************/
-typedef uint32_t    ioc_fm_port_frame_err_select_t; /**< typedef for defining Frame Descriptor errors */
-
-#define IOC_FM_PORT_FRM_ERR_UNSUPPORTED_FORMAT      FM_FD_ERR_UNSUPPORTED_FORMAT    /**< Not for Rx-Port! Unsupported Format */
-#define IOC_FM_PORT_FRM_ERR_LENGTH                  FM_FD_ERR_LENGTH                /**< Not for Rx-Port! Length Error */
-#define IOC_FM_PORT_FRM_ERR_DMA                     FM_FD_ERR_DMA                   /**< DMA Data error */
-#ifdef FM_DISABLE_SEC_ERRORS
-#define IOC_FM_PORT_FRM_ERR_NON_FM                  FM_FD_RX_STATUS_ERR_NON_FM      /*< Non Frame-Manager error;
-                                                                                        probably come from SEC that was chained to FM */
-#endif /* FM_DISABLE_SEC_ERRORS */
-
-#define IOC_FM_PORT_FRM_ERR_IPRE                    (FM_FD_ERR_IPR & ~FM_FD_IPR)    /**< IPR error */
-#define IOC_FM_PORT_FRM_ERR_IPR_TO                  (FM_FD_ERR_IPR_TO & ~FM_FD_IPR) /**< IPR timeout */
-#define IOC_FM_PORT_FRM_ERR_IPFE                    FM_FD_ERR_IPF                   /**< IPF error */
-
-#ifdef FM_CAPWAP_SUPPORT
-#define IOC_FM_PORT_FRM_ERR_CRE                     FM_FD_ERR_CRE
-#define IOC_FM_PORT_FRM_ERR_CHE                     FM_FD_ERR_CHE
-#endif /* FM_CAPWAP_SUPPORT */
+typedef uint32_t    ioc_fm_port_frame_err_select_t;     /**< typedef for defining Frame Descriptor errors */
 
-#define IOC_FM_PORT_FRM_ERR_PHYSICAL                FM_FD_ERR_PHYSICAL              /**< Rx FIFO overflow, FCS error, code error, running disparity
-                                                                                         error (SGMII and TBI modes), FIFO parity error, PHY
-                                                                                         Sequence error, PHY error control character detected. */
-#define IOC_FM_PORT_FRM_ERR_SIZE                    FM_FD_ERR_SIZE                  /**< Frame too long OR Frame size exceeds max_length_frame  */
-#define IOC_FM_PORT_FRM_ERR_CLS_DISCARD             FM_FD_ERR_CLS_DISCARD           /**< classification discard */
-#define IOC_FM_PORT_FRM_ERR_EXTRACTION              FM_FD_ERR_EXTRACTION            /**< Extract Out of Frame */
-#define IOC_FM_PORT_FRM_ERR_NO_SCHEME               FM_FD_ERR_NO_SCHEME             /**< No Scheme Selected */
-#define IOC_FM_PORT_FRM_ERR_KEYSIZE_OVERFLOW        FM_FD_ERR_KEYSIZE_OVERFLOW      /**< Keysize Overflow */
-#define IOC_FM_PORT_FRM_ERR_COLOR_RED               FM_FD_ERR_COLOR_RED             /**< Frame color is red */
-#define IOC_FM_PORT_FRM_ERR_COLOR_YELLOW            FM_FD_ERR_COLOR_YELLOW          /**< Frame color is yellow */
-#define IOC_FM_PORT_FRM_ERR_ILL_PLCR                FM_FD_ERR_ILL_PLCR              /**< Illegal Policer Profile selected */
-#define IOC_FM_PORT_FRM_ERR_PLCR_FRAME_LEN          FM_FD_ERR_PLCR_FRAME_LEN        /**< Policer frame length error */
-#define IOC_FM_PORT_FRM_ERR_PRS_TIMEOUT             FM_FD_ERR_PRS_TIMEOUT           /**< Parser Time out Exceed */
-#define IOC_FM_PORT_FRM_ERR_PRS_ILL_INSTRUCT        FM_FD_ERR_PRS_ILL_INSTRUCT      /**< Invalid Soft Parser instruction */
-#define IOC_FM_PORT_FRM_ERR_PRS_HDR_ERR             FM_FD_ERR_PRS_HDR_ERR           /**< Header error was identified during parsing */
-#define IOC_FM_PORT_FRM_ERR_BLOCK_LIMIT_EXCEEDED    FM_FD_ERR_BLOCK_LIMIT_EXCEEDED  /**< Frame parsed beyind 256 first bytes */
-#define IOC_FM_PORT_FRM_ERR_PROCESS_TIMEOUT         0x00000001                      /**< FPM Frame Processing Timeout Exceeded */
 /* @} */
 
 
diff --git a/include/linux/fmd/net_ioctls.h b/include/linux/fmd/net_ioctls.h
index aef7cb8..98cc01c 100644
--- a/include/linux/fmd/net_ioctls.h
+++ b/include/linux/fmd/net_ioctls.h
@@ -85,6 +85,16 @@ typedef uint8_t ioc_header_field_eth_t;
 
 #define IOC_NET_HEADER_FIELD_ETH_ADDR_SIZE                 6
 
+
+typedef uint16_t ioc_header_field_ip_t;
+
+#define IOC_NET_HEADER_FIELD_IP_VER                         (1)
+#define IOC_NET_HEADER_FIELD_IP_DSCP                        (IOC_NET_HEADER_FIELD_IP_VER << 2)
+#define IOC_NET_HEADER_FIELD_IP_ECN                         (IOC_NET_HEADER_FIELD_IP_VER << 3)
+#define IOC_NET_HEADER_FIELD_IP_PROTO                       (IOC_NET_HEADER_FIELD_IP_VER << 4)
+
+#define IOC_NET_HEADER_FIELD_IP_PROTO_SIZE                  1
+
 typedef uint16_t ioc_header_field_ipv4_t;
 
 #define IOC_NET_HEADER_FIELD_IPv4_VER                       (1)
@@ -369,6 +379,7 @@ typedef enum {
     e_IOC_NET_HEADER_TYPE_VLAN,
     e_IOC_NET_HEADER_TYPE_IPv4,
     e_IOC_NET_HEADER_TYPE_IPv6,
+    e_IOC_NET_HEADER_TYPE_IP,
     e_IOC_NET_HEADER_TYPE_TCP,
     e_IOC_NET_HEADER_TYPE_UDP,
     e_IOC_NET_HEADER_TYPE_IPHC,
-- 
1.7.9.7

