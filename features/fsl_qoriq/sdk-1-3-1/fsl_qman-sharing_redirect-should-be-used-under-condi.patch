From 7a39922faba854838e87b0ba9184ee44a100b832 Mon Sep 17 00:00:00 2001
From: Hai-Ying Wang <Haiying.Wang@freescale.com>
Date: Fri, 2 Nov 2012 02:39:01 +0000
Subject: [PATCH 123/227] fsl_qman: sharing_redirect should be used under
 condition

when CONFIG_FSL_DPA_PORTAL_SHARE is defined.

Signed-off-by: Haiying Wang <Haiying.Wang@freescale.com>
Signed-off-by: Andy Fleming <afleming@freescale.com>
[Kevin: Original patch taken from fsl sdk 1.3.1
QorIQ-SDK-V1.3.1-SOURCE-20121220-yocto.iso.]
Signed-off-by: Kevin Hao <kexin.hao@windriver.com>
---
 drivers/staging/fsl_qbman/qman_high.c |    2 ++
 1 file changed, 2 insertions(+)

diff --git a/drivers/staging/fsl_qbman/qman_high.c b/drivers/staging/fsl_qbman/qman_high.c
index a762ae9..c2f90ef 100644
--- a/drivers/staging/fsl_qbman/qman_high.c
+++ b/drivers/staging/fsl_qbman/qman_high.c
@@ -918,7 +918,9 @@ u16 qman_affine_channel(int cpu)
 {
 	if (cpu < 0) {
 		struct qman_portal *portal = get_raw_affine_portal();
+#ifdef CONFIG_FSL_DPA_PORTAL_SHARE
 		BUG_ON(portal->sharing_redirect);
+#endif
 		cpu = portal->config->public_cfg.cpu;
 		put_affine_portal();
 	}
-- 
1.7.9.7

