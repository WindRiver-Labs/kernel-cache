From 23064f9557454512d05f062deaa1207d3e1cabcb Mon Sep 17 00:00:00 2001
From: Jiang Yutang <b14898@freescale.com>
Date: Wed, 29 Aug 2012 09:17:19 +0800
Subject: [PATCH 07/19] There is no elbc compatible for p5040 in driver, this
 will cause lbc on p5040 can not be probed, so add the
 compatible for p5040.

Signed-off-by: Jiang Yutang <b14898@freescale.com>
[Yongli: Original patch taken from FSL
    QorIQ-SDK-V1.2-SOURCE-20120614-yocto.iso image]
Integrated-by: Yongli He <yongli.he@windriver.com>
---
 arch/powerpc/sysdev/fsl_lbc.c |    7 +++++--
 1 file changed, 5 insertions(+), 2 deletions(-)

diff --git a/arch/powerpc/sysdev/fsl_lbc.c b/arch/powerpc/sysdev/fsl_lbc.c
index 1d42067..d8f362b 100644
--- a/arch/powerpc/sysdev/fsl_lbc.c
+++ b/arch/powerpc/sysdev/fsl_lbc.c
@@ -49,7 +49,8 @@ u32 fsl_lbc_addr(phys_addr_t addr_base)
 	u32 addr = addr_base & 0xffff8000;
 
 	if (of_device_is_compatible(np, "fsl,elbc") ||
-			of_device_is_compatible(np, "fsl,p3041-rev1.0-elbc"))
+			of_device_is_compatible(np, "fsl,p5020-rev1.0-elbc") ||
+			of_device_is_compatible(np, "fsl,p5040-rev1.0-elbc"))
 		return addr;
 
 	return addr | ((addr_base & 0x300000000ull) >> 19);
@@ -200,7 +201,8 @@ static int __devinit fsl_lbc_ctrl_init(struct fsl_lbc_ctrl *ctrl,
 
 	/* Set the monitor timeout value to the maximum for erratum A001 */
 	if (of_device_is_compatible(node, "fsl,elbc") ||
-			of_device_is_compatible(node, "fsl,p3041-rev1.0-elbc"))
+		of_device_is_compatible(node, "fsl,p5020-rev1.0-elbc") ||
+		of_device_is_compatible(node, "fsl,p5040-rev1.0-elbc"))
 		clrsetbits_be32(&lbc->lbcr, LBCR_BMT, LBCR_BMTPS);
 
 	return 0;
@@ -390,6 +392,7 @@ static const struct of_device_id fsl_lbc_match[] = {
 	{ .compatible = "fsl,p3041-rev1.0-elbc", },
 	{ .compatible = "fsl,p5010-rev1.0-elbc", },
 	{ .compatible = "fsl,p5020-rev1.0-elbc", },
+	{ .compatible = "fsl,p5040-rev1.0-elbc", },
 	{ .compatible = "fsl,pq3-localbus", },
 	{ .compatible = "fsl,pq2-localbus", },
 	{ .compatible = "fsl,pq2pro-localbus", },
-- 
1.7.9.7

