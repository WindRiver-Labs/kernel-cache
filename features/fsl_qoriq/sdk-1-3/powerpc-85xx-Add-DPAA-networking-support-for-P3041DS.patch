From ce5ad6b332042a636fc7ae2ae1defccbfcb445bc Mon Sep 17 00:00:00 2001
From: Tiejun Chen <tiejun.chen@windriver.com>
Date: Wed, 5 Dec 2012 11:12:56 +0800
Subject: [PATCH 22/22] powerpc/85xx: Add DPAA/networking support for P3041DS

Signed-off-by: Kumar Gala <kumar.gala@freescale.com>
[Extracted from QorIQ-SDK-V1.3-SOURCE-20121114-yocto.iso to
rebase on current context.]
Signed-off-by: Tiejun Chen <tiejun.chen@windriver.com>
---
 arch/powerpc/platforms/85xx/p3041_ds.c |   15 ++++++++++++++-
 1 file changed, 14 insertions(+), 1 deletion(-)

diff --git a/arch/powerpc/platforms/85xx/p3041_ds.c b/arch/powerpc/platforms/85xx/p3041_ds.c
index 76dd02c..3700e32 100644
--- a/arch/powerpc/platforms/85xx/p3041_ds.c
+++ b/arch/powerpc/platforms/85xx/p3041_ds.c
@@ -67,6 +67,18 @@ static int __init p3041_ds_probe(void)
 	return 0;
 }
 
+#if defined(CONFIG_PHYLIB) && defined(CONFIG_VITESSE_PHY)
+int vsc824x_add_skew(struct phy_device *phydev);
+#define PHY_ID_VSC8244                  0x000fc6c0
+static int __init board_fixups(void)
+{
+	phy_register_fixup_for_uid(PHY_ID_VSC8244, 0xfffff, vsc824x_add_skew);
+
+	return 0;
+}
+machine_device_initcall(p3041_ds, board_fixups);
+#endif
+
 define_machine(p3041_ds) {
 	.name			= "P3041 DS",
 	.probe			= p3041_ds_probe,
@@ -80,10 +92,11 @@ define_machine(p3041_ds) {
 	.calibrate_decr		= generic_calibrate_decr,
 	.progress		= udbg_progress,
 	.power_save		= e500_idle,
+	.init_early		= corenet_ds_init_early,
 };
 
 machine_arch_initcall(p3041_ds, corenet_ds_publish_pci_device);
-machine_device_initcall(p3041_ds, corenet_ds_publish_devices);
+machine_device_initcall(p3041_ds, declare_of_platform_devices);
 
 #ifdef CONFIG_SWIOTLB
 machine_arch_initcall(p3041_ds, swiotlb_setup_bus_notifier);
-- 
1.7.9.7

