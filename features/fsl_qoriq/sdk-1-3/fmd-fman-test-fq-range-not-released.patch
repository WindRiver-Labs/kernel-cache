From 5da161e402cda97a923dd5425bf54004b185857e Mon Sep 17 00:00:00 2001
From: Sorin Andrei Pistirica <sorin.pistirica@freescale.com>
Date: Fri, 8 Jun 2012 21:18:18 +0000
Subject: [PATCH 027/162] fmd: fman test fq range not released.

fman_test called qman_alloc_fqid_range, but never called
qman_release_fqid_range when test ended, so the fq range
was never released.

Signed-off-by: Andrei Pistirica <sorin.pistirica@freescale.com>
Signed-off-by: Stefan Szabo <szbs001@freescale.com>
[Kevin: Original patch taken from FSL
QorIQ-SDK-V1.3-SOURCE-20121114-yocto.iso tarball.]
Signed-off-by: Kevin Hao <kexin.hao@windriver.com>
---
 .../dpa/NetCommSw/src/wrapper/fman_test.c          |    2 ++
 1 file changed, 2 insertions(+)

diff --git a/drivers/net/ethernet/freescale/dpa/NetCommSw/src/wrapper/fman_test.c b/drivers/net/ethernet/freescale/dpa/NetCommSw/src/wrapper/fman_test.c
index 965b2f2..37c31e3 100644
--- a/drivers/net/ethernet/freescale/dpa/NetCommSw/src/wrapper/fman_test.c
+++ b/drivers/net/ethernet/freescale/dpa/NetCommSw/src/wrapper/fman_test.c
@@ -911,6 +911,8 @@ int dpa_free_pcd_fqids(
 	for (i = 0; i < num_allocated; i++, fmt_fqs++)
 		fmt_fq_free(fmt_fqs);
 
+	qman_release_fqid_range(base_fqid,num_allocated);
+
 	kfree(fmt_port_pcd->fmt_pcd_fqs);
 	memset(fmt_port_pcd, 0, sizeof(*fmt_port_pcd));
 
-- 
1.7.9.7

