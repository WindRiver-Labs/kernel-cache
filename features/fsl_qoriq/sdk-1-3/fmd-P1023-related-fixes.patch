From fd7bf43d3722c86086ab761c5f3fcd85c6632ed3 Mon Sep 17 00:00:00 2001
From: Stefan Szabo <szbs001@freescale.com>
Date: Thu, 23 Aug 2012 11:33:26 +0300
Subject: [PATCH 080/162] fmd: P1023-related fixes

Makefile and integration header fixes:
- re-added fm_manip.c to P1023 builds
- removed #define FM_CAPWAP_SUPPORT (#defined by default in LLD)
- re-added #ifndef NCSW_LINUX lines that were removed by accident

lnxwrp_fm_port.c:
- Added #ifndef  FM_QMI_NO_DEQ_OPTIONS_SUPPORT conditionals around
FM_PORT_ConfigDeqHighPriority() and FM_PORT_ConfigDeqPrefetchOption()
in InitFmPortDev().

Signed-off-by: Stefan Szabo <szbs001@freescale.com>
[Kevin: Original patch taken from FSL
QorIQ-SDK-V1.3-SOURCE-20121114-yocto.iso tarball.]
Signed-off-by: Kevin Hao <kexin.hao@windriver.com>
---
 .../dpa/NetCommSw/Peripherals/FM/Pcd/Makefile      |    7 +------
 .../inc/integrations/P1023/dpaa_integration_ext.h  |    1 -
 .../inc/integrations/P1023/part_integration_ext.h  |    4 ++++
 .../freescale/dpa/NetCommSw/ncsw_config.mk         |    8 ++++----
 .../dpa/NetCommSw/src/wrapper/lnxwrp_fm_port.c     |    2 ++
 5 files changed, 11 insertions(+), 11 deletions(-)

diff --git a/drivers/net/ethernet/freescale/dpa/NetCommSw/Peripherals/FM/Pcd/Makefile b/drivers/net/ethernet/freescale/dpa/NetCommSw/Peripherals/FM/Pcd/Makefile
index b74ac31..603e120 100644
--- a/drivers/net/ethernet/freescale/dpa/NetCommSw/Peripherals/FM/Pcd/Makefile
+++ b/drivers/net/ethernet/freescale/dpa/NetCommSw/Peripherals/FM/Pcd/Makefile
@@ -12,9 +12,4 @@ EXTRA_CFLAGS += -I$(NCSW_FM_INC)
 
 obj-y		+= fsl-ncsw-Pcd.o
 
-fsl-ncsw-Pcd-objs	:= fm_cc.o fm_kg.o fm_pcd.o fm_plcr.o fm_prs.o
-
-ifeq ($(CONFIG_FMAN_P3040_P4080_P5020),y)
-fsl-ncsw-Pcd-objs	+= fm_manip.o
-endif
-
+fsl-ncsw-Pcd-objs	:= fm_cc.o fm_kg.o fm_pcd.o fm_plcr.o fm_prs.o fm_manip.o
diff --git a/drivers/net/ethernet/freescale/dpa/NetCommSw/inc/integrations/P1023/dpaa_integration_ext.h b/drivers/net/ethernet/freescale/dpa/NetCommSw/inc/integrations/P1023/dpaa_integration_ext.h
index ca912b8..68fe2ba 100644
--- a/drivers/net/ethernet/freescale/dpa/NetCommSw/inc/integrations/P1023/dpaa_integration_ext.h
+++ b/drivers/net/ethernet/freescale/dpa/NetCommSw/inc/integrations/P1023/dpaa_integration_ext.h
@@ -121,7 +121,6 @@ typedef enum {
 #define FM_MAX_NUM_OF_MACSECS       1
 
 #define FM_MACSEC_SUPPORT
-#define FM_CAPWAP_SUPPORT
 #define FM_DISABLE_SEC_ERRORS
 
 #define FM_LOW_END_RESTRICTION      /* prevents the use of TX port 1 with OP port 0 */
diff --git a/drivers/net/ethernet/freescale/dpa/NetCommSw/inc/integrations/P1023/part_integration_ext.h b/drivers/net/ethernet/freescale/dpa/NetCommSw/inc/integrations/P1023/part_integration_ext.h
index ac7a33a..e2eeca6 100644
--- a/drivers/net/ethernet/freescale/dpa/NetCommSw/inc/integrations/P1023/part_integration_ext.h
+++ b/drivers/net/ethernet/freescale/dpa/NetCommSw/inc/integrations/P1023/part_integration_ext.h
@@ -41,7 +41,9 @@
 #define __PART_INTEGRATION_EXT_H
 
 #include "std_ext.h"
+#ifndef NCSW_LINUX
 #include "ddr_std_ext.h"
+#endif
 #include "dpaa_integration_ext.h"
 
 
@@ -393,7 +395,9 @@ t_Error P1023_GetDdrFactor( uintptr_t   gutilBase,
 
  @Return        E_OK on success; Other value otherwise.
 *//***************************************************************************/
+#ifndef NCSW_LINUX
 t_Error P1023_GetDdrType(uintptr_t gutilBase, e_DdrType *p_DdrType );
+#endif
 
 
 /** @} */ /* end of 1023_init_grp group */
diff --git a/drivers/net/ethernet/freescale/dpa/NetCommSw/ncsw_config.mk b/drivers/net/ethernet/freescale/dpa/NetCommSw/ncsw_config.mk
index 7fa4c15..347a5da 100644
--- a/drivers/net/ethernet/freescale/dpa/NetCommSw/ncsw_config.mk
+++ b/drivers/net/ethernet/freescale/dpa/NetCommSw/ncsw_config.mk
@@ -5,10 +5,10 @@ NET_DPA     = $(srctree)/drivers/net/ethernet/freescale
 DRV_DPA     = $(srctree)/drivers/net/ethernet/freescale/dpa
 NCSW        = $(srctree)/drivers/net/ethernet/freescale/dpa/NetCommSw
 
-ifdef CONFIG_FMAN_P3040_P4080_P5020
+ifeq ("$(CONFIG_FMAN_P3040_P4080_P5020)", "y")
 EXTRA_CFLAGS +=-include $(NCSW)/p3040_4080_5020_dflags.h
 endif
-ifdef CONFIG_FMAN_P1023
+ifeq ("$(CONFIG_FMAN_P1023)", "y")
 EXTRA_CFLAGS +=-include $(NCSW)/p1023_dflags.h
 endif
 
@@ -18,10 +18,10 @@ EXTRA_CFLAGS += -I$(NCSW)/inc/cores
 EXTRA_CFLAGS += -I$(NCSW)/inc/etc
 EXTRA_CFLAGS += -I$(NCSW)/inc/Peripherals
 
-ifdef CONFIG_FMAN_P3040_P4080_P5020
+ifeq ("$(CONFIG_FMAN_P3040_P4080_P5020)", "y")
 EXTRA_CFLAGS += -I$(NCSW)/inc/integrations/P3040_P4080_P5020
 endif
-ifdef CONFIG_FMAN_P1023
+ifeq ("$(CONFIG_FMAN_P1023)", "y")
 EXTRA_CFLAGS += -I$(NCSW)/inc/integrations/P1023
 endif
 
diff --git a/drivers/net/ethernet/freescale/dpa/NetCommSw/src/wrapper/lnxwrp_fm_port.c b/drivers/net/ethernet/freescale/dpa/NetCommSw/src/wrapper/lnxwrp_fm_port.c
index 3457d32..0924f10 100644
--- a/drivers/net/ethernet/freescale/dpa/NetCommSw/src/wrapper/lnxwrp_fm_port.c
+++ b/drivers/net/ethernet/freescale/dpa/NetCommSw/src/wrapper/lnxwrp_fm_port.c
@@ -658,6 +658,7 @@ static t_Error InitFmPortDev(t_LnxWrpFmPortDev *p_LnxWrpFmPortDev)
 	if (p_LnxWrpFmPortDev->h_Dev == NULL)
 		RETURN_ERROR(MAJOR, E_INVALID_HANDLE, ("FM-port"));
 
+#ifndef  FM_QMI_NO_DEQ_OPTIONS_SUPPORT
 	if ((p_LnxWrpFmPortDev->settings.param.portType ==
 	     e_FM_PORT_TYPE_TX_10G)
 	    || (p_LnxWrpFmPortDev->settings.param.portType ==
@@ -675,6 +676,7 @@ static t_Error InitFmPortDev(t_LnxWrpFmPortDev *p_LnxWrpFmPortDev)
 		    != E_OK)
 			RETURN_ERROR(MAJOR, errCode, NO_MSG);
 	}
+#endif  /* !FM_QMI_NO_DEQ_OPTIONS_SUPPORT */
 
 /* Call the driver's advanced configuration routines, if requested:
    Compare the function pointer of each entry to the available routines,
-- 
1.7.9.7

