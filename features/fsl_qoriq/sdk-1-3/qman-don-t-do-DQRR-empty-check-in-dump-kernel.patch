From 1d1adc30ec3a704059f1becdc4614923bea2e68b Mon Sep 17 00:00:00 2001
From: Tiejun Chen <tiejun.chen@windriver.com>
Date: Wed, 5 Dec 2012 15:10:18 +0800
Subject: [PATCH 5/7] qman: don't do DQRR empty check in dump kernel

There are maybe some responses in Dequeue Response Ring
which are still not handled by panic kernel. So don't
do empty check for DQRR and just ignore these responses
in dump kernel.

Signed-off-by: Kevin Hao <kexin.hao@windriver.com>
---
 drivers/staging/fsl_qbman/qman_high.c |    2 ++
 1 file changed, 2 insertions(+)

diff --git a/drivers/staging/fsl_qbman/qman_high.c b/drivers/staging/fsl_qbman/qman_high.c
index c89baa8..8344a9e 100644
--- a/drivers/staging/fsl_qbman/qman_high.c
+++ b/drivers/staging/fsl_qbman/qman_high.c
@@ -453,10 +453,12 @@ struct qman_portal *qman_create_affine_portal(
 	}
 	isdr ^= (QM_PIRQ_DQRI | QM_PIRQ_MRI);
 	qm_isr_disable_write(__p, isdr);
+#ifndef CONFIG_CRASH_DUMP
 	if (qm_dqrr_current(__p) != NULL) {
 		pr_err("Qman DQRR unclean\n");
 		goto fail_dqrr_mr_empty;
 	}
+#endif
 	if (qm_mr_current(__p) != NULL) {
 		/* special handling, drain just in case it's a few FQRNIs */
 		if (drain_mr_fqrni(__p)) {
-- 
1.7.9.7

