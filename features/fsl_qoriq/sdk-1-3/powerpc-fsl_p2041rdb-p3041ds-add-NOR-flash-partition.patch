From 7c43d6dca6ff618227673eeb26b69e4e2a5a77ae Mon Sep 17 00:00:00 2001
From: Tiejun Chen <tiejun.chen@windriver.com>
Date: Tue, 4 Dec 2012 15:51:42 +0800
Subject: [PATCH 20/22] powerpc/fsl_p2041rdb,p3041ds: add NOR flash partitions

Use the DTS file to act as a self documenting layout
for the default flash population on the P2041RDB & P3041DS.
This also makes MTD support more user friendly to use for
updating various components.

Signed-off-by: Jiang Lu <lu.jiang@windriver.com>
[Rebase on sdkv1.3 context.]
Signed-off-by: Tiejun Chen <tiejun.chen@windriver.com>
---
 arch/powerpc/boot/dts/p2041rdb.dts |   53 ++++++++++++++++++++++++++++++++++++
 arch/powerpc/boot/dts/p3041ds.dts  |   53 ++++++++++++++++++++++++++++++++++++
 2 files changed, 106 insertions(+)

diff --git a/arch/powerpc/boot/dts/p2041rdb.dts b/arch/powerpc/boot/dts/p2041rdb.dts
index 2ba6d61..f49eac4 100644
--- a/arch/powerpc/boot/dts/p2041rdb.dts
+++ b/arch/powerpc/boot/dts/p2041rdb.dts
@@ -267,10 +267,63 @@
 			  1 0 0xf 0xffa00000 0x00040000>;
 
 		flash@0,0 {
+			#size-cells = <1>;
+			#address-cells = <1>;
 			compatible = "cfi-flash";
 			reg = <0 0 0x08000000>;
 			bank-width = <2>;
 			device-width = <2>;
+
+			partition@0 {
+				label = "rcw";
+				reg = <0x0 0x20000>;
+				read-only;
+			};
+			partition@20000 {
+				label = "kernel";
+				reg = <0x20000 0x300000>;
+			};
+			partition@320000 {
+				label = "dtb";
+				reg = <0x320000 0x20000>;
+			};
+			partition@340000 {
+				label = "fs1";
+				reg = <0x340000 0x3c40000>;
+			};
+			partition@3f80000 {
+				label = "alt-u-boot";
+				reg = <0x3f80000 0x80000>;
+				read-only;
+			};
+			partition@4000000 {
+				label = "alt-rcw";
+				reg = <0x4000000 0x20000>;
+				read-only;
+			};
+			partition@4020000 {
+				label = "fs2";
+				reg = <0x4020000  0x2fe0000>;
+			};
+			partition@7000000 {
+				label = "fman-firmware";
+				reg = <0x7000000 0x20000>;
+				read-only;
+			};
+			partition@7020000 {
+				label = "fs3";
+				reg = <0x7020000  0xf40000>;
+			};
+			partition@7f60000 {
+				label = "u-boot env";
+				reg = <0x7f60000  0x20000>;
+				read-only;
+			};
+			partition@7f80000 {
+				label = "u-boot";
+				reg = <0x7f80000 0x80000>;
+				read-only;
+			};
 		};
 
 		nand@1,0 {
diff --git a/arch/powerpc/boot/dts/p3041ds.dts b/arch/powerpc/boot/dts/p3041ds.dts
index 562d964..c740c53 100644
--- a/arch/powerpc/boot/dts/p3041ds.dts
+++ b/arch/powerpc/boot/dts/p3041ds.dts
@@ -309,10 +309,63 @@
 			  3 0 0xf 0xffdf0000 0x00008000>;
 
 		flash@0,0 {
+			#size-cells = <1>;
+			#address-cells = <1>;
 			compatible = "cfi-flash";
 			reg = <0 0 0x08000000>;
 			bank-width = <2>;
 			device-width = <2>;
+
+			partition@0 {
+				label = "rcw";
+				reg = <0x0 0x20000>;
+				read-only;
+			};
+			partition@20000 {
+				label = "kernel";
+				reg = <0x20000 0x300000>;
+			};
+			partition@320000 {
+				label = "dtb";
+				reg = <0x320000 0x20000>;
+			};
+			partition@340000 {
+				label = "fs1";
+				reg = <0x340000 0x3c40000>;
+			};
+			partition@3f80000 {
+				label = "alt-u-boot";
+				reg = <0x3f80000 0x80000>;
+				read-only;
+			};
+			partition@4000000 {
+				label = "alt-rcw";
+				reg = <0x4000000 0x20000>;
+				read-only;
+			};
+			partition@4020000 {
+				label = "fs2";
+				reg = <0x4020000  0x2fe0000>;
+			};
+			partition@7000000 {
+				label = "fman-firmware";
+				reg = <0x7000000 0x20000>;
+				read-only;
+			};
+			partition@7020000 {
+				label = "fs3";
+				reg = <0x7020000  0xf40000>;
+			};
+			partition@7f60000 {
+				label = "u-boot env";
+				reg = <0x7f60000  0x20000>;
+				read-only;
+			};
+			partition@7f80000 {
+				label = "u-boot";
+				reg = <0x7f80000 0x80000>;
+				read-only;
+			};
 		};
 
 		nand@2,0 {
-- 
1.7.9.7

