From b18cd596cbda230b8d925256e8399cd9040c42aa Mon Sep 17 00:00:00 2001
From: Jiang Bin <bin.jiang@windriver.com>
Date: Wed, 14 Nov 2012 15:33:11 +0800
Subject: [PATCH 6/6] powerpc/mpc8548cds: Get correct CDS slot number

SW2[7:8] in CDS card to represent PCI Slot0~Slot3. For MPC8548CDS, CDS
card is inserted into Slot2 or Slot5, so add 2 to represent Slot2~Slot5.

Signed-off-by: Jiang Bin <bin.jiang@windriver.com>
---
 arch/powerpc/platforms/85xx/mpc85xx_cds.c |    3 +++
 1 file changed, 3 insertions(+)

diff --git a/arch/powerpc/platforms/85xx/mpc85xx_cds.c b/arch/powerpc/platforms/85xx/mpc85xx_cds.c
index 8b59a12..edd78ff 100644
--- a/arch/powerpc/platforms/85xx/mpc85xx_cds.c
+++ b/arch/powerpc/platforms/85xx/mpc85xx_cds.c
@@ -303,6 +303,9 @@ static void __init mpc85xx_cds_setup_arch(void)
 	if (ppc_md.progress) {
 		char buf[40];
 		cds_pci_slot = ((in_8(&cadmus->cm_csr) >> 6) & 0x3) + 1;
+		if(of_machine_is_compatible("MPC8548CDS"))
+			/* mpc8548cds uses Slot2 or Slot5 */
+			cds_pci_slot += 1;
 		snprintf(buf, 40, "CDS Version = 0x%x in slot %d\n",
 				in_8(&cadmus->cm_ver), cds_pci_slot);
 		ppc_md.progress(buf, 0);
-- 
1.7.9.7

