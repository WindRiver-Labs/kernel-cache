From 8302bd45052b503986c67c10b925f8a71e9c349c Mon Sep 17 00:00:00 2001
From: Wei Yang <Wei.Yang@windriver.com>
Date: Wed, 20 Feb 2013 09:53:36 +0800
Subject: [PATCH 2/2] edac/edac_device: Add a limitation to clear work queue
 processing

The work queue is only created in POLL mode,  accordingly it should be only torn down
in POLL mode.

Signed-off-by: Wei Yang <Wei.Yang@windriver.com>
---
 drivers/edac/edac_device.c |    3 ++-
 1 file changed, 2 insertions(+), 1 deletion(-)

diff --git a/drivers/edac/edac_device.c b/drivers/edac/edac_device.c
index 4b15459..e2618dd 100644
--- a/drivers/edac/edac_device.c
+++ b/drivers/edac/edac_device.c
@@ -595,7 +595,8 @@ struct edac_device_ctl_info *edac_device_del_device(struct device *dev)
 	mutex_unlock(&device_ctls_mutex);
 
 	/* clear workq processing on this instance */
-	edac_device_workq_teardown(edac_dev);
+	if (edac_dev->edac_check != NULL)
+		edac_device_workq_teardown(edac_dev);
 
 	/* Tear down the sysfs entries for this instance */
 	edac_device_remove_sysfs(edac_dev);
-- 
1.7.9.7

