From 54893f923ecce4ff6178c99287d2ec2b7139e3ad Mon Sep 17 00:00:00 2001
From: Andrei Pistirica <sorin.pistirica@freescale.com>
Date: Thu, 24 May 2012 11:59:43 +0300
Subject: [PATCH 068/162] FMD IOCTL bad management solved.

The following IOCTL calls weren't properly guarded:
FM_PCD_IOC_MANIP_SET_NODE
FM_PCD_IOC_MANIP_DELETE_NODE
FM_PCD_IOC_STATISTICS_SET_NODE

Signed-off-by: Andrei Pistirica <sorin.pistirica@freescale.com>
[Kevin: Original patch taken from FSL
QorIQ-SDK-V1.3-SOURCE-20121114-yocto.iso tarball.]
Signed-off-by: Kevin Hao <kexin.hao@windriver.com>
---
 .../dpa/NetCommSw/src/wrapper/lnxwrp_ioctls_fm.c   |   11 ++++-------
 1 file changed, 4 insertions(+), 7 deletions(-)

diff --git a/drivers/net/ethernet/freescale/dpa/NetCommSw/src/wrapper/lnxwrp_ioctls_fm.c b/drivers/net/ethernet/freescale/dpa/NetCommSw/src/wrapper/lnxwrp_ioctls_fm.c
index c47d8a4..2303f9a 100644
--- a/drivers/net/ethernet/freescale/dpa/NetCommSw/src/wrapper/lnxwrp_ioctls_fm.c
+++ b/drivers/net/ethernet/freescale/dpa/NetCommSw/src/wrapper/lnxwrp_ioctls_fm.c
@@ -2091,9 +2091,8 @@ invalid_port_id:
 
 #if defined(CONFIG_COMPAT)
         case FM_PCD_IOC_MANIP_SET_NODE_COMPAT:
-#else
-        case FM_PCD_IOC_MANIP_SET_NODE:
 #endif
+        case FM_PCD_IOC_MANIP_SET_NODE:
         {
             ioc_fm_pcd_manip_params_t *param;
 
@@ -2184,9 +2183,8 @@ invalid_port_id:
 
 #if defined(CONFIG_COMPAT)
         case FM_PCD_IOC_MANIP_DELETE_NODE_COMPAT:
-#else
-        case FM_PCD_IOC_MANIP_DELETE_NODE:
 #endif
+        case FM_PCD_IOC_MANIP_DELETE_NODE:
         {
             ioc_fm_obj_t id;
 
@@ -2215,12 +2213,11 @@ invalid_port_id:
 #ifdef FM_CAPWAP_SUPPORT
 #if defined(CONFIG_COMPAT)
         case FM_PCD_IOC_STATISTICS_SET_NODE_COMPAT:
-#else
-        case FM_PCD_IOC_STATISTICS_SET_NODE:
 #endif
+        case FM_PCD_IOC_STATISTICS_SET_NODE:
         {
             ioc_fm_pcd_stats_params_t param;
-#warning "TODO"
+#warning "feature not supported!"
             param->id = FM_PCD_StatisticsSetNode(p_LnxWrpFmDev->h_PcdDev,
                                 (t_FmPcdStatsParams *)&param);
         }
-- 
1.7.9.7

