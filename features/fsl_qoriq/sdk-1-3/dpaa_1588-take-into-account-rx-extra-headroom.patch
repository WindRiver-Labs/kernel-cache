From ac11362ad071c15ded0dbc29cbf31c621a4652a3 Mon Sep 17 00:00:00 2001
From: Madalin Bucur <madalin.bucur@freescale.com>
Date: Fri, 14 Sep 2012 13:28:06 +0000
Subject: [PATCH 047/162] dpaa_1588: take into account rx extra headroom

The added rx extra headroom needs to be taken into account when
reading the rx timestamp information otherwise the rx timestamp
information is errored.

Signed-off-by: Madalin Bucur <madalin.bucur@freescale.com>
[Kevin: Original patch taken from FSL
QorIQ-SDK-V1.3-SOURCE-20121114-yocto.iso tarball.]
Signed-off-by: Kevin Hao <kexin.hao@windriver.com>
---
 drivers/net/ethernet/freescale/dpa/dpaa_1588.c |    4 +++-
 1 file changed, 3 insertions(+), 1 deletion(-)

diff --git a/drivers/net/ethernet/freescale/dpa/dpaa_1588.c b/drivers/net/ethernet/freescale/dpa/dpaa_1588.c
index e836ab2..2ac2a01 100644
--- a/drivers/net/ethernet/freescale/dpa/dpaa_1588.c
+++ b/drivers/net/ethernet/freescale/dpa/dpaa_1588.c
@@ -352,7 +352,9 @@ void dpa_ptp_store_rxstamp(struct net_device *dev, struct sk_buff *skb,
 	dma_addr_t fd_addr = qm_fd_addr(fd);
 	int ret;
 
-	ret = dpa_ptp_store_stamp(dev, skb, fd_addr, &ptp_rx_data);
+	ret = dpa_ptp_store_stamp(dev, skb,
+					fd_addr + fm_get_rx_extra_headroom(),
+					&ptp_rx_data);
 	if (ret)
 		return;
 	dpa_ptp_insert(&tsu->rx_timestamps, &ptp_rx_data);
-- 
1.7.9.7

