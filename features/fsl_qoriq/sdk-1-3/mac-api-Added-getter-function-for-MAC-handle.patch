From 9f496744d938086a53ccb350d5042069b1875875 Mon Sep 17 00:00:00 2001
From: Stefan Szabo <szbs001@freescale.com>
Date: Wed, 18 Jul 2012 14:13:15 +0300
Subject: [PATCH 044/162] mac-api: Added getter function for MAC handle

Signed-off-by: Stefan Szabo <szbs001@freescale.com>
[Kevin: Original patch taken from FSL
QorIQ-SDK-V1.3-SOURCE-20121114-yocto.iso tarball.]
Signed-off-by: Kevin Hao <kexin.hao@windriver.com>
---
 drivers/net/ethernet/freescale/dpa/mac-api.c |    8 ++++++++
 drivers/net/ethernet/freescale/dpa/mac.h     |    1 +
 2 files changed, 9 insertions(+)

diff --git a/drivers/net/ethernet/freescale/dpa/mac-api.c b/drivers/net/ethernet/freescale/dpa/mac-api.c
index 043ba5e..7348976 100644
--- a/drivers/net/ethernet/freescale/dpa/mac-api.c
+++ b/drivers/net/ethernet/freescale/dpa/mac-api.c
@@ -511,6 +511,13 @@ static int __cold ptp_disable(struct mac_device *mac_dev)
 	return _errno;
 }
 
+static void *get_mac_handle(struct mac_device *mac_dev)
+{
+	const struct mac_priv_s	*priv;
+	priv = macdev_priv(mac_dev);
+	return (void*)priv->mac;
+}
+
 static int __cold fm_rtc_enable(struct net_device *net_dev)
 {
 	struct dpa_priv_s *priv = netdev_priv(net_dev);
@@ -689,6 +696,7 @@ static void __devinit __cold setup_dtsec(struct mac_device *mac_dev)
 	mac_dev->uninit		= uninit;
 	mac_dev->ptp_enable		= ptp_enable;
 	mac_dev->ptp_disable		= ptp_disable;
+	mac_dev->get_mac_handle		= get_mac_handle;
 	mac_dev->fm_rtc_enable		= fm_rtc_enable;
 	mac_dev->fm_rtc_disable		= fm_rtc_disable;
 	mac_dev->fm_rtc_get_cnt		= fm_rtc_get_cnt;
diff --git a/drivers/net/ethernet/freescale/dpa/mac.h b/drivers/net/ethernet/freescale/dpa/mac.h
index 9da9beb..ace8185 100644
--- a/drivers/net/ethernet/freescale/dpa/mac.h
+++ b/drivers/net/ethernet/freescale/dpa/mac.h
@@ -77,6 +77,7 @@ struct mac_device {
 	int (*uninit)(struct mac_device *mac_dev);
 	int (*ptp_enable)(struct mac_device *mac_dev);
 	int (*ptp_disable)(struct mac_device *mac_dev);
+	void *(*get_mac_handle)(struct mac_device *mac_dev);
 	int (*fm_rtc_enable)(struct net_device *net_dev);
 	int (*fm_rtc_disable)(struct net_device *net_dev);
 	int (*fm_rtc_get_cnt)(struct net_device *net_dev, uint64_t *ts);
-- 
1.7.9.7

