From 749b868e3992a10b79bc11be13f34bbf51cb70ba Mon Sep 17 00:00:00 2001
From: Qiang Liu <qiang.liu@freescale.com>
Date: Fri, 17 Aug 2012 14:22:06 +0000
Subject: [PATCH 014/162] crypto: talitos - Fix issue of wrong memory free

"DMA-API: device driver tries to sync DMA memory it has not allocated" is
reported by dma-debug lib when enabling DMAPOOL_DEBUG and ASYNC_RAID6_TEST.

dma mapping memory of request->desc is not released by right device,
it should be private->dev but not dev.

Signed-off-by: Qiang Liu <qiang.liu@freescale.com>
[Kevin: Original patch taken from FSL
QorIQ-SDK-V1.3-SOURCE-20121114-yocto.iso tarball.]
Signed-off-by: Kevin Hao <kexin.hao@windriver.com>
---
 drivers/crypto/talitos.c |    2 +-
 1 file changed, 1 insertion(+), 1 deletion(-)

diff --git a/drivers/crypto/talitos.c b/drivers/crypto/talitos.c
index 8250bdf..9f839fd 100644
--- a/drivers/crypto/talitos.c
+++ b/drivers/crypto/talitos.c
@@ -268,7 +268,7 @@ static int flush_channel(struct device *dev, int ch, int error, int reset_ch,
 			else
 				status = error;
 
-		dma_unmap_single(dev, request->dma_desc,
+		dma_unmap_single(priv->dev, request->dma_desc,
 				 sizeof(struct talitos_desc),
 				 DMA_BIDIRECTIONAL);
 
-- 
1.7.9.7

