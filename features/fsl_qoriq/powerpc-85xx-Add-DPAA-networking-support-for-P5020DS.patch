From 19a7cff13ebc58030ba27b38fb999785a7b58b7f Mon Sep 17 00:00:00 2001
From: Tiejun Chen <tiejun.chen@windriver.com>
Date: Mon, 23 Apr 2012 15:05:52 +0800
Subject: [PATCH 33/38] powerpc/85xx: Add DPAA/networking support for P5020DS

Extracted from QorIQ-DPAA-SDK-v1.1-20111026-systembuilder.iso

Signed-off-by: Kumar Gala <galak@kernel.crashing.org>
---
 arch/powerpc/platforms/85xx/p5020_ds.c |   15 ++++++++++++++-
 1 files changed, 14 insertions(+), 1 deletions(-)

diff --git a/arch/powerpc/platforms/85xx/p5020_ds.c b/arch/powerpc/platforms/85xx/p5020_ds.c
index 17bef15..c35dcd4 100644
--- a/arch/powerpc/platforms/85xx/p5020_ds.c
+++ b/arch/powerpc/platforms/85xx/p5020_ds.c
@@ -67,6 +67,18 @@ static int __init p5020_ds_probe(void)
 	return 0;
 }
 
+#if defined(CONFIG_PHYLIB) && defined(CONFIG_VITESSE_PHY)
+int vsc824x_add_skew(struct phy_device *phydev);
+#define PHY_ID_VSC8244                  0x000fc6c0
+static int __init board_fixups(void)
+{
+	phy_register_fixup_for_uid(PHY_ID_VSC8244, 0xfffff, vsc824x_add_skew);
+
+	return 0;
+}
+machine_device_initcall(p5020_ds, board_fixups);
+#endif
+
 define_machine(p5020_ds) {
 	.name			= "P5020 DS",
 	.probe			= p5020_ds_probe,
@@ -89,9 +101,10 @@ define_machine(p5020_ds) {
 #else
 	.power_save		= e500_idle,
 #endif
+	.init_early		= corenet_ds_init_early,
 };
 
-machine_device_initcall(p5020_ds, corenet_ds_publish_devices);
+machine_device_initcall(p5020_ds, declare_of_platform_devices);
 
 #ifdef CONFIG_SWIOTLB
 machine_arch_initcall(p5020_ds, swiotlb_setup_bus_notifier);
-- 
1.7.0.4

