From c7ebc187a84cccbc891794ec7b70d64ace8fad0b Mon Sep 17 00:00:00 2001
From: Bogdan Hamciuc <bogdan.hamciuc@freescale.com>
Date: Tue, 8 Jan 2013 00:36:02 +0200
Subject: [PATCH 007/430] dpaa_eth: MTU checking is not required for IP
 reassembled frames

The IP reassembled packets are not to be limited to MTU size.

Change-Id: I8c17af7e1396de3e4faf5716c97b24fb418693dd
Signed-off-by: Madalin Bucur <madalin.bucur@freescale.com>
(cherry picked from commit eba22bc0fe347e15d7a1b49952f695adcbb4d4c8)
Reviewed-on: http://git.am.freescale.net:8181/1036
Reviewed-by: Fleming Andrew-AFLEMING <AFLEMING@freescale.com>
Tested-by: Fleming Andrew-AFLEMING <AFLEMING@freescale.com>
[original patch is from QorIQ-SDK-V1.4-20130625-yocto]
Signed-off-by: Jiang Lu <lu.jiang@windriver.com>
---
 drivers/net/ethernet/freescale/dpa/dpaa_eth_sg.c |    4 +++-
 1 files changed, 3 insertions(+), 1 deletions(-)

diff --git a/drivers/net/ethernet/freescale/dpa/dpaa_eth_sg.c b/drivers/net/ethernet/freescale/dpa/dpaa_eth_sg.c
index d93e358..f636d6b 100644
--- a/drivers/net/ethernet/freescale/dpa/dpaa_eth_sg.c
+++ b/drivers/net/ethernet/freescale/dpa/dpaa_eth_sg.c
@@ -510,7 +510,9 @@ void __hot _dpa_rx(struct net_device *net_dev,
 
 	skb->protocol = eth_type_trans(skb, net_dev);
 
-	if (unlikely(dpa_check_rx_mtu(skb, net_dev->mtu))) {
+	/* IP Reassembled frames are allowed to be larger than MTU */
+	if (unlikely(dpa_check_rx_mtu(skb, net_dev->mtu) &&
+		!(fd_status & FM_FD_IPR))) {
 		percpu_priv->stats.rx_dropped++;
 		goto drop_bad_frame;
 	}
-- 
1.7.5.4

