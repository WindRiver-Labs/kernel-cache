From b00df1e120ce15b37105f6f14e61a6ca865203d5 Mon Sep 17 00:00:00 2001
From: Yang Wei <Wei.Yang@windriver.com>
Date: Tue, 13 Aug 2013 13:51:45 +0800
Subject: [PATCH 538/547] dts/t4240qds: Fix the incorrect partition of nor
 flash

Since the size of fs1 partition currently overlaps the alternate FMAN ucode
and alternate u-boot environment variable, so we need to separate two partition
for alternate FMAN ucode and u-boot env from fs1 partition.

At the same time, the offset of current fman ucode partition should be
at 0x7f40000, so move it to correct address, and squash fs2 and fs3
partition.

Signed-off-by: Yang Wei <Wei.Yang@windriver.com>
Signed-off-by: Bin Jiang <bin.jiang@windriver.com>
---
 arch/powerpc/boot/dts/t4240qds.dts | 22 ++++++++++++++--------
 1 file changed, 14 insertions(+), 8 deletions(-)

diff --git a/arch/powerpc/boot/dts/t4240qds.dts b/arch/powerpc/boot/dts/t4240qds.dts
index a5bb7d7..dac0719 100644
--- a/arch/powerpc/boot/dts/t4240qds.dts
+++ b/arch/powerpc/boot/dts/t4240qds.dts
@@ -101,7 +101,17 @@
 			};
 			partition@540000 {
 				label = "fs1";
-				reg = <0x540000 0x3a40000>;
+				reg = <0x540000 0x3a00000>;
+			};
+			partition@3f40000 {
+				label = "alt-fman-firmware";
+				reg = <0x3f40000 0x20000>;
+				read-only;
+			};
+			partition@3f60000 {
+				label = "alt-uboot-env";
+				reg = <0x3f60000 0x20000>;
+				read-only;
 			};
 			partition@3f80000 {
 				label = "alt-u-boot";
@@ -115,17 +125,13 @@
 			};
 			partition@4020000 {
 				label = "fs2";
-				reg = <0x4020000  0x2fe0000>;
+				reg = <0x4020000  0x3f20000>;
 			};
-			partition@7000000 {
+			partition@7f40000 {
 				label = "fman-firmware";
-				reg = <0x7000000 0x20000>;
+				reg = <0x7f40000 0x20000>;
 				read-only;
 			};
-			partition@7020000 {
-				label = "fs3";
-				reg = <0x7020000  0xf40000>;
-			};
 			partition@7f60000 {
 				label = "u-boot env";
 				reg = <0x7f60000  0x20000>;
-- 
1.8.4.93.g57e4c17

