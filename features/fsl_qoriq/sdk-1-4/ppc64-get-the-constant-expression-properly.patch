From 92f713f2ffafbd4497c62b45e57f40ee871195df Mon Sep 17 00:00:00 2001
From: Tiejun Chen <tiejun.chen@windriver.com>
Date: Fri, 18 Jan 2013 17:20:29 +0800
Subject: [PATCH 520/547] ppc64: get the constant expression properly

We should copy thread info from the kernel stack coming from usr.

Signed-off-by: Tiejun Chen <tiejun.chen@windriver.com>
[In order to get the address of a global variable, we should use
LOAD_REG_ADDR instead of LOAD_REG_IMMEDIATE.]
Signed-off-by: Yang Wei <Wei.Yang@windriver.com>
Signed-off-by: Bin Jiang <bin.jiang@windriver.com>
---
 arch/powerpc/kernel/exceptions-64e.S | 2 +-
 1 file changed, 1 insertion(+), 1 deletion(-)

diff --git a/arch/powerpc/kernel/exceptions-64e.S b/arch/powerpc/kernel/exceptions-64e.S
index 7e6c2b5..f6992af 100644
--- a/arch/powerpc/kernel/exceptions-64e.S
+++ b/arch/powerpc/kernel/exceptions-64e.S
@@ -100,7 +100,7 @@
 #define	BOOK3E_STORE_EXC_LEVEL_THEAD_INFO(type)					\
 	andi.	r10,r11,MSR_PR;							\
 	bne	1f;								\
-	ld	r14,PACA_EX##type+EX_R1(r13);					\
+	ld	r14,PACAKSAVE(r13);						\
 	CURRENT_THREAD_INFO(r14, r14);						\
 	CURRENT_THREAD_INFO(r15, r1);						\
 	ld	r10,TI_FLAGS(r14);		     				\
-- 
1.8.4.93.g57e4c17

