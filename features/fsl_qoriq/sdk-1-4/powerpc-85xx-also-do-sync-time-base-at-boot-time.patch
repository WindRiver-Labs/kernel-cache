From d962b29477351582f9adf2252c33721eeb50fe97 Mon Sep 17 00:00:00 2001
From: Kevin Hao <kexin.hao@windriver.com>
Date: Tue, 14 Jan 2014 14:00:36 +0800
Subject: [PATCH 1/3] powerpc/85xx: also do sync time base at boot time

This reverts commit 2a42485ffca3 (powerpc/85xx: do not sync time base at
boot time). The kernel may be used as the new kernel for kexec/kdump, so
we still need to sync the time base in the boot time.

Signed-off-by: Kevin Hao <kexin.hao@windriver.com>
---
 arch/powerpc/platforms/85xx/smp.c |    6 ------
 1 files changed, 0 insertions(+), 6 deletions(-)

diff --git a/arch/powerpc/platforms/85xx/smp.c b/arch/powerpc/platforms/85xx/smp.c
index 24a73d1..fd4fbb6 100644
--- a/arch/powerpc/platforms/85xx/smp.c
+++ b/arch/powerpc/platforms/85xx/smp.c
@@ -111,9 +111,6 @@ static void __cpuinit mpc85xx_give_timebase(void)
 {
 	unsigned long flags;
 
-	/* only do time base sync when system is running */
-	if (system_state == SYSTEM_BOOTING)
-		return;
 	/*
 	 * If the booting thread is not the first thread of the core,
 	 * skip time base sync.
@@ -145,9 +142,6 @@ static void __cpuinit mpc85xx_take_timebase(void)
 {
 	unsigned long flags;
 
-	if (system_state == SYSTEM_BOOTING)
-		return;
-
 	if (smt_capable() &&
 		cur_booting_core != cpu_first_thread_sibling(cur_booting_core))
 		return;
-- 
1.7.5.4

