From 83157b5283b42379f646341fc95e6da51c57f7ea Mon Sep 17 00:00:00 2001
From: Claudiu Manoil <claudiu.manoil@freescale.com>
Date: Wed, 3 Apr 2013 17:13:55 +0300
Subject: [PATCH 376/547] gianfar: Fix Rx/Tx ring sizes setup by ethtool -G

Remove the assumption that num_rx_queues==num_tx_queues
from ethtool -G option. Rx and Tx ring sizes shall be
configured independently by ethtool, according to the
corresponding num_rx_queues and resp. num_tx_queues values.

Signed-off-by: Claudiu Manoil <claudiu.manoil@freescale.com>
Change-Id: I0e2af163eb37637b373e2fe49d14bfe2bfdfbd68
Reviewed-on: http://git.am.freescale.net:8181/983
Reviewed-by: Fleming Andrew-AFLEMING <AFLEMING@freescale.com>
Tested-by: Fleming Andrew-AFLEMING <AFLEMING@freescale.com>
[Original patch taken from QorIQ-SDK-V1.4-SOURCE-20130625-yocto.iso]
Signed-off-by: Bin Jiang <bin.jiang@windriver.com>
---
 drivers/net/ethernet/freescale/gianfar_ethtool.c | 4 +++-
 1 file changed, 3 insertions(+), 1 deletion(-)

diff --git a/drivers/net/ethernet/freescale/gianfar_ethtool.c b/drivers/net/ethernet/freescale/gianfar_ethtool.c
index 21cd881..f84e78c 100644
--- a/drivers/net/ethernet/freescale/gianfar_ethtool.c
+++ b/drivers/net/ethernet/freescale/gianfar_ethtool.c
@@ -520,8 +520,10 @@ static int gfar_sringparam(struct net_device *dev,
 	}
 
 	/* Change the size */
-	for (i = 0; i < priv->num_rx_queues; i++) {
+	for (i = 0; i < priv->num_rx_queues; i++)
 		priv->rx_queue[i]->rx_ring_size = rvals->rx_pending;
+
+	for (i = 0; i < priv->num_tx_queues; i++) {
 		priv->tx_queue[i]->tx_ring_size = rvals->tx_pending;
 		priv->tx_queue[i]->num_txbdfree =
 			priv->tx_queue[i]->tx_ring_size;
-- 
1.8.4.93.g57e4c17

