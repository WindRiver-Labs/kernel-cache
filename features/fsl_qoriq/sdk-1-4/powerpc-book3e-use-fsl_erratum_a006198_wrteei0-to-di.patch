From 8b8ef652f53377243a1d4005b39934e9afcd8298 Mon Sep 17 00:00:00 2001
From: Tiejun Chen <tiejun.chen@windriver.com>
Date: Thu, 26 Sep 2013 17:10:24 +0800
Subject: [PATCH] powerpc/book3e: use fsl_erratum_a006198_wrteei0 to disable
 interrupt

After commit 1d73d5054,

"powerpc/mpc85xx/e6500: work around CPU erratum A-006198"

is introduced to work around that CPU erratum A-006198, we
should intend to use fsl_erratum_a006198_wrteei0 to disable
interrupt for this CPU erratum.

Signed-off-by: Tiejun Chen <tiejun.chen@windriver.com>
---
 arch/powerpc/kernel/entry_64.S |    2 +-
 1 files changed, 1 insertions(+), 1 deletions(-)

diff --git a/arch/powerpc/kernel/entry_64.S b/arch/powerpc/kernel/entry_64.S
index ff94be3..3a3f047 100644
--- a/arch/powerpc/kernel/entry_64.S
+++ b/arch/powerpc/kernel/entry_64.S
@@ -628,7 +628,7 @@ resume_kernel:
 	 * interrupted after loading SRR0/1.
 	 */
 #ifdef CONFIG_PPC_BOOK3E
-	wrteei	0
+	fsl_erratum_a006198_wrteei0 r10 r9
 #else
 	ld	r10,PACAKMSR(r13) /* Get kernel MSR without EE */
 	mtmsrd	r10,1		  /* Update machine state */
-- 
1.7.5.4

