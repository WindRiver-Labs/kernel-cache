From 96e00c66d7d719838c4628b3aef7d168c09b6133 Mon Sep 17 00:00:00 2001
From: Bogdan Hamciuc <bogdan.hamciuc@freescale.com>
Date: Wed, 3 Apr 2013 12:56:08 +0300
Subject: [PATCH 447/547] phylib: Fix compile errors on xgmac_mdio

Signed-off-by: Bogdan Hamciuc <bogdan.hamciuc@freescale.com>
Change-Id: Ifa7cd8d12c4f3f460d1dffbacbd6b7857bb54364
Reviewed-on: http://git.am.freescale.net:8181/1027
Reviewed-by: Fleming Andrew-AFLEMING <AFLEMING@freescale.com>
Tested-by: Fleming Andrew-AFLEMING <AFLEMING@freescale.com>
[Original patch taken from QorIQ-SDK-V1.4-SOURCE-20130625-yocto.iso]
Signed-off-by: Bin Jiang <bin.jiang@windriver.com>
---
 drivers/net/ethernet/freescale/xgmac_mdio.c | 6 +++++-
 1 file changed, 5 insertions(+), 1 deletion(-)

diff --git a/drivers/net/ethernet/freescale/xgmac_mdio.c b/drivers/net/ethernet/freescale/xgmac_mdio.c
index 8faf5ec..7ef6115 100644
--- a/drivers/net/ethernet/freescale/xgmac_mdio.c
+++ b/drivers/net/ethernet/freescale/xgmac_mdio.c
@@ -31,6 +31,10 @@ struct tgec_mdio_controller {
 	__be32	mdio_addr;	/* MDIO address */
 } __packed;
 
+/* Taken from memac_mdio.c */
+#define MDIO_STAT_ENC (1 << 6)
+#define MDIO_STAT_HOLD_15_CLK (7 << 2)
+
 #define MDIO_STAT_CLKDIV(x)	(((x>>1) & 0xff) << 8)
 #define MDIO_STAT_BSY		(1 << 0)
 #define MDIO_STAT_RD_ER		(1 << 1)
@@ -98,7 +102,7 @@ static int xgmac_mdio_write(struct mii_bus *bus, int phy_id, int regnum, u16 val
 	if (regnum & MII_ADDR_C45) {
 		/* Clause 45 (ie 10G) */
 		dev_addr = (regnum >> 16) & 0x1f;
-		mdiostat |= MDIO_STAT_ENC | MDIO_STAT_HOLD_15_CLK;
+		mdio_stat |= MDIO_STAT_ENC | MDIO_STAT_HOLD_15_CLK;
 	} else {
 		/* Clause 22 (ie 1G) */
 		dev_addr = regnum & 0x1f;
-- 
1.8.4.93.g57e4c17

