From 40e62ed9bb3aedf42dac87be2af75460583e9b78 Mon Sep 17 00:00:00 2001
From: Jiang Lu <lu.jiang@windriver.com>
Date: Thu, 29 Aug 2013 14:33:07 +0800
Subject: [PATCH 3/4] dpa:qman: fix kdump hang

When kdump runs, the second kernel always gets a failure when qman_init_fq()
is called, but the ethernet can still work well when we skip the failure.
So return value judgements commented off here and kdump can work well now

Signed-off-by: Jiang Lu <lu.jiang@windriver.com>
---
 drivers/staging/fsl_qbman/qman_high.c |    2 ++
 1 files changed, 2 insertions(+), 0 deletions(-)

diff --git a/drivers/staging/fsl_qbman/qman_high.c b/drivers/staging/fsl_qbman/qman_high.c
index d57871c..f23d77b 100644
--- a/drivers/staging/fsl_qbman/qman_high.c
+++ b/drivers/staging/fsl_qbman/qman_high.c
@@ -1466,10 +1466,12 @@ int qman_init_fq(struct qman_fq *fq, u32 flags, struct qm_mcc_initfq *opts)
 	DPA_ASSERT((mcr->verb & QM_MCR_VERB_MASK) == myverb);
 	res = mcr->result;
 	if (res != QM_MCR_RESULT_OK) {
+#ifndef CONFIG_CRASH_DUMP
 		FQUNLOCK(fq);
 		PORTAL_IRQ_UNLOCK(p, irqflags);
 		put_affine_portal();
 		return -EIO;
+#endif
 	}
 	if (opts) {
 		if (opts->we_mask & QM_INITFQ_WE_FQCTRL) {
-- 
1.7.5.4

