From ab11122c7b594bda8a8165d4c441a9d9f37fdcee Mon Sep 17 00:00:00 2001
From: Madalin Bucur <madalin.bucur@freescale.com>
Date: Tue, 23 Apr 2013 14:38:01 +0300
Subject: [PATCH 215/547] dpaa_eth: make use of alloc_percpu()

Simplify code using alloc_percpu() instead of __alloc_percpu().

Signed-off-by: Madalin Bucur <madalin.bucur@freescale.com>

Change-Id: I8d8f003e7506bdea4113b1ec69aaa54b230b62ea
Reviewed-on: http://git.am.freescale.net:8181/1739
Reviewed-by: Sovaiala Cristian-Constantin-B39531 <Cristian.Sovaiala@freescale.com>
Reviewed-by: Fleming Andrew-AFLEMING <AFLEMING@freescale.com>
Tested-by: Fleming Andrew-AFLEMING <AFLEMING@freescale.com>
[Original patch taken from QorIQ-SDK-V1.4-SOURCE-20130625-yocto.iso]
Signed-off-by: Bin Jiang <bin.jiang@windriver.com>
---
 drivers/net/ethernet/freescale/dpa/dpaa_eth.c    | 9 ++++-----
 drivers/net/ethernet/freescale/dpa/dpaa_eth_sg.c | 3 +--
 2 files changed, 5 insertions(+), 7 deletions(-)

diff --git a/drivers/net/ethernet/freescale/dpa/dpaa_eth.c b/drivers/net/ethernet/freescale/dpa/dpaa_eth.c
index 542e3dc..3a07949 100644
--- a/drivers/net/ethernet/freescale/dpa/dpaa_eth.c
+++ b/drivers/net/ethernet/freescale/dpa/dpaa_eth.c
@@ -341,8 +341,7 @@ void dpa_make_private_pool(struct dpa_bp *dpa_bp)
 {
 	int i;
 
-	dpa_bp->percpu_count = __alloc_percpu(sizeof(*dpa_bp->percpu_count),
-			__alignof__(*dpa_bp->percpu_count));
+	dpa_bp->percpu_count = alloc_percpu(*dpa_bp->percpu_count);
 
 	/* Give each cpu an allotment of "count" buffers */
 	for_each_online_cpu(i) {
@@ -4211,10 +4210,10 @@ dpaa_eth_probe(struct platform_device *_of_dev)
 	}
 
 	/* Now we need to initialize either a private or shared interface */
-	priv->percpu_priv = __alloc_percpu(sizeof(*priv->percpu_priv),
-					   __alignof__(*priv->percpu_priv));
+	priv->percpu_priv = alloc_percpu(*priv->percpu_priv);
+
 	if (priv->percpu_priv == NULL) {
-		dev_err(dev, "__alloc_percpu() failed\n");
+		dev_err(dev, "alloc_percpu() failed\n");
 		err = -ENOMEM;
 		goto alloc_percpu_failed;
 	}
diff --git a/drivers/net/ethernet/freescale/dpa/dpaa_eth_sg.c b/drivers/net/ethernet/freescale/dpa/dpaa_eth_sg.c
index a9c3f04..8307f77 100644
--- a/drivers/net/ethernet/freescale/dpa/dpaa_eth_sg.c
+++ b/drivers/net/ethernet/freescale/dpa/dpaa_eth_sg.c
@@ -199,8 +199,7 @@ void dpa_make_private_pool(struct dpa_bp *dpa_bp)
 {
 	int i;
 
-	dpa_bp->percpu_count = __alloc_percpu(sizeof(*dpa_bp->percpu_count),
-					__alignof__(*dpa_bp->percpu_count));
+	dpa_bp->percpu_count = alloc_percpu(*dpa_bp->percpu_count);
 
 	/* Give each CPU an allotment of "page_count" buffers */
 	for_each_online_cpu(i) {
-- 
1.8.4.93.g57e4c17

