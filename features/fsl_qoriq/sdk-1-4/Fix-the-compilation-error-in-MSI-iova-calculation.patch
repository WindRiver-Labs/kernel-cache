From cf9e8901d2a9f6b68e3a4738b3f7071fa057ae90 Mon Sep 17 00:00:00 2001
From: Bharat Bhushan <bharat.bhushan@freescale.com>
Date: Tue, 23 Apr 2013 15:54:33 +0530
Subject: [PATCH 118/547] Fix the compilation error in MSI iova calculation

There were couple of issue:
 - MSIIR address is uint64_t while it was passed to a function which expect
   this to dma_addr_t. And dma_addr_t can be 32 bit also.
 - do_div() expect uint64_t as first parameter while it was passed dma_addr_t.

Both of these changed be uint64_t.

Signed-off-by: Bharat Bhushan <bharat.bhushan@freescale.com>
Signed-off-by: Harninder Rai <harninder.rai@freescale.com>
Change-Id: Icca7eafef4fa63bc5daf355ebc0ba85a2111495a
Reviewed-on: http://git.am.freescale.net:8181/1732
Reviewed-by: Yoder Stuart-B08248 <stuart.yoder@freescale.com>
Reviewed-by: Fleming Andrew-AFLEMING <AFLEMING@freescale.com>
Tested-by: Fleming Andrew-AFLEMING <AFLEMING@freescale.com>
[Original patch taken from QorIQ-SDK-V1.4-SOURCE-20130625-yocto.iso]
Signed-off-by: Bin Jiang <bin.jiang@windriver.com>
---
 arch/powerpc/sysdev/fsl_msi.c | 4 ++--
 1 file changed, 2 insertions(+), 2 deletions(-)

diff --git a/arch/powerpc/sysdev/fsl_msi.c b/arch/powerpc/sysdev/fsl_msi.c
index a902de9..b346247 100644
--- a/arch/powerpc/sysdev/fsl_msi.c
+++ b/arch/powerpc/sysdev/fsl_msi.c
@@ -166,12 +166,12 @@ static void fsl_teardown_msi_irqs(struct pci_dev *pdev)
 	return;
 }
 
-static int fsl_iommu_get_iova(struct pci_dev *pdev, dma_addr_t *address)
+static int fsl_iommu_get_iova(struct pci_dev *pdev, uint64_t *address)
 {
 	struct iommu_domain *domain;
 	struct iommu_domain_geometry geometry;
 	u32 wins = 0;
-	dma_addr_t iova, size, msi_phys;
+	uint64_t iova, size, msi_phys;
 	int ret, i;
 
 	domain = iommu_get_dev_domain(&pdev->dev);
-- 
1.8.4.93.g57e4c17

