From 16a52f401770841001f2a38f759bdaf6b2d1558f Mon Sep 17 00:00:00 2001
From: Jiang Lu <lu.jiang@windriver.com>
Date: Fri, 21 Jun 2013 16:41:23 +0800
Subject: [PATCH 075/430] dpa_offload: Makefile and Kconfig for DPA Offload
 module

Makefile - compiles DPA Classifier, IPSec and Stats components and
creates the dpa_offload.ko module when required or makes the
module built in kernel.

Kconfig - configure "Freescale Datapath Offloading Driver"

Signed-off-by: Andrei Varvara <andrei.varvara@freescale.com>
Change-Id: I06894635e95b88f165ad121a81c96801ba44b00a
Reviewed-on: http://git.am.freescale.net:8181/2239
Reviewed-by: Fleming Andrew-AFLEMING <AFLEMING@freescale.com>
Tested-by: Fleming Andrew-AFLEMING <AFLEMING@freescale.com>
[Original patch is from QorIQ-SDK-V1.4-20130625-yocto, just
a minor modification to port 3.4 kernel]
Signed-off-by: Jiang Lu <lu.jiang@windriver.com>
---
 drivers/staging/Kconfig                  |    2 +
 drivers/staging/Makefile                 |    1 +
 drivers/staging/fsl_dpa_offload/Kconfig  |   15 +++++++++
 drivers/staging/fsl_dpa_offload/Makefile |   49 ++++++++++++++++++++++++++++++
 4 files changed, 67 insertions(+), 0 deletions(-)
 create mode 100644 drivers/staging/fsl_dpa_offload/Kconfig
 create mode 100644 drivers/staging/fsl_dpa_offload/Makefile

diff --git a/drivers/staging/Kconfig b/drivers/staging/Kconfig
index f21b05d..8ecba16 100644
--- a/drivers/staging/Kconfig
+++ b/drivers/staging/Kconfig
@@ -142,4 +142,6 @@ source "drivers/staging/fsl_pme2/Kconfig"
 
 source "drivers/staging/fsl_rman/Kconfig"
 
+source "drivers/staging/fsl_dpa_offload/Kconfig"
+
 endif # STAGING
diff --git a/drivers/staging/Makefile b/drivers/staging/Makefile
index f5bedc7..547392f 100644
--- a/drivers/staging/Makefile
+++ b/drivers/staging/Makefile
@@ -61,4 +61,5 @@ obj-$(CONFIG_USB_WPAN_HCD)	+= ozwpan/
 obj-$(CONFIG_FSL_DPA)		+= fsl_qbman/
 obj-$(CONFIG_FSL_PME2)		+= fsl_pme2/
 obj-$(CONFIG_FSL_RMAN_UIO)	+= fsl_rman/
+obj-$(CONFIG_FSL_DPA_OFFLOAD)  += fsl_dpa_offload/
 obj-$(CONFIG_LTTNG2)		+= lttng2/
diff --git a/drivers/staging/fsl_dpa_offload/Kconfig b/drivers/staging/fsl_dpa_offload/Kconfig
new file mode 100644
index 0000000..51a556c
--- /dev/null
+++ b/drivers/staging/fsl_dpa_offload/Kconfig
@@ -0,0 +1,15 @@
+
+config FSL_DPA_OFFLOAD
+	tristate "Freescale Datapath Offloading Driver"
+	depends on FSL_FMAN
+	default n
+	---help---
+		The driver supports DPAA offloading capabilities.
+		    * Classifier component makes possible the offloading of
+		      classification rules by configuring the FMAN hardware.
+		    * DPA IPsec component makes possible the offloading of
+		      security operations (ESP) by configuring the onboard
+		      SEC 4.x.
+
+		To compile this driver as a module, choose M here. The module
+		will be called dpa_offload.
diff --git a/drivers/staging/fsl_dpa_offload/Makefile b/drivers/staging/fsl_dpa_offload/Makefile
new file mode 100644
index 0000000..e4d4f3f
--- /dev/null
+++ b/drivers/staging/fsl_dpa_offload/Makefile
@@ -0,0 +1,49 @@
+################################################################################
+#Copyright 2008-2013 Freescale Semiconductor, Inc.
+#
+# Redistribution and use in source and binary forms, with or without
+# modification, are permitted provided that the following conditions are met:
+#	* Redistributions of source code must retain the above copyright
+#	  notice, this list of conditions and the following disclaimer.
+#	* Redistributions in binary form must reproduce the above copyright
+#	  notice, this list of conditions and the following disclaimer in the
+#	  documentation and/or other materials provided with the distribution.
+#	  Neither the name of Freescale Semiconductor nor the
+#	  names of its contributors may be used to endorse or promote products
+#	  derived from this software without specific prior written permission.
+#
+# ALTERNATIVELY, this software may be distributed under the terms of the
+# GNU General Public License ("GPL") as published by the Free Software
+# Foundation, either version 2 of that License or (at your option) any
+# later version.
+#
+# THIS SOFTWARE IS PROVIDED BY Freescale Semiconductor ``AS IS'' AND ANY
+# EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE IMPLIED
+# WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE ARE
+# DISCLAIMED. IN NO EVENT SHALL Freescale Semiconductor BE LIABLE FOR ANY
+# DIRECT, INDIRECT, INCIDENTAL, SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES
+# (INCLUDING, BUT NOT LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES;
+# LOSS OF USE, DATA, OR PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND
+# ON ANY THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT
+# (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE OF THIS
+# SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.
+################################################################################
+
+#
+# Makefile for the DPA Offloading driver
+#
+
+#Include NetComm SW specific definitions
+include $(srctree)/drivers/net/ethernet/freescale/fman/ncsw_config.mk
+
+EXTRA_CFLAGS += \
+	-Idrivers/crypto/caam \
+	-Idrivers/net/ethernet/freescale/fman/src/wrapper \
+	-Idrivers/net/ethernet/freescale/fman/Peripherals/FM/Pcd \
+	-Idrivers/net/ethernet/freescale/fman/Peripherals/FM/inc
+
+obj-$(CONFIG_FSL_DPA_OFFLOAD) += dpa_offload.o
+
+dpa_offload-objs := dpa_classifier.o dpa_ipsec.o dpa_ipsec_desc.o \
+		cq.o dpa_stats.o wrp_dpa_classifier.o wrp_dpa_ipsec.o \
+		wrp_dpa_stats.o dpa_offload_module.o
-- 
1.7.5.4

