From 4df1192bbe3ca46f1f0fa614fecb0d6db14776c8 Mon Sep 17 00:00:00 2001
From: Kevin Hao <kexin.hao@windriver.com>
Date: Mon, 7 Jan 2013 10:48:30 +0800
Subject: [PATCH 001/547] powerpc: apply the mfcrf workaround to all the
 embedded ppc64 cores

The patch (powerpc: update compilation flags to support e5500
instructions) introduces a workaround for the toolchain mfcrf issue
for the fsl e5500 core. But this issue apples to all the embedded ppc64
cores. So make the kernel option name more general and enable it for
all the book3e 64 cores.

Signed-off-by: Kevin Hao <kexin.hao@windriver.com>
Signed-off-by: Bin Jiang <bin.jiang@windriver.com>
---
 arch/powerpc/Makefile               | 1 +
 arch/powerpc/platforms/85xx/Kconfig | 4 ++++
 2 files changed, 5 insertions(+)

diff --git a/arch/powerpc/Makefile b/arch/powerpc/Makefile
index 61675af..a897bd3 100644
--- a/arch/powerpc/Makefile
+++ b/arch/powerpc/Makefile
@@ -140,6 +140,7 @@ endif
 cpu-as-$(CONFIG_4xx)		+= -Wa,-m405
 cpu-as-$(CONFIG_ALTIVEC)	+= -Wa,-maltivec
 cpu-as-$(CONFIG_E500)		+= -Wa,-me500
+cpu-as-$(CONFIG_WORKAROUND_BOOK3E_64_MFCR) += -mno-mfcrf
 cpu-as-$(CONFIG_E200)		+= -Wa,-me200
 
 KBUILD_AFLAGS += $(cpu-as-y)
diff --git a/arch/powerpc/platforms/85xx/Kconfig b/arch/powerpc/platforms/85xx/Kconfig
index efdd37c..70f81fe 100644
--- a/arch/powerpc/platforms/85xx/Kconfig
+++ b/arch/powerpc/platforms/85xx/Kconfig
@@ -275,6 +275,10 @@ config P5020_DS
 	help
 	  This option enables support for the P5020 DS board
 
+config WORKAROUND_BOOK3E_64_MFCR
+	def_bool y
+	depends on PPC_BOOK3E_64
+
 config P5040_DS
 	bool "Freescale P5040 DS"
 	select DEFAULT_UIMAGE
-- 
1.8.4.93.g57e4c17

