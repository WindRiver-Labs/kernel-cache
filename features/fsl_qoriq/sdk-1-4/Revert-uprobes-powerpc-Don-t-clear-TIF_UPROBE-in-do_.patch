From 0da6c95f5e85a016dc13348e23562a9724457603 Mon Sep 17 00:00:00 2001
From: Yang Wei <Wei.Yang@windriver.com>
Date: Mon, 9 Sep 2013 13:47:25 +0800
Subject: [PATCH 2/2] Revert "uprobes/powerpc: Don't clear TIF_UPROBE in
 do_notify_resume()"

This reverts commit 694264d6e881984cac1316dd39c8fbf649c8e512.

The clear_thread_flag(TIF_UPROBE) function is not moved from do_notify_resume() to
uprobe_notify_resume() in our kernel, so we need to revert the patch.

Signed-off-by: Yang Wei <wei.yang@windriver.com>
---
 arch/powerpc/kernel/signal.c |    4 +++-
 1 files changed, 3 insertions(+), 1 deletions(-)

diff --git a/arch/powerpc/kernel/signal.c b/arch/powerpc/kernel/signal.c
index f0bd204..e72fb65 100644
--- a/arch/powerpc/kernel/signal.c
+++ b/arch/powerpc/kernel/signal.c
@@ -188,8 +188,10 @@ static int do_signal(struct pt_regs *regs)
 
 void do_notify_resume(struct pt_regs *regs, unsigned long thread_info_flags)
 {
-	if (thread_info_flags & _TIF_UPROBE)
+	if (thread_info_flags & _TIF_UPROBE) {
+		clear_thread_flag(TIF_UPROBE);
 		uprobe_notify_resume(regs);
+	}
 
 	if (thread_info_flags & _TIF_SIGPENDING)
 		do_signal(regs);
-- 
1.7.5.4

