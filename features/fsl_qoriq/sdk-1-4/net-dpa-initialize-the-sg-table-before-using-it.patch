From 89235c431542d514dff090437b0f5121ae67575c Mon Sep 17 00:00:00 2001
From: Kevin Hao <kexin.hao@windriver.com>
Date: Tue, 18 Sep 2012 13:21:19 +0800
Subject: [PATCH 462/547] net/dpa: initialize the sg table before using it

According to the DPAA manual, the reserved bits in sg table
must be 0. So we should initialize all the reserved bits in sg
table to 0 before using it. This also fix a bug where the simics
would interpret the buffer address as 48bit (40 bit in fact) and
then get a wrong buffer address if there are some noise in the
first reserve area.

Signed-off-by: Kevin Hao <kexin.hao@windriver.com>
Signed-off-by: Bin Jiang <bin.jiang@windriver.com>
---
 drivers/net/ethernet/freescale/dpa/dpaa_eth.c | 1 +
 1 file changed, 1 insertion(+)

diff --git a/drivers/net/ethernet/freescale/dpa/dpaa_eth.c b/drivers/net/ethernet/freescale/dpa/dpaa_eth.c
index d6c902b..c1e1638 100644
--- a/drivers/net/ethernet/freescale/dpa/dpaa_eth.c
+++ b/drivers/net/ethernet/freescale/dpa/dpaa_eth.c
@@ -1887,6 +1887,7 @@ static int skb_to_sg_fd(struct dpa_priv_s *priv,
 
 	/* Fill in S/G entry */
 	sg_entry = (struct qm_sg_entry *)(vaddr + fd->offset);
+	memset(sg_entry, 0, sizeof(*sg_entry));
 
 	sg_entry->extension = 0;
 	sg_entry->final = 1;
-- 
1.8.4.93.g57e4c17

