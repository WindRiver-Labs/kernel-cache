From a022a97efa1c1a514bdb0f7cdc0ae5ebe29be392 Mon Sep 17 00:00:00 2001
From: Wei Yang <Wei.Yang@windriver.com>
Date: Tue, 9 Jul 2013 14:27:17 +0800
Subject: [PATCH 329/430] net/mdio-mux: make driver requested deferred probing

The mdio_mux_mmioreg_driver is registered prior to mdio driver such
as xgmac mdio. We can check the System.map file to validate it.

c000000000ba9438 t __initcall_mdio_mux_mmioreg_driver_init6
c000000000ba9440 t __initcall_xgmac_mdio_driver_init6

So if the probe of mdio_mux_mmioreg fails, we need to return
EPROBE_DEFER to tell platform infrastructure the probe of driver
need to be deferred.

Signed-off-by: Wei Yang <Wei.Yang@windriver.com>
---
 drivers/net/phy/mdio-mux.c |    2 +-
 1 files changed, 1 insertions(+), 1 deletions(-)

diff --git a/drivers/net/phy/mdio-mux.c b/drivers/net/phy/mdio-mux.c
index 15a88cb..ccd0c9a 100644
--- a/drivers/net/phy/mdio-mux.c
+++ b/drivers/net/phy/mdio-mux.c
@@ -110,7 +110,7 @@ int mdio_mux_init(struct device *dev,
 
 	parent_bus = of_mdio_find_bus(parent_bus_node);
 	if (parent_bus == NULL) {
-		ret_val = -ENODEV;
+		ret_val = -EPROBE_DEFER;
 		goto err_parent_bus;
 	}
 
-- 
1.7.5.4

