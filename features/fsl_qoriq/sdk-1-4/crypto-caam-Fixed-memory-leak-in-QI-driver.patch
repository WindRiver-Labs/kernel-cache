From ffa75bbe7ae0f1bdc28c8c1794a335aa09982d23 Mon Sep 17 00:00:00 2001
From: Vakul Garg <vakul@freescale.com>
Date: Tue, 28 May 2013 12:55:51 +0530
Subject: [PATCH 196/430] crypto: caam - Fixed memory leak in QI driver

The function caam_drv_ctx_rel() did not release the memory allocated for
driver context. Added kfree() for cleanup.

Change-Id: If44af08f4be6992f428414ac83c029a79e4de6c6
Signed-off-by: Vakul Garg <vakul@freescale.com>
Reviewed-on: http://git.am.freescale.net:8181/2733
Tested-by: Review Code-CDREVIEW <CDREVIEW@freescale.com>
Reviewed-by: Geanta Neag Horia Ioan-B05471 <horia.geanta@freescale.com>
Reviewed-by: Fleming Andrew-AFLEMING <AFLEMING@freescale.com>
Tested-by: Fleming Andrew-AFLEMING <AFLEMING@freescale.com>
[original patch is from QorIQ-SDK-V1.4-20130625-yocto]
Signed-off-by: Jiang Lu <lu.jiang@windriver.com>
---
 drivers/crypto/caam/qi.c |    2 ++
 1 files changed, 2 insertions(+), 0 deletions(-)

diff --git a/drivers/crypto/caam/qi.c b/drivers/crypto/caam/qi.c
index 88c99bf..7ec0b58 100644
--- a/drivers/crypto/caam/qi.c
+++ b/drivers/crypto/caam/qi.c
@@ -368,6 +368,8 @@ void caam_drv_ctx_rel(struct caam_drv_ctx *drv_ctx)
 
 	dma_unmap_single(drv_ctx->qidev, dma_unmap_addr(drv_ctx, context_a),
 			 size, DMA_BIDIRECTIONAL);
+
+	kfree(drv_ctx);
 }
 EXPORT_SYMBOL(caam_drv_ctx_rel);
 
-- 
1.7.5.4

