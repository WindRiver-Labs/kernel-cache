From 8783533d4d7066010986c47a637aa9b99eaac978 Mon Sep 17 00:00:00 2001
From: Vakul Garg <vakul@freescale.com>
Date: Tue, 28 May 2013 12:55:51 +0530
Subject: [PATCH 087/547] crypto: caam - Fixed memory leak in QI driver

The function caam_drv_ctx_rel() did not release the memory allocated for
driver context. Added kfree() for cleanup.

Change-Id: If44af08f4be6992f428414ac83c029a79e4de6c6
Signed-off-by: Vakul Garg <vakul@freescale.com>
Reviewed-on: http://git.am.freescale.net:8181/2733
Tested-by: Review Code-CDREVIEW <CDREVIEW@freescale.com>
Reviewed-by: Geanta Neag Horia Ioan-B05471 <horia.geanta@freescale.com>
Reviewed-by: Fleming Andrew-AFLEMING <AFLEMING@freescale.com>
Tested-by: Fleming Andrew-AFLEMING <AFLEMING@freescale.com>
[Original patch taken from QorIQ-SDK-V1.4-SOURCE-20130625-yocto.iso]
Signed-off-by: Bin Jiang <bin.jiang@windriver.com>
---
 drivers/crypto/caam/qi.c | 2 ++
 1 file changed, 2 insertions(+)

diff --git a/drivers/crypto/caam/qi.c b/drivers/crypto/caam/qi.c
index 88c99bf..7ec0b58 100644
--- a/drivers/crypto/caam/qi.c
+++ b/drivers/crypto/caam/qi.c
@@ -368,6 +368,8 @@ void caam_drv_ctx_rel(struct caam_drv_ctx *drv_ctx)
 
 	dma_unmap_single(drv_ctx->qidev, dma_unmap_addr(drv_ctx, context_a),
 			 size, DMA_BIDIRECTIONAL);
+
+	kfree(drv_ctx);
 }
 EXPORT_SYMBOL(caam_drv_ctx_rel);
 
-- 
1.8.4.93.g57e4c17

