From b31e386f0ce3ee6c5e4e710f978fc78d0ccac3fa Mon Sep 17 00:00:00 2001
From: Madalin Bucur <madalin.bucur@freescale.com>
Date: Thu, 18 Apr 2013 14:03:01 +0000
Subject: [PATCH 206/547] dpaa_eth: make use of skb_frag_dma_map()

Use convenience function to map fragment page.

Signed-off-by: Madalin Bucur <madalin.bucur@freescale.com>
Change-Id: If99e0692bddcd50661fb78be089d8f89c720cbca
Reviewed-on: http://git.am.freescale.net:8181/1536
Reviewed-by: Hamciuc Bogdan-BHAMCIU1 <bogdan.hamciuc@freescale.com>
Reviewed-by: Sovaiala Cristian-Constantin-B39531 <Cristian.Sovaiala@freescale.com>
Reviewed-by: Fleming Andrew-AFLEMING <AFLEMING@freescale.com>
Tested-by: Fleming Andrew-AFLEMING <AFLEMING@freescale.com>
[Original patch taken from QorIQ-SDK-V1.4-SOURCE-20130625-yocto.iso]
Signed-off-by: Bin Jiang <bin.jiang@windriver.com>
---
 drivers/net/ethernet/freescale/dpa/dpaa_eth_sg.c | 4 ++--
 1 file changed, 2 insertions(+), 2 deletions(-)

diff --git a/drivers/net/ethernet/freescale/dpa/dpaa_eth_sg.c b/drivers/net/ethernet/freescale/dpa/dpaa_eth_sg.c
index b50ccab..48f32fe 100644
--- a/drivers/net/ethernet/freescale/dpa/dpaa_eth_sg.c
+++ b/drivers/net/ethernet/freescale/dpa/dpaa_eth_sg.c
@@ -674,8 +674,8 @@ static int __hot skb_to_sg_fd(struct dpa_priv_s *priv,
 		/* This shouldn't happen */
 		BUG_ON(!frag->page.p);
 
-		addr = dma_map_page(dpa_bp->dev, skb_frag_page(frag),
-			frag->page_offset, dpa_bp->size, dma_dir);
+		addr = skb_frag_dma_map(dpa_bp->dev, frag, 0, dpa_bp->size,
+					dma_dir);
 
 		if (unlikely(dma_mapping_error(dpa_bp->dev, addr))) {
 			dev_err(dpa_bp->dev, "DMA mapping failed");
-- 
1.8.4.93.g57e4c17

