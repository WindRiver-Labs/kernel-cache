From f74d72cf7c73642766a6bb4cfea4dd8ea7439501 Mon Sep 17 00:00:00 2001
From: Cristian Sovaiala <cristian.sovaiala@freescale.com>
Date: Thu, 14 Mar 2013 19:56:11 +0000
Subject: [PATCH 193/547] dpaa_eth: MTU checking is not necessary for IP
 Reassembled frames

Do not limit IP Reassembled frames to MTU size.

Change-Id: I8ec3ca5e23165d7ee6397935dff26c7a18903fef
Signed-off-by: Cristian Sovaiala <cristian.sovaiala@freescale.com>
Reviewed-on: http://git.am.freescale.net:8181/1280
Reviewed-by: Fleming Andrew-AFLEMING <AFLEMING@freescale.com>
Tested-by: Fleming Andrew-AFLEMING <AFLEMING@freescale.com>
[Original patch taken from QorIQ-SDK-V1.4-SOURCE-20130625-yocto.iso]
Signed-off-by: Bin Jiang <bin.jiang@windriver.com>
---
 drivers/net/ethernet/freescale/dpa/dpaa_eth.c | 4 +++-
 1 file changed, 3 insertions(+), 1 deletion(-)

diff --git a/drivers/net/ethernet/freescale/dpa/dpaa_eth.c b/drivers/net/ethernet/freescale/dpa/dpaa_eth.c
index ec3ad8c..e4f8efa 100644
--- a/drivers/net/ethernet/freescale/dpa/dpaa_eth.c
+++ b/drivers/net/ethernet/freescale/dpa/dpaa_eth.c
@@ -2104,7 +2104,9 @@ shared_rx_dqrr(struct qman_portal *portal, struct qman_fq *fq,
 skb_copied:
 	skb->protocol = eth_type_trans(skb, net_dev);
 
-	if (unlikely(dpa_check_rx_mtu(skb, net_dev->mtu))) {
+	/* IP Reassembled frames are allowed to be larger than MTU */
+	if (unlikely(dpa_check_rx_mtu(skb, net_dev->mtu) &&
+		!(fd->status & FM_FD_IPR))) {
 		percpu_priv->stats.rx_dropped++;
 		dev_kfree_skb_any(skb);
 		goto out;
-- 
1.8.4.93.g57e4c17

