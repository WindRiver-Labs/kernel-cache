From 5215f6594cd9474c8018704d656f2acae1c6f2a8 Mon Sep 17 00:00:00 2001
From: Haijun Zhang <haijun.zhang@freescale.com>
Date: Thu, 11 Apr 2013 09:09:01 +0800
Subject: [PATCH 266/430] eSDHC: Add broken ADMA quirk for T4 board

eMMC build-in in T4 board can't work when use ADMA transfer data,
but for SDHC card it work well. No ERRATA and relevant bugfix
for this issue, so use SDMA instead get it working fist.

Signed-off-by: Haijun Zhang <Haijun.Zhang@freescale.com>
Signed-off-by: Jerry Huang <Chang-Ming.Huang@freescale.com>
Signed-off-by: Chunhe Lan <Chunhe.Lan@freescale.com>
Signed-off-by: Andy Fleming <afleming@freescale.com>
Change-Id: Ifdb8cf3caa7b1904c252e435e94254d089ec23c4
Reviewed-on: http://git.am.freescale.net:8181/1215
Tested-by: Fleming Andrew-AFLEMING <AFLEMING@freescale.com>
Reviewed-by: Fleming Andrew-AFLEMING <AFLEMING@freescale.com>
[Original patch is from QorIQ-SDK-V1.4-20130625-yocto, just a minor
modification to port 3.4 kernel]
Signed-off-by: Jiang Lu <lu.jiang@windriver.com>
---
 drivers/mmc/host/sdhci-pltfm.c |    5 +----
 1 files changed, 1 insertions(+), 4 deletions(-)

diff --git a/drivers/mmc/host/sdhci-pltfm.c b/drivers/mmc/host/sdhci-pltfm.c
index 5718157..1d27044 100644
--- a/drivers/mmc/host/sdhci-pltfm.c
+++ b/drivers/mmc/host/sdhci-pltfm.c
@@ -87,14 +87,11 @@ void sdhci_get_of_property(struct platform_device *pdev)
 			host->quirks |= SDHCI_QUIRK_BROKEN_TIMEOUT_VAL;
 
 		if (of_device_is_compatible(np, "fsl,t4240-esdhc")) {
-			host->quirks |= SDHCI_QUIRK_BROKEN_ADMA;
-		}
-
-		if (of_device_is_compatible(np, "fsl,t4240-esdhc")) {
 			host->quirks2 |= SDHCI_QUIRK2_BROKEN_RESET_ALL;
 			host->quirks2 |= SDHCI_QUIRK2_LONG_TIME_CMD_COMPLETE_IRQ;
 			host->quirks2 |= SDHCI_QUIRK2_CIRCUIT_SUPPORT_VS33;
 			host->quirks2 |= SDHCI_QUIRK2_FORCE_CMD13_DETECT_CARD;
+			host->quirks |= SDHCI_QUIRK_BROKEN_ADMA;
 		}
 
 		if (of_device_is_compatible(np, "fsl,p4860-rev1-esdhc") ||
-- 
1.7.5.4

