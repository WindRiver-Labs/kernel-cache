From fe4bbec14f228528fd1f686a4e17135a7eba6f47 Mon Sep 17 00:00:00 2001
From: Roy Zang <tie-fei.zang@freescale.com>
Date: Thu, 28 Mar 2013 00:21:30 +0800
Subject: [PATCH 232/430] powerpc/pci: fix 64 bit pci size issue

The size might be 64 bit, so use __ilog2_u64() instead of __ilog2().

Signed-off-by: Roy Zang <tie-fei.zang@freescale.com>
Change-Id: I4c0cec016258cf46fa943d813b6fcbf59371960e
Reviewed-on: http://git.am.freescale.net:8181/743
Reviewed-by: Fleming Andrew-AFLEMING <AFLEMING@freescale.com>
Tested-by: Fleming Andrew-AFLEMING <AFLEMING@freescale.com>
[original patch is from QorIQ-SDK-V1.4-20130625-yocto]
Signed-off-by: Jiang Lu <lu.jiang@windriver.com>
---
 arch/powerpc/sysdev/fsl_pci.c |    4 ++--
 1 files changed, 2 insertions(+), 2 deletions(-)

diff --git a/arch/powerpc/sysdev/fsl_pci.c b/arch/powerpc/sysdev/fsl_pci.c
index 8a9e04a..1f3ed17 100644
--- a/arch/powerpc/sysdev/fsl_pci.c
+++ b/arch/powerpc/sysdev/fsl_pci.c
@@ -143,7 +143,7 @@ static int __init setup_one_atmu(struct ccsr_pci __iomem *pci,
 		flags |= 0x10000000; /* enable relaxed ordering */
 
 	for (i = 0; size > 0; i++) {
-		unsigned int bits = min(__ilog2(size),
+		unsigned int bits = min(__ilog2_u64(size),
 					__ffs(pci_addr | phys_addr));
 
 		if (index + i >= 5)
@@ -252,7 +252,7 @@ static void __init setup_pci_atmu(struct pci_controller *hose,
 			out_be32(&pci->pow[j].powbar, (hose->io_base_phys >> 12));
 			/* Enable, IO R/W */
 			out_be32(&pci->pow[j].powar, 0x80088000
-				| (__ilog2(hose->io_resource.end
+				| (__ilog2_u64(hose->io_resource.end
 				- hose->io_resource.start + 1) - 1));
 		}
 	}
-- 
1.7.5.4

