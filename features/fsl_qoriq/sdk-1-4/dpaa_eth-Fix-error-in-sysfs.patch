From de83dfd44a99b78ed223d57ed0b0ac959d9ab836 Mon Sep 17 00:00:00 2001
From: Ioana Radulescu <ruxandra.radulescu@freescale.com>
Date: Thu, 31 Jan 2013 23:56:08 +0000
Subject: [PATCH 174/547] dpaa_eth: Fix error in sysfs

Trying to dump the MAC registers for MACless interfaces resulted
in a segmentation fault. Just print a message for the user instead
of accessing non-existent regs.

Change-Id: I425390fbdf6aa67fa96568a8861576b8706123e7
Signed-off-by: Ioana Radulescu <ruxandra.radulescu@freescale.com>
Reviewed-on: http://git.am.freescale.net:8181/1048
Reviewed-by: Fleming Andrew-AFLEMING <AFLEMING@freescale.com>
Tested-by: Fleming Andrew-AFLEMING <AFLEMING@freescale.com>
[Original patch taken from QorIQ-SDK-V1.4-SOURCE-20130625-yocto.iso]
Signed-off-by: Bin Jiang <bin.jiang@windriver.com>
---
 drivers/net/ethernet/freescale/dpa/dpaa_eth_sysfs.c | 5 ++++-
 1 file changed, 4 insertions(+), 1 deletion(-)

diff --git a/drivers/net/ethernet/freescale/dpa/dpaa_eth_sysfs.c b/drivers/net/ethernet/freescale/dpa/dpaa_eth_sysfs.c
index 69aa8f9..ac67774 100644
--- a/drivers/net/ethernet/freescale/dpa/dpaa_eth_sysfs.c
+++ b/drivers/net/ethernet/freescale/dpa/dpaa_eth_sysfs.c
@@ -143,7 +143,10 @@ static ssize_t dpaa_eth_show_mac_regs(struct device *dev,
 	struct dpa_priv_s *priv = netdev_priv(to_net_dev(dev));
 	struct mac_device *mac_dev = priv->mac_dev;
 
-	fm_mac_dump_regs(mac_dev);
+	if (mac_dev)
+		fm_mac_dump_regs(mac_dev);
+	else
+		return sprintf(buf, "no mac registers\n");
 
 	return 0;
 }
-- 
1.8.4.93.g57e4c17

