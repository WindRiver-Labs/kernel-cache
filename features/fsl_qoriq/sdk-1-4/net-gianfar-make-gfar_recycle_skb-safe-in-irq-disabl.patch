From ca969fbeef621c7c68be7f4b4d612887f0fef8b2 Mon Sep 17 00:00:00 2001
From: Kevin Hao <kexin.hao@windriver.com>
Date: Tue, 19 Nov 2013 16:36:25 +0800
Subject: [PATCH 3/3] net/gianfar: make gfar_recycle_skb() safe in irq disabled
 context

It may be used in irq disabled context, such as netconsole, kgdboe.
So we should use dev_kfree_skb_irq() instead of dev_kfree_skb().

Signed-off-by: Kevin Hao <kexin.hao@windriver.com>
---
 drivers/net/ethernet/freescale/gianfar.c | 2 +-
 1 file changed, 1 insertion(+), 1 deletion(-)

diff --git a/drivers/net/ethernet/freescale/gianfar.c b/drivers/net/ethernet/freescale/gianfar.c
index 8c63efa..2ea5c5c 100644
--- a/drivers/net/ethernet/freescale/gianfar.c
+++ b/drivers/net/ethernet/freescale/gianfar.c
@@ -3053,7 +3053,7 @@ static void gfar_recycle_skb(struct gfar_private *priv, struct sk_buff *skb)
 	return;
 
 free:
-	dev_kfree_skb(skb);
+	dev_kfree_skb_irq(skb);
 }
 
 /* Interrupt Handler for Transmit complete */
-- 
1.8.4.93.g57e4c17

