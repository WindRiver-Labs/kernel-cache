From c7888487b0196bfbe71456d726c2d7f81ea208e1 Mon Sep 17 00:00:00 2001
From: Bin Jiang <bin.jiang@windriver.com>
Date: Fri, 6 Sep 2013 15:49:25 +0800
Subject: [PATCH 547/547] powerpc/e6500: Copy lock value to Condition Register

The lock value is used to check whether TLB_PER_CORE_HAS_LOCK is clear.

Signed-off-by: Bin Jiang <bin.jiang@windriver.com>
---
 arch/powerpc/mm/tlb_low_64e.S | 1 +
 1 file changed, 1 insertion(+)

diff --git a/arch/powerpc/mm/tlb_low_64e.S b/arch/powerpc/mm/tlb_low_64e.S
index f2e1636..fddc8b6 100644
--- a/arch/powerpc/mm/tlb_low_64e.S
+++ b/arch/powerpc/mm/tlb_low_64e.S
@@ -228,6 +228,7 @@ tlb_miss_done_bolted:
 	.macro	tlb_unlock_bolted
 BEGIN_FTR_SECTION
 	ld	r10,PACA_TLB_PER_CORE_PTR(r13)
+	mtocrf	0x01,r10
 	bf	31,1f
 	li	r15,0
 	isync
-- 
1.8.4.93.g57e4c17

