From 87c886824a4dfddef9316719302681b38f43759a Mon Sep 17 00:00:00 2001
From: Andy Fleming <afleming@freescale.com>
Date: Thu, 11 Apr 2013 18:32:52 -0500
Subject: [PATCH 046/547] qoriq: Enable muxing MDIO buses

The MDIO muxing drivers needed to be enabled on the platforms
which use them, and the devices needed to be probed.

Change-Id: I6aa210cabb663f63c44c2ddfa5ccc9941e4799ab
Signed-off-by: Andy Fleming <afleming@freescale.com>
Reviewed-on: http://git.am.freescale.net:8181/1265
Reviewed-by: Fleming Andrew-AFLEMING <AFLEMING@freescale.com>
Tested-by: Fleming Andrew-AFLEMING <AFLEMING@freescale.com>
[Original patch taken from QorIQ-SDK-V1.4-SOURCE-20130625-yocto.iso]
Signed-off-by: Bin Jiang <bin.jiang@windriver.com>
---
 arch/powerpc/platforms/85xx/Kconfig      | 12 ++++++++++++
 arch/powerpc/platforms/85xx/corenet_ds.c |  6 ++++++
 2 files changed, 18 insertions(+)

diff --git a/arch/powerpc/platforms/85xx/Kconfig b/arch/powerpc/platforms/85xx/Kconfig
index ba0ec88..82402ee 100644
--- a/arch/powerpc/platforms/85xx/Kconfig
+++ b/arch/powerpc/platforms/85xx/Kconfig
@@ -243,6 +243,8 @@ config P3041_DS
 	select HAS_RAPIDIO
 	select PPC_EPAPR_HV_PIC
         select HAS_FSL_QBMAN
+	select MDIO_BUS_MUX if DPA_ETH
+	select MDIO_BUS_MUX_MMIOREG if DPA_ETH
 	help
 	  This option enables support for the P3041 DS board
 
@@ -257,6 +259,8 @@ config P4080_DS
 	select HAS_RAPIDIO
 	select PPC_EPAPR_HV_PIC
         select HAS_FSL_QBMAN
+	select MDIO_BUS_MUX if DPA_ETH
+	select MDIO_BUS_MUX_GPIO
 	help
 	  This option enables support for the P4080 DS board
 
@@ -282,6 +286,8 @@ config P5020_DS
 	select HAS_RAPIDIO
 	select PPC_EPAPR_HV_PIC
         select HAS_FSL_QBMAN
+	select MDIO_BUS_MUX if DPA_ETH
+	select MDIO_BUS_MUX_MMIOREG if DPA_ETH
 	help
 	  This option enables support for the P5020 DS board
 
@@ -301,6 +307,8 @@ config P5040_DS
 	select HAS_RAPIDIO
 	select PPC_EPAPR_HV_PIC
         select HAS_FSL_QBMAN
+	select MDIO_BUS_MUX if DPA_ETH
+	select MDIO_BUS_MUX_MMIOREG if DPA_ETH
 	help
 	  This option enables support for the P5040 DS board
 
@@ -333,6 +341,8 @@ config T4240_QDS
 	select HAS_RAPIDIO
 	select PPC_EPAPR_HV_PIC
 	select HAS_FSL_QBMAN
+	select MDIO_BUS_MUX if DPA_ETH
+	select MDIO_BUS_MUX_MMIOREG if DPA_ETH
 	help
 	  This option enables support for the T4240 QDS board
 
@@ -348,6 +358,8 @@ config B4_QDS
 	select HAS_RAPIDIO
 	select PPC_EPAPR_HV_PIC
 	select HAS_FSL_QBMAN
+	select MDIO_BUS_MUX if DPA_ETH
+	select MDIO_BUS_MUX_MMIOREG if DPA_ETH
 	help
 	  This option enables support for the B4 QDS board
 	  The B4 application development system B4 QDS is a complete
diff --git a/arch/powerpc/platforms/85xx/corenet_ds.c b/arch/powerpc/platforms/85xx/corenet_ds.c
index 7da3b05..0bddf7c 100644
--- a/arch/powerpc/platforms/85xx/corenet_ds.c
+++ b/arch/powerpc/platforms/85xx/corenet_ds.c
@@ -72,6 +72,12 @@ static const struct of_device_id of_device_ids[] = {
 		.compatible	= "fsl,dpaa",
 	},
 	{
+		.compatible	= "mdio-mux-gpio",
+	},
+	{
+		.compatible	= "fsl,fpga-ngpixis",
+	},
+	{
 		.compatible	= "fsl,srio",
 	},
 	{
-- 
1.8.4.93.g57e4c17

