From b530028381240645edbb627bca2c23f5b2f54328 Mon Sep 17 00:00:00 2001
From: Andy Fleming <afleming@freescale.com>
Date: Thu, 11 Apr 2013 18:32:52 -0500
Subject: [PATCH 334/430] qoriq: Enable muxing MDIO buses

The MDIO muxing drivers needed to be enabled on the platforms
which use them, and the devices needed to be probed.

Change-Id: I6aa210cabb663f63c44c2ddfa5ccc9941e4799ab
Signed-off-by: Andy Fleming <afleming@freescale.com>
Reviewed-on: http://git.am.freescale.net:8181/1265
Reviewed-by: Fleming Andrew-AFLEMING <AFLEMING@freescale.com>
Tested-by: Fleming Andrew-AFLEMING <AFLEMING@freescale.com>
[Original patch is from QorIQ-SDK-V1.4-20130625-yocto, just a minor
modification to port 3.4 kernel]
Signed-off-by: Wei Yang <Wei.Yang@windriver.com>
---
 arch/powerpc/platforms/85xx/Kconfig      |   12 ++++++++++++
 arch/powerpc/platforms/85xx/corenet_ds.c |    6 ++++++
 2 files changed, 18 insertions(+), 0 deletions(-)

diff --git a/arch/powerpc/platforms/85xx/Kconfig b/arch/powerpc/platforms/85xx/Kconfig
index eac5749..0d2a822 100644
--- a/arch/powerpc/platforms/85xx/Kconfig
+++ b/arch/powerpc/platforms/85xx/Kconfig
@@ -243,6 +243,8 @@ config P3041_DS
 	select HAS_FSL_PAMU
 	select HAS_FSL_QBMAN
 	select HAS_FSL_PME
+	select MDIO_BUS_MUX if DPA_ETH
+	select MDIO_BUS_MUX_MMIOREG if DPA_ETH
 	help
 	  This option enables support for the P3041 DS board
 
@@ -272,6 +274,8 @@ config P4080_DS
 	select HAS_FSL_PAMU
 	select HAS_FSL_QBMAN
 	select HAS_FSL_PME
+	select MDIO_BUS_MUX if DPA_ETH
+	select MDIO_BUS_MUX_GPIO
 	help
 	  This option enables support for the P4080 DS board
 
@@ -290,6 +294,8 @@ config B4_QDS
 	select HAS_RAPIDIO
 	select PPC_EPAPR_HV_PIC
 	select HAS_FSL_PAMU
+	select MDIO_BUS_MUX if DPA_ETH
+	select MDIO_BUS_MUX_MMIOREG if DPA_ETH
 	help
 	  This option enables support for the B4 QDS board
 
@@ -309,6 +315,8 @@ config P5020_DS
 	select HAS_FSL_PAMU
 	select HAS_FSL_QBMAN
 	select HAS_FSL_PME
+	select MDIO_BUS_MUX if DPA_ETH
+	select MDIO_BUS_MUX_MMIOREG if DPA_ETH
 	help
 	  This option enables support for the P5020 DS board
 
@@ -329,6 +337,8 @@ config P5040_DS
 	select HAS_FSL_PAMU
 	select HAS_FSL_QBMAN
 	select HAS_FSL_PME
+	select MDIO_BUS_MUX if DPA_ETH
+	select MDIO_BUS_MUX_MMIOREG if DPA_ETH
 	help
 	  This option enables support for the Freescale P5040 DS
 	  ("Super Hydra") reference board.
@@ -347,6 +357,8 @@ config T4240_QDS
 	select HAS_FSL_PAMU
 	select HAS_FSL_QBMAN
 	select HAS_FSL_PME
+	select MDIO_BUS_MUX if DPA_ETH
+	select MDIO_BUS_MUX_MMIOREG if DPA_ETH
 	help
 	  This option enables support for the T4240 QDS board
 
diff --git a/arch/powerpc/platforms/85xx/corenet_ds.c b/arch/powerpc/platforms/85xx/corenet_ds.c
index 7172f24..27e1a58 100644
--- a/arch/powerpc/platforms/85xx/corenet_ds.c
+++ b/arch/powerpc/platforms/85xx/corenet_ds.c
@@ -91,6 +91,12 @@ static const struct of_device_id of_device_ids[] __devinitconst = {
 	{
 		.compatible	= "simple-bus"
 	},
+ 	{
+		.compatible	= "mdio-mux-gpio",
+	},
+	{
+		.compatible	= "fsl,fpga-ngpixis",
+	},
 	{
 		.compatible	= "fsl,srio",
 	},
-- 
1.7.5.4

