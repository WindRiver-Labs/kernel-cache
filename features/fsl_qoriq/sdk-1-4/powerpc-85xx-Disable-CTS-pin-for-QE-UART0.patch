From 083feb964697b3cb572ae62aa458b48599db13e0 Mon Sep 17 00:00:00 2001
From: Xie Xiaobo <X.Xie@freescale.com>
Date: Tue, 28 May 2013 16:01:43 +0800
Subject: [PATCH 364/430] powerpc/85xx: Disable CTS pin for QE UART0

On P1025TWR board, the UCC7 acted as UART port0. However, The UCC7's
CTS pin is low level in default, it will impact the transmission in
full duplex communication. So disable the Flow control pin - CTS.
The UCC7 UART just can use RXD and TXD pins.

Signed-off-by: Xie Xiaobo <X.Xie@freescale.com>
Change-Id: I8ab9b3edb0edb6440ce32a83fbcf0200c8eb54f7
Reviewed-on: http://git.am.freescale.net:8181/2706
Tested-by: Review Code-CDREVIEW <CDREVIEW@freescale.com>
Reviewed-by: Fleming Andrew-AFLEMING <AFLEMING@freescale.com>
[Original patch is from QorIQ-SDK-V1.4-20130625-yocto, just a minor
modification to port 3.4 kernel]
Signed-off-by: Wei Yang <Wei.Yang@windriver.com>
---
 arch/powerpc/platforms/85xx/twr_p102x.c |    9 +++++++++
 1 files changed, 9 insertions(+), 0 deletions(-)

diff --git a/arch/powerpc/platforms/85xx/twr_p102x.c b/arch/powerpc/platforms/85xx/twr_p102x.c
index 6ed7be5..383eb57 100644
--- a/arch/powerpc/platforms/85xx/twr_p102x.c
+++ b/arch/powerpc/platforms/85xx/twr_p102x.c
@@ -139,6 +139,15 @@ static void __init twr_p1025_setup_arch(void)
 					MPC85xx_PMUXCR_QE(12));
 			iounmap(guts);
 
+#if defined(CONFIG_SERIAL_QE)
+			/* On P1025TWR board, the UCC7 acted as UART port.
+			 * However, The UCC7's CTS pin is low level in default,
+			 * it will impact the transmission in full duplex
+			 * communication. So disable the Flow control pin PA18.
+			 * The UCC7 UART just can use RXD and TXD pins.
+			 */
+			par_io_config_pin(0, 18, 0, 0, 0, 0);
+#endif
 			/* Drive PB29 to CPLD low - CPLD will then change
 			 * muxing from LBC to QE */
 			par_io_config_pin(1, 29, 1, 0, 0, 0);
-- 
1.7.5.4

