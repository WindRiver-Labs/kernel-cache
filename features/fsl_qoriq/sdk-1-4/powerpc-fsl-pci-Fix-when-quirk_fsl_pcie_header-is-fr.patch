From 484046acd34c8aea7714ff63743f06312369ca5a Mon Sep 17 00:00:00 2001
From: Matias Garcia <mgarcia@rossvideo.com>
Date: Mon, 19 Sep 2011 11:35:11 -0400
Subject: [PATCH 274/430] powerpc/fsl/pci: Fix when quirk_fsl_pcie_header is
 freed up

commit dea0ed4a64b9d62b266d54350c2514fa7b2b1dbd upstream

Change quirk_fsl_pcie_header from __init to __devinit to ensure if we
have a runtime access (like via an FPGA being loaded after boot on the
PCIe link) that we dont access randomly freed memory.

Signed-off-by: Matias Garcia <mgarcia@rossvideo.com>
Signed-off-by: Kumar Gala <galak@kernel.crashing.org>
Signed-off-by: Wei Yang <Wei.Yang@windriver.com>
---
 arch/powerpc/sysdev/fsl_pci.c |    2 +-
 1 files changed, 1 insertions(+), 1 deletions(-)

diff --git a/arch/powerpc/sysdev/fsl_pci.c b/arch/powerpc/sysdev/fsl_pci.c
index 13760d1..2a963da 100644
--- a/arch/powerpc/sysdev/fsl_pci.c
+++ b/arch/powerpc/sysdev/fsl_pci.c
@@ -38,7 +38,7 @@
 
 static int fsl_pcie_bus_fixup, is_mpc83xx_pci;
 
-static void __init quirk_fsl_pcie_header(struct pci_dev *dev)
+static void __devinit quirk_fsl_pcie_header(struct pci_dev *dev)
 {
 	u8 hdr_type;
 
-- 
1.7.5.4

