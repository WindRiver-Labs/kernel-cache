From 487dde13d482cd8529d4f46fb9b76adc8b0a103f Mon Sep 17 00:00:00 2001
From: Zhao Chenhui <chenhui.zhao@freescale.com>
Date: Thu, 29 Nov 2012 18:50:29 +0800
Subject: [PATCH 034/547] powerpc/85xx: fix compile error when
 CONFIG_HOTPLUG_CPU is disabled

../arch/powerpc/platforms/85xx/smp.c:306:4:
error: implicit declaration of function 'generic_set_cpu_up'
../arch/powerpc/platforms/85xx/smp.c:321:4:
error: implicit declaration of function 'is_core_down'
make[3]: *** [arch/powerpc/platforms/85xx/smp.o] Error 1

Signed-off-by: Zhao Chenhui <chenhui.zhao@freescale.com>
Signed-off-by: Andy Fleming <afleming@freescale.com>
Change-Id: I55145d1acf2a2710bc544c09b49492039bff1968
Reviewed-on: http://git.am.freescale.net:8181/564
Reviewed-by: Fleming Andrew-AFLEMING <AFLEMING@freescale.com>
Tested-by: Fleming Andrew-AFLEMING <AFLEMING@freescale.com>
[Original patch taken from QorIQ-SDK-V1.4-SOURCE-20130625-yocto.iso]
Signed-off-by: Bin Jiang <bin.jiang@windriver.com>
---
 arch/powerpc/include/asm/smp.h    | 2 +-
 arch/powerpc/platforms/85xx/smp.c | 2 ++
 2 files changed, 3 insertions(+), 1 deletion(-)

diff --git a/arch/powerpc/include/asm/smp.h b/arch/powerpc/include/asm/smp.h
index 62d3a20..15aa070 100644
--- a/arch/powerpc/include/asm/smp.h
+++ b/arch/powerpc/include/asm/smp.h
@@ -75,7 +75,7 @@ extern void uninhibit_secondary_onlining(void);
 #else /* HOTPLUG_CPU */
 static inline void inhibit_secondary_onlining(void) {}
 static inline void uninhibit_secondary_onlining(void) {}
-
+#define generic_set_cpu_up(cpu) do { } while (0)
 #endif
 
 #ifdef CONFIG_PPC64
diff --git a/arch/powerpc/platforms/85xx/smp.c b/arch/powerpc/platforms/85xx/smp.c
index dc69f77..eeb2268 100644
--- a/arch/powerpc/platforms/85xx/smp.c
+++ b/arch/powerpc/platforms/85xx/smp.c
@@ -317,6 +317,7 @@ static int __cpuinit smp_85xx_kick_cpu(int nr)
 		}
 	}
 
+#ifdef CONFIG_HOTPLUG_CPU
 	/* Starting Thread 0 will reset core, so put both threads down first */
 	if (smt_capable() && system_state == SYSTEM_RUNNING &&
 			cpu_thread_in_core(nr) == 0 && !is_core_down(nr)) {
@@ -325,6 +326,7 @@ static int __cpuinit smp_85xx_kick_cpu(int nr)
 			return -ENOENT;
 	}
 #endif
+#endif
 
 	np = of_get_cpu_node(nr, NULL);
 	cpu_rel_addr = of_get_property(np, "cpu-release-addr", NULL);
-- 
1.8.4.93.g57e4c17

