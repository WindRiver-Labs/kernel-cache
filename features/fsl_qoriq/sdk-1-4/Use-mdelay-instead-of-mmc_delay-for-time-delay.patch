From e297cd4d72814fc1126e21c07f30c1b1d2e90b82 Mon Sep 17 00:00:00 2001
From: Ming Liu <ming.liu@windriver.com>
Date: Mon, 2 Sep 2013 17:30:05 +0800
Subject: [PATCH] Use mdelay() instead of mmc_delay() for time delay

This revert following revision:

    mmc: Use mmc_delay() instead of mdelay() for time delay

mmc_delay may sleep but its caller will be called in many mmc host common
hook functions between spin_lock_save()/spin_unlock_irqrestore(), which will
trigger that known call trace because of msleep() in interrupt context.

Signed-off-by: ming.liu <ming.liu@windriver.com>
---
 drivers/mmc/host/sdhci.c |   10 +++++-----
 1 files changed, 5 insertions(+), 5 deletions(-)

diff --git a/drivers/mmc/host/sdhci.c b/drivers/mmc/host/sdhci.c
index 8c63d10..0028a07 100644
--- a/drivers/mmc/host/sdhci.c
+++ b/drivers/mmc/host/sdhci.c
@@ -212,7 +212,7 @@ void sdhci_reset(struct sdhci_host *host, u8 mask)
 			return;
 		}
 		timeout--;
-		mmc_delay(1);
+		mdelay(1);
 	}
 
 	if (host->ops->platform_reset_exit)
@@ -1005,7 +1005,7 @@ static void sdhci_send_command(struct sdhci_host *host, struct mmc_command *cmd)
 			return;
 		}
 		timeout--;
-		mmc_delay(1);
+		mdelay(1);
 	}
 
 	/* In case some controller need long time to generate command
@@ -1192,7 +1192,7 @@ static void sdhci_set_clock(struct sdhci_host *host, unsigned int clock)
 			return;
 		}
 		timeout--;
-		mmc_delay(1);
+		mdelay(1);
 	}
 
 	clk |= SDHCI_CLOCK_CARD_EN;
@@ -1278,7 +1278,7 @@ static int sdhci_set_power(struct sdhci_host *host, unsigned short power)
 	 * can apply clock after applying power
 	 */
 	if (host->quirks & SDHCI_QUIRK_DELAY_AFTER_POWER)
-		mmc_delay(1);
+		mdelay(1);
 
 	return power;
 }
@@ -1904,7 +1904,7 @@ static int sdhci_execute_tuning(struct mmc_host *mmc, u32 opcode)
 		ctrl = sdhci_readw(host, SDHCI_HOST_CONTROL2);
 		tuning_loop_counter--;
 		timeout--;
-		mmc_delay(1);
+		mdelay(1);
 	} while (ctrl & SDHCI_CTRL_EXEC_TUNING);
 
 	/*
-- 
1.7.5.4

