From f65a62dd657c4b802789404d6dfec3f20cb655ea Mon Sep 17 00:00:00 2001
From: Bogdan Hamciuc <bogdan.hamciuc@freescale.com>
Date: Sun, 28 Oct 2012 00:17:27 +0300
Subject: [PATCH 160/547] dpaa_eth: Reset congestion stats after display

Be consistent with the QMan CGR API and reset the per-netdev congestion
stats that we display, after each user read from debugfs.

Change-Id: I21fd55445784dd91dfd7fd7a0ee56884d24f49ee
Signed-off-by: Bogdan Hamciuc <bogdan.hamciuc@freescale.com>
Reviewed-on: http://git.am.freescale.net:8181/1034
Reviewed-by: Fleming Andrew-AFLEMING <AFLEMING@freescale.com>
Tested-by: Fleming Andrew-AFLEMING <AFLEMING@freescale.com>
[Original patch taken from QorIQ-SDK-V1.4-SOURCE-20130625-yocto.iso]
Signed-off-by: Bin Jiang <bin.jiang@windriver.com>
---
 drivers/net/ethernet/freescale/dpa/dpaa_eth.c | 3 +++
 1 file changed, 3 insertions(+)

diff --git a/drivers/net/ethernet/freescale/dpa/dpaa_eth.c b/drivers/net/ethernet/freescale/dpa/dpaa_eth.c
index 64ffe53..6b38ce2 100644
--- a/drivers/net/ethernet/freescale/dpa/dpaa_eth.c
+++ b/drivers/net/ethernet/freescale/dpa/dpaa_eth.c
@@ -2991,6 +2991,9 @@ static int __cold dpa_debugfs_show(struct seq_file *file, void *offset)
 		"Current congestion state is: %s.\n",
 		priv->cgr_data.cgr_congested_count,
 		query_cgr.cgr.cs ? "congested" : "not congested");
+	/* Reset congestion stats (like QMan CGR API does) */
+	priv->cgr_data.congested_jiffies = 0;
+	priv->cgr_data.cgr_congested_count = 0;
 
 	/* Rx Errors demultiplexing */
 	seq_printf(file, "\nDPA RX Errors:\nCPU        dma err  phys err" \
-- 
1.8.4.93.g57e4c17

