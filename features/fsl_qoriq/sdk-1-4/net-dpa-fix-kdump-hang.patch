From 555c50a4f1d4a579c3f8844abf582b18654bea9a Mon Sep 17 00:00:00 2001
From: Tiejun Chen <tiejun.chen@windriver.com>
Date: Wed, 5 Dec 2012 15:38:31 +0800
Subject: [PATCH 468/547] net/dpa: fix kdump hang

When kdump runs, the second kernel always gets a failure when qman_init_fq
is called, but the ethernet can still work well when we skip the failure.
So return value judgement is commented off here and kdump can work well now

Signed-off-by: Weiwei Wang <weiwei.wang@windriver.com>
Signed-off-by: Bin Jiang <bin.jiang@windriver.com>
---
 drivers/net/ethernet/freescale/dpa/dpaa_eth.c | 2 ++
 1 file changed, 2 insertions(+)

diff --git a/drivers/net/ethernet/freescale/dpa/dpaa_eth.c b/drivers/net/ethernet/freescale/dpa/dpaa_eth.c
index 7065cbe..a2b858f 100644
--- a/drivers/net/ethernet/freescale/dpa/dpaa_eth.c
+++ b/drivers/net/ethernet/freescale/dpa/dpaa_eth.c
@@ -736,12 +736,14 @@ _dpa_fq_alloc(struct list_head *list, struct dpa_fq *dpa_fq)
 		};
 
 		_errno = qman_init_fq(fq, QMAN_INITFQ_FLAG_SCHED, &initfq);
+#ifndef CONFIG_CRASH_DUMP
 		if (_errno < 0) {
 			dev_err(dev, "qman_init_fq(%u) = %d\n",
 					qman_fq_fqid(fq), _errno);
 			qman_destroy_fq(fq, 0);
 			return _errno;
 		}
+#endif
 	}
 
 	dpa_fq->fqid = qman_fq_fqid(fq);
-- 
1.8.4.93.g57e4c17

