From 443c424567bf9e70ae6933627dbf1b7ac49878ec Mon Sep 17 00:00:00 2001
From: Ioana Radulescu <ruxandra.radulescu@freescale.com>
Date: Fri, 31 May 2013 11:10:40 +0300
Subject: [PATCH 130/430] dpaa_eth: Increase maximum allowed size for buffer
 recycle

There is an upper limit for the size of a recycleable skb, in order
to prevent unbounded growth of the recycled buffers. This limit
was however too strict and could prevent recycling for some of the
skbs found on the ipforward path.

Relax the recycling condition, such as to also account for internal
buffer padding, skb alignment padding and sh_info size.

Signed-off-by: Ioana Radulescu <ruxandra.radulescu@freescale.com>
Change-Id: I0f0b8a48a564657dd107661d6bb5ad474ce8a7a8
Reviewed-on: http://git.am.freescale.net:8181/2807
Reviewed-by: Bucur Madalin-Cristian-B32716 <madalin.bucur@freescale.com>
Reviewed-by: Sovaiala Cristian-Constantin-B39531 <Cristian.Sovaiala@freescale.com>
Tested-by: Review Code-CDREVIEW <CDREVIEW@freescale.com>
Reviewed-by: Hamciuc Bogdan-BHAMCIU1 <bogdan.hamciuc@freescale.com>
Reviewed-by: Fleming Andrew-AFLEMING <AFLEMING@freescale.com>
Tested-by: Fleming Andrew-AFLEMING <AFLEMING@freescale.com>
[original patch is from QorIQ-SDK-V1.4-20130625-yocto]
Signed-off-by: Jiang Lu <lu.jiang@windriver.com>
---
 drivers/net/ethernet/freescale/dpa/dpaa_eth.c |    2 +-
 1 files changed, 1 insertions(+), 1 deletions(-)

diff --git a/drivers/net/ethernet/freescale/dpa/dpaa_eth.c b/drivers/net/ethernet/freescale/dpa/dpaa_eth.c
index d9cb724..c850e0c 100644
--- a/drivers/net/ethernet/freescale/dpa/dpaa_eth.c
+++ b/drivers/net/ethernet/freescale/dpa/dpaa_eth.c
@@ -132,7 +132,7 @@
  * frames may get recycled, while forwarded skbs that get reallocated on Tx
  * aren't allowed to grow unboundedly.
  */
-#define DPA_RECYCLE_EXTRA_SIZE	256
+#define DPA_RECYCLE_EXTRA_SIZE	1024
 
 /* For MAC-based interfaces, we compute the tx needed headroom from the
  * associated Tx port's buffer layout settings.
-- 
1.7.5.4

