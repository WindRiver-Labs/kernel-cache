From aa5d12100f4b7bacaa046f177d8b6cc3f1a4089b Mon Sep 17 00:00:00 2001
From: Wei Yang <Wei.Yang@windriver.com>
Date: Wed, 6 Mar 2013 10:26:31 +0800
Subject: [PATCH 482/547] powerpc64/execption-64e: Check where debug exception
 comes from

ACCOUNT_CPU_USER_ENTRY ,invoked by EXCEPTION_COMMON, depends on
cr0 to decide where this exception comes from and then perform
the statistics of the process executing time in userspace and kernel
mode.

Signed-off-by: Wei Yang <Wei.Yang@windriver.com>
Signed-off-by: Tiejun Chen <tiejun.chen@windriver.com>
Signed-off-by: Bin Jiang <bin.jiang@windriver.com>
---
 arch/powerpc/kernel/exceptions-64e.S | 3 +--
 1 file changed, 1 insertion(+), 2 deletions(-)

diff --git a/arch/powerpc/kernel/exceptions-64e.S b/arch/powerpc/kernel/exceptions-64e.S
index 4df80f0..a2483fb 100644
--- a/arch/powerpc/kernel/exceptions-64e.S
+++ b/arch/powerpc/kernel/exceptions-64e.S
@@ -590,12 +590,11 @@ kernel_dbg_exc:
 	rfdi
 
 	/* Normal debug exception */
-1:
+1:  andi.	r14,r11,MSR_PR;		/* check for userspace again */
 #ifndef CONFIG_KGDB
 	/* XXX We only handle coming from userspace for now since we can't
 	 *     quite save properly an interrupted kernel state yet
 	 */
-	andi.	r14,r11,MSR_PR;		/* check for userspace again */
 	beq	kernel_dbg_exc;		/* if from kernel mode */
 #endif
 
-- 
1.8.4.93.g57e4c17

