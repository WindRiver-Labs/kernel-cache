From ea31158bc333dc93c1ab07c80089dbaf41fe8a97 Mon Sep 17 00:00:00 2001
From: Tiejun Chen <tiejun.chen@windriver.com>
Date: Tue, 27 Aug 2013 17:26:36 +0800
Subject: [PATCH 3/7] timer/list: pass correct function entry address

Function Descriptor is introduced for PPC64 ABI. It consists of
three words as follows:

1st word: This function real entry point address
2nd word: TOC base address of this function
3rd word: Others

And the function symbol only means this associated function descriptor.

So we should call dereference_function_descriptor to convert that to
the first word as address to lookup symbol name for PPC64 if
pass function symbol.

This should be fine for all arch since dereference_function_descriptor()
is no-op for other arches that don't need this.

Signed-off-by: Tiejun Chen <tiejun.chen@windriver.com>
Signed-off-by: Bin Jiang <bin.jiang@windriver.com>
---
 kernel/time/timer_list.c | 3 +++
 1 file changed, 3 insertions(+)

diff --git a/kernel/time/timer_list.c b/kernel/time/timer_list.c
index af5a7e9..836100b 100644
--- a/kernel/time/timer_list.c
+++ b/kernel/time/timer_list.c
@@ -19,6 +19,7 @@
 #include <linux/tick.h>
 
 #include <asm/uaccess.h>
+#include <asm/sections.h>
 
 typedef void (*print_fn_t)(struct seq_file *m, unsigned int *classes);
 
@@ -40,6 +41,8 @@ static void print_name_offset(struct seq_file *m, void *sym)
 {
 	char symname[KSYM_NAME_LEN];
 
+	sym = dereference_function_descriptor(sym);
+
 	if (lookup_symbol_name((unsigned long)sym, symname) < 0)
 		SEQ_printf(m, "<%pK>", sym);
 	else
-- 
1.8.4.93.g57e4c17

