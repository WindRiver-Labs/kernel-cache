From 7f2c8dc48105f5b805c1ed776f5a4146a69260ff Mon Sep 17 00:00:00 2001
From: Kumar Gala <galak@kernel.crashing.org>
Date: Fri, 18 Nov 2011 09:25:25 -0600
Subject: [PATCH 19/21] powerpc/85xx: Add DPAA support to P1023 SoC device tree files

P1023 has 2 FMan ethernet ports, 3 Q/Bman SW portals, and 3 Qman pool
channels.

Signed-off-by: Kumar Gala <galak@kernel.crashing.org>
[Extracted from SDK 1.2.1 for p1023, minor patch context modifications.]
Signed-off-by: Wei Yang <Wei.Yang@windriver.com>
---
 arch/powerpc/boot/dts/fsl/p1023si-post.dtsi |  204 +++++++++++++++++++++++++++
 arch/powerpc/boot/dts/fsl/p1023si-pre.dtsi  |    8 +-
 2 files changed, 210 insertions(+), 2 deletions(-)

diff --git a/arch/powerpc/boot/dts/fsl/p1023si-post.dtsi b/arch/powerpc/boot/dts/fsl/p1023si-post.dtsi
index 6840e54..865d398 100644
--- a/arch/powerpc/boot/dts/fsl/p1023si-post.dtsi
+++ b/arch/powerpc/boot/dts/fsl/p1023si-post.dtsi
@@ -96,6 +96,77 @@
 	};
 };
 
+&qportals {
+	#address-cells = <0x1>;
+	#size-cells = <0x1>;
+	compatible = "simple-bus";
+	qportal0: qman-portal@0 {
+		cell-index = <0x0>;
+		compatible = "fsl,qman-portal";
+		reg = <0x0 0x4000 0x100000 0x1000>;
+		interrupts = <29 2 0 0>;
+		fsl,qman-channel-id = <0x0>;
+	};
+
+	qportal1: qman-portal@4000 {
+		cell-index = <0x1>;
+		compatible = "fsl,qman-portal";
+		reg = <0x4000 0x4000 0x101000 0x1000>;
+		interrupts = <31 2 0 0>;
+		fsl,qman-channel-id = <0x1>;
+	};
+
+	qportal2: qman-portal@8000 {
+		cell-index = <0x2>;
+		compatible = "fsl,qman-portal";
+		reg = <0x8000 0x4000 0x102000 0x1000>;
+		interrupts = <33 2 0 0>;
+		fsl,qman-channel-id = <0x2>;
+	};
+
+	qpool1: qman-pool@1 {
+		cell-index = <1>;
+		compatible = "fsl,qman-pool-channel";
+		fsl,qman-channel-id = <0x21>;
+	};
+
+	qpool2: qman-pool@2 {
+		cell-index = <2>;
+		compatible = "fsl,qman-pool-channel";
+		fsl,qman-channel-id = <0x22>;
+	};
+
+	qpool3: qman-pool@3 {
+		cell-index = <3>;
+		compatible = "fsl,qman-pool-channel";
+		fsl,qman-channel-id = <0x23>;
+	};
+};
+
+&bportals {
+	#address-cells = <0x1>;
+	#size-cells = <0x1>;
+	compatible = "simple-bus";
+	bman-portal@0 {
+		cell-index = <0x0>;
+		compatible = "fsl,bman-portal";
+		reg = <0x0 0x4000 0x100000 0x1000>;
+		interrupts = <30 2 0 0>;
+	};
+	bman-portal@4000 {
+		cell-index = <0x1>;
+		compatible = "fsl,bman-portal";
+		reg = <0x4000 0x4000 0x101000 0x1000>;
+		interrupts = <32 2 0 0>;
+	};
+	bman-portal@8000 {
+		cell-index = <2>;
+		compatible = "fsl,bman-portal";
+		reg = <0x8000 0x4000 0x102000 0x1000>;
+		interrupts = <34 2 0 0>;
+	};
+};
+
 &soc {
 	#address-cells = <1>;
 	#size-cells = <1>;
@@ -219,9 +290,142 @@
 /include/ "pq3-mpic.dtsi"
 /include/ "pq3-mpic-timer-B.dtsi"
 
+	qman: qman@88000 {
+		compatible = "fsl,qman";
+		reg = <0x88000 0x1000>;
+		interrupts = <16 2 0 0>;
+	};
+
+	bman: bman@8a000 {
+		compatible = "fsl,bman";
+		reg = <0x8a000 0x1000>;
+		interrupts = <16 2 0 0>;
+	};
+
 	global-utilities@e0000 {
 		compatible = "fsl,p1023-guts";
 		reg = <0xe0000 0x1000>;
 		fsl,has-rstcr;
 	};
+
+	fman0: fman@100000 {
+		#address-cells = <1>;
+		#size-cells = <1>;
+		cell-index = <0>;
+		compatible = "fsl,fman", "simple-bus";
+		ranges = <0 0x100000 0x100000>;
+		reg = <0x100000 0x100000>;
+		clock-frequency = <0>;
+		interrupts = <
+			24 2 0 0
+			16 2 0 0>;
+		cc@0 {
+			compatible = "fsl,fman-cc";
+		};
+		muram@0 {
+			compatible = "fsl,fman-muram";
+			reg = <0x0 0x10000>;
+		};
+		bmi@80000 {
+			compatible = "fsl,fman-bmi";
+			reg = <0x80000 0x400>;
+		};
+		qmi@80400 {
+			compatible = "fsl,fman-qmi";
+			reg = <0x80400 0x400>;
+		};
+		policer@c0000 {
+			compatible = "fsl,fman-policer";
+			reg = <0xc0000 0x1000>;
+		};
+		keygen@c1000 {
+			compatible = "fsl,fman-keygen";
+			reg = <0xc1000 0x1000>;
+		};
+		dma@c2000 {
+			compatible = "fsl,fman-dma";
+			reg = <0xc2000 0x1000>;
+		};
+		fpm@c3000 {
+			compatible = "fsl,fman-fpm";
+			reg = <0xc3000 0x1000>;
+		};
+		parser@c7000 {
+			compatible = "fsl,fman-parser";
+			reg = <0xc7000 0x1000>;
+		};
+		fman0_rx0: port@88000 {
+			cell-index = <0>;
+			compatible = "fsl,fman-port-1g-rx";
+			reg = <0x88000 0x1000>;
+		};
+		fman0_rx1: port@89000 {
+			cell-index = <1>;
+			compatible = "fsl,fman-port-1g-rx";
+			reg = <0x89000 0x1000>;
+		};
+		fman0_tx0: port@a8000 {
+			cell-index = <0>;
+			compatible = "fsl,fman-port-1g-tx";
+			reg = <0xa8000 0x1000>;
+			fsl,qman-channel-id = <0x40>;
+		};
+		fman0_tx1: port@a9000 {
+			cell-index = <1>;
+			compatible = "fsl,fman-port-1g-tx";
+			reg = <0xa9000 0x1000>;
+			fsl,qman-channel-id = <0x41>;
+		};
+		fman0_oh1: port@82000 {
+			cell-index = <1>;
+			compatible = "fsl,fman-port-oh";
+			reg = <0x82000 0x1000>;
+			fsl,qman-channel-id = <0x43>;
+		};
+		fman0_oh2: port@83000 {
+			cell-index = <2>;
+			compatible = "fsl,fman-port-oh";
+			reg = <0x83000 0x1000>;
+			fsl,qman-channel-id = <0x44>;
+		};
+		fman0_oh3: port@84000 {
+			cell-index = <3>;
+			compatible = "fsl,fman-port-oh";
+			reg = <0x84000 0x1000>;
+			fsl,qman-channel-id = <0x45>;
+		};
+		fman0_oh4: port@85000 {
+			cell-index = <4>;
+			compatible = "fsl,fman-port-oh";
+			reg = <0x85000 0x1000>;
+			fsl,qman-channel-id = <0x46>;
+		};
+		enet0: ethernet@e0000 {
+			cell-index = <0>;
+			compatible = "fsl,fman-1g-mac";
+			reg = <0xe0000 0x1000>;
+			fsl,port-handles = <&fman0_rx0 &fman0_tx0>;
+			ptimer-handle = <&ptp_timer0>;
+		};
+		enet1: ethernet@e2000 {
+			cell-index = <1>;
+			compatible = "fsl,fman-1g-mac";
+			reg = <0xe2000 0x1000>;
+			fsl,port-handles = <&fman0_rx1 &fman0_tx1>;
+			ptimer-handle = <&ptp_timer0>;
+		};
+		mdio0: mdio@e1120 {
+			#address-cells = <1>;
+			#size-cells = <0>;
+			compatible = "fsl,fman-mdio";
+			reg = <0xe1120 0xee0>;
+			interrupts = <26 1 0 0>;
+		};
+
+		ptp_timer0: rtc@fe000 {
+			compatible = "fsl,fman-rtc";
+			reg = <0xfe000 0x1000>;
+		};
+	};
+
 };
diff --git a/arch/powerpc/boot/dts/fsl/p1023si-pre.dtsi b/arch/powerpc/boot/dts/fsl/p1023si-pre.dtsi
index 132a152..6cfff45 100644
--- a/arch/powerpc/boot/dts/fsl/p1023si-pre.dtsi
+++ b/arch/powerpc/boot/dts/fsl/p1023si-pre.dtsi
@@ -58,19 +58,23 @@
 		rtic_b = &rtic_b;
 		rtic_c = &rtic_c;
 		rtic_d = &rtic_d;
+
+		bman = &bman;
+		qman = &qman;
+		fman0 = &fman0;
 	};
 
 	cpus {
 		#address-cells = <1>;
 		#size-cells = <0>;
 
-		PowerPC,P1023@0 {
+		cpu0: PowerPC,P1023@0 {
 			device_type = "cpu";
 			reg = <0x0>;
 			next-level-cache = <&L2>;
 		};
 
-		PowerPC,P1023@1 {
+		cpu1: PowerPC,P1023@1 {
 			device_type = "cpu";
 			reg = <0x1>;
 			next-level-cache = <&L2>;
-- 
1.7.0

