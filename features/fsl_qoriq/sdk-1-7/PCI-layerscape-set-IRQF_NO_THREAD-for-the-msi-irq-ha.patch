From 27ec78b9389c691b5875ea9aa4fe417832539093 Mon Sep 17 00:00:00 2001
From: Kevin Hao <kexin.hao@windriver.com>
Date: Thu, 13 Nov 2014 17:19:39 +0800
Subject: [PATCH] PCI: layerscape: set IRQF_NO_THREAD for the msi irq handler

The irq handler for the cascaded irqchip can't be threaded.

Signed-off-by: Kevin Hao <kexin.hao@windriver.com>
Signed-off-by: Xulin Sun <xulin.sun@windriver.com>
---
 drivers/pci/host/pci-layerscape.c |    2 +-
 1 files changed, 1 insertions(+), 1 deletions(-)

diff --git a/drivers/pci/host/pci-layerscape.c b/drivers/pci/host/pci-layerscape.c
index 04ba519..6e3fa7c 100644
--- a/drivers/pci/host/pci-layerscape.c
+++ b/drivers/pci/host/pci-layerscape.c
@@ -181,7 +181,7 @@ static int ls_add_pcie_port(struct ls_pcie *pcie)
 	if (IS_ENABLED(CONFIG_PCI_MSI)) {
 		ret = devm_request_irq(pp->dev, pp->msi_irq,
 					ls_pcie_msi_irq_handler,
-					IRQF_SHARED, "ls-pcie-msi", pp);
+					IRQF_NO_THREAD, "ls-pcie-msi", pp);
 		if (ret) {
 			dev_err(pp->dev, "failed to request msi irq\n");
 			return ret;
-- 
1.7.5.4

