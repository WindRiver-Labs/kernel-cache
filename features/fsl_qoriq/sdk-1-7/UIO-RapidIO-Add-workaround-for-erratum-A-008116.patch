From e6629a3b5c8d24edd478bc196d5cbe00a8f21eb1 Mon Sep 17 00:00:00 2001
From: Liu Gang <Gang.Liu@freescale.com>
Date: Wed, 29 Oct 2014 19:56:26 +0800
Subject: [PATCH 095/399] UIO/RapidIO: Add workaround for erratum A-008116

Erratum A-008116 can cause a SRIO phyiscal or logical/transport
error interrupt (PINTn) that orginates on port 2 is incorrectly
reported as originating on port 1.

Valid workaround needed if using Serial RapidIO port 2. Upon
detection of a Serial RapidIO interrupt, each port's LTLEDCSR
and PnEDCSR registers must be read to determine the port origin.

Signed-off-by: Liu Gang <Gang.Liu@freescale.com>
Change-Id: I309106e79853cf08b9b546924a41ec74ad4b8b53
Reviewed-on: http://git.am.freescale.net:8181/22437
Tested-by: Review Code-CDREVIEW <CDREVIEW@freescale.com>
Reviewed-by: Minghuan Lian <Minghuan.Lian@freescale.com>
Reviewed-by: Mingkai Hu <Mingkai.Hu@freescale.com>
Reviewed-by: Richard Schmitt <richard.schmitt@freescale.com>
[Lu:Original patch taken from
QorIQ-SDK-V1.7-SOURCE-20141218-yocto.iso]
Signed-off-by: Jiang Lu <lu.jiang@windriver.com>
---
 drivers/uio/fsl_srio_uio.c |    2 --
 1 files changed, 0 insertions(+), 2 deletions(-)

diff --git a/drivers/uio/fsl_srio_uio.c b/drivers/uio/fsl_srio_uio.c
index 840872b..c46aab5 100644
--- a/drivers/uio/fsl_srio_uio.c
+++ b/drivers/uio/fsl_srio_uio.c
@@ -111,7 +111,6 @@ static irqreturn_t srio_uio_irq_handler(int irq, struct uio_info *dev_info)
 		out_be32(sriodev->regs.regs_win + LTLEECSR, 0);
 
 	for (i = 0; i < sriodev->port_num; i++) {
-		if (port_bits & (1 << (31 - i))) {
 			/* Clear retry error threshold exceeded */
 			out_be32(sriodev->regs.regs_win + IECSR + 0x80 * i,
 				 SRIO_IECSR_CLEAR);
@@ -121,7 +120,6 @@ static irqreturn_t srio_uio_irq_handler(int irq, struct uio_info *dev_info)
 			/* Clear EDCSR */
 			out_be32(sriodev->regs.regs_win + EDCSR + 0x40 * i,
 				 0);
-		}
 	}
 
 	return IRQ_HANDLED;
-- 
1.7.5.4

