From bde91a2e8f9126cc95d051b357bdaaaa00e705d5 Mon Sep 17 00:00:00 2001
From: Marian Cristian Rotariu <marian.rotariu@freescale.com>
Date: Mon, 29 Sep 2014 15:59:52 +0300
Subject: [PATCH 033/399] offline_port: fix dt parser for tx frame queues

With the current implementation the user has the possibility to initialize
some queues that exit the offline port. The format of the device tree format
is:

 fsl,qman-frame-queues-egress = <base_id1 count1 ... base_idn countn>;
 fsl,qman-channel-ids-egress = <channel_id1 ... channel_idn>;

Intuitively, the base_id1, count1 frame queues batch are placed in the
channel_id1 QMan channel. Because the list_add() adds an entry at the beginning
of the list, the map between the frame queues and their channel ID is reversed.

This patch adds a particular entry at the end of the fq list using
list_add_tail() function.

Signed-off-by: Marian Cristian Rotariu <marian.rotariu@freescale.com>
Change-Id: I8d3a2fd3c36f63d15837ffe90bf6e4e8b041a3e5
Reviewed-on: http://git.am.freescale.net:8181/20154
Reviewed-by: Madalin-Cristian Bucur <madalin.bucur@freescale.com>
Tested-by: Marian Cristian Rotariu <marian.rotariu@freescale.com>
[Lu:Original patch taken from
QorIQ-SDK-V1.7-SOURCE-20141218-yocto.iso]
Signed-off-by: Jiang Lu <lu.jiang@windriver.com>
---
 drivers/net/ethernet/freescale/dpa/offline_port.c |    2 +-
 1 files changed, 1 insertions(+), 1 deletions(-)

diff --git a/drivers/net/ethernet/freescale/dpa/offline_port.c b/drivers/net/ethernet/freescale/dpa/offline_port.c
index b9f17cf..042f44a 100644
--- a/drivers/net/ethernet/freescale/dpa/offline_port.c
+++ b/drivers/net/ethernet/freescale/dpa/offline_port.c
@@ -491,7 +491,7 @@ oh_port_probe(struct platform_device *_of_dev)
 		fqd->fqs_count = crt_fq_count;
 		/* channel ID is specified in another attribute */
 		fqd->channel_id = 0;
-		list_add(&fqd->fq_list, &oh_config->fqs_egress_list);
+		list_add_tail(&fqd->fq_list, &oh_config->fqs_egress_list);
 
 		/* allocate the queue */
 
-- 
1.7.5.4

