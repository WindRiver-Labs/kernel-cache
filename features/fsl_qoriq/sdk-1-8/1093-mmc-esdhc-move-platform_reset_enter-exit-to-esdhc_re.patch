From 060b05d8b5bd8b13cf5bed9f16f94d1741cbbb31 Mon Sep 17 00:00:00 2001
From: Wang Quanyang <quanyang.wang@windriver.com>
Date: Tue, 13 Oct 2015 13:55:59 +0000
Subject: [PATCH 1093/1094] mmc: esdhc: move platform_reset_enter/exit to
 esdhc_reset

According to upstream commit 03231f9b781f
("mmc: sdhci: convert reset into a library function"),
the function platform_reset_enter/exit has been removed from sdhci_ops.
So move esdhc's platform_reset_enter/exit to esdhc_reset to guanrantee
the correct reset order. Or it will occur a compile error as below:

drivers/mmc/host/sdhci-of-esdhc.c:553:2
 error: unknown field 'platform_reset_enter' specified in initializer
  .platform_reset_enter = esdhc_of_platform_reset_enter,
  ^
drivers/mmc/host/sdhci-of-esdhc.c:553:26
: warning: initialization from incompatible pointer type [-Wincompatible-pointer-types]
  .platform_reset_enter = esdhc_of_platform_reset_enter,
                          ^
drivers/mmc/host/sdhci-of-esdhc.c:553:26: note: (near initialization for 'sdhci_esdhc_ops.adma_workaround')
drivers/mmc/host/sdhci-of-esdhc.c:554:2  error: unknown field 'platform_reset_exit' specified in initializer
  .platform_reset_exit = esdhc_of_platform_reset_exit,
  ^
drivers/mmc/host/sdhci-of-esdhc.c:554:25: warning: initialization from incompatible pointer type [-Wincompatible-pointer-types]
  .platform_reset_exit = esdhc_of_platform_reset_exit,
                         ^
Signed-off-by: Quanyang Wang <quanyang.wang@windriver.com>
---
 drivers/mmc/host/sdhci-of-esdhc.c | 4 ++--
 1 file changed, 2 insertions(+), 2 deletions(-)

diff --git a/drivers/mmc/host/sdhci-of-esdhc.c b/drivers/mmc/host/sdhci-of-esdhc.c
index ddf168e..f906808 100644
--- a/drivers/mmc/host/sdhci-of-esdhc.c
+++ b/drivers/mmc/host/sdhci-of-esdhc.c
@@ -504,7 +504,9 @@ static void esdhc_pltfm_set_bus_width(struct sdhci_host *host, int width)
 
 static void esdhc_reset(struct sdhci_host *host, u8 mask)
 {
+	esdhc_of_platform_reset_enter(host, mask);
 	sdhci_reset(host, mask);
+	esdhc_of_platform_reset_exit(host, mask);
 
 	sdhci_writel(host, host->ier, SDHCI_INT_ENABLE);
 	sdhci_writel(host, host->ier, SDHCI_SIGNAL_ENABLE);
@@ -550,8 +552,6 @@ static const struct sdhci_ops sdhci_esdhc_ops = {
 	.get_min_clock = esdhc_of_get_min_clock,
 	.get_platform_irq = esdhc_get_pltfm_irq,
 	.handle_platform_irq = esdhc_pltfm_irq_handler,
-	.platform_reset_enter = esdhc_of_platform_reset_enter,
-	.platform_reset_exit = esdhc_of_platform_reset_exit,
 	.platform_init = esdhc_of_platform_init,
 	.get_cd = esdhc_of_get_cd,
 	.adma_workaround = esdhci_of_adma_workaround,
-- 
2.0.2

