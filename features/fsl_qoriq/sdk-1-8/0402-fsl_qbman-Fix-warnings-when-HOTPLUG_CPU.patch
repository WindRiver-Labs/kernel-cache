From 4e002f2c49108a000875dda9f638460b08f0ac9d Mon Sep 17 00:00:00 2001
From: Emil Medve <Emilian.Medve@Freescale.com>
Date: Fri, 18 Oct 2013 16:11:19 -0500
Subject: [PATCH 402/987] fsl_qbman: Fix warnings when !HOTPLUG_CPU
MIME-Version: 1.0
Content-Type: text/plain; charset=UTF-8
Content-Transfer-Encoding: 8bit

[Original patch taken from QorIQ-SDK-V1.6-SOURCE-20140619-yocto.iso]

drivers/staging/fsl_qbman/bman_driver.c:304:13: warning: ‘bman_online_cpu’ defined but not used [-Wunused-function]
 static void bman_online_cpu(unsigned int cpu)
             ^
drivers/staging/fsl_qbman/qman_driver.c:645:13: warning: ‘qman_online_cpu’ defined but not used [-Wunused-function]
 static void qman_online_cpu(unsigned int cpu)
             ^

Signed-off-by: Emil Medve <Emilian.Medve@Freescale.com>
Change-Id: I8b9bb2cc21d46b38d605470e091ddf55ca86c534
Reviewed-on: http://git.am.freescale.net:8181/5840
Tested-by: Review Code-CDREVIEW <CDREVIEW@freescale.com>
Reviewed-by: Thorpe Geoff-R01361 <Geoff.Thorpe@freescale.com>
Reviewed-by: Haiying Wang <Haiying.Wang@freescale.com>
Reviewed-by: Rivera Jose-B46482 <German.Rivera@freescale.com>
---
 drivers/staging/fsl_qbman/bman_driver.c  | 2 +-
 drivers/staging/fsl_qbman/bman_high.c    | 2 ++
 drivers/staging/fsl_qbman/bman_private.h | 2 ++
 drivers/staging/fsl_qbman/qman_driver.c  | 2 +-
 drivers/staging/fsl_qbman/qman_high.c    | 2 ++
 drivers/staging/fsl_qbman/qman_private.h | 2 ++
 6 files changed, 10 insertions(+), 2 deletions(-)

diff --git a/drivers/staging/fsl_qbman/bman_driver.c b/drivers/staging/fsl_qbman/bman_driver.c
index 3bd5160..513c7f1 100644
--- a/drivers/staging/fsl_qbman/bman_driver.c
+++ b/drivers/staging/fsl_qbman/bman_driver.c
@@ -301,6 +301,7 @@ static void bman_offline_cpu(unsigned int cpu)
 		bman_migrate_portal(p);
 }
 
+#ifdef CONFIG_HOTPLUG_CPU
 static void bman_online_cpu(unsigned int cpu)
 {
 	struct bman_portal *p;
@@ -309,7 +310,6 @@ static void bman_online_cpu(unsigned int cpu)
 		bman_migrate_portal_back(p, cpu);
 }
 
-#ifdef CONFIG_HOTPLUG_CPU
 static int __cpuinit bman_hotplug_cpu_callback(struct notifier_block *nfb,
 					unsigned long action, void *hcpu)
 {
diff --git a/drivers/staging/fsl_qbman/bman_high.c b/drivers/staging/fsl_qbman/bman_high.c
index 3e82672..d070d34 100644
--- a/drivers/staging/fsl_qbman/bman_high.c
+++ b/drivers/staging/fsl_qbman/bman_high.c
@@ -1062,6 +1062,7 @@ void bman_migrate_portal(struct bman_portal *portal)
 	PORTAL_IRQ_UNLOCK(portal, irqflags);
 }
 
+#ifdef CONFIG_HOTPLUG_CPU
 /* Migrate the portal back to the affined cpu once that cpu reappears.*/
 void bman_migrate_portal_back(struct bman_portal *portal, unsigned int cpu)
 {
@@ -1070,3 +1071,4 @@ void bman_migrate_portal_back(struct bman_portal *portal, unsigned int cpu)
 	irq_set_affinity(portal->config->public_cfg.irq, cpumask_of(cpu));
 	PORTAL_IRQ_UNLOCK(portal, irqflags);
 }
+#endif /* CONFIG_HOTPLUG_CPU */
diff --git a/drivers/staging/fsl_qbman/bman_private.h b/drivers/staging/fsl_qbman/bman_private.h
index cdd8c00..22e4a8c 100644
--- a/drivers/staging/fsl_qbman/bman_private.h
+++ b/drivers/staging/fsl_qbman/bman_private.h
@@ -159,5 +159,7 @@ __init int bman_resource_init(void);
 /* Portal migration */
 int bman_portal_is_sharing_redirect(struct bman_portal *portal);
 void bman_migrate_portal(struct bman_portal *portal);
+#ifdef CONFIG_HOTPLUG_CPU
 void bman_migrate_portal_back(struct bman_portal *portal, unsigned int cpu);
+#endif /* CONFIG_HOTPLUG_CPU */
 #endif /* CONFIG_FSL_BMAN_CONFIG */
diff --git a/drivers/staging/fsl_qbman/qman_driver.c b/drivers/staging/fsl_qbman/qman_driver.c
index 9d60ca1..53e5f176 100644
--- a/drivers/staging/fsl_qbman/qman_driver.c
+++ b/drivers/staging/fsl_qbman/qman_driver.c
@@ -642,6 +642,7 @@ static void qman_offline_cpu(unsigned int cpu)
 		qman_migrate_portal(p);
 }
 
+#ifdef CONFIG_HOTPLUG_CPU
 static void qman_online_cpu(unsigned int cpu)
 {
 	struct qman_portal *p;
@@ -650,7 +651,6 @@ static void qman_online_cpu(unsigned int cpu)
 		qman_migrate_portal_back(p, cpu);
 }
 
-#ifdef CONFIG_HOTPLUG_CPU
 static int __cpuinit qman_hotplug_cpu_callback(struct notifier_block *nfb,
 				unsigned long action, void *hcpu)
 {
diff --git a/drivers/staging/fsl_qbman/qman_high.c b/drivers/staging/fsl_qbman/qman_high.c
index b369cd5..821349a 100644
--- a/drivers/staging/fsl_qbman/qman_high.c
+++ b/drivers/staging/fsl_qbman/qman_high.c
@@ -4919,6 +4919,7 @@ void qman_migrate_portal(struct qman_portal *portal)
 	PORTAL_IRQ_UNLOCK(portal, irqflags);
 }
 
+#ifdef CONFIG_HOTPLUG_CPU
 /* Migrate the portal back to the affined cpu once that cpu appears.*/
 void qman_migrate_portal_back(struct qman_portal *portal, unsigned int cpu)
 {
@@ -4928,3 +4929,4 @@ void qman_migrate_portal_back(struct qman_portal *portal, unsigned int cpu)
 	irq_set_affinity(portal->config->public_cfg.irq, cpumask_of(cpu));
 	PORTAL_IRQ_UNLOCK(portal, irqflags);
 }
+#endif /* CONFIG_HOTPLUG_CPU */
diff --git a/drivers/staging/fsl_qbman/qman_private.h b/drivers/staging/fsl_qbman/qman_private.h
index fd322e0..17314a8 100644
--- a/drivers/staging/fsl_qbman/qman_private.h
+++ b/drivers/staging/fsl_qbman/qman_private.h
@@ -395,4 +395,6 @@ int qman_ceetm_get_xsfdr(enum qm_dc_portal portal, unsigned int *num);
 extern void *affine_portals[NR_CPUS];
 int qman_portal_is_sharing_redirect(struct qman_portal *portal);
 void qman_migrate_portal(struct qman_portal *portal);
+#ifdef CONFIG_HOTPLUG_CPU
 void qman_migrate_portal_back(struct qman_portal *portal, unsigned int cpu);
+#endif /* CONFIG_HOTPLUG_CPU */
-- 
1.9.1

