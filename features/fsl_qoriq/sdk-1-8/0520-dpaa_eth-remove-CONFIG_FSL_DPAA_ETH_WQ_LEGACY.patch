From a7d4aaeffb84f1507486218a99be79d11bf98361 Mon Sep 17 00:00:00 2001
From: Madalin Bucur <madalin.bucur@freescale.com>
Date: Mon, 20 Jan 2014 18:50:33 +0200
Subject: [PATCH 520/987] dpaa_eth: remove CONFIG_FSL_DPAA_ETH_WQ_LEGACY

[Original patch taken from QorIQ-SDK-V1.6-SOURCE-20140619-yocto.iso]

De-feature obsolete option CONFIG_FSL_DPAA_ETH_WQ_LEGACY
and default to CONFIG_FSL_DPAA_ETH_WQ_MULTI behavior.

Signed-off-by: Madalin Bucur <madalin.bucur@freescale.com>
Change-Id: I2a68309d494ea2016dab6989281f76216b069f51
Reviewed-on: http://git.am.freescale.net:8181/8114
Tested-by: Review Code-CDREVIEW <CDREVIEW@freescale.com>
Reviewed-by: Bogdan Hamciuc <bogdan.hamciuc@freescale.com>
Reviewed-by: Ruxandra Ioana Radulescu <ruxandra.radulescu@freescale.com>
(cherry picked from commit 765648bf1b6b2b4d2fdf43d1bb7c99ca25b83ec0)
Reviewed-on: http://git.am.freescale.net:8181/8462
---
 drivers/net/ethernet/freescale/dpa/Kconfig    | 22 ----------------------
 drivers/net/ethernet/freescale/dpa/dpaa_eth.h | 18 ------------------
 2 files changed, 40 deletions(-)

diff --git a/drivers/net/ethernet/freescale/dpa/Kconfig b/drivers/net/ethernet/freescale/dpa/Kconfig
index 64b61e7..2d4544e3 100644
--- a/drivers/net/ethernet/freescale/dpa/Kconfig
+++ b/drivers/net/ethernet/freescale/dpa/Kconfig
@@ -53,28 +53,6 @@ config FSL_DPAA_TS
 	---help---
 	  Enable Linux API compliant timestamping support.
 
-choice FSL_DPAA_ETH_WQ_ASSIGN
-	prompt "WorkQueue assignment scheme for FrameQueues"
-	depends on FSL_DPAA_ETH
-	default FSL_DPAA_ETH_WQ_MULTI
-	---help---
-	  Selects the FrameQueue to WorkQueue assignment scheme.
-
-	config FSL_DPAA_ETH_WQ_LEGACY
-		bool "Legacy WQ assignment"
-		---help---
-		  Statically-defined FQIDs are round-robin assigned to all WQs (0..7). PCD queues are always
-		  in this category. Other frame queues may be those used for "MAC-less" or "shared MAC" configurations
-		  of the driver.
-		  Dynamically-defined FQIDs all go to WQ7.
-	config FSL_DPAA_ETH_WQ_MULTI
-	bool "Multi-WQ assignment"
-	---help---
-	  Tx Confirmation FQs go to WQ1.
-	  Rx Default, Tx and PCD FQs go to WQ3.
-	  Rx Error and Tx Error FQs go to WQ2.
-endchoice
-
 config FSL_DPAA_ETH_USE_NDO_SELECT_QUEUE
 	bool "Use driver's Tx queue selection mechanism"
 	default y
diff --git a/drivers/net/ethernet/freescale/dpa/dpaa_eth.h b/drivers/net/ethernet/freescale/dpa/dpaa_eth.h
index 3f3f2ce..4c934ac 100644
--- a/drivers/net/ethernet/freescale/dpa/dpaa_eth.h
+++ b/drivers/net/ethernet/freescale/dpa/dpaa_eth.h
@@ -583,19 +583,6 @@ static inline int __hot dpa_xmit(struct dpa_priv_s *priv,
 	return 0;
 }
 
-#if defined CONFIG_FSL_DPAA_ETH_WQ_LEGACY
-#define DPA_NUM_WQS 8
-/* Older WQ assignment: statically-defined FQIDs (such as PCDs) are assigned
- * round-robin to all WQs available. Dynamically-allocated FQIDs go to WQ7.
- *
- * Not necessarily the best scheme, but worked fine so far, so we might want
- * to keep it around for a while.
- */
-static inline void _dpa_assign_wq(struct dpa_fq *fq)
-{
-	fq->wq = fq->fqid ? fq->fqid % DPA_NUM_WQS : DPA_NUM_WQS - 1;
-}
-#elif defined CONFIG_FSL_DPAA_ETH_WQ_MULTI
 /* Use multiple WQs for FQ assignment:
  *	- Tx Confirmation queues go to WQ1.
  *	- Rx Default, Tx and PCD queues go to WQ3 (no differentiation between
@@ -631,11 +618,6 @@ static inline void _dpa_assign_wq(struct dpa_fq *fq)
 		       fq->fq_type, fq->fqid);
 	}
 }
-#else
-/* This shouldn't happen, since we've made a "default" choice in the Kconfig. */
-#warning "No WQ assignment scheme chosen; Kconfig out-of-sync?"
-#endif /* CONFIG_FSL_DPAA_ETH_WQ_ASSIGN_* */
-
 
 #ifdef CONFIG_FSL_DPAA_ETH_USE_NDO_SELECT_QUEUE
 /* Use in lieu of skb_get_queue_mapping() */
-- 
1.9.1

