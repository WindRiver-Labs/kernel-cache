From e397cbabb54ef61b5bbe645192bb36517203349e Mon Sep 17 00:00:00 2001
From: Cristian Sovaiala <cristian.sovaiala@freescale.com>
Date: Thu, 10 Apr 2014 15:47:10 +0300
Subject: [PATCH 646/987] fmd: Unmask normal Fman interrupt when entering sleep
 mode

[Original patch taken from QorIQ-SDK-V1.6-SOURCE-20140619-yocto.iso]

Magic Packet raises normal Fman interrupt so unmask it when
the system enters sleep/deep sleep mode such that the system
can be woken up.

Signed-off-by: Cristian Sovaiala <cristian.sovaiala@freescale.com>
Change-Id: I6325493dad3d0ea54a34575d6a24229fd351fbde
Reviewed-on: http://git.am.freescale.net:8181/10888
Reviewed-by: Mandy Lavi <Mandy.Lavi@freescale.com>
Reviewed-by: Madalin-Cristian Bucur <madalin.bucur@freescale.com>
Tested-by: Madalin-Cristian Bucur <madalin.bucur@freescale.com>
(cherry picked from commit a55ee50a7e6907561f21015ba8dc6a022b46722e)
Reviewed-on: http://git.am.freescale.net:8181/10924
---
 drivers/net/ethernet/freescale/fman/src/wrapper/lnxwrp_fm.c | 2 +-
 1 file changed, 1 insertion(+), 1 deletion(-)

diff --git a/drivers/net/ethernet/freescale/fman/src/wrapper/lnxwrp_fm.c b/drivers/net/ethernet/freescale/fman/src/wrapper/lnxwrp_fm.c
index 7c09d8b..0da272b 100755
--- a/drivers/net/ethernet/freescale/fman/src/wrapper/lnxwrp_fm.c
+++ b/drivers/net/ethernet/freescale/fman/src/wrapper/lnxwrp_fm.c
@@ -790,7 +790,7 @@ static t_Error ConfigureFmDev(t_LnxWrpFmDev  *p_LnxWrpFmDev)
     if (unlikely(_errno < 0))
         RETURN_ERROR(MAJOR, E_INVALID_STATE, ("can_request_irq() = %d", _errno));
 #endif
-    _errno = devm_request_irq(p_LnxWrpFmDev->dev, p_LnxWrpFmDev->irq, fm_irq, 0, "fman", p_LnxWrpFmDev);
+    _errno = devm_request_irq(p_LnxWrpFmDev->dev, p_LnxWrpFmDev->irq, fm_irq, IRQF_NO_SUSPEND, "fman", p_LnxWrpFmDev);
     if (unlikely(_errno < 0))
         RETURN_ERROR(MAJOR, E_INVALID_STATE, ("request_irq(%d) = %d", p_LnxWrpFmDev->irq, _errno));
 
-- 
1.9.1

