From 5ebee5672de08b59183f5335fe2feb6a85ba702f Mon Sep 17 00:00:00 2001
From: Jianhua Xie <jianhua.xie@freescale.com>
Date: Fri, 7 Mar 2014 16:22:18 +0800
Subject: [PATCH 17/57] powerpc/t1040/dts: Enable oh port5 to support LAG

Enable one offline port5 with a buffer pool to support
HW based LAG for T1040QDS/RDB. The dts codes are borrowed
from other USDPAA dts file.

Change-Id: Ifc67f8a9fc8e5fadfe59d76bc54532c9f3f99586
Signed-off-by: Jianhua Xie <jianhua.xie@freescale.com>
Reviewed-by: Mandy Lavi <Mandy.Lavi@freescale.com>
Reviewed-on: http://git.am.freescale.net:8181/10416
Tested-by: Review Code-CDREVIEW <CDREVIEW@freescale.com>
Reviewed-by: Jiafei Pan <Jiafei.Pan@freescale.com>
Reviewed-by: Jose Rivera <German.Rivera@freescale.com>
[Original patch taken from QorIQ-SDK-V1.8-20150619-yocto.]
Signed-off-by: Yanjiang Jin <yanjiang.jin@windriver.com>
---
 arch/powerpc/boot/dts/t1040rdb.dts  |   18 ++++++++++++++++++
 arch/powerpc/boot/dts/t104xqds.dtsi |   17 +++++++++++++++++
 2 files changed, 35 insertions(+), 0 deletions(-)

diff --git a/arch/powerpc/boot/dts/t1040rdb.dts b/arch/powerpc/boot/dts/t1040rdb.dts
index dcb5a93..d1caf30 100644
--- a/arch/powerpc/boot/dts/t1040rdb.dts
+++ b/arch/powerpc/boot/dts/t1040rdb.dts
@@ -304,6 +304,14 @@
 		};
 	};
 
+	/* bp dts definition is borrowed from other USDPAA dts */
+	bp6: buffer-pool@6 {
+		compatible = "fsl,t1040-bpool", "fsl,bpool";
+		fsl,bpid = <6>;
+		fsl,bpool-ethernet-cfg = <0 0 0 1728 0 0xfeedabba>;
+		fsl,bpool-thresholds = <0x100 0x300 0x0 0x0>;
+	};
+
 	fsl,dpaa {
 		compatible = "fsl,t1040-dpaa", "fsl,dpaa";
 		ethernet@0 {
@@ -331,6 +339,16 @@
 			fsl,fman-mac = <&enet4>;
 			sleep = <&rcpm 0x08000008>;
 		};
+		/* enable one offline port */
+		dpa-fman0-oh@5 {
+			compatible = "fsl,dpa-oh";
+			/* Define frame queues for the OH port*/
+			/* <OH Rx error, OH Rx default> */
+			fsl,qman-frame-queues-oh = <0x68 1 0x69 1>;
+			fsl,bman-buffer-pools = <&bp6>;
+			fsl,qman-frame-queues-tx = <0x90 8>;
+			fsl,fman-oh-port = <&fman0_oh5>;
+		};
 	};
 
 	qe: qe@ffe139999 {
diff --git a/arch/powerpc/boot/dts/t104xqds.dtsi b/arch/powerpc/boot/dts/t104xqds.dtsi
index 079a4cd..ba4de7f 100644
--- a/arch/powerpc/boot/dts/t104xqds.dtsi
+++ b/arch/powerpc/boot/dts/t104xqds.dtsi
@@ -329,6 +329,13 @@
 			};
 		};
 	};
+	/* bp dts definition is borrowed from other USDPAA dts */
+	bp6: buffer-pool@6 {
+		compatible = "fsl,t1040-bpool", "fsl,bpool";
+		fsl,bpid = <6>;
+		fsl,bpool-ethernet-cfg = <0 0 0 1728 0 0xfeedabba>;
+		fsl,bpool-thresholds = <0x100 0x300 0x0 0x0>;
+	};
 
 	fsl,dpaa {
 		compatible = "fsl,t1040-dpaa", "fsl,dpaa";
@@ -357,6 +364,16 @@
 			fsl,fman-mac = <&enet4>;
 			sleep = <&rcpm 0x08000008>;
 		};
+		/* Enable one offline port as default to support HW based LAG */
+		dpa-fman0-oh@5 {
+			compatible = "fsl,dpa-oh";
+			/* Define frame queues for the OH port*/
+			/* <OH Rx error, OH Rx default> */
+			fsl,qman-frame-queues-oh = <0x68 1 0x69 1>;
+			fsl,bman-buffer-pools = <&bp6>;
+			fsl,qman-frame-queues-tx = <0x90 8>;
+			fsl,fman-oh-port = <&fman0_oh5>;
+		};
 	};
 
 	pci0: pcie@ffe240000 {
-- 
1.7.5.4

