From ed62c6368e6b37f82e8f4ce9133ea4e71df2b69b Mon Sep 17 00:00:00 2001
From: Yangbo Lu <yangbo.lu@freescale.com>
Date: Wed, 26 Nov 2014 13:15:21 +0800
Subject: [PATCH 799/987] dpaa_eth: fix PTPd 1588 stack sync issue

It existed a settime issue for 1588 timer module on
some platforms' 32-bit kernels. It's caused by the
difference of data type length between 32-bit and 64-bit
platforms or kernels.

Signed-off-by: Yangbo Lu <yangbo.lu@freescale.com>
Change-Id: Ia223770de71fd30d08c6dab5d58bec62719e4a32
Reviewed-on: http://git.am.freescale.net:8181/24537
Tested-by: Review Code-CDREVIEW <CDREVIEW@freescale.com>
Reviewed-by: Xiaobo Xie <X.Xie@freescale.com>
Reviewed-by: Richard Schmitt <richard.schmitt@freescale.com>
[Lu:Original patch taken from
QorIQ-SDK-V1.7-SOURCE-20141218-yocto.iso]
Signed-off-by: Jiang Lu <lu.jiang@windriver.com>
---
 drivers/net/ethernet/freescale/fman/Peripherals/FM/Rtc/fm_rtc.c | 2 +-
 1 file changed, 1 insertion(+), 1 deletion(-)

diff --git a/drivers/net/ethernet/freescale/fman/Peripherals/FM/Rtc/fm_rtc.c b/drivers/net/ethernet/freescale/fman/Peripherals/FM/Rtc/fm_rtc.c
index 2745dc4..5ea7a16 100644
--- a/drivers/net/ethernet/freescale/fman/Peripherals/FM/Rtc/fm_rtc.c
+++ b/drivers/net/ethernet/freescale/fman/Peripherals/FM/Rtc/fm_rtc.c
@@ -629,7 +629,7 @@ t_Error FM_RTC_SetCurrentTime(t_Handle h_FmRtc, uint64_t ts)
     SANITY_CHECK_RETURN_ERROR(!p_Rtc->p_RtcDriverParam, E_INVALID_STATE);
 
     ts = ts/p_Rtc->clockPeriodNanoSec;
-    fman_rtc_set_timer(p_Rtc->p_MemMap, (unsigned long)ts);
+    fman_rtc_set_timer(p_Rtc->p_MemMap, (int64_t)ts);
 
     return E_OK;
 }
-- 
1.9.1

