From 41098a5890ae727242d8c1bb377b3ec56c89968f Mon Sep 17 00:00:00 2001
From: Quanyang Wang <quanyang.wang@windriver.com>
Date: Wed, 18 Nov 2015 17:12:32 +0800
Subject: [PATCH 1343/1350] crypto: caam - fix compile warning

Because of upstream commit cbceeefd8724
("crypto: caam - fix resource clean-up on error path for caam_jr_init"),
tasklet_kill is used to clean up resources, but in sdk we have used NAPI
instead of tasklet. So use NAPI cleanup code instead, or else it will
occur compile warning as below:

drivers/crypto/caam/jr.c: 603:15: warning: passing argument 1 of 'tasklet_kill' from incompatible pointer type [-Wincompatible-pointer-types]
  tasklet_kill(&jrp->irqtask);
               ^
Signed-off-by: Quanyang Wang <quanyang.wang@windriver.com>
---
 drivers/crypto/caam/jr.c | 8 +++++++-
 1 file changed, 7 insertions(+), 1 deletion(-)

diff --git a/drivers/crypto/caam/jr.c b/drivers/crypto/caam/jr.c
index e264926..a7a8dd0 100644
--- a/drivers/crypto/caam/jr.c
+++ b/drivers/crypto/caam/jr.c
@@ -600,7 +600,13 @@ out_free_inpring:
 out_free_irq:
 	free_irq(jrp->irq, dev);
 out_kill_deq:
-	tasklet_kill(&jrp->irqtask);
+	for_each_possible_cpu(i) {
+		napi_disable(per_cpu_ptr(jrp->irqtask, i));
+		netif_napi_del(per_cpu_ptr(jrp->irqtask, i));
+	}
+	free_percpu(jrp->irqtask);
+	free_percpu(jrp->net_dev);
+
 	return error;
 }
 
-- 
2.0.2

