From 23e7960b4dbb2833e6ed951fc35aefdb4cadd918 Mon Sep 17 00:00:00 2001
From: Radu Bulie <radu.bulie@freescale.com>
Date: Sun, 26 May 2013 10:58:17 +0000
Subject: [PATCH 197/987] dpa_offload: Bug fix. Fix policer profile parameters
 for multicast component

[Original patch taken from QorIQ-SDK-V1.6-SOURCE-20140619-yocto.iso]

Some parameters regarding policer were not set for multicast component
and other were set incorrectly.

Signed-off-by: Radu Bulie <radu.bulie@freescale.com>
Change-Id: Ia603d30c9b85d10db65281d74735c2cf160dc8fe
Reviewed-on: http://git.am.freescale.net:8181/2699
Tested-by: Review Code-CDREVIEW <CDREVIEW@freescale.com>
Reviewed-by: Chereji Marian-Cornel-R27762 <marian.chereji@freescale.com>
Reviewed-by: Fleming Andrew-AFLEMING <AFLEMING@freescale.com>
---
 drivers/staging/fsl_dpa_offload/dpa_classifier.c | 35 ++++++++++++++++--------
 1 file changed, 24 insertions(+), 11 deletions(-)

diff --git a/drivers/staging/fsl_dpa_offload/dpa_classifier.c b/drivers/staging/fsl_dpa_offload/dpa_classifier.c
index da291de..4208546 100644
--- a/drivers/staging/fsl_dpa_offload/dpa_classifier.c
+++ b/drivers/staging/fsl_dpa_offload/dpa_classifier.c
@@ -7559,18 +7559,27 @@ int dpa_classif_mcast_create_group(
 				next_engine_params->params.plcrParams.
 					newRelativeProfileId =
 			      member_params->policer_params->new_rel_profile_id;
+				next_engine_params->params.plcrParams.
+					overrideParams =
+			   member_params->policer_params->modify_policer_params;
+				next_engine_params->params.plcrParams.
+					newFqid =  member_params->new_fqid;
 			} else {
 				next_engine_params->nextEngine = e_FM_PCD_DONE;
 				next_engine_params->params.enqueueParams.
 					newRelativeStorageProfileId =
 						  member_params->new_rel_vsp_id;
+				next_engine_params->params.enqueueParams.
+						   action =
+							     e_FM_PCD_ENQ_FRAME;
+				next_engine_params->params.enqueueParams.
+					overrideFqid =
+						   member_params->override_fqid;
+				next_engine_params->params.enqueueParams.
+					newFqid =
+						   member_params->new_fqid;
 			}
-			next_engine_params->params.enqueueParams.action =
-						e_FM_PCD_ENQ_FRAME;
-			next_engine_params->params.enqueueParams.overrideFqid =
-						  member_params->override_fqid;
-			next_engine_params->params.enqueueParams.newFqid =
-						  member_params->new_fqid;
+
 		}
 		if (member_params->hmd != DPA_OFFLD_DESC_NONE) {
 			pgroup->entries[0].hmd = member_params->hmd;
@@ -7780,18 +7789,22 @@ int dpa_classif_mcast_add_member(int grpd,
 			next_engine_params->params.plcrParams.
 				newRelativeProfileId =
 			      member_params->policer_params->new_rel_profile_id;
+			next_engine_params->params.plcrParams.overrideParams =
+			   member_params->policer_params->modify_policer_params;
+			next_engine_params->params.plcrParams.newFqid =
+							member_params->new_fqid;
 		} else {
 			next_engine_params->nextEngine = e_FM_PCD_DONE;
 			next_engine_params->params.enqueueParams.
 				newRelativeStorageProfileId =
 						  member_params->new_rel_vsp_id;
-		}
-		next_engine_params->params.enqueueParams.action =
+			next_engine_params->params.enqueueParams.action =
 							     e_FM_PCD_ENQ_FRAME;
-		next_engine_params->params.enqueueParams.overrideFqid =
+			next_engine_params->params.enqueueParams.overrideFqid =
 						   member_params->override_fqid;
-		next_engine_params->params.enqueueParams.newFqid =
-						   member_params->new_fqid;
+			next_engine_params->params.enqueueParams.newFqid =
+							member_params->new_fqid;
+		}
 	}
 
 	if (member_params->hmd != DPA_OFFLD_DESC_NONE) {
-- 
1.9.1

