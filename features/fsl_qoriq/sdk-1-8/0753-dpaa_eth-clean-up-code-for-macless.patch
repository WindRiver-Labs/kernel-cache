From 6a029fb4b6ed5b3e94c4c33c8a77770c19d06805 Mon Sep 17 00:00:00 2001
From: Marian Rotariu <marian.rotariu@freescale.com>
Date: Mon, 16 Jun 2014 18:36:35 +0300
Subject: [PATCH 753/987] dpaa_eth: clean-up code for macless

Remove unused local variable and unnecessary CGR function calls. Macless does
not use CGR capabilities or specific port fqs.

Signed-off-by: Marian Rotariu <marian.rotariu@freescale.com>
Change-Id: I13ac2037266948a22ab16606bd65e9e965d9aa32
Reviewed-on: http://git.am.freescale.net:8181/13672
Tested-by: Review Code-CDREVIEW <CDREVIEW@freescale.com>
Reviewed-by: Cristian-Constantin Sovaiala <Cristian.Sovaiala@freescale.com>
Reviewed-by: Madalin-Cristian Bucur <madalin.bucur@freescale.com>
[Lu:Original patch taken from
QorIQ-SDK-V1.7-SOURCE-20141218-yocto.iso]
Signed-off-by: Jiang Lu <lu.jiang@windriver.com>
---
 drivers/net/ethernet/freescale/dpa/dpaa_eth_macless.c | 8 +-------
 1 file changed, 1 insertion(+), 7 deletions(-)

diff --git a/drivers/net/ethernet/freescale/dpa/dpaa_eth_macless.c b/drivers/net/ethernet/freescale/dpa/dpaa_eth_macless.c
index 56bf16b..f27ce5c 100644
--- a/drivers/net/ethernet/freescale/dpa/dpaa_eth_macless.c
+++ b/drivers/net/ethernet/freescale/dpa/dpaa_eth_macless.c
@@ -320,7 +320,6 @@ static int dpaa_eth_macless_probe(struct platform_device *_of_dev)
 	struct dpa_priv_s *priv = NULL;
 	struct dpa_percpu_priv_s *percpu_priv;
 	static struct proxy_device *proxy_dev;
-	struct fm_port_fqs port_fqs;
 	struct task_struct *kth;
 	static u8 macless_idx;
 
@@ -381,8 +380,6 @@ static int dpaa_eth_macless_probe(struct platform_device *_of_dev)
 
 	INIT_LIST_HEAD(&priv->dpa_fq_list);
 
-	memset(&port_fqs, 0, sizeof(port_fqs));
-
 	err = dpa_fq_probe_macless(dev, &priv->dpa_fq_list, RX);
 	if (!err)
 		err = dpa_fq_probe_macless(dev, &priv->dpa_fq_list,
@@ -461,11 +458,8 @@ netdev_init_failed:
 		free_percpu(priv->percpu_priv);
 alloc_percpu_failed:
 fq_alloc_failed:
-	if (net_dev) {
+	if (net_dev)
 		dpa_fq_free(dev, &priv->dpa_fq_list);
-		qman_release_cgrid(priv->cgr_data.cgr.cgrid);
-		qman_delete_cgr(&priv->cgr_data.cgr);
-	}
 add_channel_failed:
 get_channel_failed:
 	if (net_dev)
-- 
1.9.1

