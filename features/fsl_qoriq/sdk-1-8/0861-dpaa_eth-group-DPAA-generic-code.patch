From 233524c43407aa5e98dae0a889682185845a60b3 Mon Sep 17 00:00:00 2001
From: Madalin Bucur <madalin.bucur@freescale.com>
Date: Fri, 25 Jul 2014 10:23:15 +0300
Subject: [PATCH 861/987] dpaa_eth: group DPAA generic code

Group DPAA Ethernet generic driver code under one Kconfig option.

Signed-off-by: Madalin Bucur <madalin.bucur@freescale.com>
Change-Id: I96061198d022d344280f8b52b14f25e9b3daf2ba
Reviewed-on: http://git.am.freescale.net:8181/15298
Reviewed-by: Cristian Bercaru <cristian.bercaru@freescale.com>

Conflicts:
	drivers/net/ethernet/freescale/dpa/Makefile
[Yang: Original patch taken from
QorIQ-SDK-V1.8-SOURCE-20150619-yocto.iso]
Signed-off-by: Quanyang Wang <quanyang.wang@windriver.com>
---
 drivers/net/ethernet/freescale/dpa/Kconfig  |  7 +++++++
 drivers/net/ethernet/freescale/dpa/Makefile | 17 ++++++++++++-----
 2 files changed, 19 insertions(+), 5 deletions(-)

diff --git a/drivers/net/ethernet/freescale/dpa/Kconfig b/drivers/net/ethernet/freescale/dpa/Kconfig
index 477f7fc..46edb58 100644
--- a/drivers/net/ethernet/freescale/dpa/Kconfig
+++ b/drivers/net/ethernet/freescale/dpa/Kconfig
@@ -61,6 +61,13 @@ config FSL_DPAA_ADVANCED_DRIVERS
 	  - DPAA Proxy initialization driver (for USDPAA)
 	  Select this to also build the advanced drivers.
 
+config FSL_DPAA_GENERIC_DRIVER
+	bool "Generic DPAA Ethernet driver"
+	depends on FSL_DPAA_ETH
+	default y
+	---help---
+	  This enables the DPAA Generic driver (oNIC).
+
 config FSL_DPAA_ETH_JUMBO_FRAME
 	bool "Optimize for jumbo frames"
 	default n
diff --git a/drivers/net/ethernet/freescale/dpa/Makefile b/drivers/net/ethernet/freescale/dpa/Makefile
index b716dbf..9a05012 100644
--- a/drivers/net/ethernet/freescale/dpa/Makefile
+++ b/drivers/net/ethernet/freescale/dpa/Makefile
@@ -10,9 +10,8 @@ ccflags-y += -I$(NET_DPA)
 
 obj-$(CONFIG_FSL_DPAA_1588) += dpaa_1588.o
 # dpaa_debugfs needs to be initialized before dpaa_eth
-obj-$(CONFIG_FSL_DPAA_ETH_DEBUGFS) += dpaa_debugfs.o dpaa_generic_debugfs.o
-obj-$(CONFIG_FSL_DPAA_ETH) += fsl-mac.o fsl-dpa.o fsl-dpa-common.o \
- fsl-dpa-generic.o
+obj-$(CONFIG_FSL_DPAA_ETH_DEBUGFS) += dpaa_debugfs.o
+obj-$(CONFIG_FSL_DPAA_ETH) += fsl-mac.o fsl-dpa.o fsl-dpa-common.o
 obj-$(CONFIG_PTP_1588_CLOCK_DPAA) += dpaa_ptp.o
 
 fsl-dpa-objs	:= dpaa_ethtool.o dpaa_eth_sysfs.o \
@@ -31,8 +30,16 @@ fsl_oh-objs += offline_port.o
 endif
 endif
 
-fsl-dpa-generic-objs	:= dpaa_eth_generic.o dpaa_eth_generic_sysfs.o \
- dpaa_generic_ethtool.o
+# Generic driver
+ifeq ($(CONFIG_FSL_DPAA_GENERIC_DRIVER),y)
+obj-$(CONFIG_FSL_DPAA_ETH) += fsl_generic.o
+
+fsl_generic-objs += dpaa_eth_generic.o dpaa_eth_generic_sysfs.o dpaa_generic_ethtool.o
+ifeq ($(CONFIG_FSL_DPAA_ETH_DEBUGFS),y)
+fsl_generic-objs += dpaa_generic_debugfs.o
+endif
+endif
+
 fsl-mac-objs	:= mac.o mac-api.o
 obj-$(CONFIG_FSL_CAPWAP) += capwap/
 
-- 
1.9.1

