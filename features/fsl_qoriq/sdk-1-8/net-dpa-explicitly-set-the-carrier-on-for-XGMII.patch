From d7972ee3b95fafcb21a6f8b636a2b8af9b1d8d2d Mon Sep 17 00:00:00 2001
From: Kevin Hao <kexin.hao@windriver.com>
Date: Thu, 31 Mar 2016 10:49:45 +0800
Subject: [PATCH] net: dpa: explicitly set the carrier on for XGMII

In commit ("net: dpa: call netif_carrier_off() before register netdev"),
we choose to set the carrier off and assume that the phy state machine
will set the carrier on eventually. But this is not true for XGMII
since we don't support to update the phy link status automatically for
it and even don't start the phy state machine. So we have to explicitly
set the carrier on after starting the mac.

Signed-off-by: Kevin Hao <kexin.hao@windriver.com>
---
 drivers/net/ethernet/freescale/dpa/mac-api.c |    4 +++-
 1 files changed, 3 insertions(+), 1 deletions(-)

diff --git a/drivers/net/ethernet/freescale/dpa/mac-api.c b/drivers/net/ethernet/freescale/dpa/mac-api.c
index 323d0f1..8e03f10 100644
--- a/drivers/net/ethernet/freescale/dpa/mac-api.c
+++ b/drivers/net/ethernet/freescale/dpa/mac-api.c
@@ -276,8 +276,10 @@ static int __cold start(struct mac_device *mac_dev)
 	if (!_errno && phy_dev) {
 		if (macdev2enetinterface(mac_dev) != e_ENET_MODE_XGMII_10000)
 			phy_start(phy_dev);
-		else if (phy_dev->drv->read_status)
+		else if (phy_dev->drv->read_status) {
 			phy_dev->drv->read_status(phy_dev);
+			netif_carrier_on(phy_dev->attached_dev);
+		}
 	}
 
 	return _errno;
-- 
1.7.5.4

