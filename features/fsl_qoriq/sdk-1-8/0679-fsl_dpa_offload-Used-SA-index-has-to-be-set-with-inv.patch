From dd2e3dc9ea7825fbe51d83ad540a9280c75b620a Mon Sep 17 00:00:00 2001
From: Andrei Varvara <andrei.varvara@freescale.com>
Date: Thu, 8 May 2014 13:19:25 +0300
Subject: [PATCH 679/987] fsl_dpa_offload: Used SA index has to be set with
 invalid value at initialization

[Original patch taken from QorIQ-SDK-V1.6-SOURCE-20140619-yocto.iso]

used_sa_index field is used to check if SA is being initialized and used.
Have to be set to -1 when init_sa_manager is called.

Signed-off-by: Andrei Varvara <andrei.varvara@freescale.com>
Change-Id: Ie227979a3fc2f713d9c368245f9884c347a11434
Reviewed-on: http://git.am.freescale.net:8181/12044
Tested-by: Review Code-CDREVIEW <CDREVIEW@freescale.com>
Reviewed-by: Marian-Cornel Chereji <marian.chereji@freescale.com>
Reviewed-by: Jose Rivera <German.Rivera@freescale.com>
---
 drivers/staging/fsl_dpa_offload/dpa_ipsec.c | 1 +
 1 file changed, 1 insertion(+)

diff --git a/drivers/staging/fsl_dpa_offload/dpa_ipsec.c b/drivers/staging/fsl_dpa_offload/dpa_ipsec.c
index aba4710..3e14ca5 100644
--- a/drivers/staging/fsl_dpa_offload/dpa_ipsec.c
+++ b/drivers/staging/fsl_dpa_offload/dpa_ipsec.c
@@ -1055,6 +1055,7 @@ static int init_sa_manager(struct dpa_ipsec *dpa_ipsec)
 
 		/* init the inbound SA lookup table desc with an invalid value*/
 		sa[i].inbound_sa_td = DPA_OFFLD_DESC_NONE;
+		sa[i].used_sa_index = -1;
 	}
 
 	/*
-- 
1.9.1

