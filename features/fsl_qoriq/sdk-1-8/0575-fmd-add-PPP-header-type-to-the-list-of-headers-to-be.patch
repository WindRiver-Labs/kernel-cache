From 90647f2ea68fe5005ae0bf63d52135d07283569c Mon Sep 17 00:00:00 2001
From: Mandy Lavi <mandy.lavi@freescale.com>
Date: Mon, 16 Dec 2013 15:37:24 +0200
Subject: [PATCH 575/987] fmd: add PPP header type to the list of headers to be
 handled

[Original patch taken from QorIQ-SDK-V1.6-SOURCE-20140619-yocto.iso]

Change-Id: I7347668005c7979c2c64a97cbf05c16faddff49a
Signed-off-by: Mandy Lavi <mandy.lavi@freescale.com>
Reviewed-on: http://git.am.freescale.net:8181/7945
Tested-by: Richard Schmitt <richard.schmitt@freescale.com>
Reviewed-by: Nir Erez <nir.erez@freescale.com>
Reviewed-by: Jose Rivera <German.Rivera@freescale.com>
(cherry picked from commit 978622644e30299070942ff53c9908c1c01e59e4)
Change-Id: I7347668005c7979c2c64a97cbf05c16faddff49a
Reviewed-on: http://git.am.freescale.net:8181/9383
Reviewed-by: Jose Rivera <German.Rivera@freescale.com>
Tested-by: Jose Rivera <German.Rivera@freescale.com>
---
 drivers/net/ethernet/freescale/fman/Peripherals/FM/Pcd/fm_kg.c     | 3 ++-
 drivers/net/ethernet/freescale/fman/Peripherals/FM/inc/fm_common.h | 1 +
 include/uapi/linux/fmd/Peripherals/fm_pcd_ioctls.h                 | 2 ++
 3 files changed, 5 insertions(+), 1 deletion(-)

diff --git a/drivers/net/ethernet/freescale/fman/Peripherals/FM/Pcd/fm_kg.c b/drivers/net/ethernet/freescale/fman/Peripherals/FM/Pcd/fm_kg.c
index 5570bb1..4b0edc2 100644
--- a/drivers/net/ethernet/freescale/fman/Peripherals/FM/Pcd/fm_kg.c
+++ b/drivers/net/ethernet/freescale/fman/Peripherals/FM/Pcd/fm_kg.c
@@ -1520,8 +1520,9 @@ static t_Error BuildSchemeRegs(t_FmPcdKgScheme            *p_Scheme,
                 swDefault = GetGenericSwDefault(swDefaults, numOfSwDefaults, code);
                 if (swDefault == e_FM_PCD_KG_DFLT_ILLEGAL)
                     DBG(WARNING, ("No sw default configured"));
+                else
+                    genTmp |= swDefault << KG_SCH_GEN_DEF_SHIFT;
 
-                genTmp |= swDefault << KG_SCH_GEN_DEF_SHIFT;
                 genTmp |= KG_SCH_GEN_MASK;
                 p_SchemeRegs->kgse_gec[currGenId] = genTmp;
                 /* save in driver structure */
diff --git a/drivers/net/ethernet/freescale/fman/Peripherals/FM/inc/fm_common.h b/drivers/net/ethernet/freescale/fman/Peripherals/FM/inc/fm_common.h
index d23c1d0..0d7bf55 100644
--- a/drivers/net/ethernet/freescale/fman/Peripherals/FM/inc/fm_common.h
+++ b/drivers/net/ethernet/freescale/fman/Peripherals/FM/inc/fm_common.h
@@ -584,6 +584,7 @@ switch (hdr)                                                \
     case (HEADER_TYPE_LLC_SNAP):         num = 1;  break;   \
     case (HEADER_TYPE_VLAN):             num = 2;  break;   \
     case (HEADER_TYPE_PPPoE):            num = 3;  break;   \
+    case (HEADER_TYPE_PPP):              num = 3;  break;   \
     case (HEADER_TYPE_MPLS):             num = 4;  break;   \
     case (HEADER_TYPE_IPv4):             num = 5;  break;   \
     case (HEADER_TYPE_IPv6):             num = 6;  break;   \
diff --git a/include/uapi/linux/fmd/Peripherals/fm_pcd_ioctls.h b/include/uapi/linux/fmd/Peripherals/fm_pcd_ioctls.h
index 542f935..45402e8 100644
--- a/include/uapi/linux/fmd/Peripherals/fm_pcd_ioctls.h
+++ b/include/uapi/linux/fmd/Peripherals/fm_pcd_ioctls.h
@@ -1213,8 +1213,10 @@ typedef struct ioc_fm_pcd_kg_scheme_params_t {
 /**************************************************************************//**
  @Collection
 *//***************************************************************************/
+#if DPAA_VERSION >= 11
 #define IOC_FM_PCD_CC_STATS_MAX_NUM_OF_FLR      10  /* Maximal supported number of frame length ranges */
 #define IOC_FM_PCD_CC_STATS_FLR_SIZE            2   /* Size in bytes of a frame length range limit */
+#endif /* DPAA_VERSION >= 11 */
 #define IOC_FM_PCD_CC_STATS_FLR_COUNT_SIZE      4   /* Size in bytes of a frame length range counter */
 /* @} */
 
-- 
1.9.1

