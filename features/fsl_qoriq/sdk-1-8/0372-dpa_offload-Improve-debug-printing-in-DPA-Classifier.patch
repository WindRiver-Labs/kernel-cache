From 1b4e134767d569142e458e347d5351afa241a55d Mon Sep 17 00:00:00 2001
From: Marian Chereji <marian.chereji@freescale.com>
Date: Wed, 4 Sep 2013 11:44:11 +0300
Subject: [PATCH 372/987] dpa_offload: Improve debug printing in DPA Classifier

[Original patch taken from QorIQ-SDK-V1.6-SOURCE-20140619-yocto.iso]

Signed-off-by: Marian Chereji <marian.chereji@freescale.com>
Change-Id: Ibe6ba10afc6447cf284b27cc7e3caed854eab304
Reviewed-on: http://git.am.freescale.net:8181/4413
Tested-by: Review Code-CDREVIEW <CDREVIEW@freescale.com>
Reviewed-by: Bulie Radu-Andrei-B37577 <Radu.Bulie@freescale.com>
Reviewed-by: Rivera Jose-B46482 <German.Rivera@freescale.com>
---
 drivers/staging/fsl_dpa_offload/dpa_classifier.c | 18 ++++++++++++++++++
 1 file changed, 18 insertions(+)

diff --git a/drivers/staging/fsl_dpa_offload/dpa_classifier.c b/drivers/staging/fsl_dpa_offload/dpa_classifier.c
index 3dc35bc..f8ed8b7 100644
--- a/drivers/staging/fsl_dpa_offload/dpa_classifier.c
+++ b/drivers/staging/fsl_dpa_offload/dpa_classifier.c
@@ -1673,6 +1673,12 @@ static int flush_table(struct dpa_cls_table *ptable)
 			int_cc_node = &ptable->int_cc_node[cc_node_index];
 
 			dpa_classif_hm_release_chain(index_entry->hmd);
+#ifdef DPA_CLASSIFIER_DEBUG
+			dpa_cls_dbg(("DEBUG: dpa_classifier %s (%d): Remove "
+				"entry #%d from table cc_node=0x%p.\n",
+				__func__, __LINE__, index_entry->entry_index,
+				cc_node));
+#endif /* DPA_CLASSIFIER_DEBUG */
 			err = FM_PCD_MatchTableRemoveKey(cc_node,
 						index_entry->entry_index);
 			if (err != E_OK) {
@@ -2444,6 +2450,18 @@ static int table_insert_entry_exact_match(struct dpa_cls_table	*cls_table,
 	}
 
 	/* Add the key to the selected Cc node */
+#ifdef DPA_CLASSIFIER_DEBUG
+	dpa_cls_dbg(("DEBUG: dpa_classifier %s (%d): Insert new entry in table "
+		"cc_node=0x%p.\n", __func__, __LINE__,
+		cls_table->int_cc_node[0].cc_node));
+	dpa_cls_dbg(("	index=%d; action type (id)=%d; hmd=%d; h_Manip=0x%p\n",
+		cls_table->entry[k].entry_index, action->type, hmd,
+		key_params.ccNextEngineParams.h_Manip));
+	dpa_cls_dbg(("	Lookup key (%d bytes): ",
+		cls_table->params.exact_match_params.key_size));
+	dump_lookup_key(key);
+	pr_err("\n");
+#endif /* DPA_CLASSIFIER_DEBUG */
 	err = FM_PCD_MatchTableAddKey((t_Handle)cls_table->
 			int_cc_node[0].cc_node,
 		cls_table->entry[k].entry_index,
-- 
1.9.1

