From 6327d959a87ba0012ffa8ed290c7b9ae930a4368 Mon Sep 17 00:00:00 2001
From: Meenakshi Aggarwal <meenakshi.aggarwal@freescale.com>
Date: Mon, 24 Mar 2014 16:34:15 +0530
Subject: [PATCH 614/987] fsl_qbman: remove unnecessary call to
 put_affine_portal()

[Original patch taken from QorIQ-SDK-V1.6-SOURCE-20140619-yocto.iso]

In bman_create_affine_slave() function :
- we used put_affine_portal() which should be called along with
  get_affine_portal() or get_raw_affine_portal().
- unnecessary call to put_affine_portal() leaves the function in
  invalid state and resulted in kernel panic.

Signed-off-by: Meenakshi Aggarwal <meenakshi.aggarwal@freescale.com>
Signed-off-by: Priyanka Jain <priyanka.jain@freescale.com>
Change-Id: I52a98c18b20d6f83f86ce462005f43e26fa1bdd9
Reviewed-on: http://git.am.freescale.net:8181/10283
Tested-by: Review Code-CDREVIEW <CDREVIEW@freescale.com>
Reviewed-by: Priyanka Jain <Priyanka.Jain@freescale.com>
Reviewed-by: Jose Rivera <German.Rivera@freescale.com>
---
 drivers/staging/fsl_qbman/bman_high.c | 1 -
 1 file changed, 1 deletion(-)

diff --git a/drivers/staging/fsl_qbman/bman_high.c b/drivers/staging/fsl_qbman/bman_high.c
index 16e9534..16445a7 100644
--- a/drivers/staging/fsl_qbman/bman_high.c
+++ b/drivers/staging/fsl_qbman/bman_high.c
@@ -326,7 +326,6 @@ struct bman_portal *bman_create_affine_slave(struct bman_portal *redirect,
 	BUG_ON(!redirect->config->public_cfg.is_shared);
 	p->irq_sources = 0;
 	p->sharing_redirect = redirect;
-	put_affine_portal();
 	return p;
 #else
 	BUG();
-- 
1.9.1

