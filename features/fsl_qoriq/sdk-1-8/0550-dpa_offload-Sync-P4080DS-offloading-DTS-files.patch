From 77e60035efb146b3e0143ae51c6ac6a1fc5ba6f9 Mon Sep 17 00:00:00 2001
From: Marian Chereji <marian.chereji@freescale.com>
Date: Fri, 14 Feb 2014 12:46:35 +0200
Subject: [PATCH 550/987] dpa_offload: Sync P4080DS offloading DTS files

[Original patch taken from QorIQ-SDK-V1.6-SOURCE-20140619-yocto.iso]

Updated the P4080DS DTS example files for DPA offloading applications
to bring them to the version delivered with SDK 1.5.

Signed-off-by: Marian Chereji <marian.chereji@freescale.com>
Change-Id: I36ceef07304fca5b65b450f93cfe66fc308a16ff
Reviewed-on: http://git.am.freescale.net:8181/8833
Tested-by: Review Code-CDREVIEW <CDREVIEW@freescale.com>
Reviewed-by: Radu-Andrei Bulie <Radu.Bulie@freescale.com>
Reviewed-by: Jose Rivera <German.Rivera@freescale.com>
---
 .../dts/p4080ds-usdpaa-shared-interfaces.dts       | 31 +++++++++++++++-------
 .../staging/fsl_dpa_offload/dts/p4080ds-usdpaa.dts | 11 +++++---
 .../fsl_dpa_offload/dts/p4080si-chosen-offld.dtsi  |  1 +
 3 files changed, 31 insertions(+), 12 deletions(-)

diff --git a/drivers/staging/fsl_dpa_offload/dts/p4080ds-usdpaa-shared-interfaces.dts b/drivers/staging/fsl_dpa_offload/dts/p4080ds-usdpaa-shared-interfaces.dts
index 574f733..1486ceb 100644
--- a/drivers/staging/fsl_dpa_offload/dts/p4080ds-usdpaa-shared-interfaces.dts
+++ b/drivers/staging/fsl_dpa_offload/dts/p4080ds-usdpaa-shared-interfaces.dts
@@ -76,7 +76,7 @@
 	fsl,dpaa {
 		ethernet@0 {
 			compatible = "fsl,p4080-dpa-ethernet-init", "fsl,dpa-ethernet-init";
-			fsl,bman-buffer-pools = <&bp7 &bp8 &bp9>;
+			fsl,bman-buffer-pools = <&bp16>;
 			fsl,qman-frame-queues-rx = <0x50 1 0x51 1>;
 			fsl,qman-frame-queues-tx = <0x70 1 0x71 1>;
 		};
@@ -87,19 +87,19 @@
 
 		ethernet@2 {
 			compatible = "fsl,p4080-dpa-ethernet-init", "fsl,dpa-ethernet-init";
-			fsl,bman-buffer-pools = <&bp7 &bp8 &bp9>;
+			fsl,bman-buffer-pools = <&bp16>;
 			fsl,qman-frame-queues-rx = <0x54 1 0x55 1>;
 			fsl,qman-frame-queues-tx = <0x74 1 0x75 1>;
 		};
 		ethernet@3 {
 			compatible = "fsl,p4080-dpa-ethernet-init", "fsl,dpa-ethernet-init";
-			fsl,bman-buffer-pools = <&bp7 &bp8 &bp9>;
+			fsl,bman-buffer-pools = <&bp16>;
 			fsl,qman-frame-queues-rx = <0x56 1 0x57 1>;
 			fsl,qman-frame-queues-tx = <0x76 1 0x77 1>;
 		};
 		ethernet@4 {
 			compatible = "fsl,p4080-dpa-ethernet-init", "fsl,dpa-ethernet-init";
-			fsl,bman-buffer-pools = <&bp7 &bp8 &bp9>;
+			fsl,bman-buffer-pools = <&bp16>;
 			fsl,qman-frame-queues-rx = <0x5a 1 0x5b 1>;
 			fsl,qman-frame-queues-tx = <0x7a 1 0x7b 1>;
 		};
@@ -117,13 +117,13 @@
 		};
 		ethernet@7 {
 			compatible = "fsl,p4080-dpa-ethernet-init", "fsl,dpa-ethernet-init";
-			fsl,bman-buffer-pools = <&bp7 &bp8 &bp9>;
+			fsl,bman-buffer-pools = <&bp16>;
 			fsl,qman-frame-queues-rx = <0x60 1 0x61 1>;
 			fsl,qman-frame-queues-tx = <0x80 1 0x81 1>;
 		};
 		ethernet@8 {
 			compatible = "fsl,p4080-dpa-ethernet-init", "fsl,dpa-ethernet-init";
-			fsl,bman-buffer-pools = <&bp7 &bp8 &bp9>;
+			fsl,bman-buffer-pools = <&bp16>;
 			fsl,qman-frame-queues-rx = <0x62 1 0x63 1>;
 			fsl,qman-frame-queues-tx = <0x82 1 0x83 1>;
 		};
@@ -133,7 +133,7 @@
 		 * at this interface, the ethernet driver will do kmap_atomic/kunmap_atomic
 		 * for that frame. */
 		ethernet@9 {
-			compatible = "fsl,p4080-dpa-ethernet", "fsl,dpa-ethernet";
+			compatible = "fsl,p4080-dpa-ethernet-shared", "fsl,dpa-ethernet-shared";
 			fsl,bman-buffer-pools = <&bp17>;
 			fsl,qman-frame-queues-rx = <0x66 1 0x67 1 0x2000 3>;
 			fsl,qman-frame-queues-tx = <0 1 0 1 0x3000 8>;
@@ -144,32 +144,45 @@
 		 * On receiving frame at this interface, the ethernet driver will do
 		 * kmap_atomic/kunmap_atomic for that frame. */
 		ethernet@16 {
-			compatible = "fsl,p4080-dpa-ethernet", "fsl,dpa-ethernet";
+			compatible = "fsl,p4080-dpa-ethernet-macless", "fsl,dpa-ethernet-macless";
 			fsl,bman-buffer-pools = <&bp16>;
 			fsl,qman-frame-queues-rx = <4000 8>;
 			fsl,qman-frame-queues-tx = <4008 8>;
 			local-mac-address = [00 11 22 33 44 55];
 		};
 		ethernet@17 {
-			compatible = "fsl,p4080-dpa-ethernet", "fsl,dpa-ethernet";
+			compatible = "fsl,p4080-dpa-ethernet-macless", "fsl,dpa-ethernet-macless";
 			fsl,bman-buffer-pools = <&bp16>;
 			fsl,qman-frame-queues-rx = <5000 8>;
 			fsl,qman-frame-queues-tx = <5008 8>;
 			local-mac-address = [00 11 22 33 44 66];
 		};
+		ethernet@18 {
+                        compatible = "fsl,p4080-dpa-ethernet-macless", "fsl,dpa-ethernet-macless";
+                        fsl,bman-buffer-pools = <&bp16>;
+                        fsl,qman-frame-queues-rx = <6000 8>;
+                        fsl,qman-frame-queues-tx = <6008 8>;
+                        local-mac-address = [00 11 22 33 44 77];
+                };
 		dpa_fman1_oh1: dpa-fman1-oh@1 {
 			compatible = "fsl,dpa-oh";
+			/* Define frame queues for the OH port*/
+			/* <OH Rx error, OH Rx default> */
 			fsl,qman-frame-queues-oh = <0x64 1 0x65 1>;
 			fsl,fman-oh-port = <&fman1_oh1>;
 		};
 		dpa_fman1_oh2: dpa-fman1-oh@2 { /* Define frame queues for the OH port*/
 			compatible = "fsl,dpa-oh"; /* <OH Rx error, OH Rx default> */
+			/* Define frame queues for the OH port*/
+			/* <OH Rx error, OH Rx default> */
 			fsl,qman-frame-queues-oh = <0x68 1 0x69 1>;
 			fsl,bman-buffer-pools = <&bp8>;
 			fsl,fman-oh-port = <&fman1_oh2>;
 		};
 		dpa_fman1_oh3: dpa-fman1-oh@3 {
 			compatible = "fsl,dpa-oh";
+			/* Define frame queues for the OH port*/
+			/* <OH Rx error, OH Rx default> */
 			fsl,qman-frame-queues-oh = <0x70 1 0x71 1>;
 			fsl,bman-buffer-pools = <&bp9>;
 			fsl,fman-oh-port = <&fman1_oh3>;
diff --git a/drivers/staging/fsl_dpa_offload/dts/p4080ds-usdpaa.dts b/drivers/staging/fsl_dpa_offload/dts/p4080ds-usdpaa.dts
index 2e69bbc..5f889e3 100644
--- a/drivers/staging/fsl_dpa_offload/dts/p4080ds-usdpaa.dts
+++ b/drivers/staging/fsl_dpa_offload/dts/p4080ds-usdpaa.dts
@@ -61,7 +61,6 @@
 		fsl,bpool-ethernet-cfg = <0 0 0 1728 0 0xfeedabba>;
 		fsl,bpool-thresholds = <0x100 0x300 0x0 0x0>;
 	};
-
 	bp16: buffer-pool@16 {
 		compatible = "fsl,p4080-bpool", "fsl,bpool";
 		fsl,bpid = <16>;
@@ -136,14 +135,14 @@
 		 * On receiving frame at this interface, the ethernet driver will do
 		 * kmap_atomic/kunmap_atomic for that frame. */
 		ethernet@16 {
-			compatible = "fsl,p4080-dpa-ethernet", "fsl,dpa-ethernet";
+			compatible = "fsl,p4080-dpa-ethernet-macless", "fsl,dpa-ethernet-macless";
 			fsl,bman-buffer-pools = <&bp16>;
 			fsl,qman-frame-queues-rx = <4000 8>;
 			fsl,qman-frame-queues-tx = <4008 8>;
 			local-mac-address = [00 11 22 33 44 55];
 		};
 		ethernet@17 {
-			compatible = "fsl,p4080-dpa-ethernet", "fsl,dpa-ethernet";
+			compatible = "fsl,p4080-dpa-ethernet-macless", "fsl,dpa-ethernet-macless";
 			fsl,bman-buffer-pools = <&bp16>;
 			fsl,qman-frame-queues-rx = <5000 8>;
 			fsl,qman-frame-queues-tx = <5008 8>;
@@ -152,17 +151,23 @@
 
 		dpa_fman1_oh1: dpa-fman1-oh@1 {
 			compatible = "fsl,dpa-oh";
+			/* Define frame queues for the OH port*/
+			/* <OH Rx error, OH Rx default> */
 			fsl,qman-frame-queues-oh = <0x64 1 0x65 1>;
 			fsl,fman-oh-port = <&fman1_oh1>;
 		};
 		dpa_fman1_oh2: dpa-fman1-oh@2 {
 			compatible = "fsl,dpa-oh";
+			/* Define frame queues for the OH port*/
+			/* <OH Rx error, OH Rx default> */
 			fsl,qman-frame-queues-oh = <0x68 1 0x69 1>;
 			fsl,bman-buffer-pools = <&bp9>;
 			fsl,fman-oh-port = <&fman1_oh2>;
 		};
 		dpa_fman1_oh3: dpa-fman1-oh@3 {
 			compatible = "fsl,dpa-oh";
+			/* Define frame queues for the OH port*/
+			/* <OH Rx error, OH Rx default> */
 			fsl,qman-frame-queues-oh = <0x70 1 0x71 1>;
 			fsl,bman-buffer-pools = <&bp9>;
 			fsl,fman-oh-port = <&fman1_oh3>;
diff --git a/drivers/staging/fsl_dpa_offload/dts/p4080si-chosen-offld.dtsi b/drivers/staging/fsl_dpa_offload/dts/p4080si-chosen-offld.dtsi
index 32e5689..1b9f530 100644
--- a/drivers/staging/fsl_dpa_offload/dts/p4080si-chosen-offld.dtsi
+++ b/drivers/staging/fsl_dpa_offload/dts/p4080si-chosen-offld.dtsi
@@ -9,6 +9,7 @@ chosen {
 			fman1_oh2-extd-args {
 				cell-index = <2>;
 				compatible = "fsl,fman-port-op-extended-args";
+				errors-to-discard = <0x00420000>;
 				/* Define buffer layout parameters. Can be used
 				 * in fragmentation or header manip operations
 				 */
-- 
1.9.1

