From 643d745a5aa78386bdcbba28772cc880c9893c89 Mon Sep 17 00:00:00 2001
From: Alex Porosanu <alexandru.porosanu@freescale.com>
Date: Mon, 12 May 2014 18:19:13 +0300
Subject: [PATCH 1293/1336] crypto: caam/qi - FQs must be destroyed after being
 retired

[Original patch taken from QorIQ-SDK-V1.6-SOURCE-20140619-yocto.iso]

Once there is no further need for a QI context, and its
attached FQ, this must be destroyed, so it can be reused
later on.

Change-Id: If7c1c57aede3242a726f3be345216de2176dc393
Signed-off-by: Alex Porosanu <alexandru.porosanu@freescale.com>
Reviewed-on: http://git.am.freescale.net:8181/12227
Tested-by: Review Code-CDREVIEW <CDREVIEW@freescale.com>
Reviewed-by: Vakul Garg <vakul@freescale.com>
Reviewed-by: Mircea Pop <mircea.pop@freescale.com>
Reviewed-by: Horia Ioan Geanta Neag <horia.geanta@freescale.com>
Reviewed-by: Cristian Stoica <cristian.stoica@freescale.com>
Reviewed-by: Jose Rivera <German.Rivera@freescale.com>
---
 drivers/crypto/caam/qi.c | 2 ++
 1 file changed, 2 insertions(+)

diff --git a/drivers/crypto/caam/qi.c b/drivers/crypto/caam/qi.c
index fb37ce9..673f474 100644
--- a/drivers/crypto/caam/qi.c
+++ b/drivers/crypto/caam/qi.c
@@ -380,6 +380,8 @@ empty_fq:
 	if (ret)
 		dev_err(qidev, "OOS of FQID: %u failed\n", fq->fqid);
 
+	qman_destroy_fq(fq, 0);
+
 	return ret;
 }
 
-- 
2.0.2

