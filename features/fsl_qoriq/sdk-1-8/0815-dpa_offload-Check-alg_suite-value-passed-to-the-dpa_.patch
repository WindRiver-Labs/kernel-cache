From 233ebfa688a8013ef39b7e62f58c8cad4f56a640 Mon Sep 17 00:00:00 2001
From: Radu Bulie <radu.bulie@freescale.com>
Date: Wed, 17 Sep 2014 07:15:36 +0000
Subject: [PATCH 815/987] dpa_offload: Check alg_suite value passed to the
 dpa_ipsec driver

This patch adds a fix for alg_suite value that could be tainted
from the ipsec wrapper.

Signed-off-by: Radu Bulie <radu.bulie@freescale.com>
Change-Id: I288f71f11d0a84311dcf966f4c7a693ff754a34b
Reviewed-on: http://git.am.freescale.net:8181/19119
Reviewed-by: Anca Jeanina Floarea <anca.floarea@freescale.com>
Reviewed-by: Marian-Cornel Chereji <marian.chereji@freescale.com>
Tested-by: Marian-Cornel Chereji <marian.chereji@freescale.com>
[Lu:Original patch taken from
QorIQ-SDK-V1.7-SOURCE-20141218-yocto.iso]
Signed-off-by: Jiang Lu <lu.jiang@windriver.com>
---
 drivers/staging/fsl_dpa_offload/dpa_ipsec.c | 7 +++++++
 1 file changed, 7 insertions(+)

diff --git a/drivers/staging/fsl_dpa_offload/dpa_ipsec.c b/drivers/staging/fsl_dpa_offload/dpa_ipsec.c
index f228cef..6570f9f 100644
--- a/drivers/staging/fsl_dpa_offload/dpa_ipsec.c
+++ b/drivers/staging/fsl_dpa_offload/dpa_ipsec.c
@@ -3240,6 +3240,13 @@ static int check_sa_params(struct dpa_ipsec_sa_params *sa_params)
 		return -EINVAL;
 	}
 
+	if (sa_params->crypto_params.alg_suite <
+	     DPA_IPSEC_CIPHER_ALG_3DES_CBC_HMAC_96_MD5_128 ||
+	    sa_params->crypto_params.alg_suite >
+	     DPA_IPSEC_CIPHER_ALG_AES_CTR_HMAC_SHA_512_256) {
+		log_err("Invalid alg_suite value\n");
+		return -EINVAL;
+	}
 	/*
 	 * check crypto params:
 	 * - an authentication key must always be provided
-- 
1.9.1

