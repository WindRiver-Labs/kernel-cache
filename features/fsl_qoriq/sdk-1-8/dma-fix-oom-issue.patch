From 2c0df88f2a8c97ee0295c4c333a977e0e4f881c1 Mon Sep 17 00:00:00 2001
From: Xuelin Shi <xuelin.shi@freescale.com>
Date: Mon, 12 May 2014 10:28:35 +0800
Subject: [PATCH 19/45] dma: fix oom issue.

missing unmap sources and destinations while doing dequeue.

Signed-off-by: Xuelin Shi <xuelin.shi@freescale.com>
Change-Id: Ibf51682e6d2db57f00adb2bacab3d2b6d44690e0
Reviewed-on: http://git.am.freescale.net:8181/12191
Tested-by: Review Code-CDREVIEW <CDREVIEW@freescale.com>
Reviewed-by: Yang Li <LeoLi@freescale.com>
Reviewed-by: Jose Rivera <German.Rivera@freescale.com>
[Original patch taken from QorIQ-SDK-V1.8-20150619-yocto]
Signed-off-by: Kevin Hao <kexin.hao@windriver.com>
---
 drivers/dma/fsldma.c |    2 ++
 1 files changed, 2 insertions(+), 0 deletions(-)

diff --git a/drivers/dma/fsldma.c b/drivers/dma/fsldma.c
index 300f821..8a27d7b 100644
--- a/drivers/dma/fsldma.c
+++ b/drivers/dma/fsldma.c
@@ -524,6 +524,8 @@ static dma_cookie_t fsldma_run_tx_complete_actions(struct fsldma_chan *chan,
 		}
 	}
 
+	dma_descriptor_unmap(txd);
+
 	/* Run any dependencies */
 	dma_run_dependencies(txd);
 
-- 
1.7.5.4

