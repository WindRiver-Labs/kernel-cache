From 43d85b4709da396bcb48e0e1399e0b404a15bfeb Mon Sep 17 00:00:00 2001
From: Anca Jeanina FLOAREA <anca.floarea@freescale.com>
Date: Wed, 2 Oct 2013 14:22:13 +0300
Subject: [PATCH 376/987] dpa_offload: Fix de-allocation of uninitialized value

[Original patch taken from QorIQ-SDK-V1.6-SOURCE-20140619-yocto.iso]

The tbl pointer is dereference without it being previously
initialized. The code should use variable cnode instead of
tbl in case DPA Stats counters of type DPA_STATS_CNT_CLASSIF_NODE
is being created.

Signed-off-by: Anca Jeanina FLOAREA <anca.floarea@freescale.com>
Change-Id: I10f8cd233f850c339e82d44522f2005dfb9ab27f
Reviewed-on: http://git.am.freescale.net:8181/5149
Tested-by: Review Code-CDREVIEW <CDREVIEW@freescale.com>
Reviewed-by: Marian-Cornel Chereji <marian.chereji@freescale.com>
Reviewed-by: Rivera Jose-B46482 <German.Rivera@freescale.com>
---
 drivers/staging/fsl_dpa_offload/wrp_dpa_stats.c | 2 +-
 1 file changed, 1 insertion(+), 1 deletion(-)

diff --git a/drivers/staging/fsl_dpa_offload/wrp_dpa_stats.c b/drivers/staging/fsl_dpa_offload/wrp_dpa_stats.c
index 6784cf5..f141aa8 100644
--- a/drivers/staging/fsl_dpa_offload/wrp_dpa_stats.c
+++ b/drivers/staging/fsl_dpa_offload/wrp_dpa_stats.c
@@ -1047,7 +1047,7 @@ create_cls_counter_cleanup:
 			kfree(cnode->keys[i]);
 		}
 		/* Restore user-space pointers */
-		tbl->keys = us_keys;
+		cnode->keys = us_keys;
 		break;
 	case DPA_STATS_CNT_IPSEC:
 		kfree(sa_ids);
-- 
1.9.1

