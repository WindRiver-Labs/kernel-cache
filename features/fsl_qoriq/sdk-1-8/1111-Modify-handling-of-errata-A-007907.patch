From 0865838dd65b449e922e3e69668bf231dcb912f1 Mon Sep 17 00:00:00 2001
From: Varun Sethi <Varun.Sethi@freescale.com>
Date: Mon, 8 Dec 2014 11:34:45 +0530
Subject: [PATCH 1111/1114] Modify handling of errata A-007907

Errata A-007907 corresponds to the e6500 core i.e. all e6500 based
SOCs have this errata. Rather than enabling the errata workaround
based on the SOC version, it can be enabled based on the e6500 core
version.

Signed-off-by: Varun Sethi <Varun.Sethi@freescale.com>
Change-Id: I13bc541dc0da75a791bba933bbdc47456ef808f8
Reviewed-on: http://git.am.freescale.net:8181/25446
Tested-by: Review Code-CDREVIEW <CDREVIEW@freescale.com>
Reviewed-by: Vakul Garg <vakul@freescale.com>
Reviewed-by: Matthew Weigel <Matthew.Weigel@freescale.com>
[Lu:Original patch taken from
QorIQ-SDK-V1.7-SOURCE-20141218-yocto.iso]
Signed-off-by: Jiang Lu <lu.jiang@windriver.com>
---
 drivers/iommu/fsl_pamu.c | 20 +++++---------------
 1 file changed, 5 insertions(+), 15 deletions(-)

diff --git a/drivers/iommu/fsl_pamu.c b/drivers/iommu/fsl_pamu.c
index d7461fd..31e71df 100644
--- a/drivers/iommu/fsl_pamu.c
+++ b/drivers/iommu/fsl_pamu.c
@@ -26,6 +26,7 @@
 #include <asm/mpc85xx.h>
 #include <asm/fsl_guts.h>
 #include <asm/fsl_kibo.h>
+#include <asm/reg.h>
 #include <linux/syscore_ops.h>
 
 
@@ -656,23 +657,12 @@ static u32 get_dsp_l2_stash_id(u32 vcpu)
 
 static bool has_erratum_a007907(void)
 {
-	u32 svr = mfspr(SPRN_SVR);
+	u32 pvr = mfspr(SPRN_PVR);
 
-	switch (SVR_SOC_VER(svr)) {
-	case SVR_B4860:
-	case SVR_B4420:
-	case SVR_T4240:
-	case SVR_T4160:
-	case SVR_T4080:
-		return SVR_REV(svr) <= 0x20;
+	if (PVR_VER(pvr) == PVR_VER_E6500 && PVR_REV(pvr) <= 0x20)
+		return true;
 
-	case SVR_T2080:
-	case SVR_T2081:
-		return SVR_REV(svr) == 0x10;
-
-	default:
-		return false;
-	};
+	return false;
 }
 
 /**
-- 
2.0.2

