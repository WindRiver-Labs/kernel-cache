From 70be7529df0221cec83f384cc8c9d625a703f1c1 Mon Sep 17 00:00:00 2001
From: Sunil Kumar Kori <Sunil.Kori@freescale.com>
Date: Thu, 11 Apr 2013 11:45:14 +0530
Subject: [PATCH 095/987] Patch contains hook to offload FD to ASF instead of
 skb.

[Original patch taken from QorIQ-SDK-V1.6-SOURCE-20140619-yocto.iso]

Earlier in DPA, hook was given to offload skb to asf. This patch
provides a hook to offload a FD to ASF instead of skb.

Change-Id: I855dd48c127479ae60d3371d1956ba533d8e4407
Signed-off-by: Sunil Kumar Kori <Sunil.Kori@freescale.com>
CR:ENGR00243312
Reviewed-on: http://git.am.freescale.net:8181/1294
Reviewed-by: Hamciuc Bogdan-BHAMCIU1 <bogdan.hamciuc@freescale.com>
Reviewed-by: Fleming Andrew-AFLEMING <AFLEMING@freescale.com>
Tested-by: Fleming Andrew-AFLEMING <AFLEMING@freescale.com>
---
 drivers/net/ethernet/freescale/dpa/dpaa_eth.c | 10 +++++-----
 1 file changed, 5 insertions(+), 5 deletions(-)

diff --git a/drivers/net/ethernet/freescale/dpa/dpaa_eth.c b/drivers/net/ethernet/freescale/dpa/dpaa_eth.c
index 334cafa..5f6bb55 100644
--- a/drivers/net/ethernet/freescale/dpa/dpaa_eth.c
+++ b/drivers/net/ethernet/freescale/dpa/dpaa_eth.c
@@ -1317,6 +1317,11 @@ void __hot _dpa_rx(struct net_device *net_dev,
 	dpa_bp = dpa_bpid2pool(fd->bpid);
 
 	dma_unmap_single(dpa_bp->dev, addr, dpa_bp->size, DMA_BIDIRECTIONAL);
+	/* Execute the Rx processing hook, if it exists. */
+	if (dpaa_eth_hooks.rx_default && dpaa_eth_hooks.rx_default((void *)fd,
+		net_dev, fqid) == DPAA_ETH_STOLEN)
+		/* won't count the rx bytes in */
+		goto skb_stolen;
 
 	skb = *skbh;
 	prefetch(skb);
@@ -1338,11 +1343,6 @@ void __hot _dpa_rx(struct net_device *net_dev,
 		goto drop_large_frame;
 	}
 
-	/* Execute the Rx processing hook, if it exists. */
-	if (dpaa_eth_hooks.rx_default && dpaa_eth_hooks.rx_default(skb,
-		net_dev, fqid) == DPAA_ETH_STOLEN)
-		/* won't count the rx bytes in */
-		goto skb_stolen;
 
 	skb_len = skb->len;
 
-- 
1.9.1

