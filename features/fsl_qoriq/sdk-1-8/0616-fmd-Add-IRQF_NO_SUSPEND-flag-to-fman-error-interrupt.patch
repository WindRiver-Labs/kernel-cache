From f003a158a694b9d17fbcb97ebf1037db2feb8ce5 Mon Sep 17 00:00:00 2001
From: Cristian Sovaiala <cristian.sovaiala@freescale.com>
Date: Tue, 18 Mar 2014 18:21:33 +0200
Subject: [PATCH 616/987] fmd: Add IRQF_NO_SUSPEND flag to fman error interrupt

[Original patch taken from QorIQ-SDK-V1.6-SOURCE-20140619-yocto.iso]

Magic Packets are processed in Fman error interrupt therefore
in order for the error interrupt to be handled while the system
is in sleep mode, we set the IRQF_NO_SUSPEND flag when the
interrupt is being registered.

Signed-off-by: Cristian Sovaiala <cristian.sovaiala@freescale.com>
Change-Id: Iff2fec80452a1af42ffc9a639bed555d896a57af
Reviewed-on: http://git.am.freescale.net:8181/9903
Reviewed-by: Madalin-Cristian Bucur <madalin.bucur@freescale.com>
Reviewed-by: Mandy Lavi <Mandy.Lavi@freescale.com>
Reviewed-by: Jose Rivera <German.Rivera@freescale.com>
Tested-by: Jose Rivera <German.Rivera@freescale.com>
(cherry picked from commit 3cc4c999ce457e5a99ae0cac7626106b9a551511)
Reviewed-on: http://git.am.freescale.net:8181/10399
Tested-by: Madalin-Cristian Bucur <madalin.bucur@freescale.com>
---
 drivers/net/ethernet/freescale/fman/src/wrapper/lnxwrp_fm.c | 2 +-
 1 file changed, 1 insertion(+), 1 deletion(-)

diff --git a/drivers/net/ethernet/freescale/fman/src/wrapper/lnxwrp_fm.c b/drivers/net/ethernet/freescale/fman/src/wrapper/lnxwrp_fm.c
index 4581645..d30f2ed 100755
--- a/drivers/net/ethernet/freescale/fman/src/wrapper/lnxwrp_fm.c
+++ b/drivers/net/ethernet/freescale/fman/src/wrapper/lnxwrp_fm.c
@@ -792,7 +792,7 @@ static t_Error ConfigureFmDev(t_LnxWrpFmDev  *p_LnxWrpFmDev)
         if (unlikely(_errno < 0))
             RETURN_ERROR(MAJOR, E_INVALID_STATE, ("can_request_irq() = %d", _errno));
 #endif
-        _errno = devm_request_irq(p_LnxWrpFmDev->dev, p_LnxWrpFmDev->err_irq, fm_err_irq, IRQF_SHARED, "fman-err", p_LnxWrpFmDev);
+        _errno = devm_request_irq(p_LnxWrpFmDev->dev, p_LnxWrpFmDev->err_irq, fm_err_irq, IRQF_SHARED | IRQF_NO_SUSPEND, "fman-err", p_LnxWrpFmDev);
         if (unlikely(_errno < 0))
             RETURN_ERROR(MAJOR, E_INVALID_STATE, ("request_irq(%d) = %d", p_LnxWrpFmDev->err_irq, _errno));
     }
-- 
1.9.1

