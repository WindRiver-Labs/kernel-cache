From 45901a6528a7b42a1365e63715d16b0a960060ea Mon Sep 17 00:00:00 2001
From: Eyal Harari <Eyal.Harari@freesacle.com>
Date: Tue, 26 Aug 2014 12:40:19 +0300
Subject: [PATCH 762/987] FMD: DS: configure SCFG_FMCLKDPSLPCR for all DS
 cases, not only AR

Signed-off-by: Eyal Harari <Eyal.Harari@freesacle.com>
[Lu:Original patch taken from
QorIQ-SDK-V1.7-SOURCE-20141218-yocto.iso]
Signed-off-by: Jiang Lu <lu.jiang@windriver.com>
---
 drivers/net/ethernet/freescale/fman/src/wrapper/lnxwrp_fm.c | 12 ++++++------
 1 file changed, 6 insertions(+), 6 deletions(-)

diff --git a/drivers/net/ethernet/freescale/fman/src/wrapper/lnxwrp_fm.c b/drivers/net/ethernet/freescale/fman/src/wrapper/lnxwrp_fm.c
index 39b4ee7..d594104 100644
--- a/drivers/net/ethernet/freescale/fman/src/wrapper/lnxwrp_fm.c
+++ b/drivers/net/ethernet/freescale/fman/src/wrapper/lnxwrp_fm.c
@@ -1141,18 +1141,18 @@ struct device *g_fm_dev;
 static int fm_soc_suspend(struct device *dev)
 {
 	int err = 0;
+	uint32_t *fmclk;
 	t_LnxWrpFmDev *p_LnxWrpFmDev = dev_get_drvdata(get_device(dev));
 	g_fm_dev = dev;
+	fmclk = ioremap(SCFG_FMCLKDPSLPCR_ADDR, 4);
+	WRITE_UINT32(*fmclk, SCFG_FMCLKDPSLPCR_DS_VAL);
 	if (p_LnxWrpFmDev->h_DsarRxPort)
 	{
-		uint32_t *fmclk;
 #ifdef CONFIG_FSL_QORIQ_PM
 		fsl_set_power_except(dev,1);
 #endif
 		err = FM_PORT_EnterDsarFinal(p_LnxWrpFmDev->h_DsarRxPort,
 			p_LnxWrpFmDev->h_DsarTxPort);
-		fmclk = ioremap(SCFG_FMCLKDPSLPCR_ADDR, 4);
-		WRITE_UINT32(*fmclk, SCFG_FMCLKDPSLPCR_DS_VAL);
 	}
 	return err;
 }
@@ -1160,11 +1160,11 @@ static int fm_soc_suspend(struct device *dev)
 static int fm_soc_resume(struct device *dev)
 {
 	t_LnxWrpFmDev *p_LnxWrpFmDev = dev_get_drvdata(get_device(dev));
+	uint32_t *fmclk;
+	fmclk = ioremap(SCFG_FMCLKDPSLPCR_ADDR, 4);
+	WRITE_UINT32(*fmclk, SCFG_FMCLKDPSLPCR_NORMAL_VAL);
 	if (p_LnxWrpFmDev->h_DsarRxPort)
 	{
-		uint32_t *fmclk;
-		fmclk = ioremap(SCFG_FMCLKDPSLPCR_ADDR, 4);
-		WRITE_UINT32(*fmclk, SCFG_FMCLKDPSLPCR_NORMAL_VAL);
 		p_LnxWrpFmDev->h_DsarRxPort = 0;
 		p_LnxWrpFmDev->h_DsarTxPort = 0;
 	}
-- 
1.9.1

