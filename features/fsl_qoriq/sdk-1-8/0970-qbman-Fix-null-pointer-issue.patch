From a0e90628f7a73cb2d14d8fcfb1f6b19e18d2f1a4 Mon Sep 17 00:00:00 2001
From: Mahammad Ismayilzada <mahammad.ismayilzada@freescale.com>
Date: Wed, 20 May 2015 14:34:22 -0400
Subject: [PATCH 970/987] qbman: Fix null pointer issue

bufs passed as NULL and dereferenced. Replaced with local variable.

Signed-off-by: Mahammad Ismayilzada <mahammad.ismayilzada@freescale.com>
Change-Id: I39aecee95b086567a21487ee2b751126aa0777f1
Reviewed-on: http://git.am.freescale.net:8181/36648
Tested-by: Review Code-CDREVIEW <CDREVIEW@freescale.com>
Reviewed-by: Haiying Wang <Haiying.Wang@freescale.com>
Reviewed-by: Roy Pledge <roy.pledge@freescale.com>
Reviewed-by: Honghua Yin <Hong-Hua.Yin@freescale.com>
[Yang: Original patch taken from
QorIQ-SDK-V1.8-SOURCE-20150619-yocto.iso]
Signed-off-by: Quanyang Wang <quanyang.wang@windriver.com>
---
 drivers/staging/fsl_qbman/bman_test_high.c | 4 +++-
 1 file changed, 3 insertions(+), 1 deletion(-)

diff --git a/drivers/staging/fsl_qbman/bman_test_high.c b/drivers/staging/fsl_qbman/bman_test_high.c
index 7bdd181..4676fb0 100644
--- a/drivers/staging/fsl_qbman/bman_test_high.c
+++ b/drivers/staging/fsl_qbman/bman_test_high.c
@@ -165,7 +165,9 @@ do_loop:
 		BUG_ON(tmp != num);
 		i -= num;
 	}
-	i = bman_acquire(pool, NULL, 1, 0);
+
+	struct bm_buffer tmp_buf;
+	i = bman_acquire(pool, &tmp_buf, 1, 0);
 	BUG_ON(i > 0);
 
 	bufs_confirm();
-- 
1.9.1

