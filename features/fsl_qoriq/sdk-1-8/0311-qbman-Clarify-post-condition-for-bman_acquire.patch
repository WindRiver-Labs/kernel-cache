From ec066cb4755f5a6c04fec2b9e933ee04291649d4 Mon Sep 17 00:00:00 2001
From: Bogdan Hamciuc <bogdan.hamciuc@freescale.com>
Date: Wed, 31 Jul 2013 13:04:04 +0300
Subject: [PATCH 311/987] qbman: Clarify post-condition for bman_acquire()

[Original patch taken from QorIQ-SDK-V1.6-SOURCE-20140619-yocto.iso]

If bman_acquire() cannot provide the requested number of buffers, it
doesn't touch the bpool, even if that may still contain some, fewer,
buffers. -ENOMEM is returned, but the @bufs array is overwritten
nevertheless.

Make it clear that the caller should not rely on @bufs if this was the
case.

Signed-off-by: Bogdan Hamciuc <bogdan.hamciuc@freescale.com>
Change-Id: I5b4336fb98bbaa67924600ba5bad9c9e2d665509
Reviewed-on: http://git.am.freescale.net:8181/3646
Reviewed-by: Fleming Andrew-AFLEMING <AFLEMING@freescale.com>
Tested-by: Fleming Andrew-AFLEMING <AFLEMING@freescale.com>
---
 include/linux/fsl_bman.h | 3 ++-
 1 file changed, 2 insertions(+), 1 deletion(-)

diff --git a/include/linux/fsl_bman.h b/include/linux/fsl_bman.h
index 4bf2366..04797e71 100644
--- a/include/linux/fsl_bman.h
+++ b/include/linux/fsl_bman.h
@@ -474,7 +474,8 @@ int bman_release(struct bman_pool *pool, const struct bm_buffer *bufs, u8 num,
  *
  * Issues an "Acquire" command via the portal's management command interface.
  * The return value will be the number of buffers obtained from the pool, or a
- * negative error code if a h/w error or pool starvation was encountered.
+ * negative error code if a h/w error or pool starvation was encountered. In
+ * the latter case, the content of @bufs is undefined.
  */
 int bman_acquire(struct bman_pool *pool, struct bm_buffer *bufs, u8 num,
 			u32 flags);
-- 
1.9.1

