From b0bea2b1ccfa8d3ba275310624c46f0363bb30cc Mon Sep 17 00:00:00 2001
From: Yangbo Lu <yangbo.lu@freescale.com>
Date: Wed, 18 Mar 2015 17:35:45 +0800
Subject: [PATCH 914/987] dpaa_eth: fix compile error when selecting 1588
 config

Signed-off-by: Yangbo Lu <yangbo.lu@freescale.com>
Change-Id: I56995d4297e8b1001dc8089ae650604dea311428
Reviewed-on: http://git.am.freescale.net:8181/32977
Tested-by: Review Code-CDREVIEW <CDREVIEW@freescale.com>
Reviewed-by: Honghua Yin <Hong-Hua.Yin@freescale.com>
[Yang: Original patch taken from
QorIQ-SDK-V1.8-SOURCE-20150619-yocto.iso]
Signed-off-by: Quanyang Wang <quanyang.wang@windriver.com>
---
 drivers/net/ethernet/freescale/dpa/dpaa_eth_common.c | 11 ++++++++---
 1 file changed, 8 insertions(+), 3 deletions(-)

diff --git a/drivers/net/ethernet/freescale/dpa/dpaa_eth_common.c b/drivers/net/ethernet/freescale/dpa/dpaa_eth_common.c
index 63b2827..8aecb20 100644
--- a/drivers/net/ethernet/freescale/dpa/dpaa_eth_common.c
+++ b/drivers/net/ethernet/freescale/dpa/dpaa_eth_common.c
@@ -556,10 +556,15 @@ dpa_mac_probe(struct platform_device *_of_dev)
 	struct mac_device	*mac_dev;
 #ifdef CONFIG_FSL_DPAA_1588
 	int			 lenp;
+	const phandle		*phandle_prop;
 	struct net_device	*net_dev = NULL;
 	struct dpa_priv_s	*priv = NULL;
 	struct device_node	*timer_node;
 #endif
+#ifdef CONFIG_PTP_1588_CLOCK_DPAA
+	int			lenp_ptp;
+	const phandle		*phandle_ptp;
+#endif
 
 	dpa_dev = &_of_dev->dev;
 
@@ -605,11 +610,11 @@ dpa_mac_probe(struct platform_device *_of_dev)
 #endif
 
 #ifdef CONFIG_PTP_1588_CLOCK_DPAA
-	phandle_prop = of_get_property(mac_node, "ptimer-handle", &lenp);
-	if (phandle_prop && ((mac_dev->phy_if != PHY_INTERFACE_MODE_SGMII) ||
+	phandle_ptp = of_get_property(mac_node, "ptimer-handle", &lenp_ptp);
+	if (phandle_ptp && ((mac_dev->phy_if != PHY_INTERFACE_MODE_SGMII) ||
 			((mac_dev->phy_if == PHY_INTERFACE_MODE_SGMII) &&
 			 (mac_dev->speed == SPEED_1000)))) {
-		ptp_priv.node = of_find_node_by_phandle(*phandle_prop);
+		ptp_priv.node = of_find_node_by_phandle(*phandle_ptp);
 		if (ptp_priv.node) {
 			ptp_priv.of_dev = of_find_device_by_node(ptp_priv.node);
 			if (unlikely(ptp_priv.of_dev == NULL)) {
-- 
1.9.1

