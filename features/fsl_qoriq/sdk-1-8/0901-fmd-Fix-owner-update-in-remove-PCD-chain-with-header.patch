From 1ab1d1ebbbf4629c26ea3e89e6b32e46c9c57415 Mon Sep 17 00:00:00 2001
From: Marian Chereji <marian.chereji@freescale.com>
Date: Tue, 10 Feb 2015 11:53:45 +0200
Subject: [PATCH 901/987] fmd: Fix "owner" update in remove PCD chain with
 header manipulation

When user askes to update a particular CC Node which points to another CC node
that contains entries with header manipulation the owner of the header
manipulation node is increased. This patch decreases back the owner explicitly,
as owner shouldn't be changed in this situation.

Signed-off-by: Ella Segal <ella.segal@freescale.com>
Reviewed-by: Marian Chereji <marian.chereji@freescale.com>
Change-Id: Ibf963791198d47ade1d376ec1bf8902f510b9900
Reviewed-on: http://git.am.freescale.net:8181/30463
Reviewed-by: Marian-Cornel Chereji <marian.chereji@freescale.com>
Tested-by: Review Code-CDREVIEW <CDREVIEW@freescale.com>
Reviewed-by: Honghua Yin <Hong-Hua.Yin@freescale.com>
[Yang: Original patch taken from
QorIQ-SDK-V1.8-SOURCE-20150619-yocto.iso]
Signed-off-by: Quanyang Wang <quanyang.wang@windriver.com>
---
 drivers/net/ethernet/freescale/fman/Peripherals/FM/Pcd/fm_cc.c | 3 +++
 1 file changed, 3 insertions(+)

diff --git a/drivers/net/ethernet/freescale/fman/Peripherals/FM/Pcd/fm_cc.c b/drivers/net/ethernet/freescale/fman/Peripherals/FM/Pcd/fm_cc.c
index fc42642..863b61d 100644
--- a/drivers/net/ethernet/freescale/fman/Peripherals/FM/Pcd/fm_cc.c
+++ b/drivers/net/ethernet/freescale/fman/Peripherals/FM/Pcd/fm_cc.c
@@ -3572,6 +3572,9 @@ static t_Error UpdatePtrWhichPointOnCrntMdfNode(
 
         ccNodeInfo.h_CcNode = h_NewAd;
         EnqueueNodeInfoToRelevantLst(h_NewLst, &ccNodeInfo, NULL);
+
+        if (p_NextEngineParams->h_Manip)
+            FmPcdManipUpdateOwner(p_NextEngineParams->h_Manip, FALSE);
     }
     return E_OK;
 }
-- 
1.9.1

