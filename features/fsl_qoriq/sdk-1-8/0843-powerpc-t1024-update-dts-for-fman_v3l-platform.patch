From 0f6b88339dfaf5435e750beca77c40604e12ab4c Mon Sep 17 00:00:00 2001
From: Shengzhou Liu <Shengzhou.Liu@freescale.com>
Date: Wed, 5 Nov 2014 15:37:15 +0800
Subject: [PATCH 843/987] powerpc/t1024: update dts for fman_v3l platform

- add CONFIG_FMAN_V3L by default for FMan_V3L platform.
- t1024 officially supports 6 portals of QMan/BMan instead of 10
- remove CONFIG_ALTIVEC as e5500 core has no ALTIVEC.

Signed-off-by: Shengzhou Liu <Shengzhou.Liu@freescale.com>
Change-Id: I71a5426ad441ef034c66e2d794a86b366092530d
Reviewed-on: http://git.am.freescale.net:8181/23188
Tested-by: Review Code-CDREVIEW <CDREVIEW@freescale.com>
Reviewed-by: Mandy Lavi <Mandy.Lavi@freescale.com>
Reviewed-by: Richard Schmitt <richard.schmitt@freescale.com>
[Lu:Original patch taken from
QorIQ-SDK-V1.7-SOURCE-20141218-yocto.iso]
Signed-off-by: Jiang Lu <lu.jiang@windriver.com>
---
 arch/powerpc/boot/dts/fsl/t1023si-post.dtsi        | 66 +---------------------
 drivers/net/ethernet/freescale/fman/Kconfig        |  4 +-
 .../inc/integrations/T4240/dpaa_integration_ext.h  |  2 +-
 3 files changed, 4 insertions(+), 68 deletions(-)

diff --git a/arch/powerpc/boot/dts/fsl/t1023si-post.dtsi b/arch/powerpc/boot/dts/fsl/t1023si-post.dtsi
index 37e20a7..0bd63c4 100644
--- a/arch/powerpc/boot/dts/fsl/t1023si-post.dtsi
+++ b/arch/powerpc/boot/dts/fsl/t1023si-post.dtsi
@@ -222,30 +222,6 @@
 		reg = <0x14000 0x4000 0x1005000 0x1000>;
 		interrupts = <115 2 0 0>;
 	};
-	bman-portal@18000 {
-		cell-index = <0x6>;
-		compatible = "fsl,bman-portal";
-		reg = <0x18000 0x4000 0x1006000 0x1000>;
-		interrupts = <117 2 0 0>;
-	};
-	bman-portal@1c000 {
-		cell-index = <0x7>;
-		compatible = "fsl,bman-portal";
-		reg = <0x1c000 0x4000 0x1007000 0x1000>;
-		interrupts = <119 2 0 0>;
-	};
-	bman-portal@20000 {
-		cell-index = <0x8>;
-		compatible = "fsl,bman-portal";
-		reg = <0x20000 0x4000 0x1008000 0x1000>;
-		interrupts = <121 2 0 0>;
-	};
-	bman-portal@24000 {
-		cell-index = <0x9>;
-		compatible = "fsl,bman-portal";
-		reg = <0x24000 0x4000 0x1009000 0x1000>;
-		interrupts = <123 2 0 0>;
-	};
 };
 
 &qportals {
@@ -300,38 +276,6 @@
 		fsl,qman-channel-id = <0x5>;
 	};
 
-	qportal6: qman-portal@18000 {
-		cell-index = <0x6>;
-		compatible = "fsl,qman-portal";
-		reg = <0x18000 0x4000 0x1006000 0x1000>;
-		interrupts = <116 0x2 0 0>;
-		fsl,qman-channel-id = <0x6>;
-	};
-
-	qportal7: qman-portal@1c000 {
-		cell-index = <0x7>;
-		compatible = "fsl,qman-portal";
-		reg = <0x1c000 0x4000 0x1007000 0x1000>;
-		interrupts = <118 0x2 0 0>;
-		fsl,qman-channel-id = <0x7>;
-	};
-
-	qportal8: qman-portal@20000 {
-		cell-index = <0x8>;
-		compatible = "fsl,qman-portal";
-		reg = <0x20000 0x4000 0x1008000 0x1000>;
-		interrupts = <120 0x2 0 0>;
-		fsl,qman-channel-id = <0x8>;
-	};
-
-	qportal9: qman-portal@24000 {
-		cell-index = <0x9>;
-		compatible = "fsl,qman-portal";
-		reg = <0x24000 0x4000 0x1009000 0x1000>;
-		interrupts = <122 0x2 0 0>;
-		fsl,qman-channel-id = <0x9>;
-	};
-
 	qman-ceetm@0 {
 		compatible = "fsl,qman-ceetm";
 		fsl,ceetm-lfqid-range = <0xf00000 0x1000>;
@@ -512,7 +456,7 @@ sata@220000 {
 /include/ "qoriq-sec5.0-0.dtsi"
 /include/ "qoriq-qman1.dtsi"
 /include/ "qoriq-bman1.dtsi"
-/include/ "qoriq-fman3-0.dtsi"
+/include/ "qoriq-fman3l-0.dtsi"
 /include/ "qoriq-fman3-0-1g-0.dtsi"
 /include/ "qoriq-fman3-0-1g-1.dtsi"
 /include/ "qoriq-fman3-0-1g-2.dtsi"
@@ -551,13 +495,5 @@ sata@220000 {
 		port@85000 {
 			fsl,qman-channel-id = <0x80c>;
 		};
-		/* offline - 5 */
-		port@86000 {
-			fsl,qman-channel-id = <0x80d>;
-		};
-		/* offline - 6 */
-		port@87000 {
-			fsl,qman-channel-id = <0x80e>;
-		};
 	};
 };
diff --git a/drivers/net/ethernet/freescale/fman/Kconfig b/drivers/net/ethernet/freescale/fman/Kconfig
index bd50e3d..735b865 100644
--- a/drivers/net/ethernet/freescale/fman/Kconfig
+++ b/drivers/net/ethernet/freescale/fman/Kconfig
@@ -38,11 +38,11 @@ config FMAN_V3L
 	default n
 	---help---
 	  There are two FMAN V3 version: FMAN_V3H and FMAN_V3L.
-	  T1040, T1042, T1020, T1022 belong to FMAN_V3L, there
+	  T1040, T1042, T1020, T1022, T1023, T1024 belong to FMAN_V3L, there
 	  are 4 Offline/Host Command Ports (O/H n) in FMAN_V3L.
 	  But there are 6 Offline/Host Command Ports (O/H n) in
 	  FMAN_V3H.
-	  Say "Y" if chips are T1040, T1042, T1020, T1022 family.
+	  Say "Y" if chips are T1040, T1042, T1020, T1022, T1023, T1024 family.
 
 config FMAN_MIB_CNT_OVF_IRQ_EN
 	bool "Enable the dTSEC MIB counters overflow interrupt"
diff --git a/drivers/net/ethernet/freescale/fman/inc/integrations/T4240/dpaa_integration_ext.h b/drivers/net/ethernet/freescale/fman/inc/integrations/T4240/dpaa_integration_ext.h
index 97a333e..cffeef9 100644
--- a/drivers/net/ethernet/freescale/fman/inc/integrations/T4240/dpaa_integration_ext.h
+++ b/drivers/net/ethernet/freescale/fman/inc/integrations/T4240/dpaa_integration_ext.h
@@ -194,7 +194,7 @@ typedef enum
 
 /* Ports defines */
 #define FM_MAX_NUM_OF_1G_MACS	5
-#define FM_MAX_NUM_OF_10G_MACS	0
+#define FM_MAX_NUM_OF_10G_MACS	1
 #define FM_MAX_NUM_OF_MACS	(FM_MAX_NUM_OF_1G_MACS + FM_MAX_NUM_OF_10G_MACS)
 #define FM_MAX_NUM_OF_OH_PORTS	4
 #else
-- 
1.9.1

