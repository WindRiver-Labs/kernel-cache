From b8ce18e44e79b0ee453189b1bb9c67dde8944a66 Mon Sep 17 00:00:00 2001
From: Cristian Bercaru <cristian.bercaru@freescale.com>
Date: Thu, 3 Apr 2014 18:27:07 +0300
Subject: [PATCH 638/987] FMD: enable multiple priorities per PFC frame

[Original patch taken from QorIQ-SDK-V1.6-SOURCE-20140619-yocto.iso]

The BMan Pool Depletion Register (FMBM_RMPD) has 8 bits for
- NBPDE - Buffer Pools Depleted Enable
- QbbPEV - 802.1Qbb Priority Enable Vector
- SBPD - Single Buffer Pool Depletion
This patch takes into account all the 8 bits for each of these fields.

Signed-off-by: Cristian Bercaru <cristian.bercaru@freescale.com>
Change-Id: Ie373c6b12501b7005233095ca480fb1bdad57416
Reviewed-on: http://git.am.freescale.net:8181/10606
Reviewed-by: Ehud Shiff <Ehud.Shiff@freescale.com>
Reviewed-by: Jose Rivera <German.Rivera@freescale.com>
Tested-by: Jose Rivera <German.Rivera@freescale.com>
---
 drivers/net/ethernet/freescale/fman/Peripherals/FM/Port/fman_port.c | 2 +-
 1 file changed, 1 insertion(+), 1 deletion(-)

diff --git a/drivers/net/ethernet/freescale/fman/Peripherals/FM/Port/fman_port.c b/drivers/net/ethernet/freescale/fman/Peripherals/FM/Port/fman_port.c
index c748a16..ec261c4 100755
--- a/drivers/net/ethernet/freescale/fman/Peripherals/FM/Port/fman_port.c
+++ b/drivers/net/ethernet/freescale/fman/Peripherals/FM/Port/fman_port.c
@@ -951,7 +951,7 @@ int fman_port_set_bpools(const struct fman_port *port,
 
     /* Pools depletion */
     tmp = 0;
-    for (i = 0; i < bp->count; i++) {
+    for (i = 0; i < FMAN_PORT_MAX_EXT_POOLS_NUM; i++) {
         if (bp->bpool[i].grp_bp_depleted) {
             grp_depl_used = TRUE;
             tmp |= 0x80000000 >> i;
-- 
1.9.1

