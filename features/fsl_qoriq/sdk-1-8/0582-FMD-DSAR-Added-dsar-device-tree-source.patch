From 6c918155240d9ab7f7f3ee80e4a389487a623aac Mon Sep 17 00:00:00 2001
From: Eyal Harari <Eyal.Harari@freescale.com>
Date: Sun, 2 Mar 2014 17:52:10 +0200
Subject: [PATCH 582/987] FMD: DSAR: Added dsar device tree source

[Original patch taken from QorIQ-SDK-V1.6-SOURCE-20140619-yocto.iso]

Change-Id: I1da08cec47972011c871796ab0d1b7a8fbe3024e
Signed-off-by: Eyal Harari <Eyal.Harari@freescale.com>
Reviewed-on: http://git.am.freescale.net:8181/9306
Tested-by: Review Code-CDREVIEW <CDREVIEW@freescale.com>
Reviewed-by: Mandy Lavi <Mandy.Lavi@freescale.com>
Reviewed-by: Sunil Kumar Kori <Sunil.Kori@freescale.com>
Reviewed-by: Jose Rivera <German.Rivera@freescale.com>
Reviewed-on: http://git.am.freescale.net:8181/9447
Tested-by: Jose Rivera <German.Rivera@freescale.com>
---
 .../powerpc/fsl/fman_chosen_node_device_tree.txt   | 34 ++++++++-
 arch/powerpc/boot/dts/t1040qds-dsar.dts            | 80 ++++++++++++++++++++++
 2 files changed, 111 insertions(+), 3 deletions(-)
 create mode 100755 arch/powerpc/boot/dts/t1040qds-dsar.dts

diff --git a/Documentation/devicetree/bindings/powerpc/fsl/fman_chosen_node_device_tree.txt b/Documentation/devicetree/bindings/powerpc/fsl/fman_chosen_node_device_tree.txt
index abdd9ad..7d160fb 100644
--- a/Documentation/devicetree/bindings/powerpc/fsl/fman_chosen_node_device_tree.txt
+++ b/Documentation/devicetree/bindings/powerpc/fsl/fman_chosen_node_device_tree.txt
@@ -123,7 +123,7 @@ PROPERTIES
         and the dfault virtual port relative id (second value). Note that the
         kernel FMan driver automatically initializes the default VSP (using
         the configuration from the Linux dpaa Ethernet Driver of the equivalent
-        port) while the rest of the VSPs should be initialized by the user 
+        port) while the rest of the VSPs should be initialized by the user
         (using the appropriate IOCTLs).
         For more information please refer to the FMan User's guide
 
@@ -132,7 +132,35 @@ PROPERTIES
       Value type: <u32>
       Definition: Specifies which errors should be discarded.
         Errors that are not in the mask, will not be discarded;
-        I.e. those errors will be enqueued and sent to the default error queue.        
+        I.e. those errors will be enqueued and sent to the default error queue.
+
+  - ar-tables-sizes
+      Usage: optional
+      Value type: <prop-encoded-array>
+      Definition: Specifies the max number of entries which would be allocated
+        to each protocol in the auto response module. 0 value means protocol is
+        not supported. This field is only relevant for Rx ports.
+        A special value is the SNMP_char which stands for total
+        number of characters that would be available for the SNMP protocol in
+        auto response; Since all memory for the auto response must be pre
+        allocated, this is the only value that can't be auto calculated from
+        number of entries.
+        For example, if SNMP table uses among other values 3 strings:
+        "General printer", "idle", "Floor 2",
+        then the number of characters used is 15+4+7=26. The SNMP_char should
+        be a maximal value for such cases, i.e. worst case for such combination.
+        the location of the protocols is as followes:
+        < ARP ICMPv4 NDP ICMPv6 SNMP_ipv4 SNMP_ipv6 SNMP_oid SNMP_char >
+
+  - ar-filters-sizes
+      Usage: optional
+      Value type: <prop-encoded-array>
+      Definition: Specifies the max number of entries which would be allocated
+        to each filtering table in the auto response module.
+        0 value means such filtering table will not be used.
+        This field is only relevant for Rx ports.
+        the location of the filtering tables is as followes:
+        < IP_prot TCP_port UDP_port >
 
 Example
 
@@ -168,7 +196,7 @@ chosen {
                 fifo-size = <0x3000 0>;
                 buffer-layout = <64 128>;
                 vsp-window = <8 0>;
-                errors-to-discard = <0x00020000>;                
+                errors-to-discard = <0x00020000>;
             };
 
             fman1_tx4-extd-args {
diff --git a/arch/powerpc/boot/dts/t1040qds-dsar.dts b/arch/powerpc/boot/dts/t1040qds-dsar.dts
new file mode 100755
index 0000000..aaf84ee
--- /dev/null
+++ b/arch/powerpc/boot/dts/t1040qds-dsar.dts
@@ -0,0 +1,80 @@
+/*
+ * T1040QDS Deep Sleep Auto Response Device Tree Source
+ *
+ * Copyright 2014 Freescale Semiconductor Inc.
+ *
+ * Redistribution and use in source and binary forms, with or without
+ * modification, are permitted provided that the following conditions are met:
+ *     * Redistributions of source code must retain the above copyright
+ *	 notice, this list of conditions and the following disclaimer.
+ *     * Redistributions in binary form must reproduce the above copyright
+ *	 notice, this list of conditions and the following disclaimer in the
+ *	 documentation and/or other materials provided with the distribution.
+ *     * Neither the name of Freescale Semiconductor nor the
+ *	 names of its contributors may be used to endorse or promote products
+ *	 derived from this software without specific prior written permission.
+ *
+ *
+ * ALTERNATIVELY, this software may be distributed under the terms of the
+ * GNU General Public License ("GPL") as published by the Free Software
+ * Foundation, either version 2 of that License or (at your option) any
+ * later version.
+ *
+ * THIS SOFTWARE IS PROVIDED BY Freescale Semiconductor "AS IS" AND ANY
+ * EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE IMPLIED
+ * WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE ARE
+ * DISCLAIMED. IN NO EVENT SHALL Freescale Semiconductor BE LIABLE FOR ANY
+ * DIRECT, INDIRECT, INCIDENTAL, SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES
+ * (INCLUDING, BUT NOT LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES;
+ * LOSS OF USE, DATA, OR PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND
+ * ON ANY THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT
+ * (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE OF THIS
+ * SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.
+ */
+
+/include/ "fsl/t104xsi-pre.dtsi"
+/include/ "t104xqds.dtsi"
+
+/ {
+	model = "fsl,T1040QDS";
+	compatible = "fsl,T1040QDS";
+	interrupt-parent = <&mpic>;
+	chosen {
+	    name = "chosen";
+
+	    dpaa-extended-args {
+		fman1-extd-args {
+		    cell-index = <0>;
+		    compatible = "fsl,fman-extended-args";
+		    dma-aid-mode = "port";
+
+		    fman1_rx3-extd-args {
+			cell-index = <3>;
+			compatible = "fsl,fman-port-1g-rx-extended-args";
+			policer-profile-window = <8>;
+			num-tnums = <16 0>;
+			num-dmas = <8 0>;
+			fifo-size = <0x3000 0>;
+			vsp-window = <8 0>;
+			errors-to-discard = <0x00020000>;
+			ar-tables-sizes = <10 10 10 10 5 5 20 100>;
+			ar-filters-sizes = <10 20 20>;
+		    };
+
+		    fman1_tx3-extd-args {
+			cell-index = <3>;
+			compatible = "fsl,fman-port-1g-tx-extended-args";
+			num-tnums = <16 0>;
+			num-dmas = <8 0>;
+			fifo-size = <0x3000 0>;
+		    };
+
+		};
+	    };
+	};
+};
+
+/include/ "fsl/t1040si-post.dtsi"
+/include/ "fsl/qoriq-dpaa-res3.dtsi"
+
+
-- 
1.9.1

