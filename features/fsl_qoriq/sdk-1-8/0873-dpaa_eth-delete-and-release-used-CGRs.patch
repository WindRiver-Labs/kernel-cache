From 35d141b47684c7e58353faf362b3922919087390 Mon Sep 17 00:00:00 2001
From: Madalin Bucur <madalin.bucur@freescale.com>
Date: Thu, 15 Jan 2015 14:09:46 +0200
Subject: [PATCH 873/987] dpaa_eth: delete and release used CGRs

The CGRs need to be deteled and released upon driver removal.

Signed-off-by: Madalin Bucur <madalin.bucur@freescale.com>
Change-Id: I8bfe5f10388c0d90761a6b8ed9d8816b65625864
Reviewed-on: http://git.am.freescale.net:8181/28534
Tested-by: Review Code-CDREVIEW <CDREVIEW@freescale.com>
Reviewed-by: Marian Cristian Rotariu <marian.rotariu@freescale.com>
[Yang: Original patch taken from
QorIQ-SDK-V1.8-SOURCE-20150619-yocto.iso]
Signed-off-by: Quanyang Wang <quanyang.wang@windriver.com>
---
 drivers/net/ethernet/freescale/dpa/dpaa_eth_common.c | 5 +++++
 1 file changed, 5 insertions(+)

diff --git a/drivers/net/ethernet/freescale/dpa/dpaa_eth_common.c b/drivers/net/ethernet/freescale/dpa/dpaa_eth_common.c
index 19788b5..51c0a01 100644
--- a/drivers/net/ethernet/freescale/dpa/dpaa_eth_common.c
+++ b/drivers/net/ethernet/freescale/dpa/dpaa_eth_common.c
@@ -509,6 +509,11 @@ int __cold dpa_remove(struct platform_device *of_dev)
 
 	err = dpa_fq_free(dev, &priv->dpa_fq_list);
 
+	qman_delete_cgr_safe(&priv->ingress_cgr);
+	qman_release_cgrid(priv->ingress_cgr.cgrid);
+	qman_delete_cgr_safe(&priv->cgr_data.cgr);
+	qman_release_cgrid(priv->cgr_data.cgr.cgrid);
+
 	dpa_private_napi_del(net_dev);
 
 	dpa_bp_free(priv, priv->dpa_bp);
-- 
1.9.1

