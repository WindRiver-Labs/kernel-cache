From d06a461c90641a15fe6173afcc06b30011e39a4e Mon Sep 17 00:00:00 2001
From: Shengzhou Liu <Shengzhou.Liu@freescale.com>
Date: Fri, 19 Sep 2014 07:12:51 +0800
Subject: [PATCH 785/987] fmd: extend workaround of fman reset for T1024

The same hang issue was observed on T1024 as well.

Signed-off-by: Shengzhou Liu <Shengzhou.Liu@freescale.com>
Change-Id: Ifad3fff1b430be90b6cc9548a959365ecd28236d
Reviewed-on: http://git.am.freescale.net:8181/21425
Tested-by: Review Code-CDREVIEW <CDREVIEW@freescale.com>
Reviewed-by: Xiaobo Xie <X.Xie@freescale.com>
[Lu:Original patch taken from
QorIQ-SDK-V1.7-SOURCE-20141218-yocto.iso]
Signed-off-by: Jiang Lu <lu.jiang@windriver.com>
---
 arch/powerpc/include/asm/mpc85xx.h                      | 2 ++
 drivers/net/ethernet/freescale/fman/Peripherals/FM/fm.c | 2 ++
 2 files changed, 4 insertions(+)

diff --git a/arch/powerpc/include/asm/mpc85xx.h b/arch/powerpc/include/asm/mpc85xx.h
index 1530a9d..2c492d9 100644
--- a/arch/powerpc/include/asm/mpc85xx.h
+++ b/arch/powerpc/include/asm/mpc85xx.h
@@ -58,6 +58,8 @@
 #define SVR_P5020	0x822000
 #define SVR_P5021	0X820500
 #define SVR_P5040	0x820400
+#define SVR_T1023       0x854100
+#define SVR_T1024	0x854000
 #define SVR_T2080	0x853000
 #define SVR_T2081	0x853100
 #define SVR_T4240	0x824000
diff --git a/drivers/net/ethernet/freescale/fman/Peripherals/FM/fm.c b/drivers/net/ethernet/freescale/fman/Peripherals/FM/fm.c
index 0c2745e..552a76b 100644
--- a/drivers/net/ethernet/freescale/fman/Peripherals/FM/fm.c
+++ b/drivers/net/ethernet/freescale/fman/Peripherals/FM/fm.c
@@ -3547,6 +3547,8 @@ t_Error FM_Init(t_Handle h_Fm)
 	if (((SVR_SOC_VER(svr) == SVR_T4240 && SVR_REV(svr) > 0x10)) ||
 	    ((SVR_SOC_VER(svr) == SVR_T4160 && SVR_REV(svr) > 0x10)) ||
 	    ((SVR_SOC_VER(svr) == SVR_T4080 && SVR_REV(svr) > 0x10)) ||
+	    (SVR_SOC_VER(svr) == SVR_T1024) ||
+	    (SVR_SOC_VER(svr) == SVR_T1023) ||
 	    (SVR_SOC_VER(svr) == SVR_T2080) ||
 	    (SVR_SOC_VER(svr) == SVR_T2081)) {
 
-- 
1.9.1

