From c4b9d785e4e3bb6a81fb99516db877cab2b56b12 Mon Sep 17 00:00:00 2001
From: Marian Rotariu <marian.rotariu@freescale.com>
Date: Thu, 27 Feb 2014 12:59:55 +0200
Subject: [PATCH 564/987] dpaa_eth: fix MAC device capabilities for macless

[Original patch taken from QorIQ-SDK-V1.6-SOURCE-20140619-yocto.iso]

Right now, the macless probe function will set mac_dev on NULL even if
mac_dev variable was previously initialiazed with a MAC device reference.
The MAC device reference is needed for the new macless capability of having
some control on a proxy initialized MAC device.

This patch removes the undesired mac_dev variable overwrite.

Signed-off-by: Marian Rotariu <marian.rotariu@freescale.com>
Change-Id: Idd1830a464f172ead8a824d7d39bddf9fd66a0b0
Reviewed-on: http://git.am.freescale.net:8181/9227
Tested-by: Review Code-CDREVIEW <CDREVIEW@freescale.com>
Reviewed-by: Cristian-Constantin Sovaiala <Cristian.Sovaiala@freescale.com>
Reviewed-by: Madalin-Cristian Bucur <madalin.bucur@freescale.com>
(cherry picked from commit 80854e726ec82d0d5c903de4b284ed387908000d)
Reviewed-on: http://git.am.freescale.net:8181/9259
Tested-by: Madalin-Cristian Bucur <madalin.bucur@freescale.com>
---
 drivers/net/ethernet/freescale/dpa/dpaa_eth_macless.c | 3 +--
 1 file changed, 1 insertion(+), 2 deletions(-)

diff --git a/drivers/net/ethernet/freescale/dpa/dpaa_eth_macless.c b/drivers/net/ethernet/freescale/dpa/dpaa_eth_macless.c
index 738cb14..705a26f 100644
--- a/drivers/net/ethernet/freescale/dpa/dpaa_eth_macless.c
+++ b/drivers/net/ethernet/freescale/dpa/dpaa_eth_macless.c
@@ -360,6 +360,7 @@ static int dpaa_eth_macless_probe(struct platform_device *_of_dev)
 	priv->msg_enable = netif_msg_init(debug, -1);
 
 	priv->peer = NULL;
+	priv->mac_dev = NULL;
 	if (proxy_dev) {
 		/* This is a temporary solution for the need of
 		 * having main driver upstreamability: adjust_link
@@ -394,8 +395,6 @@ static int dpaa_eth_macless_probe(struct platform_device *_of_dev)
 	if (err < 0)
 		goto bp_create_failed;
 
-	priv->mac_dev = NULL;
-
 	priv->channel = dpa_get_channel();
 
 	if (priv->channel < 0) {
-- 
1.9.1

