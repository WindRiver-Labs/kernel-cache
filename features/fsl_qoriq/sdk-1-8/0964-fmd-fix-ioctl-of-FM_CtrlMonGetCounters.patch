From 6f2af34e39657f6c76e0cbde64e7729517f9e5bf Mon Sep 17 00:00:00 2001
From: Pan Jiafei <Jiafei.Pan@freescale.com>
Date: Wed, 6 May 2015 13:07:48 +0800
Subject: [PATCH 964/987] fmd: fix ioctl of FM_CtrlMonGetCounters

Signed-off-by: Pan Jiafei <Jiafei.Pan@freescale.com>
Change-Id: If3f1264a02dbc9241b10e6050ff0c55c17170ab1
Reviewed-on: http://git.am.freescale.net:8181/35983
Reviewed-by: Mandy Lavi <Mandy.Lavi@freescale.com>
Reviewed-by: Honghua Yin <Hong-Hua.Yin@freescale.com>
Tested-by: Honghua Yin <Hong-Hua.Yin@freescale.com>
[Yang: Original patch taken from
QorIQ-SDK-V1.8-SOURCE-20150619-yocto.iso]
Signed-off-by: Quanyang Wang <quanyang.wang@windriver.com>
---
 drivers/net/ethernet/freescale/fman/src/wrapper/lnxwrp_ioctls_fm.c | 2 +-
 include/uapi/linux/fmd/Peripherals/fm_ioctls.h                     | 2 +-
 2 files changed, 2 insertions(+), 2 deletions(-)

diff --git a/drivers/net/ethernet/freescale/fman/src/wrapper/lnxwrp_ioctls_fm.c b/drivers/net/ethernet/freescale/fman/src/wrapper/lnxwrp_ioctls_fm.c
index 109dd36..886cd5d 100644
--- a/drivers/net/ethernet/freescale/fman/src/wrapper/lnxwrp_ioctls_fm.c
+++ b/drivers/net/ethernet/freescale/fman/src/wrapper/lnxwrp_ioctls_fm.c
@@ -3523,7 +3523,7 @@ t_Error LnxwrpFmIOCTL(t_LnxWrpFmDev *p_LnxWrpFmDev, unsigned int cmd, unsigned l
             else
 #endif
             {
-                if (copy_from_user(&param, (void *)arg, sizeof(ioc_fm_counters_params_t)))
+                if (copy_from_user(&param, (void *)arg, sizeof(ioc_fm_ctrl_mon_counters_params_t)))
                     RETURN_ERROR(MINOR, E_WRITE_FAILED, NO_MSG);
             }
 
diff --git a/include/uapi/linux/fmd/Peripherals/fm_ioctls.h b/include/uapi/linux/fmd/Peripherals/fm_ioctls.h
index 54e65b7..e0c2dd3 100644
--- a/include/uapi/linux/fmd/Peripherals/fm_ioctls.h
+++ b/include/uapi/linux/fmd/Peripherals/fm_ioctls.h
@@ -328,7 +328,7 @@ typedef struct ioc_fm_vsp_prs_result_params_t {
 #endif
 
 typedef struct fm_ctrl_mon_t {
-    uint8_t     percent_cnt[1];
+    uint8_t     percent_cnt[2];
 } fm_ctrl_mon_t;
 
 typedef struct ioc_fm_ctrl_mon_counters_params_t {
-- 
1.9.1

