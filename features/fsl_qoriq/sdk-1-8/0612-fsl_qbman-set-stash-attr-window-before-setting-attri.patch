From 532cca57c3e56574a83092959a66d06d234f57ea Mon Sep 17 00:00:00 2001
From: Haiying Wang <Haiying.Wang@freescale.com>
Date: Mon, 24 Mar 2014 16:58:36 -0400
Subject: [PATCH 612/987] fsl_qbman: set stash attr window before setting
 attribute

[Original patch taken from QorIQ-SDK-V1.6-SOURCE-20140619-yocto.iso]

This additional parameter (window number) is required based
on the latest update of pamu driver.

Signed-off-by: Haiying Wang <Haiying.Wang@freescale.com>
Change-Id: I449919d7d89f3a91b6fe120970911487006fccca
Reviewed-on: http://git.am.freescale.net:8181/10184
Reviewed-by: Varun Sethi <Varun.Sethi@freescale.com>
Tested-by: Review Code-CDREVIEW <CDREVIEW@freescale.com>
Reviewed-by: Geoff Thorpe <Geoff.Thorpe@freescale.com>
Reviewed-by: Jose Rivera <German.Rivera@freescale.com>
---
 drivers/staging/fsl_qbman/qman_driver.c | 2 ++
 1 file changed, 2 insertions(+)

diff --git a/drivers/staging/fsl_qbman/qman_driver.c b/drivers/staging/fsl_qbman/qman_driver.c
index 4190c58..b703daa 100644
--- a/drivers/staging/fsl_qbman/qman_driver.c
+++ b/drivers/staging/fsl_qbman/qman_driver.c
@@ -651,6 +651,8 @@ static void qman_portal_update_sdest(const struct qm_portal_config *pcfg,
 	if (pcfg->iommu_domain) {
 		stash_attr.cpu = cpu;
 		stash_attr.cache = PAMU_ATTR_CACHE_L1;
+		/* set stash information for the window */
+		stash_attr.window = 0;
 		ret = iommu_domain_set_attr(pcfg->iommu_domain,
 				DOMAIN_ATTR_FSL_PAMU_STASH, &stash_attr);
 		if (ret < 0) {
-- 
1.9.1

