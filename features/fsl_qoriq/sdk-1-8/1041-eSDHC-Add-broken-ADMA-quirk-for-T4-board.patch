From 8e4db3ec84a59d77370b87c6314f7ba5bd90bb87 Mon Sep 17 00:00:00 2001
From: Haijun Zhang <haijun.zhang@freescale.com>
Date: Thu, 11 Apr 2013 09:09:01 +0800
Subject: [PATCH 1041/1094] eSDHC: Add broken ADMA quirk for T4 board

[Original patch taken from QorIQ-SDK-V1.6-SOURCE-20140619-yocto.iso]

eMMC build-in in T4 board can't work when use ADMA transfer data,
but for SDHC card it work well. No ERRATA and relevant bugfix
for this issue, so use SDMA instead get it working fist.

Signed-off-by: Haijun Zhang <Haijun.Zhang@freescale.com>
Signed-off-by: Jerry Huang <Chang-Ming.Huang@freescale.com>
Signed-off-by: Chunhe Lan <Chunhe.Lan@freescale.com>
Signed-off-by: Andy Fleming <afleming@freescale.com>
Change-Id: Ifdb8cf3caa7b1904c252e435e94254d089ec23c4
Reviewed-on: http://git.am.freescale.net:8181/1215
Tested-by: Fleming Andrew-AFLEMING <AFLEMING@freescale.com>
Reviewed-by: Fleming Andrew-AFLEMING <AFLEMING@freescale.com>
[Fix context to apply to WRL.]
Signed-off-by: Quanyang Wang <quanyang.wang@windriver.com>
---
 drivers/mmc/host/sdhci-pltfm.c | 1 +
 1 file changed, 1 insertion(+)

diff --git a/drivers/mmc/host/sdhci-pltfm.c b/drivers/mmc/host/sdhci-pltfm.c
index a0558e1..76ce438 100644
--- a/drivers/mmc/host/sdhci-pltfm.c
+++ b/drivers/mmc/host/sdhci-pltfm.c
@@ -106,6 +106,7 @@ void sdhci_get_of_property(struct platform_device *pdev)
 		host->quirks2 |= SDHCI_QUIRK2_LONG_TIME_CMD_COMPLETE_IRQ;
 		host->quirks2 |= SDHCI_QUIRK2_CIRCUIT_SUPPORT_VS33;
 		host->quirks2 |= SDHCI_QUIRK2_FORCE_CMD13_DETECT_CARD;
+			host->quirks |= SDHCI_QUIRK_BROKEN_ADMA;
 	}
 
 	if (of_device_is_compatible(np, "fsl,p4860-rev1-esdhc") ||
-- 
2.0.2

