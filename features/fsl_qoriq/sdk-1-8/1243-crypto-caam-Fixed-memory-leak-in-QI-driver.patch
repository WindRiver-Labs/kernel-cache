From 6227d4463b3038abebbbc703cab53a63a9bc40ea Mon Sep 17 00:00:00 2001
From: Vakul Garg <vakul@freescale.com>
Date: Tue, 28 May 2013 12:55:51 +0530
Subject: [PATCH 1243/1336] crypto: caam - Fixed memory leak in QI driver

[Original patch taken from QorIQ-SDK-V1.6-SOURCE-20140619-yocto.iso]

The function caam_drv_ctx_rel() did not release the memory allocated for
driver context. Added kfree() for cleanup.

Change-Id: If44af08f4be6992f428414ac83c029a79e4de6c6
Signed-off-by: Vakul Garg <vakul@freescale.com>
Reviewed-on: http://git.am.freescale.net:8181/2733
Tested-by: Review Code-CDREVIEW <CDREVIEW@freescale.com>
Reviewed-by: Geanta Neag Horia Ioan-B05471 <horia.geanta@freescale.com>
Reviewed-by: Fleming Andrew-AFLEMING <AFLEMING@freescale.com>
Tested-by: Fleming Andrew-AFLEMING <AFLEMING@freescale.com>
---
 drivers/crypto/caam/qi.c | 2 ++
 1 file changed, 2 insertions(+)

diff --git a/drivers/crypto/caam/qi.c b/drivers/crypto/caam/qi.c
index 88c99bf..7ec0b58 100644
--- a/drivers/crypto/caam/qi.c
+++ b/drivers/crypto/caam/qi.c
@@ -368,6 +368,8 @@ void caam_drv_ctx_rel(struct caam_drv_ctx *drv_ctx)
 
 	dma_unmap_single(drv_ctx->qidev, dma_unmap_addr(drv_ctx, context_a),
 			 size, DMA_BIDIRECTIONAL);
+
+	kfree(drv_ctx);
 }
 EXPORT_SYMBOL(caam_drv_ctx_rel);
 
-- 
2.0.2

