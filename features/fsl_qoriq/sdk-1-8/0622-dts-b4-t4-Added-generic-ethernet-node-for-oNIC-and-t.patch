From 9d7f4a1d8a347902df0bf7e1563839c0cb5eac95 Mon Sep 17 00:00:00 2001
From: Vakul Garg <vakul@freescale.com>
Date: Fri, 28 Mar 2014 09:28:56 -0400
Subject: [PATCH 622/987] dts b4/t4: Added generic ethernet node for oNIC and
 two oh ports

[Original patch taken from QorIQ-SDK-V1.6-SOURCE-20140619-yocto.iso]

OH ports serve as tx/rx points for oNIC

Signed-off-by: Sandeep Singh <sandeep@freescale.com>
Signed-off-by: Vakul Garg <vakul@freescale.com>
Change-Id: I7896a19ea05f6b09ee8559e7a2895be9c8c0de3d
Reviewed-on: http://git.am.freescale.net:8181/10007
Reviewed-by: Bharat Bhushan <Bharat.Bhushan@freescale.com>
Tested-by: Review Code-CDREVIEW <CDREVIEW@freescale.com>
Reviewed-by: Jianhua Xie <jianhua.xie@freescale.com>
Reviewed-by: Marian Cristian Rotariu <marian.rotariu@freescale.com>
Reviewed-by: Jose Rivera <German.Rivera@freescale.com>
---
 arch/powerpc/boot/dts/b4420qds-usdpaa.dts | 45 +++++++++++++++++++++++++++++
 arch/powerpc/boot/dts/b4860qds-usdpaa.dts | 46 +++++++++++++++++++++++++++++-
 arch/powerpc/boot/dts/t4240qds-usdpaa.dts | 47 +++++++++++++++++++++++++++++++
 3 files changed, 137 insertions(+), 1 deletion(-)

diff --git a/arch/powerpc/boot/dts/b4420qds-usdpaa.dts b/arch/powerpc/boot/dts/b4420qds-usdpaa.dts
index 2884b0c..4d76fcf 100644
--- a/arch/powerpc/boot/dts/b4420qds-usdpaa.dts
+++ b/arch/powerpc/boot/dts/b4420qds-usdpaa.dts
@@ -77,6 +77,32 @@
 		fsl,bpid = <12>;
 		fsl,bpool-thresholds = <0x100 0x300 0x0 0x0>;
 	};
+	bp13: buffer-pool@13 {
+			compatible = "fsl,b4420-bpool", "fsl,bpool", "fsl,bpool-ethernet-seeds";
+			fsl,bpid = <13>;
+			fsl,bpool-ethernet-cfg = <0 2048 0 1728 0 0>;
+			fsl,bpool-thresholds = <0x100 0x300 0x0 0x0>;
+	};
+
+	chosen {
+		dpaa-extended-args {
+			fman0-extd-args {
+				cell-index = <0x0>;
+				compatible = "fsl,fman-extended-args";
+				dma-aid-mode = "port";
+				fman0_oh3-extd-args {
+					cell-index = <0x2>;
+					compatible = "fsl,fman-port-op-extended-args";
+					vsp-window = <0x8 0x0>;
+				};
+				fman0_oh4-extd-args {
+					cell-index = <0x3>;
+					compatible = "fsl,fman-port-op-extended-args";
+					vsp-window = <0x8 0x0>;
+				};
+			};
+		};
+	};
 
 	fsl,dpaa {
 		ethernet@0 {
@@ -103,6 +129,12 @@
 			fsl,qman-frame-queues-rx = <0x56 1 0x57 1>;
 			fsl,qman-frame-queues-tx = <0x76 1 0x77 1>;
 		};
+		ethernet@4 {
+			compatible = "fsl,b4420-dpa-ethernet-generic", "fsl,dpa-ethernet-generic";
+			fsl,qman-frame-queues-tx = <0x78 1>;
+			fsl,oh-ports = <&oh3 &oh4>;
+			local-mac-address = [00 11 22 33 44 66];
+		};
 
 		dpa-fman0-oh@2 {
 			compatible = "fsl,dpa-oh";
@@ -111,5 +143,18 @@
 			fsl,qman-frame-queues-oh = <0x6e 1 0x6f 1>;
 			fsl,fman-oh-port = <&fman0_oh2>;
 		};
+		oh3: dpa-fman0-oh@3 {
+			compatible = "fsl,dpa-oh";
+			fsl,bman-buffer-pools = <&bp13>;
+			fsl,qman-frame-queues-oh = <0x7a 1 0x7b 1>;
+			fsl,fman-oh-port = <&fman0_oh3>;
+		};
+		oh4: dpa-fman0-oh@4 {
+			compatible = "fsl,dpa-oh";
+			fsl,bman-buffer-pools = <&bp7 &bp8 &bp9>;
+			fsl,qman-frame-queues-oh = <0x7c 1 0x7d 1>;
+			fsl,fman-oh-port = <&fman0_oh4>;
+		};
+
 	};
 };
diff --git a/arch/powerpc/boot/dts/b4860qds-usdpaa.dts b/arch/powerpc/boot/dts/b4860qds-usdpaa.dts
index 845e975..955cab3 100644
--- a/arch/powerpc/boot/dts/b4860qds-usdpaa.dts
+++ b/arch/powerpc/boot/dts/b4860qds-usdpaa.dts
@@ -85,6 +85,32 @@
 			fsl,bpool-thresholds = <0x100 0x300 0x0 0x0>;
 	};
 
+	bp17: buffer-pool@17 {
+			compatible = "fsl,b4860-bpool", "fsl,bpool", "fsl,bpool-ethernet-seeds";
+			fsl,bpid = <17>;
+			fsl,bpool-ethernet-cfg = <0 2048 0 1728 0 0>;
+			fsl,bpool-thresholds = <0x100 0x300 0x0 0x0>;
+	};
+
+	chosen {
+		dpaa-extended-args {
+			fman0-extd-args {
+				cell-index = <0x0>;
+				compatible = "fsl,fman-extended-args";
+				dma-aid-mode = "port";
+				fman0_oh3-extd-args {
+					cell-index = <0x2>;
+					compatible = "fsl,fman-port-op-extended-args";
+					vsp-window = <0x8 0x0>;
+				};
+				fman0_oh4-extd-args {
+					cell-index = <0x3>;
+					compatible = "fsl,fman-port-op-extended-args";
+					vsp-window = <0x8 0x0>;
+				};
+			};
+		};
+	};
 
 	fsl,dpaa {
 		ethernet@0 {
@@ -147,7 +173,12 @@
                         fsl,qman-frame-queues-tx = <4008 8>;
                         local-mac-address = [00 11 22 33 44 55];
                 };
-
+		ethernet@17 {
+			compatible = "fsl,b4860-dpa-ethernet-generic", "fsl,dpa-ethernet-generic";
+			fsl,qman-frame-queues-tx = <4050 1>;
+			fsl,oh-ports = <&oh3 &oh4>;
+			local-mac-address = [00 11 22 33 44 66];
+		};
 		dpa-fman0-oh@2 {
 			compatible = "fsl,dpa-oh";
 			/* Define frame queues for the OH port*/
@@ -155,5 +186,18 @@
 			fsl,qman-frame-queues-oh = <0x6e 1 0x6f 1>;
 			fsl,fman-oh-port = <&fman0_oh2>;
 		};
+		oh3: dpa-fman0-oh@3 {
+			compatible = "fsl,dpa-oh";
+			fsl,bman-buffer-pools = <&bp17>;
+			fsl,qman-frame-queues-oh = <4054 1 4055 1>;
+			fsl,fman-oh-port = <&fman0_oh3>;
+		};
+		oh4: dpa-fman0-oh@4 {
+			compatible = "fsl,dpa-oh";
+			fsl,bman-buffer-pools = <&bp7 &bp8 &bp9>;
+			fsl,qman-frame-queues-oh = <4052 1 4053 1>;
+			fsl,fman-oh-port = <&fman0_oh4>;
+		};
+
 	};
 };
diff --git a/arch/powerpc/boot/dts/t4240qds-usdpaa.dts b/arch/powerpc/boot/dts/t4240qds-usdpaa.dts
index 88e627d..f6ee470 100644
--- a/arch/powerpc/boot/dts/t4240qds-usdpaa.dts
+++ b/arch/powerpc/boot/dts/t4240qds-usdpaa.dts
@@ -77,6 +77,32 @@
 		fsl,bpid = <12>;
 		fsl,bpool-thresholds = <0x100 0x300 0x0 0x0>;
 	};
+	bp13: buffer-pool@13 {
+			compatible = "fsl,t4240-bpool", "fsl,bpool", "fsl,bpool-ethernet-seeds";
+			fsl,bpid = <13>;
+			fsl,bpool-ethernet-cfg = <0 2048 0 1728 0 0>;
+			fsl,bpool-thresholds = <0x100 0x300 0x0 0x0>;
+	};
+
+	chosen {
+		dpaa-extended-args {
+			fman0-extd-args {
+				cell-index = <0x0>;
+				compatible = "fsl,fman-extended-args";
+				dma-aid-mode = "port";
+				fman0_oh3-extd-args {
+					cell-index = <0x2>;
+					compatible = "fsl,fman-port-op-extended-args";
+					vsp-window = <0x8 0x0>;
+				};
+				fman0_oh4-extd-args {
+					cell-index = <0x3>;
+					compatible = "fsl,fman-port-op-extended-args";
+					vsp-window = <0x8 0x0>;
+				};
+			};
+		};
+	};
 
 	fsl,dpaa {
 		ethernet@4 {
@@ -115,6 +141,14 @@
 			fsl,qman-frame-queues-rx = <0x6e 1 0x6f 1>;
 			fsl,qman-frame-queues-tx = <0x8e 1 0x8f 1>;
 		};
+		ethernet@16 {
+			compatible = "fsl,t4240-dpa-ethernet-generic", "fsl,dpa-ethernet-generic";
+			fsl,qman-frame-queues-tx = <0x92 1>;
+			fsl,oh-ports = <&oh3 &oh4>;
+			local-mac-address = [00 11 22 33 44 66];
+
+		};
+
 		dpa-fman0-oh@2 {
 			compatible = "fsl,dpa-oh";
 			/* Define frame queues for the OH port*/
@@ -122,5 +156,18 @@
 			fsl,qman-frame-queues-oh = <0x90 1 0x91 1>;
 			fsl,fman-oh-port = <&fman0_oh2>;
 		};
+		oh3: dpa-fman0-oh@3 {
+			compatible = "fsl,dpa-oh";
+			fsl,bman-buffer-pools = <&bp13>;
+			fsl,qman-frame-queues-oh = <0x96 1 0x97 1>;
+			fsl,fman-oh-port = <&fman0_oh3>;
+		};
+		oh4: dpa-fman0-oh@4 {
+			compatible = "fsl,dpa-oh";
+			fsl,bman-buffer-pools = <&bp7 &bp8 &bp9>;
+			fsl,qman-frame-queues-oh = <0x94 1 0x95 1>;
+			fsl,fman-oh-port = <&fman0_oh4>;
+		};
+
 	};
 };
-- 
1.9.1

