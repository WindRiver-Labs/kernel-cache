From 05e6701d145909dc87b826c1e325dbfbfd43ee95 Mon Sep 17 00:00:00 2001
From: Marian Chereji <marian.chereji@freescale.com>
Date: Tue, 16 Sep 2014 12:31:19 +0300
Subject: [PATCH 822/987] dpa_offload: Avoid dereferencing a free pointer in
 DPA Stats wrapper

In the DPA statistics wrapper, in the function
"do_ioctl_stats_modify_class_counter" the pointer prm.params.pair is
dereferenced immediately after it has been freed up. The assignment
espressions were useless hence they were discarded.

Change-Id: Idbfc3865413b15d9713803fceb91956cc618d930
Signed-off-by: Marian Chereji <marian.chereji@freescale.com>
Reviewed-on: http://git.am.freescale.net:8181/18812
Reviewed-by: Anca Jeanina Floarea <anca.floarea@freescale.com>
[Lu:Original patch taken from
QorIQ-SDK-V1.7-SOURCE-20141218-yocto.iso]
Signed-off-by: Jiang Lu <lu.jiang@windriver.com>
---
 drivers/staging/fsl_dpa_offload/wrp_dpa_stats.c | 2 --
 1 file changed, 2 deletions(-)

diff --git a/drivers/staging/fsl_dpa_offload/wrp_dpa_stats.c b/drivers/staging/fsl_dpa_offload/wrp_dpa_stats.c
index aa30e0e..48ed7ca 100644
--- a/drivers/staging/fsl_dpa_offload/wrp_dpa_stats.c
+++ b/drivers/staging/fsl_dpa_offload/wrp_dpa_stats.c
@@ -1348,8 +1348,6 @@ static int do_ioctl_stats_modify_class_counter(void *args)
 			}
 			kfree(prm.params.pair);
 			/* Restore user-provided key */
-			prm.params.pair->first_key = us_pair->first_key;
-			prm.params.pair->second_key = us_pair->second_key;
 			prm.params.pair = us_pair;
 		}
 		break;
-- 
1.9.1

