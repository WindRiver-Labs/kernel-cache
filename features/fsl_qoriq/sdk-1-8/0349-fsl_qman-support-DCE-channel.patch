From 4f660e4c80801e4a8db0a44a1cafde71bf61d75b Mon Sep 17 00:00:00 2001
From: Jeffrey Ladouceur <Jeffrey.Ladouceur@freescale.com>
Date: Wed, 26 Jun 2013 15:57:06 -0400
Subject: [PATCH 349/987] fsl_qman: support DCE channel

[Original patch taken from QorIQ-SDK-V1.6-SOURCE-20140619-yocto.iso]

The dce accelerator uses QMan's direct connect portal.
Extend qm_dc_portal to support dce.
Add api to query the DCE channel.
This is consistent with other accelerators such as PME.

Signed-off-by: Jeffrey Ladouceur <Jeffrey.Ladouceur@freescale.com>
Change-Id: I7278684ce2b3c85e67e629605aa79a88c19a50f1
Reviewed-on: http://git.am.freescale.net:8181/4199
Tested-by: Review Code-CDREVIEW <CDREVIEW@freescale.com>
Reviewed-by: Thorpe Geoff-R01361 <Geoff.Thorpe@freescale.com>
Reviewed-by: Wang Haiying-R54964 <Haiying.Wang@freescale.com>
Reviewed-by: Rivera Jose-B46482 <German.Rivera@freescale.com>
---
 drivers/staging/fsl_qbman/qman_driver.c |  2 ++
 include/linux/fsl_qman.h                | 10 +++++++---
 2 files changed, 9 insertions(+), 3 deletions(-)

diff --git a/drivers/staging/fsl_qbman/qman_driver.c b/drivers/staging/fsl_qbman/qman_driver.c
index a1aab54..cb8f222 100644
--- a/drivers/staging/fsl_qbman/qman_driver.c
+++ b/drivers/staging/fsl_qbman/qman_driver.c
@@ -44,6 +44,8 @@ u16 qm_channel_caam = QMAN_CHANNEL_CAAM;
 EXPORT_SYMBOL(qm_channel_caam);
 u16 qm_channel_pme = QMAN_CHANNEL_PME;
 EXPORT_SYMBOL(qm_channel_pme);
+u16 qm_channel_dce = QMAN_CHANNEL_DCE;
+EXPORT_SYMBOL(qm_channel_dce);
 u16 qman_portal_max;
 EXPORT_SYMBOL(qman_portal_max);
 
diff --git a/include/linux/fsl_qman.h b/include/linux/fsl_qman.h
index 673724a..e328d1d 100644
--- a/include/linux/fsl_qman.h
+++ b/include/linux/fsl_qman.h
@@ -46,14 +46,18 @@ extern "C" {
 #define QMAN_CHANNEL_POOL1_REV3 0x401
 #define QMAN_CHANNEL_CAAM_REV3 0x840
 #define QMAN_CHANNEL_PME_REV3 0x860
+#define QMAN_CHANNEL_DCE 0x8a0
 extern u16 qm_channel_pool1;
 extern u16 qm_channel_caam;
 extern u16 qm_channel_pme;
+extern u16 qm_channel_dce;
 enum qm_dc_portal {
 	qm_dc_portal_fman0 = 0,
 	qm_dc_portal_fman1 = 1,
 	qm_dc_portal_caam = 2,
-	qm_dc_portal_pme = 3
+	qm_dc_portal_pme = 3,
+	qm_dc_portal_rman = 4,
+	qm_dc_portal_dce = 5
 };
 
 /* Portal processing (interrupt) sources */
@@ -327,8 +331,8 @@ struct qm_mr_entry {
 		} __packed ern;
 		struct {
 			u8 colour:2;	/* See QM_MR_DCERN_COLOUR_* */
-			u8 __reserved1:4;
-			enum qm_dc_portal portal:2;
+			u8 __reserved1:3;
+			enum qm_dc_portal portal:3;
 			u16 __reserved2;
 			u8 rc;		/* Rejection Code */
 			u32 __reserved3:24;
-- 
1.9.1

