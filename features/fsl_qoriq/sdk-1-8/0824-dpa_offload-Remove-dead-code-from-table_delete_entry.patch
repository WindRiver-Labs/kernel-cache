From 3066b92640000d68dd7e5b472d765a77026787e7 Mon Sep 17 00:00:00 2001
From: Marian Chereji <marian.chereji@freescale.com>
Date: Thu, 18 Sep 2014 15:30:54 +0300
Subject: [PATCH 824/987] dpa_offload: Remove dead code from
 "table_delete_entry_by_ref"

There is an unreachable code paragraph in function "table_delete_entry_by_ref".
The function doesn't work for indexed tables. In the first half, an error
is issued in this case. However, in the second half, another code paragraph
is testing again if the table type is "indexed". This branch will never
be reachable and was removed.

Change-Id: Ib200f49eafca8131d4c1696af2e61753ede41a3d
Signed-off-by: Marian Chereji <marian.chereji@freescale.com>
Reviewed-on: http://git.am.freescale.net:8181/19135
Reviewed-by: Radu-Andrei Bulie <Radu.Bulie@freescale.com>
[Lu:Original patch taken from
QorIQ-SDK-V1.7-SOURCE-20141218-yocto.iso]
Signed-off-by: Jiang Lu <lu.jiang@windriver.com>
---
 drivers/staging/fsl_dpa_offload/dpa_classifier.c | 27 ++++++------------------
 1 file changed, 6 insertions(+), 21 deletions(-)

diff --git a/drivers/staging/fsl_dpa_offload/dpa_classifier.c b/drivers/staging/fsl_dpa_offload/dpa_classifier.c
index 76ba474..246435b 100644
--- a/drivers/staging/fsl_dpa_offload/dpa_classifier.c
+++ b/drivers/staging/fsl_dpa_offload/dpa_classifier.c
@@ -1560,7 +1560,6 @@ static int table_delete_entry_by_ref(struct dpa_cls_table *ptable, int entry_id)
 {
 	t_Error err;
 	struct dpa_cls_tbl_shadow_entry *shadow_entry;
-	struct dpa_cls_tbl_shadow_entry_indexed *shadow_entry_indexed;
 	uint8_t entry_index;
 	unsigned int cc_node_index;
 	t_Handle cc_node;
@@ -1630,30 +1629,16 @@ static int table_delete_entry_by_ref(struct dpa_cls_table *ptable, int entry_id)
 	int_cc_node->used--;
 
 	if (ptable->shadow_table) {
-		if (ptable->params.type == DPA_CLS_TBL_INDEXED) {
-			shadow_list_entry = ptable->shadow_table[0].
-					shadow_entry[entry_index].next;
-			shadow_entry_indexed = list_entry(shadow_list_entry,
-					struct dpa_cls_tbl_shadow_entry_indexed,
-					list_node);
-
-			list_del(&shadow_entry_indexed->list_node);
-
-			kfree(shadow_entry_indexed);
-		} else {
-			shadow_list_entry =
-					ptable->entry[entry_id].shadow_entry;
-			shadow_entry = list_entry(shadow_list_entry,
+		shadow_list_entry = ptable->entry[entry_id].shadow_entry;
+		shadow_entry = list_entry(shadow_list_entry,
 						struct dpa_cls_tbl_shadow_entry,
 						list_node);
 
-			list_del(&shadow_entry->list_node);
-
-			kfree(shadow_entry->key.byte);
-			kfree(shadow_entry->key.mask);
-			kfree(shadow_entry);
-		}
+		list_del(&shadow_entry->list_node);
 
+		kfree(shadow_entry->key.byte);
+		kfree(shadow_entry->key.mask);
+		kfree(shadow_entry);
 	}
 
 	dpa_cls_dbg(("DEBUG: dpa_classifier %s (%d) <--\n", __func__,
-- 
1.9.1

