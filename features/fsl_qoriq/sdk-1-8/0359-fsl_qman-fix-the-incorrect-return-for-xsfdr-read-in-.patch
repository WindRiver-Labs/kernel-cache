From f3ab2b1ebe80705c94e0126276ea2e8568dc3c5d Mon Sep 17 00:00:00 2001
From: Haiying Wang <Haiying.Wang@freescale.com>
Date: Fri, 16 Aug 2013 14:17:44 -0400
Subject: [PATCH 359/987] fsl_qman: fix the incorrect return for xsfdr read in
 debugfs

[Original patch taken from QorIQ-SDK-V1.6-SOURCE-20140619-yocto.iso]

and fix the mask value for correctly getting the XSFDR value.

Signed-off-by: Haiying Wang <Haiying.Wang@freescale.com>
Change-Id: I72ba857bd01b93ca6042e354c7ca8c391f430e83
Reviewed-on: http://git.am.freescale.net:8181/4059
Reviewed-by: Thorpe Geoff-R01361 <Geoff.Thorpe@freescale.com>
Tested-by: Review Code-CDREVIEW <CDREVIEW@freescale.com>
Reviewed-by: Rivera Jose-B46482 <German.Rivera@freescale.com>
---
 drivers/staging/fsl_qbman/qman_debugfs.c | 4 ++--
 1 file changed, 2 insertions(+), 2 deletions(-)

diff --git a/drivers/staging/fsl_qbman/qman_debugfs.c b/drivers/staging/fsl_qbman/qman_debugfs.c
index 6b4dc046..ede3d40 100644
--- a/drivers/staging/fsl_qbman/qman_debugfs.c
+++ b/drivers/staging/fsl_qbman/qman_debugfs.c
@@ -1387,7 +1387,7 @@ static int query_ceetm_xsfdr_show(struct seq_file *file, void *offset)
 	enum qm_dc_portal portal;
 
 
-	if ((qman_ip_rev & 0xFF00) < QMAN_REV31)
+	if (qman_ip_rev < QMAN_REV31)
 		return -EINVAL;
 
 	portal = query_ceetm_xsfdr_data.dcp_portal;
@@ -1399,7 +1399,7 @@ static int query_ceetm_xsfdr_show(struct seq_file *file, void *offset)
 	}
 
 	seq_printf(file, "DCP%d: CEETM_XSFDR_IN_USE number is %u\n", portal,
-						(xsfdr_in_use & 0x1FF));
+						(xsfdr_in_use & 0x1FFF));
 	return 0;
 }
 
-- 
1.9.1

