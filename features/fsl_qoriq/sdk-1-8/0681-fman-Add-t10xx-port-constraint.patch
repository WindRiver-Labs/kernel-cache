From e31440f10032f3ae9071c1c15152da199564d155 Mon Sep 17 00:00:00 2001
From: Jianhua Xie <jianhua.xie@freescale.com>
Date: Tue, 13 May 2014 11:02:55 +0800
Subject: [PATCH 681/987] fman: Add t10xx port constraint

[Original patch taken from QorIQ-SDK-V1.6-SOURCE-20140619-yocto.iso]

There are two FMAN V3 version: FMAN_V3H and FMAN_V3L. Some hardware
resources are different between the two version. T1040, T1042,
T1020, T1022 belong to FMAN_V3L, there are 4 Offline/Host Command
Ports (O/H n) in FMAN_V3L. But there are 6 Offline/Host Command
Ports (O/H n) in FMAN_V3H.
This patch is correcting some definition like INTG_MAX_NUM_OF_FM,
FM_MAX_NUM_OF_10G_MACS, FM_MAX_NUM_OF_1G_MACS and etc. according
to (T1040RM Rev D, 04/2014)

Signed-off-by: Jianhua Xie <jianhua.xie@freescale.com>
Change-Id: I3f7fa9b70fad30b49cd76da57429ab8ad08b5176
Reviewed-on: http://git.am.freescale.net:8181/12241
Reviewed-by: Jiafei Pan <Jiafei.Pan@freescale.com>
Tested-by: Review Code-CDREVIEW <CDREVIEW@freescale.com>
Reviewed-by: Jose Rivera <German.Rivera@freescale.com>
---
 drivers/net/ethernet/freescale/fman/Kconfig                   | 11 +++++++++++
 .../fman/inc/integrations/T4240/dpaa_integration_ext.h        | 11 +++++++++++
 2 files changed, 22 insertions(+)

diff --git a/drivers/net/ethernet/freescale/fman/Kconfig b/drivers/net/ethernet/freescale/fman/Kconfig
index ccf77ef..fe0f51d 100644
--- a/drivers/net/ethernet/freescale/fman/Kconfig
+++ b/drivers/net/ethernet/freescale/fman/Kconfig
@@ -32,6 +32,17 @@ config FMAN_T4240
 endchoice
 endmenu
 
+config FMAN_V3L
+	depends on FMAN_T4240
+	bool "FMAN_V3L like T1040, T1042, T1020, T1022"
+	default n
+	---help---
+	  There are two FMAN V3 version: FMAN_V3H and FMAN_V3L.
+	  T1040, T1042, T1020, T1022 belong to FMAN_V3L, there
+	  are 4 Offline/Host Command Ports (O/H n) in FMAN_V3L.
+	  But there are 6 Offline/Host Command Ports (O/H n) in
+	  FMAN_V3H.
+	  Say "Y" if chips are T1040, T1042, T1020, T1022 family.
 
 config FMAN_DISABLE_OH_TO_REUSE_RESOURCES
 	depends on FMAN_RESOURCE_ALLOCATION_ALGORITHM
diff --git a/drivers/net/ethernet/freescale/fman/inc/integrations/T4240/dpaa_integration_ext.h b/drivers/net/ethernet/freescale/fman/inc/integrations/T4240/dpaa_integration_ext.h
index 6fa8c25..dc3320f 100644
--- a/drivers/net/ethernet/freescale/fman/inc/integrations/T4240/dpaa_integration_ext.h
+++ b/drivers/net/ethernet/freescale/fman/inc/integrations/T4240/dpaa_integration_ext.h
@@ -188,6 +188,16 @@ typedef enum
 /*****************************************************************************
  FM INTEGRATION-SPECIFIC DEFINITIONS
 ******************************************************************************/
+/* Add T1 Port constraint:T1040, T1042, T1020, T1022 (T1040RM Rev D, 04/2014) */
+#ifdef CONFIG_FMAN_V3L
+#define INTG_MAX_NUM_OF_FM	1
+
+/* Ports defines */
+#define FM_MAX_NUM_OF_1G_MACS	5
+#define FM_MAX_NUM_OF_10G_MACS	0
+#define FM_MAX_NUM_OF_MACS	(FM_MAX_NUM_OF_1G_MACS + FM_MAX_NUM_OF_10G_MACS)
+#define FM_MAX_NUM_OF_OH_PORTS	4
+#else
 #define INTG_MAX_NUM_OF_FM          2
 
 /* Ports defines */
@@ -195,6 +205,7 @@ typedef enum
 #define FM_MAX_NUM_OF_10G_MACS      2
 #define FM_MAX_NUM_OF_MACS          (FM_MAX_NUM_OF_1G_MACS + FM_MAX_NUM_OF_10G_MACS)
 #define FM_MAX_NUM_OF_OH_PORTS      6
+#endif
 
 #define FM_MAX_NUM_OF_1G_RX_PORTS   FM_MAX_NUM_OF_1G_MACS
 #define FM_MAX_NUM_OF_10G_RX_PORTS  FM_MAX_NUM_OF_10G_MACS
-- 
1.9.1

