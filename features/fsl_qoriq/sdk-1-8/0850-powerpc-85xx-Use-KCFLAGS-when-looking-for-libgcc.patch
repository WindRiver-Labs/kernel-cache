From 8d11ef35437e92f65d113b01ffab11e518ad55b5 Mon Sep 17 00:00:00 2001
From: Yuanjie Huang <Yuanjie.Huang@windriver.com>
Date: Thu, 23 Jul 2015 09:01:07 +0000
Subject: [PATCH 850/987] powerpc/85xx: Use KCFLAGS when looking for libgcc

Freescale SDK kernel v1.6 and above adds code with dependency on libgcc
to support Freescale DPAA Q/Bman, but the makefile change has not
considered that a cross-compiler normally needs an sysroot option to
correctly report the path of libgcc.

Since CC variable is composed from CROSS_COMPILE variable in top-most
makefile, the sysroot has to be set using KCFLAGS, which is designed to
provide additional options to the C compiler. Moreover, KCFLAGS is not
appended to KBUILD_CFLAGS propagated to architecture specific makefile.
Therefore, this patch modifies the compiler command for querying libgcc
path to use KCFLAGS option, so that once --sysroot=<path> option is set
in KCFLAGS, libgcc can be found correctly.

Signed-off-by: Yuanjie Huang <Yuanjie.Huang@windriver.com>
---
 arch/powerpc/Makefile | 2 +-
 1 file changed, 1 insertion(+), 1 deletion(-)

diff --git a/arch/powerpc/Makefile b/arch/powerpc/Makefile
index a3040e4..f39fcea 100644
--- a/arch/powerpc/Makefile
+++ b/arch/powerpc/Makefile
@@ -97,7 +97,7 @@ LDFLAGS_vmlinux-y := -Bstatic
 LDFLAGS_vmlinux-$(CONFIG_RELOCATABLE) := -pie
 LDFLAGS_vmlinux	:= $(LDFLAGS_vmlinux-y)
 
-LIBGCC          := $(shell $(CC) $(KBUILD_CFLAGS) -print-libgcc-file-name)
+LIBGCC          := $(shell $(CC) $(KBUILD_CFLAGS) $(KCFLAGS) -print-libgcc-file-name)
 
 ifeq ($(CONFIG_PPC64),y)
 ifeq ($(call cc-option-yn,-mcmodel=medium),y)
-- 
1.9.1

