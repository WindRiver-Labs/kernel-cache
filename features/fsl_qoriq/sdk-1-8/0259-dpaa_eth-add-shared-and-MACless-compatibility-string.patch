From aeb4ccf5bae56c925081083f1eede9452af67d64 Mon Sep 17 00:00:00 2001
From: Madalin Bucur <madalin.bucur@freescale.com>
Date: Fri, 7 Jun 2013 17:18:50 +0300
Subject: [PATCH 259/987] dpaa_eth: add shared and MACless compatibility
 strings

[Original patch taken from QorIQ-SDK-V1.6-SOURCE-20140619-yocto.iso]

Add dedicated compatibility strings for shared and MACless
interfaces: "fsl,dpa-ethernet-shared" and "fsl,dpa-ethernet-macless".

Signed-off-by: Madalin Bucur <madalin.bucur@freescale.com>
Change-Id: I71a9f14e53e9ecbbba5f837589708cc847b41e4e
Reviewed-on: http://git.am.freescale.net:8181/3080
Reviewed-by: Sovaiala Cristian-Constantin-B39531 <Cristian.Sovaiala@freescale.com>
Reviewed-by: Radulescu Ruxandra Ioana-B05472 <ruxandra.radulescu@freescale.com>
Reviewed-by: Fleming Andrew-AFLEMING <AFLEMING@freescale.com>
Tested-by: Fleming Andrew-AFLEMING <AFLEMING@freescale.com>
---
 arch/powerpc/boot/dts/b4860qds-usdpaa-shared-interfaces.dts | 4 ++--
 arch/powerpc/boot/dts/b4860qds-usdpaa.dts                   | 2 +-
 arch/powerpc/boot/dts/p2041rdb-usdpaa-shared-interfaces.dts | 4 ++--
 arch/powerpc/boot/dts/p3041ds-usdpaa-shared-interfaces.dts  | 4 ++--
 arch/powerpc/boot/dts/p4080ds-usdpaa-shared-interfaces.dts  | 4 ++--
 arch/powerpc/boot/dts/p5020ds-usdpaa-shared-interfaces.dts  | 4 ++--
 arch/powerpc/boot/dts/p5040ds-usdpaa-shared-interfaces.dts  | 4 ++--
 arch/powerpc/boot/dts/t4240qds-usdpaa-shared-interfaces.dts | 4 ++--
 drivers/net/ethernet/freescale/dpa/dpaa_eth.c               | 4 +++-
 9 files changed, 18 insertions(+), 16 deletions(-)

diff --git a/arch/powerpc/boot/dts/b4860qds-usdpaa-shared-interfaces.dts b/arch/powerpc/boot/dts/b4860qds-usdpaa-shared-interfaces.dts
index cf4a46f..c71dd11 100644
--- a/arch/powerpc/boot/dts/b4860qds-usdpaa-shared-interfaces.dts
+++ b/arch/powerpc/boot/dts/b4860qds-usdpaa-shared-interfaces.dts
@@ -140,7 +140,7 @@
 		 * at this interface, the ethernet driver will do kmap_atomic/kunmap_atomic
 		 * for that frame. */
 		ethernet@9 {
-			compatible = "fsl,b4860-dpa-ethernet", "fsl,dpa-ethernet";
+			compatible = "fsl,b4860-dpa-ethernet-shared", "fsl,dpa-ethernet-shared";
 			fsl,bman-buffer-pools = <&bp17>;
 			fsl,qman-frame-queues-rx = <0x5e 1 0x5f 1 0x2000 3>;
 			fsl,qman-frame-queues-tx = <0 1 0 1 0x3000 8>;
@@ -152,7 +152,7 @@
                  * On receiving frame at this interface, the ethernet driver will do
                  * kmap_atomic/kunmap_atomic for that frame. */
                ethernet@16 {
-                        compatible = "fsl,b4860-dpa-ethernet", "fsl,dpa-ethernet";
+                        compatible = "fsl,b4860-dpa-ethernet-macless", "fsl,dpa-ethernet-macless";
                         fsl,bman-buffer-pools = <&bp16>;
                         fsl,qman-frame-queues-rx = <4000 8>;
                         fsl,qman-frame-queues-tx = <4008 8>;
diff --git a/arch/powerpc/boot/dts/b4860qds-usdpaa.dts b/arch/powerpc/boot/dts/b4860qds-usdpaa.dts
index f41ee5d..845e975 100644
--- a/arch/powerpc/boot/dts/b4860qds-usdpaa.dts
+++ b/arch/powerpc/boot/dts/b4860qds-usdpaa.dts
@@ -141,7 +141,7 @@
                  * On receiving frame at this interface, the ethernet driver will do
                  * kmap_atomic/kunmap_atomic for that frame. */
                ethernet@16 {
-                        compatible = "fsl,b4860-dpa-ethernet", "fsl,dpa-ethernet";
+                        compatible = "fsl,b4860-dpa-ethernet-macless", "fsl,dpa-ethernet-macless";
                         fsl,bman-buffer-pools = <&bp16>;
                         fsl,qman-frame-queues-rx = <4000 8>;
                         fsl,qman-frame-queues-tx = <4008 8>;
diff --git a/arch/powerpc/boot/dts/p2041rdb-usdpaa-shared-interfaces.dts b/arch/powerpc/boot/dts/p2041rdb-usdpaa-shared-interfaces.dts
index 8aeb65b..eb65344 100644
--- a/arch/powerpc/boot/dts/p2041rdb-usdpaa-shared-interfaces.dts
+++ b/arch/powerpc/boot/dts/p2041rdb-usdpaa-shared-interfaces.dts
@@ -111,7 +111,7 @@
 		 * at this interface, the ethernet driver will do kmap_atomic/kunmap_atomic
 		 * for that frame. */
 		ethernet@5 {
-			compatible = "fsl,p2041-dpa-ethernet", "fsl,dpa-ethernet";
+			compatible = "fsl,p2041-dpa-ethernet-shared", "fsl,dpa-ethernet-shared";
 			fsl,bman-buffer-pools = <&bp16>;
 			fsl,qman-frame-queues-rx = <0x5a 1 0x5b 1 0x2000 3>;
 			fsl,qman-frame-queues-tx = <0 1 0 1 0x3000 8>;
@@ -122,7 +122,7 @@
 		 * On receiving frame at this interface, the ethernet driver will do
 		 * kmap_atomic/kunmap_atomic for that frame. */
 		ethernet@6 {
-			compatible = "fsl,p2041-dpa-ethernet", "fsl,dpa-ethernet";
+			compatible = "fsl,p2041-dpa-ethernet-macless", "fsl,dpa-ethernet-macless";
 			fsl,bman-buffer-pools = <&bp17>;
 			fsl,qman-frame-queues-rx = <4000 8>;
 			fsl,qman-frame-queues-tx = <4008 8>;
diff --git a/arch/powerpc/boot/dts/p3041ds-usdpaa-shared-interfaces.dts b/arch/powerpc/boot/dts/p3041ds-usdpaa-shared-interfaces.dts
index 7b4005b..8bba94c 100644
--- a/arch/powerpc/boot/dts/p3041ds-usdpaa-shared-interfaces.dts
+++ b/arch/powerpc/boot/dts/p3041ds-usdpaa-shared-interfaces.dts
@@ -111,7 +111,7 @@
 		 * at this interface, the ethernet driver will do kmap_atomic/kunmap_atomic
 		 * for that frame. */
 		ethernet@5 {
-			compatible = "fsl,p3041-dpa-ethernet", "fsl,dpa-ethernet";
+			compatible = "fsl,p3041-dpa-ethernet-shared", "fsl,dpa-ethernet-shared";
 			fsl,bman-buffer-pools = <&bp16>;
 			fsl,qman-frame-queues-rx = <0x5a 1 0x5b 1 0x2000 3>;
 			fsl,qman-frame-queues-tx = <0 1 0 1 0x3000 8>;
@@ -122,7 +122,7 @@
 		 * On receiving frame at this interface, the ethernet driver will do
 		 * kmap_atomic/kunmap_atomic for that frame. */
 		ethernet@6 {
-			compatible = "fsl,p3041-dpa-ethernet", "fsl,dpa-ethernet";
+			compatible = "fsl,p3041-dpa-ethernet-macless", "fsl,dpa-ethernet-macless";
 			fsl,bman-buffer-pools = <&bp17>;
 			fsl,qman-frame-queues-rx = <4000 8>;
 			fsl,qman-frame-queues-tx = <4008 8>;
diff --git a/arch/powerpc/boot/dts/p4080ds-usdpaa-shared-interfaces.dts b/arch/powerpc/boot/dts/p4080ds-usdpaa-shared-interfaces.dts
index 65ad32a..91f4d73 100644
--- a/arch/powerpc/boot/dts/p4080ds-usdpaa-shared-interfaces.dts
+++ b/arch/powerpc/boot/dts/p4080ds-usdpaa-shared-interfaces.dts
@@ -133,7 +133,7 @@
 		 * at this interface, the ethernet driver will do kmap_atomic/kunmap_atomic
 		 * for that frame. */
 		ethernet@9 {
-			compatible = "fsl,p4080-dpa-ethernet", "fsl,dpa-ethernet";
+			compatible = "fsl,p4080-dpa-ethernet-shared", "fsl,dpa-ethernet-shared";
 			fsl,bman-buffer-pools = <&bp17>;
 			fsl,qman-frame-queues-rx = <0x66 1 0x67 1 0x2000 3>;
 			fsl,qman-frame-queues-tx = <0 1 0 1 0x3000 8>;
@@ -144,7 +144,7 @@
 		 * On receiving frame at this interface, the ethernet driver will do
 		 * kmap_atomic/kunmap_atomic for that frame. */
 		ethernet@16 {
-			compatible = "fsl,p4080-dpa-ethernet", "fsl,dpa-ethernet";
+			compatible = "fsl,p4080-dpa-ethernet-macless", "fsl,dpa-ethernet-macless";
 			fsl,bman-buffer-pools = <&bp16>;
 			fsl,qman-frame-queues-rx = <4000 8>;
 			fsl,qman-frame-queues-tx = <4008 8>;
diff --git a/arch/powerpc/boot/dts/p5020ds-usdpaa-shared-interfaces.dts b/arch/powerpc/boot/dts/p5020ds-usdpaa-shared-interfaces.dts
index 67c8ae8..188b0c1 100644
--- a/arch/powerpc/boot/dts/p5020ds-usdpaa-shared-interfaces.dts
+++ b/arch/powerpc/boot/dts/p5020ds-usdpaa-shared-interfaces.dts
@@ -111,7 +111,7 @@
 		 * at this interface, the ethernet driver will do kmap_atomic/kunmap_atomic
 		 * for that frame. */
 		ethernet@5 {
-			compatible = "fsl,p5020-dpa-ethernet", "fsl,dpa-ethernet";
+			compatible = "fsl,p5020-dpa-ethernet-shared", "fsl,dpa-ethernet-shared";
 			fsl,bman-buffer-pools = <&bp16>;
 			fsl,qman-frame-queues-rx = <0x5a 1 0x5b 1 0x2000 3>;
 			fsl,qman-frame-queues-tx = <0 1 0 1 0x3000 8>;
@@ -122,7 +122,7 @@
 		 * On receiving frame at this interface, the ethernet driver will do
 		 * kmap_atomic/kunmap_atomic for that frame. */
 		ethernet@6 {
-			compatible = "fsl,p5020-dpa-ethernet", "fsl,dpa-ethernet";
+			compatible = "fsl,p5020-dpa-ethernet-macless", "fsl,dpa-ethernet-macless";
 			fsl,bman-buffer-pools = <&bp17>;
 			fsl,qman-frame-queues-rx = <4000 8>;
 			fsl,qman-frame-queues-tx = <4008 8>;
diff --git a/arch/powerpc/boot/dts/p5040ds-usdpaa-shared-interfaces.dts b/arch/powerpc/boot/dts/p5040ds-usdpaa-shared-interfaces.dts
index 6981600..d4b0be3 100644
--- a/arch/powerpc/boot/dts/p5040ds-usdpaa-shared-interfaces.dts
+++ b/arch/powerpc/boot/dts/p5040ds-usdpaa-shared-interfaces.dts
@@ -123,7 +123,7 @@
 		 * at this interface, the ethernet driver will do kmap_atomic/kunmap_atomic
 		 * for that frame. */
 		ethernet@11 {
-			compatible = "fsl,p5040-dpa-ethernet", "fsl,dpa-ethernet";
+			compatible = "fsl,p5040-dpa-ethernet-shared", "fsl,dpa-ethernet-shared";
 			fsl,bman-buffer-pools = <&bp16>;
 			fsl,qman-frame-queues-rx = <0x66 1 0x67 1 0x2000 3>;
 			fsl,qman-frame-queues-tx = <0 1 0 1 0x3000 8>;
@@ -134,7 +134,7 @@
 		 * On receiving frame at this interface, the ethernet driver will do
 		 * kmap_atomic/kunmap_atomic for that frame. */
 		ethernet@16 {
-			compatible = "fsl,p5040-dpa-ethernet", "fsl,dpa-ethernet";
+			compatible = "fsl,p5040-dpa-ethernet-macless", "fsl,dpa-ethernet-macless";
 			fsl,bman-buffer-pools = <&bp17>;
 			fsl,qman-frame-queues-rx = <4000 8>;
 			fsl,qman-frame-queues-tx = <4008 8>;
diff --git a/arch/powerpc/boot/dts/t4240qds-usdpaa-shared-interfaces.dts b/arch/powerpc/boot/dts/t4240qds-usdpaa-shared-interfaces.dts
index 17c2b58..89d1979 100644
--- a/arch/powerpc/boot/dts/t4240qds-usdpaa-shared-interfaces.dts
+++ b/arch/powerpc/boot/dts/t4240qds-usdpaa-shared-interfaces.dts
@@ -127,7 +127,7 @@
 		 * at this interface, the ethernet driver will do kmap_atomic/kunmap_atomic
 		 * for that frame. */
 		ethernet@15 {
-			compatible = "fsl,t4240-dpa-ethernet", "fsl,dpa-ethernet";
+			compatible = "fsl,t4240-dpa-ethernet-shared", "fsl,dpa-ethernet-shared";
 			fsl,bman-buffer-pools = <&bp17>;
 			fsl,qman-frame-queues-rx = <0x6e 1 0x6f 1 0x2000 3>;
 			fsl,qman-frame-queues-tx = <0 1 0 1 0x3000 8>;
@@ -138,7 +138,7 @@
 		 * On receiving frame at this interface, the ethernet driver will do
 		 * kmap_atomic/kunmap_atomic for that frame. */
 		ethernet@16 {
-			compatible = "fsl,t4240-dpa-ethernet", "fsl,dpa-ethernet";
+			compatible = "fsl,t4240-dpa-ethernet-macless", "fsl,dpa-ethernet-macless";
 			fsl,bman-buffer-pools = <&bp16>;
 			fsl,qman-frame-queues-rx = <4000 8>;
 			fsl,qman-frame-queues-tx = <4008 8>;
diff --git a/drivers/net/ethernet/freescale/dpa/dpaa_eth.c b/drivers/net/ethernet/freescale/dpa/dpaa_eth.c
index 9a9cff6..2281ebcbf 100644
--- a/drivers/net/ethernet/freescale/dpa/dpaa_eth.c
+++ b/drivers/net/ethernet/freescale/dpa/dpaa_eth.c
@@ -4316,7 +4316,9 @@ dpaa_eth_proxy_probe(struct platform_device *_of_dev)
 
 static const struct of_device_id dpa_match[] = {
 	{
-		.compatible	= "fsl,dpa-ethernet"
+		.compatible	= "fsl,dpa-ethernet",
+		.compatible	= "fsl,dpa-ethernet-shared",
+		.compatible	= "fsl,dpa-ethernet-macless"
 	},
 	{}
 };
-- 
1.9.1

