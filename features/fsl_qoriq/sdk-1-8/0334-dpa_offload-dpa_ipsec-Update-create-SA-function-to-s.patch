From 7317b2596cbec9f04a0ea814fc08d6b38a84f142 Mon Sep 17 00:00:00 2001
From: Andrei Varvara <andrei.varvara@freescale.com>
Date: Thu, 18 Jul 2013 16:06:26 +0300
Subject: [PATCH 334/987] dpa_offload: dpa_ipsec - Update create SA function to
 set hmd to invalid

[Original patch taken from QorIQ-SDK-V1.6-SOURCE-20140619-yocto.iso]

DPA Classifier API was updated by adding a new attribute (hmd)
to the struct dpa_cls_tbl_next_table_desc.

DPA IPSec is using the classifier feature for linking two tables,
if inbound policy verification is required but does not require
the hmd option.

A minor update had to be made to set the hdm
to -1 (not valid) otherwise the 0 value would have been concidered
valid by classifier and crash since not hmd is required here.

Signed-off-by: Andrei Varvara <andrei.varvara@freescale.com>
Change-Id: I76eccbf6a60b7d563540de539be5144112c1567c
Reviewed-on: http://git.am.freescale.net:8181/3474
Tested-by: Review Code-CDREVIEW <CDREVIEW@freescale.com>
Reviewed-by: Fleming Andrew-AFLEMING <AFLEMING@freescale.com>
---
 drivers/staging/fsl_dpa_offload/dpa_ipsec.c | 1 +
 1 file changed, 1 insertion(+)

diff --git a/drivers/staging/fsl_dpa_offload/dpa_ipsec.c b/drivers/staging/fsl_dpa_offload/dpa_ipsec.c
index 63f067f..797bee5 100644
--- a/drivers/staging/fsl_dpa_offload/dpa_ipsec.c
+++ b/drivers/staging/fsl_dpa_offload/dpa_ipsec.c
@@ -3439,6 +3439,7 @@ int dpa_ipsec_create_sa(int dpa_ipsec_id,
 			memset(&action, 0, sizeof(action));
 			action.type = DPA_CLS_TBL_ACTION_NEXT_TABLE;
 			action.next_table_params.next_td = inbpol_td;
+			action.next_table_params.hmd = DPA_OFFLD_DESC_NONE;
 			action.enable_statistics = FALSE;
 			err = set_flow_id_action(sa, &action);
 			if (err < 0) {
-- 
1.9.1

