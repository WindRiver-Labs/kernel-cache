From 49ba5759d4d472020954d1b019c2d1c60aa8aa2b Mon Sep 17 00:00:00 2001
From: Marian Chereji <marian.chereji@freescale.com>
Date: Tue, 4 Nov 2014 12:46:31 +0200
Subject: [PATCH 828/987] dpa_offload: Avoid double free of replicator group
 params in case of error

In dpa_classifier function "dpa_classif_mcast_create_group" the replicator
group params could be freed twice if the function "FM_PCD_FrmReplicSetGroup"
fails, for instance. The pointer is now reset at first free so that the second
free operation ignores it.

Change-Id: I8869db05157f68964bd2a131f6e184f78e64cf8c
Signed-off-by: Marian Chereji <marian.chereji@freescale.com>
Reviewed-on: http://git.am.freescale.net:8181/23108
Tested-by: Review Code-CDREVIEW <CDREVIEW@freescale.com>
Reviewed-by: Radu-Andrei Bulie <Radu.Bulie@freescale.com>
Reviewed-by: Richard Schmitt <richard.schmitt@freescale.com>
[Lu:Original patch taken from
QorIQ-SDK-V1.7-SOURCE-20141218-yocto.iso]
Signed-off-by: Jiang Lu <lu.jiang@windriver.com>
---
 drivers/staging/fsl_dpa_offload/dpa_classifier.c | 1 +
 1 file changed, 1 insertion(+)

diff --git a/drivers/staging/fsl_dpa_offload/dpa_classifier.c b/drivers/staging/fsl_dpa_offload/dpa_classifier.c
index 65bc333..20b0143 100644
--- a/drivers/staging/fsl_dpa_offload/dpa_classifier.c
+++ b/drivers/staging/fsl_dpa_offload/dpa_classifier.c
@@ -7972,6 +7972,7 @@ int dpa_classif_mcast_create_group(
 	}
 
 	kfree(replic_grp_params);
+	replic_grp_params = NULL;
 
 	if (!pgroup->group) {
 		log_err("Could not create %s group %d\n",
-- 
1.9.1

