From ee14a7e240ac49db4900f36a88d310fb7e30952d Mon Sep 17 00:00:00 2001
From: Wang Quanyang <quanyang.wang@windriver.com>
Date: Thu, 8 Oct 2015 04:16:15 -0400
Subject: [PATCH 987/988] fsl_eth: replace __get_cpu_var with this_cpu_ptr in
 module qman-test

According to the upstream commit 69111bac42f5
("powerpc: Replace __get_cpu_var uses"), use this_cpu_ptr
instead of __get_cpu_var, or else we will get a compile error
as below:

drivers/staging/fsl_qbman/qman_test_hotpotato.c:276:27: error: implicit declaration of function '__get_cpu_var' [-Werror=implicit-function-declaration]
  struct hp_cpu *hp_cpu = &__get_cpu_var(hp_cpus);
                           ^
drivers/staging/fsl_qbman/qman_test_hotpotato.c:276:26: error: lvalue required as unary '&' operand
  struct hp_cpu *hp_cpu = &__get_cpu_var(hp_cpus);

Signed-off-by: Quanyang Wang <quanyang.wang@windriver.com>
---
 drivers/staging/fsl_qbman/qman_test_hotpotato.c | 4 ++--
 1 file changed, 2 insertions(+), 2 deletions(-)

diff --git a/drivers/staging/fsl_qbman/qman_test_hotpotato.c b/drivers/staging/fsl_qbman/qman_test_hotpotato.c
index 05db7ee..85495da 100644
--- a/drivers/staging/fsl_qbman/qman_test_hotpotato.c
+++ b/drivers/staging/fsl_qbman/qman_test_hotpotato.c
@@ -273,7 +273,7 @@ static void create_per_cpu_handlers(void)
 {
 	struct hp_handler *handler;
 	int loop;
-	struct hp_cpu *hp_cpu = &__get_cpu_var(hp_cpus);
+	struct hp_cpu *hp_cpu = this_cpu_ptr(&hp_cpus);
 
 	hp_cpu->processor_id = smp_processor_id();
 	spin_lock(&hp_lock);
@@ -295,7 +295,7 @@ static void create_per_cpu_handlers(void)
 static void destroy_per_cpu_handlers(void)
 {
 	struct list_head *loop, *tmp;
-	struct hp_cpu *hp_cpu = &__get_cpu_var(hp_cpus);
+	struct hp_cpu *hp_cpu = this_cpu_ptr(&hp_cpus);
 
 	spin_lock(&hp_lock);
 	list_del(&hp_cpu->node);
-- 
2.0.2

