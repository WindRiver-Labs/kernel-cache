From f68ca4c199407bc2dbd2148a8159a3390eb021fa Mon Sep 17 00:00:00 2001
From: Cristian Bercaru <cristian.bercaru@freescale.com>
Date: Tue, 14 May 2013 17:46:05 +0300
Subject: [PATCH 158/987] dpaa_eth: fix ethtool pause frame issue on tx

[Original patch taken from QorIQ-SDK-V1.6-SOURCE-20140619-yocto.iso]

Fixed issue introduced in
"dpaa_eth: add ethtool PAUSE frame support"
Passing proper 'priority' value to 'FM_MAC_SetTxPauseFrames'.

Signed-off-by: Cristian Bercaru <cristian.bercaru@freescale.com>
Change-Id: Ib4f67e4147c410cafdb26b8e741c0f15af51a08a
Reviewed-on: http://git.am.freescale.net:8181/2483
Reviewed-by: Bucur Madalin-Cristian-B32716 <madalin.bucur@freescale.com>
Reviewed-by: Fleming Andrew-AFLEMING <AFLEMING@freescale.com>
Tested-by: Fleming Andrew-AFLEMING <AFLEMING@freescale.com>
---
 drivers/net/ethernet/freescale/dpa/mac-api.c | 4 ++--
 drivers/net/ethernet/freescale/dpa/mac.h     | 3 +--
 2 files changed, 3 insertions(+), 4 deletions(-)

diff --git a/drivers/net/ethernet/freescale/dpa/mac-api.c b/drivers/net/ethernet/freescale/dpa/mac-api.c
index 700e10e..b43687f 100644
--- a/drivers/net/ethernet/freescale/dpa/mac-api.c
+++ b/drivers/net/ethernet/freescale/dpa/mac-api.c
@@ -649,13 +649,13 @@ static int __cold set_tx_pause(struct mac_device *mac_dev, bool en)
 	if (en)
 		err = FM_MAC_SetTxPauseFrames(
 				((struct mac_priv_s *)macdev_priv(mac_dev))->mac,
-				TX_PAUSE_PRIO_ENABLE,
+				TX_PAUSE_PRIO_DEFAULT,
 				TX_PAUSE_TIME_ENABLE,
 				TX_PAUSE_THRESH_DEFAULT);
 	else
 		err = FM_MAC_SetTxPauseFrames(
 				((struct mac_priv_s *)macdev_priv(mac_dev))->mac,
-				TX_PAUSE_PRIO_DISABLE,
+				TX_PAUSE_PRIO_DEFAULT,
 				TX_PAUSE_TIME_DISABLE,
 				TX_PAUSE_THRESH_DEFAULT);
 
diff --git a/drivers/net/ethernet/freescale/dpa/mac.h b/drivers/net/ethernet/freescale/dpa/mac.h
index 87c21c4..7025ea7 100644
--- a/drivers/net/ethernet/freescale/dpa/mac.h
+++ b/drivers/net/ethernet/freescale/dpa/mac.h
@@ -113,8 +113,7 @@ extern const char	*mac_driver_description;
 extern const size_t	 mac_sizeof_priv[];
 extern void (*const mac_setup[])(struct mac_device *mac_dev);
 
-#define TX_PAUSE_PRIO_ENABLE 0
-#define TX_PAUSE_PRIO_DISABLE 0xff
+#define TX_PAUSE_PRIO_DEFAULT 0xff
 #define TX_PAUSE_TIME_ENABLE 0xf000
 #define TX_PAUSE_TIME_DISABLE 0
 #define TX_PAUSE_THRESH_DEFAULT 0
-- 
1.9.1

