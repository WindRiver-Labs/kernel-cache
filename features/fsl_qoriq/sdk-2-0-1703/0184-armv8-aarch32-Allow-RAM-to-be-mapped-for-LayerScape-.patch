From 475e42b68a1dd9d63bee771de3ed536381c431da Mon Sep 17 00:00:00 2001
From: Alison Wang <b18965@freescale.com>
Date: Wed, 7 Dec 2016 14:56:13 +0800
Subject: [PATCH 184/388] armv8: aarch32: Allow RAM to be mapped for LayerScape
 SoC

This patch is based on Kernel v4.1. As in v4.1, memremap() is not
introduced and the WARN() check is not relaxed to allow MT_MEMORY_RW
mappings of pfn_valid() pages, this patch is needed as a workaround
for the current problem.

For the latest kernel in upstream, this patch is not needed anymore.

Signed-off-by: Alison Wang <alison.wang@nxp.com>
[Original patch taken from SDK-V2.0-1703]
Signed-off-by: Yanjiang Jin <yanjiang.jin@windriver.com>
---
 arch/arm/mm/ioremap.c | 2 ++
 1 file changed, 2 insertions(+)

diff --git a/arch/arm/mm/ioremap.c b/arch/arm/mm/ioremap.c
index d1e5ad7..b7fa69b 100644
--- a/arch/arm/mm/ioremap.c
+++ b/arch/arm/mm/ioremap.c
@@ -298,8 +298,10 @@ void __iomem * __arm_ioremap_pfn_caller(unsigned long pfn,
 	/*
 	 * Don't allow RAM to be mapped - this causes problems with ARMv6+
 	 */
+#ifndef CONFIG_ARCH_MXC
 	if (WARN_ON(pfn_valid(pfn)))
 		return NULL;
+#endif
 
 	area = get_vm_area_caller(size, VM_IOREMAP, caller);
  	if (!area)
-- 
2.9.3

