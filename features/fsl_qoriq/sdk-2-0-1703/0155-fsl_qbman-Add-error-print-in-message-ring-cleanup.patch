From caa96050cb332bc7b8935703fd567512d00ec9f1 Mon Sep 17 00:00:00 2001
From: Ahmed Mansour <Ahmed.Mansour@nxp.com>
Date: Mon, 30 May 2016 17:56:30 -0400
Subject: [PATCH 155/388] fsl_qbman: Add error print in message ring cleanup

Added a printout if one of the messages on the message ring is not the
expected type of message. In this case we only expect fqrni messages

JIRA issue#: QLINUX-5370

Signed-off-by: Ahmed Mansour <Ahmed.Mansour@nxp.com>
[Original patch taken from SDK-V2.0-1703]
Signed-off-by: Yanjiang Jin <yanjiang.jin@windriver.com>
---
 drivers/staging/fsl_qbman/qman_high.c | 5 +++++
 1 file changed, 5 insertions(+)

diff --git a/drivers/staging/fsl_qbman/qman_high.c b/drivers/staging/fsl_qbman/qman_high.c
index fe4e326..235e8b9 100644
--- a/drivers/staging/fsl_qbman/qman_high.c
+++ b/drivers/staging/fsl_qbman/qman_high.c
@@ -514,6 +514,11 @@ loop:
 		if (!msg)
 			return 0;
 	}
+	if ((msg->verb & QM_MR_VERB_TYPE_MASK) != QM_MR_VERB_FQRNI) {
+		/* We aren't draining anything but FQRNIs */
+		pr_err("QMan found verb 0x%x in MR\n", msg->verb);
+		return -1;
+	}
 	qm_mr_next(p);
 	qm_mr_cci_consume(p, 1);
 	goto loop;
-- 
2.9.3

