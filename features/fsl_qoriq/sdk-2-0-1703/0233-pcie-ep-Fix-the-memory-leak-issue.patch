From 4e418a0400e823123cb3edd516e4e4db4ee2a5d1 Mon Sep 17 00:00:00 2001
From: Liu Gang <Gang.Liu@nxp.com>
Date: Fri, 6 Jan 2017 14:49:48 +0800
Subject: [PATCH 233/388] pcie-ep: Fix the memory leak issue

Add the memory free step to avoid the memory leak issue.

Signed-off-by: Liu Gang <Gang.Liu@nxp.com>
[Original patch taken from SDK-V2.0-1703]
Signed-off-by: Yanjiang Jin <yanjiang.jin@windriver.com>
---
 drivers/pci/host/pci-layerscape-ep-debugfs.c | 1 +
 1 file changed, 1 insertion(+)

diff --git a/drivers/pci/host/pci-layerscape-ep-debugfs.c b/drivers/pci/host/pci-layerscape-ep-debugfs.c
index 88a3308..5f4870b 100644
--- a/drivers/pci/host/pci-layerscape-ep-debugfs.c
+++ b/drivers/pci/host/pci-layerscape-ep-debugfs.c
@@ -679,6 +679,7 @@ static ssize_t ls_pcie_ep_dbg_dump_read(struct file *filp,
 
 	if (!test) {
 		dev_info(&ep->dev, " there is NO test\n");
+		kfree(buf);
 		return 0;
 	}
 
-- 
2.9.3

