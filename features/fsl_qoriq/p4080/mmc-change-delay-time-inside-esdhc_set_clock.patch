From abbf30c02de1485921c35d5cf61f63f04d928e78 Mon Sep 17 00:00:00 2001
From: Tiejun Chen <tiejun.chen@windriver.com>
Date: Thu, 13 Sep 2012 15:05:40 +0800
Subject: [PATCH 14/14] mmc: change delay time inside esdhc_set_clock()

This should be squashed into commit"

    mmc: Use mmc_delay() instead of mdelay() for time delay

mmc_delay may sleep but esdhc_set_clock() is called in many mmc host
common hook functions between spin_lock_save()/spin_unlock_irqrestore(),
so the original mmc_delay(1) will trigger that known call trace because
of msleep() with interrupt context.

So move mmc_delay(1) to mdelay(1) to avoid this with an appropriate time slot.

Signed-off-by: Tiejun Chen <tiejun.chen@windriver.com>
---
 drivers/mmc/host/sdhci-esdhc.h |    2 +-
 1 file changed, 1 insertion(+), 1 deletion(-)

diff --git a/drivers/mmc/host/sdhci-esdhc.h b/drivers/mmc/host/sdhci-esdhc.h
index 37d261b..5858ddb 100644
--- a/drivers/mmc/host/sdhci-esdhc.h
+++ b/drivers/mmc/host/sdhci-esdhc.h
@@ -74,7 +74,7 @@ static inline void esdhc_set_clock(struct sdhci_host *host, unsigned int clock)
 		| (div << ESDHC_DIVIDER_SHIFT)
 		| (pre_div << ESDHC_PREDIV_SHIFT));
 	sdhci_writel(host, temp, ESDHC_SYSTEM_CONTROL);
-	mmc_delay(1);
+	mdelay(1);
 out:
 	host->clock = clock;
 }
-- 
1.7.9.7

