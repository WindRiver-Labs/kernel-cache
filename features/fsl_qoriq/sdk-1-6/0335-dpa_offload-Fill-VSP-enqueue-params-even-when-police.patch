From dd11dae74f02d4687bbea036243bfcc7cfb04ff4 Mon Sep 17 00:00:00 2001
From: Marian Chereji <marian.chereji@freescale.com>
Date: Wed, 14 May 2014 00:31:48 +0300
Subject: [PATCH 335/466] dpa_offload: Fill VSP enqueue params even when
 policer is not enabled

The dpa_classifier was filling in the VSP profile Id only when policer
parameters were specified for the classification entry. VSP profile
parameters must not depend on the policer parameters.

Signed-off-by: Francois Massot-Pellet <francois.massot-pellet@freescale.com>
Signed-off-by: Sebastian Grigore <sebastian.grigore@freescale.com>
Signed-off-by: Marian Chereji <marian.chereji@freescale.com>
Change-Id: Ide4a26c8cc8fa8d7f85b2212a89816c51e01d19a
Reviewed-on: http://git.am.freescale.net:8181/12301
Tested-by: Review Code-CDREVIEW <CDREVIEW@freescale.com>
Reviewed-by: Jose Rivera <German.Rivera@freescale.com>
[Original patch taken from QorIQ-SDK-V1.6-SOURCE-20140619-yocto.iso]
Signed-off-by: Bin Jiang <bin.jiang@windriver.com>
---
 drivers/staging/fsl_dpa_offload/dpa_classifier.c |    8 ++++----
 1 file changed, 4 insertions(+), 4 deletions(-)

diff --git a/drivers/staging/fsl_dpa_offload/dpa_classifier.c b/drivers/staging/fsl_dpa_offload/dpa_classifier.c
index 996ce82..224474f 100644
--- a/drivers/staging/fsl_dpa_offload/dpa_classifier.c
+++ b/drivers/staging/fsl_dpa_offload/dpa_classifier.c
@@ -3097,12 +3097,12 @@ static int action_to_next_engine_params(const struct dpa_cls_tbl_action *action,
 					next_engine_params->params.
 						enqueueParams.overrideFqid =
 						TRUE;
+			}
 #if (DPAA_VERSION >= 11)
-				next_engine_params->params.enqueueParams.
-					  newRelativeStorageProfileId =
-					      action->enq_params.new_rel_vsp_id;
+			next_engine_params->params.enqueueParams.
+				  newRelativeStorageProfileId =
+				      action->enq_params.new_rel_vsp_id;
 #endif
-			}
 		}
 
 		if (action->enq_params.hmd != DPA_OFFLD_DESC_NONE) {
-- 
1.7.10.4

