From e69d52ed14e5f0a0e29610a4de30a9f019fa09cd Mon Sep 17 00:00:00 2001
From: Emil Medve <Emilian.Medve@Freescale.com>
Date: Fri, 17 Jan 2014 10:35:39 -0600
Subject: [PATCH 078/466] fsl_qbman: Check kmalloc() result

This fixes the following coccinelle warning:

alloc with no test

Signed-off-by: Emil Medve <Emilian.Medve@Freescale.com>
Change-Id: I573f5fb75cc8b88336bf96e18464730dd8c79686
Reviewed-on: http://git.am.freescale.net:8181/8107
Tested-by: Review Code-CDREVIEW <CDREVIEW@freescale.com>
Reviewed-by: Haiying Wang <Haiying.Wang@freescale.com>
Reviewed-by: Emilian Medve <Emilian.Medve@freescale.com>
[Original patch taken from QorIQ-SDK-V1.6-SOURCE-20140619-yocto.iso]
Signed-off-by: Bin Jiang <bin.jiang@windriver.com>
---
 drivers/staging/fsl_qbman/bman_high.c |    2 ++
 drivers/staging/fsl_qbman/qman_high.c |    2 ++
 2 files changed, 4 insertions(+)

diff --git a/drivers/staging/fsl_qbman/bman_high.c b/drivers/staging/fsl_qbman/bman_high.c
index 593b624..5f05db8 100644
--- a/drivers/staging/fsl_qbman/bman_high.c
+++ b/drivers/staging/fsl_qbman/bman_high.c
@@ -205,6 +205,8 @@ struct bman_portal *bman_create_portal(
 
 	if (!portal) {
 		portal = kmalloc(sizeof(*portal), GFP_KERNEL);
+		if (!portal)
+			return portal;
 		portal->alloced = 1;
 	} else
 		portal->alloced = 0;
diff --git a/drivers/staging/fsl_qbman/qman_high.c b/drivers/staging/fsl_qbman/qman_high.c
index 0e0e23a..496018c 100644
--- a/drivers/staging/fsl_qbman/qman_high.c
+++ b/drivers/staging/fsl_qbman/qman_high.c
@@ -398,6 +398,8 @@ struct qman_portal *qman_create_portal(
 
 	if (!portal) {
 		portal = kmalloc(sizeof(*portal), GFP_KERNEL);
+		if (!portal)
+			return portal;
 		portal->alloced = 1;
 	} else
 		portal->alloced = 0;
-- 
1.7.10.4

