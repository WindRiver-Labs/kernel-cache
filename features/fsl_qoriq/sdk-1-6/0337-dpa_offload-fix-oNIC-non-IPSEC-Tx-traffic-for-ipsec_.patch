From 6d617fe76a7bf5310a3a1b8b6881d0089afa158b Mon Sep 17 00:00:00 2001
From: Ioana Tibuleac <ioana.tibuleac@freescale.com>
Date: Wed, 14 May 2014 12:46:45 +0300
Subject: [PATCH 337/466] dpa_offload: fix oNIC non-IPSEC Tx traffic for
 ipsec_offload

add dts attribute that prevents the pre-SEC OH port to free buffers
when used with an oNIC node

Signed-off-by: Ioana Tibuleac <ioana.tibuleac@freescale.com>
Change-Id: I0d0c4f67973e2661855ed6d30a1d1bea3311f983
Reviewed-on: http://git.am.freescale.net:8181/12333
Reviewed-by: Marian Cristian Rotariu <marian.rotariu@freescale.com>
Tested-by: Review Code-CDREVIEW <CDREVIEW@freescale.com>
Reviewed-by: Jose Rivera <German.Rivera@freescale.com>
[Original patch taken from QorIQ-SDK-V1.6-SOURCE-20140619-yocto.iso]
Signed-off-by: Bin Jiang <bin.jiang@windriver.com>
---
 .../staging/fsl_dpa_offload/dts/b4420qds-usdpaa-shared-interfaces.dts |    1 +
 .../staging/fsl_dpa_offload/dts/b4860qds-usdpaa-shared-interfaces.dts |    1 +
 .../staging/fsl_dpa_offload/dts/t4240qds-usdpaa-shared-interfaces.dts |    1 +
 3 files changed, 3 insertions(+)

diff --git a/drivers/staging/fsl_dpa_offload/dts/b4420qds-usdpaa-shared-interfaces.dts b/drivers/staging/fsl_dpa_offload/dts/b4420qds-usdpaa-shared-interfaces.dts
index c26caa0..3eafae2 100644
--- a/drivers/staging/fsl_dpa_offload/dts/b4420qds-usdpaa-shared-interfaces.dts
+++ b/drivers/staging/fsl_dpa_offload/dts/b4420qds-usdpaa-shared-interfaces.dts
@@ -148,6 +148,7 @@
 			fsl,qman-frame-queues-rx = <7000 2>;
 			fsl,qman-frame-queues-tx = <7008 1>;
 			fsl,oh-ports = <&oh2 &oh3>;
+			fsl,disable_buff_dealloc;
 			local-mac-address = [00 11 22 33 44 88];
 		};
 
diff --git a/drivers/staging/fsl_dpa_offload/dts/b4860qds-usdpaa-shared-interfaces.dts b/drivers/staging/fsl_dpa_offload/dts/b4860qds-usdpaa-shared-interfaces.dts
index 84f66c2..4c2694f 100644
--- a/drivers/staging/fsl_dpa_offload/dts/b4860qds-usdpaa-shared-interfaces.dts
+++ b/drivers/staging/fsl_dpa_offload/dts/b4860qds-usdpaa-shared-interfaces.dts
@@ -160,6 +160,7 @@
 			fsl,qman-frame-queues-rx = <7000 2>;
 			fsl,qman-frame-queues-tx = <7008 1>;
 			fsl,oh-ports = <&oh2 &oh3>;
+			fsl,disable_buff_dealloc;
 			local-mac-address = [00 11 22 33 44 88];
 		};
 
diff --git a/drivers/staging/fsl_dpa_offload/dts/t4240qds-usdpaa-shared-interfaces.dts b/drivers/staging/fsl_dpa_offload/dts/t4240qds-usdpaa-shared-interfaces.dts
index a1549b4..54dc5ce 100644
--- a/drivers/staging/fsl_dpa_offload/dts/t4240qds-usdpaa-shared-interfaces.dts
+++ b/drivers/staging/fsl_dpa_offload/dts/t4240qds-usdpaa-shared-interfaces.dts
@@ -170,6 +170,7 @@
 			fsl,qman-frame-queues-rx = <7000 2>;
 			fsl,qman-frame-queues-tx = <7008 1>;
 			fsl,oh-ports = <&dpa_fman0_oh2 &dpa_fman0_oh3>;
+			fsl,disable_buff_dealloc;
 			local-mac-address = [00 11 22 33 44 88];
 		};
 
-- 
1.7.10.4

