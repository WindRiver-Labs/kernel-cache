From a3b1d9c56c9ef10e2f966845e35cbd25aaff038f Mon Sep 17 00:00:00 2001
From: Xuelin Shi <xuelin.shi@freescale.com>
Date: Mon, 12 May 2014 10:28:35 +0800
Subject: [PATCH 1009/1089] dma: fix oom issue.

[Original patch taken from QorIQ-SDK-V1.6-SOURCE-20140619-yocto.iso]

missing unmap sources and destinations while doing dequeue.

Signed-off-by: Xuelin Shi <xuelin.shi@freescale.com>
Change-Id: Ibf51682e6d2db57f00adb2bacab3d2b6d44690e0
Reviewed-on: http://git.am.freescale.net:8181/12191
Tested-by: Review Code-CDREVIEW <CDREVIEW@freescale.com>
Reviewed-by: Yang Li <LeoLi@freescale.com>
Reviewed-by: Jose Rivera <German.Rivera@freescale.com>
---
 drivers/dma/fsldma.c | 2 ++
 1 file changed, 2 insertions(+)

diff --git a/drivers/dma/fsldma.c b/drivers/dma/fsldma.c
index d5d6885..8a82e67 100644
--- a/drivers/dma/fsldma.c
+++ b/drivers/dma/fsldma.c
@@ -510,6 +510,8 @@ static dma_cookie_t fsldma_run_tx_complete_actions(struct fsldma_chan *chan,
 		}
 	}
 
+	dma_descriptor_unmap(txd);
+
 	/* Run any dependencies */
 	dma_run_dependencies(txd);
 
-- 
2.0.2

