From 238408871f5b3625ded7ad84d199172c5597db97 Mon Sep 17 00:00:00 2001
From: Zhao Chenhui <chenhui.zhao@freescale.com>
Date: Thu, 29 Nov 2012 18:50:29 +0800
Subject: [PATCH 0042/1089] powerpc/85xx: fix compile error when
 CONFIG_HOTPLUG_CPU is disabled

[Original patch taken from QorIQ-SDK-V1.6-SOURCE-20140619-yocto.iso]

../arch/powerpc/platforms/85xx/smp.c:306:4:
error: implicit declaration of function 'generic_set_cpu_up'
../arch/powerpc/platforms/85xx/smp.c:321:4:
error: implicit declaration of function 'is_core_down'
make[3]: *** [arch/powerpc/platforms/85xx/smp.o] Error 1

Signed-off-by: Zhao Chenhui <chenhui.zhao@freescale.com>
Signed-off-by: Andy Fleming <afleming@freescale.com>
Change-Id: I55145d1acf2a2710bc544c09b49492039bff1968
Reviewed-on: http://git.am.freescale.net:8181/564
Reviewed-by: Fleming Andrew-AFLEMING <AFLEMING@freescale.com>
Tested-by: Fleming Andrew-AFLEMING <AFLEMING@freescale.com>
---
 arch/powerpc/include/asm/smp.h    | 2 +-
 arch/powerpc/platforms/85xx/smp.c | 2 ++
 2 files changed, 3 insertions(+), 1 deletion(-)

diff --git a/arch/powerpc/include/asm/smp.h b/arch/powerpc/include/asm/smp.h
index 571fa83..ee7e58d 100644
--- a/arch/powerpc/include/asm/smp.h
+++ b/arch/powerpc/include/asm/smp.h
@@ -76,7 +76,7 @@ extern void uninhibit_secondary_onlining(void);
 #else /* HOTPLUG_CPU */
 static inline void inhibit_secondary_onlining(void) {}
 static inline void uninhibit_secondary_onlining(void) {}
-
+#define generic_set_cpu_up(cpu) do { } while (0)
 #endif
 
 #ifdef CONFIG_PPC64
diff --git a/arch/powerpc/platforms/85xx/smp.c b/arch/powerpc/platforms/85xx/smp.c
index ae040ae..dbc0b16 100644
--- a/arch/powerpc/platforms/85xx/smp.c
+++ b/arch/powerpc/platforms/85xx/smp.c
@@ -343,6 +343,7 @@ static int smp_85xx_kick_cpu(int nr)
 		}
 	}
 
+#ifdef CONFIG_HOTPLUG_CPU
 	/* Starting Thread 0 will reset core, so put both threads down first */
 	if (smt_capable() && system_state == SYSTEM_RUNNING &&
 			cpu_thread_in_core(nr) == 0 && !is_core_down(nr)) {
@@ -351,6 +352,7 @@ static int smp_85xx_kick_cpu(int nr)
 			return -ENOENT;
 	}
 #endif
+#endif
 
 	np = of_get_cpu_node(nr, NULL);
 	cpu_rel_addr = of_get_property(np, "cpu-release-addr", NULL);
-- 
2.0.2

