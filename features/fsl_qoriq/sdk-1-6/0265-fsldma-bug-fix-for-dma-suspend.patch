From 51e8a83cf7f5b7a64ae79160b6cd0ac64faad9b0 Mon Sep 17 00:00:00 2001
From: Hongbo Zhang <hongbo.zhang@freescale.com>
Date: Thu, 10 Apr 2014 14:18:22 +0800
Subject: [PATCH 265/466] fsldma: bug fix for dma suspend

During the suspend process, DMA channels are suspended one by one, if one
channel cannot be suspended, all the former channels which have been suspended
should be restored, i.e. mark the pm_state as running, and release the spin
locks aquired.
This patch adds the "pm_state = RUNNING" which was omitted in the original
suspend patch.

Signed-off-by: Hongbo Zhang <hongbo.zhang@freescale.com>
Change-Id: I924af3384d58d03f6321cb02c28a702367ea6bc1
Reviewed-on: http://git.am.freescale.net:8181/10871
Tested-by: Review Code-CDREVIEW <CDREVIEW@freescale.com>
Reviewed-by: Yang Li <LeoLi@freescale.com>
Reviewed-by: Jeffrey Ladouceur <Jeffrey.Ladouceur@freescale.com>
Reviewed-by: Jose Rivera <German.Rivera@freescale.com>
[Original patch taken from QorIQ-SDK-V1.6-SOURCE-20140619-yocto.iso]
Signed-off-by: Bin Jiang <bin.jiang@windriver.com>
---
 drivers/dma/fsldma.c |    1 +
 1 file changed, 1 insertion(+)

diff --git a/drivers/dma/fsldma.c b/drivers/dma/fsldma.c
index 1c6b209..6a731d1 100644
--- a/drivers/dma/fsldma.c
+++ b/drivers/dma/fsldma.c
@@ -1548,6 +1548,7 @@ out:
 		chan = fdev->chan[i];
 		if (!chan)
 			continue;
+		chan->pm_state = RUNNING;
 		spin_unlock_bh(&chan->desc_lock);
 	}
 	return -EBUSY;
-- 
1.7.10.4

