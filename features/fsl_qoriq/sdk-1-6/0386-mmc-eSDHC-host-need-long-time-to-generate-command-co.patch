From 9da4b39506b2e778eb5e2e349b2ac5aa195f7a2c Mon Sep 17 00:00:00 2001
From: Yangbo Lu <yangbo.lu@freescale.com>
Date: Mon, 9 Jun 2014 15:33:53 +0800
Subject: [PATCH 386/466] mmc/eSDHC: host need long time to generate command
 complete interrupt

According to Spec 2.0, command complete interrupt will be generate
within 150 SD-CLK. But this was not long enough for T1040 board.
So add quirk SDHCI_QUIRK2_LONG_TIME_CMD_COMPLETE_IRQ
to enlarge this detect time to avoid hardware timeout error.

Signed-off-by: Wujie Qiu <B49553@freescale.com>
Signed-off-by: Yangbo Lu <yangbo.lu@freescale.com>
Change-Id: Ia850b3fb707824c65f57511943ec0c91f78d9899
Reviewed-on: http://git.am.freescale.net:8181/13438
Tested-by: Review Code-CDREVIEW <CDREVIEW@freescale.com>
Reviewed-by: Xiaobo Xie <X.Xie@freescale.com>
Reviewed-by: Zhenhua Luo <zhenhua.luo@freescale.com>
Tested-by: Zhenhua Luo <zhenhua.luo@freescale.com>
[Original patch taken from QorIQ-SDK-V1.6-SOURCE-20140619-yocto.iso]
Signed-off-by: Bin Jiang <bin.jiang@windriver.com>
---
 drivers/mmc/host/sdhci-pltfm.c |    3 ++-
 1 file changed, 2 insertions(+), 1 deletion(-)

diff --git a/drivers/mmc/host/sdhci-pltfm.c b/drivers/mmc/host/sdhci-pltfm.c
index 1b5ce1d..22c453a 100644
--- a/drivers/mmc/host/sdhci-pltfm.c
+++ b/drivers/mmc/host/sdhci-pltfm.c
@@ -105,7 +105,8 @@ void sdhci_get_of_property(struct platform_device *pdev)
 		}
 
 		if (of_device_is_compatible(np, "fsl,p5020-esdhc") ||
-			of_device_is_compatible(np, "fsl,p5040-esdhc"))
+			of_device_is_compatible(np, "fsl,p5040-esdhc") ||
+			of_device_is_compatible(np, "fsl,t1040-esdhc"))
 			host->quirks2 |= SDHCI_QUIRK2_LONG_TIME_CMD_COMPLETE_IRQ;
 
 		if (of_device_is_compatible(np, "fsl,p5040-esdhc") ||
-- 
1.7.10.4

