From 86def54ef8a75978d1527cafecbc9a6c276b51a8 Mon Sep 17 00:00:00 2001
From: Marian Rotariu <marian.rotariu@freescale.com>
Date: Thu, 19 Sep 2013 11:10:54 +0300
Subject: [PATCH 0536/1089] dpaa_eth: Show all created buffers in sysfs

[Original patch taken from QorIQ-SDK-V1.6-SOURCE-20140619-yocto.iso]

The current sysfs code shows only the default buffer pool. With this
patch, sysfs code will show all created buffer pools, including the
default one.

Signed-off-by: Marian Rotariu <marian.rotariu@freescale.com>
Change-Id: Ia3ff0e72f2806f7a0d7e94a520b12829af8a6a23
Reviewed-on: http://git.am.freescale.net:8181/4847
Reviewed-by: Cristian-Constantin Sovaiala <Cristian.Sovaiala@freescale.com>
Tested-by: Review Code-CDREVIEW <CDREVIEW@freescale.com>
Reviewed-by: Rivera Jose-B46482 <German.Rivera@freescale.com>
---
 drivers/net/ethernet/freescale/dpa/dpaa_eth_sysfs.c | 13 ++++++-------
 1 file changed, 6 insertions(+), 7 deletions(-)

diff --git a/drivers/net/ethernet/freescale/dpa/dpaa_eth_sysfs.c b/drivers/net/ethernet/freescale/dpa/dpaa_eth_sysfs.c
index 9e293da..16071b3 100644
--- a/drivers/net/ethernet/freescale/dpa/dpaa_eth_sysfs.c
+++ b/drivers/net/ethernet/freescale/dpa/dpaa_eth_sysfs.c
@@ -1,4 +1,3 @@
-
 /*
  * Copyright 2008-2012 Freescale Semiconductor Inc.
  *
@@ -145,17 +144,17 @@ static ssize_t dpaa_eth_show_fqids(struct device *dev,
 	return bytes;
 }
 
-static ssize_t dpaa_eth_show_dflt_bpid(struct device *dev,
+static ssize_t dpaa_eth_show_bpids(struct device *dev,
 		struct device_attribute *attr, char *buf)
 {
 	ssize_t bytes = 0;
 	struct dpa_priv_s *priv = netdev_priv(to_net_dev(dev));
 	struct dpa_bp *dpa_bp = priv->dpa_bp;
+	int i = 0;
 
-	if (priv->bp_count != 1)
-		bytes += snprintf(buf, PAGE_SIZE, "-1\n");
-	else
-		bytes += snprintf(buf, PAGE_SIZE, "%u\n", dpa_bp->bpid);
+	for (i = 0; i < priv->bp_count; i++)
+		bytes += snprintf(buf + bytes, PAGE_SIZE, "%u\n",
+				dpa_bp[i].bpid);
 
 	return bytes;
 }
@@ -218,7 +217,7 @@ static struct device_attribute dpaa_eth_attrs[] = {
 	__ATTR(device_addr, S_IRUGO, dpaa_eth_show_addr, NULL),
 	__ATTR(device_type, S_IRUGO, dpaa_eth_show_type, NULL),
 	__ATTR(fqids, S_IRUGO, dpaa_eth_show_fqids, NULL),
-	__ATTR(dflt_bpid, S_IRUGO, dpaa_eth_show_dflt_bpid, NULL),
+	__ATTR(bpids, S_IRUGO, dpaa_eth_show_bpids, NULL),
 	__ATTR(mac_regs, S_IRUGO, dpaa_eth_show_mac_regs, NULL),
 #ifdef CONFIG_FSL_DPAA_1588
 	__ATTR(ptp_1588, S_IRUGO | S_IWUSR, dpaa_eth_show_ptp_1588,
-- 
2.0.2

