From 121ff61651e98ef7e5ab407e250db68413cfb931 Mon Sep 17 00:00:00 2001
From: Mandy Lavi <mandy.lavi@freescale.com>
Date: Mon, 2 Jun 2014 21:51:38 +0300
Subject: [PATCH 385/466] fmd: add new attribute total-fifo-size to fman
 chosen node

This will enable increasing the total allowed fifo-size
to more than 120KB for FManV1 parts (up to 160KB)
for the purpose of better traffic performance in case
that jumbo frames are involved.

Change-Id: I3e357e08656af7d4f6c7e1c071212ccc81825449
Signed-off-by: Mandy Lavi <mandy.lavi@freescale.com>
Reviewed-on: http://git.am.freescale.net:8181/13297
Tested-by: Review Code-CDREVIEW <CDREVIEW@freescale.com>
Reviewed-by: Nir Erez <nir.erez@freescale.com>
Reviewed-by: Thomas Trefny <Tom.Trefny@freescale.com>
Reviewed-by: Jose Rivera <German.Rivera@freescale.com>
[Original patch taken from QorIQ-SDK-V1.6-SOURCE-20140619-yocto.iso]
Signed-off-by: Bin Jiang <bin.jiang@windriver.com>
---
 drivers/net/ethernet/freescale/fman/src/wrapper/lnxwrp_fm.c |   11 +++++++++++
 1 file changed, 11 insertions(+)

diff --git a/drivers/net/ethernet/freescale/fman/src/wrapper/lnxwrp_fm.c b/drivers/net/ethernet/freescale/fman/src/wrapper/lnxwrp_fm.c
index 529215f..90c102a 100755
--- a/drivers/net/ethernet/freescale/fman/src/wrapper/lnxwrp_fm.c
+++ b/drivers/net/ethernet/freescale/fman/src/wrapper/lnxwrp_fm.c
@@ -738,6 +738,17 @@ static t_Error CheckNConfigFmAdvArgs (t_LnxWrpFmDev *p_LnxWrpFmDev)
             RETURN_ERROR(MINOR, err, NO_MSG);
     }
 
+	uint32_prop = (uint32_t *)of_get_property(dev_node,
+						"total-fifo-size", &lenp);
+	if (uint32_prop) {
+		if (WARN_ON(lenp != sizeof(uint32_t)))
+			RETURN_ERROR(MINOR, E_INVALID_VALUE, NO_MSG);
+
+		if (FM_ConfigTotalFifoSize(p_LnxWrpFmDev->h_Dev,
+				*uint32_prop) != E_OK)
+			RETURN_ERROR(MINOR, E_INVALID_VALUE, NO_MSG);
+	}
+
     uint32_prop = (uint32_t *)of_get_property(dev_node, "tnum-aging-period",
 	&lenp);
     if (uint32_prop) {
-- 
1.7.10.4

