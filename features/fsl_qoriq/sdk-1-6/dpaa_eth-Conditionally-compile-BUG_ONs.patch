From 47da3d5ac70d61162b264751fb4965d0a41f73aa Mon Sep 17 00:00:00 2001
From: Bogdan Hamciuc <bogdan.hamciuc@freescale.com>
Date: Mon, 25 Nov 2013 19:28:28 +0200
Subject: [PATCH 0604/1089] dpaa_eth: Conditionally-compile BUG_ONs

[Original patch taken from QorIQ-SDK-V1.6-SOURCE-20140619-yocto.iso]

We have our own debugging flag - using for some BUG_ONs accidentally
left behind in the hotpath.

Signed-off-by: Bogdan Hamciuc <bogdan.hamciuc@freescale.com>
Change-Id: I34d3ae7dab7341d55f093ee84c8d48d52e120567
Reviewed-on: http://git.am.freescale.net:8181/6858
Reviewed-by: Cristian-Constantin Sovaiala <Cristian.Sovaiala@freescale.com>
Reviewed-by: Ruxandra Ioana Radulescu <ruxandra.radulescu@freescale.com>
Tested-by: Review Code-CDREVIEW <CDREVIEW@freescale.com>
Reviewed-by: Thomas Trefny <Tom.Trefny@freescale.com>
Reviewed-on: http://git.am.freescale.net:8181/7678
Reviewed-by: Madalin-Cristian Bucur <madalin.bucur@freescale.com>
Tested-by: Madalin-Cristian Bucur <madalin.bucur@freescale.com>
---
 drivers/net/ethernet/freescale/dpa/dpaa_eth.c        |  2 +-
 drivers/net/ethernet/freescale/dpa/dpaa_eth_common.c | 10 +++++-----
 2 files changed, 6 insertions(+), 6 deletions(-)

diff --git a/drivers/net/ethernet/freescale/dpa/dpaa_eth.c b/drivers/net/ethernet/freescale/dpa/dpaa_eth.c
index 669edeb..d35eee2 100644
--- a/drivers/net/ethernet/freescale/dpa/dpaa_eth.c
+++ b/drivers/net/ethernet/freescale/dpa/dpaa_eth.c
@@ -271,7 +271,7 @@ static int dpaa_eth_poll(struct napi_struct *napi, int budget)
 		int tmp;
 		napi_complete(napi);
 		tmp = qman_p_irqsource_add(np->p, QM_PIRQ_DQRI);
-		BUG_ON(tmp);
+		DPA_BUG_ON(tmp);
 	}
 
 	return cleaned;
diff --git a/drivers/net/ethernet/freescale/dpa/dpaa_eth_common.c b/drivers/net/ethernet/freescale/dpa/dpaa_eth_common.c
index 2b02136..6b4b2da 100644
--- a/drivers/net/ethernet/freescale/dpa/dpaa_eth_common.c
+++ b/drivers/net/ethernet/freescale/dpa/dpaa_eth_common.c
@@ -1454,11 +1454,11 @@ void dpa_release_sgt(struct qm_sg_entry *sgt, struct bm_buffer *bmb)
 
 	do {
 		dpa_bp = dpa_bpid2pool(sgt[i].bpid);
-		BUG_ON(!dpa_bp);
+		DPA_BUG_ON(!dpa_bp);
 
 		j = 0;
 		do {
-			BUG_ON(sgt[i].extension);
+			DPA_BUG_ON(sgt[i].extension);
 
 			bmb[j].hi       = sgt[i].addr_hi;
 			bmb[j].lo       = sgt[i].addr_lo;
@@ -1484,7 +1484,7 @@ dpa_fd_release(const struct net_device *net_dev, const struct qm_fd *fd)
 	_bmb.lo	= fd->addr_lo;
 
 	_dpa_bp = dpa_bpid2pool(fd->bpid);
-	BUG_ON(!_dpa_bp);
+	DPA_BUG_ON(!_dpa_bp);
 
 	if (fd->format == qm_fd_sg) {
 		sgt = (phys_to_virt(bm_buf_addr(&_bmb)) + dpa_fd_offset(fd));
@@ -1577,13 +1577,13 @@ int dpa_enable_tx_csum(struct dpa_priv_s *priv,
 	case ETH_P_IP:
 		parse_result->l3r = FM_L3_PARSE_RESULT_IPV4;
 		iph = ip_hdr(skb);
-		BUG_ON(iph == NULL);
+		DPA_BUG_ON(iph == NULL);
 		l4_proto = ntohs(iph->protocol);
 		break;
 	case ETH_P_IPV6:
 		parse_result->l3r = FM_L3_PARSE_RESULT_IPV6;
 		ipv6h = ipv6_hdr(skb);
-		BUG_ON(ipv6h == NULL);
+		DPA_BUG_ON(ipv6h == NULL);
 		l4_proto = ntohs(ipv6h->nexthdr);
 		break;
 	default:
-- 
2.0.2

