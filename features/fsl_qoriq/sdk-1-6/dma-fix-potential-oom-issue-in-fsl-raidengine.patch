From 7b81916d8991a7bdf183203d0a6cbedd904c9d71 Mon Sep 17 00:00:00 2001
From: Xuelin Shi <xuelin.shi@freescale.com>
Date: Mon, 12 May 2014 10:50:40 +0800
Subject: [PATCH 1010/1089] dma: fix potential oom issue in fsl raidengine.

[Original patch taken from QorIQ-SDK-V1.6-SOURCE-20140619-yocto.iso]

missing unmap dma sources and destinations.

Signed-off-by: Xuelin Shi <xuelin.shi@freescale.com>
Change-Id: I698884591fc0b56525ee2803c0b6a0581f9d9d95
Reviewed-on: http://git.am.freescale.net:8181/12192
Tested-by: Review Code-CDREVIEW <CDREVIEW@freescale.com>
Reviewed-by: Yang Li <LeoLi@freescale.com>
Reviewed-by: Jose Rivera <German.Rivera@freescale.com>
---
 drivers/dma/fsl_raid.c | 2 ++
 1 file changed, 2 insertions(+)

diff --git a/drivers/dma/fsl_raid.c b/drivers/dma/fsl_raid.c
index df3c9da..ccab188 100644
--- a/drivers/dma/fsl_raid.c
+++ b/drivers/dma/fsl_raid.c
@@ -131,6 +131,8 @@ static void re_jr_desc_done(struct fsl_re_dma_async_tx_desc *desc)
 			chan->completed_cookie = DMA_MIN_COOKIE;
 	}
 
+	dma_descriptor_unmap(&desc->async_tx);
+
 	if (callback)
 		callback(callback_param);
 }
-- 
2.0.2

