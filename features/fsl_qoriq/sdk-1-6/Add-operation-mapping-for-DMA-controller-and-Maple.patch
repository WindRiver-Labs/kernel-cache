From b6fb0df6ae5ca1f4902cc16f583658264102cc63 Mon Sep 17 00:00:00 2001
From: "Lu.Jiang" <lu.jiang@windriver.com>
Date: Tue, 9 Sep 2014 15:26:01 +0800
Subject: [PATCH 0422/1089] Add operation mapping for DMA controller and Maple.

[Original patch taken from QorIQ-SDK-V1.6-SOURCE-20140619-yocto.iso]

These are required for ALU DSP stashing use case.

Signed-off-by: Varun Sethi <Varun.Sethi@freescale.com>
Signed-off-by: Lu.Jiang <lu.jiang@windriver.com>
---
 drivers/iommu/fsl_pamu.c | 19 +++++++++++++++++++
 include/linux/iommu.h    |  3 +++
 2 files changed, 22 insertions(+)

diff --git a/drivers/iommu/fsl_pamu.c b/drivers/iommu/fsl_pamu.c
index a232a56..3d4e669 100644
--- a/drivers/iommu/fsl_pamu.c
+++ b/drivers/iommu/fsl_pamu.c
@@ -707,7 +707,26 @@ static void __init setup_omt(struct ome *omt)
 	ome->moe[IOE_DIRECT0_IDX] = EOE_LDEC | EOE_VALID;
 	ome->moe[IOE_DIRECT1_IDX] = EOE_LDEC | EOE_VALID;
 
+	/* Configure OMI_DMA */
+	ome = &omt[OMI_DMA];
+	ome->moe[IOE_READ_IDX]  = EOE_VALID | EOE_RSA;
+	ome->moe[IOE_EREAD0_IDX] = EOE_VALID | EOE_RSA;
+	ome->moe[IOE_WRITE_IDX] = EOE_VALID | EOE_WWSA;
+	ome->moe[IOE_EWRITE0_IDX] = EOE_VALID | EOE_WWSA;
+
+	/* Configure OMI_DMA_READI */
+	ome = &omt[OMI_DMA_READI];
+	ome->moe[IOE_READ_IDX]  = EOE_VALID | EOE_READI;
+	ome->moe[IOE_EREAD0_IDX] = EOE_VALID | EOE_READI;
+	ome->moe[IOE_WRITE_IDX] = EOE_VALID | EOE_WWSA;
+	ome->moe[IOE_EWRITE0_IDX] = EOE_VALID | EOE_WWSA;
 
+	/* Configure OMI_MAPLE */
+	ome = &omt[OMI_MAPLE];
+	ome->moe[IOE_READ_IDX]  = EOE_VALID | EOE_RSA;
+	ome->moe[IOE_EREAD0_IDX] = EOE_VALID | EOE_RSA;
+	ome->moe[IOE_WRITE_IDX] = EOE_VALID | EOE_WWSA;
+	ome->moe[IOE_EWRITE0_IDX] = EOE_VALID | EOE_WWSA;
 }
 
 /*
diff --git a/include/linux/iommu.h b/include/linux/iommu.h
index e30b47c..7a9ea57 100644
--- a/include/linux/iommu.h
+++ b/include/linux/iommu.h
@@ -72,6 +72,9 @@ enum omap_index {
 	OMI_QMAN_PRIV,
 	OMI_CAAM,
 	OMI_PMAN,
+	OMI_DMA,
+	OMI_DMA_READI,
+	OMI_MAPLE,
 	OMI_MAX,
 };
 
-- 
2.0.2

