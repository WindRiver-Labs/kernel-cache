From 0fdb61e360c62b6f4a9350463541a8496af12808 Mon Sep 17 00:00:00 2001
From: Andrei Varvara <andrei.varvara@freescale.com>
Date: Thu, 8 May 2014 11:47:35 +0300
Subject: [PATCH 326/466] fsl_dpa_offload: Fix T4240 DTS for Multiple DPAA
 IPSec Instances

required update of chosen offload, new entry for
FMAN 1 with VSP.

Change-Id: If6518557ed6be13c5d66e428a7198c20b7cb5d7d
Signed-off-by: Andrei Varvara <andrei.varvara@freescale.com>
Reviewed-on: http://git.am.freescale.net:8181/12035
Tested-by: Review Code-CDREVIEW <CDREVIEW@freescale.com>
Reviewed-by: Marian-Cornel Chereji <marian.chereji@freescale.com>
Reviewed-by: Jose Rivera <German.Rivera@freescale.com>
[Original patch taken from QorIQ-SDK-V1.6-SOURCE-20140619-yocto.iso]
Signed-off-by: Bin Jiang <bin.jiang@windriver.com>
---
 ...red-interfaces_for_ipsec_multiple_instances.dts |    4 +-
 ...-chosen-offld_for_ipsec_multiple_instances.dtsi |   57 ++++++++++++++++++++
 2 files changed, 59 insertions(+), 2 deletions(-)
 create mode 100644 drivers/staging/fsl_dpa_offload/dts/t4240si-chosen-offld_for_ipsec_multiple_instances.dtsi

diff --git a/drivers/staging/fsl_dpa_offload/dts/t4240qds-usdpaa-shared-interfaces_for_ipsec_multiple_instances.dts b/drivers/staging/fsl_dpa_offload/dts/t4240qds-usdpaa-shared-interfaces_for_ipsec_multiple_instances.dts
index 75ffece..39ed59b 100644
--- a/drivers/staging/fsl_dpa_offload/dts/t4240qds-usdpaa-shared-interfaces_for_ipsec_multiple_instances.dts
+++ b/drivers/staging/fsl_dpa_offload/dts/t4240qds-usdpaa-shared-interfaces_for_ipsec_multiple_instances.dts
@@ -166,7 +166,7 @@
 			local-mac-address = [00 11 22 33 44 88];
 		};
 
-		dpa-fman0-oh2: dpa-fman0-oh@2 {
+		dpa_fman0_oh2: dpa-fman0-oh@2 {
 			compatible = "fsl,dpa-oh";
 			/* Define frame queues for the OH port*/
 			/* <OH Rx error, OH Rx default> */
@@ -186,7 +186,7 @@
 			fsl,bman-buffer-pools = <&bp16>;
 			fsl,fman-oh-port = <&fman0_oh4>;
 		};
-		dpa-fman1-oh2: dpa-fman1-oh@2 {
+		dpa_fman1_oh2: dpa-fman1-oh@2 {
 			compatible = "fsl,dpa-oh";
 			/* Define frame queues for the OH port*/
 			/* <OH Rx error, OH Rx default> */
diff --git a/drivers/staging/fsl_dpa_offload/dts/t4240si-chosen-offld_for_ipsec_multiple_instances.dtsi b/drivers/staging/fsl_dpa_offload/dts/t4240si-chosen-offld_for_ipsec_multiple_instances.dtsi
new file mode 100644
index 0000000..2859018
--- /dev/null
+++ b/drivers/staging/fsl_dpa_offload/dts/t4240si-chosen-offld_for_ipsec_multiple_instances.dtsi
@@ -0,0 +1,57 @@
+chosen {
+	name = "chosen";
+
+	dpaa-extended-args {
+		fman0-extd-args {
+			cell-index = <0>;
+			compatible = "fsl,fman-extended-args";
+			dma-aid-mode = "port";
+			/* Inbound O/H post decryption */
+			fman0_oh2-extd-args {
+				cell-index = <1>;
+				compatible = "fsl,fman-port-op-extended-args";
+				errors-to-discard = <0x00420000>;
+				/* Define Virtual storage profile */
+				/* <number of profiles, default profile id> */
+				vsp-window = <8 0>;
+			};
+			/* Outbound O/H pre encryption */
+			fman0_oh3-extd-args {
+				cell-index = <2>;
+				compatible = "fsl,fman-port-op-extended-args";
+				errors-to-discard = <0x00420000>;
+				/* Define buffer layout parameters. Can be used
+				 * in fragmentation or header manip operations
+				 */
+				/* <manip extra space, data alignment> */
+				buffer-layout = <128 64>;
+			};
+		};
+
+		fman1-extd-args {
+			cell-index = <1>;
+			compatible = "fsl,fman-extended-args";
+			dma-aid-mode = "port";
+			/* Inbound O/H post decryption */
+			fman1_oh2-extd-args {
+				cell-index = <1>;
+				compatible = "fsl,fman-port-op-extended-args";
+				errors-to-discard = <0x00420000>;
+				/* Define Virtual storage profile */
+				/* <number of profiles, default profile id> */
+				vsp-window = <8 0>;
+			};
+			/* Outbound O/H pre encryption */
+			fman1_oh3-extd-args {
+				cell-index = <2>;
+				compatible = "fsl,fman-port-op-extended-args";
+				errors-to-discard = <0x00420000>;
+				/* Define buffer layout parameters. Can be used
+				* in fragmentation or header manip operations
+				*/
+				/* <manip extra space, data alignment> */
+				buffer-layout = <128 64>;
+			};
+	        };
+	};
+};
-- 
1.7.10.4

