From 8e34bebcb86970704e158bfe10e351b480b387a1 Mon Sep 17 00:00:00 2001
From: "Lu.Jiang" <lu.jiang@windriver.com>
Date: Tue, 2 Sep 2014 18:05:00 +0800
Subject: [PATCH 0016/1089] powerpc/fsl-booke: build e6500 on 64-bit only.

[Original patch taken from QorIQ-SDK-V1.6-SOURCE-20140619-yocto.iso]

Fixes build break on 32-bit (undefined reference to
.setup_altivec_ivors).  We don't support this anyway as it lacks thread,
tablewalk, and altivec support.

Signed-off-by: Scott Wood <scottwood@freescale.com>
Signed-off-by: Andy Fleming <afleming@freescale.com>
Signed-off-by: Lu.Jiang <lu.jiang@windriver.com>
---
 arch/powerpc/kernel/cpu_setup_fsl_booke.S | 2 ++
 arch/powerpc/kernel/cputable.c            | 4 ++--
 2 files changed, 4 insertions(+), 2 deletions(-)

diff --git a/arch/powerpc/kernel/cpu_setup_fsl_booke.S b/arch/powerpc/kernel/cpu_setup_fsl_booke.S
index cc2d896..1a41725 100644
--- a/arch/powerpc/kernel/cpu_setup_fsl_booke.S
+++ b/arch/powerpc/kernel/cpu_setup_fsl_booke.S
@@ -91,6 +91,7 @@ _GLOBAL(setup_altivec_idle)
 
 	blr
 
+#ifdef CONFIG_PPC_BOOK3E_64
 _GLOBAL(__setup_cpu_e6500)
 	mflr	r6
 #ifdef CONFIG_PPC64
@@ -107,6 +108,7 @@ _GLOBAL(__setup_cpu_e6500)
 	bl	__setup_cpu_e5500
 	mtlr	r6
 	blr
+#endif
 
 #ifdef CONFIG_PPC32
 _GLOBAL(__setup_cpu_e200)
diff --git a/arch/powerpc/kernel/cputable.c b/arch/powerpc/kernel/cputable.c
index 7ac1eab..bb4cf0c 100644
--- a/arch/powerpc/kernel/cputable.c
+++ b/arch/powerpc/kernel/cputable.c
@@ -2110,6 +2110,7 @@ static struct cpu_spec __initdata cpu_specs[] = {
 		.machine_check		= machine_check_e500mc,
 		.platform		= "ppce5500",
 	},
+#ifndef CONFIG_PPC32
 	{	/* e6500 */
 		.pvr_mask		= 0xffff0000,
 		.pvr_value		= 0x80400000,
@@ -2126,12 +2127,11 @@ static struct cpu_spec __initdata cpu_specs[] = {
 		.oprofile_cpu_type	= "ppc/e6500",
 		.oprofile_type		= PPC_OPROFILE_FSL_EMB,
 		.cpu_setup		= __setup_cpu_e6500,
-#ifndef CONFIG_PPC32
 		.cpu_restore		= __restore_cpu_e6500,
-#endif
 		.machine_check		= machine_check_e500mc,
 		.platform		= "ppce6500",
 	},
+#endif
 #ifdef CONFIG_PPC32
 	{	/* default match */
 		.pvr_mask		= 0x00000000,
-- 
2.0.2

