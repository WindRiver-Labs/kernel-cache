From 8a4ca908ef81130925544b6c06561b92a61933a5 Mon Sep 17 00:00:00 2001
From: Yanjiang Jin <yanjiang.jin@windriver.com>
Date: Thu, 23 Apr 2015 13:49:47 +0800
Subject: [PATCH] crypto: talitos: execute full RNGU reset

Execute full RNGU reset in reset_device(), else system would hang
during starting random number generator daemon in kexec/kdump's
secondary kernel.

Signed-off-by: Yanjiang Jin <yanjiang.jin@windriver.com>
---
 drivers/crypto/talitos.c |    1 +
 1 files changed, 1 insertions(+), 0 deletions(-)

diff --git a/drivers/crypto/talitos.c b/drivers/crypto/talitos.c
index 503b69c..2d03b28 100644
--- a/drivers/crypto/talitos.c
+++ b/drivers/crypto/talitos.c
@@ -128,6 +128,7 @@ static int reset_device(struct device *dev)
 	unsigned int timeout = TALITOS_TIMEOUT;
 	u32 mcr = TALITOS_MCR_SWR;
 
+	setbits32(priv->reg + TALITOS_RNGURCR_LO, TALITOS_RNGURCR_LO_SR);
 	setbits32(priv->reg + TALITOS_MCR, mcr);
 
 	while ((in_be32(priv->reg + TALITOS_MCR) & TALITOS_MCR_SWR)
-- 
1.7.5.4

