From f07d5423552d4f66962218e1ba45adf37315bf6f Mon Sep 17 00:00:00 2001
From: "Lu.Jiang" <lu.jiang@windriver.com>
Date: Thu, 11 Sep 2014 15:50:11 +0800
Subject: [PATCH 0556/1089] Powerpc/eSDCH: Specify voltage for T4240QDS

[Original patch taken from QorIQ-SDK-V1.6-SOURCE-20140619-yocto.iso]

Freescale T4240QDS reference board has extra voltage shifters added
to allow 3.3V operation, so add 3.3v voltage support for T4240QDS.
1.8v and 3.3v is recommand for eMMC and SDHC card.

Signed-off-by: Haijun Zhang <haijun.zhang@freescale.com>
Change-Id: I3cd97a087535406ac4db4e30dc6169ab024d20bf
Reviewed-on: http://git.am.freescale.net:8181/4824
Tested-by: Review Code-CDREVIEW <CDREVIEW@freescale.com>
Reviewed-by: Xie Xiaobo-R63061 <X.Xie@freescale.com>
Reviewed-by: Rivera Jose-B46482 <German.Rivera@freescale.com>
Signed-off-by: Lu.Jiang <lu.jiang@windriver.com>
---
 arch/powerpc/boot/dts/t4240qds.dts | 8 ++++----
 drivers/mmc/host/sdhci-pltfm.c     | 1 -
 2 files changed, 4 insertions(+), 5 deletions(-)

diff --git a/arch/powerpc/boot/dts/t4240qds.dts b/arch/powerpc/boot/dts/t4240qds.dts
index 7534c6e..7980c8b 100644
--- a/arch/powerpc/boot/dts/t4240qds.dts
+++ b/arch/powerpc/boot/dts/t4240qds.dts
@@ -403,10 +403,6 @@
 			};
 		};
 
-		sdhc@114000 {
-			voltage-ranges = <1800 1800 3300 3300>;
-		};
-
 		fman0: fman@400000 {
 			enet0: ethernet@e0000 {
 				phy-handle = <&phy5>;
@@ -552,6 +548,10 @@
 				status = "disabled";
 			};
 		};
+
+		sdhc@114000 {
+			voltage-ranges = <1800 1800 3300 3300>;
+		};
 	};
 
 	pci0: pcie@ffe240000 {
diff --git a/drivers/mmc/host/sdhci-pltfm.c b/drivers/mmc/host/sdhci-pltfm.c
index 7ce1a2f..4a5cf28 100644
--- a/drivers/mmc/host/sdhci-pltfm.c
+++ b/drivers/mmc/host/sdhci-pltfm.c
@@ -100,7 +100,6 @@ void sdhci_get_of_property(struct platform_device *pdev)
 
 		if (of_device_is_compatible(np, "fsl,t4240-esdhc")) {
 			host->quirks2 |= SDHCI_QUIRK2_LONG_TIME_CMD_COMPLETE_IRQ;
-			host->quirks2 |= SDHCI_QUIRK2_CIRCUIT_SUPPORT_VS33;
 			host->quirks2 |= SDHCI_QUIRK2_FORCE_CMD13_DETECT_CARD;
 			host->quirks |= SDHCI_QUIRK_BROKEN_ADMA;
 		}
-- 
2.0.2

