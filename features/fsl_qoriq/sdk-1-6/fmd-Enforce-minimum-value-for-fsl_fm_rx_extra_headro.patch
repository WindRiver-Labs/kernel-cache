From 11b35f8400a353350a71ab425f102e156076ebaa Mon Sep 17 00:00:00 2001
From: Ioana Radulescu <ruxandra.radulescu@freescale.com>
Date: Thu, 3 Oct 2013 15:42:56 +0300
Subject: [PATCH 0539/1089] fmd: Enforce minimum value for
 fsl_fm_rx_extra_headroom

[Original patch taken from QorIQ-SDK-V1.6-SOURCE-20140619-yocto.iso]

fsl_fm_rx_extra headroom must have a value of at least 16 bytes.
The Kconfig option has this lower limit, but when configuring the
parameter through bootargs no check was made.

So enforce the lower limit for all input methods, to avoid invalid
values.

Signed-off-by: Ioana Radulescu <ruxandra.radulescu@freescale.com>
Change-Id: Ibf6dfe82d7497745b04eb46e0e7b0a1497c3aa7f
Reviewed-on: http://git.am.freescale.net:8181/5172
Reviewed-by: Bogdan Hamciuc <bogdan.hamciuc@freescale.com>
Tested-by: Review Code-CDREVIEW <CDREVIEW@freescale.com>
Reviewed-by: Rivera Jose-B46482 <German.Rivera@freescale.com>
---
 drivers/net/ethernet/freescale/fman/src/wrapper/lnxwrp_fm.c | 8 +++++---
 1 file changed, 5 insertions(+), 3 deletions(-)

diff --git a/drivers/net/ethernet/freescale/fman/src/wrapper/lnxwrp_fm.c b/drivers/net/ethernet/freescale/fman/src/wrapper/lnxwrp_fm.c
index 333b20a..a95a603 100644
--- a/drivers/net/ethernet/freescale/fman/src/wrapper/lnxwrp_fm.c
+++ b/drivers/net/ethernet/freescale/fman/src/wrapper/lnxwrp_fm.c
@@ -105,7 +105,8 @@ extern struct device_node *GetFmPortAdvArgsDevTreeNode (struct device_node *fm_n
 /* Bootarg used to override FSL_FM_RX_EXTRA_HEADROOM Kconfig value */
 #define FSL_FM_RX_EXTRA_HEADROOM_BOOTARG  "fsl_fm_rx_extra_headroom"
 
-/* Maximum value for the fsl_fm_rx_extra_headroom bootarg */
+/* Minimum and maximum value for the fsl_fm_rx_extra_headroom bootarg */
+#define FSL_FM_RX_EXTRA_HEADROOM_MIN 16
 #define FSL_FM_RX_EXTRA_HEADROOM_MAX 384
 
 #define TX_PAUSE_PRIO_DEFAULT 0xff
@@ -204,12 +205,13 @@ static int __init fm_set_rx_extra_headroom(char *str)
 		return 1;
 	}
 
-	if (fsl_fm_rx_extra_headroom < 0 ||
+	if (fsl_fm_rx_extra_headroom < FSL_FM_RX_EXTRA_HEADROOM_MIN ||
 		fsl_fm_rx_extra_headroom > FSL_FM_RX_EXTRA_HEADROOM_MAX) {
-		printk(KERN_WARNING "Invalid value for %s=<int> prop in "
+		printk(KERN_WARNING "Invalid value for %s=%d prop in "
 			"bootargs; will use the default "
 			"FSL_FM_RX_EXTRA_HEADROOM (%d) from Kconfig.\n",
 			FSL_FM_RX_EXTRA_HEADROOM_BOOTARG,
+			fsl_fm_rx_extra_headroom,
 			CONFIG_FSL_FM_RX_EXTRA_HEADROOM);
 		fsl_fm_rx_extra_headroom = CONFIG_FSL_FM_RX_EXTRA_HEADROOM;
 	}
-- 
2.0.2

