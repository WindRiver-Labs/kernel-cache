From e2bf1a78d43f62c838c8a76f8819c081b5679963 Mon Sep 17 00:00:00 2001
From: Shengzhou Liu <Shengzhou.Liu@freescale.com>
Date: Wed, 11 Dec 2013 16:44:55 +0800
Subject: [PATCH 151/466] fmd: extend workaround of fman reset on t208x and
 t4160v2

The same hang issue was observed on T208x and T4160v2 also.
So extend the workaround for now.

Signed-off-by: Shengzhou Liu <Shengzhou.Liu@freescale.com>
Signed-off-by: Shaohui Xie <Shaohui.Xie@freescale.com>
Signed-off-by: Mandy Lavi <mandy.lavi@freescale.com>
Change-Id: If75d58a3d609f3607050c0cf306d9c86aa69cfaf
Reviewed-on: http://git.am.freescale.net:8181/7205
Reviewed-by: Jose Rivera <German.Rivera@freescale.com>
Tested-by: Jose Rivera <German.Rivera@freescale.com>
Reviewed-on: http://git.am.freescale.net:8181/9450
Tested-by: Review Code-CDREVIEW <CDREVIEW@freescale.com>
[Original patch taken from QorIQ-SDK-V1.6-SOURCE-20140619-yocto.iso]
Signed-off-by: Bin Jiang <bin.jiang@windriver.com>
---
 drivers/net/ethernet/freescale/fman/Peripherals/FM/fm.c |    4 +++-

diff --git a/drivers/net/ethernet/freescale/fman/Peripherals/FM/fm.c b/drivers/net/ethernet/freescale/fman/Peripherals/FM/fm.c
index 6e3ee68..9a046c5 100644
--- a/drivers/net/ethernet/freescale/fman/Peripherals/FM/fm.c
+++ b/drivers/net/ethernet/freescale/fman/Peripherals/FM/fm.c
@@ -3517,7 +3517,9 @@ t_Error FM_Init(t_Handle h_Fm)
 	u32 svr = mfspr(SPRN_SVR);
 
 	if ((SVR_SOC_VER(svr) == SVR_T4240 && SVR_REV(svr) > 0x10) ||
-	    (SVR_SOC_VER(svr) == SVR_T4160 && SVR_REV(svr) > 0x10)) {
+	    ((SVR_SOC_VER(svr) == SVR_T4160 && SVR_REV(svr) > 0x10)) ||
+	    (SVR_SOC_VER(svr) == SVR_T2080) ||
+	    (SVR_SOC_VER(svr) == SVR_T2081)) {
 		DBG(WARNING, ("Hack: No FM reset!\n"));
 	} else {
 		WRITE_UINT32(p_Fm->p_FmFpmRegs->fm_rstc, FPM_RSTC_FM_RESET);
-- 
1.7.10.4

