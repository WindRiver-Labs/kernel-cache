From 012b1276f49dc39ddb1321864c8eb20193c65b60 Mon Sep 17 00:00:00 2001
From: Mandy Lavi <mandy.lavi@freescale.com>
Date: Wed, 14 May 2014 20:02:12 +0300
Subject: [PATCH 341/466] fmd: fman advanced args should not be mandatory

Fman advanced args should not be mandatory.

Change-Id: I0080ab68d4658bf8eb855b6c4b43ed2526f2a878
Signed-off-by: Mandy Lavi <mandy.lavi@freescale.com>
Reviewed-on: http://git.am.freescale.net:8181/12366
Reviewed-by: Nir Erez <nir.erez@freescale.com>
Reviewed-by: Jose Rivera <German.Rivera@freescale.com>
Tested-by: Jose Rivera <German.Rivera@freescale.com>
[Original patch taken from QorIQ-SDK-V1.6-SOURCE-20140619-yocto.iso]
Signed-off-by: Bin Jiang <bin.jiang@windriver.com>
---
 drivers/net/ethernet/freescale/fman/src/wrapper/lnxwrp_fm.c |   11 +++++++----
 1 file changed, 7 insertions(+), 4 deletions(-)

diff --git a/drivers/net/ethernet/freescale/fman/src/wrapper/lnxwrp_fm.c b/drivers/net/ethernet/freescale/fman/src/wrapper/lnxwrp_fm.c
index ed9e918..04e6826 100755
--- a/drivers/net/ethernet/freescale/fman/src/wrapper/lnxwrp_fm.c
+++ b/drivers/net/ethernet/freescale/fman/src/wrapper/lnxwrp_fm.c
@@ -732,6 +732,9 @@ static t_Error CheckNConfigFmAdvArgs (t_LnxWrpFmDev *p_LnxWrpFmDev)
             err = FM_ConfigDmaAidMode(p_LnxWrpFmDev->h_Dev, e_FM_DMA_AID_OUT_PORT_ID);
         else if (strcmp(str_prop, "tnum") == 0)
             err = FM_ConfigDmaAidMode(p_LnxWrpFmDev->h_Dev, e_FM_DMA_AID_OUT_TNUM);
+
+        if (err != E_OK)
+            RETURN_ERROR(MINOR, err, NO_MSG);
     }
 
     uint32_prop = (uint32_t *)of_get_property(dev_node, "tnum-aging-period",
@@ -741,11 +744,11 @@ static t_Error CheckNConfigFmAdvArgs (t_LnxWrpFmDev *p_LnxWrpFmDev)
             RETURN_ERROR(MINOR, E_INVALID_VALUE, NO_MSG);
  
         err = FM_ConfigTnumAgingPeriod(p_LnxWrpFmDev->h_Dev,
-		(uint16_t)uint32_prop[0]/*tnumAgingPeriod*/);
+            (uint16_t)uint32_prop[0]/*tnumAgingPeriod*/);
+
+        if (err != E_OK)
+            RETURN_ERROR(MINOR, err, NO_MSG);
     }
-        
-    if (err != E_OK)
-        RETURN_ERROR(MINOR, err, NO_MSG);
 
     of_node_put(dev_node);
 
-- 
1.7.10.4

