From cd32acb0711263adbb4aa7e1e23a87c0f89682e9 Mon Sep 17 00:00:00 2001
From: Xie Xiaobo <X.Xie@freescale.com>
Date: Thu, 16 Apr 2015 15:15:30 +0800
Subject: [PATCH] PowerPC/P1025RDB: Reasonably set the PMUXCR register

Setup_arch() will set the PMUXCR register based on the dts.

Signed-off-by: Xie Xiaobo <X.Xie@freescale.com>
Signed-off-by: Yanjiang Jin <yanjiang.jin@windriver.com>
---
 arch/powerpc/platforms/85xx/mpc85xx_rdb.c |    4 +++-
 1 files changed, 3 insertions(+), 1 deletions(-)

diff --git a/arch/powerpc/platforms/85xx/mpc85xx_rdb.c b/arch/powerpc/platforms/85xx/mpc85xx_rdb.c
index b071a2c..f3ce8f1 100644
--- a/arch/powerpc/platforms/85xx/mpc85xx_rdb.c
+++ b/arch/powerpc/platforms/85xx/mpc85xx_rdb.c
@@ -88,6 +88,7 @@ static void __init mpc85xx_rdb_setup_arch(void)
 {
 #ifdef CONFIG_QUICC_ENGINE
 	struct device_node *np;
+	struct device_node *np1;
 #if defined(CONFIG_SPI_FSL_SPI)
 	struct device_node *qe_spi;
 #endif
@@ -113,7 +114,8 @@ static void __init mpc85xx_rdb_setup_arch(void)
 	}
 
 	np = of_find_node_by_name(NULL, "global-utilities");
-	if (np) {
+	np1 = of_find_node_by_name(NULL, "qe");
+	if (np && np1) {
 		guts = of_iomap(np, 0);
 		if (!guts)
 			pr_err("mpc85xx-rdb: could not map global "
-- 
1.7.5.4

