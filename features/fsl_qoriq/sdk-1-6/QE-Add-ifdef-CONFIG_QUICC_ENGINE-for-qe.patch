From f9d3bd18366b1392eaa9448110e976f1f797ccd7 Mon Sep 17 00:00:00 2001
From: Zhao Qiang <B45475@freescale.com>
Date: Mon, 14 Apr 2014 14:49:54 +0800
Subject: [PATCH 0920/1089] QE: Add "ifdef CONFIG_QUICC_ENGINE" for qe

[Original patch taken from QorIQ-SDK-V1.6-SOURCE-20140619-yocto.iso]

qe and qe_ic shouldn't be initialized when QUICC_ENGINE
is not selected.

Signed-off-by: Zhao Qiang <B45475@freescale.com>
Change-Id: If9b1b22499dade52ebc0727b6c0ec923f520cdd1
Reviewed-on: http://git.am.freescale.net:8181/10936
Tested-by: Review Code-CDREVIEW <CDREVIEW@freescale.com>
Reviewed-by: Xiaobo Xie <X.Xie@freescale.com>
Reviewed-by: Jose Rivera <German.Rivera@freescale.com>
---
 arch/powerpc/platforms/85xx/corenet_generic.c | 6 ++++++
 1 file changed, 6 insertions(+)

diff --git a/arch/powerpc/platforms/85xx/corenet_generic.c b/arch/powerpc/platforms/85xx/corenet_generic.c
index 0eb7a10..23d70ed 100644
--- a/arch/powerpc/platforms/85xx/corenet_generic.c
+++ b/arch/powerpc/platforms/85xx/corenet_generic.c
@@ -42,7 +42,9 @@ void __init corenet_gen_pic_init(void)
 	unsigned int flags = MPIC_BIG_ENDIAN | MPIC_SINGLE_DEST_CPU |
 		MPIC_NO_RESET;
 
+#ifdef CONFIG_QUICC_ENGINE
 	struct device_node *np;
+#endif
 
 	if (ppc_md.get_irq == mpic_get_coreint_irq)
 		flags |= MPIC_ENABLE_COREINT;
@@ -52,12 +54,14 @@ void __init corenet_gen_pic_init(void)
 
 	mpic_init(mpic);
 
+#ifdef CONFIG_QUICC_ENGINE
 	np = of_find_compatible_node(NULL, NULL, "fsl,qe-ic");
 	if (np) {
 		qe_ic_init(np, 0, qe_ic_cascade_low_mpic,
 				qe_ic_cascade_high_mpic);
 		of_node_put(np);
 	}
+#endif
 }
 
 /*
@@ -108,9 +112,11 @@ static const struct of_device_id of_device_ids[] = {
 	{
 		.compatible	= "fsl,qoriq-pcie-v3.0",
 	},
+#ifdef CONFIG_QUICC_ENGINE
 	{
 		.compatible	= "fsl,qe",
 	},
+#endif
 	/* The following two are for the Freescale hypervisor */
 	{
 		.name		= "hypervisor",
-- 
2.0.2

