From c20a8c9cff0b495bb4e1c090114bebfe35b43f22 Mon Sep 17 00:00:00 2001
From: Andrei Varvara <andrei.varvara@freescale.com>
Date: Fri, 9 May 2014 14:31:17 +0300
Subject: [PATCH 1022/1089] dpa_offload: wrp compat, Instance ID not given OK
 when creating SAs

[Original patch taken from QorIQ-SDK-V1.6-SOURCE-20140619-yocto.iso]

In compat case the instances id was not properly given
to the create SA API function. This commit is fixing
the issue.

Signed-off-by: Andrei Varvara <andrei.varvara@freescale.com>
Change-Id: Ie8c3d0f4bbbd8d34f7fa62207efcdf66d504b72b
Reviewed-on: http://git.am.freescale.net:8181/12085
Reviewed-by: Marian-Cornel Chereji <marian.chereji@freescale.com>
Tested-by: Review Code-CDREVIEW <CDREVIEW@freescale.com>
Reviewed-by: Jose Rivera <German.Rivera@freescale.com>
---
 drivers/staging/fsl_dpa_offload/wrp_dpa_ipsec.c | 1 +
 1 file changed, 1 insertion(+)

diff --git a/drivers/staging/fsl_dpa_offload/wrp_dpa_ipsec.c b/drivers/staging/fsl_dpa_offload/wrp_dpa_ipsec.c
index 5d04f84..d3cf32b 100644
--- a/drivers/staging/fsl_dpa_offload/wrp_dpa_ipsec.c
+++ b/drivers/staging/fsl_dpa_offload/wrp_dpa_ipsec.c
@@ -610,6 +610,7 @@ static int do_create_sa_compat_ioctl(void *args)
 	}
 
 	/* copy SA params from userspace */
+	prm.dpa_ipsec_id = compat_prm.dpa_ipsec_id;
 	compat_copy_sa_params(&prm.sa_params, &compat_prm.sa_params);
 
 	err = do_copy_sa_params(&prm.sa_params, &compat_prm.sa_params);
-- 
2.0.2

