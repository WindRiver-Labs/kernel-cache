From aebc0c2b08b49837dbfb40c2567604a93830ac4d Mon Sep 17 00:00:00 2001
From: Marian Chereji <marian.chereji@freescale.com>
Date: Fri, 14 Feb 2014 12:49:52 +0200
Subject: [PATCH 0724/1089] dpa_offload: Sync B4860QDS offloading DTS files

[Original patch taken from QorIQ-SDK-V1.6-SOURCE-20140619-yocto.iso]

Updated the B4860QDS DTS example files for DPA offloading applications
to bring them to the version delivered with SDK 1.5.

Change-Id: I07532902ce0024a00913b8d2c8de25e863b42bd7
Signed-off-by: Marian Chereji <marian.chereji@freescale.com>
Reviewed-on: http://git.am.freescale.net:8181/8834
Tested-by: Review Code-CDREVIEW <CDREVIEW@freescale.com>
Reviewed-by: Radu-Andrei Bulie <Radu.Bulie@freescale.com>
Reviewed-by: Jose Rivera <German.Rivera@freescale.com>
---
 .../dts/b4860qds-usdpaa-shared-interfaces.dts      | 55 +++++++++++---------
 .../fsl_dpa_offload/dts/b4860qds-usdpaa.dts        | 38 +++++++-------
 .../fsl_dpa_offload/dts/b4860si-chosen-offld.dtsi  |  2 +
 .../fsl_dpa_offload/dts/b4860si-chosen-reass.dtsi  |  2 +
 .../staging/fsl_dpa_offload/dts/b4860si-pre.dtsi   | 59 ++++++++++++++++++++++
 5 files changed, 111 insertions(+), 45 deletions(-)

diff --git a/drivers/staging/fsl_dpa_offload/dts/b4860qds-usdpaa-shared-interfaces.dts b/drivers/staging/fsl_dpa_offload/dts/b4860qds-usdpaa-shared-interfaces.dts
index 7baa9b1..764ca3c 100644
--- a/drivers/staging/fsl_dpa_offload/dts/b4860qds-usdpaa-shared-interfaces.dts
+++ b/drivers/staging/fsl_dpa_offload/dts/b4860qds-usdpaa-shared-interfaces.dts
@@ -77,37 +77,35 @@
 		fsl,bpid = <12>;
 		fsl,bpool-thresholds = <0x100 0x300 0x0 0x0>;
 	};
-
 	bp16: buffer-pool@16 {
-                        compatible = "fsl,b4860-bpool", "fsl,bpool";
-                        fsl,bpid = <16>;
-			fsl,bpool-ethernet-cfg = <0 2048 0 1728 0 0>;
-                        fsl,bpool-thresholds = <0x100 0x300 0x0 0x0>;
-       };
-
+		compatible = "fsl,b4860-bpool", "fsl,bpool";
+		fsl,bpid = <16>;
+		fsl,bpool-ethernet-cfg = <0 2048 0 1728 0 0>;
+		fsl,bpool-thresholds = <0x100 0x300 0x0 0x0>;
+	};
 
 	fsl,dpaa {
 		ethernet@0 {
 			compatible = "fsl,b4860-dpa-ethernet-init", "fsl,dpa-ethernet-init";
-			fsl,bman-buffer-pools = <&bp7 &bp8 &bp9>;
+			fsl,bman-buffer-pools = <&bp16>;
 			fsl,qman-frame-queues-rx = <0x50 1 0x51 1>;
 			fsl,qman-frame-queues-tx = <0x70 1 0x71 1>;
 		};
 		ethernet@1 {
 			compatible = "fsl,b4860-dpa-ethernet-init", "fsl,dpa-ethernet-init";
-			fsl,bman-buffer-pools = <&bp7 &bp8 &bp9>;
+			fsl,bman-buffer-pools = <&bp16>;
 			fsl,qman-frame-queues-rx = <0x52 1 0x53 1>;
 			fsl,qman-frame-queues-tx = <0x72 1 0x73 1>;
 		};
 		ethernet@2 {
 			compatible = "fsl,b4860-dpa-ethernet-init", "fsl,dpa-ethernet-init";
-			fsl,bman-buffer-pools = <&bp7 &bp8 &bp9>;
+			fsl,bman-buffer-pools = <&bp16>;
 			fsl,qman-frame-queues-rx = <0x54 1 0x55 1>;
 			fsl,qman-frame-queues-tx = <0x74 1 0x75 1>;
 		};
 		ethernet@3 {
 			compatible = "fsl,b4860-dpa-ethernet-init", "fsl,dpa-ethernet-init";
-			fsl,bman-buffer-pools = <&bp7 &bp8 &bp9>;
+			fsl,bman-buffer-pools = <&bp16>;
 			fsl,qman-frame-queues-rx = <0x56 1 0x57 1>;
 			fsl,qman-frame-queues-tx = <0x76 1 0x77 1>;
 		};
@@ -130,19 +128,26 @@
 		 * On receiving frame at this interface, the ethernet driver will do
 		 * kmap_atomic/kunmap_atomic for that frame. */
 		ethernet@16 {
-			compatible = "fsl,b4860-dpa-ethernet", "fsl,dpa-ethernet";
+			compatible = "fsl,b4860-dpa-ethernet-macless", "fsl,dpa-ethernet-macless";
 			fsl,bman-buffer-pools = <&bp16>;
 			fsl,qman-frame-queues-rx = <4000 8>;
 			fsl,qman-frame-queues-tx = <4008 8>;
 			local-mac-address = [00 11 22 33 44 55];
 		};
 		ethernet@17 {
-			compatible = "fsl,b4860-dpa-ethernet", "fsl,dpa-ethernet";
+			compatible = "fsl,b4860-dpa-ethernet-macless", "fsl,dpa-ethernet-macless";
 			fsl,bman-buffer-pools = <&bp16>;
 			fsl,qman-frame-queues-rx = <5000 8>;
 			fsl,qman-frame-queues-tx = <5008 8>;
 			local-mac-address = [00 11 22 33 44 66];
 		};
+		ethernet@18 {
+			compatible = "fsl,b4860-dpa-ethernet-macless", "fsl,dpa-ethernet-macless";
+			fsl,bman-buffer-pools = <&bp16>;
+			fsl,qman-frame-queues-rx = <6000 8>;
+			fsl,qman-frame-queues-tx = <6008 8>;
+			local-mac-address = [00 11 22 33 44 77];
+		};
 
 		dpa-fman0-oh@2 {
 			compatible = "fsl,dpa-oh";
@@ -152,17 +157,17 @@
 			fsl,bman-buffer-pools = <&bp16>;
 			fsl,fman-oh-port = <&fman0_oh2>;
 		};
-                dpa_fman0_oh3: dpa-fman0-oh@3 {
-                        compatible = "fsl,dpa-oh";
-                        fsl,qman-frame-queues-oh = <0x68 1 0x69 1>;
-                        fsl,bman-buffer-pools = <&bp9>;
-                        fsl,fman-oh-port = <&fman0_oh3>;
-                };
-                dpa_fman0_oh4: dpa-fman0-oh@4 {
-                        compatible = "fsl,dpa-oh";
-                        fsl,qman-frame-queues-oh = <0x70 1 0x71 1>;
-                        fsl,bman-buffer-pools = <&bp9>;
-                        fsl,fman-oh-port = <&fman0_oh4>;
-                };
+		dpa_fman0_oh3: dpa-fman0-oh@3 {
+			compatible = "fsl,dpa-oh";
+			fsl,qman-frame-queues-oh = <0x68 1 0x69 1>;
+			fsl,bman-buffer-pools = <&bp9>;
+			fsl,fman-oh-port = <&fman0_oh3>;
+		};
+		dpa_fman0_oh4: dpa-fman0-oh@4 {
+			compatible = "fsl,dpa-oh";
+			fsl,qman-frame-queues-oh = <0x70 1 0x71 1>;
+			fsl,bman-buffer-pools = <&bp9>;
+			fsl,fman-oh-port = <&fman0_oh4>;
+		};
 	};
 };
diff --git a/drivers/staging/fsl_dpa_offload/dts/b4860qds-usdpaa.dts b/drivers/staging/fsl_dpa_offload/dts/b4860qds-usdpaa.dts
index 70717b5..621b52e 100644
--- a/drivers/staging/fsl_dpa_offload/dts/b4860qds-usdpaa.dts
+++ b/drivers/staging/fsl_dpa_offload/dts/b4860qds-usdpaa.dts
@@ -77,15 +77,13 @@
 		fsl,bpid = <12>;
 		fsl,bpool-thresholds = <0x100 0x300 0x0 0x0>;
 	};
-
 	bp16: buffer-pool@16 {
-			compatible = "fsl,b4860-bpool", "fsl,bpool";
-			fsl,bpid = <16>;
-			fsl,bpool-ethernet-cfg = <0 2048 0 1728 0 0>;
-			fsl,bpool-thresholds = <0x100 0x300 0x0 0x0>;
+		compatible = "fsl,b4860-bpool", "fsl,bpool";
+		fsl,bpid = <16>;
+		fsl,bpool-ethernet-cfg = <0 2048 0 1728 0 0>;
+		fsl,bpool-thresholds = <0x100 0x300 0x0 0x0>;
 	};
 
-
 	fsl,dpaa {
 		ethernet@0 {
 			compatible = "fsl,b4860-dpa-ethernet-init", "fsl,dpa-ethernet-init";
@@ -130,14 +128,14 @@
 		 * On receiving frame at this interface, the ethernet driver will do
 		 * kmap_atomic/kunmap_atomic for that frame. */
 		ethernet@16 {
-			compatible = "fsl,b4860-dpa-ethernet", "fsl,dpa-ethernet";
+			compatible = "fsl,b4860-dpa-ethernet-macless", "fsl,dpa-ethernet-macless";
 			fsl,bman-buffer-pools = <&bp16>;
 			fsl,qman-frame-queues-rx = <4000 8>;
 			fsl,qman-frame-queues-tx = <4008 8>;
 			local-mac-address = [00 11 22 33 44 55];
 		};
 		ethernet@17 {
-			compatible = "fsl,b4860-dpa-ethernet", "fsl,dpa-ethernet";
+			compatible = "fsl,b4860-dpa-ethernet-macless", "fsl,dpa-ethernet-macless";
 			fsl,bman-buffer-pools = <&bp16>;
 			fsl,qman-frame-queues-rx = <5000 8>;
 			fsl,qman-frame-queues-tx = <5008 8>;
@@ -152,17 +150,17 @@
 			fsl,bman-buffer-pools = <&bp9>;
 			fsl,fman-oh-port = <&fman0_oh2>;
 		};
-                dpa_fman0_oh3: dpa-fman0-oh@3 {
-                        compatible = "fsl,dpa-oh";
-                        fsl,qman-frame-queues-oh = <0x68 1 0x69 1>;
-                        fsl,bman-buffer-pools = <&bp9>;
-                        fsl,fman-oh-port = <&fman0_oh3>;
-                };
-                dpa_fman0_oh4: dpa-fman0-oh@4 {
-                        compatible = "fsl,dpa-oh";
-                        fsl,qman-frame-queues-oh = <0x70 1 0x71 1>;
-                        fsl,bman-buffer-pools = <&bp9>;
-                        fsl,fman-oh-port = <&fman0_oh4>;
-                };
+		dpa_fman0_oh3: dpa-fman0-oh@3 {
+			compatible = "fsl,dpa-oh";
+			fsl,qman-frame-queues-oh = <0x68 1 0x69 1>;
+			fsl,bman-buffer-pools = <&bp9>;
+			fsl,fman-oh-port = <&fman0_oh3>;
+		};
+		dpa_fman0_oh4: dpa-fman0-oh@4 {
+			compatible = "fsl,dpa-oh";
+			fsl,qman-frame-queues-oh = <0x70 1 0x71 1>;
+			fsl,bman-buffer-pools = <&bp9>;
+			fsl,fman-oh-port = <&fman0_oh4>;
+		};
 	};
 };
diff --git a/drivers/staging/fsl_dpa_offload/dts/b4860si-chosen-offld.dtsi b/drivers/staging/fsl_dpa_offload/dts/b4860si-chosen-offld.dtsi
index b47d8fb..91ec766 100644
--- a/drivers/staging/fsl_dpa_offload/dts/b4860si-chosen-offld.dtsi
+++ b/drivers/staging/fsl_dpa_offload/dts/b4860si-chosen-offld.dtsi
@@ -10,6 +10,7 @@ chosen {
 			fman0_oh2-extd-args {
 				cell-index = <1>;
 				compatible = "fsl,fman-port-op-extended-args";
+				errors-to-discard = <0x00420000>;
 				/* Define Virtual storage profile */
 				/* <number of profiles, default profile id> */
 				vsp-window = <8 0>;
@@ -18,6 +19,7 @@ chosen {
 			fman0_oh3-extd-args {
 				cell-index = <2>;
 				compatible = "fsl,fman-port-op-extended-args";
+				errors-to-discard = <0x00420000>;
 				/* Define buffer layout parameters. Can be used
 				 * in fragmentation or header manip operations
 				 */
diff --git a/drivers/staging/fsl_dpa_offload/dts/b4860si-chosen-reass.dtsi b/drivers/staging/fsl_dpa_offload/dts/b4860si-chosen-reass.dtsi
index 934ff70..23090a4 100644
--- a/drivers/staging/fsl_dpa_offload/dts/b4860si-chosen-reass.dtsi
+++ b/drivers/staging/fsl_dpa_offload/dts/b4860si-chosen-reass.dtsi
@@ -9,6 +9,7 @@ chosen {
 			fman0_rx5-extd-args {
 				cell-index = <5>;
 				compatible = "fsl,fman-port-1g-rx-extended-args";
+				errors-to-discard = <0x00420000>;
 				/* Define Virtual storage profile */
 				/* <number of profiles, default profile id> */
 				vsp-window = <8 0>;
@@ -16,6 +17,7 @@ chosen {
 			fman0_oh2-extd-args {
 				cell-index = <1>;
 				compatible = "fsl,fman-port-op-extended-args";
+				errors-to-discard = <0x00420000>;
 				/* Define buffer layout parameters. Can be used
 				 * in fragmentation or header manip operations
 				 */
diff --git a/drivers/staging/fsl_dpa_offload/dts/b4860si-pre.dtsi b/drivers/staging/fsl_dpa_offload/dts/b4860si-pre.dtsi
index 950114b..78cb451 100644
--- a/drivers/staging/fsl_dpa_offload/dts/b4860si-pre.dtsi
+++ b/drivers/staging/fsl_dpa_offload/dts/b4860si-pre.dtsi
@@ -107,4 +107,63 @@
 			next-level-cache = <&L2>;
 		};
 	};
+
+	dsp-clusters {
+		#address-cells = <1>;
+		#size-cells = <0>;
+
+		dsp-cluster0 {
+			#address-cells = <1>;
+			#size-cells = <0>;
+			compatible = "fsl,sc3900-cluster";
+			reg = <0>;
+
+			dsp0: dsp@0 {
+				compatible = "fsl,sc3900";
+				reg = <0>;
+				next-level-cache = <&L2_2>;
+			};
+			dsp1: dsp@1 {
+				compatible = "fsl,sc3900";
+				reg = <1>;
+				next-level-cache = <&L2_2>;
+			};
+		};
+
+		dsp-cluster1 {
+			#address-cells = <1>;
+			#size-cells = <0>;
+			compatible = "fsl,sc3900-cluster";
+			reg = <1>;
+
+			dsp2: dsp@2 {
+				compatible = "fsl,sc3900";
+				reg = <2>;
+				next-level-cache = <&L2_3>;
+			};
+			dsp3: dsp@3 {
+				compatible = "fsl,sc3900";
+				reg = <3>;
+				next-level-cache = <&L2_3>;
+			};
+		};
+
+		dsp-cluster2 {
+			#address-cells = <1>;
+			#size-cells = <0>;
+			compatible = "fsl,sc3900-cluster";
+			reg = <2>;
+
+			dsp4: dsp@4 {
+				compatible = "fsl,sc3900";
+				reg = <4>;
+				next-level-cache = <&L2_4>;
+			};
+			dsp5: dsp@5 {
+				compatible = "fsl,sc3900";
+				reg = <5>;
+				next-level-cache = <&L2_4>;
+			};
+		};
+	};
 };
-- 
2.0.2

