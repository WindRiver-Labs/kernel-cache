From 4e67a8aac91801ec05bd44222f47227df854b88c Mon Sep 17 00:00:00 2001
From: Ioana Tibuleac <ioana.tibuleac@freescale.com>
Date: Fri, 25 Apr 2014 14:14:05 +0300
Subject: [PATCH 307/466] dpaa_offload: add oNIC support in dts for T4240 and
 B4420

add oNIC nodes and buffer pools for the ipsec_offload usecase

Signed-off-by: Ioana Tibuleac <ioana.tibuleac@freescale.com>
Change-Id: I28bad579d5748ec0954d02abc30b1014b3cc13e1
Reviewed-on: http://git.am.freescale.net:8181/11542
Tested-by: Review Code-CDREVIEW <CDREVIEW@freescale.com>
Reviewed-by: Marian-Cornel Chereji <marian.chereji@freescale.com>
Reviewed-by: Jose Rivera <German.Rivera@freescale.com>
[Original patch taken from QorIQ-SDK-V1.6-SOURCE-20140619-yocto.iso]
Signed-off-by: Bin Jiang <bin.jiang@windriver.com>
---
 .../dts/b4420qds-usdpaa-shared-interfaces.dts      |   21 +++++++++++++++++---
 .../dts/t4240qds-usdpaa-shared-interfaces.dts      |   21 ++++++++++++++++----
 2 files changed, 35 insertions(+), 7 deletions(-)

diff --git a/drivers/staging/fsl_dpa_offload/dts/b4420qds-usdpaa-shared-interfaces.dts b/drivers/staging/fsl_dpa_offload/dts/b4420qds-usdpaa-shared-interfaces.dts
index a279b26..c26caa0 100644
--- a/drivers/staging/fsl_dpa_offload/dts/b4420qds-usdpaa-shared-interfaces.dts
+++ b/drivers/staging/fsl_dpa_offload/dts/b4420qds-usdpaa-shared-interfaces.dts
@@ -83,6 +83,13 @@
 		fsl,bpool-ethernet-cfg = <0 2048 0 1728 0 0>;
 		fsl,bpool-thresholds = <0x100 0x300 0x0 0x0>;
 	};
+	bp17: buffer-pool@17 {
+		compatible = "fsl,b4420-bpool", "fsl,bpool";
+		fsl,bpid = <17>;
+		fsl,bpool-ethernet-cfg = <0 2048 0 1728 0 0>;
+		fsl,bpool-thresholds = <0x100 0x300 0x0 0x0>;
+		fsl,bpool-ethernet-seeds;
+	};
 
 	fsl,dpaa {
 		ethernet@0 {
@@ -136,15 +143,23 @@
                         fsl,qman-frame-queues-tx = <6008 8>;
                         local-mac-address = [00 11 22 33 44 77];
                 };
-		dpa-fman0-oh@2 {
+		ethernet@19 {
+			compatible = "fsl,b4420-dpa-ethernet-generic", "fsl,dpa-ethernet-generic";
+			fsl,qman-frame-queues-rx = <7000 2>;
+			fsl,qman-frame-queues-tx = <7008 1>;
+			fsl,oh-ports = <&oh2 &oh3>;
+			local-mac-address = [00 11 22 33 44 88];
+		};
+
+		oh2: dpa-fman0-oh@2 {
 			compatible = "fsl,dpa-oh";
 			/* Define frame queues for the OH port*/
 			/* <OH Rx error, OH Rx default> */
 			fsl,qman-frame-queues-oh = <0x6e 1 0x6f 1>;
-			fsl,bman-buffer-pools = <&bp9>;
+			fsl,bman-buffer-pools = <&bp17>;
 			fsl,fman-oh-port = <&fman0_oh2>;
 		};
-                dpa_fman0_oh3: dpa-fman0-oh@3 {
+                oh3: dpa_fman0_oh3: dpa-fman0-oh@3 {
                         compatible = "fsl,dpa-oh";
                         fsl,qman-frame-queues-oh = <0x68 1 0x69 1>;
                         fsl,bman-buffer-pools = <&bp9>;
diff --git a/drivers/staging/fsl_dpa_offload/dts/t4240qds-usdpaa-shared-interfaces.dts b/drivers/staging/fsl_dpa_offload/dts/t4240qds-usdpaa-shared-interfaces.dts
index 9253e59..a1549b4 100644
--- a/drivers/staging/fsl_dpa_offload/dts/t4240qds-usdpaa-shared-interfaces.dts
+++ b/drivers/staging/fsl_dpa_offload/dts/t4240qds-usdpaa-shared-interfaces.dts
@@ -89,6 +89,13 @@
                         fsl,bpool-ethernet-cfg = <0 2048 0 1728 0 0>;
                         fsl,bpool-thresholds = <0x100 0x300 0x0 0x0>;
        };
+    bp18: buffer-pool@18 {
+		compatible = "fsl,t4240-bpool", "fsl,bpool";
+		fsl,bpid = <18>;
+		fsl,bpool-ethernet-cfg = <0 2048 0 1728 0 0>;
+		fsl,bpool-thresholds = <0x100 0x300 0x0 0x0>;
+		fsl,bpool-ethernet-seeds;
+	};
 
 	fsl,dpaa {
 		ethernet@4 {
@@ -157,15 +164,21 @@
                         fsl,qman-frame-queues-rx = <6000 8>;
                         fsl,qman-frame-queues-tx = <6008 8>;
                         local-mac-address = [00 11 22 33 44 77];
-                };
-
+        };
+        ethernet@19 {
+			compatible = "fsl,t4240-dpa-ethernet-generic", "fsl,dpa-ethernet-generic";
+			fsl,qman-frame-queues-rx = <7000 2>;
+			fsl,qman-frame-queues-tx = <7008 1>;
+			fsl,oh-ports = <&dpa_fman0_oh2 &dpa_fman0_oh3>;
+			local-mac-address = [00 11 22 33 44 88];
+		};
 
-		dpa-fman0-oh@2 {
+		dpa_fman0_oh2: dpa-fman0-oh@2 {
 			compatible = "fsl,dpa-oh";
 			/* Define frame queues for the OH port*/
 			/* <OH Rx error, OH Rx default> */
 			fsl,qman-frame-queues-oh = <0x90 1 0x91 1>;
-			fsl,bman-buffer-pools = <&bp16>;
+			fsl,bman-buffer-pools = <&bp18>;
 			fsl,fman-oh-port = <&fman0_oh2>;
 		};
 		dpa_fman0_oh3: dpa-fman0-oh@3 {
-- 
1.7.10.4

