From 2ca6fae91e20251f1b61e82247e928a20bc333b9 Mon Sep 17 00:00:00 2001
From: Bharat Bhushan <bharat.bhushan@freescale.com>
Date: Tue, 23 Apr 2013 15:54:33 +0530
Subject: [PATCH 0218/1089] Fix the compilation error in MSI iova calculation

[Original patch taken from QorIQ-SDK-V1.6-SOURCE-20140619-yocto.iso]

There were couple of issue:
 - MSIIR address is uint64_t while it was passed to a function which expect
   this to dma_addr_t. And dma_addr_t can be 32 bit also.
 - do_div() expect uint64_t as first parameter while it was passed dma_addr_t.

Both of these changed be uint64_t.

Signed-off-by: Bharat Bhushan <bharat.bhushan@freescale.com>
Signed-off-by: Harninder Rai <harninder.rai@freescale.com>
Change-Id: Icca7eafef4fa63bc5daf355ebc0ba85a2111495a
Reviewed-on: http://git.am.freescale.net:8181/1732
Reviewed-by: Yoder Stuart-B08248 <stuart.yoder@freescale.com>
Reviewed-by: Fleming Andrew-AFLEMING <AFLEMING@freescale.com>
Tested-by: Fleming Andrew-AFLEMING <AFLEMING@freescale.com>
---
 arch/powerpc/sysdev/fsl_msi.c | 4 ++--
 1 file changed, 2 insertions(+), 2 deletions(-)

diff --git a/arch/powerpc/sysdev/fsl_msi.c b/arch/powerpc/sysdev/fsl_msi.c
index d41def8..6cd056a 100644
--- a/arch/powerpc/sysdev/fsl_msi.c
+++ b/arch/powerpc/sysdev/fsl_msi.c
@@ -179,12 +179,12 @@ static void fsl_teardown_msi_irqs(struct pci_dev *pdev)
 	return;
 }
 
-static int fsl_iommu_get_iova(struct pci_dev *pdev, dma_addr_t *address)
+static int fsl_iommu_get_iova(struct pci_dev *pdev, uint64_t *address)
 {
 	struct iommu_domain *domain;
 	struct iommu_domain_geometry geometry;
 	u32 wins = 0;
-	dma_addr_t iova, size, msi_phys;
+	uint64_t iova, size, msi_phys;
 	int ret, i;
 
 	domain = iommu_get_dev_domain(&pdev->dev);
-- 
2.0.2

