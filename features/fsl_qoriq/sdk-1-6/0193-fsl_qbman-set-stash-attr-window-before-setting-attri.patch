From cacc35a1bfdd04527282215501c491eeec6438fb Mon Sep 17 00:00:00 2001
From: Haiying Wang <Haiying.Wang@freescale.com>
Date: Mon, 24 Mar 2014 16:58:36 -0400
Subject: [PATCH 193/466] fsl_qbman: set stash attr window before setting
 attribute

This additional parameter (window number) is required based
on the latest update of pamu driver.

Signed-off-by: Haiying Wang <Haiying.Wang@freescale.com>
Change-Id: I449919d7d89f3a91b6fe120970911487006fccca
Reviewed-on: http://git.am.freescale.net:8181/10184
Reviewed-by: Varun Sethi <Varun.Sethi@freescale.com>
Tested-by: Review Code-CDREVIEW <CDREVIEW@freescale.com>
Reviewed-by: Geoff Thorpe <Geoff.Thorpe@freescale.com>
Reviewed-by: Jose Rivera <German.Rivera@freescale.com>
[Original patch taken from QorIQ-SDK-V1.6-SOURCE-20140619-yocto.iso]
Signed-off-by: Bin Jiang <bin.jiang@windriver.com>
---
 drivers/staging/fsl_qbman/qman_driver.c |    2 ++
 1 file changed, 2 insertions(+)

diff --git a/drivers/staging/fsl_qbman/qman_driver.c b/drivers/staging/fsl_qbman/qman_driver.c
index fcc5f15..da2b9d2 100644
--- a/drivers/staging/fsl_qbman/qman_driver.c
+++ b/drivers/staging/fsl_qbman/qman_driver.c
@@ -653,6 +653,8 @@ static void qman_portal_update_sdest(const struct qm_portal_config *pcfg,
 		stash_attr.cpu = cpu;
 		stash_attr.cache = IOMMU_ATTR_CACHE_L1;
 		stash_attr.window = ~(u32)0;
+		/* set stash information for the window */
+		stash_attr.window = 0;
 		ret = iommu_domain_set_attr(pcfg->iommu_domain,
 				DOMAIN_ATTR_PAMU_STASH, &stash_attr);
 		if (ret < 0) {
-- 
1.7.10.4

