From 522b0d150980d888649a3322761cc78373e467d3 Mon Sep 17 00:00:00 2001
From: Haijun Zhang <Haijun.Zhang@freescale.com>
Date: Wed, 23 Oct 2013 13:01:08 +0800
Subject: [PATCH 0584/1089] esdhc: Fix clock stable bit to 1

[Original patch taken from QorIQ-SDK-V1.6-SOURCE-20140619-yocto.iso]

Clock of esdhc host don't support clock disable and enbale.
So clock stable bit didn't behave as it mean. Just fix it
to '1' to avoid misreading.

Signed-off-by: Haijun Zhang <haijun.zhang@freescale.com>
Change-Id: Ib718005ca3419130a43cbf61c6351878b4eb4dbf
Reviewed-on: http://git.am.freescale.net:8181/5929
Tested-by: Review Code-CDREVIEW <CDREVIEW@freescale.com>
Reviewed-by: Xiaobo Xie <X.Xie@freescale.com>
Reviewed-by: Jose Rivera <German.Rivera@freescale.com>
---
 drivers/mmc/host/sdhci-of-esdhc.c | 8 ++++++++
 1 file changed, 8 insertions(+)

diff --git a/drivers/mmc/host/sdhci-of-esdhc.c b/drivers/mmc/host/sdhci-of-esdhc.c
index e4d33b9..56535db 100644
--- a/drivers/mmc/host/sdhci-of-esdhc.c
+++ b/drivers/mmc/host/sdhci-of-esdhc.c
@@ -50,6 +50,14 @@ static u32 esdhc_readl(struct sdhci_host *host, int reg)
 			ret |= SDHCI_CAN_DO_ADMA2;
 	}
 
+	/*
+	 * Clock of eSDHC host don't support to be disabled and enabled.
+	 * So clock stable bit doesn't behave as it mean, So fix it to
+	 * '1' to avoid misreading.
+	 */
+	if (reg == SDHCI_PRESENT_STATE)
+		ret |= ESDHC_CLK_STABLE;
+
 	return ret;
 }
 
-- 
2.0.2

