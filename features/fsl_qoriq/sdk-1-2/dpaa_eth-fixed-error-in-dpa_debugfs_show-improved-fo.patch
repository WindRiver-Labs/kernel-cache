From 1ad511edcea717cfad9cefdae7262dd4dff175e5 Mon Sep 17 00:00:00 2001
From: Madalin Bucur <madalin.bucur@freescale.com>
Date: Wed, 4 Apr 2012 17:40:45 +0000
Subject: [PATCH 110/128] dpaa_eth: fixed error in dpa_debugfs_show, improved
 formating

Fixed error and improved output formatting in dpa_debugfs_show()

Signed-off-by: Madalin Bucur <madalin.bucur@freescale.com>
[Kevin: Original patch taken from FSL
QorIQ-SDK-V1.2-SOURCE-20120614-yocto.iso image]
Signed-off-by: Kevin Hao <kexin.hao@windriver.com>
---
 drivers/net/ethernet/freescale/dpa/dpaa_eth.c |   30 +++++++++++++++----------
 1 file changed, 18 insertions(+), 12 deletions(-)

diff --git a/drivers/net/ethernet/freescale/dpa/dpaa_eth.c b/drivers/net/ethernet/freescale/dpa/dpaa_eth.c
index 3ed1ada..0a27716 100644
--- a/drivers/net/ethernet/freescale/dpa/dpaa_eth.c
+++ b/drivers/net/ethernet/freescale/dpa/dpaa_eth.c
@@ -2424,17 +2424,21 @@ static int __cold dpa_debugfs_show(struct seq_file *file, void *offset)
 	priv = netdev_priv((struct net_device *)file->private);
 
 	dpa_bp = priv->dpa_bp;
-	/* Only private interfaces have an associated counter for bp buffers */
-	if (!priv->shared)
-		dpa_bp_count = *percpu_priv->dpa_bp_count;
 
 	memset(&total, 0, sizeof(total));
 
-	seq_printf(file, "\tirqs\trx\ttx\trecycle\tconfirm\ttx err\trx err" \
-		"\tbp count\n");
+	seq_printf(file, "\nDPA counters for %s:\n"
+		"CPU           irqs        rx        tx   recycle" \
+		"   confirm    tx err    rx err  bp count\n",
+		priv->net_dev->name);
 	for_each_online_cpu(i) {
 		percpu_priv = per_cpu_ptr(priv->percpu_priv, i);
 
+		/* Only private interfaces have an associated counter for bp
+		 * buffers */
+		if (!priv->shared)
+			dpa_bp_count = *percpu_priv->dpa_bp_count;
+
 		total.in_interrupt += percpu_priv->in_interrupt;
 		total.ingress_calls += percpu_priv->stats.rx_packets;
 		total.stats.tx_packets += percpu_priv->stats.tx_packets;
@@ -2444,8 +2448,8 @@ static int __cold dpa_debugfs_show(struct seq_file *file, void *offset)
 		total.stats.rx_errors += percpu_priv->stats.rx_errors;
 		count_total += dpa_bp_count;
 
-		seq_printf(file, "%hu/%hu\t%u\t%lu\t%lu\t%u\t%u\t%lu\t%lu" \
-				"\t%d\n",
+		seq_printf(file, "     %hu/%hu  %8u  %8lu  %8lu  %8u  %8u" \
+				"  %8lu  %8lu  %8d\n",
 				get_hard_smp_processor_id(i), i,
 				percpu_priv->in_interrupt,
 				percpu_priv->stats.rx_packets,
@@ -2456,7 +2460,8 @@ static int __cold dpa_debugfs_show(struct seq_file *file, void *offset)
 				percpu_priv->stats.rx_errors,
 				dpa_bp_count);
 	}
-	seq_printf(file, "Total\t%u\t%u\t%lu\t%u\t%u\t%lu\t%lu\t%d\n",
+	seq_printf(file, "Total     %8u  %8u  %8lu  %8u  %8u  %8lu  %8lu" \
+				"  %8d\n",
 			total.in_interrupt,
 			total.ingress_calls,
 			total.stats.tx_packets,
@@ -2466,8 +2471,8 @@ static int __cold dpa_debugfs_show(struct seq_file *file, void *offset)
 			total.stats.rx_errors,
 			count_total);
 
-	seq_printf(file, "\nDPA RX Errors:\n\tdma err\tphy err\tsiz err" \
-				"\thdr err\tcsum err\n");
+	seq_printf(file, "\nDPA RX Errors:\nCPU        dma err   phy err" \
+				"  size err   hdr err  csum err\n");
 		for_each_online_cpu(i) {
 			percpu_priv = per_cpu_ptr(priv->percpu_priv, i);
 
@@ -2477,7 +2482,8 @@ static int __cold dpa_debugfs_show(struct seq_file *file, void *offset)
 			total.rx_errors.phe += percpu_priv->rx_errors.phe;
 			total.rx_errors.cse += percpu_priv->rx_errors.cse;
 
-			seq_printf(file, "%hu/%hu\t%u\t%u\t%u\t%u\t%u\n",
+			seq_printf(file, "     %hu/%hu  %8u  %8u  %8u" \
+						"  %8u  %8u\n",
 					get_hard_smp_processor_id(i), i,
 					percpu_priv->rx_errors.dme,
 					percpu_priv->rx_errors.fpe,
@@ -2485,7 +2491,7 @@ static int __cold dpa_debugfs_show(struct seq_file *file, void *offset)
 					percpu_priv->rx_errors.phe,
 					percpu_priv->rx_errors.cse);
 		}
-		seq_printf(file, "Total\t%u\t%u\t%u\t%u\t%u\n",
+		seq_printf(file, "Total     %8u  %8u  %8u  %8u  %8u\n",
 				total.rx_errors.dme,
 				total.rx_errors.fpe,
 				total.rx_errors.fse,
-- 
1.7.9.7

