From 2394e233db390e0917303b2ff3477ed665b0d2ec Mon Sep 17 00:00:00 2001
From: Scott Wood <scottwood@freescale.com>
Date: Sat, 2 Jun 2012 00:01:10 +0000
Subject: [PATCH 029/121] powerpc/fsl-pci: only build fsl_pci_mcheck_exception
 on e500

It's only called on e500, but was previously built unconditionally
in fsl_pci.c, causing build failures because SPRN_MCAR is only defined
on booke builds.

The breakage was introduced by "powerpc/85xx: Add machine check handler to
fix PCIe erratum on mpc85xx".

Signed-off-by: Scott Wood <scottwood@freescale.com>
[Kevin: Original patch taken from FSL
QorIQ-SDK-V1.2-SOURCE-20120614-yocto.iso image]
Signed-off-by: Kevin Hao <kexin.hao@windriver.com>
---
 arch/powerpc/sysdev/fsl_pci.c |    2 ++
 1 file changed, 2 insertions(+)

diff --git a/arch/powerpc/sysdev/fsl_pci.c b/arch/powerpc/sysdev/fsl_pci.c
index 284512b..1837248 100644
--- a/arch/powerpc/sysdev/fsl_pci.c
+++ b/arch/powerpc/sysdev/fsl_pci.c
@@ -851,6 +851,7 @@ u64 fsl_pci_immrbar_base(struct pci_controller *hose)
 	return 0;
 }
 
+#ifdef CONFIG_E500
 static int is_in_pci_mem_space(phys_addr_t addr)
 {
 	struct pci_controller *hose;
@@ -885,6 +886,7 @@ int fsl_pci_mcheck_exception(struct pt_regs *regs)
 
 	return 0;
 }
+#endif
 
 static const struct of_device_id pci_ids[] = {
 	{ .compatible = "fsl,mpc8540-pci", },
-- 
1.7.9.7

