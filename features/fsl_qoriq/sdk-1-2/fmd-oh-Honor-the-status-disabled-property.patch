From 3607d77c2da9cb34604e2ca8d12b161c58223e86 Mon Sep 17 00:00:00 2001
From: Stefan Szabo <szbs001@freescale.com>
Date: Thu, 17 May 2012 14:21:49 +0000
Subject: [PATCH 080/128] fmd: oh - Honor the status = "disabled" property

Signed-off-by: Stefan Szabo <szbs001@freescale.com>
[Kevin: Original patch taken from FSL
QorIQ-SDK-V1.2-SOURCE-20120614-yocto.iso image]
Signed-off-by: Kevin Hao <kexin.hao@windriver.com>
---
 .../dpa/NetCommSw/src/wrapper/lnxwrp_resources.c   |   12 ++++++++----
 1 file changed, 8 insertions(+), 4 deletions(-)

diff --git a/drivers/net/ethernet/freescale/dpa/NetCommSw/src/wrapper/lnxwrp_resources.c b/drivers/net/ethernet/freescale/dpa/NetCommSw/src/wrapper/lnxwrp_resources.c
index 8a86f2d..1aab8e3 100644
--- a/drivers/net/ethernet/freescale/dpa/NetCommSw/src/wrapper/lnxwrp_resources.c
+++ b/drivers/net/ethernet/freescale/dpa/NetCommSw/src/wrapper/lnxwrp_resources.c
@@ -187,11 +187,15 @@ int fm_set_active_fman_ports(struct platform_device *of_dev,
 	 * If active, set their parameters. */
 	for_each_child_of_node(fm_node, fm_port_node) {
 
+		if (!of_device_is_available(fm_port_node))
+			continue;
+
 		/* OH FMan ports */
 		if (of_device_is_compatible(fm_port_node,
-						"fsl,fman-port-oh"))
-			/* all oh ports are active */
+					    "fsl,fman-port-oh")) {
 			p_LnxWrpFmDev->fm_active_ports_info.num_oh_ports++;
+			continue;
+		}
 
 		if (!is_fman_port_active(fm_node, fm_port_node))
 			continue;
@@ -1063,14 +1067,14 @@ int fm_precalculate_tnums(t_LnxWrpFmDev *p_LnxWrpFmDev, int max_fm_tnums)
 		}
 	}
 
-	tnums_computed = 
+	tnums_computed =
 		num_1g_ports * tx_1g_tnums +
 		num_1g_ports * rx_1g_tnums +
 		num_2g5_ports * tx_2g5_tnums +
 		num_2g5_ports * rx_2g5_tnums +
 		num_10g_ports * tx_10g_tnums +
 		num_10g_ports * rx_10g_tnums +
-		num_oh_ports * oh_tnums + 
+		num_oh_ports * oh_tnums +
 		shared_ext_tnums;
 
 	if (leftovers > 0)
-- 
1.7.9.7

