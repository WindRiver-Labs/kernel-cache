From 2b04c0cfd092e0291a5d1070a15acdb92bac2bd6 Mon Sep 17 00:00:00 2001
From: stefan szabo <szbs001@freescale.com>
Date: Tue, 6 Dec 2011 18:46:56 +0000
Subject: [PATCH 099/128] dpaa_eth: Fix possible NULL-pointer dereference

Fix potential dereference of null pointer 'prev'. Issue found via static
analysis tools

Signed-off-by: Stefan Szabo <szbs001@freescale.com>
[Kevin: Original patch taken from FSL
QorIQ-SDK-V1.2-SOURCE-20120614-yocto.iso image]
Signed-off-by: Kevin Hao <kexin.hao@windriver.com>
---
 drivers/net/ethernet/freescale/dpa/dpaa_eth.c |   13 ++++++++-----
 1 file changed, 8 insertions(+), 5 deletions(-)

diff --git a/drivers/net/ethernet/freescale/dpa/dpaa_eth.c b/drivers/net/ethernet/freescale/dpa/dpaa_eth.c
index e71ea3a..2df39c4 100644
--- a/drivers/net/ethernet/freescale/dpa/dpaa_eth.c
+++ b/drivers/net/ethernet/freescale/dpa/dpaa_eth.c
@@ -2806,11 +2806,14 @@ static ssize_t dpaa_eth_show_fqids(struct device *dev,
 		i++;
 	}
 
-	if (last_fqid == first_fqid)
-		bytes += sprintf(buf + bytes, "%s: %d\n", prevstr, prev->fqid);
-	else
-		bytes += sprintf(buf + bytes, "%s: %d - %d\n", prevstr,
-				first_fqid, last_fqid);
+	if (prev) {
+		if (last_fqid == first_fqid)
+			bytes += sprintf(buf + bytes, "%s: %d\n", prevstr,
+					prev->fqid);
+		else
+			bytes += sprintf(buf + bytes, "%s: %d - %d\n", prevstr,
+					first_fqid, last_fqid);
+	}
 
 	return bytes;
 }
-- 
1.7.9.7

