From 4279e1701491d419528b51328d22d0019659bf8a Mon Sep 17 00:00:00 2001
From: Geoff Thorpe <Geoff.Thorpe@freescale.com>
Date: Wed, 14 Mar 2012 04:49:53 +0000
Subject: [PATCH 087/121] bman: remove unused code.

The bman portal initialisation code used to handle a 'pools' parameter
from the caller that could be NULL. Now, however, that parameter is gone
and is replaced by a local variable that is always non-NULL, so this
change removes the handling for the NULL case.

Signed-off-by: Geoff Thorpe <Geoff.Thorpe@freescale.com>
[Kevin: Original patch taken from FSL
QorIQ-SDK-V1.2-SOURCE-20120614-yocto.iso image]
Signed-off-by: Kevin Hao <kexin.hao@windriver.com>
---
 drivers/staging/fsl_qbman/bman_high.c |   26 +++++++++++---------------
 1 file changed, 11 insertions(+), 15 deletions(-)

diff --git a/drivers/staging/fsl_qbman/bman_high.c b/drivers/staging/fsl_qbman/bman_high.c
index bfaa7ee..fcc2c57 100644
--- a/drivers/staging/fsl_qbman/bman_high.c
+++ b/drivers/staging/fsl_qbman/bman_high.c
@@ -197,6 +197,7 @@ struct bman_portal *bman_create_affine_portal(
 	struct bm_portal *__p = &portal->p;
 	const struct bman_depletion *pools = &config->public_cfg.mask;
 	int ret;
+	u8 bpid = 0;
 
 	/* prep the low-level portal struct with the mapped addresses from the
 	 * config, everything that follows depends on it and "config" is more
@@ -215,21 +216,16 @@ struct bman_portal *bman_create_affine_portal(
 		pr_err("Bman ISR initialisation failed\n");
 		goto fail_isr;
 	}
-	if (!pools)
-		portal->pools = NULL;
-	else {
-		u8 bpid = 0;
-		portal->pools = kmalloc(2 * sizeof(*pools), GFP_KERNEL);
-		if (!portal->pools)
-			goto fail_pools;
-		portal->pools[0] = *pools;
-		bman_depletion_init(portal->pools + 1);
-		while (bpid < bman_pool_max) {
-			/* Default to all BPIDs disabled, we enable as required
-			 * at run-time. */
-			bm_isr_bscn_mask(__p, bpid, 0);
-			bpid++;
-		}
+	portal->pools = kmalloc(2 * sizeof(*pools), GFP_KERNEL);
+	if (!portal->pools)
+		goto fail_pools;
+	portal->pools[0] = *pools;
+	bman_depletion_init(portal->pools + 1);
+	while (bpid < bman_pool_max) {
+		/* Default to all BPIDs disabled, we enable as required at
+		 * run-time. */
+		bm_isr_bscn_mask(__p, bpid, 0);
+		bpid++;
 	}
 	portal->slowpoll = 0;
 #ifdef CONFIG_FSL_DPA_CAN_WAIT_SYNC
-- 
1.7.9.7

