From 097ac457a81c0b60cfab778b1a0d1cb191791115 Mon Sep 17 00:00:00 2001
From: Stefan Szabo <szbs001@freescale.com>
Date: Mon, 2 Apr 2012 14:50:54 +0300
Subject: [PATCH 077/128] fmd: Fixed possible lnxwrp OOB array access.

This is some vulnerability that can crash the kernel if an Offline
Parsing port ID of 7 is used with this IOCTL, given that out of the
total of 7 O/H ports one is used as H/C (port_id=0), and only 6
are available for offline parsing, with the IDs ranging from 1 to 6,
as far as this API goes.

Signed-off-by: Stefan Szabo <szbs001@freescale.com>
[Kevin: Original patch taken from FSL
QorIQ-SDK-V1.2-SOURCE-20120614-yocto.iso image]
Signed-off-by: Kevin Hao <kexin.hao@windriver.com>
---
 .../dpa/NetCommSw/src/wrapper/lnxwrp_ioctls_fm.c   |    2 +-
 1 file changed, 1 insertion(+), 1 deletion(-)

diff --git a/drivers/net/ethernet/freescale/dpa/NetCommSw/src/wrapper/lnxwrp_ioctls_fm.c b/drivers/net/ethernet/freescale/dpa/NetCommSw/src/wrapper/lnxwrp_ioctls_fm.c
index 4a61b16..f9c82059 100644
--- a/drivers/net/ethernet/freescale/dpa/NetCommSw/src/wrapper/lnxwrp_ioctls_fm.c
+++ b/drivers/net/ethernet/freescale/dpa/NetCommSw/src/wrapper/lnxwrp_ioctls_fm.c
@@ -1195,7 +1195,7 @@ static t_Error LnxwrpFmPcdIOCTL(t_LnxWrpFmDev *p_LnxWrpFmDev, unsigned int cmd,
                         goto invalid_port_id;
 
                     case (e_IOC_FM_PORT_TYPE_OFFLINE_PARSING):
-                        if (port_params->port_id && port_params->port_id <= FM_MAX_NUM_OF_OH_PORTS) {
+                        if (port_params->port_id && port_params->port_id < FM_MAX_NUM_OF_OH_PORTS) {
                             h_Port = p_LnxWrpFmDev->opPorts[port_params->port_id - 1].h_Dev;
                             break;
                         }
-- 
1.7.9.7

