From 155c97fd4a42ba448146f19672147ece5d248a19 Mon Sep 17 00:00:00 2001
From: Ioana Radulescu <ruxandra.radulescu@freescale.com>
Date: Thu, 26 Jan 2012 15:06:36 +0200
Subject: [PATCH 093/128] dpaa_eth: Replace a memset in dpa_tx()

Replace memsetting a frame descriptor to zero in dpa_tx()
with individual assignments of the fd fields.

While less pretty, it yields about 1-1.5% performance improvement
in forwarding scenarios.

Signed-off-by: Ioana Radulescu <ruxandra.radulescu@freescale.com>
[Kevin: Original patch taken from FSL
QorIQ-SDK-V1.2-SOURCE-20120614-yocto.iso image]
Signed-off-by: Kevin Hao <kexin.hao@windriver.com>
---
 drivers/net/ethernet/freescale/dpa/dpaa_eth.c |   10 +++++++++-
 1 file changed, 9 insertions(+), 1 deletion(-)

diff --git a/drivers/net/ethernet/freescale/dpa/dpaa_eth.c b/drivers/net/ethernet/freescale/dpa/dpaa_eth.c
index f1dfc80..675a121 100644
--- a/drivers/net/ethernet/freescale/dpa/dpaa_eth.c
+++ b/drivers/net/ethernet/freescale/dpa/dpaa_eth.c
@@ -1229,6 +1229,14 @@ buf_acquire_failed:
 	return err;
 }
 
+/* Equivalent to a memset(0), but works faster */
+static inline void clear_fd(struct qm_fd *fd)
+{
+	fd->opaque_addr = 0;
+	fd->opaque = 0;
+	fd->cmd = 0;
+}
+
 static int __hot dpa_tx(struct sk_buff *skb, struct net_device *net_dev)
 {
 	struct dpa_priv_s	*priv;
@@ -1247,7 +1255,7 @@ static int __hot dpa_tx(struct sk_buff *skb, struct net_device *net_dev)
 	percpu_priv = per_cpu_ptr(priv->percpu_priv, smp_processor_id());
 	dev = net_dev->dev.parent;
 
-	memset(&fd, 0, sizeof(fd));
+	clear_fd(&fd);
 	fd.format = qm_fd_contig;
 
 	headroom = skb_headroom(skb);
-- 
1.7.9.7

