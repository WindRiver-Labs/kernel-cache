From a0e2c2a052db51a212173995c5c221fb97a79887 Mon Sep 17 00:00:00 2001
From: Shengzhou Liu <Shengzhou.Liu@freescale.com>
Date: Mon, 23 Apr 2012 13:10:19 +0000
Subject: [PATCH 122/128] dpaa_eth: Set the timestamp granularity to 5 nsec

For better performance, we update timestamp granularity to 5 nsec from
original 10 nsec, now ptp nominal frequency is 200MHz

Signed-off-by: Shengzhou Liu <Shengzhou.Liu@freescale.com>
[Kevin: Original patch taken from FSL
QorIQ-SDK-V1.2-SOURCE-20120614-yocto.iso image]
Signed-off-by: Kevin Hao <kexin.hao@windriver.com>
---
 .../dpa/NetCommSw/src/wrapper/lnxwrp_fm.c          |    2 +-
 drivers/net/ethernet/freescale/dpa/dpaa_1588.h     |    2 +-
 2 files changed, 2 insertions(+), 2 deletions(-)

diff --git a/drivers/net/ethernet/freescale/dpa/NetCommSw/src/wrapper/lnxwrp_fm.c b/drivers/net/ethernet/freescale/dpa/NetCommSw/src/wrapper/lnxwrp_fm.c
index 7208a3a..9b84edf 100644
--- a/drivers/net/ethernet/freescale/dpa/NetCommSw/src/wrapper/lnxwrp_fm.c
+++ b/drivers/net/ethernet/freescale/dpa/NetCommSw/src/wrapper/lnxwrp_fm.c
@@ -787,7 +787,7 @@ static t_Error InitFmDev(t_LnxWrpFmDev  *p_LnxWrpFmDev)
         if(!(p_LnxWrpFmDev->h_RtcDev = FM_RTC_Config(&fmRtcParam)))
             RETURN_ERROR(MAJOR, E_INVALID_HANDLE, ("FM-RTC"));
 
-	if (FM_RTC_ConfigPeriod(p_LnxWrpFmDev->h_RtcDev, 10) != E_OK)
+	if (FM_RTC_ConfigPeriod(p_LnxWrpFmDev->h_RtcDev, 5) != E_OK)
 	    RETURN_ERROR(MAJOR, E_INVALID_STATE, ("FM-RTC"));
 
         if (FM_RTC_Init(p_LnxWrpFmDev->h_RtcDev) != E_OK)
diff --git a/drivers/net/ethernet/freescale/dpa/dpaa_1588.h b/drivers/net/ethernet/freescale/dpa/dpaa_1588.h
index e57126f..ac2fc73 100644
--- a/drivers/net/ethernet/freescale/dpa/dpaa_1588.h
+++ b/drivers/net/ethernet/freescale/dpa/dpaa_1588.h
@@ -89,7 +89,7 @@ enum {
 #define DPA_VLAN_TAG_LEN		4
 
 #define DPA_PTP_TIMESTAMP_OFFSET	0x30
-#define DPA_PTP_NOMINAL_FREQ_PERIOD	0xa /* 10ns -> 100M */
+#define DPA_PTP_NOMINAL_FREQ_PERIOD	5  /* 5ns -> 200M */
 #define NANOSEC_PER_SECOND		1000000000
 
 /* Struct needed to identify a timestamp */
-- 
1.7.9.7

