From c4a7501cbdfa79a46bafe3fb8695307c62f9941d Mon Sep 17 00:00:00 2001
From: Claudiu Manoil <claudiu.manoil@freescale.com>
Date: Wed, 23 May 2012 19:20:15 +0300
Subject: [PATCH 22/27] gianfar: Remove Tx NAPI when RX_TX_BUFF_XCHG used

This avoids useless netif_napi_add() and napi_enable/disable()
calls when the RX_TX_BUFF_XCHG optimization is selected.

Signed-off-by: Claudiu Manoil <claudiu.manoil@freescale.com>
---
 drivers/net/ethernet/freescale/gianfar.c |    3 +++
 1 file changed, 3 insertions(+)

diff --git a/drivers/net/ethernet/freescale/gianfar.c b/drivers/net/ethernet/freescale/gianfar.c
index 53a35da..d265385 100644
--- a/drivers/net/ethernet/freescale/gianfar.c
+++ b/drivers/net/ethernet/freescale/gianfar.c
@@ -4423,6 +4423,9 @@ static int __init gfar_init(void)
 	gfar_global_recycle_cntxt = gfar_init_recycle_cntxt();
 	if (!gfar_global_recycle_cntxt)
 		return -ENOMEM;
+#ifdef CONFIG_RX_TX_BUFF_XCHG
+	tx_napi_enabled = 0;
+#endif
 	return platform_driver_register(&gfar_driver);
 }
 
-- 
1.7.9.7

