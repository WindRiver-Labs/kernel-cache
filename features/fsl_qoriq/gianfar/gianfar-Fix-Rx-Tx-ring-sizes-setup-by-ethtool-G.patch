From 57b4c540747f2ba99814fde3a2ec3ced18c618c1 Mon Sep 17 00:00:00 2001
From: Claudiu Manoil <claudiu.manoil@freescale.com>
Date: Thu, 26 Apr 2012 09:43:00 +0300
Subject: [PATCH 10/27] gianfar: Fix Rx/Tx ring sizes setup by ethtool -G

Remove the assumption that num_rx_queues==num_tx_queues
from ethtool -G option. Rx and Tx ring sizes shall be
configured independently by ethtool, according to the
corresponding num_rx_queues and resp. num_tx_queues values.

Signed-off-by: Claudiu Manoil <claudiu.manoil@freescale.com>
[Kevin: Original patch taken from FSL
QorIQ-SDK-V1.2-SOURCE-20120614-yocto.iso image]
Signed-off-by: Kevin Hao <kexin.hao@windriver.com>
---
 drivers/net/ethernet/freescale/gianfar_ethtool.c |    4 +++-
 1 file changed, 3 insertions(+), 1 deletion(-)

diff --git a/drivers/net/ethernet/freescale/gianfar_ethtool.c b/drivers/net/ethernet/freescale/gianfar_ethtool.c
index b2d1e16..59f4c2f 100644
--- a/drivers/net/ethernet/freescale/gianfar_ethtool.c
+++ b/drivers/net/ethernet/freescale/gianfar_ethtool.c
@@ -507,8 +507,10 @@ static int gfar_sringparam(struct net_device *dev, struct ethtool_ringparam *rva
 	}
 
 	/* Change the size */
-	for (i = 0; i < priv->num_rx_queues; i++) {
+	for (i = 0; i < priv->num_rx_queues; i++)
 		priv->rx_queue[i]->rx_ring_size = rvals->rx_pending;
+
+	for (i = 0; i < priv->num_tx_queues; i++) {
 		priv->tx_queue[i]->tx_ring_size = rvals->tx_pending;
 		priv->tx_queue[i]->num_txbdfree = priv->tx_queue[i]->tx_ring_size;
 	}
-- 
1.7.9.7

