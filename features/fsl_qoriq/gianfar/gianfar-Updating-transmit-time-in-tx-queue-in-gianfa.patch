From 49aab64301d1c6e9d0e0b83042e462ca24756bac Mon Sep 17 00:00:00 2001
From: Tiejun Chen <tiejun.chen@windriver.com>
Date: Wed, 12 Sep 2012 15:38:29 +0800
Subject: [PATCH 25/27] gianfar: Updating transmit time in tx queue in gianfar
 driver

In RX_TX_BUFF_XCHG flag transmit queue is selected in the
gfar_start_xmit function based on the processor id to avoid
taking lock while transmitting the packet.
As transmit queue selected in driver, networking stack is
not updating the time stamp for the tramsmit queue.
Updating the time stamp in transmit queue in gfar_start_xmit
and gfar_fast_xmit functions.

Signed-off-by: Rajan Gupta <rajan.gupta@freescale.com>
[Kevin: Original patch taken from FSL
QorIQ-SDK-V1.2-SOURCE-20120614-yocto.iso image]
Signed-off-by: Kevin Hao <kexin.hao@windriver.com>
Signed-off-by: Tiejun Chen <tiejun.chen@windriver.com>
---
 drivers/net/ethernet/freescale/gianfar.c |    1 +
 1 file changed, 1 insertion(+)

diff --git a/drivers/net/ethernet/freescale/gianfar.c b/drivers/net/ethernet/freescale/gianfar.c
index 90f3c78..e9841aa 100644
--- a/drivers/net/ethernet/freescale/gianfar.c
+++ b/drivers/net/ethernet/freescale/gianfar.c
@@ -2985,6 +2985,7 @@ static int gfar_start_xmit(struct sk_buff *skb, struct net_device *dev)
 		skb->owner = KER_PKT_ID;
 }
 	skb->new_skb = new_skb;
+	txq->trans_start = jiffies;
 #endif
 
 	return NETDEV_TX_OK;
-- 
1.7.9.7

