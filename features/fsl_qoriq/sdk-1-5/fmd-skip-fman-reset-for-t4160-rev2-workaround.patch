From d745f4a72daf4b9bc066d5b8f2e38d7c579ce8da Mon Sep 17 00:00:00 2001
From: Mandy Lavi <mandy.lavi@freescale.com>
Date: Fri, 29 Nov 2013 12:10:46 +0200
Subject: [PATCH 349/383] fmd: skip fman reset for t4160 rev2 (workaround)

This is a workaround till a proper reset procedure is put in place.
This issue concerns T4 rev2 only

Change-Id: Id815666770b33291b35ab7a9c24932d0f23f3c5a
Signed-off-by: Mandy Lavi <mandy.lavi@freescale.com>
Reviewed-on: http://git.am.freescale.net:8181/6963
Tested-by: Review Code-CDREVIEW <CDREVIEW@freescale.com>
Reviewed-by: Tiefei Zang <roy.zang@freescale.com>
Reviewed-by: Thomas Trefny <Tom.Trefny@freescale.com>
[Original patch taken from QorIQ-SDK-V1.5-SOURCE-20131219-yocto.iso]
Signed-off-by: Bin Jiang <bin.jiang@windriver.com>
---
 .../ethernet/freescale/fman/Peripherals/FM/fm.c    |    3 ++-
 1 files changed, 2 insertions(+), 1 deletions(-)

diff --git a/drivers/net/ethernet/freescale/fman/Peripherals/FM/fm.c b/drivers/net/ethernet/freescale/fman/Peripherals/FM/fm.c
index e321adb..eecf998 100644
--- a/drivers/net/ethernet/freescale/fman/Peripherals/FM/fm.c
+++ b/drivers/net/ethernet/freescale/fman/Peripherals/FM/fm.c
@@ -3515,7 +3515,8 @@ t_Error FM_Init(t_Handle h_Fm)
     {
 	u32 svr = mfspr(SPRN_SVR);
 
-	if (SVR_SOC_VER(svr) == SVR_T4240 && SVR_REV(svr) > 0x10) {
+	if ((SVR_SOC_VER(svr) == SVR_T4240 && SVR_REV(svr) > 0x10) ||
+	    (SVR_SOC_VER(svr) == SVR_T4160 && SVR_REV(svr) > 0x10)) {
 		DBG(WARNING, ("Hack: No FM reset!\n"));
 	} else {
 		WRITE_UINT32(p_Fm->p_FmFpmRegs->fm_rstc, FPM_RSTC_FM_RESET);
-- 
1.7.5.4

