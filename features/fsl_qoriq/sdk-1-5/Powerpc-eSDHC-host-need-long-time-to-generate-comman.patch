From 7a4df3d0532557e6821f040a743d2e0175088142 Mon Sep 17 00:00:00 2001
From: "Haijun.Zhang" <Haijun.Zhang@freescale.com>
Date: Sun, 9 Jun 2013 12:52:39 +0800
Subject: [PATCH 025/383] Powerpc/eSDHC: host need long time to generate
 command complete interrupt

According to Spec 2.0, command complete interrupt will be generate within
150 SD-CLK. But this was not long enough for P5020 board. So add quirk
SDHCI_QUIRK2_LONG_TIME_CMD_COMPLETE_IRQ to enlarge this detect time to avoid
hardware timeout error.

Signed-off-by: Haijun Zhang <Haijun.Zhang@freescale.com>
Change-Id: Ic88976d277b932550fa0a144ace0b01476e40bb4
Reviewed-on: http://git.am.freescale.net:8181/2906
Tested-by: Review Code-CDREVIEW <CDREVIEW@freescale.com>
Reviewed-by: Xie Xiaobo-R63061 <X.Xie@freescale.com>
Reviewed-by: Fleming Andrew-AFLEMING <AFLEMING@freescale.com>
[Original patch taken from QorIQ-SDK-V1.5-SOURCE-20131219-yocto.iso]
Signed-off-by: Bin Jiang <bin.jiang@windriver.com>
---
 drivers/mmc/host/sdhci-pltfm.c |    3 +++
 1 files changed, 3 insertions(+), 0 deletions(-)

diff --git a/drivers/mmc/host/sdhci-pltfm.c b/drivers/mmc/host/sdhci-pltfm.c
index 7ef5d0e..b58a811 100644
--- a/drivers/mmc/host/sdhci-pltfm.c
+++ b/drivers/mmc/host/sdhci-pltfm.c
@@ -102,6 +102,9 @@ void sdhci_get_of_property(struct platform_device *pdev)
 			host->quirks |= SDHCI_QUIRK_BROKEN_ADMA;
 		}
 
+		if (of_device_is_compatible(np, "fsl,p5020-esdhc"))
+			host->quirks2 |= SDHCI_QUIRK2_LONG_TIME_CMD_COMPLETE_IRQ;
+
 		if (of_device_is_compatible(np, "fsl,p5040-esdhc") ||
 			of_device_is_compatible(np, "fsl,p4080-esdhc") ||
 			of_device_is_compatible(np, "fsl,p1020-esdhc"))
-- 
1.7.5.4

