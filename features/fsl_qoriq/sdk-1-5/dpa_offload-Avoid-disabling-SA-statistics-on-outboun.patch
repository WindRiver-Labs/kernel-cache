From 7df14365112881e60ccb2413f36ccbcf13a3af0a Mon Sep 17 00:00:00 2001
From: Marian Chereji <marian.chereji@freescale.com>
Date: Tue, 26 Nov 2013 13:53:25 +0200
Subject: [PATCH 374/429] dpa_offload: Avoid disabling SA statistics on
 outbound during rekeying

The SA statistics were accidentally disabled during rekeying on
outbound SA. All statistics requests on outbound SAs that previously
went through a rekeying process would fail. This is because the
function "fill_cls_action_enq" was called with the wrong argument.

Signed-off-by: Marian Chereji <marian.chereji@freescale.com>
Change-Id: I7ba496b447de9d0cb4dfa9bc1c754be37866bbf0
Reviewed-on: http://git.am.freescale.net:8181/6864
Reviewed-by: Radu-Andrei Bulie <Radu.Bulie@freescale.com>
Tested-by: Review Code-CDREVIEW <CDREVIEW@freescale.com>
Reviewed-by: Thomas Trefny <Tom.Trefny@freescale.com>
[origin patch is from QorIQ-SDK-V1.5-20131219-yocto]
Signed-off-by: Yang Wei <Wei.Yang@windriver.com>
---
 drivers/staging/fsl_dpa_offload/dpa_ipsec.c |    3 ++-
 1 files changed, 2 insertions(+), 1 deletions(-)

diff --git a/drivers/staging/fsl_dpa_offload/dpa_ipsec.c b/drivers/staging/fsl_dpa_offload/dpa_ipsec.c
index 84a4497..1ce8dd6 100644
--- a/drivers/staging/fsl_dpa_offload/dpa_ipsec.c
+++ b/drivers/staging/fsl_dpa_offload/dpa_ipsec.c
@@ -1798,7 +1798,8 @@ set_manipulation:
 			pol_hmd = sa->ipsec_hmd;
 
 		memset(&action, 0, sizeof(action));
-		fill_cls_action_enq(&action, FALSE,
+		fill_cls_action_enq(&action,
+				    (sa->enable_extended_stats)? TRUE: FALSE,
 				    qman_fq_fqid((sa->to_sec_fq)), pol_hmd);
 
 		memset(&params, 0, sizeof(params));
-- 
1.7.5.4

