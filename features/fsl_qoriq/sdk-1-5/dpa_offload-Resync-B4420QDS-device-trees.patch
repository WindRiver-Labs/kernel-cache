From c89642cd2c35a0d29c0a938b6881acfc210efb3e Mon Sep 17 00:00:00 2001
From: Marian Chereji <marian.chereji@freescale.com>
Date: Thu, 17 Oct 2013 11:22:09 +0300
Subject: [PATCH 237/383] dpa_offload: Resync B4420QDS device trees

Updated the B4420QDS device trees to work with linux kernel 3.10.

Signed-off-by: Marian Chereji <marian.chereji@freescale.com>
Change-Id: I4c334a8172dfdf814fefb44ee87540ab2397ec94
Reviewed-on: http://git.am.freescale.net:8181/5739
Tested-by: Review Code-CDREVIEW <CDREVIEW@freescale.com>
Reviewed-by: Aurelian Zanoschi <Aurelian.Zanoschi@freescale.com>
Reviewed-by: Rivera Jose-B46482 <German.Rivera@freescale.com>
[Original patch taken from QorIQ-SDK-V1.5-SOURCE-20131219-yocto.iso]
Signed-off-by: Bin Jiang <bin.jiang@windriver.com>
---
 .../dts/b4420qds-usdpaa-shared-interfaces.dts      |   16 +++++-------
 .../fsl_dpa_offload/dts/b4420qds-usdpaa.dts        |    5 +--
 .../staging/fsl_dpa_offload/dts/b4420si-pre.dtsi   |   24 ++++++++++++++++++++
 3 files changed, 33 insertions(+), 12 deletions(-)

diff --git a/drivers/staging/fsl_dpa_offload/dts/b4420qds-usdpaa-shared-interfaces.dts b/drivers/staging/fsl_dpa_offload/dts/b4420qds-usdpaa-shared-interfaces.dts
index f141931..8eb4a77 100644
--- a/drivers/staging/fsl_dpa_offload/dts/b4420qds-usdpaa-shared-interfaces.dts
+++ b/drivers/staging/fsl_dpa_offload/dts/b4420qds-usdpaa-shared-interfaces.dts
@@ -77,14 +77,12 @@
 		fsl,bpid = <12>;
 		fsl,bpool-thresholds = <0x100 0x300 0x0 0x0>;
 	};
-
 	bp16: buffer-pool@16 {
-                        compatible = "fsl,b4420-bpool", "fsl,bpool";
-                        fsl,bpid = <16>;
-			fsl,bpool-ethernet-cfg = <0 2048 0 1728 0 0>;
-                        fsl,bpool-thresholds = <0x100 0x300 0x0 0x0>;
-       };
-
+		compatible = "fsl,b4420-bpool", "fsl,bpool";
+		fsl,bpid = <16>;
+		fsl,bpool-ethernet-cfg = <0 2048 0 1728 0 0>;
+		fsl,bpool-thresholds = <0x100 0x300 0x0 0x0>;
+	};
 
 	fsl,dpaa {
 		ethernet@0 {
@@ -118,14 +116,14 @@
 		 * On receiving frame at this interface, the ethernet driver will do
 		 * kmap_atomic/kunmap_atomic for that frame. */
 		ethernet@16 {
-			compatible = "fsl,b4420-dpa-ethernet", "fsl,dpa-ethernet";
+			compatible = "fsl,b4420-dpa-ethernet-macless", "fsl,dpa-ethernet-macless";
 			fsl,bman-buffer-pools = <&bp16>;
 			fsl,qman-frame-queues-rx = <4000 8>;
 			fsl,qman-frame-queues-tx = <4008 8>;
 			local-mac-address = [00 11 22 33 44 55];
 		};
 		ethernet@17 {
-			compatible = "fsl,b4420-dpa-ethernet", "fsl,dpa-ethernet";
+			compatible = "fsl,b4420-dpa-ethernet-macless", "fsl,dpa-ethernet-macless";
 			fsl,bman-buffer-pools = <&bp16>;
 			fsl,qman-frame-queues-rx = <5000 8>;
 			fsl,qman-frame-queues-tx = <5008 8>;
diff --git a/drivers/staging/fsl_dpa_offload/dts/b4420qds-usdpaa.dts b/drivers/staging/fsl_dpa_offload/dts/b4420qds-usdpaa.dts
index 0b7b71b..8165f70 100644
--- a/drivers/staging/fsl_dpa_offload/dts/b4420qds-usdpaa.dts
+++ b/drivers/staging/fsl_dpa_offload/dts/b4420qds-usdpaa.dts
@@ -77,7 +77,6 @@
 		fsl,bpid = <12>;
 		fsl,bpool-thresholds = <0x100 0x300 0x0 0x0>;
 	};
-
 	bp16: buffer-pool@16 {
 		compatible = "fsl,b4420-bpool", "fsl,bpool";
 		fsl,bpid = <16>;
@@ -117,14 +116,14 @@
 		 * On receiving frame at this interface, the ethernet driver will do
 		 * kmap_atomic/kunmap_atomic for that frame. */
 		ethernet@16 {
-			compatible = "fsl,b4420-dpa-ethernet", "fsl,dpa-ethernet";
+			compatible = "fsl,b4420-dpa-ethernet-macless", "fsl,dpa-ethernet-macless";
 			fsl,bman-buffer-pools = <&bp16>;
 			fsl,qman-frame-queues-rx = <4000 8>;
 			fsl,qman-frame-queues-tx = <4008 8>;
 			local-mac-address = [00 11 22 33 44 55];
 		};
 		ethernet@17 {
-			compatible = "fsl,b4420-dpa-ethernet", "fsl,dpa-ethernet";
+			compatible = "fsl,b4420-dpa-ethernet-macless", "fsl,dpa-ethernet-macless";
 			fsl,bman-buffer-pools = <&bp16>;
 			fsl,qman-frame-queues-rx = <5000 8>;
 			fsl,qman-frame-queues-tx = <5008 8>;
diff --git a/drivers/staging/fsl_dpa_offload/dts/b4420si-pre.dtsi b/drivers/staging/fsl_dpa_offload/dts/b4420si-pre.dtsi
index cc7cf06..8c1af26 100644
--- a/drivers/staging/fsl_dpa_offload/dts/b4420si-pre.dtsi
+++ b/drivers/staging/fsl_dpa_offload/dts/b4420si-pre.dtsi
@@ -68,6 +68,7 @@
 	};
 
 /include/ "b4420si-chosen.dtsi"
+
 	cpus {
 		#address-cells = <1>;
 		#size-cells = <0>;
@@ -90,4 +91,27 @@
 			next-level-cache = <&L2>;
 		};
 	};
+
+	dsp-clusters {
+		#address-cells = <1>;
+		#size-cells = <0>;
+
+		dsp-cluster0 {
+			#address-cells = <1>;
+			#size-cells = <0>;
+			compatible = "fsl,sc3900-cluster";
+			reg = <0>;
+
+			dsp0: dsp@0 {
+				compatible = "fsl,sc3900";
+				reg = <0>;
+				next-level-cache = <&L2_2>;
+			};
+			dsp1: dsp@1 {
+				compatible = "fsl,sc3900";
+				reg = <1>;
+				next-level-cache = <&L2_2>;
+			};
+		};
+	};
 };
-- 
1.7.5.4

