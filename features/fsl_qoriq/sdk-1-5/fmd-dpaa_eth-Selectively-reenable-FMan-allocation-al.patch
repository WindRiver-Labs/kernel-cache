From e779d43b12f201ec4ef5bcc268781dd93edc34e5 Mon Sep 17 00:00:00 2001
From: Bogdan Hamciuc <bogdan.hamciuc@freescale.com>
Date: Mon, 10 Jun 2013 19:57:04 +0300
Subject: [PATCH 075/429] fmd,dpaa_eth: Selectively reenable FMan allocation
 algorithm

On P3/P4/P5 platforms, as well as on P1023, FMan's default resource
allocation values are not enough to enable jumbo frame forwarding in the
absence of SG support. Enable the (previously deselected) FMan dynamic
resource allocation algorithm on those platforms, if the legacy
DPAA-Ethernet driver (missing SG support) is used.

Signed-off-by: Bogdan Hamciuc <bogdan.hamciuc@freescale.com>
Change-Id: Iec8224c331b95903d57291312791ac6bf0b7fa8a
Reviewed-on: http://git.am.freescale.net:8181/3332
Reviewed-by: Fleming Andrew-AFLEMING <AFLEMING@freescale.com>
Tested-by: Fleming Andrew-AFLEMING <AFLEMING@freescale.com>
[origin patch is from QorIQ-SDK-V1.5-20131219-yocto]
Signed-off-by: Yang Wei <Wei.Yang@windriver.com>
---
 drivers/net/ethernet/freescale/dpa/Kconfig  |    1 +
 drivers/net/ethernet/freescale/fman/Kconfig |    2 +-
 2 files changed, 2 insertions(+), 1 deletions(-)

diff --git a/drivers/net/ethernet/freescale/dpa/Kconfig b/drivers/net/ethernet/freescale/dpa/Kconfig
index 06ea4f9..7afd3aa 100644
--- a/drivers/net/ethernet/freescale/dpa/Kconfig
+++ b/drivers/net/ethernet/freescale/dpa/Kconfig
@@ -36,6 +36,7 @@ choice FSL_DPAA_ETH_OPTIMIZE
 	config FSL_DPAA_ETH_OPTIMIZE_FOR_IPFWD
 		bool "Optimize for forwarding"
 		select FSL_DPAA_TX_RECYCLE if FMAN_T4240
+		select FMAN_RESOURCE_ALLOCATION_ALGORITHM if (FMAN_P3040_P4080_P5020 || FMAN_P1023)
 		---help---
 		  Optimize the DPAA-Ethernet driver for IP/IPSec forwarding use-cases.
 		  This option disabled SG support in the DPAA Ethernet driver.
diff --git a/drivers/net/ethernet/freescale/fman/Kconfig b/drivers/net/ethernet/freescale/fman/Kconfig
index d359501..124710c 100644
--- a/drivers/net/ethernet/freescale/fman/Kconfig
+++ b/drivers/net/ethernet/freescale/fman/Kconfig
@@ -34,7 +34,7 @@ endmenu
 
 config FMAN_RESOURCE_ALLOCATION_ALGORITHM
 	bool "Enable FMan dynamic resource allocation algorithm"
-	default n
+	default y if ((FMAN_P3040_P4080_P5020 || FMAN_P1023) && FSL_DPAA_ETH_OPTIMIZE_FOR_IPFWD)
 	---help---
 		Enables algorithm for dynamic resource allocation
 
-- 
1.7.5.4

