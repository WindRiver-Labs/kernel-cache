From 2a502bfeba54617bfd32ff159f1c86bee240fbd9 Mon Sep 17 00:00:00 2001
From: Andrei Varvara <andrei.varvara@freescale.com>
Date: Fri, 22 Nov 2013 17:23:56 +0200
Subject: [PATCH 321/383] dpa_offload: Bug fix, remove double free on policy
 entry

the remote policy from sa list function is doing the
free on policy entry and there is no need to do it also
outside of this function.

Signed-off-by: Andrei Varvara <andrei.varvara@freescale.com>
Change-Id: Ief70ffe08439807c7b87cf522f7e72fffd795c57
Reviewed-on: http://git.am.freescale.net:8181/6828
Tested-by: Review Code-CDREVIEW <CDREVIEW@freescale.com>
Reviewed-by: Radu-Andrei Bulie <Radu.Bulie@freescale.com>
Reviewed-by: Thomas Trefny <Tom.Trefny@freescale.com>
[Original patch taken from QorIQ-SDK-V1.5-SOURCE-20131219-yocto.iso]
Signed-off-by: Bin Jiang <bin.jiang@windriver.com>
---
 drivers/staging/fsl_dpa_offload/dpa_ipsec.c |    2 --
 1 files changed, 0 insertions(+), 2 deletions(-)

diff --git a/drivers/staging/fsl_dpa_offload/dpa_ipsec.c b/drivers/staging/fsl_dpa_offload/dpa_ipsec.c
index 5c161db..c6d1866 100644
--- a/drivers/staging/fsl_dpa_offload/dpa_ipsec.c
+++ b/drivers/staging/fsl_dpa_offload/dpa_ipsec.c
@@ -3945,14 +3945,12 @@ int dpa_ipsec_sa_add_policy(int sa_id,
 		if (ret < 0) {
 			remove_policy_from_sa_policy_list(sa, policy_entry);
 			log_err("Could not add the inbound policy\n");
-			kfree(policy_entry);
 		}
 	} else {  /* DPA_IPSEC_OUTBOUND */
 		ret = update_outbound_policy(sa, policy_entry, MNG_OP_ADD);
 		if (ret < 0) {
 			remove_policy_from_sa_policy_list(sa, policy_entry);
 			log_err("Could not add the outbound policy\n");
-			kfree(policy_entry);
 		}
 	}
 
-- 
1.7.5.4

