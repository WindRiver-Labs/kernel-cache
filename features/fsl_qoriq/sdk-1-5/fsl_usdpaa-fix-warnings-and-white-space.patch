From ab7882ec4c97470d5ab33334c3ba6b68ab305d3e Mon Sep 17 00:00:00 2001
From: Geoff Thorpe <Geoff.Thorpe@freescale.com>
Date: Fri, 17 May 2013 13:18:48 -0400
Subject: [PATCH 019/383] fsl_usdpaa: fix warnings and white-space

Remove unnecessary blank line.
The usdpaa_irq_handler() routine is made static.
Add missing CONFIG_COMPAT.

Signed-off-by: Geoff Thorpe <Geoff.Thorpe@freescale.com>
Change-Id: I0bbfd15b0743194ff8fba4fee938f3d703148b1a
Reviewed-on: http://git.am.freescale.net:8181/2632
Tested-by: Review Code-CDREVIEW <CDREVIEW@freescale.com>
Reviewed-by: Pledge Roy-R01356 <roy.pledge@freescale.com>
Reviewed-by: Fleming Andrew-AFLEMING <AFLEMING@freescale.com>
[Original patch taken from QorIQ-SDK-V1.5-SOURCE-20131219-yocto.iso]
Signed-off-by: Bin Jiang <bin.jiang@windriver.com>
---
 drivers/staging/fsl_qbman/fsl_usdpaa.c     |    8 ++------
 drivers/staging/fsl_qbman/fsl_usdpaa_irq.c |   12 ++++--------
 2 files changed, 6 insertions(+), 14 deletions(-)

diff --git a/drivers/staging/fsl_qbman/fsl_usdpaa.c b/drivers/staging/fsl_qbman/fsl_usdpaa.c
index 9ef375e..c0eac1b 100644
--- a/drivers/staging/fsl_qbman/fsl_usdpaa.c
+++ b/drivers/staging/fsl_qbman/fsl_usdpaa.c
@@ -304,7 +304,6 @@ static int usdpaa_open(struct inode *inode, struct file *filp)
 	return 0;
 }
 
-
 #define DQRR_MAXFILL 15
 
 /* Reset a QMan portal to its default state */
@@ -412,7 +411,6 @@ static int qm_check_and_destroy_fqs(struct qm_portal *portal, void *ctx,
 		++fq_id;
 	}
 	return 0;
-
 }
 
 static bool check_channel_device(void *_ctx, u32 channel)
@@ -441,8 +439,6 @@ static bool check_channel_device(void *_ctx, u32 channel)
 	return false;
 }
 
-
-
 static int usdpaa_release(struct inode *inode, struct file *filp)
 {
 	struct ctx *ctx = filp->private_data;
@@ -1219,13 +1215,13 @@ static long usdpaa_ioctl(struct file *fp, unsigned int cmd, unsigned long arg)
 	return -EINVAL;
 }
 
-
-
 static long usdpaa_ioctl_compat(struct file *fp, unsigned int cmd,
 				unsigned long arg)
 {
+#ifdef CONFIG_COMPAT
 	struct ctx *ctx = fp->private_data;
 	void __user *a = (void __user *)arg;
+#endif
 	switch (cmd) {
 #ifdef CONFIG_COMPAT
 	case USDPAA_IOCTL_DMA_MAP_COMPAT:
diff --git a/drivers/staging/fsl_qbman/fsl_usdpaa_irq.c b/drivers/staging/fsl_qbman/fsl_usdpaa_irq.c
index a2c609f..e9e36de 100644
--- a/drivers/staging/fsl_qbman/fsl_usdpaa_irq.c
+++ b/drivers/staging/fsl_qbman/fsl_usdpaa_irq.c
@@ -61,14 +61,11 @@ struct usdpaa_irq_ctx {
 	struct file *usdpaa_filp;
 };
 
-
 static int usdpaa_irq_open(struct inode *inode, struct file *filp)
 {
-	struct usdpaa_irq_ctx *ctx = kmalloc(sizeof(struct usdpaa_irq_ctx),
-					     GFP_KERNEL);
+	struct usdpaa_irq_ctx *ctx = kmalloc(sizeof(*ctx), GFP_KERNEL);
 	if (!ctx)
 		return -ENOMEM;
-
 	ctx->irq_set = 0;
 	ctx->irq_count = 0;
 	ctx->last_irq_count = 0;
@@ -92,8 +89,7 @@ static int usdpaa_irq_release(struct inode *inode, struct file *filp)
 	return 0;
 }
 
-
-irqreturn_t usdpaa_irq_handler(int irq, void *_ctx)
+static irqreturn_t usdpaa_irq_handler(int irq, void *_ctx)
 {
 	unsigned long flags;
 	struct usdpaa_irq_ctx *ctx = _ctx;
@@ -107,8 +103,6 @@ irqreturn_t usdpaa_irq_handler(int irq, void *_ctx)
 	return IRQ_HANDLED;
 }
 
-
-
 static int map_irq(struct file *fp, struct usdpaa_ioctl_irq_map *irq_map)
 {
 	struct usdpaa_irq_ctx *ctx = fp->private_data;
@@ -240,7 +234,9 @@ static unsigned int usdpaa_irq_poll(struct file *filp, poll_table *wait)
 static long usdpaa_irq_ioctl_compat(struct file *fp, unsigned int cmd,
 				unsigned long arg)
 {
+#ifdef CONFIG_COMPAT
 	void __user *a = (void __user *)arg;
+#endif
 	switch (cmd) {
 #ifdef CONFIG_COMPAT
 	case  USDPAA_IOCTL_PORTAL_IRQ_MAP_COMPAT:
-- 
1.7.5.4

