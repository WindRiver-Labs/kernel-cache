From 856e6da353fdbca11b8ef4b58301e324c8f6e59f Mon Sep 17 00:00:00 2001
From: Yashpal Dutta <yashpal.dutta@freescale.com>
Date: Mon, 11 Nov 2013 20:15:18 +0545
Subject: [PATCH 296/383] crypto: caam - allow to build PKC support as module

The CAAM driver itself can be build as a module. With addition
of PKC support in CAAM driver, CAAM driver module build fails

The fix allows PKC support in CAAM driver as separate module and
fixes CAAM driver module build issue.

Signed-off-by: Yashpal Dutta <yashpal.dutta@freescale.com>
Change-Id: Ia6cab9205ce1476c820ee055e8713142a74f65b2
Reviewed-on: http://git.am.freescale.net:8181/6545
Tested-by: Review Code-CDREVIEW <CDREVIEW@freescale.com>
Reviewed-by: Vakul Garg <vakul@freescale.com>
Reviewed-by: Horia Ioan Geanta Neag <horia.geanta@freescale.com>
Reviewed-by: Thomas Trefny <Tom.Trefny@freescale.com>
[Original patch taken from QorIQ-SDK-V1.5-SOURCE-20131219-yocto.iso]
Signed-off-by: Bin Jiang <bin.jiang@windriver.com>
---
 drivers/crypto/caam/Kconfig  |   12 ++++++++++++
 drivers/crypto/caam/Makefile |    5 ++++-
 2 files changed, 16 insertions(+), 1 deletions(-)

diff --git a/drivers/crypto/caam/Kconfig b/drivers/crypto/caam/Kconfig
index c4979b6..7ff3091 100644
--- a/drivers/crypto/caam/Kconfig
+++ b/drivers/crypto/caam/Kconfig
@@ -74,6 +74,18 @@ config CRYPTO_DEV_FSL_CAAM_CRYPTO_API
 	  To compile this as a module, choose M here: the module
 	  will be called caamalg.
 
+config FSL_CAAM_PKC_SUPPORT
+	tristate "Public Key Cryptography Support in CAAM driver"
+	depends on CRYPTO_DEV_FSL_CAAM_CRYPTO_API
+	default y
+	help
+	  Selecting this will allow SEC Public key support for
+	  RSA, DSA, DH, ECDH, ECDSA. Supported operations includes
+	  Keygen, Sign and Verify.
+
+	  To compile this as a module, choose M here: the module
+	  will be called caam_pkc.
+
 config CRYPTO_DEV_FSL_CAAM_CRYPTO_API_QI
 	tristate "Queue Interface as Crypto API backend"
 	depends on CRYPTO_DEV_FSL_CAAM_CRYPTO_API && FSL_QMAN
diff --git a/drivers/crypto/caam/Makefile b/drivers/crypto/caam/Makefile
index cd23142..bb762ab 100644
--- a/drivers/crypto/caam/Makefile
+++ b/drivers/crypto/caam/Makefile
@@ -10,10 +10,13 @@ obj-$(CONFIG_CRYPTO_DEV_FSL_CAAM_CRYPTO_API) += caamalg.o
 obj-$(CONFIG_CRYPTO_DEV_FSL_CAAM_AHASH_API) += caamhash.o
 obj-$(CONFIG_CRYPTO_DEV_FSL_CAAM_RNG_API) += caamrng.o
 
-caam-objs := ctrl.o jr.o error.o key_gen.o pkc_desc.o caampkc.o
+caam-objs := ctrl.o jr.o error.o key_gen.o
 
 ifeq ($(CONFIG_FSL_QMAN), y)
 	caam-objs += qi.o
 endif
 
 obj-$(CONFIG_CRYPTO_DEV_FSL_CAAM_CRYPTO_API_QI) += caamalg_qi.o
+obj-$(CONFIG_FSL_CAAM_PKC_SUPPORT) += caam_pkc.o
+
+caam_pkc-objs := caampkc.o pkc_desc.o
-- 
1.7.5.4

