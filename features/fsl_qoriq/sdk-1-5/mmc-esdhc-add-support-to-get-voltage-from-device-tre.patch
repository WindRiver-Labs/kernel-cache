From e2fd75b28feb52b76fb61cf4867a869ea622b0b0 Mon Sep 17 00:00:00 2001
From: Haijun Zhang <Haijun.Zhang@freescale.com>
Date: Mon, 26 Aug 2013 09:19:24 +0800
Subject: [PATCH 173/383] mmc: esdhc: add support to get voltage from
 device-tree

Signed-off-by: Haijun Zhang <haijun.zhang@freescale.com>
Change-Id: I3ec8dd6cb0c628ada3533163c602c9b752a45657
Reviewed-on: http://git.am.freescale.net:8181/4764
Tested-by: Review Code-CDREVIEW <CDREVIEW@freescale.com>
Reviewed-by: Xie Xiaobo-R63061 <X.Xie@freescale.com>
Reviewed-by: Rivera Jose-B46482 <German.Rivera@freescale.com>
[Original patch taken from QorIQ-SDK-V1.5-SOURCE-20131219-yocto.iso]
Signed-off--by: Bin Jiang <bin.jiang@windriver.com>
---
 drivers/mmc/host/sdhci-pltfm.c |    3 +++
 1 files changed, 3 insertions(+), 0 deletions(-)

diff --git a/drivers/mmc/host/sdhci-pltfm.c b/drivers/mmc/host/sdhci-pltfm.c
index aa7d170..c979736 100644
--- a/drivers/mmc/host/sdhci-pltfm.c
+++ b/drivers/mmc/host/sdhci-pltfm.c
@@ -220,13 +220,16 @@ int sdhci_pltfm_register(struct platform_device *pdev,
 			 const struct sdhci_pltfm_data *pdata)
 {
 	struct sdhci_host *host;
+	struct device_node *np;
 	int ret = 0;
 
+	np = pdev->dev.of_node;
 	host = sdhci_pltfm_init(pdev, pdata);
 	if (IS_ERR(host))
 		return PTR_ERR(host);
 
 	sdhci_get_of_property(pdev);
+	mmc_of_parse_voltage(np, &host->ocr_mask);
 
 	ret = sdhci_add_host(host);
 	if (ret)
-- 
1.7.5.4

