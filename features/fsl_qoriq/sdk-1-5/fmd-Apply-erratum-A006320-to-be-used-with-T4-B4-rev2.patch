From 4cebc1eac764b7a11adc929a0f1511fa553373ab Mon Sep 17 00:00:00 2001
From: Mandy Lavi <mandy.lavi@freescale.com>
Date: Wed, 4 Dec 2013 18:48:50 +0200
Subject: [PATCH 401/429] fmd: Apply erratum A006320 to be used with T4/B4
 rev2

This is a workaround to handle "Physical Error" issues

Change-Id: Ie7b241b54dc4ddf8c3b156f0ff653b2de7d63ff7
Signed-off-by: Mandy Lavi <mandy.lavi@freescale.com>
Reviewed-on: http://git.am.freescale.net:8181/7067
Reviewed-by: Nir Erez <nir.erez@freescale.com>
Reviewed-by: Thomas Trefny <Tom.Trefny@freescale.com>
Tested-by: Zhenhua Luo <zhenhua.luo@freescale.com>
[origin patch is from QorIQ-SDK-V1.5-20131219-yocto]
Signed-off-by: Yang Wei <Wei.Yang@windriver.com>
---
 .../freescale/fman/Peripherals/FM/MAC/memac.c      |    3 ++-
 .../freescale/fman/Peripherals/FM/Port/fm_port.c   |    3 ++-
 2 files changed, 4 insertions(+), 2 deletions(-)

diff --git a/drivers/net/ethernet/freescale/fman/Peripherals/FM/MAC/memac.c b/drivers/net/ethernet/freescale/fman/Peripherals/FM/MAC/memac.c
index 2ae7eb80..11ccb0d 100644
--- a/drivers/net/ethernet/freescale/fman/Peripherals/FM/MAC/memac.c
+++ b/drivers/net/ethernet/freescale/fman/Peripherals/FM/MAC/memac.c
@@ -873,7 +873,8 @@ static t_Error MemacInit(t_Handle h_Memac)
     	FM_GetRevision(p_Memac->fmMacControllerDriver.h_Fm, &p_Memac->fmMacControllerDriver.fmRevInfo);
         /* check the FMAN version - the bug exists only in rev1 */
         if ((p_Memac->fmMacControllerDriver.fmRevInfo.majorRev == 6) &&
-        	(p_Memac->fmMacControllerDriver.fmRevInfo.minorRev == 0))
+            ((p_Memac->fmMacControllerDriver.fmRevInfo.minorRev == 0) ||
+             (p_Memac->fmMacControllerDriver.fmRevInfo.minorRev == 3)))
         {
         	/* MAC strips CRC from received frames - this workaround should
         	   decrease the likelihood of bug appearance
diff --git a/drivers/net/ethernet/freescale/fman/Peripherals/FM/Port/fm_port.c b/drivers/net/ethernet/freescale/fman/Peripherals/FM/Port/fm_port.c
index be54318..adb0eef 100644
--- a/drivers/net/ethernet/freescale/fman/Peripherals/FM/Port/fm_port.c
+++ b/drivers/net/ethernet/freescale/fman/Peripherals/FM/Port/fm_port.c
@@ -1965,7 +1965,8 @@ t_Handle FM_PORT_Config(t_FmPortParams *p_FmPortParams)
 #else
     p_FmPort->p_FmPortDriverParam->dfltCfg.errata_A006675 = FALSE;
 #endif
-    if ((p_FmPort->fmRevInfo.majorRev == 6) && (p_FmPort->fmRevInfo.minorRev == 0))
+    if ((p_FmPort->fmRevInfo.majorRev == 6) &&
+        ((p_FmPort->fmRevInfo.minorRev == 0) || (p_FmPort->fmRevInfo.minorRev == 3)))
         p_FmPort->p_FmPortDriverParam->dfltCfg.errata_A006320 = TRUE;
     else
         p_FmPort->p_FmPortDriverParam->dfltCfg.errata_A006320 = FALSE;
-- 
1.7.5.4

