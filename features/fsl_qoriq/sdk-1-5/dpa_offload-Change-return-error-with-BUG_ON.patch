From 259fe46892e27db3400e2e0d690e6d34817dc296 Mon Sep 17 00:00:00 2001
From: Anca Jeanina FLOAREA <anca.floarea@freescale.com>
Date: Tue, 22 Oct 2013 16:04:23 +0300
Subject: [PATCH 285/429] dpa_offload: Change return error with BUG_ON

The scenario when a counter id or a request id is not properly
returned in the pool is not a normal operation and it happens
when a memory corruption occurs, case in which the calling
application is not able to recover.

Signed-off-by: Anca Jeanina FLOAREA <anca.floarea@freescale.com>
Change-Id: Id349b1a176f8fc1a17fca1c928b69bf7e35948bc
Reviewed-on: http://git.am.freescale.net:8181/5897
Tested-by: Review Code-CDREVIEW <CDREVIEW@freescale.com>
Reviewed-by: Aurelian Zanoschi <Aurelian.Zanoschi@freescale.com>
Reviewed-by: Rivera Jose-B46482 <German.Rivera@freescale.com>
[origin patch is from QorIQ-SDK-V1.5-20131219-yocto]
Signed-off-by: Yang Wei <Wei.Yang@windriver.com>
---
 drivers/staging/fsl_dpa_offload/dpa_stats.c |   10 ++--------
 1 files changed, 2 insertions(+), 8 deletions(-)

diff --git a/drivers/staging/fsl_dpa_offload/dpa_stats.c b/drivers/staging/fsl_dpa_offload/dpa_stats.c
index becbbcb..2af3620 100644
--- a/drivers/staging/fsl_dpa_offload/dpa_stats.c
+++ b/drivers/staging/fsl_dpa_offload/dpa_stats.c
@@ -631,10 +631,7 @@ static int free_cnts_resources(struct dpa_stats *dpa_stats)
 		if (id != DPA_OFFLD_INVALID_OBJECT_ID) {
 			/* Release the counter id in the Counter IDs cq */
 			err = put_cnt(dpa_stats, &dpa_stats->cnts_cb[id]);
-			if (err < 0) {
-				log_err("Cannot release counter id %d\n", id);
-				return err;
-			}
+			BUG_ON(err < 0);
 		}
 		for (j = 0; j < MAX_NUM_OF_MEMBERS; j++) {
 			kfree(dpa_stats->cnts_cb[i].info.stats[j]);
@@ -754,10 +751,7 @@ static int free_reqs_resources(struct dpa_stats *dpa_stats)
 
 			/* Release the request id in the Requests IDs cq */
 			err = put_req(dpa_stats, req_cb);
-			if (err < 0) {
-				log_err("Cannot release request id %d\n", id);
-				return err;
-			}
+			BUG_ON(err < 0);
 
 			/* Release the array of counter ids */
 			kfree(req_cb->cnts_ids);
-- 
1.7.5.4

