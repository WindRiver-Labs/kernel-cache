From 02d3d4109706477d8b1a1409cb25e9afad04d071 Mon Sep 17 00:00:00 2001
From: Marian Chereji <marian.chereji@freescale.com>
Date: Wed, 2 Oct 2013 16:51:35 +0300
Subject: [PATCH 236/429] dpa_offload: Allow statistics enable on NEXT_TABLE
 classifier table entries

The DPA classifier allowed the user to enable statistics only for
"enqueue" and "drop" type table entries. It now allows the user to
enable statistics also for the "next_table" type table entries.

Change-Id: I9d57af14922170a7554431b7ba5abcaaaeac04ac
Signed-off-by: Marian Chereji <marian.chereji@freescale.com>
Reviewed-on: http://git.am.freescale.net:8181/5151
Reviewed-by: Floarea Anca Jeanina-B12569 <anca.floarea@freescale.com>
Tested-by: Review Code-CDREVIEW <CDREVIEW@freescale.com>
Reviewed-by: Rivera Jose-B46482 <German.Rivera@freescale.com>
[origin patch is from QorIQ-SDK-V1.5-20131219-yocto]
Signed-off-by: Yang Wei <Wei.Yang@windriver.com>
---
 drivers/staging/fsl_dpa_offload/dpa_classifier.c |   11 +++--------
 1 files changed, 3 insertions(+), 8 deletions(-)

diff --git a/drivers/staging/fsl_dpa_offload/dpa_classifier.c b/drivers/staging/fsl_dpa_offload/dpa_classifier.c
index 0c081b9..5f7c7f7 100644
--- a/drivers/staging/fsl_dpa_offload/dpa_classifier.c
+++ b/drivers/staging/fsl_dpa_offload/dpa_classifier.c
@@ -2784,10 +2784,6 @@ static int action_to_next_engine_params(const struct dpa_cls_tbl_action *action,
 		next_engine_params->nextEngine = e_FM_PCD_DONE;
 		next_engine_params->params.enqueueParams.action =
 			e_FM_PCD_DROP_FRAME;
-		if (action->enable_statistics)
-			next_engine_params->statisticsEn =
-				TRUE;
-
 		break;
 	case DPA_CLS_TBL_ACTION_ENQ:
 		if (distribution && classification) {
@@ -2863,10 +2859,6 @@ static int action_to_next_engine_params(const struct dpa_cls_tbl_action *action,
 					      action->enq_params.new_rel_vsp_id;
 #endif
 			}
-
-		if (action->enable_statistics)
-			next_engine_params->statisticsEn =
-				TRUE;
 		}
 
 		if (action->enq_params.hmd != DPA_OFFLD_DESC_NONE) {
@@ -2980,6 +2972,9 @@ static int action_to_next_engine_params(const struct dpa_cls_tbl_action *action,
 		return -EINVAL;
 	}
 
+	if (action->enable_statistics)
+		next_engine_params->statisticsEn = TRUE;
+
 	dpa_cls_dbg(("DEBUG: dpa_classifier %s (%d) <--\n", __func__,
 		__LINE__));
 
-- 
1.7.5.4

