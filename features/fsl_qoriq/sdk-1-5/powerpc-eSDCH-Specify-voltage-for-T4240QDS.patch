From b714b70dba448a0b5d3788fd236a08dec4f31b97 Mon Sep 17 00:00:00 2001
From: "Haijun.Zhang" <Haijun.Zhang@freescale.com>
Date: Thu, 29 Aug 2013 11:31:28 +0800
Subject: [PATCH 243/383] powerpc/eSDCH: Specify voltage for T4240QDS

commit 0f06ad70921eb00fa48f73754059fd8854f32572 upstream

Freescale T4240QDS reference board has extra voltage shifters added
to allow 3.3V operation, so add 3.3v voltage support for T4240QDS.
1.8v and 3.3v is recommand for eMMC and SDHC card.

Signed-off-by: Haijun Zhang <haijun.zhang@freescale.com>
Signed-off-by: Scott Wood <scottwood@freescale.com>
[Revert commit "mmc: esdhc: Add SDHCI_QUIRK_QORIQ_CIRCUIT_SUPPORT_VS33
quirk support" which is no useful now.``]
Signed-off-by: Bin Jiang <bin.jiang@windriver.com>
---
 arch/powerpc/boot/dts/t4240qds.dts |    4 ++++
 drivers/mmc/host/sdhci-pltfm.c     |    1 -
 2 files changed, 4 insertions(+), 1 deletions(-)

diff --git a/arch/powerpc/boot/dts/t4240qds.dts b/arch/powerpc/boot/dts/t4240qds.dts
index dac0719..f244c00 100644
--- a/arch/powerpc/boot/dts/t4240qds.dts
+++ b/arch/powerpc/boot/dts/t4240qds.dts
@@ -577,6 +577,10 @@
 				status = "disabled";
 			};
 		};
+
+		sdhc@114000 {
+			voltage-ranges = <1800 1800 3300 3300>;
+		};
 	};
 
 	pci0: pcie@ffe240000 {
diff --git a/drivers/mmc/host/sdhci-pltfm.c b/drivers/mmc/host/sdhci-pltfm.c
index c979736..5dc80f6 100644
--- a/drivers/mmc/host/sdhci-pltfm.c
+++ b/drivers/mmc/host/sdhci-pltfm.c
@@ -97,7 +97,6 @@ void sdhci_get_of_property(struct platform_device *pdev)
 
 		if (of_device_is_compatible(np, "fsl,t4240-esdhc")) {
 			host->quirks2 |= SDHCI_QUIRK2_LONG_TIME_CMD_COMPLETE_IRQ;
-			host->quirks2 |= SDHCI_QUIRK2_CIRCUIT_SUPPORT_VS33;
 			host->quirks2 |= SDHCI_QUIRK2_FORCE_CMD13_DETECT_CARD;
 			host->quirks |= SDHCI_QUIRK_BROKEN_ADMA;
 		}
-- 
1.7.5.4

