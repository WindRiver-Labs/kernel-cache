From 3ad3bc2fa75d81dcd6936dc6258354aa2a80e5cf Mon Sep 17 00:00:00 2001
From: Tiejun Chen <tiejun.chen@windriver.com>
Date: Fri, 27 Dec 2013 16:11:42 +0800
Subject: [PATCH 422/429] powerpc/dpaa: workaround of fixed-link

fixed-link does not work in 3.8.x, to make XFI work which has no PHY,
it's actually not necessary to use fixed-link, otherwise there will be
more work and code changes to make fixed-link work in 3.8.x. For now, if
driver does not find the phy_node of MAC, just set the mac_dev->phy_dev
= NULL and return 0; we can get XFI work and this won't break other
ethernet ports. It's only for SDK1.4, if we decide to bring fixed-link
back, it can be done after SDK1.4.

Signed-off-by: Shaohui Xie <Shaohui.Xie@freescale.com>
Change-Id: I930edbe76f5d739f7d6565d3a7f8a3aabf224db0
Reviewed-on: http://git.am.freescale.net:8181/2797
Tested-by: Review Code-CDREVIEW <CDREVIEW@freescale.com>
Reviewed-by: Zang Tiefei-R61911 <tie-fei.zang@freescale.com>
Reviewed-by: Fleming Andrew-AFLEMING <AFLEMING@freescale.com>
Tested-by: Fleming Andrew-AFLEMING <AFLEMING@freescale.com>
[Fetch from http://git.freescale.com/git/cgit.cgi/ppc/sdk/linux.git/,
 Tag: fsl-sdk-v1.5
 rebase on current context.]
Signed-off-by: Tiejun Chen <tiejun.chen@windriver.com>
---
 drivers/net/ethernet/freescale/dpa/mac-api.c |    8 ++++----
 1 files changed, 4 insertions(+), 4 deletions(-)

diff --git a/drivers/net/ethernet/freescale/dpa/mac-api.c b/drivers/net/ethernet/freescale/dpa/mac-api.c
index d2abcee..46ecca9 100644
--- a/drivers/net/ethernet/freescale/dpa/mac-api.c
+++ b/drivers/net/ethernet/freescale/dpa/mac-api.c
@@ -401,10 +401,10 @@ static int memac_init_phy(struct net_device *net_dev,
 	struct phy_device       *phy_dev;
 
 	if (macdev2enetinterface(mac_dev) == e_ENET_MODE_XGMII_10000) {
-		if (!mac_dev->phy_node)
-			phy_dev = phy_attach(net_dev, mac_dev->fixed_bus_id, 0,
-				mac_dev->phy_if);
-		else
+		if (!mac_dev->phy_node) {
+			mac_dev->phy_dev = NULL;
+			return 0;
+		} else
 			phy_dev = of_phy_attach(net_dev, mac_dev->phy_node, 0,
 				mac_dev->phy_if);
 	} else {
-- 
1.7.5.4

