From 33287865d404452d6eb591a851e4dbc887856e11 Mon Sep 17 00:00:00 2001
From: Haijun Zhang <Haijun.Zhang@freescale.com>
Date: Tue, 12 Nov 2013 10:53:39 +0800
Subject: [PATCH 299/383] esdhc: Command need longer time to detect timeout

10 sec is not long enough for mmc command in some extreme case.
So add this quirk for P5040 as T4240 and P5020 does to avoid mistaken
timeout detecting.

Signed-off-by: Haijun Zhang <haijun.zhang@freescale.com>
Change-Id: I2ea1b1ef56b128bce0975743302061dde4b5a3fc
Reviewed-on: http://git.am.freescale.net:8181/6553
Tested-by: Review Code-CDREVIEW <CDREVIEW@freescale.com>
Reviewed-by: Xiaobo Xie <X.Xie@freescale.com>
Reviewed-by: Thomas Trefny <Tom.Trefny@freescale.com>
[Original patch taken from QorIQ-SDK-V1.5-SOURCE-20131219-yocto.iso]
Signed-off-by: Bin Jiang <bin.jiang@windriver.com>
---
 drivers/mmc/host/sdhci-pltfm.c |    3 ++-
 1 files changed, 2 insertions(+), 1 deletions(-)

diff --git a/drivers/mmc/host/sdhci-pltfm.c b/drivers/mmc/host/sdhci-pltfm.c
index 5dc80f6..e5afe5d 100644
--- a/drivers/mmc/host/sdhci-pltfm.c
+++ b/drivers/mmc/host/sdhci-pltfm.c
@@ -101,7 +101,8 @@ void sdhci_get_of_property(struct platform_device *pdev)
 			host->quirks |= SDHCI_QUIRK_BROKEN_ADMA;
 		}
 
-		if (of_device_is_compatible(np, "fsl,p5020-esdhc"))
+		if (of_device_is_compatible(np, "fsl,p5020-esdhc") ||
+			of_device_is_compatible(np, "fsl,p5040-esdhc"))
 			host->quirks2 |= SDHCI_QUIRK2_LONG_TIME_CMD_COMPLETE_IRQ;
 
 		if (of_device_is_compatible(np, "fsl,p5040-esdhc") ||
-- 
1.7.5.4

