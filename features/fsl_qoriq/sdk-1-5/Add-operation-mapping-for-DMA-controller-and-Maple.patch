From a7675e3ec9b7a4533be7ed8f238a9b3e3e5f2560 Mon Sep 17 00:00:00 2001
From: Varun Sethi <Varun.Sethi@freescale.com>
Date: Mon, 22 Jul 2013 19:35:49 +0530
Subject: [PATCH 091/383] Add operation mapping for DMA controller and Maple.

These are required for ALU DSP stashing use case.

Signed-off-by: Varun Sethi <Varun.Sethi@freescale.com>
[Original patch taken from QorIQ-SDK-V1.5-SOURCE-20131219-yocto.iso]
Signed-off-by: Bin Jiang <bin.jiang@windriver.com>
---
 drivers/iommu/fsl_pamu.c |   19 +++++++++++++++++++
 include/linux/iommu.h    |    3 +++
 2 files changed, 22 insertions(+), 0 deletions(-)

diff --git a/drivers/iommu/fsl_pamu.c b/drivers/iommu/fsl_pamu.c
index b92a53a..c38eaa3 100644
--- a/drivers/iommu/fsl_pamu.c
+++ b/drivers/iommu/fsl_pamu.c
@@ -707,7 +707,26 @@ static void __init setup_omt(struct ome *omt)
 	ome->moe[IOE_DIRECT0_IDX] = EOE_LDEC | EOE_VALID;
 	ome->moe[IOE_DIRECT1_IDX] = EOE_LDEC | EOE_VALID;
 
+	/* Configure OMI_DMA */
+	ome = &omt[OMI_DMA];
+	ome->moe[IOE_READ_IDX]  = EOE_VALID | EOE_RSA;
+	ome->moe[IOE_EREAD0_IDX] = EOE_VALID | EOE_RSA;
+	ome->moe[IOE_WRITE_IDX] = EOE_VALID | EOE_WWSA;
+	ome->moe[IOE_EWRITE0_IDX] = EOE_VALID | EOE_WWSA;
+
+	/* Configure OMI_DMA_READI */
+	ome = &omt[OMI_DMA_READI];
+	ome->moe[IOE_READ_IDX]  = EOE_VALID | EOE_READI;
+	ome->moe[IOE_EREAD0_IDX] = EOE_VALID | EOE_READI;
+	ome->moe[IOE_WRITE_IDX] = EOE_VALID | EOE_WWSA;
+	ome->moe[IOE_EWRITE0_IDX] = EOE_VALID | EOE_WWSA;
 
+	/* Configure OMI_MAPLE */
+	ome = &omt[OMI_MAPLE];
+	ome->moe[IOE_READ_IDX]  = EOE_VALID | EOE_RSA;
+	ome->moe[IOE_EREAD0_IDX] = EOE_VALID | EOE_RSA;
+	ome->moe[IOE_WRITE_IDX] = EOE_VALID | EOE_WWSA;
+	ome->moe[IOE_EWRITE0_IDX] = EOE_VALID | EOE_WWSA;
 }
 
 /*
diff --git a/include/linux/iommu.h b/include/linux/iommu.h
index 5363981..eac6d70 100644
--- a/include/linux/iommu.h
+++ b/include/linux/iommu.h
@@ -90,6 +90,9 @@ enum omap_index {
 	OMI_QMAN_PRIV,
 	OMI_CAAM,
 	OMI_PMAN,
+	OMI_DMA,
+	OMI_DMA_READI,
+	OMI_MAPLE,
 	OMI_MAX,
 };
 
-- 
1.7.5.4

