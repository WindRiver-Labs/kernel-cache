From 2c6e2a2766346559c2b18835554b6dc779a94a4b Mon Sep 17 00:00:00 2001
From: Haijun Zhang <Haijun.Zhang@freescale.com>
Date: Tue, 30 Jul 2013 08:19:49 +0800
Subject: [PATCH 163/429] Powerpc/eSDHC: Update ERRATA A-004388 impact list

Add new board to ERRATA A-004388:
eSDHC DMA might not stop if error occurs on system transaction
New added:
P2040-41-R1.0 P2040-41-R2.0 P2040-41-R1.1
P3041-R1.0 P3041-R1.1 P3041-R2.0 P5040-21-R2.0

Signed-off-by: Haijun Zhang <haijun.zhang@freescale.com>
Change-Id: I3875efd67021b9c82a4b68c902fdf02d6389fc62
Reviewed-on: http://git.am.freescale.net:8181/3603
Tested-by: Review Code-CDREVIEW <CDREVIEW@freescale.com>
Reviewed-by: Fleming Andrew-AFLEMING <AFLEMING@freescale.com>
[origin patch is from QorIQ-SDK-V1.5-20131219-yocto]
Signed-off-by: Yang Wei <Wei.Yang@windriver.com>
---
 drivers/mmc/host/sdhci-of-esdhc.c |   11 ++++++++---
 1 files changed, 8 insertions(+), 3 deletions(-)

diff --git a/drivers/mmc/host/sdhci-of-esdhc.c b/drivers/mmc/host/sdhci-of-esdhc.c
index 888a830..bb33895 100644
--- a/drivers/mmc/host/sdhci-of-esdhc.c
+++ b/drivers/mmc/host/sdhci-of-esdhc.c
@@ -206,15 +206,20 @@ static void esdhci_of_adma_workaround(struct sdhci_host *host, u32 intmask)
 	 * Check for A-004388: eSDHC DMA might not stop if error
 	 * occurs on system transaction
 	 * Impact list:
-	 * T4240-R1.0 B4860-R1.0 P1010-R1.0
-	 * P3041-R1.0-R2.0-R1.1 P2041-R1.0-R1.1-R2.0
-	 * P5040-R2.0
+	 * T4240-4160-R1.0 B4860-4420-R1.0 P1010-1014-R1.0
+	 * P3041-R1.0-R2.0-R1.1 P2041-2040-R1.0-R1.1-R2.0
+	 * P5040-5021-R2.0
 	 */
 	if (!(((SVR_SOC_VER(svr) == SVR_T4240) && (SVR_REV(svr) == 0x10)) ||
+		((SVR_SOC_VER(svr) == SVR_T4160) && (SVR_REV(svr) == 0x10)) ||
+		((SVR_SOC_VER(svr) == SVR_B4420) && (SVR_REV(svr) == 0x10)) ||
 		((SVR_SOC_VER(svr) == SVR_B4860) && (SVR_REV(svr) == 0x10)) ||
 		((SVR_SOC_VER(svr) == SVR_P1010) && (SVR_REV(svr) == 0x10)) ||
+		((SVR_SOC_VER(svr) == SVR_P1014) && (SVR_REV(svr) == 0x10)) ||
 		((SVR_SOC_VER(svr) == SVR_P3041) && (SVR_REV(svr) <= 0x20)) ||
 		((SVR_SOC_VER(svr) == SVR_P2041) && (SVR_REV(svr) <= 0x20)) ||
+		((SVR_SOC_VER(svr) == SVR_P2040) && (SVR_REV(svr) <= 0x20)) ||
+		((SVR_SOC_VER(svr) == SVR_P5021) && (SVR_REV(svr) == 0x20)) ||
 		((SVR_SOC_VER(svr) == SVR_P5040) && (SVR_REV(svr) == 0x20))))
 		return;
 
-- 
1.7.5.4

