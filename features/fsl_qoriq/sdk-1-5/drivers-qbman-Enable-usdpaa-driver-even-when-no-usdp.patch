From 113552f074ccca32f4ed110ed14bd57704d8f9fb Mon Sep 17 00:00:00 2001
From: Sandeep Singh <sandeep@freescale.com>
Date: Fri, 27 Sep 2013 13:19:17 -0400
Subject: [PATCH 263/429] drivers/qbman:Enable usdpaa driver even when no
 usdpaa_mem

Kernel boot argument "usdpaa_mem=" should affect only the allocation of
usdpaa memory and not the initialization of the driver. Hence driver is
registered even when memory is not allocated at boot time.

Signed-off-by: Sandeep Singh <sandeep@freescale.com>
Change-Id: I7a0514e21a8edb6671ab26bf1ca5bb8992a8d1a2
Reviewed-on: http://git.am.freescale.net:8181/5032
Tested-by: Review Code-CDREVIEW <CDREVIEW@freescale.com>
Reviewed-by: Thorpe Geoff-R01361 <Geoff.Thorpe@freescale.com>
Reviewed-by: Rivera Jose-B46482 <German.Rivera@freescale.com>
[origin patch is from QorIQ-SDK-V1.5-20131219-yocto]
Signed-off-by: Yang Wei <Wei.Yang@windriver.com>
---
 drivers/staging/fsl_qbman/fsl_usdpaa.c |    3 ++-
 1 files changed, 2 insertions(+), 1 deletions(-)

diff --git a/drivers/staging/fsl_qbman/fsl_usdpaa.c b/drivers/staging/fsl_qbman/fsl_usdpaa.c
index 6c4ac36..e937891 100644
--- a/drivers/staging/fsl_qbman/fsl_usdpaa.c
+++ b/drivers/staging/fsl_qbman/fsl_usdpaa.c
@@ -1510,7 +1510,7 @@ static int __init usdpaa_init(void)
 	pr_info("Freescale USDPAA process driver\n");
 	if (!phys_start) {
 		pr_warn("fsl-usdpaa: no region found\n");
-		return 0;
+		goto skip_setup;
 	}
 
 	while (tmp_size != 0) {
@@ -1535,6 +1535,7 @@ static int __init usdpaa_init(void)
 		tmp_pfn_start += frag_size / PAGE_SIZE;
 		tmp_pfn_size -= frag_size / PAGE_SIZE;
 	}
+skip_setup:
 	ret = misc_register(&usdpaa_miscdev);
 	if (ret)
 		pr_err("fsl-usdpaa: failed to register misc device\n");
-- 
1.7.5.4

