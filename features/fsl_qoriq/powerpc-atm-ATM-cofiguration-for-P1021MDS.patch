From fefcf93c59154e3d7c75596e9335c8320ff98d09 Mon Sep 17 00:00:00 2001
From: Wei Yang <Wei.Yang@windriver.com>
Date: Fri, 15 Mar 2013 13:28:09 +0800
Subject: [PATCH 08/21] powerpc/atm: ATM cofiguration for P1021MDS

include bcsr and PMUXCR settings.

Signed-off-by: Liu Yu <yu.liu@freescale.com>
[Extracted from P1021MDS_20101124_ltib.iso Just some minor context
mods in order to port to 3.4 kernel]
Signed-off-by: Wei Yang <Wei.Yang@windriver.com>
---
 arch/powerpc/platforms/85xx/mpc85xx_mds.c |   16 ++++++++++++++++
 1 files changed, 16 insertions(+), 0 deletions(-)

diff --git a/arch/powerpc/platforms/85xx/mpc85xx_mds.c b/arch/powerpc/platforms/85xx/mpc85xx_mds.c
index 3a88c5b..2a469ab 100644
--- a/arch/powerpc/platforms/85xx/mpc85xx_mds.c
+++ b/arch/powerpc/platforms/85xx/mpc85xx_mds.c
@@ -231,6 +231,12 @@ static void __init mpc85xx_mds_reset_ucc_phys(void)
 		/* Reset Micrel PHY */
 		clrbits8(&bcsr_regs[11], BCSR11_ENET_MICRST);
 		setbits8(&bcsr_regs[11], BCSR11_ENET_MICRST);
+#if defined CONFIG_ATM_UCC
+#define BCSR6_LBC_UPC          (0x1 << 5)
+#define BCSR6_UPC_EN           (0x1 << 4)
+		clrbits8(&bcsr_regs[6], BCSR6_LBC_UPC);
+		clrbits8(&bcsr_regs[6], BCSR6_UPC_EN);
+#endif
 	}
 
 	iounmap(bcsr_regs);
@@ -291,6 +297,16 @@ static void __init mpc85xx_mds_qe_init(void)
 			 */
 				setbits32(&guts->pmuxcr, MPC85xx_PMUXCR_QE(0) |
 						  MPC85xx_PMUXCR_QE(3));
+#if defined CONFIG_ATM_UCC
+			clrbits32(&guts->pmuxcr, MPC85xx_PMUXCR_QE(12));
+			clrbits32(&guts->pmuxcr, MPC85xx_PMUXCR_QE(9));
+			setbits32(&guts->pmuxcr, MPC85xx_PMUXCR_QE(0) |
+					  MPC85xx_PMUXCR_QE(2) |
+					  MPC85xx_PMUXCR_QE(4) |
+					  MPC85xx_PMUXCR_QE(5) |
+					  MPC85xx_PMUXCR_QE(11));
+#endif
+
 				iounmap(guts);
 			}
 			of_node_put(np);
-- 
1.7.0

