From c5e6312423c2415670c65ac6a0669987ac8bbe67 Mon Sep 17 00:00:00 2001
From: Jerry Huang <Chang-Ming.Huang@freescale.com>
Date: Fri, 11 Jun 2010 14:23:53 +0800
Subject: [PATCH 08/23] MMC/SD: power on before detecting card

extract from vendor drop _QorIQ_SDK_V1_0x_systembuilder.iso.

power on before detecting card.

The driver will not get the right status when using the callback function 'get_cd' to check if the card is present because the power is not on.
Therefore, the controller must be power on before detecting the card status.

Signed-off-by: Jerry Huang <Chang-Ming.Huang@freescale.com>
---
 drivers/mmc/core/core.c |    3 +++
 1 file changed, 3 insertions(+)

diff --git a/drivers/mmc/core/core.c b/drivers/mmc/core/core.c
index ba821fe..3a65b1f 100644
--- a/drivers/mmc/core/core.c
+++ b/drivers/mmc/core/core.c
@@ -2044,6 +2044,9 @@ void mmc_rescan(struct work_struct *work)
 	 */
 	mmc_bus_put(host);
 
+	mmc_power_up(host);
+
+
 	if (host->ops->get_cd && host->ops->get_cd(host) == 0)
 		goto out;
 
-- 
1.7.9.7

