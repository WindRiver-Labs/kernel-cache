From b421ad8e651f48b73ef936f7688ae40e799291a1 Mon Sep 17 00:00:00 2001
From: Chandrakala Chavva <cchavva@caviumnetworks.com>
Date: Tue, 4 Feb 2014 19:10:44 -0800
Subject: [PATCH 011/202] NAND driver: disable subpage reads

Disable subpage support in the Octeon NAND driver, as it is
not properly supported. Subpage support is assumed by
nand_base.c for all large-page NAND flashes that use soft
ECC.
Without this change, UBI/UBIFS does not correctly work.

Signed-off-by: Chandrakala Chavva <cchavva@caviumnetworks.com>
[Original patch taken from Cavium SDK 3.1.1-544]
Signed-off-by: Bin Jiang <bin.jiang@windriver.com>
---
 arch/mips/cavium-octeon/octeon-nand.c | 7 +++++++
 1 file changed, 7 insertions(+)

diff --git a/arch/mips/cavium-octeon/octeon-nand.c b/arch/mips/cavium-octeon/octeon-nand.c
index 4aefa51..8a8db46 100644
--- a/arch/mips/cavium-octeon/octeon-nand.c
+++ b/arch/mips/cavium-octeon/octeon-nand.c
@@ -1226,6 +1226,13 @@ static int octeon_nand_probe(struct platform_device *pdev)
 			return -ENXIO;
 		}
 
+		/* Disable subpage support, as it is not properly supported
+		 * in this octeon-nand driver. Subpage support is assumed by
+		 * nand_base.c for all large-page NAND flashes that use soft
+		 * ECC.
+		 */
+		priv->nand.options &= ~NAND_SUBPAGE_READ;
+
 		/* We need to override the name, as the default names
 		 * have spaces in them, and this prevents the passing
 		 * of partitioning information on the kernel command line.
-- 
1.8.2.1

