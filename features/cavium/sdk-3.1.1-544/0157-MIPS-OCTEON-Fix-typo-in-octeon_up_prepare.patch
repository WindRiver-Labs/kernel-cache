From be24d1a89f3dcffe7de65e021dcc960160ae7fb4 Mon Sep 17 00:00:00 2001
From: David Daney <david.daney@cavium.com>
Date: Fri, 26 Sep 2014 11:18:06 -0700
Subject: [PATCH 157/202] MIPS: OCTEON: Fix typo in octeon_up_prepare().

We need to set the state of the target CPU, not the current CPU.

Signed-off-by: David Daney <david.daney@cavium.com>
[Original patch taken from Cavium SDK 3.1.1-544]
Signed-off-by: Bin Jiang <bin.jiang@windriver.com>
---
 arch/mips/cavium-octeon/smp.c | 2 +-
 1 file changed, 1 insertion(+), 1 deletion(-)

diff --git a/arch/mips/cavium-octeon/smp.c b/arch/mips/cavium-octeon/smp.c
index b58c83f..5753e97 100644
--- a/arch/mips/cavium-octeon/smp.c
+++ b/arch/mips/cavium-octeon/smp.c
@@ -372,7 +372,7 @@ static int octeon_up_prepare(unsigned int cpu)
 	int coreid = cpu_logical_map(cpu);
 	int node;
 
-	per_cpu(cpu_state, smp_processor_id()) = CPU_UP_PREPARE;
+	per_cpu(cpu_state, cpu) = CPU_UP_PREPARE;
 	octeon_bootvector[coreid] = octeon_hotplug_entry_raw;
 	mb();
 	/* Convert coreid to node,core spair and send NMI to target core */
-- 
1.8.2.1

