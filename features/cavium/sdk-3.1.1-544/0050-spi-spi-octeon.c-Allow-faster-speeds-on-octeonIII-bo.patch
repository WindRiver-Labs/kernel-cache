From b243cd61942ac630bd752bb31885619a2a1b9c1a Mon Sep 17 00:00:00 2001
From: Carlos Munoz <carlos.munoz@caviumnetworks.com>
Date: Fri, 13 Feb 2015 13:59:11 +0530
Subject: [PATCH 050/148] spi: spi-octeon.c: Allow faster speeds on octeonIII
 boards.

Commit 6b18a8b70414d74e52b4e09fd1b916b89c39059e from
git://git.yoctoproject.org/linux-yocto-3.14

Signed-off-by: Carlos Munoz <carlos.munoz@caviumnetworks.com>
Signed-off-by: Abhishek Paliwal <abhishek.paliwal@aricent.com>
---
 drivers/spi/spi-octeon.c | 9 +++++++++
 1 file changed, 9 insertions(+)

diff --git a/drivers/spi/spi-octeon.c b/drivers/spi/spi-octeon.c
index 5665ae9..3892cb9 100644
--- a/drivers/spi/spi-octeon.c
+++ b/drivers/spi/spi-octeon.c
@@ -25,6 +25,7 @@
 #define OCTEON_SPI_MAX_BYTES 9
 
 #define OCTEON_SPI_MAX_CLOCK_HZ 16000000
+#define OCTEON_SPI_MAX_CLOCK_HZ_7XXX    25000000        /** Max clock for O3 */
 
 struct octeon_spi {
 	u64 register_base;
@@ -77,6 +78,14 @@ static int octeon_spi_do_transfer(struct octeon_spi *p,
 	if (xfer->speed_hz)
 		speed_hz = xfer->speed_hz;
 
+	if (OCTEON_IS_OCTEON3()) {
+		if (speed_hz > OCTEON_SPI_MAX_CLOCK_HZ_7XXX)
+			speed_hz = OCTEON_SPI_MAX_CLOCK_HZ_7XXX;
+	} else {
+		if (speed_hz > OCTEON_SPI_MAX_CLOCK_HZ)
+			speed_hz = OCTEON_SPI_MAX_CLOCK_HZ;
+	}
+
 	if (speed_hz > OCTEON_SPI_MAX_CLOCK_HZ)
 		speed_hz = OCTEON_SPI_MAX_CLOCK_HZ;
 
-- 
1.8.2.1

