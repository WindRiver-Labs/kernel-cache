From 01ba5f72cefbf1dfae646d4f9042181be4d34c4f Mon Sep 17 00:00:00 2001
From: Chandrakala Chavva <cchavva@caviumnetworks.com>
Date: Sat, 12 Apr 2014 10:54:12 -0700
Subject: [PATCH 048/202] MIPS: OCTEON: Fix compilation issues for debugging
 kernel

Updated cvmx-core.h which has function to return number of TLB Entries,
required for pushing/poping tlb entries on debug exception.

Signed-off-by: Chandrakala Chavva <cchavva@caviumnetworks.com>
[Original patch taken from Cavium SDK 3.1.1-544]
Signed-off-by: Bin Jiang <bin.jiang@windriver.com>
---
 arch/mips/cavium-octeon/executive/Makefile |  2 +-
 arch/mips/include/asm/octeon/cvmx-core.h   | 16 +++++++++++++---
 2 files changed, 14 insertions(+), 4 deletions(-)

diff --git a/arch/mips/cavium-octeon/executive/Makefile b/arch/mips/cavium-octeon/executive/Makefile
index 9023f08..5acfae8 100644
--- a/arch/mips/cavium-octeon/executive/Makefile
+++ b/arch/mips/cavium-octeon/executive/Makefile
@@ -29,4 +29,4 @@ obj-$(CONFIG_USB_OCTEON_HCD)		+= cvmx-usb.o
 obj-$(CONFIG_CAVIUM_OCTEON_RAPIDIO) 	+= cvmx-dma-engine.o
 obj-$(CONFIG_CAVIUM_OCTEON_NAND)	+= cvmx-bch.o cvmx-nand.o
 obj-$(CONFIG_CAVIUM_OCTEON_ERROR_TREE)	+= cvmx-error-trees.o
-obj-$(CONFIG_CAVIUM_GDB)		+= cvmx-debug.o cvmx-core.o cvmx-debug-handler.o cvmx-debug-uart.o cvmx-debug-remote.o
+obj-$(CONFIG_CAVIUM_GDB)		+= cvmx-debug.o cvmx-debug-handler.o cvmx-debug-uart.o cvmx-debug-remote.o
diff --git a/arch/mips/include/asm/octeon/cvmx-core.h b/arch/mips/include/asm/octeon/cvmx-core.h
index 848498f..c1e0560 100644
--- a/arch/mips/include/asm/octeon/cvmx-core.h
+++ b/arch/mips/include/asm/octeon/cvmx-core.h
@@ -1,5 +1,5 @@
 /***********************license start***************
- * Copyright (c) 2003-2013  Cavium Inc. (support@cavium.com). All rights
+ * Copyright (c) 2003-2014  Cavium Inc. (support@cavium.com). All rights
  * reserved.
  *
  *
@@ -42,7 +42,7 @@
  *
  * Module to support operations on core such as TLB config, etc.
  *
- * <hr>$Revision: 90021 $<hr>
+ * <hr>$Revision: 96463 $<hr>
  *
  */
 
@@ -287,7 +287,17 @@ int cvmx_core_add_fixed_tlb_mapping_bits(uint64_t vaddr, uint64_t page0_addr, ui
 /**
  * Return number of TLB entries.
  */
-int cvmx_core_get_tlb_entries(void);
+static inline int cvmx_core_get_tlb_entries(void)
+{
+	if (OCTEON_IS_MODEL(OCTEON_CN3XXX))
+		return 32;
+	else if (OCTEON_IS_MODEL(OCTEON_CN5XXX))
+		return 64;
+	else if (OCTEON_IS_OCTEON2())
+		return 128;
+	else
+		return 256;
+}
 #ifdef	__cplusplus
 /* *INDENT-OFF* */
 }
-- 
1.8.2.1

