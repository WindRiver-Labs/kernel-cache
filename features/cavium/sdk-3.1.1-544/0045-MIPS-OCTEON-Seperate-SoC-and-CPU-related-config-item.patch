From c327309e382324f573b1ec0cf5b8fc8e8b226a66 Mon Sep 17 00:00:00 2001
From: David Daney <david.daney@cavium.com>
Date: Fri, 13 Feb 2015 14:09:54 +0530
Subject: [PATCH 045/132] MIPS: OCTEON: Seperate SoC and CPU related config
 items

Commit 86627625fc5bec56177d02d772493190b56c109c from
git://git.yoctoproject.org/linux-yocto-3.14

Segregate SOC and CPU related config items so that if we select
CPU_CAVIUM_OCTEON, we don't get to select SoC support unrelated to the
CPU, those are enabled by CAVIUM_OCTEON_SOC.

It is advantageous to use CONFIG_CAVIUM_OCTEON2 with OCTEON III CPU
cores as they have the same instruction set.  However, OCTEON III
doesn't require the CN63XXP1 workaround, so make it optional.

Signed-off-by: David Daney <david.daney@cavium.com>
Signed-off-by: Abhishek Paliwal <abhishek.paliwal@aricent.com>
[Original patch taken from OCTEON-SDK 3.1.1-544.]
Signed-off-by: Yanjiang Jin <yanjiang.jin@windriver.com>
---
 arch/mips/cavium-octeon/Kconfig | 25 ++++++++++++-------------
 arch/mips/cavium-octeon/setup.c |  2 +-
 2 files changed, 13 insertions(+), 14 deletions(-)

diff --git a/arch/mips/cavium-octeon/Kconfig b/arch/mips/cavium-octeon/Kconfig
index b81bbd0..1a78943 100644
--- a/arch/mips/cavium-octeon/Kconfig
+++ b/arch/mips/cavium-octeon/Kconfig
@@ -1,14 +1,22 @@
 if CPU_CAVIUM_OCTEON
 
+config CAVIUM_OCTEON2
+	bool "Build the kernel to be used only on OCTEON II or OCTEON III processor cores"
+	default "n"
+	help
+	  This option enables the generation of Octeon2 specific
+	  instructions by the compiler, resulting in a kernel that is
+	  more efficient, but that will not run on Octeon and
+	  OcteonPlus processor cores.
+
 config CAVIUM_CN63XXP1
-	bool "Enable CN63XXP1 errata workarounds"
+	bool "Enable CN6XXX DCache prefetch errata workaround"
 	default "n"
 	help
-	  The CN63XXP1 chip requires build time workarounds to
+	  The CN63XXP1 chip require build time workarounds to
 	  function reliably, select this option to enable them.  These
 	  workarounds will cause a slight decrease in performance on
-	  non-CN63XXP1 hardware, so it is recommended to select "n"
-	  unless it is known the workarounds are needed.
+	  non-CN6XXX hardware.
 
 config CAVIUM_OCTEON_EXTRA_CVMSEG
 	int "Number of extra L1 cache lines reserved for CVMSEG memory"
@@ -41,15 +49,6 @@ endif # CPU_CAVIUM_OCTEON
 
 if CAVIUM_OCTEON_SOC
 
-config CAVIUM_OCTEON_2ND_KERNEL
-	bool "Build the kernel to be used as a 2nd kernel on the same chip"
-	default "n"
-	help
-	  This option configures this kernel to be linked at a different
-	  address and use the 2nd uart for output. This allows a kernel built
-	  with this option to be run at the same time as one built without this
-	  option.
-
 config FAST_ACCESS_TO_THREAD_POINTER
 	bool "Enable fast access to the thread pointer"
 	default "y"
diff --git a/arch/mips/cavium-octeon/setup.c b/arch/mips/cavium-octeon/setup.c
index 84116ba..61ede11 100644
--- a/arch/mips/cavium-octeon/setup.c
+++ b/arch/mips/cavium-octeon/setup.c
@@ -612,7 +612,7 @@ void octeon_user_io_init(void)
 
 	/* Setup of CVMSEG is done in kernel-entry-init.h */
 	if (smp_processor_id() == 0)
-		pr_notice("CVMSEG size: %d cache lines (%d bytes)\n",
+		pr_notice("CVMSEG size: %u cache lines (%u bytes)\n",
 			  CONFIG_CAVIUM_OCTEON_CVMSEG_SIZE,
 			  CONFIG_CAVIUM_OCTEON_CVMSEG_SIZE * 128);
 
-- 
1.9.1

