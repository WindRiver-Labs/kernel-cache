From 547d7da06ac0fdf2556a87028750e40e6eca6681 Mon Sep 17 00:00:00 2001
From: Carlos Munoz <cmunoz@caviumnetworks.com>
Date: Tue, 17 Jun 2014 09:47:20 -0700
Subject: [PATCH 106/202] netdev: ethernet.c: Use at least 8 pko queues per
 port.

Signed-off-by: Carlos Munoz <cmunoz@caviumnetworks.com>
[Original patch taken from Cavium SDK 3.1.1-544]
Signed-off-by: Bin Jiang <bin.jiang@windriver.com>
---
 drivers/net/ethernet/octeon/ethernet.c | 4 ++--
 1 file changed, 2 insertions(+), 2 deletions(-)

diff --git a/drivers/net/ethernet/octeon/ethernet.c b/drivers/net/ethernet/octeon/ethernet.c
index aeeced0..9db6578 100644
--- a/drivers/net/ethernet/octeon/ethernet.c
+++ b/drivers/net/ethernet/octeon/ethernet.c
@@ -215,7 +215,7 @@ static bool cvm_oct_pko_lockless(void)
 			case CVMX_HELPER_INTERFACE_MODE_RGMII:
 			case CVMX_HELPER_INTERFACE_MODE_GMII:
 			case CVMX_HELPER_INTERFACE_MODE_SPI:
-				queues += num_possible_cpus();
+				queues += max(8u, num_possible_cpus());
 				break;
 			case CVMX_HELPER_INTERFACE_MODE_NPI:
 			case CVMX_HELPER_INTERFACE_MODE_LOOP:
@@ -255,7 +255,7 @@ static void cvm_oct_set_pko_multiqueue(void)
 			case CVMX_HELPER_INTERFACE_MODE_GMII:
 			case CVMX_HELPER_INTERFACE_MODE_SPI:
 				rv = cvmx_pko_alloc_iport_and_queues(interface, port, 1,
-								     num_possible_cpus());
+								     max(8u, num_possible_cpus()));
 				WARN(rv, "cvmx_pko_alloc_iport_and_queues failed");
 				if (rv)
 					return;
-- 
1.8.2.1

