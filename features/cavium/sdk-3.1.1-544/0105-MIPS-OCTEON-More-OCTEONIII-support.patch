From 48a3c9baf181cee4fb034d239089e10fe968c322 Mon Sep 17 00:00:00 2001
From: Chandrakala Chavva <cchavva@caviumnetworks.com>
Date: Fri, 23 Jan 2015 09:53:14 -0800
Subject: [PATCH 105/132] MIPS:OCTEON: More OCTEONIII support

Porting missing part from WRL7.

Read clock rate from the correct CSR. Don't clear COP0_DCACHE for OCTEONIII.

Signed-off-by: Chandrakala Chavva <cchavva@caviumnetworks.com>
Signed-off-by: Abhishek Paliwal <abhishek.paliwal@aricent.com>
Signed-off-by: Bruce Ashfield <bruce.ashfield@windriver.com>
Signed-off-by: Yanjiang Jin <yanjiang.jin@windriver.com>
---
 arch/mips/Makefile                           | 7 +++++++
 arch/mips/include/asm/octeon/cvmx-rst-defs.h | 2 ++
 2 files changed, 9 insertions(+)

diff --git a/arch/mips/Makefile b/arch/mips/Makefile
index 4a34147..96806e0 100644
--- a/arch/mips/Makefile
+++ b/arch/mips/Makefile
@@ -186,6 +186,13 @@ cflags-y += -DCVMX_ENABLE_PARAMETER_CHECKING=1
 else
 cflags-y += -DCVMX_ENABLE_PARAMETER_CHECKING=0
 endif
+
+ifdef  CONFIG_CAVIUM_OCTEON_CHK_CVMX_ADDRESS
+cflags-y += -DCVMX_ENABLE_CSR_ADDRESS_CHECKING=1
+else
+cflags-y += -DCVMX_ENABLE_CSR_ADDRESS_CHECKING=0
+endif
+
 cflags-$(CONFIG_CPU_BMIPS)	+= -march=mips32 -Wa,-mips32 -Wa,--trap
 #
 # binutils from v2.25 on and gcc starting from v4.9.0 treat -march=loongson3a
diff --git a/arch/mips/include/asm/octeon/cvmx-rst-defs.h b/arch/mips/include/asm/octeon/cvmx-rst-defs.h
index 0c9c3e7..1b39ba2 100644
--- a/arch/mips/include/asm/octeon/cvmx-rst-defs.h
+++ b/arch/mips/include/asm/octeon/cvmx-rst-defs.h
@@ -84,6 +84,7 @@ union cvmx_rst_boot {
 	struct cvmx_rst_boot_s cn70xxp1;
 	struct cvmx_rst_boot_s cn78xx;
 };
+typedef union cvmx_rst_boot cvmx_rst_boot_t;
 
 union cvmx_rst_cfg {
 	uint64_t u64;
@@ -154,6 +155,7 @@ union cvmx_rst_ctlx {
 	struct cvmx_rst_ctlx_s cn70xxp1;
 	struct cvmx_rst_ctlx_s cn78xx;
 };
+typedef union cvmx_rst_ctlx cvmx_rst_ctlx_t;
 
 union cvmx_rst_delay {
 	uint64_t u64;
-- 
1.9.1

