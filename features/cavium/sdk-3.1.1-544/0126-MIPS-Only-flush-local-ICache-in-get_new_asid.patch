From f7c26c2a434bfeeedba99c8a8af42771dcaef6d4 Mon Sep 17 00:00:00 2001
From: David Daney <david.daney@cavium.com>
Date: Fri, 13 Feb 2015 15:32:12 +0530
Subject: [PATCH 126/148] MIPS: Only flush local ICache in get_new_asid().

Commit f5fc131b3e4413f197d3401acea29d6ca8f60ceb from
git://git.yoctoproject.org/linux-yocto-3.14

For virtually tagged ICache, on ASID rollover, only the local ICache
needs to be invalidated.  Flushing across all CPUs is unnecessary.

Signed-off-by: David Daney <david.daney@cavium.com>
Signed-off-by: Abhishek Paliwal <abhishek.paliwal@aricent.com>
---
 arch/mips/include/asm/mmu_context.h | 2 +-
 1 file changed, 1 insertion(+), 1 deletion(-)

diff --git a/arch/mips/include/asm/mmu_context.h b/arch/mips/include/asm/mmu_context.h
index e277bba..37b593b 100644
--- a/arch/mips/include/asm/mmu_context.h
+++ b/arch/mips/include/asm/mmu_context.h
@@ -102,7 +102,7 @@ get_new_mmu_context(struct mm_struct *mm, unsigned long cpu)
 
 	if (! ((asid += ASID_INC) & ASID_MASK) ) {
 		if (cpu_has_vtag_icache)
-			flush_icache_all();
+			local_flush_icache_all();
 #ifdef CONFIG_KVM
 		kvm_local_flush_tlb_all();      /* start new asid cycle */
 #else
-- 
1.8.2.1

