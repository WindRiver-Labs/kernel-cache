From b844588d8499bbf85ef98e1843e116f890318a7a Mon Sep 17 00:00:00 2001
From: David Daney <david.daney@cavium.com>
Date: Fri, 13 Feb 2015 15:22:26 +0530
Subject: [PATCH 091/132] MIPS: move arch/mips/cavium-octeon/cpu.c to
 arch/mips/kernel/

Commit 51bdc4cf3d5f6b8f7a191687347b17654fbc2615 from
git://git.yoctoproject.org/linux-yocto-3.14

... and rename it to octeon-cpu.c.

Follow-on patches will be using this code for non-OCTEON-SoC systems
that have OCTEON CPUs, so we need it in a common place.

Signed-off-by: David Daney <david.daney@cavium.com>
Signed-off-by: Abhishek Paliwal <abhishek.paliwal@aricent.com>
[Original patch taken from OCTEON-SDK 3.1.1-544.]
Signed-off-by: Yanjiang Jin <yanjiang.jin@windriver.com>
---
 arch/mips/cavium-octeon/cpu.c | 48 -------------------------------------------
 1 file changed, 48 deletions(-)
 delete mode 100644 arch/mips/cavium-octeon/cpu.c

diff --git a/arch/mips/cavium-octeon/cpu.c b/arch/mips/cavium-octeon/cpu.c
deleted file mode 100644
index a5b4279..0000000
--- a/arch/mips/cavium-octeon/cpu.c
+++ /dev/null
@@ -1,48 +0,0 @@
-/*
- * This file is subject to the terms and conditions of the GNU General Public
- * License.  See the file "COPYING" in the main directory of this archive
- * for more details.
- *
- * Copyright (C) 2009 Wind River Systems,
- *   written by Ralf Baechle <ralf@linux-mips.org>
- */
-#include <linux/init.h>
-#include <linux/irqflags.h>
-#include <linux/notifier.h>
-#include <linux/prefetch.h>
-#include <linux/sched.h>
-
-#include <asm/cop2.h>
-#include <asm/current.h>
-#include <asm/mipsregs.h>
-#include <asm/page.h>
-#include <asm/octeon/octeon.h>
-
-static int cnmips_cu2_call(struct notifier_block *nfb, unsigned long action,
-	void *data)
-{
-	unsigned long flags;
-	unsigned int status;
-
-	switch (action) {
-	case CU2_EXCEPTION:
-		prefetch(&current->thread.cp2);
-		local_irq_save(flags);
-		KSTK_STATUS(current) |= ST0_CU2;
-		status = read_c0_status();
-		write_c0_status(status | ST0_CU2);
-		octeon_cop2_restore(&(current->thread.cp2));
-		write_c0_status(status & ~ST0_CU2);
-		local_irq_restore(flags);
-
-		return NOTIFY_BAD;	/* Don't call default notifier */
-	}
-
-	return NOTIFY_OK;		/* Let default notifier send signals */
-}
-
-static int __init cnmips_cu2_setup(void)
-{
-	return cu2_notifier(cnmips_cu2_call, 0);
-}
-early_initcall(cnmips_cu2_setup);
-- 
1.9.1

