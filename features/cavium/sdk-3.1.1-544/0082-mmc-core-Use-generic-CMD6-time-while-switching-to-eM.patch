From fd7e5ef0b28649d2829a48fe2d10e0149d9c92f7 Mon Sep 17 00:00:00 2001
From: Peter Swain <pswain@cavium.net>
Date: Fri, 13 Feb 2015 14:38:52 +0530
Subject: [PATCH 082/148] mmc: core: Use generic CMD6 time while switching to
 eMMC HS200 mode

commit 57de31f6351ecad9212a26d2112b546e4c8b4a5 upstream

Conform to the eMMC spec and use the CMD6 generic timeout from the
EXT_CSD register, when switching to HS200 mode.

Signed-off-by: Peter Swain <pswain@cavium.net>
Signed-off-by: Ulf Hansson <ulf.hansson@linaro.org>
Signed-off-by: Chris Ball <chris@printf.net>
Signed-off-by: Abhishek Paliwal <abhishek.paliwal@aricent.com>
---
 drivers/mmc/core/mmc.c | 3 ++-
 1 file changed, 2 insertions(+), 1 deletion(-)

diff --git a/drivers/mmc/core/mmc.c b/drivers/mmc/core/mmc.c
index 6d91ff7..ab920de 100644
--- a/drivers/mmc/core/mmc.c
+++ b/drivers/mmc/core/mmc.c
@@ -857,7 +857,8 @@ static int mmc_select_hs200(struct mmc_card *card)
 	/* switch to HS200 mode if bus width set successfully */
 	if (!err)
 		err = mmc_switch(card, EXT_CSD_CMD_SET_NORMAL,
-				 EXT_CSD_HS_TIMING, 2, 0);
+				 EXT_CSD_HS_TIMING, 2,
+				 card->ext_csd.generic_cmd6_time);
 err:
 	return err;
 }
-- 
1.8.2.1

