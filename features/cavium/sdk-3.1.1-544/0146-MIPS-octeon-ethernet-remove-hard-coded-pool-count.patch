From 28333a121b894e8f099eeda7bea84016925b3226 Mon Sep 17 00:00:00 2001
From: Peter Swain <pswain@cavium.com>
Date: Thu, 18 Sep 2014 21:58:28 -0700
Subject: [PATCH 146/202] MIPS: octeon-ethernet: remove hard-coded pool count

Eliminate explicitly-sized cvm_oct_pools[], sizing it to
[CVMX_FPA1_NUM_POOLS+1] to provide resilience against off-by-one.

This was causing hang when CVMX_FPA1_NUM_POOLS was upped to 9 in 8806baadfe,
which still seems to occur on cn70 after it was reduced to 8.

Signed-off-by: Peter Swain <peter.swain@cavium.com>
[Original patch taken from Cavium SDK 3.1.1-544]
Signed-off-by: Bin Jiang <bin.jiang@windriver.com>
---
 drivers/net/ethernet/octeon/ethernet-mem.c | 5 ++---
 1 file changed, 2 insertions(+), 3 deletions(-)

diff --git a/drivers/net/ethernet/octeon/ethernet-mem.c b/drivers/net/ethernet/octeon/ethernet-mem.c
index 8e66f06..b90c00b 100644
--- a/drivers/net/ethernet/octeon/ethernet-mem.c
+++ b/drivers/net/ethernet/octeon/ethernet-mem.c
@@ -46,9 +46,8 @@ struct fpa_pool {
 };
 
 static DEFINE_MUTEX(cvm_oct_pools_lock);
-/* Eight pools. */
-static struct fpa_pool cvm_oct_pools[] = {
-	{-1}, {-1}, {-1}, {-1}, {-1}, {-1}, {-1}, {-1}
+static struct fpa_pool cvm_oct_pools[CVMX_FPA1_NUM_POOLS+1] = {
+	[0 ... CVMX_FPA1_NUM_POOLS] = {-1,},
 };
 
 /**
-- 
1.8.2.1

