From 88d9d5ecaa64a799697306d189bba9aac825d608 Mon Sep 17 00:00:00 2001
From: David Daney <david.daney@cavium.com>
Date: Tue, 23 Sep 2014 15:36:43 -0700
Subject: [PATCH 149/202] MIPS: Make setting of MAX_PHYSMEM_BITS settable per
 sub-architecture.

OCTEON needs 40 bits (41 for NUMA).  But making this too big
universally wastes space in the mem_section array, so make it settable
per mips machine type.

Signed-off-by: David Daney <david.daney@cavium.com>
[Original patch taken from Cavium SDK 3.1.1-544]
Signed-off-by: Bin Jiang <bin.jiang@windriver.com>
---
 arch/mips/include/asm/mach-cavium-octeon/physmem.h | 10 ++++++++++
 arch/mips/include/asm/mach-generic/physmem.h       |  6 ++++++
 arch/mips/include/asm/sparsemem.h                  |  2 +-
 3 files changed, 17 insertions(+), 1 deletion(-)
 create mode 100644 arch/mips/include/asm/mach-cavium-octeon/physmem.h
 create mode 100644 arch/mips/include/asm/mach-generic/physmem.h

diff --git a/arch/mips/include/asm/mach-cavium-octeon/physmem.h b/arch/mips/include/asm/mach-cavium-octeon/physmem.h
new file mode 100644
index 0000000..d1622a9
--- /dev/null
+++ b/arch/mips/include/asm/mach-cavium-octeon/physmem.h
@@ -0,0 +1,10 @@
+#ifndef _ASM_MACH_CAVIUM_OCTEON_PHYSMEM_H
+#define _ASM_MACH_CAVIUM_OCTEON_PHYSMEM_H
+
+#ifdef CONFIG_NUMA
+#define MAX_PHYSMEM_BITS        41
+#else
+#define MAX_PHYSMEM_BITS        40
+#endif
+
+#endif /* _ASM_MACH_CAVIUM_OCTEON_PHYSMEM_H */
diff --git a/arch/mips/include/asm/mach-generic/physmem.h b/arch/mips/include/asm/mach-generic/physmem.h
new file mode 100644
index 0000000..6a900cd
--- /dev/null
+++ b/arch/mips/include/asm/mach-generic/physmem.h
@@ -0,0 +1,6 @@
+#ifndef _ASM_MACH_GENERIC_PHYSMEM_H
+#define _ASM_MACH_GENERIC_PHYSMEM_H
+
+#define MAX_PHYSMEM_BITS        38
+
+#endif /*_ASM_MACH_GENERIC_PHYSMEM_H */
diff --git a/arch/mips/include/asm/sparsemem.h b/arch/mips/include/asm/sparsemem.h
index b199871..b773f6d 100644
--- a/arch/mips/include/asm/sparsemem.h
+++ b/arch/mips/include/asm/sparsemem.h
@@ -12,7 +12,7 @@
 # define SECTION_SIZE_BITS	28
 #endif
 
-#define MAX_PHYSMEM_BITS        38
+#include <physmem.h>
 
 #endif /* CONFIG_SPARSEMEM */
 #endif /* _MIPS_SPARSEMEM_H */
-- 
1.8.2.1

