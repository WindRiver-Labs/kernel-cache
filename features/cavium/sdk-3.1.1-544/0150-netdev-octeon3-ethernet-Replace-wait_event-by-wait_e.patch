From 5ef637b0efa410f605b992b3fb06917699003193 Mon Sep 17 00:00:00 2001
From: Andreas Herrmann <andreas.herrmann@caviumnetworks.com>
Date: Tue, 9 Sep 2014 20:01:57 +0200
Subject: [PATCH 150/202] netdev: octeon3-ethernet: Replace wait_event by
 wait_event_interruptible

... to avoid

[  304.646015] INFO: task oct3_eth/0:1:1249 blocked for more than 120 seconds.
[  304.652979] "echo 0 > /proc/sys/kernel/hung_task_timeout_secs" disables this message.
[  304.660811] oct3_eth/0:1    D ffffffff80538934     0  1249      2 0x00100000
[  304.667884] Stack : 0000000000000000 ffffffff80a90000 8000000029c7ad80 ffffffff80a90000
[  304.667884]    00000000ffff8dd3 0000000000000000 8000000029c7ad80 ffffffff801c7174
[  304.667884]    000000010cd6e2b8 8000000029c7ae18 0000000000000001 8000000029c7ad80
[  304.667884]    8000000029c7ad80 ffffffff801bbd84 ffffffff866bfd80 800000040c1a0338
[  304.667884]    800000040cd6e2b8 ffffffff866bfd80 800000040c1a0338 ffffffff8076f248
[  304.667884]    0000000000000000 0000000000000000 0000000000000000 0000000000000000
[  304.667884]    0000000000000000 0000000000000000 0000000000000000 0000000000000000
[  304.667884]    0000000000000000 0000000000000002 0000000000000000 0000000000000000
[  304.667884]    0000000000000001 ffffffff809cc820 0000000000000000 ffffffff809cc820
[  304.667884]    0000000000000000 0000000000000000 0000000000000000 0000000000000001
[  304.667884]    ...
[  304.733423] Call Trace:
[  304.735875] [<ffffffff8076f1f4>] __schedule+0x354/0x7d8
[  304.741107] [<ffffffff80538934>] octeon3_eth_tx_complete_worker+0xc4/0x580
[  304.747987] [<ffffffff801b12d8>] kthread+0xb8/0xc0
[  304.752780] [<ffffffff80152454>] ret_from_kernel_thread+0x14/0x1c

Signed-off-by: Andreas Herrmann <andreas.herrmann@caviumnetworks.com>
[Original patch taken from Cavium SDK 3.1.1-544]
Signed-off-by: Bin Jiang <bin.jiang@windriver.com>
---
 drivers/net/ethernet/octeon/octeon3-ethernet.c | 6 +++++-
 1 file changed, 5 insertions(+), 1 deletion(-)

diff --git a/drivers/net/ethernet/octeon/octeon3-ethernet.c b/drivers/net/ethernet/octeon/octeon3-ethernet.c
index 47a0a9f..87d2cad 100644
--- a/drivers/net/ethernet/octeon/octeon3-ethernet.c
+++ b/drivers/net/ethernet/octeon/octeon3-ethernet.c
@@ -370,7 +370,11 @@ static int octeon3_eth_tx_complete_worker(void *data)
 	unsigned long last_jiffies = jiffies;
 #endif
 	for (;;) {
-		wait_event(worker->queue, octeon3_eth_tx_complete_runnable(worker));
+		/*
+		 * repalced by wait_event to avoid warnings like
+		 * "task oct3_eth/0:2:1250 blocked for more than 120 seconds."
+		 */
+		wait_event_interruptible(worker->queue, octeon3_eth_tx_complete_runnable(worker));
 		atomic_dec_if_positive(&worker->kick); /* clear the flag */
 		loops = 0;
 		do {
-- 
1.8.2.1

