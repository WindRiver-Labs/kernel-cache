From bf2928fa9cf2c4fa554ea8c51a50e89d88ff59e5 Mon Sep 17 00:00:00 2001
From: Vinita Gupta <vgupta@caviumnetworks.com>
Date: Wed, 6 Nov 2013 15:17:39 -0800
Subject: [PATCH 315/518] MIPS:OCTEON:SATA: fixed code to make sata loadable
 module working

Source: Cavium Networks, Inc.
MR: 00000
Type: Integration
Disposition: Merged from Octeon Tree
ChangeID: 7f3e71257899288eab8f41d1871169a9812d73eb
Description:

Signed-off-by: Vinita Gupta <vgupta@caviumnetworks.com>
Signed-off-by: Corey Minyard <cminyard@mvista.com>
[Original patch taken from Cavium SDK 3.1.1 525]
Signed-off-by: Yanjiang Jin <yanjiang.jin@windriver.com>
---
 drivers/ata/ahci_platform.c | 2 +-
 drivers/ata/sata_octeon.c   | 6 ++++++
 2 files changed, 7 insertions(+), 1 deletion(-)

diff --git a/drivers/ata/ahci_platform.c b/drivers/ata/ahci_platform.c
index e36d4d1..f757fe1 100644
--- a/drivers/ata/ahci_platform.c
+++ b/drivers/ata/ahci_platform.c
@@ -102,7 +102,7 @@ static int ahci_probe(struct platform_device *pdev)
 	int i;
 	int rc;
 
-#ifdef CONFIG_SATA_OCTEON
+#if IS_ENABLED(CONFIG_SATA_OCTEON)
 	ahci_octeon_config();
 #endif
 	mem = platform_get_resource(pdev, IORESOURCE_MEM, 0);
diff --git a/drivers/ata/sata_octeon.c b/drivers/ata/sata_octeon.c
index 1496d5e..6be0578 100644
--- a/drivers/ata/sata_octeon.c
+++ b/drivers/ata/sata_octeon.c
@@ -10,6 +10,7 @@
  *
  */
 
+#include <linux/module.h>
 #include <asm/octeon/octeon.h>
 #include <asm/octeon/cvmx-sata-defs.h>
 
@@ -28,3 +29,8 @@ void ahci_octeon_config(void)
 #endif
 	cvmx_write_csr(CVMX_SATA_UCTL_SHIM_CFG, shim_cfg.u64);
 }
+EXPORT_SYMBOL(ahci_octeon_config);
+
+MODULE_LICENSE("GPL");
+MODULE_AUTHOR("Cavium, Inc. <support@cavium.com>");
+MODULE_DESCRIPTION("Cavium Inc. sata config.");
-- 
1.9.1

