From 46da478bf5aff87a0e4282f97e7ab1c284060668 Mon Sep 17 00:00:00 2001
From: Chandrakala Chavva <cchavva@caviumnetworks.com>
Date: Mon, 17 Jun 2013 17:43:08 -0700
Subject: [PATCH 159/518] EDAC:OCTEON: Fix reading LMCX_DLL_CTL2 CSR fields.

Source: Cavium Networks, Inc.
MR: 00000
Type: Integration
Disposition: Merged from Octeon Tree
ChangeID: dca43f009bc6dcfc57590df1b550da3770c76f44
Description:

Read LMCX_DLL_CTL2<quad_dll_ena> from the correct struct.

Signed-off-by: Chandrakala Chavva <cchavva@caviumnetworks.com>
Signed-off-by: Corey Minyard <cminyard@mvista.com>
[Original patch taken from Cavium SDK 3.1.1 525]
Signed-off-by: Yanjiang Jin <yanjiang.jin@windriver.com>
---
 drivers/edac/octeon_edac-lmc.c | 3 ++-
 1 file changed, 2 insertions(+), 1 deletion(-)

diff --git a/drivers/edac/octeon_edac-lmc.c b/drivers/edac/octeon_edac-lmc.c
index fa219f9..12d1510 100644
--- a/drivers/edac/octeon_edac-lmc.c
+++ b/drivers/edac/octeon_edac-lmc.c
@@ -134,7 +134,8 @@ static int octeon_lmc_edac_probe(struct platform_device *pdev)
 
 		/* Check if LMC controller is enabled. */
 		ctl2.u64 = cvmx_read_csr(CVMX_LMCX_DLL_CTL2(mc));
-		if (ctl2.s.quad_dll_ena == 0) {
+		if ((OCTEON_IS_OCTEON3() && ctl2.cn70xx.quad_dll_ena == 0)
+		    || (OCTEON_IS_OCTEON2() && ctl2.cn63xx.quad_dll_ena == 0)) { 
 			dev_info(&pdev->dev, "Disabled (LMC not present)\n");
 			return 0;
 		}
-- 
1.9.1

