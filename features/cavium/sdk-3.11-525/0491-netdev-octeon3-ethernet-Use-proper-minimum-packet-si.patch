From 71ce11dbf1d3921f85fba87a0855b04a0a6c09d0 Mon Sep 17 00:00:00 2001
From: David Daney <david.daney@cavium.com>
Date: Fri, 23 May 2014 10:54:00 -0700
Subject: [PATCH 491/518] netdev: octeon3-ethernet: Use proper minimum packet
 size padding for 10G ports.

Source: Cavium Networks, Inc.
MR: 00000
Type: Integration
Disposition: Merged from Octeon Tree
ChangeID: 894b0ac90916968b0988ce0c61fa61df0bb006e4
Description:

Signed-off-by: David Daney <david.daney@cavium.com>
Signed-off-by: Corey Minyard <cminyard@mvista.com>
[Original patch taken from Cavium SDK 3.1.1 525]
Signed-off-by: Yanjiang Jin <yanjiang.jin@windriver.com>
---
 drivers/net/ethernet/octeon/octeon-bgx-port.c | 6 ++++--
 1 file changed, 4 insertions(+), 2 deletions(-)

diff --git a/drivers/net/ethernet/octeon/octeon-bgx-port.c b/drivers/net/ethernet/octeon/octeon-bgx-port.c
index 727dc9c..11cefba 100644
--- a/drivers/net/ethernet/octeon/octeon-bgx-port.c
+++ b/drivers/net/ethernet/octeon/octeon-bgx-port.c
@@ -225,7 +225,8 @@ int bgx_port_enable(struct net_device *netdev)
 				    tx_append.u64);
 
 		min_pkt.u64 = 0;
-		min_pkt.s.min_size = 60 - 1; /* packets are padded to MIN_SIZE + 1 in SGMII */
+		/* packets are padded (without FCS) to MIN_SIZE + 1 in SGMII */
+		min_pkt.s.min_size = 60 - 1;
 		cvmx_write_csr_node(priv->numa_node,
 				    CVMX_BGXX_GMP_GMI_TXX_MIN_PKT(priv->index, priv->bgx_interface),
 				    min_pkt.u64);
@@ -244,7 +245,8 @@ int bgx_port_enable(struct net_device *netdev)
 				    tx_append.u64);
 
 		min_pkt.u64 = 0;
-		min_pkt.s.min_size = 60;/* packets are padded to MIN_SIZE in non-SGMII */
+		/* packets are padded(with FCS) to MIN_SIZE  in non-SGMII */
+		min_pkt.s.min_size = 60 + 4;
 		cvmx_write_csr_node(priv->numa_node,
 				    CVMX_BGXX_SMUX_TX_MIN_PKT(priv->index, priv->bgx_interface),
 				    min_pkt.u64);
-- 
1.9.1

