From 3ec886d957d6ce6d2f8abbd2793ec11aadace75c Mon Sep 17 00:00:00 2001
From: Peter Swain <peter.swain@cavium.com>
Date: Tue, 4 Mar 2014 17:48:50 -0800
Subject: [PATCH 406/518] perf: context-sensitive keywords: for
 uncore_foo/miss/

Source: Cavium Networks, Inc.
MR: 00000
Type: Integration
Disposition: Merged from Octeon Tree
ChangeID: 6622eb832f39dfd3169fbc27fa322e95aa264aea
Description:

Previously the inbuilt event names could not be re-used in subsystem
context, like uncore_foo/miss/, because "miss" was always recognized
as a builtin keyword by the lexer.

Now such useful event names as "cycles", "store", "miss" and "ops"
are only recognized as builtin events in the <INITIAL> state,
so they're free to be re-used without conflict as the names of
events within add-in subsystems. This allows event-naming to follow
hardware docs, avoiding an extra level of name-mapping documentation.

Running "perf stat -a -e cycles,uncore_dma/cycles/" is now allowed.

Signed-off-by: Corey Minyard <cminyard@mvista.com>
[Original patch taken from Cavium SDK 3.1.1 525]
Signed-off-by: Yanjiang Jin <yanjiang.jin@windriver.com>
---
 tools/perf/util/parse-events.l | 2 ++
 1 file changed, 2 insertions(+)

diff --git a/tools/perf/util/parse-events.l b/tools/perf/util/parse-events.l
index e9d1134..15a97b6 100644
--- a/tools/perf/util/parse-events.l
+++ b/tools/perf/util/parse-events.l
@@ -125,6 +125,7 @@ modifier_bp	[rwx]{1,3}
 
 }
 
+<INITIAL>{
 cpu-cycles|cycles				{ return sym(yyscanner, PERF_TYPE_HARDWARE, PERF_COUNT_HW_CPU_CYCLES); }
 stalled-cycles-frontend|idle-cycles-frontend	{ return sym(yyscanner, PERF_TYPE_HARDWARE, PERF_COUNT_HW_STALLED_CYCLES_FRONTEND); }
 stalled-cycles-backend|idle-cycles-backend	{ return sym(yyscanner, PERF_TYPE_HARDWARE, PERF_COUNT_HW_STALLED_CYCLES_BACKEND); }
@@ -159,6 +160,7 @@ prefetch|prefetches			|
 speculative-read|speculative-load	|
 refs|Reference|ops|access		|
 misses|miss				{ return str(yyscanner, PE_NAME_CACHE_OP_RESULT); }
+}
 
 <config>{
 config			{ return term(yyscanner, PARSE_EVENTS__TERM_TYPE_CONFIG); }
-- 
1.9.1

