From adfc8bd032d9654c776ea9f195b93151fb4e5051 Mon Sep 17 00:00:00 2001
From: Peter Swain <peter.swain@cavium.com>
Date: Tue, 7 Jan 2014 11:19:07 -0800
Subject: [PATCH 370/518] MIPS: OCTEON: Sync up SE files (cvmx-l2c only)

Source: Cavium Networks, Inc.
MR: 00000
Type: Integration
Disposition: Merged from Octeon Tree
ChangeID: 9326919368b3c875f6f447d2b81b1b24f51eb2dd
Description:

Signed-off-by: Corey Minyard <cminyard@mvista.com>
[Original patch taken from Cavium SDK 3.1.1 525]
Signed-off-by: Yanjiang Jin <yanjiang.jin@windriver.com>
---
 arch/mips/cavium-octeon/executive/cvmx-l2c.c | 10 ++++------
 arch/mips/include/asm/octeon/cvmx-l2c.h      |  6 +++---
 2 files changed, 7 insertions(+), 9 deletions(-)

diff --git a/arch/mips/cavium-octeon/executive/cvmx-l2c.c b/arch/mips/cavium-octeon/executive/cvmx-l2c.c
index 9c4706d..609fb97 100644
--- a/arch/mips/cavium-octeon/executive/cvmx-l2c.c
+++ b/arch/mips/cavium-octeon/executive/cvmx-l2c.c
@@ -43,7 +43,7 @@
  * Implementation of the Level 2 Cache (L2C) control,
  * measurement, and debugging facilities.
  *
- * <hr>$Revision: 89166 $<hr>
+ * <hr>$Revision: 92683 $<hr>
  *
  */
 
@@ -241,8 +241,6 @@ void cvmx_l2c_config_perf(uint32_t counter, enum cvmx_l2c_event event, uint32_t
 		union cvmx_l2c_tadx_prf l2c_tadx_prf;
 		int tad;
 
-		cvmx_warn("L2C performance counter events are different for this chip, mapping 'event' to cvmx_l2c_tad_event_t\n");
-
 		cvmx_warn_if(clear_on_read, "L2C counters don't support clear on read for this chip\n");
 
 		l2c_tadx_prf.u64 = cvmx_read_csr(CVMX_L2C_TADX_PRF(0));
@@ -1066,7 +1064,7 @@ int cvmx_l2c_get_num_assoc(void)
 			break;
 		case 2:  /* 1/2 size */
 			l2_assoc = 2;
-			break; 
+			break;
 		case 1:  /* 3/4 size */
 			l2_assoc = 3;
 			break;
@@ -1104,7 +1102,7 @@ int cvmx_l2c_get_num_assoc(void)
 			l2_assoc = 8;
 		else if (mio_fus_dat3.cn63xx.l2c_crip == 1)
 			l2_assoc = 12;
-	} else {
+	} else if (!OCTEON_IS_OCTEON3()) {
 		union cvmx_l2d_fus3 val;
 		val.u64 = cvmx_read_csr(CVMX_L2D_FUS3);
 		/*
@@ -1182,7 +1180,7 @@ void cvmx_l2c_flush_line(uint32_t assoc, uint32_t index)
 
 /**
  * Initialize the BIG address in L2C+DRAM to generate proper error
- * on reading/writing to an non-existant memory location. 
+ * on reading/writing to an non-existant memory location.
  *
  * @param mem_size  Amount of DRAM configured in MB.
  * @param mode      Allow/Disallow reporting errors L2C_INT_SUM[BIGRD,BIGWR].
diff --git a/arch/mips/include/asm/octeon/cvmx-l2c.h b/arch/mips/include/asm/octeon/cvmx-l2c.h
index 9b9b538..f89ab21 100644
--- a/arch/mips/include/asm/octeon/cvmx-l2c.h
+++ b/arch/mips/include/asm/octeon/cvmx-l2c.h
@@ -43,7 +43,7 @@
  * Interface to the Level 2 Cache (L2C) control, measurement, and debugging
  * facilities.
  *
- * <hr>$Revision: 89914 $<hr>
+ * <hr>$Revision: 92683 $<hr>
  *
  */
 
@@ -104,7 +104,7 @@ union cvmx_l2c_tag {
 };
 typedef union cvmx_l2c_tag cvmx_l2c_tag_t;
 
-  /* L2C Performance Counter events. */
+  /* L2C Performance Counter events for Octeon1(Plus) */
 enum cvmx_l2c_event {
 	CVMX_L2C_EVENT_CYCLES = 0,		 /**< Cycles */
 	CVMX_L2C_EVENT_INSTRUCTION_MISS = 1,	 /**< L2 Instruction Miss */
@@ -164,7 +164,7 @@ enum cvmx_l2c_event {
 };
 typedef enum cvmx_l2c_event cvmx_l2c_event_t;
 
-/* L2C Performance Counter events for Octeon2. */
+/* L2C TAD Performance Counter events for Octeon2/3. */
 enum cvmx_l2c_tad_event {
 	CVMX_L2C_TAD_EVENT_NONE = 0,	/* None */
 	CVMX_L2C_TAD_EVENT_TAG_HIT = 1,	/* L2 Tag Hit */
-- 
1.9.1

