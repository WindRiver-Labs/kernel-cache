From 76a9e12455cefbad483818ec9a328cf8642981c2 Mon Sep 17 00:00:00 2001
From: David Daney <david.daney@cavium.com>
Date: Tue, 15 Jan 2013 15:19:29 -0800
Subject: [PATCH 139/518] usb: octeon2-common.c: Enable error reporting.

Source: Cavium Networks, Inc.
MR: 00000
Type: Integration
Disposition: Merged from Octeon Tree
ChangeID: 08df64a0659842cdb36a0b919bb5ba170b28c9bb
Description:

Hook up the octeon_error_tree things.

Signed-off-by: David Daney <david.daney@cavium.com>
Signed-off-by: Leonid Rosenboim <lrosenboim@caviumnetworks.com>
Signed-off-by: Corey Minyard <cminyard@mvista.com>
[Original patch taken from Cavium SDK 3.1.1 525]
Signed-off-by: Yanjiang Jin <yanjiang.jin@windriver.com>
---
 drivers/usb/host/octeon2-common.c | 4 ++++
 1 file changed, 4 insertions(+)

diff --git a/drivers/usb/host/octeon2-common.c b/drivers/usb/host/octeon2-common.c
index f2d734b..5e18bfc 100644
--- a/drivers/usb/host/octeon2-common.c
+++ b/drivers/usb/host/octeon2-common.c
@@ -225,6 +225,8 @@ end_clock:
 
 	/* Set uSOF cycle period to 60,000 bits. */
 	cvmx_write_csr(CVMX_UCTLX_EHCI_FLA(0), 0x20ull);
+
+	octeon_error_tree_enable(CVMX_ERROR_GROUP_USB, -1);
 exit:
 	mutex_unlock(&octeon2_usb_clocks_mutex);
 }
@@ -234,6 +236,8 @@ void octeon2_usb_clocks_stop(void)
 {
 	mutex_lock(&octeon2_usb_clocks_mutex);
 	octeon2_usb_clock_start_cnt--;
+	if (octeon2_usb_clock_start_cnt == 0)
+		octeon_error_tree_disable(CVMX_ERROR_GROUP_USB, -1);
 	mutex_unlock(&octeon2_usb_clocks_mutex);
 }
 EXPORT_SYMBOL(octeon2_usb_clocks_stop);
-- 
1.9.1

