From 67d127ccf065e2341d994259a5aacbaf0110ef0a Mon Sep 17 00:00:00 2001
From: Chandrakala Chavva <cchavva@caviumnetworks.com>
Date: Mon, 7 Oct 2013 12:14:44 -0700
Subject: [PATCH 266/518] netdev: octeon-ethernet: Use correct CSR for
 processing receive errors

Source: Cavium Networks, Inc.
MR: 00000
Type: Integration
Disposition: Merged from Octeon Tree
ChangeID: ca439d6fa29c365f531a4e08df11485bdb8ff509
Description:

AGL interface uses different CSR for processing errors
on received packet.

Signed-off-by: Chandrakala Chavva <cchavva@caviumnetworks.com>
Signed-off-by: Corey Minyard <cminyard@mvista.com>
[Original patch taken from Cavium SDK 3.1.1 525]
Signed-off-by: Yanjiang Jin <yanjiang.jin@windriver.com>
---
 drivers/net/ethernet/octeon/ethernet-rx.c | 10 +++++++++-
 1 file changed, 9 insertions(+), 1 deletion(-)

diff --git a/drivers/net/ethernet/octeon/ethernet-rx.c b/drivers/net/ethernet/octeon/ethernet-rx.c
index aa74fb8..ac647ec 100644
--- a/drivers/net/ethernet/octeon/ethernet-rx.c
+++ b/drivers/net/ethernet/octeon/ethernet-rx.c
@@ -239,7 +239,15 @@ static int cvm_oct_check_rcv_error(cvmx_wqe_t *work)
 		int interface = cvmx_helper_get_interface_num(port);
 		int index = cvmx_helper_get_interface_index_num(port);
 		union cvmx_gmxx_rxx_frm_ctl gmxx_rxx_frm_ctl;
-		gmxx_rxx_frm_ctl.u64 = cvmx_read_csr(CVMX_GMXX_RXX_FRM_CTL(index, interface));
+		uint64_t frm_ctl_reg;
+
+		if (cvmx_helper_interface_get_mode(interface) ==
+			CVMX_HELPER_INTERFACE_MODE_AGL)
+			frm_ctl_reg = CVMX_AGL_GMX_RXX_FRM_CTL(index);
+		else
+			frm_ctl_reg = CVMX_GMXX_RXX_FRM_CTL(index, interface);
+
+		gmxx_rxx_frm_ctl.u64 = cvmx_read_csr(frm_ctl_reg);
 		if (gmxx_rxx_frm_ctl.s.pre_chk == 0) {
 
 			u8 *ptr = phys_to_virt(work->packet_ptr.s.addr);
-- 
1.9.1

