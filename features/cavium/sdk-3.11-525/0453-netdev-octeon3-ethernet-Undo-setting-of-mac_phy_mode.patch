From d718c0e14e5b6ae498ce6f392698c13c2d5421d2 Mon Sep 17 00:00:00 2001
From: David Daney <david.daney@cavium.com>
Date: Sun, 4 May 2014 18:35:44 -0400
Subject: [PATCH 453/518] netdev: octeon3-ethernet: Undo setting of
 mac_phy_mode.

Source: Cavium Networks, Inc.
MR: 00000
Type: Integration
Disposition: Merged from Octeon Tree
ChangeID: 3a9cbf02765015308e0c35b2d15ccf9d3887c02f
Description:

Due to misunderstanding, we were setting this.  It should not normally
be set.

Signed-off-by: David Daney <david.daney@cavium.com>
Signed-off-by: Corey Minyard <cminyard@mvista.com>
[Original patch taken from Cavium SDK 3.1.1 525]
Signed-off-by: Yanjiang Jin <yanjiang.jin@windriver.com>
---
 drivers/net/ethernet/octeon/octeon-bgx-port.c | 3 +--
 1 file changed, 1 insertion(+), 2 deletions(-)

diff --git a/drivers/net/ethernet/octeon/octeon-bgx-port.c b/drivers/net/ethernet/octeon/octeon-bgx-port.c
index efa8ece..1b11a1f 100644
--- a/drivers/net/ethernet/octeon/octeon-bgx-port.c
+++ b/drivers/net/ethernet/octeon/octeon-bgx-port.c
@@ -202,8 +202,8 @@ int bgx_port_enable(struct net_device *netdev)
 	struct bgx_port_priv *priv = bgx_port_netdev2priv(netdev);
 
 	cvmx_helper_set_1000x_mode(priv->xiface, priv->index, false);
+	cvmx_helper_set_mac_phy_mode(priv->xiface, priv->index, false);
 	if (priv->phy_np == NULL) {
-		cvmx_helper_set_mac_phy_mode(priv->xiface, priv->index, false);
 		netif_carrier_on(netdev);
 		return 0;
 	}
@@ -213,7 +213,6 @@ int bgx_port_enable(struct net_device *netdev)
 	if (!priv->phydev)
 		return -ENODEV;
 
-	cvmx_helper_set_mac_phy_mode(priv->xiface, priv->index, true);
 	netif_carrier_off(netdev);
 	phy_start_aneg(priv->phydev);
 
-- 
1.9.1

