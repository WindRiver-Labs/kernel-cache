From c7fbe0a408bda8bb0ae42a3b7d0d7604e22485e9 Mon Sep 17 00:00:00 2001
From: Yanjiang Jin <yanjiang.jin@windriver.com>
Date: Wed, 5 Mar 2014 13:26:18 +0800
Subject: [PATCH 514/518] cav-octeon3: only warn once for unknown board type

Cavium declares that the function cvmx_helper_board_get_mii_address()
must be modified for every new Octeon board. But SDK3.10 doesn't add
CN7XXX support yet, so add this workaroud to avoid too many warnings.

Signed-off-by: Yanjiang Jin <yanjiang.jin@windriver.com>
---
 arch/mips/cavium-octeon/executive/cvmx-helper-board.c | 9 ++++++++-
 1 file changed, 8 insertions(+), 1 deletion(-)

diff --git a/arch/mips/cavium-octeon/executive/cvmx-helper-board.c b/arch/mips/cavium-octeon/executive/cvmx-helper-board.c
index f86fc96..e11932b 100644
--- a/arch/mips/cavium-octeon/executive/cvmx-helper-board.c
+++ b/arch/mips/cavium-octeon/executive/cvmx-helper-board.c
@@ -1224,6 +1224,8 @@ int cvmx_helper_board_get_mii_address(int ipd_port)
 #ifndef CVMX_BUILD_FOR_LINUX_KERNEL
 	int dbg = device_tree_dbg;
 #endif
+	static int warned = 0;
+
 	if (cvmx_sysinfo_get()->board_type == CVMX_BOARD_TYPE_SIM)
 		return -1;
 #ifndef CVMX_BUILD_FOR_LINUX_KERNEL
@@ -1450,7 +1452,12 @@ int cvmx_helper_board_get_mii_address(int ipd_port)
 	}
 
 	/* Some unknown board. Somebody forgot to update this function... */
-	cvmx_dprintf("%s: Unknown board type %d\n", __func__, cvmx_sysinfo_get()->board_type);
+	if (warned == 0) {
+		cvmx_dprintf(
+		"Unknown board type %d, maybe it is a CN7XXX board, but Cavium doesn't support it in function %s yet\n",
+		cvmx_sysinfo_get()->board_type, __func__);
+		warned = 1;
+	}
 	return -1;
 }
 
-- 
1.9.1

