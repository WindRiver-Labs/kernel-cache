From 82cda5f36a29893d2311e8d2b6b5c83ab56516a7 Mon Sep 17 00:00:00 2001
From: Chandrakala Chavva <cchavva@caviumnetworks.com>
Date: Thu, 24 Apr 2014 13:12:05 -0700
Subject: [PATCH 437/518] MIPS:OCTEON:PHY: Added Atheros 8033.

Source: Cavium Networks, Inc.
MR: 00000
Type: Integration
Disposition: Merged from Octeon Tree
ChangeID: 7ed8e0cef5c95d0f9d38166527c0cc0517c6ec13
Description:

Signed-off-by: Chandrakala Chavva <cchavva@caviumnetworks.com>
Signed-off-by: Corey Minyard <cminyard@mvista.com>
[Original patch taken from Cavium SDK 3.1.1 525]
Signed-off-by: Yanjiang Jin <yanjiang.jin@windriver.com>
---
 drivers/net/phy/at803x.c | 26 +++++++++++++++++++++++++-
 1 file changed, 25 insertions(+), 1 deletion(-)

diff --git a/drivers/net/phy/at803x.c b/drivers/net/phy/at803x.c
index 45cbc10..411fd77 100644
--- a/drivers/net/phy/at803x.c
+++ b/drivers/net/phy/at803x.c
@@ -123,6 +123,22 @@ static struct phy_driver at8035_driver = {
 	},
 };
 
+/* ATHEROS 8033 */
+static struct phy_driver at8033_driver = {
+	.phy_id		= 0x004dd074,
+	.name		= "Atheros 8033 ethernet",
+	.phy_id_mask	= 0xffffffef,
+	.config_init	= &at803x_config_init,
+	.features	= PHY_GBIT_FEATURES,
+	.flags		= PHY_HAS_INTERRUPT,
+	.config_aneg	= &genphy_config_aneg,
+	.read_status	= &genphy_read_status,
+	.driver		= {
+		.owner = THIS_MODULE,
+	},
+};
+
+
 /* ATHEROS 8030 */
 static struct phy_driver at8030_driver = {
 	.phy_id		= 0x004dd076,
@@ -146,12 +162,18 @@ static int __init atheros_init(void)
 	if (ret)
 		goto err1;
 
-	ret = phy_driver_register(&at8030_driver);
+	ret = phy_driver_register(&at8033_driver);
 	if (ret)
 		goto err2;
 
+	ret = phy_driver_register(&at8030_driver);
+	if (ret)
+		goto err3;
+
 	return 0;
 
+err3:
+	phy_driver_unregister(&at8033_driver);
 err2:
 	phy_driver_unregister(&at8035_driver);
 err1:
@@ -161,6 +183,7 @@ err1:
 static void __exit atheros_exit(void)
 {
 	phy_driver_unregister(&at8035_driver);
+	phy_driver_unregister(&at8033_driver);
 	phy_driver_unregister(&at8030_driver);
 }
 
@@ -169,6 +192,7 @@ module_exit(atheros_exit);
 
 static struct mdio_device_id __maybe_unused atheros_tbl[] = {
 	{ 0x004dd076, 0xffffffef },
+	{ 0x004dd074, 0xffffffef },
 	{ 0x004dd072, 0xffffffef },
 	{ }
 };
-- 
1.9.1

