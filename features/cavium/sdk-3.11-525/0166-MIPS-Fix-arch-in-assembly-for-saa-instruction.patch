From 989d6a6f07911132c6d2e4336df9d916caa321e7 Mon Sep 17 00:00:00 2001
From: Andrew Pinski <apinski@cavium.com>
Date: Thu, 27 Jun 2013 13:38:37 -0700
Subject: [PATCH 166/518] MIPS: Fix arch in assembly for saa instruction.

Source: Cavium Networks, Inc.
MR: 00000
Type: Integration
Disposition: Merged from Octeon Tree
ChangeID: f7e313843d9861fc2e28e2e55109af8319d7884b
Description:

This patch fixes the ".set arch" for the saa instruction so that it works with the upstream binutils.

Signed-off-by: Andrew Pinski <apinski@cavium.com>
Signed-off-by: Corey Minyard <cminyard@mvista.com>
[Original patch taken from Cavium SDK 3.1.1 525]
Signed-off-by: Yanjiang Jin <yanjiang.jin@windriver.com>
---
 arch/mips/include/asm/atomic.h | 8 ++++----
 1 file changed, 4 insertions(+), 4 deletions(-)

diff --git a/arch/mips/include/asm/atomic.h b/arch/mips/include/asm/atomic.h
index e3266ce0..4bbcf2d 100644
--- a/arch/mips/include/asm/atomic.h
+++ b/arch/mips/include/asm/atomic.h
@@ -52,7 +52,7 @@ static __inline__ void atomic_add(int i, atomic_t * v)
 	if (cpu_has_saa) {
 		__asm__ __volatile__(
 		".set	push\n\t"
-		".set	arch=octeon\n\t"
+		".set	arch=octeon+\n\t"
 		"saa    %1, (%2)\t# atomic_add (%0)\n\t"
 		".set	pop"
 		: "+m" (v->counter)
@@ -103,7 +103,7 @@ static __inline__ void atomic_sub(int i, atomic_t * v)
 	if (cpu_has_saa) {
 		__asm__ __volatile__(
 		".set	push\n\t"
-		".set	arch=octeon\n\t"
+		".set	arch=octeon+\n\t"
 		"saa    %1, (%2)\t# atomic_sub(%0)\n\t"
 		".set	pop"
 		: "+m" (v->counter)
@@ -471,7 +471,7 @@ static __inline__ void atomic64_add(long i, atomic64_t * v)
 	if (cpu_has_saa) {
 		__asm__ __volatile__(
 		".set	push\n\t"
-		".set	arch=octeon\n\t"
+		".set	arch=octeon+\n\t"
 		"saad   %1, (%2)\t# atomic64_add (%0)\n\t"
 		".set	pop"
 		: "+m" (v->counter)
@@ -522,7 +522,7 @@ static __inline__ void atomic64_sub(long i, atomic64_t * v)
 	if (cpu_has_saa) {
 		__asm__ __volatile__(
 		".set	push\n\t"
-		".set	arch=octeon\n\t"
+		".set	arch=octeon+\n\t"
 		"saad    %1, (%2)\t# atomic64_sub (%0)\n\t"
 		".set	pop"
 		: "+m" (v->counter)
-- 
1.9.1

