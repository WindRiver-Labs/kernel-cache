From 5a692190051ba8d96e0c8533bb40f8a11983a2f2 Mon Sep 17 00:00:00 2001
From: Chandrakala Chavva <cchavva@caviumnetworks.com>
Date: Wed, 13 Nov 2013 14:54:40 -0800
Subject: [PATCH 336/518] MIPS: OCTEON: Sync up SE files.

Source: Cavium Networks, Inc.
MR: 00000
Type: Integration
Disposition: Merged from Octeon Tree
ChangeID: 95430a7d7da3c70ad3158ae2776996e77ced7d49
Description:

Signed-off-by: Chandrakala Chavva <cchavva@caviumnetworks.com>
Signed-off-by: Corey Minyard <cminyard@mvista.com>
[Original patch taken from Cavium SDK 3.1.1 525]
Signed-off-by: Yanjiang Jin <yanjiang.jin@windriver.com>
---
 arch/mips/cavium-octeon/executive/cvmx-pcie.c | 4 ++--
 arch/mips/include/asm/octeon/cvmx-clock.h     | 2 +-
 2 files changed, 3 insertions(+), 3 deletions(-)

diff --git a/arch/mips/cavium-octeon/executive/cvmx-pcie.c b/arch/mips/cavium-octeon/executive/cvmx-pcie.c
index d708f93..181fcf0 100644
--- a/arch/mips/cavium-octeon/executive/cvmx-pcie.c
+++ b/arch/mips/cavium-octeon/executive/cvmx-pcie.c
@@ -42,7 +42,7 @@
  *
  * Interface to PCIe as a host(RC) or target(EP)
  *
- * <hr>$Revision: 90025 $<hr>
+ * <hr>$Revision: 90514 $<hr>
  */
 #ifdef CVMX_BUILD_FOR_LINUX_KERNEL
 #include <asm/octeon/cvmx.h>
@@ -822,7 +822,7 @@ static int __cvmx_pcie_rc_initialize_link_gen2(int pcie_port)
 	/* Wait for the link to come up */
 	start_cycle = cvmx_get_cycle();
 	do {
-		if ((cvmx_get_cycle() - start_cycle) > cvmx_clock_get_rate(CVMX_CLOCK_CORE) * 2)
+		if (cvmx_get_cycle() - start_cycle > cvmx_clock_get_rate(CVMX_CLOCK_CORE))
 			return -1;
 		cvmx_wait(10000);
 		pciercx_cfg032.u32 = cvmx_pcie_cfgx_read(pcie_port, CVMX_PCIERCX_CFG032(pcie_port));
diff --git a/arch/mips/include/asm/octeon/cvmx-clock.h b/arch/mips/include/asm/octeon/cvmx-clock.h
index 06e7490..240c7e5 100644
--- a/arch/mips/include/asm/octeon/cvmx-clock.h
+++ b/arch/mips/include/asm/octeon/cvmx-clock.h
@@ -133,9 +133,9 @@ static inline uint64_t cvmx_clock_get_rate(cvmx_clock_t clock)
 {
 	switch (clock) {
 	case CVMX_CLOCK_RCLK:
+	case CVMX_CLOCK_CORE:
 		return octeon_get_clock_rate();
 	case CVMX_CLOCK_SCLK:
-	case CVMX_CLOCK_CORE:
 	case CVMX_CLOCK_TIM:
 	case CVMX_CLOCK_IPD:
 		return octeon_get_io_clock_rate();
-- 
1.9.1

