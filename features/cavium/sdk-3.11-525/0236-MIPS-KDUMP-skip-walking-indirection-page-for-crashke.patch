From 8342c3d03fc7e21d9db866af81f607f8f735f084 Mon Sep 17 00:00:00 2001
From: Prem Mallappa <prem.mallappa@gmail.com>
Date: Fri, 30 Aug 2013 20:03:31 +0530
Subject: [PATCH 236/518] MIPS: KDUMP: skip walking indirection page for
 crashkernels

Source: Cavium Networks, Inc.
MR: 00000
Type: Integration
Disposition: Merged from Octeon Tree
ChangeID: aff0b6da8a55cbba120ddcc9e49fde04c0ee9fd5
Description:

KDUMP: skip indirection page, as crashkernel has already copied to destination

Signed-off-by: Prem Mallappa <pmallappa@caviumnetworks.com>
Signed-off-by: David Daney <david.daney@cavium.com>
Signed-off-by: Corey Minyard <cminyard@mvista.com>
[Original patch taken from Cavium SDK 3.1.1 525]
Signed-off-by: Yanjiang Jin <yanjiang.jin@windriver.com>
---
 arch/mips/kernel/relocate_kernel.S | 5 +++++
 1 file changed, 5 insertions(+)

diff --git a/arch/mips/kernel/relocate_kernel.S b/arch/mips/kernel/relocate_kernel.S
index 43d2d78..2778a41 100644
--- a/arch/mips/kernel/relocate_kernel.S
+++ b/arch/mips/kernel/relocate_kernel.S
@@ -26,6 +26,11 @@ process_entry:
 	PTR_L		s2, (s0)
 	PTR_ADD		s0, s0, SZREG
 
+	/* In case of kdump/crash kernel, indirection page is not populated
+	* as the kernel is directly copied to reserved location
+	*/
+	beq             s2, zero, done
+
 	/* destination page */
 	and		s3, s2, 0x1
 	beq		s3, zero, 1f
-- 
1.9.1

