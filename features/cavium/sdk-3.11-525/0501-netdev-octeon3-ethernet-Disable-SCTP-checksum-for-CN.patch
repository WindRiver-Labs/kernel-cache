From 253ba3a6084a56755a24ea24bea37cf4d02adedf Mon Sep 17 00:00:00 2001
From: David Daney <david.daney@cavium.com>
Date: Wed, 28 May 2014 14:46:28 -0700
Subject: [PATCH 501/518] netdev: octeon3-ethernet: Disable SCTP checksum for
 CN78XX_PASS1.

Source: Cavium Networks, Inc.
MR: 00000
Type: Integration
Disposition: Merged from Octeon Tree
ChangeID: bf9d71c96a1db786ddf3a9f7275d7feac7a6cbac
Description:

It doesn't work as per: PKO-18824

Signed-off-by: David Daney <david.daney@cavium.com>
Signed-off-by: Corey Minyard <cminyard@mvista.com>
[Original patch taken from Cavium SDK 3.1.1 525]
Signed-off-by: Yanjiang Jin <yanjiang.jin@windriver.com>
---
 drivers/net/ethernet/octeon/octeon3-ethernet.c | 8 ++++++--
 1 file changed, 6 insertions(+), 2 deletions(-)

diff --git a/drivers/net/ethernet/octeon/octeon3-ethernet.c b/drivers/net/ethernet/octeon/octeon3-ethernet.c
index af17218..bac5eac 100644
--- a/drivers/net/ethernet/octeon/octeon3-ethernet.c
+++ b/drivers/net/ethernet/octeon/octeon3-ethernet.c
@@ -579,11 +579,13 @@ static int octeon3_eth_ndo_init(struct net_device *netdev)
 #ifndef BROKEN_SIMULATOR_CSUM
 		|
 		NETIF_F_IP_CSUM |
-		NETIF_F_IPV6_CSUM |
-		NETIF_F_SCTP_CSUM
+		NETIF_F_IPV6_CSUM
 #endif
 		;
 
+	if (!OCTEON_IS_MODEL(OCTEON_CN78XX_PASS1_X)) /* PKO-18824 */
+		netdev->features |= NETIF_F_SCTP_CSUM;
+
 	priv->rx_buf_count = num_packet_buffers;
 
 	ipd_port = cvmx_helper_get_ipd_port(priv->xiface, priv->port_index);
@@ -857,6 +859,8 @@ static int octeon3_eth_ndo_start_xmit(struct sk_buff *skb, struct net_device *ne
 	checksum_alg = 1; /* UDP == 1 */
 	switch (l4_hdr) {
 	case IPPROTO_SCTP:
+		if (OCTEON_IS_MODEL(OCTEON_CN78XX_PASS1_X)) /* PKO-18824 */
+			break;
 		checksum_alg++; /* SCTP == 3 */
 		/* Fall through */
 	case IPPROTO_TCP: /* TCP == 2 */
-- 
1.9.1

