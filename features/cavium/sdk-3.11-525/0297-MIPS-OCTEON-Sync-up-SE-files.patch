From c4d6dd0d07e338dd513765b2507f33fa4e7fc200 Mon Sep 17 00:00:00 2001
From: Chandrakala Chavva <cchavva@caviumnetworks.com>
Date: Fri, 25 Oct 2013 16:27:39 -0700
Subject: [PATCH 297/518] MIPS: OCTEON: Sync up SE files.

Source: Cavium Networks, Inc.
MR: 00000
Type: Integration
Disposition: Merged from Octeon Tree
ChangeID: 6f4571c116d788fd2336fa8f32c82e3622df321c
Description:

Signed-off-by: Chandrakala Chavva <cchavva@caviumnetworks.com>
Signed-off-by: Corey Minyard <cminyard@mvista.com>
[Original patch taken from Cavium SDK 3.1.1 525]
Signed-off-by: Yanjiang Jin <yanjiang.jin@windriver.com>
---
 arch/mips/cavium-octeon/executive/cvmx-pcie.c |  4 +++-
 arch/mips/cavium-octeon/executive/cvmx-qlm.c  | 21 ++++++++++++++-------
 arch/mips/include/asm/octeon/cvmx-l2c.h       | 24 ++++++++++++++++++++----
 arch/mips/include/asm/octeon/cvmx-qlm.h       |  4 +++-
 4 files changed, 40 insertions(+), 13 deletions(-)

diff --git a/arch/mips/cavium-octeon/executive/cvmx-pcie.c b/arch/mips/cavium-octeon/executive/cvmx-pcie.c
index 68e8a52..44da70f 100644
--- a/arch/mips/cavium-octeon/executive/cvmx-pcie.c
+++ b/arch/mips/cavium-octeon/executive/cvmx-pcie.c
@@ -42,7 +42,7 @@
  *
  * Interface to PCIe as a host(RC) or target(EP)
  *
- * <hr>$Revision: 89436 $<hr>
+ * <hr>$Revision: 89912 $<hr>
  */
 #ifdef CVMX_BUILD_FOR_LINUX_KERNEL
 #include <asm/octeon/cvmx.h>
@@ -922,6 +922,8 @@ static int __cvmx_pcie_rc_initialize_gen2(int pcie_port)
 			cvmx_dprintf("PCIe: Port %d is ILK, skipping.\n", pcie_port);
 			return -1;
 		} else if (mode != CVMX_QLM_MODE_PCIE &&
+			   mode != CVMX_QLM_MODE_PCIE_1X2_SATA_2X1 &&
+			   mode != CVMX_QLM_MODE_PCIE_2X1_SATA_2X1 &&
 			   mode != CVMX_QLM_MODE_PCIE_1X2 &&
 			   mode != CVMX_QLM_MODE_PCIE_2X1 &&
 			   mode != CVMX_QLM_MODE_PCIE_1X1) {
diff --git a/arch/mips/cavium-octeon/executive/cvmx-qlm.c b/arch/mips/cavium-octeon/executive/cvmx-qlm.c
index bc3c7e6..baaed62 100644
--- a/arch/mips/cavium-octeon/executive/cvmx-qlm.c
+++ b/arch/mips/cavium-octeon/executive/cvmx-qlm.c
@@ -42,7 +42,7 @@
  *
  * Helper utilities for qlm.
  *
- * <hr>$Revision: 89635 $<hr>
+ * <hr>$Revision: 89912 $<hr>
  */
 #ifdef CVMX_BUILD_FOR_LINUX_KERNEL
 #include <asm/octeon/cvmx.h>
@@ -811,15 +811,22 @@ static enum cvmx_qlm_mode __cvmx_qlm_get_mode_cn70xx(int qlm)
 			    || pem0_cfg.cn70xx.md == CVMX_PEM_MD_GEN1_4LANE)
 				return CVMX_QLM_MODE_PCIE;
 			if (pem1_cfg.cn70xx.md == CVMX_PEM_MD_GEN2_2LANE
-			    || pem1_cfg.cn70xx.md == CVMX_PEM_MD_GEN1_2LANE)
-				return CVMX_QLM_MODE_PCIE_1X2;
+			    || pem1_cfg.cn70xx.md == CVMX_PEM_MD_GEN1_2LANE) {
+				if (sata_cfg.s.sata_en)
+					return CVMX_QLM_MODE_PCIE_1X2_SATA_2X1;
+				else
+					return CVMX_QLM_MODE_PCIE_1X2;
+			}
 			if (pem1_cfg.cn70xx.md == CVMX_PEM_MD_GEN2_1LANE
 			    || pem1_cfg.cn70xx.md == CVMX_PEM_MD_GEN1_1LANE) {
 				if (pem2_cfg.cn70xx.md == CVMX_PEM_MD_GEN2_1LANE
-				    || pem2_cfg.cn70xx.md == CVMX_PEM_MD_GEN1_1LANE)
-					return CVMX_QLM_MODE_PCIE_2X1;
-				else
-					return CVMX_QLM_MODE_PCIE_1X1;
+				    || pem2_cfg.cn70xx.md == CVMX_PEM_MD_GEN1_1LANE) {
+					if (sata_cfg.s.sata_en)
+						return CVMX_QLM_MODE_PCIE_2X1_SATA_2X1;
+					else
+						return CVMX_QLM_MODE_PCIE_2X1;
+				} else
+						return CVMX_QLM_MODE_PCIE_1X1;
 			}
 			if (pem2_cfg.cn70xx.md == CVMX_PEM_MD_GEN2_1LANE
 			    || pem2_cfg.cn70xx.md == CVMX_PEM_MD_GEN1_1LANE)
diff --git a/arch/mips/include/asm/octeon/cvmx-l2c.h b/arch/mips/include/asm/octeon/cvmx-l2c.h
index 6a1a9c3..9b9b538 100644
--- a/arch/mips/include/asm/octeon/cvmx-l2c.h
+++ b/arch/mips/include/asm/octeon/cvmx-l2c.h
@@ -43,7 +43,7 @@
  * Interface to the Level 2 Cache (L2C) control, measurement, and debugging
  * facilities.
  *
- * <hr>$Revision: 84158 $<hr>
+ * <hr>$Revision: 89914 $<hr>
  *
  */
 
@@ -59,13 +59,13 @@
 #define CVMX_L2C_MEMBANK_SELECT_SIZE  4096
 
 /* Maximium number of TADs */
-#define CVMX_L2C_MAX_TADS     4
+#define CVMX_L2C_MAX_TADS     8
 /* Maximium number of L2C performance counters */
 #define CVMX_L2C_MAX_PCNT     4
 
 /* Number of L2C Tag-and-data sections (TADs) that are connected to LMC. */
-#define CVMX_L2C_TADS  ((OCTEON_IS_MODEL(OCTEON_CN68XX) \
-			 || OCTEON_IS_MODEL(OCTEON_CN78XX)) ? 4 : 1)
+#define CVMX_L2C_TADS  ((OCTEON_IS_MODEL(OCTEON_CN68XX)) ? 4 : \
+			(OCTEON_IS_MODEL(OCTEON_CN78XX)) ? 8 : 1)
 /* Number of L2C IOBs connected to LMC. */
 #define CVMX_L2C_IOBS  ((OCTEON_IS_MODEL(OCTEON_CN68XX) \
 			 || OCTEON_IS_MODEL(OCTEON_CN78XX)) ? 2 : 1)
@@ -192,6 +192,22 @@ enum cvmx_l2c_tad_event {
 	CVMX_L2C_TAD_EVENT_QUAD3_READ = 177,	/* Quad 3 read data bus inuse */
 	CVMX_L2C_TAD_EVENT_QUAD3_BANK = 178,	/* Quad 3 \# banks inuse (0-4/cycle) */
 	CVMX_L2C_TAD_EVENT_QUAD3_WDAT = 179,	/* Quad 3 wdat flops inuse (0-4/cycle) */
+	CVMX_L2C_TAD_EVENT_QUAD4_INDEX = 192,	/* Quad 4 index bus inuse */
+	CVMX_L2C_TAD_EVENT_QUAD4_READ = 193,	/* Quad 4 read data bus inuse */
+	CVMX_L2C_TAD_EVENT_QUAD4_BANK = 194,	/* Quad 4 \# banks inuse (0-4/cycle) */
+	CVMX_L2C_TAD_EVENT_QUAD4_WDAT = 195,	/* Quad 4 wdat flops inuse (0-4/cycle) */
+	CVMX_L2C_TAD_EVENT_QUAD5_INDEX = 208,	/* Quad 5 index bus inuse */
+	CVMX_L2C_TAD_EVENT_QUAD5_READ = 209,	/* Quad 5 read data bus inuse */
+	CVMX_L2C_TAD_EVENT_QUAD5_BANK = 210,	/* Quad 5 \# banks inuse (0-4/cycle) */
+	CVMX_L2C_TAD_EVENT_QUAD5_WDAT = 211,	/* Quad 5 wdat flops inuse (0-4/cycle) */
+	CVMX_L2C_TAD_EVENT_QUAD6_INDEX = 224,	/* Quad 6 index bus inuse */
+	CVMX_L2C_TAD_EVENT_QUAD6_READ = 225,	/* Quad 6 read data bus inuse */
+	CVMX_L2C_TAD_EVENT_QUAD6_BANK = 226,	/* Quad 6 \# banks inuse (0-4/cycle) */
+	CVMX_L2C_TAD_EVENT_QUAD6_WDAT = 227,	/* Quad 6 wdat flops inuse (0-4/cycle) */
+	CVMX_L2C_TAD_EVENT_QUAD7_INDEX = 240,	/* Quad 7 index bus inuse */
+	CVMX_L2C_TAD_EVENT_QUAD7_READ = 241,	/* Quad 7 read data bus inuse */
+	CVMX_L2C_TAD_EVENT_QUAD7_BANK = 242,	/* Quad 7 \# banks inuse (0-4/cycle) */
+	CVMX_L2C_TAD_EVENT_QUAD7_WDAT = 243,	/* Quad 7 wdat flops inuse (0-4/cycle) */
 	CVMX_L2C_TAD_EVENT_MAX
 };
 typedef enum cvmx_l2c_tad_event cvmx_l2c_tad_event_t;
diff --git a/arch/mips/include/asm/octeon/cvmx-qlm.h b/arch/mips/include/asm/octeon/cvmx-qlm.h
index 460027b..3690ac6 100644
--- a/arch/mips/include/asm/octeon/cvmx-qlm.h
+++ b/arch/mips/include/asm/octeon/cvmx-qlm.h
@@ -42,7 +42,7 @@
  *
  * Helper utilities for qlm.
  *
- * <hr>$Revision: 87866 $<hr>
+ * <hr>$Revision: 89912 $<hr>
  */
 
 #ifndef __CVMX_QLM_H__
@@ -185,6 +185,8 @@ enum cvmx_qlm_mode {
 	CVMX_QLM_MODE_QSGMII_SGMII,
 	CVMX_QLM_MODE_RXAUI_1X2,
 	CVMX_QLM_MODE_SATA_2X1,
+	CVMX_QLM_MODE_PCIE_2X1_SATA_2X1,
+	CVMX_QLM_MODE_PCIE_1X2_SATA_2X1,
 };
 
 enum cvmx_gmx_inf_mode {
-- 
1.9.1

