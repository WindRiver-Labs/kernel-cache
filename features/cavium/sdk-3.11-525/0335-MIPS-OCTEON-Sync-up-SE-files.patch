From b64a19940f249cfa25e6c32297239ef297cdaecd Mon Sep 17 00:00:00 2001
From: Chandrakala Chavva <cchavva@caviumnetworks.com>
Date: Wed, 13 Nov 2013 12:01:48 -0800
Subject: [PATCH 335/518] MIPS: OCTEON: Sync up SE files.

Source: Cavium Networks, Inc.
MR: 00000
Type: Integration
Disposition: Merged from Octeon Tree
ChangeID: 020b5b1e645a72ca9f67e4b6bcaceb87fe5fce2d
Description:

Signed-off-by: Chandrakala Chavva <cchavva@caviumnetworks.com>
Signed-off-by: Corey Minyard <cminyard@mvista.com>
[Original patch taken from Cavium SDK 3.1.1 525]
Signed-off-by: Yanjiang Jin <yanjiang.jin@windriver.com>
---
 arch/mips/cavium-octeon/executive/cvmx-pcie.c | 2 +-
 1 file changed, 1 insertion(+), 1 deletion(-)

diff --git a/arch/mips/cavium-octeon/executive/cvmx-pcie.c b/arch/mips/cavium-octeon/executive/cvmx-pcie.c
index e7dcf94..d708f93 100644
--- a/arch/mips/cavium-octeon/executive/cvmx-pcie.c
+++ b/arch/mips/cavium-octeon/executive/cvmx-pcie.c
@@ -822,7 +822,7 @@ static int __cvmx_pcie_rc_initialize_link_gen2(int pcie_port)
 	/* Wait for the link to come up */
 	start_cycle = cvmx_get_cycle();
 	do {
-		if (cvmx_get_cycle() - start_cycle > cvmx_clock_get_rate(CVMX_CLOCK_CORE))
+		if ((cvmx_get_cycle() - start_cycle) > cvmx_clock_get_rate(CVMX_CLOCK_CORE) * 2)
 			return -1;
 		cvmx_wait(10000);
 		pciercx_cfg032.u32 = cvmx_pcie_cfgx_read(pcie_port, CVMX_PCIERCX_CFG032(pcie_port));
-- 
1.9.1

