From 968ca8fc4cca810dece2e9655b86434172f7005a Mon Sep 17 00:00:00 2001
From: Bin Jiang <bin.jiang@windriver.com>
Date: Wed, 8 May 2013 15:35:58 +0800
Subject: [PATCH 20/22] Cavium: support memory size unit (M/K) in command line

1. Add 'break' in switch condition.
2. Use MAX_MEMORY as total memory size.

Signed-off-by: Bin Jiang <bin.jiang@windriver.com>
---
 arch/mips/cavium-octeon/setup.c |    4 +++-
 1 file changed, 3 insertions(+), 1 deletion(-)

diff --git a/arch/mips/cavium-octeon/setup.c b/arch/mips/cavium-octeon/setup.c
index 7723b54..e093362 100644
--- a/arch/mips/cavium-octeon/setup.c
+++ b/arch/mips/cavium-octeon/setup.c
@@ -837,8 +837,10 @@ void __init prom_init(void)
 				case 'M':
 				case '?':
 					MAX_MEMORY <<= 20;
+					break;
 				case 'K':
 					MAX_MEMORY <<= 10;
+					break;
 				default:
 					break;
 			}
@@ -1127,7 +1129,7 @@ void __init plat_mem_setup(void)
 	 */
 	cvmx_bootmem_lock();
 	while ((boot_mem_map.nr_map < BOOT_MEM_MAP_MAX)
-		&& (total <= OCTEON_MAX_PHY_MEM_SIZE)) {
+		&& (total <= MAX_MEMORY)) {
 #if defined(CONFIG_64BIT) || defined(CONFIG_64BIT_PHYS_ADDR)
 		memory = cvmx_bootmem_phy_alloc(mem_alloc_size,
 						__pa_symbol(&__init_end), -1,
-- 
1.7.10.4

