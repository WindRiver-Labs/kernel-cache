From 1d87c3874b503bca0d01e643b631baab4a85ddfc Mon Sep 17 00:00:00 2001
From: Peter Swain <peter.swain@cavium.com>
Date: Mon, 11 Nov 2013 14:24:20 -0800
Subject: [PATCH 087/122] MIPS: octeon-hw-status tree-walker should visit irq
 objects

Source: Cavium Networks, Inc.
MR: 00000
Type: Integration
Disposition: Merged from Octeon Tree
ChangeID: 61944fe225e280242e31186e47a84044beeedc52
Description:

visit_leaves() with visit_sibs=true did not walk the root irq nodes.
Now it does, so /sys/kernel/debug/hwstat sees everything

Signed-off-by: Corey Minyard <cminyard@mvista.com>
[Original patch taken from Cavium SDK 3.1.1 525]
Signed-off-by: Bin Jiang <bin.jiang@windriver.com>
---
 arch/mips/cavium-octeon/octeon-hw-status.c | 7 +++++++
 1 file changed, 7 insertions(+)

diff --git a/arch/mips/cavium-octeon/octeon-hw-status.c b/arch/mips/cavium-octeon/octeon-hw-status.c
index 5a871f2..a20c1b6 100644
--- a/arch/mips/cavium-octeon/octeon-hw-status.c
+++ b/arch/mips/cavium-octeon/octeon-hw-status.c
@@ -67,9 +67,16 @@ static int visit_leaves(struct octeon_hw_status_node *s, bool visit_sibs,
 {
 	int depth = 0;
 	struct octeon_hw_status_node *w = s;
+	bool visit_roots = visit_sibs; /* should they ever differ? bitmask? */
 	int r;
 
 	while (w && depth >= 0) {
+		if (visit_roots && !depth) {
+			r = cb(w, arg);
+			if (r)
+				return r;
+		}
+
 		if (w->child) {
 			/* Go out to the leaves */
 			w = w->child;
-- 
1.8.2.1

