From 57082f788e43ad8462903d9a6e60f5096d5db209 Mon Sep 17 00:00:00 2001
From: Bin Jiang <bin.jiang@windriver.com>
Date: Mon, 6 May 2013 11:05:34 +0800
Subject: [PATCH 18/22] Revert "MIPS: Octeon2 : Jumping to
 0x80xx_xxxx_xxxx_xxxx when KEXEC/KDUMP"

This reverts commit 22e61205a81a0a740d542e4d54decac8815ef8f7 which is
no useful.

Signed-off-by: Bin Jiang <bin.jiang@windriver.com>
---
 arch/mips/include/asm/kexec.h      |    5 -----
 arch/mips/kernel/machine_kexec.c   |    5 ++---
 arch/mips/kernel/relocate_kernel.S |    8 --------
 3 files changed, 2 insertions(+), 16 deletions(-)

diff --git a/arch/mips/include/asm/kexec.h b/arch/mips/include/asm/kexec.h
index 1f2bdcd..ee25ebb 100644
--- a/arch/mips/include/asm/kexec.h
+++ b/arch/mips/include/asm/kexec.h
@@ -40,11 +40,6 @@ extern int (*_machine_kexec_prepare)(struct kimage *);
 extern void (*_machine_kexec_shutdown)(void);
 extern void (*_machine_crash_shutdown)(struct pt_regs *regs);
 extern void default_machine_crash_shutdown(struct pt_regs *regs);
-#ifdef CONFIG_CAVIUM_OCTEON2
-#define OCTEON_KEXEC_OFFSET	(0x2800000000000000)
-#else
-#define OCTEON_KEXEC_OFFSET	(0)
-#endif
 #ifdef CONFIG_SMP
 extern const unsigned char kexec_smp_wait[];
 extern unsigned long secondary_kexec_args[4];
diff --git a/arch/mips/kernel/machine_kexec.c b/arch/mips/kernel/machine_kexec.c
index 3f45cbe..992e184 100644
--- a/arch/mips/kernel/machine_kexec.c
+++ b/arch/mips/kernel/machine_kexec.c
@@ -102,10 +102,9 @@ machine_kexec(struct kimage *image)
 #ifdef CONFIG_SMP
 	/* All secondary cpus now may jump to kexec_wait cycle */
 	relocated_kexec_smp_wait = reboot_code_buffer +
-		(void *)(kexec_smp_wait - relocate_new_kernel)
-		- OCTEON_KEXEC_OFFSET;
+		(void *)(kexec_smp_wait - relocate_new_kernel);
 	smp_wmb();
 	atomic_set(&kexec_ready_to_reboot, 1);
 #endif
-	((noretfun_t) (reboot_code_buffer - OCTEON_KEXEC_OFFSET))();
+	((noretfun_t) reboot_code_buffer)();
 }
diff --git a/arch/mips/kernel/relocate_kernel.S b/arch/mips/kernel/relocate_kernel.S
index 6bec27b..e4142c5 100644
--- a/arch/mips/kernel/relocate_kernel.S
+++ b/arch/mips/kernel/relocate_kernel.S
@@ -14,12 +14,6 @@
 #include <asm/stackframe.h>
 #include <asm/addrspace.h>
 
-#ifdef CONFIG_CAVIUM_OCTEON2
-#define OCTEON_KEXEC_OFFSET	(0x2800000000000000)
-#else
-#define OCTEON_KEXEC_OFFSET	(0)
-#endif
-
 LEAF(relocate_new_kernel)
 	PTR_L a0,	arg0
 	PTR_L a1,	arg1
@@ -28,7 +22,6 @@ LEAF(relocate_new_kernel)
 
 	PTR_L		s0, kexec_indirection_page
 	PTR_L		s1, kexec_start_address
-	LONG_SUB	s1, OCTEON_KEXEC_OFFSET
 
 process_entry:
 	PTR_L		s2, (s0)
@@ -113,7 +106,6 @@ LEAF(kexec_smp_wait)
 	PTR_L		a2, s_arg2
 	PTR_L		a3, s_arg3
 	PTR_L		s1, kexec_start_address
-	LONG_SUB	s1, OCTEON_KEXEC_OFFSET
 
 	/* Non-relocated address works for args and kexec_start_address ( old
 	 * kernel is not overwritten). But we need relocated address of
-- 
1.7.10.4

