From ed119d67de9a2c0b820f2e7a44d9fb0d74cadb93 Mon Sep 17 00:00:00 2001
From: David Daney <david.daney@cavium.com>
Date: Tue, 15 Jan 2013 15:46:31 -0800
Subject: [PATCH 315/337] MIPS:OCTEON: Add command line parameter to allow
 octeon-error-tree to be disabled.

Based On SDK 3.0.0-482

It is octeon_error_tree.disable=1

Signed-off-by: David Daney <david.daney@cavium.com>
Signed-off-by: Corey Minyard <cminyard@mvista.com>
Signed-off-by: Jack Tan <jack.tan@windriver.com>
---
 arch/mips/cavium-octeon/octeon-error-tree.c |   15 ++++++++++++++-
 1 files changed, 14 insertions(+), 1 deletions(-)

diff --git a/arch/mips/cavium-octeon/octeon-error-tree.c b/arch/mips/cavium-octeon/octeon-error-tree.c
index c7fd63f..7ab01c1 100644
--- a/arch/mips/cavium-octeon/octeon-error-tree.c
+++ b/arch/mips/cavium-octeon/octeon-error-tree.c
@@ -7,7 +7,7 @@
  */
 
 #include <linux/init.h>
-#include <linux/export.h>
+#include <linux/module.h>
 #include <linux/interrupt.h>
 
 #include <asm/mipsregs.h>
@@ -15,6 +15,10 @@
 #include <asm/octeon/octeon-hw-status.h>
 #include <asm/octeon/octeon.h>
 
+/* Module parameter to disable PCI probing */
+static int disable;
+module_param(disable, int, S_IRUGO);
+
 static struct cvmx_error_muxchild *octeon_error_tree_current;
 
 static void octeon_error_tree_remove(int idx, int max_idx, struct cvmx_error_muxchild *n,
@@ -167,6 +171,9 @@ int octeon_error_tree_disable(enum cvmx_error_groups group, int unit)
 	struct cvmx_error_childbit *line;
 	int irq_reg;
 
+	if (disable)
+		return 0;
+
 	if (!octeon_error_tree_current)
 		return -ENODEV;
 
@@ -197,6 +204,9 @@ int octeon_error_tree_enable(enum cvmx_error_groups group, int unit)
 	struct cvmx_error_childbit *line;
 	int irq_reg;
 
+	if (disable)
+		return 0;
+
 	if (!octeon_error_tree_current)
 		return -ENODEV;
 
@@ -229,6 +239,9 @@ static int __init octeon_error_tree_init(void)
 	u32 prid = read_c0_prid();
 	struct cvmx_error_tree *tree = octeon_error_trees;
 
+	if (disable)
+		return 0;
+
 	while (tree->tree) {
 		if ((prid & tree->prid_mask) == tree->prid_val) {
 			break;
-- 
1.7.5.4

