From ba6d2005ba653489755e324bccd86f55b3f2175c Mon Sep 17 00:00:00 2001
From: David Daney <david.daney@cavium.com>
Date: Thu, 23 Aug 2012 15:22:41 -0700
Subject: [PATCH 143/337] netdev: octeon_ethernet: Initialize RED after
 configuring packet I/O.

Based On SDK 3.0.0-482

The RED code expects packet I/O already initialized on cn68XX.

Signed-off-by: David Daney <david.daney@cavium.com>
Signed-off-by: Corey Minyard <cminyard@mvista.com>
Signed-off-by: Jack Tan <jack.tan@windriver.com>
---
 drivers/net/ethernet/octeon/ethernet.c |    5 +++--
 1 files changed, 3 insertions(+), 2 deletions(-)

diff --git a/drivers/net/ethernet/octeon/ethernet.c b/drivers/net/ethernet/octeon/ethernet.c
index 51ad641..5fb5d3f 100644
--- a/drivers/net/ethernet/octeon/ethernet.c
+++ b/drivers/net/ethernet/octeon/ethernet.c
@@ -171,6 +171,9 @@ static __devinit int cvm_oct_configure_common_hw(void)
 				     cvm_oct_num_output_buffers);
 	}
 
+	cvmx_helper_initialize_packet_io_global();
+
+	/* Enable red after interface is initialized */
 	if (USE_RED)
 		cvmx_helper_setup_red(num_packet_buffers / 4,
 				      num_packet_buffers / 8);
@@ -604,8 +607,6 @@ static int __devinit cvm_oct_probe(struct platform_device *pdev)
 	if (r)
 		return r;
 
-	cvmx_helper_initialize_packet_io_global();
-
 	/* Change the input group for all ports before input is enabled */
 	num_interfaces = cvmx_helper_get_number_of_interfaces();
 	for (interface = 0; interface < num_interfaces; interface++) {
-- 
1.7.5.4

