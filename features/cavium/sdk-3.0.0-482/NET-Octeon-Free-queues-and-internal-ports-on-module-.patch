From ea16b07bc7e2dd0ceb125fa01dccb827065acad9 Mon Sep 17 00:00:00 2001
From: Venkat Subbiah <venkat.subbiah@cavium.com>
Date: Mon, 7 Jan 2013 09:59:48 -0800
Subject: [PATCH 291/337] NET: Octeon: Free queues and internal ports on
 module exit.

Based On SDK 3.0.0-482

Signed-off-by: Venkat Subbiah <venkat.subbiah@cavium.com>
Signed-off-by: Corey Minyard <cminyard@mvista.com>
Signed-off-by: Jack Tan <jack.tan@windriver.com>
---
 drivers/net/ethernet/octeon/ethernet.c |    4 ++++
 1 files changed, 4 insertions(+), 0 deletions(-)

diff --git a/drivers/net/ethernet/octeon/ethernet.c b/drivers/net/ethernet/octeon/ethernet.c
index b3916e0..060c4ed 100644
--- a/drivers/net/ethernet/octeon/ethernet.c
+++ b/drivers/net/ethernet/octeon/ethernet.c
@@ -48,6 +48,7 @@
 #include <asm/octeon/cvmx-ipd.h>
 #include <asm/octeon/cvmx-srio.h>
 #include <asm/octeon/cvmx-helper.h>
+#include <asm/octeon/cvmx-pko-internal-ports-range.h>
 #include <asm/octeon/cvmx-app-config.h>
 
 #include <asm/octeon/cvmx-gmxx-defs.h>
@@ -1139,6 +1140,9 @@ static int __devexit cvm_oct_remove(struct platform_device *pdev)
 
 	cvm_oct_mem_cleanup();
 
+	cvmx_pko_queue_free_all();
+	cvmx_pko_internal_ports_range_free_all();
+
 	__cvmx_export_app_config_cleanup();
 
 	return 0;
-- 
1.7.5.4

