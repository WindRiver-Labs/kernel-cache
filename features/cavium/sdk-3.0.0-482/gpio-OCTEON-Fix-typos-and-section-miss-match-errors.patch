From eae4001ccaa3275ac1a78e9debfcba0c47e3dfff Mon Sep 17 00:00:00 2001
From: David Daney <david.daney@cavium.com>
Date: Fri, 13 Apr 2012 09:50:12 -0700
Subject: [PATCH 052/337] gpio/OCTEON: Fix typos and section miss-match
 errors.

Based On SDK 3.0.0-482

Also let ngpio be 20, that will cover all known chips and on chips
that have only 16, nobody will be requesting 16..19 so we are good
there too.

Signed-off-by: David Daney <david.daney@cavium.com>
Signed-off-by: Corey Minyard <cminyard@mvista.com>
Signed-off-by: Jack Tan <jack.tan@windriver.com>
---
 drivers/gpio/gpio-octeon.c |   19 ++++++-------------
 1 files changed, 6 insertions(+), 13 deletions(-)

diff --git a/drivers/gpio/gpio-octeon.c b/drivers/gpio/gpio-octeon.c
index e679b44..37f2104 100644
--- a/drivers/gpio/gpio-octeon.c
+++ b/drivers/gpio/gpio-octeon.c
@@ -78,7 +78,7 @@ static int octeon_gpio_get(struct gpio_chip *chip, unsigned offset)
 	return ((1ull << offset) & read_bits) != 0;
 }
 
-static int __init octeon_gpio_probe(struct platform_device *pdev)
+static int __devinit octeon_gpio_probe(struct platform_device *pdev)
 {
 	struct octeon_gpio *gpio;
 	struct gpio_chip *chip;
@@ -113,14 +113,7 @@ static int __init octeon_gpio_probe(struct platform_device *pdev)
 	chip->owner = THIS_MODULE;
 	chip->base = 0;
 	chip->can_sleep = 0;
-
-	if (OCTEON_IS_MODEL(OCTEON_CN66XX) ||
-	    OCTEON_IS_MODEL(OCTEON_CN61XX) ||
-	    OCTEON_IS_MODEL(OCTEON_CNF71XX))
-		chip->ngpio = 20;
-	else
-		chip->ngpio = 16;
-
+	chip->ngpio = 20;
 	chip->direction_input = octeon_gpio_dir_in;
 	chip->get = octeon_gpio_get;
 	chip->direction_output = octeon_gpio_dir_out;
@@ -134,7 +127,7 @@ out:
 	return err;
 }
 
-static int __exit octeon_gpio_remove(struct platform_device *pdev)
+static int __devexit octeon_gpio_remove(struct platform_device *pdev)
 {
 	struct gpio_chip *chip = pdev->dev.platform_data;
 	return gpiochip_remove(chip);
@@ -146,16 +139,16 @@ static struct of_device_id octeon_gpio_match[] = {
 	},
 	{},
 };
-MODULE_DEVICE_TABLE(of, octeon_mgmt_match);
+MODULE_DEVICE_TABLE(of, octeon_gpio_match);
 
 static struct platform_driver octeon_gpio_driver = {
+	.probe		= octeon_gpio_probe,
+	.remove		= __exit_p(octeon_gpio_remove),
 	.driver = {
 		.name		= "octeon_gpio",
 		.owner		= THIS_MODULE,
 		.of_match_table = octeon_gpio_match,
 	},
-	.probe		= octeon_gpio_probe,
-	.remove		= __exit_p(octeon_gpio_remove),
 };
 
 module_platform_driver(octeon_gpio_driver);
-- 
1.7.5.4

