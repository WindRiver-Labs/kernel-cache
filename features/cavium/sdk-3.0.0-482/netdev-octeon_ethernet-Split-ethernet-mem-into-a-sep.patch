From 94c0d30d0823c10da33d716004119d8d9417a8e0 Mon Sep 17 00:00:00 2001
From: David Daney <david.daney@cavium.com>
Date: Mon, 22 Oct 2012 14:11:58 -0700
Subject: [PATCH 211/337] netdev: octeon_ethernet: Split ethernet-mem into a
 separate module.

Based On SDK 3.0.0-482

This code is shared with the sRIO driver, so must be accessible from
there too.

Signed-off-by: David Daney <david.daney@cavium.com>
Signed-off-by: Corey Minyard <cminyard@mvista.com>
Signed-off-by: Jack Tan <jack.tan@windriver.com>
---
 arch/mips/cavium-octeon/Kconfig      |    1 +
 drivers/net/ethernet/octeon/Kconfig  |    7 +++++++
 drivers/net/ethernet/octeon/Makefile |    2 +-
 3 files changed, 9 insertions(+), 1 deletions(-)

diff --git a/arch/mips/cavium-octeon/Kconfig b/arch/mips/cavium-octeon/Kconfig
index b78e8f8..8721c2d 100644
--- a/arch/mips/cavium-octeon/Kconfig
+++ b/arch/mips/cavium-octeon/Kconfig
@@ -174,6 +174,7 @@ config CAVIUM_OCTEON_RAPIDIO
 	bool "Enable support for Octeon Serial Rapid IO"
 	depends on !CPU_LITTLE_ENDIAN
 	select RAPIDIO
+	select OCTEON_ETHERNET_MEM
 	help
 	  Connect the SRIO interfaces available in the Octeon II series of
 	  processors to the kernel's RapidIO subsystem. The existence of the
diff --git a/drivers/net/ethernet/octeon/Kconfig b/drivers/net/ethernet/octeon/Kconfig
index f2077e8..0c7d2fa 100644
--- a/drivers/net/ethernet/octeon/Kconfig
+++ b/drivers/net/ethernet/octeon/Kconfig
@@ -7,6 +7,7 @@ config OCTEON_ETHERNET
 	select PHYLIB
 	select MDIO_OCTEON
 	select NET_VENDOR_OCTEON
+	select OCTEON_ETHERNET_MEM
 	help
 	  This driver supports the builtin ethernet ports on Cavium
 	  Inc.' products in the Octeon family. This driver supports the
@@ -15,6 +16,12 @@ config OCTEON_ETHERNET
 	  To compile this driver as a module, choose M here.  The module
 	  will be called octeon-ethernet.
 
+config OCTEON_ETHERNET_MEM
+	tristate
+	depends on CPU_CAVIUM_OCTEON
+
+
+
 config OCTEON_POW_ONLY_ETHERNET
 	tristate "POW based internal only ethernet driver"
 	depends on  CPU_CAVIUM_OCTEON
diff --git a/drivers/net/ethernet/octeon/Makefile b/drivers/net/ethernet/octeon/Makefile
index d9b7b08..8c19cfd 100644
--- a/drivers/net/ethernet/octeon/Makefile
+++ b/drivers/net/ethernet/octeon/Makefile
@@ -5,10 +5,10 @@
 obj-$(CONFIG_OCTEON_MGMT_ETHERNET)	+= octeon_mgmt.o
 obj-$(CONFIG_OCTEON_POW_ONLY_ETHERNET)	+= octeon-pow-ethernet.o
 obj-${CONFIG_OCTEON_ETHERNET} +=  octeon-ethernet.o
+obj-${CONFIG_OCTEON_ETHERNET_MEM} += ethernet-mem.o
 
 octeon-ethernet-objs := ethernet.o
 octeon-ethernet-objs += ethernet-mdio.o
-octeon-ethernet-objs += ethernet-mem.o
 octeon-ethernet-objs += ethernet-rgmii.o
 octeon-ethernet-objs += ethernet-rx.o
 octeon-ethernet-objs += ethernet-sgmii.o
-- 
1.7.5.4

