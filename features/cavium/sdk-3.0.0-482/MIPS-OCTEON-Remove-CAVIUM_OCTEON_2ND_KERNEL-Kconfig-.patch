From f1f6884f3a92b0c65b704ace69843eacb1c6b119 Mon Sep 17 00:00:00 2001
From: David Daney <david.daney@cavium.com>
Date: Fri, 21 Sep 2012 11:30:14 -0700
Subject: [PATCH 163/337] MIPS: OCTEON: Remove CAVIUM_OCTEON_2ND_KERNEL
 Kconfig variable.

Based On SDK 3.0.0-482

The mapped kernel option makes this unneeded.

Signed-off-by: David Daney <david.daney@cavium.com>
Signed-off-by: Corey Minyard <cminyard@mvista.com>
Signed-off-by: Jack Tan <jack.tan@windriver.com>
---
 arch/mips/cavium-octeon/Kconfig  |    9 ---------
 arch/mips/cavium-octeon/Platform |    4 ----
 arch/mips/cavium-octeon/setup.c  |    8 --------
 drivers/usb/host/Kconfig         |    2 +-
 4 files changed, 1 insertions(+), 22 deletions(-)

diff --git a/arch/mips/cavium-octeon/Kconfig b/arch/mips/cavium-octeon/Kconfig
index ca74fd0..17ad1d3 100644
--- a/arch/mips/cavium-octeon/Kconfig
+++ b/arch/mips/cavium-octeon/Kconfig
@@ -21,15 +21,6 @@ config CAVIUM_CN63XXP1
 	  non-CN63XXP1 hardware, so it is recommended to select "n"
 	  unless it is known the workarounds are needed.
 
-config CAVIUM_OCTEON_2ND_KERNEL
-	bool "Build the kernel to be used as a 2nd kernel on the same chip"
-	default "n"
-	help
-	  This option configures this kernel to be linked at a different
-	  address and use the 2nd uart for output. This allows a kernel built
-	  with this option to be run at the same time as one built without this
-	  option.
-
 config CAVIUM_OCTEON_HW_FIX_UNALIGNED
 	bool "Enable hardware fixups of unaligned loads and stores"
 	default "y"
diff --git a/arch/mips/cavium-octeon/Platform b/arch/mips/cavium-octeon/Platform
index 1e43ccf..ef9871a 100644
--- a/arch/mips/cavium-octeon/Platform
+++ b/arch/mips/cavium-octeon/Platform
@@ -4,8 +4,4 @@
 platform-$(CONFIG_CPU_CAVIUM_OCTEON)	+= cavium-octeon/
 cflags-$(CONFIG_CPU_CAVIUM_OCTEON)	+=				\
 		-I$(srctree)/arch/mips/include/asm/mach-cavium-octeon
-ifdef CONFIG_CAVIUM_OCTEON_2ND_KERNEL
-load-$(CONFIG_CPU_CAVIUM_OCTEON)	+= 0xffffffff84100000
-else
 load-$(CONFIG_CPU_CAVIUM_OCTEON)	+= 0xffffffff81100000
-endif
diff --git a/arch/mips/cavium-octeon/setup.c b/arch/mips/cavium-octeon/setup.c
index 52ed448..21c6d74 100644
--- a/arch/mips/cavium-octeon/setup.c
+++ b/arch/mips/cavium-octeon/setup.c
@@ -145,12 +145,8 @@ void octeon_write_lcd(const char *s)
 int octeon_get_boot_uart(void)
 {
 	int uart;
-#ifdef CONFIG_CAVIUM_OCTEON_2ND_KERNEL
-	uart = 1;
-#else
 	uart = (octeon_boot_desc_ptr->flags & OCTEON_BL_FLAG_CONSOLE_UART1) ?
 		1 : 0;
-#endif
 	return uart;
 }
 
@@ -744,14 +740,10 @@ void __init prom_init(void)
 	}
 
 	if (strstr(arcs_cmdline, "console=") == NULL) {
-#ifdef CONFIG_CAVIUM_OCTEON_2ND_KERNEL
-		strcat(arcs_cmdline, " console=ttyS0,115200");
-#else
 		if (octeon_uart == 1)
 			strcat(arcs_cmdline, " console=ttyS1,115200");
 		else
 			strcat(arcs_cmdline, " console=ttyS0,115200");
-#endif
 	}
 
 	if (octeon_is_simulation()) {
diff --git a/drivers/usb/host/Kconfig b/drivers/usb/host/Kconfig
index 3301c20..1728108 100644
--- a/drivers/usb/host/Kconfig
+++ b/drivers/usb/host/Kconfig
@@ -669,7 +669,7 @@ config USB_IMX21_HCD
 
 config USB_OCTEON_HCD
 	tristate "Octeon usb host driver" 
-	depends on USB && CPU_CAVIUM_OCTEON && !CAVIUM_OCTEON_2ND_KERNEL
+	depends on USB && CPU_CAVIUM_OCTEON
  	default n
         help
           The Octeon DWC_OTG USB host controller.  All CN3XXX and
-- 
1.7.5.4

