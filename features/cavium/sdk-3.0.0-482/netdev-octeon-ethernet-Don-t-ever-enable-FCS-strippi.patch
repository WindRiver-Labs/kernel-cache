From 2c7dae66a6ed31b18fb4af293db8fec4949a4cac Mon Sep 17 00:00:00 2001
From: David Daney <david.daney@cavium.com>
Date: Mon, 14 Jan 2013 15:54:07 -0800
Subject: [PATCH 307/337] netdev/octeon-ethernet: Don't ever enable FCS
 stripping on RGMII ports.

Based On SDK 3.0.0-482

The packet receive processing expects the FCS to be present, so leave
it there unconditionally.

Signed-off-by: David Daney <david.daney@cavium.com>
Signed-off-by: Corey Minyard <cminyard@mvista.com>
Signed-off-by: Jack Tan <jack.tan@windriver.com>
---
 drivers/net/ethernet/octeon/ethernet-rgmii.c |   12 ------------
 1 files changed, 0 insertions(+), 12 deletions(-)

diff --git a/drivers/net/ethernet/octeon/ethernet-rgmii.c b/drivers/net/ethernet/octeon/ethernet-rgmii.c
index 4bc892d..9b26789 100644
--- a/drivers/net/ethernet/octeon/ethernet-rgmii.c
+++ b/drivers/net/ethernet/octeon/ethernet-rgmii.c
@@ -82,7 +82,6 @@ static void cvm_oct_rgmii_poll(struct net_device *dev)
 				 * checking and do it in software.
 				 */
 				union cvmx_gmxx_rxx_frm_ctl gmxx_rxx_frm_ctl;
-				union cvmx_ipd_sub_port_fcs ipd_sub_port_fcs;
 
 				/* Disable preamble checking */
 				gmxx_rxx_frm_ctl.u64 =
@@ -91,12 +90,6 @@ static void cvm_oct_rgmii_poll(struct net_device *dev)
 				cvmx_write_csr(CVMX_GMXX_RXX_FRM_CTL(priv->interface_port, priv->interface),
 					       gmxx_rxx_frm_ctl.u64);
 
-				/* Disable FCS stripping */
-				ipd_sub_port_fcs.u64 = cvmx_read_csr(CVMX_IPD_SUB_PORT_FCS);
-				ipd_sub_port_fcs.s.port_bit &= 0xffffffffull ^ (1ull << priv->ipd_port);
-				cvmx_write_csr(CVMX_IPD_SUB_PORT_FCS,
-					       ipd_sub_port_fcs.u64);
-
 				/* Clear any error bits */
 				cvmx_write_csr(CVMX_GMXX_RXX_INT_REG(priv->interface_port, priv->interface),
 					       gmxx_rxx_int_reg.u64);
@@ -114,7 +107,6 @@ static void cvm_oct_rgmii_poll(struct net_device *dev)
 	 */
 	if (USE_10MBPS_PREAMBLE_WORKAROUND) {
 		union cvmx_gmxx_rxx_frm_ctl gmxx_rxx_frm_ctl;
-		union cvmx_ipd_sub_port_fcs ipd_sub_port_fcs;
 		union cvmx_gmxx_rxx_int_reg gmxx_rxx_int_reg;
 
 		/* Enable preamble checking */
@@ -123,10 +115,6 @@ static void cvm_oct_rgmii_poll(struct net_device *dev)
 		gmxx_rxx_frm_ctl.s.pre_chk = 1;
 		cvmx_write_csr(CVMX_GMXX_RXX_FRM_CTL(priv->interface_port, priv->interface),
 			       gmxx_rxx_frm_ctl.u64);
-		/* Enable FCS stripping */
-		ipd_sub_port_fcs.u64 = cvmx_read_csr(CVMX_IPD_SUB_PORT_FCS);
-		ipd_sub_port_fcs.s.port_bit |= 1ull << priv->ipd_port;
-		cvmx_write_csr(CVMX_IPD_SUB_PORT_FCS, ipd_sub_port_fcs.u64);
 		/* Clear any error bits */
 		gmxx_rxx_int_reg.u64 =
 			cvmx_read_csr(CVMX_GMXX_RXX_INT_REG(priv->interface_port, priv->interface));
-- 
1.7.5.4

