From 563704fe4cc9ec7dc59f6e01a495e2b7747a10f5 Mon Sep 17 00:00:00 2001
From: David Daney <david.daney@cavium.com>
Date: Tue, 15 Jan 2013 15:21:16 -0800
Subject: [PATCH 314/337] usb: octeon-hcd: Enable error reporting.

Based On SDK 3.0.0-482

Hook up the octeon_error_tree things.

Signed-off-by: David Daney <david.daney@cavium.com>
Signed-off-by: Corey Minyard <cminyard@mvista.com>
Signed-off-by: Jack Tan <jack.tan@windriver.com>
---
 drivers/usb/host/octeon-hcd.c |    8 +++++++-
 1 files changed, 7 insertions(+), 1 deletions(-)

diff --git a/drivers/usb/host/octeon-hcd.c b/drivers/usb/host/octeon-hcd.c
index 7b40c23..2b8f815 100644
--- a/drivers/usb/host/octeon-hcd.c
+++ b/drivers/usb/host/octeon-hcd.c
@@ -18,7 +18,7 @@
 #include <asm/time.h>
 #include <asm/delay.h>
 
-#include <asm/octeon/cvmx.h>
+#include <asm/octeon/octeon.h>
 #include <asm/octeon/cvmx-usb.h>
 #include <asm/octeon/cvmx-iob-defs.h>
 
@@ -45,6 +45,7 @@
 
 struct octeon_hcd {
 	spinlock_t lock;
+	int usb_num;
 	cvmx_usb_state_t usb;
 	struct tasklet_struct dequeue_tasklet;
 	struct list_head dequeue_list;
@@ -782,6 +783,7 @@ static int octeon_usb_probe(struct platform_device *pdev)
 	}
 	hcd->uses_new_polling = 1;
 	priv = (struct octeon_hcd *)hcd->hcd_priv;
+	priv->usb_num = usb_num;
 
 	spin_lock_init(&priv->lock);
 
@@ -816,6 +818,8 @@ static int octeon_usb_probe(struct platform_device *pdev)
 
 	pr_info("OcteonUSB: Registered HCD for port %d on irq %d\n", usb_num, irq);
 
+	octeon_error_tree_enable(CVMX_ERROR_GROUP_USB, usb_num);
+
 	return 0;
 }
 
@@ -829,6 +833,8 @@ static int octeon_usb_remove(struct platform_device *pdev)
 
 	DEBUG_CALL();
 
+	octeon_error_tree_disable(CVMX_ERROR_GROUP_USB, priv->usb_num);
+
 	usb_remove_hcd(hcd);
 	tasklet_kill(&priv->dequeue_tasklet);
 	spin_lock_irqsave(&priv->lock, flags);
-- 
1.7.5.4

