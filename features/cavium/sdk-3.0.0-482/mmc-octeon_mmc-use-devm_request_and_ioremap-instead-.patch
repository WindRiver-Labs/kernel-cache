From ffbb6da730ee8b2940c414b69e87b4ef8f348ac4 Mon Sep 17 00:00:00 2001
From: Yang Wei <Wei.Yang@windriver.com>
Date: Mon, 4 Aug 2014 14:46:59 +0800
Subject: [PATCH 20/20] mmc:octeon_mmc:use devm_request_and_ioremap instead of
 devm_ioremap_resource

In 3.4 kernel, devm_ioremap_resource is not introduced, so we have to
use the older API.

Signed-off-by: Yang Wei <Wei.Yang@windriver.com>
---
 drivers/mmc/host/octeon_mmc.c |   12 ++++++------
 1 files changed, 6 insertions(+), 6 deletions(-)

diff --git a/drivers/mmc/host/octeon_mmc.c b/drivers/mmc/host/octeon_mmc.c
index 26aaa00..50616d7 100644
--- a/drivers/mmc/host/octeon_mmc.c
+++ b/drivers/mmc/host/octeon_mmc.c
@@ -1191,9 +1191,9 @@ static int __devinit octeon_mmc_probe(struct platform_device *pdev)
 		return -ENXIO;
 	}
 
-	base = devm_ioremap_resource(&pdev->dev, res);
-	if (IS_ERR(base))
-		return PTR_ERR(base);
+	base = devm_request_and_ioremap(&pdev->dev, res);
+	if (!base)
+		return -ENOMEM;
 	host->base = (u64)base;
 
 	res = platform_get_resource(pdev, IORESOURCE_MEM, 1);
@@ -1202,9 +1202,9 @@ static int __devinit octeon_mmc_probe(struct platform_device *pdev)
 		ret = -EINVAL;
 		goto err;
 	}
-	base = devm_ioremap_resource(&pdev->dev, res);
-	if (IS_ERR(base)) {
-		ret = PTR_ERR(base);
+	base = devm_request_and_ioremap(&pdev->dev, res);
+	if (!base) {
+		ret = -ENOMEM;
 		goto err;
 	}
 
-- 
1.7.5.4

