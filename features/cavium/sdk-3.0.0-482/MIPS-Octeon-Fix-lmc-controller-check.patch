From 34ed5941246d138c354bf0b0d63fcb2633d1bef9 Mon Sep 17 00:00:00 2001
From: Chandrakala Chavva <cchavva@caviumnetworks.com>
Date: Wed, 23 Jan 2013 10:51:18 -0800
Subject: [PATCH 335/337] MIPS: Octeon: Fix lmc controller check.

Based On SDK 3.0.0-482

Check for LMCX_DLL_CTL2[QUAD_DLL_ENA] which is set correctly
for all OcteonII models.

Signed-off-by: Chandrakala Chavva <cchavva@caviumnetworks.com>
Signed-off-by: Corey Minyard <cminyard@mvista.com>
Signed-off-by: Jack Tan <jack.tan@windriver.com>
---
 drivers/edac/octeon_edac-lmc.c |    5 +++--
 1 files changed, 3 insertions(+), 2 deletions(-)

diff --git a/drivers/edac/octeon_edac-lmc.c b/drivers/edac/octeon_edac-lmc.c
index aa3e7fc..b84c93d 100644
--- a/drivers/edac/octeon_edac-lmc.c
+++ b/drivers/edac/octeon_edac-lmc.c
@@ -123,9 +123,10 @@ static int __devinit octeon_lmc_edac_probe(struct platform_device *pdev)
 		union cvmx_lmcx_config config;
 		union cvmx_lmcx_dll_ctl2 ctl2;
 
+		/* Check if LMC controller is enabled. */
 		ctl2.u64 = cvmx_read_csr(CVMX_LMCX_DLL_CTL2(mc));
-		if (ctl2.s.intf_en == 0) {
-			dev_info(&pdev->dev, "LMC is present\n");
+		if (ctl2.s.quad_dll_ena == 0) {
+			dev_info(&pdev->dev, "Disabled (LMC not present)\n");
 			return 0;
 		}
 		
-- 
1.7.5.4

