From 0040958fba27a158768d02840a0b0cad4b2f4278 Mon Sep 17 00:00:00 2001
From: Chandrakala Chavva <cchavva@caviumnetworks.com>
Date: Mon, 7 Oct 2013 12:14:44 -0700
Subject: [PATCH 286/382] netdev: octeon-ethernet: Use correct CSR for processing receive errors

Based on SDK octeon3_3.10.

AGL interface uses different CSR for processing errors
on received packet.

Signed-off-by: Chandrakala Chavva <cchavva@caviumnetworks.com>
Signed-off-by: Yanjiang Jin <yanjiang.jin@windriver.com>
---
 drivers/net/ethernet/octeon/ethernet-rx.c |   10 +++++++++-
 1 files changed, 9 insertions(+), 1 deletions(-)

diff --git a/drivers/net/ethernet/octeon/ethernet-rx.c b/drivers/net/ethernet/octeon/ethernet-rx.c
index aa74fb8..ac647ec 100644
--- a/drivers/net/ethernet/octeon/ethernet-rx.c
+++ b/drivers/net/ethernet/octeon/ethernet-rx.c
@@ -239,7 +239,15 @@ static int cvm_oct_check_rcv_error(cvmx_wqe_t *work)
 		int interface = cvmx_helper_get_interface_num(port);
 		int index = cvmx_helper_get_interface_index_num(port);
 		union cvmx_gmxx_rxx_frm_ctl gmxx_rxx_frm_ctl;
-		gmxx_rxx_frm_ctl.u64 = cvmx_read_csr(CVMX_GMXX_RXX_FRM_CTL(index, interface));
+		uint64_t frm_ctl_reg;
+
+		if (cvmx_helper_interface_get_mode(interface) ==
+			CVMX_HELPER_INTERFACE_MODE_AGL)
+			frm_ctl_reg = CVMX_AGL_GMX_RXX_FRM_CTL(index);
+		else
+			frm_ctl_reg = CVMX_GMXX_RXX_FRM_CTL(index, interface);
+
+		gmxx_rxx_frm_ctl.u64 = cvmx_read_csr(frm_ctl_reg);
 		if (gmxx_rxx_frm_ctl.s.pre_chk == 0) {
 
 			u8 *ptr = phys_to_virt(work->packet_ptr.s.addr);
-- 
1.7.0.4

