From 2d3a892eb8aa3f81b863de3a8840b1ef2c80e07a Mon Sep 17 00:00:00 2001
From: Chandrakala Chavva <cchavva@caviumnetworks.com>
Date: Wed, 7 Aug 2013 10:15:32 -0700
Subject: [PATCH 218/382] MIPS: OCTEON: Force L1 Dcache and TLB parity errors for testing.

Based on SDK octeon3_3.10.

Signed-off-by: Chandrakala Chavva <cchavva@caviumnetworks.com>
Signed-off-by: Yanjiang Jin <yanjiang.jin@windriver.com>
---
 arch/mips/cavium-octeon/octeon-error-injector.c |   21 +++++++++++++++++++++
 1 files changed, 21 insertions(+), 0 deletions(-)

diff --git a/arch/mips/cavium-octeon/octeon-error-injector.c b/arch/mips/cavium-octeon/octeon-error-injector.c
index 6d36767..7f16ced 100644
--- a/arch/mips/cavium-octeon/octeon-error-injector.c
+++ b/arch/mips/cavium-octeon/octeon-error-injector.c
@@ -23,6 +23,21 @@ int test_param;
 module_param(test_param, int, S_IRUGO);
 MODULE_PARM_DESC(test_param, "Parameter used in the test case.");
 
+static void octeon_error_injector_l1_dcache_parity(void)
+{
+	if (OCTEON_IS_OCTEON3())
+		write_octeon_c0_errctl(1ull<<11);
+	else if (OCTEON_IS_OCTEON2())
+		write_octeon_c0_dcacheerr(1ull<<3);
+}
+
+static void octeon_error_injector_tlb_parity(void)
+{
+	if (OCTEON_IS_OCTEON3())
+		write_octeon_c0_errctl(1ull<<15);
+	else if (OCTEON_IS_OCTEON2())
+		write_octeon_c0_dcacheerr(1ull<<6);
+}
 
 static void octeon_error_injector_memory_read(void)
 {
@@ -78,6 +93,12 @@ static int __init octeon_error_injector_init(void)
 	case 2:
 		octeon_error_injector_fpa1();
 		break;
+	case 3:
+		octeon_error_injector_l1_dcache_parity();
+		break;
+	case 4:
+		octeon_error_injector_tlb_parity();
+		break;
 	default:
 		pr_err("Error: Unrecognized test number: %d\n",  test_number);
 		break;
-- 
1.7.0.4

