From 45fb5c87ceed4b3a971c603eaf9dfffcc119d0c2 Mon Sep 17 00:00:00 2001
From: David Daney <david.daney@cavium.com>
Date: Mon, 29 Jul 2013 11:54:45 -0700
Subject: [PATCH 177/382] netdev: octeon-ethernet: Fix netif_running/netif_queue_stopped confusion.

Based on SDK octeon3_3.10.

Xmit flow control is done by testing netif_queue_stopped.

Signed-off-by: David Daney <david.daney@cavium.com>
Signed-off-by: Yanjiang Jin <yanjiang.jin@windriver.com>
---
 drivers/net/ethernet/octeon/ethernet-napi.c |    2 +-
 1 files changed, 1 insertions(+), 1 deletions(-)

diff --git a/drivers/net/ethernet/octeon/ethernet-napi.c b/drivers/net/ethernet/octeon/ethernet-napi.c
index 89d8f59..8608598 100644
--- a/drivers/net/ethernet/octeon/ethernet-napi.c
+++ b/drivers/net/ethernet/octeon/ethernet-napi.c
@@ -158,7 +158,7 @@ static int CVM_OCT_NAPI_POLL(struct napi_struct *napi, int budget)
 
 			skb = (struct sk_buff *)packet_ptr.u64;
 			priv = netdev_priv(skb->dev);
-			if (!netif_running(skb->dev))
+			if (netif_queue_stopped(skb->dev))
 				netif_wake_queue(skb->dev);
 			if (unlikely((skb_shinfo(skb)->tx_flags | SKBTX_IN_PROGRESS) != 0 &&
 				     priv->tx_timestamp_hw)) {
-- 
1.7.0.4

