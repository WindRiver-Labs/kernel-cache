From a46821e1ce19c92c51ffe59a08835fd127d4c63d Mon Sep 17 00:00:00 2001
From: Prem Mallappa <prem.mallappa@gmail.com>
Date: Fri, 30 Aug 2013 20:03:31 +0530
Subject: [PATCH 260/382] MIPS: KDUMP: skip walking indirection page for crashkernels

Based on SDK octeon3_3.10.

KDUMP: skip indirection page, as crashkernel has already copied to destination

Signed-off-by: Prem Mallappa <pmallappa@caviumnetworks.com>
Signed-off-by: David Daney <david.daney@cavium.com>
Signed-off-by: Yanjiang Jin <yanjiang.jin@windriver.com>
---
 arch/mips/kernel/relocate_kernel.S |    5 +++++
 1 files changed, 5 insertions(+), 0 deletions(-)

diff --git a/arch/mips/kernel/relocate_kernel.S b/arch/mips/kernel/relocate_kernel.S
index 43d2d78..2778a41 100644
--- a/arch/mips/kernel/relocate_kernel.S
+++ b/arch/mips/kernel/relocate_kernel.S
@@ -26,6 +26,11 @@ process_entry:
 	PTR_L		s2, (s0)
 	PTR_ADD		s0, s0, SZREG
 
+	/* In case of kdump/crash kernel, indirection page is not populated
+	* as the kernel is directly copied to reserved location
+	*/
+	beq             s2, zero, done
+
 	/* destination page */
 	and		s3, s2, 0x1
 	beq		s3, zero, 1f
-- 
1.7.0.4

