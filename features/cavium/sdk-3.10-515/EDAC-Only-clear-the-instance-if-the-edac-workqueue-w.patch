From ff73fa3e15d2e075312425b2ce8b84e8fed270bb Mon Sep 17 00:00:00 2001
From: Bin Jiang <bin.jiang@windriver.com>
Date: Mon, 27 May 2013 20:14:58 +0800
Subject: [PATCH 4/5] EDAC: Only clear the instance if the edac workqueue was
 initialized

When adding a edac device, if it has a check routine, the edac workqueue
will be initialized. So only clear the instance if the edac workqueue was
initialized when removing a edac device.

Signed-off-by: Bin Jiang <bin.jiang@windriver.com>
---
 drivers/edac/edac_device.c |    3 ++-
 1 files changed, 2 insertions(+), 1 deletions(-)

diff --git a/drivers/edac/edac_device.c b/drivers/edac/edac_device.c
index 211021d..ad84cab 100644
--- a/drivers/edac/edac_device.c
+++ b/drivers/edac/edac_device.c
@@ -587,7 +587,8 @@ struct edac_device_ctl_info *edac_device_del_device(struct device *dev)
 	mutex_unlock(&device_ctls_mutex);
 
 	/* clear workq processing on this instance */
-	edac_device_workq_teardown(edac_dev);
+	if (edac_dev->edac_check)
+		edac_device_workq_teardown(edac_dev);
 
 	/* Tear down the sysfs entries for this instance */
 	edac_device_remove_sysfs(edac_dev);
-- 
1.7.5.4

