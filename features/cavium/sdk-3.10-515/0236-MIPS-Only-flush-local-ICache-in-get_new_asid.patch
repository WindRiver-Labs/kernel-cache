From 36f28aac8641efc7ac439544e4418693c46d8585 Mon Sep 17 00:00:00 2001
From: David Daney <david.daney@cavium.com>
Date: Mon, 12 Aug 2013 17:27:47 -0700
Subject: [PATCH 236/382] MIPS: Only flush local ICache in get_new_asid().

Based on SDK octeon3_3.10.

For virtually tagged ICache, on ASID rollover, only the local ICache
needs to be invalidated.  Flushing across all CPUs is unnecessary.

Signed-off-by: David Daney <david.daney@cavium.com>
Signed-off-by: Yanjiang Jin <yanjiang.jin@windriver.com>
---
 arch/mips/include/asm/mmu_context.h |    2 +-
 1 files changed, 1 insertions(+), 1 deletions(-)

diff --git a/arch/mips/include/asm/mmu_context.h b/arch/mips/include/asm/mmu_context.h
index dc56f16..b2ed536 100644
--- a/arch/mips/include/asm/mmu_context.h
+++ b/arch/mips/include/asm/mmu_context.h
@@ -116,7 +116,7 @@ get_new_asid(unsigned long cpu)
 
 	if (! ((asid += ASID_INC) & ASID_MASK) ) {
 		if (cpu_has_vtag_icache)
-			flush_icache_all();
+			local_flush_icache_all();
 #if IS_ENABLED(CONFIG_KVM_MIPS_TE)
 		kvm_local_flush_tlb_all();      /* start new asid cycle */
 #else
-- 
1.7.0.4

