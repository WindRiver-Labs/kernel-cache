From 2eb29145ab8d1d404f02e422650a94bce7537fed Mon Sep 17 00:00:00 2001
From: Carlos Munoz <cmunoz@caviumnetworks.com>
Date: Fri, 7 Aug 2015 17:20:21 -0700
Subject: [PATCH 136/184] netdev: octeon3-ethernet: Only swap pki buffer links
 on cn78xx pass 1.

Source: Cavium Networks, Inc.
MR: 00000
Type: Integration
Disposition: Merged from Octeon Tree
ChangeID: 6e83290ce4710091c7f6f6c19478411e984b0470
Description:

Signed-off-by: Carlos Munoz <cmunoz@caviumnetworks.com>
Signed-off-by: Corey Minyard <cminyard@mvista.com>
[Original patch taken from octeon-linux-kernel-patches-SDK-3.1.2-release]
Signed-off-by: Yanjiang Jin <yanjiang.jin@windriver.com>
---
 drivers/net/ethernet/octeon/octeon3-ethernet.c | 12 ++++++++----
 1 file changed, 8 insertions(+), 4 deletions(-)

diff --git a/drivers/net/ethernet/octeon/octeon3-ethernet.c b/drivers/net/ethernet/octeon/octeon3-ethernet.c
index eb8c0462..3ac3701 100644
--- a/drivers/net/ethernet/octeon/octeon3-ethernet.c
+++ b/drivers/net/ethernet/octeon/octeon3-ethernet.c
@@ -1137,8 +1137,10 @@ static int octeon3_eth_rx_one(struct octeon3_rx *rx, bool is_async,
 				break;
 			packet_ptr.u64 = *(u64 *)(data - 8);
 #ifndef __LITTLE_ENDIAN
-			/* PKI_BUFLINK_S's are endian-swapped */
-			packet_ptr.u64 = swab64(packet_ptr.u64);
+			if (OCTEON_IS_MODEL(OCTEON_CN78XX_PASS1_X)) {
+				/* PKI_BUFLINK_S's are endian-swapped */
+				packet_ptr.u64 = swab64(packet_ptr.u64);
+			}
 #endif
 			data = phys_to_virt(packet_ptr.addr);
 			skb = octeon3_eth_work_to_skb((void *)round_down((unsigned long)data, 128ul));
@@ -1176,8 +1178,10 @@ static int octeon3_eth_rx_one(struct octeon3_rx *rx, bool is_async,
 				break;
 			packet_ptr.u64 = *(u64 *)(data - 8);
 #ifndef __LITTLE_ENDIAN
-			/* PKI_BUFLINK_S's are endian-swapped */
-			packet_ptr.u64 = swab64(packet_ptr.u64);
+			if (OCTEON_IS_MODEL(OCTEON_CN78XX_PASS1_X)) {
+				/* PKI_BUFLINK_S's are endian-swapped */
+				packet_ptr.u64 = swab64(packet_ptr.u64);
+			}
 #endif
 			data = phys_to_virt(packet_ptr.addr);
 			next_skb = octeon3_eth_work_to_skb((void *)round_down((unsigned long)data, 128ul));
-- 
1.9.1

