From e9870e5ade10fc03bbb142aa69512f9f9637da5f Mon Sep 17 00:00:00 2001
From: David Daney <david.daney@cavium.com>
Date: Mon, 16 Dec 2013 15:52:50 -0800
Subject: [PATCH 431/974] netdev: octeon-ethernet: Add some likely()/unlikely()
 to speed up NAPI rx.

Signed-off-by: David Daney <david.daney@cavium.com>
[Original patch taken from Cavium SDK 3.1.2-568]
Signed-off-by: Quanyang Wang <quanyang.wang@windriver.com>
---
 drivers/net/ethernet/octeon/ethernet-napi.c | 5 ++---
 1 file changed, 2 insertions(+), 3 deletions(-)

diff --git a/drivers/net/ethernet/octeon/ethernet-napi.c b/drivers/net/ethernet/octeon/ethernet-napi.c
index 01aa2cf..281b38b 100644
--- a/drivers/net/ethernet/octeon/ethernet-napi.c
+++ b/drivers/net/ethernet/octeon/ethernet-napi.c
@@ -105,7 +105,6 @@ static int CVM_OCT_NAPI_POLL(struct napi_struct *napi, int budget)
 		else
 			work = cvmx_pow_work_request_sync(CVMX_POW_NO_WAIT);
 
-		prefetch(work);
 		did_work_request = false;
 		if (unlikely(work == NULL)) {
 			/* It takes so long to get here, so lets wait
@@ -122,12 +121,12 @@ static int CVM_OCT_NAPI_POLL(struct napi_struct *napi, int budget)
 		pskb = cvm_oct_packet_to_skb(cvm_oct_get_buffer_ptr(packet_ptr));
 		prefetch(pskb);
 
-		if (USE_ASYNC_IOBDMA && rx_count < (budget - 1)) {
+		if (likely(USE_ASYNC_IOBDMA && rx_count < (budget - 1))) {
 			cvmx_pow_work_request_async_nocheck(CVMX_SCR_SCRATCH, CVMX_POW_NO_WAIT);
 			did_work_request = true;
 		}
 
-		if (rx_count == 0) {
+		if (unlikely(rx_count == 0)) {
 			/* First time through, see if there is enough
 			 * work waiting to merit waking another
 			 * CPU.
-- 
2.6.2

