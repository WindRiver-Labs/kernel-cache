From b5358145e8e0ee015cb27d02523669dfec29c201 Mon Sep 17 00:00:00 2001
From: Yanjiang Jin <yanjiang.jin@windriver.com>
Date: Fri, 13 Oct 2017 10:19:42 +0800
Subject: [PATCH] OCTEON: disable tx/rx for octeon3 ethernet in kexec's 1st
 kernel

For the limitation of octeon3 ethernet hardware, the network can't be
reset in the kexec's 2nd kernel. So we need to
call cvmx_helper_shutdown_cmr_cn78xx() to disable tx/rx functions.

Signed-off-by: Yanjiang Jin <yanjiang.jin@windriver.com>
---
 arch/mips/cavium-octeon/setup.c |    3 ++-
 1 files changed, 2 insertions(+), 1 deletions(-)

diff --git a/arch/mips/cavium-octeon/setup.c b/arch/mips/cavium-octeon/setup.c
index 5c1183d..b4304b2 100644
--- a/arch/mips/cavium-octeon/setup.c
+++ b/arch/mips/cavium-octeon/setup.c
@@ -146,8 +146,10 @@ static void octeon_generic_shutdown(void)
 	kexec_args[3] = (unsigned long)octeon_boot_desc_ptr;
 }
 
+extern void cvmx_helper_shutdown_cmr_cn78xx(void);
 static void octeon_shutdown(void)
 {
+	cvmx_helper_shutdown_cmr_cn78xx();
 	octeon_generic_shutdown();
 	octeon_error_tree_shutdown();
 #ifdef CONFIG_SMP
@@ -160,7 +162,6 @@ static void octeon_shutdown(void)
 #endif
 }
 
-extern void cvmx_helper_shutdown_cmr_cn78xx(void);
 static void octeon_crash_shutdown(struct pt_regs *regs)
 {
 	cvmx_helper_shutdown_cmr_cn78xx();
-- 
1.7.5.4

