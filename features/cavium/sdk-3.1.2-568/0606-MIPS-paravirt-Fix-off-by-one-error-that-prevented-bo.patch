From 2e0512c799fc56842f9a9b64a51b51c1cfff8193 Mon Sep 17 00:00:00 2001
From: Andreas Herrmann <andreas.herrmann@caviumnetworks.com>
Date: Thu, 27 Feb 2014 13:46:59 -0800
Subject: [PATCH 606/974] MIPS: paravirt: Fix off-by-one error that prevented
 boot w/ numcpus==NR_CPUS

When booting a kernel (built with CONFIG_NR_CPUS=4) using

  # ./lkvm run -c 4 -m 256 -k vmlinux -d rootfs.ext3 --console=virtio -p "numcpus=4 debug"

it complained about

  [    0.000000] Malformed early option 'numcpus'

and just one vCPU was enabled.

Signed-off-by: Andreas Herrmann <andreas.herrmann@caviumnetworks.com>
[Original patch taken from Cavium SDK 3.1.2-568]
Signed-off-by: Quanyang Wang <quanyang.wang@windriver.com>
---
 arch/mips/paravirt/paravirt-smp.c | 2 +-
 1 file changed, 1 insertion(+), 1 deletion(-)

diff --git a/arch/mips/paravirt/paravirt-smp.c b/arch/mips/paravirt/paravirt-smp.c
index 41d393c..c7e0d50f 100644
--- a/arch/mips/paravirt/paravirt-smp.c
+++ b/arch/mips/paravirt/paravirt-smp.c
@@ -30,7 +30,7 @@ static int __init set_numcpus(char *str)
 	int newval;
 
 	if (get_option(&str, &newval)) {
-		if (newval < 1 || newval >= NR_CPUS)
+		if (newval < 1 || newval > NR_CPUS)
 			goto bad;
 		numcpus = newval;
 		return 0;
-- 
2.6.2

