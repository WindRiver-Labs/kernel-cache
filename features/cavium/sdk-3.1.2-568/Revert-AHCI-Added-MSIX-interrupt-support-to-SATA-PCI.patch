From 162dd73c881f2de54d31c270ea10f0600d8906c1 Mon Sep 17 00:00:00 2001
From: Yanjiang Jin <yanjiang.jin@windriver.com>
Date: Wed, 25 Oct 2017 15:16:38 +0800
Subject: [PATCH] Revert "AHCI: Added MSIX interrupt support to SATA PCI
 driver"

This patch should be for Cavium Thunder only, which is an ARM64 board.
It shouldn't be for Cavium Octeon, which is a MIPS board.
The macro 'AHCI_HFLAG_MSIX' is only defined in Cavium Thunder environment,
it would lead to a build error.
---
 drivers/ata/ahci.c |   16 ----------------
 drivers/ata/ahci.h |    1 -
 2 files changed, 0 insertions(+), 17 deletions(-)

diff --git a/drivers/ata/ahci.c b/drivers/ata/ahci.c
index 772cb70..a337cb2 100644
--- a/drivers/ata/ahci.c
+++ b/drivers/ata/ahci.c
@@ -76,7 +76,6 @@ enum board_ids {
 	board_ahci_sb600,
 	board_ahci_sb700,	/* for SB700 and SB800 */
 	board_ahci_vt8251,
-	board_ahci_cavium,
 
 	/* aliases */
 	board_ahci_mcp_linux	= board_ahci_mcp65,
@@ -226,13 +225,6 @@ static const struct ata_port_info ahci_port_info[] = {
 		.udma_mask	= ATA_UDMA6,
 		.port_ops	= &ahci_vt8251_ops,
 	},
-	[board_ahci_cavium] = {
-		AHCI_HFLAGS	(AHCI_HFLAG_MSIX | AHCI_HFLAG_NO_MSI),
-		.flags		= AHCI_FLAG_COMMON,
-		.pio_mask	= ATA_PIO4,
-		.udma_mask	= ATA_UDMA6,
-		.port_ops	= &ahci_ops,
-	},
 };
 
 static const struct pci_device_id ahci_pci_tbl[] = {
@@ -579,10 +571,6 @@ static const struct pci_device_id ahci_pci_tbl[] = {
 	/* Enmotus */
 	{ PCI_DEVICE(0x1c44, 0x8000), board_ahci },
 
-	/* Cavium */
-	{ PCI_DEVICE(0x177d, 0xa01c),
-	  .driver_data = board_ahci_cavium },
-
 	/* Generic, PCI class code for AHCI */
 	{ PCI_ANY_ID, PCI_ANY_ID, PCI_ANY_ID, PCI_ANY_ID,
 	  PCI_CLASS_STORAGE_SATA_AHCI, 0xffffff, board_ahci },
@@ -1482,10 +1470,6 @@ static int ahci_init_msi(struct pci_dev *pdev, unsigned int n_ports,
 	if (nvec > 1)
 		hpriv->flags |= AHCI_HFLAG_MULTI_MSI;
 
-	/* Cavium Thunder doesn't have per port MSI-X irq */
-	if (board_id == board_ahci_cavium)
-		hpriv->flags &= ~AHCI_HFLAG_MULTI_MSI;
-
 	goto out;
 
 single_msi:
diff --git a/drivers/ata/ahci.h b/drivers/ata/ahci.h
index 974df6e..9fd5cc9 100644
--- a/drivers/ata/ahci.h
+++ b/drivers/ata/ahci.h
@@ -39,7 +39,6 @@
 #include <linux/libata.h>
 #include <linux/phy/phy.h>
 #include <linux/regulator/consumer.h>
-#include <linux/pci.h>
 
 /* Enclosure Management Control */
 #define EM_CTRL_MSG_TYPE              0x000f0000
-- 
1.7.5.4

