From 2d085eb697bfc5ed0aec3ae500b33dc7f4d2af0c Mon Sep 17 00:00:00 2001
From: Carlos Munoz <cmunoz@caviumnetworks.com>
Date: Thu, 17 Dec 2015 14:12:01 -0800
Subject: [PATCH 05/13] netdev: octeon3-ethernet: Calculate checksum only when
 necessary.

Signed-off-by: Carlos Munoz <cmunoz@caviumnetworks.com>
[Original patch taken from patch set for OCTEON SDK 3.1.2]
Signed-off-by: Quanyang Wang <quanyang.wang@windriver.com>
---
 drivers/net/ethernet/octeon/octeon3-ethernet.c |    3 ++-
 1 files changed, 2 insertions(+), 1 deletions(-)

diff --git a/drivers/net/ethernet/octeon/octeon3-ethernet.c b/drivers/net/ethernet/octeon/octeon3-ethernet.c
index a30acf7..d5ee45f 100644
--- a/drivers/net/ethernet/octeon/octeon3-ethernet.c
+++ b/drivers/net/ethernet/octeon/octeon3-ethernet.c
@@ -2003,7 +2003,8 @@ static int octeon3_eth_ndo_start_xmit(struct sk_buff *skb, struct net_device *ne
 	send_hdr.s.total = skb->len;
 	send_hdr.s.aura = gaura;
 
-	if (skb->ip_summed != CHECKSUM_NONE) {
+	if (skb->ip_summed != CHECKSUM_NONE &&
+	    skb->ip_summed != CHECKSUM_UNNECESSARY) {
 #ifndef BROKEN_SIMULATOR_CSUM
 		switch (skb->protocol) {
 		case __constant_htons(ETH_P_IP):
-- 
1.7.5.4

