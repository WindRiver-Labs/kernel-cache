From 706412b5d690cf95fdc0c53929e6b8381e6235a0 Mon Sep 17 00:00:00 2001
From: Carlos Munoz <cmunoz@caviumnetworks.com>
Date: Mon, 21 Jul 2014 18:05:50 -0700
Subject: [PATCH 783/974] etdev: octeon-ethernet: Only recycles skbs that came
 from the fpa.

Signed-off-by: Carlos Munoz <cmunoz@caviumnetworks.com>
[Original patch taken from Cavium SDK 3.1.2-568]
Signed-off-by: Quanyang Wang <quanyang.wang@windriver.com>
---
 drivers/net/ethernet/octeon/ethernet-tx.c | 3 +++
 1 file changed, 3 insertions(+)

diff --git a/drivers/net/ethernet/octeon/ethernet-tx.c b/drivers/net/ethernet/octeon/ethernet-tx.c
index 26f9340..0515835 100644
--- a/drivers/net/ethernet/octeon/ethernet-tx.c
+++ b/drivers/net/ethernet/octeon/ethernet-tx.c
@@ -65,6 +65,9 @@ static bool cvm_oct_skb_ok_for_reuse(struct sk_buff *skb)
 {
 	unsigned char *fpa_head = cvm_oct_get_fpa_head(skb);
 
+	if (*(struct sk_buff **)(fpa_head - sizeof(void *)) != skb)
+		return false;
+
 	if (unlikely(skb->data < fpa_head))
 		return false;
 
-- 
2.6.2

