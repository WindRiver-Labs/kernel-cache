From 3e6632ab7c4fa59eec268442c8df5bf60fbae495 Mon Sep 17 00:00:00 2001
From: David Daney <david.daney@cavium.com>
Date: Wed, 19 Nov 2014 09:44:38 -0800
Subject: [PATCH 026/184] MIPS: OCTEON: Increase NR_IRQS for CONFIG_NUMA.

Source: Cavium Networks, Inc.
MR: 00000
Type: Integration
Disposition: Merged from Octeon Tree
ChangeID: b5386406852ec2e771c6fb486b7d656a71fcb763
Description:

MSI requires 256 irqs per node, so 511 is not enough for a two node
system.

Signed-off-by: David Daney <david.daney@cavium.com>
Signed-off-by: Corey Minyard <cminyard@mvista.com>
[Original patch taken from octeon-linux-kernel-patches-SDK-3.1.2-release]
Signed-off-by: Yanjiang Jin <yanjiang.jin@windriver.com>
---
 arch/mips/include/asm/mach-cavium-octeon/irq.h | 11 ++++++++---
 1 file changed, 8 insertions(+), 3 deletions(-)

diff --git a/arch/mips/include/asm/mach-cavium-octeon/irq.h b/arch/mips/include/asm/mach-cavium-octeon/irq.h
index d8d4684..f5557e3 100644
--- a/arch/mips/include/asm/mach-cavium-octeon/irq.h
+++ b/arch/mips/include/asm/mach-cavium-octeon/irq.h
@@ -8,7 +8,13 @@
 #ifndef __OCTEON_IRQ_H__
 #define __OCTEON_IRQ_H__
 
-#define NR_IRQS OCTEON_IRQ_LAST
+#ifdef CONFIG_NUMA
+	/* We need 256 per node for MSI */
+#define NR_IRQS 767
+#else
+#define NR_IRQS 511
+#endif
+
 #define MIPS_CPU_IRQ_BASE OCTEON_IRQ_SW0
 
 /*
@@ -55,8 +61,7 @@ enum octeon_irq {
 	OCTEON_IRQ_SRIO2,
 	OCTEON_IRQ_SRIO3,
 	OCTEON_IRQ_USB0,
-	OCTEON_IRQ_USB1,
-	OCTEON_IRQ_LAST = 511
+	OCTEON_IRQ_USB1
 };
 
 #endif
-- 
1.9.1

