From 3edcfef543fc9f8ddb81716d61c182df37ef9da7 Mon Sep 17 00:00:00 2001
From: Chandrakala Chavva <cchavva@caviumnetworks.com>
Date: Thu, 17 Jul 2014 18:05:50 -0700
Subject: [PATCH 907/974] XHCI:OCTEON: Use correct GPIO CSRs for 73xx.

Signed-off-by: Chandrakala Chavva <cchavva@caviumnetworks.com>
[Original patch taken from Cavium SDK 3.1.2-568]
Signed-off-by: Quanyang Wang <quanyang.wang@windriver.com>
---
 drivers/usb/host/xhci-octeon.c | 7 ++++++-
 1 file changed, 6 insertions(+), 1 deletion(-)

diff --git a/drivers/usb/host/xhci-octeon.c b/drivers/usb/host/xhci-octeon.c
index a713019..932430f 100644
--- a/drivers/usb/host/xhci-octeon.c
+++ b/drivers/usb/host/xhci-octeon.c
@@ -67,7 +67,12 @@ static int octeon3_usb_config_power(struct device_node *node, u64 base)
 			pr_err("Invalid power GPIO device tree entry\n");
 			return -1;
 		}
-		if (gpio <= 15) {
+		if (OCTEON_IS_MODEL(OCTEON_CN73XX) && gpio <= 31) {
+			gpio_bit.u64 = cvmx_read_csr(CVMX_GPIO_BIT_CFGX(gpio));
+			gpio_bit.s.tx_oe = 1;
+			gpio_bit.cn73xx.output_sel = (index == 0 ? 0x14 : 0x15);
+			cvmx_write_csr(CVMX_GPIO_BIT_CFGX(gpio), gpio_bit.u64);
+		} else if (gpio <= 15) {
 			gpio_bit.u64 = cvmx_read_csr(CVMX_GPIO_BIT_CFGX(gpio));
 			gpio_bit.s.tx_oe = 1;
 			gpio_bit.cn70xx.output_sel = (index == 0 ? 0x14 : 0x19);
-- 
2.6.2

