From 7ce7a4537b84817260d031a0ce5535de2ce86d2b Mon Sep 17 00:00:00 2001
From: Peter Swain <peter.swain@cavium.com>
Date: Fri, 18 Jul 2014 18:05:50 -0700
Subject: [PATCH 642/974] mips: octeon-ethernet: simplify ethtool.reset()

no need to callback into cvmx, when priv contains last reported state
[Original patch taken from Cavium SDK 3.1.2-568]
Signed-off-by: Quanyang Wang <quanyang.wang@windriver.com>
---
 drivers/net/ethernet/octeon/ethernet-mdio.c | 6 +++---
 1 file changed, 3 insertions(+), 3 deletions(-)

diff --git a/drivers/net/ethernet/octeon/ethernet-mdio.c b/drivers/net/ethernet/octeon/ethernet-mdio.c
index 7bc73ce..79adb11 100644
--- a/drivers/net/ethernet/octeon/ethernet-mdio.c
+++ b/drivers/net/ethernet/octeon/ethernet-mdio.c
@@ -137,7 +137,7 @@ static inline void set_port_pcs(struct net_device *dev, bool up)
       cvmx_write_csr(CVMX_PCSX_MRX_CONTROL_REG(index, interface), control_reg.u64);
 }
 
-static int cvm_oct_reset(struct net_device *dev, u32 *maskp)
+static int cvm_eth_reset(struct net_device *dev, u32 *maskp)
 {
 	struct octeon_ethernet *priv = netdev_priv(dev);
 
@@ -154,7 +154,7 @@ static int cvm_oct_reset(struct net_device *dev, u32 *maskp)
 	if (*maskp & ETH_RESET_PHY) {
 		struct octeon_ethernet *priv = netdev_priv(dev);
 		int ipd_port = priv->ipd_port;
-		cvmx_helper_link_info_t link_info = cvmx_helper_link_get(ipd_port);
+		cvmx_helper_link_info_t link_info = (cvmx_helper_link_info_t) priv->link_info;
 
 		if (priv->last_link)
 		{
@@ -180,7 +180,7 @@ const struct ethtool_ops cvm_oct_ethtool_ops = {
 	.set_settings = cvm_oct_set_settings,
 	.nway_reset = cvm_oct_nway_reset,
 	.get_link = ethtool_op_get_link,
-	.reset = cvm_oct_reset,
+	.reset = cvm_eth_reset,
 };
 
 /**
-- 
2.6.2

