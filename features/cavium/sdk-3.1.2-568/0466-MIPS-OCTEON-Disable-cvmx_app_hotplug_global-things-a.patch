From 429a6ad07abfdda2331ef96e93bed39ffb121c05 Mon Sep 17 00:00:00 2001
From: David Daney <david.daney@cavium.com>
Date: Tue, 4 Feb 2014 13:46:59 -0800
Subject: [PATCH 466/974] MIPS/OCTEON: Disable cvmx_app_hotplug_global things
 as they are broken.

Signed-off-by: David Daney <david.daney@cavium.com>
[Original patch taken from Cavium SDK 3.1.2-568]
Signed-off-by: Quanyang Wang <quanyang.wang@windriver.com>
---
 arch/mips/cavium-octeon/smp.c | 10 ++--------
 1 file changed, 2 insertions(+), 8 deletions(-)

diff --git a/arch/mips/cavium-octeon/smp.c b/arch/mips/cavium-octeon/smp.c
index 6646eb9..dfa29bd 100644
--- a/arch/mips/cavium-octeon/smp.c
+++ b/arch/mips/cavium-octeon/smp.c
@@ -529,14 +529,9 @@ void play_dead(void)
 	}
 }
 
-#ifdef	CONFIG_CPU_LITTLE_ENDIAN
-# ifdef __BIG_ENDIAN_BITFIELD
-#   error "Endian Configuration Mismatch"
-# endif
-#endif
-
 static int octeon_update_boot_vector(unsigned int cpu)
 {
+#if 0
 	int coreid = cpu_logical_map(cpu);
 	int node;
 	struct cvmx_app_hotplug_global *hgp = octeon_hotplug_global_ptr;
@@ -565,13 +560,11 @@ static int octeon_update_boot_vector(unsigned int cpu)
 	 * A core being brought up must be present either in the boot
 	 * core_mask or in the hotplug available coremask
 	 */
-#if 0
 	if (boot_core_mask & (1 << coreid)) {
 		boot_core_mask &= ~(1 << coreid);
 		/* CPU in boot core mask needs no further handling */
 		return 0;
 	}
-#endif
 	cvmx_spinlock_lock(&hgp->hotplug_global_lock);
 	if (!cvmx_coremask_is_core_set(&hgp->avail_coremask, coreid)) {
 		cvmx_spinlock_unlock(&hgp->hotplug_global_lock);
@@ -594,6 +587,7 @@ static int octeon_update_boot_vector(unsigned int cpu)
 	node = cvmx_coremask_core_to_node(coreid);
 	coreid = cvmx_coremask_core_on_node(coreid);
 	cvmx_write_csr_node(node, CVMX_CIU_NMI, (1 << coreid));
+#endif
 
 	return 0;
 }
-- 
2.6.2

