From 196e28c874e8c64d75cb57fe6a6ced76c001e330 Mon Sep 17 00:00:00 2001
From: Chandrakala Chavva <cchavva@caviumnetworks.com>
Date: Fri, 17 Jul 2015 14:50:21 -0700
Subject: [PATCH 128/184] XHCI:OCTEON: Use correct GPIO CSRs for 73xx.

Source: Cavium Networks, Inc.
MR: 00000
Type: Integration
Disposition: Merged from Octeon Tree
ChangeID: 16e1823f033247585abebf7d31d1745ef82a148a
Description:

Signed-off-by: Chandrakala Chavva <cchavva@caviumnetworks.com>
Signed-off-by: Corey Minyard <cminyard@mvista.com>
[Original patch taken from octeon-linux-kernel-patches-SDK-3.1.2-release]
Signed-off-by: Yanjiang Jin <yanjiang.jin@windriver.com>
---
 drivers/usb/host/xhci-octeon.c | 7 ++++++-
 1 file changed, 6 insertions(+), 1 deletion(-)

diff --git a/drivers/usb/host/xhci-octeon.c b/drivers/usb/host/xhci-octeon.c
index a713019..932430f 100644
--- a/drivers/usb/host/xhci-octeon.c
+++ b/drivers/usb/host/xhci-octeon.c
@@ -67,7 +67,12 @@ static int octeon3_usb_config_power(struct device_node *node, u64 base)
 			pr_err("Invalid power GPIO device tree entry\n");
 			return -1;
 		}
-		if (gpio <= 15) {
+		if (OCTEON_IS_MODEL(OCTEON_CN73XX) && gpio <= 31) {
+			gpio_bit.u64 = cvmx_read_csr(CVMX_GPIO_BIT_CFGX(gpio));
+			gpio_bit.s.tx_oe = 1;
+			gpio_bit.cn73xx.output_sel = (index == 0 ? 0x14 : 0x15);
+			cvmx_write_csr(CVMX_GPIO_BIT_CFGX(gpio), gpio_bit.u64);
+		} else if (gpio <= 15) {
 			gpio_bit.u64 = cvmx_read_csr(CVMX_GPIO_BIT_CFGX(gpio));
 			gpio_bit.s.tx_oe = 1;
 			gpio_bit.cn70xx.output_sel = (index == 0 ? 0x14 : 0x19);
-- 
1.9.1

