From 8ffa56130a61f36de298b10e71a0ff615eeea71f Mon Sep 17 00:00:00 2001
From: David Daney <david.daney@cavium.com>
Date: Mon, 12 Aug 2013 17:27:47 -0700
Subject: [PATCH 263/974] MIPS: Only flush local ICache in get_new_asid().

For virtually tagged ICache, on ASID rollover, only the local ICache
needs to be invalidated.  Flushing across all CPUs is unnecessary.

Signed-off-by: David Daney <david.daney@cavium.com>
[Original patch taken from Cavium SDK 3.1.2-568]
Signed-off-by: Quanyang Wang <quanyang.wang@windriver.com>
---
 arch/mips/include/asm/mmu_context.h | 2 +-
 1 file changed, 1 insertion(+), 1 deletion(-)

diff --git a/arch/mips/include/asm/mmu_context.h b/arch/mips/include/asm/mmu_context.h
index dc56f16..b2ed536 100644
--- a/arch/mips/include/asm/mmu_context.h
+++ b/arch/mips/include/asm/mmu_context.h
@@ -116,7 +116,7 @@ get_new_asid(unsigned long cpu)
 
 	if (! ((asid += ASID_INC) & ASID_MASK) ) {
 		if (cpu_has_vtag_icache)
-			flush_icache_all();
+			local_flush_icache_all();
 #ifdef CONFIG_KVM
 		kvm_local_flush_tlb_all();      /* start new asid cycle */
 #else
-- 
2.6.2

