From b9a6b6c2420f8a8af19ceb7abbb02c1bc4d4c302 Mon Sep 17 00:00:00 2001
From: Carlos Munoz <cmunoz@caviumnetworks.com>
Date: Mon, 17 Feb 2014 13:46:59 -0800
Subject: [PATCH 593/974] netdev: ethernet.c: Use at least 8 pko queues per
 port.

Signed-off-by: Carlos Munoz <cmunoz@caviumnetworks.com>
[Original patch taken from Cavium SDK 3.1.2-568]
Signed-off-by: Quanyang Wang <quanyang.wang@windriver.com>
---
 drivers/net/ethernet/octeon/ethernet.c | 4 ++--
 1 file changed, 2 insertions(+), 2 deletions(-)

diff --git a/drivers/net/ethernet/octeon/ethernet.c b/drivers/net/ethernet/octeon/ethernet.c
index 69da1dc..dda5101 100644
--- a/drivers/net/ethernet/octeon/ethernet.c
+++ b/drivers/net/ethernet/octeon/ethernet.c
@@ -215,7 +215,7 @@ static bool cvm_oct_pko_lockless(void)
 			case CVMX_HELPER_INTERFACE_MODE_RGMII:
 			case CVMX_HELPER_INTERFACE_MODE_GMII:
 			case CVMX_HELPER_INTERFACE_MODE_SPI:
-				queues += num_possible_cpus();
+				queues += max(8u, num_possible_cpus());
 				break;
 			case CVMX_HELPER_INTERFACE_MODE_NPI:
 			case CVMX_HELPER_INTERFACE_MODE_LOOP:
@@ -255,7 +255,7 @@ static void cvm_oct_set_pko_multiqueue(void)
 			case CVMX_HELPER_INTERFACE_MODE_GMII:
 			case CVMX_HELPER_INTERFACE_MODE_SPI:
 				rv = cvmx_pko_alloc_iport_and_queues(interface, port, 1,
-								     num_possible_cpus());
+								     max(8u, num_possible_cpus()));
 				WARN(rv, "cvmx_pko_alloc_iport_and_queues failed");
 				if (rv)
 					return;
-- 
2.6.2

