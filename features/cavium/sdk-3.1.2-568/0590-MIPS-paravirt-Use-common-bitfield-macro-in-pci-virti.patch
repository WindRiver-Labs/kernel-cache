From abdb9c43967e277da3ca3a1781c1b8471712f952 Mon Sep 17 00:00:00 2001
From: Andreas Herrmann <andreas.herrmann@caviumnetworks.com>
Date: Thu, 13 Feb 2014 13:46:59 -0800
Subject: [PATCH 590/974] MIPS: paravirt: Use common bitfield macro in
 pci-virtio-guest.c

Signed-off-by: Andreas Herrmann <andreas.herrmann@caviumnetworks.com>
[Original patch taken from Cavium SDK 3.1.2-568]
Signed-off-by: Quanyang Wang <quanyang.wang@windriver.com>
---
 arch/mips/pci/pci-virtio-guest.c | 24 ++++++------------------
 1 file changed, 6 insertions(+), 18 deletions(-)

diff --git a/arch/mips/pci/pci-virtio-guest.c b/arch/mips/pci/pci-virtio-guest.c
index eedc5c2..e0630e1 100644
--- a/arch/mips/pci/pci-virtio-guest.c
+++ b/arch/mips/pci/pci-virtio-guest.c
@@ -11,32 +11,20 @@
 #include <linux/interrupt.h>
 #include <linux/pci.h>
 
+#include <uapi/asm/bitfield.h>
 #include <asm/byteorder.h>
 #include <asm/io.h>
 
 #define PCI_CONFIG_ADDRESS	0xcf8
 #define PCI_CONFIG_DATA		0xcfc
 
-#ifdef __BIG_ENDIAN_BITFIELD
-#define BITFIELD_FIELD(field, more)					\
-	field;								\
-	more
-
-#else defined(__MIPSEL__)
-
-#define BITFIELD_FIELD(field, more)					\
-	more								\
-	field;
-
-#endif
-
 union pci_config_address {
 	struct {
-		BITFIELD_FIELD(unsigned enable_bit	:1,	/* 31       */
-		BITFIELD_FIELD(unsigned reserved	:7,	/* 30 .. 24 */
-		BITFIELD_FIELD(unsigned bus_number	:8,	/* 23 .. 16 */
-		BITFIELD_FIELD(unsigned devfn_number	:8,	/* 15 .. 8  */
-		BITFIELD_FIELD(unsigned	register_number	:8,	/* 7  .. 0  */
+		__BITFIELD_FIELD(unsigned enable_bit	  : 1,	/* 31       */
+		__BITFIELD_FIELD(unsigned reserved	  : 7,	/* 30 .. 24 */
+		__BITFIELD_FIELD(unsigned bus_number	  : 8,	/* 23 .. 16 */
+		__BITFIELD_FIELD(unsigned devfn_number	  : 8,	/* 15 .. 8  */
+		__BITFIELD_FIELD(unsigned register_number : 8,	/* 7  .. 0  */
 		;)))))
 	};
 	u32 w;
-- 
2.6.2

