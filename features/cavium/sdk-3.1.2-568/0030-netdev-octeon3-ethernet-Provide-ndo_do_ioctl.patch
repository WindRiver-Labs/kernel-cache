From 692346aa894f2b73e0ffea3c780eae906f06e133 Mon Sep 17 00:00:00 2001
From: David Daney <david.daney@cavium.com>
Date: Wed, 19 Nov 2014 14:55:03 -0800
Subject: [PATCH 030/184] netdev: octeon3-ethernet: Provide ndo_do_ioctl.

Source: Cavium Networks, Inc.
MR: 00000
Type: Integration
Disposition: Merged from Octeon Tree
ChangeID: c5b99c62e083d89c18bff8696a1250e61d952883
Description:

Signed-off-by: David Daney <david.daney@cavium.com>
Signed-off-by: Corey Minyard <cminyard@mvista.com>
[Original patch taken from octeon-linux-kernel-patches-SDK-3.1.2-release]
Signed-off-by: Yanjiang Jin <yanjiang.jin@windriver.com>
---
 drivers/net/ethernet/octeon/octeon-bgx-port.c  | 10 ++++++++++
 drivers/net/ethernet/octeon/octeon-bgx.h       |  1 +
 drivers/net/ethernet/octeon/octeon3-ethernet.c |  3 ++-
 3 files changed, 13 insertions(+), 1 deletion(-)

diff --git a/drivers/net/ethernet/octeon/octeon-bgx-port.c b/drivers/net/ethernet/octeon/octeon-bgx-port.c
index 9e331fe..a7a700c 100644
--- a/drivers/net/ethernet/octeon/octeon-bgx-port.c
+++ b/drivers/net/ethernet/octeon/octeon-bgx-port.c
@@ -133,6 +133,16 @@ const u8 *bgx_port_get_mac(struct net_device *netdev)
 }
 EXPORT_SYMBOL(bgx_port_get_mac);
 
+int bgx_port_do_ioctl(struct net_device *netdev, struct ifreq *ifr, int cmd)
+{
+	struct bgx_port_priv *p = bgx_port_netdev2priv(netdev);
+
+	if (p->phydev)
+		return phy_mii_ioctl(p->phydev, ifr, cmd);
+	return -EOPNOTSUPP;
+}
+EXPORT_SYMBOL(bgx_port_do_ioctl);
+
 static void bgx_port_write_cam(int numa_node, int interface, int index, int cam, const u8 *mac)
 {
 	int i;
diff --git a/drivers/net/ethernet/octeon/octeon-bgx.h b/drivers/net/ethernet/octeon/octeon-bgx.h
index a54ed9b..33f2e8c 100644
--- a/drivers/net/ethernet/octeon/octeon-bgx.h
+++ b/drivers/net/ethernet/octeon/octeon-bgx.h
@@ -50,6 +50,7 @@ int bgx_port_ethtool_get_settings(struct net_device *netdev,
 int bgx_port_ethtool_set_settings(struct net_device *netdev,
 				  struct ethtool_cmd *cmd);
 int bgx_port_ethtool_nway_reset(struct net_device *netdev);
+int bgx_port_do_ioctl(struct net_device *netdev, struct ifreq *ifr, int cmd);
 
 struct bgx_platform_data {
 	int numa_node;
diff --git a/drivers/net/ethernet/octeon/octeon3-ethernet.c b/drivers/net/ethernet/octeon/octeon3-ethernet.c
index 2278285..353e4e8 100644
--- a/drivers/net/ethernet/octeon/octeon3-ethernet.c
+++ b/drivers/net/ethernet/octeon/octeon3-ethernet.c
@@ -1966,7 +1966,8 @@ static const struct net_device_ops octeon3_eth_netdev_ops = {
 	.ndo_get_stats64	= octeon3_eth_ndo_get_stats64,
 	.ndo_set_rx_mode	= bgx_port_set_rx_filtering,
 	.ndo_set_mac_address	= octeon3_eth_set_mac_address,
-	.ndo_change_mtu		= bgx_port_change_mtu
+	.ndo_change_mtu		= bgx_port_change_mtu,
+	.ndo_do_ioctl		= bgx_port_do_ioctl,
 };
 
 static int octeon3_eth_probe(struct platform_device *pdev)
-- 
1.9.1

