From b07f4826b8ef4228faba41f232039dfd52f223f5 Mon Sep 17 00:00:00 2001
From: David Daney <david.daney@cavium.com>
Date: Wed, 16 Jul 2014 18:05:50 -0700
Subject: [PATCH 801/974] MIPS: OCTEON: Handle CONFIG_CAVIUM_GDB for CIU3.

OCTEON simulator was producing:

  pm_ciu.cpp:375  CIU: CSR write to CIU3_ISC(0x23), which is not present
  pm_ciu.cpp:375  Assertion '0' FAILED.

Signed-off-by: David Daney <david.daney@cavium.com>
[Original patch taken from Cavium SDK 3.1.2-568]
Signed-off-by: Quanyang Wang <quanyang.wang@windriver.com>
---
 arch/mips/cavium-octeon/serial.c | 4 +++-
 1 file changed, 3 insertions(+), 1 deletion(-)

diff --git a/arch/mips/cavium-octeon/serial.c b/arch/mips/cavium-octeon/serial.c
index a931d06..f338c7d 100644
--- a/arch/mips/cavium-octeon/serial.c
+++ b/arch/mips/cavium-octeon/serial.c
@@ -51,7 +51,9 @@ static int octeon_setup_debug_uart(void)
 	unsigned int hwirq;
 	int irq;
 
-	if (OCTEON_IS_MODEL(OCTEON_CN68XX))
+	if (octeon_has_feature(OCTEON_FEATURE_CIU3))
+		hwirq = 0x8000 + (0x40 * OCTEON_DEBUG_UART);
+	else if (OCTEON_IS_MODEL(OCTEON_CN68XX))
 		hwirq = (3 << 6) + 36 + OCTEON_DEBUG_UART;
 	else
 		hwirq = 34 + OCTEON_DEBUG_UART;
-- 
2.6.2

