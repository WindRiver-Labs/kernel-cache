From 0676679d02c40b8952f2041cf1802ae0810c76db Mon Sep 17 00:00:00 2001
From: Chandrakala Chavva <cchavva@caviumnetworks.com>
Date: Thu, 17 Jul 2014 18:05:50 -0700
Subject: [PATCH 906/974] MIPS:OCTEON: Sync-up SE files

Signed-off-by: Chandrakala Chavva <cchavva@caviumnetworks.com>
[Original patch taken from Cavium SDK 3.1.2-568]
Signed-off-by: Quanyang Wang <quanyang.wang@windriver.com>
---
 arch/mips/cavium-octeon/executive/cvmx-pcie.c | 12 +++++++-----
 1 file changed, 7 insertions(+), 5 deletions(-)

diff --git a/arch/mips/cavium-octeon/executive/cvmx-pcie.c b/arch/mips/cavium-octeon/executive/cvmx-pcie.c
index bbb5bff..81ff5e0 100644
--- a/arch/mips/cavium-octeon/executive/cvmx-pcie.c
+++ b/arch/mips/cavium-octeon/executive/cvmx-pcie.c
@@ -42,7 +42,7 @@
  *
  * Interface to PCIe as a host(RC) or target(EP)
  *
- * <hr>$Revision: 121833 $<hr>
+ * <hr>$Revision: 121858 $<hr>
  */
 #ifdef CVMX_BUILD_FOR_LINUX_KERNEL
 #include <asm/octeon/cvmx.h>
@@ -1463,12 +1463,14 @@ static int __cvmx_pcie_rc_initialize_gen2(int pcie_port)
 	}
 
 	/* No need to re-initialize if PCIe is already initialized */
-	if (OCTEON_IS_OCTEON3() && mio_rst_ctl.s.rst_done) {
+	if (OCTEON_IS_OCTEON3()) {
 		pciercx_cfg032.u32 = CVMX_PCIE_CFGX_READ(pcie_port,
 						CVMX_PCIERCX_CFG032(pcie_port));
-		cvmx_printf("%d:PCIe: Port %d link active, %d lanes, speed gen%d\n",
-			node, pcie_port, pciercx_cfg032.s.nlw, pciercx_cfg032.s.ls);
-		return 0;
+		if (pciercx_cfg032.s.dlla == 1 && pciercx_cfg032.s.lt == 0) {
+			cvmx_printf("%d:PCIe: Port %d link active, %d lanes, speed gen%d\n",
+				node, pcie_port, pciercx_cfg032.s.nlw, pciercx_cfg032.s.ls);
+			return 0;
+		}
 	}
 	
 #if 0
-- 
2.6.2

