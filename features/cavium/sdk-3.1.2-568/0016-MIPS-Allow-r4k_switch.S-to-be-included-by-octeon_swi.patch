From b49a662f03cb19e8ed5fd5d9d9ec419415519150 Mon Sep 17 00:00:00 2001
From: David Daney <david.daney@cavium.com>
Date: Mon, 28 Jan 2013 14:33:16 -0800
Subject: [PATCH 016/974] MIPS: Allow r4k_switch.S to be included by
 octeon_switch.S

The follow-on patch includes r4k_switch.S from octeon_switch.S, use
the preprocessor symbol USE_ALTERNATE_RESUME_IMPL to disable the parts
of r4k_switch.S that are unwanted (the resume function).

Signed-off-by: David Daney <david.daney@cavium.com>
[Original patch taken from Cavium SDK 3.1.2-568]
Signed-off-by: Quanyang Wang <quanyang.wang@windriver.com>
---
 arch/mips/kernel/r4k_switch.S | 3 +++
 1 file changed, 3 insertions(+)

diff --git a/arch/mips/kernel/r4k_switch.S b/arch/mips/kernel/r4k_switch.S
index 5e51219..19c4c28 100644
--- a/arch/mips/kernel/r4k_switch.S
+++ b/arch/mips/kernel/r4k_switch.S
@@ -28,6 +28,7 @@
  */
 #define ST_OFF (_THREAD_SIZE - 32 - PT_SIZE + PT_STATUS)
 
+#ifndef USE_ALTERNATE_RESUME_IMPL
 /*
  * FPU context is saved iff the process has used it's FPU in the current
  * time slice as indicated by _TIF_USEDFPU.  In any case, the CU1 bit for user
@@ -113,6 +114,8 @@
 	jr	ra
 	END(resume)
 
+#endif /* USE_ALTERNATE_RESUME_IMPL */
+
 /*
  * Save a thread's fp context.
  */
-- 
2.6.2

