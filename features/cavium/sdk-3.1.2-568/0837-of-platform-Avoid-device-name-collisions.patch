From bc09b36187fbf6f83a2093c5b57cbc2b7f84d6f7 Mon Sep 17 00:00:00 2001
From: David Daney <david.daney@cavium.com>
Date: Fri, 11 Jul 2014 18:05:50 -0700
Subject: [PATCH 837/974] of/platform: Avoid device name collisions.

If the device doesn't have a translatable address, it is possible to
get name space collisions if the address is used in the name.  Fall
back to the serial number approach in this case.

Signed-off-by: David Daney <david.daney@cavium.com>
[Original patch taken from Cavium SDK 3.1.2-568]
Signed-off-by: Quanyang Wang <quanyang.wang@windriver.com>
---
 drivers/of/platform.c | 10 +---------
 1 file changed, 1 insertion(+), 9 deletions(-)

diff --git a/drivers/of/platform.c b/drivers/of/platform.c
index e0a6514..ab87318 100644
--- a/drivers/of/platform.c
+++ b/drivers/of/platform.c
@@ -106,15 +106,7 @@ void of_device_make_bus_id(struct device *dev)
 	 */
 	reg = of_get_property(node, "reg", NULL);
 	if (reg) {
-		if (of_can_translate_address(node)) {
-			addr = of_translate_address(node, reg);
-		} else {
-			addrp = of_get_address(node, 0, NULL, NULL);
-			if (addrp)
-				addr = of_read_number(addrp, 1);
-			else
-				addr = OF_BAD_ADDR;
-		}
+		addr = of_translate_address(node, reg);
 		if (addr != OF_BAD_ADDR) {
 			dev_set_name(dev, "%llx.%s",
 				     (unsigned long long)addr, node->name);
-- 
2.6.2

