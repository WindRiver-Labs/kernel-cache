From 2b6f4abdca2102c1aec3f7f4665a0f95f010bc71 Mon Sep 17 00:00:00 2001
From: David Daney <david.daney@cavium.com>
Date: Tue, 15 Jul 2014 18:05:50 -0700
Subject: [PATCH 799/974] MIPS: OCTEON: Print WARN() message if too few CPUs
 are configured.

Signed-off-by: David Daney <david.daney@cavium.com>
[Original patch taken from Cavium SDK 3.1.2-568]
Signed-off-by: Quanyang Wang <quanyang.wang@windriver.com>
---
 arch/mips/cavium-octeon/smp.c | 6 ++++++
 1 file changed, 6 insertions(+)

diff --git a/arch/mips/cavium-octeon/smp.c b/arch/mips/cavium-octeon/smp.c
index cc9ce9ef..17b5610 100644
--- a/arch/mips/cavium-octeon/smp.c
+++ b/arch/mips/cavium-octeon/smp.c
@@ -325,6 +325,12 @@ static void octeon_smp_finish(void)
  */
 static void octeon_cpus_done(void)
 {
+	struct cvmx_sysinfo *sysinfo = cvmx_sysinfo_get();
+	int cpus_in_coremask = cvmx_coremask_get_core_count(&sysinfo->core_mask);
+
+	WARN(cpus_in_coremask > setup_max_cpus,
+	     "Error: %d CPUs in coremask, but kernel configured for only %d\n",
+	     cpus_in_coremask, setup_max_cpus);
 }
 
 #ifdef CONFIG_HOTPLUG_CPU
-- 
2.6.2

