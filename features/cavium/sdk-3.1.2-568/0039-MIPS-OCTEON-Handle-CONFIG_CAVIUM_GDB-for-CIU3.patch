From 6a088a5088160e4bbc662b49adffef5d906e3b35 Mon Sep 17 00:00:00 2001
From: David Daney <david.daney@cavium.com>
Date: Tue, 16 Dec 2014 09:56:52 -0800
Subject: [PATCH 039/184] MIPS: OCTEON: Handle CONFIG_CAVIUM_GDB for CIU3.

Source: Cavium Networks, Inc.
MR: 00000
Type: Integration
Disposition: Merged from Octeon Tree
ChangeID: 5c6654ff27fdab7d96c3c71262e07fc5d62b0d20
Description:

OCTEON simulator was producing:

  pm_ciu.cpp:375  CIU: CSR write to CIU3_ISC(0x23), which is not present
  pm_ciu.cpp:375  Assertion '0' FAILED.

Signed-off-by: David Daney <david.daney@cavium.com>
Signed-off-by: Corey Minyard <cminyard@mvista.com>
[Original patch taken from octeon-linux-kernel-patches-SDK-3.1.2-release]
Signed-off-by: Yanjiang Jin <yanjiang.jin@windriver.com>
---
 arch/mips/cavium-octeon/serial.c | 4 +++-
 1 file changed, 3 insertions(+), 1 deletion(-)

diff --git a/arch/mips/cavium-octeon/serial.c b/arch/mips/cavium-octeon/serial.c
index a931d06..f338c7d 100644
--- a/arch/mips/cavium-octeon/serial.c
+++ b/arch/mips/cavium-octeon/serial.c
@@ -51,7 +51,9 @@ static int octeon_setup_debug_uart(void)
 	unsigned int hwirq;
 	int irq;
 
-	if (OCTEON_IS_MODEL(OCTEON_CN68XX))
+	if (octeon_has_feature(OCTEON_FEATURE_CIU3))
+		hwirq = 0x8000 + (0x40 * OCTEON_DEBUG_UART);
+	else if (OCTEON_IS_MODEL(OCTEON_CN68XX))
 		hwirq = (3 << 6) + 36 + OCTEON_DEBUG_UART;
 	else
 		hwirq = 34 + OCTEON_DEBUG_UART;
-- 
1.9.1

