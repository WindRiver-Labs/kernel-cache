From 054452c3124b6d82b525958b94e7e6abcefdb141 Mon Sep 17 00:00:00 2001
From: Peter Swain <pswain@cavium.com>
Date: Tue, 29 Jul 2014 18:05:50 -0700
Subject: [PATCH 934/974] mips: octeon_mmc: work around legacy u-boot device
 trees

Upcoming fixes to octeon ciu3 irq processing will break mmc driver
unless IRQs for 73/75/78xx processors are correctly marked edge-triggered.

Fix to allow deployment of new kernels with legacy u-boot images.

Signed-off-by: Peter Swain <pswain@cavium.com>
[Original patch taken from Cavium SDK 3.1.2-568]
Signed-off-by: Quanyang Wang <quanyang.wang@windriver.com>
---
 drivers/mmc/host/octeon_mmc.c | 3 +++
 1 file changed, 3 insertions(+)

diff --git a/drivers/mmc/host/octeon_mmc.c b/drivers/mmc/host/octeon_mmc.c
index 1c697be..4faf841 100644
--- a/drivers/mmc/host/octeon_mmc.c
+++ b/drivers/mmc/host/octeon_mmc.c
@@ -1162,6 +1162,9 @@ static int octeon_mmc_probe(struct platform_device *pdev)
 			mmc_irq[i] = platform_get_irq(pdev, i);
 			if (mmc_irq[i] < 0)
 				return mmc_irq[i];
+
+			/* work around legacy u-boot device trees */
+			irq_set_irq_type(mmc_irq[i], IRQ_TYPE_EDGE_RISING);
 		}
 	} else {
 		host->need_bootbus_lock = true;
-- 
2.6.2

