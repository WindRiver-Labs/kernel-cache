From 0ae8b452a3dfd722978e520794e8bb3ec45ca621 Mon Sep 17 00:00:00 2001
From: Quanyang Wang <quanyang.wang@windriver.com>
Date: Mon, 28 Dec 2015 14:55:05 +0800
Subject: [PATCH] cav-octeon3: use cvmx_cpu_to_be64 instead of gcc built-in
 function "__builtin_bswap64"

Because the gcc doesn't support built-in function "__builtin_bswap64", so use
cvmx_cpu_to_be64 to take place of it. Or else will occurr compile error as below:

arch/mips/built-in.o: In function `cvmx_wqe_pki_errata_20776':
arch/mips/include/asm/octeon/cvmx-wqe.h:1612: undefined reference to `__bswapdi2'

Signed-off-by: Quanyang Wang <quanyang.wang@windriver.com>
---
 arch/mips/include/asm/octeon/cvmx-wqe.h | 5 +++--
 1 file changed, 3 insertions(+), 2 deletions(-)

diff --git a/arch/mips/include/asm/octeon/cvmx-wqe.h b/arch/mips/include/asm/octeon/cvmx-wqe.h
index faca8c7..d077b80 100644
--- a/arch/mips/include/asm/octeon/cvmx-wqe.h
+++ b/arch/mips/include/asm/octeon/cvmx-wqe.h
@@ -56,6 +56,7 @@
 
 #include "cvmx-pki-defs.h"
 #include "cvmx-pip-defs.h"
+#include "cvmx-swap.h"
 
 #ifdef	__cplusplus
 /* *INDENT-OFF* */
@@ -1609,7 +1610,7 @@ static inline void cvmx_wqe_pki_errata_20776(cvmx_wqe_t *work)
 			cvmx_buf_ptr_pki_t next;
 			void *nextaddr = cvmx_phys_to_ptr(buffer_next.addr - 8);
 			memcpy (&next, nextaddr, sizeof(next));
-			next.u64 = __builtin_bswap64(next.u64);
+			next.u64 = cvmx_cpu_to_be64(next.u64);
 			memcpy (nextaddr, &next, sizeof(next));
 			buffer_next = next;
 			bufs--;
@@ -1638,7 +1639,7 @@ static inline void cvmx_wqe_pko_errata_22235(cvmx_buf_ptr_pki_t packet_ptr, unsi
 			buffer_next.u64 = *(unsigned long long*)(nextaddr);
 			total_len += buffer_next.size;
 			memcpy(&next, nextaddr, sizeof(next));
-			next.u64 = __builtin_bswap64(next.u64);
+			next.u64 = cvmx_cpu_to_be64(next.u64);
 			memcpy(nextaddr, &next, sizeof(next));
 		}
 	}
-- 
1.9.1

