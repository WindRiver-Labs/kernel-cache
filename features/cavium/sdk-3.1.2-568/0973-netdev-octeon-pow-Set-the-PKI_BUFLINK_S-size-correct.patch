From 23dd42703b3aa61fddee7d02314f9f5f2e688877 Mon Sep 17 00:00:00 2001
From: Carlos Munoz <cmunoz@caviumnetworks.com>
Date: Mon, 16 Nov 2015 15:15:04 -0800
Subject: [PATCH 973/974] netdev: octeon-pow: Set the PKI_BUFLINK_S size
 correctly.

Signed-off-by: Carlos Munoz <cmunoz@caviumnetworks.com>
[Original patch taken from Cavium SDK 3.1.2-568]
Signed-off-by: Quanyang Wang <quanyang.wang@windriver.com>
---
 drivers/net/ethernet/octeon/octeon-pow-ethernet.c | 5 ++---
 1 file changed, 2 insertions(+), 3 deletions(-)

diff --git a/drivers/net/ethernet/octeon/octeon-pow-ethernet.c b/drivers/net/ethernet/octeon/octeon-pow-ethernet.c
index 49a23c9..d043917 100644
--- a/drivers/net/ethernet/octeon/octeon-pow-ethernet.c
+++ b/drivers/net/ethernet/octeon/octeon-pow-ethernet.c
@@ -295,13 +295,12 @@ static cvmx_wqe_t *octeon_skb_to_fpa_buf(struct net_device *dev,
 		/* We need to leave 8 bytes for the next pointer */
 		copy_location = packet_ptr + sizeof(uint64_t);
 		segment_len -= sizeof(uint64_t);
+		octeon_packet_ptr_init(packet_ptr, copy_location,
+				       segment_len);
 		if (segment_len > len)
 			segment_len = len;
 		octeon_pow_copy_to(copy_location, data_ptr, segment_len);
 
-		octeon_packet_ptr_init(packet_ptr, copy_location,
-				       segment_len);
-
 		if (first_segment) {
 			if (octeon_has_feature(OCTEON_FEATURE_CN78XX_WQE)) {
 				cvmx_wqe_78xx_t *wqe = (cvmx_wqe_78xx_t *)work;
-- 
2.6.2

