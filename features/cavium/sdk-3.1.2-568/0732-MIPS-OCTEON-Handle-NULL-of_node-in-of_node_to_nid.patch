From 8cb4e55b83464d640ff349ad65a133a84ba6ff2e Mon Sep 17 00:00:00 2001
From: David Daney <david.daney@cavium.com>
Date: Wed, 30 Jul 2014 18:05:50 -0700
Subject: [PATCH 732/974] MIPS: OCTEON: Handle NULL of_node in
 of_node_to_nid().

If there is no of_node, just say it is on node 0.

Signed-off-by: David Daney <david.daney@cavium.com>
[Original patch taken from Cavium SDK 3.1.2-568]
Signed-off-by: Quanyang Wang <quanyang.wang@windriver.com>
---
 arch/mips/cavium-octeon/octeon-numa.c | 6 +++++-
 1 file changed, 5 insertions(+), 1 deletion(-)

diff --git a/arch/mips/cavium-octeon/octeon-numa.c b/arch/mips/cavium-octeon/octeon-numa.c
index 5c3dc1a..e992dc6 100644
--- a/arch/mips/cavium-octeon/octeon-numa.c
+++ b/arch/mips/cavium-octeon/octeon-numa.c
@@ -110,8 +110,12 @@ void __init mem_init(void)
 int of_node_to_nid(struct device_node *np)
 {
 	int ret = 0;
-	struct device_node *node = of_node_get(np);
+	struct device_node *node;
 
+	if (!np)
+		return 0;
+
+	node = of_node_get(np);
 	do {
 		if (strcmp("soc", node->name) == 0) {
 			int rc;
-- 
2.6.2

