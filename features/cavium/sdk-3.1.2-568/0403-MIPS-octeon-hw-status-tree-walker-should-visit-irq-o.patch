From 4e051a20f81c82095211f7729e491981b587ab4e Mon Sep 17 00:00:00 2001
From: Peter Swain <peter.swain@cavium.com>
Date: Mon, 11 Nov 2013 14:24:20 -0800
Subject: [PATCH 403/974] MIPS: octeon-hw-status tree-walker should visit irq
 objects

visit_leaves() with visit_sibs=true did not walk the root irq nodes.
Now it does, so /sys/kernel/debug/hwstat sees everything
[Original patch taken from Cavium SDK 3.1.2-568]
Signed-off-by: Quanyang Wang <quanyang.wang@windriver.com>
---
 arch/mips/cavium-octeon/octeon-hw-status.c | 7 +++++++
 1 file changed, 7 insertions(+)

diff --git a/arch/mips/cavium-octeon/octeon-hw-status.c b/arch/mips/cavium-octeon/octeon-hw-status.c
index b4aa280..ba0f9df 100644
--- a/arch/mips/cavium-octeon/octeon-hw-status.c
+++ b/arch/mips/cavium-octeon/octeon-hw-status.c
@@ -60,9 +60,16 @@ static int visit_leaves(struct octeon_hw_status_node *s, bool visit_sibs,
 {
 	int depth = 0;
 	struct octeon_hw_status_node *w = s;
+	bool visit_roots = visit_sibs; /* should they ever differ? bitmask? */
 	int r;
 
 	while (w && depth >= 0) {
+		if (visit_roots && !depth) {
+			r = cb(w, arg);
+			if (r)
+				return r;
+		}
+
 		if (w->child) {
 			/* Go out to the leaves */
 			w = w->child;
-- 
2.6.2

