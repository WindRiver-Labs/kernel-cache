From 9a082b6256827e76d60536ba7c43914bbec2b8cb Mon Sep 17 00:00:00 2001
From: David Daney <david.daney@cavium.com>
Date: Wed, 4 Mar 2015 15:10:28 -0800
Subject: [PATCH 091/184] netdev: octeon-mgmt: Add ethtool_ops for cn78XX mode.

Source: Cavium Networks, Inc.
MR: 00000
Type: Integration
Disposition: Merged from Octeon Tree
ChangeID: b047583816196209f2316f8921cfacca9cb6916d
Description:

Signed-off-by: David Daney <david.daney@cavium.com>
Signed-off-by: Corey Minyard <cminyard@mvista.com>
[Original patch taken from octeon-linux-kernel-patches-SDK-3.1.2-release]
Signed-off-by: Yanjiang Jin <yanjiang.jin@windriver.com>
---
 drivers/net/ethernet/octeon/octeon_mgmt.c | 11 ++++++++++-
 1 file changed, 10 insertions(+), 1 deletion(-)

diff --git a/drivers/net/ethernet/octeon/octeon_mgmt.c b/drivers/net/ethernet/octeon/octeon_mgmt.c
index f7cb27d..74dec91 100644
--- a/drivers/net/ethernet/octeon/octeon_mgmt.c
+++ b/drivers/net/ethernet/octeon/octeon_mgmt.c
@@ -1537,6 +1537,14 @@ static const struct net_device_ops octeon_mgmt_ops = {
 #endif
 };
 
+static const struct ethtool_ops octeon_mgmt_o3_ethtool_ops = {
+	.get_drvinfo = octeon_mgmt_get_drvinfo,
+	.get_settings = bgx_port_ethtool_get_settings,
+	.set_settings = bgx_port_ethtool_set_settings,
+	.nway_reset = bgx_port_ethtool_nway_reset,
+	.get_link = ethtool_op_get_link,
+};
+
 static const struct net_device_ops octeon_mgmt_o3_ops = {
 	.ndo_init		= octeon_mgmt_o3_init,
 	.ndo_open		= octeon_mgmt_o3_open,
@@ -1638,6 +1646,7 @@ static int octeon_mgmt_o3_probe(struct platform_device *pdev)
 	p->port = pd->port;
 	p->numa_node = pd->numa_node;
 	netdev->netdev_ops = &octeon_mgmt_o3_ops;
+	SET_ETHTOOL_OPS(netdev, &octeon_mgmt_o3_ethtool_ops);
 
 	p->mix_phys = 0x1070000100000ull + 0x800 * p->port + (1ull << 36) * p->numa_node;
 	p->mix_size = 0x100;
@@ -1767,7 +1776,7 @@ static int octeon_mgmt_probe(struct platform_device *pdev)
 	p->agl_prt_ctl = (u64)devm_ioremap(&pdev->dev, p->agl_prt_ctl_phys,
 					   p->agl_prt_ctl_size);
 	netdev->netdev_ops = &octeon_mgmt_ops;
-	netdev->ethtool_ops = &octeon_mgmt_ethtool_ops;
+	SET_ETHTOOL_OPS(netdev, &octeon_mgmt_ethtool_ops);
 
 	mac = of_get_mac_address(pdev->dev.of_node);
 
-- 
1.9.1

