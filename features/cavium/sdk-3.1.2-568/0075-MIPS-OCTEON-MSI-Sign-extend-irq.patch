From 13749c74baf45f2fa0a9d1e0e8b2900076528b2f Mon Sep 17 00:00:00 2001
From: Chandrakala Chavva <cchavva@caviumnetworks.com>
Date: Thu, 6 Jun 2013 16:08:22 -0700
Subject: [PATCH 075/974] MIPS: OCTEON/MSI: Sign extend irq.

Sign extend the irq to set the mask properly and to teardown
the correct interrupt.

Signed-off-by: Chandrakala Chavva <cchavva@caviumnetworks.com>
[Original patch taken from Cavium SDK 3.1.2-568]
Signed-off-by: Quanyang Wang <quanyang.wang@windriver.com>
---
 arch/mips/pci/msi-octeon.c | 4 ++--
 1 file changed, 2 insertions(+), 2 deletions(-)

diff --git a/arch/mips/pci/msi-octeon.c b/arch/mips/pci/msi-octeon.c
index 0165b14..1ec3656 100644
--- a/arch/mips/pci/msi-octeon.c
+++ b/arch/mips/pci/msi-octeon.c
@@ -112,7 +112,7 @@ try_only_one:
 	irq_step = 1 << request_private_bits;
 
 	/* Mask with one bit for each IRQ */
-	search_mask = (1 << irq_step) - 1;
+	search_mask = (1ull << irq_step) - 1;
 
 	/*
 	 * We're going to search msi_free_irq_bitmask_lock for zero
@@ -248,7 +248,7 @@ void arch_teardown_msi_irq(unsigned int irq)
 		number_irqs++;
 	number_irqs++;
 	/* Mask with one bit for each IRQ */
-	bitmask = (1 << number_irqs) - 1;
+	bitmask = (1ull << number_irqs) - 1;
 	/* Shift the mask to the correct bit location */
 	bitmask <<= irq0;
 	if ((msi_free_irq_bitmask[index] & bitmask) != bitmask)
-- 
2.6.2

