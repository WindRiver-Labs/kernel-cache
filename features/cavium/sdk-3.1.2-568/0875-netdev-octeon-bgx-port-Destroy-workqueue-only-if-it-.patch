From 35eb4cc63b26673b7a8eb4707b88da4a2fd84e03 Mon Sep 17 00:00:00 2001
From: Carlos Munoz <cmunoz@caviumnetworks.com>
Date: Sat, 12 Jul 2014 18:05:50 -0700
Subject: [PATCH 875/974] netdev: octeon-bgx-port: Destroy workqueue only if it
 had been created.

Signed-off-by: Carlos Munoz <cmunoz@caviumnetworks.com>
[Original patch taken from Cavium SDK 3.1.2-568]
Signed-off-by: Quanyang Wang <quanyang.wang@windriver.com>
---
 drivers/net/ethernet/octeon/octeon-bgx-port.c | 3 ++-
 1 file changed, 2 insertions(+), 1 deletion(-)

diff --git a/drivers/net/ethernet/octeon/octeon-bgx-port.c b/drivers/net/ethernet/octeon/octeon-bgx-port.c
index f43cad4..59c1395 100644
--- a/drivers/net/ethernet/octeon/octeon-bgx-port.c
+++ b/drivers/net/ethernet/octeon/octeon-bgx-port.c
@@ -570,7 +570,8 @@ module_init(bgx_port_driver_init);
 static void __exit bgx_port_driver_exit(void)
 {
 	platform_driver_unregister(&bgx_port_driver);
-	destroy_workqueue(check_state_wq);
+	if (check_state_wq)
+		destroy_workqueue(check_state_wq);
 }
 module_exit(bgx_port_driver_exit);
 
-- 
2.6.2

