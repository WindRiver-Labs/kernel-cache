From efab7b8b8c5c49cb7d2a88c15f1c35d9b79c4f59 Mon Sep 17 00:00:00 2001
From: Andreas Herrmann <andreas.herrmann@caviumnetworks.com>
Date: Sat, 19 Jul 2014 18:05:50 -0700
Subject: [PATCH 682/974] MIPS: paravirt: Fix build error

arch/mips/built-in.o: In function `do_ade':
/home/reasand/projects/repos/cavium/linux-base/trunk/kernel/linux-octeon-sdk/arch/mips/kernel/unaligned.c:1644: undefined reference to `octeon_cvmseg_lines'
/home/reasand/projects/repos/cavium/linux-base/trunk/kernel/linux-octeon-sdk/arch/mips/kernel/unaligned.c:1644: undefined reference to `octeon_cvmseg_lines'
/home/reasand/projects/repos/cavium/linux-base/trunk/kernel/linux-octeon-sdk/arch/mips/kernel/unaligned.c:1659: undefined reference to `octeon_cvmseg_lines'
/home/reasand/projects/repos/cavium/linux-base/trunk/kernel/linux-octeon-sdk/arch/mips/kernel/unaligned.c:1662: undefined reference to `octeon_cvmseg_lines'
/home/reasand/projects/repos/cavium/linux-base/trunk/kernel/linux-octeon-sdk/arch/mips/kernel/unaligned.c:1662: undefined reference to `octeon_cvmseg_lines'

when kernel is built with CONFIG_MIPS_PARAVIRT=y.

Move definition of octeon_cvmseg_lines from
arch/mips/cavium-octeon/setup.c to arch/mips/kernel/unaligned.c to fix
this.

Signed-off-by: Andreas Herrmann <andreas.herrmann@caviumnetworks.com>
[Original patch taken from Cavium SDK 3.1.2-568]
Signed-off-by: Quanyang Wang <quanyang.wang@windriver.com>
---
 arch/mips/cavium-octeon/setup.c | 6 ------
 arch/mips/kernel/unaligned.c    | 5 +++++
 2 files changed, 5 insertions(+), 6 deletions(-)

diff --git a/arch/mips/cavium-octeon/setup.c b/arch/mips/cavium-octeon/setup.c
index 8792f90..febb80e 100644
--- a/arch/mips/cavium-octeon/setup.c
+++ b/arch/mips/cavium-octeon/setup.c
@@ -52,12 +52,6 @@
 static unsigned long long MAX_MEMORY = 512ull << 20;
 static const unsigned long MIN_MEM_32 = 256 << 20;
 
-/*
- * modified in hernel-entry-init.h, must have an initial value to keep
- * it from being clobbered when bss is zeroed.
- */
-u32 octeon_cvmseg_lines = 2;
-
 DEFINE_SEMAPHORE(octeon_bootbus_sem);
 EXPORT_SYMBOL(octeon_bootbus_sem);
 
diff --git a/arch/mips/kernel/unaligned.c b/arch/mips/kernel/unaligned.c
index d99a93f..5ed5b1a 100644
--- a/arch/mips/kernel/unaligned.c
+++ b/arch/mips/kernel/unaligned.c
@@ -1619,6 +1619,11 @@ sigill:
 }
 #ifdef CONFIG_CPU_CAVIUM_OCTEON
 #include <asm/octeon/octeon.h>
+/*
+ * modified in kernel-entry-init.h, must have an initial value to keep
+ * it from being clobbered when bss is zeroed.
+ */
+u32 octeon_cvmseg_lines = 2;
 #endif
 asmlinkage void do_ade(struct pt_regs *regs)
 {
-- 
2.6.2

