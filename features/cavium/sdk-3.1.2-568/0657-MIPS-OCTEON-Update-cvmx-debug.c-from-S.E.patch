From c6dc4091b7f2be6ff28edb25e55641c2b00bf2a3 Mon Sep 17 00:00:00 2001
From: David Daney <david.daney@cavium.com>
Date: Sun, 27 Jul 2014 18:05:50 -0700
Subject: [PATCH 657/974] MIPS: OCTEON: Update cvmx-debug.c from S.E.

Signed-off-by: David Daney <david.daney@cavium.com>
[Original patch taken from Cavium SDK 3.1.2-568]
Signed-off-by: Quanyang Wang <quanyang.wang@windriver.com>
---
 arch/mips/cavium-octeon/executive/cvmx-debug.c | 17 +++--------------
 1 file changed, 3 insertions(+), 14 deletions(-)

diff --git a/arch/mips/cavium-octeon/executive/cvmx-debug.c b/arch/mips/cavium-octeon/executive/cvmx-debug.c
index d10a37c..756599c 100644
--- a/arch/mips/cavium-octeon/executive/cvmx-debug.c
+++ b/arch/mips/cavium-octeon/executive/cvmx-debug.c
@@ -73,6 +73,8 @@
 #define CVMX_DEBUG_LOGGING 0
 #endif
 
+#define cvmx_debug_printf(...) do { if (CVMX_DEBUG_LOGGING) cvmx_dprintf(__VA_ARGS__); } while(0)
+
 #ifndef CVMX_DEBUG_ATTACH
 #define CVMX_DEBUG_ATTACH 1
 #endif
@@ -225,19 +227,6 @@ static inline void cvmx_debug_get_state(cvmx_debug_state_t *state)
 	cvmx_debug_memcpy_align(state, cvmx_debug_globals->state, sizeof(cvmx_debug_state_t));
 }
 
-static void cvmx_debug_printf(char *format, ...) __attribute__ ((format(__printf__, 1, 2)));
-static void cvmx_debug_printf(char *format, ...)
-{
-	va_list ap;
-
-	if (!CVMX_DEBUG_LOGGING)
-		return;
-
-	va_start(ap, format);
-	cvmx_dvprintf(format, ap);
-	va_end(ap);
-}
-
 static inline int __cvmx_debug_in_focus(cvmx_debug_state_t *state, unsigned core)
 {
 	return state->focus_core == core;
@@ -294,7 +283,7 @@ static void cvmx_debug_init_globals(void)
 	ptr = cvmx_bootmem_alloc_named_range_once(
 			sizeof(cvmx_debug_globals_t), 
 			0,	/* min addr */
-			0,	/* max addr */
+			1ull<<29,	/* max addr */
 			8,	/* align */
 			CVMX_DEBUG_GLOBALS_BLOCK_NAME,	/* name */
 			cvmx_debug_init_global_ptr);	/* init func */
-- 
2.6.2

