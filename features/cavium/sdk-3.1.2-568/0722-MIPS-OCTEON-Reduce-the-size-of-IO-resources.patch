From bf8f2b687061485f9b36853b6cdbb844ebc41f75 Mon Sep 17 00:00:00 2001
From: Chandrakala Chavva <cchavva@caviumnetworks.com>
Date: Thu, 17 Jul 2014 18:05:50 -0700
Subject: [PATCH 722/974] MIPS:OCTEON: Reduce the size of IO resources

Reduce the size of io_resource start and end address.

Bug #11563

Signed-off-by: Chandrakala Chavva <cchavva@caviumnetworks.com>
[Original patch taken from Cavium SDK 3.1.2-568]
Signed-off-by: Quanyang Wang <quanyang.wang@windriver.com>
---
 arch/mips/pci/pcie-octeon.c | 8 ++++----
 1 file changed, 4 insertions(+), 4 deletions(-)

diff --git a/arch/mips/pci/pcie-octeon.c b/arch/mips/pci/pcie-octeon.c
index f74d85a..8784a14 100644
--- a/arch/mips/pci/pcie-octeon.c
+++ b/arch/mips/pci/pcie-octeon.c
@@ -576,7 +576,8 @@ static int __init octeon_pcie_setup(void)
 	set_io_port_base(CVMX_ADD_IO_SEG(cvmx_pcie_get_io_base_address(0)));
 	ioport_resource.start = 0;
 	ioport_resource.end =
-		(cvmx_pcie_get_io_size(0) * CVMX_PCIE_PORTS) - 1;
+		cvmx_pcie_get_io_base_address(CVMX_PCIE_PORTS-1) -
+		cvmx_pcie_get_io_base_address(0) + (1ull << 34) - 1;
 
 	/*
 	 * Create a dummy PCIe controller to swallow up bus 0. IDT bridges
@@ -679,10 +680,9 @@ static int __init octeon_pcie_setup(void)
 					octeon_pcie[port].io.end = cvmx_pcie_get_io_size(port) - 1;
 				} else {
 					octeon_pcie[port].controller.io_offset =
-						cvmx_pcie_get_io_base_address(port) - cvmx_pcie_get_io_base_address(port - 1);
 					octeon_pcie[port].io.start =
-						cvmx_pcie_get_io_base_address(port) & ((1ull << 34) - 1);
-					octeon_pcie[port].io.end = octeon_pcie[port].io.start + cvmx_pcie_get_io_size(port) - 1;
+						(cvmx_pcie_get_io_base_address(port) & ((1ull << 34) - 1)) + (1ull << 20);
+					octeon_pcie[port].io.end = octeon_pcie[port].io.start + (1ull << 20);
 				}
 				msleep(100); /* Some devices need extra time */
 				octeon_pcie[port].controller.index = port;
-- 
2.6.2

