From 0d98489fa2d6be3ca6c3c0a7cd98658e56a462a2 Mon Sep 17 00:00:00 2001
From: Chandrakala Chavva <cchavva@caviumnetworks.com>
Date: Tue, 4 Feb 2014 19:10:44 -0800
Subject: [PATCH 443/974] # HG changeset patch # User Ronny Meeus
 <ronny.meeus@alcatel-lucent.com> # Date 1386156030 -3600 # Wed Dec 04
 12:20:30 2013 +0100 # Node ID 2ba522e9bb1949c61327c3cca0afedb7c09a3702 #
 Parent b1603c6392f81b0537b97ded34f5c6c685886260 alu change: NAND driver:
 disable subpage reads

Disable subpage support in the Octeon NAND driver, as it is
not properly supported. Subpage support is assumed by
nand_base.c for all large-page NAND flashes that use soft
ECC.
Without this change, UBI/UBIFS does not correctly work.

Signed-off-by: Chandrakala Chavva <cchavva@caviumnetworks.com>
[Original patch taken from Cavium SDK 3.1.2-568]
Signed-off-by: Quanyang Wang <quanyang.wang@windriver.com>
---
 arch/mips/cavium-octeon/octeon-nand.c | 7 +++++++
 1 file changed, 7 insertions(+)

diff --git a/arch/mips/cavium-octeon/octeon-nand.c b/arch/mips/cavium-octeon/octeon-nand.c
index 4aefa51..8a8db46 100644
--- a/arch/mips/cavium-octeon/octeon-nand.c
+++ b/arch/mips/cavium-octeon/octeon-nand.c
@@ -1226,6 +1226,13 @@ static int octeon_nand_probe(struct platform_device *pdev)
 			return -ENXIO;
 		}
 
+		/* Disable subpage support, as it is not properly supported
+		 * in this octeon-nand driver. Subpage support is assumed by
+		 * nand_base.c for all large-page NAND flashes that use soft
+		 * ECC.
+		 */
+		priv->nand.options &= ~NAND_SUBPAGE_READ;
+
 		/* We need to override the name, as the default names
 		 * have spaces in them, and this prevents the passing
 		 * of partitioning information on the kernel command line.
-- 
2.6.2

