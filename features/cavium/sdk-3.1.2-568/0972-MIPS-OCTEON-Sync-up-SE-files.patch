From 2a1a574df046229b2e28e9ee551f7cd571034902 Mon Sep 17 00:00:00 2001
From: Chandrakala Chavva <cchavva@caviumnetworks.com>
Date: Sun, 15 Nov 2015 21:24:35 -0800
Subject: [PATCH 972/974] MIPS:OCTEON: Sync-up SE files

 - Revert changes made to cvmx-bootmem.h, failing to boot LE kernel
 - Sync-up cvmx-ila.c file.

Signed-off-by: Chandrakala Chavva <cchavva@caviumnetworks.com>
[Original patch taken from Cavium SDK 3.1.2-568]
Signed-off-by: Quanyang Wang <quanyang.wang@windriver.com>
---
 arch/mips/cavium-octeon/executive/cvmx-ila.c | 10 +++++++++-
 arch/mips/include/asm/octeon/cvmx-bootmem.h  | 15 +++++++++++++++
 2 files changed, 24 insertions(+), 1 deletion(-)

diff --git a/arch/mips/cavium-octeon/executive/cvmx-ila.c b/arch/mips/cavium-octeon/executive/cvmx-ila.c
index 1401a0c..9c817f12 100644
--- a/arch/mips/cavium-octeon/executive/cvmx-ila.c
+++ b/arch/mips/cavium-octeon/executive/cvmx-ila.c
@@ -169,8 +169,10 @@ retry:
 	}
 
 #ifdef CVMX_BUILD_FOR_LINUX_KERNEL
+#ifdef  CONFIG_CAVIUM_OCTEON_ERROR_TREE
 	/* Enable error interrupts, now link is up */
 	octeon_error3_tree_enable(CVMX_ERROR_GROUP_ILA, 0);
+#endif
 #else
 	/* Enable error interrupts, now link is up */
 	cvmx_error_enable_group(CVMX_ERROR_GROUP_ILA, 0);
@@ -191,8 +193,10 @@ fail:
 		cvmx_write_csr_node(node, CVMX_ILA_RXX_CFG1(0), rx_cfg1.u64);
 
 #ifdef CVMX_BUILD_FOR_LINUX_KERNEL
+#ifdef  CONFIG_CAVIUM_OCTEON_ERROR_TREE
 		/* Disable error interrupts */
 		octeon_error3_tree_disable(CVMX_ERROR_GROUP_ILA, 0);
+#endif
 #else
 		/* Disable error interrupts */
 		cvmx_error_disable_group(CVMX_ERROR_GROUP_ILA, 0);
@@ -227,9 +231,13 @@ int cvmx_ila_initialize(int lane_mask)
 		ser_cfg.s.ser_reset_n = lane_mask;
 		cvmx_write_csr_node(node, CVMX_ILA_SER_CFG, ser_cfg.u64);
 	}
-#ifndef CVMX_BUILD_FOR_LINUX_KERNEL
 	/* Disable all error interrupts, enable after the interface is up. */
 	if (lane_mask)
+#ifdef CVMX_BUILD_FOR_LINUX_KERNEL
+#ifdef  CONFIG_CAVIUM_OCTEON_ERROR_TREE
+		octeon_error3_tree_disable(CVMX_ERROR_GROUP_ILA, 0);
+#endif
+#else
 		cvmx_error_disable_group(CVMX_ERROR_GROUP_ILA, 0);
 #endif
 
diff --git a/arch/mips/include/asm/octeon/cvmx-bootmem.h b/arch/mips/include/asm/octeon/cvmx-bootmem.h
index 7a748e0..927ee0a 100644
--- a/arch/mips/include/asm/octeon/cvmx-bootmem.h
+++ b/arch/mips/include/asm/octeon/cvmx-bootmem.h
@@ -126,6 +126,7 @@ typedef struct cvmx_bootmem_named_block_desc cvmx_bootmem_named_block_desc_t;
 */
 typedef struct {
 	/* Linux compatible proxy for __BIG_ENDIAN */
+#if defined(__BIG_ENDIAN_BITFIELD) || defined(CVMX_BUILD_FOR_LINUX_HOST)
 	uint32_t lock;
 			    /**< spinlock to control access to list */
 	uint32_t flags;
@@ -145,6 +146,20 @@ typedef struct {
 					 /**< length of name array in bootmem blocks */
 	uint64_t named_block_array_addr;
 					 /**< address of named memory block descriptors */
+#else				/* __LITTLE_ENDIAN */
+	uint32_t flags;
+	uint32_t lock;
+	uint64_t head_addr;
+
+	uint32_t minor_version;
+	uint32_t major_version;
+	uint64_t app_data_addr;
+	uint64_t app_data_size;
+
+	uint32_t named_block_name_len;
+	uint32_t named_block_num_blocks;
+	uint64_t named_block_array_addr;
+#endif
 } cvmx_bootmem_desc_t;
 
 /**
-- 
2.6.2

