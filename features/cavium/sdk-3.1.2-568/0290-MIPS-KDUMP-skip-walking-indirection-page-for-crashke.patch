From fca7a2a83d46be82746f7e8097df4e6790623481 Mon Sep 17 00:00:00 2001
From: Prem Mallappa <prem.mallappa@gmail.com>
Date: Fri, 30 Aug 2013 20:03:31 +0530
Subject: [PATCH 290/974] MIPS: KDUMP: skip walking indirection page for
 crashkernels

KDUMP: skip indirection page, as crashkernel has already copied to destination

Signed-off-by: Prem Mallappa <pmallappa@caviumnetworks.com>
Signed-off-by: David Daney <david.daney@cavium.com>
[Original patch taken from Cavium SDK 3.1.2-568]
Signed-off-by: Quanyang Wang <quanyang.wang@windriver.com>
---
 arch/mips/kernel/relocate_kernel.S | 5 +++++
 1 file changed, 5 insertions(+)

diff --git a/arch/mips/kernel/relocate_kernel.S b/arch/mips/kernel/relocate_kernel.S
index 43d2d78..2778a41 100644
--- a/arch/mips/kernel/relocate_kernel.S
+++ b/arch/mips/kernel/relocate_kernel.S
@@ -26,6 +26,11 @@ process_entry:
 	PTR_L		s2, (s0)
 	PTR_ADD		s0, s0, SZREG
 
+	/* In case of kdump/crash kernel, indirection page is not populated
+	* as the kernel is directly copied to reserved location
+	*/
+	beq             s2, zero, done
+
 	/* destination page */
 	and		s3, s2, 0x1
 	beq		s3, zero, 1f
-- 
2.6.2

