From 7b91f811ceb59a93d5ebe241a0afe7996b10566b Mon Sep 17 00:00:00 2001
From: David Daney <david.daney@cavium.com>
Date: Sat, 26 Jul 2014 18:05:50 -0700
Subject: [PATCH 693/974] MIPS: OCTEON: Fix typo in octeon_up_prepare().

We need to set the state of the target CPU, not the current CPU.

Signed-off-by: David Daney <david.daney@cavium.com>
[Original patch taken from Cavium SDK 3.1.2-568]
Signed-off-by: Quanyang Wang <quanyang.wang@windriver.com>
---
 arch/mips/cavium-octeon/smp.c | 2 +-
 1 file changed, 1 insertion(+), 1 deletion(-)

diff --git a/arch/mips/cavium-octeon/smp.c b/arch/mips/cavium-octeon/smp.c
index 7c3fcf1..32ab0aa 100644
--- a/arch/mips/cavium-octeon/smp.c
+++ b/arch/mips/cavium-octeon/smp.c
@@ -372,7 +372,7 @@ static int octeon_up_prepare(unsigned int cpu)
 	int coreid = cpu_logical_map(cpu);
 	int node;
 
-	per_cpu(cpu_state, smp_processor_id()) = CPU_UP_PREPARE;
+	per_cpu(cpu_state, cpu) = CPU_UP_PREPARE;
 	octeon_bootvector[coreid].target_ptr = (uint64_t)octeon_hotplug_entry_raw;
 	mb();
 	/* Convert coreid to node,core spair and send NMI to target core */
-- 
2.6.2

