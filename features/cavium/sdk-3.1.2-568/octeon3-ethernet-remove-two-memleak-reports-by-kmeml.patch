From 3ebd483394e1fb6260a5152248834ed96fe5b5fd Mon Sep 17 00:00:00 2001
From: Quanyang Wang <quanyang.wang@windriver.com>
Date: Mon, 1 Feb 2016 13:19:53 +0800
Subject: [PATCH 1/2] octeon3-ethernet: remove two memleak reports by
 kmemleak_not_leak

The allocated memory is send to cvmx_fpa3_free(), this function is to
free a pointer back to the pool, it will call cvmx_write_io() to write
this val to a IO address finally. So these shouldn't be kmem leak.

Signed-off-by: Yanjiang Jin <yanjiang.jin@windriver.com>
Signed-off-by: Quanyang Wang <quanyang.wang@windriver.com>
---
 arch/mips/cavium-octeon/octeon-fpa3.c          |    1 +
 drivers/net/ethernet/octeon/octeon3-ethernet.c |    1 +
 2 files changed, 2 insertions(+), 0 deletions(-)

diff --git a/arch/mips/cavium-octeon/octeon-fpa3.c b/arch/mips/cavium-octeon/octeon-fpa3.c
index 5e347fe..3a4cd7d 100644
--- a/arch/mips/cavium-octeon/octeon-fpa3.c
+++ b/arch/mips/cavium-octeon/octeon-fpa3.c
@@ -225,6 +225,7 @@ int octeon_mem_fill_fpa3(int			node,
 			rc = -ENOMEM;
 			break;
 		}
+		kmemleak_not_leak(mem);
 		cvmx_fpa3_free(mem, aura, 0);
 	}
 
diff --git a/drivers/net/ethernet/octeon/octeon3-ethernet.c b/drivers/net/ethernet/octeon/octeon3-ethernet.c
index 0320395..3b4e13f 100644
--- a/drivers/net/ethernet/octeon/octeon3-ethernet.c
+++ b/drivers/net/ethernet/octeon/octeon3-ethernet.c
@@ -631,6 +631,7 @@ static void octeon3_eth_replenish_rx(struct octeon3_ethernet *priv, int count)
 			pr_err("WARNING: octeon3_eth_replenish_rx out of memory\n");
 			break;
 		}
+		kmemleak_not_leak(skb);
 		buf = (void **)PTR_ALIGN(skb->head, 128);
 		buf[SKB_PTR_OFFSET] = skb;
 		cvmx_fpa3_free(buf,
-- 
1.7.5.4

