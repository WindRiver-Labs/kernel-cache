From 8f13e2ec91cd328e142ca4be0aa213fedaf4f533 Mon Sep 17 00:00:00 2001
From: Chandrakala Chavva <cchavva@caviumnetworks.com>
Date: Mon, 21 Jul 2014 18:05:50 -0700
Subject: [PATCH 912/974] MIPS:OCTEON: Sync-up SE files.

This fixes udhcpc in ethernet driver.

Signed-off-by: Chandrakala Chavva <cchavva@caviumnetworks.com>
[Original patch taken from Cavium SDK 3.1.2-568]
Signed-off-by: Quanyang Wang <quanyang.wang@windriver.com>
---
 arch/mips/cavium-octeon/executive/cvmx-helper-cfg.c |  2 +-
 arch/mips/cavium-octeon/executive/cvmx-pcie.c       |  2 +-
 arch/mips/cavium-octeon/executive/cvmx-qlm.c        |  4 ++--
 arch/mips/cavium-octeon/executive/octeon-model.c    | 20 ++++++++++++++------
 arch/mips/include/asm/octeon/cvmx-qlm.h             |  2 +-
 5 files changed, 19 insertions(+), 11 deletions(-)

diff --git a/arch/mips/cavium-octeon/executive/cvmx-helper-cfg.c b/arch/mips/cavium-octeon/executive/cvmx-helper-cfg.c
index bdbed62..bb634ba 100644
--- a/arch/mips/cavium-octeon/executive/cvmx-helper-cfg.c
+++ b/arch/mips/cavium-octeon/executive/cvmx-helper-cfg.c
@@ -94,7 +94,7 @@ CVMX_SHARED struct cvmx_cfg_port_param cvmx_cfg_port[CVMX_MAX_NODES][CVMX_HELPER
 				.ccpp_pko_port_base = CVMX_HELPER_CFG_INVALID_VALUE,
 				.ccpp_pko_num_ports = CVMX_HELPER_CFG_INVALID_VALUE,
 				.agl_rx_clk_skew = 0,
-				.valid = false,
+				.valid = true,
 				.sgmii_phy_mode = false,
 				.sgmii_1000x_mode = false,
 				.agl_rx_clk_delay_bypass = false,
diff --git a/arch/mips/cavium-octeon/executive/cvmx-pcie.c b/arch/mips/cavium-octeon/executive/cvmx-pcie.c
index d8848f9..91f832f 100644
--- a/arch/mips/cavium-octeon/executive/cvmx-pcie.c
+++ b/arch/mips/cavium-octeon/executive/cvmx-pcie.c
@@ -42,7 +42,7 @@
  *
  * Interface to PCIe as a host(RC) or target(EP)
  *
- * <hr>$Revision: 121873 $<hr>
+ * <hr>$Revision: 122044 $<hr>
  */
 #ifdef CVMX_BUILD_FOR_LINUX_KERNEL
 #include <asm/octeon/cvmx.h>
diff --git a/arch/mips/cavium-octeon/executive/cvmx-qlm.c b/arch/mips/cavium-octeon/executive/cvmx-qlm.c
index 86ef992..b1791cb 100644
--- a/arch/mips/cavium-octeon/executive/cvmx-qlm.c
+++ b/arch/mips/cavium-octeon/executive/cvmx-qlm.c
@@ -42,7 +42,7 @@
  *
  * Helper utilities for qlm.
  *
- * <hr>$Revision: 121917 $<hr>
+ * <hr>$Revision: 122049 $<hr>
  */
 #ifdef CVMX_BUILD_FOR_LINUX_KERNEL
 #include <asm/octeon/cvmx.h>
@@ -1748,7 +1748,7 @@ enum cvmx_qlm_mode __cvmx_qlm_get_mode_cn73xx(int qlm)
 				qlm_mode[qlm] = CVMX_QLM_MODE_RXAUI_1X2;
 			else
 		case 0x205:
-		case 0x2033:
+		case 0x233:
 		case 0x3302:
 		case 0x3305:
 			if (mux == 0)
diff --git a/arch/mips/cavium-octeon/executive/octeon-model.c b/arch/mips/cavium-octeon/executive/octeon-model.c
index 839dd15..74de6c5 100644
--- a/arch/mips/cavium-octeon/executive/octeon-model.c
+++ b/arch/mips/cavium-octeon/executive/octeon-model.c
@@ -43,7 +43,7 @@
  * File defining functions for working with different Octeon
  * models.
  *
- * <hr>$Revision: 114198 $<hr>
+ * <hr>$Revision: 122055 $<hr>
  */
 #ifdef CVMX_BUILD_FOR_LINUX_KERNEL
 #include <asm/octeon/octeon.h>
@@ -480,11 +480,19 @@ const char *octeon_model_get_string_buffer(uint32_t chip_id, char *buffer)
 		if (num_cores == 6)	/* Other core counts match generic */
 			core_model = "35";
 		family = "73";
-		if (fus_dat3.cn78xx.nozip
-		    && fus_dat3.cn78xx.nodfa_dte
-		    && fus_dat3.cn78xx.nohna_dte)
-			suffix = "SCP";
-		else
+		if (fus_dat3.cn73xx.l2c_crip == 2)
+			family = "72";
+		if (fus_dat3.cn73xx.nozip
+				&& fus_dat3.cn73xx.nodfa_dte
+				&& fus_dat3.cn73xx.nohna_dte) {
+			if (!fus_dat2.cn73xx.raid_en) {
+				suffix = "CP";
+			}
+			else {
+				suffix = "SCP";
+			}
+		}
+		else 
 			suffix = "AAP";
 		break;
 	case 0x98:		/* CN75XX */
diff --git a/arch/mips/include/asm/octeon/cvmx-qlm.h b/arch/mips/include/asm/octeon/cvmx-qlm.h
index acd48cd..f43ea1b 100644
--- a/arch/mips/include/asm/octeon/cvmx-qlm.h
+++ b/arch/mips/include/asm/octeon/cvmx-qlm.h
@@ -42,7 +42,7 @@
  *
  * Helper utilities for qlm.
  *
- * <hr>$Revision: 121917 $<hr>
+ * <hr>$Revision: 122043 $<hr>
  */
 
 #ifndef __CVMX_QLM_H__
-- 
2.6.2

