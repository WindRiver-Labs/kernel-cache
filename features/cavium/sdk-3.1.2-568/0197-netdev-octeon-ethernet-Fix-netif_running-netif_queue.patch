From df778a2c4c3f854c4bfaa496ee14474da04f77f2 Mon Sep 17 00:00:00 2001
From: David Daney <david.daney@cavium.com>
Date: Mon, 29 Jul 2013 11:54:45 -0700
Subject: [PATCH 197/974] netdev: octeon-ethernet: Fix
 netif_running/netif_queue_stopped confusion.

Xmit flow control is done by testing netif_queue_stopped.

Signed-off-by: David Daney <david.daney@cavium.com>
[Original patch taken from Cavium SDK 3.1.2-568]
Signed-off-by: Quanyang Wang <quanyang.wang@windriver.com>
---
 drivers/net/ethernet/octeon/ethernet-napi.c | 2 +-
 1 file changed, 1 insertion(+), 1 deletion(-)

diff --git a/drivers/net/ethernet/octeon/ethernet-napi.c b/drivers/net/ethernet/octeon/ethernet-napi.c
index 89d8f59..8608598 100644
--- a/drivers/net/ethernet/octeon/ethernet-napi.c
+++ b/drivers/net/ethernet/octeon/ethernet-napi.c
@@ -158,7 +158,7 @@ static int CVM_OCT_NAPI_POLL(struct napi_struct *napi, int budget)
 
 			skb = (struct sk_buff *)packet_ptr.u64;
 			priv = netdev_priv(skb->dev);
-			if (!netif_running(skb->dev))
+			if (netif_queue_stopped(skb->dev))
 				netif_wake_queue(skb->dev);
 			if (unlikely((skb_shinfo(skb)->tx_flags | SKBTX_IN_PROGRESS) != 0 &&
 				     priv->tx_timestamp_hw)) {
-- 
2.6.2

