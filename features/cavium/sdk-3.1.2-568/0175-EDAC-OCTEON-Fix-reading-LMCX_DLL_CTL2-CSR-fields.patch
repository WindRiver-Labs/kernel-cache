From 55f74dd7225609a45587f35271758496beb1d11d Mon Sep 17 00:00:00 2001
From: Chandrakala Chavva <cchavva@caviumnetworks.com>
Date: Mon, 17 Jun 2013 17:43:08 -0700
Subject: [PATCH 175/974] EDAC:OCTEON: Fix reading LMCX_DLL_CTL2 CSR fields.

Read LMCX_DLL_CTL2<quad_dll_ena> from the correct struct.

Signed-off-by: Chandrakala Chavva <cchavva@caviumnetworks.com>
[Original patch taken from Cavium SDK 3.1.2-568]
Signed-off-by: Quanyang Wang <quanyang.wang@windriver.com>
---
 drivers/edac/octeon_edac-lmc.c | 3 ++-
 1 file changed, 2 insertions(+), 1 deletion(-)

diff --git a/drivers/edac/octeon_edac-lmc.c b/drivers/edac/octeon_edac-lmc.c
index fa219f9..12d1510 100644
--- a/drivers/edac/octeon_edac-lmc.c
+++ b/drivers/edac/octeon_edac-lmc.c
@@ -134,7 +134,8 @@ static int octeon_lmc_edac_probe(struct platform_device *pdev)
 
 		/* Check if LMC controller is enabled. */
 		ctl2.u64 = cvmx_read_csr(CVMX_LMCX_DLL_CTL2(mc));
-		if (ctl2.s.quad_dll_ena == 0) {
+		if ((OCTEON_IS_OCTEON3() && ctl2.cn70xx.quad_dll_ena == 0)
+		    || (OCTEON_IS_OCTEON2() && ctl2.cn63xx.quad_dll_ena == 0)) { 
 			dev_info(&pdev->dev, "Disabled (LMC not present)\n");
 			return 0;
 		}
-- 
2.6.2

