From d3acecc6ceb936aa9733f1235c8f52a94a77abbe Mon Sep 17 00:00:00 2001
From: Peter Swain <peter.swain@cavium.com>
Date: Sun, 16 Feb 2014 13:46:59 -0800
Subject: [PATCH 458/974] MIPS: panic_on_oops: remove ssleep()

MIPS catches up to 2006 fix on other archs...
   commit cea6a4ba8acfba6f59cc9ed71e0d05cb770b9d9c
   Author: Horms <horms@verge.net.au>
   Date:   Sun Jul 30 03:03:34 2006 -0700
from cea6a4ba log ...
   This patch is part of an effort to unify the panic_on_oops behaviour across
   all architectures that implement it.

   It was pointed out to me by Andi Kleen that if an oops has occured in
   interrupt context, then calling sleep() in the oops path will only cause a
   panic, and that it would be really better for it not to be in the path at
   all.

Signed-off-by: Peter Swain <pswain@cavium.net>
[Original patch taken from Cavium SDK 3.1.2-568]
Signed-off-by: Quanyang Wang <quanyang.wang@windriver.com>
---
 arch/mips/kernel/traps.c | 5 +----
 1 file changed, 1 insertion(+), 4 deletions(-)

diff --git a/arch/mips/kernel/traps.c b/arch/mips/kernel/traps.c
index 4709d5d..dd59f093 100644
--- a/arch/mips/kernel/traps.c
+++ b/arch/mips/kernel/traps.c
@@ -390,11 +390,8 @@ void __noreturn die(const char *str, struct pt_regs *regs)
 	if (in_interrupt())
 		panic("Fatal exception in interrupt");
 
-	if (panic_on_oops) {
-		printk(KERN_EMERG "Fatal exception: panic in 5 seconds");
-		ssleep(5);
+	if (panic_on_oops)
 		panic("Fatal exception");
-	}
 
 	if (regs && kexec_should_crash(current))
 		crash_kexec(regs);
-- 
2.6.2

