From f91e3260d10946b5f4d2fefcca0e8604e8158a0c Mon Sep 17 00:00:00 2001
From: Carlos Munoz <cmunoz@caviumnetworks.com>
Date: Fri, 21 Nov 2014 15:10:02 -0800
Subject: [PATCH 031/184] etdev: octeon-ethernet: Only recycles skbs that came
 from the fpa.

Source: Cavium Networks, Inc.
MR: 00000
Type: Integration
Disposition: Merged from Octeon Tree
ChangeID: 4d99ae5513bd038158c6130d2a16383662f69a4d
Description:

Signed-off-by: Carlos Munoz <cmunoz@caviumnetworks.com>
Signed-off-by: Corey Minyard <cminyard@mvista.com>
[Original patch taken from octeon-linux-kernel-patches-SDK-3.1.2-release]
Signed-off-by: Yanjiang Jin <yanjiang.jin@windriver.com>
---
 drivers/net/ethernet/octeon/ethernet-tx.c | 3 +++
 1 file changed, 3 insertions(+)

diff --git a/drivers/net/ethernet/octeon/ethernet-tx.c b/drivers/net/ethernet/octeon/ethernet-tx.c
index 26f9340..0515835 100644
--- a/drivers/net/ethernet/octeon/ethernet-tx.c
+++ b/drivers/net/ethernet/octeon/ethernet-tx.c
@@ -65,6 +65,9 @@ static bool cvm_oct_skb_ok_for_reuse(struct sk_buff *skb)
 {
 	unsigned char *fpa_head = cvm_oct_get_fpa_head(skb);
 
+	if (*(struct sk_buff **)(fpa_head - sizeof(void *)) != skb)
+		return false;
+
 	if (unlikely(skb->data < fpa_head))
 		return false;
 
-- 
1.9.1

