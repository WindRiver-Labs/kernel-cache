From e4d423c1a05555892cad561515e9ad81344582b2 Mon Sep 17 00:00:00 2001
From: David Daney <david.daney@cavium.com>
Date: Wed, 9 Jul 2014 18:05:50 -0700
Subject: [PATCH 867/974] netdev: octeon_mgmt: Fix incorrect RingEntry[CODE]
 mask value.

Low order bits of the length were leaking into the code, causing
packets with odd lengths to be rejected.

Signed-off-by: David Daney <david.daney@cavium.com>
[Original patch taken from Cavium SDK 3.1.2-568]
Signed-off-by: Quanyang Wang <quanyang.wang@windriver.com>
---
 drivers/net/ethernet/octeon/octeon_mgmt.c | 6 ++++--
 1 file changed, 4 insertions(+), 2 deletions(-)

diff --git a/drivers/net/ethernet/octeon/octeon_mgmt.c b/drivers/net/ethernet/octeon/octeon_mgmt.c
index 5c79ff9..8b0c3cc 100644
--- a/drivers/net/ethernet/octeon/octeon_mgmt.c
+++ b/drivers/net/ethernet/octeon/octeon_mgmt.c
@@ -46,8 +46,10 @@
 /* 14 bits of length */
 #define OCTEON_MGMT_RE_LEN_MASK 0x3fffULL
 
-/* 7 or 8 bits of code. 8th bit is always zero, so just look at 7 bits. */
-#define OCTEON_MGMT_RE_CODE_MASK 0x7fULL
+/* 6 or 8 bits of code. 7th and 8th bits are always zero, so just look
+ * at 6 bits.
+ */
+#define OCTEON_MGMT_RE_CODE_MASK 0x3fULL
 
 #define RING_ENTRY_CODE_DONE 0xf
 #define RING_ENTRY_CODE_MORE 0x10
-- 
2.6.2

