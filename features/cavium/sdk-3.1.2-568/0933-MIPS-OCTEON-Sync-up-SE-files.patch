From 502f85b1b801c6084ed3b0d4394ebb9843e93e4d Mon Sep 17 00:00:00 2001
From: Chandrakala Chavva <cchavva@caviumnetworks.com>
Date: Sun, 27 Jul 2014 18:05:50 -0700
Subject: [PATCH 933/974] MIPS: OCTEON: Sync-up SE files.

Signed-off-by: Chandrakala Chavva <cchavva@caviumnetworks.com>
[Original patch taken from Cavium SDK 3.1.2-568]
Signed-off-by: Quanyang Wang <quanyang.wang@windriver.com>
---
 arch/mips/cavium-octeon/executive/cvmx-helper-board.c | 10 ++++++++++
 arch/mips/cavium-octeon/executive/cvmx-helper.c       |  8 ++++++++
 arch/mips/include/asm/octeon/cvmx-helper-bgx.h        | 16 +++++++++++++++-
 3 files changed, 33 insertions(+), 1 deletion(-)

diff --git a/arch/mips/cavium-octeon/executive/cvmx-helper-board.c b/arch/mips/cavium-octeon/executive/cvmx-helper-board.c
index a2001b8..66e164f 100644
--- a/arch/mips/cavium-octeon/executive/cvmx-helper-board.c
+++ b/arch/mips/cavium-octeon/executive/cvmx-helper-board.c
@@ -2775,7 +2775,9 @@ cvmx_helper_link_info_t __cvmx_helper_board_link_get_from_dt(int ipd_port)
 			default:
 				break;
 			}
+#ifndef CVMX_BUILD_FOR_LINUX_KERNEL
 			__cvmx_update_link_led(xiface, index, result);
+#endif
 			return result;
 		}
 		phy_info = cvmx_helper_get_port_phy_info(xiface, index);
@@ -2829,8 +2831,10 @@ cvmx_helper_link_info_t __cvmx_helper_board_link_get_from_dt(int ipd_port)
 			result.s.link_up = 1;
 			result.s.speed = 1000;
 		}
+#ifndef CVMX_BUILD_FOR_LINUX_KERNEL
 		if (ipd_port >= 0)
 			__cvmx_update_link_led(xiface, index, result);
+#endif
 		return result;
 	}
 
@@ -2855,8 +2859,10 @@ cvmx_helper_link_info_t __cvmx_helper_board_link_get_from_dt(int ipd_port)
 	else
 		result = cvmx_helper_link_get(ipd_port);
 
+#ifndef CVMX_BUILD_FOR_LINUX_KERNEL
 	if (ipd_port >= 0)
 		__cvmx_update_link_led(xiface, index, result);
+#endif
 	return result;
 
 }
@@ -2908,8 +2914,10 @@ cvmx_helper_link_info_t __cvmx_helper_board_link_get(int ipd_port)
 	/* Give the user a chance to override the processing of this function */
 	if (cvmx_override_board_link_get) {
 		result = cvmx_override_board_link_get(ipd_port);
+#ifndef CVMX_BUILD_FOR_LINUX_KERNEL
 		if (ipd_port >= 0)
 			__cvmx_update_link_led(xiface, index, result);
+#endif
 
 		return result;
 	}
@@ -3069,8 +3077,10 @@ cvmx_helper_link_info_t __cvmx_helper_board_link_get(int ipd_port)
 	if (!result.s.link_up)
 		result.u64 = 0;
 
+#ifndef CVMX_BUILD_FOR_LINUX_KERNEL
 	if (ipd_port >= 0)
 		__cvmx_update_link_led(xiface, index, result);
+#endif
 	return result;
 }
 
diff --git a/arch/mips/cavium-octeon/executive/cvmx-helper.c b/arch/mips/cavium-octeon/executive/cvmx-helper.c
index 43e21522..35eabf8 100644
--- a/arch/mips/cavium-octeon/executive/cvmx-helper.c
+++ b/arch/mips/cavium-octeon/executive/cvmx-helper.c
@@ -2034,14 +2034,18 @@ int cvmx_helper_shutdown_packet_io_global_cn78xx(int node)
 
 		cvmx_bgx_set_backpressure_override(xiface, 0);
 		for (index = 0; index < num_ports; index++) {
+#ifndef CVMX_BUILD_FOR_LINUX_KERNEL
 			cvmx_helper_link_info_t link_info;
+#endif
 			if (!cvmx_helper_is_port_valid(xiface, index))
 				continue;
 
 			cvmx_helper_bgx_shutdown_port(xiface, index);
+#ifndef CVMX_BUILD_FOR_LINUX_KERNEL
 			/* Turn off link LEDs */
 			link_info.u64 = 0;
 			__cvmx_update_link_led(xiface, index, link_info);
+#endif
 		}
 	}
 
@@ -2101,6 +2105,7 @@ int cvmx_helper_shutdown_packet_io_global_cn78xx(int node)
 		}
 	}
 
+#ifndef CVMX_BUILD_FOR_LINUX_KERNEL
 	for (interface = 0; interface < num_interfaces; interface++) {
 		int index;
 		int xiface = cvmx_helper_node_interface_to_xiface(node, interface);
@@ -2114,6 +2119,7 @@ int cvmx_helper_shutdown_packet_io_global_cn78xx(int node)
 			cvmx_update_rx_activity_led(xiface, index, false);
 		}
 	}
+#endif
 
 	/* Shutdown the PKO unit */
 	result = cvmx_helper_pko3_shutdown(node);
@@ -2621,8 +2627,10 @@ cvmx_helper_link_info_t cvmx_helper_link_get(int xipd_port)
 	if (iface_node_ops[xi.node][xi.interface]->link_get)
 		result = iface_node_ops[xi.node][xi.interface]->link_get(xipd_port);
 
+#ifndef CVMX_BUILD_FOR_LINUX_KERNEL
 	if (xipd_port >= 0)
 		__cvmx_update_link_led(xiface, index, result);
+#endif
 
 	return result;
 }
diff --git a/arch/mips/include/asm/octeon/cvmx-helper-bgx.h b/arch/mips/include/asm/octeon/cvmx-helper-bgx.h
index 5be2726..49a69cc 100644
--- a/arch/mips/include/asm/octeon/cvmx-helper-bgx.h
+++ b/arch/mips/include/asm/octeon/cvmx-helper-bgx.h
@@ -48,6 +48,16 @@
 #ifndef __CVMX_HELPER_BGX_H__
 #define __CVMX_HELPER_BGX_H__
 
+#ifdef CVMX_BUILD_FOR_LINUX_KERNEL
+#include <asm/octeon/cvmx-bgxx-defs.h>
+#endif
+
+#ifdef __cplusplus
+/* *INDENT-OFF* */
+extern "C" {
+/* *INDENT-ON* */
+#endif
+
 #define CVMX_BGX_RX_FIFO_SIZE	(64 * 1024)
 
 extern int __cvmx_helper_bgx_enumerate(int xiface);
@@ -311,5 +321,9 @@ int cvmx_dump_bgx_config_node(unsigned node, unsigned bgx);
 int cvmx_dump_bgx_status_node(unsigned node, unsigned bgx);
 
 #endif
-
+#ifdef __cplusplus
+/* *INDENT-OFF* */
+}
+/* *INDENT-ON* */
+#endif
 #endif
-- 
2.6.2

