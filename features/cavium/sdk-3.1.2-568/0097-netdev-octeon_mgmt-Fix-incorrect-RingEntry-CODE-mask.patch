From 00d4841e75d6c7ad516d8babdd7afe22c880e39d Mon Sep 17 00:00:00 2001
From: David Daney <david.daney@cavium.com>
Date: Mon, 9 Mar 2015 14:27:10 -0700
Subject: [PATCH 097/184] netdev: octeon_mgmt: Fix incorrect RingEntry[CODE]
 mask value.

Source: Cavium Networks, Inc.
MR: 00000
Type: Integration
Disposition: Merged from Octeon Tree
ChangeID: 80b2efdc452ca143f16957c4cecf44ab00ed857a
Description:

Low order bits of the length were leaking into the code, causing
packets with odd lengths to be rejected.

Signed-off-by: David Daney <david.daney@cavium.com>
Signed-off-by: Corey Minyard <cminyard@mvista.com>
[Original patch taken from octeon-linux-kernel-patches-SDK-3.1.2-release]
Signed-off-by: Yanjiang Jin <yanjiang.jin@windriver.com>
---
 drivers/net/ethernet/octeon/octeon_mgmt.c | 6 ++++--
 1 file changed, 4 insertions(+), 2 deletions(-)

diff --git a/drivers/net/ethernet/octeon/octeon_mgmt.c b/drivers/net/ethernet/octeon/octeon_mgmt.c
index 74dec91..76f47dd 100644
--- a/drivers/net/ethernet/octeon/octeon_mgmt.c
+++ b/drivers/net/ethernet/octeon/octeon_mgmt.c
@@ -46,8 +46,10 @@
 /* 14 bits of length */
 #define OCTEON_MGMT_RE_LEN_MASK 0x3fffULL
 
-/* 7 or 8 bits of code. 8th bit is always zero, so just look at 7 bits. */
-#define OCTEON_MGMT_RE_CODE_MASK 0x7fULL
+/* 6 or 8 bits of code. 7th and 8th bits are always zero, so just look
+ * at 6 bits.
+ */
+#define OCTEON_MGMT_RE_CODE_MASK 0x3fULL
 
 #define RING_ENTRY_CODE_DONE 0xf
 #define RING_ENTRY_CODE_MORE 0x10
-- 
1.9.1

