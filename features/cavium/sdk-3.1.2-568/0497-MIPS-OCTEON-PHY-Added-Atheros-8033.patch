From 7deeff4ac923f403eee48fbae71a022c98a3a856 Mon Sep 17 00:00:00 2001
From: Chandrakala Chavva <cchavva@caviumnetworks.com>
Date: Mon, 24 Feb 2014 13:46:59 -0800
Subject: [PATCH 497/974] MIPS:OCTEON:PHY: Added Atheros 8033.

Signed-off-by: Chandrakala Chavva <cchavva@caviumnetworks.com>
[Original patch taken from Cavium SDK 3.1.2-568]
Signed-off-by: Quanyang Wang <quanyang.wang@windriver.com>
---
 drivers/net/phy/at803x.c | 26 +++++++++++++++++++++++++-
 1 file changed, 25 insertions(+), 1 deletion(-)

diff --git a/drivers/net/phy/at803x.c b/drivers/net/phy/at803x.c
index 45cbc10..411fd77 100644
--- a/drivers/net/phy/at803x.c
+++ b/drivers/net/phy/at803x.c
@@ -123,6 +123,22 @@ static struct phy_driver at8035_driver = {
 	},
 };
 
+/* ATHEROS 8033 */
+static struct phy_driver at8033_driver = {
+	.phy_id		= 0x004dd074,
+	.name		= "Atheros 8033 ethernet",
+	.phy_id_mask	= 0xffffffef,
+	.config_init	= &at803x_config_init,
+	.features	= PHY_GBIT_FEATURES,
+	.flags		= PHY_HAS_INTERRUPT,
+	.config_aneg	= &genphy_config_aneg,
+	.read_status	= &genphy_read_status,
+	.driver		= {
+		.owner = THIS_MODULE,
+	},
+};
+
+
 /* ATHEROS 8030 */
 static struct phy_driver at8030_driver = {
 	.phy_id		= 0x004dd076,
@@ -146,12 +162,18 @@ static int __init atheros_init(void)
 	if (ret)
 		goto err1;
 
-	ret = phy_driver_register(&at8030_driver);
+	ret = phy_driver_register(&at8033_driver);
 	if (ret)
 		goto err2;
 
+	ret = phy_driver_register(&at8030_driver);
+	if (ret)
+		goto err3;
+
 	return 0;
 
+err3:
+	phy_driver_unregister(&at8033_driver);
 err2:
 	phy_driver_unregister(&at8035_driver);
 err1:
@@ -161,6 +183,7 @@ err1:
 static void __exit atheros_exit(void)
 {
 	phy_driver_unregister(&at8035_driver);
+	phy_driver_unregister(&at8033_driver);
 	phy_driver_unregister(&at8030_driver);
 }
 
@@ -169,6 +192,7 @@ module_exit(atheros_exit);
 
 static struct mdio_device_id __maybe_unused atheros_tbl[] = {
 	{ 0x004dd076, 0xffffffef },
+	{ 0x004dd074, 0xffffffef },
 	{ 0x004dd072, 0xffffffef },
 	{ }
 };
-- 
2.6.2

