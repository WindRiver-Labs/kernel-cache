From 685d10c25b1c434a0d95104e9ba9916a68e48585 Mon Sep 17 00:00:00 2001
From: Xin Ouyang <Xin.Ouyang@windriver.com>
Date: Tue, 21 May 2013 05:32:25 -0400
Subject: [PATCH] Grsecurity: set DEFAULT_MMAP_MIN_ADDR for arm and other
 archs

vm.mmap_min_addr = max(DEFAULT_MMAP_MIN_ADDR, LSM_MMAP_MIN_ADDR).

Because LSM_MMAP_MIN_ADDR is set to 32768-65536 depend on archs, and
grsecurity's patch set DEFAULT_MMAP_MIN_ADDR to 65536 will cause
vm.mmap_min_addr always be 65536.

This will result in many userspace applications fail to execute and
normal user could not login in, on ARM or some other targets.

  # strace -p $LOGIN_PID
  [pid  3146] execve("/bin/sh", ["-sh"], [/* 8 vars */] <unfinished ...>
  [pid  3146] +++ killed by SIGKILL +++

Signed-off-by: Xin Ouyang <Xin.Ouyang@windriver.com>
---
 mm/Kconfig |    1 +
 1 files changed, 1 insertions(+), 0 deletions(-)

diff --git a/mm/Kconfig b/mm/Kconfig
index 423dfc8..1b6eb9d 100644
--- a/mm/Kconfig
+++ b/mm/Kconfig
@@ -254,6 +254,7 @@ config DEFAULT_MMAP_MIN_ADDR
 	int "Low address space to protect from user allocation"
 	depends on MMU
 	default 65536
+	default 32768 if ALPHA || ARM || PARISC || SPARC32
 	help
 	  This is the portion of low virtual memory which should be protected
 	  from userspace allocation.  Keeping a user from writing to low pages
-- 
1.7.5.4

