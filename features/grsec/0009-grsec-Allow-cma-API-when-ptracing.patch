From 229155477b748d41f4e0968f826134ba0c7e84f4 Mon Sep 17 00:00:00 2001
From: Joe MacDonald <joe.macdonald@windriver.com>
Date: Fri, 25 Jan 2013 11:16:18 -0500
Subject: [PATCH 09/16] grsec: Allow cma API when ptracing

PaX unconditionally disabled the process_vm_rw_core syscall pending a full
audit.  We'll re-enable it provided the configuration has already
explicitly allowed ptracing, expecting that allowing potential holes via
CMA is probably a lesser concern under those circumstances.

Signed-off-by: Joe MacDonald <joe.macdonald@windriver.com>
---
 mm/process_vm_access.c |    2 ++
 1 file changed, 2 insertions(+)

diff --git a/mm/process_vm_access.c b/mm/process_vm_access.c
index 0cea1b0..52f2d3a 100644
--- a/mm/process_vm_access.c
+++ b/mm/process_vm_access.c
@@ -259,7 +259,9 @@ static ssize_t process_vm_rw_core(pid_t pid, const struct iovec *lvec,
 	size_t iov_l_curr_offset = 0;
 	ssize_t iov_len;
 
+#ifndef CONFIG_PAX_MPROTECT_ALLOW_PTRACE
 	return -ENOSYS; // PaX: until properly audited
+#endif
 
 	/*
 	 * Work out how many pages of struct pages we're going to need
-- 
1.7.9.5

