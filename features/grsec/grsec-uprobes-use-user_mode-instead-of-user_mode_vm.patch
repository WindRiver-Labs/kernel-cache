From 2fc0b5050f4b6c51923be4fc008033ca717bcd02 Mon Sep 17 00:00:00 2001
From: Michel Thebeau <michel.thebeau@windriver.com>
Date: Thu, 20 Sep 2012 11:48:36 -0400
Subject: [PATCH] grsec/uprobes: use user_mode() instead of user_mode_vm()

grsec drops user_mode_vm(), and uses a modified version of user_mode()
instead.  Add uprobe's use of user_mode_vm to this refactor.

Signed-off-by: Michel Thebeau <michel.thebeau@windriver.com>
---
 arch/x86/kernel/uprobes.c |    2 +-
 1 file changed, 1 insertion(+), 1 deletion(-)

diff --git a/arch/x86/kernel/uprobes.c b/arch/x86/kernel/uprobes.c
index 36fd420..7e5892d 100644
--- a/arch/x86/kernel/uprobes.c
+++ b/arch/x86/kernel/uprobes.c
@@ -607,7 +607,7 @@ int arch_uprobe_exception_notify(struct notifier_block *self, unsigned long val,
 	int ret = NOTIFY_DONE;
 
 	/* We are only interested in userspace traps */
-	if (regs && !user_mode_vm(regs))
+	if (regs && !user_mode(regs))
 		return NOTIFY_DONE;
 
 	switch (val) {
-- 
1.7.9.7

