From 5bc9cc4bb733247e163e1f28fe2ec0357590f393 Mon Sep 17 00:00:00 2001
From: "Roy.Li" <rongqing.li@windriver.com>
Date: Wed, 9 Jan 2013 10:00:45 +0800
Subject: [PATCH] Define GRSEC_ALLOW_VMCORE

Define GRSEC_ALLOW_VMCORE to allow user to enable VMCORE
when GRSEC is enabled

Signed-off-by: Roy.Li <rongqing.li@windriver.com>
---
 fs/proc/Kconfig |   10 +++++++++-
 1 file changed, 9 insertions(+), 1 deletion(-)

diff --git a/fs/proc/Kconfig b/fs/proc/Kconfig
index 0e9f4467..60c13b4 100644
--- a/fs/proc/Kconfig
+++ b/fs/proc/Kconfig
@@ -32,9 +32,17 @@ config PROC_KCORE
 	bool "/proc/kcore support" if !ARM
 	depends on PROC_FS && MMU && !GRKERNSEC_PROC_ADD
 
+config GRSEC_ALLOW_VMCORE
+	bool "force /proc/vmcore support when grsec is on"
+	depends on GRKERNSEC
+	default n
+	help
+	/proc/vmcore is normally disabled by the GRSecurity kernel hardening
+	policy. Unless you know you need this feature, you should say N here.
+
 config PROC_VMCORE
 	bool "/proc/vmcore support"
-	depends on PROC_FS && CRASH_DUMP && !GRKERNSEC
+	depends on PROC_FS && CRASH_DUMP && (!GRKERNSEC || GRSEC_ALLOW_VMCORE)
 	default n
         help
         Exports the dump image of crashed kernel in ELF format.
-- 
1.7.9.7

