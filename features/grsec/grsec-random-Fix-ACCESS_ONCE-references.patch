From 23ea5c5b88869475a531264f8dc287bbbef192df Mon Sep 17 00:00:00 2001
From: Michel Thebeau <michel.thebeau@windriver.com>
Date: Wed, 5 Sep 2012 16:55:32 -0400
Subject: [PATCH] grsec/random: Fix ACCESS_ONCE references

This fix is replicated from "lttng: Fix ACCESS_ONCE references" which
states:

"PAX introduces a new macro, ACCESS_ONCE_RW that indicates we intend to
update the value we're referencing."

Upstream commit e0604ba541f04a542ee9a7f6a468a60688ad8c72 adds an
assignment with ACCESS_ONCE to drivers/char/random.c:

+       ACCESS_ONCE(r->input_rotate) = input_rotate;
+       ACCESS_ONCE(r->add_ptr) = i;

So refactor these references as well.

Signed-off-by: Michel Thebeau <michel.thebeau@windriver.com>
---
 drivers/char/random.c |    4 ++--
 1 file changed, 2 insertions(+), 2 deletions(-)

diff --git a/drivers/char/random.c b/drivers/char/random.c
index c111acb..2df1a92 100644
--- a/drivers/char/random.c
+++ b/drivers/char/random.c
@@ -549,8 +549,8 @@ static void _mix_pool_bytes(struct entropy_store *r, const void *in,
 		input_rotate += i ? 7 : 14;
 	}
 
-	ACCESS_ONCE(r->input_rotate) = input_rotate;
-	ACCESS_ONCE(r->add_ptr) = i;
+	ACCESS_ONCE_RW(r->input_rotate) = input_rotate;
+	ACCESS_ONCE_RW(r->add_ptr) = i;
 	smp_wmb();
 
 	if (out)
-- 
1.7.9.7

