From 4656847127fbf951559ae30c8ce6406567ca1d25 Mon Sep 17 00:00:00 2001
From: Donn Seeley <donn.seeley@windriver.com>
Date: Tue, 12 Jun 2012 09:47:43 -0600
Subject: [PATCH 04/19] emgd: Change EMGD not to include <asm/system.h>.

The header file <asm/system.h> was removed, and its functionality was
split up into several different headers in 3.4:

  commit 0195c00244dc2e9f522475868fa278c473ba7339
  Author: Linus Torvalds <torvalds@linux-foundation.org>
  Date:   Wed Mar 28 15:58:21 2012 -0700

  Pull "Disintegrate and delete asm/system.h" from David Howells

We changed EMGD not to include <asm/system.h>, and when the required
functionality wasn't included implicitly, we added explicit includes
for some of the split-up headers.

Signed-off-by: Donn Seeley <donn.seeley@windriver.com>
---
 .../drm/emgd/pvr/services4/srvkm/env/linux/event.c |    2 +-
 .../emgd/pvr/services4/srvkm/env/linux/osfunc.c    |    6 +++++-
 .../drm/emgd/pvr/services4/srvkm/env/linux/proc.h  |    1 -
 3 files changed, 6 insertions(+), 3 deletions(-)

diff --git a/drivers/gpu/drm/emgd/pvr/services4/srvkm/env/linux/event.c b/drivers/gpu/drm/emgd/pvr/services4/srvkm/env/linux/event.c
index 85493c1..705b8e4 100644
--- a/drivers/gpu/drm/emgd/pvr/services4/srvkm/env/linux/event.c
+++ b/drivers/gpu/drm/emgd/pvr/services4/srvkm/env/linux/event.c
@@ -23,7 +23,7 @@
 #include <linux/version.h>
 #include <asm/io.h>
 #include <asm/page.h>
-#if (LINUX_VERSION_CODE >= KERNEL_VERSION(2,6,22))
+#if (LINUX_VERSION_CODE >= KERNEL_VERSION(2,6,22)) && (LINUX_VERSION_CODE < KERNEL_VERSION(3,4,0))
 #include <asm/system.h>
 #endif
 #include <linux/mm.h>
diff --git a/drivers/gpu/drm/emgd/pvr/services4/srvkm/env/linux/osfunc.c b/drivers/gpu/drm/emgd/pvr/services4/srvkm/env/linux/osfunc.c
index 60b8a69..241577c 100644
--- a/drivers/gpu/drm/emgd/pvr/services4/srvkm/env/linux/osfunc.c
+++ b/drivers/gpu/drm/emgd/pvr/services4/srvkm/env/linux/osfunc.c
@@ -23,7 +23,11 @@
 #include <linux/version.h>
 #include <asm/io.h>
 #include <asm/page.h>
-#if (LINUX_VERSION_CODE >= KERNEL_VERSION(2,6,22))
+#if (LINUX_VERSION_CODE >= KERNEL_VERSION(3,4,0))
+#include <asm/barrier.h>
+#include <asm/bug.h>
+#include <asm/cmpxchg.h>
+#elif (LINUX_VERSION_CODE >= KERNEL_VERSION(2,6,22))
 #include <asm/system.h>
 #endif
 #if defined(SUPPORT_CPU_CACHED_BUFFERS)
diff --git a/drivers/gpu/drm/emgd/pvr/services4/srvkm/env/linux/proc.h b/drivers/gpu/drm/emgd/pvr/services4/srvkm/env/linux/proc.h
index 7aa5424..e348c26 100644
--- a/drivers/gpu/drm/emgd/pvr/services4/srvkm/env/linux/proc.h
+++ b/drivers/gpu/drm/emgd/pvr/services4/srvkm/env/linux/proc.h
@@ -23,7 +23,6 @@
 #ifndef __SERVICES_PROC_H__
 #define __SERVICES_PROC_H__
 
-#include <asm/system.h>
 #include <linux/proc_fs.h>
 #include <linux/seq_file.h>
 
-- 
1.7.9.7

