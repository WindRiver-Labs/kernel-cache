From 2264cdc31a6e222fb65caad042505934e156b7ad Mon Sep 17 00:00:00 2001
From: Tom Zanussi <tom.zanussi@intel.com>
Date: Wed, 11 May 2011 09:05:59 -0500
Subject: [PATCH 4/4] emgd: backfix for 2.6.37

Signed-off-by: Tom Zanussi <tom.zanussi@intel.com>
---
 drivers/gpu/drm/emgd/emgd/drm/emgd_drv.c |    8 ++++++--
 1 files changed, 6 insertions(+), 2 deletions(-)

diff --git a/drivers/gpu/drm/emgd/emgd/drm/emgd_drv.c b/drivers/gpu/drm/emgd/emgd/drm/emgd_drv.c
index 48e2cbf..33aa681 100644
--- a/drivers/gpu/drm/emgd/emgd/drm/emgd_drv.c
+++ b/drivers/gpu/drm/emgd/emgd/drm/emgd_drv.c
@@ -1955,6 +1955,10 @@ static struct drm_driver driver = {
 		.poll    = drm_poll,
 		.fasync  = drm_fasync,
 	},
+	.pci_driver = {
+		.name     = DRIVER_NAME,
+		.id_table = pciidlist,
+	},
 	.name                = DRIVER_NAME,
 	.desc                = DRIVER_DESC,
 	.date                = DRIVER_DATE,
@@ -1976,7 +1980,7 @@ static int __init emgd_init(void) {
 
 	EMGD_TRACE_ENTER;
 	driver.num_ioctls = emgd_max_ioctl;
-	ret = drm_pci_init(&driver, &emgd_pci_driver);
+	ret = drm_init(&driver);
 	PVRDPFInit();
 	printk(KERN_INFO "[EMGD] drm_init() returning %d\n", ret);
 	EMGD_TRACE_EXIT;
@@ -1988,7 +1992,7 @@ static int __init emgd_init(void) {
  */
 static void __exit emgd_exit(void) {
 	EMGD_TRACE_ENTER;
-	drm_pci_exit(&driver, &emgd_pci_driver);
+	drm_exit(&driver);
 	EMGD_TRACE_EXIT;
 }
 
-- 
1.7.0.4

