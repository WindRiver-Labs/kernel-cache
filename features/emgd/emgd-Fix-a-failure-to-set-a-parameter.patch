From 8de1d3639240cfcfaf7d1a5a27d117c008f36103 Mon Sep 17 00:00:00 2001
From: Donn Seeley <donn.seeley@windriver.com>
Date: Tue, 12 Jun 2012 10:18:19 -0600
Subject: [PATCH 08/19] emgd: Fix a failure to set a parameter.

A compiler warning exposed a potential problem in emgddc_init_devinfo().
A function GetDCBufferAddr() was assigned to a function pointer and the
function signatures didn't match.  The function was missing an 'is_mapped'
reference parameter that was added to the API at some point, which means
that 'is_mapped' could be left uninitialized across a successful call to
the function.  I fixed the function to add the parameter and set it to
a reasonable value.  I have no easy way to test the fix, but it should
be better than the original code.

Signed-off-by: Donn Seeley <donn.seeley@windriver.com>
---
 .../services4/3rdparty/emgd_displayclass/emgd_dc.c |    8 +++++++-
 1 file changed, 7 insertions(+), 1 deletion(-)

diff --git a/drivers/gpu/drm/emgd/pvr/services4/3rdparty/emgd_displayclass/emgd_dc.c b/drivers/gpu/drm/emgd/pvr/services4/3rdparty/emgd_displayclass/emgd_dc.c
index b7a879a2..6a09b27 100644
--- a/drivers/gpu/drm/emgd/pvr/services4/3rdparty/emgd_displayclass/emgd_dc.c
+++ b/drivers/gpu/drm/emgd/pvr/services4/3rdparty/emgd_displayclass/emgd_dc.c
@@ -451,6 +451,7 @@ static PVRSRV_ERROR GetDCInfo(IMG_HANDLE device_h, DISPLAY_INFO *dc_info)
  * the buffer.
  * @param os_map_info_h (OUT) Ununsed by PVR services.
  * @param is_contiguous (OUT) A pointer to a boolean that is set to IMG_FALSE,
+ * @param is_mapped (OUT) A pointer to a boolean that is set to IMG_FALSE,
  * because EMGD uses non-contiguous pages of memory for buffers.
  * @return PVRSRV_OK or a PVRSRV_ERROR enum value.
  */
@@ -460,7 +461,8 @@ static PVRSRV_ERROR GetDCBufferAddr(IMG_HANDLE device_h,
 	IMG_UINT32 *fb_size,
 	IMG_VOID **virt_addr,
 	IMG_HANDLE *os_map_info_h,
-	IMG_BOOL *is_contiguous)
+	IMG_BOOL *is_contiguous,
+	IMG_BOOL *is_mapped)
 {
 	emgddc_devinfo_t *devinfo;
 	igd_context_t *context;
@@ -549,6 +551,10 @@ static PVRSRV_ERROR GetDCBufferAddr(IMG_HANDLE device_h,
 		}
 	}
 
+	if (is_mapped) {
+		*is_mapped = IMG_FALSE;
+	}
+
 	EMGD_TRACE_EXIT;
 	return PVRSRV_OK;
 
-- 
1.7.9.7

