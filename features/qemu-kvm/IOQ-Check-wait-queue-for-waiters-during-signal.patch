From 35de2c32b6c16835ec833a694f3e32c17e37f4aa Mon Sep 17 00:00:00 2001
From: Gregory Haskins <ghaskins@novell.com>
Date: Mon, 21 Sep 2009 10:05:31 -0400
Subject: [PATCH 044/119] IOQ: Check wait-queue for waiters during signal

This will reduce some locking overhead/latency

Signed-off-by: Gregory Haskins <ghaskins@novell.com>
---
 lib/ioq.c |    4 +++-
 1 files changed, 3 insertions(+), 1 deletions(-)

diff --git a/lib/ioq.c b/lib/ioq.c
index af3090f..a6c8664 100644
--- a/lib/ioq.c
+++ b/lib/ioq.c
@@ -265,7 +265,9 @@ static void ioq_shm_signal(struct shm_signal_notifier *notifier)
 {
 	struct ioq *ioq = container_of(notifier, struct ioq, shm_notifier);
 
-	wake_up(&ioq->wq);
+	if (waitqueue_active(&ioq->wq))
+		wake_up(&ioq->wq);
+
 	if (ioq->notifier)
 		ioq->notifier->signal(ioq->notifier);
 }
-- 
1.6.5.2

