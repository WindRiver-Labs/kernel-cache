From 6f93d18e9897789c7c6d1e5e02db3868b3a16d59 Mon Sep 17 00:00:00 2001
From: Rahat Mahbub <rahat.mahbub@windriver.com>
Date: Mon, 14 Apr 2014 19:06:36 -0400
Subject: [PATCH] netmap: Add netmap to Kconfig and Makefile. Fix header paths.

This commit creates and includes netmap kernel Makefile and
Kconfig, thus linking it into the kernel overall make and config.
It also creates a new Makefle to build the netmap module and modifies
header paths.

Signed-off-by: Rahat Mahbub <rahat.mahbub@windriver.com>
[PG: refresh for 3.10 --> 3.14 carry forward.]
Signed-off-by: Paul Gortmaker <paul.gortmaker@windriver.com>

diff --git a/drivers/staging/Kconfig b/drivers/staging/Kconfig
index f9c7a6609688..8b36790de0b7 100644
--- a/drivers/staging/Kconfig
+++ b/drivers/staging/Kconfig
@@ -150,4 +150,6 @@ source "drivers/staging/lttng2/Kconfig"
 
 source "drivers/staging/r8168/Kconfig"
 
+source "drivers/staging/netmap/Kconfig"
+
 endif # STAGING
diff --git a/drivers/staging/Makefile b/drivers/staging/Makefile
index bee758fe8593..9722603d1875 100644
--- a/drivers/staging/Makefile
+++ b/drivers/staging/Makefile
@@ -66,4 +66,5 @@ obj-$(CONFIG_DGNC)			+= dgnc/
 obj-$(CONFIG_DGAP)			+= dgap/
 obj-$(CONFIG_LTTNG2)			+= lttng2/
 obj-$(CONFIG_MTD_SPINAND_MT29F)	+= mt29f_spinand/
+obj-$(CONFIG_NETMAP)            += netmap/
 obj-$(CONFIG_R8168)             += r8168/
diff --git a/drivers/staging/netmap/Kconfig b/drivers/staging/netmap/Kconfig
new file mode 100644
index 000000000000..b31bb4822601
--- /dev/null
+++ b/drivers/staging/netmap/Kconfig
@@ -0,0 +1,17 @@
+#
+# Netmap (and VALE)
+#
+
+config NETMAP
+	boolean "Netmap (and VALE)"
+	---help---
+	  NETMAP is a framework for fast packet I/O from userspace.
+	  VALE implements an equally fast software switch using the netmap API.
+	  Both can deal with line rate on real or emulated 10 Gbit ports.
+
+	  See details at:
+	    http://info.iet.unipi.it/~luigi/netmap/
+	    http://code.google.com/p/netmap/
+	    http://info.iet.unipi.it/~luigi/vale/
+
+	  If unsure, say N.
diff --git a/drivers/staging/netmap/LINUX/if_e1000_netmap.h b/drivers/staging/netmap/LINUX/if_e1000_netmap.h
index fb2da6e1a578..d6ae336fae48 100644
--- a/drivers/staging/netmap/LINUX/if_e1000_netmap.h
+++ b/drivers/staging/netmap/LINUX/if_e1000_netmap.h
@@ -31,9 +31,9 @@
  */
 
 
-#include <bsd_glue.h>
-#include <net/netmap.h>
-#include <netmap/netmap_kern.h>
+#include "bsd_glue.h"
+#include "../sys/net/netmap.h"
+#include "../sys/dev/netmap/netmap_kern.h"
 
 #define SOFTC_T	e1000_adapter
 
diff --git a/drivers/staging/netmap/LINUX/if_e1000e_netmap.h b/drivers/staging/netmap/LINUX/if_e1000e_netmap.h
index 52a66d71c94d..6fd4b5a17a98 100644
--- a/drivers/staging/netmap/LINUX/if_e1000e_netmap.h
+++ b/drivers/staging/netmap/LINUX/if_e1000e_netmap.h
@@ -35,9 +35,9 @@
  */
 
 
-#include <bsd_glue.h>
-#include <net/netmap.h>
-#include <netmap/netmap_kern.h>
+#include "bsd_glue.h"
+#include "../sys/net/netmap.h"
+#include "../sys/dev/netmap/netmap_kern.h"
 
 #define SOFTC_T	e1000_adapter
 
diff --git a/drivers/staging/netmap/LINUX/if_igb_netmap.h b/drivers/staging/netmap/LINUX/if_igb_netmap.h
index 0fdec89b8bdc..c1b08a3af1f6 100644
--- a/drivers/staging/netmap/LINUX/if_igb_netmap.h
+++ b/drivers/staging/netmap/LINUX/if_igb_netmap.h
@@ -31,9 +31,9 @@
  */
 
 
-#include <bsd_glue.h>
-#include <net/netmap.h>
-#include <netmap/netmap_kern.h>
+#include "bsd_glue.h"
+#include "../sys/net/netmap.h"
+#include "../sys/dev/netmap/netmap_kern.h"
 
 #define SOFTC_T	igb_adapter
 
diff --git a/drivers/staging/netmap/LINUX/ixgbe_netmap_linux.h b/drivers/staging/netmap/LINUX/ixgbe_netmap_linux.h
index 378b96c607dc..d6ce7cca5155 100644
--- a/drivers/staging/netmap/LINUX/ixgbe_netmap_linux.h
+++ b/drivers/staging/netmap/LINUX/ixgbe_netmap_linux.h
@@ -36,9 +36,9 @@
  */
 
 
-#include <bsd_glue.h>
-#include <net/netmap.h>
-#include <netmap/netmap_kern.h>
+#include "bsd_glue.h"
+#include "../sys/net/netmap.h"
+#include "../sys/dev/netmap/netmap_kern.h"
 
 #define SOFTC_T	ixgbe_adapter
 
diff --git a/drivers/staging/netmap/Makefile b/drivers/staging/netmap/Makefile
new file mode 100644
index 000000000000..3bec3e869b2b
--- /dev/null
+++ b/drivers/staging/netmap/Makefile
@@ -0,0 +1,11 @@
+#
+# Makefile for Netmap
+#
+
+remoteobjs := netmap.o netmap_mem2.o \
+        netmap_generic.o netmap_mbq.o netmap_vale.o \
+        netmap_offloadings.o netmap_pipe.o
+# all objects
+netmap_lin-objs := $(remoteobjs) netmap_linux.o
+
+obj-$(CONFIG_NETMAP) = netmap_lin.o
-- 
2.1.2

