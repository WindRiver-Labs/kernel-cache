From f185b0d1e1159f1eb280bc7bf1c7a04eab0deb02 Mon Sep 17 00:00:00 2001
From: Rahat Mahbub <rahat.mahbub@windriver.com>
Date: Mon, 14 Apr 2014 19:06:36 -0400
Subject: [PATCH] netmap: Add netmap to Kconfig and Makefile. Fix header paths.

This commit creates and includes netmap kernel Makefile and
Kconfig, thus linking it into the kernel overall make and config.
It also creates a new Makefle to build the netmap module and modifies
header paths.

Signed-off-by: Rahat Mahbub <rahat.mahbub@windriver.com>

diff --git a/drivers/staging/Kconfig b/drivers/staging/Kconfig
index 568d425..69b175b 100644
--- a/drivers/staging/Kconfig
+++ b/drivers/staging/Kconfig
@@ -142,4 +142,6 @@ source "drivers/staging/dwc2/Kconfig"
 
 source "drivers/staging/lttng2/Kconfig"
 
+source "drivers/staging/netmap/Kconfig"
+
 endif # STAGING
diff --git a/drivers/staging/Makefile b/drivers/staging/Makefile
index 09066fc..783b842 100644
--- a/drivers/staging/Makefile
+++ b/drivers/staging/Makefile
@@ -63,3 +63,4 @@ obj-$(CONFIG_ZCACHE)		+= zcache/
 obj-$(CONFIG_GOLDFISH)		+= goldfish/
 obj-$(CONFIG_USB_DWC2)		+= dwc2/
 obj-$(CONFIG_LTTNG2)		+= lttng2/
+obj-$(CONFIG_NETMAP)            += netmap/
diff --git a/drivers/staging/netmap/Kconfig b/drivers/staging/netmap/Kconfig
new file mode 100644
index 0000000..b31bb48
--- /dev/null
+++ b/drivers/staging/netmap/Kconfig
@@ -0,0 +1,17 @@
+#
+# Netmap (and VALE)
+#
+
+config NETMAP
+	boolean "Netmap (and VALE)"
+	---help---
+	  NETMAP is a framework for fast packet I/O from userspace.
+	  VALE implements an equally fast software switch using the netmap API.
+	  Both can deal with line rate on real or emulated 10 Gbit ports.
+
+	  See details at:
+	    http://info.iet.unipi.it/~luigi/netmap/
+	    http://code.google.com/p/netmap/
+	    http://info.iet.unipi.it/~luigi/vale/
+
+	  If unsure, say N.
diff --git a/drivers/staging/netmap/LINUX/if_e1000_netmap.h b/drivers/staging/netmap/LINUX/if_e1000_netmap.h
index b30661d..43d073c 100644
--- a/drivers/staging/netmap/LINUX/if_e1000_netmap.h
+++ b/drivers/staging/netmap/LINUX/if_e1000_netmap.h
@@ -31,9 +31,9 @@
  */
 
 
-#include <bsd_glue.h>
-#include <net/netmap.h>
-#include <netmap/netmap_kern.h>
+#include "bsd_glue.h"
+#include "../sys/net/netmap.h"
+#include "../sys/dev/netmap/netmap_kern.h"
 
 #define SOFTC_T	e1000_adapter
 
diff --git a/drivers/staging/netmap/LINUX/if_e1000e_netmap.h b/drivers/staging/netmap/LINUX/if_e1000e_netmap.h
index 24f3b76..85b2bda 100644
--- a/drivers/staging/netmap/LINUX/if_e1000e_netmap.h
+++ b/drivers/staging/netmap/LINUX/if_e1000e_netmap.h
@@ -35,9 +35,9 @@
  */
 
 
-#include <bsd_glue.h>
-#include <net/netmap.h>
-#include <netmap/netmap_kern.h>
+#include "bsd_glue.h"
+#include "../sys/net/netmap.h"
+#include "../sys/dev/netmap/netmap_kern.h"
 
 #define SOFTC_T	e1000_adapter
 
diff --git a/drivers/staging/netmap/LINUX/if_igb_netmap.h b/drivers/staging/netmap/LINUX/if_igb_netmap.h
index 189a937..dc3e326 100644
--- a/drivers/staging/netmap/LINUX/if_igb_netmap.h
+++ b/drivers/staging/netmap/LINUX/if_igb_netmap.h
@@ -31,9 +31,9 @@
  */
 
 
-#include <bsd_glue.h>
-#include <net/netmap.h>
-#include <netmap/netmap_kern.h>
+#include "bsd_glue.h"
+#include "../sys/net/netmap.h"
+#include "../sys/dev/netmap/netmap_kern.h"
 
 #define SOFTC_T	igb_adapter
 
diff --git a/drivers/staging/netmap/LINUX/ixgbe_netmap_linux.h b/drivers/staging/netmap/LINUX/ixgbe_netmap_linux.h
index e4ce396..e932db0 100644
--- a/drivers/staging/netmap/LINUX/ixgbe_netmap_linux.h
+++ b/drivers/staging/netmap/LINUX/ixgbe_netmap_linux.h
@@ -36,9 +36,9 @@
  */
 
 
-#include <bsd_glue.h>
-#include <net/netmap.h>
-#include <netmap/netmap_kern.h>
+#include "bsd_glue.h"
+#include "../sys/net/netmap.h"
+#include "../sys/dev/netmap/netmap_kern.h"
 
 #define SOFTC_T	ixgbe_adapter
 
diff --git a/drivers/staging/netmap/Makefile b/drivers/staging/netmap/Makefile
index ec5dab5..3bec3e8 100644
--- a/drivers/staging/netmap/Makefile
+++ b/drivers/staging/netmap/Makefile
@@ -1,30 +1,11 @@
-# $Id$
-# targets to build tarballs and diffs
+#
+# Makefile for Netmap
+#
 
-# build a distribution
+remoteobjs := netmap.o netmap_mem2.o \
+        netmap_generic.o netmap_mbq.o netmap_vale.o \
+        netmap_offloadings.o netmap_pipe.o
+# all objects
+netmap_lin-objs := $(remoteobjs) netmap_linux.o
 
-RELEASE_SRCS := ./sys/net ./sys/dev ./sys/modules ./examples
-RELEASE_SRCS += ./README* ./LINUX ./OSX
-RELEASE_EXCL := --exclude .svn --exclude examples/testmod
-RELEASE_EXCL += --exclude connlib\*
-RELEASE_EXCL += --exclude if_epair.diff
-#RELEASE_EXCL += --exclude \*-patches
-RELEASE_EXCL += --exclude \*bnx2x\* --exclude \*mellanox\* --exclude \*mlx4\*
-RELEASE_EXCL += --exclude OSX
-
-all:
-	@echo "What do you want to do ?"
-
-
-diff-head:
-	(cd ~/FreeBSD/head ; \
-	svn diff sys/conf sys/dev sbin/ifconfig ) > head-netmap.diff
-
-# XXX remember to patch sbin/ifconfig if not done yet
-diff-r8:
-	(cd ~/FreeBSD/RELENG_8 ; \
-	svn diff sys/conf sys/dev sbin/ifconfig ) > r8-netmap.diff
-
-release:
-	D=`date +%Y%m%d` && tar cvzf /tmp/$${D}-netmap.tgz \
-		-s'/^./netmap-release/' $(RELEASE_EXCL) $(RELEASE_SRCS)
+obj-$(CONFIG_NETMAP) = netmap_lin.o
-- 
1.8.2.3

