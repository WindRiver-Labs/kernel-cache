From 7d500a3293981041d8b1f172d0e2429d166a7fff Mon Sep 17 00:00:00 2001
From: Rahat Mahbub <rahat.mahbub@windriver.com>
Date: Tue, 22 Apr 2014 17:12:27 -0400
Subject: [PATCH] netmap: fix build error

This patch fixes the error: "make[5]: *** No rule to make target
`drivers/staging/netmap/netmap.o'"

A Makefile is only responsible for building objects in its own
directory. This creates a top Makefile that contains the location
of other Makefiles in subdirectories so it recursively does Make.
The Makefiles also included the header locations so the source files
doesn't need to be changed.

Signed-off-by: Rahat Mahbub <rahat.mahbub@windriver.com>

diff --git a/drivers/staging/netmap/LINUX/Makefile b/drivers/staging/netmap/LINUX/Makefile
new file mode 100644
index 0000000..a7db83c
--- /dev/null
+++ b/drivers/staging/netmap/LINUX/Makefile
@@ -0,0 +1,4 @@
+NETMAP_PATH := $(srctree)/drivers/staging/netmap
+ccflags-y += -I$(NETMAP_PATH)/sys/ -I$(NETMAP_PATH)/LINUX
+
+obj-$(CONFIG_NETMAP) += netmap_linux.o
diff --git a/drivers/staging/netmap/Makefile b/drivers/staging/netmap/Makefile
index 3bec3e8..ccc4f21 100644
--- a/drivers/staging/netmap/Makefile
+++ b/drivers/staging/netmap/Makefile
@@ -1,11 +1,5 @@
 #
 # Makefile for Netmap
 #
-
-remoteobjs := netmap.o netmap_mem2.o \
-        netmap_generic.o netmap_mbq.o netmap_vale.o \
-        netmap_offloadings.o netmap_pipe.o
-# all objects
-netmap_lin-objs := $(remoteobjs) netmap_linux.o
-
-obj-$(CONFIG_NETMAP) = netmap_lin.o
+obj-$(CONFIG_NETMAP) += sys/dev/netmap/
+obj-$(CONFIG_NETMAP) += LINUX/
diff --git a/drivers/staging/netmap/sys/dev/netmap/Makefile b/drivers/staging/netmap/sys/dev/netmap/Makefile
new file mode 100644
index 0000000..05df2c2
--- /dev/null
+++ b/drivers/staging/netmap/sys/dev/netmap/Makefile
@@ -0,0 +1,6 @@
+NETMAP_PATH := $(srctree)/drivers/staging/netmap
+ccflags-y += -I$(NETMAP_PATH)/sys/ -I$(NETMAP_PATH)/LINUX
+
+obj-$(CONFIG_NETMAP) += netmap.o netmap_mem2.o \
+        netmap_generic.o netmap_mbq.o netmap_vale.o \
+        netmap_offloadings.o netmap_pipe.o
-- 
1.8.2.3

