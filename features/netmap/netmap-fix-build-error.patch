From 2281bf79942a60b8db99907884d6a69e18bd4d4e Mon Sep 17 00:00:00 2001
From: Rahat Mahbub <rahat.mahbub@windriver.com>
Date: Tue, 22 Apr 2014 17:12:27 -0400
Subject: [PATCH] netmap: fix build error

This patch fixes the error: "make[5]: *** No rule to make target
`drivers/staging/netmap/netmap.o'"

A Makefile is only responsible for building objects in its own
directory. This creates a top Makefile that contains the location
of other Makefiles in subdirectories so it recursively does Make.
The Makefiles also included the header locations so the source files
doesn't need to be changed.

Signed-off-by: Rahat Mahbub <rahat.mahbub@windriver.com>
[PG: 3.10 ---> 3.14 carry forward.]
Signed-off-by: Paul Gortmaker <paul.gortmaker@windriver.com>

diff --git a/drivers/staging/netmap/LINUX/Makefile b/drivers/staging/netmap/LINUX/Makefile
new file mode 100644
index 000000000000..a7db83c188fc
--- /dev/null
+++ b/drivers/staging/netmap/LINUX/Makefile
@@ -0,0 +1,4 @@
+NETMAP_PATH := $(srctree)/drivers/staging/netmap
+ccflags-y += -I$(NETMAP_PATH)/sys/ -I$(NETMAP_PATH)/LINUX
+
+obj-$(CONFIG_NETMAP) += netmap_linux.o
diff --git a/drivers/staging/netmap/Makefile b/drivers/staging/netmap/Makefile
index 3bec3e869b2b..ccc4f2101512 100644
--- a/drivers/staging/netmap/Makefile
+++ b/drivers/staging/netmap/Makefile
@@ -1,11 +1,5 @@
 #
 # Makefile for Netmap
 #
-
-remoteobjs := netmap.o netmap_mem2.o \
-        netmap_generic.o netmap_mbq.o netmap_vale.o \
-        netmap_offloadings.o netmap_pipe.o
-# all objects
-netmap_lin-objs := $(remoteobjs) netmap_linux.o
-
-obj-$(CONFIG_NETMAP) = netmap_lin.o
+obj-$(CONFIG_NETMAP) += sys/dev/netmap/
+obj-$(CONFIG_NETMAP) += LINUX/
diff --git a/drivers/staging/netmap/sys/dev/netmap/Makefile b/drivers/staging/netmap/sys/dev/netmap/Makefile
new file mode 100644
index 000000000000..05df2c2f91c9
--- /dev/null
+++ b/drivers/staging/netmap/sys/dev/netmap/Makefile
@@ -0,0 +1,6 @@
+NETMAP_PATH := $(srctree)/drivers/staging/netmap
+ccflags-y += -I$(NETMAP_PATH)/sys/ -I$(NETMAP_PATH)/LINUX
+
+obj-$(CONFIG_NETMAP) += netmap.o netmap_mem2.o \
+        netmap_generic.o netmap_mbq.o netmap_vale.o \
+        netmap_offloadings.o netmap_pipe.o
-- 
2.1.2

