From e4050427ef9b25eb80905971b7ea13f36ddbfe85 Mon Sep 17 00:00:00 2001
From: Vu Tran <vu.tran@windriver.com>
Date: Fri, 11 Oct 2013 13:53:03 -0400
Subject: [PATCH] netmap: rtl8169 names changed cause build errors

There are errors while building rtl8169 netmap plugin driver due to the
newer version of rtl8169 driver which removes/changes some of the function
names used by netmap rtl8169 plugin driver.

Signed-off-by: Vu Tran <vu.tran@windriver.com>
---
 drivers/staging/netmap/if_re_netmap_linux.h | 10 ++++------
 1 file changed, 4 insertions(+), 6 deletions(-)

diff --git a/drivers/staging/netmap/if_re_netmap_linux.h b/drivers/staging/netmap/if_re_netmap_linux.h
index 98cba15..f0dcbda 100644
--- a/drivers/staging/netmap/if_re_netmap_linux.h
+++ b/drivers/staging/netmap/if_re_netmap_linux.h
@@ -38,7 +38,8 @@
 #include "netmap_kern.h"
 
 
-static void rtl8169_wait_for_quiescence(struct ifnet *);
+static int rtl8169_close(struct net_device *dev);
+static int rtl_open(struct net_device *dev);
 #define SOFTC_T	rtl8169_private
 
 
@@ -53,8 +54,6 @@ re_netmap_reg(struct ifnet *ifp, int onoff)
 
 	if (na == NULL)
 		return EINVAL;
-	rtnl_lock();
-	rtl8169_wait_for_quiescence(ifp);
 	rtl8169_close(ifp);
 
 	if (onoff) { /* enable netmap mode */
@@ -62,7 +61,7 @@ re_netmap_reg(struct ifnet *ifp, int onoff)
 		na->if_transmit = (void *)ifp->netdev_ops;
 		ifp->netdev_ops = &na->nm_ndo;
 
-		if (rtl8169_open(ifp) < 0) {
+		if (rtl_open(ifp) < 0) {
 			error = ENOMEM;
 			goto fail;
 		}
@@ -70,9 +69,8 @@ re_netmap_reg(struct ifnet *ifp, int onoff)
 fail:
 		ifp->if_capenable &= ~IFCAP_NETMAP;
 		ifp->netdev_ops = (void *)na->if_transmit;
-		error = rtl8169_open(ifp) ? EINVAL : 0;
+		error = rtl_open(ifp) ? EINVAL : 0;
 	}
-	rtnl_unlock();
 	return (error);
 }
 
-- 
1.8.4

