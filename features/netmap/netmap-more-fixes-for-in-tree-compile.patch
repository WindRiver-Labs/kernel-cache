From cb72b87c0211bc50c17284ae5927a4d1e077c734 Mon Sep 17 00:00:00 2001
From: Jim Somerville <Jim.Somerville@windriver.com>
Date: Thu, 29 Jan 2015 10:10:24 -0500
Subject: [PATCH] netmap: more fixes for in-tree compile

Hardcode the vale, pipes, generic, and monitor
config options to be on.

Clean up the now unnecessary CONFIG options in the
Makefiles.

Signed-off-by: Jim Somerville <Jim.Somerville@windriver.com>

diff --git a/drivers/staging/netmap/LINUX/Kbuild.in b/drivers/staging/netmap/LINUX/Kbuild.in
index 1a1010182c3a..a887adad5f64 100644
--- a/drivers/staging/netmap/LINUX/Kbuild.in
+++ b/drivers/staging/netmap/LINUX/Kbuild.in
@@ -10,10 +10,10 @@ $(foreach s,$(SUBSYS),$(eval CONFIG_NETMAP_$(shell echo $s|tr a-z A-Z)=y))
 
 remoteobjs-y := netmap_mem2.o netmap_mbq.o
 
-remoteobjs-$(CONFIG_NETMAP_VALE)    += netmap_vale.o netmap_offloadings.o
-remoteobjs-$(CONFIG_NETMAP_PIPE)    += netmap_pipe.o
-remoteobjs-$(CONFIG_NETMAP_MONITOR) += netmap_monitor.o
-remoteobjs-$(CONFIG_NETMAP_GENERIC) += netmap_generic.o
+remoteobjs-y                        += netmap_vale.o netmap_offloadings.o
+remoteobjs-y                        += netmap_pipe.o
+remoteobjs-y                        += netmap_monitor.o
+remoteobjs-y                        += netmap_generic.o
 
 define remote_template
 $$(obj)/$(1): $$(SRCDIR)/../sys/dev/netmap/$(2) FORCE
diff --git a/drivers/staging/netmap/LINUX/Makefile b/drivers/staging/netmap/LINUX/Makefile
index 98d05447dc23..c5d82dd820ee 100644
--- a/drivers/staging/netmap/LINUX/Makefile
+++ b/drivers/staging/netmap/LINUX/Makefile
@@ -1,4 +1,4 @@
 NETMAP_PATH := $(srctree)/drivers/staging/netmap
-ccflags-y += -I$(NETMAP_PATH)/sys/ -I$(NETMAP_PATH)/LINUX -DCONFIG_NETMAP -DCONFIG_NETMAP_GENERIC -DCONFIG_NETMAP_MONITOR -DCONFIG_NETMAP_PIPE -DCONFIG_NETMAP_VALE
+ccflags-y += -I$(NETMAP_PATH)/sys/ -I$(NETMAP_PATH)/LINUX -DCONFIG_NETMAP
 
 obj-$(CONFIG_NETMAP) += netmap_linux.o
diff --git a/drivers/staging/netmap/sys/dev/netmap/Makefile b/drivers/staging/netmap/sys/dev/netmap/Makefile
index 48d19fb41a44..fcac9c885ca7 100644
--- a/drivers/staging/netmap/sys/dev/netmap/Makefile
+++ b/drivers/staging/netmap/sys/dev/netmap/Makefile
@@ -1,6 +1,7 @@
 NETMAP_PATH := $(srctree)/drivers/staging/netmap
-ccflags-y += -I$(NETMAP_PATH)/sys/ -I$(NETMAP_PATH)/LINUX -DCONFIG_NETMAP -DCONFIG_NETMAP_GENERIC -DCONFIG_NETMAP_MONITOR -DCONFIG_NETMAP_PIPE -DCONFIG_NETMAP_VALE
+ccflags-y += -I$(NETMAP_PATH)/sys/ -I$(NETMAP_PATH)/LINUX -DCONFIG_NETMAP
 
 obj-$(CONFIG_NETMAP) += netmap.o netmap_mem2.o \
-        netmap_generic.o netmap_mbq.o netmap_vale.o \
-        netmap_offloadings.o netmap_pipe.o netmap_monitor.o
+        netmap_mbq.o netmap_vale.o \
+        netmap_offloadings.o netmap_pipe.o \
+        netmap_generic.o netmap_monitor.o
diff --git a/drivers/staging/netmap/sys/dev/netmap/netmap_kern.h b/drivers/staging/netmap/sys/dev/netmap/netmap_kern.h
index 24352a507fef..c63eff4217c2 100644
--- a/drivers/staging/netmap/sys/dev/netmap/netmap_kern.h
+++ b/drivers/staging/netmap/sys/dev/netmap/netmap_kern.h
@@ -36,18 +36,11 @@
 
 #if defined(linux)
 
-#if  defined(CONFIG_NETMAP_VALE)
 #define WITH_VALE
-#endif
-#if defined(CONFIG_NETMAP_PIPE)
 #define WITH_PIPES
-#endif
-#if defined(CONFIG_NETMAP_MONITOR)
 #define WITH_MONITOR
-#endif
-#if defined(CONFIG_NETMAP_GENERIC)
 #define WITH_GENERIC
-#endif
+
 #if defined(CONFIG_NETMAP_V1000)
 #define WITH_V1000
 #endif
-- 
1.9.1

