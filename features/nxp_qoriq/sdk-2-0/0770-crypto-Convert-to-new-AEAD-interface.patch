From 6dd41cb1bfebcff21b088bc9c9b9cc067bb7051a Mon Sep 17 00:00:00 2001
From: Yanjiang Jin <yanjiang.jin@windriver.com>
Date: Mon, 31 Oct 2016 15:23:30 +0800
Subject: [PATCH 770/771] crypto: Convert to new AEAD interface

This patch converts testmgr and cryptlib to the new AEAD interface,
it is to fix the below error:

crypto/testmgr.c:1090:3: error: implicit declaration of function 'aead_request_set_assoc' [-Werror=implicit-function-declaration]
    aead_request_set_assoc(req, asg, template[i].alen);
    ^

Signed-off-by: Yanjiang Jin <yanjiang.jin@windriver.com>
---
 crypto/testmgr.c                            | 2 +-
 drivers/staging/crypto/cryptodev/cryptlib.h | 2 +-
 2 files changed, 2 insertions(+), 2 deletions(-)

diff --git a/crypto/testmgr.c b/crypto/testmgr.c
index 5565975..08fcc84 100644
--- a/crypto/testmgr.c
+++ b/crypto/testmgr.c
@@ -1087,7 +1087,7 @@ static int __test_tls(struct crypto_aead *tfm, int enc,
 		}
 
 		sg_init_one(&asg[0], assoc, template[i].alen);
-		aead_request_set_assoc(req, asg, template[i].alen);
+		aead_request_set_ad(req, template[i].alen);
 		aead_request_set_crypt(req, sg, (diff_dst) ? sgout : sg,
 				       template[i].ilen, iv);
 
diff --git a/drivers/staging/crypto/cryptodev/cryptlib.h b/drivers/staging/crypto/cryptodev/cryptlib.h
index a0a8a63..0c20092 100644
--- a/drivers/staging/crypto/cryptodev/cryptlib.h
+++ b/drivers/staging/crypto/cryptodev/cryptlib.h
@@ -40,7 +40,7 @@ static inline void cryptodev_cipher_auth(struct cipher_data *cdata,
 					 struct scatterlist *sg1, size_t len)
 {
 	/* for some reason we _have_ to call that even for zero length sgs */
-	aead_request_set_assoc(cdata->async.arequest, len ? sg1 : NULL, len);
+	aead_request_set_ad(cdata->async.arequest, len);
 }
 
 static inline void cryptodev_cipher_set_tag_size(struct cipher_data *cdata, int size)
-- 
2.0.2

