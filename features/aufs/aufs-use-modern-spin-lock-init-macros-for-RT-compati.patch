From 63443bbf417e78a12c6abe1f487d2681c508e47e Mon Sep 17 00:00:00 2001
From: Paul Gortmaker <paul.gortmaker@windriver.com>
Date: Fri, 11 Jul 2014 15:52:30 -0400
Subject: [PATCH] aufs: use modern spin lock init macros for RT compatibility
MIME-Version: 1.0
Content-Type: text/plain; charset=UTF-8
Content-Transfer-Encoding: 8bit

To fix:

tree-pub$make -j50 fs/aufs/ > /dev/null
fs/aufs/f_op_sp.c:34:2: error: implicit declaration of function ‘__SPIN_LOCK_INITIALIZER’ [-Werror=implicit-function-declaration]
  .spin = __SPIN_LOCK_INITIALIZER(au_finfo_sp.spin),
  ^
fs/aufs/f_op_sp.c:34:2: warning: missing braces around initializer [-Wmissing-braces]
fs/aufs/f_op_sp.c:34:2: warning: (near initialization for ‘au_finfo_sp.spin’) [-Wmissing-braces]
fs/aufs/f_op_sp.c:34:2: error: initializer element is not constant
fs/aufs/f_op_sp.c:34:2: error: (near initialization for ‘au_finfo_sp.spin.lock.wait_lock.raw_lock.<anonymous>.head_tail’)
cc1: some warnings being treated as errors
make[1]: *** [fs/aufs/f_op_sp.o] Error 1

...we replace the old INITIALIZER with the more modern UNLOCKED
variant.

Signed-off-by: Paul Gortmaker <paul.gortmaker@windriver.com>
---
 fs/aufs/f_op_sp.c | 2 +-
 1 file changed, 1 insertion(+), 1 deletion(-)

diff --git a/fs/aufs/f_op_sp.c b/fs/aufs/f_op_sp.c
index 1753ea16ee1e..52bacd3a4369 100644
--- a/fs/aufs/f_op_sp.c
+++ b/fs/aufs/f_op_sp.c
@@ -31,7 +31,7 @@
  * given file.
  */
 static struct au_sphlhead au_finfo_sp = {
-	.spin	= __SPIN_LOCK_INITIALIZER(au_finfo_sp.spin),
+	.spin	= __SPIN_LOCK_UNLOCKED(au_finfo_sp.spin),
 	.head	= HLIST_HEAD_INIT
 };
 
-- 
2.0.1

