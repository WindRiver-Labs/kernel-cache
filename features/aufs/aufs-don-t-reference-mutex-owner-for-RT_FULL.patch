From 22122efc41ce96cd76a7ab73179e8001c74071e6 Mon Sep 17 00:00:00 2001
From: Paul Gortmaker <paul.gortmaker@windriver.com>
Date: Fri, 11 Jul 2014 14:53:48 -0400
Subject: [PATCH] aufs: don't reference mutex->owner for RT_FULL

If RT_FULL is set, we source <linux/mutex_rt.h> instead of the
normal definitions for struct mutex in <linux/mutex.h> and the
RT variant doesn't have an owner field.

Ensure aufs doesn't go after ->owner when RT_FULL is enabled.

Signed-off-by: Paul Gortmaker <paul.gortmaker@windriver.com>

diff --git a/fs/aufs/i_op.c b/fs/aufs/i_op.c
index 036a54ade073..20b4a1e74c47 100644
--- a/fs/aufs/i_op.c
+++ b/fs/aufs/i_op.c
@@ -433,9 +433,11 @@ out:
 
 void au_pin_hdir_set_owner(struct au_pin *p, struct task_struct *task)
 {
+#ifndef CONFIG_PREEMPT_RT_FULL
 #if defined(CONFIG_DEBUG_MUTEXES) || defined(CONFIG_SMP)
 	p->hdir->hi_inode->i_mutex.owner = task;
 #endif
+#endif
 }
 
 void au_pin_hdir_acquire_nest(struct au_pin *p)
-- 
2.1.2

