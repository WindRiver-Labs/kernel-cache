From c2504986ae3c5bed8fc274d445d68659a9137e64 Mon Sep 17 00:00:00 2001
From: Paul Gortmaker <paul.gortmaker@windriver.com>
Date: Wed, 29 Apr 2015 15:20:49 -0400
Subject: [PATCH] aufs: fix build fail caused by stable backport.

Stable 3.10.76 brings in this:

  commit 6637ecd306a94a03dd5b8e4e8d3f260d9877c5b0
  Author: Al Viro <viro@zeniv.linux.org.uk>
  Date:   Sun Oct 26 19:19:16 2014 -0400

    move d_rcu from overlapping d_child to overlapping d_alias

    commit 946e51f2bf37f1656916eb75bd0742ba33983c28 upstream.

..but since aufs is out of tree, it didn't get updated accordingly, and
hence compile fails on invalid references to d_child.

Updte it in the manner that all the rest of the filesystem types were.

Signed-off-by: Paul Gortmaker <paul.gortmaker@windriver.com>

diff --git a/fs/aufs/dcsub.c b/fs/aufs/dcsub.c
index 5b3d904ee625..bb02c7024f27 100644
--- a/fs/aufs/dcsub.c
+++ b/fs/aufs/dcsub.c
@@ -134,7 +134,7 @@ resume:
 	while (next != &this_parent->d_subdirs) {
 		struct list_head *tmp = next;
 		struct dentry *dentry = list_entry(tmp, struct dentry,
-						   d_u.d_child);
+						   d_child);
 
 		next = tmp->next;
 		spin_lock_nested(&dentry->d_lock, DENTRY_D_LOCK_NESTED);
@@ -170,7 +170,7 @@ resume:
 		this_parent = tmp;
 		spin_lock(&this_parent->d_lock);
 		rcu_read_unlock();
-		next = child->d_u.d_child.next;
+		next = child->d_child.next;
 		goto resume;
 	}
 
diff --git a/fs/aufs/hnotify.c b/fs/aufs/hnotify.c
index b7f7a95512e4..c60c030161c2 100644
--- a/fs/aufs/hnotify.c
+++ b/fs/aufs/hnotify.c
@@ -378,7 +378,7 @@ static struct dentry *lookup_wlock_by_name(char *name, unsigned int nlen,
 
 	dentry = NULL;
 	spin_lock(&parent->d_lock);
-	list_for_each_entry(d, &parent->d_subdirs, d_u.d_child) {
+	list_for_each_entry(d, &parent->d_subdirs, d_child) {
 		/* AuDbg("%.*s\n", AuDLNPair(d)); */
 		spin_lock_nested(&d->d_lock, DENTRY_D_LOCK_NESTED);
 		dname = &d->d_name;
-- 
2.1.0

