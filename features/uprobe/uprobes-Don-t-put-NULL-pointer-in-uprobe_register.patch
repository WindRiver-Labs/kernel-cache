From 44684d43ae4ffaf5a44427fad0ea4551ab9dd62c Mon Sep 17 00:00:00 2001
From: Sebastian Andrzej Siewior <bigeasy@linutronix.de>
Date: Thu, 30 Aug 2012 19:26:22 +0200
Subject: [PATCH 46/60] uprobes: Don't put NULL pointer in uprobe_register()

commit 6d1d8dfa8b65831cfa9a528e3d17efa7e7f4226c upstream.

alloc_uprobe() might return a NULL pointer, put_uprobe() can't deal with
this.

Signed-off-by: Sebastian Andrzej Siewior <bigeasy@linutronix.de>
Signed-off-by: Oleg Nesterov <oleg@redhat.com>
Acked-by: Srikar Dronamraju <srikar@linux.vnet.ibm.com>
Signed-off-by: Paul Barrette <paul.barrette@windriver.com>
---
 kernel/events/uprobes.c |    3 ++-
 1 file changed, 2 insertions(+), 1 deletion(-)

diff --git a/kernel/events/uprobes.c b/kernel/events/uprobes.c
index fb2e419..1850dab 100644
--- a/kernel/events/uprobes.c
+++ b/kernel/events/uprobes.c
@@ -902,7 +902,8 @@ int uprobe_register(struct inode *inode, loff_t offset, struct uprobe_consumer *
 	}
 
 	mutex_unlock(uprobes_hash(inode));
-	put_uprobe(uprobe);
+	if (uprobe)
+		put_uprobe(uprobe);
 
 	return ret;
 }
-- 
1.7.9.7

