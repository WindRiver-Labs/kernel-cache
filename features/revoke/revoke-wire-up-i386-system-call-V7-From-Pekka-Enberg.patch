From 1957c5ae1c0a3db3faaa6ad84804f99900c3a236 Mon Sep 17 00:00:00 2001
From: Yongli He <yongli.he@windriver.com>
Date: Mon, 25 Aug 2008 11:27:58 +0800
Subject: [PATCH] revoke wire up i386 system call V7 From: Pekka Enberg <penberg@cs.helsinki.fi>

Make revokeat system call available to user-space on i386.

[akpm@linux-foundation.org: fix 32-bit userspace]
Cc: Alan Cox <alan@redhat.com>
Cc: Al Viro <viro@zeniv.linux.org.uk>
Cc: Christoph Hellwig <hch@infradead.org>
Cc: Peter Zijlstra <peterz@infradead.org>
Signed-off-by: Pekka Enberg <penberg@cs.helsinki.fi>
Integrated-by: Yongli he   <yongli.he@windriver.com>
---
 arch/x86/ia32/ia32entry.S          |    1 +
 arch/x86/include/asm/unistd_32.h   |    3 ++-
 arch/x86/kernel/syscall_table_32.S |    1 +
 3 files changed, 4 insertions(+), 1 deletions(-)

diff --git a/arch/x86/ia32/ia32entry.S b/arch/x86/ia32/ia32entry.S
index 349547f..c0ae489 100644
--- a/arch/x86/ia32/ia32entry.S
+++ b/arch/x86/ia32/ia32entry.S
@@ -931,4 +931,5 @@ ia32_sys_call_table:
 	.quad sys_sched_setparam_ex
 	.quad sys_sched_getparam_ex		/* 340 */
 	.quad sys_sched_wait_interval
+	.quad sys_revokeat		
 ia32_syscall_end:
diff --git a/arch/x86/include/asm/unistd_32.h b/arch/x86/include/asm/unistd_32.h
index b969e56..b36d55a 100644
--- a/arch/x86/include/asm/unistd_32.h
+++ b/arch/x86/include/asm/unistd_32.h
@@ -343,7 +343,8 @@
 #define __NR_rt_tgsigqueueinfo	335
 #define __NR_perf_event_open	336
 #define __NR_recvmmsg		337
-#define __NR_vbi_mem		338
+#define __NR_revokeat		338
+#define __NR_vbi_mem		339
 #define __NR_vbi_activate_vb	339
 #define __NR_vbi_control		340
 #define __NR_sched_setscheduler_ex	341
diff --git a/arch/x86/kernel/syscall_table_32.S b/arch/x86/kernel/syscall_table_32.S
index f25bdb5..900bd58 100644
--- a/arch/x86/kernel/syscall_table_32.S
+++ b/arch/x86/kernel/syscall_table_32.S
@@ -338,6 +338,7 @@ ENTRY(sys_call_table)
 	.long sys_rt_tgsigqueueinfo	/* 335 */
 	.long sys_perf_event_open
 	.long sys_recvmmsg
+	.long sys_revokeat
 	.long sys_vbi_mem		/* 338 */
 	.long sys_vbi_activate_vb	/* 339 */
 	.long sys_vbi_control		/* 340 */
-- 
1.7.0.2

