From f0f27addfe2b0ac48dffdf39b0700c896677a42b Mon Sep 17 00:00:00 2001
From: Bruce Ashfield <bruce.ashfield@windriver.com>
Date: Wed, 2 Jun 2010 00:31:33 -0400
Subject: [PATCH] revoke: mips: syscall wireups

Signed-off-by: Bruce Ashfield <bruce.ashfield@windriver.com>
---
 arch/mips/include/asm/unistd.h |   15 ++++++++++-----
 arch/mips/kernel/scall32-o32.S |    1 +
 arch/mips/kernel/scall64-64.S  |    1 +
 arch/mips/kernel/scall64-n32.S |    1 +
 arch/mips/kernel/scall64-o32.S |    1 +
 5 files changed, 14 insertions(+), 5 deletions(-)

diff --git a/arch/mips/include/asm/unistd.h b/arch/mips/include/asm/unistd.h
index 853b65a..9ce639c 100644
--- a/arch/mips/include/asm/unistd.h
+++ b/arch/mips/include/asm/unistd.h
@@ -365,16 +365,17 @@
 #define SYS_VBI_VB_SUSPEND		0x10001
 #define SYS_VBI_VB_RESUME		0x20002
 #define SYS_VBI_VB_RESTART		0x40004
+#define __NR_revokeat			(__NR_Linux + 339)
 
 /*
  * Offset of the last Linux o32 flavoured syscall
  */
-#define __NR_Linux_syscalls		338
+#define __NR_Linux_syscalls		339
 
 #endif /* _MIPS_SIM == _MIPS_SIM_ABI32 */
 
 #define __NR_O32_Linux			4000
-#define __NR_O32_Linux_syscalls		338
+#define __NR_O32_Linux_syscalls		339
 
 #if _MIPS_SIM == _MIPS_SIM_ABI64
 
@@ -687,15 +688,17 @@
 #define SYS_VBI_VB_RESUME		0x20002
 #define SYS_VBI_VB_RESTART		0x40004
 
+#define __NR_revokeat			(__NR_Linux + 298)
+
 /*
  * Offset of the last Linux 64-bit flavoured syscall
  */
-#define __NR_Linux_syscalls		297
+#define __NR_Linux_syscalls		298
 
 #endif /* _MIPS_SIM == _MIPS_SIM_ABI64 */
 
 #define __NR_64_Linux			5000
-#define __NR_64_Linux_syscalls		297
+#define __NR_64_Linux_syscalls		298
 
 #if _MIPS_SIM == _MIPS_SIM_NABI32
 
@@ -1013,10 +1016,12 @@
 #define SYS_VBI_VB_RESUME		0x20002
 #define SYS_VBI_VB_RESTART		0x40004
 
+#define __NR_revokeat			(__NR_Linux + 303)
+
 /*
  * Offset of the last N32 flavoured syscall
  */
-#define __NR_Linux_syscalls		302
+#define __NR_Linux_syscalls		303
 
 #endif /* _MIPS_SIM == _MIPS_SIM_NABI32 */
 
diff --git a/arch/mips/kernel/scall32-o32.S b/arch/mips/kernel/scall32-o32.S
index 79639f8..b894edb 100644
--- a/arch/mips/kernel/scall32-o32.S
+++ b/arch/mips/kernel/scall32-o32.S
@@ -585,6 +585,7 @@ einval:	li	v0, -ENOSYS
 	sys	sys_perf_event_open	5
 	sys	sys_accept4		4
 	sys     sys_recvmmsg            5
+	sys     sys_revokeat            2
 	.endm
 
 	/* We pre-compute the number of _instruction_ bytes needed to
diff --git a/arch/mips/kernel/scall64-64.S b/arch/mips/kernel/scall64-64.S
index bf00e44..5f377f4 100644
--- a/arch/mips/kernel/scall64-64.S
+++ b/arch/mips/kernel/scall64-64.S
@@ -428,4 +428,5 @@ EXPORT(sys_call_table)
 	PTR	sys_perf_event_open
 	PTR	sys_accept4
 	PTR     sys_recvmmsg
+	PTR     sys_revokeat        
 	.size	sys_call_table,.-sys_call_table
diff --git a/arch/mips/kernel/scall64-n32.S b/arch/mips/kernel/scall64-n32.S
index 515390a..fc11166 100644
--- a/arch/mips/kernel/scall64-n32.S
+++ b/arch/mips/kernel/scall64-n32.S
@@ -428,4 +428,5 @@ EXPORT(sysn32_call_table)
 	PTR	sys_accept4
 	PTR     compat_sys_recvmmsg
 	PTR     sys_getdents64
+	PTR     sys_revokeat            
 	.size	sysn32_call_table,.-sysn32_call_table
diff --git a/arch/mips/kernel/scall64-o32.S b/arch/mips/kernel/scall64-o32.S
index 4079891..8223cb9 100644
--- a/arch/mips/kernel/scall64-o32.S
+++ b/arch/mips/kernel/scall64-o32.S
@@ -544,4 +544,5 @@ EXPORT(syso32_call_table)
 	PTR	sys_perf_event_open
 	PTR	sys_accept4
 	PTR     compat_sys_recvmmsg
+	PTR     sys_revokeat            
 	.size	sys_call_table,.-sys_call_table
-- 
1.6.0.3

