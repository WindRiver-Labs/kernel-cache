From df8c3e502e7bf0ed1453e111fbf0216246f2043d Mon Sep 17 00:00:00 2001
From: Ivar Holmqvist <ivarholmqvist@gmail.com>
Date: Tue, 17 Apr 2012 17:59:15 +0200
Subject: [PATCH 02/22] simicsfs: Replace obsolete d_alloc_root with d_make_root.

[Original patch is from simics-pkg-12514-4.8.1-linux64.tar]

Signed-off-by: Ruan Zhengwang <zhengwang.ruan@windriver.com>
---
 fs/simicsfs/hostfs_super.c |    3 +--
 1 files changed, 1 insertions(+), 2 deletions(-)

diff --git a/fs/simicsfs/hostfs_super.c b/fs/simicsfs/hostfs_super.c
index ec62795..87d613c 100644
--- a/fs/simicsfs/hostfs_super.c
+++ b/fs/simicsfs/hostfs_super.c
@@ -87,7 +87,7 @@ hostfs_read_super(struct super_block *sb, void *data, int silent)
                 goto out_fail;
         root_inode->i_ino = HOSTFS_ROOT_INO;
         hostfs_read_inode(root_inode);
-        sb->s_root = d_alloc_root(root_inode);
+        sb->s_root = d_make_root(root_inode);
         if (!sb->s_root)
                 goto out_no_root;
 
@@ -99,7 +99,6 @@ hostfs_read_super(struct super_block *sb, void *data, int silent)
 
  out_no_root:
         printk(DEVICE_NAME " get root inode failed\n");
-        iput(root_inode);
 
  out_fail:
 #ifndef KERNEL_2_6
-- 
1.7.1

