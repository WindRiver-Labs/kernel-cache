From cfd2daeb6e61cb4233abf29b13d3fe8683492591 Mon Sep 17 00:00:00 2001
From: Ivar Holmqvist <ivarholmqvist@gmail.com>
Date: Fri, 9 Mar 2012 09:28:16 +0100
Subject: [PATCH 06/22] qsp-ppc: Enable powersave-nap early for qsp.

[Original patch is from simics-pkg-12514-4.8.1-linux64.tar]

Signed-off-by: Ruan Zhengwang <zhengwang.ruan@windriver.com>
---
 arch/powerpc/kernel/idle.c |    7 +++++++
 1 files changed, 7 insertions(+), 0 deletions(-)

diff --git a/arch/powerpc/kernel/idle.c b/arch/powerpc/kernel/idle.c
index 04d7909..0c99101 100644
--- a/arch/powerpc/kernel/idle.c
+++ b/arch/powerpc/kernel/idle.c
@@ -132,7 +132,14 @@ void cpu_idle_wait(void)
 }
 EXPORT_SYMBOL_GPL(cpu_idle_wait);
 
+#ifdef CONFIG_QSP
+/* Enabling powersave early makes a huge difference for
+ * SMP boot speed on simulated systems.
+ */
+int powersave_nap = 1;
+#else
 int powersave_nap;
+#endif
 
 #ifdef CONFIG_SYSCTL
 /*
-- 
1.7.1

