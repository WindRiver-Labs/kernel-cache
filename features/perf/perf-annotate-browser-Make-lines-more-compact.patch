From e2612a6a16acc3bcb313aae08465be20f164dea3 Mon Sep 17 00:00:00 2001
From: Arnaldo Carvalho de Melo <acme@redhat.com>
Date: Thu, 19 Apr 2012 15:07:46 -0300
Subject: [PATCH] perf annotate browser: Make lines more compact

commit 8bf39cb81bdad01ad0d830e8c3639b9e8f552d57 upstream.

But now we have a lot of space on the right...

Perhaps we should add a "Trending on G+" gizmo... ;-)

Requested-by: Linus Torvalds <torvalds@linux-foundation.org>
Cc: David Ahern <dsahern@gmail.com>
Cc: Frederic Weisbecker <fweisbec@gmail.com>
Cc: Linus Torvalds <torvalds@linux-foundation.org>
Cc: Mike Galbraith <efault@gmx.de>
Cc: Namhyung Kim <namhyung@gmail.com>
Cc: Paul Mackerras <paulus@samba.org>
Cc: Peter Zijlstra <peterz@infradead.org>
Cc: Stephane Eranian <eranian@google.com>
Link: http://lkml.kernel.org/n/tip-igoynvtg2wc6mdfinc69prp6@git.kernel.org
Signed-off-by: Arnaldo Carvalho de Melo <acme@redhat.com>
Signed-off-by: Paul Barrette <paul.barrette@windriver.com>

diff --git a/tools/perf/ui/browsers/annotate.c b/tools/perf/ui/browsers/annotate.c
index c5ab21c..34b86ea 100644
--- a/tools/perf/ui/browsers/annotate.c
+++ b/tools/perf/ui/browsers/annotate.c
@@ -82,11 +82,11 @@ static void annotate_browser__write(struct ui_browser *self, void *entry, int ro
 		ui_browser__set_color(self, HE_COLORSET_CODE);
 
 	if (!*dl->line)
-		slsmg_write_nstring(" ", width - 18);
+		slsmg_write_nstring(" ", width - 10);
 	else if (dl->offset == -1)
-		slsmg_write_nstring(dl->line, width - 18);
+		slsmg_write_nstring(dl->line, width - 10);
 	else {
-		char bf[256], *line = dl->line;
+		char bf[256];
 		u64 addr = dl->offset;
 		int printed, color = -1;
 
@@ -114,12 +114,12 @@ static void annotate_browser__write(struct ui_browser *self, void *entry, int ro
 			dl->ins->ops->scnprintf(dl->ins, bf, sizeof(bf),
 						!ab->use_offset ? dl->operands : NULL,
 						dl->target);
-			line = bf;
-			slsmg_write_nstring(" ", 7);
-			printed += 7;
-		}
+			slsmg_write_nstring(" ", 2);
+			printed += 2;
+		} else
+			scnprintf(bf, sizeof(bf), "  %-6.6s %s", dl->name, dl->operands);
 
-		slsmg_write_nstring(line, width - 18 - printed);
+		slsmg_write_nstring(bf, width - 10 - printed);
 	}
 
 	if (current_entry)
@@ -653,6 +653,7 @@ int symbol__tui_annotate(struct symbol *sym, struct map *map, int evidx,
 			.priv	 = &ms,
 			.use_navkeypressed = true,
 		},
+		.use_offset = true,
 	};
 	int ret = -1;
 
-- 
1.8.1.2

