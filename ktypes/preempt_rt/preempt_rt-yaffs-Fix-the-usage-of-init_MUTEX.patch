From d8134f52b38dda404fbd0fa974883c921701c81d Mon Sep 17 00:00:00 2001
From: Mark Asselstine <mark.asselstine@windriver.com>
Date: Fri, 17 Sep 2010 01:13:07 -0400
Subject: [PATCH 03/43] preempt_rt: yaffs: Fix the usage of init_MUTEX*

init_MUTEX* should be converted to sema_init() in preempt_rt, this patch
fixes all of the related usage in yaffs.

Without this patch, we may get the error of "implicit declaration of
function 'init_MUTEX'".

Signed-off-by: Wu Zhangjin <zhangjin.wu@windriver.com>
---
 fs/yaffs2/yaffs_fs.c |    4 ++--
 1 files changed, 2 insertions(+), 2 deletions(-)

diff --git a/fs/yaffs2/yaffs_fs.c b/fs/yaffs2/yaffs_fs.c
index 9983464..db4f26b 100644
--- a/fs/yaffs2/yaffs_fs.c
+++ b/fs/yaffs2/yaffs_fs.c
@@ -2493,7 +2493,7 @@ static struct super_block *yaffs_internal_read_super(int yaffsVersion,
         YINIT_LIST_HEAD(&(yaffs_DeviceToContext(dev)->searchContexts));
         param->removeObjectCallback = yaffs_RemoveObjectCallback;
 
-	init_MUTEX(&(yaffs_DeviceToContext(dev)->grossLock));
+	sema_init(&(yaffs_DeviceToContext(dev)->grossLock), 1);
 
 	yaffs_GrossLock(dev);
 
@@ -2946,7 +2946,7 @@ static int __init init_yaffs_fs(void)
 	T(YAFFS_TRACE_ALWAYS,
 	  ("yaffs " __DATE__ " " __TIME__ " Installing. \n"));
 
-	init_MUTEX(&yaffs_context_lock);
+	sema_init(&yaffs_context_lock, 1);
 
 	/* Install the proc_fs entries */
 	my_proc_entry = create_proc_entry("yaffs",
-- 
1.7.1

