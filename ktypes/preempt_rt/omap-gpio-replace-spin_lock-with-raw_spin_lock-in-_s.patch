From bbffa0ad670c6d2b3181fe403d6d12cccfff2c23 Mon Sep 17 00:00:00 2001
From: Guoqing Jiang <Guoqing.Jiang@windriver.com>
Date: Wed, 27 Apr 2011 09:23:08 +0800
Subject: [PATCH] omap gpio: replace spin_lock with raw_spin_lock in _set_gpio_wakeup func to avoid warnings

spin_lock is sleepable in rt kernel, if we call it in an atomic and
irq_disabled context then calltrace appears. The following path
will cause calltrace when do suspend/resume system.

__device_suspend->pm_op->i2c_device_pm_suspend->tsc2004_rtc_suspend
->set_irq_wake->gpio_wake_enable->_set_gpio_wakeup

Signed-off-by: Guoqing Jiang <Guoqing.Jiang@windriver.com>
---
 arch/arm/plat-omap/gpio.c |    4 ++--
 1 files changed, 2 insertions(+), 2 deletions(-)

diff --git a/arch/arm/plat-omap/gpio.c b/arch/arm/plat-omap/gpio.c
index 1ef0d75..b81abb8 100644
--- a/arch/arm/plat-omap/gpio.c
+++ b/arch/arm/plat-omap/gpio.c
@@ -1202,12 +1202,12 @@ static int _set_gpio_wakeup(struct gpio_bank *bank, int gpio, int enable)
 					(bank - gpio_bank) * 32 + gpio);
 			return -EINVAL;
 		}
-		spin_lock_irqsave(&bank->lock, flags);
+		raw_spin_lock_irqsave(&bank->lock, flags);
 		if (enable)
 			bank->suspend_wakeup |= (1 << gpio);
 		else
 			bank->suspend_wakeup &= ~(1 << gpio);
-		spin_unlock_irqrestore(&bank->lock, flags);
+		raw_spin_unlock_irqrestore(&bank->lock, flags);
 		return 0;
 #endif
 	default:
-- 
1.7.0.4

