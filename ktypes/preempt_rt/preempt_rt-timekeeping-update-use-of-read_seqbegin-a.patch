From a0eb0ce14fea141df1d2091773eaea02bff8f04d Mon Sep 17 00:00:00 2001
From: Michel Thebeau <michel.thebeau@windriver.com>
Date: Thu, 27 Sep 2012 12:00:49 -0400
Subject: [PATCH] preempt_rt/timekeeping: update use of read_seqbegin() and
 read_seqretry()

The following upstream stable commit adds calls to read_seqbegin() and
read_seqretry():
bd77b8e820140e552098f5262aa4e91513614110
    timekeeping: Provide hrtimer update function

preempt_rt replaces both of these with the raw versions
read_raw_seqbegin() and read_raw_seqretry().  Follow suit for the new
additions.

Signed-off-by: Michel Thebeau <michel.thebeau@windriver.com>
---
 kernel/time/timekeeping.c |    4 ++--
 1 file changed, 2 insertions(+), 2 deletions(-)

diff --git a/kernel/time/timekeeping.c b/kernel/time/timekeeping.c
index 0cdda11..1e131bb 100644
--- a/kernel/time/timekeeping.c
+++ b/kernel/time/timekeeping.c
@@ -996,7 +996,7 @@ ktime_t ktime_get_update_offsets(ktime_t *real)
 	u64 secs, nsecs;
 
 	do {
-		seq = read_seqbegin(&xtime_lock);
+		seq = read_raw_seqbegin(&xtime_lock);
 
 		secs = xtime.tv_sec;
 		nsecs = xtime.tv_nsec;
@@ -1005,7 +1005,7 @@ ktime_t ktime_get_update_offsets(ktime_t *real)
 		nsecs += arch_gettimeoffset();
 
 		*real = offs_real;
-	} while (read_seqretry(&xtime_lock, seq));
+	} while (read_raw_seqretry(&xtime_lock, seq));
 
 	now = ktime_add_ns(ktime_set(secs, 0), nsecs);
 	now = ktime_sub(now, *real);
-- 
1.7.9.7

