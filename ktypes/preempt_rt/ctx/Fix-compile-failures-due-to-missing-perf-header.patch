From 9fd87a275f9f689d43a5d49852f269872a186681 Mon Sep 17 00:00:00 2001
From: Paul Gortmaker <paul.gortmaker@windriver.com>
Date: Tue, 15 Feb 2011 13:16:05 -0500
Subject: [PATCH] Fix compile failures due to missing perf header
MIME-Version: 1.0
Content-Type: text/plain; charset=UTF-8
Content-Transfer-Encoding: 8bit

The upstream header cleanup that took place between the rev
list ^9e74e7c b66696e breaks on RT with:

  CC      lib/kernel_lock.o
In file included from /home/paul/tip-debare/include/linux/slab.h:171,
include/linux/slab_def.h: In function ‘kmalloc’:
include/linux/slab_def.h:157: error: implicit declaration of function ‘trace_kmalloc’
include/trace/events/kmem.h: In function ‘perf_trace_enable_kmalloc’:
include/trace/events/kmem.h:81: error: implicit declaration of function ‘register_trace_kmalloc’

and similar for kernel/trace/power-traces.c -- the fix is
the same for both.

Signed-off-by: Paul Gortmaker <paul.gortmaker@windriver.com>

diff --git a/kernel/trace/power-traces.c b/kernel/trace/power-traces.c
index 9f4f565..1f2d92a 100644
--- a/kernel/trace/power-traces.c
+++ b/kernel/trace/power-traces.c
@@ -9,7 +9,7 @@
 #include <linux/workqueue.h>
 #include <linux/sched.h>
 #include <linux/module.h>
-#include <linux/slab.h>
+#include <linux/perf_event.h>
 
 #define CREATE_TRACE_POINTS
 #include <trace/events/power.h>
diff --git a/lib/kernel_lock.c b/lib/kernel_lock.c
index 5698b3f..199c5c5 100644
--- a/lib/kernel_lock.c
+++ b/lib/kernel_lock.c
@@ -12,6 +12,7 @@
 #include <linux/kallsyms.h>
 #include <linux/mutex.h>
 #include <linux/smp_lock.h>
+#include <linux/perf_event.h>
 
 #define CREATE_TRACE_POINTS
 #include <trace/events/bkl.h>
-- 
1.7.1.1

