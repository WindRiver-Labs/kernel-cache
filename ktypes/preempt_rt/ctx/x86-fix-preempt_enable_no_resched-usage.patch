From c9611f89da7de616de1da33052c2e090826ecc18 Mon Sep 17 00:00:00 2001
From: Thomas Gleixner <tglx@linutronix.de>
Date: Sat, 25 Jul 2009 22:37:24 +0200
Subject: [PATCH] x86: fix preempt_enable_no_resched usage

commit f2905d541f2329af7ce09a2b95bfa307e5c05fb6 in tip.

Triggers the missed preemption check.

Signed-off-by: Thomas Gleixner <tglx@linutronix.de>
Signed-off-by: Paul Gortmaker <paul.gortmaker@windriver.com>

diff --git a/arch/x86/kernel/process_32.c b/arch/x86/kernel/process_32.c
index 8f0aab6..d394298 100644
--- a/arch/x86/kernel/process_32.c
+++ b/arch/x86/kernel/process_32.c
@@ -156,7 +156,7 @@ void cpu_idle(void)
 			__exit_idle();
 		}
 		tick_nohz_restart_sched_tick();
-		preempt_enable_no_resched();
+		__preempt_enable_no_resched();
 		schedule();
 		preempt_disable();
 	}
diff --git a/arch/x86/kernel/process_64.c b/arch/x86/kernel/process_64.c
index 354e38d..5fdb3d3 100644
--- a/arch/x86/kernel/process_64.c
+++ b/arch/x86/kernel/process_64.c
@@ -146,7 +146,7 @@ void cpu_idle(void)
 		}
 
 		tick_nohz_restart_sched_tick();
-		preempt_enable_no_resched();
+		__preempt_enable_no_resched();
 		schedule();
 		preempt_disable();
 	}
-- 
1.7.1.1

