From 5f8a5b0c5393908e6056ae13404c0f0a40936333 Mon Sep 17 00:00:00 2001
From: Paul Gortmaker <paul.gortmaker@windriver.com>
Date: Sun, 20 Feb 2011 00:09:25 -0500
Subject: [PATCH] sched_fair: use raw_smp_processor_id in run_rebalance_domains

In the tip repo changeset 33fe41da821c6c542bcaa612a46695425525fdc6:

	From: Ingo Molnar <mingo@elte.hu>
	Date: Fri, 3 Jul 2009 08:44:01 -0500
	Subject: [PATCH] softirq: per cpu assumptions fixes

the "this_cpu" in run_rebalance_domains is obtained with a
raw_smp_processor_id(). This change was not carried forward in
the big RT "preempt-rt: -rt20 applied to 2.6.34 -standard" patch

Signed-off-by: Paul Gortmaker <paul.gortmaker@windriver.com>
---
 kernel/sched_fair.c |    2 +-
 1 files changed, 1 insertions(+), 1 deletions(-)

diff --git a/kernel/sched_fair.c b/kernel/sched_fair.c
index a331630..bd3e452 100644
--- a/kernel/sched_fair.c
+++ b/kernel/sched_fair.c
@@ -3468,7 +3468,7 @@ out:
  */
 static void run_rebalance_domains(struct softirq_action *h)
 {
-	int this_cpu = smp_processor_id();
+	int this_cpu = raw_smp_processor_id();
 	struct rq *this_rq = cpu_rq(this_cpu);
 	enum cpu_idle_type idle = this_rq->idle_at_tick ?
 						CPU_IDLE : CPU_NOT_IDLE;
-- 
1.7.4

