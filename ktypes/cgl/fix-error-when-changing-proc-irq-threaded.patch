From a1fd46947351aed0ab99e1198186f28034c24bbb Mon Sep 17 00:00:00 2001
From: Yong Zhang <yong.zhang@windriver.com>
Date: Mon, 21 Sep 2009 10:10:17 +0800
Subject: [PATCH] fix error when changing /proc/irq/*/*/threaded

My test is showing below:
sh-3.1# cat /proc/irq/25/eth3/threaded
1
sh-3.1# echo 0 > /proc/irq/25/eth3/threaded
sh: echo: write error: Invalid argument
sh-3.1# cat /proc/irq/25/eth3/threaded
0
sh-3.1# echo 1 > /proc/irq/25/eth3/threaded;echo $?
sh: echo: write error: Invalid argument
1
sh-3.1# cat /proc/irq/25/eth3/threaded
1
sh-3.1# echo -n 1 > /proc/irq/25/eth3/threaded;echo $?
0

The current status makes the user confused.
So the right value should be returned with threaded_write_proc().

Signed-off-by: Yong Zhang <yong.zhang@windriver.com>
---
 kernel/irq/proc.c |    2 +-
 1 files changed, 1 insertions(+), 1 deletions(-)

diff --git a/kernel/irq/proc.c b/kernel/irq/proc.c
index 9b44f6c..2d8a83d 100644
--- a/kernel/irq/proc.c
+++ b/kernel/irq/proc.c
@@ -215,7 +215,7 @@ static int threaded_write_proc(struct file *file, const char __user *buffer,
 
 	spin_unlock_irq(&desc->lock);
 
-	return 1;
+	return count;
 }
 
 #endif
-- 
1.6.3.3

