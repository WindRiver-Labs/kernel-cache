From 8e49d3bd6c99641f994097c9304cfa6e502b5477 Mon Sep 17 00:00:00 2001
From: Jason HU <yongqi.hu@windriver.com>
Date: Tue, 25 May 2010 13:43:30 +0800
Subject: [PATCH 2/5] nmi print fix

Collect more information for system death by adding dump_stack()
to die_nmi() for x86.

Signed-off-by: Yongli he   <yongli.he@windriver.com>
Signed-off-by: MacDonald, Joe <Joe.MacDonald@windriver.com>
Signed-off-by: Jason HU <yongqi.hu@windriver.com>
---
 arch/x86/kernel/dumpstack.c |    1 +
 1 files changed, 1 insertions(+), 0 deletions(-)

diff --git a/arch/x86/kernel/dumpstack.c b/arch/x86/kernel/dumpstack.c
index 9a92ee2..e75ac50 100644
--- a/arch/x86/kernel/dumpstack.c
+++ b/arch/x86/kernel/dumpstack.c
@@ -357,6 +357,7 @@ die_nmi(char *str, struct pt_regs *regs, int do_panic)
 	printk(KERN_EMERG "%s", str);
 	printk(" on CPU%d, ip %08lx, registers:\n",
 		smp_processor_id(), regs->ip);
+	dump_stack();
 	show_registers(regs);
 	oops_end(flags, regs, 0);
 	if (do_panic || panic_on_oops)
-- 
1.7.0

