From 37183aa0355537887f3b9026cb493a48f427b70c Mon Sep 17 00:00:00 2001
From: Yongli He <yongli.he@windriver.com>
Date: Thu, 24 Jul 2008 11:44:46 +0800
Subject: [PATCH] Force the system to restart instead of halt or power off

Signed-off-by: Liming Wang <liming.wang@windriver.com>
Integrated-by: Yongli he   <yongli.he@windriver.com>
---
 init/Kconfig |    4 ++++
 kernel/sys.c |    6 ++++++
 2 files changed, 10 insertions(+), 0 deletions(-)

diff --git a/init/Kconfig b/init/Kconfig
index 81b7cc2..67e5fcc 100644
--- a/init/Kconfig
+++ b/init/Kconfig
@@ -762,6 +762,10 @@ config VM_EVENT_COUNTERS
 	  on EMBEDDED systems.  /proc/vmstat will only show page counts
 	  if VM event counters are disabled.
 
+config ALWAYS_RESTART
+	bool "Force the system to restart instead of halt or power off"
+	default n
+
 config SLUB_DEBUG
 	default y
 	bool "Enable SLUB debugging support" if EMBEDDED
diff --git a/kernel/sys.c b/kernel/sys.c
index 9e72396..fe7c152 100644
--- a/kernel/sys.c
+++ b/kernel/sys.c
@@ -404,12 +404,18 @@ asmlinkage long sys_reboot(int magic1, int magic2, unsigned int cmd, void __user
 		break;
 
 	case LINUX_REBOOT_CMD_HALT:
+#ifdef CONFIG_ALWAYS_RESTART
+		kernel_restart(NULL);
+#endif
 		kernel_halt();
 		unlock_kernel();
 		do_exit(0);
 		break;
 
 	case LINUX_REBOOT_CMD_POWER_OFF:
+#ifdef CONFIG_ALWAYS_RESTART
+		kernel_restart(NULL);
+#endif
 		kernel_power_off();
 		unlock_kernel();
 		do_exit(0);
-- 
1.5.5.1

