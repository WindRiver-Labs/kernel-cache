From 9c2c4e8874af7779c4f0b21f58f6f4431e0d0f8f Mon Sep 17 00:00:00 2001
From: Greg Moffatt <greg.moffatt@windriver.com>
Date: Tue, 21 Dec 2010 09:15:02 -0500
Subject: [PATCH] kernel: use SLAB allocator with NUMA

When NUMA is configured for a CGL kernel on an intel 5500 target,
the kernel panics when init is started.  There is a conflict between
NUMA, GRSEC/PAX, and the SLUB allocator.

To address this the SLAB allocator should be configured instead.  To
achieve this the Kconfig for the allocator is changed such that if
NUMA is configured by a user the SLAB allocator is selected, rather
than the SLUB allocator.

Signed-off-by: Greg Moffatt <greg.moffatt@windriver.com>
---
 init/Kconfig |    2 ++
 1 files changed, 2 insertions(+), 0 deletions(-)

diff --git a/init/Kconfig b/init/Kconfig
index 4d26d06..caa4c8a 100644
--- a/init/Kconfig
+++ b/init/Kconfig
@@ -1162,6 +1162,7 @@ config COMPAT_BRK
 
 choice
 	prompt "Choose SLAB allocator"
+	default SLAB if NUMA
 	default SLUB
 	help
 	   This option allows to select a slab allocator.
@@ -1174,6 +1175,7 @@ config SLAB
 	  per cpu and per node queues.
 
 config SLUB
+	depends on !NUMA
 	bool "SLUB (Unqueued Allocator)"
 	help
 	   SLUB is a slab allocator that minimizes cache line usage
-- 
1.7.0

