From c60ab458e73a2be2793063574063285015a060d3 Mon Sep 17 00:00:00 2001
From: Jason HU <yongqi.hu@windriver.com>
Date: Fri, 25 Jun 2010 11:13:55 +0800
Subject: [PATCH] sysctl: sysctl table check failure fix for hrt-khz and nmi_watchdog_thresh

The check failure for /hrt-khz and /kernel/nmi_watchdog_thresh was fixed,
which will be reported when CONFIG_SYSCTL_SYSCALL_CHECK is turned on.

Signed-off-by: Jason HU <yongqi.hu@windriver.com>
---
 kernel/sysctl.c       |    1 +
 kernel/sysctl_check.c |    2 ++
 2 files changed, 3 insertions(+), 0 deletions(-)

diff --git a/kernel/sysctl.c b/kernel/sysctl.c
index 5d8d05f..f573dfd 100644
--- a/kernel/sysctl.c
+++ b/kernel/sysctl.c
@@ -734,6 +734,7 @@ static struct ctl_table kern_table[] = {
 		.maxlen		= sizeof(int),
 		.mode		= 0644,
 		.proc_handler	= &proc_dointvec_minmax,
+		.strategy	= &sysctl_intvec,
 		.extra1		= &nmi_watchdog_thresh_min,
 		.extra2		= &nmi_watchdog_thresh_max,
 	},
diff --git a/kernel/sysctl_check.c b/kernel/sysctl_check.c
index c35da23..aa707d0 100644
--- a/kernel/sysctl_check.c
+++ b/kernel/sysctl_check.c
@@ -104,6 +104,7 @@ static const struct trans_ctl_table trans_kern_table[] = {
 	{ KERN_MAX_LOCK_DEPTH,		"max_lock_depth" },
 	{ KERN_NMI_WATCHDOG,		"nmi_watchdog" },
 	{ KERN_PANIC_ON_NMI,		"panic_on_unrecovered_nmi" },
+	{ KERN_NMI_WATCHDOG_THRESH,	"nmi_watchdog_thresh" },
 	{}
 };
 
@@ -1233,6 +1234,7 @@ static const struct trans_ctl_table trans_root_table[] = {
 	{ CTL_SUNRPC,	"sunrpc",	trans_sunrpc_table },
 	{ CTL_PM,	"pm",		trans_pm_table },
 	{ CTL_FRV,	"frv",		trans_frv_table },
+	{ KERN_HRT_KHZ,	"hrt-khz" },
 	{}
 };
 
-- 
1.7.0.4

