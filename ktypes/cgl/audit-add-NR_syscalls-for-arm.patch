From b064abe5379809e191e456daf03a94675e5860cc Mon Sep 17 00:00:00 2001
From: Lans Zhang <jia.zhang@windriver.com>
Date: Tue, 24 Aug 2010 10:46:39 +0800
Subject: [PATCH 3/3] audit: add NR_syscalls for arm

We need a NR_syscalls macro for arm under cgl configuration, because the
check is placed at common area and other architectures all have NR_syscalls.

Signed-off-by: Lans Zhang <jia.zhang@windriver.com>
---
 arch/arm/include/asm/unistd.h  |    1 +
 arch/arm/kernel/entry-common.S |    1 +
 2 files changed, 2 insertions(+), 0 deletions(-)

diff --git a/arch/arm/include/asm/unistd.h b/arch/arm/include/asm/unistd.h
index b32c36c..4d746b8 100644
--- a/arch/arm/include/asm/unistd.h
+++ b/arch/arm/include/asm/unistd.h
@@ -394,6 +394,7 @@
 #define __NR_recvmmsg			(__NR_SYSCALL_BASE+365)
 
 #define __NR_syscall_max 366
+#define NR_syscalls	__NR_syscall_max
 
 /*
  * The following SWIs are ARM private.
diff --git a/arch/arm/kernel/entry-common.S b/arch/arm/kernel/entry-common.S
index 35656da..35be82b 100644
--- a/arch/arm/kernel/entry-common.S
+++ b/arch/arm/kernel/entry-common.S
@@ -87,6 +87,7 @@ ENTRY(ret_from_fork)
 	b	ret_slow_syscall
 ENDPROC(ret_from_fork)
 
+#undef NR_syscalls
 	.equ NR_syscalls,0
 #define CALL(x) .equ NR_syscalls,NR_syscalls+1
 #include "calls.S"
-- 
1.6.5.2

