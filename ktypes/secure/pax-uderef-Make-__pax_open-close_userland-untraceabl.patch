From f9d90a78390889cec43dfaf39d2d6dabc2e2704c Mon Sep 17 00:00:00 2001
From: Yang Shi <yang.shi@windriver.com>
Date: Thu, 15 May 2014 15:18:59 -0700
Subject: [PATCH 3/3] pax: uderef: Make __pax_open/close_userland untraceable

According to the comment in arch/x86/mm/uderef_64.c, __pax_open/close_userland
must remain leaf functions under all configurations, if function tracer is
enabled, this condition is not true anymore since they will call mcount to do
function trace.

So, make them untraceable to fulfill the leaf function requirement so that
ftrace could work with PAX_UDEREF at the mean time.

Signed-off-by: Yang Shi <yang.shi@windriver.com>
Signed-off-by: Jianchuan Wang <jianchuan.wang@windriver.com>
---
 arch/x86/mm/uderef_64.c |    4 ++--
 1 files changed, 2 insertions(+), 2 deletions(-)

diff --git a/arch/x86/mm/uderef_64.c b/arch/x86/mm/uderef_64.c
index 3fda3f3..516be55 100644
--- a/arch/x86/mm/uderef_64.c
+++ b/arch/x86/mm/uderef_64.c
@@ -7,7 +7,7 @@
  * - remain leaf functions under all configurations,
  * - never be called directly, only dereferenced from the wrappers.
  */
-void __used __pax_open_userland(void)
+void notrace __used __pax_open_userland(void)
 {
 	unsigned int cpu;
 
@@ -21,7 +21,7 @@ void __used __pax_open_userland(void)
 }
 EXPORT_SYMBOL(__pax_open_userland);
 
-void __used __pax_close_userland(void)
+void notrace __used __pax_close_userland(void)
 {
 	unsigned int cpu;
 
-- 
1.7.5.4

