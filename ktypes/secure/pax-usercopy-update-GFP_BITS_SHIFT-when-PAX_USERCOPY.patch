From 5508f9a8f570e6f9bbfec82ebcbcdd56011fd339 Mon Sep 17 00:00:00 2001
From: Yang Shi <yang.shi@windriver.com>
Date: Tue, 24 May 2016 12:28:33 -0700
Subject: [PATCH] pax: usercopy: update GFP_BITS_SHIFT when PAX_USERCOPY_SLABS
 is defined

When PAX_USERCOPY_SLABS is enabled, a new gfp flag, __gfp_usercopy, is defined,
GFP_BITS_SHIFT need to be updated to make it fit it, otherwise it may cause
boot failure.

Signed-off-by: Yang Shi <yang.shi@windriver.com>
---
 include/linux/gfp.h |    4 ++++
 1 files changed, 4 insertions(+), 0 deletions(-)

diff --git a/include/linux/gfp.h b/include/linux/gfp.h
index 7e3da6b..83646ee 100644
--- a/include/linux/gfp.h
+++ b/include/linux/gfp.h
@@ -110,7 +110,11 @@ struct vm_area_struct;
  */
 #define __GFP_NOTRACK_FALSE_POSITIVE (__GFP_NOTRACK)
 
+#ifdef CONFIG_PAX_USERCOPY_SLABS
+#define __GFP_BITS_SHIFT 26	/* Room for N __GFP_FOO bits */
+#else
 #define __GFP_BITS_SHIFT 25	/* Room for N __GFP_FOO bits */
+#endif
 #define __GFP_BITS_MASK ((__force gfp_t)((1 << __GFP_BITS_SHIFT) - 1))
 
 /* This equals 0, but use constants in case they ever change */
-- 
1.7.5.4

