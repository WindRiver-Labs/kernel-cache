From 4fd616edef8ef635f726314cd353bb42a1945889 Mon Sep 17 00:00:00 2001
From: Jack Tan <jack.tan@windriver.com>
Date: Wed, 25 Aug 2010 01:34:48 -0700
Subject: [PATCH] genirq: nlm_xls_atx_64_be: prevent usb softirq thread from dropping its binding

usb host irq handlers have been shown to not function correctly when
handled in threads. Add IRQF_NODELAY to prevent threading.

Signed-off--by: Jack Tan <jack.tan@windriver.com>
---
 drivers/usb/core/hcd.c |    4 ++++
 1 files changed, 4 insertions(+), 0 deletions(-)

diff --git a/drivers/usb/core/hcd.c b/drivers/usb/core/hcd.c
index 7379b44..08b55a9 100644
--- a/drivers/usb/core/hcd.c
+++ b/drivers/usb/core/hcd.c
@@ -2198,6 +2198,10 @@ int usb_add_hcd(struct usb_hcd *hcd,
 		if (irqflags & IRQF_SHARED)
 			irqflags &= ~IRQF_DISABLED;
 
+#ifdef CONFIG_PREEMPT_HARDIRQS
+			irqflags |= IRQF_NODELAY;
+#endif
+
 		snprintf(hcd->irq_descr, sizeof(hcd->irq_descr), "%s:usb%d",
 				hcd->driver->description, hcd->self.busnum);
 		if ((retval = request_irq(irqnum, &usb_hcd_irq, irqflags,
-- 
1.6.5.2

