From f86cf5b87b8eaba234ea59412272087bff589ed4 Mon Sep 17 00:00:00 2001
From: Yongli He <yongli.he@windriver.com>
Date: Thu, 4 Sep 2008 15:20:13 +0800
Subject: [PATCH] nmi print fixes

Signed-off-by: Yongli he   <yongli.he@windriver.com>
Signed-off-by: MacDonald, Joe <Joe.MacDonald@windriver.com>
---
 arch/x86/kernel/nmi.c      |    3 ++-
 arch/x86/kernel/traps_32.c |    1 +
 2 files changed, 3 insertions(+), 1 deletions(-)

diff --git a/arch/x86/kernel/nmi.c b/arch/x86/kernel/nmi.c
index d23673e..153b69a 100644
--- a/arch/x86/kernel/nmi.c
+++ b/arch/x86/kernel/nmi.c
@@ -440,7 +440,8 @@ nmi_watchdog_tick(struct pt_regs *regs, unsigned reason)
 			if (local_read(&__get_cpu_var(alert_counter)) ==
 				nmi_watchdog_thresh * nmi_hz) {
 				touch_nmi_watchdog();
-			/*
+
+				/*
 				 * die_nmi will return ONLY if NOTIFY_STOP
 				 * happens..
 				 */
diff --git a/arch/x86/kernel/traps_32.c b/arch/x86/kernel/traps_32.c
index 22699fc..83d3b1b 100644
--- a/arch/x86/kernel/traps_32.c
+++ b/arch/x86/kernel/traps_32.c
@@ -978,6 +978,7 @@ void notrace __kprobes die_nmi(char *str, struct pt_regs *regs, int do_panic)
 	printk(KERN_EMERG "%s", str);
 	printk(" on CPU%d, ip %08lx, registers:\n",
 		smp_processor_id(), regs->ip);
+	dump_stack();
 	show_registers(regs);
 	if (do_panic)
 		panic("Non maskable interrupt");
-- 
1.6.0.3

