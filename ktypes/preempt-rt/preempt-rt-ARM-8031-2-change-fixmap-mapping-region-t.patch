From 2e92ba1ba3eab3cf1fc1e3355ef419ce2e3af1e5 Mon Sep 17 00:00:00 2001
From: Yue Tao <yue.tao@windriver.com>
Date: Thu, 21 Aug 2014 22:58:37 -0700
Subject: [PATCH] preempt-rt: ARM: 8031/2: change fixmap mapping region to
 support 32 CPUs

This is the part fix for standard/preempt-rt/base branch, the common changes
are on standard/base branch.

Signed-off-by: Yue Tao <yue.tao@windriver.com>
---
 arch/arm/mm/highmem.c |    5 ++---
 1 files changed, 2 insertions(+), 3 deletions(-)

diff --git a/arch/arm/mm/highmem.c b/arch/arm/mm/highmem.c
index b3666cf..8d19b6e 100644
--- a/arch/arm/mm/highmem.c
+++ b/arch/arm/mm/highmem.c
@@ -174,7 +174,7 @@ void switch_kmaps(struct task_struct *prev_p, struct task_struct *next_p)
 	for (i = 0; i < prev_p->kmap_idx; i++) {
 		int idx = i + KM_TYPE_NR * smp_processor_id();
 
-		set_top_pte(__fix_to_virt(FIX_KMAP_BEGIN + idx), __pte(0));
+		set_fixmap_pte(idx, __pte(0));
 	}
 	/*
 	 * Restore @next_p's kmap_atomic mappings
@@ -183,8 +183,7 @@ void switch_kmaps(struct task_struct *prev_p, struct task_struct *next_p)
 		int idx = i + KM_TYPE_NR * smp_processor_id();
 
 		if (!pte_none(next_p->kmap_pte[i]))
-			set_top_pte(__fix_to_virt(FIX_KMAP_BEGIN + idx),
-					next_p->kmap_pte[i]);
+			set_fixmap_pte(idx, next_p->kmap_pte[i]);
 	}
 }
 #endif
-- 
1.7.5.4

