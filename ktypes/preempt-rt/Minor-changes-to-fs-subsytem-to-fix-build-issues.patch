From bf9779bbdf8dfb4c681ee81fe3c1f82f681a5118 Mon Sep 17 00:00:00 2001
From: Mark Asselstine <mark.asselstine@windriver.com>
Date: Mon, 7 Jun 2010 13:16:42 -0400
Subject: [PATCH] Minor changes to fs subsytem to fix build issues

cifs and jbd2 require minor changes to allow the preempt-rt
build to complete successfully. No functional changes.

Signed-off-by: Mark Asselstine <mark.asselstine@windriver.com>
---
 fs/cifs/inode.c   |    2 +-
 fs/jbd2/journal.c |    2 +-
 2 files changed, 2 insertions(+), 2 deletions(-)

diff --git a/fs/cifs/inode.c b/fs/cifs/inode.c
index 29b9ea2..ac6e7f3 100644
--- a/fs/cifs/inode.c
+++ b/fs/cifs/inode.c
@@ -1595,7 +1595,7 @@ int cifs_revalidate_dentry(struct dentry *dentry)
 	}
 
 	cFYI(1, ("Revalidate: %s inode 0x%p count %d dentry: 0x%p d_time %ld "
-		 "jiffies %ld", full_path, inode, inode->i_count.counter,
+		 "jiffies %ld", full_path, inode, inode->i_count,
 		 dentry, dentry->d_time, jiffies));
 
 	if (CIFS_SB(sb)->tcon->unix_ext)
diff --git a/fs/jbd2/journal.c b/fs/jbd2/journal.c
index c03d4dc..1ea21e1 100644
--- a/fs/jbd2/journal.c
+++ b/fs/jbd2/journal.c
@@ -1833,7 +1833,7 @@ size_t journal_tag_bytes(journal_t *journal)
  */
 #define JBD2_MAX_SLABS 8
 static struct kmem_cache *jbd2_slab[JBD2_MAX_SLABS];
-static DECLARE_MUTEX(jbd2_slab_create_sem);
+static DEFINE_SEMAPHORE(jbd2_slab_create_sem, 1);
 
 static const char *jbd2_slab_names[JBD2_MAX_SLABS] = {
 	"jbd2_1k", "jbd2_2k", "jbd2_4k", "jbd2_8k",
-- 
1.6.0.3

