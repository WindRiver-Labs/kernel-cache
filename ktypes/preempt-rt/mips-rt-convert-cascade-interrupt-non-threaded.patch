From c86423d29c94525d18ef1c9b6c025f733c1e8252 Mon Sep 17 00:00:00 2001
From: Liming Wang <liming.wang@windriver.com>
Date: Thu, 25 Aug 2011 15:55:35 +0800
Subject: [PATCH] mips/rt: convert cascade interrupt non threaded

The preempt_rt kernel forces all irq interrupts to be threaded,
but special interrupts can be excluded from this conversion.
The cascade interrupt should be part of these exceptions.

In this case, irq2 is initialized before "kthreadd" task, which
converts irq interrupt to threaded.

If this irq is threaded, the kernel calls "try_to_wake_up" function
to wake up "kthreadd" task, but at that moment, "kthreadd" task
has no been initialize and try_to_wake_up wakes up a NULL task.

Signed-off-by: Liming Wang <liming.wang@windriver.com>
---
 arch/mips/kernel/i8259.c |    1 +
 1 files changed, 1 insertions(+), 0 deletions(-)

diff --git a/arch/mips/kernel/i8259.c b/arch/mips/kernel/i8259.c
index 5c74eb7..fb338db 100644
--- a/arch/mips/kernel/i8259.c
+++ b/arch/mips/kernel/i8259.c
@@ -295,6 +295,7 @@ static void init_8259A(int auto_eoi)
 static struct irqaction irq2 = {
 	.handler = no_action,
 	.name = "cascade",
+	.flags = IRQF_NO_THREAD,
 };
 
 static struct resource pic1_io_resource = {
-- 
1.7.4.1

