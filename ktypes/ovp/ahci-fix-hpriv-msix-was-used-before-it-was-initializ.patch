From 12e244680097da8a69a0b77cc7a150a6be5cf54b Mon Sep 17 00:00:00 2001
From: Liwei Song <liwei.song@windriver.com>
Date: Fri, 26 May 2017 06:01:41 -0400
Subject: [PATCH] ahci: fix hpriv->msix was used before it was initialize

This error was import by patch "ahci: Store irq number in struct
ahci_host_priv".

When adjust patch, ahci_init_interrupts was put before hpriv->msix
get initialize, while hpriv->msix was used in ahci_init_interrupts,
a NULL pointer will get, then oops happen.

put ahci_init_interrupts after hpriv->msix was initialized, just as what
the origin upstream patch has done.

Signed-off-by: Liwei Song <liwei.song@windriver.com>
---
 drivers/ata/ahci.c |    3 +--
 1 files changed, 1 insertions(+), 2 deletions(-)

diff --git a/drivers/ata/ahci.c b/drivers/ata/ahci.c
index 3be49a7..773c45e 100644
--- a/drivers/ata/ahci.c
+++ b/drivers/ata/ahci.c
@@ -1635,12 +1635,11 @@ static int ahci_init_one(struct pci_dev *pdev, const struct pci_device_id *ent)
 		return -ENOMEM;
 	host->private_data = hpriv;
 
-	ahci_init_interrupts(pdev, n_ports, hpriv);
-
 	hpriv->msix = devm_kzalloc(&pdev->dev,
 			sizeof(struct msix_entry) * n_ports, GFP_KERNEL);
 	if (!hpriv->msix)
 		return -ENOMEM;
+	ahci_init_interrupts(pdev, n_ports, hpriv);
 
 	if (!(hpriv->cap & HOST_CAP_SSS) || ahci_ignore_sss)
 		host->flags |= ATA_HOST_PARALLEL_SCAN;
-- 
1.7.5.4

