From de66bb9b823255161092683a7f047802aeb87f1d Mon Sep 17 00:00:00 2001
From: Weiwei Wang <weiwei.wang@windriver.com>
Date: Wed, 27 Jul 2011 16:25:34 +0800
Subject: [PATCH] mtd/devices/m25p80: fix compile error in non-ppc platform

In non-ppc platform, compile error happens:
drivers/mtd/devices/m25p80.c: In function 'parse_flash_partition':
drivers/mtd/devices/m25p80.c:840: error: 'struct dev_archdata' has no member named 'of_node'
scripts/Makefile.build:313: *** [drivers/mtd/devices/m25p80.o] Error 1
scripts/Makefile.build:365: *** [drivers/mtd/devices] Error 2

function parse_flash_partition is introduced by fsl spi driver, so
use CONFIG_SPI_FSL_LIB to restrict it here.

Signed-off-by: Weiwei Wang <weiwei.wang@windriver.com>
---
 drivers/mtd/devices/m25p80.c |    4 ++++
 1 files changed, 4 insertions(+), 0 deletions(-)

diff --git a/drivers/mtd/devices/m25p80.c b/drivers/mtd/devices/m25p80.c
index 17aca16..289f330 100644
--- a/drivers/mtd/devices/m25p80.c
+++ b/drivers/mtd/devices/m25p80.c
@@ -828,6 +828,7 @@ static const struct spi_device_id *__devinit jedec_probe(struct spi_device *spi)
 	return NULL;
 }
 
+#ifdef CONFIG_SPI_FSL_LIB
 /*
  * parse_flash_partition - Parse the flash partition on the SPI bus
  * @spi: Pointer to spi_device device
@@ -853,6 +854,7 @@ void parse_flash_partition(struct spi_device *spi)
 
 	return;
 }
+#endif
 
 /*
  * board specific setup should have ensured the SPI clock used here
@@ -873,8 +875,10 @@ static int __devinit m25p_probe(struct spi_device *spi)
 	 * newer chips, even if we don't recognize the particular chip.
 	 */
 
+#ifdef CONFIG_SPI_FSL_LIB
 	/* Parse the flash partition */
 	parse_flash_partition(spi);
+#endif
 
 	data = spi->dev.platform_data;
 	if (data && data->type) {
-- 
1.7.0.4

