From 8ffc21ed7cefd47adff5ebe9f639ade37f52bf26 Mon Sep 17 00:00:00 2001
From: Andy Fleming <afleming@freescale.com>
Date: Thu, 2 Jun 2011 21:31:48 -0500
Subject: [PATCH 135/233] dpaa_eth: Count all interrupts

Extracted from vendor drop QorIQ-DPAA-SDK-V1-20110609-systembuilder.iso
0165-dpaa_eth-Count-all-interrupts.patch

The in_interrupt counter was only counting the rx dqrr handler.

Signed-off-by: Andy Fleming <afleming@freescale.com>
---
 drivers/net/dpa/dpaa_eth.c |   12 +++++++++---
 1 files changed, 9 insertions(+), 3 deletions(-)

diff --git a/drivers/net/dpa/dpaa_eth.c b/drivers/net/dpa/dpaa_eth.c
index 5697097..8be79bc 100644
--- a/drivers/net/dpa/dpaa_eth.c
+++ b/drivers/net/dpa/dpaa_eth.c
@@ -1310,8 +1310,10 @@ ingress_rx_error_dqrr(struct qman_portal		*portal,
 
 	percpu_priv = per_cpu_ptr(priv->percpu_priv, smp_processor_id());
 
-	if (dpaa_eth_napi_schedule(percpu_priv))
+	if (dpaa_eth_napi_schedule(percpu_priv)) {
+		percpu_priv->in_interrupt++;
 		return qman_cb_dqrr_stop;
+	}
 
 	_dpa_rx_error(net_dev, priv, percpu_priv, &dq->fd);
 
@@ -1449,8 +1451,10 @@ ingress_tx_error_dqrr(struct qman_portal		*portal,
 
 	percpu_priv = per_cpu_ptr(priv->percpu_priv, smp_processor_id());
 
-	if (dpaa_eth_napi_schedule(percpu_priv))
+	if (dpaa_eth_napi_schedule(percpu_priv)) {
+		percpu_priv->in_interrupt++;
 		return qman_cb_dqrr_stop;
+	}
 
 	_dpa_tx_error(net_dev, priv, percpu_priv, &dq->fd);
 
@@ -1471,8 +1475,10 @@ ingress_tx_default_dqrr(struct qman_portal		*portal,
 
 	percpu_priv = per_cpu_ptr(priv->percpu_priv, smp_processor_id());
 
-	if (dpaa_eth_napi_schedule(percpu_priv))
+	if (dpaa_eth_napi_schedule(percpu_priv)) {
+		percpu_priv->in_interrupt++;
 		return qman_cb_dqrr_stop;
+	}
 
 	_dpa_tx(net_dev, priv, percpu_priv, &dq->fd);
 
-- 
1.7.0.4

