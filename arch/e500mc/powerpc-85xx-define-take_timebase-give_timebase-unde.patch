From f4a1806eeaabcf335fa3bc91a93c95db15a8ad06 Mon Sep 17 00:00:00 2001
From: Weiwei Wang <weiwei.wang@windriver.com>
Date: Tue, 19 Jul 2011 11:27:56 +0800
Subject: [PATCH 080/233] powerpc/85xx: define take_timebase()/give_timebase under CONFIG_KEXEC

kexec can be taken as reboot, so tbl/tbu must be sync at kexec boot up.
Idea is taken from SDK-2.2.

Signed-off-by: Yong Zhang <yong.zhang@windriver.com>
---
 arch/powerpc/platforms/85xx/smp.c |    2 ++
 1 files changed, 2 insertions(+), 0 deletions(-)

diff --git a/arch/powerpc/platforms/85xx/smp.c b/arch/powerpc/platforms/85xx/smp.c
index fc8d8a0..f6a8735 100644
--- a/arch/powerpc/platforms/85xx/smp.c
+++ b/arch/powerpc/platforms/85xx/smp.c
@@ -142,6 +142,8 @@ struct smp_ops_t smp_85xx_ops = {
 	.kick_cpu = smp_85xx_kick_cpu,
 #ifdef CONFIG_KEXEC
 	.kexec_stop_cpus = default_kexec_stop_cpus,
+	.give_timebase = smp_generic_give_timebase,
+	.take_timebase = smp_generic_take_timebase,
 #endif
 #if defined(CONFIG_HOTPLUG_CPU)
 	.cpu_enable = generic_cpu_enable,
-- 
1.7.0.4

