From 49d75bbefa42b72dffdc92439969133fd259a00f Mon Sep 17 00:00:00 2001
From: Weiwei Wang <weiwei.wang@windriver.com>
Date: Wed, 29 Dec 2010 17:18:31 +0800
Subject: [PATCH 23/28] net/dpa: fix function dpa_remove

From SDK 2.2, only the first element of priv->dpa_fq_list
is initialized and used, so modify funciton dpa_remove to
aligh with it.

Signed-off-by: Weiwei Wang <weiwei.wang@windriver.com>
---
 drivers/net/dpa/dpaa_eth.c |    8 ++------
 1 files changed, 2 insertions(+), 6 deletions(-)

diff --git a/drivers/net/dpa/dpaa_eth.c b/drivers/net/dpa/dpaa_eth.c
index 7e38069..d0223c0 100644
--- a/drivers/net/dpa/dpaa_eth.c
+++ b/drivers/net/dpa/dpaa_eth.c
@@ -2769,7 +2769,7 @@ MODULE_DEVICE_TABLE(of, dpa_match);
 
 static int __devexit __cold dpa_remove(struct of_device *of_dev)
 {
-	int			 _errno, __errno, i;
+	int			 _errno;
 	struct device		*dev;
 	struct net_device	*net_dev;
 	struct dpa_priv_s	*priv;
@@ -2781,11 +2781,7 @@ static int __devexit __cold dpa_remove(struct of_device *of_dev)
 	dev_set_drvdata(dev, NULL);
 	unregister_netdev(net_dev);
 
-	for (i = 0, _errno = 0; i < ARRAY_SIZE(priv->dpa_fq_list); i++) {
-		__errno = dpa_fq_free(dev, priv->dpa_fq_list + i);
-		if (unlikely(__errno < 0) && _errno >= 0)
-			_errno = __errno;
-	}
+	_errno = dpa_fq_free(dev, priv->dpa_fq_list);
 
 	free_percpu(priv->percpu_priv);
 
-- 
1.6.5.2

