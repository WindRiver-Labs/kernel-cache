From b637c9b1daa4d3edc38cff2093f27d49780d13fc Mon Sep 17 00:00:00 2001
From: Weiwei Wang <weiwei.wang@windriver.com>
Date: Wed, 3 Aug 2011 11:02:30 +0800
Subject: [PATCH] usdpaa: fix usdpaa share memory access failure

usdpaa shmem needs to be accessed from user space, so tlb
needs to be set to allow this happen.

Signed-off-by: Weiwei Wang <weiwei.wang@windriver.com>
---
 arch/powerpc/mm/mem.c |    2 +-
 1 files changed, 1 insertions(+), 1 deletions(-)

diff --git a/arch/powerpc/mm/mem.c b/arch/powerpc/mm/mem.c
index 78a85bf..948bc03 100644
--- a/arch/powerpc/mm/mem.c
+++ b/arch/powerpc/mm/mem.c
@@ -531,7 +531,7 @@ static inline void hook_usdpaa_tlb1(struct vm_area_struct *vma,
 		flush_tlb_mm(vma->vm_mm);
 		settlbcam(usdpaa_tlbcam_index, va,
 			usdpaa_phys_start, usdpaa_phys_size,
-			pte_val(*ptep), mfspr(SPRN_PID));
+			pte_val(*ptep) | _PAGE_USER, mfspr(SPRN_PID));
 	}
 }
 #else
-- 
1.7.0.4

