From f17162db029174be5806306cffcd8bdfd1dc5ae7 Mon Sep 17 00:00:00 2001
From: Kevin Hao <kexin.hao@windriver.com>
Date: Tue, 19 Oct 2010 13:40:08 +0800
Subject: [PATCH 197/252] bman: use the old FBPR memory in the dump kernel

Since the dump kernel only use the memory reserved for it,
it is safe for the BMAN to still use the memory set by the
previous kernel. This will also make it easy to reuse the
BMAN in the dump kernel.

Signed-off-by: Kevin Hao <kexin.hao@windriver.com>
---
 drivers/hwalloc/bman_config.c |    2 +-
 1 files changed, 1 insertions(+), 1 deletions(-)

diff --git a/drivers/hwalloc/bman_config.c b/drivers/hwalloc/bman_config.c
index 5ad4ecc..73af407 100644
--- a/drivers/hwalloc/bman_config.c
+++ b/drivers/hwalloc/bman_config.c
@@ -171,7 +171,7 @@ static void bm_set_pool(struct bman *bm, u8 pool, u32 swdet, u32 swdxt,
 	bm_out(POOL_HWDXT(pool), __generate_thresh(hwdxt, 1));
 }
 
-#ifdef CONFIG_KEXEC_POWERPC_SMP_BOOTABLE
+#if defined(CONFIG_KEXEC_POWERPC_SMP_BOOTABLE) && !defined(CONFIG_CRASH_DUMP)
 /* we're coming from a kexec reboot, of course the register will have a
  * non-zero value in it, but we want to reallocate the memory from the
  * new kernel, not use the old memory, which might be used for something
-- 
1.6.5.2

