From ac91afb0f17844ac19efe95b207c588384a6ff5a Mon Sep 17 00:00:00 2001
From: Weiwei Wang <weiwei.wang@windriver.com>
Date: Thu, 30 Jun 2011 09:37:40 +0800
Subject: [PATCH 213/233] bman: use the old FBPR memory in the dump kernel

Since the dump kernel only use the memory reserved for it,
it is safe for the BMAN to still use the memory set by the
previous kernel. This will also make it easy to reuse the
BMAN in the dump kernel.

Signed-off-by: Kevin Hao <kexin.hao@windriver.com>
[rebase it onto QorIQ-DPAA-SDK-V1-20110609-systembuilder.iso]
Integrated-by: Weiwei Wang <weiwei.wang@windriver.com>
---
 drivers/staging/fsl_qbman/bman_config.c |    2 +-
 1 files changed, 1 insertions(+), 1 deletions(-)

diff --git a/drivers/staging/fsl_qbman/bman_config.c b/drivers/staging/fsl_qbman/bman_config.c
index 27d8192..543810e 100644
--- a/drivers/staging/fsl_qbman/bman_config.c
+++ b/drivers/staging/fsl_qbman/bman_config.c
@@ -234,7 +234,7 @@ static void bm_set_pool(struct bman *bm, u8 pool, u32 swdet, u32 swdxt,
 	bm_out(POOL_HWDXT(pool), __generate_thresh(hwdxt, 1));
 }
 
-#ifdef CONFIG_KEXEC_POWERPC_SMP_BOOTABLE
+#if defined(CONFIG_KEXEC_POWERPC_SMP_BOOTABLE) && !defined(CONFIG_CRASH_DUMP)
 /* we're coming from a kexec reboot, of course the register will have a
  * non-zero value in it, but we want to reallocate the memory from the
  * new kernel, not use the old memory, which might be used for something
-- 
1.7.0.4

