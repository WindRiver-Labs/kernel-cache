From ae1ca74b071d1e68381d99e9943eae94d21097f5 Mon Sep 17 00:00:00 2001
From: Weiwei Wang <weiwei.wang@windriver.com>
Date: Wed, 29 Jun 2011 14:06:04 +0800
Subject: [PATCH 202/233] qman: don't do DQRR empty check in dump kernel

There are maybe some responses in Dequeue Response Ring
which are still not handled by panic kernel. So don't
do empty check for DQRR and just ignore these responses
in dump kernel.

Signed-off-by: Kevin Hao <kexin.hao@windriver.com>
[rebase it onto QorIQ-DPAA-SDK-V1-20110609-systembuilder.iso]
Integrated-by: Weiwei Wang <weiwei.wang@windriver.com>
---
 drivers/staging/fsl_qbman/qman_high.c |    2 ++
 1 files changed, 2 insertions(+), 0 deletions(-)

diff --git a/drivers/staging/fsl_qbman/qman_high.c b/drivers/staging/fsl_qbman/qman_high.c
index 61a09ba..8b52e82 100644
--- a/drivers/staging/fsl_qbman/qman_high.c
+++ b/drivers/staging/fsl_qbman/qman_high.c
@@ -604,10 +604,12 @@ drain_loop:
 	}
 	isdr ^= (QM_PIRQ_DQRI | QM_PIRQ_MRI);
 	qm_isr_disable_write(__p, isdr);
+#ifndef CONFIG_CRASH_DUMP
 	if (qm_dqrr_current(__p) != NULL) {
 		pr_err("Qman DQRR unclean, need recovery\n");
 		goto fail_dqrr_mr_empty;
 	}
+#endif
 	if (qm_mr_current(__p) != NULL) {
 		/* special handling, drain just in case it's a few FQRNIs */
 		if (drain_mr_fqrni(__p)) {
-- 
1.7.0.4

