From 21a6f5b008364d4101483a729a62832d7ec9682e Mon Sep 17 00:00:00 2001
From: Kevin Hao <kexin.hao@windriver.com>
Date: Thu, 21 Oct 2010 10:07:49 +0800
Subject: [PATCH 200/252] qman: don't do DQRR empty check in dump kernel

There are maybe some responses in Dequeue Response Ring
which are still not handled by panic kernel. So don't
do empty check for DQRR and just ignore these responses
in dump kernel.

Signed-off-by: Kevin Hao <kexin.hao@windriver.com>
---
 drivers/hwqueue/qman_high.c |    2 ++
 1 files changed, 2 insertions(+), 0 deletions(-)

diff --git a/drivers/hwqueue/qman_high.c b/drivers/hwqueue/qman_high.c
index 433043f..1b55b24 100644
--- a/drivers/hwqueue/qman_high.c
+++ b/drivers/hwqueue/qman_high.c
@@ -336,6 +336,7 @@ struct qman_portal *qman_create_portal(struct qm_portal *__p, u32 flags,
 #endif
 	isdr ^= (QM_PIRQ_DQRI | QM_PIRQ_MRI);
 	qm_isr_disable_write(portal->p, isdr);
+#ifndef CONFIG_CRASH_DUMP
 #ifdef CONFIG_FSL_QMAN_PORTAL_FLAG_RECOVER
 	wait_event(affine_queue, int_dqrr_mr_empty(portal, 1));
 	ret = 0;
@@ -352,6 +353,7 @@ struct qman_portal *qman_create_portal(struct qm_portal *__p, u32 flags,
 #endif
 		goto fail_dqrr_mr_empty;
 	}
+#endif
 	qm_isr_disable_write(portal->p, 0);
 	/* Write a sane SDQCR */
 	qm_dqrr_sdqcr_set(portal->p, portal->sdqcr);
-- 
1.6.5.2

