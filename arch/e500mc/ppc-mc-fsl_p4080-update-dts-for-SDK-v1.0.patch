From 5d194bfc5aaa9cb7519d278a6e439c14321e42da Mon Sep 17 00:00:00 2001
From: Tiejun Chen <tiejun.chen@windriver.com>
Date: Fri, 5 Aug 2011 12:36:24 +0800
Subject: [PATCH 6/6] ppc-mc/fsl_p4080: update dts for SDK v1.0

We should update dts according to native dts.

Signed-off-by: Tiejun Chen <tiejun.chen@windriver.com>
---
 arch/powerpc/boot/dts/wrhv_p4080ds.dts |  247 ++++++++++----------------------
 1 files changed, 78 insertions(+), 169 deletions(-)

diff --git a/arch/powerpc/boot/dts/wrhv_p4080ds.dts b/arch/powerpc/boot/dts/wrhv_p4080ds.dts
index 754ff52..22b6f61 100644
--- a/arch/powerpc/boot/dts/wrhv_p4080ds.dts
+++ b/arch/powerpc/boot/dts/wrhv_p4080ds.dts
@@ -67,7 +67,7 @@
 		rtic_b = &rtic_b;
 		rtic_c = &rtic_c;
 		rtic_d = &rtic_d;
-		snvs = &snvs;
+		sec_mon = &sec_mon;
 
 		fman0 = &fman0;
 		fman0_oh0 = &fman0_oh0;
@@ -283,18 +283,6 @@
 						  &qpool7 &qpool8 &qpool9
 						  &qpool10 &qpool11 &qpool12
 						  &qpool13 &qpool14 &qpool15>;
-			crypto@0 {
-				dev-handle = <&crypto>;
-			};
-			pme@0 {
-				dev-handle = <&pme>;
-			};
-			fman@0 {
-				dev-handle = <&fman0>;
-			};
-			fman@1 {
-				dev-handle = <&fman1>;
-			};
 		};
 
 		qportal1: qman-portal@4000 {
@@ -310,18 +298,6 @@
 						  &qpool7 &qpool8 &qpool9
 						  &qpool10 &qpool11 &qpool12
 						  &qpool13 &qpool14 &qpool15>;
-			crypto@0 {
-				dev-handle = <&crypto>;
-			};
-			pme@0 {
-				dev-handle = <&pme>;
-			};
-			fman@0 {
-				dev-handle = <&fman0>;
-			};
-			fman@1 {
-				dev-handle = <&fman1>;
-			};
 		};
 
 		qportal2: qman-portal@8000 {
@@ -337,18 +313,6 @@
 						  &qpool7 &qpool8 &qpool9
 						  &qpool10 &qpool11 &qpool12
 						  &qpool13 &qpool14 &qpool15>;
-			crypto@0 {
-				dev-handle = <&crypto>;
-			};
-			pme@0 {
-				dev-handle = <&pme>;
-			};
-			fman@0 {
-				dev-handle = <&fman0>;
-			};
-			fman@1 {
-				dev-handle = <&fman1>;
-			};
 		};
 
 		qportal3: qman-portal@c000 {
@@ -364,18 +328,6 @@
 						  &qpool7 &qpool8 &qpool9
 						  &qpool10 &qpool11 &qpool12
 						  &qpool13 &qpool14 &qpool15>;
-			crypto@0 {
-				dev-handle = <&crypto>;
-			};
-			pme@0 {
-				dev-handle = <&pme>;
-			};
-			fman@0 {
-				dev-handle = <&fman0>;
-			};
-			fman@1 {
-				dev-handle = <&fman1>;
-			};
 		};
 
 		qportal4: qman-portal@10000 {
@@ -391,18 +343,6 @@
 						  &qpool7 &qpool8 &qpool9
 						  &qpool10 &qpool11 &qpool12
 						  &qpool13 &qpool14 &qpool15>;
-			crypto@0 {
-				dev-handle = <&crypto>;
-			};
-			pme@0 {
-				dev-handle = <&pme>;
-			};
-			fman@0 {
-				dev-handle = <&fman0>;
-			};
-			fman@1 {
-				dev-handle = <&fman1>;
-			};
 		};
 
 		qportal5: qman-portal@14000 {
@@ -418,18 +358,6 @@
 						  &qpool7 &qpool8 &qpool9
 						  &qpool10 &qpool11 &qpool12
 						  &qpool13 &qpool14 &qpool15>;
-			crypto@0 {
-				dev-handle = <&crypto>;
-			};
-			pme@0 {
-				dev-handle = <&pme>;
-			};
-			fman@0 {
-				dev-handle = <&fman0>;
-			};
-			fman@1 {
-				dev-handle = <&fman1>;
-			};
 		};
 
 		qportal6: qman-portal@18000 {
@@ -445,18 +373,6 @@
 						  &qpool7 &qpool8 &qpool9
 						  &qpool10 &qpool11 &qpool12
 						  &qpool13 &qpool14 &qpool15>;
-			crypto@0 {
-				dev-handle = <&crypto>;
-			};
-			pme@0 {
-				dev-handle = <&pme>;
-			};
-			fman@0 {
-				dev-handle = <&fman0>;
-			};
-			fman@1 {
-				dev-handle = <&fman1>;
-			};
 		};
 
 		qportal7: qman-portal@1c000 {
@@ -472,18 +388,6 @@
 						  &qpool7 &qpool8 &qpool9
 						  &qpool10 &qpool11 &qpool12
 						  &qpool13 &qpool14 &qpool15>;
-			crypto@0 {
-				dev-handle = <&crypto>;
-			};
-			pme@0 {
-				dev-handle = <&pme>;
-			};
-			fman@0 {
-				dev-handle = <&fman0>;
-			};
-			fman@1 {
-				dev-handle = <&fman1>;
-			};
 		};
 
 		qportal8: qman-portal@20000 {
@@ -498,18 +402,6 @@
 						  &qpool7 &qpool8 &qpool9
 						  &qpool10 &qpool11 &qpool12
 						  &qpool13 &qpool14 &qpool15>;
-			crypto@0 {
-				dev-handle = <&crypto>;
-			};
-			pme@0 {
-				dev-handle = <&pme>;
-			};
-			fman@0 {
-				dev-handle = <&fman0>;
-			};
-			fman@1 {
-				dev-handle = <&fman1>;
-			};
 		};
 
 		qportal9: qman-portal@24000 {
@@ -524,18 +416,6 @@
 						  &qpool7 &qpool8 &qpool9
 						  &qpool10 &qpool11 &qpool12
 						  &qpool13 &qpool14 &qpool15>;
-			crypto@0 {
-				dev-handle = <&crypto>;
-			};
-			pme@0 {
-				dev-handle = <&pme>;
-			};
-			fman@0 {
-				dev-handle = <&fman0>;
-			};
-			fman@1 {
-				dev-handle = <&fman1>;
-			};
 		};
 
 		qpool1: qman-pool@1 {
@@ -630,6 +510,7 @@
 	};
 
 	soc: soc@fe000000 {
+		bus-frequency = <0x2faee8c0>;
 		#address-cells = <1>;
 		#size-cells = <1>;
 		device_type = "soc";
@@ -637,7 +518,12 @@
 		ranges = <0x00000000 0 0xfe000000 0x1000000>;
 		reg = <0 0xfe000000 0 0x00001000>;
 
-		corenet-law {
+		soc-sram-error {
+			compatible = "fsl,soc-sram-error";
+			interrupts = <16 2 1 29>;
+		};
+
+		corenet-law@0 {
 			compatible = "fsl,corenet-law";
 			reg = <0x0 0x1000>;
 			fsl,num-laws = <32>;
@@ -654,14 +540,14 @@
 		};
 
 		memory-controller@8000 {
-			compatible = "fsl,p4080-memory-controller";
+			compatible = "fsl,qoriq-memory-controller-v4.4", "fsl,qoriq-memory-controller";
 			reg = <0x8000 0x1000>;
 			interrupt-parent = <&mpic>;
 			interrupts = <0x12 2>;
 		};
 
 		memory-controller@9000 {
-			compatible = "fsl,p4080-memory-controller";
+			compatible = "fsl,qoriq-memory-controller-v4.4","fsl,qoriq-memory-controller";
 			reg = <0x9000 0x1000>;
 			interrupt-parent = <&mpic>;
 			interrupts = <0x12 2>;
@@ -690,14 +576,14 @@
 			reg = <0x41600 0x200>;
 			msi-available-ranges = <0 0x100>;
 			interrupts = <
-				0xe0 0
-				0xe1 0
-				0xe2 0
-				0xe3 0
-				0xe4 0
-				0xe5 0
-				0xe6 0
-				0xe7 0>;
+				0xe0 0 0 0
+				0xe1 0 0 0
+				0xe2 0 0 0
+				0xe3 0 0 0
+				0xe4 0 0 0
+				0xe5 0 0 0
+				0xe6 0 0 0
+				0xe7 0 0 0>;
 			interrupt-parent = <&mpic>;
 		};
 
@@ -706,14 +592,14 @@
 			reg = <0x41800 0x200>;
 			msi-available-ranges = <0 0x100>;
 			interrupts = <
-				0xe8 0
-				0xe9 0
-				0xea 0
-				0xeb 0
-				0xec 0
-				0xed 0
-				0xee 0
-				0xef 0>;
+				0xe8 0 0 0
+				0xe9 0 0 0
+				0xea 0 0 0
+				0xeb 0 0 0
+				0xec 0 0 0
+				0xed 0 0 0
+				0xee 0 0 0
+				0xef 0 0 0>;
 			interrupt-parent = <&mpic>;
 		};
 
@@ -722,14 +608,14 @@
 			reg = <0x41a00 0x200>;
 			msi-available-ranges = <0 0x100>;
 			interrupts = <
-				0xf0 0
-				0xf1 0
-				0xf2 0
-				0xf3 0
-				0xf4 0
-				0xf5 0
-				0xf6 0
-				0xf7 0>;
+				0xf0 0 0 0
+				0xf1 0 0 0
+				0xf2 0 0 0
+				0xf3 0 0 0
+				0xf4 0 0 0
+				0xf5 0 0 0
+				0xf6 0 0 0
+				0xf7 0 0 0>;
 			interrupt-parent = <&mpic>;
 		};
 
@@ -877,17 +763,17 @@
 			cell-index = <0>;
 			#address-cells = <1>;
 			#size-cells = <0>;
-			compatible = "fsl,espi";
+			compatible = "fsl,p4080-espi", "fsl,mpc8536-espi";
 			reg = <0x110000 0x1000>;
 			interrupts = <53 0x2>;
 			interrupt-parent = <&mpic>;
-			espi,num-ss-bits = <4>;
+			fsl,espi-num-chipselects = <4>;
 			mode = "cpu";
 
 			fsl_m25p80@0 {
 				#address-cells = <1>;
 				#size-cells = <1>;
-				compatible = "fsl,espi-flash";
+				compatible = "spansion,s25sl12801";
 				reg = <0>;
 				linux,modalias = "fsl_m25p80";
 				spi-max-frequency = <40000000>; /* input clock */
@@ -1010,6 +896,11 @@
 			#sleep-cells = <1>;
 		};
 
+		sfp: sfp@e8000 {
+			compatible = "fsl,p4080-sfp", "fsl,qoriq-sfp-1.0";
+			reg	   = <0xe8000 0x1000>;
+		};
+
 		serdes@ea800{
 			compatible = "fsl,p4080-serdes";
 			reg = <0xea000 0x1000>;
@@ -1021,7 +912,7 @@
 			#address-cells = <0>;
 			#interrupt-cells = <2>;
 			reg = <0x40000 0x40000>;
-			compatible = "chrp,open-pic";
+			compatible = "fsl,mpic", "chrp,open-pic";
 			device_type = "open-pic";
 			big-endian;
 			message@1400 {
@@ -1041,7 +932,7 @@
 		};
 
 		crypto: crypto@300000 {
-			compatible = "fsl,p4080-sec4.0", "fsl,sec4.0";
+			compatible = "fsl,sec-v4.0";
 			#address-cells = <1>;
 			#size-cells = <1>;
 			reg		 = <0x300000 0x10000>;
@@ -1051,67 +942,67 @@
 			fsl,qi-spids	 = <5>;
 
 			sec_jq0: jq@1000 {
-				compatible = "fsl,p4080-sec4.0-job-queue", "fsl,sec4.0-job-queue";
+				compatible = "fsl,sec-v4.0-job-ring";
 				reg	   = <0x1000 0x1000>;
 				interrupts	 = <88 2>;
 				interrupt-parent = <&mpic>;
 			};
 
 			sec_jq1: jq@2000 {
-				compatible = "fsl,p4080-sec4.0-job-queue", "fsl,sec4.0-job-queue";
+				compatible = "fsl,sec-v4.0-job-ring";
 				reg	   = <0x2000 0x1000>;
 				interrupts	 = <89 2>;
 				interrupt-parent = <&mpic>;
 			};
 
 			sec_jq2: jq@3000 {
-				compatible = "fsl,p4080-sec4.0-job-queue", "fsl,sec4.0-job-queue";
+				compatible = "fsl,sec-v4.0-job-ring";
 				reg	   = <0x3000 0x1000>;
 				interrupts	 = <90 2>;
 				interrupt-parent = <&mpic>;
 			};
 
 			sec_jq3: jq@4000 {
-				compatible = "fsl,p4080-sec4.0-job-queue", "fsl,sec4.0-job-queue";
+				compatible = "fsl,sec-v4.0-job-ring";
 				reg	   = <0x4000 0x1000>;
 				interrupts	 = <91 2>;
 				interrupt-parent = <&mpic>;
 			};
 
 			rtic@6100 {
-				compatible = "fsl,p4080-sec4.0-rtic", "fsl,sec4.0-rtic";
+				compatible = "fsl,sec-v4.0-rtic";
 				#address-cells = <1>;
 				#size-cells = <1>;
 				reg		 = <0x6100 0x100>;
 				ranges		 = <0x0 0x6100 0xe00>;
 
 				rtic_a: rtic-a@100 {
-					compatible = "fsl,p4080-sec4.0-rtic-memory", "fsl,sec4.0-rtic-memory";
+					compatible = "fsl,sec-v4.0-rtic-memory";
 					reg		 = <0x100 0x20 0x200 0x80>;
 				};
 
 				rtic_b: rtic-b@120 {
-					compatible = "fsl,p4080-sec4.0-rtic-memory", "fsl,sec4.0-rtic-memory";
+					compatible = "fsl,sec-v4.0-rtic-memory";
 					reg		 = <0x120 0x20 0x300 0x80>;
 				};
 
 				rtic_c: rtic-c@140 {
-					compatible = "fsl,p4080-sec4.0-rtic-memory", "fsl,sec4.0-rtic-memory";
+					compatible = "fsl,sec-v4.0-rtic-memory";
 					reg		 = <0x140 0x20 0x400 0x80>;
 				};
 
 				rtic_d: rtic-d@160 {
-					compatible = "fsl,p4080-sec4.0-rtic-memory", "fsl,sec4.0-rtic-memory";
+					compatible = "fsl,sec-v4.0-rtic-memory";
 					reg		 = <0x160 0x20 0x500 0x80>;
 				};
 			};
 		};
 
-		snvs: snvs@314000 {
-			compatible = "fsl,p4080-sec4.0-snvs", "fsl,sec4.0-snvs";
-			reg	   = <0x314000 0x1000>;
-			interrupts	 = <93 2>;
+		sec_mon: sec_mon@314000 {
+			compatible = "fsl,sec-v4.0-mon";
+			reg = <0x314000 0x1000>;
 			interrupt-parent = <&mpic>;
+			interrupts = <93 2 0 0>;
 		};
 
 		pme: pme@316000 {
@@ -1293,6 +1184,7 @@
 				tbi-handle = <&tbi0>;
 				phy-handle = <&phydummy>;
 				phy-connection-type = "sgmii";
+				ptimer-handle = <&ptp_timer0>;
 			};
 
 			mdio0: mdio@e1120 {
@@ -1400,6 +1292,7 @@
 				tbi-handle = <&tbi1>;
 				phy-handle = <&phyrgmii>;
 				phy-connection-type = "rgmii";
+				ptimer-handle = <&ptp_timer0>;
 			};
 
 			mdio@e3120 {
@@ -1424,6 +1317,7 @@
 				tbi-handle = <&tbi2>;
 				phy-handle = <&phydummy>;
 				phy-connection-type = "sgmii";
+				ptimer-handle = <&ptp_timer0>;
 			};
 
 			mdio@e5120 {
@@ -1448,6 +1342,7 @@
 				tbi-handle = <&tbi3>;
 				phy-handle = <&phydummy>;
 				phy-connection-type = "sgmii";
+				ptimer-handle = <&ptp_timer0>;
 			};
 
 			mdio@e7120 {
@@ -1505,6 +1400,11 @@
 					};
 				};
 			};
+
+			ptp_timer0: rtc@fe000 {
+				compatible = "fsl,fman-rtc";
+				reg = <0xfe000 0x1000>;
+			};
 		};
 
 		fman1: fman@500000 {
@@ -1661,6 +1561,7 @@
 				tbi-handle = <&tbi5>;
 				phy-handle = <&phy5slot3>;
 				phy-connection-type = "sgmii";
+				ptimer-handle = <&ptp_timer1>;
 			};
 			mdio@e1120 {
 				#address-cells = <1>;
@@ -1684,6 +1585,7 @@
 				tbi-handle = <&tbi6>;
 				phy-handle = <&phy6slot3>;
 				phy-connection-type = "sgmii";
+				ptimer-handle = <&ptp_timer1>;
 			};
 
 			mdio@e3120 {
@@ -1708,6 +1610,7 @@
 				tbi-handle = <&tbi7>;
 				phy-handle = <&phy7slot3>;
 				phy-connection-type = "sgmii";
+				ptimer-handle = <&ptp_timer1>;
 			};
 
 			mdio@e5120 {
@@ -1732,6 +1635,7 @@
 				tbi-handle = <&tbi8>;
 				phy-handle = <&phy8slot3>;
 				phy-connection-type = "sgmii";
+				ptimer-handle = <&ptp_timer1>;
 			};
 
 			mdio@e7120 {
@@ -1756,6 +1660,11 @@
 				phy-handle = <&phy11>;
 				phy-connection-type = "xgmii";
 			};
+
+			ptp_timer1: rtc@fe000 {
+				compatible = "fsl,fman-rtc";
+				reg = <0xfe000 0x1000>;
+			};
 		};
 	};
 
@@ -1839,12 +1748,12 @@
 		ethernet@4 {
 			status = "disabled";
 			compatible = "fsl,p4080-dpa-ethernet", "fsl,dpa-ethernet";
-			fsl,qman-channel = <&qportal0>;
+			fsl,qman-channel = <&qpool1>;
 			fsl,fman-mac = <&enet4>;
 		};
 		ethernet@5 {
 			compatible = "fsl,p4080-dpa-ethernet", "fsl,dpa-ethernet";
-			fsl,qman-channel = <&qportal7>;
+			fsl,qman-channel = <&qpool1>;
 			fsl,fman-mac = <&enet5>;
 		};
 		ethernet@6 {
@@ -1866,7 +1775,7 @@
 		};
 		ethernet@9 {
 			compatible = "fsl,p4080-dpa-ethernet", "fsl,dpa-ethernet";
-			fsl,qman-channel = <&qportal0>;
+			fsl,qman-channel = <&qpool1>;
 			fsl,fman-mac = <&enet9>;
 		};
 	};
-- 
1.7.0.4

