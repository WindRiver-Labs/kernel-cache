From c3d6bb8ebeda127845882ddf0786542d55a53f85 Mon Sep 17 00:00:00 2001
From: Bruce Ashfield <bruce.ashfield@windriver.com>
Date: Mon, 20 Dec 2010 23:40:21 -0500
Subject: [PATCH] mtd/nand: complete converstion to elbc common interrupt

Signed-off-by: Bruce Ashfield <bruce.ashfield@windriver.com>
---
 drivers/mtd/nand/fsl_elbc_nand.c |    7 +++----
 1 files changed, 3 insertions(+), 4 deletions(-)

diff --git a/drivers/mtd/nand/fsl_elbc_nand.c b/drivers/mtd/nand/fsl_elbc_nand.c
index 041c0cd..55ea45c 100644
--- a/drivers/mtd/nand/fsl_elbc_nand.c
+++ b/drivers/mtd/nand/fsl_elbc_nand.c
@@ -226,7 +226,7 @@ static int fsl_elbc_run_command(struct mtd_info *mtd)
  	elbc_fcm_ctrl->use_mdr = 0;
 
 
-	if (ctrl->status != LTESR_CC) {
+	if (elbc_fcm_ctrl->status != LTESR_CC) {
 		dev_info(ctrl->dev,
 		         "command failed: fir %x fcr %x status %x mdr %x\n",
 		         in_be32(&lbc->fir), in_be32(&lbc->fcr),
@@ -364,7 +364,7 @@ static void fsl_elbc_cmdfunc(struct mtd_info *mtd, unsigned int command,
 
 		out_be32(&lbc->fbcr, 0);
   		elbc_fcm_ctrl->read_bytes = 0;
-		ctrl->use_mdr = 1;
+		elbc_fcm_ctrl->use_mdr = 1;
 
 		fsl_elbc_run_command(mtd);
 		return;
@@ -379,7 +379,7 @@ static void fsl_elbc_cmdfunc(struct mtd_info *mtd, unsigned int command,
 
    		elbc_fcm_ctrl->column = column;
   		elbc_fcm_ctrl->oob = 0;
-		ctrl->use_mdr = 1;
+		elbc_fcm_ctrl->use_mdr = 1;
 
 		fcr = (NAND_CMD_STATUS   << FCR_CMD1_SHIFT) |
 		      (NAND_CMD_SEQIN    << FCR_CMD2_SHIFT) |
@@ -623,7 +623,6 @@ static int fsl_elbc_verify_buf(struct mtd_info *mtd, const u_char *buf, int len)
 static int fsl_elbc_wait(struct mtd_info *mtd, struct nand_chip *chip)
 {
 	struct fsl_elbc_mtd *priv = chip->priv;
- 	struct fsl_lbc_ctrl *ctrl = priv->ctrl;	
 
  	if (elbc_fcm_ctrl->status != LTESR_CC)	
 		return NAND_STATUS_FAIL;
-- 
1.6.5.2

