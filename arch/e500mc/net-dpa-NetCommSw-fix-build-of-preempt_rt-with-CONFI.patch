From 3694b8c31e5c16a20f536f5e83d7469be37db3a8 Mon Sep 17 00:00:00 2001
From: Andrew Liu <shengping.liu@windriver.com>
Date: Wed, 4 Aug 2010 14:09:25 +0800
Subject: [PATCH 154/252] net : dpa: NetCommSw : fix build of preempt_rt with CONFIG_PREEMPT_RT disabled

Move code functions so the kernel can be built with preempt-rt disabled.

Signed-off-by: Patrik Lindergren <patrik.lindergren@windriver.com>
Integrated-by: Andrew Liu <shengping.liu@windriver.com>
---
 .../user/env/linux/kernel/2.6/xx/xx_linux.c        |   19 +++++++++++++++++++
 1 files changed, 19 insertions(+), 0 deletions(-)

diff --git a/drivers/net/dpa/NetCommSw/user/env/linux/kernel/2.6/xx/xx_linux.c b/drivers/net/dpa/NetCommSw/user/env/linux/kernel/2.6/xx/xx_linux.c
index 927ff4e..ff985bd 100644
--- a/drivers/net/dpa/NetCommSw/user/env/linux/kernel/2.6/xx/xx_linux.c
+++ b/drivers/net/dpa/NetCommSw/user/env/linux/kernel/2.6/xx/xx_linux.c
@@ -136,6 +136,25 @@ static bool in_big_phys_area (uint32_t addr)
 }
 #endif /* BIGPHYSAREA_ENABLE */
 
+#ifdef CONFIG_PREEMPT_RT
+uint32_t XX_DisableAllIntr_nort(void)
+{
+    unsigned long flags;
+
+    local_irq_save_nort(flags);
+
+    return (uint32_t)flags;
+}
+
+void XX_RestoreAllIntr_nort(uint32_t flags)
+{
+    local_irq_restore_nort(flags);
+}
+#else
+#define        XX_DisableAllIntr_nort(flags)   XX_DisableAllIntr(flags)
+#define        XX_RestoreAllIntr_nort(flags)   XX_RestoreAllIntr(flags)
+#endif
+
 void * xx_Malloc(uint32_t n)
 {
     void        *a;
-- 
1.6.5.2

