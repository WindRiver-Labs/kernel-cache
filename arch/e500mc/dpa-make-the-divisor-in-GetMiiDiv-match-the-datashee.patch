From 24660b34545a15ebb3a1898210d057093affa1dd Mon Sep 17 00:00:00 2001
From: Yong Zhang <yong.zhang@windriver.com>
Date: Wed, 23 May 2012 16:57:35 +0800
Subject: [PATCH] dpa: make the divisor in GetMiiDiv() match the datasheet

Remove on duplicated 1/6 and add 1/20. Based on the datasheet:

3.6.3.4.6 MII Management Configuration Register (MIIMCFG)
MIIMCFG[MgmtClk]: Bits 29-31
00x 1/4 of the dTSEC system clock divided by 8
010 1/6 of the dTSEC system clock divided by 8
011 1/8 of the dTSEC system clock divided by 8
100 1/10 of the dTSEC system clock divided by 8
101 1/14 of the dTSEC system clock divided by 8
110 1/20 of the dTSEC system clock divided by 8
111 1/28 of the dTSEC system clock divided by 8

Signed-off-by: Yong Zhang <yong.zhang@windriver.com>
---
 .../net/dpa/NetCommSw/Peripherals/FM/MAC/dtsec.c   |    8 ++++----
 1 files changed, 4 insertions(+), 4 deletions(-)

diff --git a/drivers/net/dpa/NetCommSw/Peripherals/FM/MAC/dtsec.c b/drivers/net/dpa/NetCommSw/Peripherals/FM/MAC/dtsec.c
index 2e1c84f..1f6460b 100644
--- a/drivers/net/dpa/NetCommSw/Peripherals/FM/MAC/dtsec.c
+++ b/drivers/net/dpa/NetCommSw/Peripherals/FM/MAC/dtsec.c
@@ -118,25 +118,25 @@ static uint8_t GetMiiDiv(int32_t refClk)
         div = 2;
         minRange = (int)tmpClk;
     }
-    tmpClk = (uint32_t)ABS(refClk/60 - 1);
+    tmpClk = (uint32_t)ABS(refClk/80 - 1);
     if (tmpClk < minRange)
     {
         div = 3;
         minRange = (int)tmpClk;
     }
-    tmpClk = (uint32_t)ABS(refClk/80 - 1);
+    tmpClk = (uint32_t)ABS(refClk/100 - 1);
     if (tmpClk < minRange)
     {
         div = 4;
         minRange = (int)tmpClk;
     }
-    tmpClk = (uint32_t)ABS(refClk/100 - 1);
+    tmpClk = (uint32_t)ABS(refClk/140 - 1);
     if (tmpClk < minRange)
     {
         div = 5;
         minRange = (int)tmpClk;
     }
-    tmpClk = (uint32_t)ABS(refClk/140 - 1);
+    tmpClk = (uint32_t)ABS(refClk/200 - 1);
     if (tmpClk < minRange)
     {
         div = 6;
-- 
1.7.0

