From 9418adfa8be791a78fcb8d9f9caac3a36698d084 Mon Sep 17 00:00:00 2001
From: Weiwei Wang <weiwei.wang@windriver.com>
Date: Fri, 29 Jul 2011 14:46:49 +0800
Subject: [PATCH 1/2] powerpc/mmu: restrict next_tlbcam_idx declaration

next_tlbcam_idx is defined that way:
arch/powerpc/mm/tlb_nohash.c:
...
139 #ifdef CONFIG_PPC_FSL_BOOK3E
140 /* next_tlbcam_idx is used to round-robin tlbcam entry assignment */
141 DEFINE_PER_CPU(int, next_tlbcam_idx);
142 EXPORT_PER_CPU_SYMBOL(next_tlbcam_idx);
143 #endif
...

So when DECLARE_PER_CPU(int, next_tlbcam_idx), macro CONFIG_PPC_FSL_BOOK3E
is also needed.

Signed-off-by: Weiwei Wang <weiwei.wang@windriver.com>
---
 arch/powerpc/include/asm/mmu.h |    2 ++
 1 files changed, 2 insertions(+), 0 deletions(-)

diff --git a/arch/powerpc/include/asm/mmu.h b/arch/powerpc/include/asm/mmu.h
index c70e397..b26c589 100644
--- a/arch/powerpc/include/asm/mmu.h
+++ b/arch/powerpc/include/asm/mmu.h
@@ -69,9 +69,11 @@
 
 #ifndef __ASSEMBLY__
 #include <asm/cputable.h>
+#ifdef CONFIG_PPC_FSL_BOOK3E
 #include <asm/percpu.h>
 
 DECLARE_PER_CPU(int, next_tlbcam_idx);
+#endif
 
 static inline int mmu_has_feature(unsigned long feature)
 {
-- 
1.7.0.4

