From 4bebedff1d465ef236e4b36c7fc4ce5e9447e238 Mon Sep 17 00:00:00 2001
From: Shaohui Xie <b21989@freescale.com>
Date: Fri, 7 Jan 2011 14:31:38 +0800
Subject: [PATCH 054/233] fsl_rio: fix non-standard HID1 register access

commit b5fb0cc7f1c90e3b00d40b64681efcbf8bcdeb9e upstream
correspond to vendor drop QorIQ-DPAA-SDK-V1-20110609-systembuilder.iso
0078-fsl_rio-fix-non-standard-HID1-register-access.patch

Signed-off-by: Shaohui Xie <b21989@freescale.com>
Signed-off-by: Roy Zang <tie-fei.zang@freescale.com>
Cc: Li Yang <leoli@freescale.com>
Signed-off-by: Kumar Gala <kumar.gala@freescale.com>
---
 arch/powerpc/kernel/cpu_setup_fsl_booke.S |    8 +++++++-
 1 files changed, 7 insertions(+), 1 deletions(-)

diff --git a/arch/powerpc/kernel/cpu_setup_fsl_booke.S b/arch/powerpc/kernel/cpu_setup_fsl_booke.S
index 1e071a9..3a3693c 100644
--- a/arch/powerpc/kernel/cpu_setup_fsl_booke.S
+++ b/arch/powerpc/kernel/cpu_setup_fsl_booke.S
@@ -1,7 +1,7 @@
 /*
  * This file contains low level CPU setup functions.
  * Kumar Gala <galak@kernel.crashing.org>
- * Copyright 2009 Freescale Semiconductor, Inc.
+ * Copyright 2009-2010 Freescale Semiconductor, Inc.
  *
  * Based on cpu_setup_6xx code by
  * Benjamin Herrenschmidt <benh@kernel.crashing.org>
@@ -91,6 +91,12 @@ _GLOBAL(__setup_cpu_e500v2)
 	bl	__e500_icache_setup
 	bl	__e500_dcache_setup
 	bl	__setup_e500_ivors
+#ifdef CONFIG_RAPIDIO
+	/* Ensure that RFXE is set */
+	mfspr	r3,SPRN_HID1
+	oris	r3,r3,HID1_RFXE@h
+	mtspr	SPRN_HID1,r3
+#endif
 	mtlr	r4
 	blr
 _GLOBAL(__setup_cpu_e500mc)
-- 
1.7.0.4

