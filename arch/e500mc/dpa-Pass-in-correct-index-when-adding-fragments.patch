From e3604b6c2b4cc2eee0b5cfab2275cb0382bb5fcb Mon Sep 17 00:00:00 2001
From: Andy Fleming <afleming@freescale.com>
Date: Tue, 10 Nov 2009 22:52:55 +0000
Subject: [PATCH 080/252] dpa: Pass in correct index when adding fragments

The code was passing in "0" for the index, even though when we are
adding pages, we want to place the fragment in the next available slot.
So we use skb_shinfo(skb)->nr_frags as the index.

Signed-off-by: Andy Fleming <afleming@freescale.com
[Applied FSL SDK 2.0.3 patch
"kernel-2.6.30-dpa-Pass-in-correct-index-when-adding-fragme.patch"]
Integrated-by: Yuri Nedel <Yuri.Nedel@windriver.com>
---
 drivers/net/dpa/dpa.c |    2 +-
 1 files changed, 1 insertions(+), 1 deletions(-)

diff --git a/drivers/net/dpa/dpa.c b/drivers/net/dpa/dpa.c
index 4624924..2f42b90 100644
--- a/drivers/net/dpa/dpa.c
+++ b/drivers/net/dpa/dpa.c
@@ -1302,7 +1302,7 @@ static void __cold dpa_change_rx_flags(struct net_device *net_dev, int flags)
 static void dpa_rx_skb_add_page(struct sk_buff *skb, struct page *page,
 				u32 offset, u32 size)
 {
-	skb_fill_page_desc(skb, 0, page, offset, size);
+	skb_fill_page_desc(skb, skb_shinfo(skb)->nr_frags, page, offset, size);
 
 	skb->len	+= size;
 	skb->data_len	+= size;
-- 
1.6.5.2

