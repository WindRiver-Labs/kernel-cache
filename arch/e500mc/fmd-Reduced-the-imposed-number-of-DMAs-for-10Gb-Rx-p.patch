From 5db1cf140fa5a2ef785bbd0573eb921e9ed3b7eb Mon Sep 17 00:00:00 2001
From: Madalin Bucur <madalin.bucur@freescale.com>
Date: Thu, 26 May 2011 17:56:30 +0300
Subject: [PATCH 110/233] fmd: Reduced the imposed number of DMAs for 10Gb Rx port

Extracted from vendor drop QorIQ-DPAA-SDK-V1-20110609-systembuilder.iso
0138-fmd-Reduced-the-imposed-number-of-DMAs-for-10Gb-Rx-p.patch

Reduced the imposed number of DMAs for 10Gb Rx port to allow for the 5th
1Gb port on P3/P5.  Increased the number of TNums for 10Gb Tx and Rx.

Signed-off-by: Haiying Wang <Haiying.Wang@freescale.com>
Signed-off-by: Madalin Bucur <madalin.bucur@freescale.com>
---
 .../src/wrappers/Peripherals/FM/lnxwrp_fm.c        |   13 ++++++++++++-
 1 files changed, 12 insertions(+), 1 deletions(-)

diff --git a/drivers/net/dpa/NetCommSw/src/wrappers/Peripherals/FM/lnxwrp_fm.c b/drivers/net/dpa/NetCommSw/src/wrappers/Peripherals/FM/lnxwrp_fm.c
index 22ba10f..520b255 100644
--- a/drivers/net/dpa/NetCommSw/src/wrappers/Peripherals/FM/lnxwrp_fm.c
+++ b/drivers/net/dpa/NetCommSw/src/wrappers/Peripherals/FM/lnxwrp_fm.c
@@ -2247,10 +2247,21 @@ static t_Error InitFmPortDev(t_LnxWrpFmPortDev *p_LnxWrpFmPortDev)
     {
         t_Error      errCode = E_OK;
         t_FmPortRsrc numOfOpenDmas;
-        numOfOpenDmas.num = FM_PORT_10G_NUM_OF_OPEN_DMA;
+        t_FmPortRsrc numOfTasks;
+
+        numOfOpenDmas.num = (p_LnxWrpFmPortDev->settings.param.portType ==
+                        e_FM_PORT_TYPE_TX_10G) ? 12 : 8; 
         numOfOpenDmas.extra = 0;
+
         if ((errCode = FM_PORT_SetNumOfOpenDmas(p_LnxWrpFmPortDev->h_Dev, &numOfOpenDmas)) != E_OK)
              RETURN_ERROR(MAJOR, errCode, NO_MSG);
+
+        numOfTasks.num = 22;  /* performance requirements impose these values */
+        numOfTasks.extra = 8;
+
+        if ((errCode = FM_PORT_SetNumOfTasks(p_LnxWrpFmPortDev->h_Dev,
+                                &numOfTasks)) != E_OK)
+                RETURN_ERROR(MAJOR, errCode, NO_MSG);
     }
 
     /*Do we still need this one?*/
-- 
1.7.0.4

