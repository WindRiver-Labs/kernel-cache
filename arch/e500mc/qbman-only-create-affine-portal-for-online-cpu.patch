From 1c55e87e1f5181e984e50c0ed991aa47d29e8d10 Mon Sep 17 00:00:00 2001
From: Kevin Hao <kexin.hao@windriver.com>
Date: Fri, 9 Sep 2011 10:31:13 +0800
Subject: [PATCH] qbman: only create affine portal for online cpu

Currently the qbman driver will try to create affine portal for
all the present cpu. If the kernel finds that the cpu is not online,
it will redirects this portal's irq to an online cpu at random.
But the qbman's irq handler only supports one affine portal for
each cpu. Then the cpu which is assigned two portal's irq will
get stuck. And it also makes no sense to create an affine portal
for an offline cpu.

Signed-off-by: Kevin Hao <kexin.hao@windriver.com>
---
 drivers/staging/fsl_qbman/dpa_sys.h |    2 +-
 1 files changed, 1 insertions(+), 1 deletions(-)

diff --git a/drivers/staging/fsl_qbman/dpa_sys.h b/drivers/staging/fsl_qbman/dpa_sys.h
index 9f8a0a5..be16fe3 100644
--- a/drivers/staging/fsl_qbman/dpa_sys.h
+++ b/drivers/staging/fsl_qbman/dpa_sys.h
@@ -77,7 +77,7 @@ static inline int check_cpu_phandle(phandle ph)
 		pr_err("Can't get %s property 'reg'\n", tmp_node->full_name);
 		return -ENODEV;
 	}
-	for_each_present_cpu(cpu) {
+	for_each_online_cpu(cpu) {
 		if (*cpu_val == get_hard_smp_processor_id(cpu))
 			goto done;
 	}
-- 
1.7.0.2

