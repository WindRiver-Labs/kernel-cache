From b8c805ab8ce5a66ffd744d753e225b9fe7de8c27 Mon Sep 17 00:00:00 2001
From: Roy Zang <tie-fei.zang@freescale.com>
Date: Wed, 12 Jan 2011 12:30:26 +0800
Subject: [PATCH 148/233] sdhci: fix the capability setting for P4080

Extracted from QorIQ-DPAA-SDK-V1-20110609-systembuilder.iso
0119-sdhci-fix-the-capability-setting-for-P4080.patch

P4080 does not support V300 instead of V330. Mask v300 bit in
capability.

Signed-off-by: Roy Zang <tie-fei.zang@freescale.com>
---
 drivers/mmc/host/sdhci.c |    3 ++-
 1 files changed, 2 insertions(+), 1 deletions(-)

diff --git a/drivers/mmc/host/sdhci.c b/drivers/mmc/host/sdhci.c
index c63ba1f..1a20677 100644
--- a/drivers/mmc/host/sdhci.c
+++ b/drivers/mmc/host/sdhci.c
@@ -1729,7 +1729,8 @@ int sdhci_add_host(struct sdhci_host *host)
 	caps = sdhci_readl(host, SDHCI_CAPABILITIES);
 
 	 /* Workaround for P4080 ESDHC12 errata */
-	caps &= ~(SDHCI_CAN_VDD_180 | SDHCI_CAN_VDD_330);
+	if (host->quirks & SDHCI_QUIRK_QORIQ_REG_WEIRD)
+		caps &= ~(SDHCI_CAN_VDD_180 | SDHCI_CAN_VDD_300);
 
 	if (host->quirks & SDHCI_QUIRK_FORCE_DMA)
 		host->flags |= SDHCI_USE_SDMA;
-- 
1.7.0.4

