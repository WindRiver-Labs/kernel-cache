From 98233f4547ea8ac86ffa8ffa7b02888690312753 Mon Sep 17 00:00:00 2001
From: Weiwei Wang <weiwei.wang@windriver.com>
Date: Wed, 27 Jul 2011 16:25:31 +0800
Subject: [PATCH] mmc/host: fix mfspr undefined error

mfspr is only defined in PPC platform, so add #ifdef CONFIG_PPC
to control it.

Signed-off-by: Weiwei Wang <weiwei.wang@windriver.com>
---
 drivers/mmc/host/sdhci.c |    4 ++++
 1 files changed, 4 insertions(+), 0 deletions(-)

diff --git a/drivers/mmc/host/sdhci.c b/drivers/mmc/host/sdhci.c
index c8e77a0..9337ffa 100644
--- a/drivers/mmc/host/sdhci.c
+++ b/drivers/mmc/host/sdhci.c
@@ -174,6 +174,7 @@ static void sdhci_reset(struct sdhci_host *host, u8 mask)
 	if (host->quirks & SDHCI_QUIRK_RESTORE_IRQS_AFTER_RESET)
 		sdhci_clear_set_irqs(host, SDHCI_INT_ALL_MASK, ier);
 
+#ifdef CONFIG_PPC
 	/* Add P4080 ESDHC9 errata workaround.
 	 * Reset value of WML register should be 0x02100210
 	 * Only need on Rev1 silicon
@@ -182,6 +183,7 @@ static void sdhci_reset(struct sdhci_host *host, u8 mask)
 	if (host->quirks & SDHCI_QUIRK_QORIQ_REG_WEIRD)
 		if ((mfspr(SPRN_SVR) & 0xff) == 0x10)
 			sdhci_writel(host, 0x02100210, ESDHC_WML);
+#endif
 
 }
 
@@ -631,6 +633,7 @@ static u8 sdhci_calc_timeout(struct sdhci_host *host, struct mmc_data *data)
 		count = 0xE;
 	}
 
+#ifdef CONFIG_PPC
 	/* Add p4080 ESDHC11 workaround. Only need on Rev1 silicon */
 	if (host->quirks & SDHCI_QUIRK_QORIQ_TIMEOUT_WEIRD)
 		if ((mfspr(SPRN_SVR) & 0xff) == 0x10) {
@@ -641,6 +644,7 @@ static u8 sdhci_calc_timeout(struct sdhci_host *host, struct mmc_data *data)
 			if (count == 12)
 				count = 13;
 		}
+#endif
 
 	return count;
 }
-- 
1.7.0.4

