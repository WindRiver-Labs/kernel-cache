From d3a61886de8a41142a0b33bee2710c42dae8f17d Mon Sep 17 00:00:00 2001
From: Shan Hai <shan.hai@windriver.com>
Date: Mon, 23 Sep 2013 10:29:58 +0800
Subject: [PATCH] mmc/sdhci: fix mmc command timeout error

The commit "p4080ds: fix sd card issue on rev1 board" fixes a mmc command
timeout error for Rev1 board while the Rev2 boards has the same problem too.

Fix the mmc command timeout error by setting BROKEN_TIMEOUT_VAL quirks on both
Rev1/2 boards.

Signed-off-by: Shan Hai <shan.hai@windriver.com>
---
 drivers/mmc/host/sdhci-of-core.c |    3 +--
 1 files changed, 1 insertions(+), 2 deletions(-)

diff --git a/drivers/mmc/host/sdhci-of-core.c b/drivers/mmc/host/sdhci-of-core.c
index a97bef1..c94e423 100644
--- a/drivers/mmc/host/sdhci-of-core.c
+++ b/drivers/mmc/host/sdhci-of-core.c
@@ -189,8 +189,7 @@ static int __devinit sdhci_of_probe(struct of_device *ofdev,
 		host->quirks |= SDHCI_QUIRK_QORIQ_REG_WEIRD |
 			SDHCI_QUIRK_QORIQ_TIMEOUT_WEIRD;
 		host->quirks &= ~SDHCI_QUIRK_INVERTED_WRITE_PROTECT;
-		if ((mfspr(SPRN_SVR) & 0xff) == 0x10)
-			host->quirks |= SDHCI_QUIRK_BROKEN_TIMEOUT_VAL;
+		host->quirks |= SDHCI_QUIRK_BROKEN_TIMEOUT_VAL;
 	}
 
 	if (of_device_is_compatible(np, "fsl,esdhc"))
-- 
1.7.0

