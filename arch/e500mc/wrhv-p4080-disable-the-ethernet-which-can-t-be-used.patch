From 31dbaa84ffa8169d4c031dcb8ce09937c3b9edbd Mon Sep 17 00:00:00 2001
From: Kevin Hao <kexin.hao@windriver.com>
Date: Thu, 19 May 2011 09:06:04 +0800
Subject: [PATCH 1/3] wrhv/p4080: disable the ethernet which can't be used

The P4080 SoC contains 10 total ethernet MACs, but they can't all be
used at the same time for the reasons of pin multiplexing. Currently
we use SerDes protocol 0x10 on P4080. It means that only FM1@DTSEC2,
FM2@DTSEC1, FM2@DTSEC2 and FM2@TGEC1 can be used. We already comment
out FM1@DTSEC1, FM1@DTSEC3, FM1@DTSEC4 and FM1@TGEC1 device nodes in
DTS, but leave FM2@DTSEC3 and FM2@DTSEC4 still here. And the DPAA
driver will also allocate resources for these two ethernets which
can't not be used. Then some resources such as the number of tasks on
FMAN will be exhausted before initializing the FM2@TGEC1, and cause
it malfunction.

Instead of commenting out the ethernet device node, we just mark them
as "disabled" in DTS. This is also what the u-boot do for the native
BSP.

Signed-off-by: Kevin Hao <kexin.hao@windriver.com>
---
 arch/powerpc/boot/dts/wrhv_p4080ds.dts |   10 ++++++----
 1 files changed, 6 insertions(+), 4 deletions(-)

diff --git a/arch/powerpc/boot/dts/wrhv_p4080ds.dts b/arch/powerpc/boot/dts/wrhv_p4080ds.dts
index 37d7d6a..a3621a1 100644
--- a/arch/powerpc/boot/dts/wrhv_p4080ds.dts
+++ b/arch/powerpc/boot/dts/wrhv_p4080ds.dts
@@ -1801,35 +1801,35 @@
 	fsl,dpaa {
 		compatible = "fsl,p4080-dpaa", "fsl,dpaa";
 
-/*
 		ethernet@0 {
+			status = "disabled";
 			compatible = "fsl,p4080-dpa-ethernet", "fsl,dpa-ethernet";
 			fsl,qman-channel = <&qpool1>;
 			fsl,fman-mac = <&enet0>;
 		};
-*/
 		ethernet@1 {
 			compatible = "fsl,p4080-dpa-ethernet", "fsl,dpa-ethernet";
 			fsl,qman-channel = <&qpool1>;
 			fsl,fman-mac = <&enet1>;
 		};
-/*
 		ethernet@2 {
+			status = "disabled";
 			compatible = "fsl,p4080-dpa-ethernet", "fsl,dpa-ethernet";
 			fsl,qman-channel = <&qpool1>;
 			fsl,fman-mac = <&enet2>;
 		};
 		ethernet@3 {
+			status = "disabled";
 			compatible = "fsl,p4080-dpa-ethernet", "fsl,dpa-ethernet";
 			fsl,qman-channel = <&qpool1>;
 			fsl,fman-mac = <&enet3>;
 		};
 		ethernet@4 {
+			status = "disabled";
 			compatible = "fsl,p4080-dpa-ethernet", "fsl,dpa-ethernet";
 			fsl,qman-channel = <&qportal0>;
 			fsl,fman-mac = <&enet4>;
 		};
-*/
 		ethernet@5 {
 			compatible = "fsl,p4080-dpa-ethernet", "fsl,dpa-ethernet";
 			fsl,qman-channel = <&qportal7>;
@@ -1841,11 +1841,13 @@
 			fsl,fman-mac = <&enet6>;
 		};
 		ethernet@7 {
+			status = "disabled";
 			compatible = "fsl,p4080-dpa-ethernet", "fsl,dpa-ethernet";
 			fsl,qman-channel = <&qpool1>;
 			fsl,fman-mac = <&enet7>;
 		};
 		ethernet@8 {
+			status = "disabled";
 			compatible = "fsl,p4080-dpa-ethernet", "fsl,dpa-ethernet";
 			fsl,qman-channel = <&qpool1>;
 			fsl,fman-mac = <&enet8>;
-- 
1.7.0.4

