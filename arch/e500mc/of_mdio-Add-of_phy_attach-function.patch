From 0bcd5255b5055df337a1fdada98d7b599d3193f6 Mon Sep 17 00:00:00 2001
From: Andy Fleming <afleming@freescale.com>
Date: Wed, 7 Apr 2010 14:49:52 -0400
Subject: [PATCH 041/252] of_mdio: Add of_phy_attach function

of_phy_connect is useful for most systems, but some drivers will want
finer-grained control over their PHYs, and won't want to use the
PHY Lib state machine or interrupt handlers.

Signed-off-by: Andy Fleming <afleming@freescale.com>
[Ported the FSL SDK 2.0.3 patch
"kernel-2.6.30-of_mdio-Add-of_phy_attach-function.patch"
to the kernel 2.6.34. 2.6.34 context updates only.]
Integrated-by: Yuri Nedel <Yuri.Nedel@windriver.com>
---
 drivers/of/of_mdio.c    |   13 +++++++++++++
 include/linux/of_mdio.h |    5 ++++-
 2 files changed, 17 insertions(+), 1 deletions(-)

diff --git a/drivers/of/of_mdio.c b/drivers/of/of_mdio.c
index b474833..11ad48a 100644
--- a/drivers/of/of_mdio.c
+++ b/drivers/of/of_mdio.c
@@ -143,6 +143,19 @@ struct phy_device *of_phy_connect(struct net_device *dev,
 }
 EXPORT_SYMBOL(of_phy_connect);
 
+struct phy_device *of_phy_attach(struct net_device *dev,
+				struct device_node *phy_np, u32 flags,
+				phy_interface_t iface)
+{
+	struct phy_device *phy = of_phy_find_device(phy_np);
+
+	if (!phy)
+		return NULL;
+
+	return phy_attach_direct(dev, phy, flags, iface) ? NULL : phy;
+}
+EXPORT_SYMBOL(of_phy_attach);
+
 /**
  * of_phy_connect_fixed_link - Parse fixed-link property and return a dummy phy
  * @dev: pointer to net_device claiming the phy
diff --git a/include/linux/of_mdio.h b/include/linux/of_mdio.h
index 53b94e0..e4a3160 100644
--- a/include/linux/of_mdio.h
+++ b/include/linux/of_mdio.h
@@ -21,5 +21,8 @@ extern struct phy_device *of_phy_connect(struct net_device *dev,
 extern struct phy_device *of_phy_connect_fixed_link(struct net_device *dev,
 					 void (*hndlr)(struct net_device *),
 					 phy_interface_t iface);
-
+struct phy_device *of_phy_attach(struct net_device *dev,
+				struct device_node *phy_np, u32 flags,
+ 				phy_interface_t iface);
+  
 #endif /* __LINUX_OF_MDIO_H */
-- 
1.6.5.2

