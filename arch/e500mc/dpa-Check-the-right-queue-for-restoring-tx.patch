From f1e78b6cc55db69559b88511414626f5f9f279a8 Mon Sep 17 00:00:00 2001
From: Andy Fleming <afleming@freescale.com>
Date: Fri, 7 May 2010 15:54:01 +0800
Subject: [PATCH 122/252] dpa: Check the right queue for restoring tx

0 is the error queue, 1 is the default queue

Signed-off-by: Andy Fleming <afleming@freescale.com>
[Original patch
"kernel-2.6.30-dpa-Check-the-right-queue-for-restoring-tx.patch"
taken from Freescale p4080 SDK 2.1 ISO image. Apply cleanly to kernel 2.6.27]
Integrated-by: Kevin Hao <kexin.hao@windriver.com>
---
 drivers/net/dpa/dpa.c |    2 +-
 1 files changed, 1 insertions(+), 1 deletions(-)

diff --git a/drivers/net/dpa/dpa.c b/drivers/net/dpa/dpa.c
index eeef0ab..bf33fab 100644
--- a/drivers/net/dpa/dpa.c
+++ b/drivers/net/dpa/dpa.c
@@ -1671,7 +1671,7 @@ static void __hot dpa_work(struct work_struct *fd_work)
 	}
 
 	if (netif_queue_stopped(net_dev) &&
-			percpu_priv->count[TX][0] < DPA_MAX_TX_BACKLOG)
+			percpu_priv->count[TX][1] < DPA_MAX_TX_BACKLOG)
 		netif_tx_wake_all_queues(net_dev);
 
 	/* Try again later if we're not done */
-- 
1.6.5.2

