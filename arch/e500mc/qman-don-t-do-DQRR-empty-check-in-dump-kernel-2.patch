From b64fc2afa408e42508c2be44a69c1aa78c6dc4a7 Mon Sep 17 00:00:00 2001
From: Weiwei Wang <weiwei.wang@windriver.com>
Date: Sun, 16 Jan 2011 21:40:24 +0800
Subject: [PATCH 17/28] qman: don't do DQRR empty check in dump kernel

There are maybe some responses in Dequeue Response Ring
which are still not handled by panic kernel. So don't
do empty check for DQRR and just ignore these responses
in dump kernel.

Signed-off-by: Kevin Hao <kexin.hao@windriver.com>
Signed-off-by: Weiwei Wang <weiwei.wang@windriver.com>
---
 drivers/hwqueue/qman_high.c |    2 ++
 1 files changed, 2 insertions(+), 0 deletions(-)

diff --git a/drivers/hwqueue/qman_high.c b/drivers/hwqueue/qman_high.c
index 538aea0..e1ce822 100644
--- a/drivers/hwqueue/qman_high.c
+++ b/drivers/hwqueue/qman_high.c
@@ -416,10 +416,12 @@ int qman_create_affine_portal(const struct qm_portal_config *config, u32 flags,
 	}
 	isdr ^= (QM_PIRQ_DQRI | QM_PIRQ_MRI);
 	qm_isr_disable_write(__p, isdr);
+#ifndef CONFIG_CRASH_DUMP
 	if (qm_dqrr_current(__p) != NULL) {
 		pr_err("Qman DQRR unclean, need recovery\n");
 		goto fail_dqrr_mr_empty;
 	}
+#endif
 	if (qm_mr_current(__p) != NULL) {
 		/* special handling, drain just in case it's a few FQRNIs */
 		if (drain_mr_fqrni(__p)) {
-- 
1.6.5.2

