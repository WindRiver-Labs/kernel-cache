From 7367d0bfc4b46217d40012cce7b5dfcab6d05274 Mon Sep 17 00:00:00 2001
From: Pengyu Ma <pengyu.ma@windriver.com>
Date: Wed, 24 Dec 2014 06:44:24 +0000
Subject: [PATCH] Force PCI bar memory resource within 32-bit address on
 x86-32 arch

PCI 64-bit bar memory resource that set by BIOS was set as default,
but it can NOT be remapped to a correct virtual address on 32-bit kernel.
Make it fallback within 32-bit address is a safe way.

Signed-off-by: Pengyu Ma <pengyu.ma@windriver.com>
Signed-off-by: Luming Yu <luming.yu@intel.com>
---
 arch/x86/pci/acpi.c |    2 ++
 1 files changed, 2 insertions(+), 0 deletions(-)

diff --git a/arch/x86/pci/acpi.c b/arch/x86/pci/acpi.c
index 4f25ec0..51853fa 100644
--- a/arch/x86/pci/acpi.c
+++ b/arch/x86/pci/acpi.c
@@ -252,7 +252,9 @@ resource_to_addr(struct acpi_resource *resource,
 		return AE_OK;
 	case ACPI_RESOURCE_TYPE_ADDRESS16:
 	case ACPI_RESOURCE_TYPE_ADDRESS32:
+#if BITS_PER_LONG == 64
 	case ACPI_RESOURCE_TYPE_ADDRESS64:
+#endif
 		status = acpi_resource_to_address64(resource, addr);
 		if (ACPI_SUCCESS(status) &&
 		    (addr->resource_type == ACPI_MEMORY_RANGE ||
-- 
1.7.5.4

