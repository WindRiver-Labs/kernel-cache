From 23faccb8a4bf3f9dc242570b9cfb95c7702c7987 Mon Sep 17 00:00:00 2001
From: Liming Wang <liming.wang@windriver.com>
Date: Fri, 23 Jul 2010 00:39:33 -0700
Subject: [PATCH] mips/syscall: add __NR_getdents64 to N32 syscall table

To support 64-bit inodes and generally make the C library 64-bit readdir
routines work right, the kernel should export an explicit __NR_getdents64
interface on N32 ABI.

Signed-off-by: Liming Wang <liming.wang@windriver.com>
---
 arch/mips/include/asm/unistd.h |    5 +++--
 arch/mips/kernel/scall64-n32.S |    1 +
 2 files changed, 4 insertions(+), 2 deletions(-)

diff --git a/arch/mips/include/asm/unistd.h b/arch/mips/include/asm/unistd.h
index 1b5a664..baa318a 100644
--- a/arch/mips/include/asm/unistd.h
+++ b/arch/mips/include/asm/unistd.h
@@ -984,16 +984,17 @@
 #define __NR_perf_event_open		(__NR_Linux + 296)
 #define __NR_accept4			(__NR_Linux + 297)
 #define __NR_recvmmsg			(__NR_Linux + 298)
+#define __NR_getdents64			(__NR_Linux + 299)
 
 /*
  * Offset of the last N32 flavoured syscall
  */
-#define __NR_Linux_syscalls		298
+#define __NR_Linux_syscalls		299
 
 #endif /* _MIPS_SIM == _MIPS_SIM_NABI32 */
 
 #define __NR_N32_Linux			6000
-#define __NR_N32_Linux_syscalls		298
+#define __NR_N32_Linux_syscalls		299
 
 #ifdef __KERNEL__
 
diff --git a/arch/mips/kernel/scall64-n32.S b/arch/mips/kernel/scall64-n32.S
index 746a322..f5973ce 100644
--- a/arch/mips/kernel/scall64-n32.S
+++ b/arch/mips/kernel/scall64-n32.S
@@ -423,4 +423,5 @@ EXPORT(sysn32_call_table)
 	PTR	sys_perf_event_open
 	PTR	sys_accept4
 	PTR     compat_sys_recvmmsg
+	PTR     sys_getdents64
 	.size	sysn32_call_table,.-sysn32_call_table
-- 
1.6.5.2

