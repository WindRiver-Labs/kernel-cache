From 0901fb29776ba23823b5c065a77407b812c4cc7f Mon Sep 17 00:00:00 2001
From: Liming Wang <liming.wang@windriver.com>
Date: Tue, 22 May 2012 17:51:58 +0800
Subject: [PATCH 05/28] SPEAr: update Kconfig and Makefile to support
 spear13xx machines

Update Kconfig and Makefile to include plat-spear13xx
and mach-spear13xx directories to build.

Signed-off-by: Liming Wang <liming.wang@windriver.com>
---
 arch/arm/Kconfig                |    4 ++++
 arch/arm/Makefile               |    5 +++++
 arch/arm/plat-spear/Kconfig     |   16 +++++++++++++++
 arch/arm/plat-spear13xx/Kconfig |   42 ---------------------------------------
 4 files changed, 25 insertions(+), 42 deletions(-)

diff --git a/arch/arm/Kconfig b/arch/arm/Kconfig
index c146cdd..a019145 100644
--- a/arch/arm/Kconfig
+++ b/arch/arm/Kconfig
@@ -985,7 +985,10 @@ config PLAT_SPEAR
 	select CLKDEV_LOOKUP
 	select CLKSRC_MMIO
 	select GENERIC_CLOCKEVENTS
+	select GENERIC_GPIO
+	select GENERIC_TIME
 	select HAVE_CLK
+	select ARCH_HAS_CPUFREQ
 	help
 	  Support for ST's SPEAr platform (SPEAr3xx, SPEAr6xx and SPEAr13xx).
 
@@ -1094,6 +1097,7 @@ source "arch/arm/plat-s3c24xx/Kconfig"
 source "arch/arm/plat-s5p/Kconfig"
 
 source "arch/arm/plat-spear/Kconfig"
+source "arch/arm/plat-spear13xx/Kconfig"
 
 source "arch/arm/mach-s3c24xx/Kconfig"
 if ARCH_S3C24XX
diff --git a/arch/arm/Makefile b/arch/arm/Makefile
index 9db0fd0..98b8e0f 100644
--- a/arch/arm/Makefile
+++ b/arch/arm/Makefile
@@ -193,6 +193,7 @@ machine-$(CONFIG_ARCH_VEXPRESS)		:= vexpress
 machine-$(CONFIG_ARCH_VT8500)		:= vt8500
 machine-$(CONFIG_ARCH_W90X900)		:= w90x900
 machine-$(CONFIG_FOOTBRIDGE)		:= footbridge
+machine-$(CONFIG_ARCH_SPEAR13XX)	:= spear13xx
 machine-$(CONFIG_MACH_SPEAR300)		:= spear3xx
 machine-$(CONFIG_MACH_SPEAR310)		:= spear3xx
 machine-$(CONFIG_MACH_SPEAR320)		:= spear3xx
@@ -211,7 +212,11 @@ plat-$(CONFIG_PLAT_ORION)	:= orion
 plat-$(CONFIG_PLAT_PXA)		:= pxa
 plat-$(CONFIG_PLAT_S3C24XX)	:= s3c24xx samsung
 plat-$(CONFIG_PLAT_S5P)		:= s5p samsung
+ifeq ($(CONFIG_ARCH_SPEAR13XX),y)
+plat-$(CONFIG_PLAT_SPEAR)	:= spear13xx
+else
 plat-$(CONFIG_PLAT_SPEAR)	:= spear
+endif
 plat-$(CONFIG_PLAT_VERSATILE)	:= versatile
 
 ifeq ($(CONFIG_ARCH_EBSA110),y)
diff --git a/arch/arm/plat-spear/Kconfig b/arch/arm/plat-spear/Kconfig
index 1bb3dbc..604bb68 100644
--- a/arch/arm/plat-spear/Kconfig
+++ b/arch/arm/plat-spear/Kconfig
@@ -22,10 +22,26 @@ config ARCH_SPEAR6XX
 	help
 	  Supports for ARM's SPEAR6XX family
 
+config ARCH_SPEAR13XX
+	bool "SPEAr13XX"
+	select ARM_GIC
+	select CPU_V7
+	select ARCH_SUPPORTS_MSI
+	select HAVE_SMP
+	select MIGHT_HAVE_CACHE_L2X0
+	select ARCH_SUPPORTS_MSI
+	select MIGHT_HAVE_PCI
+
+	help
+	  Supports for ARM's SPEAR13XX family
+
 endchoice
 
 # Adding SPEAr machine specific configuration files
 source "arch/arm/mach-spear3xx/Kconfig"
 source "arch/arm/mach-spear6xx/Kconfig"
 
+# Adding SPEAr13xx machine specific configuration files
+source "arch/arm/mach-spear13xx/Kconfig"
+
 endif
diff --git a/arch/arm/plat-spear13xx/Kconfig b/arch/arm/plat-spear13xx/Kconfig
index 8deab16..cd24a1d 100644
--- a/arch/arm/plat-spear13xx/Kconfig
+++ b/arch/arm/plat-spear13xx/Kconfig
@@ -2,56 +2,14 @@
 # SPEAr Platform configuration file
 #
 
-if PLAT_SPEAR
-
-choice
-	prompt "ST SPEAr Family"
-	default ARCH_SPEAR3XX
-
-config ARCH_SPEAR13XX
-	bool "SPEAr13XX"
-	select ARM_GIC
-	select CPU_V7
-	select ARCH_SUPPORTS_MSI
-	select HAVE_SMP
-	select MIGHT_HAVE_CACHE_L2X0
-	select ARCH_SUPPORTS_MSI
-	select MIGHT_HAVE_PCI
-
-	help
-	  Supports for ARM's SPEAR13XX family
-
-config ARCH_SPEAR3XX
-	bool "SPEAr3XX"
-	select ARM_VIC
-	select CPU_ARM926T
-	help
-	  Supports for ARM's SPEAR3XX family
-
-config ARCH_SPEAR6XX
-	bool "SPEAr6XX"
-	select ARM_VIC
-	select CPU_ARM926T
-	help
-	  Supports for ARM's SPEAR6XX family
-
-endchoice
-
 config SPEAR_PLUG_BOARDS
 	bool "SPEAr Plug Boards"
 	help
 	  Supports ST SPEAr Plug boards
 
-# Adding SPEAr machine specific configuration files
-source "arch/arm/mach-spear13xx/Kconfig"
-source "arch/arm/mach-spear3xx/Kconfig"
-source "arch/arm/mach-spear6xx/Kconfig"
-
 config SPEAR_PWM
 	tristate "SPEAr Pulse Width Modulator"
 	depends on CPU_SPEAR320 || CPU_SPEAR1340
 	default y
 	help
 	  Support for ST Microelectronics Pulse Width Modulator present on SPEAr Platform.
-
-endif
-- 
1.7.9.7

