From 2442be3133ed547340408c3cccafed40d122f688 Mon Sep 17 00:00:00 2001
From: Archit Taneja <archit@ti.com>
Date: Fri, 20 Sep 2013 19:25:53 +0530
Subject: [PATCH 0411/1115] arm: omap: display: Create drm, fb and v4l devices
 in omapdss_init_of

Create omapdrm, omapfb, omapvrfb and omap_vout in the case omapdss is created
via device tree.

Signed-off-by: Archit Taneja <archit@ti.com>
(cherry picked from commit 193e378b6d4fddbb9746e083b12945db1defea4b)
Signed-off-by: Zumeng Chen <zumeng.chen@windriver.com>
---
 arch/arm/mach-omap2/display.c |   28 ++++++++++++++++++++++++++++
 1 files changed, 28 insertions(+), 0 deletions(-)

diff --git a/arch/arm/mach-omap2/display.c b/arch/arm/mach-omap2/display.c
index de78ee6..3279afc 100644
--- a/arch/arm/mach-omap2/display.c
+++ b/arch/arm/mach-omap2/display.c
@@ -624,5 +624,33 @@ int __init omapdss_init_of(void)
 		return r;
 	}
 
+	/* create DRM device */
+	r = omap_init_drm();
+	if (r < 0) {
+		pr_err("Unable to register omapdrm device\n");
+		return r;
+	}
+
+	/* create vrfb device */
+	r = omap_init_vrfb();
+	if (r < 0) {
+		pr_err("Unable to register omapvrfb device\n");
+		return r;
+	}
+
+	/* create FB device */
+	r = omap_init_fb();
+	if (r < 0) {
+		pr_err("Unable to register omapfb device\n");
+		return r;
+	}
+
+	/* create V4L2 display device */
+	r = omap_init_vout();
+	if (r < 0) {
+		pr_err("Unable to register omap_vout device\n");
+		return r;
+	}
+
 	return 0;
 }
-- 
1.7.5.4

