From d64962e1ee371f3dd71a9ca6c46e18a1fb1ca32f Mon Sep 17 00:00:00 2001
From: Rajendra Nayak <rnayak@ti.com>
Date: Wed, 16 Oct 2013 18:05:58 +0530
Subject: [PATCH 0621/1115] reset: ti_reset: Add support for DRA7 PCIe reset

Add support for DRA7 PCIe reset

Signed-off-by: Rajendra Nayak <rnayak@ti.com>
Signed-off-by: Kishon Vijay Abraham I <kishon@ti.com>
(cherry picked from commit 4422e028116e147ac190de0d17e4f05ddb95f307)
Signed-off-by: Zumeng Chen <zumeng.chen@windriver.com>
---
 arch/arm/mach-omap2/Kconfig |    2 ++
 drivers/reset/ti_reset.c    |   15 +++++++++++++++
 2 files changed, 17 insertions(+), 0 deletions(-)

diff --git a/arch/arm/mach-omap2/Kconfig b/arch/arm/mach-omap2/Kconfig
index cfb2197..adb5753 100644
--- a/arch/arm/mach-omap2/Kconfig
+++ b/arch/arm/mach-omap2/Kconfig
@@ -150,6 +150,8 @@ config SOC_DRA7XX
 	select HAVE_SMP
 	select COMMON_CLK
 	select CROSSBAR
+	select ARCH_HAS_RESET_CONTROLLER
+	select RESET_TI
 
 comment "OMAP Core Type"
 	depends on ARCH_OMAP2
diff --git a/drivers/reset/ti_reset.c b/drivers/reset/ti_reset.c
index 7b1447d..4ec49e9 100644
--- a/drivers/reset/ti_reset.c
+++ b/drivers/reset/ti_reset.c
@@ -61,6 +61,20 @@ static struct ti_reset_data am43x_reset_data = {
 	.nr_resets	= ARRAY_SIZE(am43x_reset_reg_data),
 };
 
+static struct ti_reset_reg_data dra7_reset_reg_data[] = {
+	{
+		.rstctrl_offs	= 0x1310,
+		.rstst_offs	= 0x1314,
+		.rstctrl_bit	= 0,
+		.rstst_bit	= 0,
+	},
+};
+
+static struct ti_reset_data dra7_reset_data = {
+	.reg_data	= dra7_reset_reg_data,
+	.nr_resets	= ARRAY_SIZE(dra7_reset_reg_data),
+};
+
 static int ti_reset_clear_reset(struct reset_controller_dev *rcdev,
 				  unsigned long id)
 {
@@ -111,6 +125,7 @@ static struct reset_controller_dev ti_reset_controller = {
 static const struct of_device_id ti_reset_of_match[] = {
 	{ .compatible = "ti,am3352-prcm", .data = &am335x_reset_data,},
 	{ .compatible = "ti,am4372-prcm", .data = &am43x_reset_data,},
+	{ .compatible = "ti,dra7-prcm", .data = &dra7_reset_data,},
 	{},
 };
 
-- 
1.7.5.4

