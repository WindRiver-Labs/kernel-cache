From 3d853bcbe2c69b4ead300d9274f735f7cb83a184 Mon Sep 17 00:00:00 2001
From: Suman Anna <s-anna@ti.com>
Date: Thu, 18 Jul 2013 19:31:57 -0500
Subject: [PATCH 0698/1115] ARM: OMAP: remoteproc: assign timers for DRA7xx
 IPU processors

The GPTimers #3 and #11 are chosen as the BIOS tick source for the
DRA7xx IPU2 and IPU1 processors respectively, so add this timer data
to the DRA7xx remoteproc platform data. This is needed for successfully
booting an IPU image configured with these timers. The timers are
optional, but are mandatory to support device management features
such as power management and watchdog support.

The timer id for each processor needs to be unique so that other
processors can be run simultaneously. The IPUs are currently expected
to be running in SMP-mode, which requires only a single BIOS tick
timer per processor sub-system.

GPT11 is chosen for IPU2 based on its unique capabilities mask
previously, but the timer request logic no longer uses the capabilities
match logic. The GPT11 is chosen to maintain compatibility with the
firmware images.

Signed-off-by: Suman Anna <s-anna@ti.com>
(cherry picked from commit a1be8681b2bdb282e74be97b50f03b9000b6b306)
Signed-off-by: Zumeng Chen <zumeng.chen@windriver.com>
---
 arch/arm/mach-omap2/remoteproc.c |    8 ++++++++
 1 files changed, 8 insertions(+), 0 deletions(-)

diff --git a/arch/arm/mach-omap2/remoteproc.c b/arch/arm/mach-omap2/remoteproc.c
index fb47bd3..02dffce 100644
--- a/arch/arm/mach-omap2/remoteproc.c
+++ b/arch/arm/mach-omap2/remoteproc.c
@@ -97,6 +97,10 @@ static struct omap_rproc_timers_info dsp_timers[] = {
 	{ .name = "timer5", },
 };
 
+static struct omap_rproc_timers_info ipu1_timers[] = {
+	{ .name = "timer11", },
+};
+
 /*
  * These data structures define platform-specific information
  * needed for each supported remote processor.
@@ -134,6 +138,8 @@ static struct omap_rproc_pdata dra7_rproc_data[] = {
 		.firmware	= "dra7-ipu2-fw.xem4",
 		.mbox_name	= "mbox-ipu2",
 		.oh_name	= "ipu2",
+		.timers		= ipu_timers,
+		.timers_cnt	= ARRAY_SIZE(ipu_timers),
 	},
 	{
 		.name		= "dsp2",
@@ -147,6 +153,8 @@ static struct omap_rproc_pdata dra7_rproc_data[] = {
 		.firmware	= "dra7-ipu1-fw.xem4",
 		.mbox_name	= "mbox-ipu1",
 		.oh_name	= "ipu1",
+		.timers		= ipu1_timers,
+		.timers_cnt	= ARRAY_SIZE(ipu1_timers),
 	},
 };
 
-- 
1.7.5.4

