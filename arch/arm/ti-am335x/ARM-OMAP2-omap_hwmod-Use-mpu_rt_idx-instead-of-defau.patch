From 7627a5a8200d38e8c79fe540021f323bc314fc88 Mon Sep 17 00:00:00 2001
From: Dave Gerlach <d-gerlach@ti.com>
Date: Mon, 7 Oct 2013 11:29:35 +0530
Subject: [PATCH 0556/1115] ARM: OMAP2+: omap_hwmod: Use mpu_rt_idx instead of
 default '0' index

commit '74fb9f3474ab52e69151bec241e240363258ec8d' "ARM: OMAP2+: Add support
to parse 'main_clk' info from DT" wrongly removed the use of mpu_rt_idx as the
index and instead used a default '0' index for of_iomap() to map the modules
register address space.

AM33xx devices have a cpgmac module which has the mpu_rt_idx defined as 1 and
hence the above change caused hangs on these devices during suspend resume
as PER domain (to which the cpgmac module belongs) could not transition.

Signed-off-by: Dave Gerlach <d-gerlach@ti.com>
(cherry picked from commit 11c2715e1fc2bc3ffa46551d04fe3f2e83ef3462)
Signed-off-by: Zumeng Chen <zumeng.chen@windriver.com>
---
 arch/arm/mach-omap2/omap_hwmod.c |    2 +-
 1 files changed, 1 insertions(+), 1 deletions(-)

diff --git a/arch/arm/mach-omap2/omap_hwmod.c b/arch/arm/mach-omap2/omap_hwmod.c
index 7ab155d..c563ab9 100644
--- a/arch/arm/mach-omap2/omap_hwmod.c
+++ b/arch/arm/mach-omap2/omap_hwmod.c
@@ -2454,7 +2454,7 @@ static void __init _init_mpu_rt_base(struct omap_hwmod *oh, void *data,
 		if (!np)
 			return;
 
-		va_start = of_iomap(np, 0);
+		va_start = of_iomap(np, oh->mpu_rt_idx);
 	} else {
 		va_start = ioremap(mem->pa_start, mem->pa_end - mem->pa_start);
 	}
-- 
1.7.5.4

