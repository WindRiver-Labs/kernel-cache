From ae342eb4d92b329118048ad5b74b8fb1d63a5e65 Mon Sep 17 00:00:00 2001
From: Rajendra Nayak <rnayak@ti.com>
Date: Wed, 18 Sep 2013 19:17:31 +0530
Subject: [PATCH 0377/1115] ARM: DRA7: Fix crash with earlycon enabled

With earlycon enabled, hwmod needs to know not to reset
the debug console. Do this by adding the right CONFIG_DEBUG_OMAPxUARTy
FLAGS for dra7 uart1.

Signed-off-by: Rajendra Nayak <rnayak@ti.com>
(cherry picked from commit fa75bf7bd48256af476e21d09eca45348fda8314)
Signed-off-by: Zumeng Chen <zumeng.chen@windriver.com>
---
 arch/arm/mach-omap2/omap_hwmod_7xx_data.c |    2 +-
 1 files changed, 1 insertions(+), 1 deletions(-)

diff --git a/arch/arm/mach-omap2/omap_hwmod_7xx_data.c b/arch/arm/mach-omap2/omap_hwmod_7xx_data.c
index 2b20140..c0454dc 100644
--- a/arch/arm/mach-omap2/omap_hwmod_7xx_data.c
+++ b/arch/arm/mach-omap2/omap_hwmod_7xx_data.c
@@ -1542,7 +1542,7 @@ static struct omap_hwmod dra7xx_uart1_hwmod = {
 	.name		= "uart1",
 	.class		= &dra7xx_uart_hwmod_class,
 	.clkdm_name	= "l4per_clkdm",
-	.flags		= HWMOD_SWSUP_SIDLE_ACT,
+	.flags		= DEBUG_OMAP2UART1_FLAGS | HWMOD_SWSUP_SIDLE_ACT,
 	.prcm = {
 		.omap4 = {
 			.clkctrl_offs = DRA7XX_CM_L4PER_UART1_CLKCTRL_OFFSET,
-- 
1.7.5.4

