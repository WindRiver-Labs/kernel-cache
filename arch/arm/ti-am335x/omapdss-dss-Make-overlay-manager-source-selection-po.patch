From 7257163b5ddcdaabefa79864c839c6bc7e3aba36 Mon Sep 17 00:00:00 2001
From: Archit Taneja <archit@ti.com>
Date: Thu, 4 Apr 2013 20:04:12 +0530
Subject: [PATCH 0539/1115] omapdss: dss: Make overlay manager source
 selection possible for multiple DPI IPs

DRA7x has 3 DPI IPs, out of these DPI1 has a configurable source while the
others don't. Create a func which allows us to select sources for different DPI
instances.

A new dss feat struct is needed for DRA7x, add it.
Signed-off-by: Archit Taneja <archit@ti.com>
(cherry picked from commit 767528a3fd6bbf07305bae1ae6c18332ecc0ddf2)
Signed-off-by: Zumeng Chen <zumeng.chen@windriver.com>
---
 drivers/video/omap2/dss/dss.c |   20 +++++++++++++++++++-
 1 files changed, 19 insertions(+), 1 deletions(-)

diff --git a/drivers/video/omap2/dss/dss.c b/drivers/video/omap2/dss/dss.c
index 3b6db42..ec61aa5 100644
--- a/drivers/video/omap2/dss/dss.c
+++ b/drivers/video/omap2/dss/dss.c
@@ -691,6 +691,14 @@ static int dss_dpi_select_source_omap5(int module_id, enum omap_channel channel)
 	return 0;
 }
 
+static int dss_dpi_select_source_dra7xx(int module_id, enum omap_channel channel)
+{
+	if (module_id != 0)
+		return 0;
+
+	return dss_dpi_select_source_omap5(module_id, channel);
+}
+
 int dss_dpi_select_source(int module_id, enum omap_channel channel)
 {
 	return dss.feat->dpi_select_source(module_id, channel);
@@ -797,6 +805,13 @@ static const struct dss_features omap54xx_dss_feats __initconst = {
 	.dpi_select_source	=	&dss_dpi_select_source_omap5,
 };
 
+static const struct dss_features dra7xx_dss_feats __initconst = {
+	.fck_div_max		=	64,
+	.dss_fck_multiplier	=	1,
+	.clk_name		=	"dpll_per_h12x2_ck",
+	.dpi_select_source	=	&dss_dpi_select_source_dra7xx,
+};
+
 static int __init dss_init_features(struct platform_device *pdev)
 {
 	const struct dss_features *src;
@@ -830,10 +845,13 @@ static int __init dss_init_features(struct platform_device *pdev)
 		break;
 
 	case OMAPDSS_VER_OMAP5:
-	case OMAPDSS_VER_DRA7xx:
 		src = &omap54xx_dss_feats;
 		break;
 
+	case OMAPDSS_VER_DRA7xx:
+		src = &dra7xx_dss_feats;
+		break;
+
 	default:
 		return -ENODEV;
 	}
-- 
1.7.5.4

