From 664637b8cb762c3923d539cbeafecc30dedbec53 Mon Sep 17 00:00:00 2001
From: George Cherian <george.cherian@ti.com>
Date: Tue, 10 Dec 2013 11:36:44 +0530
Subject: [PATCH 0705/1115] ARM: OMAP2+: AM437x: use non-coherent DMA when
 available

AM43x hangs if UVC driver Coherent DMA buffers. Instruct the UVC
driver to use NON COHERENT DMA buffers.

Hang is due to bug in early internal version of AM43x engineering
sample, production version does not have this bug and can be reverted
at that time.

Signed-off-by: George Cherian <george.cherian@ti.com>
Signed-off-by: Sekhar Nori <nsekhar@ti.com>
(cherry picked from commit 1dbb709ff3d094bc59d9ba41e5307bb688393f35)
Signed-off-by: Zumeng Chen <zumeng.chen@windriver.com>
---
 arch/arm/Kconfig            |    4 ++++
 arch/arm/mach-omap2/Kconfig |    1 +
 2 files changed, 5 insertions(+), 0 deletions(-)

diff --git a/arch/arm/Kconfig b/arch/arm/Kconfig
index 887766e..bd8bda0 100644
--- a/arch/arm/Kconfig
+++ b/arch/arm/Kconfig
@@ -188,6 +188,10 @@ config ARCH_MAY_HAVE_PC_FDC
 config ZONE_DMA
 	bool
 
+config DMA_NONCOHERENT
+	bool
+	select NEED_DMA_MAP_STATE
+
 config NEED_DMA_MAP_STATE
        def_bool y
 
diff --git a/arch/arm/mach-omap2/Kconfig b/arch/arm/mach-omap2/Kconfig
index 99c17e2..2141acb 100644
--- a/arch/arm/mach-omap2/Kconfig
+++ b/arch/arm/mach-omap2/Kconfig
@@ -86,6 +86,7 @@ config SOC_AM43XX
 	select MULTI_IRQ_HANDLER
 	select ARM_GIC
 	select COMMON_CLK
+	select DMA_NONCOHERENT
 	select MACH_OMAP_GENERIC
 	select MIGHT_HAVE_CACHE_L2X0
 	select ARCH_HAS_RESET_CONTROLLER
-- 
1.7.5.4

