From e36633a2bd116d0a919a28aa14bd30347c7032f6 Mon Sep 17 00:00:00 2001
From: Dave Gerlach <d-gerlach@ti.com>
Date: Wed, 16 Oct 2013 19:51:19 +0000
Subject: [PATCH 0618/1115] ARM: OMAP2+: AM33XX: Hard code virtual address for
 am33xx_dram_sync

Rev 1.5B of AM335x EVM has 1GB memory which prevents a 1:1 mapping from
physical to virtual memory. Hard code assignment of virtual address for
uncached memory page needed for emif power configuration (see commit
9461486d37643d0922f11fa3ef10006e99c25ad6 for further details).

Signed-off-by: Dave Gerlach <d-gerlach@ti.com>
Acked-by: Rajendra Nayak <rnayak@ti.com>
(cherry picked from commit 28bc966ad981be4aebe05f07562a105dec9a9aaa)
Signed-off-by: Zumeng Chen <zumeng.chen@windriver.com>
---
 arch/arm/mach-omap2/common.c |    4 +++-
 1 files changed, 3 insertions(+), 1 deletions(-)

diff --git a/arch/arm/mach-omap2/common.c b/arch/arm/mach-omap2/common.c
index 968ad73..36089d7 100644
--- a/arch/arm/mach-omap2/common.c
+++ b/arch/arm/mach-omap2/common.c
@@ -21,6 +21,8 @@
 #include "common.h"
 #include "omap-secure.h"
 
+#define AM33XX_DRAM_SYNC_VA 0xfe600000
+
 /*
  * Stub function for OMAP2 so that common files
  * continue to build when custom builds are used
@@ -55,7 +57,7 @@ void __init am33xx_dram_sync_init(void)
 {
 	struct map_desc dram_io_desc[1];
 
-	dram_io_desc[0].virtual = __phys_to_virt(am33xx_paddr);
+	dram_io_desc[0].virtual = AM33XX_DRAM_SYNC_VA;
 	dram_io_desc[0].pfn = __phys_to_pfn(am33xx_paddr);
 	dram_io_desc[0].length = am33xx_size;
 	dram_io_desc[0].type = MT_MEMORY_SO;
-- 
1.7.5.4

