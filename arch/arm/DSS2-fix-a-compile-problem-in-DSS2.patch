From fba6cafedb3c79731f23b88c952c741d67fc953d Mon Sep 17 00:00:00 2001
From: Stanley.Miao <stanley.miao@windriver.com>
Date: Thu, 18 Mar 2010 14:28:19 +0800
Subject: [PATCH 1/3] DSS2: fix a compile problem in DSS2

Tomi Valkeinen added a patch to manipulate the regulator device "vdds_dsi"
in dpi.c, but this patch doesn't apply to am3517/am3505, because there is
no the regulator device "vdds_dsi" on am3517/am3505. So encapsulate the
regulator API under "!cpu_is_omap3517() && !cpu_is_omap3505()".

Signed-off-by: Stanley.Miao <stanley.miao@windriver.com>
---
 drivers/video/omap2/dss/dpi.c |    8 ++++----
 1 files changed, 4 insertions(+), 4 deletions(-)

diff --git a/drivers/video/omap2/dss/dpi.c b/drivers/video/omap2/dss/dpi.c
index 960e977..3a8edfa 100644
--- a/drivers/video/omap2/dss/dpi.c
+++ b/drivers/video/omap2/dss/dpi.c
@@ -163,7 +163,7 @@ int omapdss_dpi_display_enable(struct omap_dss_device *dssdev)
 		goto err0;
 	}
 
-	if (cpu_is_omap34xx()) {
+	if (cpu_is_omap34xx() && !cpu_is_omap3517() && !cpu_is_omap3505()) {
 		r = regulator_enable(dpi.vdds_dsi_reg);
 		if (r)
 			goto err1;
@@ -199,7 +199,7 @@ err3:
 #endif
 err2:
 	dss_clk_disable(DSS_CLK_ICK | DSS_CLK_FCK1);
-	if (cpu_is_omap34xx())
+	if (cpu_is_omap34xx() && !cpu_is_omap3517() && !cpu_is_omap3505())
 		regulator_disable(dpi.vdds_dsi_reg);
 err1:
 	omap_dss_stop_device(dssdev);
@@ -220,7 +220,7 @@ void omapdss_dpi_display_disable(struct omap_dss_device *dssdev)
 
 	dss_clk_disable(DSS_CLK_ICK | DSS_CLK_FCK1);
 
-	if (cpu_is_omap34xx())
+	if (cpu_is_omap34xx() && !cpu_is_omap3517() && !cpu_is_omap3505())
 		regulator_disable(dpi.vdds_dsi_reg);
 
 	omap_dss_stop_device(dssdev);
@@ -304,7 +304,7 @@ int dpi_init_display(struct omap_dss_device *dssdev)
 
 int dpi_init(struct platform_device *pdev)
 {
-	if (cpu_is_omap34xx()) {
+	if (cpu_is_omap34xx() && !cpu_is_omap3517() && !cpu_is_omap3505()) {
 		dpi.vdds_dsi_reg = dss_get_vdds_dsi();
 		if (IS_ERR(dpi.vdds_dsi_reg)) {
 			DSSERR("can't get VDDS_DSI regulator\n");
-- 
1.6.5.2

