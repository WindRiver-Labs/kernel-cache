From d4a9cf6c4ff4d6a1e1e1a6ca81af57445e7bfeb9 Mon Sep 17 00:00:00 2001
From: Jiang Lu <lu.jiang@windriver.com>
Date: Thu, 9 Jun 2011 16:24:00 +0800
Subject: [PATCH 4/4] ARM:CNS3xxx:Adjust vmalloc space

The CNS3xxx Validation Board implements 128MB NOR
flash, which use phyical memory map MTD driver.
It need 128MB in vmalloc space. So need adjust
vmalloc space to accomodate the space for NOR
flash.

This patch set virtual address of PCIe to 0xf0000000
from 0xe000000, set end of vmalloc space to
0xF0000000 from 0xd8000000.

Signed-off-by: Jiang Lu <lu.jiang@windriver.com>
---
 arch/arm/mach-cns3xxx/include/mach/cns3xxx.h |   24 ++++++++++++------------
 arch/arm/mach-cns3xxx/include/mach/vmalloc.h |    2 +-
 2 files changed, 13 insertions(+), 13 deletions(-)

diff --git a/arch/arm/mach-cns3xxx/include/mach/cns3xxx.h b/arch/arm/mach-cns3xxx/include/mach/cns3xxx.h
index 6dbce13..94cca22 100644
--- a/arch/arm/mach-cns3xxx/include/mach/cns3xxx.h
+++ b/arch/arm/mach-cns3xxx/include/mach/cns3xxx.h
@@ -190,40 +190,40 @@
 #define CNS3XXX_L2C_BASE_VIRT			0xFFF27000
 
 #define CNS3XXX_PCIE0_MEM_BASE			0xA0000000	/* PCIe Port 0 IO/Memory Space */
-#define CNS3XXX_PCIE0_MEM_BASE_VIRT		0xE0000000
+#define CNS3XXX_PCIE0_MEM_BASE_VIRT		0xF0000000
 
 #define CNS3XXX_PCIE0_HOST_BASE			0xAB000000	/* PCIe Port 0 RC Base */
-#define CNS3XXX_PCIE0_HOST_BASE_VIRT		0xE1000000
+#define CNS3XXX_PCIE0_HOST_BASE_VIRT		0xF1000000
 
 #define CNS3XXX_PCIE0_IO_BASE			0xAC000000	/* PCIe Port 0 */
-#define CNS3XXX_PCIE0_IO_BASE_VIRT		0xE2000000
+#define CNS3XXX_PCIE0_IO_BASE_VIRT		0xF2000000
 
 #define CNS3XXX_PCIE0_CFG0_BASE			0xAD000000	/* PCIe Port 0 CFG Type 0 */
-#define CNS3XXX_PCIE0_CFG0_BASE_VIRT		0xE3000000
+#define CNS3XXX_PCIE0_CFG0_BASE_VIRT		0xF3000000
 
 #define CNS3XXX_PCIE0_CFG1_BASE			0xAE000000	/* PCIe Port 0 CFG Type 1 */
-#define CNS3XXX_PCIE0_CFG1_BASE_VIRT		0xE4000000
+#define CNS3XXX_PCIE0_CFG1_BASE_VIRT		0xF4000000
 
 #define CNS3XXX_PCIE0_MSG_BASE			0xAF000000	/* PCIe Port 0 Message Space */
-#define CNS3XXX_PCIE0_MSG_BASE_VIRT		0xE5000000
+#define CNS3XXX_PCIE0_MSG_BASE_VIRT		0xF5000000
 
 #define CNS3XXX_PCIE1_MEM_BASE			0xB0000000	/* PCIe Port 1 IO/Memory Space */
-#define CNS3XXX_PCIE1_MEM_BASE_VIRT		0xE8000000
+#define CNS3XXX_PCIE1_MEM_BASE_VIRT		0xF8000000
 
 #define CNS3XXX_PCIE1_HOST_BASE			0xBB000000	/* PCIe Port 1 RC Base */
-#define CNS3XXX_PCIE1_HOST_BASE_VIRT		0xE9000000
+#define CNS3XXX_PCIE1_HOST_BASE_VIRT		0xF9000000
 
 #define CNS3XXX_PCIE1_IO_BASE			0xBC000000	/* PCIe Port 1 */
-#define CNS3XXX_PCIE1_IO_BASE_VIRT		0xEA000000
+#define CNS3XXX_PCIE1_IO_BASE_VIRT		0xFA000000
 
 #define CNS3XXX_PCIE1_CFG0_BASE			0xBD000000	/* PCIe Port 1 CFG Type 0 */
-#define CNS3XXX_PCIE1_CFG0_BASE_VIRT		0xEB000000
+#define CNS3XXX_PCIE1_CFG0_BASE_VIRT		0xFB000000
 
 #define CNS3XXX_PCIE1_CFG1_BASE			0xBE000000	/* PCIe Port 1 CFG Type 1 */
-#define CNS3XXX_PCIE1_CFG1_BASE_VIRT		0xEC000000
+#define CNS3XXX_PCIE1_CFG1_BASE_VIRT		0xFC000000
 
 #define CNS3XXX_PCIE1_MSG_BASE			0xBF000000	/* PCIe Port 1 Message Space */
-#define CNS3XXX_PCIE1_MSG_BASE_VIRT		0xED000000
+#define CNS3XXX_PCIE1_MSG_BASE_VIRT		0xFD000000
 
 /*
  * Testchip peripheral and fpga gic regions
diff --git a/arch/arm/mach-cns3xxx/include/mach/vmalloc.h b/arch/arm/mach-cns3xxx/include/mach/vmalloc.h
index 4d381ec..2b52816 100644
--- a/arch/arm/mach-cns3xxx/include/mach/vmalloc.h
+++ b/arch/arm/mach-cns3xxx/include/mach/vmalloc.h
@@ -8,4 +8,4 @@
  * published by the Free Software Foundation.
  */
 
-#define VMALLOC_END		0xd8000000
+#define VMALLOC_END		0xF0000000
-- 
1.7.0.4

