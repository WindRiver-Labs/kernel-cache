From de76fe78f53ec12824bacfd7712c7b8e867d3b04 Mon Sep 17 00:00:00 2001
From: Jon Medhurst <tixy@linaro.org>
Date: Fri, 6 Jul 2012 10:38:22 +0100
Subject: [PATCH 05/28] ARM: kernel: Make cpuif_logical_map() cope with absent
 device-tree

Commit 6f4bc98a0694e9f89d68b3313de1e123e0695865 from
git://git.linaro.org/kernel/linux-linaro-tracking.git

A kernel may be compiled for multiple devices, some of which use
device-tree, and some which don't. To make cpuif_logical_map() work in
the absense of device-trees entries we initialise its table with the
same values as cpu_logical_map().

Signed-off-by: Jon Medhurst <tixy@linaro.org>
Signed-off-by: Guoqing Jiang <Guoqing.Jiang@windriver.com>
---
 arch/arm/common/gic.c |    5 ++++-
 1 file changed, 4 insertions(+), 1 deletion(-)

diff --git a/arch/arm/common/gic.c b/arch/arm/common/gic.c
index 4820ee1..d90d07f 100644
--- a/arch/arm/common/gic.c
+++ b/arch/arm/common/gic.c
@@ -152,7 +152,10 @@ static void __init gic_init_if_maps(struct gic_chip_data *gic)
 	struct irq_domain *domain = gic->domain;
 	int i;
 
-	if (WARN_ON(!domain || !domain->of_node))
+	for (i = 0; i < NR_CPUS; i++)
+		cpuif_logical_map(i) = cpu_logical_map(i);
+
+	if (!domain || !domain->of_node)
 		return;
 
 	for_each_child_of_node(domain->of_node, gic_cpuif) {
-- 
1.7.9.7

