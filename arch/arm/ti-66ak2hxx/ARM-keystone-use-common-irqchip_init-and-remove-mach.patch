From 320f6abb17836f1ea5837c2836ef93dd1e2e9076 Mon Sep 17 00:00:00 2001
From: Guoqing Jiang <Guoqing.Jiang@windriver.com>
Date: Wed, 11 Sep 2013 14:07:40 +0800
Subject: [PATCH 45/57] ARM/keystone: use common irqchip_init and remove mach
 .handle_irq for GIC

Commit 0529e315bbda5d502c93df2cfafba9bb337fbdf4 "ARM: use
common irqchip_init for GIC init" convert all GIC DT
initialization over to use common irqchip_init function.

And another commit 1d5cc604f42ff1acdec0407247b2f720135ba0c2
"ARM: remove mach .handle_irq for GIC users" move GIC
initialization sets up the handle_arch_irq pointer.

Make both changes applied to keystone as well.

Signed-off-by: Guoqing Jiang <Guoqing.Jiang@windriver.com>
---
 arch/arm/mach-keystone/keystone.c | 22 ++--------------------
 1 file changed, 2 insertions(+), 20 deletions(-)

diff --git a/arch/arm/mach-keystone/keystone.c b/arch/arm/mach-keystone/keystone.c
index da7e4b4..42c4dd4 100644
--- a/arch/arm/mach-keystone/keystone.c
+++ b/arch/arm/mach-keystone/keystone.c
@@ -22,6 +22,7 @@
 #include <linux/of_irq.h>
 #include <linux/of_platform.h>
 #include <linux/of_address.h>
+#include <linux/irqchip.h>
 #include <linux/irqchip/tci6614.h>
 #include <linux/irqchip/keystone-ipc.h>
 #include <linux/platform_data/davinci-clock.h>
@@ -32,7 +33,6 @@
 #include <asm/mach/arch.h>
 #include <asm/mach/time.h>
 #include <asm/arch_timer.h>
-#include <asm/hardware/gic.h>
 
 #include "keystone.h"
 
@@ -77,22 +77,6 @@ static void __init keystone_map_io(void)
 	iotable_init(io_desc, ARRAY_SIZE(io_desc));
 }
 
-static const struct of_device_id irq_match[] = {
-	{
-		.compatible = "arm,cortex-a15-gic",
-		.data = gic_of_init,
-	},
-	{
-		.compatible = "ti,tci6614-intctrl",
-		.data = tci6614_of_init_irq,
-	},
-	{
-		.compatible = "ti,keystone-ipc-irq",
-		.data = keystone_ipc_irq_of_init,
-	},
-	{}
-};
-
 static struct of_device_id keystone_dt_match_table[] __initdata = {
 	{ .compatible = "simple-bus",},
 	{ .compatible = "ti,davinci-aemif", },
@@ -254,7 +238,7 @@ static const struct of_device_id keystone2_pcie_serdes_match[] = {
 
 static void __init keystone_init_irq(void)
 {
-	of_irq_init(irq_match);
+	irqchip_init();
 }
 
 
@@ -465,14 +449,12 @@ void keystone_restart(char mode, const char *cmd)
 
 DT_MACHINE_START(KEYSTONE1, "KeyStone1")
 	KEYSTONE_MACHINE_DEFS
-	.handle_irq	= tci6614_handle_irq,
 	.dt_compat	= keystone1_match,
 MACHINE_END
 
 DT_MACHINE_START(KEYSTONE2, "KeyStone2")
 	KEYSTONE_MACHINE_DEFS
 	.smp		= smp_ops(keystone_smp_ops),
-	.handle_irq	= gic_handle_irq,
 	.dt_compat	= keystone2_match,
 #ifdef CONFIG_ZONE_DMA
 	.dma_zone_size  = SZ_2G,
-- 
1.8.4.93.g57e4c17

