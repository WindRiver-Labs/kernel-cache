From d58152f743177f0ae8a0274378f3e718a0ff957f Mon Sep 17 00:00:00 2001
From: Vitaly Andrianov <vitalya@ti.com>
Date: Tue, 9 Apr 2013 09:32:21 -0400
Subject: [PATCH 44/57] ARM: keystone: change virtual address in io_desc

Commit 3ee0df69e706115ec2221f72326655f11c3f46b6 from arago tree
git://arago-project.org/git/projects/linux-keystone.git releases/03.00.00.11/master

The "ARM: Add fixed PCI i/o mapping" commit in v3.7 kernel added
a fixed virtual mapping for PCI i/o addresses. The mapping is located
at the last 2MB of vmalloc region. That conflicts with keystone's fixed
IO mapping. This patch moves virtual address of the io_desc to release
2MB required for the fixed PCI i/o mapping.

Signed-off-by: Vitaly Andrianov <vitalya@ti.com>
---
 arch/arm/mach-keystone/include/mach/serial.h | 8 ++++----
 arch/arm/mach-keystone/keystone.c            | 2 +-
 2 files changed, 5 insertions(+), 5 deletions(-)

diff --git a/arch/arm/mach-keystone/include/mach/serial.h b/arch/arm/mach-keystone/include/mach/serial.h
index 4f8c596..eb095a3 100644
--- a/arch/arm/mach-keystone/include/mach/serial.h
+++ b/arch/arm/mach-keystone/include/mach/serial.h
@@ -22,22 +22,22 @@
 #if defined(CONFIG_DEBUG_DAVINCI_TCI6614_UART0)
 
 #define UART_PHYS	0x02540000
-#define UART_VIRT	0xfed40000
+#define UART_VIRT	0xfeb40000
 
 #elif defined(CONFIG_DEBUG_DAVINCI_TCI6614_UART1)
 
 #define UART_PHYS	0x02541000
-#define UART_VIRT	0xfed41000
+#define UART_VIRT	0xfeb41000
 
 #elif defined(CONFIG_DEBUG_DAVINCI_TCI6638_UART0)
 
 #define UART_PHYS	0x02530c00
-#define UART_VIRT	0xfed30c00
+#define UART_VIRT	0xfeb30c00
 
 #elif defined(CONFIG_DEBUG_DAVINCI_TCI6638_UART1)
 
 #define UART_PHYS	0x02531000
-#define UART_VIRT	0xfed31000
+#define UART_VIRT	0xfeb31000
 
 #elif defined(CONFIG_DEBUG_EARLY_PRINTK)
 
diff --git a/arch/arm/mach-keystone/keystone.c b/arch/arm/mach-keystone/keystone.c
index 58ee2bc..da7e4b4 100644
--- a/arch/arm/mach-keystone/keystone.c
+++ b/arch/arm/mach-keystone/keystone.c
@@ -65,7 +65,7 @@ static inline void reg_rmw(u32 addr, u32 mask, u32 val)
 
 static struct map_desc io_desc[] = {
 	{
-		.virtual        = 0xfe800000UL,
+		.virtual        = 0xfe600000UL,
 		.pfn            = __phys_to_pfn(0x02000000UL),
 		.length         = 0x800000UL,
 		.type           = MT_DEVICE
-- 
1.8.4.93.g57e4c17

