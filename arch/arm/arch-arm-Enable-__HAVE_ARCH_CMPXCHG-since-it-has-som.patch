From a29b3d4a1cef14d71350dd5efb054d1d638b0ba7 Mon Sep 17 00:00:00 2001
From: Fredrik Markstrom <fredrik.markstrom@gmail.com>
Date: Tue, 3 Mar 2015 14:21:45 +0100
Subject: [PATCH] arch/arm: Enable __HAVE_ARCH_CMPXCHG since it has some
 noticable performance improvements

On preempt-rt kernel, the test result is like below:
sigwaittest -p 99 -l 100000 (less is better)
before patched: #1 -> #0, Min   35, Cur   36, Avg   36, Max   59
after patched: #1 -> #0, Min   33, Cur   34, Avg   34, Max   54

Signed-off-by: Fredrik Markstrom <fredrik.markstrom@gmail.com>
Signed-off-by: Li Zhou <li.zhou@windriver.com>
---
 arch/arm/include/asm/cmpxchg.h |    2 ++
 1 files changed, 2 insertions(+), 0 deletions(-)

diff --git a/arch/arm/include/asm/cmpxchg.h b/arch/arm/include/asm/cmpxchg.h
index df2fbba..1e11042 100644
--- a/arch/arm/include/asm/cmpxchg.h
+++ b/arch/arm/include/asm/cmpxchg.h
@@ -127,6 +127,8 @@ static inline unsigned long __xchg(unsigned long x, volatile void *ptr, int size
 
 #else	/* min ARCH >= ARMv6 */
 
+#define __HAVE_ARCH_CMPXCHG
+
 extern void __bad_cmpxchg(volatile void *ptr, int size);
 
 /*
-- 
1.7.5.4

