From 102fb9a7c9a1c0c842cf960622942cf61ccb769a Mon Sep 17 00:00:00 2001
From: Wang Hui <Hui.Wang@windriver.com>
Date: Mon, 26 Jul 2010 15:35:16 +0800
Subject: [PATCH 4/9] V4L: Int if: Dummy slave

This patch implements a dummy slave that has no functionality. Helps
managing slaves in the OMAP 3 camera driver; no need to check for NULL
pointers.

[Picked from the commit 7ac3aec5 of http://arago-project.org/git/\
 projects/linux-omap3.git]

Signed-off-by: Sakari Ailus <sakari.ailus@nokia.com>
Signed-off-by: Vaibhav Hiremath <hvaibhav@ti.com>
Integrated-by: Wang Hui <Hui.Wang@windriver.com>
---
 drivers/media/video/v4l2-int-device.c |   19 +++++++++++++++++++
 include/media/v4l2-int-device.h       |    2 ++
 2 files changed, 21 insertions(+), 0 deletions(-)

diff --git a/drivers/media/video/v4l2-int-device.c b/drivers/media/video/v4l2-int-device.c
index a935bae..bcf7a8d 100644
--- a/drivers/media/video/v4l2-int-device.c
+++ b/drivers/media/video/v4l2-int-device.c
@@ -68,6 +68,25 @@ void v4l2_int_device_try_attach_all(void)
 }
 EXPORT_SYMBOL_GPL(v4l2_int_device_try_attach_all);
 
+static struct v4l2_int_slave dummy_slave = {
+	/* Dummy pointer to avoid underflow in find_ioctl. */
+	.ioctls = (void *)0x80000000,
+	.num_ioctls = 0,
+};
+
+static struct v4l2_int_device dummy = {
+	.type = v4l2_int_type_slave,
+	.u = {
+		.slave = &dummy_slave,
+	},
+};
+
+struct v4l2_int_device *v4l2_int_device_dummy()
+{
+	return &dummy;
+}
+EXPORT_SYMBOL_GPL(v4l2_int_device_dummy);
+
 static int ioctl_sort_cmp(const void *a, const void *b)
 {
 	const struct v4l2_int_ioctl_desc *d1 = a, *d2 = b;
diff --git a/include/media/v4l2-int-device.h b/include/media/v4l2-int-device.h
index fbf5855..5d254c4 100644
--- a/include/media/v4l2-int-device.h
+++ b/include/media/v4l2-int-device.h
@@ -84,6 +84,8 @@ struct v4l2_int_device {
 	void *priv;
 };
 
+struct v4l2_int_device *v4l2_int_device_dummy(void);
+
 void v4l2_int_device_try_attach_all(void);
 
 int v4l2_int_device_register(struct v4l2_int_device *d);
-- 
1.6.5.2

