From de125ecf22bf9b583ba463b57d2a8ba7d3843e14 Mon Sep 17 00:00:00 2001
From: Paul Gortmaker <paul.gortmaker@windriver.com>
Date: Thu, 9 Jun 2011 15:07:13 -0400
Subject: [PATCH] ARM: force optimize for size.

While kernels will compile OK without it, strange behaviour
has been seen in the past with networking/NFS that disappears
when this is enabled.  It is normally recommended that this
always be set for ARM.  Make it obvious to people when it
is inadvertently not set.

Signed-off-by: Paul Gortmaker <paul.gortmaker@windriver.com>
---
 arch/arm/kernel/setup.c |    5 +++++
 1 files changed, 5 insertions(+), 0 deletions(-)

diff --git a/arch/arm/kernel/setup.c b/arch/arm/kernel/setup.c
index ec429fe..b218e8d 100644
--- a/arch/arm/kernel/setup.c
+++ b/arch/arm/kernel/setup.c
@@ -52,6 +52,11 @@
 #define MEM_SIZE	(16*1024*1024)
 #endif
 
+#ifndef CONFIG_CC_OPTIMIZE_FOR_SIZE
+#warning Compiling ARM without -Os can lead to unpredictable results.
+#error Please select CONFIG_CC_OPTIMIZE_FOR_SIZE in your .config
+#endif
+
 #if defined(CONFIG_FPE_NWFPE) || defined(CONFIG_FPE_FASTFPE)
 char fpe_type[8];
 
-- 
1.7.4.4

