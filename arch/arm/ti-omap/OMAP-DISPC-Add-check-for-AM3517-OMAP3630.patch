From 9797d02b11714c7ebad64d130be475c8078e7bfc Mon Sep 17 00:00:00 2001
From: Vaibhav Hiremath <hvaibhav@ti.com>
Date: Fri, 29 Jan 2010 17:49:30 +0530
Subject: [PATCH 095/108] OMAP: DISPC: Add check for AM3517/OMAP3630

commit 4cdfe8a5172f107888042a7bf80494ff14fab7f6 from
the branch origin/OMAPPSP_03.00.01.06 of
git://arago-project.org/git/projects/linux-omap3.git

The DISPC timing configuration for AM3517/OMAp3630 should be as per >=ES3.0,
but the omap_rev_lt_3_0() return true for these platforms which leads to
wrong operation.

So added check for OMAP3630 and AM3517 first before checking for
OMAP34xx/omap-rev_xx.

Signed-off-by: Vaibhav Hiremath <hvaibhav@ti.com>
Integrated-by: Stanley.Miao <stanley.miao@windriver.com>
---
 drivers/video/omap2/dss/dispc.c |    8 ++++++--
 1 files changed, 6 insertions(+), 2 deletions(-)

diff --git a/drivers/video/omap2/dss/dispc.c b/drivers/video/omap2/dss/dispc.c
index 6ba87d8..e876f0f 100644
--- a/drivers/video/omap2/dss/dispc.c
+++ b/drivers/video/omap2/dss/dispc.c
@@ -2111,7 +2111,9 @@ void dispc_set_parallel_interface_mode(enum omap_parallel_interface_mode mode)
 static bool _dispc_lcd_timings_ok(int hsw, int hfp, int hbp,
 		int vsw, int vfp, int vbp)
 {
-	if (cpu_is_omap24xx() || (cpu_is_omap34xx() && omap_rev_lt_3_0())) {
+	if (!cpu_is_omap3630() && !cpu_is_omap3517() && !cpu_is_omap3505() &&
+			(cpu_is_omap24xx() ||
+			 (cpu_is_omap34xx() && omap_rev_lt_3_0()))) {
 		if (hsw < 1 || hsw > 64 ||
 				hfp < 1 || hfp > 256 ||
 				hbp < 1 || hbp > 256 ||
@@ -2144,7 +2146,9 @@ static void _dispc_set_lcd_timings(int hsw, int hfp, int hbp,
 {
 	u32 timing_h, timing_v;
 
-	if (cpu_is_omap24xx() || (cpu_is_omap34xx() && omap_rev_lt_3_0())) {
+	if (!cpu_is_omap3630() && !cpu_is_omap3517() && !cpu_is_omap3505() &&
+			(cpu_is_omap24xx() ||
+			 (cpu_is_omap34xx() && omap_rev_lt_3_0()))) {
 		timing_h = FLD_VAL(hsw-1, 5, 0) | FLD_VAL(hfp-1, 15, 8) |
 			FLD_VAL(hbp-1, 27, 20);
 
-- 
1.7.0.4

