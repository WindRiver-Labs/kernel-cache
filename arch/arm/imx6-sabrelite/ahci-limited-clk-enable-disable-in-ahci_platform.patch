From 67e83a84021a23e2b10e2f889d357d1b0b1e6d6d Mon Sep 17 00:00:00 2001
From: Zhong Hongbo <hongbo.zhong@windriver.com>
Date: Mon, 24 Dec 2012 13:25:55 +0800
Subject: [PATCH 32/62] ahci: limited clk enable/disable in ahci_platform

In default, the clk of ahci will be enable/disable in
platform_data->init and platform_data->exit, Since AHCI
will need more clock, such as phy's clock, ahci clock.
the issue is generated by the commit
fbaa421594aa0f4c0d0b124ea73c17c4cf641caf.

Add the limited conditions for the commit.

Signed-off-by: Zhong Hongbo <hongbo.zhong@windriver.com>
---
 drivers/ata/ahci_platform.c |    8 ++++----
 1 file changed, 4 insertions(+), 4 deletions(-)

diff --git a/drivers/ata/ahci_platform.c b/drivers/ata/ahci_platform.c
index 78dcfee..5fda581 100644
--- a/drivers/ata/ahci_platform.c
+++ b/drivers/ata/ahci_platform.c
@@ -121,7 +121,7 @@ static int __init ahci_probe(struct platform_device *pdev)
 		dev_err(dev, "can't map %pR\n", mem);
 		return -ENOMEM;
 	}
-#ifdef CONFIG_HAVE_CLK
+#if defined(CONFIG_HAVE_CLK) && defined(CONFIG_ARCH_SPEAR13XX)
 	hpriv->clk = clk_get(dev, NULL);
 	if (IS_ERR(hpriv->clk)) {
 		dev_err(dev, "Clock not found\n");
@@ -215,7 +215,7 @@ pdata_exit:
 	if (pdata && pdata->exit)
 		pdata->exit(dev);
 disable_clk:
-#ifdef CONFIG_HAVE_CLK
+#if defined(CONFIG_HAVE_CLK) && defined(CONFIG_ARCH_SPEAR13XX)
 	clk_disable(hpriv->clk);
 free_clk:
 	clk_put(hpriv->clk);
@@ -228,7 +228,7 @@ static int __devexit ahci_remove(struct platform_device *pdev)
 	struct device *dev = &pdev->dev;
 	struct ahci_platform_data *pdata = dev_get_platdata(dev);
 	struct ata_host *host = dev_get_drvdata(dev);
-#ifdef CONFIG_HAVE_CLK
+#ifdef CONFIG_HAVE_CLK && defined(CONFIG_ARCH_SPEAR13XX)
 	struct ahci_host_priv *hpriv = host->private_data;
 #endif
 
@@ -237,7 +237,7 @@ static int __devexit ahci_remove(struct platform_device *pdev)
 	if (pdata && pdata->exit)
 		pdata->exit(dev);
 
-#ifdef CONFIG_HAVE_CLK
+#ifdef CONFIG_HAVE_CLK && defined(CONFIG_ARCH_SPEAR13XX)
 	clk_disable(hpriv->clk);
 	clk_put(hpriv->clk);
 #endif
-- 
1.7.9.7

