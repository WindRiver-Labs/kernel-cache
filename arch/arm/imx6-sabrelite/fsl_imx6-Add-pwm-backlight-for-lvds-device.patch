From d80e243826af61601b00f1f59ca8b90e0316699c Mon Sep 17 00:00:00 2001
From: Zhong Hongbo <hongbo.zhong@windriver.com>
Date: Mon, 15 Oct 2012 17:15:10 +0800
Subject: [PATCH 38/62] fsl_imx6: Add pwm backlight for lvds device

Source: Extract from vendor-drop package, L3.0.15_12.04.01_ER_source.tar.gz
(May,2012).

Signed-off-by: Zhong Hongbo <hongbo.zhong@windriver.com>
---
 arch/arm/mach-mx6/devices-imx6q.h       |    4 ++++
 arch/arm/mach-mx6/mach-mx6q_sabrelite.c |   22 ++++++++++++++++++++++
 2 files changed, 26 insertions(+)

diff --git a/arch/arm/mach-mx6/devices-imx6q.h b/arch/arm/mach-mx6/devices-imx6q.h
index 48e30ea..17f71cf 100644
--- a/arch/arm/mach-mx6/devices-imx6q.h
+++ b/arch/arm/mach-mx6/devices-imx6q.h
@@ -115,4 +115,8 @@ imx6q_anatop_thermal_imx_data __initconst;
 extern const struct imx_mxc_pwm_data imx6q_mxc_pwm_data[] __initconst;
 #define imx6q_add_mxc_pwm(id)	\
 	imx_add_mxc_pwm(&imx6q_mxc_pwm_data[id])
+
+#define imx6q_add_mxc_pwm_backlight(id, pdata)	   \
+	platform_device_register_resndata(NULL, "pwm-backlight",\
+			id, NULL, 0, pdata, sizeof(*pdata));
 #endif
diff --git a/arch/arm/mach-mx6/mach-mx6q_sabrelite.c b/arch/arm/mach-mx6/mach-mx6q_sabrelite.c
index ca2f801..2e4680b 100644
--- a/arch/arm/mach-mx6/mach-mx6q_sabrelite.c
+++ b/arch/arm/mach-mx6/mach-mx6q_sabrelite.c
@@ -484,6 +484,27 @@ static const struct esdhc_platform_data mx6q_sabrelite_sd4_data __initconst = {
 	.platform_pad_change = plt_sd4_pad_change,
 };
 
+static int check_fb(struct device *dev, struct fb_info *info)
+{
+	char *id = info->fix.id;
+
+	if (!strcmp(id, "DISP3 BG") ||
+		!strcmp(id, "DISP3 BG - DI1") ||
+		!strcmp(id, "DISP4 BG") ||
+		!strcmp(id, "DISP4 BG - DI1"))
+		return 1;
+	else
+		return 0;
+}
+
+static struct platform_pwm_backlight_data mx6_sabrelite_pwm_backlight_data = {
+	.pwm_id = 3,
+	.max_brightness = 255,
+	.dft_brightness = 128,
+	.pwm_period_ns = 50000,
+	.check_fb = check_fb,
+};
+
 /* Serial ports */
 static const struct imxuart_platform_data uart_pdata __initconst = {
 	.flags = IMXUART_HAVE_RTSCTS,
@@ -705,6 +726,7 @@ static void __init mx6_sabrelite_board_init(void)
 	imx6q_add_mxc_pwm(1);
 	imx6q_add_mxc_pwm(2);
 	imx6q_add_mxc_pwm(3);
+	imx6q_add_mxc_pwm_backlight(3, &mx6_sabrelite_pwm_backlight_data);
 
 	clko2 = clk_get(NULL, "clko2_clk");
 	if (IS_ERR(clko2))
-- 
1.7.9.7

