From 2a2a130ef1b1beb318fed6f0eb962a2c696cb24f Mon Sep 17 00:00:00 2001
From: Zhong Hongbo <hongbo.zhong@windriver.com>
Date: Tue, 11 Sep 2012 17:52:30 +0800
Subject: [PATCH 08/62] fsl_imx6: Setup consistent dma size at boot time

Signed-off-by: Zhong Hongbo <hongbo.zhong@windriver.com>
---
 arch/arm/include/asm/pgtable.h |    4 ++++
 arch/arm/mach-mx6/mm.c         |    2 ++
 2 files changed, 6 insertions(+)

diff --git a/arch/arm/include/asm/pgtable.h b/arch/arm/include/asm/pgtable.h
index 41dc31f..d3b903b4 100644
--- a/arch/arm/include/asm/pgtable.h
+++ b/arch/arm/include/asm/pgtable.h
@@ -40,7 +40,11 @@
  */
 #define VMALLOC_OFFSET		(8*1024*1024)
 #define VMALLOC_START		(((unsigned long)high_memory + VMALLOC_OFFSET) & ~(VMALLOC_OFFSET-1))
+#ifdef CONFIG_ARCH_MX6Q
+#define VMALLOC_END		0xfb000000UL
+#else
 #define VMALLOC_END		0xff000000UL
+#endif
 
 #define LIBRARY_TEXT_START	0x0c000000
 
diff --git a/arch/arm/mach-mx6/mm.c b/arch/arm/mach-mx6/mm.c
index c21d03d..29fc146 100644
--- a/arch/arm/mach-mx6/mm.c
+++ b/arch/arm/mach-mx6/mm.c
@@ -27,6 +27,7 @@
 #include <mach/iomux-v3.h>
 #include <mach/hardware.h>
 #include <mach/common.h>
+#include <linux/dma-mapping.h>
 
 /*!
  * This structure defines the MX6 memory map.
@@ -80,6 +81,7 @@ void __init mx6_map_io(void)
 	mxc_iomux_v3_init(IO_ADDRESS(MX6Q_IOMUXC_BASE_ADDR));
 	mxc_arch_reset_init(IO_ADDRESS(MX6Q_WDOG1_BASE_ADDR));
 	mxc_cpu_lp_set(WAIT_CLOCKED);
+	init_consistent_dma_size(64 << 20);
 }
 
 #ifdef CONFIG_CACHE_L2X0
-- 
1.7.9.7

