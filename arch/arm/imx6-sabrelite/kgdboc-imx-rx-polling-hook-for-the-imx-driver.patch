From 2eea30859dc968ffd3862091c71cbacbe730db72 Mon Sep 17 00:00:00 2001
From: Zhong Hongbo <hongbo.zhong@windriver.com>
Date: Sat, 1 Dec 2012 17:57:35 +0800
Subject: [PATCH 59/62] kgdboc, imx: rx polling hook for the imx driver

The RX polling hook allows the debugger to hook character input so as
to allow entry to the kernel debugger with a control-c as an example.

Signed-off-by: Zhong Hongbo <hongbo.zhong@windriver.com>
---
 drivers/tty/serial/imx.c |    4 ++++
 1 file changed, 4 insertions(+)

diff --git a/drivers/tty/serial/imx.c b/drivers/tty/serial/imx.c
index 9b4773a..d89f66c 100644
--- a/drivers/tty/serial/imx.c
+++ b/drivers/tty/serial/imx.c
@@ -533,6 +533,10 @@ static irqreturn_t imx_rxint(int irq, void *dev_id)
 				continue;
 		}
 
+#ifdef CONFIG_CONSOLE_POLL
+		if (sport->port.poll_rx_cb && sport->port.poll_rx_cb((unsigned char)rx))
+			continue;
+#endif
 		if (uart_handle_sysrq_char(&sport->port, (unsigned char)rx))
 			continue;
 
-- 
1.7.9.7

