From 064486e31eb8abc7dd3b6c5c956dc68e54aca4fd Mon Sep 17 00:00:00 2001
From: Liu Gang <Gang.Liu@freescale.com>
Date: Mon, 27 Apr 2015 15:24:01 +0800
Subject: [PATCH 117/132] LS2085A/GPIO: Add GPIO IP block support for LS2085A

LS2085A has the same GPIO IP block as GPIO on PowerPC
and LS1021A. So just update the drivers/gpio/gpio-mpc8xxx.c
to support the LS2085A GPIO IP block.

Signed-off-by: Liu Gang <Gang.Liu@freescale.com>
Change-Id: Ib302ce671b5301ce09cbc304388e0c43723781cc
Reviewed-on: http://git.am.freescale.net:8181/35673
Tested-by: Review Code-CDREVIEW <CDREVIEW@freescale.com>
Reviewed-by: Stuart Yoder <stuart.yoder@freescale.com>
[Original patch from FSL LS2085 SDK EAR4.0]
Signed-off-by: Yanjiang Jin <yanjiang.jin@windriver.com>
---
 arch/arm64/include/asm/irq.h |    8 ++++++++
 drivers/gpio/Kconfig         |    6 +++---
 drivers/gpio/gpio-mpc8xxx.c  |    1 +
 3 files changed, 12 insertions(+), 3 deletions(-)

diff --git a/arch/arm64/include/asm/irq.h b/arch/arm64/include/asm/irq.h
index e1f7ecd..5e0a946 100644
--- a/arch/arm64/include/asm/irq.h
+++ b/arch/arm64/include/asm/irq.h
@@ -3,6 +3,14 @@
 
 #include <asm-generic/irq.h>
 
+/*
+ * Use this value to indicate lack of interrupt
+ * capability
+ */
+#ifndef NO_IRQ
+#define NO_IRQ	((unsigned int)(-1))
+#endif
+
 extern void (*handle_arch_irq)(struct pt_regs *);
 extern void migrate_irqs(void);
 extern void set_handle_irq(void (*handle_irq)(struct pt_regs *));
diff --git a/drivers/gpio/Kconfig b/drivers/gpio/Kconfig
index 3e72875..012a77a 100644
--- a/drivers/gpio/Kconfig
+++ b/drivers/gpio/Kconfig
@@ -186,12 +186,12 @@ config GPIO_MPC5200
 	depends on PPC_MPC52xx
 
 config GPIO_MPC8XXX
-	bool "MPC512x/MPC8xxx GPIO support"
+	bool "MPC512x/MPC8xxx/Layerscape GPIO support"
 	depends on PPC_MPC512x || PPC_MPC831x || PPC_MPC834x || PPC_MPC837x || \
-		   FSL_SOC_BOOKE || PPC_86xx
+		   FSL_SOC_BOOKE || PPC_86xx || SOC_LS1021A || ARCH_FSL_LS2085A
 	help
 	  Say Y here if you're going to use hardware that connects to the
-	  MPC512x/831x/834x/837x/8572/8610 GPIOs.
+	  MPC512x/831x/834x/837x/8572/8610/LS1021A/LS2085A GPIOs.
 
 config GPIO_MSM_V1
 	tristate "Qualcomm MSM GPIO v1"
diff --git a/drivers/gpio/gpio-mpc8xxx.c b/drivers/gpio/gpio-mpc8xxx.c
index 82b76e3..7291916 100644
--- a/drivers/gpio/gpio-mpc8xxx.c
+++ b/drivers/gpio/gpio-mpc8xxx.c
@@ -332,6 +332,7 @@ static struct of_device_id mpc8xxx_gpio_ids[] __initdata = {
 	{ .compatible = "fsl,pq3-gpio",     },
 	{ .compatible = "fsl,qoriq-gpio",   },
 	{ .compatible = "fsl,ls1021a-gpio",   },
+	{ .compatible = "fsl,ls2085a-gpio",   },
 	{}
 };
 
-- 
1.7.5.4

