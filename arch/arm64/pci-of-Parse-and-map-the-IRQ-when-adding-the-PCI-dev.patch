From 29b7552dd5c8fbb16d599d7c52f5e15f5fa4dccb Mon Sep 17 00:00:00 2001
From: Liviu Dudau <Liviu.Dudau@arm.com>
Date: Tue, 29 Apr 2014 12:38:38 +0100
Subject: [PATCH 409/430] pci: of: Parse and map the IRQ when adding the PCI
 device.

This commit comes from:
  git://git.kernel.org/pub/scm/linux/kernel/git/rric/linux.git

Enhance the default implementation of pcibios_add_device() to
parse and map the IRQ of the device if a DT binding is available.

Signed-off-by: Liviu Dudau <Liviu.Dudau@arm.com>
(cherry picked from commit ce97c1e193a09637ae951ffc3dca61b74b102139)
Signed-off-by: Zumeng Chen <zumeng.chen@windriver.com>
---
 drivers/pci/pci.c |    4 ++++
 1 files changed, 4 insertions(+), 0 deletions(-)

diff --git a/drivers/pci/pci.c b/drivers/pci/pci.c
index be3a1b1..28b85f5 100644
--- a/drivers/pci/pci.c
+++ b/drivers/pci/pci.c
@@ -17,6 +17,7 @@
 #include <linux/spinlock.h>
 #include <linux/string.h>
 #include <linux/log2.h>
+#include <linux/of_pci.h>
 #include <linux/pci-aspm.h>
 #include <linux/pm_wakeup.h>
 #include <linux/interrupt.h>
@@ -1438,6 +1439,9 @@ void pcim_pin_device(struct pci_dev *pdev)
  */
 int __weak pcibios_add_device (struct pci_dev *dev)
 {
+#ifdef CONFIG_OF
+	dev->irq = of_irq_parse_and_map_pci(dev, 0, 0);
+#endif
 	return 0;
 }
 
-- 
1.7.5.4

