From 34c6342035516868fcaa8d14fb2ce59f5ce7889c Mon Sep 17 00:00:00 2001
From: Jiang Lu <lu.jiang@windriver.com>
Date: Wed, 15 Jul 2015 16:54:56 +0800
Subject: [PATCH 08/23] Revert "pci: Create pci_host_bridge before its
 associated bus in pci_create_root_bus."

This reverts commit 311d2ef4311f68abea365cf2aa447cab27fd4b05.

This patch picked from rric tree, dropped when upstream merging patch from
this tree.

Signed-off-by: Jiang Lu <lu.jiang@windriver.com>
---
 drivers/pci/probe.c |    5 +++--
 1 files changed, 3 insertions(+), 2 deletions(-)

diff --git a/drivers/pci/probe.c b/drivers/pci/probe.c
index 8205607..47f5cce 100644
--- a/drivers/pci/probe.c
+++ b/drivers/pci/probe.c
@@ -511,7 +511,7 @@ static void pci_release_host_bridge_dev(struct device *dev)
 	kfree(bridge);
 }
 
-static struct pci_host_bridge *pci_alloc_host_bridge(void)
+static struct pci_host_bridge *pci_alloc_host_bridge(struct pci_bus *b)
 {
 	struct pci_host_bridge *bridge;
 
@@ -520,6 +520,7 @@ static struct pci_host_bridge *pci_alloc_host_bridge(void)
 		return NULL;
 
 	INIT_LIST_HEAD(&bridge->windows);
+	bridge->bus = b;
 	return bridge;
 }
 
@@ -1732,7 +1733,7 @@ struct pci_bus *pci_create_root_bus(struct device *parent, int bus,
 	char bus_addr[64];
 	char *fmt;
 
-	bridge = pci_alloc_host_bridge();
+	bridge = pci_alloc_host_bridge(b);
 	if (!bridge)
 		return NULL;
 
-- 
1.7.5.4

