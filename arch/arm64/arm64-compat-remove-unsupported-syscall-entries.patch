From f678b2b9bcb889216a2a37ddaa213fe6d77b5afc Mon Sep 17 00:00:00 2001
From: Li Zhou <li.zhou@windriver.com>
Date: Sun, 12 Jun 2016 14:52:25 +0800
Subject: [PATCH] arm64: compat: remove unsupported syscall entries

This commit reverts 3 commits:
1) arm64: add renameat2 compat syscall
2) arm64: compat: wire up memfd_create and getrandom syscalls
for aarch32
3) arm64: include unistd32.h before code

1 and 2 add unsupported syscall entries and cause compiling failure.
They are the mainline commits merged for cav-thunder BSP,
but these related system call implementations are not rolled in.
3 tries to solve the compiling failure, but it will destroy the table
compat_sys_call_table and cause segment fault when execute statically
linked 32-bit binary on arm64 target (on condition that CONFIG_COMPAT
is set).
So here revert them all.

Signed-off-by: Li Zhou <li.zhou@windriver.com>
---
 arch/arm64/include/asm/unistd.h   |    2 +-
 arch/arm64/include/asm/unistd32.h |    7 -------
 arch/arm64/kernel/sys32.S         |    2 +-
 3 files changed, 2 insertions(+), 9 deletions(-)

diff --git a/arch/arm64/include/asm/unistd.h b/arch/arm64/include/asm/unistd.h
index daed7c3..e531cc4 100644
--- a/arch/arm64/include/asm/unistd.h
+++ b/arch/arm64/include/asm/unistd.h
@@ -40,7 +40,7 @@
 #define __ARM_NR_compat_cacheflush	(__ARM_NR_COMPAT_BASE+2)
 #define __ARM_NR_compat_set_tls		(__ARM_NR_COMPAT_BASE+5)
 
-#define __NR_compat_syscalls		386
+#define __NR_compat_syscalls		382
 #endif
 
 #define __ARCH_WANT_SYS_CLONE
diff --git a/arch/arm64/include/asm/unistd32.h b/arch/arm64/include/asm/unistd32.h
index da1f06b..87e2dd1 100644
--- a/arch/arm64/include/asm/unistd32.h
+++ b/arch/arm64/include/asm/unistd32.h
@@ -785,10 +785,3 @@ __SYSCALL(__NR_finit_module, sys_finit_module)
 __SYSCALL(__NR_sched_setattr, sys_sched_setattr)
 #define __NR_sched_getattr 381
 __SYSCALL(__NR_sched_getattr, sys_sched_getattr)
-#define __NR_renameat2 382
-__SYSCALL(__NR_renameat2, sys_renameat2)
-			/* 383 for seccomp */
-#define __NR_getrandom 384
-__SYSCALL(__NR_getrandom, sys_getrandom)
-#define __NR_memfd_create 385
-__SYSCALL(__NR_memfd_create, sys_memfd_create)
diff --git a/arch/arm64/kernel/sys32.S b/arch/arm64/kernel/sys32.S
index 0c6f812..423a5b3 100644
--- a/arch/arm64/kernel/sys32.S
+++ b/arch/arm64/kernel/sys32.S
@@ -22,7 +22,6 @@
 
 #include <asm/assembler.h>
 #include <asm/asm-offsets.h>
-#include <asm/unistd32.h>
 
 /*
  * System call wrappers for the AArch32 compatibility layer.
@@ -113,3 +112,4 @@ ENDPROC(compat_sys_fallocate_wrapper)
  */
 	.align	12
 ENTRY(compat_sys_call_table)
+#include <asm/unistd32.h>
-- 
1.7.5.4

