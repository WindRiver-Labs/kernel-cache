From 860927f853fc90a7ebb8e207ee2991b25e372066 Mon Sep 17 00:00:00 2001
From: Yang Shi <yang.shi@windriver.com>
Date: Mon, 19 Aug 2013 15:39:44 -0700
Subject: [PATCH] ppc4xx: specify "-mcpu=405" as compiler flag for PPC4xx

4.8 toolchain will be rebuilt from source runtime to take TUNE machine conf
configure, so PPC476 will be the default compiler flag for PPC476 BSP
(i.e. ACP34xx) for GCC.

Then it will generate some PPC476 specific instructions, i.e. "mfcr 9, 1".
But, "-Wa,-m405" is the AS flag used by PPC 4xx in kernel which can't
recognize that format mfcr instruction.

So, specify "-mcpu=405" as compiler flag for PPC 4xx machine in kernel.

Signed-off-by: Yang Shi <yang.shi@windriver.com>
---
 arch/powerpc/Makefile |    4 ++++
 1 file changed, 4 insertions(+)

diff --git a/arch/powerpc/Makefile b/arch/powerpc/Makefile
index 89e25df..028d0de 100644
--- a/arch/powerpc/Makefile
+++ b/arch/powerpc/Makefile
@@ -125,6 +125,10 @@ ifeq ($(CONFIG_6xx),y)
 KBUILD_CFLAGS		+= -mcpu=powerpc
 endif
 
+ifeq ($(CONFIG_4xx),y)
+KBUILD_CFLAGS		+= -mcpu=405
+endif
+
 # Work around a gcc code-gen bug with -fno-omit-frame-pointer.
 ifeq ($(CONFIG_FUNCTION_TRACER),y)
 KBUILD_CFLAGS		+= -mno-sched-epilog
-- 
1.7.9.7

