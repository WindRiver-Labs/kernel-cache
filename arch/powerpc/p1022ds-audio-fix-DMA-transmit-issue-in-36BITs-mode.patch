From 46ee946d01911b20eafae2bbe6e89a0c558a600c Mon Sep 17 00:00:00 2001
From: Jiang Lu <lu.jiang@windriver.com>
Date: Mon, 29 Nov 2010 18:47:03 +0800
Subject: [PATCH 06/13] p1022ds: audio: fix DMA transmit issue in 36BITs mode

Extracted from the P1022DS_20100925-ltib.iso vendor drop.

The patch fix DMA transmit issue for fsl audio port in 36bit physical
address space.

Signed-off-by: Jiang Yutang <b14898@freescale.com>
Integrated-by: Jiang Lu <lu.jiang@windriver.com>
---
 sound/soc/fsl/fsl_dma.c |    6 ++++--
 1 files changed, 4 insertions(+), 2 deletions(-)

diff --git a/sound/soc/fsl/fsl_dma.c b/sound/soc/fsl/fsl_dma.c
index 410c749..d2411df 100644
--- a/sound/soc/fsl/fsl_dma.c
+++ b/sound/soc/fsl/fsl_dma.c
@@ -658,10 +658,12 @@ static int fsl_dma_hw_params(struct snd_pcm_substream *substream,
 			link->source_attr = cpu_to_be32(CCSR_DMA_ATR_SNOOP);
 
 			link->dest_addr = cpu_to_be32(ssi_sxx_phys);
-			link->dest_attr = cpu_to_be32(CCSR_DMA_ATR_NOSNOOP);
+			link->dest_attr = cpu_to_be32(CCSR_DMA_ATR_NOSNOOP |
+				upper_32_bits(ssi_sxx_phys));
 		} else {
 			link->source_addr = cpu_to_be32(ssi_sxx_phys);
-			link->source_attr = cpu_to_be32(CCSR_DMA_ATR_NOSNOOP);
+			link->source_attr = cpu_to_be32(CCSR_DMA_ATR_NOSNOOP |
+				upper_32_bits(ssi_sxx_phys));
 
 			link->dest_addr = cpu_to_be32(temp_addr);
 			link->dest_attr = cpu_to_be32(CCSR_DMA_ATR_SNOOP);
-- 
1.6.5.2

