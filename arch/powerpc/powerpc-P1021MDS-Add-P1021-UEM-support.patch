From ced44957a8e1ca509bd680f8704d874f37dd54fb Mon Sep 17 00:00:00 2001
From: Jiang Lu <lu.jiang@windriver.com>
Date: Thu, 27 Jan 2011 09:21:59 +0800
Subject: [PATCH] powerpc:P1021MDS:Add P1021 UEM support

P1021 implements 100M Ethernet controller via QE, need enable 2 TX
threads for it.

Extracted from the P1021MDS-20101124-ltib.iso vendor drop.
Use machine_is(p1021_mds) marco to protect the added code.

Signed-off-by: Jiang Lu <lu.jiang@windriver.com>
---
 drivers/net/ucc_geth.c |    7 +++++++
 1 files changed, 7 insertions(+), 0 deletions(-)

diff --git a/drivers/net/ucc_geth.c b/drivers/net/ucc_geth.c
index 9779185..9c280ad 100644
--- a/drivers/net/ucc_geth.c
+++ b/drivers/net/ucc_geth.c
@@ -3862,6 +3862,13 @@ static int ucc_geth_probe(struct of_device* ofdev, const struct of_device_id *ma
 			break;
 		}
 
+#ifdef CONFIG_MPC85xx_MDS	
+	if ((machine_is(p1021_mds)) && (max_speed == SPEED_100)) {
+		/* enable 2 Tx threads in 100Mb mode*/
+		ug_info->numThreadsTx = UCC_GETH_NUM_OF_THREADS_2;
+	}
+#endif
+
 	if (max_speed == SPEED_1000) {
 		/* configure muram FIFOs for gigabit operation */
 		ug_info->uf_info.urfs = UCC_GETH_URFS_GIGA_INIT;
-- 
1.7.0.4

