From b5f06c85fc9f8e901c9f5b9d4ff959293fa4d0f1 Mon Sep 17 00:00:00 2001
From: Xufeng Zhang <xufeng.zhang@windriver.com>
Date: Thu, 11 Aug 2011 16:14:46 +0800
Subject: [PATCH 5/5] Enable X700 and X800 video card in kernel

Extracted from vendor drop QorIQ-NONDPAA-SDK-V1-20110429_ltib.iso
linux-2.6.35-qoriq-Enable-X700-and-X800-video-card-in-kern.patch

Signed-off-by: Jason Jin <Jason.jin@freescale.com>
Integrated-by: Xufeng Zhang <xufeng.zhang@windriver.com>
---
 drivers/video/aty/ati_ids.h     |    2 ++
 drivers/video/aty/radeon_base.c |    6 ++++--
 2 files changed, 6 insertions(+), 2 deletions(-)

diff --git a/drivers/video/aty/ati_ids.h b/drivers/video/aty/ati_ids.h
index 3e9d28b..0452436 100644
--- a/drivers/video/aty/ati_ids.h
+++ b/drivers/video/aty/ati_ids.h
@@ -182,6 +182,8 @@
 #define PCI_CHIP_R423_UI                0x5549
 #define PCI_CHIP_R423_UJ                0x554A
 #define PCI_CHIP_R423_UK                0x554B
+#define PCI_CHIP_R423_554d              0x554d
+#define PCI_CHIP_R423_5657              0x5657
 #define PCI_CHIP_R423_UQ                0x5551
 #define PCI_CHIP_R423_UR                0x5552
 #define PCI_CHIP_R423_UT                0x5554
diff --git a/drivers/video/aty/radeon_base.c b/drivers/video/aty/radeon_base.c
index 6c37e8e..b632eb9 100644
--- a/drivers/video/aty/radeon_base.c
+++ b/drivers/video/aty/radeon_base.c
@@ -225,6 +225,8 @@ static struct pci_device_id radeonfb_pci_table[] = {
 	CHIP_DEF(PCI_CHIP_R423_UR,	R420,	CHIP_HAS_CRTC2),
 	CHIP_DEF(PCI_CHIP_R423_UT,	R420,	CHIP_HAS_CRTC2),
 	CHIP_DEF(PCI_CHIP_R423_5D57,	R420,	CHIP_HAS_CRTC2),
+	CHIP_DEF(PCI_CHIP_R423_554d,	R420,	CHIP_HAS_CRTC2),
+	CHIP_DEF(PCI_CHIP_R423_5657,	R420,	CHIP_HAS_CRTC2),
 	/* Original Radeon/7200 */
 	CHIP_DEF(PCI_CHIP_RADEON_QD,	RADEON,	0),
 	CHIP_DEF(PCI_CHIP_RADEON_QE,	RADEON,	0),
@@ -270,7 +272,7 @@ static int ignore_edid = 0;
 static int mirror = 0;
 static int panel_yres = 0;
 static int force_dfp = 0;
-static int force_measure_pll = 0;
+static int force_measure_pll = 1;
 #ifdef CONFIG_MTRR
 static int nomtrr = 0;
 #endif
@@ -559,7 +561,7 @@ static int __devinit radeon_probe_pll_params(struct radeonfb_info *rinfo)
 	do_div(vclk, 1000 * num);
 	xtal = vclk;
 
-	if ((xtal > 26900) && (xtal < 27100))
+	if ((xtal > 26700) && (xtal < 27100))
 		xtal = 2700;
 	else if ((xtal > 14200) && (xtal < 14400))
 		xtal = 1432;
-- 
1.7.0.2

