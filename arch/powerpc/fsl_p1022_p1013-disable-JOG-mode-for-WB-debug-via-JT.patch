From c78bc7abb4b009c9a7e143c43a9a7e634819aa5e Mon Sep 17 00:00:00 2001
From: Tiejun Chen <tiejun.chen@windriver.com>
Date: Mon, 23 May 2011 10:20:44 +0800
Subject: [PATCH] fsl_p1022_p1013: disable JOG mode for WB debug via JTAG

The JTAG debug has limitations comparing running the OS with full
functionalities for the core. The "WR_OCD_DEBUG" flag is for
adding/removing certain features to enable background debug being
functional. We especially have difficulty to fully control the CPU
when it's in power saving mode. For some CPU family we have to take
the whole power management module out of the system to enable JATG
debugging. For this specific case, when the CPU in jogging mode,
the JTAG detect it as "STOPPED" mode then we put in "BKM" mode
instead of "RUN" mode. And there is no way for the JTAG to
tell the CPU in JOG mode. So we have to disable JOG only when we
use WorkBench to debug this target via JTAG.

Signed-off-by: Tiejun Chen <tiejun.chen@windriver.com>
---
 arch/powerpc/platforms/Kconfig |    2 +-
 1 files changed, 1 insertions(+), 1 deletions(-)

diff --git a/arch/powerpc/platforms/Kconfig b/arch/powerpc/platforms/Kconfig
index 618da6c..a2e1109 100644
--- a/arch/powerpc/platforms/Kconfig
+++ b/arch/powerpc/platforms/Kconfig
@@ -175,7 +175,7 @@ config CPU_FREQ_PMAC64
 
 config MPC85xx_CPUFREQ
 	bool "Support for Freescale MPC85xx CPU freq"
-	depends on PPC_85xx && PPC32
+	depends on PPC_85xx && PPC32 && !WR_OCD_DEBUG
 	select CPU_FREQ_TABLE
 	help
 	  This adds support for frequency switching on Freescale MPC85xx,
-- 
1.7.0.4

