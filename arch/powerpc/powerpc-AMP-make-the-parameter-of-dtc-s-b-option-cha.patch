From 92189934347ffcf700733a179d0a599dd7a628d9 Mon Sep 17 00:00:00 2001
From: Wu Zhangjin <zhangjin.wu@windriver.com>
Date: Wed, 28 Jul 2010 16:20:12 +0800
Subject: [PATCH] powerpc: AMP: make the parameter of dtc's -b option changeable

Before, the parameter of dtc's -b option is hardcoded as 0 in the Makefile, but
in AMP or some other situations, this may need to be changeable.  for example,
to make the core1 of fsl_p1020 run well with the dts file, we must set the boot
cpu as 1 via compiling the dts file with "-b 1" of dtc.

This patch makes the parameter of the -b option of dtc changeable via adding a
DTB_BOOT_CPU for the Makefile, if no explicit change pass, it is reserved as 0.

Usage:

$ cd /patch/to/linux-build-directory/
$ make p1020rdb_camp_core1.dtb DTB_BOOT_CPU=1

Signed-off-by: Wu Zhangjin <zhangjin.wu@windriver.com>
---
 arch/powerpc/boot/Makefile |    3 ++-
 1 files changed, 2 insertions(+), 1 deletions(-)

diff --git a/arch/powerpc/boot/Makefile b/arch/powerpc/boot/Makefile
index 3ee4a77..2d282ed 100644
--- a/arch/powerpc/boot/Makefile
+++ b/arch/powerpc/boot/Makefile
@@ -39,6 +39,7 @@ endif
 
 BOOTCFLAGS	+= -I$(obj) -I$(srctree)/$(obj)
 
+DTB_BOOT_CPU	?= 0
 DTS_FLAGS	?= -p 1024
 
 $(obj)/4xx.o: BOOTCFLAGS += -mcpu=405
@@ -343,7 +344,7 @@ $(obj)/treeImage.%: vmlinux $(obj)/%.dtb $(wrapperbits)
 DTC = $(objtree)/scripts/dtc/dtc
 
 $(obj)/%.dtb: $(dtstree)/%.dts
-	$(DTC) -O dtb -o $(obj)/$*.dtb -b 0 $(DTS_FLAGS) $(dtstree)/$*.dts
+	$(DTC) -O dtb -o $(obj)/$*.dtb -b ${DTB_BOOT_CPU} $(DTS_FLAGS) $(dtstree)/$*.dts
 
 # If there isn't a platform selected then just strip the vmlinux.
 ifeq (,$(image-y))
-- 
1.6.5.2

