From 16f0db9332b794959fa08b873298b4807773a28c Mon Sep 17 00:00:00 2001
From: Yongli He <yongli.he@windriver.com>
Date: Tue, 30 Aug 2011 09:40:21 +0800
Subject: [PATCH] ppc64/kprobes:  pgirq_ctx initialization for book3e

book3e missing kprobe pgirq_ctx initialization.

Signed-off-by: Yongli He <yongli.he@windriver.com>
---
 arch/powerpc/kernel/setup_64.c |    5 +++++
 1 files changed, 5 insertions(+), 0 deletions(-)

diff --git a/arch/powerpc/kernel/setup_64.c b/arch/powerpc/kernel/setup_64.c
index d44e38b..6f76843 100644
--- a/arch/powerpc/kernel/setup_64.c
+++ b/arch/powerpc/kernel/setup_64.c
@@ -467,6 +467,11 @@ static void __init exc_lvl_early_init(void)
 			__va(lmb_alloc(THREAD_SIZE, THREAD_SIZE));
 		mcheckirq_ctx[i] = (struct thread_info *)
 			__va(lmb_alloc(THREAD_SIZE, THREAD_SIZE));
+
+#ifdef CONFIG_KPROBES
+		pgirq_ctx[i] = (struct thread_info *)
+			__va(lmb_alloc(THREAD_SIZE, THREAD_SIZE));
+#endif
 	}
 }
 #else
-- 
1.7.0.4

