From 8ba2cb5bb373fa45e92932adffa9682ccce8b3ec Mon Sep 17 00:00:00 2001
From: Jiang Lu <lu.jiang@windriver.com>
Date: Tue, 21 Dec 2010 10:19:26 +0800
Subject: [PATCH 12/13] I2C: Save I2CCR in MPC I2C PM routines

Update suspend & resume routines of MPC-I2c driver, to save I2CCR
register while entering suspend state and restore register after
resuming from sleep.

Signed-off-by: Jiang Lu <lu.jiang@windriver.com>
---
 drivers/i2c/busses/i2c-mpc.c |    3 +++
 1 files changed, 3 insertions(+), 0 deletions(-)

diff --git a/drivers/i2c/busses/i2c-mpc.c b/drivers/i2c/busses/i2c-mpc.c
index 8444a83..b293832 100644
--- a/drivers/i2c/busses/i2c-mpc.c
+++ b/drivers/i2c/busses/i2c-mpc.c
@@ -65,6 +65,7 @@ struct mpc_i2c {
 	int irq;
 #ifdef CONFIG_SUSPEND
 	u32 save_fdr;
+	u32 save_cr;
 #endif
 };
 
@@ -553,6 +554,7 @@ static int fsl_i2c_suspend(struct of_device *op, pm_message_t state)
 	struct mpc_i2c *i2c = dev_get_drvdata(&op->dev);
 
 	i2c->save_fdr = readb(i2c->base + MPC_I2C_FDR);
+	i2c->save_cr = readb(i2c->base + MPC_I2C_CR);
 
 	return 0;
 }
@@ -563,6 +565,7 @@ static int fsl_i2c_resume(struct of_device *op)
 	struct mpc_i2c *i2c = dev_get_drvdata(&op->dev);
 
 	writeb(i2c->save_fdr & 0xff, i2c->base + MPC_I2C_FDR);
+	writeb(i2c->save_cr & (CCR_MEN|CCR_MIEN), i2c->base + MPC_I2C_CR);
 
 	return 0;
 }
-- 
1.6.5.2

