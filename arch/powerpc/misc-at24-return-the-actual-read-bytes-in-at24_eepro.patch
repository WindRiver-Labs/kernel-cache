From e0ea1e7e130cf46d91648d41c0258bc96169af08 Mon Sep 17 00:00:00 2001
From: Kevin Hao <kexin.hao@windriver.com>
Date: Tue, 22 May 2012 18:18:27 +0800
Subject: [PATCH 7/7] misc/at24: return the actual read bytes in
 at24_eeprom_read

In at24_eeprom_read we assume that we will aways receive the
count of bytes as we requested. But this is not true in some
cases. So we should return the actual read bytes as it is
indicated in msg->len.

Signed-off-by: Kevin Hao <kexin.hao@windriver.com>
---
 drivers/misc/eeprom/at24.c |    2 +-
 1 file changed, 1 insertion(+), 1 deletion(-)

diff --git a/drivers/misc/eeprom/at24.c b/drivers/misc/eeprom/at24.c
index ab1ad41..3e89a90 100644
--- a/drivers/misc/eeprom/at24.c
+++ b/drivers/misc/eeprom/at24.c
@@ -251,7 +251,7 @@ static ssize_t at24_eeprom_read(struct at24_data *at24, char *buf,
 		default:
 			status = i2c_transfer(client->adapter, msg, 2);
 			if (status == 2)
-				status = count;
+				status = count = msg[1].len;
 		}
 		dev_dbg(&client->dev, "read %zu@%d --> %d (%ld)\n",
 				count, offset, status, jiffies);
-- 
1.7.9.7

