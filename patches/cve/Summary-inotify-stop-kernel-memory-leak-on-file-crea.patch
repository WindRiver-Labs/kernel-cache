From 62a32f60cefb28920247bd4dca90e569a22a547e Mon Sep 17 00:00:00 2001
From: wei cai <wei.cai@windriver.com>
Date: Thu, 8 Nov 2012 13:43:58 +0800
Subject: [PATCH] Summary: inotify: stop kernel memory leak on file creation failure

Commit a2ae4cc9a16e211c8a128ba10d22a85431f093ab upstream

If inotify_init is unable to allocate a new file for the new inotify
group we leak the new group.  This patch drops the reference on the
group on file allocation failure.

Reported-by: Vegard Nossum <vegard.nossum@gmail.com>
cc: stable@kernel.org
Signed-off-by: Eric Paris <eparis@redhat.com>
Integrated-off-by: Wei.cai@winfriver.com
---
 fs/notify/inotify/inotify_user.c |    2 +-
 1 files changed, 1 insertions(+), 1 deletions(-)

diff --git a/fs/notify/inotify/inotify_user.c b/fs/notify/inotify/inotify_user.c
index 0c6bbc0..0216c72 100644
--- a/fs/notify/inotify/inotify_user.c
+++ b/fs/notify/inotify/inotify_user.c
@@ -673,7 +673,7 @@ SYSCALL_DEFINE1(inotify_init1, int, flags)
 				  O_RDONLY | flags);
 	if (ret >= 0)
 		return ret;
-
+	fsnotify_put_group(group);
 	atomic_dec(&user->inotify_devs);
 out_free_uid:
 	free_uid(user);
-- 
1.7.0

