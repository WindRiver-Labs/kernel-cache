From a96179336a0d623f167b578dea4d8e2e23e4a0d4 Mon Sep 17 00:00:00 2001
From: "yadi.hu@windriver.com" <yadi.hu@windriver.com>
Date: Thu, 12 Jun 2014 16:00:19 +0800
Subject: [PATCH] wifi call trace is reported

f77b86d7d3acf9dfcb5ee834628d12207584b2cb upstream

regulatory: add missing rtnl locking
restore_regulatory_settings() requires the RTNL to be held,
add the missing locking in reg_timeout_work().

Signed-off-by: Johannes Berg <johannes.berg@intel.com>
Signed-off-by: Hu <yadi.hu@windriver.com>
---
 net/wireless/reg.c |    2 ++
 1 files changed, 2 insertions(+), 0 deletions(-)

diff --git a/net/wireless/reg.c b/net/wireless/reg.c
index 796a0ee..3ff410e 100644
--- a/net/wireless/reg.c
+++ b/net/wireless/reg.c
@@ -2333,7 +2333,9 @@ static void reg_timeout_work(struct work_struct *work)
 {
 	REG_DBG_PRINT("Timeout while waiting for CRDA to reply, "
 		      "restoring regulatory settings\n");
+	rtnl_lock();
 	restore_regulatory_settings(true);
+	rtnl_unlock();
 }
 
 int __init regulatory_init(void)
-- 
1.7.5.4

