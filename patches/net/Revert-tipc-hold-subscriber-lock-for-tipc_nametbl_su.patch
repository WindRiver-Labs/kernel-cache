From 13dbc3560336f6433a3ab78d9dd5b36ef032bfdb Mon Sep 17 00:00:00 2001
From: Zhenbo Gao <zhenbo.gao@windriver.com>
Date: Wed, 28 Mar 2018 16:38:29 +0800
Subject: [PATCH 006/376] Revert "tipc: hold subscriber->lock for
 tipc_nametbl_subscribe()"

This reverts commit e597534bedf0f4926c5a005d470ca0b023c97148.

A big patch set for upgrading TIPC(to v4.16-rc6) will come soon

Signed-off-by: Zhenbo Gao <zhenbo.gao@windriver.com>
---
 net/tipc/subscr.c |    4 ++--
 1 files changed, 2 insertions(+), 2 deletions(-)

diff --git a/net/tipc/subscr.c b/net/tipc/subscr.c
index d6e6af2..cb091d2 100644
--- a/net/tipc/subscr.c
+++ b/net/tipc/subscr.c
@@ -296,14 +296,14 @@ static void tipc_subscrp_subscribe(struct net *net, struct tipc_subscr *s,
 
 	spin_lock_bh(&subscriber->lock);
 	list_add(&sub->subscrp_list, &subscriber->subscrp_list);
-	sub->subscriber = subscriber;
-	tipc_nametbl_subscribe(sub);
 	spin_unlock_bh(&subscriber->lock);
 
+	sub->subscriber = subscriber;
 	timeout = htohl(sub->evt.s.timeout, sub->swap);
 
 	if (!mod_timer(&sub->timer, jiffies + msecs_to_jiffies(timeout)))
 		tipc_subscrb_get(subscriber);
+	tipc_nametbl_subscribe(sub);
 }
 
 /* Handle one termination request for the subscriber */
-- 
1.7.5.4

