From 6820f6f53e71e92b2e52236c534bf5f34d68ea9f Mon Sep 17 00:00:00 2001
From: Xufeng Zhang <xufeng.zhang@windriver.com>
Date: Fri, 22 Nov 2013 16:13:36 +0800
Subject: [PATCH 2/2] sctp: Set 'resent' bit in the appropriate place

The resent bit for the DATA chunks is mistakenly set
during packet transmitting process, it will prevent
DATA chunks from updating rto.
We should set resent bit for DATA chunks during the
retransmitting process.

Signed-off-by: Xufeng Zhang <xufeng.zhang@windriver.com>
---
 net/sctp/output.c   |    2 --
 net/sctp/outqueue.c |    2 ++
 2 files changed, 2 insertions(+), 2 deletions(-)

diff --git a/net/sctp/output.c b/net/sctp/output.c
index 3c31cc6..38c9c74 100644
--- a/net/sctp/output.c
+++ b/net/sctp/output.c
@@ -469,8 +469,6 @@ int sctp_packet_transmit(struct sctp_packet *packet)
 				}
 			}
 
-			chunk->resent = 1;
-
 			has_data = 1;
 		}
 
diff --git a/net/sctp/outqueue.c b/net/sctp/outqueue.c
index 54e20e3..c241dab 100644
--- a/net/sctp/outqueue.c
+++ b/net/sctp/outqueue.c
@@ -456,6 +456,8 @@ void sctp_retransmit_mark(struct sctp_outq *q,
 				transport->rto_pending = 0;
 			}
 
+			chunk->resent = 1;
+
 			/* Move the chunk to the retransmit queue. The chunks
 			 * on the retransmit queue are always kept in order.
 			 */
-- 
1.7.0

