From e6e5f5a755ce84925550fcd629f708a49a9f9859 Mon Sep 17 00:00:00 2001
From: Li Wang <li.wang@windriver.com>
Date: Wed, 2 Jun 2010 11:16:42 +0800
Subject: [PATCH] Fix NULL pionter handle of sysctl syscall

In function "devinet_conf_sysctl", the variable of
"table->extra1" or "table->extra2" is probably equal to zero.
If so, it will cause the error, and must add NULL pointer handle.

Signed-off-by: Li Wang <li.wang@windriver.com>
---
 net/ipv4/devinet.c |   10 ++++++----
 1 files changed, 6 insertions(+), 4 deletions(-)

diff --git a/net/ipv4/devinet.c b/net/ipv4/devinet.c
index 49d30b6..3fbbc63 100644
--- a/net/ipv4/devinet.c
+++ b/net/ipv4/devinet.c
@@ -1328,12 +1328,14 @@ static int devinet_conf_sysctl(ctl_table *table, int __user *name, int nlen,
 
 	cnf = table->extra1;
 	net = table->extra2;
-	i = (int *)table->data - cnf->data;
+	if (cnf && net) {
+		i = (int *)table->data - cnf->data;
 
-	set_bit(i, cnf->state);
+		set_bit(i, cnf->state);
 
-	if (cnf == net->ipv4.devconf_dflt)
-		devinet_copy_dflt_conf(net, i);
+		if (cnf == net->ipv4.devconf_dflt)
+			devinet_copy_dflt_conf(net, i);
+	}
 
 	return 1;
 }
-- 
1.6.0.4

