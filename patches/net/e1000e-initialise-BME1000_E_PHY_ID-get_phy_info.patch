From f2f80e5cb939a59856527aecdcfd5c0bdb7ccb67 Mon Sep 17 00:00:00 2001
From: Yong Zhang <yong.zhang@windriver.com>
Date: Mon, 15 Nov 2010 14:30:06 +0800
Subject: [PATCH] e1000e: initialise BME1000_E_PHY_ID get_phy_info

When BME1000_E_PHY_ID NIC is used, the kernel will crash due to
NULL dereference. This cause is phy->ops.get_phy_info is not
initialised for BME1000_E_PHY_ID.

The patch is partly taken from upstread commit: 0be84010

Signed-off-by: Yong Zhang <yong.zhang@windriver.com>
---
 drivers/net/e1000e/ich8lan.c |    1 +
 1 files changed, 1 insertions(+), 0 deletions(-)

diff --git a/drivers/net/e1000e/ich8lan.c b/drivers/net/e1000e/ich8lan.c
index c5dc0a0..0690d66 100644
--- a/drivers/net/e1000e/ich8lan.c
+++ b/drivers/net/e1000e/ich8lan.c
@@ -327,6 +327,7 @@ static s32 e1000_init_phy_params_ich8lan(struct e1000_hw *hw)
 	case BME1000_E_PHY_ID:
 		phy->type = e1000_phy_bm;
 		phy->autoneg_mask = AUTONEG_ADVERTISE_SPEED_DEFAULT;
+		phy->ops.get_phy_info = e1000e_get_phy_info_m88;
 		hw->phy.ops.read_phy_reg = e1000e_read_phy_reg_bm;
 		hw->phy.ops.write_phy_reg = e1000e_write_phy_reg_bm;
 		hw->phy.ops.commit_phy = e1000e_phy_sw_reset;
-- 
1.7.0.4

