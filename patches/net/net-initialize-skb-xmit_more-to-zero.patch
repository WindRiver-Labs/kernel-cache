From 7109cf114a39d64ba974566d3ffbc1ce17a20139 Mon Sep 17 00:00:00 2001
From: Zhu Yanjun <yanjun.zhu@windriver.com>
Date: Sun, 6 Sep 2015 13:20:33 +0800
Subject: [PATCH] net: initialize skb->xmit_more to zero

In the commit 957a28a0 ("net: Remove ndo_xmit_flush netdev operation, use signalling instead"), skb->xmit_more is not initialized to zero. As such,
the tail pointer of tx ring is not updated in time.
If xmit_more is non-zero, it means that more SKBs are pending to
be transmitted on the same queue as the current SKB.

Right now skb->xmit_more is always zero.

Signed-off-by: Zhu Yanjun <yanjun.zhu@windriver.com>
---
 net/core/dev.c |    1 +
 1 files changed, 1 insertions(+), 0 deletions(-)

diff --git a/net/core/dev.c b/net/core/dev.c
index f6d8d7f..271a4cb 100644
--- a/net/core/dev.c
+++ b/net/core/dev.c
@@ -2620,6 +2620,7 @@ int dev_hard_start_xmit(struct sk_buff *skb, struct net_device *dev,
 
 		skb_len = skb->len;
 		trace_net_dev_start_xmit(skb, dev);
+		skb->xmit_more = 0;
 		rc = ops->ndo_start_xmit(skb, dev);
 		trace_net_dev_xmit(skb, rc, dev, skb_len);
 		if (rc == NETDEV_TX_OK)
-- 
1.7.5.4

