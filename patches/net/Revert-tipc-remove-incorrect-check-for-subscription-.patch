From 7de123caf63882c36ff814b5d923b5cc6d538c9a Mon Sep 17 00:00:00 2001
From: Zhenbo Gao <zhenbo.gao@windriver.com>
Date: Wed, 28 Mar 2018 16:39:08 +0800
Subject: [PATCH 010/376] Revert "tipc: remove incorrect check for
 subscription timeout value"

This reverts commit 00047a19ac8801aed8d3dd025dce7dcdcdee0583.

A big patch set for upgrading TIPC(to v4.16-rc6) will come soon

Signed-off-by: Zhenbo Gao <zhenbo.gao@windriver.com>
---
 net/tipc/subscr.c |    3 ++-
 1 files changed, 2 insertions(+), 1 deletions(-)

diff --git a/net/tipc/subscr.c b/net/tipc/subscr.c
index efb8186..fbd36ea 100644
--- a/net/tipc/subscr.c
+++ b/net/tipc/subscr.c
@@ -270,7 +270,8 @@ static int tipc_subscrp_create(struct net *net, struct tipc_subscr *s,
 	memcpy(&sub->evt.s, s, sizeof(*s));
 	atomic_inc(&tn->subscription_count);
 	setup_timer(&sub->timer, tipc_subscrp_timeout, (unsigned long)sub);
-	sub->timeout += jiffies;
+	if (sub->timeout != TIPC_WAIT_FOREVER)
+		sub->timeout += jiffies;
 	if (!mod_timer(&sub->timer, sub->timeout))
 		tipc_subscrb_get(subscriber);
 	*sub_p = sub;
-- 
1.7.5.4

