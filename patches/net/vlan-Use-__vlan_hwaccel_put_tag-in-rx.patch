From 2ff5e1753c0c5d611ff7f4115fdd833f14d29fdc Mon Sep 17 00:00:00 2001
From: jiaxi liu <jiaxi.liu@windriver.com>
Date: Fri, 29 Apr 2011 10:22:01 +0800
Subject: [PATCH] vlan: Use __vlan_hwaccel_put_tag() in rx

commit b93ab837a2d3eb394082c9eae4ee0a4f83060027 upstream

Commit 05423b241311c9380 (vlan: allow null VLAN ID to be used)
forgot to update __vlan_hwaccel_rx()

We need to set VLAN_TAG_PRESENT flag in skb->vlan_tci

Signed-off-by: Eric Dumazet <eric.dumazet@gmail.com>
Signed-off-by: David S. Miller <davem@davemloft.net>
Integrated-off-by: jiaxi liu <jiaxi.liu@windriver.com>
---
 net/8021q/vlan_core.c |    2 +-
 1 files changed, 1 insertions(+), 1 deletions(-)

diff --git a/net/8021q/vlan_core.c b/net/8021q/vlan_core.c
index 2fa5e14..44e4a5f 100644
--- a/net/8021q/vlan_core.c
+++ b/net/8021q/vlan_core.c
@@ -24,7 +24,7 @@ int __vlan_hwaccel_rx(struct sk_buff *skb, struct vlan_group *grp,
 	}
 
 	skb->iif = skb->dev->ifindex;
-	skb->vlan_tci = vlan_tci;
+	__vlan_hwaccel_put_tag(skb, vlan_tci);
 	cb->dev = vlan_group_get_device(grp, vlan_tci & VLAN_VID_MASK);
 
 	return (polling ? netif_receive_skb(skb) : netif_rx(skb));
-- 
1.7.0.2

