From bfef19bc499aa1994b19680554eb3a96fc3ce184 Mon Sep 17 00:00:00 2001
From: Zhenbo Gao <zhenbo.gao@windriver.com>
Date: Wed, 28 Mar 2018 16:40:39 +0800
Subject: [PATCH 019/376] Revert "tipc: fix connection abort during
 subscription cancel"

This reverts commit 257a04782588b4b97ac005a044f85947f792be44.

A big patch set for upgrading TIPC(to v4.16-rc6) will come soon

Signed-off-by: Zhenbo Gao <zhenbo.gao@windriver.com>
---
 net/tipc/subscr.c |    7 ++++---
 1 files changed, 4 insertions(+), 3 deletions(-)

diff --git a/net/tipc/subscr.c b/net/tipc/subscr.c
index 948f316..1c147c86 100644
--- a/net/tipc/subscr.c
+++ b/net/tipc/subscr.c
@@ -302,10 +302,11 @@ static void subscr_conn_msg_event(struct net *net, int conid,
 	struct tipc_net *tn = net_generic(net, tipc_net_id);
 
 	spin_lock_bh(&subscriber->lock);
-	if (subscr_subscribe(net, (struct tipc_subscr *)buf, subscriber, &sub))
-		tipc_conn_terminate(tn->topsrv, subscriber->conid);
-	else
+	subscr_subscribe(net, (struct tipc_subscr *)buf, subscriber, &sub);
+	if (sub)
 		tipc_nametbl_subscribe(sub);
+	else
+		tipc_conn_terminate(tn->topsrv, subscriber->conid);
 	spin_unlock_bh(&subscriber->lock);
 }
 
-- 
1.7.5.4

