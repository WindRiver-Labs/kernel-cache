From a690664f99c66477e6f70249292c23c6cf20227e Mon Sep 17 00:00:00 2001
From: "yadi.hu@windriver.com" <yadi.hu@windriver.com>
Date: Fri, 31 Jul 2015 09:54:19 +0800
Subject: [PATCH] sctp:Fix ABORT packet gets dropped

In case of ipv6 packets, the abort is generated
but dropped as there is no corresponding association to it .
But this is not in accordance to the RFC and the SCTP
stack should send an ABORT to the sender.

Signed-off-by: Hu <yadi.hu@windriver.com>
---
 net/sctp/ipv6.c |    7 ++++---
 1 files changed, 4 insertions(+), 3 deletions(-)

diff --git a/net/sctp/ipv6.c b/net/sctp/ipv6.c
index 2ffa958..f9eae10 100644
--- a/net/sctp/ipv6.c
+++ b/net/sctp/ipv6.c
@@ -362,16 +362,17 @@ out:
 			if (err < 0)
 				goto failure;
 		}
+failure:
 		t->dst = dst;
 		t->dst_cookie = rt->rt6i_node ? rt->rt6i_node->fn_sernum : 0;
 
 		SCTP_DEBUG_PRINTK("rt6_dst:%pI6 rt6_src:%pI6\n",
 			&rt->rt6i_dst.addr, &fl->fl6_src);
 		return;
+	} else {
+		t->dst = NULL;
+		SCTP_DEBUG_PRINTK("NO ROUTE\n");
 	}
-failure:
-	t->dst = NULL;
-	SCTP_DEBUG_PRINTK("NO ROUTE\n");
 }
 
 /* Returns the number of consecutive initial bits that match in the 2 ipv6
-- 
1.7.5.4

