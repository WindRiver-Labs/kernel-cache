From 875e7f6da1966c2f83265df3bb528878034fcffc Mon Sep 17 00:00:00 2001
Message-Id: <875e7f6da1966c2f83265df3bb528878034fcffc.1445619480.git.Jim.Somerville@windriver.com>
From: Paul Gortmaker <paul.gortmaker@windriver.com>
Date: Wed, 21 Oct 2015 18:43:41 -0400
Subject: [PATCH 1/1] i40e: nix low latency polling not avail until 3.11

Low latency socket polling was introduced in 3.11
via [ upstream 060212928670593fb89243640bf05cf89560b023 ]
using config option CONFIG_NET_LL_RX_POLL.  This was
subsequently renamed by [ upstream e0d1095ae3405404d247afb00233ef837d58da83 ]
to CONFIG_NET_RX_BUSY_POLL.  With that config option off, skb_mark_napi_id
is just a nop anyway so simply remove it.

Signed-off-by: Jim Somerville <Jim.Somerville@windriver.com>
---
 drivers/net/ethernet/intel/i40e/i40e_txrx.c   | 2 --
 drivers/net/ethernet/intel/i40evf/i40e_txrx.c | 2 --
 2 files changed, 4 deletions(-)

diff --git a/drivers/net/ethernet/intel/i40e/i40e_txrx.c b/drivers/net/ethernet/intel/i40e/i40e_txrx.c
index 94b0810..e1f2901 100644
--- a/drivers/net/ethernet/intel/i40e/i40e_txrx.c
+++ b/drivers/net/ethernet/intel/i40e/i40e_txrx.c
@@ -25,7 +25,6 @@
  ******************************************************************************/
 
 #include <linux/prefetch.h>
-#include <net/busy_poll.h>
 #include "i40e.h"
 #include "i40e_prototype.h"
 
@@ -1673,7 +1672,6 @@ static int i40e_clean_rx_irq_ps(struct i40e_ring *rx_ring, int budget)
 			continue;
 		}
 #endif
-		skb_mark_napi_id(skb, &rx_ring->q_vector->napi);
 		i40e_receive_skb(rx_ring, skb, vlan_tag);
 
 		rx_ring->netdev->last_rx = jiffies;
diff --git a/drivers/net/ethernet/intel/i40evf/i40e_txrx.c b/drivers/net/ethernet/intel/i40evf/i40e_txrx.c
index 2c8e413..6334737 100644
--- a/drivers/net/ethernet/intel/i40evf/i40e_txrx.c
+++ b/drivers/net/ethernet/intel/i40evf/i40e_txrx.c
@@ -25,7 +25,6 @@
  ******************************************************************************/
 
 #include <linux/prefetch.h>
-#include <net/busy_poll.h>
 
 #include "i40evf.h"
 #include "i40e_prototype.h"
@@ -1145,7 +1144,6 @@ static int i40e_clean_rx_irq_ps(struct i40e_ring *rx_ring, int budget)
 			continue;
 		}
 #endif
-		skb_mark_napi_id(skb, &rx_ring->q_vector->napi);
 		i40e_receive_skb(rx_ring, skb, vlan_tag);
 
 		rx_ring->netdev->last_rx = jiffies;
-- 
1.8.3.2

