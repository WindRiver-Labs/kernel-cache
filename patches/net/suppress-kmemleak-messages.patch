From cc6bbc670f6c4d28886998876618ceecfb5c6365 Mon Sep 17 00:00:00 2001
From: Hu Yadi <Yadi.hu@windriver.com>
Date: Wed, 6 Nov 2013 11:40:20 +0800
Subject: [PATCH] suppress kmemleak messages

The networking stack in the kernel uses sysctl to register /proc/sys/net/*,
this registration is known to trigger false positive memory leak reports.

We can fix this warning by following the same method which was used
in mainline commit <fd4b616b0fbb77e3f349e7d60914f2b7c7e39f9c> [suppress kmemleak messages].

Signed-off-by: Hu Yadi <Yadi.hu@windriver.com>
---
 net/core/sysctl_net_core.c |   13 ++++++++++---
 1 files changed, 10 insertions(+), 3 deletions(-)

diff --git a/net/core/sysctl_net_core.c b/net/core/sysctl_net_core.c
index 0c28508..dbc749b 100644
--- a/net/core/sysctl_net_core.c
+++ b/net/core/sysctl_net_core.c
@@ -14,6 +14,7 @@
 #include <linux/vmalloc.h>
 #include <linux/init.h>
 #include <linux/slab.h>
+#include <linux/kmemleak.h>
 
 #include <net/ip.h>
 #include <net/sock.h>
@@ -254,10 +255,16 @@ static __net_initdata struct pernet_operations sysctl_core_ops = {
 
 static __init int sysctl_core_init(void)
 {
-	static struct ctl_table empty[1];
+       static struct ctl_table empty[1];
 
-	register_sysctl_paths(net_core_path, empty);
-	register_net_sysctl_rotable(net_core_path, net_core_table);
+	struct ctl_table_header *hdr_1;
+	struct ctl_table_header *hdr_2;
+
+	hdr_1 = register_sysctl_paths(net_core_path, empty);
+	kmemleak_not_leak(hdr_1);
+
+	hdr_2 = register_net_sysctl_rotable(net_core_path, net_core_table);
+	kmemleak_not_leak(hdr_2);
 	return register_pernet_subsys(&sysctl_core_ops);
 }
 
-- 
1.7.5.4

