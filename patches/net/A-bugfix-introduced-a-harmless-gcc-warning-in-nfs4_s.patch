From e043b68667ddb78b6dda8c22e79282e97afde34d Mon Sep 17 00:00:00 2001
From: "Kexin(Casey) Chen" <Casey.Chen@windriver.com>
Date: Tue, 15 Nov 2016 11:56:29 -0800
Subject: [PATCH] A bugfix introduced a harmless gcc warning in
 nfs4_slot_seqid_in_use:

fs/nfs/nfs4session.c:203:54: error: 'cur_seq' may be used
uninitialized in this function [-Werror=maybe-uninitialized]

gcc is not smart enough to conclude that the IS_ERR/PTR_ERR pair
results in a nonzero return value here. Using PTR_ERR_OR_ZERO()
instead makes this clear to the compiler.

https://groups.google.com/forum/#!topic/linux.kernel/bVGGqwmAzVo

Signed-off-by: Arnd Bergmann <arnd@arndb.de>

Signed-off-by: Kexin(Casey) Chen <Casey.Chen@windriver.com>
---
 fs/nfs/nfs4session.c | 10 ++++++----
 1 file changed, 6 insertions(+), 4 deletions(-)

diff --git a/fs/nfs/nfs4session.c b/fs/nfs/nfs4session.c
index b629730..3fa1933 100644
--- a/fs/nfs/nfs4session.c
+++ b/fs/nfs/nfs4session.c
@@ -178,12 +178,14 @@ static int nfs4_slot_get_seqid(struct nfs4_slot_table  *tbl, u32 slotid,
 	__must_hold(&tbl->slot_tbl_lock)
 {
 	struct nfs4_slot *slot;
+	int ret;
 
 	slot = nfs4_lookup_slot(tbl, slotid);
-	if (IS_ERR(slot))
-		return PTR_ERR(slot);
-	*seq_nr = slot->seq_nr;
-	return 0;
+	ret = PTR_ERR_OR_ZERO(slot);
+        if (!ret)
+		*seq_nr = slot->seq_nr;
+
+        return ret;
 }
 
 /*
-- 
2.0.2

