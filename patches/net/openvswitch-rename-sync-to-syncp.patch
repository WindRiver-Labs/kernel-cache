From 368b5a5d4dd8520fb05442464f2cf456563816a8 Mon Sep 17 00:00:00 2001
From: WANG Cong <xiyou.wangcong@gmail.com>
Date: Fri, 14 Feb 2014 15:10:46 -0800
Subject: [PATCH] openvswitch: rename ->sync to ->syncp

commit df9d9fdf8fdad710949ce52a403684c991ced29b upstream

Openvswitch defines u64_stats_sync as ->sync rather than ->syncp,
so fails to compile with netdev_alloc_pcpu_stats(). So just rename it to ->syncp.

Reported-by: kbuild test robot <fengguang.wu@intel.com>
Fixes: 1c213bd24ad04f4430031 (net: introduce netdev_alloc_pcpu_stats() for drivers)
Cc: David S. Miller <davem@davemloft.net>
Signed-off-by: Cong Wang <xiyou.wangcong@gmail.com>
Reviewed-by: Flavio Leitner <fbl@redhat.com>
Signed-off-by: David S. Miller <davem@davemloft.net>
[Drop changes to the u64_stats_fetch_begin_bh/u64_stats_fetch_retry_bh
 for the cherry pick of 57a7744e0986 applied the dropped parts while the
 whole commit should be picked as a dependency.
]
Signed-off-by: Shan Hai <shan.hai@windriver.com>
---
 net/openvswitch/datapath.c |    8 ++++----
 net/openvswitch/datapath.h |    2 +-
 2 files changed, 5 insertions(+), 5 deletions(-)

diff --git a/net/openvswitch/datapath.c b/net/openvswitch/datapath.c
index d12d6b8..1fbac59 100644
--- a/net/openvswitch/datapath.c
+++ b/net/openvswitch/datapath.c
@@ -260,9 +260,9 @@ void ovs_dp_process_received_packet(struct vport *p, struct sk_buff *skb)
 
 out:
 	/* Update datapath statistics. */
-	u64_stats_update_begin(&stats->sync);
+	u64_stats_update_begin(&stats->syncp);
 	(*stats_counter)++;
-	u64_stats_update_end(&stats->sync);
+	u64_stats_update_end(&stats->syncp);
 }
 
 static struct genl_family dp_packet_genl_family = {
@@ -305,9 +305,9 @@ int ovs_dp_upcall(struct datapath *dp, struct sk_buff *skb,
 err:
 	stats = this_cpu_ptr(dp->stats_percpu);
 
-	u64_stats_update_begin(&stats->sync);
+	u64_stats_update_begin(&stats->syncp);
 	stats->n_lost++;
-	u64_stats_update_end(&stats->sync);
+	u64_stats_update_end(&stats->syncp);
 
 	return err;
 }
diff --git a/net/openvswitch/datapath.h b/net/openvswitch/datapath.h
index 16b8406..d22c0d2 100644
--- a/net/openvswitch/datapath.h
+++ b/net/openvswitch/datapath.h
@@ -50,7 +50,7 @@ struct dp_stats_percpu {
 	u64 n_hit;
 	u64 n_missed;
 	u64 n_lost;
-	struct u64_stats_sync sync;
+	struct u64_stats_sync syncp;
 };
 
 /**
-- 
1.7.5.4

