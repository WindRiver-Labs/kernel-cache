From 6442e342df134448f2549d1a5088e12daf5bf237 Mon Sep 17 00:00:00 2001
From: Xufeng Zhang <xufeng.zhang@windriver.com>
Date: Thu, 24 Jan 2013 13:18:14 +0800
Subject: [PATCH 1/3] Revert "fix sctp can not work with ipv6 source address routing"

This reverts commit 0c84684bc1e5a5098a4e47c67cb705feebb304ee.

This is v1 version which is made and used by us, but it is not
accepted by sctp upstream, and another version is used by mainline
kernel to resolve the same problem, so we should use the upstream
one instead of the original one to keep consistent with mainline.

Signed-off-by: Xufeng Zhang <xufeng.zhang@windriver.com>
---
 net/sctp/transport.c |   11 ++---------
 1 files changed, 2 insertions(+), 9 deletions(-)

diff --git a/net/sctp/transport.c b/net/sctp/transport.c
index 1571aaf..5bdd29a 100644
--- a/net/sctp/transport.c
+++ b/net/sctp/transport.c
@@ -284,16 +284,9 @@ void sctp_transport_route(struct sctp_transport *transport,
 
 	if (saddr)
 		memcpy(&transport->saddr, saddr, sizeof(union sctp_addr));
-	else {
+	else
 		af->get_saddr(opt, asoc, dst, daddr, &transport->saddr);
-		/* When using source address routing, since dst was
-		 * looked up prior to filling in the source address, dst
-		 * needs to be looked up again to get the correct dst
-		*/
-		if (dst)
-			dst_release(dst);
-		dst = af->get_dst(asoc, daddr, &transport->saddr);
-	}
+
 	transport->dst = dst;
 	if ((transport->param_flags & SPP_PMTUD_DISABLE) && transport->pathmtu) {
 		return;
-- 
1.7.0

