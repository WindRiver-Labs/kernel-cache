From 43244a24bb1e740584ceb637175cf4b8e8a0f216 Mon Sep 17 00:00:00 2001
From: Ovidiu Panait <ovidiu.panait@windriver.com>
Date: Thu, 5 Apr 2018 13:20:47 +0300
Subject: [PATCH] bonding: save original net_device in skb->real_dev

When CONFIG_BONDING_DEVINFO is activated, skb->real_dev contains the
bonding interface(e.g. bond0), not the real interface the packet came in
from (e.g. eth0).

Fix this by saving the original net_device in skb->real_dev.

This issue is specific to the WRL8 kernel, introduced by commit
1406c88116835dc6f3617bdd49b629d0de88a492 [bonding: Bonding device info support]

Signed-off-by: Ovidiu Panait <ovidiu.panait@windriver.com>
---
 net/core/dev.c |    2 +-
 1 files changed, 1 insertions(+), 1 deletions(-)

diff --git a/net/core/dev.c b/net/core/dev.c
index 8e54f52..6a270ca 100644
--- a/net/core/dev.c
+++ b/net/core/dev.c
@@ -3766,7 +3766,7 @@ ncls:
 	/* deliver only exact match when indicated */
 	if (likely(!deliver_exact)) {
 #ifdef CONFIG_BONDING_DEVINFO
-		skb->real_dev = skb->dev;
+		skb->real_dev = orig_dev;
 #endif
 		deliver_ptype_list_skb(skb, &pt_prev, orig_dev, type,
 				       &ptype_base[ntohs(type) &
-- 
1.7.5.4

