From 5a88af01502a5b10723e84edd2f960b8f32811a8 Mon Sep 17 00:00:00 2001
From: Xiaotian Feng <Xiaotian.Feng@windriver.com>
Date: Wed, 20 May 2009 10:04:19 +0800
Subject: [PATCH] bonding: fix miss tracking of real_dev in skb copy

git commit f6df40e provides the physical device the packet came in
from for a bonded ethernet device. But if the skb is handled by
__copy_skb_header, the real_dev info will be lost. Copy real_dev
in __copy_skb_header when BONDING_DEVINFO is enabled.
---
 net/core/skbuff.c |    3 +++
 1 files changed, 3 insertions(+), 0 deletions(-)

diff --git a/net/core/skbuff.c b/net/core/skbuff.c
index 7832287..3fbc8f9 100644
--- a/net/core/skbuff.c
+++ b/net/core/skbuff.c
@@ -420,6 +420,9 @@ static void __copy_skb_header(struct sk_buff *new, const struct sk_buff *old)
 	new->network_header	= old->network_header;
 	new->mac_header		= old->mac_header;
 	new->dst		= dst_clone(old->dst);
+#ifdef CONFIG_BONDING_DEVINFO 
+	new->real_dev           = old->real_dev; 
+#endif
 #ifdef CONFIG_INET
 	new->sp			= secpath_get(old->sp);
 #endif
-- 
1.6.3.3

