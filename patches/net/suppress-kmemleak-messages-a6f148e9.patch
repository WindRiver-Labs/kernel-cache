From da3f96014ad97149c2d942cecbbbf2650d97f908 Mon Sep 17 00:00:00 2001
From: Hu Yadi <Yadi.hu@windriver.com>
Date: Wed, 6 Nov 2013 11:40:21 +0800
Subject: [PATCH] suppress kmemleak messages

The networking stack in the kernel uses sysctl to register /proc/sys/net/*,
this registration is known to trigger false positive memory leak reports.

We can fix this warning by following the same method which was used
in mainline commit <fd4b616b0fbb77e3f349e7d60914f2b7c7e39f9c> [suppress kmemleak messages].

Signed-off-by: Hu Yadi <Yadi.hu@windriver.com>
---
 net/ipv4/route.c |    6 +++++-
 1 files changed, 5 insertions(+), 1 deletions(-)

diff --git a/net/ipv4/route.c b/net/ipv4/route.c
index 167ea10..fe084da 100644
--- a/net/ipv4/route.c
+++ b/net/ipv4/route.c
@@ -107,6 +107,7 @@
 #include <net/xfrm.h>
 #include <net/netevent.h>
 #include <net/rtnetlink.h>
+#include <linux/kmemleak.h>
 #ifdef CONFIG_SYSCTL
 #include <linux/sysctl.h>
 #endif
@@ -3505,6 +3506,9 @@ int __init ip_rt_init(void)
  */
 void __init ip_static_sysctl_init(void)
 {
-	register_sysctl_paths(ipv4_path, ipv4_skeleton);
+        struct ctl_table_header *hdr;
+	hdr = register_sysctl_paths(ipv4_path, ipv4_skeleton);
+	kmemleak_not_leak(hdr);
+	return 0;
 }
 #endif
-- 
1.7.5.4

