From a6be220a6949c18de942417ea7929c7d48706bba Mon Sep 17 00:00:00 2001
From: Subbaraya Sundeep Bhatta <subbaraya.sundeep.bhatta@xilinx.com>
Date: Mon, 23 Sep 2013 21:20:46 +0530
Subject: [PATCH 556/628] usb: gadget: Proper initialization of Endpoints

git://github.com/Xilinx/linux-xlnx.git xilinx-v14.7
commit 560ee104e269aaaab47f2f2c34a0015bf93ff1df

Initialize maxpacket of usb_ep for non-zero endpoints properly so
that gadget layer can use.

Signed-off-by: Subbaraya Sundeep Bhatta <sbhatta@xilinx.com>
Signed-off-by: Michal Simek <michal.simek@xilinx.com>
Signed-off-by: Liming Wang <liming.wang@windriver.com>
---
 drivers/usb/gadget/xilinx_udc.c |    4 +++-
 1 files changed, 3 insertions(+), 1 deletions(-)

diff --git a/drivers/usb/gadget/xilinx_udc.c b/drivers/usb/gadget/xilinx_udc.c
index b2be6d5..fd4c458 100644
--- a/drivers/usb/gadget/xilinx_udc.c
+++ b/drivers/usb/gadget/xilinx_udc.c
@@ -1465,8 +1465,10 @@ static void xudc_reinit(struct xusb_udc *udc)
 	for (ep_number = 0; ep_number < XUSB_MAX_ENDPOINTS; ep_number++) {
 		struct xusb_ep *ep = &udc->ep[ep_number];
 
-		if (ep_number)
+		if (ep_number) {
 			list_add_tail(&ep->ep.ep_list, &udc->gadget.ep_list);
+			ep->ep.maxpacket = (unsigned short)~0;
+		}
 		ep->desc = NULL;
 		ep->stopped = 0;
 		/*
-- 
1.7.5.4

