From ab466a85210825479d2fe0b50a5174c2a539274b Mon Sep 17 00:00:00 2001
From: Naveen Mamindlapalli <naveen.mamindlapalli@xilinx.com>
Date: Wed, 1 May 2013 21:10:24 +0530
Subject: [PATCH 539/628] usb: xilinxps_udc: Fixed zero length packet issue
 with control endpoint.

git://github.com/Xilinx/linux-xlnx.git xilinx-v14.7
commit 221c0f490c1633d460076d4f96cfb010e748f00b

Disabled sending Zero Length Packet (ZLP) automatically based on ZLT bit
in dQH for Control IN and OUT endpoints.

Signed-off-by: Naveen Mamindlapalli <naveenm@xilinx.com>
Signed-off-by: Michal Simek <michal.simek@xilinx.com>
Signed-off-by: Liming Wang <liming.wang@windriver.com>
---
 drivers/usb/gadget/xilinx_usbps_udc.c |    4 ++--
 1 files changed, 2 insertions(+), 2 deletions(-)

diff --git a/drivers/usb/gadget/xilinx_usbps_udc.c b/drivers/usb/gadget/xilinx_usbps_udc.c
index 38cd054..a06d551 100644
--- a/drivers/usb/gadget/xilinx_usbps_udc.c
+++ b/drivers/usb/gadget/xilinx_usbps_udc.c
@@ -807,9 +807,9 @@ static void ep0_setup(struct xusbps_udc *udc)
 	/* the intialization of an ep includes: fields in QH, Regs,
 	 * xusbps_ep struct */
 	struct_ep_qh_setup(udc, 0, USB_RECV, USB_ENDPOINT_XFER_CONTROL,
-			USB_MAX_CTRL_PAYLOAD, 0, 0);
+			USB_MAX_CTRL_PAYLOAD, 1, 0);
 	struct_ep_qh_setup(udc, 0, USB_SEND, USB_ENDPOINT_XFER_CONTROL,
-			USB_MAX_CTRL_PAYLOAD, 0, 0);
+			USB_MAX_CTRL_PAYLOAD, 1, 0);
 	dr_ep_setup(0, USB_RECV, USB_ENDPOINT_XFER_CONTROL);
 	dr_ep_setup(0, USB_SEND, USB_ENDPOINT_XFER_CONTROL);
 
-- 
1.7.5.4

