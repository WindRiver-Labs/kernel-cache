From a6550f4670c9e2e760d79c5da103ee8b108b94e6 Mon Sep 17 00:00:00 2001
From: Soren Brinkmann <soren.brinkmann@xilinx.com>
Date: Tue, 16 Apr 2013 14:38:33 -0700
Subject: [PATCH 314/628] i2c: xilinx_ps: Migrate to clock controller

git://github.com/Xilinx/linux-xlnx.git xilinx-v14.7
commit 28581ed9 arm: zynq: Migrate to clock controller

Switch Zynq, including its drivers, over to use the new clock
controller. And remove old clock implementation.

Signed-off-by: Soren Brinkmann <soren.brinkmann@xilinx.com>
[cherry picked the xilinx i2c driver modification only]
Signed-off-by: Liming Wang <liming.wang@windriver.com>
---
 drivers/i2c/busses/i2c-xilinx_ps.c |    7 ++-----
 1 files changed, 2 insertions(+), 5 deletions(-)

diff --git a/drivers/i2c/busses/i2c-xilinx_ps.c b/drivers/i2c/busses/i2c-xilinx_ps.c
index ae5117f..65709c1 100644
--- a/drivers/i2c/busses/i2c-xilinx_ps.c
+++ b/drivers/i2c/busses/i2c-xilinx_ps.c
@@ -877,12 +877,9 @@ static int xi2cps_probe(struct platform_device *pdev)
 		 "XILINX I2C at %08lx", (unsigned long)r_mem->start);
 
 	id->cur_timeout = id->adap.timeout;
-	if (id->irq == 80)
-		id->clk = clk_get_sys("I2C1_APER", NULL);
-	else
-		id->clk = clk_get_sys("I2C0_APER", NULL);
+	id->clk = clk_get(&pdev->dev, NULL);
 	if (IS_ERR(id->clk)) {
-		dev_err(&pdev->dev, "Clock not found.\n");
+		dev_err(&pdev->dev, "input clock not found.\n");
 		ret = PTR_ERR(id->clk);
 		goto err_unmap;
 	}
-- 
1.7.5.4

