From b4e584e8079e6baba43eb60674598d83a38b2151 Mon Sep 17 00:00:00 2001
From: Zumeng Chen <zumeng.chen@windriver.com>
Date: Mon, 10 Feb 2014 14:10:39 +0800
Subject: [PATCH] kgdboc, omap: rx polling hook for the omap serial driver

The RX polling hook allows the debugger to hook character input so as
to allow entry to the kernel debugger with a control-c as an example.

Signed-off-by: Zumeng Chen <zumeng.chen@@windriver.com>
---
 drivers/tty/serial/omap-serial.c |    4 ++++
 1 files changed, 4 insertions(+), 0 deletions(-)

diff --git a/drivers/tty/serial/omap-serial.c b/drivers/tty/serial/omap-serial.c
index b080214..9272b46 100644
--- a/drivers/tty/serial/omap-serial.c
+++ b/drivers/tty/serial/omap-serial.c
@@ -469,6 +469,10 @@ static void serial_omap_rdi(struct uart_omap_port *up, unsigned int lsr)
 	flag = TTY_NORMAL;
 	up->port.icount.rx++;
 
+#ifdef CONFIG_CONSOLE_POLL
+	if (up->port.poll_rx_cb && up->port.poll_rx_cb(ch))
+		return;
+#endif
 	if (uart_handle_sysrq_char(&up->port, ch))
 		return;
 
-- 
1.7.5.4

