From 7113630f70ffb15f07d38c6a9db2a5349c111bd5 Mon Sep 17 00:00:00 2001
From: fli <fupan.li@windriver.com>
Date: Fri, 31 May 2013 10:04:49 +0800
Subject: [PATCH] fix the bug triggered by introduce struct
 vga_switcheroo_client_ops

upstream commit 26ec685ff9d9c16525d8ec4c97e52fcdb187b302 introduce the
struct vga_switcheroo_client_ops changing the API as a clean-up.

Signed-off-by: fli <fupan.li@windriver.com>
---
 drivers/gpu/drm/i915/i915_dma.c |   11 +++++++----
 1 files changed, 7 insertions(+), 4 deletions(-)

diff --git a/drivers/gpu/drm/i915/i915_dma.c b/drivers/gpu/drm/i915/i915_dma.c
index ba60f3c..fd69d0d 100644
--- a/drivers/gpu/drm/i915/i915_dma.c
+++ b/drivers/gpu/drm/i915/i915_dma.c
@@ -1183,6 +1183,12 @@ static bool i915_switcheroo_can_switch(struct pci_dev *pdev)
 	return can_switch;
 }
 
+static const struct vga_switcheroo_client_ops i915_switcheroo_ops = {
+	.set_gpu_state = i915_switcheroo_set_state,
+	.reprobe = NULL,
+	.can_switch = i915_switcheroo_can_switch,
+};
+
 static bool
 intel_enable_ppgtt(struct drm_device *dev)
 {
@@ -1288,10 +1294,7 @@ static int i915_load_modeset_init(struct drm_device *dev)
 
 	intel_register_dsm_handler();
 
-	ret = vga_switcheroo_register_client(dev->pdev,
-					     i915_switcheroo_set_state,
-					     NULL,
-					     i915_switcheroo_can_switch);
+	ret = vga_switcheroo_register_client(dev->pdev, &i915_switcheroo_ops);
 	if (ret)
 		goto cleanup_vga_client;
 
-- 
1.7.5.4

