From bae7aa6577d092f2b99374ac6509861d3cabdacd Mon Sep 17 00:00:00 2001
From: Subbaraya Sundeep Bhatta <subbaraya.sundeep.bhatta@xilinx.com>
Date: Mon, 23 Sep 2013 21:20:38 +0530
Subject: [PATCH 548/628] usb: gadget: Replaced of_get_property with
 of_property_read_bool

git://github.com/Xilinx/linux-xlnx.git xilinx-v14.7
commit fc88972e55acb933b36fa31e231f9221956b3fe2

Use of_property_read_bool for DMA info in dts.

Signed-off-by: Subbaraya Sundeep Bhatta <sbhatta@xilinx.com>
Signed-off-by: Michal Simek <michal.simek@xilinx.com>
Signed-off-by: Liming Wang <liming.wang@windriver.com>
---
 drivers/usb/gadget/xilinx_udc.c |   20 +++-----------------
 1 files changed, 3 insertions(+), 17 deletions(-)

diff --git a/drivers/usb/gadget/xilinx_udc.c b/drivers/usb/gadget/xilinx_udc.c
index b4db2fe..1e4ade3 100644
--- a/drivers/usb/gadget/xilinx_udc.c
+++ b/drivers/usb/gadget/xilinx_udc.c
@@ -200,7 +200,7 @@ struct xusb_udc {
 	struct xusb_ep ep[8];
 	void __iomem *base_address;
 	struct usb_gadget_driver *driver;
-	u8 dma_enabled;
+	bool dma_enabled;
 	u8 status;
 	unsigned int (*read_fn) (void __iomem *);
 	void (*write_fn) (u32, void __iomem *);
@@ -2185,11 +2185,6 @@ static int xudc_init(struct device *dev, struct resource *regs_res,
 	}
 	udc->base_address = v_addr;
 
-	if (regs_res->flags == IORESOURCE_DMA)
-		udc->dma_enabled = 1;
-	else
-		udc->dma_enabled = 0;
-
 	spin_lock_init(&udc->lock);
 
 	/* Check for IP endianness */
@@ -2292,7 +2287,7 @@ usb_of_probe(struct platform_device *pdev)
 	struct device_node *np = pdev->dev.of_node;
 	struct resource res, irq_res;
 	int rc;
-	const u32 *dma;
+	struct xusb_udc *udc = &controller;
 
 	dev_dbg(&pdev->dev, "%s(%p)\n", __func__, pdev);
 
@@ -2308,16 +2303,7 @@ usb_of_probe(struct platform_device *pdev)
 		return rc;
 	}
 
-	dma = of_get_property(np, "xlnx,include-dma", NULL);
-	if (!dma) {
-		dev_err(&pdev->dev, "DMA information missing in device tree\n");
-		return -ENODATA;
-	}
-	if (*dma)
-		res.flags = IORESOURCE_DMA;
-	else
-		res.flags = IORESOURCE_IO;
-
+	udc->dma_enabled = of_property_read_bool(np, "xlnx,include-dma");
 
 	return xudc_init(&pdev->dev, &res, &irq_res);
 }
-- 
1.7.5.4

