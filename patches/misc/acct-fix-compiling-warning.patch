From 856cc70ed131e6cb98801eb2b719b24a70193be1 Mon Sep 17 00:00:00 2001
From: Zumeng Chen <zumeng.chen@windriver.com>
Date: Mon, 28 Sep 2015 17:18:47 +0800
Subject: [PATCH] acct: fix compiling warning

1. Actually it should be shown in all arch, but why not in
   the latest mainline and qemux86 in 4.1.x kernel?
   Because it has been work-arouded by an C assignment for
   __cmpxchg, in which the value of (__typeof__(*(ptr)))
   has been used. So no warnings popped out.

2. We use "void" to use the value since no one cares the
   return value in line 174 of acct.c to fix this defect
   once and for all.

Here is the original warning information:

In file included from ./arch/arm/include/asm/atomic.h:19:0,
                 from include/linux/atomic.h:4,
                 from include/linux/spinlock.h:416,
                 from include/linux/mmzone.h:7,
                 from include/linux/gfp.h:5,
                 from include/linux/mm.h:9,
                 from kernel/acct.c:46:
kernel/acct.c: In function 'acct_pin_kill':
./arch/arm/include/asm/cmpxchg.h:205:3: warning: value computed is not used [-Wunused-value]
  ((__typeof__(*(ptr)))__cmpxchg_mb((ptr),   \
   ^
kernel/acct.c:174:2: note: in expansion of macro 'cmpxchg'
  cmpxchg(&acct->ns->bacct, pin, NULL);
  ^

Signed-off-by: Zumeng Chen <zumeng.chen@windriver.com>
---
 kernel/acct.c | 2 +-
 1 file changed, 1 insertion(+), 1 deletion(-)

diff --git a/kernel/acct.c b/kernel/acct.c
index 74963d1..0992de1 100644
--- a/kernel/acct.c
+++ b/kernel/acct.c
@@ -171,7 +171,7 @@ static void acct_pin_kill(struct fs_pin *pin)
 	do_acct_process(acct);
 	schedule_work(&acct->work);
 	wait_for_completion(&acct->done);
-	cmpxchg(&acct->ns->bacct, pin, NULL);
+	(void)cmpxchg(&acct->ns->bacct, pin, NULL);
 	mutex_unlock(&acct->lock);
 	pin_remove(pin);
 	acct_put(acct);
-- 
2.0.2

