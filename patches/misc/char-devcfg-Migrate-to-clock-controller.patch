From d50d3037986d1d63d438b2abc74a63aec12ad90b Mon Sep 17 00:00:00 2001
From: Soren Brinkmann <soren.brinkmann@xilinx.com>
Date: Tue, 16 Apr 2013 14:38:33 -0700
Subject: [PATCH 184/628] char: devcfg: Migrate to clock controller

git://github.com/Xilinx/linux-xlnx.git xilinx-v14.7
commit 28581ed9 arm: zynq: Migrate to clock controller

cherry picked the devcfg driver modification.

Signed-off-by: Soren Brinkmann <soren.brinkmann@xilinx.com>
Signed-off-by: Liming Wang <liming.wang@windriver.com>
---
 drivers/char/xilinx_devcfg.c |   12 ++++++------
 1 files changed, 6 insertions(+), 6 deletions(-)

diff --git a/drivers/char/xilinx_devcfg.c b/drivers/char/xilinx_devcfg.c
index 96818a6..e48df71 100644
--- a/drivers/char/xilinx_devcfg.c
+++ b/drivers/char/xilinx_devcfg.c
@@ -96,10 +96,10 @@ static DEFINE_MUTEX(xdevcfg_mutex);
 #define XDCFG_DMA_INVALID_ADDRESS	0xFFFFFFFF  /* Invalid DMA address */
 
 static const char * const fclk_name[] = {
-	"FPGA0",
-	"FPGA1",
-	"FPGA2",
-	"FPGA3"
+	"fclk0",
+	"fclk1",
+	"fclk2",
+	"fclk3"
 };
 #define NUMFCLKS ARRAY_SIZE(fclk_name)
 
@@ -1773,7 +1773,7 @@ static void xdevcfg_fclk_init(struct device *dev)
 	struct xdevcfg_drvdata *drvdata = dev_get_drvdata(dev);
 
 	for (i = 0; i < NUMFCLKS; i++) {
-		drvdata->fclk[i] = clk_get_sys(fclk_name[i], NULL);
+		drvdata->fclk[i] = clk_get(dev, fclk_name[i]);
 		if (IS_ERR(drvdata->fclk[i])) {
 			dev_warn(dev, "fclk not found\n");
 			return;
@@ -1904,7 +1904,7 @@ static int xdevcfg_drv_probe(struct platform_device *pdev)
 		 drvdata->base_address,
 		 (unsigned long long) (regs_res->end - regs_res->start + 1));
 
-	drvdata->clk = clk_get_sys("PCAP", NULL);
+	drvdata->clk = clk_get(&pdev->dev, "ref_clk");
 	if (IS_ERR(drvdata->clk)) {
 		dev_err(&pdev->dev, "input clock not found\n");
 		retval = PTR_ERR(drvdata->clk);
-- 
1.7.5.4

