From cca75f682b7c607d914ce02e04cc789760379c65 Mon Sep 17 00:00:00 2001
From: Joe MacDonald <joe.macdonald@windriver.com>
Date: Wed, 25 Aug 2010 13:47:30 -0400
Subject: [PATCH] ipc: update load_msg to take size_t

load_msg() originally took a signed int which could have resulted in a
kmalloc requesting less that the necessary size for msg and subsequently
overwriting pieces of kernel memory if the parameter was sufficiently
large to be considered a negative number for sizeof(*msg)+len.

Signed-off-by: Joe MacDonald <joe.macdonald@windriver.com>
---
 ipc/msgutil.c |    4 ++--
 ipc/util.h    |    2 +-
 2 files changed, 3 insertions(+), 3 deletions(-)

diff --git a/ipc/msgutil.c b/ipc/msgutil.c
index f095ee2..7bbb773 100644
--- a/ipc/msgutil.c
+++ b/ipc/msgutil.c
@@ -44,12 +44,12 @@ struct msg_msgseg {
 #define DATALEN_MSG	(PAGE_SIZE-sizeof(struct msg_msg))
 #define DATALEN_SEG	(PAGE_SIZE-sizeof(struct msg_msgseg))
 
-struct msg_msg *load_msg(const void __user *src, int len)
+struct msg_msg *load_msg(const void __user *src, size_t len)
 {
 	struct msg_msg *msg;
 	struct msg_msgseg **pseg;
 	int err;
-	int alen;
+	size_t alen;
 
 	alen = len;
 	if (alen > DATALEN_MSG)
diff --git a/ipc/util.h b/ipc/util.h
index 764b51a..42eb09d 100644
--- a/ipc/util.h
+++ b/ipc/util.h
@@ -137,7 +137,7 @@ int ipc_parse_version (int *cmd);
 #endif
 
 extern void free_msg(struct msg_msg *msg);
-extern struct msg_msg *load_msg(const void __user *src, int len);
+extern struct msg_msg *load_msg(const void __user *src, size_t len);
 extern int store_msg(void __user *dest, struct msg_msg *msg, int len);
 
 extern void recompute_msgmni(struct ipc_namespace *);
-- 
1.6.5.2

