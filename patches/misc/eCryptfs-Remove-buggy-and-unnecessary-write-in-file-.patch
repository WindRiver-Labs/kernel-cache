From 435d364b19ebe719629fcf8a4646df7d6a597801 Mon Sep 17 00:00:00 2001
From: Jian Liu <jian.liu@windriver.com>
Date: Thu, 9 Apr 2015 10:16:37 +0800
Subject: [PATCH] eCryptfs: Remove buggy and unnecessary write in file name
 decode routine

commit 942080643bce061c3dd9d5718d3b745dcb39a8bc upstream

CVE-2014-9683:
Dmitry Chernenkov used KASAN to discover that eCryptfs writes past
the end of the allocated buffer during encrypted filename decoding.
This fix corrects the issue by getting rid of the unnecessary 0
write when the current bit offset is 2.

Signed-off-by: Michael Halcrow <mhalcrow@google.com>
Reported-by: Dmitry Chernenkov <dmitryc@google.com>
Suggested-by: Kees Cook <keescook@chromium.org>
Cc: stable@vger.kernel.org
Signed-off-by: Tyler Hicks <tyhicks@canonical.com>
Signed-off-by: Jian Liu <jian.liu@windriver.com>
---
 fs/ecryptfs/crypto.c |    1 -
 1 files changed, 0 insertions(+), 1 deletions(-)

diff --git a/fs/ecryptfs/crypto.c b/fs/ecryptfs/crypto.c
index f71ec12..1da2446 100644
--- a/fs/ecryptfs/crypto.c
+++ b/fs/ecryptfs/crypto.c
@@ -2102,7 +2102,6 @@ ecryptfs_decode_from_filename(unsigned char *dst, size_t *dst_size,
 			break;
 		case 2:
 			dst[dst_byte_offset++] |= (src_byte);
-			dst[dst_byte_offset] = 0;
 			current_bit_offset = 0;
 			break;
 		}
-- 
1.7.5.4

