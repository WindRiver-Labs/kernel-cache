From 090bc3c92f3bdc194f380c2ae9b326e89dcca6df Mon Sep 17 00:00:00 2001
From: Vlad Lungu <vlad.lungu@windriver.com>
Date: Tue, 27 Mar 2012 14:19:30 +0100
Subject: [PATCH 211/628] Xilinx: ARM: QSPI: Allow OF configuration of SPI
 devices

git://github.com/Xilinx/linux-xlnx.git xilinx-v14.7
commit c549ae7a1e9f42a4c958043b5ee166b33be7b33f

Setting master->dev.of_node allows spi_register_master to
populate the bus from the device tree, like this:

               spi@e000d000 {
                        compatible = "xlnx,ps7-qspi-1.00.a";
			...
                        flash@0 {
                                compatible = "n25q128";
                                reg = <0x0>;
				...
			}
		}

Signed-off-by: Vlad Lungu <vlad.lungu@windriver.com>
Signed-off-by: John Linn <john.linn@xilinx.com>
Signed-off-by: Liming Wang <liming.wang@windriver.com>
---
 drivers/spi/spi-xilinx-qps.c |    1 +
 1 files changed, 1 insertions(+), 0 deletions(-)

diff --git a/drivers/spi/spi-xilinx-qps.c b/drivers/spi/spi-xilinx-qps.c
index 8a3b74b..662b0ca 100644
--- a/drivers/spi/spi-xilinx-qps.c
+++ b/drivers/spi/spi-xilinx-qps.c
@@ -933,6 +933,7 @@ static int __devinit xqspips_probe(struct platform_device *dev)
 		return -ENOMEM;
 
 	xqspi = spi_master_get_devdata(master);
+	master->dev.of_node = dev->dev.of_node;
 	platform_set_drvdata(dev, master);
 
 #ifndef CONFIG_OF
-- 
1.7.5.4

