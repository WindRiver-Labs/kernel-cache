From f66ef062101e0caa578e205fd3f53aa0a42c70ba Mon Sep 17 00:00:00 2001
From: Peder Andersen <peder.andersen@windriver.com>
Date: Thu, 2 Jun 2011 15:52:28 -0700
Subject: [PATCH] perf: fix PERF_EVENT_IOC_PERIOD ioctl

The perf_event_period() routine was misinterpreting the return value of
copy_from_user(), resulting in all valid calls to
ioctl(PERF_EVENT_IOC_PERIOD) returning -EINVAL.

Signed-off-by: Peder Andersen <peder.andersen@windriver.com>
---
 kernel/perf_event.c |    4 +---
 1 files changed, 1 insertions(+), 3 deletions(-)

diff --git a/kernel/perf_event.c b/kernel/perf_event.c
index 2357b19..a250bfc 100644
--- a/kernel/perf_event.c
+++ b/kernel/perf_event.c
@@ -2123,15 +2123,13 @@ static void perf_event_for_each(struct perf_event *event,
 static int perf_event_period(struct perf_event *event, u64 __user *arg)
 {
 	struct perf_event_context *ctx = event->ctx;
-	unsigned long size;
 	int ret = 0;
 	u64 value;
 
 	if (!event->attr.sample_period)
 		return -EINVAL;
 
-	size = copy_from_user(&value, arg, sizeof(value));
-	if (size != sizeof(value))
+	if (copy_from_user(&value, arg, sizeof(value)))
 		return -EFAULT;
 
 	if (!value)
-- 
1.7.0.4

