From 08a415a0b33445826570952c0a56d36ca9ca6842 Mon Sep 17 00:00:00 2001
From: Liming Wang <liming.wang@windriver.com>
Date: Fri, 4 Apr 2014 17:27:31 +0800
Subject: [PATCH 571/628] usb: xilinx: Use platform_{get,set}_drvdata()

git://github.com/Xilinx/linux-xlnx.git xilinx-v14.7
commit 3bd0d085 xilinx: Use platform_{get,set}_drvdata()

Based on mainline commit:
"serial: use platform_{get,set}_drvdata()"
(sha1: 696faedd616e202f5c510cd03dcc8853c11ca6db)

Signed-off-by: Michal Simek <michal.simek@xilinx.com>
[cherry picked the xilinx ehci driver modification only]
Signed-off-by: Liming Wang <liming.wang@windriver.com>
---
 drivers/usb/host/ehci-xilinx-of.c |    5 ++---
 1 files changed, 2 insertions(+), 3 deletions(-)

diff --git a/drivers/usb/host/ehci-xilinx-of.c b/drivers/usb/host/ehci-xilinx-of.c
index d845e3b..35c7f90 100644
--- a/drivers/usb/host/ehci-xilinx-of.c
+++ b/drivers/usb/host/ehci-xilinx-of.c
@@ -209,8 +209,7 @@ err_irq:
  */
 static int ehci_hcd_xilinx_of_remove(struct platform_device *op)
 {
-	struct usb_hcd *hcd = dev_get_drvdata(&op->dev);
-	dev_set_drvdata(&op->dev, NULL);
+	struct usb_hcd *hcd = platform_get_drvdata(op);
 
 	dev_dbg(&op->dev, "stopping XILINX-OF USB Controller\n");
 
@@ -229,7 +228,7 @@ static int ehci_hcd_xilinx_of_remove(struct platform_device *op)
  */
 static void ehci_hcd_xilinx_of_shutdown(struct platform_device *op)
 {
-	struct usb_hcd *hcd = dev_get_drvdata(&op->dev);
+	struct usb_hcd *hcd = platform_get_drvdata(op);
 
 	if (hcd->driver->shutdown)
 		hcd->driver->shutdown(hcd);
-- 
1.7.5.4

