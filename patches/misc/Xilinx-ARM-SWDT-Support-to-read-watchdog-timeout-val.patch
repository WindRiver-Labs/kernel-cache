From 488d94680666ef5570ded69217a218219241977b Mon Sep 17 00:00:00 2001
From: SrikanthT <sthokal@xilinx.com>
Date: Tue, 18 Sep 2012 18:02:52 +0530
Subject: [PATCH 085/628] Xilinx: ARM: SWDT: Support to read watchdog timeout
 value from device-tree

git://github.com/Xilinx/linux-xlnx.git xilinx-v14.7
commit 692181909fe1f392260bf55bb46bb68dac8f8d21

This patch adds support to read the watchdog timeout value
from device-tree.

Signed-off-by: SrikanthT <sthokal@xilinx.com>
[cherry picked the driver modification only]
Signed-off-by: Liming Wang <liming.wang@windriver.com>
---
 drivers/watchdog/xilinx_wdtps.c |    5 ++++-
 1 files changed, 4 insertions(+), 1 deletions(-)

diff --git a/drivers/watchdog/xilinx_wdtps.c b/drivers/watchdog/xilinx_wdtps.c
index 3609412..0cc2d12 100644
--- a/drivers/watchdog/xilinx_wdtps.c
+++ b/drivers/watchdog/xilinx_wdtps.c
@@ -336,7 +336,10 @@ static int __init xwdtps_probe(struct platform_device *pdev)
 
 	/* Initialize the members of xwdtps structure */
 	xwdtps_device.parent = &pdev->dev;
-	if (wdt_timeout < XWDTPS_MAX_TIMEOUT &&
+	prop = of_get_property(pdev->dev.of_node, "timeout", NULL);
+	if (prop)
+		xwdtps_device.timeout = be32_to_cpup(prop);
+	else if (wdt_timeout < XWDTPS_MAX_TIMEOUT &&
 			wdt_timeout > XWDTPS_MIN_TIMEOUT) {
 		xwdtps_device.timeout = wdt_timeout;
 	} else {
-- 
1.7.5.4

