From b12daf221fe17f4bd6e5f54ea02f450bd4a79556 Mon Sep 17 00:00:00 2001
From: Yang Honggang (Joseph) <eagle.rtlinux@gmail.com>
Date: Thu, 1 Dec 2011 22:22:41 -0500
Subject: [PATCH 1/2] clocksource: Fix bug with max_deferment margin calculation

based on commit b1f919664d04a8d0ba29cb76673c7ca3325a2006 upstream

discard modification in the __clocksource_updatefreq_scale function
because the current version of the kernel has no such function.

CC: stable@kernel.org
Signed-off-by: Yang Honggang (Joseph) <eagle.rtlinux@gmail.com>
[jstultz: Modified commit subject]
Signed-off-by: John Stultz <john.stultz@linaro.org>
Signed-off-by: Shan Hai <shan.hai@windriver.com>
---
 kernel/time/clocksource.c |    2 +-
 1 files changed, 1 insertions(+), 1 deletions(-)

diff --git a/kernel/time/clocksource.c b/kernel/time/clocksource.c
index 3748aa8..0859c8d 100644
--- a/kernel/time/clocksource.c
+++ b/kernel/time/clocksource.c
@@ -549,7 +549,7 @@ static u64 clocksource_max_deferment(struct clocksource *cs)
 	 * note a margin of 12.5% is used because this can be computed with
 	 * a shift, versus say 10% which would require division.
 	 */
-	return max_nsecs - (max_nsecs >> 5);
+	return max_nsecs - (max_nsecs >> 3);
 }
 
 #ifdef CONFIG_GENERIC_TIME
-- 
1.7.0

