From fbc0c159d45911b94dcdbcb5709e8ce06e012be3 Mon Sep 17 00:00:00 2001
From: Peter Zijlstra <a.p.zijlstra@chello.nl>
Date: Thu, 6 Oct 2011 22:39:14 +0200
Subject: [PATCH 3/3] sched, rt: Provide means of disabling cross-cpu
 bandwidth sharing

commit 4a6184ce7a48c478dee0d8a9ed74c1fa35161858 upstream

Normally the RT bandwidth scheme will share bandwidth across the
entire root_domain. However sometimes its convenient to disable this
sharing for debug purposes. Provide a simple feature switch to this
end.

Signed-off-by: Peter Zijlstra <a.p.zijlstra@chello.nl>
Signed-off-by: Ingo Molnar <mingo@elte.hu>
Signed-off-by: Shan Hai <shan.hai@windriver.com>
---
 kernel/sched_features.h |    1 +
 kernel/sched_rt.c       |    3 +++
 2 files changed, 4 insertions(+), 0 deletions(-)

diff --git a/kernel/sched_features.h b/kernel/sched_features.h
index d5059fd..f55d035 100644
--- a/kernel/sched_features.h
+++ b/kernel/sched_features.h
@@ -116,3 +116,4 @@ SCHED_FEAT(ASYM_EFF_LOAD, 1)
  * release the lock. Decreases scheduling overhead.
  */
 SCHED_FEAT(OWNER_SPIN, 1)
+SCHED_FEAT(RT_RUNTIME_SHARE, 1)
diff --git a/kernel/sched_rt.c b/kernel/sched_rt.c
index 1041ccc..fcdb4b5 100644
--- a/kernel/sched_rt.c
+++ b/kernel/sched_rt.c
@@ -502,6 +502,9 @@ static int balance_runtime(struct rt_rq *rt_rq)
 {
 	int more = 0;
 
+	if (!sched_feat(RT_RUNTIME_SHARE))
+		return more;
+
 	if (rt_rq->rt_time > rt_rq->rt_runtime) {
 		raw_spin_unlock(&rt_rq->rt_runtime_lock);
 		more = do_balance_runtime(rt_rq);
-- 
1.7.5.4

