From f6bfa3d3ffc3e4280ad711b52beb3ff7c79b78df Mon Sep 17 00:00:00 2001
From: Suneel Garapati <suneel.garapati@xilinx.com>
Date: Thu, 30 May 2013 16:29:38 +0530
Subject: [PATCH 246/628] spi: xilinx-qps: Remove switch logic in
 xqspips_copy_read_data

git://github.com/Xilinx/linux-xlnx.git xilinx-v14.7
commit 5dcab0201bf2754e9091be75f81536df6ff1fc3e

Instead of switch cases, handle the copy of data from rxd
to buffer using memcpy with check on endianess.

Signed-off-by: Suneel Garapati <suneel.garapati@xilinx.com>
Signed-off-by: Michal Simek <michal.simek@xilinx.com>
Signed-off-by: Liming Wang <liming.wang@windriver.com>
---
 drivers/spi/spi-xilinx-qps.c |   30 ++++--------------------------
 1 files changed, 4 insertions(+), 26 deletions(-)

diff --git a/drivers/spi/spi-xilinx-qps.c b/drivers/spi/spi-xilinx-qps.c
index 061a741..ad0811d 100644
--- a/drivers/spi/spi-xilinx-qps.c
+++ b/drivers/spi/spi-xilinx-qps.c
@@ -295,33 +295,11 @@ static void xqspips_init_hw(void __iomem *regs_base, int is_dual)
  **/
 static void xqspips_copy_read_data(struct xqspips *xqspi, u32 data, u8 size)
 {
-	u8 byte3;
-
 	if (xqspi->rxbuf) {
-		switch (size) {
-		case 1:
-			*((u8 *)xqspi->rxbuf) = data;
-			xqspi->rxbuf += 1;
-			break;
-		case 2:
-			*((u16 *)xqspi->rxbuf) = data;
-			xqspi->rxbuf += 2;
-			break;
-		case 3:
-			*((u16 *)xqspi->rxbuf) = data;
-			xqspi->rxbuf += 2;
-			byte3 = (u8)(data >> 16);
-			*((u8 *)xqspi->rxbuf) = byte3;
-			xqspi->rxbuf += 1;
-			break;
-		case 4:
-			(*(u32 *)xqspi->rxbuf) = data;
-			xqspi->rxbuf += 4;
-			break;
-		default:
-			/* This will never execute */
-			break;
-		}
+		data >>= (4 - size) * 8;
+		data = le32_to_cpu(data);
+		memcpy((u8 *)xqspi->rxbuf, &data, size);
+		xqspi->rxbuf += size;
 	}
 	xqspi->bytes_to_receive -= size;
 	if (xqspi->bytes_to_receive < 0)
-- 
1.7.5.4

