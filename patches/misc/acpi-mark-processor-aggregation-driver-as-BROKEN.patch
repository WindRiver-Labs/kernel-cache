From 908b9e68e35182766471c6f3f00d156c44ed67e7 Mon Sep 17 00:00:00 2001
From: Paul Gortmaker <paul.gortmaker@windriver.com>
Date: Mon, 27 Jul 2015 15:35:06 -0400
Subject: [PATCH] acpi: mark processor aggregation driver as BROKEN

This driver was added ~6y ago over an explicit NACK from
PeterZ[1] and then even just more recenlty tglx was extremely
disappointed in the driver code quality[2] and lack of updates.

But more important than that, it isn't properly or completely
developed, and if people disable C states, then the "idle"
rt threads this thing creates will eat 100% CPU and trip
rt throttling messages and generally render a system ground
to a halt and effectively dead.

This is not specific to the kernel here, there are also reports
from Dell users[3] and Ubuntu users[4] that suffered the same
problem of a rediculous number of acpi_pad threads all over.

We see several problems with it ; it sets these idle threads
to -rt but does not try to mitigate their runtime, or even
see if C states are available 1st; a comment in it says the
rt runtime "borrowing" feature will effectively break the
driver, but it doesn't try to detect if that is enabled (and
it is enabled by default in mainline).

To that end, mark it as BROKEN so nobody else has to learn
the hard way that this is not something you want enabled
by default on production systems.  If we are RT_FULL or
NOHZ_FULL, we don't want this thing adding non-deterministic
behaviour, mucking with rt threads or set_cpus_allowed.

[1] https://git.kernel.org/cgit/linux/kernel/git/torvalds/linux.git/commit/?id=8e0af5141ab950b78b3ebbfaded5439dcf8b3a8d
[2] https://git.kernel.org/cgit/linux/kernel/git/torvalds/linux.git/commit/?id=3ff70551a942b4c1d3c2e96e31a5c6e369a6d0be
[3] http://en.community.dell.com/techcenter/b/techcenter/archive/2012/08/27/ubuntu-on-dell-12g-poweredge-servers
[4] https://devtalk.nvidia.com/default/topic/842168/-acpi_pad-module-issue-on-ubuntu/

Signed-off-by: Paul Gortmaker <paul.gortmaker@windriver.com>

diff --git a/drivers/acpi/Kconfig b/drivers/acpi/Kconfig
index 100bd724f648..3bcf3ba51c0e 100644
--- a/drivers/acpi/Kconfig
+++ b/drivers/acpi/Kconfig
@@ -219,7 +219,7 @@ config ACPI_HOTPLUG_CPU
 
 config ACPI_PROCESSOR_AGGREGATOR
 	tristate "Processor Aggregator"
-	depends on ACPI_PROCESSOR
+	depends on ACPI_PROCESSOR && BROKEN
 	depends on X86
 	help
 	  ACPI 4.0 defines processor Aggregator, which enables OS to perform
-- 
2.4.3

