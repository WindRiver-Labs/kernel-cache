From ae6582089708871422e9bea871037742a159627e Mon Sep 17 00:00:00 2001
From: Michal Simek <michal.simek@xilinx.com>
Date: Mon, 8 Jul 2013 08:02:09 +0200
Subject: [PATCH 156/628] edac: zynq: Do not explicitely use devres groups

git://github.com/Xilinx/linux-xlnx.git xilinx-v14.7
commit a8092ea8e798c1f4052d82dd8b2459005ec11976

devres groups are setup automatically. Not necessary
to create them again.

Signed-off-by: Michal Simek <michal.simek@xilinx.com>
Signed-off-by: Liming Wang <liming.wang@windriver.com>
---
 drivers/edac/zynq_edac.c |   13 ++-----------
 1 files changed, 2 insertions(+), 11 deletions(-)

diff --git a/drivers/edac/zynq_edac.c b/drivers/edac/zynq_edac.c
index 7470af0..39ad551 100644
--- a/drivers/edac/zynq_edac.c
+++ b/drivers/edac/zynq_edac.c
@@ -509,9 +509,6 @@ static int zynq_edac_mc_probe(struct platform_device *pdev)
 	struct resource *res;
 	void __iomem *baseaddr;
 
-	if (!devres_open_group(&pdev->dev, NULL, GFP_KERNEL))
-		return -ENOMEM;
-
 	/* Get the data from the platform device */
 	res = platform_get_resource(pdev, IORESOURCE_MEM, 0);
 	baseaddr = devm_ioremap_resource(&pdev->dev, res);
@@ -522,9 +519,8 @@ static int zynq_edac_mc_probe(struct platform_device *pdev)
 
 	/* Check for the ecc enable status */
 	if (zynq_edac_get_eccstate(baseaddr) == false) {
-		rc = -ENXIO;
 		dev_err(&pdev->dev, "ecc not enabled\n");
-		goto iounmap;
+		return -ENXIO;
 	}
 
 	/*
@@ -542,9 +538,8 @@ static int zynq_edac_mc_probe(struct platform_device *pdev)
 	mci = edac_mc_alloc(pdev->id, ARRAY_SIZE(layers), layers,
 			    sizeof(struct zynq_edac_priv));
 	if (mci == NULL) {
-		rc = -ENOMEM;
 		pr_err("Failed memory allocation for mci instance!\n");
-		goto iounmap;
+		return -ENOMEM;
 	}
 
 	priv = mci->pvt_info;
@@ -565,16 +560,12 @@ static int zynq_edac_mc_probe(struct platform_device *pdev)
 		goto del_edac_mc;
 	}
 
-	devres_close_group(&pdev->dev, NULL);
-
 	return rc;
 
 del_edac_mc:
 	edac_mc_del_mc(&pdev->dev);
 free_edac_mc:
 	edac_mc_free(mci);
-iounmap:
-	devres_release_group(&pdev->dev, NULL);
 
 	return rc;
 }
-- 
1.7.5.4

