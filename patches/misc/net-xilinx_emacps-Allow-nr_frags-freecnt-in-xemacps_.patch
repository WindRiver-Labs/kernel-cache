From a333f009ee3347d1049d79c213fc0b3099398b55 Mon Sep 17 00:00:00 2001
From: Thomas Betker <thomas.betker@rohde-schwarz.com>
Date: Sat, 8 Jun 2013 11:03:19 +0200
Subject: [PATCH 410/628] net: xilinx_emacps: Allow nr_frags == freecnt in
 xemacps_start_xmit().

git://github.com/Xilinx/linux-xlnx.git xilinx-v14.7
commit 10b702055345a7ef949877c84860fe96ba00b6df

In xemacps_start_xmit(), allow nr_frags == tx_bd_freecnt so that the
whole Tx BD list can be used.

Signed-off-by: Thomas Betker <thomas.betker@rohde-schwarz.com>
Signed-off-by: Michal Simek <michal.simek@xilinx.com>
Signed-off-by: Liming Wang <liming.wang@windriver.com>
---
 drivers/net/ethernet/xilinx/xilinx_emacps.c |    2 +-
 1 files changed, 1 insertions(+), 1 deletions(-)

diff --git a/drivers/net/ethernet/xilinx/xilinx_emacps.c b/drivers/net/ethernet/xilinx/xilinx_emacps.c
index f16a16e..7e5c74d 100644
--- a/drivers/net/ethernet/xilinx/xilinx_emacps.c
+++ b/drivers/net/ethernet/xilinx/xilinx_emacps.c
@@ -2012,7 +2012,7 @@ static int xemacps_start_xmit(struct sk_buff *skb, struct net_device *ndev)
 	nr_frags = skb_shinfo(skb)->nr_frags + 1;
 	spin_lock_bh(&lp->tx_lock);
 
-	if (nr_frags >= lp->tx_bd_freecnt) {
+	if (nr_frags > lp->tx_bd_freecnt) {
 		netif_stop_queue(ndev); /* stop send queue */
 		spin_unlock_bh(&lp->tx_lock);
 		return NETDEV_TX_BUSY;
-- 
1.7.5.4

