From aea2620b284932c6920af5a0344a122e09aee716 Mon Sep 17 00:00:00 2001
From: Punnaiah Choudary Kalluri <punnaiah.choudary.kalluri@xilinx.com>
Date: Tue, 6 Aug 2013 12:17:01 +0530
Subject: [PATCH 270/628] zynq: qspi: Added support for quad page program
 command

git://github.com/Xilinx/linux-xlnx.git xilinx-v14.7
commit 81db44f817a1c7c90d8238015c7dbe2c4216dc26

Added the quad page program command support to the qspi controller
driver command table.
updated the quad support macro to the spi framework.

Signed-off-by: Punnaiah Choudary Kalluri <punnaia@xilinx.com>
Acked-by: Peter Crosthwaite <peter.crosthwaite@xilinx.com>
Signed-off-by: Michal Simek <michal.simek@xilinx.com>
Signed-off-by: Liming Wang <liming.wang@windriver.com>
---
 drivers/spi/spi-xilinx-qps.c |    3 +++
 1 files changed, 3 insertions(+), 0 deletions(-)

diff --git a/drivers/spi/spi-xilinx-qps.c b/drivers/spi/spi-xilinx-qps.c
index aeb0e7f..f48f141 100644
--- a/drivers/spi/spi-xilinx-qps.c
+++ b/drivers/spi/spi-xilinx-qps.c
@@ -138,6 +138,7 @@
 #define	XQSPIPS_FLASH_OPCODE_RDID	0x9F	/* Read JEDEC ID */
 #define	XQSPIPS_FLASH_OPCODE_BE		0xC7	/* Erase whole flash block */
 #define	XQSPIPS_FLASH_OPCODE_SE		0xD8	/* Sector erase (usually 64KB)*/
+#define XQSPIPS_FLASH_OPCODE_QPP	0x32	/* Quad page program */
 
 /*
  * Macros for the QSPI controller read/write
@@ -229,6 +230,7 @@ static struct xqspips_inst_format flash_inst[] = {
 	{ XQSPIPS_FLASH_OPCODE_BRWR, 2, XQSPIPS_TXD_00_10_OFFSET },
 	{ XQSPIPS_FLASH_OPCODE_EXTADRD, 1, XQSPIPS_TXD_00_01_OFFSET },
 	{ XQSPIPS_FLASH_OPCODE_EXTADWR, 2, XQSPIPS_TXD_00_10_OFFSET },
+	{ XQSPIPS_FLASH_OPCODE_QPP, 4, XQSPIPS_TXD_00_00_OFFSET },
 	/* Add all the instructions supported by the flash device */
 };
 
@@ -1096,6 +1098,7 @@ static int xqspips_probe(struct platform_device *pdev)
 
 	master->setup = xqspips_setup;
 	master->transfer = xqspips_transfer;
+	master->flags = SPI_MASTER_QUAD_MODE;
 
 	xqspi->speed_hz = clk_get_rate(xqspi->devclk) / 2;
 
-- 
1.7.5.4

