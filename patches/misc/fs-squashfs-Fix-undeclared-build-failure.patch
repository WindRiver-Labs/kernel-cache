From 793fe67c9ea65f819b024c44568cb646c37d37f6 Mon Sep 17 00:00:00 2001
From: De Huo <De.Huo@windriver.com>
Date: Fri, 6 Jan 2017 15:47:42 +0800
Subject: [PATCH] fs/squashfs: Fix undeclared build failure

Supply the header file for some functions and macros
from commit squashfs: modify the method of sleep in
squashfs_read_data from TASK_UNINTERRUPTIBLE to
TASK_KILLABLE.
Otherwise there will be below build error when set
CONFIG_SQUASHFS=m
CONFIG_SQUASHFS_XATTR=y
.

| /buildarea1/dhuo2/7_x86_std_rcpl22_lx06/bitbake_build/tmp/work-shared/intel-x86-64/kernel-source/fs/squashfs/block.c: In function 'squashfs_sleep_on_buffer':
| /buildarea1/dhuo2/7_x86_std_rcpl22_lx06/bitbake_build/tmp/work-shared/intel-x86-64/kernel-source/fs/squashfs/block.c:44:2: error: implicit declaration of function 'io_schedule' [-Werror=implicit-function-declaration]
|   io_schedule();
|   ^
| /buildarea1/dhuo2/7_x86_std_rcpl22_lx06/bitbake_build/tmp/work-shared/intel-x86-64/kernel-source/fs/squashfs/block.c:45:2: error: implicit declaration of function 'fatal_signal_pending' [-Werror=implicit-function-declaration]
|   return fatal_signal_pending(current) ? -EINTR : 0;
|   ^
| /buildarea1/dhuo2/7_x86_std_rcpl22_lx06/bitbake_build/tmp/work-shared/intel-x86-64/kernel-source/fs/squashfs/block.c: In function 'squashfs_wait_on_buffer_killable':
| /buildarea1/dhuo2/7_x86_std_rcpl22_lx06/bitbake_build/tmp/work-shared/intel-x86-64/kernel-source/fs/squashfs/block.c:58:5: error: 'TASK_KILLABLE' undeclared (first use in this function)
|      TASK_KILLABLE);
|      ^
| /buildarea1/dhuo2/7_x86_std_rcpl22_lx06/bitbake_build/tmp/work-shared/intel-x86-64/kernel-source/fs/squashfs/block.c:58:5: note: each undeclared identifier is reported only once for each function it appears in
| cc1: some warnings being treated as errors
|   CC [M]  fs/reiserfs/xattr_user.o
| /buildarea1/dhuo2/7_x86_std_rcpl22_lx06/bitbake_build/tmp/work-shared/intel-x86-64/kernel-source/scripts/Makefile.build:308: recipe for target 'fs/squashfs/block.o' failed
| make[4]: *** [fs/squashfs/block.o] Error 1
| /buildarea1/dhuo2/7_x86_std_rcpl22_lx06/bitbake_build/tmp/work-shared/intel-x86-64/kernel-source/scripts/Makefile.build:455: recipe for target 'fs/squashfs' failed
| make[3]: *** [fs/squashfs] Error 2
| make[3]: *** Waiting for unfinished jobs....

Signed-off-by: De Huo <De.Huo@windriver.com>
---
 fs/squashfs/block.c |    1 +
 1 files changed, 1 insertions(+), 0 deletions(-)

diff --git a/fs/squashfs/block.c b/fs/squashfs/block.c
index 7280e12..10bf5b7 100644
--- a/fs/squashfs/block.c
+++ b/fs/squashfs/block.c
@@ -31,6 +31,7 @@
 #include <linux/slab.h>
 #include <linux/string.h>
 #include <linux/buffer_head.h>
+#include <linux/sched.h>
 
 #include "squashfs_fs.h"
 #include "squashfs_fs_sb.h"
-- 
1.7.5.4

