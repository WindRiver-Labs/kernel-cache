From 2bb72a0586157d8a9573bc42676af5628884bc97 Mon Sep 17 00:00:00 2001
From: Liming Wang <liming.wang@windriver.com>
Date: Wed, 26 Mar 2014 17:31:15 +0800
Subject: [PATCH 348/628] gpio: xilinxps: Remove __devinit, __devexit,
 __definitdata, __devexit_p, __exit_p

git://github.com/Xilinx/linux-xlnx.git xilinx-v14.7
commit 068160c0 Merge commit 'v3.8' into master-next

cherry picked the xilinx gpio driver modification.

Signed-off-by: Liming Wang <liming.wang@windriver.com>
---
 drivers/gpio/gpio-xilinx.c   |    9 ++++++++-
 drivers/gpio/gpio-xilinxps.c |    4 ++--
 2 files changed, 10 insertions(+), 3 deletions(-)

diff --git a/drivers/gpio/gpio-xilinx.c b/drivers/gpio/gpio-xilinx.c
index 7370eb9..1fa1519 100644
--- a/drivers/gpio/gpio-xilinx.c
+++ b/drivers/gpio/gpio-xilinx.c
@@ -232,7 +232,14 @@ static int xgpio_of_probe(struct device_node *np)
 	if (tree_info && be32_to_cpup(tree_info)) {
 		/* Distinguish dual gpio chip */
 		/* NOTE baseaddr ends with zero address XGPIO_CHANNEL_OFFSET */
-		np->full_name[strlen(np->full_name) - 1] = '8';
+		/*
+		 * FIXME
+		 * drivers/gpio/gpio-xilinx.c: In function 'xgpio_of_probe':
+		 * drivers/gpio/gpio-xilinx.c:235:3: error: assignment of
+		 * read-only location '*(np->full_name + ((unsigned int)strlen
+		 * (np->full_name) + 0xffffffffffffffffffffffffffffffffu))'
+		 */
+		/* np->full_name[strlen(np->full_name) - 1] = '8'; */
 
 		chip = kzalloc(sizeof(*chip), GFP_KERNEL);
 		if (!chip)
diff --git a/drivers/gpio/gpio-xilinxps.c b/drivers/gpio/gpio-xilinxps.c
index 908ffa8..8c51700 100644
--- a/drivers/gpio/gpio-xilinxps.c
+++ b/drivers/gpio/gpio-xilinxps.c
@@ -541,7 +541,7 @@ static const struct dev_pm_ops xgpiops_dev_pm_ops = {
  * Note: Interrupts are disabled for all the banks during initialization.
  * Returns 0 on success, negative error otherwise.
  */
-static int __devinit xgpiops_probe(struct platform_device *pdev)
+static int xgpiops_probe(struct platform_device *pdev)
 {
 	int ret;
 	unsigned int irq_num;
@@ -693,7 +693,7 @@ static int xgpiops_remove(struct platform_device *pdev)
 	return 0;
 }
 
-static struct of_device_id xgpiops_of_match[] __devinitdata = {
+static struct of_device_id xgpiops_of_match[] = {
 	{ .compatible = "xlnx,ps7-gpio-1.00.a", },
 	{ /* end of table */}
 };
-- 
1.7.5.4

