From ff988bdcd035c4d24fc8c8751d07d0085910d83a Mon Sep 17 00:00:00 2001
From: Clemens Ladisch <clemens@ladisch.de>
Date: Mon, 7 Mar 2011 13:22:50 +0100
Subject: [PATCH 2/4] ALSA: control: fix numid conflict check for new controls

Commit 7c7335877105364f7f5181e80ff34206b54be81f upstream

The purpose of the snd_ctl_hole_check() function is to find conflicts
between the numerical IDs of the new control and those of any existing
controls.  However, it would fail to detect an existing control whose
count is smaller than the new control's count and whose interval of IDs
is entirely contained in the interval of the new control's IDs.

To fix this, use the correct formula to detect overlapping intervals,
which happens to simplify the condition.

This problem was not encountered so far because ALSA does not yet allow
drivers to allocate specific control IDs.

Signed-off-by: Clemens Ladisch <clemens@ladisch.de>
Signed-off-by: Takashi Iwai <tiwai@suse.de>
---
 sound/core/control.c |    6 ++----
 1 files changed, 2 insertions(+), 4 deletions(-)

diff --git a/sound/core/control.c b/sound/core/control.c
index 0e69f4b..4cfa8ad 100644
--- a/sound/core/control.c
+++ b/sound/core/control.c
@@ -281,10 +281,8 @@ static unsigned int snd_ctl_hole_check(struct snd_card *card,
 	struct snd_kcontrol *kctl;
 
 	list_for_each_entry(kctl, &card->controls, list) {
-		if ((kctl->id.numid <= card->last_numid &&
-		     kctl->id.numid + kctl->count > card->last_numid) ||
-		    (kctl->id.numid <= card->last_numid + count - 1 &&
-		     kctl->id.numid + kctl->count > card->last_numid + count - 1))
+		if (kctl->id.numid < card->last_numid + 1 + count &&
+		    kctl->id.numid + kctl->count > card->last_numid + 1)
 		    	return card->last_numid = kctl->id.numid + kctl->count - 1;
 	}
 	return card->last_numid;
-- 
1.7.0

