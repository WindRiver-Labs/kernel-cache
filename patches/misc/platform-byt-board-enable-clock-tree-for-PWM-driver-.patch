From fa2734b091bf16ca8f06f281da1505fc7506bcb3 Mon Sep 17 00:00:00 2001
From: fupan li <fupan.li@windriver.com>
Date: Mon, 10 Feb 2014 11:00:30 +0800
Subject: [PATCH 17/22] platform: byt-board: enable clock tree for PWM driver
 in board file

This patch comes from the Yocto Project BayTrail BSP golden release.

	From 455e1a198270540e61307e8da68de6b5451e9eaf Mon Sep 17 00:00:00 2001
	From: "Chang, Rebecca Swee Fun" <rebecca.swee.fun.chang@intel.com>
	Date: Thu, 19 Dec 2013 16:00:10 +0800
	Subject: [PATCH 6/7] platform: byt-board: enable clock tree for PWM driver in
	 board file

	Signed-off-by: Chang, Rebecca Swee Fun <rebecca.swee.fun.chang@intel.com>

Signed-off-by: fupan li <fupan.li@windriver.com>
---
 arch/x86/platform/byt/byt-board.c |   15 ++++++++++++---
 1 file changed, 12 insertions(+), 3 deletions(-)

diff --git a/arch/x86/platform/byt/byt-board.c b/arch/x86/platform/byt/byt-board.c
index a89c9d6..2bd265a 100644
--- a/arch/x86/platform/byt/byt-board.c
+++ b/arch/x86/platform/byt/byt-board.c
@@ -7,6 +7,7 @@
 #include <linux/spi/spidev.h>
 #include <linux/spi/spi.h>
 #include <linux/spi/pxa2xx_spi.h>
+#include <linux/pwm.h>
 
 static bool disable = 0;
 module_param(disable, bool, 0);
@@ -28,7 +29,7 @@ static struct spi_board_info byt_spi_slaves[] = {
 	}
 };
 
-static int byt_spi_board_setup()
+static int byt_spi_board_setup(void)
 {
 	int ret = -1;
 
@@ -40,7 +41,7 @@ static int byt_spi_board_setup()
 	return ret;
 }
 
-static int byt_clk_setup()
+static int byt_clk_setup(void)
 {
 	struct clk *clk;
 
@@ -67,7 +68,15 @@ static int byt_clk_setup()
 
 	/* register the clock for DW DMA engines */
 	clk_register_clkdev(clk, "hclk", "0000:00:18.0");
-	clk_register_clkdev(clk, "hclk", "0000:00:1e.0"); 
+	clk_register_clkdev(clk, "hclk", "0000:00:1e.0");
+
+	/* Make clock tree required by the PWM driver */
+	clk = clk_register_fixed_rate(NULL, "pwm_clk", "lpss_clk", 0, 25000000);
+	if (IS_ERR(clk))
+		return PTR_ERR(clk);
+
+	clk_register_clkdev(clk, NULL, "0000:00:1e.1");
+	clk_register_clkdev(clk, NULL, "0000:00:1e.2");
 
 	return 0;
 }
-- 
1.7.9.5

