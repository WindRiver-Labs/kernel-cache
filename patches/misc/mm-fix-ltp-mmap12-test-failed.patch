From 8bc12144b34ff0a001ffe796800d8e6a7ee8cdb4 Mon Sep 17 00:00:00 2001
From: Jibin Xu <jibin.xu@windriver.com>
Date: Fri, 8 Dec 2017 16:05:31 +0800
Subject: [PATCH] mm : fix ltp mmap12 test failed

a patch from upstream to larger stack guard gap between vmas,
but introduced ltp mmap12 test failed issue.
the upstream commit is 1be7107fbe18eed3e319a6c3e83c78254b693acb.
so fix it here.

Signed-off-by: Jibin Xu <jibin.xu@windriver.com>
---
 mm/memory.c |    3 ---
 1 files changed, 0 insertions(+), 3 deletions(-)

diff --git a/mm/memory.c b/mm/memory.c
index e6de9fb..d65bb94 100644
--- a/mm/memory.c
+++ b/mm/memory.c
@@ -1813,9 +1813,6 @@ long __get_user_pages(struct task_struct *tsk, struct mm_struct *mm,
 				int ret;
 				unsigned int fault_flags = 0;
 
-				/* mlock all present pages, but do not fault in new pages */
-				if (foll_flags & FOLL_MLOCK)
-					return -ENOENT;
 				if (foll_flags & FOLL_WRITE)
 					fault_flags |= FAULT_FLAG_WRITE;
 				if (nonblocking)
-- 
1.7.5.4

