From cf643153ab8e6bf7cc9f53114f7e59dd136018e5 Mon Sep 17 00:00:00 2001
From: Liming Wang <liming.wang@windriver.com>
Date: Mon, 24 Mar 2014 18:19:48 +0800
Subject: [PATCH 071/628] mmc: xilinx_sdhcips: Migrate to clock controller

git://github.com/Xilinx/linux-xlnx.git xilinx-v14.7
commit 28581ed9 arm: zynq: Migrate to clock controller

cherry picked the sdhci driver modification.

Signed-off-by: Liming Wang <liming.wang@windriver.com>
---
 drivers/mmc/host/sdhci-of-xilinxps.c |   17 ++++-------------
 1 files changed, 4 insertions(+), 13 deletions(-)

diff --git a/drivers/mmc/host/sdhci-of-xilinxps.c b/drivers/mmc/host/sdhci-of-xilinxps.c
index f79e0db..4a4a9b0 100644
--- a/drivers/mmc/host/sdhci-of-xilinxps.c
+++ b/drivers/mmc/host/sdhci-of-xilinxps.c
@@ -143,7 +143,6 @@ static const struct dev_pm_ops xsdhcips_dev_pm_ops = {
 static int sdhci_zynq_probe(struct platform_device *pdev)
 {
 	int ret;
-	int irq = platform_get_irq(pdev, 0);
 	const void *prop;
 	struct device_node *np = pdev->dev.of_node;
 	struct sdhci_host *host;
@@ -156,24 +155,16 @@ static int sdhci_zynq_probe(struct platform_device *pdev)
 		return -ENOMEM;
 	}
 
-	if (irq == 56)
-		xsdhcips->aperclk = clk_get_sys("SDIO0_APER", NULL);
-	else
-		xsdhcips->aperclk = clk_get_sys("SDIO1_APER", NULL);
-
+	xsdhcips->aperclk = clk_get(&pdev->dev, "aper_clk");
 	if (IS_ERR(xsdhcips->aperclk)) {
-		dev_err(&pdev->dev, "APER clock not found.\n");
+		dev_err(&pdev->dev, "aper_clk clock not found.\n");
 		ret = PTR_ERR(xsdhcips->aperclk);
 		goto err_free;
 	}
 
-	if (irq == 56)
-		xsdhcips->devclk = clk_get_sys("SDIO0", NULL);
-	else
-		xsdhcips->devclk = clk_get_sys("SDIO1", NULL);
-
+	xsdhcips->devclk = clk_get(&pdev->dev, "ref_clk");
 	if (IS_ERR(xsdhcips->devclk)) {
-		dev_err(&pdev->dev, "Device clock not found.\n");
+		dev_err(&pdev->dev, "ref_clk clock not found.\n");
 		ret = PTR_ERR(xsdhcips->devclk);
 		goto clk_put_aper;
 	}
-- 
1.7.5.4

