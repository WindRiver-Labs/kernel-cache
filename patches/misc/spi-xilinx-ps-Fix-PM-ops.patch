From 79316ea1ea68494705c7fbfba4e3f4d11f6d7b7b Mon Sep 17 00:00:00 2001
From: Michal Simek <michal.simek@xilinx.com>
Date: Mon, 8 Jul 2013 15:50:08 +0200
Subject: [PATCH 255/628] spi: xilinx-ps: Fix PM ops

git://github.com/Xilinx/linux-xlnx.git xilinx-v14.7
commit 396e327afc32475550f2e06bbe11c1d0d319e545

Use SIMPLE_DEV_PM_OPS macro instead of ifdef mess.

Signed-off-by: Michal Simek <michal.simek@xilinx.com>
Signed-off-by: Liming Wang <liming.wang@windriver.com>
---
 drivers/spi/spi-xilinx-ps.c |   11 ++---------
 1 files changed, 2 insertions(+), 9 deletions(-)

diff --git a/drivers/spi/spi-xilinx-ps.c b/drivers/spi/spi-xilinx-ps.c
index 316e4c6..bbde74e 100644
--- a/drivers/spi/spi-xilinx-ps.c
+++ b/drivers/spi/spi-xilinx-ps.c
@@ -912,16 +912,9 @@ static int xspips_resume(struct device *dev)
 	dev_dbg(&pdev->dev, "resume succeeded\n");
 	return 0;
 }
-
-static const struct dev_pm_ops xspips_dev_pm_ops = {
-	SET_SYSTEM_SLEEP_PM_OPS(xspips_suspend, xspips_resume)
-};
-#define XSPIPS_PM	(&xspips_dev_pm_ops)
-
-#else /* ! CONFIG_PM_SLEEP */
-#define XSPIPS_PM	NULL
 #endif /* ! CONFIG_PM_SLEEP */
 
+static SIMPLE_DEV_PM_OPS(xspips_dev_pm_ops, xspips_suspend, xspips_resume);
 
 /* Work with hotplug and coldplug */
 MODULE_ALIAS("platform:" XSPIPS_NAME);
@@ -942,7 +935,7 @@ static struct platform_driver xspips_driver = {
 		.name = XSPIPS_NAME,
 		.owner = THIS_MODULE,
 		.of_match_table = xspips_of_match,
-		.pm = XSPIPS_PM,
+		.pm = &xspips_dev_pm_ops,
 	},
 };
 
-- 
1.7.5.4

