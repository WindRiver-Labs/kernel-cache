From bac19775308374d86aa341223c4b58d6e14c7afc Mon Sep 17 00:00:00 2001
From: Michal Simek <michal.simek@xilinx.com>
Date: Mon, 8 Jul 2013 15:48:23 +0200
Subject: [PATCH 254/628] spi: xilinx-ps: Do not free memory which is already
 freed

git://github.com/Xilinx/linux-xlnx.git xilinx-v14.7
commit 3b9ae1f76c17f3edf5739d99988d081dee036e5d

Fix spi unregistration.

Signed-off-by: Michal Simek <michal.simek@xilinx.com>
Signed-off-by: Liming Wang <liming.wang@windriver.com>
---
 drivers/spi/spi-xilinx-ps.c |    3 ---
 1 files changed, 0 insertions(+), 3 deletions(-)

diff --git a/drivers/spi/spi-xilinx-ps.c b/drivers/spi/spi-xilinx-ps.c
index be25e17..316e4c6 100644
--- a/drivers/spi/spi-xilinx-ps.c
+++ b/drivers/spi/spi-xilinx-ps.c
@@ -803,7 +803,6 @@ clk_put_aper:
 	clk_put(xspi->aperclk);
 remove_master:
 	spi_master_put(master);
-	kfree(master);
 	return ret;
 }
 
@@ -838,8 +837,6 @@ static int xspips_remove(struct platform_device *pdev)
 	clk_put(xspi->devclk);
 	clk_put(xspi->aperclk);
 
-	kfree(master);
-
 	dev_dbg(&pdev->dev, "remove succeeded\n");
 	return 0;
 
-- 
1.7.5.4

