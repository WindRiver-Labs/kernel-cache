From 17148da8fcc01bd4a8b84cd7019ad5b9879f0d53 Mon Sep 17 00:00:00 2001
From: Maxin John <maxin.john@gmail.com>
Date: Tue, 29 Mar 2011 00:15:55 +0300
Subject: [PATCH 1/2] MIPS: Enable kmemleak for MIPS

Signed-off-by: Maxin B. John <maxin.john@gmail.com>
To: Catalin Marinas <catalin.marinas@arm.com>
Cc: Daniel Baluta <dbaluta@ixiacom.com>
Cc: naveen yadav <yad.naveen@gmail.com>
Cc: linux-mips@linux-mips.org
Cc: linux-kernel@vger.kernel.org
Cc: linux-mm@kvack.org
Patchwork: https://patchwork.linux-mips.org/patch/2244/
Signed-off-by: Ralf Baechle <ralf@linux-mips.org>
Signed-off-by: Yong Zhang <yong.zhang@windriver.com>
---
 arch/mips/kernel/vmlinux.lds.S |    1 +
 lib/Kconfig.debug              |    2 +-
 2 files changed, 2 insertions(+), 1 deletions(-)

diff --git a/arch/mips/kernel/vmlinux.lds.S b/arch/mips/kernel/vmlinux.lds.S
index afb119f..9a8baab 100644
--- a/arch/mips/kernel/vmlinux.lds.S
+++ b/arch/mips/kernel/vmlinux.lds.S
@@ -63,6 +63,7 @@ SECTIONS
 	RODATA
 
 	/* writeable */
+	_sdata = .;				/* Start of data section */
 	.data : {	/* Data */
 		. = . + DATAOFFSET;		/* for CONFIG_MAPPED_KERNEL */
 		/*
diff --git a/lib/Kconfig.debug b/lib/Kconfig.debug
index 392bcab..24976a8 100644
--- a/lib/Kconfig.debug
+++ b/lib/Kconfig.debug
@@ -313,7 +313,7 @@ config SLUB_STATS
 
 config DEBUG_KMEMLEAK
 	bool "Kernel memory leak detector"
-	depends on DEBUG_KERNEL && EXPERIMENTAL && (X86 || ARM) && \
+	depends on DEBUG_KERNEL && EXPERIMENTAL && (X86 || ARM || MIPS) && \
 		!MEMORY_HOTPLUG
 	select DEBUG_SLAB if SLAB
 	select SLUB_DEBUG if SLUB
-- 
1.7.0.2

