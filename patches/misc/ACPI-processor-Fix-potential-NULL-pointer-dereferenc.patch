From e23aa73cb3c556b150d8ea457bfddc40896068ca Mon Sep 17 00:00:00 2001
From: Hanjun Guo <hanjun.guo@linaro.org>
Date: Fri, 31 May 2013 11:36:08 +0800
Subject: [PATCH 06/25] ACPI / processor: Fix potential NULL pointer
 dereference in acpi_processor_add()

commit 173a5a4c909789fcd57d00355d2237618a3824a4	upstream

In acpi_processor_add(), get_cpu_device() may return NULL in some cases
which is then passed to acpi_bind_one() and that will case a NULL
pointer dereference to occur.

Add a check to prevent that from happening.

[rjw: Changelog]
Signed-off-by: Hanjun Guo <hanjun.guo@linaro.org>
Signed-off-by: Rafael J. Wysocki <rafael.j.wysocki@intel.com>
Signed-off-by: Lans Zhang <jia.zhang@windriver.com>
---
 drivers/acpi/acpi_processor.c |    5 +++++
 1 files changed, 5 insertions(+), 0 deletions(-)

diff --git a/drivers/acpi/acpi_processor.c b/drivers/acpi/acpi_processor.c
index 157e738..e9b01e3 100644
--- a/drivers/acpi/acpi_processor.c
+++ b/drivers/acpi/acpi_processor.c
@@ -393,6 +393,11 @@ static int __cpuinit acpi_processor_add(struct acpi_device *device,
 	per_cpu(processors, pr->id) = pr;
 
 	dev = get_cpu_device(pr->id);
+	if (!dev) {
+		result = -ENODEV;
+		goto err;
+	}
+
 	result = acpi_bind_one(dev, pr->handle);
 	if (result)
 		goto err;
-- 
1.7.5.4

