From 031182ad9de92bbd17e3087c25efad7ebca753bf Mon Sep 17 00:00:00 2001
From: Yong Zhang <yong.zhang@windriver.com>
Date: Tue, 12 Nov 2013 14:49:13 +0800
Subject: [PATCH 2/2] kmemleak: build fix

There is no kmemcheck in this version, so remove the code
related to kmemcheck to make build pass.

Signed-off-by: Yong Zhang <yong.zhang@windriver.com>
---
 mm/kmemleak.c |    9 ---------
 1 files changed, 0 insertions(+), 9 deletions(-)

diff --git a/mm/kmemleak.c b/mm/kmemleak.c
index 5b069e4..d4d81cd 100644
--- a/mm/kmemleak.c
+++ b/mm/kmemleak.c
@@ -99,7 +99,6 @@
 #include <asm/processor.h>
 #include <asm/atomic.h>
 
-#include <linux/kmemcheck.h>
 #include <linux/kmemleak.h>
 
 /*
@@ -952,9 +951,6 @@ static bool update_checksum(struct kmemleak_object *object)
 {
 	u32 old_csum = object->checksum;
 
-	if (!kmemcheck_is_obj_initialized(object->pointer, object->size))
-		return false;
-
 	object->checksum = crc32(0, (void *)object->pointer, object->size);
 	return object->checksum != old_csum;
 }
@@ -1001,11 +997,6 @@ static void scan_block(void *_start, void *_end,
 		if (scan_should_stop())
 			break;
 
-		/* don't scan uninitialized memory */
-		if (!kmemcheck_is_obj_initialized((unsigned long)ptr,
-						  BYTES_PER_POINTER))
-			continue;
-
 		pointer = *ptr;
 
 		object = find_and_get_object(pointer, 1);
-- 
1.7.0.2

