From aa2d8d73adba23e753612d316f3235e8f595f1de Mon Sep 17 00:00:00 2001
From: Michal Simek <michal.simek@xilinx.com>
Date: Mon, 8 Jul 2013 10:42:04 +0200
Subject: [PATCH 261/628] spi: xilinx-qps: Do not free memory which is already
 freed

git://github.com/Xilinx/linux-xlnx.git xilinx-v14.7
commit d6760713484ad2321a6aec48fdb0e556a6331492

Fix spi unregistration. struct master is freed in
spi_master_release().

Reported-by: Davor Joja <davorjoja@logicbricks.com>
Signed-off-by: Michal Simek <michal.simek@xilinx.com>
Signed-off-by: Liming Wang <liming.wang@windriver.com>
---
 drivers/spi/spi-xilinx-qps.c |    3 ---
 1 files changed, 0 insertions(+), 3 deletions(-)

diff --git a/drivers/spi/spi-xilinx-qps.c b/drivers/spi/spi-xilinx-qps.c
index 9234068..8d97e0a 100644
--- a/drivers/spi/spi-xilinx-qps.c
+++ b/drivers/spi/spi-xilinx-qps.c
@@ -1164,7 +1164,6 @@ clk_put_aper:
 	clk_put(xqspi->aperclk);
 remove_master:
 	spi_master_put(master);
-	kfree(master);
 	return ret;
 }
 
@@ -1200,8 +1199,6 @@ static int xqspips_remove(struct platform_device *pdev)
 	clk_put(xqspi->devclk);
 	clk_put(xqspi->aperclk);
 
-	kfree(master);
-
 	dev_dbg(&pdev->dev, "remove succeeded\n");
 	return 0;
 }
-- 
1.7.5.4

