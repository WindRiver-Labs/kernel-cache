From d5a0a67ff3654ffcd0b195c8b7210667e6f7fd96 Mon Sep 17 00:00:00 2001
From: Corey Minyard <cminyard@mvista.com>
Date: Tue, 25 Mar 2014 11:39:05 -0500
Subject: [PATCH 2/2] Revert "kernel/fork.c: make dup_mm() static"

The original commit taken from: https://github.com/cminyard/linux-live-app-coredump.git.

This reverts commit ff252c1fc537b0c9e40f62da0a9d11bf0737b7db.

livedump requires dup_mm, so we need it back.

Signed-off-by: Corey Minyard <cminyard@mvista.com>
Signed-off-by: Jianchuan Wang <jianchuan.wang@windriver.com>
---
 include/linux/sched.h |    2 ++
 kernel/fork.c         |    2 +-
 2 files changed, 3 insertions(+), 1 deletions(-)

diff --git a/include/linux/sched.h b/include/linux/sched.h
index 6e4e764..b4c4793 100644
--- a/include/linux/sched.h
+++ b/include/linux/sched.h
@@ -2499,6 +2499,8 @@ extern struct mm_struct *get_task_mm(struct task_struct *task);
 extern struct mm_struct *mm_access(struct task_struct *task, unsigned int mode);
 /* Remove the current tasks stale references to the old mm_struct */
 extern void mm_release(struct task_struct *, struct mm_struct *);
+/* Allocate a new mm structure and copy contents from tsk->mm */
+extern struct mm_struct *dup_mm(struct task_struct *tsk);
 
 extern int copy_thread(unsigned long, unsigned long, unsigned long,
 			struct task_struct *);
diff --git a/kernel/fork.c b/kernel/fork.c
index 0988b25..25293e6 100644
--- a/kernel/fork.c
+++ b/kernel/fork.c
@@ -902,7 +902,7 @@ void mm_release(struct task_struct *tsk, struct mm_struct *mm)
  * Allocate a new mm structure and copy contents from the
  * mm structure of the passed in task structure.
  */
-static struct mm_struct *dup_mm(struct task_struct *tsk)
+struct mm_struct *dup_mm(struct task_struct *tsk)
 {
 	struct mm_struct *mm, *oldmm = current->mm;
 	int err;
-- 
1.7.5.4

