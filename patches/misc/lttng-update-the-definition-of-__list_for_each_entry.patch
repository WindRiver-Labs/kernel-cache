From 7f9888c608fca684fd080de927bc86f36660f65f Mon Sep 17 00:00:00 2001
From: Xufeng Zhang <xufeng.zhang@windriver.com>
Date: Wed, 23 Apr 2014 11:01:50 +0800
Subject: [PATCH 03/10] lttng: update the definition of __list_for_each_entry_rcu()

The previous __list_for_each_entry_rcu() function would introduce
a kernel warning, update the definition of this function based on
git://git.lttng.org/linux-2.6-lttng.git:
commit 802c8dcd97ed0eb6dfa6baffb8f6789e17cb6cf0

Signed-off-by: Xufeng Zhang <xufeng.zhang@windriver.com>
---
 include/linux/rculist.h |   10 +++++-----
 1 files changed, 5 insertions(+), 5 deletions(-)

diff --git a/include/linux/rculist.h b/include/linux/rculist.h
index a09807e..8ac201c 100644
--- a/include/linux/rculist.h
+++ b/include/linux/rculist.h
@@ -229,11 +229,6 @@ static inline void list_splice_init_rcu(struct list_head *list,
 		pos != (head); \
 		pos = rcu_dereference_raw(pos->next))
 
-#define __list_for_each_entry_rcu(pos, head, member) \
-	for (pos = list_entry(rcu_dereference((head)->next), typeof(*pos), member); \
-		&pos->member != (head); \
-		pos = list_entry(rcu_dereference(pos->member.next), typeof(*pos), member))
-
 /**
  * list_for_each_entry_rcu	-	iterate over rcu list of given type
  * @pos:	the type * to use as a loop cursor.
@@ -250,6 +245,11 @@ static inline void list_splice_init_rcu(struct list_head *list,
 		pos = list_entry_rcu(pos->member.next, typeof(*pos), member))
 
 
+#define __list_for_each_entry_rcu(pos, head, member) \
+	for (pos = list_entry_rcu((head)->next, typeof(*pos), member); \
+		&pos->member != (head); \
+		pos = list_entry_rcu(pos->member.next, typeof(*pos), member))
+
 /**
  * list_for_each_continue_rcu
  * @pos:	the &struct list_head to use as a loop cursor.
-- 
1.7.0

