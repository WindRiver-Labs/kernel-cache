From aa8adb235a14ffe849f2b8b0efbf94f6eb087f63 Mon Sep 17 00:00:00 2001
From: Li Zhou <li.zhou@windriver.com>
Date: Fri, 4 Jan 2019 15:46:19 +0800
Subject: [PATCH] ptrace/net: Remove several warnings for building

Remove below 3 warnings for OVP7 kernel building:
.../kernel/ptrace.c:252:2: warning: ISO C90 forbids mixed declarations and code [-Wdeclaration-after-statement]
.../kernel/ptrace.c:235:6: warning: unused variable 'dumpable' [-Wunused-variable]
.../net/core/sysctl_net_core.c:26:12: warning: 'one' defined but not used [-Wunused-variable]

Fixes: 91d478334a4a ("mm: Add a user_ns owner to mm_struct and fix
ptrace permission checks") for the 1st and 2nd warning.
Fixes: a1d55b36de6b ("net: sysctl_net_core: check SNDBUF and RCVBUF
for min length") for the 3rd warning.

Signed-off-by: Li Zhou <li.zhou@windriver.com>
---
 kernel/ptrace.c            |    4 ++--
 net/core/sysctl_net_core.c |    1 -
 2 files changed, 2 insertions(+), 3 deletions(-)

diff --git a/kernel/ptrace.c b/kernel/ptrace.c
index 27367aa..8505c97 100644
--- a/kernel/ptrace.c
+++ b/kernel/ptrace.c
@@ -232,7 +232,7 @@ static int ptrace_has_cap(struct user_namespace *ns, unsigned int mode)
 static int __ptrace_may_access(struct task_struct *task, unsigned int mode)
 {
 	const struct cred *cred = current_cred(), *tcred;
-	int dumpable = 0;
+	struct mm_struct *mm;
 	kuid_t caller_uid;
 	kgid_t caller_gid;
 
@@ -249,7 +249,7 @@ static int __ptrace_may_access(struct task_struct *task, unsigned int mode)
 	 * because setting up the necessary parent/child relationship
 	 * or halting the specified task is impossible.
 	 */
-	struct mm_struct *mm;
+
 	/* Don't let security modules deny introspection */
 	if (same_thread_group(task, current))
 		return 0;
diff --git a/net/core/sysctl_net_core.c b/net/core/sysctl_net_core.c
index fc44b99..a46f1b8 100644
--- a/net/core/sysctl_net_core.c
+++ b/net/core/sysctl_net_core.c
@@ -23,7 +23,6 @@
 #include <net/pkt_sched.h>
 
 static int zero = 0;
-static int one = 1;
 static int ushort_max = USHRT_MAX;
 static int min_sndbuf = SOCK_MIN_SNDBUF;
 static int min_rcvbuf = SOCK_MIN_RCVBUF;
-- 
1.7.9.5

