From 220ac112d0352287db7f84d4dadc3afe4511c001 Mon Sep 17 00:00:00 2001
From: Subbaraya Sundeep Bhatta <subbaraya.sundeep.bhatta@xilinx.com>
Date: Mon, 23 Sep 2013 21:20:45 +0530
Subject: [PATCH 555/628] usb: gadget: Use usb_endpoint_descriptor from usb_ep

git://github.com/Xilinx/linux-xlnx.git xilinx-v14.7
commit e89e5669046f47e3a746655a5a7dfa0475331774

Used usb_endpoint_descriptor from usb_ep for endpoint
enable/disable status

Signed-off-by: Subbaraya Sundeep Bhatta <sbhatta@xilinx.com>
Signed-off-by: Michal Simek <michal.simek@xilinx.com>
Signed-off-by: Liming Wang <liming.wang@windriver.com>
---
 drivers/usb/gadget/xilinx_udc.c |    2 ++
 1 files changed, 2 insertions(+), 0 deletions(-)

diff --git a/drivers/usb/gadget/xilinx_udc.c b/drivers/usb/gadget/xilinx_udc.c
index 7955664..b2be6d5 100644
--- a/drivers/usb/gadget/xilinx_udc.c
+++ b/drivers/usb/gadget/xilinx_udc.c
@@ -875,6 +875,7 @@ static int xusb_ep_enable(struct usb_ep *_ep,
 	ep->epnumber = (desc->bEndpointAddress & 0x0f);
 	ep->stopped = 0;
 	ep->desc = desc;
+	ep->ep.desc = desc;
 	tmp = desc->bmAttributes & USB_ENDPOINT_XFERTYPE_MASK;
 	spin_lock_irqsave(&ep->udc->lock, flags);
 	ep->ep.maxpacket = le16_to_cpu(desc->wMaxPacketSize);
@@ -982,6 +983,7 @@ static int xusb_ep_disable(struct usb_ep *_ep)
 	 * Restore the endpoint's pristine config
 	 */
 	ep->desc = NULL;
+	ep->ep.desc = NULL;
 
 	ep->stopped = 1;
 
-- 
1.7.5.4

