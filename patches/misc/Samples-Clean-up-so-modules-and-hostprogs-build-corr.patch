From 07e788e6581f67f490aa4828d60a1d7de5ff6011 Mon Sep 17 00:00:00 2001
From: Yang Shi <yang.shi@windriver.com>
Date: Tue, 10 Sep 2013 18:54:40 -0700
Subject: [PATCH 2/2] Samples: Clean up so modules and hostprogs build
 correctly

Add the samples directory to the core so that modules will
build.

Only build hostprogs if not cross compiling.  Otherwise the
resulting executables would be pretty much useless.

Signed-off-by: Jim Somerville <Jim.Somerville@windriver.com>
[Uprev to apply to 3.10]
Signed-off-by: Yang Shi <yang.shi@windriver.com>
[Uprev to apply to 3.14]
Signed-off-by: He Zhe <zhe.he@windriver.com>
---
 Makefile                 | 5 +----
 samples/hidraw/Makefile  | 2 ++
 samples/seccomp/Makefile | 2 ++
 3 files changed, 5 insertions(+), 4 deletions(-)

diff --git a/Makefile b/Makefile
index 580e790..afc3e38 100644
--- a/Makefile
+++ b/Makefile
@@ -781,7 +781,7 @@ export mod_sign_cmd
 
 
 ifeq ($(KBUILD_EXTMOD),)
-core-y		+= kernel/ mm/ fs/ ipc/ security/ crypto/ block/
+core-y		+= kernel/ mm/ fs/ ipc/ security/ crypto/ block/ samples/
 
 vmlinux-dirs	:= $(patsubst %/,%,$(filter %/, $(init-y) $(init-m) \
 		     $(core-y) $(core-m) $(drivers-y) $(drivers-m) \
@@ -820,9 +820,6 @@ vmlinux: scripts/link-vmlinux.sh $(vmlinux-deps) FORCE
 ifdef CONFIG_HEADERS_CHECK
 	$(Q)$(MAKE) -f $(srctree)/Makefile headers_check
 endif
-ifdef CONFIG_SAMPLES
-	$(Q)$(MAKE) $(build)=samples
-endif
 ifdef CONFIG_BUILD_DOCSRC
 	$(Q)$(MAKE) $(build)=Documentation
 endif
diff --git a/samples/hidraw/Makefile b/samples/hidraw/Makefile
index 1e6aabc..583afd5 100644
--- a/samples/hidraw/Makefile
+++ b/samples/hidraw/Makefile
@@ -4,7 +4,9 @@ obj- := dummy.o
 # List of programs to build
 hostprogs-y := hid-example
 
+ifeq ($(CROSS_COMPILE),)
 # Tell kbuild to always build the programs
 always := $(hostprogs-y)
+endif
 
 HOSTCFLAGS_hid-example.o += -I$(srctree)/usr/include
diff --git a/samples/seccomp/Makefile b/samples/seccomp/Makefile
index 64648e4..cf810c3 100644
--- a/samples/seccomp/Makefile
+++ b/samples/seccomp/Makefile
@@ -38,5 +38,7 @@ HOSTLOADLIBES_dropper += $(MFLAG)
 endif
 endif
 
+ifeq ($(CROSS_COMPILE),)
 # Tell kbuild to always build the programs
 always := $(hostprogs-y)
+endif
-- 
2.0.2

