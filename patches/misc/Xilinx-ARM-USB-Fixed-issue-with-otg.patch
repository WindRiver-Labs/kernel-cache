From ae355c2bc8e651d7e1b70aeae54422d0fc530b3c Mon Sep 17 00:00:00 2001
From: Naveen Mamindlapalli <naveenm@xilinx.com>
Date: Tue, 1 May 2012 14:51:28 +0530
Subject: [PATCH 472/628] Xilinx: ARM: USB: Fixed issue with otg.

git://github.com/Xilinx/linux-xlnx.git xilinx-v14.7
commit 873e5c28e6b83205da1302aba410cd28089e1979

Fixed a minor issue with otg.

Signed-off-by: Liming Wang <liming.wang@windriver.com>
---
 drivers/usb/gadget/xilinx_usbps_udc.c |    3 ++-
 1 files changed, 2 insertions(+), 1 deletions(-)

diff --git a/drivers/usb/gadget/xilinx_usbps_udc.c b/drivers/usb/gadget/xilinx_usbps_udc.c
index becd05b..b57ce10 100755
--- a/drivers/usb/gadget/xilinx_usbps_udc.c
+++ b/drivers/usb/gadget/xilinx_usbps_udc.c
@@ -1986,9 +1986,10 @@ int xusbps_stop(struct usb_gadget_driver *driver)
 	/* report disconnect; the controller is already quiesced */
 	driver->disconnect(&udc_controller->gadget);
 
+#ifdef CONFIG_USB_XUSBPS_OTG
 	udc_controller->xotg->start_peripheral = NULL;
 	udc_controller->xotg->stop_peripheral = NULL;
-
+#endif
 	/* unbind gadget and unhook driver. */
 	driver->unbind(&udc_controller->gadget);
 	udc_controller->gadget.dev.driver = NULL;
-- 
1.7.5.4

