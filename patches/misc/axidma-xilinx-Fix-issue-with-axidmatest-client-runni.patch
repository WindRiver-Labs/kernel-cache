From 88bb68e655397d000d20119f0109fb32668cd1db Mon Sep 17 00:00:00 2001
From: Srikanth Thokala <srikanth.thokala@xilinx.com>
Date: Wed, 18 Sep 2013 17:27:32 +0530
Subject: [PATCH 123/628] axidma: xilinx: Fix issue with axidmatest client
 running as module

git://github.com/Xilinx/linux-xlnx.git xilinx-v14.7
commit 80434c07d098d3595713dfb5417b197df37bb4d3

Loopback test needs some of the APP words of DMA configured
and this logic is under flag TEST_DMA_WITH_LOOPBACK. So this
flag has to be enabled when running axidmatest client. This
patch fixes issue with axidmatest client running as module.

Signed-off-by: Srikanth Thokala <sthokal@xilinx.com>
Signed-off-by: Michal Simek <michal.simek@xilinx.com>
Signed-off-by: Liming Wang <liming.wang@windriver.com>
---
 drivers/dma/xilinx/xilinx_axidma.c |    4 ++--
 1 files changed, 2 insertions(+), 2 deletions(-)

diff --git a/drivers/dma/xilinx/xilinx_axidma.c b/drivers/dma/xilinx/xilinx_axidma.c
index ca0b0e2..ac6ba6e 100644
--- a/drivers/dma/xilinx/xilinx_axidma.c
+++ b/drivers/dma/xilinx/xilinx_axidma.c
@@ -113,8 +113,8 @@
 #define dma_write(addr, val)	(iowrite32(val, addr))
 #define dma_read(addr)		(ioread32(addr))
 
-#ifdef CONFIG_XILINX_DMATEST
-#define TEST_DMA_WITH_LOOPBACK
+#if defined(CONFIG_XILINX_DMATEST) || defined(CONFIG_XILINX_DMATEST_MODULE)
+# define TEST_DMA_WITH_LOOPBACK
 #endif
 
 /* Hardware descriptor */
-- 
1.7.5.4

