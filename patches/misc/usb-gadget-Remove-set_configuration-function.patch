From 5f3b5d1af76aa3732a16ac6dd3257542501107cc Mon Sep 17 00:00:00 2001
From: Subbaraya Sundeep Bhatta <subbaraya.sundeep.bhatta@xilinx.com>
Date: Mon, 23 Sep 2013 21:20:47 +0530
Subject: [PATCH 557/628] usb: gadget: Remove set_configuration function.

git://github.com/Xilinx/linux-xlnx.git xilinx-v14.7
commit ae2922bbe409d3b0c86e168438c68b958702ed78

Use status in xusb_udc to indicate configuration is set
and return SET_CONFIGURATION request to gadget layer.

Signed-off-by: Subbaraya Sundeep Bhatta <sbhatta@xilinx.com>
Signed-off-by: Michal Simek <michal.simek@xilinx.com>
Signed-off-by: Liming Wang <liming.wang@windriver.com>
---
 drivers/usb/gadget/xilinx_udc.c |   42 +--------------------------------------
 1 files changed, 1 insertions(+), 41 deletions(-)

diff --git a/drivers/usb/gadget/xilinx_udc.c b/drivers/usb/gadget/xilinx_udc.c
index fd4c458..aca89ca 100644
--- a/drivers/usb/gadget/xilinx_udc.c
+++ b/drivers/usb/gadget/xilinx_udc.c
@@ -1599,46 +1599,6 @@ static void startup_intrhandler(void *callbackref, u32 intrstatus)
 	}
 }
 
-
-/**
- * set_configuration() - Sets the device configuration.
- * @udc:		Pointer to the usb device controller structure.
- *
- *	Processes the SET_CONFIGURATION command recieved during enumeration.
- **/
-static void set_configuration(struct xusb_udc *udc)
-{
-	u32 epcfgreg;
-
-	switch (ch9_cmdbuf.setup.wValue) {
-	case 0:
-		/*
-		 * This configuration value resets the device to the
-		 * un configured state like power up.
-		 */
-		udc->status = 0;
-		/* Cause a valid status phase to be issued.*/
-		setup_ctrl_wr_status_stage(udc);
-
-		break;
-	case CONFIGURATION_ONE:
-		udc->status = 1;
-		setup_ctrl_wr_status_stage(udc);
-		break;
-
-		/* Additional configurations can be added here.*/
-	default:
-		/* Stall the end point.*/
-		epcfgreg = (udc->read_fn(udc->base_address +
-				udc->ep[XUSB_EP_NUMBER_ZERO].endpointoffset)|
-				XUSB_EP_CFG_STALL_MASK);
-
-		udc->write_fn(epcfgreg, (udc->base_address +
-			udc->ep[XUSB_EP_NUMBER_ZERO].endpointoffset));
-		break;
-	}
-}
-
 /**
  * setclearfeature() - Executes the set feature and clear feature commands.
  * @udc:		Pointer to the usb device controller structure.
@@ -1775,7 +1735,7 @@ static int execute_command(struct xusb_udc *udc)
 			break;
 
 		case USB_REQ_SET_CONFIGURATION:
-			set_configuration(udc);
+			udc->status = 1;
 			return ch9_cmdbuf.setup.bRequest;
 
 		default:
-- 
1.7.5.4

