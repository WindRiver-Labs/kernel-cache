From 7c4fe049557e32dd5b8a349625cecdfc3616a110 Mon Sep 17 00:00:00 2001
From: Naveen Mamindlapalli <naveenm@xhdrdevl6.(none)>
Date: Tue, 21 Feb 2012 12:38:55 +0530
Subject: [PATCH 470/628] Xilinx: ARM: USB: Removed the stream disable mode
 setting

git://github.com/Xilinx/linux-xlnx.git xilinx-v14.7
commit e1be1f01bd195f3a36531e7a01a26d82ec702849

Removed the stream disable mode setting in the driver to make
it work on Zynq silicon. The USB device controller was not
sending response to BULK IN requests that are part of same SCSI
read request of size more than 512 bytes.

This setting can be used in low bandwidth systems like PEEP but
irrespective of this setting, the driver works on PEEP also since
the TX FIFO setting is increased from 256 bytes to 512 bytes on
PEEP unlike on Zynq silicon which is 256 bytes only.

Signed-off-by: Liming Wang <liming.wang@windriver.com>
---
 drivers/usb/gadget/xilinx_usbps_udc.c |    1 -
 1 files changed, 0 insertions(+), 1 deletions(-)

diff --git a/drivers/usb/gadget/xilinx_usbps_udc.c b/drivers/usb/gadget/xilinx_usbps_udc.c
index 0c0df4d..32d8dd0 100755
--- a/drivers/usb/gadget/xilinx_usbps_udc.c
+++ b/drivers/usb/gadget/xilinx_usbps_udc.c
@@ -274,7 +274,6 @@ static void dr_controller_run(struct xusbps_udc *udc)
 	temp = xusbps_readl(&dr_regs->usbmode);
 	temp |= USB_MODE_CTRL_MODE_DEVICE;
 	temp |= USB_MODE_SETUP_LOCK_OFF;
-	temp |= USB_MODE_STREAM_DISABLE;
 	xusbps_writel(temp, &dr_regs->usbmode);
 
 	/* Set OTG Terminate bit */
-- 
1.7.5.4

