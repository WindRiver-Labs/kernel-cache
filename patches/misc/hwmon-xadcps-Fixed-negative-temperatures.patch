From 119004d0551b706ce1ccb443e757dd419aac52a0 Mon Sep 17 00:00:00 2001
From: Matthias Auchmann <m.auchmann@artech.at>
Date: Thu, 15 Aug 2013 16:00:01 +0200
Subject: [PATCH 198/628] hwmon: xadcps: Fixed negative temperatures

git://github.com/Xilinx/linux-xlnx.git xilinx-v14.7
commit 0dddc9e52e5efe923827377f79fa1911f26ea448

Changed uint to int so that negative temperatures work properly.

Signed-off-by: Matthias Auchmann <m.auchmann@artech.at>
Signed-off-by: Michal Simek <michal.simek@xilinx.com>
Signed-off-by: Liming Wang <liming.wang@windriver.com>
---
 drivers/hwmon/xilinx-xadcps.c |    6 +++---
 1 files changed, 3 insertions(+), 3 deletions(-)

diff --git a/drivers/hwmon/xilinx-xadcps.c b/drivers/hwmon/xilinx-xadcps.c
index 9ff73d6..1df8223 100644
--- a/drivers/hwmon/xilinx-xadcps.c
+++ b/drivers/hwmon/xilinx-xadcps.c
@@ -267,9 +267,9 @@ static inline void write_register(struct xadc_t *xadc, unsigned int reg,
 	kfree(b);
 }
 
-static inline unsigned reg2temp(u16 reg)
+static inline int reg2temp(u16 reg)
 {
-	unsigned val;
+	int val;
 
 	val = (reg >> 4) & 0xFFF; /* Use only 12 bits */
 	val = ((val * 503975) / 4096) - 273150; /* (X*503.975/4096) -273.15 */
@@ -324,7 +324,7 @@ static ssize_t xadc_read_temp(struct device *dev,
 
 	clk_disable(xadc->clk);
 
-	return sprintf(buf, "%u\n", reg2temp(regval));
+	return sprintf(buf, "%d\n", reg2temp(regval));
 }
 
 static ssize_t xadc_read_vcc(struct device *dev,
-- 
1.7.5.4

