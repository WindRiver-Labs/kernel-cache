From 439e02a8618bc63e1527293e8e6b1576ed81b444 Mon Sep 17 00:00:00 2001
From: Qi Hou <qi.hou@windriver.com>
Date: Thu, 26 May 2016 09:57:03 +0800
Subject: [PATCH] ftrace: references to ftrace_callsites wrapped by
 CONFIG_FTRACE_MCOUNT_RECORD

The declarations of num_ftrace_callsites and ftrace_callsites in structure
of module are wrapped by CONFIG_FTRACE_MCOUNT_RECORD,like below:

/* include/linux/module.h */
345 #ifdef CONFIG_FTRACE_MCOUNT_RECORD
346         unsigned int num_ftrace_callsites;
347         unsigned long *ftrace_callsites;
348 #endif

So, if they are referenced,they should also be wrapped by
CONFIG_FTRACE_MCOUNT_RECORD.

Signed-off-by: Qi Hou <qi.hou@windriver.com>
---
 kernel/trace/ftrace.c |    2 ++
 1 files changed, 2 insertions(+), 0 deletions(-)

diff --git a/kernel/trace/ftrace.c b/kernel/trace/ftrace.c
index eb11011..a56f907 100644
--- a/kernel/trace/ftrace.c
+++ b/kernel/trace/ftrace.c
@@ -4944,9 +4944,11 @@ static void ftrace_init_module(struct module *mod,
 
 void ftrace_module_init(struct module *mod)
 {
+#ifdef CONFIG_FTRACE_MCOUNT_RECORD
 	ftrace_init_module(mod, mod->ftrace_callsites,
 			   mod->ftrace_callsites +
 			   mod->num_ftrace_callsites);
+#endif
 }
 
 static int ftrace_module_notify_exit(struct notifier_block *self,
-- 
1.7.5.4

