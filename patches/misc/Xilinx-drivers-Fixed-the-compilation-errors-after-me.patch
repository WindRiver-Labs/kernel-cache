From f62f2388bb338d067d5e2bcc763ddb3d4a28a7c1 Mon Sep 17 00:00:00 2001
From: Madhubala Sharma <madhubala.sharma@xilinx.com>
Date: Wed, 7 Sep 2011 14:38:55 +0530
Subject: [PATCH 468/628] Xilinx: drivers: Fixed the compilation errors after
 merge with 2.6.39

git://github.com/Xilinx/linux-xlnx.git xilinx-v14.7
commit de90944502725968b1a3b6f693ad4ab04b577933

Incorporated the driver changes required for 2.6.39 kernel
used the platform_driver_register and unregister functions
SPIN_LOCK_UNLOCKED replaced with __SPIN_LOCK_UNLOCKED

Signed-off-by: Madhubala Sharma <madhubala.sharma@xilinx.com>
Signed-off-by: Liming Wang <liming.wang@windriver.com>
---
 drivers/usb/gadget/xilinx_udc.c |    4 ++--
 1 files changed, 2 insertions(+), 2 deletions(-)
 mode change 100755 => 100644 drivers/usb/gadget/xilinx_udc.c

diff --git a/drivers/usb/gadget/xilinx_udc.c b/drivers/usb/gadget/xilinx_udc.c
old mode 100755
new mode 100644
index bd3a116..b551923
--- a/drivers/usb/gadget/xilinx_udc.c
+++ b/drivers/usb/gadget/xilinx_udc.c
@@ -2427,7 +2427,7 @@ static struct of_platform_driver usb_of_driver = {
  **/
 static int __init udc_init(void)
 {
-	return of_register_platform_driver(&usb_of_driver);
+	return platform_driver_register(&usb_of_driver);
 }
 
 /**
@@ -2438,7 +2438,7 @@ static int __init udc_init(void)
  **/
 static void __devexit udc_exit(void)
 {
-	of_unregister_platform_driver(&usb_of_driver);
+	platform_driver_unregister(&usb_of_driver);
 }
 
 module_init(udc_init);
-- 
1.7.5.4

