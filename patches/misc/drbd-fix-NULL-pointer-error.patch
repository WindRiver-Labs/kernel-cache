From a111f64fa2445d45fa15aa5083de78062f07cb15 Mon Sep 17 00:00:00 2001
From: Li Wang <li.wang@windriver.com>
Date: Tue, 30 Jul 2013 11:58:56 +0800
Subject: [PATCH] drbd: fix NULL pointer error

When use module with drbd driver, use error module define:
replace CONFIG_MODULES with MODULE.

In face, rework previous fix pactch for compile waning:
drbd: compile warning: comparison will always evaluate as 'true'
the patch come from commit bc4854bc (drbd: check MODULE for THIS_MODULE),
but missing some part of code content.

Signed-off-by: Li Wang <li.wang@windriver.com>
---
 drivers/block/drbd/drbd_main.c |    2 +-
 1 files changed, 1 insertions(+), 1 deletions(-)

diff --git a/drivers/block/drbd/drbd_main.c b/drivers/block/drbd/drbd_main.c
index 36a51ac..96c432f 100644
--- a/drivers/block/drbd/drbd_main.c
+++ b/drivers/block/drbd/drbd_main.c
@@ -4183,7 +4183,7 @@ const char *drbd_buildtag(void)
 	static char buildtag[38] = "\0uilt-in";
 
 	if (buildtag[0] == 0) {
-#ifdef CONFIG_MODULES
+#ifdef MODULE
 		sprintf(buildtag, "srcversion: %-24s", THIS_MODULE->srcversion);
 #else
 		buildtag[0] = 'b';
-- 
1.7.5.4

