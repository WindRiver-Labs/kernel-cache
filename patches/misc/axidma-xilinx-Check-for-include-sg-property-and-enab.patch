From f30fc865ec9b1cefda0f6496919cf8290ab0206c Mon Sep 17 00:00:00 2001
From: Srikanth Thokala <srikanth.thokala@xilinx.com>
Date: Wed, 18 Sep 2013 17:27:30 +0530
Subject: [PATCH 121/628] axidma: xilinx: Check for include-sg property and
 enable SG feature

git://github.com/Xilinx/linux-xlnx.git xilinx-v14.7
commit fe618d7079fd01402c0197e999d577ffa311b28c

In some cases, DMA can be configured in SG mode with status and control
streams not connected. For example, Vivado loopback hardware design
has these streams unconnected and configured for SG Mode. This commit
fixes this issue by checking 'xlnx,include-sg' dt property and enable
the SG feature (making independent of 'xlnx,sg-include-stscntrl-strm').

Signed-off-by: Srikanth Thokala <sthokal@xilinx.com>
Signed-off-by: Michal Simek <michal.simek@xilinx.com>
Signed-off-by: Liming Wang <liming.wang@windriver.com>
---
 drivers/dma/xilinx/xilinx_axidma.c |    8 ++++++--
 1 files changed, 6 insertions(+), 2 deletions(-)

diff --git a/drivers/dma/xilinx/xilinx_axidma.c b/drivers/dma/xilinx/xilinx_axidma.c
index 9ed7083..8a4c3d2 100644
--- a/drivers/dma/xilinx/xilinx_axidma.c
+++ b/drivers/dma/xilinx/xilinx_axidma.c
@@ -1080,11 +1080,15 @@ static int xilinx_dma_of_probe(struct platform_device *pdev)
 	}
 
 	/* Check if SG is enabled */
+	value = of_property_read_bool(node, "xlnx,include-sg");
+	if (value)
+		xdev->feature |= XILINX_DMA_FTR_HAS_SG;
+
+	/* Check if status control streams are enabled */
 	value = of_property_read_bool(node,
 			"xlnx,sg-include-stscntrl-strm");
 	if (value)
-		xdev->feature |= (XILINX_DMA_FTR_STSCNTRL_STRM |
-						XILINX_DMA_FTR_HAS_SG);
+		xdev->feature |= XILINX_DMA_FTR_STSCNTRL_STRM;
 
 	/*
 	 * Axi DMA only do slave transfers
-- 
1.7.5.4

