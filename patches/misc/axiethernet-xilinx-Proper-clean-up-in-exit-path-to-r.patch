From 049f86b5a4e03de3f93a66182505bee2c27c34ad Mon Sep 17 00:00:00 2001
From: Srikanth Thokala <srikanth.thokala@xilinx.com>
Date: Tue, 24 Sep 2013 20:00:53 +0530
Subject: [PATCH 458/628] axiethernet: xilinx: Proper clean up in exit path to
 run as module

git://github.com/Xilinx/linux-xlnx.git xilinx-v2013.4
commit 0448a50adbaec343e939b6afb765d276268bb6f5

Running driver as module ends up in kernel panic.  This
patch does proper clean up in exit path to fix this issue.

Signed-off-by: Srikanth Thokala <sthokal@xilinx.com>
Signed-off-by: Michal Simek <michal.simek@xilinx.com>
Signed-off-by: Liming Wang <liming.wang@windriver.com>
---
 drivers/net/ethernet/xilinx/xilinx_axienet_mdio.c |    1 -
 1 files changed, 0 insertions(+), 1 deletions(-)

diff --git a/drivers/net/ethernet/xilinx/xilinx_axienet_mdio.c b/drivers/net/ethernet/xilinx/xilinx_axienet_mdio.c
index a53baf9..898d969 100644
--- a/drivers/net/ethernet/xilinx/xilinx_axienet_mdio.c
+++ b/drivers/net/ethernet/xilinx/xilinx_axienet_mdio.c
@@ -240,7 +240,6 @@ int axienet_mdio_setup(struct axienet_local *lp, struct device_node *np)
 void axienet_mdio_teardown(struct axienet_local *lp)
 {
 	mdiobus_unregister(lp->mii_bus);
-	kfree(lp->mii_bus->irq);
 	mdiobus_free(lp->mii_bus);
 	lp->mii_bus = NULL;
 }
-- 
1.7.5.4

