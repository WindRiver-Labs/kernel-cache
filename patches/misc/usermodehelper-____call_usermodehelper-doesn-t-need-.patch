From a7a90ae15e0ae9f0739c2bc9b9805be02239c7ad Mon Sep 17 00:00:00 2001
From: Li Wang <li.wang@windriver.com>
Date: Wed, 23 Apr 2014 18:33:02 +0800
Subject: [PATCH 3/6] usermodehelper: ____call_usermodehelper() doesn't need do_exit()

upstream 5b9bd473e3b8a8c6c4ae99be475e6e9b27568555 commit

the CVE patch is found in:
http://web.nvd.nist.gov/view/vuln/detail?vulnId=CVE-2012-4398
https://bugzilla.redhat.com/show_bug.cgi?id=853474
Upstream fixes:
(5) 5b9bd473 "usermodehelper: ____call_usermodehelper() doesn't need do_exit()"

Minor cleanup.  ____call_usermodehelper() can simply return, no need to
call do_exit() explicitely.

Signed-off-by: Oleg Nesterov <oleg@redhat.com>
Cc: Tetsuo Handa <penguin-kernel@I-love.SAKURA.ne.jp>
Cc: Rusty Russell <rusty@rustcorp.com.au>
Cc: Tejun Heo <tj@kernel.org>
Cc: David Rientjes <rientjes@google.com>
Signed-off-by: Andrew Morton <akpm@linux-foundation.org>
Signed-off-by: Linus Torvalds <torvalds@linux-foundation.org>
Signed-off-by: Li Wang <li.wang@windriver.com>
---
 kernel/kmod.c |    2 +-
 1 files changed, 1 insertions(+), 1 deletions(-)

diff --git a/kernel/kmod.c b/kernel/kmod.c
index 6562447..d0cc9a9 100644
--- a/kernel/kmod.c
+++ b/kernel/kmod.c
@@ -197,7 +197,7 @@ static int ____call_usermodehelper(void *data)
 
 	/* Exec failed? */
 	sub_info->retval = retval;
-	do_exit(0);
+	return 0;
 }
 
 static int call_helper(void *data)
-- 
1.7.0

