From 860e5bcf1a4a19f4a8d619951b8d73385ed0f13d Mon Sep 17 00:00:00 2001
From: Srikanth Thokala <srikanth.thokala@xilinx.com>
Date: Wed, 18 Sep 2013 17:27:25 +0530
Subject: [PATCH 116/628] axidma: xilinx: Replace custom my_log() function
 with fls()

git://github.com/Xilinx/linux-xlnx.git xilinx-v14.7
commit a866aab280d2a464a5911e65f8249088315b7ad7

Replace custom my_log() function with fls()

Signed-off-by: Srikanth Thokala <sthokal@xilinx.com>
Signed-off-by: Michal Simek <michal.simek@xilinx.com>
Signed-off-by: Liming Wang <liming.wang@windriver.com>
---
 drivers/dma/xilinx/xilinx_axidma.c |   20 +-------------------
 1 files changed, 1 insertions(+), 19 deletions(-)

diff --git a/drivers/dma/xilinx/xilinx_axidma.c b/drivers/dma/xilinx/xilinx_axidma.c
index e97ec06..11151c3 100644
--- a/drivers/dma/xilinx/xilinx_axidma.c
+++ b/drivers/dma/xilinx/xilinx_axidma.c
@@ -926,24 +926,6 @@ static int xilinx_dma_device_control(struct dma_chan *dchan,
 		return -ENXIO;
 }
 
-/*
- * Logarithm function to compute alignment shift
- *
- * Only deals with value less than 4096.
- */
-static int my_log(int value)
-{
-	int i = 0;
-	while ((1 << i) < value) {
-		i++;
-
-		if (i >= 12)
-			return 0;
-	}
-
-	return i;
-}
-
 static void xilinx_dma_free_channels(struct xilinx_dma_device *xdev)
 {
 	int i;
@@ -1032,7 +1014,7 @@ static int xilinx_dma_chan_probe(struct xilinx_dma_device *xdev,
 	chan->common.private = (void *)&(chan->private);
 
 	if (!chan->has_dre)
-		xdev->common.copy_align = my_log(width);
+		xdev->common.copy_align = fls(width - 1);
 
 	chan->dev = xdev->dev;
 	xdev->chan[chan->id] = chan;
-- 
1.7.5.4

