From d9efc7a3e6d0e28a45d386b822489cd8399265cb Mon Sep 17 00:00:00 2001
From: Hui Zhu <hui.zhu@windriver.com>
Date: Tue, 30 Jun 2009 16:22:38 +0800
Subject: [PATCH] Fix the multithread program core thread message error.

The thread message of core file is generated in
elf_dump_thread_status.  The register values is set by
elf_core_copy_task_regs in this function.
static inline int elf_core_copy_task_regs(struct task_struct *t,
					   elf_gregset_t* elfregs)
{

	return ELF_CORE_COPY_TASK_REGS(t, elfregs);
	return 0;
}
If a arch doesn't define ELF_CORE_COPY_TASK_REGS, This function will do
nothing.  Then the core file will not have the register message of
thread.
So add elf_core_copy_regs to set regiser values if
ELF_CORE_COPY_TASK_REGS doesn't define.

Signed-off-by: Hui Zhu <hui.zhu@windriver.com>
---
 include/linux/elfcore.h |    2 ++
 1 files changed, 2 insertions(+), 0 deletions(-)

diff --git a/include/linux/elfcore.h b/include/linux/elfcore.h
index 5ca54d7..cf3e1e9 100644
--- a/include/linux/elfcore.h
+++ b/include/linux/elfcore.h
@@ -116,6 +116,8 @@ static inline int elf_core_copy_task_regs(struct task_struct *t, elf_gregset_t*
 #ifdef ELF_CORE_COPY_TASK_REGS
 	
 	return ELF_CORE_COPY_TASK_REGS(t, elfregs);
+#else
+	elf_core_copy_regs(elfregs, task_pt_regs(t));
 #endif
 	return 0;
 }
-- 
1.6.3.3

