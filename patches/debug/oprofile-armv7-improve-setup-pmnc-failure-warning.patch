From 8f82a498db5fa6b13ffc18f6d33b88aebdc2f45d Mon Sep 17 00:00:00 2001
From: Hui Wang <Hui.Wang@windriver.com>
Date: Wed, 5 Jan 2011 17:42:26 +0800
Subject: [PATCH 2/2] oprofile/armv7: improve setup pmnc failure warning

When some function tracers(i.e. IRQSOFF_TRACER, PREEMPT_TRACER and
FUNCTION_TRACER) are active, they will keep the PMU enabled. Under
this condition, if we startup oprofile, it will fail and print out a
warning. The warning is a little bit simple to users, now improve it
to make the warning can tell users how to handle this situation.

Signed-off-by: Hui Wang <Hui.Wang@windriver.com>
---
 arch/arm/oprofile/op_model_v7.c |    6 ++++--
 1 files changed, 4 insertions(+), 2 deletions(-)

diff --git a/arch/arm/oprofile/op_model_v7.c b/arch/arm/oprofile/op_model_v7.c
index 8642d08..6971bc9 100644
--- a/arch/arm/oprofile/op_model_v7.c
+++ b/arch/arm/oprofile/op_model_v7.c
@@ -189,8 +189,10 @@ int armv7_setup_pmnc(void)
 	unsigned int cnt;
 
 	if (armv7_pmnc_read() & PMNC_E) {
-		printk(KERN_ERR "oprofile: CPU%u PMNC still enabled when setup"
-			" new event counter.\n", smp_processor_id());
+		printk(KERN_ERR "oprofile: CPU%u PMNC is already enabled and "
+		        "can't be setup. Check active function tracers and "
+			"disable them by echo 0 > $(DEBUGFS_MOUNT_PATH)/"
+			"tracing/tracing_enabled.\n", smp_processor_id());
 		return -EBUSY;
 	}
 
-- 
1.6.5.2

