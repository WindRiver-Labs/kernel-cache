From 70b17b4e840925b9affb09befe09398538217739 Mon Sep 17 00:00:00 2001
From: Paul Gortmaker <paul.gortmaker@windriver.com>
Date: Sun, 25 Jan 2009 17:58:09 -0500
Subject: [PATCH] modpost: mask trivial warnings

Newer HOSTCC will complain about various stdio fcns because
they are now declared with "warn_unused_return", or because
some initializers aren't filled out with values -- trivially
assign values so we aren't overwhelmed with these warnings
once the kernel build kicks off.

Signed-off-by: Paul Gortmaker <paul.gortmaker@windriver.com>
---
 scripts/mod/modpost.c |   14 ++++++++------
 1 files changed, 8 insertions(+), 6 deletions(-)

diff --git a/scripts/mod/modpost.c b/scripts/mod/modpost.c
index 8e0de6a..5b2d9be 100644
--- a/scripts/mod/modpost.c
+++ b/scripts/mod/modpost.c
@@ -1539,7 +1539,8 @@ static void get_markers(struct elf_info *info, struct module *mod)
 			const char *name = strings + sym->st_value;
 			const char *fmt = strchr(name, '\0') + 1;
 			char *line = NULL;
-			asprintf(&line, "%s\t%s\t%s\n", name, mod->name, fmt);
+			int b;
+			b = asprintf(&line, "%s\t%s\t%s\n", name, mod->name, fmt);
 			NOFAIL(line);
 			mod->markers[n++] = line;
 		}
@@ -1551,7 +1552,7 @@ static void read_symbols(char *modname)
 	char *version;
 	char *license;
 	struct module *mod;
-	struct elf_info info = { };
+	struct elf_info info = { .hdr = NULL };
 	Elf_Sym *sym;
 
 	if (!parse_elf(&info, modname))
@@ -1930,7 +1931,7 @@ static int dump_sym(struct symbol *sym)
 
 static void write_dump(const char *fname)
 {
-	struct buffer buf = { };
+	struct buffer buf = { NULL, 0, 0 };
 	struct symbol *symbol;
 	int n;
 
@@ -1951,7 +1952,8 @@ static void write_dump(const char *fname)
 static void add_marker(struct module *mod, const char *name, const char *fmt)
 {
 	char *line = NULL;
-	asprintf(&line, "%s\t%s\t%s\n", name, mod->name, fmt);
+	int b;
+	b = asprintf(&line, "%s\t%s\t%s\n", name, mod->name, fmt);
 	NOFAIL(line);
 
 	mod->markers = NOFAIL(realloc(mod->markers, ((mod->nmarkers + 1) *
@@ -2009,7 +2011,7 @@ static int compare_strings(const void *a, const void *b)
 
 static void write_markers(const char *fname)
 {
-	struct buffer buf = { };
+	struct buffer buf = { NULL, 0, 0 };
 	struct module *mod;
 	size_t i;
 
@@ -2045,7 +2047,7 @@ struct ext_sym_list {
 int main(int argc, char **argv)
 {
 	struct module *mod;
-	struct buffer buf = { };
+	struct buffer buf = { NULL, 0, 0 };
 	char *kernel_read = NULL, *module_read = NULL;
 	char *dump_write = NULL;
 	char *markers_read = NULL;
-- 
1.6.1

