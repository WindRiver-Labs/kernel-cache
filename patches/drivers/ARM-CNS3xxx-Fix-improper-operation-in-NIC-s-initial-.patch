From d8246b3d02ceac44f2d6ef78cd08fe43a1dc5d92 Mon Sep 17 00:00:00 2001
From: Jiang Lu <lu.jiang@windriver.com>
Date: Mon, 1 Aug 2011 18:09:46 +0800
Subject: [PATCH 27/27] ARM:CNS3xxx:Fix improper operation in NIC's initial routine

The init routine of pse module need enable PLL for RGMII module (clear
bit 2 in PLL_HM_PD_CTRL register) as well as enable Clock for PSE
module (set bit 11 in CLK_GATE reigter). This is done by
cns3xxx_gsw_power_enable() function.

In addition, the init process use cns3xxx_gsw_software_reset() instead
of writing PM_SOFT_RST_REG register directly.

Signed-off-by: Jiang Lu <lu.jiang@windriver.com>
---
 drivers/net/cns3xxx/pse_init.c |    4 ++--
 1 files changed, 2 insertions(+), 2 deletions(-)

diff --git a/drivers/net/cns3xxx/pse_init.c b/drivers/net/cns3xxx/pse_init.c
index a8e3fde..6976377 100644
--- a/drivers/net/cns3xxx/pse_init.c
+++ b/drivers/net/cns3xxx/pse_init.c
@@ -189,8 +189,8 @@ void cns3xxx_gsw_hw_init(void)
 	reg |= (1 << 21); /*enable MDIO*/
 	__raw_writel(reg, MISC_GPIOB_PIN_ENABLE_REG);
 
-	cns3xxx_pwr_clk_en(0x1 << PM_CLK_GATE_REG_OFFSET_SWITCH);
-	cns3xxx_pwr_soft_rst(0x1 << PM_CLK_GATE_REG_OFFSET_SWITCH);
+	cns3xxx_gsw_power_enable();
+	cns3xxx_gsw_software_reset();
 
 	/* RGMII0 high speed drive strength */
 	reg = __raw_readl(MISC_IO_PAD_DRIVE_STRENGTH_CTRL_A);
-- 
1.7.0.4

