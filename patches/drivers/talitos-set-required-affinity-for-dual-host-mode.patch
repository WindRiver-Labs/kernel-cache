From 57ba393df2a5c9ecf7e1b97101e050f9aa98d2c7 Mon Sep 17 00:00:00 2001
From: Xufeng Zhang <xufeng.zhang@windriver.com>
Date: Tue, 28 Jun 2011 16:49:06 +0800
Subject: [PATCH 11/47] talitos: set required affinity for dual host mode

Set required affinity for dual host mode, otherwise the affinity
need to be set manually.

Extracted from vendor drop QorIQ-NONDPAA-SDK-V1-20110429_ltib.iso
linux-2.6.35-qoriq-talitos-set-required-affinity-for-dual-.patch.

Signed-off-by: Li Yang <leoli@freescale.com>
Integrated-by: Xufeng Zhang <xufeng.zhang@windriver.com>
---
 drivers/crypto/talitos.c |   10 ++++++++++
 1 files changed, 10 insertions(+), 0 deletions(-)

diff --git a/drivers/crypto/talitos.c b/drivers/crypto/talitos.c
index 3a9df4f..f26fa0f 100644
--- a/drivers/crypto/talitos.c
+++ b/drivers/crypto/talitos.c
@@ -2390,6 +2390,7 @@ static int talitos_probe(struct of_device *ofdev,
 	const char *name;
 	int i, err;
 	int grp_id;
+	struct cpumask cpumask_irq;
 
 	priv = kzalloc(sizeof(struct talitos_private), GFP_KERNEL);
 	if (!priv)
@@ -2519,6 +2520,15 @@ static int talitos_probe(struct of_device *ofdev,
 				priv->irq[1] = NO_IRQ;
 				goto err_out;
 			}
+
+			 /* set correct interrupt affinity */
+			cpumask_clear(&cpumask_irq);
+			cpumask_set_cpu(0, &cpumask_irq);
+			irq_set_affinity(priv->irq[0], &cpumask_irq);
+
+			cpumask_clear(&cpumask_irq);
+			cpumask_set_cpu(1, &cpumask_irq);
+			irq_set_affinity(priv->irq[1], &cpumask_irq);
 		}
 	}
 	for (grp_id = 0; grp_id < MAX_GROUPS; grp_id++) {
-- 
1.7.0.4

