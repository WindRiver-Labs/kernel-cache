From f2ebb77c3c2a58ad8fef9473951ba712492be773 Mon Sep 17 00:00:00 2001
From: Toshi Kani <toshi.kani@hp.com>
Date: Thu, 30 May 2013 00:30:05 +0200
Subject: [PATCH] CPU: Fix sysfs cpu/online of offlined CPUs

commit 1001b4d4a8ee6b2e7a6078a02ccdf68f91b192bd upstream

As reported by Dave Hansen, sysfs cpu/online shows 1 for
offlined CPUs at boot.

Fix this problem by initializing dev.offline with cpu_online()
when registering a CPU.

References: https://lkml.org/lkml/2013/5/29/403
Reported-and-tested-by: Dave Hansen <dave.hansen@intel.com>
Signed-off-by: Toshi Kani <toshi.kani@hp.com>
Signed-off-by: Rafael J. Wysocki <rafael.j.wysocki@intel.com>
Signed-off-by: Zhenbo Gao <zhenbo.gao@windriver.com>
---
 drivers/base/cpu.c |    1 +
 1 files changed, 1 insertions(+), 0 deletions(-)

diff --git a/drivers/base/cpu.c b/drivers/base/cpu.c
index 7431ba6..1d110dc6 100644
--- a/drivers/base/cpu.c
+++ b/drivers/base/cpu.c
@@ -265,6 +265,7 @@ int __cpuinit register_cpu(struct cpu *cpu, int num)
 	cpu->dev.bus = &cpu_subsys;
 	cpu->dev.release = cpu_device_release;
 	cpu->dev.offline_disabled = !cpu->hotpluggable;
+	cpu->dev.offline = !cpu_online(num);
 #ifdef CONFIG_ARCH_HAS_CPU_AUTOPROBE
 	cpu->dev.bus->uevent = arch_cpu_uevent;
 #endif
-- 
1.7.5.4

