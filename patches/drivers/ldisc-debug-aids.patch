From bc507293d1dbefcd3234fe489ea90e2ddab62993 Mon Sep 17 00:00:00 2001
From: Alan Cox <alan@linux.intel.com>
Date: Thu, 15 Sep 2011 14:31:39 +0800
Subject: [PATCH 3/9] ldisc: debug aids

commit 677ca3060c474d7d89941948e32493d9c18c52d2 upstream

Signed-off-by: Linus Torvalds <torvalds@linux-foundation.org>
Integrated-by: Yong Zhang <yong.zhang@windriver.com>
---
 drivers/char/tty_ldisc.c |    1 +
 1 files changed, 1 insertions(+), 0 deletions(-)

diff --git a/drivers/char/tty_ldisc.c b/drivers/char/tty_ldisc.c
index bd62f82..fdc3efa 100644
--- a/drivers/char/tty_ldisc.c
+++ b/drivers/char/tty_ldisc.c
@@ -206,6 +206,7 @@ static void tty_ldisc_put(struct tty_ldisc *ld)
 	ldo->refcount--;
 	module_put(ldo->owner);
 	spin_unlock_irqrestore(&tty_ldisc_lock, flags);
+	WARN_ON(ld->refcount);
 	kfree(ld);
 }
 
-- 
1.7.0.4

