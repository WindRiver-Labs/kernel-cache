From 80c4ac9227af0c7e72f33c0edc609e60ece142c9 Mon Sep 17 00:00:00 2001
From: Xufeng Zhang <xufeng.zhang@windriver.com>
Date: Wed, 21 Sep 2011 09:41:12 +0800
Subject: [PATCH] ibm_newemac: Set BMCR_RESET bit when write to MII_BMCR register

Change NIC speed to 100Mb/s and close auto negotiation by ethtool
makes NIC can't send out packet, this is caused by improper write
to MII_BMCR register. A write to speed/duplex bits must be followed
by a software reset. Otherwise, the write has no effect.

Signed-off-by: Xufeng Zhang <xufeng.zhang@windriver.com>
---
 drivers/net/ibm_newemac/phy.c |    2 +-
 1 files changed, 1 insertions(+), 1 deletions(-)

diff --git a/drivers/net/ibm_newemac/phy.c b/drivers/net/ibm_newemac/phy.c
index ac9d964..ab1cefb 100644
--- a/drivers/net/ibm_newemac/phy.c
+++ b/drivers/net/ibm_newemac/phy.c
@@ -194,7 +194,7 @@ static int genmii_setup_forced(struct mii_phy *phy, int speed, int fd)
 	}
 	if (fd == DUPLEX_FULL)
 		ctl |= BMCR_FULLDPLX;
-	phy_write(phy, MII_BMCR, ctl);
+	phy_write(phy, MII_BMCR, ctl | BMCR_RESET);
 
 	return 0;
 }
-- 
1.7.0.4

