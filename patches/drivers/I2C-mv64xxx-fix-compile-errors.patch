From 40e8fddaee9caa31dc787c7de92a40517657d419 Mon Sep 17 00:00:00 2001
From: Zhang Xiao <xiao.zhang@windriver.com>
Date: Thu, 23 Apr 2015 15:36:04 +0800
Subject: [PATCH] I2C: mv64xxx: fix compile errors.

Commit "I2C: mv64xxx: fix race between FSM/interrupt and process context"
introduced some compilation error as follows:

| drivers/i2c/busses/i2c-mv64xxx.c:114:19: error: duplicate member 'msg'
| drivers/i2c/busses/i2c-mv64xxx.c: In function 'mv64xxx_i2c_do_action':
| drivers/i2c/busses/i2c-mv64xxx.c:262:11: error: 'struct mv64xxx_i2c_data' has no member named 'msgs'
| drivers/i2c/busses/i2c-mv64xxx.c:266:3: error: implicit declaration of function 'mv64xxx_i2c_prepare_for_io' [-Werror=implicit-function-declaration]
| drivers/i2c/busses/i2c-mv64xxx.c:266:48: error: 'struct mv64xxx_i2c_data' has no member named 'msgs'
| drivers/i2c/busses/i2c-mv64xxx.c: At top level:
| drivers/i2c/busses/i2c-mv64xxx.c:375:1: warning: conflicting types for 'mv64xxx_i2c_prepare_for_io' [enabled by default]
| drivers/i2c/busses/i2c-mv64xxx.c:375:1: error: static declaration of 'mv64xxx_i2c_prepare_for_io' follows non-static declaration
| drivers/i2c/busses/i2c-mv64xxx.c:266:3: note: previous implicit declaration of 'mv64xxx_i2c_prepare_for_io' was here
| drivers/i2c/busses/i2c-mv64xxx.c: In function 'mv64xxx_i2c_xfer':
| drivers/i2c/busses/i2c-mv64xxx.c:478:2: error: 'struct mv64xxx_i2c_data' has no member named 'msgs'
| drivers/i2c/busses/i2c-mv64xxx.c:479:10: error: 'struct mv64xxx_i2c_data' has no member named 'msgs'
| drivers/i2c/busses/i2c-mv64xxx.c:487:10: error: 'struct mv64xxx_i2c_data' has no member named 'msgs'
| drivers/i2c/busses/i2c-mv64xxx.c:489:2: error: expected ';' before 'return'
| drivers/i2c/busses/i2c-mv64xxx.c:490:1: warning: control reaches end of non-void function [-Wreturn-type]

Three bugs need to be fixed:
-) The first domain of structure mv64xxx_i2c_data should be
"msgs" instead of "msg";
-) Static function should be defined before it was used;
-) An ";" was missed at the end of a setence.

Signed-off-by: Zhang Xiao <xiao.zhang@windriver.com>
---
 drivers/i2c/busses/i2c-mv64xxx.c |    7 +++++--
 1 files changed, 5 insertions(+), 2 deletions(-)

diff --git a/drivers/i2c/busses/i2c-mv64xxx.c b/drivers/i2c/busses/i2c-mv64xxx.c
index 16a3bb3..a7cdee3 100644
--- a/drivers/i2c/busses/i2c-mv64xxx.c
+++ b/drivers/i2c/busses/i2c-mv64xxx.c
@@ -87,7 +87,7 @@ enum {
 };
 
 struct mv64xxx_i2c_data {
-	struct i2c_msg		*msg;
+	struct i2c_msg		*msgs;
 	int			num_msgs;
 	int			irq;
 	u32			state;
@@ -117,6 +117,9 @@ struct mv64xxx_i2c_data {
 	bool errata_delay;
 };
 
+static void mv64xxx_i2c_prepare_for_io(struct mv64xxx_i2c_data *drv_data,
+					struct i2c_msg *msg);
+
 /*
  *****************************************************************************
  *
@@ -484,7 +487,7 @@ mv64xxx_i2c_xfer(struct i2c_adapter *adap, struct i2c_msg msgs[], int num)
 	ret = rc;
 
 	drv_data->num_msgs = 0;
-	drv_data->msgs = NULL
+	drv_data->msgs = NULL;
 
 	return ret;
 }
-- 
1.7.5.4

