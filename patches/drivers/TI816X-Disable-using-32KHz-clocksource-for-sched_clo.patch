From 69e58759e3bc5be1f77f24d4c291374e09462135 Mon Sep 17 00:00:00 2001
From: Guoqing Jiang <Guoqing.Jiang@windriver.com>
Date: Thu, 23 Jun 2011 11:10:06 +0800
Subject: [PATCH 04/20] TI816X: Disable using 32KHz clocksource for sched_clock

This patch is from arago git tree.
git://arago-project.org/git/projects/linux-omap3.git
Commit: 513785de598321b436d0dc76f199a320d6109392

TI816X platforms do not have 32KHz synchronized clock source available so do not
override shced_clock for TI816X.

Note that this is a temporary fix to allow default sched_clock to execute for
TI816X otherwise per process 'utime' conters remain zero.

We could use one of the timer as clocksource but this requires modifications in
common OMAP code to allow multi-omap build.

NOTE: This patch has a side effect that the multi-omap builds (including TI816X)
will have usage of 32K synchronized timer support disabled even on OMAPs
supporting it.

Signed-off-by: Hemant Pedanekar <hemantp@ti.com>
[Import this one to fix some ltp case hang such as sigrelse01 and mmstress]
Intergated-by: Guoqing Jiang <Guoqing.Jiang@windriver.com>
---
 arch/arm/plat-omap/common.c |    5 +++--
 1 files changed, 3 insertions(+), 2 deletions(-)

diff --git a/arch/arm/plat-omap/common.c b/arch/arm/plat-omap/common.c
index e38774c..ea6d832 100644
--- a/arch/arm/plat-omap/common.c
+++ b/arch/arm/plat-omap/common.c
@@ -87,14 +87,15 @@ EXPORT_SYMBOL(omap_get_var_config);
 
 /*
  * 32KHz clocksource ... always available, on pretty most chips except
- * OMAP 730 and 1510.  Other timers could be used as clocksources, with
+ * OMAP 730, 1510 and TI816X.  Other timers could be used as clocksources, with
  * higher resolution in free-running counter modes (e.g. 12 MHz xtal),
  * but systems won't necessarily want to spend resources that way.
  */
 
 #define OMAP16XX_TIMER_32K_SYNCHRONIZED		0xfffbc410
 
-#if !(defined(CONFIG_ARCH_OMAP730) || defined(CONFIG_ARCH_OMAP15XX))
+#if !(defined(CONFIG_ARCH_OMAP730) || defined(CONFIG_ARCH_OMAP15XX) \
+		|| defined(CONFIG_ARCH_TI816X))
 
 #include <linux/clocksource.h>
 
-- 
1.7.0.2

