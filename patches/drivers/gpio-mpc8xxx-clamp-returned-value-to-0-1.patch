From da4e94eafb7efd128184a5bcd379ee9358d5dbf2 Mon Sep 17 00:00:00 2001
From: Jian Liu <jian.liu@windriver.com>
Date: Thu, 11 Jun 2015 10:09:35 +0800
Subject: [PATCH] gpio: mpc8xxx: clamp returned value to [0,1]

Fix mpc8xxx_gpio_get and mpc8572_gpio_get
to only return 0 or 1.

Signed-off-by: Par Olsson <par.olsson@windriver.com>
Signed-off-by: Jian Liu <jian.liu@windriver.com>
---
 drivers/gpio/gpio-mpc8xxx.c |   10 ++++++++--
 1 files changed, 8 insertions(+), 2 deletions(-)

diff --git a/drivers/gpio/gpio-mpc8xxx.c b/drivers/gpio/gpio-mpc8xxx.c
index d7d6d72..ce8c0cb 100644
--- a/drivers/gpio/gpio-mpc8xxx.c
+++ b/drivers/gpio/gpio-mpc8xxx.c
@@ -77,14 +77,20 @@ static int mpc8572_gpio_get(struct gpio_chip *gc, unsigned int gpio)
 	val = in_be32(mm->regs + GPIO_DAT) & ~out_mask;
 	out_shadow = mpc8xxx_gc->data & out_mask;
 
-	return (val | out_shadow) & mpc8xxx_gpio2mask(gpio);
+	if ((val | out_shadow) & mpc8xxx_gpio2mask(gpio))
+		return 1;
+
+	return 0;
 }
 
 static int mpc8xxx_gpio_get(struct gpio_chip *gc, unsigned int gpio)
 {
 	struct of_mm_gpio_chip *mm = to_of_mm_gpio_chip(gc);
 
-	return in_be32(mm->regs + GPIO_DAT) & mpc8xxx_gpio2mask(gpio);
+	if (in_be32(mm->regs + GPIO_DAT) & mpc8xxx_gpio2mask(gpio))
+		return 1;
+
+	return 0;
 }
 
 static void mpc8xxx_gpio_set(struct gpio_chip *gc, unsigned int gpio, int val)
-- 
1.7.5.4

