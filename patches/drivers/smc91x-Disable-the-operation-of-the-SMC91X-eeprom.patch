From 36bf1296c6781a07b3fb37d6a58b619bd5d452d8 Mon Sep 17 00:00:00 2001
From: Hongbo Zhong <hongbo.zhong@windriver.com>
Date: Wed, 30 Jun 2010 02:30:30 -0700
Subject: [PATCH] smc91x: Disable the operation of the SMC91X eeprom

When you read/write the SMC91X eeprom,the operation will be
fail.at the same time,the network will down on the board of
arm_versatile_926ejs.

  $ ethtool -e eth0

The SMC91X eeprom functionality is not core to the BSP,so
we will simple disable the operation to prevent that the
network device don't work.

Signed-off-by: Hongbo Zhong <hongbo.zhong@windriver.com>
---
 drivers/net/smc91x.c |    4 ++++
 1 files changed, 4 insertions(+), 0 deletions(-)

diff --git a/drivers/net/smc91x.c b/drivers/net/smc91x.c
index 860339d..6edcfcb 100644
--- a/drivers/net/smc91x.c
+++ b/drivers/net/smc91x.c
@@ -1702,6 +1702,7 @@ static int smc_ethtool_geteeprom_len(struct net_device *dev)
 	return 0x23 * 2;
 }
 
+#ifdef CONFIG_SMC91X_EEPROM_OPERATION
 static int smc_ethtool_geteeprom(struct net_device *dev,
 		struct ethtool_eeprom *eeprom, u8 *data)
 {
@@ -1751,6 +1752,7 @@ static int smc_ethtool_seteeprom(struct net_device *dev,
 	return 0;
 }
 
+#endif
 
 static const struct ethtool_ops smc_ethtool_ops = {
 	.get_settings	= smc_ethtool_getsettings,
@@ -1762,8 +1764,10 @@ static const struct ethtool_ops smc_ethtool_ops = {
 	.nway_reset	= smc_ethtool_nwayreset,
 	.get_link	= ethtool_op_get_link,
 	.get_eeprom_len = smc_ethtool_geteeprom_len,
+#ifdef CONFIG_SMC91X_EEPROM_OPERATION
 	.get_eeprom	= smc_ethtool_geteeprom,
 	.set_eeprom	= smc_ethtool_seteeprom,
+#endif
 };
 
 static const struct net_device_ops smc_netdev_ops = {
-- 
1.6.5.2

