From fa8d54685e1da0956a9b6ac77543dd988764ba6b Mon Sep 17 00:00:00 2001
From: Xufeng Zhang <xufeng.zhang@windriver.com>
Date: Thu, 14 Jul 2011 17:13:56 +0800
Subject: [PATCH 38/47] Fix SD PM variable define position error

Extracted from vendor drop QorIQ-NONDPAA-SDK-V1-20110429_ltib.iso
linux-2.6.35-qoriq-Fix-SD-PM-variable-define-position-err.patch.

Signed-off-by: Jiang Yutang <b14898@freescale.com>
Signed-off-by: Li Yang <leoli@freescale.com>
Integrated-by: Xufeng Zhang <xufeng.zhang@windriver.com>
---
 drivers/mmc/host/sdhci-of-core.c |    9 +++++----
 1 files changed, 5 insertions(+), 4 deletions(-)

diff --git a/drivers/mmc/host/sdhci-of-core.c b/drivers/mmc/host/sdhci-of-core.c
index d6d4a1e..3f77631 100644
--- a/drivers/mmc/host/sdhci-of-core.c
+++ b/drivers/mmc/host/sdhci-of-core.c
@@ -1,7 +1,7 @@
 /*
  * OpenFirmware bindings for Secure Digital Host Controller Interface.
  *
- * Copyright (c) 2007 Freescale Semiconductor, Inc.
+ * Copyright (c) 2007-2011 Freescale Semiconductor, Inc.
  * Copyright (c) 2009 MontaVista Software, Inc.
  *
  * Authors: Xiaobo Xie <X.Xie@freescale.com>
@@ -29,9 +29,6 @@
 
 #ifdef CONFIG_MMC_SDHCI_BIG_ENDIAN_32BIT_BYTE_SWAPPER
 
-static int sdhc_pmsaveproctlreg = 0;
-static u32 esdhc_proctl;
-
 /*
  * These accessors are designed for big endian hosts doing I/O to
  * little endian controllers incorporating a 32-bit hardware byte swapper.
@@ -90,6 +87,8 @@ void sdhci_be32bs_writeb(struct sdhci_host *host, u8 val, int reg)
 
 #ifdef CONFIG_PM
 
+static int sdhc_pmsaveproctlreg = 0;
+static u32 esdhc_proctl;
 static int sdhci_of_suspend(struct of_device *ofdev, pm_message_t state)
 {
 	struct sdhci_host *host = dev_get_drvdata(&ofdev->dev);
@@ -227,9 +226,11 @@ static int __devinit sdhci_of_probe(struct of_device *ofdev,
 		}
 	}
 
+#ifdef CONFIG_PM
 	sdhc_proctl = of_get_property(np, "pmsaveproctlreg", NULL);
 	if (sdhc_proctl && (*sdhc_proctl == 1))
 		sdhc_pmsaveproctlreg = 1;
+#endif
 
 	ret = sdhci_add_host(host);
 	if (ret)
-- 
1.7.0.4

