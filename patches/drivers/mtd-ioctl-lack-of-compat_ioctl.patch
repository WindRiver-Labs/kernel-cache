From 911167f937cd9e91325fd049d8cf23d7ce68a693 Mon Sep 17 00:00:00 2001
From: Walton Wang <Lei.Wang@windriver.com>
Date: Tue, 24 Mar 2009 15:11:42 +0800
Subject: [PATCH] mtd ioctl lack of compat_ioctl

mtd ioctl needs compat_ioctl. When mtd-utils (eg. flash_eraseall) uses
ioctl method which is MEMGETOOBSEL and so on, an error will occur
like "Unknown cmd fd(3) cmd(40c84d0a){00} arg(7f945be4) on /dev/mtd0"

Signed-off-by: lei wang <lei.wang@windriver.com>
---
 fs/compat_ioctl.c |   11 +++++++++++
 1 files changed, 11 insertions(+), 0 deletions(-)

diff --git a/fs/compat_ioctl.c b/fs/compat_ioctl.c
index 61cb48f..d189854 100644
--- a/fs/compat_ioctl.c
+++ b/fs/compat_ioctl.c
@@ -2431,6 +2431,17 @@ COMPATIBLE_IOCTL(MEMGETREGIONCOUNT)
 COMPATIBLE_IOCTL(MEMGETREGIONINFO)
 COMPATIBLE_IOCTL(MEMGETBADBLOCK)
 COMPATIBLE_IOCTL(MEMSETBADBLOCK)
+COMPATIBLE_IOCTL(MEMGETOOBSEL)
+COMPATIBLE_IOCTL(MEMWRITEOOB)
+COMPATIBLE_IOCTL(MEMREADOOB)
+COMPATIBLE_IOCTL(MEMSETOOBSEL)
+COMPATIBLE_IOCTL(OTPSELECT)
+COMPATIBLE_IOCTL(OTPGETREGIONCOUNT)
+COMPATIBLE_IOCTL(OTPGETREGIONINFO)
+COMPATIBLE_IOCTL(OTPLOCK)
+COMPATIBLE_IOCTL(ECCGETLAYOUT)
+COMPATIBLE_IOCTL(ECCGETSTATS)
+COMPATIBLE_IOCTL(MTDFILEMODE)
 /* NBD */
 ULONG_IOCTL(NBD_SET_SOCK)
 ULONG_IOCTL(NBD_SET_BLKSIZE)
-- 
1.6.3.3

