From 307599d7b2b8cff72549cf151f31fbde760d2894 Mon Sep 17 00:00:00 2001
From: Xufeng Zhang <xufeng.zhang@windriver.com>
Date: Tue, 9 Aug 2011 19:22:58 +0800
Subject: [PATCH 16/47] gianfar: Bug fix IEEE 1588 padding

The initial padding value used in the gfar_probe is incorrect
when IEEE 1588 is enabled, this was causing issues in the
intial setup and even ping was not happening.

Corrected this with proper padding value while initialization.

Extracted from vendor drop QorIQ-NONDPAA-SDK-V1-20110429_ltib.iso
linux-2.6.35-qoriq-gianfar-Bug-fix-IEEE-1588-padding.patch.

Signed-off-by: Sandeep Gopalpet <sandeep.kumar@freescale.com>
Signed-off-by: Vishnu Suresh <Vishnu@freescale.com>
Integrated-by: Xufeng Zhang <xufeng.zhang@windriver.com>
---
 drivers/net/gianfar.c |    4 +++-
 1 files changed, 3 insertions(+), 1 deletions(-)

diff --git a/drivers/net/gianfar.c b/drivers/net/gianfar.c
index 9df9afc..52cb1f6 100644
--- a/drivers/net/gianfar.c
+++ b/drivers/net/gianfar.c
@@ -1270,8 +1270,10 @@ static int gfar_probe(struct of_device *ofdev,
 	else
 		priv->padding = 0;
 
-	if (dev->features & NETIF_F_IP_CSUM  || priv->ptimer_present)
+	if (dev->features & NETIF_F_IP_CSUM  || priv->ptimer_present) {
+		priv->padding = 0x8;
 		dev->hard_header_len += GMAC_FCB_LEN;
+	}
 
 	/* Program the isrg regs only if number of grps > 1 */
 	if (priv->num_grps > 1) {
-- 
1.7.0.2

