From 4f395fd3cbaadef42b824912ced16d2fd388381c Mon Sep 17 00:00:00 2001
From: "Chew, Kean Ho" <kean.ho.chew@intel.com>
Date: Wed, 12 Feb 2014 04:20:41 -0500
Subject: [PATCH 19/24] pinctrl-baytrail: unmap interrupt when free the gpio
 pin

commit 30114eadba1a0bfa9958c7953f4464e1ac598213 valleyisland-io-3.0
git://git.yoctoproject.org/linux-yocto-3.10.git

In to_irq() callback, we create the hwirq to linux irq
mapping for the requested GPIO pin. Hence, we unamp
the mapping when the gpio pin is being released.

Signed-off-by: Chew, Kean Ho <kean.ho.chew@intel.com>
Signed-off-by: Chew, Chiau Ee <chiau.ee.chew@intel.com>
Signed-off-by: Sreeju Selvaraj <sreeju.armughanx.selvaraj@intel.com>
Signed-off-by: chunguang yang <chunguang.yang@windriver.com>
---
 drivers/pinctrl/pinctrl-baytrail.c |    3 +++
 1 files changed, 3 insertions(+), 0 deletions(-)

diff --git a/drivers/pinctrl/pinctrl-baytrail.c b/drivers/pinctrl/pinctrl-baytrail.c
index c5da101..2182e59 100644
--- a/drivers/pinctrl/pinctrl-baytrail.c
+++ b/drivers/pinctrl/pinctrl-baytrail.c
@@ -195,11 +195,14 @@ static void byt_gpio_free(struct gpio_chip *chip, unsigned offset)
 	struct byt_gpio *vg = to_byt_gpio(chip);
 	void __iomem *reg = byt_gpio_reg(&vg->chip, offset, BYT_CONF0_REG);
 	u32 value;
+	unsigned int virq;
 
 	/* clear interrupt triggering */
 	value = readl(reg);
 	value &= ~(BYT_TRIG_POS | BYT_TRIG_NEG | BYT_TRIG_LVL);
 	writel(value, reg);
+	virq = irq_find_mapping(vg->domain, offset);
+	irq_dispose_mapping(virq);
 
 	pm_runtime_put(&vg->pdev->dev);
 }
-- 
1.7.5.4

