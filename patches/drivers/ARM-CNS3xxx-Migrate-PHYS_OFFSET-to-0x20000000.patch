From 888a4744edaa1a1ea9b60b41973af77e6a89d512 Mon Sep 17 00:00:00 2001
From: Jiang Lu <lu.jiang@windriver.com>
Date: Wed, 10 Aug 2011 11:09:16 +0800
Subject: [PATCH 3/4] ARM:CNS3xxx:Migrate PHYS_OFFSET to 0x20000000

On Econa chip, 0x20000000 is base address of DDR2 SDRAM, the size of
this region is 1G byte. 0x00000000 is used for alias memory, which is
a shadow of RAM after remapped in uboot, the size of this region is
256M byte.

To support system with SDRAM more than 256M byte, it needs to move the
PHYS_OFFSET to 0x20000000.

In addition to change the definition of PHYS_OFFSET, the patch update
a few symbol definitions related to physical address.

Signed-off-by: Jiang Lu <lu.jiang@windriver.com>
---
 arch/arm/mach-cns3xxx/Makefile.boot         |    6 +++---
 arch/arm/mach-cns3xxx/cns3420vb.c           |    2 +-
 arch/arm/mach-cns3xxx/include/mach/memory.h |    2 +-
 3 files changed, 5 insertions(+), 5 deletions(-)

diff --git a/arch/arm/mach-cns3xxx/Makefile.boot b/arch/arm/mach-cns3xxx/Makefile.boot
index 7770128..29979a1 100644
--- a/arch/arm/mach-cns3xxx/Makefile.boot
+++ b/arch/arm/mach-cns3xxx/Makefile.boot
@@ -1,3 +1,3 @@
-   zreladdr-y	:= 0x00008000
-params_phys-y	:= 0x00000100
-initrd_phys-y	:= 0x00C00000
+   zreladdr-y	:= 0x20008000
+params_phys-y	:= 0x20000100
+initrd_phys-y	:= 0x20C00000
diff --git a/arch/arm/mach-cns3xxx/cns3420vb.c b/arch/arm/mach-cns3xxx/cns3420vb.c
index a473974..e1e0a26 100644
--- a/arch/arm/mach-cns3xxx/cns3420vb.c
+++ b/arch/arm/mach-cns3xxx/cns3420vb.c
@@ -430,7 +430,7 @@ static void __init cns3420_map_io(void)
 MACHINE_START(CNS3420VB, "Cavium Networks CNS3420 Validation Board")
 	.phys_io	= CNS3XXX_UART0_BASE,
 	.io_pg_offst	= (CNS3XXX_UART0_BASE_VIRT >> 18) & 0xfffc,
-	.boot_params	= 0x00000100,
+	.boot_params	= 0x20000100,
 	.map_io		= cns3420_map_io,
 	.init_irq	= cns3xxx_init_irq,
 	.timer		= &cns3xxx_timer,
diff --git a/arch/arm/mach-cns3xxx/include/mach/memory.h b/arch/arm/mach-cns3xxx/include/mach/memory.h
index 3b6b769..04bc3b0 100644
--- a/arch/arm/mach-cns3xxx/include/mach/memory.h
+++ b/arch/arm/mach-cns3xxx/include/mach/memory.h
@@ -13,7 +13,7 @@
 /*
  * Physical DRAM offset.
  */
-#define PHYS_OFFSET		UL(0x00000000)
+#define PHYS_OFFSET		UL(0x20000000)
 
 #define __phys_to_bus(x)	((x) + PHYS_OFFSET)
 #define __bus_to_phys(x)	((x) - PHYS_OFFSET)
-- 
1.7.0.4

