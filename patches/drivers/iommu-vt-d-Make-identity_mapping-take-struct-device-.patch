From 57a27f809ddbd0fb6d9472a67dbc03ce035951db Mon Sep 17 00:00:00 2001
From: David Woodhouse <David.Woodhouse@intel.com>
Date: Sun, 9 Mar 2014 14:03:28 -0700
Subject: [PATCH 038/108] iommu/vt-d: Make identity_mapping() take struct
 device not struct pci_dev

commit 9b226624bbf7102cee67b6459bcb9c66dd081ca7 upstream.

Signed-off-by: David Woodhouse <David.Woodhouse@intel.com>
Signed-off-by: Liwei Song <liwei.song@windriver.com>
---
 drivers/iommu/intel-iommu.c |    6 +++---
 1 files changed, 3 insertions(+), 3 deletions(-)

diff --git a/drivers/iommu/intel-iommu.c b/drivers/iommu/intel-iommu.c
index 157617b..7d1024e 100644
--- a/drivers/iommu/intel-iommu.c
+++ b/drivers/iommu/intel-iommu.c
@@ -2437,14 +2437,14 @@ static int __init si_domain_init(int hw)
 	return 0;
 }
 
-static int identity_mapping(struct pci_dev *pdev)
+static int identity_mapping(struct device *dev)
 {
 	struct device_domain_info *info;
 
 	if (likely(!iommu_identity_mapping))
 		return 0;
 
-	info = pdev->dev.archdata.iommu;
+	info = dev->archdata.iommu;
 	if (info && info != DUMMY_DEVICE_DOMAIN_INFO)
 		return (info->domain == si_domain);
 
@@ -2901,7 +2901,7 @@ static int iommu_no_mapping(struct device *dev)
 		return 0;
 
 	pdev = to_pci_dev(dev);
-	found = identity_mapping(pdev);
+	found = identity_mapping(dev);
 	if (found) {
 		if (iommu_should_identity_map(pdev, 0))
 			return 1;
-- 
1.7.5.4

