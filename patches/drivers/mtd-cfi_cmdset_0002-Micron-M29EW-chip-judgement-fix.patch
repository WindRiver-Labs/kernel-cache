From 7ef1ff8dc41332ddb80f755782796db78db0a756 Mon Sep 17 00:00:00 2001
From: Zhang Xiao <xiao.zhang@windriver.com>
Date: Thu, 8 Nov 2012 18:06:19 +0800
Subject: [PATCH] mtd: cfi_cmdset_0002: Micron M29EW chip judgement fix

Commit 4209628843 from git.infradead.org/users/dedekind/l2-mtd-2.6.git
was integrated before to workaround some hardware issue. There is an
error in the integration that the judgment of this flash chip is not
correct. Fix it.

Signed-off-by: Zhang Xiao <xiao.zhang@windriver.com>
---
 drivers/mtd/chips/cfi_cmdset_0002.c |   15 ++++++---------
 1 files changed, 6 insertions(+), 9 deletions(-)

diff --git a/drivers/mtd/chips/cfi_cmdset_0002.c b/drivers/mtd/chips/cfi_cmdset_0002.c
index 17aa9cc..b4ef59e 100644
--- a/drivers/mtd/chips/cfi_cmdset_0002.c
+++ b/drivers/mtd/chips/cfi_cmdset_0002.c
@@ -560,16 +560,13 @@ static int __xipram chip_good(struct map_info *map, unsigned long addr, map_word
  * and prior to resuming. [...] The work-around is to issue a dummy write cycle
  * that writes an F0 command code before the RESUME command.
  */
-static bool is_m29ew(struct cfi_private *cfi)
+static int is_m29ew(struct cfi_private *cfi)
 {
-	if (cfi->mfr != 0x0089)
-		if ((cfi->device_type == CFI_DEVICETYPE_X8  &&
-			(cfi->id & 0xff)== 0x7e) ||
-		    (cfi->device_type == CFI_DEVICETYPE_X16 &&
-			cfi->id == 0x227e))
-		return true;
-
-	return false;
+	if (cfi->mfr == CFI_MFR_INTEL &&
+	    ((cfi->device_type == CFI_DEVICETYPE_X8 && (cfi->id & 0xff) == 0x7e) ||
+	     (cfi->device_type == CFI_DEVICETYPE_X16 && cfi->id == 0x227e)))
+		return 1;
+	return 0;
 }
 
 static void cfi_fixup_m29ew_erase_suspend(struct map_info *map,
-- 
1.7.0

