From 25096659305a6b33b69e26ba4fd06b419c993ff5 Mon Sep 17 00:00:00 2001
From: Jiang Lu <lu.jiang@windriver.com>
Date: Tue, 18 Aug 2015 04:12:37 +0000
Subject: [PATCH] watchdog:softdog:Fix a null pointer bug

When softdog compiled as a kernel module, if the timer still running
while removing module, it will lead a null pointer calltrace when timer
expired.

This patch disables the timer in exit() routine.

Signed-off-by: Jiang Lu <lu.jiang@windriver.com>
---
 drivers/watchdog/softdog.c |    1 +
 1 files changed, 1 insertions(+), 0 deletions(-)

diff --git a/drivers/watchdog/softdog.c b/drivers/watchdog/softdog.c
index 0dc5e323d..78e94a5 100644
--- a/drivers/watchdog/softdog.c
+++ b/drivers/watchdog/softdog.c
@@ -196,6 +196,7 @@ static int __init watchdog_init(void)
 
 static void __exit watchdog_exit(void)
 {
+	del_timer_sync(&watchdog_ticktock);
 	watchdog_unregister_device(&softdog_dev);
 	unregister_reboot_notifier(&softdog_notifier);
 }
-- 
1.7.5.4

