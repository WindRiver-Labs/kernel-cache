From 79a078caf4fe29ef3461dd667f4a04ff46ab9487 Mon Sep 17 00:00:00 2001
From: Yang Shi <yang.shi@windriver.com>
Date: Tue, 10 Aug 2010 12:38:13 +0800
Subject: [PATCH] SDHCI: Auto CMD12 support for eSDHC driver of P1022

Extracted from the P1022DS_20100330-ltib.iso vendor drop.

Auto CMD12 command support for P1022DS eSDHC driver.

Signed-off-by: Jerry Huang <Chang-Ming.Huang@freescale.com>
[Adjust the context to apply the patch cleanly]
Signed-off-by: Yang Shi <yang.shi@windriver.com>
---
 drivers/mmc/host/sdhci-of-core.c |    6 +++---
 drivers/mmc/host/sdhci.c         |    2 +-
 2 files changed, 4 insertions(+), 4 deletions(-)

diff --git a/drivers/mmc/host/sdhci-of-core.c b/drivers/mmc/host/sdhci-of-core.c
index a873b29..78765f0 100644
--- a/drivers/mmc/host/sdhci-of-core.c
+++ b/drivers/mmc/host/sdhci-of-core.c
@@ -156,15 +156,15 @@ static int __devinit sdhci_of_probe(struct of_device *ofdev,
 		host->ops = &sdhci_of_data->ops;
 	}
 
-	if (of_get_property(np, "sdhci,auto-cmd12", NULL))
-		host->quirks |= SDHCI_QUIRK_MULTIBLOCK_READ_ACMD12;
-
 	if (of_get_property(np, "sdhci,broken-timeout", NULL))
 		host->quirks |= SDHCI_QUIRK_BROKEN_TIMEOUT_VAL;
 
 	if (of_get_property(np, "sdhci,1-bit-only", NULL))
 		host->quirks |= SDHCI_QUIRK_FORCE_1_BIT_DATA;
 
+	if (of_get_property(np, "fsl,sdhci-auto-cmd12", NULL))
+		host->quirks |= SDHCI_QUIRK_MULTIBLOCK_READ_ACMD12;
+
 	if (sdhci_of_wp_inverted(np))
 		host->quirks |= SDHCI_QUIRK_INVERTED_WRITE_PROTECT;
 
diff --git a/drivers/mmc/host/sdhci.c b/drivers/mmc/host/sdhci.c
index b7a1ce4..f3a3980 100644
--- a/drivers/mmc/host/sdhci.c
+++ b/drivers/mmc/host/sdhci.c
@@ -811,7 +811,7 @@ static void sdhci_set_transfer_mode(struct sdhci_host *host,
 		if (host->quirks & SDHCI_QUIRK_MULTIBLOCK_READ_ACMD12)
 			mode |= SDHCI_TRNS_MULTI | SDHCI_TRNS_ACMD12;
 		else
-		mode |= SDHCI_TRNS_MULTI;
+			mode |= SDHCI_TRNS_MULTI;
 	}
 	if (data->flags & MMC_DATA_READ)
 		mode |= SDHCI_TRNS_READ;
-- 
1.6.5.2

