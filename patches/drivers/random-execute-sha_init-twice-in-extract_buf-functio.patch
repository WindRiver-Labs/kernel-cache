From b54b5c7096f4b4dc872057f8b2989f4673442d5c Mon Sep 17 00:00:00 2001
From: Zhixiong Chi <Zhixiong.Chi@windriver.com>
Date: Wed, 18 Nov 2015 16:27:26 +0800
Subject: [PATCH] random: execute sha_init() twice in extract_buf function

The commit "random: use the architectural HWRNG for the SHA's IV in
extract_buf()" introduce this issue.
we execute the function of sha_init() twice, inspite of having no
influence with working normally.

Signed-off-by: Zhixiong Chi <Zhixiong.Chi@windriver.com>
---
 drivers/char/random.c |    1 -
 1 files changed, 0 insertions(+), 1 deletions(-)

diff --git a/drivers/char/random.c b/drivers/char/random.c
index 715f674..6c03531 100644
--- a/drivers/char/random.c
+++ b/drivers/char/random.c
@@ -1011,7 +1011,6 @@ static void extract_buf(struct entropy_store *r, __u8 *out)
 	}
 
 	/* Generate a hash across the pool, 16 words (512 bits) at a time */
-	sha_init(hash.w);
 	spin_lock_irqsave(&r->lock, flags);
 	for (i = 0; i < r->poolinfo->poolwords; i += 16)
 		sha_transform(hash.w, (__u8 *)(r->pool + i), workspace);
-- 
1.7.5.4

