From a87d75d6544e9b70689dd7602ac22f63f45f58f7 Mon Sep 17 00:00:00 2001
From: Guoqing Jiang <Guoqing.Jiang@windriver.com>
Date: Thu, 23 Jun 2011 17:26:56 +0800
Subject: [PATCH 12/20] TI816x i2c: modify i2c resource and modify timeout macro

This patch is based on below commit from arago git tree.
git://arago-project.org/git/projects/linux-omap3.git
e31761 Added support for PCF8575 in board file

Signed-off-by: Brijesh Jadav <brijesh.j@ti.com>
[This one is picked from the original commit to compatible
with wrlinux tree]
Integrated-by: Guoqing Jiang <Guoqing.Jiang@windriver.com>
---
 arch/arm/plat-omap/i2c.c      |    6 +++++-
 drivers/i2c/busses/i2c-omap.c |    2 +-
 2 files changed, 6 insertions(+), 2 deletions(-)

diff --git a/arch/arm/plat-omap/i2c.c b/arch/arm/plat-omap/i2c.c
index ad6556e..9b23a4e 100644
--- a/arch/arm/plat-omap/i2c.c
+++ b/arch/arm/plat-omap/i2c.c
@@ -36,6 +36,7 @@
 #define OMAP2_I2C_BASE2		0x48072000
 #define OMAP2_I2C_BASE3		0x48060000
 #define TI816x_I2C_BASE0	0x48028000
+#define TI816x_I2C_BASE1	0x4802A000
 
 static const char name[] = "i2c_omap";
 
@@ -52,6 +53,9 @@ static const char name[] = "i2c_omap";
 
 static struct resource i2c_resources[][2] = {
 	{ I2C_RESOURCE_BUILDER(0, 0) },
+#if	defined(CONFIG_ARCH_TI816X)
+	{ I2C_RESOURCE_BUILDER(TI816x_I2C_BASE1, 0) },
+#endif
 #if	defined(CONFIG_ARCH_OMAP2) || defined(CONFIG_ARCH_OMAP3)
 	{ I2C_RESOURCE_BUILDER(OMAP2_I2C_BASE2, INT_24XX_I2C2_IRQ) },
 #endif
@@ -96,7 +100,7 @@ static int __init omap_i2c_nr_ports(void)
 	else if (cpu_is_omap34xx())
 		ports = 3;
 	else if (cpu_is_ti816x())
-		ports = 1;
+		ports = 2;
 
 	return ports;
 }
diff --git a/drivers/i2c/busses/i2c-omap.c b/drivers/i2c/busses/i2c-omap.c
index 3d775af..fc074b5 100644
--- a/drivers/i2c/busses/i2c-omap.c
+++ b/drivers/i2c/busses/i2c-omap.c
@@ -48,7 +48,7 @@
 #define OMAP_I2C_REV_ON_4430		0x40
 
 /* timeout waiting for the controller to respond */
-#define OMAP_I2C_TIMEOUT (msecs_to_jiffies(1000))
+#define OMAP_I2C_TIMEOUT (msecs_to_jiffies(2000))
 
 /* For OMAP3 I2C_IV has changed to I2C_WE (wakeup enable) */
 enum {
-- 
1.7.0.2

