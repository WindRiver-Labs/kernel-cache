From 9aa8f9f744a2c1f6aa3ee8154c674850509e3586 Mon Sep 17 00:00:00 2001
From: Xufeng Zhang <xufeng.zhang@windriver.com>
Date: Tue, 9 Aug 2011 19:23:19 +0800
Subject: [PATCH 37/47] Gianfar: Optimization for SKB Alingment

Since most of the time skb allocated is 64 byte aligned, calling the
skb_reserve only if alignment is required.

Extracted from vendor drop QorIQ-NONDPAA-SDK-V1-20110429_ltib.iso
0033-Gianfar-Optimization-for-SKB-Alingment.patch.

Signed-off-by: Sachin Saxena <sachin.saxena@freescale.com>
Integrated-by: Xufeng Zhang <xufeng.zhang@windriver.com>
---
 drivers/net/gianfar.c |    4 +++-
 1 files changed, 3 insertions(+), 1 deletions(-)

diff --git a/drivers/net/gianfar.c b/drivers/net/gianfar.c
index 14387cb..4c6f935 100644
--- a/drivers/net/gianfar.c
+++ b/drivers/net/gianfar.c
@@ -3520,8 +3520,10 @@ struct sk_buff * gfar_new_skb(struct net_device *dev)
 
 	/* We need the data buffer to be aligned properly.  We will reserve
 	 * as many bytes as needed to align the data properly
+	 * Do only if not already aligned
 	 */
-	skb_reserve(skb, alignamount);
+	if (alignamount != RXBUF_ALIGNMENT)
+		skb_reserve(skb, alignamount);
 	GFAR_CB(skb)->alignamount = alignamount;
 
 	return skb;
-- 
1.7.0.2

