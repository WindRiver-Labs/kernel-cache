From 3422294de4f1466cbcba1731220c9db53eaf8d35 Mon Sep 17 00:00:00 2001
From: Shan Hai <shan.hai@windriver.com>
Date: Thu, 11 Aug 2016 14:19:52 +0800
Subject: [PATCH] serial/kgdboc: fix a compilation error

The previous commit "drivers/kgdboc: reclaim allocated resources
on unloading the kgdboc driver" uses variables unconditionally
and causes compilation errors, fix it by using the variables
conditionally.

Signed-off-by: Shan Hai <shan.hai@windriver.com>
---
 drivers/tty/serial/kgdboc.c |    3 ++-
 1 files changed, 2 insertions(+), 1 deletions(-)

diff --git a/drivers/tty/serial/kgdboc.c b/drivers/tty/serial/kgdboc.c
index 1ef6cff..d84e1e7 100644
--- a/drivers/tty/serial/kgdboc.c
+++ b/drivers/tty/serial/kgdboc.c
@@ -237,12 +237,13 @@ __setup("kgdboc=", kgdboc_option_setup);
 
 static void cleanup_kgdboc(void)
 {
+#ifdef CONFIG_KDB_KEYBOARD
 	if (do_reschedule_work)
                 cancel_work_sync(&kgdboc_restore_input_work);
 
 	if (delay_schedule_work_task)
 		kthread_stop(delay_schedule_work_task);
-
+#endif
 	if (kgdb_unregister_nmi_console())
 		return;
 	kgdboc_unregister_kbd();
-- 
1.7.5.4

