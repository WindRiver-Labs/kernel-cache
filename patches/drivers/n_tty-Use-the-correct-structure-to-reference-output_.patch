From 6fd1a5165912c1c218d0701405220214639f1917 Mon Sep 17 00:00:00 2001
From: Auto Configured <auto.configured>
Date: Tue, 10 Jun 2014 02:15:17 -0700
Subject: [PATCH] n_tty: Use the correct structure to reference output_lock

commit "n_tty: Fix n_tty_write crash when echoing in raw mode"
used the wrong structure to reference output_lock, and lead to
building error.

Signed-off-by: Xufeng Zhang <xufeng.zhang@windriver.com>
---
 drivers/tty/n_tty.c |    6 ++----
 1 files changed, 2 insertions(+), 4 deletions(-)

diff --git a/drivers/tty/n_tty.c b/drivers/tty/n_tty.c
index 2b70d24..fa0376b 100644
--- a/drivers/tty/n_tty.c
+++ b/drivers/tty/n_tty.c
@@ -1995,12 +1995,10 @@ static ssize_t n_tty_write(struct tty_struct *tty, struct file *file,
 			if (tty->ops->flush_chars)
 				tty->ops->flush_chars(tty);
 		} else {
-			struct n_tty_data *ldata = tty->disc_data;
-
 			while (nr > 0) {
-				mutex_lock(&ldata->output_lock);
+				mutex_lock(&tty->output_lock);
 				c = tty->ops->write(tty, b, nr);
-				mutex_unlock(&ldata->output_lock);
+				mutex_unlock(&tty->output_lock);
 				if (c < 0) {
 					retval = c;
 					goto break_out;
-- 
1.7.5.4

