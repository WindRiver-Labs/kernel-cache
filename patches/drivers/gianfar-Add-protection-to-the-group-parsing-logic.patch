From fef554a50aa0118a4a52454c70398ca0dd7d1f2e Mon Sep 17 00:00:00 2001
From: Xufeng Zhang <xufeng.zhang@windriver.com>
Date: Tue, 9 Aug 2011 19:22:55 +0800
Subject: [PATCH 13/47] gianfar: Add protection to the group parsing logic

Add protection to the group parsing logic, so that in case
the mdio node is moved inside the enet node, it isn't interpreted
as another group.

Extracted from vendor drop QorIQ-NONDPAA-SDK-V1-20110429_ltib.iso
linux-2.6.35-qoriq-gianfar-Added-protection-to-the-group-p.patch.

Signed-off-by: Sandeep Gopalpet <sandeep.kumar@freescale.com>
Signed-off-by: Jiajun Wu <b06378@freescale.com>
Integrated-by: Xufeng Zhang <xufeng.zhang@windriver.com>
---
 drivers/net/gianfar.c |    5 +++++
 1 files changed, 5 insertions(+), 0 deletions(-)

diff --git a/drivers/net/gianfar.c b/drivers/net/gianfar.c
index eba4637..c01d502 100644
--- a/drivers/net/gianfar.c
+++ b/drivers/net/gianfar.c
@@ -791,6 +791,11 @@ static int gfar_of_init(struct of_device *ofdev, struct net_device **pdev)
 	if (of_device_is_compatible(np, "fsl,etsec2")) {
 		priv->mode = MQ_MG_MODE;
 		for_each_child_of_node(np, child) {
+			if (of_device_is_compatible
+				(child, "fsl,etsec2-mdio") ||
+				of_device_is_compatible
+				(child, "fsl,etsec2-tbi"))
+				continue;
 			err = gfar_parse_group(child, priv, model);
 			if (err)
 				goto err_grp_init;
-- 
1.7.0.2

