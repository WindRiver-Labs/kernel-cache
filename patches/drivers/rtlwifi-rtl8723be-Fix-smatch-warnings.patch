From 36fa1633d5a2d6548ba2fce50c87a0639b6c5e18 Mon Sep 17 00:00:00 2001
From: chunguang yang <chunguang.yang@windriver.com>
Date: Tue, 28 Jul 2015 15:56:16 +0800
Subject: [PATCH 09/24] rtlwifi: rtl8723be: Fix smatch warnings

commit: 7ce24ab74c04ce0ce238b5dce30e9bc3823527be upstream

Smatch reports the following:

drivers/net/wireless/rtlwifi/rtl8723be/fw.c:208
_rtl8723be_fill_h2c_command() warn: variable dereferenced before check
'rtlhal' (see line 69)
drivers/net/wireless/rtlwifi/rtl8723be/hw.c:1732
_rtl8723be_read_adapter_info() error: __builtin_memcpy()
'&rtlefuse->efuse_map[0][0]' too small (256 vs 512)

The first one is fixed by removing two pointless tests for NULL
pointers.

Reported-by: Dan Carpenter <dan.carpenter@oracle.com>
Signed-off-by: Larry Finger <Larry.Finger@lwfinger.net>
Signed-off-by: John W. Linville <linville@tuxdriver.com>
Signed-off-by: chunguang yang <chunguang.yang@windriver.com>
---
 drivers/net/wireless/rtlwifi/rtl8723be/fw.c |    8 --------
 drivers/net/wireless/rtlwifi/wifi.h         |    2 +-
 2 files changed, 1 insertions(+), 9 deletions(-)

diff --git a/drivers/net/wireless/rtlwifi/rtl8723be/fw.c b/drivers/net/wireless/rtlwifi/rtl8723be/fw.c
index 0f3522d..f856be6 100644
--- a/drivers/net/wireless/rtlwifi/rtl8723be/fw.c
+++ b/drivers/net/wireless/rtlwifi/rtl8723be/fw.c
@@ -201,14 +201,6 @@ static void _rtl8723be_fill_h2c_command(struct ieee80211_hw *hw, u8 element_id,
 			 "pHalData->last_hmeboxnum  = %d\n",
 			 rtlhal->last_hmeboxnum);
 	}
-	if (!rtlpriv) {
-		pr_err("rtlpriv bad\n");
-		return;
-	}
-	if (!rtlhal) {
-		pr_err("rtlhal bad\n");
-		return;
-	}
 	spin_lock_irqsave(&rtlpriv->locks.h2c_lock, flag);
 	rtlhal->h2c_setinprogress = false;
 	spin_unlock_irqrestore(&rtlpriv->locks.h2c_lock, flag);
diff --git a/drivers/net/wireless/rtlwifi/wifi.h b/drivers/net/wireless/rtlwifi/wifi.h
index 2304c7f..b7dd5a2 100644
--- a/drivers/net/wireless/rtlwifi/wifi.h
+++ b/drivers/net/wireless/rtlwifi/wifi.h
@@ -1448,7 +1448,7 @@ struct rtl_dm {
 	struct fast_ant_training fat_table;
 };
 
-#define	EFUSE_MAX_LOGICAL_SIZE			256
+#define	EFUSE_MAX_LOGICAL_SIZE			512
 
 struct rtl_efuse {
 	bool autoLoad_ok;
-- 
1.7.5.4

