From bb8da046a49533ec7f1d206ad502d3d183606b21 Mon Sep 17 00:00:00 2001
From: Xufeng Zhang <xufeng.zhang@windriver.com>
Date: Tue, 9 Aug 2011 19:23:29 +0800
Subject: [PATCH 47/47] gianfar/1588: add compatible list for global utilities block

Add a compatible list for global utilities block,
otherwise we got the following errors when install
IEEE1588 if the compatible name for global utilities
block is not 'fsl,p2020-guts':
1588 muxing could not be done, mapping failed

Signed-off-by: Xufeng Zhang <xufeng.zhang@windriver.com>
---
 drivers/net/gianfar_1588.c |   17 ++++++++++++++++-
 1 files changed, 16 insertions(+), 1 deletions(-)

diff --git a/drivers/net/gianfar_1588.c b/drivers/net/gianfar_1588.c
index bc2eccb..358f70e 100644
--- a/drivers/net/gianfar_1588.c
+++ b/drivers/net/gianfar_1588.c
@@ -607,8 +607,23 @@ void pmuxcr_guts_write(void)
 	struct device_node *np = NULL;
 	void __iomem *immap = NULL;
 	u32 pmuxcr;
+	int i;
+	static char *compatible_list[] = {
+					"fsl,p1021-guts",
+					"fsl,p2020-guts",
+					"fsl,p1020-guts",
+					"fsl,p1022-guts",
+					"fsl,mpc8572-guts",
+					"fsl,mpc8548-guts",
+					NULL
+				};
+
+	for (i = 0; compatible_list[i] != NULL; i++) {
+		np = of_find_compatible_node(NULL, NULL, compatible_list[i]);
+		if (np)
+			break;
+	}
 
-	np =  of_find_compatible_node(NULL, NULL, "fsl,p2020-guts");
 	immap = of_iomap(np, 0);
 	if (immap) {
 		pmuxcr = in_be32(immap + MPC85XX_PMUXCR_OFFS);
-- 
1.7.0.2

