From 2e0a2e18f1c2e9757c8ccf94c97b9eeed2e78677 Mon Sep 17 00:00:00 2001
From: Wang Hui <Hui.Wang@windriver.com>
Date: Fri, 18 Dec 2009 14:06:47 +0800
Subject: [PATCH 09/11] netdriver/smc911x: re-enable rx after handle rx overrun

When the driver run into rx overrun, it will disable rx, after handle
rx overrun, the driver should re-enable rx.

Signed-off-by: Wang Hui <Hui.Wang@windriver.com>
---
 drivers/net/smc911x.c |    7 +++++++
 1 files changed, 7 insertions(+), 0 deletions(-)

diff --git a/drivers/net/smc911x.c b/drivers/net/smc911x.c
index 7471ee3..1881ce8 100644
--- a/drivers/net/smc911x.c
+++ b/drivers/net/smc911x.c
@@ -1108,6 +1108,13 @@ static irqreturn_t smc911x_interrupt(int irq, void *dev_id)
 				} else
 #endif
 				smc911x_rcv(dev);
+
+				if (rx_overrun) {
+					SMC_GET_MAC_CR(lp, cr);
+					cr |= MAC_CR_RXEN_;
+					SMC_SET_MAC_CR(lp, cr);
+					SMC_ACK_INT(lp, INT_STS_RXSTOP_INT_);
+				}
 			}
 			SMC_ACK_INT(lp, INT_STS_RSFL_);
 		}
-- 
1.6.5.2

