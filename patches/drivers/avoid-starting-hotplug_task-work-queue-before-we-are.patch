From c6e0f6633190ef852d281f979396853e22519503 Mon Sep 17 00:00:00 2001
From: Chunbo Luo <chunbo.luo@windriver.com>
Date: Tue, 24 Jun 2008 17:40:31 +0800
Subject: [PATCH 01/11] avoid starting hotplug_task work queue before we are ready

Don't start work queue hotplug_task when the flag of ata_port
is not ATA_PFLAG_SCSI_HOTPLUG enabled.

Signed-off-by: Chunbo Luo <chunbo.luo@windriver.com>
---
 drivers/ata/libata-scsi.c |    5 +++--
 1 files changed, 3 insertions(+), 2 deletions(-)

diff --git a/drivers/ata/libata-scsi.c b/drivers/ata/libata-scsi.c
index 0088cde..e367077 100644
--- a/drivers/ata/libata-scsi.c
+++ b/drivers/ata/libata-scsi.c
@@ -3409,8 +3409,9 @@ void ata_scsi_scan_host(struct ata_port *ap, int sync)
 				"                  switching to async\n");
 	}
 
-	queue_delayed_work(ata_aux_wq, &ap->hotplug_task,
-			   round_jiffies_relative(HZ));
+	if (ap->pflags & ATA_PFLAG_SCSI_HOTPLUG)
+		queue_delayed_work(ata_aux_wq, &ap->hotplug_task,
+				   round_jiffies_relative(HZ));
 }
 
 /**
-- 
1.6.5.2

