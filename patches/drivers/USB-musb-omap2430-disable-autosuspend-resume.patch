From 749b6dd6c6b849a7f6b351810c2c32f6ff8c9df3 Mon Sep 17 00:00:00 2001
From: Zumeng Chen <zumeng.chen@windriver.com>
Date: Thu, 26 Jul 2012 15:36:12 +0800
Subject: [PATCH 2/2] USB: musb: omap2430: disable autosuspend/resume

After having modprobe g_mass_storage/g_ether, omap2430 autosuspended,
which because HCD will enable autosuspend/wakeup after having created
root hub for omap2430 musb. But it seems Omap2430 musb can't supply
enough interrupt status for autosuspend, and it can't wake up.

The result is that there is no response from host on both g_ether/
g_mass_storage, so disable this for Omap2430.

Signed-off-by: Zumeng Chen <zumeng.chen@windriver.com>
---
 drivers/usb/musb/musb_gadget.c |    5 +++++
 1 file changed, 5 insertions(+)

diff --git a/drivers/usb/musb/musb_gadget.c b/drivers/usb/musb/musb_gadget.c
index adfdf85..737a93e 100644
--- a/drivers/usb/musb/musb_gadget.c
+++ b/drivers/usb/musb/musb_gadget.c
@@ -1975,6 +1975,11 @@ static int musb_gadget_start(struct usb_gadget *g,
 					&& otg->set_vbus)
 			otg_set_vbus(otg, 1);
 
+#ifdef CONFIG_USB_MUSB_OMAP2PLUS
+			/*Disable autosuspend/wakeup only for omap2plus. */
+			device_set_wakeup_capable(&hcd->self.root_hub->dev, 0);
+#endif
+
 		hcd->self.uses_pio_for_control = 1;
 	}
 	if (musb->xceiv->last_event == USB_EVENT_NONE)
-- 
1.7.9.7

