From 59e30b19025d3945ad66e3f498e3bc14caa2f9bf Mon Sep 17 00:00:00 2001
From: Yongli He <yongli.he@windriver.com>
Date: Fri, 28 Oct 2011 14:49:06 +0800
Subject: [PATCH] fsl_p50x0: booke watch dog support for PPC64

BOOKE watchdog support works unmodified for BOOK3E. So to
enable it, we simply have to update the conditional statements
to include BOOK3E.

Signed-off-by: Yongli He <yongli.he@windriver.com>
---
 drivers/watchdog/booke_wdt.c |    6 +++---
 1 files changed, 3 insertions(+), 3 deletions(-)

diff --git a/drivers/watchdog/booke_wdt.c b/drivers/watchdog/booke_wdt.c
index 769f899..6c429b4 100644
--- a/drivers/watchdog/booke_wdt.c
+++ b/drivers/watchdog/booke_wdt.c
@@ -33,7 +33,7 @@
  * occur, and the final time the board will reset.
  */
 
-#ifdef	CONFIG_FSL_BOOKE
+#if  defined(CONFIG_FSL_BOOKE) || defined(CONFIG_PPC_FSL_BOOK3E)
 #define WDT_PERIOD_DEFAULT 38	/* Ex. wdt_period=28 bus=333Mhz,reset=~40sec */
 #else
 #define WDT_PERIOD_DEFAULT 3	/* Refer to the PPC40x and PPC4xx manuals */
@@ -42,7 +42,7 @@
 u32 booke_wdt_enabled;
 u32 booke_wdt_period = WDT_PERIOD_DEFAULT;
 
-#ifdef	CONFIG_FSL_BOOKE
+#if  defined(CONFIG_FSL_BOOKE) || defined(CONFIG_PPC_FSL_BOOK3E)
 #define WDTP(x)		((((x)&0x3)<<30)|(((x)&0x3c)<<15))
 #define WDTP_MASK	(WDTP(0x3f))
 #else
@@ -190,7 +190,7 @@ static long booke_wdt_ioctl(struct file *file,
 	case WDIOC_SETTIMEOUT:
 		if (get_user(tmp, p))
 			return -EFAULT;
-#ifdef	CONFIG_FSL_BOOKE
+#if  defined(CONFIG_FSL_BOOKE) || defined(CONFIG_PPC_FSL_BOOK3E)
 		/* period of 1 gives the largest possible timeout */
 		if (tmp > period_to_sec(1))
 			return -EINVAL;
-- 
1.7.0.4

