From c42520117a081b44d2153d4963ed4486597ef9a7 Mon Sep 17 00:00:00 2001
From: Chunbo Luo <chunbo.luo@windriver.com>
Date: Tue, 24 Jun 2008 17:40:31 +0800
Subject: [PATCH] Don't start work queue hotplug_task when the flag of atat-port
 is not ATA_PFLAG_SCSI_HOTPLUG enabled.

Signed-off-by: Chunbo Luo <chunbo.luo@windriver.com>
---
 drivers/ata/libata-scsi.c |    5 +++--
 1 files changed, 3 insertions(+), 2 deletions(-)

diff --git a/drivers/ata/libata-scsi.c b/drivers/ata/libata-scsi.c
index 2e6e162..cd22519 100644
--- a/drivers/ata/libata-scsi.c
+++ b/drivers/ata/libata-scsi.c
@@ -3110,8 +3110,9 @@ void ata_scsi_scan_host(struct ata_port *ap, int sync)
 				"                  switching to async\n");
 	}
 
-	queue_delayed_work(ata_aux_wq, &ap->hotplug_task,
-			   round_jiffies_relative(HZ));
+	if (ap->pflags & ATA_PFLAG_SCSI_HOTPLUG)
+		queue_delayed_work(ata_aux_wq, &ap->hotplug_task,
+				   round_jiffies_relative(HZ));
 }
 
 /**
-- 
1.5.5.1

