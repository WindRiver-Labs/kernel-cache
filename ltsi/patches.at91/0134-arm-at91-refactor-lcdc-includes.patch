From a9336b89063ddcea9906959bcc72ff47c7cbeed8 Mon Sep 17 00:00:00 2001
From: Nicolas Ferre <nicolas.ferre@atmel.com>
Date: Mon, 22 Oct 2012 15:45:30 +0200
Subject: arm: at91: refactor lcdc-includes
MIME-Version: 1.0
Content-Type: text/plain; charset=UTF-8
Content-Transfer-Encoding: 8bit

Among others the HEO-ISR bit is fixed.

Signed-off-by: Wolfram Sang <w.sang@pengutronix.de>
Signed-off-by: Uwe Kleine-KÃ¶nig <u.kleine-koenig@pengutronix.de>

Conflicts:
	arch/arm/mach-at91/board-neocore926.c
	arch/arm/mach-at91/board-sam9261ek.c
	arch/arm/mach-at91/board-sam9263ek.c
	arch/arm/mach-at91/board-sam9m10g45ek.c
	arch/arm/mach-at91/board-sam9rlek.c
---
 arch/arm/mach-at91/at91sam9261_devices.c           |   4 +-
 arch/arm/mach-at91/at91sam9263_devices.c           |   4 +-
 arch/arm/mach-at91/at91sam9g45_devices.c           |   4 +-
 arch/arm/mach-at91/at91sam9rl_devices.c            |   4 +-
 arch/arm/mach-at91/board-neocore926.c              |   4 +-
 arch/arm/mach-at91/board-sam9261ek.c               |   4 +-
 arch/arm/mach-at91/board-sam9263ek.c               |   4 +-
 arch/arm/mach-at91/board-sam9m10g45ek.c            |   4 +-
 arch/arm/mach-at91/board-sam9rlek.c                |   4 +-
 .../include/mach/{atmel_hlcdfb.h => atmel_hlcdc.h} | 157 +--------------------
 arch/arm/mach-at91/include/mach/atmel_hlcdc_ovl.h  | 156 ++++++++++++++++++++
 .../arm/mach-at91/include/mach}/atmel_lcdc.h       |  77 +---------
 drivers/video/atmel_lcdfb.c                        |   3 +-
 drivers/video/atmel_lcdfb_core.c                   |   2 +-
 include/video/atmel_lcdfb.h                        | 100 +++++++++++++
 15 files changed, 294 insertions(+), 237 deletions(-)
 rename arch/arm/mach-at91/include/mach/{atmel_hlcdfb.h => atmel_hlcdc.h} (82%)
 create mode 100644 arch/arm/mach-at91/include/mach/atmel_hlcdc_ovl.h
 rename {include/video => arch/arm/mach-at91/include/mach}/atmel_lcdc.h (73%)
 create mode 100644 include/video/atmel_lcdfb.h

diff --git a/arch/arm/mach-at91/at91sam9261_devices.c b/arch/arm/mach-at91/at91sam9261_devices.c
index 8df5c1b..1eecff8 100644
--- a/arch/arm/mach-at91/at91sam9261_devices.c
+++ b/arch/arm/mach-at91/at91sam9261_devices.c
@@ -19,9 +19,11 @@
 #include <linux/i2c-gpio.h>
 
 #include <linux/fb.h>
-#include <video/atmel_lcdc.h>
+#include <video/atmel_lcdfb.h>
 
 #include <mach/board.h>
+#include <mach/gpio.h>
+#include <mach/atmel_lcdc.h>
 #include <mach/at91sam9261.h>
 #include <mach/at91sam9261_matrix.h>
 #include <mach/at91_matrix.h>
diff --git a/arch/arm/mach-at91/at91sam9263_devices.c b/arch/arm/mach-at91/at91sam9263_devices.c
index eb6bbf8..f0318e9 100644
--- a/arch/arm/mach-at91/at91sam9263_devices.c
+++ b/arch/arm/mach-at91/at91sam9263_devices.c
@@ -18,9 +18,11 @@
 #include <linux/i2c-gpio.h>
 
 #include <linux/fb.h>
-#include <video/atmel_lcdc.h>
+#include <video/atmel_lcdfb.h>
 
 #include <mach/board.h>
+#include <mach/gpio.h>
+#include <mach/atmel_lcdc.h>
 #include <mach/at91sam9263.h>
 #include <mach/at91sam9263_matrix.h>
 #include <mach/at91_matrix.h>
diff --git a/arch/arm/mach-at91/at91sam9g45_devices.c b/arch/arm/mach-at91/at91sam9g45_devices.c
index 7ab7e06..73eb743 100644
--- a/arch/arm/mach-at91/at91sam9g45_devices.c
+++ b/arch/arm/mach-at91/at91sam9g45_devices.c
@@ -20,9 +20,11 @@
 #include <linux/atmel-mci.h>
 
 #include <linux/fb.h>
-#include <video/atmel_lcdc.h>
+#include <video/atmel_lcdfb.h>
 
 #include <mach/board.h>
+#include <mach/gpio.h>
+#include <mach/atmel_lcdc.h>
 #include <mach/at91sam9g45.h>
 #include <mach/at91sam9g45_matrix.h>
 #include <mach/at91_matrix.h>
diff --git a/arch/arm/mach-at91/at91sam9rl_devices.c b/arch/arm/mach-at91/at91sam9rl_devices.c
index f09fff9..0d1b76f 100644
--- a/arch/arm/mach-at91/at91sam9rl_devices.c
+++ b/arch/arm/mach-at91/at91sam9rl_devices.c
@@ -15,9 +15,11 @@
 #include <linux/i2c-gpio.h>
 
 #include <linux/fb.h>
-#include <video/atmel_lcdc.h>
+#include <video/atmel_lcdfb.h>
 
 #include <mach/board.h>
+#include <mach/gpio.h>
+#include <mach/atmel_lcdc.h>
 #include <mach/at91sam9rl.h>
 #include <mach/at91sam9rl_matrix.h>
 #include <mach/at91_matrix.h>
diff --git a/arch/arm/mach-at91/board-neocore926.c b/arch/arm/mach-at91/board-neocore926.c
index 18103c5d..5d3b4d6 100644
--- a/arch/arm/mach-at91/board-neocore926.c
+++ b/arch/arm/mach-at91/board-neocore926.c
@@ -32,7 +32,7 @@
 #include <linux/gpio_keys.h>
 #include <linux/input.h>
 
-#include <video/atmel_lcdc.h>
+#include <video/atmel_lcdfb.h>
 
 #include <asm/setup.h>
 #include <asm/mach-types.h>
@@ -46,6 +46,8 @@
 #include <mach/hardware.h>
 #include <mach/board.h>
 #include <mach/at91_aic.h>
+#include <mach/gpio.h>
+#include <mach/atmel_lcdc.h>
 #include <mach/at91sam9_smc.h>
 
 #include "sam9_smc.h"
diff --git a/arch/arm/mach-at91/board-sam9261ek.c b/arch/arm/mach-at91/board-sam9261ek.c
index 2269be5..2e1c9c5 100644
--- a/arch/arm/mach-at91/board-sam9261ek.c
+++ b/arch/arm/mach-at91/board-sam9261ek.c
@@ -34,7 +34,7 @@
 #include <linux/gpio_keys.h>
 #include <linux/input.h>
 
-#include <video/atmel_lcdc.h>
+#include <video/atmel_lcdfb.h>
 
 #include <asm/setup.h>
 #include <asm/mach-types.h>
@@ -47,6 +47,8 @@
 #include <mach/hardware.h>
 #include <mach/board.h>
 #include <mach/at91_aic.h>
+#include <mach/gpio.h>
+#include <mach/atmel_lcdc.h>
 #include <mach/at91sam9_smc.h>
 #include <mach/at91_shdwc.h>
 #include <mach/system_rev.h>
diff --git a/arch/arm/mach-at91/board-sam9263ek.c b/arch/arm/mach-at91/board-sam9263ek.c
index 82adf58..7c34908 100644
--- a/arch/arm/mach-at91/board-sam9263ek.c
+++ b/arch/arm/mach-at91/board-sam9263ek.c
@@ -33,7 +33,7 @@
 #include <linux/input.h>
 #include <linux/leds.h>
 
-#include <video/atmel_lcdc.h>
+#include <video/atmel_lcdfb.h>
 
 #include <asm/setup.h>
 #include <asm/mach-types.h>
@@ -46,6 +46,8 @@
 #include <mach/hardware.h>
 #include <mach/board.h>
 #include <mach/at91_aic.h>
+#include <mach/gpio.h>
+#include <mach/atmel_lcdc.h>
 #include <mach/at91sam9_smc.h>
 #include <mach/at91_shdwc.h>
 #include <mach/system_rev.h>
diff --git a/arch/arm/mach-at91/board-sam9m10g45ek.c b/arch/arm/mach-at91/board-sam9m10g45ek.c
index d1882d5..78210f6 100644
--- a/arch/arm/mach-at91/board-sam9m10g45ek.c
+++ b/arch/arm/mach-at91/board-sam9m10g45ek.c
@@ -28,7 +28,7 @@
 #include <linux/delay.h>
 
 #include <mach/hardware.h>
-#include <video/atmel_lcdc.h>
+#include <video/atmel_lcdfb.h>
 #include <media/soc_camera.h>
 #include <media/atmel-isi.h>
 
@@ -42,6 +42,8 @@
 
 #include <mach/board.h>
 #include <mach/at91_aic.h>
+#include <mach/gpio.h>
+#include <mach/atmel_lcdc.h>
 #include <mach/at91sam9_smc.h>
 #include <mach/at91_shdwc.h>
 #include <mach/system_rev.h>
diff --git a/arch/arm/mach-at91/board-sam9rlek.c b/arch/arm/mach-at91/board-sam9rlek.c
index e7dc3ea..81d82be 100644
--- a/arch/arm/mach-at91/board-sam9rlek.c
+++ b/arch/arm/mach-at91/board-sam9rlek.c
@@ -19,7 +19,7 @@
 #include <linux/input.h>
 #include <linux/gpio_keys.h>
 
-#include <video/atmel_lcdc.h>
+#include <video/atmel_lcdfb.h>
 
 #include <asm/setup.h>
 #include <asm/mach-types.h>
@@ -32,6 +32,8 @@
 #include <mach/hardware.h>
 #include <mach/board.h>
 #include <mach/at91_aic.h>
+#include <mach/gpio.h>
+#include <mach/atmel_lcdc.h>
 #include <mach/at91sam9_smc.h>
 #include <mach/at91_shdwc.h>
 
diff --git a/arch/arm/mach-at91/include/mach/atmel_hlcdfb.h b/arch/arm/mach-at91/include/mach/atmel_hlcdc.h
similarity index 82%
rename from arch/arm/mach-at91/include/mach/atmel_hlcdfb.h
rename to arch/arm/mach-at91/include/mach/atmel_hlcdc.h
index a57b79b..9ed7e6e 100644
--- a/arch/arm/mach-at91/include/mach/atmel_hlcdfb.h
+++ b/arch/arm/mach-at91/include/mach/atmel_hlcdc.h
@@ -19,8 +19,8 @@
  * along with this program; if not, write to the Free Software
  * Foundation, Inc., 59 Temple Place, Suite 330, Boston, MA  02111-1307  USA
  */
-#ifndef __ATMEL_HLCD_H__
-#define __ATMEL_HLCD_H__
+#ifndef __MACH_ATMEL_HLCD_H__
+#define __MACH_ATMEL_HLCD_H__
 
 /* Lcdc hardware registers */
 #define ATMEL_LCDC_LCDCFG0	0x0000
@@ -145,7 +145,7 @@
 #define LCDC_LCDISR_FIFOERR		(0x1 << 4)
 #define LCDC_LCDISR_BASE		(0x1 << 8)
 #define LCDC_LCDISR_OVR1		(0x1 << 9)
-#define LCDC_LCDISR_HEO			(0x1 << 11)
+#define LCDC_LCDISR_HEO			(0x1 << 10)
 #define LCDC_LCDISR_HCR			(0x1 << 12)
 
 #define ATMEL_LCDC_BASECHER	0x0040
@@ -252,153 +252,6 @@
 #define LCDC_BASECFG4_DMA		(0x1 << 8)
 #define LCDC_BASECFG4_REP		(0x1 << 9)
 
-#define ATMEL_LCDC_OVRCHER1	0x0100
-#define LCDC_OVRCHER1_CHEN		(0x1 << 0)
-#define LCDC_OVRCHER1_UPDATEEN		(0x1 << 1)
-#define LCDC_OVRCHER1_A2QEN		(0x1 << 2)
-
-#define ATMEL_LCDC_OVRCHDR1	0x0104
-#define LCDC_OVRCHDR1_CHDIS		(0x1 << 0)
-#define LCDC_OVRCHDR1_CHRST		(0x1 << 8)
-
-#define ATMEL_LCDC_OVRCHSR1	0x0108
-#define LCDC_OVRCHSR1_CHSR		(0x1 << 0)
-#define LCDC_OVRCHSR1_UPDATESR		(0x1 << 1)
-#define LCDC_OVRCHSR1_A2QSR		(0x1 << 2)
-
-#define ATMEL_LCDC_OVRIER1	0x010C
-#define LCDC_OVRIER1_DMA		(0x1 << 2)
-#define LCDC_OVRIER1_DSCR		(0x1 << 3)
-#define LCDC_OVRIER1_ADD		(0x1 << 4)
-#define LCDC_OVRIER1_DONE		(0x1 << 5)
-#define LCDC_OVRIER1_OVR		(0x1 << 6)
-
-#define ATMEL_LCDC_OVRIDR1	0x0110
-#define LCDC_OVRIDR1_DMA		(0x1 << 2)
-#define LCDC_OVRIDR1_DSCR		(0x1 << 3)
-#define LCDC_OVRIDR1_ADD		(0x1 << 4)
-#define LCDC_OVRIDR1_DONE		(0x1 << 5)
-#define LCDC_OVRIDR1_OVR		(0x1 << 6)
-
-#define ATMEL_LCDC_OVRIMR1	0x0114
-#define LCDC_OVRIMR1_DMA		(0x1 << 2)
-#define LCDC_OVRIMR1_DSCR		(0x1 << 3)
-#define LCDC_OVRIMR1_ADD		(0x1 << 4)
-#define LCDC_OVRIMR1_DONE		(0x1 << 5)
-#define LCDC_OVRIMR1_OVR		(0x1 << 6)
-
-#define ATMEL_LCDC_OVRISR1	0x0118
-#define LCDC_OVRISR1_DMA		(0x1 << 2)
-#define LCDC_OVRISR1_DSCR		(0x1 << 3)
-#define LCDC_OVRISR1_ADD		(0x1 << 4)
-#define LCDC_OVRISR1_DONE		(0x1 << 5)
-#define LCDC_OVRISR1_OVR		(0x1 << 6)
-
-#define ATMEL_LCDC_OVRHEAD1	0x011C
-
-#define ATMEL_LCDC_OVRADDR1	0x0120
-
-#define ATMEL_LCDC_OVRCTRL1	0x0124
-#define LCDC_OVRCTRL1_DFETCH		(0x1 << 0)
-#define LCDC_OVRCTRL1_LFETCH		(0x1 << 1)
-#define LCDC_OVRCTRL1_DMAIEN		(0x1 << 2)
-#define LCDC_OVRCTRL1_DSCRIEN		(0x1 << 3)
-#define LCDC_OVRCTRL1_ADDIEN		(0x1 << 4)
-#define LCDC_OVRCTRL1_DONEIEN		(0x1 << 5)
-
-#define ATMEL_LCDC_OVRNEXT1	0x0128
-
-#define ATMEL_LCDC_OVR1CFG0	0x012C
-#define LCDC_OVR1CFG0_BLEN_OFFSET	4
-#define LCDC_OVR1CFG0_BLEN		(0x3 << LCDC_OVR1CFG0_BLEN_OFFSET)
-#define		LCDC_OVR1CFG0_BLEN_AHB_SINGLE		(0x0 << 4)
-#define		LCDC_OVR1CFG0_BLEN_AHB_INCR4		(0x1 << 4)
-#define		LCDC_OVR1CFG0_BLEN_AHB_INCR8		(0x2 << 4)
-#define		LCDC_OVR1CFG0_BLEN_AHB_INCR16		(0x3 << 4)
-#define LCDC_OVR1CFG0_DLBO		(0x1 << 8)
-#define LCDC_OVR1CFG0_ROTDIS		(0x1 << 12)
-#define LCDC_OVR1CFG0_LOCKDIS		(0x1 << 13)
-
-#define ATMEL_LCDC_OVR1CFG1	0x0130
-#define LCDC_OVR1CFG1_CLUTEN		(0x1 << 0)
-#define LCDC_OVR1CFG1_RGBMODE_OFFSET	4
-#define LCDC_OVR1CFG1_RGBMODE		(0xf << LCDC_OVR1CFG1_RGBMODE_OFFSET)
-#define		LCDC_OVR1CFG1_RGBMODE_12BPP_RGB_444	(0x0 << 4)
-#define		LCDC_OVR1CFG1_RGBMODE_16BPP_ARGB_4444	(0x1 << 4)
-#define		LCDC_OVR1CFG1_RGBMODE_16BPP_RGBA_4444	(0x2 << 4)
-#define		LCDC_OVR1CFG1_RGBMODE_16BPP_RGB_565	(0x3 << 4)
-#define		LCDC_OVR1CFG1_RGBMODE_16BPP_TRGB_1555	(0x4 << 4)
-#define		LCDC_OVR1CFG1_RGBMODE_18BPP_RGB_666	(0x5 << 4)
-#define		LCDC_OVR1CFG1_RGBMODE_18BPP_RGB_666_PACKED	(0x6 << 4)
-#define		LCDC_OVR1CFG1_RGBMODE_19BPP_TRGB_1666	(0x7 << 4)
-#define		LCDC_OVR1CFG1_RGBMODE_19BPP_TRGB_PACKED	(0x8 << 4)
-#define		LCDC_OVR1CFG1_RGBMODE_24BPP_RGB_888	(0x9 << 4)
-#define		LCDC_OVR1CFG1_RGBMODE_24BPP_RGB_888_PACKED	(0xA << 4)
-#define		LCDC_OVR1CFG1_RGBMODE_25BPP_TRGB_1888	(0xB << 4)
-#define		LCDC_OVR1CFG1_RGBMODE_32BPP_ARGB_8888	(0xC << 4)
-#define		LCDC_OVR1CFG1_RGBMODE_32BPP_RGBA_8888	(0xD << 4)
-#define LCDC_OVR1CFG1_CLUTMODE_OFFSET	8
-#define LCDC_OVR1CFG1_CLUTMODE		(0x3 << LCDC_OVR1CFG1_CLUTMODE_OFFSET)
-#define		LCDC_OVR1CFG1_CLUTMODE_1BPP		(0x0 << 8)
-#define		LCDC_OVR1CFG1_CLUTMODE_2BPP		(0x1 << 8)
-#define		LCDC_OVR1CFG1_CLUTMODE_4BPP		(0x2 << 8)
-#define		LCDC_OVR1CFG1_CLUTMODE_8BPP		(0x3 << 8)
-
-#define ATMEL_LCDC_OVR1CFG2	0x0134
-#define LCDC_OVR1CFG2_XOFFSET_OFFSET	0
-#define LCDC_OVR1CFG2_XOFFSET		(0x7ff << LCDC_OVR1CFG2_XOFFSET_OFFSET)
-#define LCDC_OVR1CFG2_YOFFSET_OFFSET	16
-#define LCDC_OVR1CFG2_YOFFSET		(0x7ff << LCDC_OVR1CFG2_YOFFSET_OFFSET)
-
-#define ATMEL_LCDC_OVR1CFG3	0x0138
-#define LCDC_OVR1CFG3_XSIZE_OFFSET	0
-#define LCDC_OVR1CFG3_XSIZE		(0x7ff << LCDC_OVR1CFG3_XSIZE_OFFSET)
-#define LCDC_OVR1CFG3_YSIZE_OFFSET	16
-#define LCDC_OVR1CFG3_YSIZE		(0x7ff << LCDC_OVR1CFG3_YSIZE_OFFSET)
-
-#define ATMEL_LCDC_OVR1CFG4	0x013C
-
-#define ATMEL_LCDC_OVR1CFG5	0x0140
-
-#define ATMEL_LCDC_OVR1CFG6	0x0144
-#define LCDC_OVR1CFG6_BDEF_OFFSET	0
-#define LCDC_OVR1CFG6_BDEF		(0xff << LCDC_OVR1CFG6_BDEF_OFFSET)
-#define LCDC_OVR1CFG6_GDEF_OFFSET	8
-#define LCDC_OVR1CFG6_GDEF		(0xff << LCDC_OVR1CFG6_GDEF_OFFSET)
-#define LCDC_OVR1CFG6_RDEF_OFFSET	16
-#define LCDC_OVR1CFG6_RDEF		(0xff << LCDC_OVR1CFG6_RDEF_OFFSET)
-
-#define ATMEL_LCDC_OVR1CFG7	0x0148
-#define LCDC_OVR1CFG7_BKEY_OFFSET	0
-#define LCDC_OVR1CFG7_BKEY		(0xff << LCDC_OVR1CFG7_BKEY_OFFSET)
-#define LCDC_OVR1CFG7_GKEY_OFFSET	8
-#define LCDC_OVR1CFG7_GKEY		(0xff << LCDC_OVR1CFG7_GKEY_OFFST)
-#define LCDC_OVR1CFG7_RKEY_OFFSET	16
-#define LCDC_OVR1CFG7_RKEY		(0xff << LCDC_OVR1CFG7_RKEY_OFFSET)
-
-#define ATMEL_LCDC_OVR1CFG8	0x014C
-#define LCDC_OVR1CFG8_BMASK_OFFSET	0
-#define LCDC_OVR1CFG8_BMASK		(0xff << LCDC_OVR1CFG8_BMASK_OFFSET)
-#define LCDC_OVR1CFG8_GMASK_OFFSET	8
-#define LCDC_OVR1CFG8_GMASK		(0xff << LCDC_OVR1CFG8_GMASK_OFFSET)
-#define LCDC_OVR1CFG8_RMASK_OFFSET	16
-#define LCDC_OVR1CFG8_RMASK		(0xff << LCDC_OVR1CFG8_RMASK_OFFSET)
-
-#define ATMEL_LCDC_OVR1CFG9	0x0150
-#define LCDC_OVR1CFG9_CRKEY		(0x1 << 0)
-#define LCDC_OVR1CFG9_INV		(0x1 << 1)
-#define LCDC_OVR1CFG9_ITER2BL		(0x1 << 2)
-#define LCDC_OVR1CFG9_ITER		(0x1 << 3)
-#define LCDC_OVR1CFG9_REVALPHA		(0x1 << 4)
-#define LCDC_OVR1CFG9_GAEN		(0x1 << 5)
-#define LCDC_OVR1CFG9_LAEN		(0x1 << 6)
-#define LCDC_OVR1CFG9_OVR		(0x1 << 7)
-#define LCDC_OVR1CFG9_DMA		(0x1 << 8)
-#define LCDC_OVR1CFG9_REP		(0x1 << 9)
-#define LCDC_OVR1CFG9_DSTKEY		(0x1 << 10)
-#define LCDC_OVR1CFG9_GA_OFFSET		16
-#define LCDC_OVR1CFG9_GA		(0xff << LCDC_OVR1CFG9_GA_OFFSET)
-
 #define ATMEL_LCDC_HEOCHER	0x0280
 #define LCDC_HEOCHER_CHEN		(0x1 << 0)
 #define LCDC_HEOCHER_UPDATEEN		(0x1 << 1)
@@ -859,7 +712,7 @@
 #define LCDC_HCRCLUT_ACLUT		(0xff << LCDC_HCRCLUT_ACLUT_OFFSET)
 
 /* Base layer CLUT */
-#define ATMEL_LCDC_LUT(n)	(0x0400 + ((n)*4))
+#define ATMEL_HLCDC_LUT			0x0400
 
 
-#endif /* __ATMEL_HLCDC4_H__ */
+#endif /* __MACH_ATMEL_HLCDC4_H__ */
diff --git a/arch/arm/mach-at91/include/mach/atmel_hlcdc_ovl.h b/arch/arm/mach-at91/include/mach/atmel_hlcdc_ovl.h
new file mode 100644
index 0000000..4416403
--- /dev/null
+++ b/arch/arm/mach-at91/include/mach/atmel_hlcdc_ovl.h
@@ -0,0 +1,156 @@
+#ifndef __MACH_ATMEL_HLCD_OVL_H__
+#define __MACH_ATMEL_HLCD_OVL_H__
+
+/*
+ * OVL has a seperate resource which already starts at offset 0x100.
+ * So, these defines start at 0x0. The manual will list them at 0x100.
+ */
+
+#define ATMEL_LCDC_OVRCHER1	0x0000
+#define LCDC_OVRCHER1_CHEN		(0x1 << 0)
+#define LCDC_OVRCHER1_UPDATEEN		(0x1 << 1)
+#define LCDC_OVRCHER1_A2QEN		(0x1 << 2)
+
+#define ATMEL_LCDC_OVRCHDR1	0x0004
+#define LCDC_OVRCHDR1_CHDIS		(0x1 << 0)
+#define LCDC_OVRCHDR1_CHRST		(0x1 << 8)
+
+#define ATMEL_LCDC_OVRCHSR1	0x0008
+#define LCDC_OVRCHSR1_CHSR		(0x1 << 0)
+#define LCDC_OVRCHSR1_UPDATESR		(0x1 << 1)
+#define LCDC_OVRCHSR1_A2QSR		(0x1 << 2)
+
+#define ATMEL_LCDC_OVRIER1	0x000C
+#define LCDC_OVRIER1_DMA		(0x1 << 2)
+#define LCDC_OVRIER1_DSCR		(0x1 << 3)
+#define LCDC_OVRIER1_ADD		(0x1 << 4)
+#define LCDC_OVRIER1_DONE		(0x1 << 5)
+#define LCDC_OVRIER1_OVR		(0x1 << 6)
+
+#define ATMEL_LCDC_OVRIDR1	0x0010
+#define LCDC_OVRIDR1_DMA		(0x1 << 2)
+#define LCDC_OVRIDR1_DSCR		(0x1 << 3)
+#define LCDC_OVRIDR1_ADD		(0x1 << 4)
+#define LCDC_OVRIDR1_DONE		(0x1 << 5)
+#define LCDC_OVRIDR1_OVR		(0x1 << 6)
+
+#define ATMEL_LCDC_OVRIMR1	0x0014
+#define LCDC_OVRIMR1_DMA		(0x1 << 2)
+#define LCDC_OVRIMR1_DSCR		(0x1 << 3)
+#define LCDC_OVRIMR1_ADD		(0x1 << 4)
+#define LCDC_OVRIMR1_DONE		(0x1 << 5)
+#define LCDC_OVRIMR1_OVR		(0x1 << 6)
+
+#define ATMEL_LCDC_OVRISR1	0x0018
+#define LCDC_OVRISR1_DMA		(0x1 << 2)
+#define LCDC_OVRISR1_DSCR		(0x1 << 3)
+#define LCDC_OVRISR1_ADD		(0x1 << 4)
+#define LCDC_OVRISR1_DONE		(0x1 << 5)
+#define LCDC_OVRISR1_OVR		(0x1 << 6)
+
+#define ATMEL_LCDC_OVRHEAD1	0x001C
+
+#define ATMEL_LCDC_OVRADDR1	0x0020
+
+#define ATMEL_LCDC_OVRCTRL1	0x0024
+#define LCDC_OVRCTRL1_DFETCH		(0x1 << 0)
+#define LCDC_OVRCTRL1_LFETCH		(0x1 << 1)
+#define LCDC_OVRCTRL1_DMAIEN		(0x1 << 2)
+#define LCDC_OVRCTRL1_DSCRIEN		(0x1 << 3)
+#define LCDC_OVRCTRL1_ADDIEN		(0x1 << 4)
+#define LCDC_OVRCTRL1_DONEIEN		(0x1 << 5)
+
+#define ATMEL_LCDC_OVRNEXT1	0x0028
+
+#define ATMEL_LCDC_OVR1CFG0	0x002C
+#define LCDC_OVR1CFG0_BLEN_OFFSET	4
+#define LCDC_OVR1CFG0_BLEN		(0x3 << LCDC_OVR1CFG0_BLEN_OFFSET)
+#define		LCDC_OVR1CFG0_BLEN_AHB_SINGLE		(0x0 << 4)
+#define		LCDC_OVR1CFG0_BLEN_AHB_INCR4		(0x1 << 4)
+#define		LCDC_OVR1CFG0_BLEN_AHB_INCR8		(0x2 << 4)
+#define		LCDC_OVR1CFG0_BLEN_AHB_INCR16		(0x3 << 4)
+#define LCDC_OVR1CFG0_DLBO		(0x1 << 8)
+#define LCDC_OVR1CFG0_ROTDIS		(0x1 << 12)
+#define LCDC_OVR1CFG0_LOCKDIS		(0x1 << 13)
+
+#define ATMEL_LCDC_OVR1CFG1	0x0030
+#define LCDC_OVR1CFG1_CLUTEN		(0x1 << 0)
+#define LCDC_OVR1CFG1_RGBMODE_OFFSET	4
+#define LCDC_OVR1CFG1_RGBMODE		(0xf << LCDC_OVR1CFG1_RGBMODE_OFFSET)
+#define		LCDC_OVR1CFG1_RGBMODE_12BPP_RGB_444	(0x0 << 4)
+#define		LCDC_OVR1CFG1_RGBMODE_16BPP_ARGB_4444	(0x1 << 4)
+#define		LCDC_OVR1CFG1_RGBMODE_16BPP_RGBA_4444	(0x2 << 4)
+#define		LCDC_OVR1CFG1_RGBMODE_16BPP_RGB_565	(0x3 << 4)
+#define		LCDC_OVR1CFG1_RGBMODE_16BPP_TRGB_1555	(0x4 << 4)
+#define		LCDC_OVR1CFG1_RGBMODE_18BPP_RGB_666	(0x5 << 4)
+#define		LCDC_OVR1CFG1_RGBMODE_18BPP_RGB_666_PACKED	(0x6 << 4)
+#define		LCDC_OVR1CFG1_RGBMODE_19BPP_TRGB_1666	(0x7 << 4)
+#define		LCDC_OVR1CFG1_RGBMODE_19BPP_TRGB_PACKED	(0x8 << 4)
+#define		LCDC_OVR1CFG1_RGBMODE_24BPP_RGB_888	(0x9 << 4)
+#define		LCDC_OVR1CFG1_RGBMODE_24BPP_RGB_888_PACKED	(0xA << 4)
+#define		LCDC_OVR1CFG1_RGBMODE_25BPP_TRGB_1888	(0xB << 4)
+#define		LCDC_OVR1CFG1_RGBMODE_32BPP_ARGB_8888	(0xC << 4)
+#define		LCDC_OVR1CFG1_RGBMODE_32BPP_RGBA_8888	(0xD << 4)
+#define LCDC_OVR1CFG1_CLUTMODE_OFFSET	8
+#define LCDC_OVR1CFG1_CLUTMODE		(0x3 << LCDC_OVR1CFG1_CLUTMODE_OFFSET)
+#define		LCDC_OVR1CFG1_CLUTMODE_1BPP		(0x0 << 8)
+#define		LCDC_OVR1CFG1_CLUTMODE_2BPP		(0x1 << 8)
+#define		LCDC_OVR1CFG1_CLUTMODE_4BPP		(0x2 << 8)
+#define		LCDC_OVR1CFG1_CLUTMODE_8BPP		(0x3 << 8)
+
+#define ATMEL_LCDC_OVR1CFG2	0x0034
+#define LCDC_OVR1CFG2_XOFFSET_OFFSET	0
+#define LCDC_OVR1CFG2_XOFFSET		(0x7ff << LCDC_OVR1CFG2_XOFFSET_OFFSET)
+#define LCDC_OVR1CFG2_YOFFSET_OFFSET	16
+#define LCDC_OVR1CFG2_YOFFSET		(0x7ff << LCDC_OVR1CFG2_YOFFSET_OFFSET)
+
+#define ATMEL_LCDC_OVR1CFG3	0x0038
+#define LCDC_OVR1CFG3_XSIZE_OFFSET	0
+#define LCDC_OVR1CFG3_XSIZE		(0x7ff << LCDC_OVR1CFG3_XSIZE_OFFSET)
+#define LCDC_OVR1CFG3_YSIZE_OFFSET	16
+#define LCDC_OVR1CFG3_YSIZE		(0x7ff << LCDC_OVR1CFG3_YSIZE_OFFSET)
+
+#define ATMEL_LCDC_OVR1CFG4	0x003C
+
+#define ATMEL_LCDC_OVR1CFG5	0x0040
+
+#define ATMEL_LCDC_OVR1CFG6	0x0044
+#define LCDC_OVR1CFG6_BDEF_OFFSET	0
+#define LCDC_OVR1CFG6_BDEF		(0xff << LCDC_OVR1CFG6_BDEF_OFFSET)
+#define LCDC_OVR1CFG6_GDEF_OFFSET	8
+#define LCDC_OVR1CFG6_GDEF		(0xff << LCDC_OVR1CFG6_GDEF_OFFSET)
+#define LCDC_OVR1CFG6_RDEF_OFFSET	16
+#define LCDC_OVR1CFG6_RDEF		(0xff << LCDC_OVR1CFG6_RDEF_OFFSET)
+
+#define ATMEL_LCDC_OVR1CFG7	0x0048
+#define LCDC_OVR1CFG7_BKEY_OFFSET	0
+#define LCDC_OVR1CFG7_BKEY		(0xff << LCDC_OVR1CFG7_BKEY_OFFSET)
+#define LCDC_OVR1CFG7_GKEY_OFFSET	8
+#define LCDC_OVR1CFG7_GKEY		(0xff << LCDC_OVR1CFG7_GKEY_OFFST)
+#define LCDC_OVR1CFG7_RKEY_OFFSET	16
+#define LCDC_OVR1CFG7_RKEY		(0xff << LCDC_OVR1CFG7_RKEY_OFFSET)
+
+#define ATMEL_LCDC_OVR1CFG8	0x004C
+#define LCDC_OVR1CFG8_BMASK_OFFSET	0
+#define LCDC_OVR1CFG8_BMASK		(0xff << LCDC_OVR1CFG8_BMASK_OFFSET)
+#define LCDC_OVR1CFG8_GMASK_OFFSET	8
+#define LCDC_OVR1CFG8_GMASK		(0xff << LCDC_OVR1CFG8_GMASK_OFFSET)
+#define LCDC_OVR1CFG8_RMASK_OFFSET	16
+#define LCDC_OVR1CFG8_RMASK		(0xff << LCDC_OVR1CFG8_RMASK_OFFSET)
+
+#define ATMEL_LCDC_OVR1CFG9	0x0050
+#define LCDC_OVR1CFG9_CRKEY		(0x1 << 0)
+#define LCDC_OVR1CFG9_INV		(0x1 << 1)
+#define LCDC_OVR1CFG9_ITER2BL		(0x1 << 2)
+#define LCDC_OVR1CFG9_ITER		(0x1 << 3)
+#define LCDC_OVR1CFG9_REVALPHA		(0x1 << 4)
+#define LCDC_OVR1CFG9_GAEN		(0x1 << 5)
+#define LCDC_OVR1CFG9_LAEN		(0x1 << 6)
+#define LCDC_OVR1CFG9_OVR		(0x1 << 7)
+#define LCDC_OVR1CFG9_DMA		(0x1 << 8)
+#define LCDC_OVR1CFG9_REP		(0x1 << 9)
+#define LCDC_OVR1CFG9_DSTKEY		(0x1 << 10)
+#define LCDC_OVR1CFG9_GA_OFFSET		16
+#define LCDC_OVR1CFG9_GA		(0xff << LCDC_OVR1CFG9_GA_OFFSET)
+
+#endif /* __MACH_ATMEL_HLCD_OVL_H__ */
diff --git a/include/video/atmel_lcdc.h b/arch/arm/mach-at91/include/mach/atmel_lcdc.h
similarity index 73%
rename from include/video/atmel_lcdc.h
rename to arch/arm/mach-at91/include/mach/atmel_lcdc.h
index 6031b5a..248fed3 100644
--- a/include/video/atmel_lcdc.h
+++ b/arch/arm/mach-at91/include/mach/atmel_lcdc.h
@@ -19,79 +19,8 @@
  * along with this program; if not, write to the Free Software
  * Foundation, Inc., 59 Temple Place, Suite 330, Boston, MA  02111-1307  USA
  */
-#ifndef __ATMEL_LCDC_H__
-#define __ATMEL_LCDC_H__
-
-#include <linux/workqueue.h>
-#include <linux/interrupt.h>
-#include <linux/backlight.h>
-
-/* Way LCD wires are connected to the chip:
- * Some Atmel chips use BGR color mode (instead of standard RGB)
- * A swapped wiring onboard can bring to RGB mode.
- */
-#define ATMEL_LCDC_WIRING_BGR	0
-#define ATMEL_LCDC_WIRING_RGB	1
-#define ATMEL_LCDC_WIRING_RGB555	2
-
-#define ATMEL_LCDC_STOP_NOWAIT (1 << 0)
-
-extern void atmel_lcdfb_start_clock(struct atmel_lcdfb_info *sinfo);
-extern void atmel_lcdfb_stop_clock(struct atmel_lcdfb_info *sinfo);
-extern int __atmel_lcdfb_probe(struct platform_device *pdev,
-				struct atmel_lcdfb_devdata *devdata);
-extern int __atmel_lcdfb_remove(struct platform_device *pdev);
-
-struct atmel_lcdfb_info;
-
-struct atmel_lcdfb_devdata {
-	int (*setup_core)(struct fb_info *info);
-	void (*start)(struct atmel_lcdfb_info *sinfo);
-	void (*stop)(struct atmel_lcdfb_info *sinfo, u32 flags);
-	irqreturn_t (*isr)(int irq, void *dev_id);
-	void (*update_dma)(struct fb_info *info, struct fb_var_screeninfo *var);
-	void (*init_contrast)(struct atmel_lcdfb_info *sinfo);
-	void (*limit_screeninfo)(struct fb_var_screeninfo *var);
-	const struct backlight_ops *bl_ops;
-	int fbinfo_flags;
-	u32 lut_base;
-};
-
- /* LCD Controller info data structure, stored in device platform_data */
-struct atmel_lcdfb_info {
-	spinlock_t		lock;
-	struct fb_info		*info;
-	void __iomem		*mmio;
-	int			irq_base;
-	struct atmel_lcdfb_devdata *dev_data;
-	struct work_struct	task;
-
-	unsigned int		guard_time;
-	unsigned int 		smem_len;
-	struct platform_device	*pdev;
-	struct clk		*bus_clk;
-	struct clk		*lcdc_clk;
-
-#ifdef CONFIG_BACKLIGHT_ATMEL_LCDC
-	struct backlight_device	*backlight;
-	u8			bl_power;
-#endif
-	bool			lcdcon_is_backlight;
-	bool			lcdcon_pol_negative;
-	bool			alpha_enabled;
-	u8			saved_lcdcon;
-
-	u8			default_bpp;
-	u8			lcd_wiring_mode;
-	unsigned int		default_lcdcon2;
-	unsigned int		default_dmacon;
-	void (*atmel_lcdfb_power_control)(int on);
-	struct fb_monspecs	*default_monspecs;
-	u32			pseudo_palette[16];
-};
-
-#define lcdc_readl(sinfo, reg)		__raw_readl((sinfo)->mmio+(reg))
-#define lcdc_writel(sinfo, reg, val)	__raw_writel((val), (sinfo)->mmio+(reg))
+#ifndef __MACH_ATMEL_LCDC_H__
+#define __MACH_ATMEL_LCDC_H__
 
 #define ATMEL_LCDC_DMABADDR1	0x00
 #define ATMEL_LCDC_DMABADDR2	0x04
@@ -245,4 +174,4 @@ struct atmel_lcdfb_info {
 
 #define ATMEL_LCDC_LUT		0x0c00
 
-#endif /* __ATMEL_LCDC_H__ */
+#endif /* __MACH_ATMEL_LCDC_H__ */
diff --git a/drivers/video/atmel_lcdfb.c b/drivers/video/atmel_lcdfb.c
index 7a48e9c..8d7992c 100644
--- a/drivers/video/atmel_lcdfb.c
+++ b/drivers/video/atmel_lcdfb.c
@@ -19,8 +19,9 @@
 
 #include <mach/board.h>
 #include <mach/cpu.h>
+#include <mach/atmel_lcdc.h>
 
-#include <video/atmel_lcdc.h>
+#include <video/atmel_lcdfb.h>
 
 /* configurable parameters */
 #define ATMEL_LCDC_CVAL_DEFAULT		0xc8
diff --git a/drivers/video/atmel_lcdfb_core.c b/drivers/video/atmel_lcdfb_core.c
index 20a4e4f..060d41f 100644
--- a/drivers/video/atmel_lcdfb_core.c
+++ b/drivers/video/atmel_lcdfb_core.c
@@ -22,7 +22,7 @@
 #include <mach/cpu.h>
 #include <mach/gpio.h>
 
-#include <video/atmel_lcdc.h>
+#include <video/atmel_lcdfb.h>
 
 /* configurable parameters */
 #define ATMEL_LCDC_CVAL_DEFAULT		0xc8
diff --git a/include/video/atmel_lcdfb.h b/include/video/atmel_lcdfb.h
new file mode 100644
index 0000000..3a0dfc7
--- /dev/null
+++ b/include/video/atmel_lcdfb.h
@@ -0,0 +1,100 @@
+/*
+ *  Header file for AT91/AT32 LCD Controller
+ *
+ *  Data structure and register user interface
+ *
+ *  Copyright (C) 2007 Atmel Corporation
+ *
+ * This program is free software; you can redistribute it and/or modify
+ * it under the terms of the GNU General Public License as published by
+ * the Free Software Foundation; either version 2 of the License, or
+ * (at your option) any later version.
+ *
+ * This program is distributed in the hope that it will be useful,
+ * but WITHOUT ANY WARRANTY; without even the implied warranty of
+ * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
+ * GNU General Public License for more details.
+ *
+ * You should have received a copy of the GNU General Public License
+ * along with this program; if not, write to the Free Software
+ * Foundation, Inc., 59 Temple Place, Suite 330, Boston, MA  02111-1307  USA
+ */
+#ifndef __ATMEL_LCDC_H__
+#define __ATMEL_LCDC_H__
+
+#include <linux/workqueue.h>
+#include <linux/interrupt.h>
+#include <linux/backlight.h>
+
+/* Way LCD wires are connected to the chip:
+ * Some Atmel chips use BGR color mode (instead of standard RGB)
+ * A swapped wiring onboard can bring to RGB mode.
+ */
+#define ATMEL_LCDC_WIRING_BGR	0
+#define ATMEL_LCDC_WIRING_RGB	1
+#define ATMEL_LCDC_WIRING_RGB555	2
+
+#define ATMEL_LCDC_STOP_NOWAIT (1 << 0)
+
+struct atmel_lcdfb_info;
+
+struct atmel_lcdfb_devdata {
+	int (*setup_core)(struct fb_info *info);
+	void (*start)(struct atmel_lcdfb_info *sinfo);
+	void (*stop)(struct atmel_lcdfb_info *sinfo, u32 flags);
+	irqreturn_t (*isr)(int irq, void *dev_id);
+	void (*update_dma)(struct fb_info *info, struct fb_var_screeninfo *var);
+	void (*init_contrast)(struct atmel_lcdfb_info *sinfo);
+	void (*limit_screeninfo)(struct fb_var_screeninfo *var);
+	const struct backlight_ops *bl_ops;
+	int fbinfo_flags;
+	u32 lut_base;
+	int dma_desc_size;
+};
+
+extern void atmel_lcdfb_start_clock(struct atmel_lcdfb_info *sinfo);
+extern void atmel_lcdfb_stop_clock(struct atmel_lcdfb_info *sinfo);
+extern int __atmel_lcdfb_probe(struct platform_device *pdev,
+				struct atmel_lcdfb_devdata *devdata);
+extern int __atmel_lcdfb_remove(struct platform_device *pdev);
+
+ /* LCD Controller info data structure, stored in device platform_data */
+struct atmel_lcdfb_info {
+	spinlock_t		lock;
+	struct fb_info		*info;
+	void __iomem		*mmio;
+	int			irq_base;
+	struct atmel_lcdfb_devdata *dev_data;
+	struct work_struct	task;
+
+	void			*dma_desc;
+	dma_addr_t		dma_desc_phys;
+
+	unsigned int		guard_time;
+	unsigned int 		smem_len;
+	struct platform_device	*pdev;
+	struct clk		*bus_clk;
+	struct clk		*lcdc_clk;
+
+#ifdef CONFIG_BACKLIGHT_ATMEL_LCDC
+	struct backlight_device	*backlight;
+	u8			bl_power;
+#endif
+	bool			lcdcon_is_backlight;
+	bool			lcdcon_pol_negative;
+	bool			alpha_enabled;
+	u8			saved_lcdcon;
+
+	u8			default_bpp;
+	u8			lcd_wiring_mode;
+	unsigned int		default_lcdcon2;
+	unsigned int		default_dmacon;
+	void (*atmel_lcdfb_power_control)(int on);
+	struct fb_monspecs	*default_monspecs;
+	u32			pseudo_palette[16];
+};
+
+#define lcdc_readl(sinfo, reg)		__raw_readl((sinfo)->mmio+(reg))
+#define lcdc_writel(sinfo, reg, val)	__raw_writel((val), (sinfo)->mmio+(reg))
+
+#endif /* __ATMEL_LCDC_H__ */
-- 
1.8.0.197.g5a90748

