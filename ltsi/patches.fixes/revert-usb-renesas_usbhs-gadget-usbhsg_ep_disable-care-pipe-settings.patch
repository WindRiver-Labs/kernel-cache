From ltsi-dev-bounces@lists.linuxfoundation.org Tue Feb 12 20:55:46 2013
From: Do Quang Thang <dq-thang@jinso.co.jp>
Date: Wed, 13 Feb 2013 13:23:49 +0900
Subject: [PATCH 01/10] Revert "usb: renesas_usbhs: gadget: usbhsg_ep_disable() care pipe settings"
To: ltsi-dev@lists.linuxfoundation.org
Message-ID: <1360729438-10731-2-git-send-email-dq-thang@jinso.co.jp>


This reverts commit 8983431340203180a6712d3ff3da6770a53cedca.

Signed-off-by: Kuninori Morimoto <kuninori.morimoto.gx@renesas.com>
Signed-off-by: Simon Horman <horms+renesas@verge.net.au>
Signed-off-by: Do Quang Thang <dq-thang@jinso.co.jp>
---
 drivers/usb/renesas_usbhs/mod_gadget.c |   11 +++--------
 1 file changed, 3 insertions(+), 8 deletions(-)

--- a/drivers/usb/renesas_usbhs/mod_gadget.c
+++ b/drivers/usb/renesas_usbhs/mod_gadget.c
@@ -597,12 +597,7 @@ static int usbhsg_ep_disable(struct usb_
 {
 	struct usbhsg_uep *uep = usbhsg_ep_to_uep(ep);
 
-	usbhsg_pipe_disable(uep);
-
-	uep->pipe->mod_private	= NULL;
-	uep->pipe		= NULL;
-
-	return 0;
+	return usbhsg_pipe_disable(uep);
 }
 
 static struct usb_request *usbhsg_ep_alloc_request(struct usb_ep *ep,
@@ -754,7 +749,7 @@ static int usbhsg_try_start(struct usbhs
 			usbhsg_dma_map_ctrl);
 	usbhs_fifo_init(priv);
 
-	/* dcp init instead of usbhsg_ep_enable() */
+	/* dcp init */
 	dcp->pipe		= usbhs_dcp_malloc(priv);
 	dcp->pipe->mod_private	= dcp;
 	usbhs_pipe_config_update(dcp->pipe, 0, 0, 64);
@@ -816,7 +811,7 @@ static int usbhsg_try_stop(struct usbhs_
 	usbhs_sys_set_test_mode(priv, 0);
 	usbhs_sys_function_ctrl(priv, 0);
 
-	usbhsg_ep_disable(&dcp->ep);
+	usbhsg_pipe_disable(dcp);
 
 	dev_dbg(dev, "stop gadget\n");
 
