From a7e83089b5f0772ba19e7e39900cbb7890a90459 Mon Sep 17 00:00:00 2001
From: Wang Hui <Hui.Wang@windriver.com>
Date: Thu, 4 Feb 2010 19:11:25 +0800
Subject: [PATCH] mx27/mach: add registration of ov2640 camera during platform init

Add platform data of camera ov2640 for eMMA camera drivers. add two
gpio configuration functions for eMMA camera drivers.

Signed-off-by: Wang Hui <Hui.Wang@windriver.com>
---
 arch/arm/mach-mx2/mx27ads.c |   34 ++++++++++++++++++++++++++++------
 1 files changed, 28 insertions(+), 6 deletions(-)

diff --git a/arch/arm/mach-mx2/mx27ads.c b/arch/arm/mach-mx2/mx27ads.c
index d7808d4..1945cfe 100644
--- a/arch/arm/mach-mx2/mx27ads.c
+++ b/arch/arm/mach-mx2/mx27ads.c
@@ -817,14 +817,21 @@ static struct imx_i2c_platform_data mx27ads_i2c_1_data = {
 	.exit = mx27ads_i2c_1_exit,
 };
 
-static struct soc_camera_link iclink = {
-	.bus_id = 0,
+/*!
+ * Data structures and data for ov2640 camera.
+ */
+static struct mxc_camera_platform_data camera_ov2640_data = {
+	.core_regulator = NULL,
+	.io_regulator = NULL,
+	.analog_regulator = NULL,
+	.gpo_regulator = NULL,
+	.mclk = 24000000,
 };
 
 static struct i2c_board_info mx27ads_i2c_devices[] = {
 	{
 		I2C_BOARD_INFO("ov2640", 0x30),
-		.platform_data = &iclink,
+		.platform_data = &camera_ov2640_data,
 		.type = "ov2640",
 	},
 	{
@@ -1792,7 +1799,7 @@ EXPORT_SYMBOL(gpio_owire_inactive);
 
 
 
-#ifdef CONFIG_VIDEO_MX27
+#ifdef CONFIG_VIDEO_MXC_EMMA_CAMERA
 static int mxc_csi_pins[] = {
 	PB10_PF_CSI_D0,
 	PB11_PF_CSI_D1,
@@ -1853,6 +1860,21 @@ static int mx27ads_camera_exit(struct platform_device *pdev)
 					    MXC_GPIO_ALLOC_MODE_RELEASE, "CSI");
 }
 
+/*!
+ * Setup GPIO for CSI device to be active
+ *
+ */
+void gpio_sensor_active(void)
+{
+	mx27ads_camera_init(&mx27_camera_device);
+}
+EXPORT_SYMBOL(gpio_sensor_active);
+void gpio_sensor_inactive(void)
+{
+	mx27ads_camera_exit(&mx27_camera_device);
+}
+EXPORT_SYMBOL(gpio_sensor_inactive);
+
 struct mx27_camera_platform_data mx27ads_camera = {
 	.init = mx27ads_camera_init,
 	.exit = mx27ads_camera_exit,
@@ -1926,7 +1948,7 @@ static void __init mx27ads_board_init(void)
 
 	mxc_init_extuart();
 
-#ifndef CONFIG_VIDEO_MX27
+#ifndef CONFIG_VIDEO_MXC_EMMA_CAMERA
 	/* CSI pins conflict with UART4 and UAT5 pins */
 	mxc_register_device(&mxc_uart_device4, &uart_pdata[4]);
 	mxc_register_device(&mxc_uart_device5, &uart_pdata[5]);
@@ -1976,7 +1998,7 @@ static void __init mx27ads_board_init(void)
 	}
 #endif
 
-#ifdef CONFIG_VIDEO_MX27
+#ifdef CONFIG_VIDEO_MXC_EMMA_CAMERA
 	mxc_register_device(&mx27_camera_device, &mx27ads_camera);
 #endif
 
-- 
1.6.0.4

