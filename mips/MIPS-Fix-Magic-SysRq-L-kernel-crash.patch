From 4c61f640d02408b5d0510f119422d78648b28ec2 Mon Sep 17 00:00:00 2001
From: Vincent Wen <vincentwenlinux@gmail.com>
Date: Thu, 19 Jul 2012 09:11:16 +0200
Subject: [PATCH] MIPS: Fix Magic SysRq L kernel crash.

commit: e909be825212da62433e805f03586015a04f3c78 upstream

show_backtrace() was passed a NULL pointer which caused paging
request fail. Set to current task as other architectures (ARM,
etc) do when passed a NULL task pointer.

Signed-off-by: Vincent Wen <vincentwenlinux@gmail.com>
Cc: linux-mips@linux-mips.org
Cc: cernekee@gmail.com
Patchwork: https://patchwork.linux-mips.org/patch/3524/
Signed-off-by: Ralf Baechle <ralf@linux-mips.org>
Integrated-by: Fan Du <fdu@windriver.com>
---
 arch/mips/kernel/traps.c |    3 +++
 1 files changed, 3 insertions(+), 0 deletions(-)

diff --git a/arch/mips/kernel/traps.c b/arch/mips/kernel/traps.c
index 7eb0d5c..9481477 100644
--- a/arch/mips/kernel/traps.c
+++ b/arch/mips/kernel/traps.c
@@ -121,6 +121,9 @@ static void show_backtrace(struct task_struct *task, const struct pt_regs *regs)
 	unsigned long ra = regs->regs[31];
 	unsigned long pc = regs->cp0_epc;
 
+	if (!task)
+		task = current;
+
 	if (raw_show_trace || !__kernel_text_address(pc)) {
 		show_raw_backtrace(sp);
 		return;
-- 
1.7.0.2

