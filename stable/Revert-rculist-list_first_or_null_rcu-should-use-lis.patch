From 9949505e84c260ead95fb7f79e72c2f732a3961c Mon Sep 17 00:00:00 2001
From: Paul Gortmaker <paul.gortmaker@windriver.com>
Date: Fri, 27 Sep 2013 09:17:26 -0400
Subject: [PATCH] Revert "rculist: list_first_or_null_rcu() should use
 list_entry_rcu()"

This reverts commit a7179b89a68c7cb6f8623cedcce02b98d9e072a1.

Unwind this and a macvlan commit containing RCU changes, so we can
really apply the upstream originals.

Signed-off-by: Paul Gortmaker <paul.gortmaker@windriver.com>
---
 include/linux/rculist.h | 5 ++---
 1 file changed, 2 insertions(+), 3 deletions(-)

diff --git a/include/linux/rculist.h b/include/linux/rculist.h
index 3863352..6f95e24 100644
--- a/include/linux/rculist.h
+++ b/include/linux/rculist.h
@@ -254,9 +254,8 @@ static inline void list_splice_init_rcu(struct list_head *list,
  */
 #define list_first_or_null_rcu(ptr, type, member) \
 	({struct list_head *__ptr = (ptr); \
-	  struct list_head *__next = ACCESS_ONCE(__ptr->next); \
-	  likely(__ptr != __next) ? \
-		list_entry_rcu(__next, type, member) : NULL; \
+	  struct list_head __rcu *__next = list_next_rcu(__ptr); \
+	  likely(__ptr != __next) ? container_of(__next, type, member) : NULL; \
 	})
 
 /**
-- 
1.8.3.1

