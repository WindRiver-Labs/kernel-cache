From a281749f12e1a606db3dbcdce384c5757712083b Mon Sep 17 00:00:00 2001
From: Paul Gortmaker <paul.gortmaker@windriver.com>
Date: Fri, 20 Aug 2010 14:54:36 -0400
Subject: [PATCH] BFS: account for KDB specific additions

BFS works by forking a copy of sched.c into sched_bfs.c, so the
forked copy has no knowledge of sched.c changes that were made
for KDB support (see upstream commit 67fc4e0cb931d6b4ccf21248)

In particular, kdb needs access to `curr_task', so take that part
from the kdb commit, and reapply it to the sched_bfs variant.

Signed-off-by: Paul Gortmaker <paul.gortmaker@windriver.com>
---
 kernel/sched_bfs.c |    7 +++++--
 1 files changed, 5 insertions(+), 2 deletions(-)

diff --git a/kernel/sched_bfs.c b/kernel/sched_bfs.c
index edac240..f94da4a 100644
--- a/kernel/sched_bfs.c
+++ b/kernel/sched_bfs.c
@@ -6752,9 +6752,9 @@ void normalize_rt_tasks(void)
 }
 #endif /* CONFIG_MAGIC_SYSRQ */
 
-#ifdef CONFIG_IA64
+#if defined(CONFIG_IA64) || defined(CONFIG_KGDB_KDB)
 /*
- * These functions are only useful for the IA64 MCA handling.
+ * These functions are only useful for the IA64 MCA handling, or kdb.
  *
  * They can only be called when the whole system has been
  * stopped - every CPU needs to be quiescent, and no scheduling
@@ -6774,6 +6774,9 @@ struct task_struct *curr_task(int cpu)
 	return cpu_curr(cpu);
 }
 
+#endif /* defined(CONFIG_IA64) || defined(CONFIG_KGDB_KDB) */
+
+#ifdef CONFIG_IA64
 /**
  * set_curr_task - set the current task for a given cpu.
  * @cpu: the processor in question.
-- 
1.7.2.1

