From dc0a5057137d180d780e96e217c74beaaecbdf26 Mon Sep 17 00:00:00 2001
From: Mark Asselstine <mark.asselstine@windriver.com>
Date: Tue, 15 Jul 2008 15:52:52 -0400
Subject: [PATCH] ARM vmlinux

This patch makes uxipImage to be booted normally by inserting uboot header
into Text segment of Linux kernel, so the size of uboot header should be added
into TEXTADDR of vmlinux.lds.S.

wrs_severity: critical
wrs_scope: few_source_files

Signed-off-by: <zumeng.chen@windriver.com>
---
 arch/arm/kernel/vmlinux.lds.S |    4 ++++
 1 files changed, 4 insertions(+), 0 deletions(-)

diff --git a/arch/arm/kernel/vmlinux.lds.S b/arch/arm/kernel/vmlinux.lds.S
index 4898bdc..961e8af 100644
--- a/arch/arm/kernel/vmlinux.lds.S
+++ b/arch/arm/kernel/vmlinux.lds.S
@@ -19,7 +19,11 @@ jiffies = jiffies_64 + 4;
 SECTIONS
 {
 #ifdef CONFIG_XIP_KERNEL
+#ifdef CONFIG_XIP_UBOOT_HDR
+	. = XIP_VIRT_ADDR(CONFIG_XIP_PHYS_ADDR + 0x40); /* 0x40 is uboot header size */
+#else
 	. = XIP_VIRT_ADDR(CONFIG_XIP_PHYS_ADDR);
+#endif
 #else
 	. = PAGE_OFFSET + TEXT_OFFSET;
 #endif
-- 
1.5.5.1

