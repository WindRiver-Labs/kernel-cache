From 84a96cfdf8c4cf29ac249b51fef2e4d5afe5ab80 Mon Sep 17 00:00:00 2001
From: Yang Shi <yang.shi@windriver.com>
Date: Fri, 23 Oct 2009 15:27:33 +0800
Subject: [PATCH] Replace restart function with standard VBI

Since vbiVbMgt is not standard VBI, so replace it with vbi_vb_reset.

Signed-off-by: Yang Shi <yang.shi@windriver.com>
---
 arch/powerpc/kernel/vbi/wrhv.c |   13 +++++++++++--
 1 files changed, 11 insertions(+), 2 deletions(-)

diff --git a/arch/powerpc/kernel/vbi/wrhv.c b/arch/powerpc/kernel/vbi/wrhv.c
index 9b8ce5e..ca1f021 100644
--- a/arch/powerpc/kernel/vbi/wrhv.c
+++ b/arch/powerpc/kernel/vbi/wrhv.c
@@ -202,8 +202,17 @@ void wrhv_power_save(void)
 void wrhv_restart(void)
 {
 	int ret;
-	vbi_vb_mgmt(VBI_VBMGMT_RESET, __wrhvConfig.pid, &ret,
-			VBI_VBMGMT_RESET_CLEAR,0);
+	printk(KERN_INFO "WRHV: rebooting \n");
+
+	ret = vbi_vb_reset(VBI_BOARD_ID_GET(), VBI_VB_CORES_ALL,
+		VBI_VBMGMT_RESET_AND_START_CORE0 |
+		VBI_VBMGMT_RESET_DOWNLOAD |
+		VBI_VBMGMT_RESET_CLEAR
+		);
+
+	if (unlikely(ret != 0)) 
+		printk(KERN_ERR "WRHV: reboot failed. \n");
+
 	while (1);
 }
 
-- 
1.6.5.2

