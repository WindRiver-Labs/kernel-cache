From 3f42516a5d444ca7abe59ec880a622f01b8f6de0 Mon Sep 17 00:00:00 2001
From: Jim Somerville <Jim.Somerville@windriver.com>
Date: Fri, 12 Feb 2010 12:16:52 -0800
Subject: [PATCH] x86 - Add interrupt support for Intel IOATDMA

This allows us to assign interrupts to the ioatdma controller
hardware that appears as a PCI device.

Signed-off-by: Jim Somerville <Jim.Somerville@windriver.com>
---
 arch/x86/kernel/vbi/wrhv.c |   14 ++++++++++++--
 1 files changed, 12 insertions(+), 2 deletions(-)

diff --git a/arch/x86/kernel/vbi/wrhv.c b/arch/x86/kernel/vbi/wrhv.c
index b81ac2a..b505486 100644
--- a/arch/x86/kernel/vbi/wrhv.c
+++ b/arch/x86/kernel/vbi/wrhv.c
@@ -377,14 +377,24 @@ static void __devinit pci_fixup_wrhv(struct pci_dev *dev)
 		break;
 
 	case PCI_BASE_CLASS_SERIAL:
-		/* Look at the upper byte of the class to see if the
-		   device is usb.
+		/* Examine more bits of the class to see if the
+		   device is specifically usb.
 		*/
 		if ((dev->class >> 8) == PCI_CLASS_SERIAL_USB) {
 			devclass = "USB";
 			break;
 		}
 
+	case PCI_BASE_CLASS_SYSTEM:
+		/* Examine more bits of the class to see if the
+		   device is "other".  This covers Intel's I/O acceleration
+		   technology aka ioatdma.
+		*/
+		if ((dev->class >> 8) == PCI_CLASS_SYSTEM_OTHER) {
+			devclass = "System";
+			break;
+		}
+
 	default:
 		skip_assign_irq = 1;
 		irq = dev->irq;
-- 
1.6.5.2

