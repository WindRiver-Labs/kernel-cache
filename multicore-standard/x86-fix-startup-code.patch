From 4d436b95878d21571921d13c34ae6b31de3f7a75 Mon Sep 17 00:00:00 2001
From: Weiwei Wang <weiwei.wang@windriver.com>
Date: Mon, 19 Oct 2009 15:26:46 +0800
Subject: [PATCH] x86: fix startup code

Guest os  gets uncertain esi value from hypervisor which
can stop linux setting segments during startup period, and
finally cause system boot failure. So comment related code.

Signed-off-by: Weiwei Wang <weiwei.wang@windriver.com>
---
 arch/x86/kernel/head_32.S |    2 ++
 1 files changed, 2 insertions(+), 0 deletions(-)

diff --git a/arch/x86/kernel/head_32.S b/arch/x86/kernel/head_32.S
index 4e8fbf6..0c2aca3 100644
--- a/arch/x86/kernel/head_32.S
+++ b/arch/x86/kernel/head_32.S
@@ -94,10 +94,12 @@ ENTRY(startup_32)
 	mov $0x2f8, %dx
 	outb %al, %dx
 */
+#ifndef CONFIG_WRHV
 	/* test KEEP_SEGMENTS flag to see if the bootloader is asking
 		us to not reload segments */
 	testb $(1<<6), BP_loadflags(%esi)
 	jnz 2f
+#endif
 
 /*
  * Set segments to known values.
-- 
1.6.3.3

