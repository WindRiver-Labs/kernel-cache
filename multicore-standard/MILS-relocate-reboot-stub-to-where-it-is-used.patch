From 6891cb6ae8b87ce7eca485a92d770053eb43bb71 Mon Sep 17 00:00:00 2001
From: Paul Gortmaker <paul.gortmaker@windriver.com>
Date: Sun, 28 Mar 2010 13:21:19 -0400
Subject: [PATCH] MILS: relocate reboot stub to where it is used

Putting the stub in the interface file gets messy if we want
to add a printk to the stub indicating that there is no support
for reboot in MILS. Relocate it and add the printk.

Signed-off-by: Paul Gortmaker <paul.gortmaker@windriver.com>
---
 arch/powerpc/kernel/vbi/wrhv.c |    8 ++++++++
 include/vbi/vdk_interface.h    |    5 -----
 2 files changed, 8 insertions(+), 5 deletions(-)

diff --git a/arch/powerpc/kernel/vbi/wrhv.c b/arch/powerpc/kernel/vbi/wrhv.c
index 487e484..2375f6c 100644
--- a/arch/powerpc/kernel/vbi/wrhv.c
+++ b/arch/powerpc/kernel/vbi/wrhv.c
@@ -176,7 +176,15 @@ static inline void put_dbcr(uint32_t reg)
 {
 	return;
 }
+
+static inline int32_t vbi_vb_reset(uint32_t id, int32_t core, uint32_t options)
+{
+	printk(KERN_INFO "MILS: guest reboot not supported by hypervisor\n");
+	return -1;
+}
+
 #else	/* !MILS */
+
 static inline uint32_t get_emsr(void)
 {
 	return VBI_CNTRL_ADDR_GET()->vb_control_regs.emsr;
diff --git a/include/vbi/vdk_interface.h b/include/vbi/vdk_interface.h
index d5fbf28..73798c2 100644
--- a/include/vbi/vdk_interface.h
+++ b/include/vbi/vdk_interface.h
@@ -574,11 +574,6 @@ static inline int32_t vbi_get_guest_dma_addr(void *gaddr, uint64_t *paddr)
 
 extern int vb_context_mmu_on(int pid, void * pgtable, int pagesize, int debug);
 
-static inline int32_t vbi_vb_reset(uint32_t id, int32_t core, uint32_t options)
-{
-	return -1;
-}
-
 #endif /*_ASMLANGUAGE */
 #endif  /* _VDK_INTERFACE_H */
 
-- 
1.7.0

