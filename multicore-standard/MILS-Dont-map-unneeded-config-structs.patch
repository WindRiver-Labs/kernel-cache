From 7d035033d09ffa22c26774fa082ee646c5e7a5cb Mon Sep 17 00:00:00 2001
From: Jeremy McNicoll <jeremy.mcnicoll@windriver.com>
Date: Tue, 23 Feb 2010 15:03:10 -0500
Subject: [PATCH] [MILS] Dont map unneeded config structs

There are some structures that MILS just doesn't have.

Signed-off-by: Jeremy McNicoll <jeremy.mcnicoll@windriver.com>
---
 arch/powerpc/kernel/vbi/wrhv.c |    5 ++++-
 1 files changed, 4 insertions(+), 1 deletions(-)

diff --git a/arch/powerpc/kernel/vbi/wrhv.c b/arch/powerpc/kernel/vbi/wrhv.c
index 521c114..ed07197 100644
--- a/arch/powerpc/kernel/vbi/wrhv.c
+++ b/arch/powerpc/kernel/vbi/wrhv.c
@@ -210,11 +210,12 @@ void wrhv_mapping(void)
 		 (unsigned long)wr_config->vb_status, _PAGE_RAM);
 	map_page((unsigned long)wr_config->vb_control,
 		 (unsigned long)wr_config->vb_control, _PAGE_RAM);
+#ifndef CONFIG_WRHV_MILS
 	map_page((unsigned long)wr_config->interruptConfiguration,
 		 (unsigned long)wr_config->interruptConfiguration, _PAGE_RAM);
 	map_page((unsigned long)wr_config->vb_control->vIoapic,
 		 (unsigned long)wr_config->vb_control->vIoapic, _PAGE_RAM);
-
+#endif
 	memcpy(&__wr_config, wr_config, sizeof(__wr_config));
 	/* map any shared memory region info */
 
@@ -223,8 +224,10 @@ void wrhv_mapping(void)
 			 sharedMemoryRegionsConfigAddress,
 			 (unsigned long)wr_config->
 			 sharedMemoryRegionsConfigAddress, _PAGE_RAM);
+#ifndef CONFIG_WRHV_MILS
 	/* MIPC */
 	map_page(0xfd000000, 0xfd000000, _PAGE_IO);
+#endif
 	/* devices mapped by the hypervisor xml coqnfiguration */
 
 	return;
-- 
1.7.0

