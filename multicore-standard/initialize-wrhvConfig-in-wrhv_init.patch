From f233fc2a21c7b7828d53e0f0867feaaec3921337 Mon Sep 17 00:00:00 2001
From: Thomas Tai <thomas.tai@windriver.com>
Date: Wed, 21 Oct 2009 14:17:47 -0400
Subject: [PATCH 1/2] initialize wrhvConfig in wrhv_init

In order to access wrhvConfig very early, move
wrhvConfig initialization into wrhv_init.

Signed-off-by: Thomas Tai <thomas.tai@windriver.com>
---
 arch/powerpc/platforms/85xx/wrhv_8572ds.c |    7 +++----
 1 files changed, 3 insertions(+), 4 deletions(-)

diff --git a/arch/powerpc/platforms/85xx/wrhv_8572ds.c b/arch/powerpc/platforms/85xx/wrhv_8572ds.c
index 4c8db3c..dcd8e28 100644
--- a/arch/powerpc/platforms/85xx/wrhv_8572ds.c
+++ b/arch/powerpc/platforms/85xx/wrhv_8572ds.c
@@ -149,10 +149,9 @@ static int __init wrhv_8572ds_probe(void)
 {
 	unsigned long root = of_get_flat_dt_root();
 
-	wrhvConfig = (VB_CONFIG *)0xF0000000;	/* TODO */
-	wrhvControl = wrhvConfig->vbControl;
-	wrhvStatus = wrhvConfig->vbStatus;
-
+	/* wrhvConfig should have been initialized in wrhv_init(),
+	 * continue to complete the vbi initialization here.
+	 */
 	wrhv_mapping(); /* Map VB_CONFIG structure */
 	vbiInit(wrhvConfig);
 
-- 
1.6.5.rc3

