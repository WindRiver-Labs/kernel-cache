From 28ed4bf8b7bef611a7dfee4cc4c4be5080e8a1a8 Mon Sep 17 00:00:00 2001
From: Weiwei Wang <weiwei.wang@windriver.com>
Date: Mon, 19 Oct 2009 10:21:50 +0800
Subject: [PATCH 2/4] x86: delete ext int unmask code

After fixing vioapic issue, ext int unmask is not
necessary all more, so delte them.

Signed-off-by: Weiwei Wang <weiwei.wang@windriver.com>
---
 arch/x86/kernel/wrhv.c |   22 ----------------------
 1 files changed, 0 insertions(+), 22 deletions(-)

diff --git a/arch/x86/kernel/wrhv.c b/arch/x86/kernel/wrhv.c
index 344ff27..03b82cc 100644
--- a/arch/x86/kernel/wrhv.c
+++ b/arch/x86/kernel/wrhv.c
@@ -40,9 +40,6 @@
 #include <asm/cpu.h>
 #include <asm/reboot.h>		/* for struct machine_ops */
 
-#ifdef CONFIG_RTC
-#include <linux/mc146818rtc.h>
-#endif
 
 //#define WRHV_DEBUG_MSR	1
 #define WRHV_USE_XMLCONFIG	1
@@ -100,22 +97,6 @@ static void wrhv_pre_intr_init_hook(void)
 	}
 }
 
-/*by default vioapic will mask the external interrupts,
- *so umask the ext ints which you are going to use.
- */
-static inline void wrhv_umask_ext_int(void)
-{
-#ifdef CONFIG_RTC
-	/*unmask rtc irq*/
-	vbiVioapicIntUnmask(RTC_IRQ);
-#endif
-
-#ifdef CONFIG_WRHV_X86_HRTIMERS
-	vbiVioapicIntUnmask(TIMER_INT_NUM);
-#endif
-	
-}
-
 void __init wrhv_init_IRQ(void)
 {
 	int i;
@@ -157,8 +138,6 @@ void __init wrhv_init_IRQ(void)
 
 	irq_ctx_init(smp_processor_id());
 
-	wrhv_umask_ext_int();
-
 	/* race during reboot might have left a timer interrupt
 	 * pending and unacked */
 	/*
@@ -356,7 +335,6 @@ static void __devinit pci_fixup_wrhv(struct pci_dev *dev)
 		irq = vbiIntVecFind(devname, 1);
 		if (irq == VBI_INVALID_IRQ)
 			irq = WRHV_POLL_IRQ;
-		vbiIoapicIoctl(VBI_IOAPICIOCTL_UNMASK, irq, 0);
 	}
 
 	dev->irq = irq;
-- 
1.6.3.3

