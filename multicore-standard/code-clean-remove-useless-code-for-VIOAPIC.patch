From 4fc26db72fc5f35d1cdbc0ba9ea4792e08237dc1 Mon Sep 17 00:00:00 2001
From: Liang Li <liang.li@windriver.com>
Date: Tue, 10 Nov 2009 01:22:24 -0800
Subject: [PATCH 2/2] code clean: remove useless code for VIOAPIC

o remove useless code for VIOAPIC
o wrhv_enable_irq/wrhv_disable_irq do not harm x86 so remove protection
for conditional code

Signed-off-by: Liang Li <liang.li@windriver.com>
---
 kernel/vbi/wrhv.c |   34 ----------------------------------
 1 files changed, 0 insertions(+), 34 deletions(-)

diff --git a/kernel/vbi/wrhv.c b/kernel/vbi/wrhv.c
index b863ac0..c95f732 100644
--- a/kernel/vbi/wrhv.c
+++ b/kernel/vbi/wrhv.c
@@ -23,38 +23,6 @@
 
 #define VIOAPIC_BASE_ADDR	(&wrhvVbControl->vIoapic)
 
-static uint32_t vioapic_reg_read(uint8_t offset)
-{
-	uint32_t reg;
-	reg = VIOAPIC_REG_GET(VIOAPIC_BASE_ADDR, offset);
-	return reg;
-}
-
-static void vioapic_reg_write(uint8_t  offset, uint32_t value)
-{
-	VIOAPIC_REG_SET(VIOAPIC_BASE_ADDR, offset, value);
-}
-
-static void wrhv_enable_vector(unsigned int vector)
-{
-	uint32_t curr, offset;
-
-	offset = VIOAPIC_REG_REDTBL + vector*2;
-	curr = vioapic_reg_read(offset);
-	curr &= ~VIOAPIC_INT_MASK;
-	vioapic_reg_write(offset, curr);
-}
-
-static void wrhv_disable_vector(unsigned int vector)
-{
-	uint32_t curr, offset;
-
-	offset = VIOAPIC_REG_REDTBL + vector*2;
-	curr = vioapic_reg_read(offset);
-	curr |= VIOAPIC_INT_MASK;
-	vioapic_reg_write(offset, curr);
-}
-
 static void wrhv_enable_irq(unsigned int irq)
 {
 	vbiVioapicIntUnmask(irq);
@@ -93,10 +61,8 @@ struct irq_chip wrhv_irq_chip = {
 	.name		= "WRHV-PIC",
 	.mask		= wrhv_mask_irq,
 	.ack		= wrhv_ack_irq,
-#ifndef CONFIG_X86
 	.disable	= wrhv_disable_irq,
 	.enable		= wrhv_enable_irq,
-#endif
 	.unmask		= wrhv_unmask_irq,
 	.mask_ack	= wrhv_maskack_irq,
 	.eoi		= wrhv_ack_irq,
-- 
1.6.5.2

