From e123eca9895ffe80efd8f8fb216882c9298a6719 Mon Sep 17 00:00:00 2001
From: Paul Gortmaker <paul.gortmaker@windriver.com>
Date: Wed, 2 Dec 2009 19:14:03 -0500
Subject: [PATCH 25/43] vbControlRegs --> vb_control_regs

Signed-off-by: Paul Gortmaker <paul.gortmaker@windriver.com>
---
 arch/powerpc/include/asm/arch_vbi.h |    2 +-
 arch/powerpc/kernel/vbi/wrhv.c      |    8 ++++----
 include/vbi/compat.h                |    1 +
 include/vbi/interface.h             |    2 +-
 4 files changed, 7 insertions(+), 6 deletions(-)

diff --git a/arch/powerpc/include/asm/arch_vbi.h b/arch/powerpc/include/asm/arch_vbi.h
index 81e0673..9ee0fcd 100644
--- a/arch/powerpc/include/asm/arch_vbi.h
+++ b/arch/powerpc/include/asm/arch_vbi.h
@@ -157,7 +157,7 @@
 	base->vbStatusRegs.field
 
 #define VB_CONTROL_REGS_ACCESS(base, field)	\
-	base->vbControlRegs.field
+	base->vb_control_regs.field
 
 /*
  * vb_arch_ctrl_regs - Virtual core PPC control structure
diff --git a/arch/powerpc/kernel/vbi/wrhv.c b/arch/powerpc/kernel/vbi/wrhv.c
index 6b5569d..064dd3a 100644
--- a/arch/powerpc/kernel/vbi/wrhv.c
+++ b/arch/powerpc/kernel/vbi/wrhv.c
@@ -870,8 +870,8 @@ int wrhv_map_page(unsigned long va, phys_addr_t pa, int flags)
 /* arch/powerpc/kernel/traps.c */
 void __kprobes wrhv_DebugException(struct pt_regs *regs, unsigned long debug_status)
 {
-	debug_status = wrhvControl->vbControlRegs.dbsr;
-	wrhvControl->vbControlRegs.emsr &= ~MSR_DE;
+	debug_status = wrhvControl->vb_control_regs.dbsr;
+	wrhvControl->vb_control_regs.emsr &= ~MSR_DE;
 
 	if (debug_status & DBSR_IC) {   /* instruction completion */
 		regs->msr &= ~MSR_DE;
@@ -934,13 +934,13 @@ int wrhv_kgdb_arch_handle_exception(int vector, int signo, int err_code,
 			 * Set hypervisor DBCR0_IC single step and
 			 * DBCR0_IDM internal debug mode.
 			 */
-			wrhvControl->vbControlRegs.dbcr0 |= (DBCR0_IC | DBCR0_IDM);
+			wrhvControl->vb_control_regs.dbcr0 |= (DBCR0_IC | DBCR0_IDM);
 
 			/*
 			 * Set Debug Enable bit in hypervisor's emulated MSR which
 			 * is restored on return from exception
 			 */
-			wrhvControl->vbControlRegs.emsr |= MSR_DE;
+			wrhvControl->vb_control_regs.emsr |= MSR_DE;
 #else
 			linux_regs->msr |= MSR_SE;
 #endif
diff --git a/include/vbi/compat.h b/include/vbi/compat.h
index c0c5df8..a5d00fb 100644
--- a/include/vbi/compat.h
+++ b/include/vbi/compat.h
@@ -64,6 +64,7 @@
 /*
  * struct fields and similar
  */
+#define vbControlRegs		vb_control_regs
 #define wrhvVbStatus		wr_vb_status
 #define wrhvVbControl		wr_vb_control
 #define wrhvVbConfig		wr_vb_config
diff --git a/include/vbi/interface.h b/include/vbi/interface.h
index 745c483..153d78c 100644
--- a/include/vbi/interface.h
+++ b/include/vbi/interface.h
@@ -305,7 +305,7 @@ struct vb_control
 {
 
 #ifdef  _WRHV_ARCH_HAS_CTRL_REGS
-	struct vb_arch_ctrl_regs vbControlRegs;
+	struct vb_arch_ctrl_regs vb_control_regs;
 #endif
 
 	uint32_t irq_disable;		/*  0: -1 => Disable all interrupts */
-- 
1.6.5.2

