From e0c0bdfc1f1b15ebc5014768f2127eb3a9649b91 Mon Sep 17 00:00:00 2001
From: Jeremy McNicoll <jeremy.mcnicoll@windriver.com>
Date: Fri, 19 Feb 2010 08:14:48 -0500
Subject: [PATCH] [MILS] Establish base exception vector address

The SK (Separation Kernel) / MILS has a different mechanism of
setting up the base exception vector.

Signed-off-by: Jeremy McNicoll <jeremy.mcnicoll@windriver.com>
---
 arch/powerpc/kernel/head_wrhv.S |    8 +++++++-
 1 files changed, 7 insertions(+), 1 deletions(-)

diff --git a/arch/powerpc/kernel/head_wrhv.S b/arch/powerpc/kernel/head_wrhv.S
index 0e765b9..deb4b8e 100644
--- a/arch/powerpc/kernel/head_wrhv.S
+++ b/arch/powerpc/kernel/head_wrhv.S
@@ -128,13 +128,19 @@ _ENTRY(__early_start)
 	addi	r4,r2,THREAD	/* init task's THREAD */
 	WRHV_MTSPRG3(r4,r1)
 	/* Establish the interrupt vector offsets */
+#ifdef CONFIG_WRHV_MILS
+	lis	r3,_start@h
+	ori	r3,r3,_start@l
+	bl	vbi_exec_vec_base_addr_set
+#else
 	lis	r0,VBI_SYS_hyIoctl@h
-	ori     r0,r0,VBI_SYS_hyIoctl@l
+	ori	r0,r0,VBI_SYS_hyIoctl@l
 	lis	r3,VBI_HYIOCTL_EXCBASE@h
 	ori	r3,r3,VBI_HYIOCTL_EXCBASE@l
 	lis	r4,_start@h
 	ori	r4,r4,_start@l
 	sc
+#endif
 
 	/* stack */
 	lis	r1,init_thread_union@h
-- 
1.7.0

