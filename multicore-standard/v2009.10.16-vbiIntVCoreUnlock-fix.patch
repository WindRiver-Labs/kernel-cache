From 971c5288131b374dcea972c75fa6919cceb09d96 Mon Sep 17 00:00:00 2001
From: Paul Gortmaker <paul.gortmaker@windriver.com>
Date: Thu, 5 Nov 2009 17:36:03 -0500
Subject: [PATCH 05/22] v2009.10.16: vbiIntVCoreUnlock fix

Integrate vbiIntVCoreUnlock fix from Oct16 drop.

[cf: 02l,05oct09,dtr  Fix vbiIntVCoreIntUnlock.]

Signed-off-by: Paul Gortmaker <paul.gortmaker@windriver.com>
---
 arch/powerpc/kernel/vbi/syscalls.S |    2 ++
 1 files changed, 2 insertions(+), 0 deletions(-)

diff --git a/arch/powerpc/kernel/vbi/syscalls.S b/arch/powerpc/kernel/vbi/syscalls.S
index 7a7bc8a..2a998f9 100644
--- a/arch/powerpc/kernel/vbi/syscalls.S
+++ b/arch/powerpc/kernel/vbi/syscalls.S
@@ -50,6 +50,7 @@ FUNC_EXPORT(vbiKputs)
 FUNC_EXPORT(vbiKputc)
 FUNC_EXPORT(vbiIntVCoreUnlock)
 FUNC_EXPORT(vbiIntVCoreLock)
+FUNC_EXPORT(vbiIntVCoreStateGet)
 FUNC_EXPORT(vbiExcBaseSet)
 FUNC_EXPORT(vbiExcOffsetsSet)
 FUNC_EXPORT(vbiExcOffsetsGet)
@@ -410,6 +411,7 @@ FUNC_END(vbiTlbFlush)
 FUNC_LABEL(vbiIntVCoreUnlock)
 	lis	p0, HIADJ(wrhvVbControl)
 	lwz	p0, LO(wrhvVbControl)(p0)
+	li	p1, 0
 	stw	p1, VB_CONTROL_INT_DISABLE(p0)
 
 tryAgain:
-- 
1.6.5.2

