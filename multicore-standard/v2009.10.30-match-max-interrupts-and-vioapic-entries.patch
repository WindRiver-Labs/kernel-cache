From 7247c94d7db84658dc90f16292e00b07525c457b Mon Sep 17 00:00:00 2001
From: Paul Gortmaker <paul.gortmaker@windriver.com>
Date: Thu, 5 Nov 2009 20:11:16 -0500
Subject: [PATCH 14/22] v2009.10.30: match max interrupts and vioapic entries

Integrate Halloween update

[cf: 02t,26oct09,mmi  match max interrupts and vioapic entries]
     01g,26oct09,mmi  match VB_MAX_INTERRUPTS with max VIOAPIC entries]
     01q,26oct09,mmi  use the common definition of max entries
                      in vbInterface.h]

Signed-off-by: Paul Gortmaker <paul.gortmaker@windriver.com>
---
 include/vbi/interface.h |   18 +++++++-----------
 include/vbi/io_apic.h   |    5 -----
 kernel/vbi/io_apic.c    |    7 -------
 3 files changed, 7 insertions(+), 23 deletions(-)

diff --git a/include/vbi/interface.h b/include/vbi/interface.h
index b5deed9..c95c5f2 100644
--- a/include/vbi/interface.h
+++ b/include/vbi/interface.h
@@ -139,11 +139,12 @@ identity mapped.
 /* Virtual Interrupt Controller definitions */
 
 /*
- * 32 is chosen as the maximum number of interrupt sources allowed.
- * care must be taken if this is changed, since some algorithms and
- * data structures will require modifications and become more complex
+ * The maximum number of interrupt sources allowed is defined by
+ * VB_MAX_INTERRUTS. Care must be taken if this is changed, since some
+ * algorithms and data structures will require modifications and become
+ * more complex
  */
-#define VB_MAX_INTERRUPTS		32
+#define VB_MAX_INTERRUPTS		128
 
 /*
  * The maximum number of associated data stored with each interrupt.
@@ -224,9 +225,8 @@ identity mapped.
 #define VB_BOOT_WARM	2
 #define VB_BOOT_RESTART	3
 
-#ifndef VB_VIOAPIC_ENTRIES_SIZE
-#define VB_VIOAPIC_ENTRIES_SIZE 64
-#endif
+/* define 128 entries for all platforms */
+#define VIOAPIC_MAX_REDTABLE_ENTRIES	VB_MAX_INTERRUPTS
 
 #ifndef	_ASMLANGUAGE
 
@@ -294,10 +294,6 @@ identity mapped.
  *   |--------------|
  *   |              | <------ 64bits - VIOAPIC information header
  *   |              |                  (internal use only)
- *   |--------------|
- *   |              |
- *   |              |<------- Nbytes - VIOAPIC redirection table
- *   |              |             *Where N = VB_VIOAPIC_ENTRIES_SIZE
  *   |              |
  *   |--------------|<------- 32bits - Pending interrupt vector number
  *   |______________|
diff --git a/include/vbi/io_apic.h b/include/vbi/io_apic.h
index d4a00bd..3c80dc9 100644
--- a/include/vbi/io_apic.h
+++ b/include/vbi/io_apic.h
@@ -21,11 +21,6 @@
 #include <sys/types.h>
 #include <vbMgr.h>
 
-/* define 128 entries for all platforms */
-
-#define VIOAPIC_REDTABLE_ENTRIES	(128)	
-#define VIOAPIC_MAX_REDTABLE_ENTRIES	(VIOAPIC_REDTABLE_ENTRIES)
-
 #ifndef	_ASMLANGUAGE
 
 /* data structures */
diff --git a/kernel/vbi/io_apic.c b/kernel/vbi/io_apic.c
index 2269425..2bebdd2 100644
--- a/kernel/vbi/io_apic.c
+++ b/kernel/vbi/io_apic.c
@@ -32,13 +32,6 @@
 #define VIOAPIC_REG_ARB		0x02	/* IOAPIC Arbitration ID */
 #define VIOAPIC_REG_BOOT	0x03	/* IOAPIC Boot Configuration */
 #define VIOAPIC_REG_REDTBL	0x10	/* Redirection Table (24 * 64bit) */
-/* Redirection table entry size per IO APIC */
-
-#define VIOAPIC_MAX_REDTABLE_ENTRIES	128
-
-#if 0
-#define DEBUG
-#endif
 
 #ifdef DEBUG
 #define DEBUGM(fmt, arg...) printk(fmt, ##arg)
-- 
1.6.5.2

