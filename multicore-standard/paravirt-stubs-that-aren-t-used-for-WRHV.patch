From 2459856ce07a58623dc0e673d39d9a6f94fc93cb Mon Sep 17 00:00:00 2001
From: Paul Gortmaker <paul.gortmaker@windriver.com>
Date: Tue, 6 Oct 2009 14:06:48 -0400
Subject: [PATCH] paravirt: stubs that aren't used for WRHV

Original design was leaving a generic out for when WRHV
was not configured in; these are those stubs, carried
forward, as-is.

Signed-off-by: Paul Gortmaker <paul.gortmaker@windriver.com>
---
 arch/powerpc/kernel/Makefile            |    2 +
 arch/powerpc/kernel/paravirt_entry_32.S |   34 +++++++++++++++++++++++++++++++
 arch/powerpc/kernel/paravirt_misc_32.S  |   33 ++++++++++++++++++++++++++++++
 3 files changed, 69 insertions(+), 0 deletions(-)
 create mode 100644 arch/powerpc/kernel/paravirt_entry_32.S
 create mode 100644 arch/powerpc/kernel/paravirt_misc_32.S

diff --git a/arch/powerpc/kernel/Makefile b/arch/powerpc/kernel/Makefile
index c62f47b..8cf4622 100644
--- a/arch/powerpc/kernel/Makefile
+++ b/arch/powerpc/kernel/Makefile
@@ -62,6 +62,8 @@ obj-$(CONFIG_MODULES)		+= module.o module_$(CONFIG_WORD_SIZE).o
 
 ifeq ($(CONFIG_WRHV),y)
 obj-$(CONFIG_WRHV)              += wrhv_entry_32.o wrhv_misc_32.o
+else
+obj-$(CONFIG_PARAVIRT)          += paravirt_entry_32.o paravirt_misc_32.o
 endif
 
 obj-$(CONFIG_44x)		+= cpu_setup_44x.o
diff --git a/arch/powerpc/kernel/paravirt_entry_32.S b/arch/powerpc/kernel/paravirt_entry_32.S
new file mode 100644
index 0000000..a12087f
--- /dev/null
+++ b/arch/powerpc/kernel/paravirt_entry_32.S
@@ -0,0 +1,34 @@
+/*
+ *  Normally this file would contain the system call entry code, context
+ *  switch code, and exception/interrupt return code for PowerPC.
+ *  In this paravirt version of entry_32.S only a few redirects remain.
+ *
+ *  This program is free software; you can redistribute it and/or
+ *  modify it under the terms of the GNU General Public License
+ *  as published by the Free Software Foundation; either version
+ *  2 of the License, or (at your option) any later version.
+ *
+ */
+
+#include <asm/reg.h>
+#include <asm/ppc_asm.h>
+#include <asm/asm-offsets.h>
+
+	.globl	paravirt_transfer_to_handler
+paravirt_transfer_to_handler:
+	b	native_transfer_to_handler
+
+	.globl	paravirt_ret_from_syscall
+paravirt_ret_from_syscall:
+	b	native_ret_from_syscall
+
+	.globl  paravirt_syscall_exit_work
+paravirt_syscall_exit_work:
+	b	native_syscall_exit_work
+
+	.globl	paravirt_restore
+paravirt_restore:
+	b	native_restore
+
+_GLOBAL(paravirt_switch)
+	b	native_switch
diff --git a/arch/powerpc/kernel/paravirt_misc_32.S b/arch/powerpc/kernel/paravirt_misc_32.S
new file mode 100644
index 0000000..e3fb51f
--- /dev/null
+++ b/arch/powerpc/kernel/paravirt_misc_32.S
@@ -0,0 +1,33 @@
+/*
+ *  misc operations, for paravirt implementation.
+ *
+ *  This program is free software; you can redistribute it and/or
+ *  modify it under the terms of the GNU General Public License
+ *  as published by the Free Software Foundation; either version
+ *  2 of the License, or (at your option) any later version.
+ *
+ */
+
+#include <asm/ppc_asm.h>
+#include <asm/asm-offsets.h>
+
+_GLOBAL(paravirt_tlbia)
+	b	native_tlbia
+
+_GLOBAL(_tlbie)
+	b	native_tlbie
+
+_GLOBAL(clean_dcache_range)
+	b	native_clean_dcache_range
+
+_GLOBAL(paravirt__flush_dcache_icache)
+        b       native__flush_dcache_icache
+
+_GLOBAL(paravirt_flush_dcache_range)
+        b       native_flush_dcache_range
+
+_GLOBAL(paravirt__flush_icache_range)
+        b       native__flush_icache_range
+
+_GLOBAL(paravirt__flush_dcache_icache_phys)
+        b       native__flush_dcache_icache_phys
-- 
1.6.5.2

