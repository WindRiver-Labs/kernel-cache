From 10731692193f71aff48bb95c80229c4a91644baf Mon Sep 17 00:00:00 2001
From: Paul Gortmaker <paul.gortmaker@windriver.com>
Date: Thu, 29 Oct 2009 20:05:51 -0400
Subject: [PATCH 08/26] vbi: ensure CPU is properly set.

The current code has no protection against not having CPU set; it
will blindly stumble on with just warnings like:

arch/powerpc/kernel/vbi/show.c:32:5: warning: "PPC85XX" is not defined

Ensure that CPU is defined and defined properly by erroring out
if it isn't.  Eventually this should be tweaked to use existing
Kconfig defines like CONFIG_MPC85XX etc.

Signed-off-by: Paul Gortmaker <paul.gortmaker@windriver.com>
---
 arch/powerpc/kernel/vbi/show.c |    5 ++++-
 include/vbi/types.h            |    5 +++++
 2 files changed, 9 insertions(+), 1 deletions(-)

diff --git a/arch/powerpc/kernel/vbi/show.c b/arch/powerpc/kernel/vbi/show.c
index c0724eb..8ac0201 100644
--- a/arch/powerpc/kernel/vbi/show.c
+++ b/arch/powerpc/kernel/vbi/show.c
@@ -24,11 +24,14 @@
  * structure on the console.
  *
  */
-
 void vbiStsRegsDisplay(void)
 {
     struct vb_status *p = VBI_STATUS_ADDR_GET();
 
+#ifndef CPU
+#error CPU is undefined, needs to be PPC85XX or similar.
+#endif
+
 #if CPU == PPC85XX /* don't know how to handle cpu variant */
     VB_PRINTF ("  srr0/srr1:          0x%08x 0x%08x\n", 
 		VB_STATUS_REGS_ACCESS (p, srr0) ,
diff --git a/include/vbi/types.h b/include/vbi/types.h
index 5e53338..ef7f001 100644
--- a/include/vbi/types.h
+++ b/include/vbi/types.h
@@ -19,6 +19,11 @@
 #define _VBI_TYPES_H
 
 /* The CPU specifics here should be relocated to arch dirs */
+
+/* Currently supported CPUs */
+#define PENTIUM		1
+#define PPC85XX		2
+
 #ifdef CONFIG_WRHV
 #ifdef CONFIG_X86
 #define CPU PENTIUM
-- 
1.6.5.2

