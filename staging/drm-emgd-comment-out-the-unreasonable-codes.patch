From e32b837c902e9267f8f59804f23774b7791baf66 Mon Sep 17 00:00:00 2001
From: fli <fupan.li@windriver.com>
Date: Tue, 14 Jan 2014 11:59:12 +0800
Subject: [PATCH] drm/emgd: comment out the unreasonable codes

The DRM has been upgraded to 3.8.0, but the kernel is still 3.4.43.
The commit "drm/emgd: upgrade the EMGD to golden release" changed
statement "LINUX_VERSION_CODE > KERNEL_VERSION(3,8,0)" to
"LINUX_VERSION_CODE > KERNEL_VERSION(3,4,0)" to fit this mismatch.
But this is wrong. The kernel version is 3.4.x, instead of 3.4.0,
So comment out those codes not reasonable to 3.4.x.

Signed-off-by: fupan li <fupan.li@windriver.com>
---
 drivers/gpu/drm/emgd/src/core/emgd_fbcon.c         |    8 ++++++--
 .../drm/emgd/src/core/i915/i915_gem_execbuffer.c   |    6 +++++-
 2 files changed, 11 insertions(+), 3 deletions(-)

diff --git a/drivers/gpu/drm/emgd/src/core/emgd_fbcon.c b/drivers/gpu/drm/emgd/src/core/emgd_fbcon.c
index 5529e7d..2d3a766 100644
--- a/drivers/gpu/drm/emgd/src/core/emgd_fbcon.c
+++ b/drivers/gpu/drm/emgd/src/core/emgd_fbcon.c
@@ -1077,7 +1077,11 @@ int emgd_fbcon_initial_config(emgd_fbdev_t *emgd_fbdev, int alloc_fb)
 
 			/* Capture currently attach fb so we can unpin it */
 			oldfb = crtc->fb;
-#if LINUX_VERSION_CODE > KERNEL_VERSION(3, 4, 0)
+/*
+* The WLinux5.0 DRM is 3.8.0, and the following codes make no sense to it,
+* so comment it out.
+*/
+#if 0
 			if (oldfb) {
 				mutex_lock(&oldfb->dev->mode_config.mutex);
 				drm_framebuffer_unreference(oldfb);
@@ -1086,7 +1090,7 @@ int emgd_fbcon_initial_config(emgd_fbdev_t *emgd_fbdev, int alloc_fb)
 #endif
 
 			crtc->fb = &emgd_fbdev->emgd_fb->base;
-#if LINUX_VERSION_CODE > KERNEL_VERSION(3, 4, 0)
+#if 0
 			if (crtc->fb)
 				drm_framebuffer_reference(crtc->fb);
 #endif
diff --git a/drivers/gpu/drm/emgd/src/core/i915/i915_gem_execbuffer.c b/drivers/gpu/drm/emgd/src/core/i915/i915_gem_execbuffer.c
index 386a5cf..978be50a 100644
--- a/drivers/gpu/drm/emgd/src/core/i915/i915_gem_execbuffer.c
+++ b/drivers/gpu/drm/emgd/src/core/i915/i915_gem_execbuffer.c
@@ -1171,7 +1171,11 @@ i915_gem_do_execbuffer(struct drm_device *dev, void *data,
 		return ret;
 
 	flags = 0;
-#if LINUX_VERSION_CODE > KERNEL_VERSION(3,4,0)
+/*
+* The WLinux5.0 DRM is 3.8.0, and the following codes make no sense to it,
+* so comment it out.
+*/
+#if 0
 	if (args->flags & I915_EXEC_SECURE) {
 		if (!file->is_master || !capable(CAP_SYS_ADMIN))
 			return -EPERM;
-- 
1.7.5.4

