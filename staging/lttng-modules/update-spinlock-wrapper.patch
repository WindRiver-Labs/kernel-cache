From 58c0c834ffb7b7abdbbfae5447311290ec19dce7 Mon Sep 17 00:00:00 2001
From: Mathieu Desnoyers <mathieu.desnoyers@efficios.com>
Date: Thu, 23 Jun 2011 23:03:30 -0400
Subject: [PATCH 199/625] update spinlock wrapper

Signed-off-by: Mathieu Desnoyers <mathieu.desnoyers@efficios.com>
Signed-off-by: Jianchuan Wang <jianchuan.wang@windriver.com>
---
 drivers/staging/lttng2/wrapper/spinlock.h | 9 ++++++---
 1 file changed, 6 insertions(+), 3 deletions(-)

diff --git a/drivers/staging/lttng2/wrapper/spinlock.h b/drivers/staging/lttng2/wrapper/spinlock.h
index e38d389..8b1ad99 100644
--- a/drivers/staging/lttng2/wrapper/spinlock.h
+++ b/drivers/staging/lttng2/wrapper/spinlock.h
@@ -11,9 +11,12 @@
 
 #if (LINUX_VERSION_CODE < KERNEL_VERSION(2,6,33))
 
-#define raw_spin_lock_init(lock)				\
-	do {							\
-		*(lock) = __RAW_SPIN_LOCK_UNLOCKED;		\
+#include <linux/string.h>
+
+#define raw_spin_lock_init(lock)					\
+	do {								\
+		raw_spinlock_t __lock = __RAW_SPIN_LOCK_UNLOCKED;	\
+		memcpy(lock, &__lock, sizeof(lock));			\
 	} while (0)
 
 #define raw_spin_is_locked(lock)	__raw_spin_is_locked(lock)
-- 
2.0.2

