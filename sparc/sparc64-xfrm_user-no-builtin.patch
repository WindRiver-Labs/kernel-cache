From a3b999721cd5ed1dcfb1049bb7f19e84deab3d59 Mon Sep 17 00:00:00 2001
From: Hong H. Pham <hong.pham@windriver.com>
Date: Tue, 27 Jan 2009 15:14:39 -0500
Subject: [PATCH] sparc64: xfrm_user no builtin

Work around to prevent gcc from inlining its built in memcpy() for SPARC64.
Gcc's built in memcpy() is causing kernel unaligned memory access to occur
in some xfrm_user functions such as copy_to_user_policy() and
copy_to_user_state().

Signed-off-by: Hong H. Pham <hong.pham@windriver.com>
---
 net/xfrm/Makefile |    4 ++++
 1 files changed, 4 insertions(+), 0 deletions(-)

diff --git a/net/xfrm/Makefile b/net/xfrm/Makefile
index 0f439a7..2a7b69a 100644
--- a/net/xfrm/Makefile
+++ b/net/xfrm/Makefile
@@ -2,6 +2,10 @@
 # Makefile for the XFRM subsystem.
 #
 
+ifeq ($(CONFIG_SPARC64),y)
+EXTRA_CFLAGS := -fno-builtin
+endif
+
 obj-$(CONFIG_XFRM) := xfrm_policy.o xfrm_state.o xfrm_hash.o \
 		      xfrm_input.o xfrm_output.o xfrm_algo.o
 obj-$(CONFIG_XFRM_STATISTICS) += xfrm_proc.o
-- 
1.6.0.3

