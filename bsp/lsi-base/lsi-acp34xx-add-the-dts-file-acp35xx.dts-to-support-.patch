From 6ea16de8ec2fd72595b918c76d6357b732d1ed63 Mon Sep 17 00:00:00 2001
From: Xulin Sun <xulin.sun@windriver.com>
Date: Thu, 5 Jun 2014 15:01:22 +0800
Subject: [PATCH] lsi-acp34xx: add the dts file acp35xx.dts to support
 AXM3500.

The added dts file acp35xx.dts is picked up from LSI and made some
modification to support I2C & EEPROM & SPI flash.

Signed-off-by: Xulin Sun <xulin.sun@windriver.com>
---
 arch/powerpc/boot/dts/acp35xx.dts |  561 +++++++++++++++++++++++++++++++++++++
 1 files changed, 561 insertions(+), 0 deletions(-)
 create mode 100644 arch/powerpc/boot/dts/acp35xx.dts

diff --git a/arch/powerpc/boot/dts/acp35xx.dts b/arch/powerpc/boot/dts/acp35xx.dts
new file mode 100644
index 0000000..80a1700
--- /dev/null
+++ b/arch/powerpc/boot/dts/acp35xx.dts
@@ -0,0 +1,561 @@
+/*
+ * Device Tree Source for LSI ACP35xx.
+ *
+ * Copyright 2013, LSI Corporation
+ *
+ * Based on earlier code:
+ *     Copyright (c) 2009, 2006, 2007 IBM Corp.
+ *     Josh Boyer <jwboyer@linux.vnet.ibm.com>, David Gibson <dwg@au1.ibm.com>
+ *
+ * This file is licensed under the terms of the GNU General Public
+ * License version 2.  This program is licensed "as is" without
+ * any warranty of any kind, whether express or implied.
+ */
+
+/dts-v1/;
+
+/memreserve/ 0x00000000 0x00400000;
+
+/ {
+	#address-cells = <2>;
+	#size-cells = <1>;
+	model = "ibm,acpx1-4xx";
+	compatible = "lsi,acp3500", "lsi,acp", "ibm,acpx1-4xx";
+	dcr-parent = <&{/cpus/cpu@0}>;
+
+	aliases {
+		serial0   = &UART0;
+		serial1   = &UART1;
+		ethernet0 = &FEMAC;
+		rapidio0  = &SRIO0;
+	};
+
+	cpus {
+		#address-cells = <1>;
+		#size-cells = <0>;
+
+		cpu@0 {
+			device_type = "cpu";
+			model = "PowerPC,4xx"; // real CPU changed in sim
+			reg = <0>;
+			clock-frequency = <0>; // filled in by U-Boot
+			timebase-frequency = <0>; // filled in by U-Boot
+			i-cache-line-size = <32>;
+			d-cache-line-size = <32>;
+			i-cache-size = <32768>;
+			d-cache-size = <32768>;
+			dcr-controller;
+			dcr-access-method = "native";
+			status = "ok";
+			reset-type = <3>; // 1=core, 2=chip, 3=system (default)
+		};
+
+		cpu@1 {
+			device_type = "cpu";
+			model = "PowerPC,4xx"; // real CPU changed in sim
+			reg = <1>;
+			clock-frequency = <0>; // filled in by U-Boot
+			timebase-frequency = <0>; // filled in by U-Boot
+			i-cache-line-size = <32>;
+			d-cache-line-size = <32>;
+			i-cache-size = <32768>;
+			d-cache-size = <32768>;
+			dcr-controller;
+			dcr-access-method = "native";
+			status = "disabled";
+			enable-method = "spin-table";
+			cpu-release-addr = <0 0>; // Fixed by the boot loader
+			reset-type = <3>; // 1=core, 2=chip, 3=system (default)
+		};
+
+		cpu@2 {
+			device_type = "cpu";
+			model = "PowerPC,4xx"; // real CPU changed in sim
+			reg = <2>;
+			clock-frequency = <0>; // filled in by U-Boot
+			timebase-frequency = <0>; // filled in by U-Boot
+			i-cache-line-size = <32>;
+			d-cache-line-size = <32>;
+			i-cache-size = <32768>;
+			d-cache-size = <32768>;
+			dcr-controller;
+			dcr-access-method = "native";
+			status = "disabled";
+			enable-method = "spin-table";
+			cpu-release-addr = <0 0>; // Fixed by the boot loader
+			reset-type = <3>; // 1=core, 2=chip, 3=system (default)
+		};
+
+
+		cpu@3 {
+			device_type = "cpu";
+			model = "PowerPC,4xx"; // real CPU changed in sim
+			reg = <3>;
+			clock-frequency = <0>; // filled in by U-Boot
+			timebase-frequency = <0>; // filled in by U-Boot
+			i-cache-line-size = <32>;
+			d-cache-line-size = <32>;
+			i-cache-size = <32768>;
+			d-cache-size = <32768>;
+			dcr-controller;
+			dcr-access-method = "native";
+			status = "disabled";
+			enable-method = "spin-table";
+			cpu-release-addr = <0 0>; // Fixed by the boot loader
+			reset-type = <3>; // 1=core, 2=chip, 3=system (default)
+		};
+
+		cpu@4 {
+			device_type = "cpu";
+			model = "PowerPC,4xx"; // real CPU changed in sim
+			reg = <4>;
+			clock-frequency = <0>; // filled in by U-Boot
+			timebase-frequency = <0>; // filled in by U-Boot
+			i-cache-line-size = <32>;
+			d-cache-line-size = <32>;
+			i-cache-size = <32768>;
+			d-cache-size = <32768>;
+			dcr-controller;
+			dcr-access-method = "native";
+			status = "disabled";
+			enable-method = "spin-table";
+			cpu-release-addr = <0 0>; // Fixed by the boot loader
+			reset-type = <3>; // 1=core, 2=chip, 3=system (default)
+		};
+
+		cpu@5 {
+			device_type = "cpu";
+			model = "PowerPC,4xx"; // real CPU changed in sim
+			reg = <5>;
+			clock-frequency = <0>; // filled in by U-Boot
+			timebase-frequency = <0>; // filled in by U-Boot
+			i-cache-line-size = <32>;
+			d-cache-line-size = <32>;
+			i-cache-size = <32768>;
+			d-cache-size = <32768>;
+			dcr-controller;
+			dcr-access-method = "native";
+			status = "disabled";
+			enable-method = "spin-table";
+			cpu-release-addr = <0 0>; // Fixed by the boot loader
+			reset-type = <3>; // 1=core, 2=chip, 3=system (default)
+		};
+
+
+
+	};
+
+        memory@0 {
+                device_type = "memory";
+                reg = <0x00000000 0x00000000 0x00000000>; // filled in by U-Boot
+        };
+
+        memory@80000000 {
+                device_type = "memory";
+                reg = <0x00000000 0x08000000 0x00000000>; // filled in by U-Boot
+        };
+
+	MPIC: interrupt-controller {
+		compatible = "chrp,open-pic";
+		interrupt-controller;
+		dcr-reg = <0xffc00000 0x00030000>;
+		#address-cells = <0>;
+		#size-cells = <0>;
+		#interrupt-cells = <2>;
+		pic-no-reset;
+	};
+
+	plb {
+		/* Could be PLB6, doesn't matter */
+		compatible = "ibm,plb-4xx", "ibm,plb4";
+		#address-cells = <2>;
+		#size-cells = <1>;
+		ranges;
+		clock-frequency = <0>; // Filled in by zImage
+
+		POB0: opb {
+			compatible = "ibm,opb-4xx", "ibm,opb";
+			#address-cells = <1>;
+			#size-cells = <1>;
+			/* Wish there was a nicer way of specifying a full 32-bit
+			   range */
+			ranges = <0x00000000 0x00000020 0x00000000 0x80000000
+				  0x80000000 0x00000020 0x80000000 0x80000000>;
+			clock-frequency = <0>; // Filled in by zImage
+
+			UART0: serial@00404000 {
+				device_type = "serial";
+				compatible = "acp-uart0";
+				reg = <0x00424000 0x1000>;
+				clock-reg = <0x00429040 0x20>;
+				clock-frequency = <0>;
+				current-speed = <9600>;
+				interrupt-parent = <&MPIC>;
+				interrupts = <29 2>;
+				/*interrupts = <23>;*/
+			};
+
+			UART1: serial@00405000 {
+				device_type = "serial";
+				compatible = "acp-uart1";
+				reg = <0x00425000 0x1000>;
+				clock-reg = <0x00429060 0x20>;
+				clock-frequency = <0>;
+				current-speed = <9600>;
+				interrupt-parent = <&MPIC>;
+				interrupts = <30 2>;
+			};
+
+			USB0: usb@004a4000 {
+				device_type = "usb";
+				compatible = "acp-usb";
+
+				reg = <0x004a0000 0x00020000 
+				       0x0040c000 0x00001000>;
+				interrupt-parent = <&MPIC>;
+				interrupts = <36 2>;
+			};
+
+			I2C0: i2c@00403000 {
+				compatible = "lsi,api2c";
+				device_type = "i2c";
+				#address-cells = <1>;
+				#size-cells = <0>;
+				reg = <0x00426000 0x00001000>;		
+				interrupt-parent = <&MPIC>;
+				interrupts = <27 2>;
+
+			};
+			I2C1: i2c@00404000 {
+				compatible = "lsi,api2c";
+				device_type = "i2c";
+				#address-cells = <1>;
+				#size-cells = <0>;
+				reg = <0x00427000 0x00001000>;
+				interrupt-parent = <&MPIC>;
+				interrupts = <28 2>;
+				eeprom@54 {
+					compatible = "atmel,24c04";
+					reg = <0x54>;
+				};
+			};
+			I2C2: i2c@00405000 {
+				compatible = "lsi,api2c";
+				device_type = "i2c";
+				#address-cells = <1>;
+				#size-cells = <0>;
+				reg = <0x00428000 0x00001000>;				
+				interrupt-parent = <&MPIC>;
+				interrupts = <39 2>;
+			};
+
+			SSP: ssp@00402000 {
+				cell-index = <0>;
+				compatible = "acp-ssp";
+				clock-frequency = <25000000>;
+				reg = <0x00422000 0x00001000>;
+				interrupt-parent = <&MPIC>;
+				interrupts = <26 2>;
+			
+				num-ss-bits = <5>;
+				enalbe-dma = <0>;
+				
+				flash@0 {
+					compatible = "spansion,m25p80";
+					reg = <0>;
+					spi-max-frequency = <40000000>;
+
+					partition@0 {
+					/* This location must not be altered  */
+					/* 1MB for 2nd stage u-boot Bootloader Image */
+					reg = <0x0 0x100000>;
+					label = "flash@0 2nd Stage";
+					read-only;
+					}; 
+					partition@100000 {
+					/* 1MB for u-boot variables */
+					reg = <0x00100000 0x00100000>;
+					label = "flash@0 env-1";
+					read-only;
+					}; 
+					
+					partition@200000 {
+					/* This location must not be altered  */
+					/* 2MB for 3rd stage u-boot Bootloader Image */
+					reg = <0x200000 0x200000>;
+					label = "flash@0 3rd Stage";
+					read-only;
+					};
+					
+					partition@400000 {
+					/* 6MB for Linux Image */
+					reg = <0x0400000 0x600000>;
+					label = "flash@0 linux";
+					read-only;
+					};	
+									
+					partition@a00000 {
+					/* 6MB for Linux Rootfs*/
+					reg = <0xa00000 0x600000>;
+					label = "flash@0 linux_fs";
+					};
+				};
+				flash@1 {
+					compatible = "spansion,m25p80";
+					reg = <1>;
+					spi-max-frequency = <40000000>;
+
+					partition@0 {
+					/* This location must not be altered  */
+					/* 1MB for 2nd stage u-boot Bootloader Image */
+					reg = <0x0 0x100000>;
+					label = "flash@1 2nd Stage";
+					read-only;					
+					}; 
+					partition@100000 {
+					/* 1MB for u-boot variables */
+					reg = <0x00100000 0x00100000>;
+					label = "flash@1 env-1";
+					read-only;
+					}; 
+					
+					partition@200000 {
+					/* This location must not be altered  */
+					/* 2MB for 3rd stage u-boot Bootloader Image */
+					reg = <0x200000 0x200000>;
+					label = "flash@1 3rd Stage";
+					read-only;
+					};
+					
+					partition@400000 {
+					/* 6MB for Linux Image */
+					reg = <0x0400000 0x600000>;
+					label = "flash@1 linux";
+					read-only;
+					};	
+									
+					partition@a00000 {
+					/* 6MB for Linux Rootfs*/
+					reg = <0xa00000 0x600000>;
+					label = "flash@1 linux_fs";
+					};
+				}; 
+			};
+
+			NAND: nand@00440000 {
+				device_type = "nand";
+				compatible = "acp-nand";
+
+				reg = <0x004e0000 0x20000
+				       0x00400000 0x1000>;       
+			};
+
+			FEMAC: femac@00480000 {
+				device_type = "network";
+				compatible = "acp-femac";
+				reg = <0x00480000 0x1000
+				       0x00481000 0x1000
+				       0x00482000 0x1000>;
+				interrupt-parent = <&MPIC>;
+				interrupts = <38 2>;
+				/*interrupts = <32>;*/
+				mdio-reg = <0x0042a000 0x1000>;
+				// The following will get filled in by
+				// the boot loader.
+				mdio-clock = <0>;
+				// offset and period
+				mdio-clock-offset = <0x10>;
+				mdio-clock-period = <0x2c>;
+				phy-address = <0>;
+				ad-value = <0>;
+				mac-address = [00 00 00 00 00 00];
+			};
+
+			SBB: sbb0 {
+				name = "sbb0";
+				ecm-dcr = <0x1300>;
+				sbb-reg = <0x00500000 0x8000>;
+				tzc-reg = <0x00541000 0x1000>;
+			};
+			
+			gpio@00400000 {
+				#address-cells = <1>;
+				#size-cells = <0>;
+				cell-index = <0>;
+				compatible = "amba_pl061";
+				reg = <0x400000 0x1000>;
+				pins-map = <0x10>; /* GPIO 4 reserved for HW*/
+			};
+
+			gpio@00401000 {
+				#address-cells = <1>;
+				#size-cells = <0>;
+				cell-index = <8>;
+				compatible = "amba_pl061";
+				reg = <0x401000 0x1000>;
+				pins-map = <0x29>; /* GPIO 8,11,13 reserved for HW*/
+			};
+
+			gpreg@0040c000 {
+				compatible = "lsi,gpreg";
+				reg = <0x00400000 0x1000>;
+			};
+			
+		        gpdma@004e0000 {
+				compatible = "lsi,dma31";
+				reg = <0x004e0000 0x20000>;
+				interrupt-parent = <&MPIC>;
+				channel0 {
+					interrupts = <57 2>;
+				};
+				channel1 {
+					interrupts = <58 2>;
+				};
+				channel2 {
+					interrupts = <59 2>;
+				};
+				channel3 {
+					interrupts = <60 2>;
+				};
+				channel4 {
+					interrupts = <61 2>;
+				};
+				channel5 {
+					interrupts = <62 2>;
+				};				
+			};
+
+		};
+	};
+
+
+	nvrtc {
+		compatible = "ds1743-nvram", "ds1743", "rtc-ds1743";
+		reg = <0 0xEF703000 0x2000>;
+	};
+
+	system {
+		ncr_0x00a_0x010_0x0002c = <0>; // filled in by the boot loader.
+		ncr_0x016_0x0ff_0x00010 = <0>; // filled in by the boot loader.
+	};
+
+	chosen {
+                bootargs = "console=ttyS0 ip=dhcp root=/dev/nfs rw";
+                linux,stdout-path = "/plb/opb/serial0";
+	};
+
+        PCIE0: pciex@f00c0000 {
+                compatible = "lsi,plb-pciex";
+                device_type = "pci";
+                plx = <0>;
+                primary;
+                port = <0>;
+                #interrupt-cells = <1>;
+                #size-cells = <2>;
+                #address-cells = <3>;
+                /* config space access MPAGE7 registers*/
+                reg = <0x0020 0x78000000 0x01000000
+                       0x0020 0x00580000 0x00008000>;
+                bus-range = <0 0x0f>;
+                /* Outbound ranges */
+                /* < <3-cell PCI addr> <2-cell CPU (PLB) addr> <2-cell size> > */
+                ranges = <0x02000000 0x00000000 0xa0000000
+                          0x20 0x40000000
+                          0x00 0x10000000>;
+                /* Inbound ranges */
+                /* < <3-cell PCI addr> <2-cell CPU addr> <2-cell size> > */
+                dma-ranges = <0x02000000 0x00000000 0x00000000
+                              0x00 0x00000000
+                              0x00 0x10000000>;
+                    interrupt-parent = <&MPIC>;
+                interrupts = <52 2>;
+                interrupt-map-mask = <0000 0 0 7>;
+                interrupt-map = <
+                        /* <3-cell dev> <irq#> <prnt> <2-cell prnt IRQ/sense> */
+                        0000 0 0 1 &MPIC 52 2
+                        0000 0 0 2 &MPIC 52 2
+                        0000 0 0 3 &MPIC 52 2
+                        0000 0 0 4 &MPIC 52 2
+                >;
+        };
+
+        PCIE1: pciex@f00c8000 {
+                compatible = "lsi,plb-pciex";
+                device_type = "pci";
+                plx = <0>;
+                primary;
+                port = <1>;
+                #interrupt-cells = <1>;
+                #size-cells = <2>;
+                #address-cells = <3>;
+                /* config space access MPAGE7 registers*/
+                reg = <0x0020 0xb8000000 0x01000000
+                       0x0020 0x00588000 0x00008000>;
+                bus-range = <0 0x0f>;
+                /* Outbound ranges */
+                /* < <3-cell PCI addr> <2-cell CPU (PLB) addr> <2-cell size> > */
+                ranges = <0x02000000 0x00000000 0xb0000000
+                          0x20 0x80000000
+                          0x00 0x10000000>;
+                /* Inbound ranges */
+                /* < <3-cell PCI addr> <2-cell CPU addr> <2-cell size> > */
+                dma-ranges = <0x02000000 0x00000000 0x00000000
+                              0x00 0x00000000
+                              0x00 0x10000000>;
+                interrupt-parent = <&MPIC>;
+                interrupts = <54 2>;
+                interrupt-map-mask = <0000 0 0 7>;
+                interrupt-map = <
+                        /* <3-cell dev> <irq#> <prnt> <2-cell prnt IRQ/sense> */
+                        0000 0 0 1 &MPIC 54 2
+                        0000 0 0 2 &MPIC 54 2
+                        0000 0 0 3 &MPIC 54 2
+                        0000 0 0 4 &MPIC 54 2
+                >;
+        };
+        PCIE2: pciex@f00d0000 {
+                compatible = "lsi,plb-pciex";
+                device_type = "pci";
+                plx = <0>;
+                primary;
+                port = <2>;
+                #interrupt-cells = <1>;
+                #size-cells = <2>;
+                #address-cells = <3>;
+                /* config space access MPAGE7 registers*/
+                reg = <0x0020 0xf8000000 0x01000000
+                       0x0020 0x00590000 0x00008000>;
+                bus-range = <0 0x0f>;
+                /* Outbound ranges */
+                /* < <3-cell PCI addr> <2-cell CPU (PLB) addr> <2-cell size> > */
+                ranges = <0x02000000 0x00000000 0xc0000000
+                          0x20 0xc0000000
+                          0x00 0x10000000>;
+                /* Inbound ranges */
+                /* < <3-cell PCI addr> <2-cell CPU addr> <2-cell size> > */
+                dma-ranges = <0x02000000 0x00000000 0x00000000
+                              0x00 0x00000000
+                              0x00 0x10000000>;
+
+                interrupt-parent = <&MPIC>;
+                interrupts = <55 2>;
+                interrupt-map-mask = <0000 0 0 7>;
+                interrupt-map = <
+                        /* <3-cell dev> <irq#> <prnt> <2-cell prnt IRQ/sense> */
+                        0000 0 0 1 &MPIC 55 2
+                        0000 0 0 2 &MPIC 55 2
+                        0000 0 0 3 &MPIC 55 2
+                        0000 0 0 4 &MPIC 55 2
+                >;
+        };
+	SRIO0: rapidio@f0020000 {
+		compatible = "acp,rapidio-delta";
+                device_type = "rapidio";
+		#size = <0>;    /* 0 = (256, small system)
+				 * 1 = (65536, large system) */
+		reg = <0xf0020000 0x20000 0x1000>; /* SRIO Conf region */
+		interrupt-parent = <&MPIC>;
+		interrupts = <56 0x2 /* NCP_INTR_MPIC_SRC_AXIS_SRIO */>;
+	};
+};
+
-- 
1.7.5.4

