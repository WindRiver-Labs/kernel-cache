From 18c0b71db3b35dbd7fb7cf2bab5a6f6dad690134 Mon Sep 17 00:00:00 2001
From: John Jacques <john.jacques@lsi.com>
Date: Wed, 2 Jul 2014 10:44:56 -0500
Subject: [PATCH 1/4] arch/powerpc: Use the right Machine Types in the Axxia
 NAND Driver

the patch come from:
https://github.com/lsigithub/lsi_axxia_yocto/commit/d9763b9cb7ba7d75e76a909c749197f73f3d6bed

Signed-off-by: John Jacques <john.jacques@lsi.com>
Signed-off-by: Xulin Sun <xulin.sun@windriver.com>
---
 drivers/mtd/nand/lsi_acp_nand.c |   23 +++--------------------
 1 files changed, 3 insertions(+), 20 deletions(-)

diff --git a/drivers/mtd/nand/lsi_acp_nand.c b/drivers/mtd/nand/lsi_acp_nand.c
index 2e3ea8d..b10cae3 100644
--- a/drivers/mtd/nand/lsi_acp_nand.c
+++ b/drivers/mtd/nand/lsi_acp_nand.c
@@ -3518,29 +3518,12 @@ lsi_nand_init(void)
 	  The ECC status register and mask are different on 344x, 342x, 35xx...
 	*/
 
-	np = of_find_compatible_node(NULL, NULL, "lsi,acp3500");
-
-	if (NULL != np) {
+	if (of_machine_is_compatible("lsi,acp3500")) {
 		pecc_busy_register = (gpreg_base + 0x8c);
 		pecc_busy_mask = (1 << 20);
 	} else {
-		np = of_find_compatible_node(NULL, NULL, "lsi,acp3420");
-
-		if (NULL != np) {
-			pecc_busy_register = (gpreg_base + 0xc);
-			pecc_busy_mask = (1 << 28);
-		} else {
-			np = of_find_compatible_node(NULL, NULL, "lsi,acp3440");
-
-			if (NULL != np) {
-				pecc_busy_register = (gpreg_base + 0xc);
-				pecc_busy_mask = (1 << 25);
-			} else {
-				printk(KERN_ERR "Unsupported NAND Target\n");
-
-				return -1;
-			}
-		}
+		pecc_busy_register = (gpreg_base + 0xc);
+		pecc_busy_mask = (1 << 28);
 	}
 
 	/*
-- 
1.7.5.4

