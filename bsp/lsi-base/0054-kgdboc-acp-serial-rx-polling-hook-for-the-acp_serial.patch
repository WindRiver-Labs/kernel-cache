From 79e244b1a917b2e55efffb7b9d7d135b1369e38b Mon Sep 17 00:00:00 2001
From: Jiang Lu <lu.jiang@windriver.com>
Date: Thu, 25 Apr 2013 15:54:14 +0800
Subject: [PATCH 54/76] kgdboc, acp serial: rx polling hook for the acp_serial driver

The patch is base upon Jason's commit
[
kgdboc, amba-pl011: rx polling hook for the amba-pl011 driver

The RX polling hook allows the debugger to hook character input so as
to allow entry to the kernel debugger with a control-c as an example.
]

Signed-off-by: Wei Yang <Wei.Yang@windriver.com>
---
 drivers/tty/serial/lsi_acp_serial.c |    4 ++++
 1 files changed, 4 insertions(+), 0 deletions(-)

diff --git a/drivers/tty/serial/lsi_acp_serial.c b/drivers/tty/serial/lsi_acp_serial.c
index 49ffd30..96adf00 100644
--- a/drivers/tty/serial/lsi_acp_serial.c
+++ b/drivers/tty/serial/lsi_acp_serial.c
@@ -333,6 +333,10 @@ acp_serial_rx_chars(struct uart_acp_port *uap)
 				flag = TTY_FRAME;
 		}
 
+#ifdef CONFIG_CONSOLE_POLL
+		if (uap->port.poll_rx_cb && uap->port.poll_rx_cb(ch))
+			goto ignore_char;
+#endif
 		if (uart_handle_sysrq_char(&uap->port, ch & 255))
 			goto ignore_char;
 
-- 
1.7.0.5

