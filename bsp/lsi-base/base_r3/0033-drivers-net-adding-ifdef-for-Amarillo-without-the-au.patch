From 0539625c0c3d12bd52c51b8a3f040b502213d70b Mon Sep 17 00:00:00 2001
From: Paul Butler <paul.butler@windriver.com>
Date: Thu, 7 Nov 2013 16:55:47 -0600
Subject: [PATCH 33/75] drivers/net: adding ifdef for Amarillo, without the
 auto-negotiate ecn.

Signed-off-by: Paul Butler <paul.butler@windriver.com>
---
 drivers/net/ethernet/lsi/lsi_acp_net.c |    7 +++++--
 1 files changed, 5 insertions(+), 2 deletions(-)

diff --git a/drivers/net/ethernet/lsi/lsi_acp_net.c b/drivers/net/ethernet/lsi/lsi_acp_net.c
index 0635bae..7e58e96 100644
--- a/drivers/net/ethernet/lsi/lsi_acp_net.c
+++ b/drivers/net/ethernet/lsi/lsi_acp_net.c
@@ -275,9 +275,9 @@ skip_first:
 		return ret;
 	}
 
-#ifdef CONFIG_ARCH_AXXIA
+#ifdef AMARILLO_WA
 	/*
-	 * For the Axxia AXM, set RX FIFO size to 0x7.
+	 * For Amarillo, without the auto-negotiate ecn.
 	 */
 	{
 		u16 val;
@@ -298,6 +298,9 @@ skip_first:
 		rc |= acp_mdio_read(phydev->addr, PHY_BCM_TEST_REG, &val);
 		val &= ~0x80;
 		rc |= acp_mdio_write(phydev->addr, PHY_BCM_TEST_REG, val);
+
+		if (0 != rc)
+			return -EIO;
 	}
 #endif
 	netdev_info(dev,
-- 
1.7.5.4

