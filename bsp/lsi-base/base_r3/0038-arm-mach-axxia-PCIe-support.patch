From e1ee4e766876ee9c4f7177ad13f87b3d08f75b99 Mon Sep 17 00:00:00 2001
From: John Jacques <john.jacques@lsi.com>
Date: Mon, 16 Sep 2013 20:05:42 -0500
Subject: [PATCH 38/75] arm/mach-axxia: PCIe support.

Signed-off-by: John Jacques <john.jacques@lsi.com>
---
 arch/arm/boot/dts/axm55xx.dts |   64 +++++++++++++++++++++++++++++++++++++++++
 arch/arm/mach-axxia/axxia.c   |    4 --
 2 files changed, 64 insertions(+), 4 deletions(-)

diff --git a/arch/arm/boot/dts/axm55xx.dts b/arch/arm/boot/dts/axm55xx.dts
index 70a2fc7..68549f5 100644
--- a/arch/arm/boot/dts/axm55xx.dts
+++ b/arch/arm/boot/dts/axm55xx.dts
@@ -246,6 +246,70 @@
 		mac-address = [00 00 00 00 00 00];
 	};
 
+        PCIE0: pciex@0x3000000000 {
+                compatible = "lsi,plb-pciex";
+                device_type = "pci";
+                status = "ok";
+                port = <0>;
+                #interrupt-cells = <1>;
+                #size-cells = <2>;
+                #address-cells = <3>;
+                /* config space access MPAGE7 registers*/
+                reg = < 0x30 0x38000000 0x0 0x01000000
+                0x20 0x20120000 0x0 0x00008000 >;
+                /* Outbound ranges */
+                /* < <3-cell PCI addr> <2-cell CPU (PLB) addr> <2-cell size> >*/
+                ranges = <0x03000000 0x00000000 0xa0000000
+                          0x30 0x00000000
+                          0x00 0x20000000>;
+                /* Inbound ranges */
+                /* < <3-cell PCI addr> <2-cell CPU addr> <2-cell size> > */
+                dma-ranges = <0x03000000 0x00000000 0x00000000
+                              0x00 0x00000000
+                              0x00 0x40000000>;
+                interrupts = <0 68 4>,
+                             <0 73 4>,
+                             <0 74 4>,
+                             <0 75 4>,
+                             <0 76 4>,
+                             <0 77 4>,
+                             <0 78 4>,
+                             <0 79 4>,
+                             <0 80 4>,
+                             <0 81 4>,
+                             <0 82 4>,
+                             <0 83 4>,
+                             <0 84 4>,
+                             <0 85 4>,
+                             <0 86 4>,
+                             <0 87 4>,
+                             <0 88 4>;
+        };
+
+        PCIE1: pciex@0x3080000000 {
+                compatible = "lsi,plb-pciex";
+                device_type = "pci";
+                status = "ok";
+                port = <1>;
+                #interrupt-cells = <1>;
+                #size-cells = <2>;
+                #address-cells = <3>;
+                /* config space access MPAGE7 registers*/
+                reg = <0x30 0xb8000000 0x0 0x01000000
+                       0x20 0x20130000 0x0 0x00008000 >;
+                /* Outbound ranges */
+                /* < <3-cell PCI addr> <2-cell CPU (PLB) addr> <2-cell size> > */
+                ranges = <0x03000000 0x00000000 0xa0000000
+                          0x30 0x80000000
+                          0x00 0x20000000>;
+                /* Inbound ranges */
+                /* < <3-cell PCI addr> <2-cell CPU addr> <2-cell size> > */
+                dma-ranges = <0x03000000 0x00000000 0x00000000
+                              0x00 0x00000000
+                              0x00 0x40000000>;
+                interrupts = <0 70 4>;
+        };
+
 	USB0: usb@004a4000 {
 		device_type = "usb";
 		compatible = "lsi,acp-usb";
diff --git a/arch/arm/mach-axxia/axxia.c b/arch/arm/mach-axxia/axxia.c
index e72fe1f..a4676d3 100644
--- a/arch/arm/mach-axxia/axxia.c
+++ b/arch/arm/mach-axxia/axxia.c
@@ -225,10 +225,6 @@ void __init axxia_dt_init(void)
 	}
 
 	axxia_pcie_init();
-
-#ifdef CONFIG_I2C
-	axxia_register_i2c_busses();
-#endif
 }
 
 static void axxia_restart(char str, const char *cmd)
-- 
1.7.5.4

