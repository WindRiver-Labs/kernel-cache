From 5be52be5a854bea8ebc7aa03b7af57b9ce7041d4 Mon Sep 17 00:00:00 2001
From: SangeethaRao <sangeetha.rao@lsi.com>
Date: Tue, 1 Apr 2014 23:17:33 -0500
Subject: [PATCH 5/9] LSI AXM55xx i2c: Adding support for AXM3500 I2C driver

This patch adds i2c support for the 3500 board

Signed-off-by: SangeethaRao <sangeetha.rao@lsi.com>
Signed-off-by: Xulin Sun <xulin.sun@windriver.com>
---
 drivers/i2c/busses/i2c-axxia.c |   11 +++++++++--
 1 files changed, 9 insertions(+), 2 deletions(-)

diff --git a/drivers/i2c/busses/i2c-axxia.c b/drivers/i2c/busses/i2c-axxia.c
index 39e45c7..14396b6 100644
--- a/drivers/i2c/busses/i2c-axxia.c
+++ b/drivers/i2c/busses/i2c-axxia.c
@@ -14,7 +14,6 @@
 #include <linux/init.h>
 #include <linux/platform_device.h>
 #include <linux/clk.h>
-#include <linux/clkdev.h>
 #include <linux/err.h>
 #include <linux/i2c.h>
 #include <linux/io.h>
@@ -501,6 +500,10 @@ axxia_i2c_probe(struct platform_device *pdev)
 	u32 bus = pdev->id;
 	int irq = 0;
 	int ret = 0;
+	int speed_property = 0;
+
+	speed_property = of_find_compatible_node(NULL, NULL,
+		"lsi,axxia35xx") != NULL;
 
 	base = of_iomap(np, 0);
 	if (!base) {
@@ -537,7 +540,11 @@ axxia_i2c_probe(struct platform_device *pdev)
 
 	of_property_read_u32(np, "bus", &bus);
 
-	of_property_read_u32(np, "clock-frequency", &idev->bus_clk_rate);
+	if (speed_property)
+		of_property_read_u32(np, "speed", &idev->bus_clk_rate);
+	else
+		of_property_read_u32(np, "clock-frequency",
+			 &idev->bus_clk_rate);
 
 	if (idev->bus_clk_rate == 0)
 		idev->bus_clk_rate = 100000; /* default clock rate */
-- 
1.7.5.4

