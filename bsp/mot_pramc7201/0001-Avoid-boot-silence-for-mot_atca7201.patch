From 5df286ba886dcd606909c5d0196ea53ac3443d1f Mon Sep 17 00:00:00 2001
From: zumeng chen <zchen@pek-cc-pb02l.(none)>
Date: Sat, 5 Jul 2008 07:04:27 +0800
Subject: [PATCH 1/1] Avoid boot silence for mot_atca7201

A workaround way to avoid entering into video dead loop,
which tries to select correct video mode from screen. This
change happenes from v2.6.23-rc1 due to a key transition
for arch/i386/boot from assemble codes to C codes.
---
 arch/x86/Kconfig     |   10 ++++++++++
 arch/x86/boot/main.c |    2 ++
 2 files changed, 12 insertions(+), 0 deletions(-)

diff --git a/arch/x86/Kconfig b/arch/x86/Kconfig
index 2d21221..173d385 100644
--- a/arch/x86/Kconfig
+++ b/arch/x86/Kconfig
@@ -737,6 +737,16 @@ config I8K
 	  Say Y if you intend to run this kernel on a Dell Inspiron 8000.
 	  Say N otherwise.
 
+config MPENTIUMM_PAMC7201
+	bool "Pentium M embedded in mot_pramc7201"
+	depends on MPENTIUMM 
+	help
+	  Add this selection for the Motorola ATCA blade processor, which
+	  is intended to avoid boot silence through skipping set_video 
+	  when bootloader tries to initialzie video in embedded application.
+	  This is just a workaround way for Intel Pentium M (not Pentium-4 M)
+	  acted as a ATCA blade process, and should be removed in the future.
+
 config X86_REBOOTFIXUPS
 	def_bool n
 	prompt "Enable X86 board specific fixups for reboot"
diff --git a/arch/x86/boot/main.c b/arch/x86/boot/main.c
index 77569a4..32f33ac 100644
--- a/arch/x86/boot/main.c
+++ b/arch/x86/boot/main.c
@@ -162,8 +162,10 @@ void main(void)
 	query_edd();
 #endif
 
+#if !defined(CONFIG_MPENTIUMM_PAMC7201)
 	/* Set the video mode */
 	set_video();
+#endif
 
 	/* Do the last things and invoke protected mode */
 	go_to_protected_mode();
-- 
1.5.5.1.67.gbdb8

