From 9eeadb194b5280a80adceea652bae46d521bb220 Mon Sep 17 00:00:00 2001
From: Liu Changhui <changhui.liu@windriver.com>
Date: Sun, 6 Jun 2010 13:56:49 +0800
Subject: [PATCH 03/21] Platform bcm5300x exception support

Add bcm5300x exception support

Source: from broadcom SDK

Signed-off-by: Liu Changhui <changhui.liu@windriver.com>
---
 arch/mips/kernel/traps.c |    3 ++-
 1 files changed, 2 insertions(+), 1 deletions(-)

diff --git a/arch/mips/kernel/traps.c b/arch/mips/kernel/traps.c
index 0648874..53d9ba9 100644
--- a/arch/mips/kernel/traps.c
+++ b/arch/mips/kernel/traps.c
@@ -47,6 +47,7 @@
 #include <asm/mmu_context.h>
 #include <asm/types.h>
 #include <asm/stacktrace.h>
+#include <asm/war.h>
 
 extern void check_wait(void);
 extern asmlinkage void r4k_wait(void);
@@ -1497,7 +1498,7 @@ void __cpuinit per_cpu_trap_init(void)
 	 *  o read IntCtl.IPTI to determine the timer interrupt
 	 *  o read IntCtl.IPPCI to determine the performance counter interrupt
 	 */
-	if (cpu_has_mips_r2) {
+	if (cpu_has_mips_r2 && !bcm53000_compare_irq_war) {
 		cp0_compare_irq = (read_c0_intctl() >> 29) & 7;
 		cp0_perfcount_irq = (read_c0_intctl() >> 26) & 7;
 		if (cp0_perfcount_irq == cp0_compare_irq)
-- 
1.7.0.4

