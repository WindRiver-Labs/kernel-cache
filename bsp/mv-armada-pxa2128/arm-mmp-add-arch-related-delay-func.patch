From cb0502ab0f575686914db7e92ce144f197bbd23e Mon Sep 17 00:00:00 2001
From: Zumeng Chen <zumeng.chen@windriver.com>
Date: Tue, 6 Aug 2013 11:11:20 +0800
Subject: [PATCH 12/60] arm: mmp: add arch related delay func.

Original patches come from M5.3.12.5.4_source.

Signed-off-by: Zumeng Chen <zumeng.chen@windriver.com>
---
 arch/arm/mach-mmp/include/mach/delay.h |   41 ++++++++++++++++++++++++++++++++
 1 files changed, 41 insertions(+), 0 deletions(-)
 create mode 100644 arch/arm/mach-mmp/include/mach/delay.h

diff --git a/arch/arm/mach-mmp/include/mach/delay.h b/arch/arm/mach-mmp/include/mach/delay.h
new file mode 100644
index 0000000..bd2390c
--- /dev/null
+++ b/arch/arm/mach-mmp/include/mach/delay.h
@@ -0,0 +1,41 @@
+/*
+ * arch/arm/mach-mmp/include/mach/delay.h
+ *
+ * Copyright (C) 2011 Marvell, Inc.
+ *
+ * Author:
+ *  Raul Xiong <xjian@marvell.com>
+ *
+ * This software is licensed under the terms of the GNU General Public
+ * License version 2, as published by the Free Software Foundation, and
+ * may be copied, distributed, and modified under those terms.
+ *
+ * This program is distributed in the hope that it will be useful,
+ * but WITHOUT ANY WARRANTY; without even the implied warranty of
+ * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
+ * GNU General Public License for more details.
+ *
+ */
+#ifndef __MACH_MMP_DELAY_H
+#define __MACH_MMP_DELAY_H
+
+/* needed by loops_per_jiffy calculations */
+extern void __delay(int loops);
+
+extern void __udelay(unsigned long usecs);
+extern void __const_udelay(unsigned long usecs);
+
+/* we don't have any restrictions on maximum udelay length, but we'll enforce
+ * the same restriction as the ARM default so we don't introduce any
+ * incompatibilties in drivers.
+ */
+extern void __bad_udelay(void);
+
+#define MAX_UDELAY_MS 2
+
+#define udelay(n)							\
+	((__builtin_constant_p(n) && (n) > (MAX_UDELAY_MS * 1000)) ?	\
+		__bad_udelay() :					\
+		__udelay(n))
+
+#endif /* defined(__MACH_MMP_DELAY_H) */
-- 
1.7.5.4

