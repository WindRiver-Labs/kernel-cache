From b9e469dd2a2e45520ec304b15f2ae3fa8fed5ba0 Mon Sep 17 00:00:00 2001
From: Zumeng Chen <zumeng.chen@windriver.com>
Date: Tue, 6 Aug 2013 11:11:23 +0800
Subject: [PATCH 39/60] arm: mmp: a compiling fix for hotplug

This patch resolve the compiling fix when forward-porting from
3.0.31 to WRLinux 3.4.x for hotplug.

Signed-off-by: Zumeng Chen <zumeng.chen@windriver.com>
---
 arch/arm/mach-mmp/pm-hotplug.c |   11 +++++++++++
 1 files changed, 11 insertions(+), 0 deletions(-)

diff --git a/arch/arm/mach-mmp/pm-hotplug.c b/arch/arm/mach-mmp/pm-hotplug.c
index 7f34974..0de9870 100644
--- a/arch/arm/mach-mmp/pm-hotplug.c
+++ b/arch/arm/mach-mmp/pm-hotplug.c
@@ -26,6 +26,7 @@
 #include <linux/reboot.h>
 #include <linux/gpio.h>
 #include <linux/cpufreq.h>
+#include <linux/kobject.h>
 #include <linux/pm_qos.h>
 
 #ifdef CONFIG_CORE_MORPHING
@@ -241,6 +242,7 @@ static struct notifier_block hotplug_constraint_notifier = {
 	.notifier_call = hotplug_constraint_notify,
 };
 
+static struct kobject hotplug_kobj;
 struct pm_qos_request min_cpu_req;
 struct pm_qos_request max_cpu_req;
 
@@ -395,6 +397,11 @@ static struct attribute *hotplug_attributes[] = {
 	NULL,
 };
 
+static struct kobj_type hotplug_dir_ktype = {
+	.sysfs_ops	= &kobj_sysfs_ops,
+	.default_attrs	= hotplug_attributes,
+};
+
 static int __init mmp_pm_hotplug_init(void)
 {
 #ifdef CONFIG_CORE_MORPHING
@@ -441,6 +448,10 @@ static int __init mmp_pm_hotplug_init(void)
 		pr_err("%s: Failed to register disable hp PM QoS notifier\n",
 			__func__);
 
+	if (kobject_init_and_add(&hotplug_kobj, &hotplug_dir_ktype,
+				&cpu_subsys.dev_root->kobj, "hotplug"))
+		pr_err("%s: Failed to add kobject for hotplug\n", __func__);
+
 	return 0;
 }
 
-- 
1.7.5.4

