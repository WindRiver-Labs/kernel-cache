From 762f4bd588c1643beee793918c97deb540ced364 Mon Sep 17 00:00:00 2001
From: Guoqing Jiang <Guoqing.Jiang@windriver.com>
Date: Wed, 27 Oct 2010 09:31:02 +0800
Subject: [PATCH 19/26] Mindspeed-c1k: add i2c eeprom support

Add mindspeed c1k board i2c info, and modify i2c eeprom driver
for c1k board.

Signed-off-by: Guoqing Jiang <Guoqing.Jiang@windriver.com>
---
 arch/arm/mach-comcerto/board-c1kmfcn_evm.c |   12 ++++++++++++
 drivers/misc/eeprom/at24.c                 |   13 +++++++++++++
 2 files changed, 25 insertions(+), 0 deletions(-)

diff --git a/arch/arm/mach-comcerto/board-c1kmfcn_evm.c b/arch/arm/mach-comcerto/board-c1kmfcn_evm.c
index 751fbfd..5a1d457 100644
--- a/arch/arm/mach-comcerto/board-c1kmfcn_evm.c
+++ b/arch/arm/mach-comcerto/board-c1kmfcn_evm.c
@@ -405,6 +405,14 @@ static struct platform_device *comcerto_devices[] __initdata = {
 #endif
 };
 
+#if defined(CONFIG_CONFIG_I2C_BOARDINFO)
+static struct i2c_board_info comcerto_i2c_info[] = {
+	{
+		I2C_BOARD_INFO("24c512", 0x50),
+	},
+};
+#endif
+
 /************************************************************************
  *  Machine definition
  *
@@ -424,6 +432,10 @@ static void __init platform_init(void)
 	device_init();
 	board_gpio_init();
 	platform_add_devices(comcerto_devices, ARRAY_SIZE(comcerto_devices));
+#if defined(CONFIG_CONFIG_I2C_BOARDINFO)
+	i2c_register_board_info(0, comcerto_i2c_info,
+				ARRAY_SIZE(comcerto_i2c_info));
+#endif
 }
 
 MACHINE_START(COMCERTO, "Comcerto 1000 (Multifunction EVM)")
diff --git a/drivers/misc/eeprom/at24.c b/drivers/misc/eeprom/at24.c
index db7d0f2..e98dec1 100644
--- a/drivers/misc/eeprom/at24.c
+++ b/drivers/misc/eeprom/at24.c
@@ -608,7 +608,16 @@ static int __devexit at24_remove(struct i2c_client *client)
 	return 0;
 }
 
+static int at24_detect(struct i2c_client *client, struct i2c_board_info *info)
+{
+       strlcpy(info->type, "24c512", I2C_NAME_SIZE);
+
+       return 0;
+}
+
 /*-------------------------------------------------------------------------*/
+/* Addresses to scan */
+static const unsigned short normal_i2c[] = { 0x50, I2C_CLIENT_END };
 
 static struct i2c_driver at24_driver = {
 	.driver = {
@@ -618,6 +627,10 @@ static struct i2c_driver at24_driver = {
 	.probe = at24_probe,
 	.remove = __devexit_p(at24_remove),
 	.id_table = at24_ids,
+
+	.class  = I2C_CLASS_SPD,
+	.detect = at24_detect,
+	.address_list = normal_i2c,
 };
 
 static int __init at24_init(void)
-- 
1.5.4.3

