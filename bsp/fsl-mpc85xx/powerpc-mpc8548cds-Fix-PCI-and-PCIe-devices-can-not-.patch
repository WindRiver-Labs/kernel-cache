From 784bb8369d98a005e5fc56fe9d87b7a39e3b6c3c Mon Sep 17 00:00:00 2001
From: Bin Jiang <bin.jiang@windriver.com>
Date: Mon, 11 Mar 2013 17:00:38 +0800
Subject: [PATCH] powerpc/mpc8548cds: Fix PCI and PCIe devices can not run

PCI/PCIe devices share the same hardware irq with i8259 controller.
In preempt-rt, i8259 cascaded to mpic is not threaded but PCI/PCIe
devices routed to mpic are threaded, so PCI/PCIe devices fail to
enable the shared irq.

Since no any devices routed to i8259 are supported, enable irq thread
of i8259.

Signed-off-by: Bin Jiang <bin.jiang@windriver.com>
---
 arch/powerpc/platforms/85xx/mpc85xx_cds.c |    2 +-
 1 files changed, 1 insertions(+), 1 deletions(-)

diff --git a/arch/powerpc/platforms/85xx/mpc85xx_cds.c b/arch/powerpc/platforms/85xx/mpc85xx_cds.c
index edd78ff..172745f 100644
--- a/arch/powerpc/platforms/85xx/mpc85xx_cds.c
+++ b/arch/powerpc/platforms/85xx/mpc85xx_cds.c
@@ -212,7 +212,7 @@ static irqreturn_t mpc85xx_8259_cascade_action(int irq, void *dev_id)
 
 static struct irqaction mpc85xxcds_8259_irqaction = {
 	.handler = mpc85xx_8259_cascade_action,
-	.flags = IRQF_SHARED | IRQF_NO_THREAD,
+	.flags = IRQF_SHARED,
 	.name = "8259 cascade",
 };
 #endif /* PPC_I8259 */
-- 
1.7.0

