From 6ea52fc698b68370f98a0444afd525b2d3efd3dd Mon Sep 17 00:00:00 2001
From: Stanley.Miao <stanley.miao@windriver.com>
Date: Tue, 15 Mar 2011 11:01:30 +0800
Subject: [PATCH 16/16] Add a NULL set_awake function to remove the Warning message

The following warning message will be printed after the rtcwake command.

rtcwake -d /dev/rtc0 -m mem -s 30

------------[ cut here ]------------
WARNING: at /work/build/stm_spear13xx/build/linux/kernel/irq/manage.c:361 set_irq_wake+0x90/0xf0()
Unbalanced IRQ 68 wake disable
Modules linked in: x_tables ip_tables ipv6 sctp binfmt_misc [last unloaded: scsi_wait_scan]
[<c0043df8>] (unwind_backtrace+0x0/0xf0) from [<c049d7c4>] (dump_stack+0x20/0x24)
[<c049d7c4>] (dump_stack+0x20/0x24) from [<c0061be8>] (warn_slowpath_common+0x58/0x70)
[<c0061be8>] (warn_slowpath_common+0x58/0x70) from [<c0061c5c>] (warn_slowpath_fmt+0x38/0x40)
[<c0061c5c>] (warn_slowpath_fmt+0x38/0x40) from [<c00b8504>] (set_irq_wake+0x90/0xf0)
[<c00b8504>] (set_irq_wake+0x90/0xf0) from [<c03946c8>] (spear_rtc_resume+0x4c/0xa4)
[<c03946c8>] (spear_rtc_resume+0x4c/0xa4) from [<c0329adc>] (platform_pm_resume+0x58/0x64)
[<c0329adc>] (platform_pm_resume+0x58/0x64) from [<c032c748>] (pm_op+0x84/0xc4)
[<c032c748>] (pm_op+0x84/0xc4) from [<c032cb68>] (device_resume+0x60/0x110)
[<c032cb68>] (device_resume+0x60/0x110) from [<c032cd58>] (dpm_resume_end+0xec/0x32c)
[<c032cd58>] (dpm_resume_end+0xec/0x32c) from [<c009c7cc>] (suspend_devices_and_enter+0x17c/0x1c0)
[<c009c7cc>] (suspend_devices_and_enter+0x17c/0x1c0) from [<c009c8c8>] (enter_state+0xb8/0xe4)
[<c009c8c8>] (enter_state+0xb8/0xe4) from [<c009bf64>] (state_store+0xb4/0xc8)
[<c009bf64>] (state_store+0xb4/0xc8) from [<c02d3b4c>] (kobj_attr_store+0x20/0x24)
[<c02d3b4c>] (kobj_attr_store+0x20/0x24) from [<c0174e18>] (sysfs_write_file+0x118/0x14c)
[<c0174e18>] (sysfs_write_file+0x118/0x14c) from [<c012320c>] (vfs_write+0xc4/0x140)
[<c012320c>] (vfs_write+0xc4/0x140) from [<c01233fc>] (sys_write+0x50/0x100)
[<c01233fc>] (sys_write+0x50/0x100) from [<c003bc00>] (ret_fast_syscall+0x0/0x3c)
---[ end trace 094ac038bc5157fb ]---

The generation of this warning message is because there is not a set_awake()
function in the gic irq_chip, so the wakeup ability of RTC interrupt cannot
be disabled. Now a NULL set_awake() function is added to remove this warning
message.

Signed-off-by: Stanley.Miao <stanley.miao@windriver.com>
---
 arch/arm/common/gic.c |    6 ++++++
 1 files changed, 6 insertions(+), 0 deletions(-)

diff --git a/arch/arm/common/gic.c b/arch/arm/common/gic.c
index 337741f..2a5fcad 100644
--- a/arch/arm/common/gic.c
+++ b/arch/arm/common/gic.c
@@ -156,11 +156,17 @@ static void gic_handle_cascade_irq(unsigned int irq, struct irq_desc *desc)
 	chip->unmask(irq);
 }
 
+static int gic_set_wake(unsigned int irq, unsigned int on)
+{
+	return 0;
+}
+
 static struct irq_chip gic_chip = {
 	.name		= "GIC",
 	.ack		= gic_ack_irq,
 	.mask		= gic_mask_irq,
 	.unmask		= gic_unmask_irq,
+	.set_wake	= gic_set_wake,
 #ifdef CONFIG_SMP
 	.set_affinity	= gic_set_cpu,
 #endif
-- 
1.7.0.4

