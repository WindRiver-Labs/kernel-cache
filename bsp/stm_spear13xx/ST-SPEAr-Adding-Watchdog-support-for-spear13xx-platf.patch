From 2e800f3ee789f162cc587e11fcb2b35314a88f54 Mon Sep 17 00:00:00 2001
From: Stanley.Miao <stanley.miao@windriver.com>
Date: Tue, 22 Feb 2011 16:37:03 +0800
Subject: [PATCH 12/16] ST SPEAr: Adding Watchdog support for spear13xx platform

Original source codes came from vendor drop.

Register the watchdog device in spear1310_evb board file.

Signed-off-by: Viresh Kumar <viresh.kumar@st.com>
Integrated-by: Stanley.Miao <stanley.miao@windriver.com>
---
 arch/arm/mach-spear13xx/include/mach/generic.h |    1 +
 arch/arm/mach-spear13xx/spear1310_evb.c        |    1 +
 arch/arm/mach-spear13xx/spear13xx.c            |   16 ++++++++++++++++
 3 files changed, 18 insertions(+), 0 deletions(-)

diff --git a/arch/arm/mach-spear13xx/include/mach/generic.h b/arch/arm/mach-spear13xx/include/mach/generic.h
index 503bd6d..e64b315 100644
--- a/arch/arm/mach-spear13xx/include/mach/generic.h
+++ b/arch/arm/mach-spear13xx/include/mach/generic.h
@@ -38,6 +38,7 @@ extern struct platform_device spear13xx_ohci0_device;
 extern struct platform_device spear13xx_ohci1_device;
 extern struct platform_device spear13xx_rtc_device;
 extern struct platform_device spear13xx_smi_device;
+extern struct platform_device spear13xx_wdt_device;
 extern struct sys_timer spear13xx_timer;
 
 /* Add spear13xx family function declarations here */
diff --git a/arch/arm/mach-spear13xx/spear1310_evb.c b/arch/arm/mach-spear13xx/spear1310_evb.c
index bb857eb..3c14c64 100644
--- a/arch/arm/mach-spear13xx/spear1310_evb.c
+++ b/arch/arm/mach-spear13xx/spear1310_evb.c
@@ -62,6 +62,7 @@ static struct platform_device *plat_devs[] __initdata = {
 	&spear13xx_ohci1_device,
 	&spear13xx_rtc_device,
 	&spear13xx_smi_device,
+	&spear13xx_wdt_device,
 
 	/* spear1310 specific devices */
 	&spear1310_phy0_device,
diff --git a/arch/arm/mach-spear13xx/spear13xx.c b/arch/arm/mach-spear13xx/spear13xx.c
index 82a0b40..1a9e41b 100644
--- a/arch/arm/mach-spear13xx/spear13xx.c
+++ b/arch/arm/mach-spear13xx/spear13xx.c
@@ -316,6 +316,22 @@ struct platform_device spear13xx_smi_device = {
 	.resource = smi_resources,
 };
 
+/* wdt device registration */
+static struct resource wdt_resources[] = {
+	{
+		.start = SPEAR13XX_WDT_BASE,
+		.end = SPEAR13XX_WDT_BASE + SZ_256 - 1,
+		.flags = IORESOURCE_MEM,
+	},
+};
+
+struct platform_device spear13xx_wdt_device = {
+	.name = "cortexa9-wdt",
+	.id = -1,
+	.num_resources = ARRAY_SIZE(wdt_resources),
+	.resource = wdt_resources,
+};
+
 /* Do spear13xx familiy common initialization part here */
 void __init spear13xx_init(void)
 {
-- 
1.7.0.4

