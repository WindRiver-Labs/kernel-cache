From be414b4e28305147b40e199a863875b91900a393 Mon Sep 17 00:00:00 2001
From: Kevin Hao <kexin.hao@windriver.com>
Date: Fri, 9 Aug 2013 19:22:20 +0800
Subject: [PATCH 7/9] powerpc: set the correct kernstart_addr when
 CONFIG_PHYS_64BIT is enabled

When CONFIG_PHYS_64BIT is enabled, the phys_addr_t is a 64bit
integer. So we should store the r21 to the lower 32bit.

Signed-off-by: Kevin Hao <kexin.hao@windriver.com>
---
 arch/powerpc/kernel/head_32.S |    4 ++++
 1 files changed, 4 insertions(+), 0 deletions(-)

diff --git a/arch/powerpc/kernel/head_32.S b/arch/powerpc/kernel/head_32.S
index 01f355d..43885c4 100644
--- a/arch/powerpc/kernel/head_32.S
+++ b/arch/powerpc/kernel/head_32.S
@@ -1327,7 +1327,11 @@ after_relocation_init:
 
 	/* Store kernstart_addr */
 	tophys(r3,r3)
+#ifdef CONFIG_PHYS_64BIT
+	stw	r21,4(r3)
+#else
 	stw	r21,0(r3)
+#endif
 
 	/*
 	 * Compute the virt_phys_offset :
-- 
1.7.5.4

