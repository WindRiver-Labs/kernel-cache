From 09eb7c102735dd2f6b6d33f764065b1e06b92b82 Mon Sep 17 00:00:00 2001
From: Yongli He <yongli.he@windriver.com>
Date: Fri, 28 Oct 2011 14:49:06 +0800
Subject: [PATCH 3/4] fsl_p50x0: booke watch dog support for PPC64

BOOKE watchdog support works unmodified for BOOK3E. So to
enable it, we simply have to update the conditional statements
to include BOOK3E.

Signed-off-by: Yongli He <yongli.he@windriver.com>
---
 drivers/watchdog/Kconfig     |    2 +-
 drivers/watchdog/booke_wdt.c |    6 +++---
 2 files changed, 4 insertions(+), 4 deletions(-)

diff --git a/drivers/watchdog/Kconfig b/drivers/watchdog/Kconfig
index 3709624..3031aac 100644
--- a/drivers/watchdog/Kconfig
+++ b/drivers/watchdog/Kconfig
@@ -1094,7 +1094,7 @@ config BOOKE_WDT
 config BOOKE_WDT_DEFAULT_TIMEOUT
 	int "PowerPC Book-E Watchdog Timer Default Timeout"
 	depends on BOOKE_WDT
-	default 38 if FSL_BOOKE
+	default 38 if (FSL_BOOKE || CONFIG_PPC_FSL_BOOK3E)
 	range 0 63 if FSL_BOOKE
 	default 3 if !FSL_BOOKE
 	range 0 3 if !FSL_BOOKE
diff --git a/drivers/watchdog/booke_wdt.c b/drivers/watchdog/booke_wdt.c
index ce0ab44..d66ca95 100644
--- a/drivers/watchdog/booke_wdt.c
+++ b/drivers/watchdog/booke_wdt.c
@@ -37,7 +37,7 @@
 u32 booke_wdt_enabled;
 u32 booke_wdt_period = CONFIG_BOOKE_WDT_DEFAULT_TIMEOUT;
 
-#ifdef	CONFIG_FSL_BOOKE
+#if  defined(CONFIG_FSL_BOOKE) || defined(CONFIG_PPC_FSL_BOOK3E)
 #define WDTP(x)		((((x)&0x3)<<30)|(((x)&0x3c)<<15))
 #define WDTP_MASK	(WDTP(0x3f))
 #else
@@ -190,7 +190,7 @@ static long booke_wdt_ioctl(struct file *file,
 	case WDIOC_SETTIMEOUT:
 		if (get_user(tmp, p))
 			return -EFAULT;
-#ifdef	CONFIG_FSL_BOOKE
+#if  defined(CONFIG_FSL_BOOKE) || defined(CONFIG_PPC_FSL_BOOK3E)
 		/* period of 1 gives the largest possible timeout */
 		if (tmp > period_to_sec(1))
 			return -EINVAL;
@@ -201,7 +201,7 @@ static long booke_wdt_ioctl(struct file *file,
 		booke_wdt_set();
 		/* Fall */
 	case WDIOC_GETTIMEOUT:
-#ifdef	CONFIG_FSL_BOOKE
+#if	defined(CONFIG_FSL_BOOKE)  || defined(CONFIG_PPC_FSL_BOOK3E)
 		return put_user(period_to_sec(booke_wdt_period), p);
 #else
 		return put_user(booke_wdt_period, p);
-- 
1.7.7

