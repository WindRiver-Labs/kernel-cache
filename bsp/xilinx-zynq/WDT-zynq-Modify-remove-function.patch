From e62d6a756fb0d3a4f6920bab9bb9ed94b945cad1 Mon Sep 17 00:00:00 2001
From: Harini Katakam <harini.katakam@xilinx.com>
Date: Fri, 28 Mar 2014 15:56:11 +0530
Subject: [PATCH 449/509] WDT: zynq: Modify remove function

https://github.com/analogdevicesinc/linux.git xcomm_zynq
commit 7403473eff943d0999db5112b3f9c66ddc644492

Remove check for nowayout and the else condition with a message.
This is not required. Mainline drivers still use nowayout but
this check is not required in remove.

Signed-off-by: Harini Katakam <harinik@xilinx.com>
Signed-off-by: Michal Simek <michal.simek@xilinx.com>
Signed-off-by: Zhong Hongbo <hongbo.zhong@windriver.com>
---
 drivers/watchdog/zynq_wdt.c |   18 ++++--------------
 1 files changed, 4 insertions(+), 14 deletions(-)

diff --git a/drivers/watchdog/zynq_wdt.c b/drivers/watchdog/zynq_wdt.c
index 6a622e4..836a602 100644
--- a/drivers/watchdog/zynq_wdt.c
+++ b/drivers/watchdog/zynq_wdt.c
@@ -436,23 +436,13 @@ err_notifier:
  * Return: 0 on success, otherwise negative error.
  *
  * Unregister the device after releasing the resources.
- * Stop is allowed only when nowayout is disabled.
  */
 static int zynq_wdt_remove(struct platform_device *pdev)
 {
-	if (wdt && !nowayout) {
-		zynq_wdt_stop(&zynq_wdt_device);
-		watchdog_unregister_device(&zynq_wdt_device);
-		unregister_reboot_notifier(&zynq_wdt_notifier);
-		clk_disable_unprepare(wdt->clk);
-		clk_put(wdt->clk);
-		kfree(wdt);
-		wdt = NULL;
-		platform_set_drvdata(pdev, NULL);
-	} else {
-		dev_err(&pdev->dev, "Cannot stop watchdog, still ticking\n");
-		return -ENOTSUPP;
-	}
+	zynq_wdt_stop(&zynq_wdt_device);
+	watchdog_unregister_device(&zynq_wdt_device);
+	unregister_reboot_notifier(&zynq_wdt_notifier);
+	clk_disable_unprepare(wdt->clk);
 
 	return 0;
 }
-- 
1.7.5.4

