From dea6c0645e6b7beaffbfa2f6039b3a413895fce8 Mon Sep 17 00:00:00 2001
From: Laurent Pinchart <laurent.pinchart@ideasonboard.com>
Date: Thu, 23 May 2013 12:52:19 +0200
Subject: [PATCH 306/509] dma: xilinx: vdma: Remove the xilinx_vdma_config
 direction field

https://github.com/analogdevicesinc/linux.git xcomm_zynq
commit 391ae13c4664610c10bcb8f15cab715078bee88e

The direction is fixed for a given channel, there's not need to pass it
through the configuration structure.

Signed-off-by: Laurent Pinchart <laurent.pinchart@ideasonboard.com>
Acked-by: Srikanth Thokala <sthokal@xilinx.com>
Signed-off-by: Zhong Hongbo <hongbo.zhong@windriver.com>
---
 drivers/dma/xilinx/vdmatest.c       |    2 --
 drivers/dma/xilinx/xilinx_axivdma.c |    3 +--
 include/linux/amba/xilinx_dma.h     |    3 +--
 3 files changed, 2 insertions(+), 6 deletions(-)

diff --git a/drivers/dma/xilinx/vdmatest.c b/drivers/dma/xilinx/vdmatest.c
index 9e18361..d5be0da 100644
--- a/drivers/dma/xilinx/vdmatest.c
+++ b/drivers/dma/xilinx/vdmatest.c
@@ -293,7 +293,6 @@ static int vdmatest_slave_func(void *data)
 		}
 
 		/* Set up hardware configuration information */
-		config.direction = DMA_MEM_TO_DEV;
 		config.vsize = vsize;
 		config.hsize = hsize;
 		config.stride = hsize;
@@ -309,7 +308,6 @@ static int vdmatest_slave_func(void *data)
 		tx_dev->device_control(tx_chan, DMA_SLAVE_CONFIG,
 					(unsigned long)&config);
 
-		config.direction = DMA_DEV_TO_MEM;
 		config.park = 0;
 		rx_dev->device_control(rx_chan, DMA_SLAVE_CONFIG,
 					(unsigned long)&config);
diff --git a/drivers/dma/xilinx/xilinx_axivdma.c b/drivers/dma/xilinx/xilinx_axivdma.c
index a9e20e9..cb88268 100644
--- a/drivers/dma/xilinx/xilinx_axivdma.c
+++ b/drivers/dma/xilinx/xilinx_axivdma.c
@@ -487,7 +487,7 @@ static void xilinx_vdma_start_transfer(struct xilinx_vdma_chan *chan)
 
 	if (config->park && (config->park_frm >= 0)
 			&& (config->park_frm < chan->num_frms)) {
-		if (config->direction == DMA_MEM_TO_DEV)
+		if (chan->direction == DMA_MEM_TO_DEV)
 			vdma_write(chan, XILINX_VDMA_REG_PARK_PTR,
 				config->park_frm << XILINX_VDMA_PARK_PTR_RD_REF_SHIFT);
 		else
@@ -946,7 +946,6 @@ static int xilinx_vdma_slave_config(struct xilinx_vdma_chan *chan,
 	chan->config.stride = cfg->stride;
 	chan->config.frm_dly = cfg->frm_dly;
 	chan->config.park = cfg->park;
-	chan->config.direction = cfg->direction;
 
 	/* genlock settings */
 	chan->config.gen_lock = cfg->gen_lock;
diff --git a/include/linux/amba/xilinx_dma.h b/include/linux/amba/xilinx_dma.h
index 7b99b55..0360116 100644
--- a/include/linux/amba/xilinx_dma.h
+++ b/include/linux/amba/xilinx_dma.h
@@ -50,8 +50,7 @@
  * Xilinx VDMA, hsize must be -1
  */
 struct xilinx_vdma_config {
-	enum dma_transfer_direction direction;
-					/* Channel direction */
+	int reserved;			/* Not used */
 	int vsize;			/* Vertical size */
 	int hsize;			/* Horizontal size */
 	int stride;			/* Stride */
-- 
1.7.5.4

