From e662ca9549c80320c262e4ff2b2e05d45f49d874 Mon Sep 17 00:00:00 2001
From: Suneel Garapati <suneel.garapati@xilinx.com>
Date: Sat, 29 Jun 2013 09:16:08 +0530
Subject: [PATCH 16/20] mtd: m25p80: Use conditional compilation for OF
 function calls

git://github.com/Xilinx/linux-xlnx.git xilinx-v14.7
commit d96dfcfa6ae7d58d465d8db9ef668f5b7900fd4d

Place the code which calls OF api's under conditional compilation
parameter CONFIG_OF.

Signed-off-by: Suneel Garapati <suneel.garapati@xilinx.com>
Signed-off-by: Michal Simek <michal.simek@xilinx.com>
Signed-off-by: Liming Wang <liming.wang@windriver.com>
---
 drivers/mtd/devices/m25p80.c |    4 ++++
 1 files changed, 4 insertions(+), 0 deletions(-)

diff --git a/drivers/mtd/devices/m25p80.c b/drivers/mtd/devices/m25p80.c
index 303bdc1..62c177d 100644
--- a/drivers/mtd/devices/m25p80.c
+++ b/drivers/mtd/devices/m25p80.c
@@ -1348,6 +1348,7 @@ static int m25p_probe(struct spi_device *spi)
 	else {
 		/* enable 4-byte addressing if the device exceeds 16MiB */
 		if (flash->mtd.size > 0x1000000) {
+#ifdef CONFIG_OF
 			struct device_node *np;
 			const char *comp_str;
 			np = of_get_next_parent(spi->dev.of_node);
@@ -1356,9 +1357,12 @@ static int m25p_probe(struct spi_device *spi)
 				flash->addr_width = 3;
 				set_4byte(flash, info->jedec_id, 0);
 			} else {
+#endif
 				flash->addr_width = 4;
 				set_4byte(flash, info->jedec_id, 1);
+#ifdef CONFIG_OF
 			}
+#endif
 		} else
 			flash->addr_width = 3;
 	}
-- 
1.7.5.4

