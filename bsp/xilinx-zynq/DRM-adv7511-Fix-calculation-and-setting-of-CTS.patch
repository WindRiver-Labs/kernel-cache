From fb4c48de22b8446076768100262c8fbe7fba11b2 Mon Sep 17 00:00:00 2001
From: Lars-Peter Clausen <lars@metafoo.de>
Date: Mon, 6 Aug 2012 11:35:24 +0200
Subject: [PATCH 221/509] DRM: adv7511: Fix calculation and setting of CTS

https://github.com/analogdevicesinc/linux.git xcomm_zynq
commit e3fc9322ea0f0343e514aa5d640045f05d352971

The value calculated for cts is of by a factor of 1000 and also the value for n
is written to the cts register. This problem is not critical since the driver
configues the device to use the automatic cts value.

Signed-off-by: Lars-Peter Clausen <lars@metafoo.de>
Signed-off-by: Zhong Hongbo <hongbo.zhong@windriver.com>
---
 drivers/gpu/drm/i2c/adv7511_audio.c |    8 ++++----
 1 files changed, 4 insertions(+), 4 deletions(-)

diff --git a/drivers/gpu/drm/i2c/adv7511_audio.c b/drivers/gpu/drm/i2c/adv7511_audio.c
index 6ca4e7c..f24fe47 100644
--- a/drivers/gpu/drm/i2c/adv7511_audio.c
+++ b/drivers/gpu/drm/i2c/adv7511_audio.c
@@ -49,7 +49,7 @@ static void adv7511_calc_cts_n(unsigned int f_tmds, unsigned int fs,
 		break;
 	}
 
-	*cts = (f_tmds * *n) / (128 * fs);
+	*cts = ((f_tmds * *n) / (128 * fs)) * 1000;
 }
 
 static int adv7511_update_cts_n(struct adv7511 *adv7511)
@@ -63,9 +63,9 @@ static int adv7511_update_cts_n(struct adv7511 *adv7511)
 	regmap_write(adv7511->regmap, ADV7511_REG_N1, (n >> 8) & 0xff);
 	regmap_write(adv7511->regmap, ADV7511_REG_N2, n & 0xff);
 
-	regmap_write(adv7511->regmap, ADV7511_REG_CTS_MANUAL0, (n >> 16) & 0xf);
-	regmap_write(adv7511->regmap, ADV7511_REG_CTS_MANUAL1, (n >> 8) & 0xff);
-	regmap_write(adv7511->regmap, ADV7511_REG_CTS_MANUAL2, n & 0xff);
+	regmap_write(adv7511->regmap, ADV7511_REG_CTS_MANUAL0, (cts >> 16) & 0xf);
+	regmap_write(adv7511->regmap, ADV7511_REG_CTS_MANUAL1, (cts >> 8) & 0xff);
+	regmap_write(adv7511->regmap, ADV7511_REG_CTS_MANUAL2, cts & 0xff);
 
 	return 0;
 }
-- 
1.7.5.4

