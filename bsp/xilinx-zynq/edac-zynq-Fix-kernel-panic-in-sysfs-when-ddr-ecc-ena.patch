From b4ee527c1fbb230ad4e58e17075decfc8ce9d7bc Mon Sep 17 00:00:00 2001
From: Punnaiah Choudary Kalluri <punnaiah.choudary.kalluri@xilinx.com>
Date: Wed, 5 Feb 2014 13:32:27 +0530
Subject: [PATCH 124/182] edac: zynq: Fix kernel panic in sysfs when ddr ecc
 enabled

This patch comes from:
  https://github.com/Xilinx/linux-xlnx.git

This patch will fix the kernel panic occurs in sysfs_create_groups while
creating the edac memory controller attributes and when ddr ecc is enabled.
The mc_num argument for edac_mc_alloc function point to the current memory
controller number. The current driver passing this value as 0xffffffff
(pdev->id) this is wrong and causing the kernel panic. so, since zynq has
single ddr controller, always passing this argument value as zero.

Signed-off-by: Punnaiah Choudary Kalluri <punnaia@xilinx.com>
Signed-off-by: Michal Simek <michal.simek@xilinx.com>
(cherry picked from commit b496d52a71c96f60b8be077bd824199b6be25f2d)
Signed-off-by: Zumeng Chen <zumeng.chen@windriver.com>
---
 drivers/edac/zynq_edac.c |    2 +-
 1 files changed, 1 insertions(+), 1 deletions(-)

diff --git a/drivers/edac/zynq_edac.c b/drivers/edac/zynq_edac.c
index e6300ef..c126aa0 100644
--- a/drivers/edac/zynq_edac.c
+++ b/drivers/edac/zynq_edac.c
@@ -532,7 +532,7 @@ static int zynq_edac_mc_probe(struct platform_device *pdev)
 	layers[1].size = ZYNQ_EDAC_NR_CHANS;
 	layers[1].is_virt_csrow = false;
 
-	mci = edac_mc_alloc(pdev->id, ARRAY_SIZE(layers), layers,
+	mci = edac_mc_alloc(0, ARRAY_SIZE(layers), layers,
 			    sizeof(struct zynq_edac_priv));
 	if (mci == NULL) {
 		pr_err("Failed memory allocation for mci instance!\n");
-- 
1.7.5.4

