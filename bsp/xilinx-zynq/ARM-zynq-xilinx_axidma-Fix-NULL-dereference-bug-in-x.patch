From bd0471dabc53723844898f703a61e57f9a6b11bc Mon Sep 17 00:00:00 2001
From: Nicolae Rosia <nicolae.rosia@certsign.ro>
Date: Mon, 5 Jan 2015 18:07:08 +0200
Subject: [PATCH 012/456] ARM: zynq: xilinx_axidma: Fix NULL dereference bug
 in xilinx_dma_free_channels

If only one channel is defined, xilinx_dma_free_channels will dereference a NULL
pointer when iterating over the channels.

Signed-off-by: Nicolae Rosia <nicolae.rosia@certsign.ro>
Acked-by: Kedareswara rao Appana <appanad@xilinx.com>
Signed-off-by: Michal Simek <michal.simek@xilinx.com>
(cherry picked from commit 8e7ddd64183ebfe6565eeb8a8225e1a045a660c2)
---
 drivers/dma/xilinx/xilinx_axidma.c |    3 +++
 1 files changed, 3 insertions(+), 0 deletions(-)

diff --git a/drivers/dma/xilinx/xilinx_axidma.c b/drivers/dma/xilinx/xilinx_axidma.c
index ab11ec7..0df1337 100644
--- a/drivers/dma/xilinx/xilinx_axidma.c
+++ b/drivers/dma/xilinx/xilinx_axidma.c
@@ -863,6 +863,9 @@ static void xilinx_dma_free_channels(struct xilinx_dma_device *xdev)
 	int i;
 
 	for (i = 0; i < XILINX_DMA_MAX_CHANS_PER_DEVICE; i++) {
+		if (!xdev->chan[i])
+			continue;
+
 		list_del(&xdev->chan[i]->common.device_node);
 		tasklet_kill(&xdev->chan[i]->tasklet);
 		irq_dispose_mapping(xdev->chan[i]->irq);
-- 
1.7.5.4

