From eb3beb6679f17ae5a3a43d7cc4897c009de9bb7a Mon Sep 17 00:00:00 2001
From: Lars-Peter Clausen <lars@metafoo.de>
Date: Wed, 16 Oct 2013 14:52:21 +0200
Subject: [PATCH 186/456] DRM: adv7511: Avoid uneccessary disconnected events

This patch comes from:
  https://github.com/Xilinx/linux-xlnx.git

Only insert a delayed disconnected event when we transition from connected to
connect. If we transition from disconnected to connected there is no need for
this since the system will already assume that the monitor was disconnected.

Signed-off-by: Lars-Peter Clausen <lars@metafoo.de>
(cherry picked from commit 727c08524462a63ce10e314d4e1650294893ed2c)
Signed-off-by: Zumeng Chen <zumeng.chen@windriver.com>
---
 drivers/gpu/drm/i2c/adv7511_core.c |    5 +++--
 1 files changed, 3 insertions(+), 2 deletions(-)

diff --git a/drivers/gpu/drm/i2c/adv7511_core.c b/drivers/gpu/drm/i2c/adv7511_core.c
index be68212..97f1552 100644
--- a/drivers/gpu/drm/i2c/adv7511_core.c
+++ b/drivers/gpu/drm/i2c/adv7511_core.c
@@ -548,14 +548,15 @@ adv7511_encoder_detect(struct drm_encoder *encoder,
 
 	/* The chip resets itself when the cable is disconnected, so in case
 	 * there is a pending HPD interrupt and the cable is connected there was
-	 * at least on transition from disconnected to connected and the chip
+	 * at least one transition from disconnected to connected and the chip
 	 * has to be reinitialized. */
 	if (status == connector_status_connected && hpd &&
 	    adv7511->dpms_mode == DRM_MODE_DPMS_ON) {
 		regcache_mark_dirty(adv7511->regmap);
 		adv7511_encoder_dpms(encoder, adv7511->dpms_mode);
 		adv7511_get_modes(encoder, connector);
-		status = connector_status_disconnected;
+		if (adv7511->status == connector_status_connected)
+			status = connector_status_disconnected;
 	} else {
 		/* Renable HDP sensing */
 		regmap_update_bits(adv7511->regmap, ADV7511_REG_POWER2,
-- 
1.7.5.4

