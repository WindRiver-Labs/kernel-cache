From f55179c77e0ae71783a9db10adda3ee164ed6a61 Mon Sep 17 00:00:00 2001
From: Zumeng Chen <zumeng.chen@windriver.com>
Date: Mon, 19 Oct 2015 17:00:14 +0800
Subject: [PATCH 288/290] drm: xylon: compiling error

This patch is to fix the compiling errors due to the different base
of xylon DRM between the current kernel and SDK git repo, orthewise
the following errors will be popped out:

drivers/gpu/drm/xylon/xylon_fb.c: In function 'xylon_drm_fb_destroy':
drivers/gpu/drm/xylon/xylon_fb.c:41:3: error: implicit declaration of function 'drm_gem_object_unreference_unlocked' [-Werror=implicit-function-declaration]
   drm_gem_object_unreference_unlocked(obj);
   ^
drivers/gpu/drm/xylon/xylon_fb.c: In function 'xylon_drm_fb_create_handle':
drivers/gpu/drm/xylon/xylon_fb.c:52:2: error: implicit declaration of function 'drm_gem_handle_create' [-Werror=implicit-function-declaration]
  return drm_gem_handle_create(file_priv, xfb->obj, handle);
  ^
drivers/gpu/drm/xylon/xylon_fb.c: In function 'xylon_drm_fb_create':
drivers/gpu/drm/xylon/xylon_fb.c:116:2: error: implicit declaration of function 'drm_gem_object_lookup' [-Werror=implicit-function-declaration]
  obj = drm_gem_object_lookup(dev, file_priv, mode_cmd->handles[0]);
  ^
drivers/gpu/drm/xylon/xylon_fb.c:116:6: warning: assignment makes pointer from integer without a cast
  obj = drm_gem_object_lookup(dev, file_priv, mode_cmd->handles[0]);
      ^
drivers/gpu/drm/xylon/xylon_drv.c: In function 'xylon_drm_platform_remove':
drivers/gpu/drm/xylon/xylon_drv.c:315:2: error: implicit declaration of function 'drm_platform_exit' [-Werror=implicit-function-declaration]
  drm_platform_exit(&xylon_drm_driver, pdev);
  ^

Signed-off-by: Zumeng Chen <zumeng.chen@windriver.com>
---
 drivers/gpu/drm/xylon/xylon_drv.c | 4 +++-
 drivers/gpu/drm/xylon/xylon_fb.c  | 1 +
 2 files changed, 4 insertions(+), 1 deletion(-)

diff --git a/drivers/gpu/drm/xylon/xylon_drv.c b/drivers/gpu/drm/xylon/xylon_drv.c
index 1c0bd6f..0e6de30 100644
--- a/drivers/gpu/drm/xylon/xylon_drv.c
+++ b/drivers/gpu/drm/xylon/xylon_drv.c
@@ -312,7 +312,9 @@ static int xylon_drm_platform_probe(struct platform_device *pdev)
 
 static int xylon_drm_platform_remove(struct platform_device *pdev)
 {
-	drm_platform_exit(&xylon_drm_driver, pdev);
+	struct xylon_drm_device *xdev = platform_get_drvdata(pdev);
+
+	drm_put_dev(xdev->dev);
 
 	return 0;
 }
diff --git a/drivers/gpu/drm/xylon/xylon_fb.c b/drivers/gpu/drm/xylon/xylon_fb.c
index 8aebab3..362c830 100644
--- a/drivers/gpu/drm/xylon/xylon_fb.c
+++ b/drivers/gpu/drm/xylon/xylon_fb.c
@@ -16,6 +16,7 @@
 
 #include <drm/drmP.h>
 #include <drm/drm_crtc_helper.h>
+#include <drm/drm_gem.h>
 
 #include "xylon_crtc.h"
 #include "xylon_drv.h"
-- 
2.0.2

