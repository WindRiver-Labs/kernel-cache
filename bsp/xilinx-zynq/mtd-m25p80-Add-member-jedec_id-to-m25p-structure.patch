From 9224f0d23a69ecf59c53fdb413ad6384e009c6e1 Mon Sep 17 00:00:00 2001
From: Suneel Garapati <suneel.garapati@xilinx.com>
Date: Fri, 31 May 2013 01:30:39 +0530
Subject: [PATCH 07/20] mtd: m25p80: Add member jedec_id to m25p structure

git://github.com/Xilinx/linux-xlnx.git xilinx-v14.7
commit 6bf46abf15426f64f4e3a3aa414a8aa4bfb793fc

Added jedec_id variable to hold id of flash memory.
Updated in probe call with the detected flash ID.

This needs discussion on mainline and will be re-visited
later.

Signed-off-by: Suneel Garapati <suneel.garapati@xilinx.com>
Signed-off-by: Michal Simek <michal.simek@xilinx.com>
Signed-off-by: Liming Wang <liming.wang@windriver.com>
---
 drivers/mtd/devices/m25p80.c |    2 ++
 1 files changed, 2 insertions(+), 0 deletions(-)

diff --git a/drivers/mtd/devices/m25p80.c b/drivers/mtd/devices/m25p80.c
index 56b796b..810c054 100644
--- a/drivers/mtd/devices/m25p80.c
+++ b/drivers/mtd/devices/m25p80.c
@@ -88,6 +88,7 @@ struct m25p {
 	u8			erase_opcode;
 	u8			*command;
 	bool			fast_read;
+	u32			jedec_id;
 };
 
 static inline struct m25p *mtd_to_m25p(struct mtd_info *mtd)
@@ -1102,6 +1103,7 @@ static int m25p_probe(struct spi_device *spi)
 	if (info->flags & M25P_NO_ERASE)
 		flash->mtd.flags |= MTD_NO_ERASE;
 
+	flash->jedec_id = info->jedec_id;
 	ppdata.of_node = spi->dev.of_node;
 	flash->mtd.dev.parent = &spi->dev;
 	flash->page_size = info->page_size;
-- 
1.7.5.4

