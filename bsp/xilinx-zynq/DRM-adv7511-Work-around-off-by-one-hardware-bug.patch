From 217861d1fdf9843dc1259e8b362713df95fe3e9a Mon Sep 17 00:00:00 2001
From: Lars-Peter Clausen <lars@metafoo.de>
Date: Tue, 30 Apr 2013 16:39:13 +0200
Subject: [PATCH 234/509] DRM: adv7511: Work around off-by-one hardware bug

https://github.com/analogdevicesinc/linux.git xcomm_zynq
commit ea8335a5af6b0694fe123bbe6bb8bd8b3974ceb9

The vsync generator of the embedded sync generator seems to have a off-by-one bug for the vsync offset, work around this by adding 1 in software.

Signed-off-by: Lars-Peter Clausen <lars@metafoo.de>
Signed-off-by: Zhong Hongbo <hongbo.zhong@windriver.com>
---
 drivers/gpu/drm/i2c/adv7511_core.c |    3 +++
 1 files changed, 3 insertions(+), 0 deletions(-)

diff --git a/drivers/gpu/drm/i2c/adv7511_core.c b/drivers/gpu/drm/i2c/adv7511_core.c
index 16c3d0c..cf91ac1 100644
--- a/drivers/gpu/drm/i2c/adv7511_core.c
+++ b/drivers/gpu/drm/i2c/adv7511_core.c
@@ -616,6 +616,9 @@ static void adv7511_encoder_mode_set(struct drm_encoder *encoder,
 		hsync_len = adj_mode->crtc_hsync_end - adj_mode->crtc_hsync_start;
 		vsync_len = adj_mode->crtc_vsync_end - adj_mode->crtc_vsync_start;
 
+		/* The hardware vsync generator has a off-by-one bug */
+		vsync_offset += 1;
+
 		regmap_write(adv7511->regmap, ADV7511_REG_HSYNC_PLACEMENT_MSB,
 			((hsync_offset >> 10) & 0x7) << 5);
 		regmap_write(adv7511->regmap, ADV7511_REG_SYNC_DECODER(0),
-- 
1.7.5.4

