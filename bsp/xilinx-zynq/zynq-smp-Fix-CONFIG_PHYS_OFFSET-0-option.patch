From 9861d436994cc571d65148f42e9cf7d2173d8dd9 Mon Sep 17 00:00:00 2001
From: Zhong Hongbo <hongbo.zhong@windriver.com>
Date: Mon, 8 Apr 2013 15:06:50 +0800
Subject: [PATCH 06/13] zynq: smp: Fix CONFIG_PHYS_OFFSET=0 option

git://git.xilinx.com/linux-xlnx.git master
commit 4aa1baa4b6ff39fc55cc24d2c6d3306da3362502

The problem was when CONFIG_PHYS_OFFSET=0 because
CONFIG option was defined but this code shouldn't be called.
Fix this wrong config option.

Signed-off-by: Michal Simek <michal.simek@xilinx.com>
Signed-off-by: Zhong Hongbo <hongbo.zhong@windriver.com>
---
 arch/arm/mach-zynq/platsmp.c |    2 +-
 1 files changed, 1 insertions(+), 1 deletions(-)

diff --git a/arch/arm/mach-zynq/platsmp.c b/arch/arm/mach-zynq/platsmp.c
index b266dae..bb79d0b 100644
--- a/arch/arm/mach-zynq/platsmp.c
+++ b/arch/arm/mach-zynq/platsmp.c
@@ -163,7 +163,7 @@ void __init platform_smp_prepare_cpus(unsigned int max_cpus)
 	 * Remap the first three addresses at zero which are used
 	 * for 32bit long jump for SMP. Look at zynq_cpu1_start()
 	 */
-#ifdef CONFIG_PHYS_OFFSET
+#if defined(CONFIG_PHYS_OFFSET) && (CONFIG_PHYS_OFFSET != 0)
 	zero = ioremap(0, 12);
 	if (!zero) {
 		printk(KERN_WARNING
-- 
1.7.5.4

