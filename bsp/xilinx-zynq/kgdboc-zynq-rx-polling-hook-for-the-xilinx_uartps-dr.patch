From 124752d64da292454a7eb052afe8388e596d1a03 Mon Sep 17 00:00:00 2001
From: Zhong Hongbo <hongbo.zhong@windriver.com>
Date: Fri, 12 Sep 2014 09:29:20 +0800
Subject: [PATCH 078/182] kgdboc, zynq: rx polling hook for the xilinx_uartps
 driver

The RX polling hook allows the debugger to hook character input so
as to allow entry to the kernel debugger with a control-c as an
example.

Signed-off-by: Zhong Hongbo <hongbo.zhong@windriver.com>
(cherry picked from commit 868ffddbe2c6914750942f29c3e1ea924a4853ef)
Signed-off-by: Zumeng Chen <zumeng.chen@windriver.com>
---
 drivers/tty/serial/xilinx_uartps.c |    4 ++++
 1 files changed, 4 insertions(+), 0 deletions(-)

diff --git a/drivers/tty/serial/xilinx_uartps.c b/drivers/tty/serial/xilinx_uartps.c
index 807cfb2..bed84a6 100644
--- a/drivers/tty/serial/xilinx_uartps.c
+++ b/drivers/tty/serial/xilinx_uartps.c
@@ -240,6 +240,10 @@ static irqreturn_t xuartps_isr(int irq, void *dev_id)
 					continue;
 			}
 
+#ifdef CONFIG_CONSOLE_POLL
+			if (port->poll_rx_cb && port->poll_rx_cb((unsigned char)data))
+				return;
+#endif
 #ifdef SUPPORT_SYSRQ
 			/*
 			 * uart_handle_sysrq_char() doesn't work if
-- 
1.7.5.4

