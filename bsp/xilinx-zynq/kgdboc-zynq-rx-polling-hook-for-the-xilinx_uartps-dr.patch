From 94bc4ee1594b5bebc4aaed88d63d7db19f8ca5c8 Mon Sep 17 00:00:00 2001
From: Zhong Hongbo <hongbo.zhong@windriver.com>
Date: Fri, 12 Sep 2014 09:29:20 +0800
Subject: [PATCH] kgdboc, zynq: rx polling hook for the xilinx_uartps driver

The RX polling hook allows the debugger to hook character input so
as to allow entry to the kernel debugger with a control-c as an
example.

Signed-off-by: Zhong Hongbo <hongbo.zhong@windriver.com>
---
 drivers/tty/serial/xilinx_uartps.c |    4 ++++
 1 files changed, 4 insertions(+), 0 deletions(-)

diff --git a/drivers/tty/serial/xilinx_uartps.c b/drivers/tty/serial/xilinx_uartps.c
index dff0f48..22ccc17 100644
--- a/drivers/tty/serial/xilinx_uartps.c
+++ b/drivers/tty/serial/xilinx_uartps.c
@@ -240,6 +240,10 @@ static irqreturn_t xuartps_isr(int irq, void *dev_id)
 					continue;
 			}
 
+#ifdef CONFIG_CONSOLE_POLL
+			if (port->poll_rx_cb && port->poll_rx_cb((unsigned char)data))
+				return;
+#endif
 #ifdef SUPPORT_SYSRQ
 			/*
 			 * uart_handle_sysrq_char() doesn't work if
-- 
1.7.5.4

