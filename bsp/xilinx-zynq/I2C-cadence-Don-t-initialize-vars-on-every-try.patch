From dfe96ca17021d524f725a60361bc1604be8746e2 Mon Sep 17 00:00:00 2001
From: Soren Brinkmann <soren.brinkmann@xilinx.com>
Date: Fri, 14 Feb 2014 09:59:22 -0800
Subject: [PATCH 192/509] I2C: cadence: Don't initialize vars on every try

https://github.com/analogdevicesinc/linux.git xcomm_zynq
commit 34c0594a9757c9032b4bbf0dbf40010ea0fb905a

When a transaction fails and is retried, some variables don't need to be
re-assigned and can be moved out of the code which is looping.

Signed-off-by: Soren Brinkmann <soren.brinkmann@xilinx.com>
Signed-off-by: Michal Simek <michal.simek@xilinx.com>
Signed-off-by: Zhong Hongbo <hongbo.zhong@windriver.com>
---
 drivers/i2c/busses/i2c-cadence.c |    2 +-
 1 files changed, 1 insertions(+), 1 deletions(-)

diff --git a/drivers/i2c/busses/i2c-cadence.c b/drivers/i2c/busses/i2c-cadence.c
index 2b0de9d..edfdc48 100644
--- a/drivers/i2c/busses/i2c-cadence.c
+++ b/drivers/i2c/busses/i2c-cadence.c
@@ -473,9 +473,9 @@ static int cdns_i2c_master_xfer(struct i2c_adapter *adap, struct i2c_msg *msgs,
 		if (count == (num - 1))
 			id->bus_hold_flag = 0;
 		retries = adap->retries;
+		id->p_msg = msgs;
 retry:
 		id->err_status = 0;
-		id->p_msg = msgs;
 		init_completion(&id->xfer_done);
 
 		/* Check for the TEN Bit mode on each msg */
-- 
1.7.5.4

