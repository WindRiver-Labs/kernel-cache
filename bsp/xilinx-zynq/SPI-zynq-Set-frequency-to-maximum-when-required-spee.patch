From 3576dc3d51e30da42542747e7b24916218158acc Mon Sep 17 00:00:00 2001
From: Harini Katakam <harini.katakam@xilinx.com>
Date: Fri, 7 Mar 2014 18:58:15 +0530
Subject: [PATCH 067/509] SPI: zynq: Set frequency to maximum when required
 speed is passed as 0

https://github.com/analogdevicesinc/linux.git xcomm_zynq
commit 453ad300cb07a544a4b25235a8edfc3bf90a1d6a

When transfer->speed_hz is 0, req_hz is set to maximum speed.

Signed-off-by: Harini Katakam <harinik@xilinx.com>
Signed-off-by: Michal Simek <michal.simek@xilinx.com>
Signed-off-by: Zhong Hongbo <hongbo.zhong@windriver.com>
---
 drivers/spi/spi-zynq.c |    3 +++
 1 files changed, 3 insertions(+), 0 deletions(-)

diff --git a/drivers/spi/spi-zynq.c b/drivers/spi/spi-zynq.c
index 30eab7d..16a7fd7 100644
--- a/drivers/spi/spi-zynq.c
+++ b/drivers/spi/spi-zynq.c
@@ -222,6 +222,9 @@ static int zynq_spi_setup_transfer(struct spi_device *spi,
 		return -EINVAL;
 	}
 
+	if (transfer && !transfer->speed_hz)
+		req_hz = spi->max_speed_hz;
+
 	frequency = clk_get_rate(xspi->devclk);
 
 	spin_lock_irqsave(&xspi->ctrl_reg_lock, flags);
-- 
1.7.5.4

