From e8388de3f52c403e6518d5c8f709d81d987b5460 Mon Sep 17 00:00:00 2001
From: Zhong Hongbo <hongbo.zhong@windriver.com>
Date: Tue, 5 Aug 2014 15:43:13 +0800
Subject: [PATCH 350/509] Merge tag 'v3.13' into xilinx/master-next

https://github.com/analogdevicesinc/linux.git xcomm_zynq
commit e7f96cb448b5a78df3d50c3ef55e9f055b5c418f

Linux 3.13

- INIT_COMPLETION -> reinit_completion
- opp_ -> dev_pm_opp_ renaming
- dmaengine: remove DMA unmap flags
(sha1: 0776ae7b89782124ddd72eafe0b1e0fdcdabe32e)
- DMA_SUCCESS -> DMA_COMPLETE
- use safedefconfigs
- sync xilinx_i2c with mainline
- clocksource/cadence_ttc: Remove clock notifier
- add missing linux/of_irq.h header

Signed-off-by: Michal Simek <michal.simek@xilinx.com>
Signed-off-by: Zhong Hongbo <hongbo.zhong@windriver.com>
---
 drivers/dma/xilinx/axidmatest.c |    8 ++++----
 drivers/dma/xilinx/cdmatest.c   |    6 +++---
 drivers/dma/xilinx/vdmatest.c   |    8 ++++----
 3 files changed, 11 insertions(+), 11 deletions(-)

diff --git a/drivers/dma/xilinx/axidmatest.c b/drivers/dma/xilinx/axidmatest.c
index dfd125791..42a4c29 100644
--- a/drivers/dma/xilinx/axidmatest.c
+++ b/drivers/dma/xilinx/axidmatest.c
@@ -236,7 +236,7 @@ static int dmatest_slave_func(void *data)
 
 	set_user_nice(current, 10);
 
-	flags = DMA_CTRL_ACK | DMA_COMPL_SKIP_DEST_UNMAP | DMA_PREP_INTERRUPT;
+	flags = DMA_CTRL_ACK | DMA_PREP_INTERRUPT;
 
 	while (!kthread_should_stop()
 		&& !(iterations && total_tests >= iterations)) {
@@ -386,7 +386,7 @@ static int dmatest_slave_func(void *data)
 				   thread_name, total_tests - 1);
 			failed_tests++;
 			continue;
-		} else if (status != DMA_SUCCESS) {
+		} else if (status != DMA_COMPLETE) {
 			pr_warn(
 			"%s: #%u: tx got completion callback, ",
 				   thread_name, total_tests - 1);
@@ -406,7 +406,7 @@ static int dmatest_slave_func(void *data)
 				   thread_name, total_tests - 1);
 			failed_tests++;
 			continue;
-		} else if (status != DMA_SUCCESS) {
+		} else if (status != DMA_COMPLETE) {
 			pr_warn(
 			"%s: #%u: rx got completion callback, ",
 				   thread_name, total_tests - 1);
@@ -417,7 +417,7 @@ static int dmatest_slave_func(void *data)
 			continue;
 		}
 
-		/* Unmap by myself (see DMA_COMPL_SKIP_DEST_UNMAP above) */
+		/* Unmap by myself */
 		for (i = 0; i < dst_cnt; i++)
 			dma_unmap_single(rx_dev->dev, dma_dsts[i],
 					test_buf_size, DMA_DEV_TO_MEM);
diff --git a/drivers/dma/xilinx/cdmatest.c b/drivers/dma/xilinx/cdmatest.c
index 4f2bb0f..65b5c38 100644
--- a/drivers/dma/xilinx/cdmatest.c
+++ b/drivers/dma/xilinx/cdmatest.c
@@ -292,7 +292,7 @@ static int cdmatest_func(void *data)
 
 	set_user_nice(current, 10);
 
-	flags = DMA_CTRL_ACK | DMA_COMPL_SKIP_DEST_UNMAP | DMA_PREP_INTERRUPT;
+	flags = DMA_CTRL_ACK | DMA_PREP_INTERRUPT;
 
 	while (!kthread_should_stop()
 		&& !(iterations && total_tests >= iterations)) {
@@ -411,7 +411,7 @@ static int cdmatest_func(void *data)
 					thread_name, total_tests - 1);
 			failed_tests++;
 			continue;
-		} else if (status != DMA_SUCCESS) {
+		} else if (status != DMA_COMPLETE) {
 			pr_warn(
 			"%s: #%u: got completion callback, ",
 					thread_name, total_tests - 1);
@@ -422,7 +422,7 @@ static int cdmatest_func(void *data)
 			continue;
 		}
 
-		/* Unmap by myself (see DMA_COMPL_SKIP_DEST_UNMAP above) */
+		/* Unmap by myself */
 		for (i = 0; i < dst_cnt; i++)
 			dma_unmap_single(dev->dev, dma_dsts[i], test_buf_size,
 					DMA_MEM_TO_MEM);
diff --git a/drivers/dma/xilinx/vdmatest.c b/drivers/dma/xilinx/vdmatest.c
index c616392..d792d97 100644
--- a/drivers/dma/xilinx/vdmatest.c
+++ b/drivers/dma/xilinx/vdmatest.c
@@ -253,7 +253,7 @@ static int xilinx_vdmatest_slave_func(void *data)
 
 	set_user_nice(current, 10);
 
-	flags = DMA_CTRL_ACK | DMA_COMPL_SKIP_DEST_UNMAP | DMA_PREP_INTERRUPT;
+	flags = DMA_CTRL_ACK | DMA_PREP_INTERRUPT;
 
 	while (!kthread_should_stop()
 		&& !(iterations && total_tests >= iterations)) {
@@ -380,7 +380,7 @@ static int xilinx_vdmatest_slave_func(void *data)
 					thread_name, total_tests - 1);
 			failed_tests++;
 			continue;
-		} else if (status != DMA_SUCCESS) {
+		} else if (status != DMA_COMPLETE) {
 			pr_warn(
 			"%s: #%u: tx got completion callback, ",
 				   thread_name, total_tests - 1);
@@ -400,7 +400,7 @@ static int xilinx_vdmatest_slave_func(void *data)
 					thread_name, total_tests - 1);
 			failed_tests++;
 			continue;
-		} else if (status != DMA_SUCCESS) {
+		} else if (status != DMA_COMPLETE) {
 			pr_warn(
 			"%s: #%u: rx got completion callback, ",
 					thread_name, total_tests - 1);
@@ -411,7 +411,7 @@ static int xilinx_vdmatest_slave_func(void *data)
 			continue;
 		}
 
-		/* Unmap by myself (see DMA_COMPL_SKIP_DEST_UNMAP above) */
+		/* Unmap by myself */
 		for (i = 0; i < frm_cnt; i++)
 			dma_unmap_single(rx_dev->dev, dma_dsts[i],
 					 test_buf_size, DMA_DEV_TO_MEM);
-- 
1.7.5.4

