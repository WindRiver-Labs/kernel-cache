From a03a6fceb90699aa8f54378d3373ade81997b079 Mon Sep 17 00:00:00 2001
From: Hyun Kwon <hyun.kwon@xilinx.com>
Date: Tue, 18 Mar 2014 09:18:37 -0700
Subject: [PATCH 215/456] media: xilinx: vip: Change the return value of
 xvip_get_format_by_fourcc()

This patch comes from:
  https://github.com/Xilinx/linux-xlnx.git

When no format is found, return 'ERR_PTR(-EINVAL)' instead of 'NULL'.

Signed-off-by: Hyun Kwon <hyunk@xilinx.com>
Signed-off-by: Michal Simek <michal.simek@xilinx.com>
(cherry picked from commit eba25e1158516371550fe2a8297f9692c501b489)
Signed-off-by: Zumeng Chen <zumeng.chen@windriver.com>
---
 drivers/media/platform/xilinx/xilinx-dma.c |    2 +-
 drivers/media/platform/xilinx/xilinx-vip.c |    5 +++--
 2 files changed, 4 insertions(+), 3 deletions(-)

diff --git a/drivers/media/platform/xilinx/xilinx-dma.c b/drivers/media/platform/xilinx/xilinx-dma.c
index c4bbd35..7df16ab 100644
--- a/drivers/media/platform/xilinx/xilinx-dma.c
+++ b/drivers/media/platform/xilinx/xilinx-dma.c
@@ -325,7 +325,7 @@ __xvip_dma_try_format(struct xvip_dma *dma, struct v4l2_pix_format *pix,
 	 * requested format isn't supported.
 	 */
 	info = xvip_get_format_by_fourcc(pix->pixelformat);
-	if (info == NULL)
+	if (IS_ERR(info))
 		info = xvip_get_format_by_fourcc(XVIP_DMA_DEF_FORMAT);
 
 	pix->pixelformat = info->fourcc;
diff --git a/drivers/media/platform/xilinx/xilinx-vip.c b/drivers/media/platform/xilinx/xilinx-vip.c
index 3bf199b..a6d1dd0 100644
--- a/drivers/media/platform/xilinx/xilinx-vip.c
+++ b/drivers/media/platform/xilinx/xilinx-vip.c
@@ -59,7 +59,8 @@ EXPORT_SYMBOL_GPL(xvip_get_format_by_code);
  * @fourcc: the format 4CC
  *
  * Return: a pointer to the format information structure corresponding to the
- * given V4L2 format @fourcc, or %NULL if no corresponding format can be found.
+ * given V4L2 format @fourcc, or ERR_PTR if no corresponding format can be
+ * found.
  */
 const struct xvip_video_format *xvip_get_format_by_fourcc(u32 fourcc)
 {
@@ -72,7 +73,7 @@ const struct xvip_video_format *xvip_get_format_by_fourcc(u32 fourcc)
 			return format;
 	}
 
-	return NULL;
+	return ERR_PTR(-EINVAL);
 }
 EXPORT_SYMBOL_GPL(xvip_get_format_by_fourcc);
 
-- 
1.7.5.4

