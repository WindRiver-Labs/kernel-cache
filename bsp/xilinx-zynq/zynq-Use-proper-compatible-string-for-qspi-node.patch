From 3c7ed2edc1e68895b5f26df860baeeb71cf77274 Mon Sep 17 00:00:00 2001
From: Michal Simek <michal.simek@xilinx.com>
Date: Fri, 28 Mar 2014 13:26:46 +0100
Subject: [PATCH 113/509] zynq: Use proper compatible string for qspi node

https://github.com/analogdevicesinc/linux.git xcomm_zynq
commit 2b2b94c98a9829c2d130d4264c6ee18b529eb661

After discussion with qspi onwer is the best to use
this 1.0 compatible string because origin cadence r1p6
was dramatically changed.

Signed-off-by: Michal Simek <michal.simek@xilinx.com>
Signed-off-by: Zhong Hongbo <hongbo.zhong@windriver.com>
---
 arch/arm/boot/dts/zynq-zc702.dts |    2 +-
 arch/arm/boot/dts/zynq-zc706.dts |    2 +-
 arch/arm/boot/dts/zynq-zed.dts   |    2 +-
 drivers/mtd/devices/m25p80.c     |    4 ++--
 drivers/spi/spi-zynq-qspi.c      |    2 +-
 5 files changed, 6 insertions(+), 6 deletions(-)

diff --git a/arch/arm/boot/dts/zynq-zc702.dts b/arch/arm/boot/dts/zynq-zc702.dts
index 53e928a..ee32eda 100644
--- a/arch/arm/boot/dts/zynq-zc702.dts
+++ b/arch/arm/boot/dts/zynq-zc702.dts
@@ -267,7 +267,7 @@
 		ps7_qspi_0: ps7-qspi@e000d000 {
 			clock-names = "ref_clk", "aper_clk";
 			clocks = <&clkc 10>, <&clkc 43>;
-			compatible = "xlnx,ps7-qspi-1.00.a", "xlnx,ps7-qspi-1.00.a";
+			compatible = "xlnx,zynq-qspi-1.0";
 			interrupt-parent = <&ps7_scugic_0>;
 			interrupts = <0 19 4>;
 			is-dual = <0>;
diff --git a/arch/arm/boot/dts/zynq-zc706.dts b/arch/arm/boot/dts/zynq-zc706.dts
index 041e530..b955065 100644
--- a/arch/arm/boot/dts/zynq-zc706.dts
+++ b/arch/arm/boot/dts/zynq-zc706.dts
@@ -252,7 +252,7 @@
 		ps7_qspi_0: ps7-qspi@e000d000 {
 			clock-names = "ref_clk", "aper_clk";
 			clocks = <&clkc 10>, <&clkc 43>;
-			compatible = "xlnx,ps7-qspi-1.00.a", "xlnx,ps7-qspi-1.00.a";
+			compatible = "xlnx,zynq-qspi-1.0";
 			interrupt-parent = <&ps7_scugic_0>;
 			interrupts = <0 19 4>;
 			is-dual = <1>;
diff --git a/arch/arm/boot/dts/zynq-zed.dts b/arch/arm/boot/dts/zynq-zed.dts
index e3047c8..4d015e4 100644
--- a/arch/arm/boot/dts/zynq-zed.dts
+++ b/arch/arm/boot/dts/zynq-zed.dts
@@ -176,7 +176,7 @@
 		ps7_qspi_0: ps7-qspi@e000d000 {
 			clock-names = "ref_clk", "aper_clk";
 			clocks = <&clkc 10>, <&clkc 43>;
-			compatible = "xlnx,ps7-qspi-1.00.a", "xlnx,ps7-qspi-1.00.a";
+			compatible = "xlnx,zynq-qspi-1.0";
 			interrupt-parent = <&ps7_scugic_0>;
 			interrupts = <0 19 4>;
 			is-dual = <0>;
diff --git a/drivers/mtd/devices/m25p80.c b/drivers/mtd/devices/m25p80.c
index b466085..cf198a4 100644
--- a/drivers/mtd/devices/m25p80.c
+++ b/drivers/mtd/devices/m25p80.c
@@ -1259,7 +1259,7 @@ static int m25p_probe(struct spi_device *spi)
 		u32 is_dual;
 		np = of_get_next_parent(spi->dev.of_node);
 		of_property_read_string(np, "compatible", &comp_str);
-		if (!strcmp(comp_str, "xlnx,zynq-qspi-1.00.a")) {
+		if (!strcmp(comp_str, "xlnx,zynq-qspi-1.0")) {
 			if (of_property_read_u32(np, "is-dual", &is_dual) < 0) {
 				/* Default to single if prop not defined */
 				flash->shift = 0;
@@ -1370,7 +1370,7 @@ static int m25p_probe(struct spi_device *spi)
 			const char *comp_str;
 			np = of_get_next_parent(spi->dev.of_node);
 			of_property_read_string(np, "compatible", &comp_str);
-			if (!strcmp(comp_str, "xlnx,zynq-qspi-1.00.a")) {
+			if (!strcmp(comp_str, "xlnx,zynq-qspi-1.0")) {
 				flash->addr_width = 3;
 				set_4byte(flash, info->jedec_id, 0);
 			} else {
diff --git a/drivers/spi/spi-zynq-qspi.c b/drivers/spi/spi-zynq-qspi.c
index 4796596..239d04b 100644
--- a/drivers/spi/spi-zynq-qspi.c
+++ b/drivers/spi/spi-zynq-qspi.c
@@ -1204,7 +1204,7 @@ static int zynq_qspi_remove(struct platform_device *pdev)
 MODULE_ALIAS("platform:" DRIVER_NAME);
 
 static struct of_device_id zynq_qspi_of_match[] = {
-	{ .compatible = "xlnx,zynq-qspi-1.00.a", },
+	{ .compatible = "xlnx,zynq-qspi-1.0", },
 	{ /* end of table */}
 };
 MODULE_DEVICE_TABLE(of, zynq_qspi_of_match);
-- 
1.7.5.4

