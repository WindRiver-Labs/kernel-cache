From a208dd6142f5277052557e541d066efde7ace263 Mon Sep 17 00:00:00 2001
From: Thomas Betker <thomas.betker@rohde-schwarz.com>
Date: Mon, 10 Mar 2014 18:46:19 +0530
Subject: [PATCH 082/509] spi: zynq-qspi: Fix BAUD_RATE_DIV calculation

https://github.com/analogdevicesinc/linux.git xcomm_zynq
commit 0d37ee38f5df2da0c58c62ee49b85001c24b0721

In xqspips_setup_transfer(), loop while baud_rate_val < 7, not < 8;
otherwise, we may end up with BAUD_RATE_DIV = 8, which is invalid.

Signed-off-by: Thomas Betker <thomas.betker@rohde-schwarz.com>
Reviewed-by: Harini Katakam <harinik@xilinx.com>
Signed-off-by: Michal Simek <michal.simek@xilinx.com>
Signed-off-by: Zhong Hongbo <hongbo.zhong@windriver.com>
---
 drivers/spi/spi-zynq-qspi.c |    2 +-
 1 files changed, 1 insertions(+), 1 deletions(-)

diff --git a/drivers/spi/spi-zynq-qspi.c b/drivers/spi/spi-zynq-qspi.c
index ebad8c0..d4b0571 100644
--- a/drivers/spi/spi-zynq-qspi.c
+++ b/drivers/spi/spi-zynq-qspi.c
@@ -467,7 +467,7 @@ static int zynq_qspi_setup_transfer(struct spi_device *qspi,
 
 	/* Set the clock frequency */
 	if (xqspi->speed_hz != req_hz) {
-		while ((baud_rate_val < 8)  &&
+		while ((baud_rate_val < 7)  &&
 			(clk_get_rate(xqspi->devclk) / (2 << baud_rate_val)) >
 			req_hz)
 				baud_rate_val++;
-- 
1.7.5.4

