From 249383181ef239076fcd851a205c23957a44aa51 Mon Sep 17 00:00:00 2001
From: Michal Simek <michal.simek@xilinx.com>
Date: Mon, 3 Feb 2014 17:36:23 +0100
Subject: [PATCH 080/182] ARM: zynq: Add waituart implementation

This patch comes from:
  https://github.com/Xilinx/linux-xlnx.git

Add missing waituart implementation.

Signed-off-by: Michal Simek <michal.simek@xilinx.com>
(cherry picked from commit 3807de09db81cae72fc00a9cea8e6859262ee694)
Signed-off-by: Zumeng Chen <zumeng.chen@windriver.com>
---
 arch/arm/include/debug/zynq.S |    3 +++
 1 files changed, 3 insertions(+), 0 deletions(-)

diff --git a/arch/arm/include/debug/zynq.S b/arch/arm/include/debug/zynq.S
index f9aa974..0b762fa 100644
--- a/arch/arm/include/debug/zynq.S
+++ b/arch/arm/include/debug/zynq.S
@@ -42,6 +42,9 @@
 		.endm
 
 		.macro	waituart,rd,rx
+1001:		ldr	\rd, [\rx, #UART_SR_OFFSET]
+		tst	\rd, #UART_SR_TXEMPTY
+		beq	1001b
 		.endm
 
 		.macro	busyuart,rd,rx
-- 
1.7.5.4

