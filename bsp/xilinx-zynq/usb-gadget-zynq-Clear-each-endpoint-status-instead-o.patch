From 7b51e79f9cada9a94473373e0cad600528271f00 Mon Sep 17 00:00:00 2001
From: Punnaiah Choudary Kalluri <punnaiah.choudary.kalluri@xilinx.com>
Date: Sat, 8 Mar 2014 06:22:29 +0530
Subject: [PATCH 388/509] usb: gadget: zynq: Clear each endpoint status
 instead of all the endpoints

https://github.com/analogdevicesinc/linux.git xcomm_zynq
commit d32a4bab635a024dbfb6c1a6ce3d074d11f0f705

Clear each endpoint status instead of the status read at the beginning of the
handler which indicates complete status of all endpoints.

Signed-off-by: Punnaiah Choudary Kalluri <punnaia@xilinx.com>
Signed-off-by: Michal Simek <michal.simek@xilinx.com>
Signed-off-by: Zhong Hongbo <hongbo.zhong@windriver.com>
---
 drivers/usb/gadget/zynq_udc.c |    2 +-
 1 files changed, 1 insertions(+), 1 deletions(-)

diff --git a/drivers/usb/gadget/zynq_udc.c b/drivers/usb/gadget/zynq_udc.c
index 35a2542..62525e9 100644
--- a/drivers/usb/gadget/zynq_udc.c
+++ b/drivers/usb/gadget/zynq_udc.c
@@ -2141,7 +2141,7 @@ static void dtd_complete_irq(struct zynq_udc *udc)
 			if (status == REQ_UNCOMPLETE)
 				break;
 			/* Clear the endpoint complete events */
-			zynq_writel(bit_pos, &dr_regs->endptcomplete);
+			zynq_writel(bit_mask, &dr_regs->endptcomplete);
 			/* write back status to req */
 			curr_req->req.status = status;
 
-- 
1.7.5.4

