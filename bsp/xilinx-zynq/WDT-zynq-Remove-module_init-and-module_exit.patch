From fbdbc567639cd3eae01450290d3e208bacd6227e Mon Sep 17 00:00:00 2001
From: Harini Katakam <harini.katakam@xilinx.com>
Date: Fri, 28 Mar 2014 15:56:12 +0530
Subject: [PATCH 450/509] WDT: zynq: Remove module_init and module_exit

https://github.com/analogdevicesinc/linux.git xcomm_zynq
commit 73d495cb816496c32d434b933160106f437f172a

Use module_platform_driver. Remove MODULE alias.

Signed-off-by: Harini Katakam <harinik@xilinx.com>
Signed-off-by: Michal Simek <michal.simek@xilinx.com>
Signed-off-by: Zhong Hongbo <hongbo.zhong@windriver.com>
---
 drivers/watchdog/zynq_wdt.c |   31 +------------------------------
 1 files changed, 1 insertions(+), 30 deletions(-)

diff --git a/drivers/watchdog/zynq_wdt.c b/drivers/watchdog/zynq_wdt.c
index 836a602..7804af5 100644
--- a/drivers/watchdog/zynq_wdt.c
+++ b/drivers/watchdog/zynq_wdt.c
@@ -518,37 +518,8 @@ static struct platform_driver zynq_wdt_driver = {
 	},
 };
 
-/**
- * zynq_wdt_init -  Register the WDT.
- *
- * Return: 0 on success, otherwise negative error.
- *
- * If using noway out, the use count will be incremented.
- * This will prevent unloading the module. An attempt to
- * unload the module will result in a warning from the kernel.
- */
-static int __init zynq_wdt_init(void)
-{
-	int res = platform_driver_register(&zynq_wdt_driver);
-
-	if (!res && nowayout)
-		try_module_get(THIS_MODULE);
-
-	return res;
-}
-
-/**
- * zynq_wdt_exit -  Unregister the WDT.
- */
-static void __exit zynq_wdt_exit(void)
-{
-	platform_driver_unregister(&zynq_wdt_driver);
-}
-
-module_init(zynq_wdt_init);
-module_exit(zynq_wdt_exit);
+module_platform_driver(zynq_wdt_driver);
 
 MODULE_AUTHOR("Xilinx, Inc.");
 MODULE_DESCRIPTION("Watchdog driver for PS WDT");
 MODULE_LICENSE("GPL");
-MODULE_ALIAS("platform: zynq_wdt");
-- 
1.7.5.4

