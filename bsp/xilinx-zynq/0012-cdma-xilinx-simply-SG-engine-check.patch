From dd3bcd05d59c8c844a9f35f2efcc30218a761139 Mon Sep 17 00:00:00 2001
From: Kedareswara rao Appana <appana.durga.rao@xilinx.com>
Date: Mon, 8 Jun 2015 16:12:37 +0530
Subject: [PATCH 12/53] cdma: xilinx: simply SG engine check

This patch comes from:
  https://github.com/Xilinx/linux-xlnx.git

This patch simplifies the logic for
SG Engine check.

Signed-off-by: Kedareswara rao Appana <appanad@xilinx.com>
Signed-off-by: Michal Simek <michal.simek@xilinx.com>
(cherry picked from commit 80de91cc4e206bf4572984be4db2db21d2ab7052)
Signed-off-by: Zumeng Chen <zumeng.chen@windriver.com>
---
 drivers/dma/xilinx/xilinx_axicdma.c |    9 +++------
 1 file changed, 3 insertions(+), 6 deletions(-)

diff --git a/drivers/dma/xilinx/xilinx_axicdma.c b/drivers/dma/xilinx/xilinx_axicdma.c
index f8cffd6..49e2203 100644
--- a/drivers/dma/xilinx/xilinx_axicdma.c
+++ b/drivers/dma/xilinx/xilinx_axicdma.c
@@ -129,6 +129,7 @@ struct xilinx_cdma_device {
 	struct dma_device common;
 	struct xilinx_cdma_chan *chan;
 	u32 feature;
+	bool has_sg;				/* Support scatter transfers */
 };
 
 #define to_xilinx_chan(chan) \
@@ -861,8 +862,7 @@ static int xilinx_cdma_chan_probe(struct xilinx_cdma_device *xdev,
 	chan->direction = DMA_MEM_TO_MEM;
 	chan->start_transfer = xilinx_cdma_start_transfer;
 
-	chan->has_sg = (xdev->feature & XILINX_CDMA_FTR_HAS_SG) >>
-		       XILINX_CDMA_FTR_HAS_SG_SHIFT;
+	chan->has_sg = xdev->has_sg;
 
 	chan->is_lite = of_property_read_bool(node, "xlnx,lite-mode");
 	if (chan->is_lite) {
@@ -941,7 +941,6 @@ static int xilinx_cdma_probe(struct platform_device *pdev)
 	struct device_node *child, *node;
 	struct resource *res;
 	int ret;
-	u32 value;
 
 	xdev = devm_kzalloc(&pdev->dev, sizeof(*xdev), GFP_KERNEL);
 	if (!xdev)
@@ -959,9 +958,7 @@ static int xilinx_cdma_probe(struct platform_device *pdev)
 		return PTR_ERR(xdev->regs);
 
 	/* Check if SG is enabled */
-	value = of_property_read_bool(node, "xlnx,include-sg");
-	if (value)
-		xdev->feature |= XILINX_CDMA_FTR_HAS_SG;
+	xdev->has_sg = of_property_read_bool(node, "xlnx,include-sg");
 
 	/* Axi CDMA only does memcpy */
 	dma_cap_set(DMA_MEMCPY, xdev->common.cap_mask);
-- 
1.7.10.4

