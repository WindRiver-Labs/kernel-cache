From f5032296be53ba0b444cd7ac49b53f779e4e9fb7 Mon Sep 17 00:00:00 2001
From: Nicolae Rosia <nicolae.rosia@certsign.ro>
Date: Mon, 5 Jan 2015 18:09:45 +0200
Subject: [PATCH 018/456] ARM: zynq: xilinx_axidma: refactor code in
 xilinx_dma_start_transfer

Improve clarity by refactoring the code into an if/else clause.
Also remove redundant comment.

Signed-off-by: Nicolae Rosia <nicolae.rosia@certsign.ro>
Acked-by: Kedareswara rao Appana <appanad@xilinx.com>
Signed-off-by: Michal Simek <michal.simek@xilinx.com>
(cherry picked from commit 28049a5e8d25a6cbb35359b83a4fa6a79406b235)
---
 drivers/dma/xilinx/xilinx_axidma.c |   30 ++++++++++++++----------------
 1 files changed, 14 insertions(+), 16 deletions(-)

diff --git a/drivers/dma/xilinx/xilinx_axidma.c b/drivers/dma/xilinx/xilinx_axidma.c
index de32c25..e90c7b7 100644
--- a/drivers/dma/xilinx/xilinx_axidma.c
+++ b/drivers/dma/xilinx/xilinx_axidma.c
@@ -391,28 +391,26 @@ static void xilinx_dma_start_transfer(struct xilinx_dma_chan *chan)
 
 		/* Update tail ptr register and start the transfer */
 		dma_write(chan, XILINX_DMA_TDESC_OFFSET, desct->async_tx.phys);
-		goto out_unlock;
-	}
-
-	/* In simple mode */
-	desch = list_first_entry(&chan->pending_list,
-				 struct xilinx_dma_desc_sw, node);
+	} else {
+		desch = list_first_entry(&chan->pending_list,
+					 struct xilinx_dma_desc_sw, node);
 
-	list_del(&desch->node);
-	list_add_tail(&desch->node, &chan->active_list);
+		list_del(&desch->node);
+		list_add_tail(&desch->node, &chan->active_list);
 
-	dma_start(chan);
+		dma_start(chan);
 
-	if (chan->err)
-		goto out_unlock;
+		if (chan->err)
+			goto out_unlock;
 
-	hw = &desch->hw;
+		hw = &desch->hw;
 
-	dma_write(chan, XILINX_DMA_SRCADDR_OFFSET, hw->buf_addr);
+		dma_write(chan, XILINX_DMA_SRCADDR_OFFSET, hw->buf_addr);
 
-	/* Start the transfer */
-	dma_write(chan, XILINX_DMA_BTT_OFFSET,
-		  hw->control & XILINX_DMA_MAX_TRANS_LEN);
+		/* Start the transfer */
+		dma_write(chan, XILINX_DMA_BTT_OFFSET,
+			  hw->control & XILINX_DMA_MAX_TRANS_LEN);
+	}
 
 out_unlock:
 	spin_unlock_irqrestore(&chan->lock, flags);
-- 
1.7.5.4

