From 61c2c5cda6728466181eb350b65fa2c0b01018e8 Mon Sep 17 00:00:00 2001
From: Liming Wang <liming.wang@windriver.com>
Date: Thu, 27 Feb 2014 17:36:48 +0800
Subject: [PATCH 7/7] net: xilinx_emacps: Enable reception of ethernet frames greater than 1536 bytes

All Ethernet frames greater than 1518 bytes get discarded which consequently
caused the low throughput. This is the case when the maximum
MTU of 1500 is used and the payload gets encapsulated in an VLAN frame.

Signed-off-by: Thomas Fekl <thomas.fekl@alcatel-lucent.com>
Signed-off-by: Liming Wang <liming.wang@windriver.com>
---
 drivers/net/ethernet/xilinx/xilinx_emacps.c |    2 ++
 1 files changed, 2 insertions(+), 0 deletions(-)

diff --git a/drivers/net/ethernet/xilinx/xilinx_emacps.c b/drivers/net/ethernet/xilinx/xilinx_emacps.c
index 56c18d0..9548f11 100644
--- a/drivers/net/ethernet/xilinx/xilinx_emacps.c
+++ b/drivers/net/ethernet/xilinx/xilinx_emacps.c
@@ -277,6 +277,7 @@ MDC_DIV_64, MDC_DIV_96, MDC_DIV_128, MDC_DIV_224 };
 #define XEMACPS_NWCFG_RETRYTESTEN_MASK	0x00001000 /* Retry test */
 #define XEMACPS_NWCFG_1000_MASK		0x00000400 /* Gigbit mode */
 #define XEMACPS_NWCFG_EXTADDRMATCHEN_MASK	0x00000200
+#define XEMACPS_NWCFG_1536B_FR_EN_MASK	0x00000100 /* enable reception of frames > 1518bytes  */
 /* External address match enable */
 #define XEMACPS_NWCFG_UCASTHASHEN_MASK	0x00000080 /* Receive unicast hash
 						frames */
@@ -1607,6 +1608,7 @@ static void xemacps_init_hw(struct net_local *lp)
 	regval |= XEMACPS_NWCFG_PAUSEEN_MASK;
 	regval |= XEMACPS_NWCFG_100_MASK;
 	regval |= XEMACPS_NWCFG_HDRXEN_MASK;
+	regval |= XEMACPS_NWCFG_1536B_FR_EN_MASK;
 
 	regval |= (MDC_DIV_224 << XEMACPS_NWCFG_MDC_SHIFT_MASK);
 	if (lp->ndev->flags & IFF_PROMISC)	/* copy all */
-- 
1.7.0

