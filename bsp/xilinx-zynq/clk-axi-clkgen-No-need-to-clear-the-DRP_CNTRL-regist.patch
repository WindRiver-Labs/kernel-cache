From 7b54315aea8bae232382ea5654170a0be0d2d535 Mon Sep 17 00:00:00 2001
From: Lars-Peter Clausen <lars@metafoo.de>
Date: Thu, 5 Sep 2013 13:23:57 +0200
Subject: [PATCH 255/509] clk: axi-clkgen: No need to clear the DRP_CNTRL
 register

https://github.com/analogdevicesinc/linux.git xcomm_zynq
commit 97cf3eaa614df2078e6885245050be8d1477b548

The lastest version of the axi-clkgen core doesn't require the DRP_CNTRL
register to be cleared anymore before writing to it.

Signed-off-by: Lars-Peter Clausen <lars@metafoo.de>
Signed-off-by: Zhong Hongbo <hongbo.zhong@windriver.com>
---
 drivers/clk/clk-axi-clkgen.c |    3 +--
 1 files changed, 1 insertions(+), 2 deletions(-)

diff --git a/drivers/clk/clk-axi-clkgen.c b/drivers/clk/clk-axi-clkgen.c
index 1ca36f3..642f63d 100644
--- a/drivers/clk/clk-axi-clkgen.c
+++ b/drivers/clk/clk-axi-clkgen.c
@@ -288,8 +288,8 @@ static int axi_clkgen_v2_mmcm_read(struct axi_clkgen *axi_clkgen,
 	reg_val = AXI_CLKGEN_V2_DRP_CNTRL_SEL | AXI_CLKGEN_V2_DRP_CNTRL_READ;
 	reg_val |= (reg << 16);
 
-	axi_clkgen_write(axi_clkgen, AXI_CLKGEN_V2_REG_DRP_CNTRL, 0x00);
 	axi_clkgen_write(axi_clkgen, AXI_CLKGEN_V2_REG_DRP_CNTRL, reg_val);
+
 	do {
 	    axi_clkgen_read(axi_clkgen, AXI_CLKGEN_V2_REG_DRP_STATUS, val);
 	} while ((*val & AXI_CLKGEN_V2_DRP_STATUS_BUSY) && --timeout);
@@ -324,7 +324,6 @@ static int axi_clkgen_v2_mmcm_write(struct axi_clkgen *axi_clkgen,
 
 	reg_val |= AXI_CLKGEN_V2_DRP_CNTRL_SEL | (reg << 16) | (val & mask);
 
-	axi_clkgen_write(axi_clkgen, AXI_CLKGEN_V2_REG_DRP_CNTRL, 0x00);
 	axi_clkgen_write(axi_clkgen, AXI_CLKGEN_V2_REG_DRP_CNTRL, reg_val);
 
 	return 0;
-- 
1.7.5.4

