From 9b5a84f05ec5e74b9f94f3e335a23e2a0b7b57d2 Mon Sep 17 00:00:00 2001
From: Davor Joja <davorjoja@logicbricks.com>
Date: Tue, 18 Nov 2014 20:03:55 +0100
Subject: [PATCH 174/456] gpu: drm: xylon: Registered plane update

This patch comes from:
  https://github.com/Xilinx/linux-xlnx.git

Set crtc base by calling registered plane driver function.
This removes direct plane driver function calls and removes functionality
redundancy.

Signed-off-by: Davor Joja <davorjoja@logicbricks.com>
Reviewed-by: Hyun Kwon <hyun.kwon@xilinx.com>
Tested-by: Radhey Shyam Pandey <radheys@xilinx.com>
Tested-by: Christian Kohn <christian.kohn@xilinx.com>
(cherry picked from commit 2b81f6cd384e8cff931a89fd2db7233894435a42)
Signed-off-by: Zumeng Chen <zumeng.chen@windriver.com>
---
 drivers/gpu/drm/xylon/xylon_crtc.c |   21 ++++++++++-----------
 1 files changed, 10 insertions(+), 11 deletions(-)

diff --git a/drivers/gpu/drm/xylon/xylon_crtc.c b/drivers/gpu/drm/xylon/xylon_crtc.c
index 438c40f..1c35774 100644
--- a/drivers/gpu/drm/xylon/xylon_crtc.c
+++ b/drivers/gpu/drm/xylon/xylon_crtc.c
@@ -203,24 +203,23 @@ static int xylon_drm_crtc_mode_set_base(struct drm_crtc *base_crtc,
 					int x, int y,
 					struct drm_framebuffer *old_fb)
 {
+	const struct drm_plane_funcs *funcs = base_crtc->primary->funcs;
 	int ret;
 
-	ret = xylon_drm_plane_fb_set(base_crtc->primary, base_crtc->primary->fb,
-				     0, 0,
-				     base_crtc->hwmode.hdisplay,
-				     base_crtc->hwmode.vdisplay,
-				     x, y,
-				     base_crtc->hwmode.hdisplay,
-				     base_crtc->hwmode.vdisplay);
+	ret = funcs->update_plane(base_crtc->primary,
+				  base_crtc,
+				  base_crtc->primary->fb,
+				  0, 0,
+				  base_crtc->hwmode.hdisplay,
+				  base_crtc->hwmode.vdisplay,
+				  x, y,
+				  base_crtc->hwmode.hdisplay,
+				  base_crtc->hwmode.vdisplay);
 	if (ret) {
 		DRM_ERROR("failed set plane mode\n");
 		return ret;
 	}
 
-	xylon_drm_plane_commit(base_crtc->primary);
-
-	xylon_drm_crtc_dpms(base_crtc, DRM_MODE_DPMS_ON);
-
 	return 0;
 }
 
-- 
1.7.5.4

