From 1d8cc2ea323f2494e41e06e4c72f878292ae2878 Mon Sep 17 00:00:00 2001
From: Hyun Kwon <hyun.kwon@xilinx.com>
Date: Mon, 5 May 2014 19:52:27 -0700
Subject: [PATCH 187/456] drm: adv7511: Add the rgb format flag to
 adv7511_link_config

This patch comes from:
  https://github.com/Xilinx/linux-xlnx.git

Add the rgb format boolean flag to struct adv7511_link_config. This was in
the drm encoder driver, but having it in the adv7511 driver would remove
direct dependency. The flag is copied to the struct adv7511 to be used for
the transmitter configuration.

Signed-off-by: Hyun Kwon <hyunk@xilinx.com>
Signed-off-by: Michal Simek <michal.simek@xilinx.com>
(cherry picked from commit b30cfd455f046684c8ca719beab5260485880ebc)
Signed-off-by: Zumeng Chen <zumeng.chen@windriver.com>
---
 drivers/gpu/drm/i2c/adv7511_core.c |    3 +++
 include/drm/i2c/adv7511.h          |    4 ++++
 2 files changed, 7 insertions(+), 0 deletions(-)

diff --git a/drivers/gpu/drm/i2c/adv7511_core.c b/drivers/gpu/drm/i2c/adv7511_core.c
index 97f1552..77c861a 100644
--- a/drivers/gpu/drm/i2c/adv7511_core.c
+++ b/drivers/gpu/drm/i2c/adv7511_core.c
@@ -216,6 +216,7 @@ static void adv7511_set_link_config(struct adv7511 *adv7511,
 
 	adv7511->hsync_polarity = config->hsync_polarity;
 	adv7511->vsync_polarity = config->vsync_polarity;
+	adv7511->rgb = config->rgb;
 }
 
 int adv7511_packet_enable(struct adv7511 *adv7511, unsigned int packet)
@@ -790,6 +791,8 @@ static int adv7511_parse_dt(struct device_node *np,
 	if (config->gpio_pd == -EPROBE_DEFER)
 		return -EPROBE_DEFER;
 
+	config->rgb = of_property_read_bool(np, "adi,is-rgb");
+
 	return 0;
 }
 
diff --git a/include/drm/i2c/adv7511.h b/include/drm/i2c/adv7511.h
index 4552a0e..721b91c 100644
--- a/include/drm/i2c/adv7511.h
+++ b/include/drm/i2c/adv7511.h
@@ -356,6 +356,7 @@ enum adv7511_up_conversion {
  * @tmds_clock_inversion:	Whether to invert the TDMS clock
  * @timing_gen_seq:		Selects the order in which sync DE generation
  *				and sync adjustment are performt.
+ * @rgb:			Whether rgb format is configured
  * @vsync_polarity:		vsync input signal configuration
  * @hsync_polarity:		hsync input signal configuration
  * @gpio_pd:			GPIO controlling the PD (powerdown) pin
@@ -371,6 +372,7 @@ struct adv7511_link_config {
 	enum adv7511_input_color_depth input_color_depth;
 	bool tmds_clock_inversion;
 	enum adv7511_timing_gen_seq timing_gen_seq;
+	bool rgb;
 
 	enum adv7511_sync_polarity vsync_polarity;
 	enum adv7511_sync_polarity hsync_polarity;
@@ -454,6 +456,8 @@ struct adv7511 {
 	enum adv7511_sync_polarity vsync_polarity;
 	enum adv7511_sync_polarity hsync_polarity;
 
+	bool rgb;
+
 	struct edid *edid;
 
 	int gpio_pd;
-- 
1.7.5.4

