From d171a4f5a50a3ae14a94402c23345eec31a205b2 Mon Sep 17 00:00:00 2001
From: Liming Wang <liming.wang@windriver.com>
Date: Fri, 5 Jul 2013 15:14:16 +0800
Subject: [PATCH 2/3] zynq: adjust the irq numbers

The original commit comes from:

https://github.com/Xilinx/linux-xlnx.git
commit 6e403c93d75478a8e29cf4d06f9490b00e0902d5
[ only borrow code of adjusting irq numbers ]

Also we have to adjust the numbers of interrupts for zynq
because several subsystems - e.g. GPIO, PCIe
use virtual IRQs beyond 128, thus this number must be increased.

Let's allocate IRQs 128-256 for PCIe
and IRQs 256-512(ARCH_NR_GPIOS) for GPIOs.
Also chnage XGPIOPS_IRQBASE to reflect this.

Signed-off-by: Soren Brinkmann <soren.brinkmann@xilinx.com>
Signed-off-by: Michal Simek <michal.simek@xilinx.com>
Signed-off-by: Liming Wang <liming.wang@windriver.com>
---
 arch/arm/mach-zynq/include/mach/gpio.h |    4 ++--
 arch/arm/mach-zynq/include/mach/irqs.h |    6 +++---
 2 files changed, 5 insertions(+), 5 deletions(-)

diff --git a/arch/arm/mach-zynq/include/mach/gpio.h b/arch/arm/mach-zynq/include/mach/gpio.h
index 4d54f4c..a669b68 100644
--- a/arch/arm/mach-zynq/include/mach/gpio.h
+++ b/arch/arm/mach-zynq/include/mach/gpio.h
@@ -18,8 +18,8 @@
 #define __ASM_ARCH_GPIO_H
 
 
-#define ARCH_NR_GPIOS		512
-#define XGPIOPS_IRQBASE		128
+#define ARCH_NR_GPIOS		256
+#define XGPIOPS_IRQBASE		256
 
 struct xgpio_platform_data {
 	unsigned int	state;
diff --git a/arch/arm/mach-zynq/include/mach/irqs.h b/arch/arm/mach-zynq/include/mach/irqs.h
index 870518d..b36d94b 100644
--- a/arch/arm/mach-zynq/include/mach/irqs.h
+++ b/arch/arm/mach-zynq/include/mach/irqs.h
@@ -15,9 +15,9 @@
 #ifndef __MACH_IRQS_H
 #define __MACH_IRQS_H
 
-#define NR_IRQS		128
-#define ARCH_NR_GPIOS	512
-#define XGPIOPS_IRQBASE	128
+#define ARCH_NR_GPIOS	256
+#define NR_IRQS		(256 + ARCH_NR_GPIOS)
+#define XGPIOPS_IRQBASE	256
 
 #define IRQ_LOCALTIMER	29
 
-- 
1.7.0

