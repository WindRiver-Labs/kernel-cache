From 7f091c3419c4ffc1987aefd3b783c4090017774b Mon Sep 17 00:00:00 2001
From: Michal Simek <michal.simek@xilinx.com>
Date: Fri, 8 Aug 2014 10:45:59 +0200
Subject: [PATCH 347/456] xilinx_axienet: Fix devm_ioremap_resource errors

devm_ioremap_resource already print message on error
that's why having another is the driver is useless.

Error message from devm_ioremap_resource:
xilinx_axienet 44a00000.network: can't request region for resource [mem
0x41e00000-0x41e0ffff]

Errors should be taken from PTR_ERR setup by devm_ioremap_resource.

Signed-off-by: Michal Simek <michal.simek@xilinx.com>
(cherry picked from commit 2bba782fb565aee0d5e437e1a9570508d5ecbc6d)
---
 drivers/net/ethernet/xilinx/xilinx_axienet_main.c |   10 ++++------
 1 files changed, 4 insertions(+), 6 deletions(-)

diff --git a/drivers/net/ethernet/xilinx/xilinx_axienet_main.c b/drivers/net/ethernet/xilinx/xilinx_axienet_main.c
index a2fa90e..f142563 100644
--- a/drivers/net/ethernet/xilinx/xilinx_axienet_main.c
+++ b/drivers/net/ethernet/xilinx/xilinx_axienet_main.c
@@ -1557,9 +1557,8 @@ static int axienet_probe(struct platform_device *pdev)
 	/* Map device registers */
 	ethres = platform_get_resource(pdev, IORESOURCE_MEM, 0);
 	lp->regs = devm_ioremap_resource(&pdev->dev, ethres);
-	if (!lp->regs) {
-		dev_err(&pdev->dev, "could not map Axi Ethernet regs.\n");
-		ret = -ENOMEM;
+	if (IS_ERR(lp->regs)) {
+		ret = PTR_ERR(lp->regs);
 		goto free_netdev;
 	}
 
@@ -1630,9 +1629,8 @@ static int axienet_probe(struct platform_device *pdev)
 		goto free_netdev;
 	}
 	lp->dma_regs = devm_ioremap_resource(&pdev->dev, &dmares);
-	if (!lp->dma_regs) {
-		dev_err(&pdev->dev, "could not map DMA regs\n");
-		ret = -ENOMEM;
+	if (IS_ERR(lp->dma_regs)) {
+		ret = PTR_ERR(lp->dma_regs);
 		goto free_netdev;
 	}
 	lp->rx_irq = irq_of_parse_and_map(np, 1);
-- 
1.7.5.4

