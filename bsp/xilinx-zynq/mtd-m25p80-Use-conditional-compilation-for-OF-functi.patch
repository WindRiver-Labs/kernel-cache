From d15010d18211d31d3c40fd1ee186e75049c0ee61 Mon Sep 17 00:00:00 2001
From: Suneel Garapati <suneel.garapati@xilinx.com>
Date: Wed, 19 Jun 2013 19:51:55 +0530
Subject: [PATCH 15/20] mtd: m25p80: Use conditional compilation for OF
 function calls in probe

git://github.com/Xilinx/linux-xlnx.git xilinx-v14.7
commit 2827507ceaa5bd2322a065fa73d51b6688a38719

Place the code which calls OF api's under conditional compilation
parameter CONFIG_OF and default initialize the variable otherwise.

Signed-off-by: Suneel Garapati <suneel.garapati@xilinx.com>
Signed-off-by: Michal Simek <michal.simek@xilinx.com>
Signed-off-by: Liming Wang <liming.wang@windriver.com>
---
 drivers/mtd/devices/m25p80.c |    7 +++++++
 1 files changed, 7 insertions(+), 0 deletions(-)

diff --git a/drivers/mtd/devices/m25p80.c b/drivers/mtd/devices/m25p80.c
index 570c38d..303bdc1 100644
--- a/drivers/mtd/devices/m25p80.c
+++ b/drivers/mtd/devices/m25p80.c
@@ -1249,6 +1249,7 @@ static int m25p_probe(struct spi_device *spi)
 	flash->mtd.size = info->sector_size * info->n_sectors;
 
 	{
+#ifdef CONFIG_OF
 		struct device_node *np;
 		const char *comp_str;
 		static int is_dual;
@@ -1285,6 +1286,12 @@ static int m25p_probe(struct spi_device *spi)
 				}
 			}
 		}
+#else
+		/* Default to single */
+		flash->shift = 0;
+		flash->isstacked = 0;
+		flash->isparallel = 0;
+#endif
 	}
 
 	flash->mtd._erase = m25p80_erase;
-- 
1.7.5.4

