From cad9929c68cfaa1e7bba8d07383d603334c1db7b Mon Sep 17 00:00:00 2001
From: "yadi.hu@windriver.com" <yadi.hu@windriver.com>
Date: Fri, 5 Dec 2014 12:48:01 +0800
Subject: [PATCH] zynq-edac: Determing has-ecc property

We see the following error printout from kernel:

zynq-edac f8006000.ps7-ddrc: ecc not enabled

We don't use ECC so the printout is valid. However, it
should not be an ERROR priority on this. The edac driver should
look at the "xlnx,has-ecc" property and take appropriate action.

Signed-off-by: Hu <yadi.hu@windriver.com>
---
 drivers/edac/zynq_edac.c |   11 +++++++++++
 1 files changed, 11 insertions(+), 0 deletions(-)

diff --git a/drivers/edac/zynq_edac.c b/drivers/edac/zynq_edac.c
index 2b7635f..cec3203 100644
--- a/drivers/edac/zynq_edac.c
+++ b/drivers/edac/zynq_edac.c
@@ -19,6 +19,7 @@
  */
 
 #include <linux/edac.h>
+#include <linux/of.h>
 #include <linux/module.h>
 #include <linux/platform_device.h>
 
@@ -507,6 +508,16 @@ static int zynq_edac_mc_probe(struct platform_device *pdev)
 	int rc;
 	struct resource *res;
 	void __iomem *baseaddr;
+	struct device_node *np = pdev->dev.of_node;
+	u32 *edac_enable;
+
+	if (!np || !of_device_is_available(np))
+		return -ENODEV;
+	
+	edac_enable = (u32 *)of_get_property(np, "xlnx,has-ecc", NULL);
+        if (!edac_enable || !(*edac_enable))/* property has-ecc disenabled or no exist */
+		return -ENODEV;
+		
 
 	/* Get the data from the platform device */
 	res = platform_get_resource(pdev, IORESOURCE_MEM, 0);
-- 
1.7.5.4

