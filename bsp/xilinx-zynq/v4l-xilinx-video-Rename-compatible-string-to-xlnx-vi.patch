From 266cdb8859be09587dff1612eac48daa851c0483 Mon Sep 17 00:00:00 2001
From: Laurent Pinchart <laurent.pinchart@ideasonboard.com>
Date: Fri, 12 Sep 2014 23:17:07 +0300
Subject: [PATCH 295/456] v4l: xilinx: video: Rename compatible string to
 xlnx,video

This patch comes from:
  https://github.com/Xilinx/linux-xlnx.git

None of the video-related IP cores use AXI in their compatible string,
modify the video device compatible string to match that.

Signed-off-by: Laurent Pinchart <laurent.pinchart@ideasonboard.com>
(cherry picked from commit 1b40d60dc2636ea36d3866627baf099f2c5115fe)

Conflicts:
	Documentation/devicetree/bindings/media/xilinx/xlnx,video.txt
	drivers/media/platform/xilinx/xilinx-vipp.c
Signed-off-by: Zumeng Chen <zumeng.chen@windriver.com>
---
 .../bindings/media/xilinx/xlnx,video.txt           |   55 ++++++++++++++++++++
 drivers/media/platform/xilinx/Makefile             |    4 +-
 drivers/media/platform/xilinx/xilinx-vipp.c        |    4 +-
 3 files changed, 59 insertions(+), 4 deletions(-)
 create mode 100644 Documentation/devicetree/bindings/media/xilinx/xlnx,video.txt

diff --git a/Documentation/devicetree/bindings/media/xilinx/xlnx,video.txt b/Documentation/devicetree/bindings/media/xilinx/xlnx,video.txt
new file mode 100644
index 0000000..543b192
--- /dev/null
+++ b/Documentation/devicetree/bindings/media/xilinx/xlnx,video.txt
@@ -0,0 +1,55 @@
+Xilinx Video IP Pipeline (VIPP)
+-------------------------------
+
+General concept
+---------------
+
+Xilinx video IP pipeline processes video streams through one or more Xilinx
+video IP cores. Each video IP core is represented as documented in video.txt
+and IP core specific documentation, xlnx,v-*.txt, in this directory. The DT
+node of the VIPP represents as a top level node of the pipeline and defines
+mappings between DMAs and the video IP cores.
+
+Required properties:
+
+- compatible: Must be "xlnx,video".
+
+- dmas, dma-names: List of one DMA specifier and identifier string (as defined
+  in Documentation/devicetree/bindings/dma/dma.txt) per port. Each port
+  requires a DMA channel with the identifier string set to "port" followed by
+  the port index.
+
+- ports: Video port, using the DT bindings defined in ../video-interfaces.txt.
+
+Required port properties:
+
+- direction: should be either "input" or "output" depending on the direction
+  of stream.
+
+Example:
+
+	axi_video_cap {
+		compatible = "xlnx,video";
+		dmas = <&axi_vdma_1 1>, <&axi_vdma_3 1>;
+		dma-names = "port0", "port1";
+
+		ports {
+			#address-cells = <1>;
+			#size-cells = <0>;
+
+			port@0 {
+				reg = <0>;
+				direction = "input";
+				vcap0_in0: endpoint {
+					remote-endpoint = <&scaler0_out>;
+				};
+			};
+			port@1 {
+				reg = <1>;
+				direction = "input";
+				vcap0_in1: endpoint {
+					remote-endpoint = <&switch_out1>;
+				};
+			};
+		};
+	};
diff --git a/drivers/media/platform/xilinx/Makefile b/drivers/media/platform/xilinx/Makefile
index 7b484c7..cf091fc 100644
--- a/drivers/media/platform/xilinx/Makefile
+++ b/drivers/media/platform/xilinx/Makefile
@@ -1,6 +1,6 @@
-xilinx-axi-video-objs += xilinx-dma.o xilinx-vip.o xilinx-vipp.o
+xilinx-video-objs += xilinx-dma.o xilinx-vip.o xilinx-vipp.o
 
-obj-$(CONFIG_VIDEO_XILINX) += xilinx-axi-video.o
+obj-$(CONFIG_VIDEO_XILINX) += xilinx-video.o
 obj-$(CONFIG_VIDEO_XILINX_CFA) += xilinx-cfa.o
 obj-$(CONFIG_VIDEO_XILINX_CRESAMPLE) += xilinx-cresample.o
 obj-$(CONFIG_VIDEO_XILINX_HLS) += xilinx-hls.o
diff --git a/drivers/media/platform/xilinx/xilinx-vipp.c b/drivers/media/platform/xilinx/xilinx-vipp.c
index d823a64..bfc745f 100644
--- a/drivers/media/platform/xilinx/xilinx-vipp.c
+++ b/drivers/media/platform/xilinx/xilinx-vipp.c
@@ -642,7 +642,7 @@ static int xvip_composite_remove(struct platform_device *pdev)
 }
 
 static const struct of_device_id xvip_composite_of_id_table[] = {
-	{ .compatible = "xlnx,axi-video" },
+	{ .compatible = "xlnx,video" },
 	{ }
 };
 MODULE_DEVICE_TABLE(of, xvip_composite_of_id_table);
@@ -650,7 +650,7 @@ MODULE_DEVICE_TABLE(of, xvip_composite_of_id_table);
 static struct platform_driver xvip_composite_driver = {
 	.driver = {
 		.owner = THIS_MODULE,
-		.name = "xilinx-axi-video",
+		.name = "xilinx-video",
 		.of_match_table = xvip_composite_of_id_table,
 	},
 	.probe = xvip_composite_probe,
-- 
1.7.5.4

