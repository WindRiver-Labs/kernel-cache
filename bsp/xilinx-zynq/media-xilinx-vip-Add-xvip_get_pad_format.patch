From 2e67cff93208a89a861c708eb1365e6e72b42f0b Mon Sep 17 00:00:00 2001
From: Hyun Kwon <hyunk@xilinx.com>
Date: Wed, 18 Dec 2013 17:42:22 -0800
Subject: [PATCH 282/456] media: xilinx: vip: Add xvip_get_pad_format()

This patch comes from:
  https://github.com/Xilinx/linux-xlnx.git

Add xvip_get_pad_format(), which gets the format of a certain pad
for a subdevice.

Signed-off-by: Hyun Kwon <hyunk@xilinx.com>
(cherry picked from commit 5a6c9014c4bec0a78a2a222b81549caaf6a89ed2)
Signed-off-by: Zumeng Chen <zumeng.chen@windriver.com>
---
 drivers/media/platform/xilinx/xilinx-vip.c |   31 ++++++++++++++++++++++++++++
 drivers/media/platform/xilinx/xilinx-vip.h |    4 +++
 2 files changed, 35 insertions(+), 0 deletions(-)

diff --git a/drivers/media/platform/xilinx/xilinx-vip.c b/drivers/media/platform/xilinx/xilinx-vip.c
index cba7447..a1d0c31 100644
--- a/drivers/media/platform/xilinx/xilinx-vip.c
+++ b/drivers/media/platform/xilinx/xilinx-vip.c
@@ -265,3 +265,34 @@ int xvip_enum_frame_size(struct v4l2_subdev *subdev, struct v4l2_subdev_fh *fh,
 	return 0;
 }
 EXPORT_SYMBOL_GPL(xvip_enum_frame_size);
+
+/**
+ * xvip_get_pad_format - Get the frame format on media bus for the pad
+ * @fh: V4L2 subdevice file handle
+ * @format: V4L2 active frame format on media bus
+ * @pad: media pad
+ * @which: media bus format type
+ *
+ * Get the frame format on media bus for the pad. Return corresponding
+ * frame format. The try format is returned by v4l2_subdev_get_try_format(),
+ * and when the active format is requested, the given frame format, @format,
+ * is returned.
+ *
+ * Return: frame format on media bus if successful, or NULL if no format
+ * is found.
+ */
+struct v4l2_mbus_framefmt *
+xvip_get_pad_format(struct v4l2_subdev_fh *fh,
+		    struct v4l2_mbus_framefmt *format,
+		    unsigned int pad, u32 which)
+{
+	switch (which) {
+	case V4L2_SUBDEV_FORMAT_TRY:
+		return v4l2_subdev_get_try_format(fh, pad);
+	case V4L2_SUBDEV_FORMAT_ACTIVE:
+		return format;
+	default:
+		return NULL;
+	}
+}
+EXPORT_SYMBOL_GPL(xvip_get_pad_format);
diff --git a/drivers/media/platform/xilinx/xilinx-vip.h b/drivers/media/platform/xilinx/xilinx-vip.h
index d2a2eb4..0a0369f 100644
--- a/drivers/media/platform/xilinx/xilinx-vip.h
+++ b/drivers/media/platform/xilinx/xilinx-vip.h
@@ -124,6 +124,10 @@ int xvip_enum_mbus_code(struct v4l2_subdev *subdev, struct v4l2_subdev_fh *fh,
 			struct v4l2_subdev_mbus_code_enum *code);
 int xvip_enum_frame_size(struct v4l2_subdev *subdev, struct v4l2_subdev_fh *fh,
 			 struct v4l2_subdev_frame_size_enum *fse);
+struct v4l2_mbus_framefmt *
+xvip_get_pad_format(struct v4l2_subdev_fh *fh,
+		    struct v4l2_mbus_framefmt *format,
+		    unsigned int pad, u32 which);
 
 static inline u32 xvip_read(struct xvip_device *xvip, u32 addr)
 {
-- 
1.7.5.4

