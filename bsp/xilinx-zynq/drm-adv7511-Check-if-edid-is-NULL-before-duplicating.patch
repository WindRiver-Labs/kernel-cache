From fc0d21fc8a55e3174dbcf9319ce77da4d99d574c Mon Sep 17 00:00:00 2001
From: Lars-Peter Clausen <lars@metafoo.de>
Date: Fri, 19 Apr 2013 14:45:03 +0200
Subject: [PATCH 230/509] drm: adv7511: Check if edid is NULL before
 duplicating it

https://github.com/analogdevicesinc/linux.git xcomm_zynq
commit 750a6e84764fbb68f63144f78262bddc1725f3eb

Signed-off-by: Lars-Peter Clausen <lars@metafoo.de>
Signed-off-by: Zhong Hongbo <hongbo.zhong@windriver.com>
---
 drivers/gpu/drm/i2c/adv7511_core.c |    5 ++++-
 1 files changed, 4 insertions(+), 1 deletions(-)

diff --git a/drivers/gpu/drm/i2c/adv7511_core.c b/drivers/gpu/drm/i2c/adv7511_core.c
index 8ee1ff3..939f447 100644
--- a/drivers/gpu/drm/i2c/adv7511_core.c
+++ b/drivers/gpu/drm/i2c/adv7511_core.c
@@ -495,6 +495,7 @@ static int adv7511_get_modes(struct drm_encoder *encoder,
 		regmap_update_bits(adv7511->regmap, ADV7511_REG_POWER,
 				ADV7511_POWER_POWER_DOWN, ADV7511_POWER_POWER_DOWN);
 
+	adv7511->edid = edid;
 	if (!edid)
 		return 0;
 
@@ -502,7 +503,6 @@ static int adv7511_get_modes(struct drm_encoder *encoder,
 	count = drm_add_edid_modes(connector, edid);
 
 	kfree(adv7511->edid);
-	adv7511->edid = edid;
 
 	return count;
 }
@@ -511,6 +511,9 @@ struct edid *adv7511_get_edid(struct drm_encoder *encoder)
 {
 	struct adv7511 *adv7511 = encoder_to_adv7511(encoder);
 
+	if (!adv7511->edid)
+		return NULL;
+
 	return kmemdup(adv7511->edid, sizeof(*adv7511->edid), GFP_KERNEL);
 }
 EXPORT_SYMBOL_GPL(adv7511_get_edid);
-- 
1.7.5.4

