From 308f42c23e84424bdc2c6e899ccd494173fc4501 Mon Sep 17 00:00:00 2001
From: Zumeng Chen <zumeng.chen@windriver.com>
Date: Thu, 15 Oct 2015 13:57:09 +0800
Subject: [PATCH 70/80] mtd:spi-nor: Added support for issi flash parts

This commit 9cb4f123 comes from:
  https://github.com/Xilinx/linux-xlnx.git

Added support for issi flash parts is25lp128, is25lp064 & is25lp032

Signed-off-by: Anurag Kumar Vulisha <anuragku@xilinx.com>
Signed-off-by: Michal Simek <michal.simek@xilinx.com>
Signed-off-by: Zumeng Chen <zumeng.chen@windriver.com>
---
 drivers/mtd/devices/m25p80.c  | 1 +
 drivers/mtd/spi-nor/spi-nor.c | 8 ++++++++
 2 files changed, 9 insertions(+)

diff --git a/drivers/mtd/devices/m25p80.c b/drivers/mtd/devices/m25p80.c
index 421f045..51ff8fa 100644
--- a/drivers/mtd/devices/m25p80.c
+++ b/drivers/mtd/devices/m25p80.c
@@ -302,6 +302,7 @@ static const struct spi_device_id m25p_ids[] = {
 	{"w25x64"},	{"w25q64"},	{"w25q80"},	{"w25q80bl"},
 	{"w25q128"},	{"w25q256"},	{"cat25c11"},
 	{"cat25c03"},	{"cat25c09"},	{"cat25c17"},	{"cat25128"},
+	{"is25lp032"},	{"is25lp064"},	{"is25lp128"},
 
 	/*
 	 * Generic support for SPI NOR that can be identified by the JEDEC READ
diff --git a/drivers/mtd/spi-nor/spi-nor.c b/drivers/mtd/spi-nor/spi-nor.c
index f9d48c91..cd37127 100644
--- a/drivers/mtd/spi-nor/spi-nor.c
+++ b/drivers/mtd/spi-nor/spi-nor.c
@@ -948,6 +948,13 @@ static const struct spi_device_id spi_nor_ids[] = {
 	{ "cat25c09", CAT25_INFO( 128, 8, 32, 2, SPI_NOR_NO_ERASE | SPI_NOR_NO_FR) },
 	{ "cat25c17", CAT25_INFO( 256, 8, 32, 2, SPI_NOR_NO_ERASE | SPI_NOR_NO_FR) },
 	{ "cat25128", CAT25_INFO(2048, 8, 64, 2, SPI_NOR_NO_ERASE | SPI_NOR_NO_FR) },
+		/* ISSI flash */
+	{ "is25lp032", INFO(0x9d6016, 0, 64 * 1024, 64,
+				SECT_4K | SPI_NOR_QUAD_IO_READ) },
+	{ "is25lp064", INFO(0x9d6017, 0, 64 * 1024, 128,
+				SECT_4K | SPI_NOR_QUAD_IO_READ) },
+	{ "is25lp128", INFO(0x9D6018, 0, 64 * 1024, 256,
+				SECT_4K | SPI_NOR_QUAD_IO_READ) },
 	{ },
 };
 
@@ -1334,6 +1341,7 @@ static int set_quad_mode(struct spi_nor *nor, struct flash_info *info)
 	int status;
 
 	switch (JEDEC_MFR(info)) {
+	case CFI_MFR_PMC:
 	case CFI_MFR_MACRONIX:
 		status = macronix_quad_enable(nor);
 		if (status) {
-- 
2.0.2

