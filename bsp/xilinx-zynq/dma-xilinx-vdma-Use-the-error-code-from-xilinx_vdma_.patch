From 0e7f15131060d3b156cee3fd0f5851cadcaaf7fa Mon Sep 17 00:00:00 2001
From: Hyun Kwon <hyunk@xilinx.com>
Date: Thu, 5 Sep 2013 11:21:17 -0700
Subject: [PATCH 318/509] dma: xilinx: vdma: Use the error code from
 xilinx_vdma_reset()

https://github.com/analogdevicesinc/linux.git xcomm_zynq
commit fe6e914665ac18be69957acae33b4eccfe5bce1e

Use the error code from xilinx_vdma_reset().

Signed-off-by: Hyun Kwon <hyunk@xilinx.com>
Acked-by: Srikanth Thokala <sthokal@xilinx.com>
Signed-off-by: Zhong Hongbo <hongbo.zhong@windriver.com>
---
 drivers/dma/xilinx/xilinx_axivdma.c |   12 ++++++------
 1 files changed, 6 insertions(+), 6 deletions(-)

diff --git a/drivers/dma/xilinx/xilinx_axivdma.c b/drivers/dma/xilinx/xilinx_axivdma.c
index 136ae37..b9f93fc 100644
--- a/drivers/dma/xilinx/xilinx_axivdma.c
+++ b/drivers/dma/xilinx/xilinx_axivdma.c
@@ -746,14 +746,16 @@ static dma_cookie_t xilinx_vdma_tx_submit(struct dma_async_tx_descriptor *tx)
 	struct xilinx_vdma_tx_segment *segment;
 	dma_cookie_t cookie;
 	unsigned long flags;
+	int err;
 
 	if (chan->err) {
 		/*
 		 * If reset fails, need to hard reset the system.
 		 * Channel is no longer functional
 		 */
-		if (xilinx_vdma_reset(chan))
-			return -EBUSY;
+		err = xilinx_vdma_reset(chan);
+		if (err < 0)
+			return err;
 	}
 
 	spin_lock_irqsave(&chan->lock, flags);
@@ -878,10 +880,8 @@ static int xilinx_vdma_slave_config(struct xilinx_vdma_chan *chan,
 {
 	u32 dmacr;
 
-	if (cfg->reset) {
-		xilinx_vdma_reset(chan);
-		return 0;
-	}
+	if (cfg->reset)
+		return xilinx_vdma_reset(chan);
 
 	dmacr = vdma_ctrl_read(chan, XILINX_VDMA_REG_DMACR);
 
-- 
1.7.5.4

