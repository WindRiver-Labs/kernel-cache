From 6b77fb4110f9207695ab8111815a2aee26a55004 Mon Sep 17 00:00:00 2001
From: Lars-Peter Clausen <lars@metafoo.de>
Date: Tue, 7 Aug 2012 15:54:35 +0200
Subject: [PATCH 222/509] DRM: adv7511: Write status word frequency and word
 len registers

https://github.com/analogdevicesinc/linux.git xcomm_zynq
commit 877856bd2b32e60fa0a7d9d11315e1a5de039072

These were commented out for no obvious reason. Make the work again.

Signed-off-by: Lars-Peter Clausen <lars@metafoo.de>
Signed-off-by: Zhong Hongbo <hongbo.zhong@windriver.com>
---
 drivers/gpu/drm/i2c/adv7511.h       |   18 ++++++++++++++----
 drivers/gpu/drm/i2c/adv7511_audio.c |   17 +++++------------
 2 files changed, 19 insertions(+), 16 deletions(-)

diff --git a/drivers/gpu/drm/i2c/adv7511.h b/drivers/gpu/drm/i2c/adv7511.h
index ebfc053..40a860e 100644
--- a/drivers/gpu/drm/i2c/adv7511.h
+++ b/drivers/gpu/drm/i2c/adv7511.h
@@ -158,10 +158,20 @@
 #define ADV7511_REG_POWER2_TDMS_ENABLE		BIT(4)
 #define ADV7511_REG_POWER2_GATE_INPUT_CLK	BIT(0)
 
-#define ADV7511_LOW_REFRESH_RATE_NONE 0x0
-#define ADV7511_LOW_REFRESH_RATE_24HZ 0x1
-#define ADV7511_LOW_REFRESH_RATE_25HZ 0x2
-#define ADV7511_LOW_REFRESH_RATE_30HZ 0x3
+#define ADV7511_LOW_REFRESH_RATE_NONE		0x0
+#define ADV7511_LOW_REFRESH_RATE_24HZ		0x1
+#define ADV7511_LOW_REFRESH_RATE_25HZ		0x2
+#define ADV7511_LOW_REFRESH_RATE_30HZ		0x3
+
+#define ADV7511_AUDIO_CFG3_LEN_MASK		0x0f
+#define ADV7511_I2C_FREQ_ID_CFG_RATE_MASK	0xf0
+
+#define ADV7511_AUDIO_SOURCE_I2S		0
+#define ADV7511_AUDIO_SOURCE_SPDIF		1
+
+#define ADV7511_I2S_FORMAT_I2S			0
+#define ADV7511_I2S_FORMAT_RIGHT_J		1
+#define ADV7511_I2S_FORMAT_LEFT_J		2
 
 #include <drm/drmP.h>
 
diff --git a/drivers/gpu/drm/i2c/adv7511_audio.c b/drivers/gpu/drm/i2c/adv7511_audio.c
index f24fe47..c7f65a7 100644
--- a/drivers/gpu/drm/i2c/adv7511_audio.c
+++ b/drivers/gpu/drm/i2c/adv7511_audio.c
@@ -126,22 +126,15 @@ static int adv7511_hw_params(struct snd_pcm_substream *substream,
 	adv7511->f_audio = params_rate(params);
 
 	adv7511_update_cts_n(adv7511);
-/*
+
 	regmap_update_bits(adv7511->regmap, ADV7511_REG_AUDIO_CFG3,
-	    ADV7511_REG_AUDIO_CFG3_LEN_MASK, len);
-	regmap_update_bits(adv7511->regmap, ADV7511_REG_AUDIO_CFG4,
-	    ADV7511_REG_AUDIO_CFG4_RATE_MASK, rate << 4);
-*/
+	    ADV7511_AUDIO_CFG3_LEN_MASK, len);
+	regmap_update_bits(adv7511->regmap, ADV7511_REG_I2C_FREQ_ID_CFG,
+	    ADV7511_I2C_FREQ_ID_CFG_RATE_MASK, rate << 4);
+
 	return 0;
 }
 
-#define ADV7511_AUDIO_SOURCE_I2S 0
-#define ADV7511_AUDIO_SOURCE_SPDIF 1
-
-#define ADV7511_I2S_FORMAT_I2S 0
-#define ADV7511_I2S_FORMAT_RIGHT_J 1
-#define ADV7511_I2S_FORMAT_LEFT_J 2
-
 static int adv7511_set_dai_fmt(struct snd_soc_dai *codec_dai,
 		unsigned int fmt)
 {
-- 
1.7.5.4

