From 2d67a745253086f7de3cd8b3af9db87fb927cc45 Mon Sep 17 00:00:00 2001
From: Hyun Kwon <hyun.kwon@xilinx.com>
Date: Mon, 5 May 2014 19:52:32 -0700
Subject: [PATCH 238/290] drm: xylon: connector: Call the encoder slave's
 mode_valid() function

This patch comes from:
  https://github.com/Xilinx/linux-xlnx.git

Call the mode valid function of the necoder slave, and let the encoder
slave driver check validity of given mode.

Signed-off-by: Hyun Kwon <hyunk@xilinx.com>
Signed-off-by: Michal Simek <michal.simek@xilinx.com>
(cherry picked from commit 463571522ee2a0ccb99f10e9a8f04ed99a265f39)
Signed-off-by: Zumeng Chen <zumeng.chen@windriver.com>
---
 drivers/gpu/drm/xylon/xylon_connector.c | 14 +++++++++++---
 1 file changed, 11 insertions(+), 3 deletions(-)

diff --git a/drivers/gpu/drm/xylon/xylon_connector.c b/drivers/gpu/drm/xylon/xylon_connector.c
index b637dd6..5f628f3 100644
--- a/drivers/gpu/drm/xylon/xylon_connector.c
+++ b/drivers/gpu/drm/xylon/xylon_connector.c
@@ -55,10 +55,18 @@ static int xylon_drm_connector_get_modes(struct drm_connector *base_connector)
 static int xylon_drm_connector_mode_valid(struct drm_connector *base_connector,
 					  struct drm_display_mode *mode)
 {
-	if (mode->clock > CLOCK_HIGH_LIMIT)
-		return MODE_CLOCK_HIGH;
+	struct xylon_drm_connector *connector =
+		to_xylon_connector(base_connector);
+	struct drm_encoder *encoder = connector->encoder;
+	struct drm_encoder_slave *encoder_slave = to_encoder_slave(encoder);
+	struct drm_encoder_slave_funcs *encoder_sfuncs =
+		encoder_slave->slave_funcs;
+	int ret = MODE_OK;
+
+	if (encoder_sfuncs->mode_valid)
+		ret = encoder_sfuncs->mode_valid(encoder, mode);
 
-	return MODE_OK;
+	return ret;
 }
 
 static struct drm_encoder *
-- 
2.0.2

