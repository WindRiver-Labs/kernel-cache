From 57864b32e07a94497d6ab68375554d36b9bb8bcf Mon Sep 17 00:00:00 2001
From: Nicolae Rosia <nicolae.rosia@certsign.ro>
Date: Mon, 5 Jan 2015 18:10:04 +0200
Subject: [PATCH 021/456] ARM: zynq: xilinx_axidma: refactor
 xilinx_dma_chan_probe logic into if/else branches

Signed-off-by: Nicolae Rosia <nicolae.rosia@certsign.ro>
Acked-by: Kedareswara rao Appana <appanad@xilinx.com>
Signed-off-by: Michal Simek <michal.simek@xilinx.com>
(cherry picked from commit 1428cc335c9f0bbc834f1e24a841e8d21401b64a)
---
 drivers/dma/xilinx/xilinx_axidma.c |   17 +++++++----------
 1 files changed, 7 insertions(+), 10 deletions(-)

diff --git a/drivers/dma/xilinx/xilinx_axidma.c b/drivers/dma/xilinx/xilinx_axidma.c
index 287d251..a1bee1f 100644
--- a/drivers/dma/xilinx/xilinx_axidma.c
+++ b/drivers/dma/xilinx/xilinx_axidma.c
@@ -905,22 +905,19 @@ static int xilinx_dma_chan_probe(struct xilinx_dma_device *xdev,
 
 	chan->start_transfer = xilinx_dma_start_transfer;
 
-	if (of_device_is_compatible(node, "xlnx,axi-dma-mm2s-channel"))
+	if (of_device_is_compatible(node, "xlnx,axi-dma-mm2s-channel")) {
+		chan->regs = xdev->regs;
+		chan->id = 0;
 		chan->direction = DMA_MEM_TO_DEV;
-	else if (of_device_is_compatible(node, "xlnx,axi-dma-s2mm-channel"))
+	} else if (of_device_is_compatible(node, "xlnx,axi-dma-s2mm-channel")) {
+		chan->regs = (xdev->regs + XILINX_DMA_RX_CHANNEL_OFFSET);
+		chan->id = 1;
 		chan->direction = DMA_DEV_TO_MEM;
-	else {
+	} else {
 		dev_err(xdev->dev, "Invalid channel compatible node\n");
 		return -EINVAL;
 	}
 
-	chan->regs = xdev->regs;
-
-	if (chan->direction == DMA_DEV_TO_MEM) {
-		chan->regs = (xdev->regs + XILINX_DMA_RX_CHANNEL_OFFSET);
-		chan->id = 1;
-	}
-
 	/*
 	 * Used by dmatest channel matching in slave transfers
 	 * Can change it to be a structure to have more matching information
-- 
1.7.5.4

