From 1a7eb45e03aa494b91b3f6246b973612be3aa4aa Mon Sep 17 00:00:00 2001
From: Srikanth Thokala <srikanth.thokala@xilinx.com>
Date: Fri, 13 Dec 2013 14:37:37 +0530
Subject: [PATCH 341/509] vdmatest: xilinx: Fix sparse errors

https://github.com/analogdevicesinc/linux.git xcomm_zynq
commit f712418203df177802838dc23f02bfa8a1fabdba

Fix sparse errors

Signed-off-by: Srikanth Thokala <sthokal@xilinx.com>
Signed-off-by: Michal Simek <michal.simek@xilinx.com>
Signed-off-by: Zhong Hongbo <hongbo.zhong@windriver.com>
---
 drivers/dma/xilinx/vdmatest.c |   10 +++++++---
 1 files changed, 7 insertions(+), 3 deletions(-)

diff --git a/drivers/dma/xilinx/vdmatest.c b/drivers/dma/xilinx/vdmatest.c
index 9a7c1e0..62ddd90 100644
--- a/drivers/dma/xilinx/vdmatest.c
+++ b/drivers/dma/xilinx/vdmatest.c
@@ -47,6 +47,9 @@ MODULE_PARM_DESC(iterations,
 #define PATTERN_OVERWRITE	0x20
 #define PATTERN_COUNT_MASK	0x1f
 
+/* Maximum number of frame buffers */
+#define MAX_NUM_FRAMES	32
+
 struct vdmatest_slave_thread {
 	struct list_head node;
 	struct task_struct *task;
@@ -67,6 +70,10 @@ struct vdmatest_chan {
 static LIST_HEAD(vdmatest_channels);
 static unsigned int nr_channels;
 static unsigned int frm_cnt;
+static dma_addr_t dma_srcs[MAX_NUM_FRAMES];
+static dma_addr_t dma_dsts[MAX_NUM_FRAMES];
+static struct scatterlist tx_sg[MAX_NUM_FRAMES];
+static struct scatterlist rx_sg[MAX_NUM_FRAMES];
 
 static void vdmatest_init_srcs(u8 **bufs, unsigned int start, unsigned int len)
 {
@@ -225,14 +232,11 @@ static int vdmatest_slave_func(void *data)
 		struct dma_device *rx_dev = rx_chan->device;
 		struct dma_async_tx_descriptor *txd = NULL;
 		struct dma_async_tx_descriptor *rxd = NULL;
-		dma_addr_t dma_srcs[frm_cnt], dma_dsts[frm_cnt];
 		struct completion rx_cmp, tx_cmp;
 		unsigned long rx_tmo =
 				msecs_to_jiffies(30000); /* RX takes longer */
 		unsigned long tx_tmo = msecs_to_jiffies(30000);
 		u8 align = 0;
-		struct scatterlist tx_sg[frm_cnt];
-		struct scatterlist rx_sg[frm_cnt];
 
 		total_tests++;
 
-- 
1.7.5.4

