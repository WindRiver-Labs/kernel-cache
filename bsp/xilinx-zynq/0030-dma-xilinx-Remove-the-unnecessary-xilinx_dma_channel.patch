From 5143c81e147bd01a5926dd17039ead188f65aa99 Mon Sep 17 00:00:00 2001
From: Kedareswara rao Appana <appana.durga.rao@xilinx.com>
Date: Sat, 29 Aug 2015 13:19:01 +0530
Subject: [PATCH 30/53] dma: xilinx: Remove the unnecessary xilinx_dma_channel_set_config API.

This patch comes from:
  https://github.com/Xilinx/linux-xlnx.git

This patch removes the unnecessary xilinx_dma_channel_set_config API
The properties in this API is not being used by the driver.
This patch also removes the api's related to set_config in the test client as well.

Signed-off-by: Kedareswara rao Appana <appanad@xilinx.com>
Signed-off-by: Michal Simek <michal.simek@xilinx.com>
(cherry picked from commit 3ce1c202cf1dc7fa884db5e9b8346b3efd9124d0)
Signed-off-by: Zumeng Chen <zumeng.chen@windriver.com>
---
 drivers/dma/xilinx/axidmatest.c |   10 ----------
 drivers/dma/xilinx/xilinx_dma.c |   30 ------------------------------
 include/linux/amba/xilinx_dma.h |   14 --------------
 3 files changed, 54 deletions(-)

diff --git a/drivers/dma/xilinx/axidmatest.c b/drivers/dma/xilinx/axidmatest.c
index a157033..c03c4ff 100644
--- a/drivers/dma/xilinx/axidmatest.c
+++ b/drivers/dma/xilinx/axidmatest.c
@@ -222,7 +222,6 @@ static int dmatest_slave_func(void *data)
 	int dst_cnt;
 	int bd_cnt = 11;
 	int i;
-	struct xilinx_dma_config config;
 	thread_name = current->comm;
 
 	ret = -ENOMEM;
@@ -337,15 +336,6 @@ static int dmatest_slave_func(void *data)
 
 		}
 
-		/* Only one interrupt */
-		config.coalesc = 1;
-		config.delay = 0;
-		xilinx_dma_channel_set_config(rx_chan, &config);
-
-		config.coalesc = 1;
-		config.delay = 0;
-		xilinx_dma_channel_set_config(tx_chan, &config);
-
 		rxd = rx_dev->device_prep_slave_sg(rx_chan, rx_sg, bd_cnt,
 				DMA_DEV_TO_MEM, flags, NULL);
 
diff --git a/drivers/dma/xilinx/xilinx_dma.c b/drivers/dma/xilinx/xilinx_dma.c
index 763e38a..bbf4499 100644
--- a/drivers/dma/xilinx/xilinx_dma.c
+++ b/drivers/dma/xilinx/xilinx_dma.c
@@ -1012,36 +1012,6 @@ static int xilinx_dma_terminate_all(struct dma_chan *dchan)
 }
 
 /**
- * xilinx_dma_channel_set_config - Configure DMA channel
- * @dchan: DMA channel
- * @cfg: DMA device configuration pointer
- * Return: '0' on success and failure value on error
- */
-int xilinx_dma_channel_set_config(struct dma_chan *dchan,
-				  struct xilinx_dma_config *cfg)
-{
-	struct xilinx_dma_chan *chan = to_xilinx_chan(dchan);
-	u32 reg = dma_ctrl_read(chan, XILINX_DMA_REG_CONTROL);
-
-	if (!xilinx_dma_is_idle(chan))
-		return -EBUSY;
-
-	if (cfg->reset)
-		return xilinx_dma_chan_reset(chan);
-
-	if (cfg->coalesc <= XILINX_DMA_CR_COALESCE_MAX)
-		reg |= cfg->coalesc << XILINX_DMA_CR_COALESCE_SHIFT;
-
-	if (cfg->delay <= XILINX_DMA_CR_DELAY_MAX)
-		reg |= cfg->delay << XILINX_DMA_CR_DELAY_SHIFT;
-
-	dma_ctrl_write(chan, XILINX_DMA_REG_CONTROL, reg);
-
-	return 0;
-}
-EXPORT_SYMBOL(xilinx_dma_channel_set_config);
-
-/**
  * xilinx_dma_chan_remove - Per Channel remove function
  * @chan: Driver specific DMA channel
  */
diff --git a/include/linux/amba/xilinx_dma.h b/include/linux/amba/xilinx_dma.h
index 492cef7..c27c9ae 100644
--- a/include/linux/amba/xilinx_dma.h
+++ b/include/linux/amba/xilinx_dma.h
@@ -49,18 +49,6 @@ struct xilinx_vdma_config {
 };
 
 /**
- * struct xilinx_dma_config - DMA Configuration structure
- * @coalesc: Interrupt coalescing threshold
- * @delay: Delay counter
- * @reset: Reset Channel
- */
-struct xilinx_dma_config {
-	int coalesc;
-	int delay;
-	int reset;
-};
-
-/**
  * struct xilinx_cdma_config - CDMA Configuration structure
  * @coalesc: Interrupt coalescing threshold
  * @delay: Delay counter
@@ -74,8 +62,6 @@ struct xilinx_cdma_config {
 
 int xilinx_vdma_channel_set_config(struct dma_chan *dchan,
 					struct xilinx_vdma_config *cfg);
-int xilinx_dma_channel_set_config(struct dma_chan *dchan,
-					struct xilinx_dma_config *cfg);
 int xilinx_cdma_channel_set_config(struct dma_chan *dchan,
                                         struct xilinx_cdma_config *cfg);
 #endif
-- 
1.7.10.4

