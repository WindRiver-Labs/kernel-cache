From 399420c8a2f342b1ce729d5325e768333f550755 Mon Sep 17 00:00:00 2001
From: Laurent Pinchart <laurent.pinchart@ideasonboard.com>
Date: Tue, 21 May 2013 01:03:23 +0200
Subject: [PATCH 282/509] dma: xilinx: vdma: Don't reconfigure channel after
 reset

https://github.com/analogdevicesinc/linux.git xcomm_zynq
commit bf17d0796b40e1a5013a83a7aca5a44edabf79fd

VDMA users usually don't supply channel configuration parameter when
requesting a reset. The driver would then reconfigure the channel with
random parameters. Avoid this by returning immediately after resetting
the channel. Users will reconfigure it afterwards anyway.

Signed-off-by: Laurent Pinchart <laurent.pinchart@ideasonboard.com>
Acked-by: Srikanth Thokala <sthokal@xilinx.com>
Signed-off-by: Zhong Hongbo <hongbo.zhong@windriver.com>
---
 drivers/dma/xilinx/xilinx_axivdma.c |    4 +++-
 1 files changed, 3 insertions(+), 1 deletions(-)

diff --git a/drivers/dma/xilinx/xilinx_axivdma.c b/drivers/dma/xilinx/xilinx_axivdma.c
index 1437bb4..2dcc212 100644
--- a/drivers/dma/xilinx/xilinx_axivdma.c
+++ b/drivers/dma/xilinx/xilinx_axivdma.c
@@ -934,8 +934,10 @@ static int xilinx_vdma_device_control(struct dma_chan *dchan,
 				(struct xilinx_vdma_config *)arg;
 		u32 reg;
 
-		if (cfg->reset)
+		if (cfg->reset) {
 			vdma_init(chan);
+			return 0;
+		}
 
 		reg = VDMA_IN(&chan->regs->cr);
 
-- 
1.7.5.4

