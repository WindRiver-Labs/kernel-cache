From 5232b917af5dce8d517c319520f10a41d7fc44ac Mon Sep 17 00:00:00 2001
From: Laurent Pinchart <laurent.pinchart@ideasonboard.com>
Date: Wed, 5 Nov 2014 17:31:47 +0200
Subject: [PATCH 309/456] v4l: xilinx: dma: Don't hardcode colorspace

This patch comes from:
  https://github.com/Xilinx/linux-xlnx.git

Even though most applications don't care about the colorspace, its value
matters and should be reported correctly by drivers. As userspace is
responsible for propagating formats, and thus colorspaces, through the
pipeline, just accept any colorspace value requested by userspace when
trying or setting the format and validates at streamon time that the
colorspace matches the one set up on the connected subdev.

Signed-off-by: Laurent Pinchart <laurent.pinchart@ideasonboard.com>
(cherry picked from commit 920e2c3a65590328bea12a00e81a799e1b81b139)
Signed-off-by: Zumeng Chen <zumeng.chen@windriver.com>
---
 drivers/media/platform/xilinx/xilinx-dma.c |    4 ++--
 1 files changed, 2 insertions(+), 2 deletions(-)

diff --git a/drivers/media/platform/xilinx/xilinx-dma.c b/drivers/media/platform/xilinx/xilinx-dma.c
index 1be1936..0c18b0f 100644
--- a/drivers/media/platform/xilinx/xilinx-dma.c
+++ b/drivers/media/platform/xilinx/xilinx-dma.c
@@ -74,7 +74,8 @@ static int xvip_dma_verify_format(struct xvip_dma *dma)
 
 	if (dma->fmtinfo->code != fmt.format.code ||
 	    dma->format.height != fmt.format.height ||
-	    dma->format.width != fmt.format.width)
+	    dma->format.width != fmt.format.width ||
+	    dma->format.colorspace != fmt.format.colorspace)
 		return -EINVAL;
 
 	return 0;
@@ -587,7 +588,6 @@ __xvip_dma_try_format(struct xvip_dma *dma, struct v4l2_pix_format *pix,
 		info = xvip_get_format_by_fourcc(XVIP_DMA_DEF_FORMAT);
 
 	pix->pixelformat = info->fourcc;
-	pix->colorspace = V4L2_COLORSPACE_SRGB;
 	pix->field = V4L2_FIELD_NONE;
 
 	/* The transfer alignment requirements are expressed in bytes. Compute
-- 
1.7.5.4

