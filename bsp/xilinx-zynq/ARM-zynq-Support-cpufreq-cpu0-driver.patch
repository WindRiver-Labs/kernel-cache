From 6081ef2c7f297f1f0c851f682807e4324c1b067b Mon Sep 17 00:00:00 2001
From: Soren Brinkmann <soren.brinkmann@xilinx.com>
Date: Tue, 4 Feb 2014 11:53:03 -0800
Subject: [PATCH 015/509] ARM: zynq: Support cpufreq-cpu0 driver

https://github.com/analogdevicesinc/linux.git xcomm_zynq
commit 9d73a5958403c3a3ac1a951f1db34d0e3f7c8821

Add the required platform device and DT data (OPPs and clock handle) to
support the generic cpu0 cpufreq driver.

Signed-off-by: Soren Brinkmann <soren.brinkmann@xilinx.com>
Signed-off-by: Michal Simek <michal.simek@xilinx.com>
Signed-off-by: Zhong Hongbo <hongbo.zhong@windriver.com>
---
 arch/arm/boot/dts/zynq-zc702.dts |    3 +++
 arch/arm/boot/dts/zynq-zc706.dts |    3 +++
 arch/arm/boot/dts/zynq-zed.dts   |    3 +++
 arch/arm/mach-zynq/common.c      |    2 ++
 4 files changed, 11 insertions(+), 0 deletions(-)

diff --git a/arch/arm/boot/dts/zynq-zc702.dts b/arch/arm/boot/dts/zynq-zc702.dts
index 9d17550..35c7451 100644
--- a/arch/arm/boot/dts/zynq-zc702.dts
+++ b/arch/arm/boot/dts/zynq-zc702.dts
@@ -33,6 +33,7 @@
 		#size-cells = <0>;
 		ps7_cortexa9_0: cpu@0 {
 			bus-handle = <&ps7_axi_interconnect_0>;
+			clocks = <&clkc 3>;
 			compatible = "arm,cortex-a9";
 			d-cache-line-size = <0x20>;
 			d-cache-size = <0x8000>;
@@ -40,10 +41,12 @@
 			i-cache-line-size = <0x20>;
 			i-cache-size = <0x8000>;
 			interrupt-handle = <&ps7_scugic_0>;
+			operating-points = <666667 1000000 333334 1000000 222223 1000000>;
 			reg = <0x0>;
 		} ;
 		ps7_cortexa9_1: cpu@1 {
 			bus-handle = <&ps7_axi_interconnect_0>;
+			clocks = <&clkc 3>;
 			compatible = "arm,cortex-a9";
 			d-cache-line-size = <0x20>;
 			d-cache-size = <0x8000>;
diff --git a/arch/arm/boot/dts/zynq-zc706.dts b/arch/arm/boot/dts/zynq-zc706.dts
index aec1377..8dd0669 100644
--- a/arch/arm/boot/dts/zynq-zc706.dts
+++ b/arch/arm/boot/dts/zynq-zc706.dts
@@ -33,6 +33,7 @@
 		#size-cells = <0>;
 		ps7_cortexa9_0: cpu@0 {
 			bus-handle = <&ps7_axi_interconnect_0>;
+			clocks = <&clkc 3>;
 			compatible = "arm,cortex-a9";
 			d-cache-line-size = <0x20>;
 			d-cache-size = <0x8000>;
@@ -40,10 +41,12 @@
 			i-cache-line-size = <0x20>;
 			i-cache-size = <0x8000>;
 			interrupt-handle = <&ps7_scugic_0>;
+			operating-points = <666667 1000000 333334 1000000 222223 1000000>;
 			reg = <0x0>;
 		} ;
 		ps7_cortexa9_1: cpu@1 {
 			bus-handle = <&ps7_axi_interconnect_0>;
+			clocks = <&clkc 3>;
 			compatible = "arm,cortex-a9";
 			d-cache-line-size = <0x20>;
 			d-cache-size = <0x8000>;
diff --git a/arch/arm/boot/dts/zynq-zed.dts b/arch/arm/boot/dts/zynq-zed.dts
index b367c5a..4b36bc5 100644
--- a/arch/arm/boot/dts/zynq-zed.dts
+++ b/arch/arm/boot/dts/zynq-zed.dts
@@ -32,6 +32,7 @@
 		#size-cells = <0>;
 		ps7_cortexa9_0: cpu@0 {
 			bus-handle = <&ps7_axi_interconnect_0>;
+			clocks = <&clkc 3>;
 			compatible = "arm,cortex-a9";
 			d-cache-line-size = <0x20>;
 			d-cache-size = <0x8000>;
@@ -39,10 +40,12 @@
 			i-cache-line-size = <0x20>;
 			i-cache-size = <0x8000>;
 			interrupt-handle = <&ps7_scugic_0>;
+			operating-points = <666667 1000000 333334 1000000 222223 1000000>;
 			reg = <0x0>;
 		} ;
 		ps7_cortexa9_1: cpu@1 {
 			bus-handle = <&ps7_axi_interconnect_0>;
+			clocks = <&clkc 3>;
 			compatible = "arm,cortex-a9";
 			d-cache-line-size = <0x20>;
 			d-cache-size = <0x8000>;
diff --git a/arch/arm/mach-zynq/common.c b/arch/arm/mach-zynq/common.c
index 8972b21..f9cce5a 100644
--- a/arch/arm/mach-zynq/common.c
+++ b/arch/arm/mach-zynq/common.c
@@ -109,10 +109,12 @@ static void __init zynq_init_late(void)
  */
 static void __init zynq_init_machine(void)
 {
+	struct platform_device_info devinfo = { .name = "cpufreq-cpu0", };
 
 	of_platform_populate(NULL, of_default_bus_match_table, NULL, NULL);
 
 	platform_device_register(&zynq_cpuidle_device);
+	platform_device_register_full(&devinfo);
 }
 
 static void __init zynq_timer_init(void)
-- 
1.7.5.4

