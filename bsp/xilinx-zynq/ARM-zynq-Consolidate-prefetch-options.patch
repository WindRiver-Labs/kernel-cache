From 95b18787275111c73084f21e8b2d00b13fb7aeef Mon Sep 17 00:00:00 2001
From: Soren Brinkmann <soren.brinkmann@xilinx.com>
Date: Thu, 29 May 2014 11:20:19 -0700
Subject: [PATCH 037/509] ARM: zynq: Consolidate prefetch options

https://github.com/analogdevicesinc/linux.git xcomm_zynq
commit 87ec42b2246c041d3e0afe382faa489dd3ea65af

Only provide one option to enable/disable prefetching. Chances are you
want it all or not at all.

Signed-off-by: Soren Brinkmann <soren.brinkmann@xilinx.com>
Signed-off-by: Michal Simek <michal.simek@xilinx.com>
Signed-off-by: Zhong Hongbo <hongbo.zhong@windriver.com>
---
 arch/arm/mach-zynq/Kconfig  |   14 +++-----------
 arch/arm/mach-zynq/common.c |    6 +++---
 2 files changed, 6 insertions(+), 14 deletions(-)

diff --git a/arch/arm/mach-zynq/Kconfig b/arch/arm/mach-zynq/Kconfig
index 7bf9181..2f696d4 100644
--- a/arch/arm/mach-zynq/Kconfig
+++ b/arch/arm/mach-zynq/Kconfig
@@ -23,19 +23,11 @@ if ARCH_ZYNQ
 
 menu "Xilinx Specific Options"
 
-config XILINX_L1_PREFETCH
-	bool "L1 Cache Prefetch"
+config XILINX_PREFETCH
+	bool "Cache Prefetch"
 	default y
 	help
-	  This option turns on L1 cache prefetching to get the best performance
-	  in many cases. This may not always be the best performance depending on
-	  the usage. There are some cases where this may cause issues when booting.
-
-config XILINX_L2_PREFETCH
-	bool "L2 Cache Prefetch"
-	default y
-	help
-	  This option turns on L2 cache prefetching to get the best performance
+	  This option turns on L1 & L2 cache prefetching to get the best performance
 	  in many cases. This may not always be the best performance depending on
 	  the usage.
 
diff --git a/arch/arm/mach-zynq/common.c b/arch/arm/mach-zynq/common.c
index 74ce1d9..5564213 100644
--- a/arch/arm/mach-zynq/common.c
+++ b/arch/arm/mach-zynq/common.c
@@ -78,7 +78,7 @@ static int __init zynq_l2c_init(void)
 	auxctrl = L2X0_AUX_CTRL_SHARE_OVERRIDE_EN_MASK |
 			L2X0_AUX_CTRL_WAY_SIZE64K_MASK |
 			L2X0_AUX_CTRL_REPLACE_POLICY_RR_MASK;
-#ifdef CONFIG_XILINX_L2_PREFETCH
+#ifdef CONFIG_XILINX_PREFETCH
 	auxctrl |= L2X0_AUX_CTRL_EARLY_BRESP_EN_MASK |
 			L2X0_AUX_CTRL_INSTR_PREFETCH_EN_MASK |
 			L2X0_AUX_CTRL_DATA_PREFETCH_EN_MASK;
@@ -89,7 +89,7 @@ early_initcall(zynq_l2c_init);
 #endif
 
 
-#ifdef CONFIG_XILINX_L1_PREFETCH
+#ifdef CONFIG_XILINX_PREFETCH
 static void __init zynq_data_prefetch_enable(void *info)
 {
 	/*
@@ -107,7 +107,7 @@ static void __init zynq_init_late(void)
 {
 	zynq_pm_late_init();
 
-#ifdef CONFIG_XILINX_L1_PREFETCH
+#ifdef CONFIG_XILINX_PREFETCH
 	on_each_cpu(zynq_data_prefetch_enable, NULL, 0);
 #endif
 }
-- 
1.7.5.4

