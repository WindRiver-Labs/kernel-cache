From 30d5aef94989cf020049bc882406e771b84868b0 Mon Sep 17 00:00:00 2001
From: Soren Brinkmann <soren.brinkmann@xilinx.com>
Date: Thu, 29 May 2014 11:20:19 -0700
Subject: [PATCH 152/182] ARM: zynq: Consolidate prefetch options

This patch comes from:
  https://github.com/Xilinx/linux-xlnx.git

Only provide one option to enable/disable prefetching. Chances are you
want it all or not at all.

Signed-off-by: Soren Brinkmann <soren.brinkmann@xilinx.com>
Signed-off-by: Michal Simek <michal.simek@xilinx.com>
(cherry picked from commit 87ec42b2246c041d3e0afe382faa489dd3ea65af)
Signed-off-by: Zumeng Chen <zumeng.chen@windriver.com>
---
 arch/arm/mach-zynq/Kconfig  |   14 +++-----------
 arch/arm/mach-zynq/common.c |    6 +++---
 2 files changed, 6 insertions(+), 14 deletions(-)

diff --git a/arch/arm/mach-zynq/Kconfig b/arch/arm/mach-zynq/Kconfig
index 9fd296e..3966f11 100644
--- a/arch/arm/mach-zynq/Kconfig
+++ b/arch/arm/mach-zynq/Kconfig
@@ -26,19 +26,11 @@ if ARCH_ZYNQ
 
 menu "Xilinx Specific Options"
 
-config XILINX_L1_PREFETCH
-	bool "L1 Cache Prefetch"
+config XILINX_PREFETCH
+	bool "Cache Prefetch"
 	default y
 	help
-	  This option turns on L1 cache prefetching to get the best performance
-	  in many cases. This may not always be the best performance depending on
-	  the usage. There are some cases where this may cause issues when booting.
-
-config XILINX_L2_PREFETCH
-	bool "L2 Cache Prefetch"
-	default y
-	help
-	  This option turns on L2 cache prefetching to get the best performance
+	  This option turns on L1 & L2 cache prefetching to get the best performance
 	  in many cases. This may not always be the best performance depending on
 	  the usage.
 
diff --git a/arch/arm/mach-zynq/common.c b/arch/arm/mach-zynq/common.c
index ba6c48b..e3c8ca3 100644
--- a/arch/arm/mach-zynq/common.c
+++ b/arch/arm/mach-zynq/common.c
@@ -84,7 +84,7 @@ static int __init zynq_l2c_init(void)
 	auxctrl = L2X0_AUX_CTRL_SHARE_OVERRIDE_EN_MASK |
 			L2X0_AUX_CTRL_WAY_SIZE64K_MASK |
 			L2X0_AUX_CTRL_REPLACE_POLICY_RR_MASK;
-#ifdef CONFIG_XILINX_L2_PREFETCH
+#ifdef CONFIG_XILINX_PREFETCH
 	auxctrl |= L2X0_AUX_CTRL_EARLY_BRESP_EN_MASK |
 			L2X0_AUX_CTRL_INSTR_PREFETCH_EN_MASK |
 			L2X0_AUX_CTRL_DATA_PREFETCH_EN_MASK;
@@ -95,7 +95,7 @@ early_initcall(zynq_l2c_init);
 #endif
 
 
-#ifdef CONFIG_XILINX_L1_PREFETCH
+#ifdef CONFIG_XILINX_PREFETCH
 static void __init zynq_data_prefetch_enable(void *info)
 {
 	/*
@@ -113,7 +113,7 @@ static void __init zynq_init_late(void)
 {
 	zynq_pm_late_init();
 
-#ifdef CONFIG_XILINX_L1_PREFETCH
+#ifdef CONFIG_XILINX_PREFETCH
 	on_each_cpu(zynq_data_prefetch_enable, NULL, 0);
 #endif
 }
-- 
1.7.5.4

