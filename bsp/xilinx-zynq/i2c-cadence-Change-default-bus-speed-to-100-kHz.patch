From b2005057e7401fa8f0f3e2a745c50d2307bcecf4 Mon Sep 17 00:00:00 2001
From: Soren Brinkmann <soren.brinkmann@xilinx.com>
Date: Thu, 10 Apr 2014 08:04:00 -0700
Subject: [PATCH 170/182] i2c: cadence: Change default bus speed to 100 kHz

This patch comes from:
  https://github.com/Xilinx/linux-xlnx.git

Normal mode is the safer option.

Signed-off-by: Soren Brinkmann <soren.brinkmann@xilinx.com>
Signed-off-by: Michal Simek <michal.simek@xilinx.com>
(cherry picked from commit 6362da1f97207759862232adf1daa9da7f078b31)
Signed-off-by: Zumeng Chen <zumeng.chen@windriver.com>
---
 .../devicetree/bindings/i2c/i2c-cadence.txt        |    3 +--
 drivers/i2c/busses/i2c-cadence.c                   |    3 ++-
 2 files changed, 3 insertions(+), 3 deletions(-)

diff --git a/Documentation/devicetree/bindings/i2c/i2c-cadence.txt b/Documentation/devicetree/bindings/i2c/i2c-cadence.txt
index 8b702c0..112e4a1 100644
--- a/Documentation/devicetree/bindings/i2c/i2c-cadence.txt
+++ b/Documentation/devicetree/bindings/i2c/i2c-cadence.txt
@@ -5,8 +5,7 @@ Required properties:
   clocks: From common clock bindings. Phandle to input clock.
 
 Optional properties:
-  clock-frequency: Desired operating frequency, in Hz, of the bus (actual may
-		   be lower). Defaults to 400000 if not specified.
+  clock-frequency: Desired operating frequency, in Hz, of the bus.
 
 Example:
 
diff --git a/drivers/i2c/busses/i2c-cadence.c b/drivers/i2c/busses/i2c-cadence.c
index b82a58a..5a17edd 100644
--- a/drivers/i2c/busses/i2c-cadence.c
+++ b/drivers/i2c/busses/i2c-cadence.c
@@ -95,6 +95,7 @@
 #define DRIVER_NAME		"cdns-i2c"
 
 #define CDNS_I2C_SPEED_MAX	400000
+#define CDNS_I2C_SPEED_DEFAULT	100000
 
 #define CDNS_I2C_DIVA_MAX	4
 #define CDNS_I2C_DIVB_MAX	64
@@ -830,7 +831,7 @@ static int cdns_i2c_probe(struct platform_device *pdev)
 	ret = of_property_read_u32(pdev->dev.of_node, "clock-frequency",
 			&id->i2c_clk);
 	if (ret || (id->i2c_clk > CDNS_I2C_SPEED_MAX))
-		id->i2c_clk = CDNS_I2C_SPEED_MAX;
+		id->i2c_clk = CDNS_I2C_SPEED_DEFAULT;
 
 	cdns_i2c_writereg(0xE, CDNS_I2C_CR_OFFSET);
 	cdns_i2c_writereg(id->adap.timeout, CDNS_I2C_TIME_OUT_OFFSET);
-- 
1.7.5.4

