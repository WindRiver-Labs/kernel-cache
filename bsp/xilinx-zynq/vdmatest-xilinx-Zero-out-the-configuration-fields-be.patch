From 6efff5016e3710aef23eab5e7053d2834a5b3414 Mon Sep 17 00:00:00 2001
From: Srikanth Thokala <srikanth.thokala@xilinx.com>
Date: Wed, 27 Nov 2013 19:56:23 +0530
Subject: [PATCH 004/182] vdmatest: xilinx: Zero out the configuration fields
 before configuring VDMA

This patch comes from:
  https://github.com/Xilinx/linux-xlnx.git

The existing VDMA test client is failing to work with latest VDMA driver,
as some of the configuration fields of configuration structure are non-zero
and hence VDMA engine is not configured properly.  So this patch fixes
the issue.

Signed-off-by: Srikanth Thokala <sthokal@xilinx.com>
Signed-off-by: Michal Simek <michal.simek@xilinx.com>
(cherry picked from commit ff62e7483c1ad6d20d2552fc62cdb40fbbdaf1bd)
Signed-off-by: Zumeng Chen <zumeng.chen@windriver.com>
---
 drivers/dma/xilinx/vdmatest.c |    9 +++------
 1 files changed, 3 insertions(+), 6 deletions(-)

diff --git a/drivers/dma/xilinx/vdmatest.c b/drivers/dma/xilinx/vdmatest.c
index d5be0da..9376ab3 100644
--- a/drivers/dma/xilinx/vdmatest.c
+++ b/drivers/dma/xilinx/vdmatest.c
@@ -292,19 +292,16 @@ static int vdmatest_slave_func(void *data)
 			sg_dma_len(&rx_sg[i]) = len;
 		}
 
+		/* Zero out configuration */
+		memset(&config, 0, sizeof(struct xilinx_vdma_config));
+
 		/* Set up hardware configuration information */
 		config.vsize = vsize;
 		config.hsize = hsize;
 		config.stride = hsize;
 		config.frm_cnt_en = 1;
 		config.coalesc = frm_cnt * 10;
-		config.delay = 0;
-		/* The following is do-not-care, need to set to 0 */
-		config.frm_dly = 0;
 		config.park = 1;
-		config.gen_lock = 0;
-		config.master = 0;
-		config.park_frm = 0;
 		tx_dev->device_control(tx_chan, DMA_SLAVE_CONFIG,
 					(unsigned long)&config);
 
-- 
1.7.5.4

