From 78bcd8a80779a64234979845be035bca8ab9e5e4 Mon Sep 17 00:00:00 2001
From: Soren Brinkmann <soren.brinkmann@xilinx.com>
Date: Thu, 10 Apr 2014 08:03:54 -0700
Subject: [PATCH 203/509] i2c: cadence: Use (read|write)l_relaxed IO helpers

https://github.com/analogdevicesinc/linux.git xcomm_zynq
commit 15db468267e5dfa64447c306bcb2df6780d32662

Also update driver dependencies accordingly. The relaxed IO helpers are
only provided on ARM.

Signed-off-by: Soren Brinkmann <soren.brinkmann@xilinx.com>
Signed-off-by: Michal Simek <michal.simek@xilinx.com>
Signed-off-by: Zhong Hongbo <hongbo.zhong@windriver.com>
---
 drivers/i2c/busses/Kconfig       |    2 +-
 drivers/i2c/busses/i2c-cadence.c |    4 ++--
 2 files changed, 3 insertions(+), 3 deletions(-)

diff --git a/drivers/i2c/busses/Kconfig b/drivers/i2c/busses/Kconfig
index 409482e..3144f90 100644
--- a/drivers/i2c/busses/Kconfig
+++ b/drivers/i2c/busses/Kconfig
@@ -366,7 +366,7 @@ config I2C_BLACKFIN_TWI_CLK_KHZ
 
 config I2C_CADENCE
 	tristate "Cadence I2C Controller"
-	depends on ARCH_ZYNQ
+	depends on COMMON_CLK && ARM
 	help
 	  Say yes here to select Cadence I2C Host Controller. This controller is
 	  e.g. used by Xilinx Zynq.
diff --git a/drivers/i2c/busses/i2c-cadence.c b/drivers/i2c/busses/i2c-cadence.c
index 922aedf..1c5014f 100644
--- a/drivers/i2c/busses/i2c-cadence.c
+++ b/drivers/i2c/busses/i2c-cadence.c
@@ -99,8 +99,8 @@
 #define CDNS_I2C_DIVA_MAX	4
 #define CDNS_I2C_DIVB_MAX	64
 
-#define cdns_i2c_readreg(offset)	__raw_readl(id->membase + offset)
-#define cdns_i2c_writereg(val, offset)	__raw_writel(val, id->membase + offset)
+#define cdns_i2c_readreg(offset)       readl_relaxed(id->membase + offset)
+#define cdns_i2c_writereg(val, offset) writel_relaxed(val, id->membase + offset)
 
 /**
  * struct cdns_i2c - I2C device private data structure
-- 
1.7.5.4

