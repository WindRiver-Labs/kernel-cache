From 53b8d8e500c32e24f3b01b39fe5c7aee57f73786 Mon Sep 17 00:00:00 2001
From: Harini Katakam <harini.katakam@xilinx.com>
Date: Fri, 28 Mar 2014 15:56:10 +0530
Subject: [PATCH 448/509] WDT: zynq: Simplify probe

https://github.com/analogdevicesinc/linux.git xcomm_zynq
commit d4e2c6663e0ca4681c481f92cf2895dfc158754f

Move register_reboot_notifier below register interrupt.
Remove goto err_notifier after request_irq and directly return.

Signed-off-by: Harini Katakam <harinik@xilinx.com>
Signed-off-by: Michal Simek <michal.simek@xilinx.com>
Signed-off-by: Zhong Hongbo <hongbo.zhong@windriver.com>
---
 drivers/watchdog/zynq_wdt.c |   18 +++++++++---------
 1 files changed, 9 insertions(+), 9 deletions(-)

diff --git a/drivers/watchdog/zynq_wdt.c b/drivers/watchdog/zynq_wdt.c
index a39350c..6a622e4 100644
--- a/drivers/watchdog/zynq_wdt.c
+++ b/drivers/watchdog/zynq_wdt.c
@@ -341,14 +341,6 @@ static int zynq_wdt_probe(struct platform_device *pdev)
 		goto err_free;
 	}
 
-	/* Register the reboot notifier */
-	ret = register_reboot_notifier(&zynq_wdt_notifier);
-	if (ret != 0) {
-		dev_err(&pdev->dev, "cannot register reboot notifier err=%d)\n",
-			res);
-		goto err_iounmap;
-	}
-
 	/* Register the interrupt */
 	prop = of_get_property(pdev->dev.of_node, "reset", NULL);
 	wdt->rst = prop ? be32_to_cpup(prop) : 0;
@@ -360,10 +352,18 @@ static int zynq_wdt_probe(struct platform_device *pdev)
 			dev_err(&pdev->dev,
 				"cannot register interrupt handler err=%d\n",
 				ret);
-			goto err_notifier;
+			return ret;
 		}
 	}
 
+	/* Register the reboot notifier */
+	ret = register_reboot_notifier(&zynq_wdt_notifier);
+	if (ret != 0) {
+		dev_err(&pdev->dev, "cannot register reboot notifier err=%d)\n",
+			ret);
+		return ret;
+	}
+
 	/* Initialize the members of zynq_wdt structure */
 	zynq_wdt_device.parent = &pdev->dev;
 	of_property_read_u32(pdev->dev.of_node, "timeout",
-- 
1.7.5.4

