From 629826c2dd0225fc3505e5585e6b0be7ad76c31e Mon Sep 17 00:00:00 2001
From: Lars-Peter Clausen <lars@metafoo.de>
Date: Tue, 25 Jun 2013 14:55:13 +0200
Subject: [PATCH 272/509] ASoC: axi-{i2s,spdif}: Set
 SND_DMAENGINE_PCM_FLAG_NO_RESIDUE for now

https://github.com/analogdevicesinc/linux.git xcomm_zynq
commit 2c64fa2f91e6998f6c2ba5ad0857777fb4514d74

The PL330 DMA driver doesn't support residue supporting, so set the
SND_DMAENGINE_PCM_FLAG_NO_RESIDUE for now.

Signed-off-by: Lars-Peter Clausen <lars@metafoo.de>
Signed-off-by: Zhong Hongbo <hongbo.zhong@windriver.com>
---
 sound/soc/xlnx/adi-axi-i2s.c |    3 ++-
 sound/soc/xlnx/axi-spdif.c   |    3 ++-
 2 files changed, 4 insertions(+), 2 deletions(-)

diff --git a/sound/soc/xlnx/adi-axi-i2s.c b/sound/soc/xlnx/adi-axi-i2s.c
index 0a5581f..a4a3864 100644
--- a/sound/soc/xlnx/adi-axi-i2s.c
+++ b/sound/soc/xlnx/adi-axi-i2s.c
@@ -247,7 +247,8 @@ static int axi_i2s_probe(struct platform_device *pdev)
 
 	regmap_write(i2s->regmap, AXI_I2S_REG_RESET, AXI_I2S_RESET_GLOBAL);
 
-	ret = snd_dmaengine_pcm_register(&pdev->dev, NULL, 0);
+	ret = snd_dmaengine_pcm_register(&pdev->dev, NULL,
+		SND_DMAENGINE_PCM_FLAG_NO_RESIDUE);
 	if (ret)
 		snd_soc_unregister_dai(&pdev->dev);
 
diff --git a/sound/soc/xlnx/axi-spdif.c b/sound/soc/xlnx/axi-spdif.c
index 3014f30..3042d62 100644
--- a/sound/soc/xlnx/axi-spdif.c
+++ b/sound/soc/xlnx/axi-spdif.c
@@ -232,7 +232,8 @@ static int axi_spdif_probe(struct platform_device *pdev)
 
 	regmap_write(spdif->regmap, AXI_SPDIF_REG_CTRL, AXI_SPDIF_CTRL_TXEN);
 
-	return snd_dmaengine_pcm_register(&pdev->dev, NULL, 0);
+	return snd_dmaengine_pcm_register(&pdev->dev, NULL,
+		SND_DMAENGINE_PCM_FLAG_NO_RESIDUE);
 }
 
 static int axi_spdif_dev_remove(struct platform_device *pdev)
-- 
1.7.5.4

