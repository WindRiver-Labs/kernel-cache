From 7f92e0f128f0613b34f64638f3f5cfd8a514a53b Mon Sep 17 00:00:00 2001
From: Lars-Peter Clausen <lars@metafoo.de>
Date: Fri, 19 Apr 2013 14:17:05 +0200
Subject: [PATCH 229/509] drm: adv7511: Ignore the csc scaling factor when the
 csc is disabled

https://github.com/analogdevicesinc/linux.git xcomm_zynq
commit ad5dae2bae24a89672f7212817f0d73e5c3c9195

The csc scaling factor might contain bogus values if the csc is not enabled, so
don't attempt to write it to the hw register.

Signed-off-by: Lars-Peter Clausen <lars@metafoo.de>
Signed-off-by: Zhong Hongbo <hongbo.zhong@windriver.com>
---
 drivers/gpu/drm/i2c/adv7511_core.c |    9 +++++++--
 1 files changed, 7 insertions(+), 2 deletions(-)

diff --git a/drivers/gpu/drm/i2c/adv7511_core.c b/drivers/gpu/drm/i2c/adv7511_core.c
index 1d67c69..8ee1ff3 100644
--- a/drivers/gpu/drm/i2c/adv7511_core.c
+++ b/drivers/gpu/drm/i2c/adv7511_core.c
@@ -90,8 +90,13 @@ static void adv7511_set_colormap(struct adv7511 *adv7511, bool enable,
 		}
 	}
 
-	regmap_update_bits(adv7511->regmap, ADV7511_REG_CSC_UPPER(0),
-		0xe0, (enable << 7) | (scaling_factor << 5));
+	if (enable) {
+		regmap_update_bits(adv7511->regmap, ADV7511_REG_CSC_UPPER(0),
+			0xe0, 0x80 | (scaling_factor << 5));
+	} else {
+		regmap_update_bits(adv7511->regmap, ADV7511_REG_CSC_UPPER(0),
+			0x80, 0x00);
+	}
 
 	regmap_update_bits(adv7511->regmap, ADV7511_REG_CSC_UPPER(1),
 		ADV7511_CSC_UPDATE_MODE, 0);
-- 
1.7.5.4

