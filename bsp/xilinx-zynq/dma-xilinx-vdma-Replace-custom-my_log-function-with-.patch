From 068b59565292471bebdcdd3be178187d463e2733 Mon Sep 17 00:00:00 2001
From: Laurent Pinchart <laurent.pinchart@ideasonboard.com>
Date: Wed, 22 May 2013 16:43:56 +0200
Subject: [PATCH 292/509] dma: xilinx: vdma: Replace custom my_log() function
 with fls()

https://github.com/analogdevicesinc/linux.git xcomm_zynq
commit b0c1fe8b45ebf84c23f3bf90062cbacc8e4637fd

Signed-off-by: Laurent Pinchart <laurent.pinchart@ideasonboard.com>
Acked-by: Srikanth Thokala <sthokal@xilinx.com>
Signed-off-by: Zhong Hongbo <hongbo.zhong@windriver.com>
---
 drivers/dma/xilinx/xilinx_axivdma.c |   20 ++------------------
 1 files changed, 2 insertions(+), 18 deletions(-)

diff --git a/drivers/dma/xilinx/xilinx_axivdma.c b/drivers/dma/xilinx/xilinx_axivdma.c
index e5221a4..0fb2cc5 100644
--- a/drivers/dma/xilinx/xilinx_axivdma.c
+++ b/drivers/dma/xilinx/xilinx_axivdma.c
@@ -19,6 +19,7 @@
  */
 
 #include <linux/amba/xilinx_dma.h>
+#include <linux/bitops.h>
 #include <linux/dmaengine.h>
 #include <linux/dmapool.h>
 #include <linux/init.h>
@@ -1032,23 +1033,6 @@ static int xilinx_vdma_device_control(struct dma_chan *dchan,
 		return -ENXIO;
 }
 
-/*
- * Logarithm function to compute alignment shift
- * Only deals with value less than 4096.
- */
-static int my_log(int value)
-{
-	int i = 0;
-	while ((1 << i) < value) {
-		i++;
-
-		if (i >= 12)
-			return 0;
-	}
-
-	return i;
-}
-
 static void xilinx_vdma_chan_remove(struct xilinx_vdma_chan *chan)
 {
 	irq_dispose_mapping(chan->irq);
@@ -1142,7 +1126,7 @@ static int xilinx_vdma_chan_probe(struct xilinx_vdma_device *xdev,
 	chan->common.private = (void *)&(chan->private);
 
 	if (!chan->has_dre)
-		xdev->common.copy_align = my_log(width);
+		xdev->common.copy_align = fls(width - 1);
 
 	chan->dev = xdev->dev;
 
-- 
1.7.5.4

