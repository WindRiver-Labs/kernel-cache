From 730dcbae01d0861aa9363daad0af027f49e2f58a Mon Sep 17 00:00:00 2001
From: Subbaraya Sundeep Bhatta <subbaraya.sundeep.bhatta@xilinx.com>
Date: Mon, 21 Sep 2015 13:48:03 +0530
Subject: [PATCH 02/77] usb: chipidea: Use usb2 phy for Zynq platform

Add usb2 phy to Zynq platform data.

Signed-off-by: Subbaraya Sundeep Bhatta <sbhatta@xilinx.com>
Signed-off-by: Michal Simek <michal.simek@xilinx.com>
[zou:Original patch taken from
https://github.com/Xilinx/linux-xlnx.git Petalinux 2015.4]
Signed-off-by: zou cao <cao.zou@windriver.com>
---
 drivers/usb/chipidea/ci_hdrc_usb2.c |    7 ++++++-
 1 files changed, 6 insertions(+), 1 deletions(-)

diff --git a/drivers/usb/chipidea/ci_hdrc_usb2.c b/drivers/usb/chipidea/ci_hdrc_usb2.c
index e99d4d1..3b11f10 100644
--- a/drivers/usb/chipidea/ci_hdrc_usb2.c
+++ b/drivers/usb/chipidea/ci_hdrc_usb2.c
@@ -79,8 +79,13 @@ static int ci_hdrc_usb2_probe(struct platform_device *pdev)
 		ci_pdata = &ci_default_pdata;
 
 	match = of_match_device(ci_hdrc_usb2_of_match, &pdev->dev);
-	if (match && match->data)
+	if (match && match->data) {
 		ci_pdata = (struct ci_hdrc_platform_data *)match->data;
+		ci_pdata->usb_phy = devm_usb_get_phy_by_phandle(dev, "usb-phy",
+					 0);
+		if (IS_ERR(ci_pdata->usb_phy))
+			return PTR_ERR(ci_pdata->usb_phy);
+	}
 
 	priv = devm_kzalloc(dev, sizeof(*priv), GFP_KERNEL);
 	if (!priv)
-- 
1.7.5.4

