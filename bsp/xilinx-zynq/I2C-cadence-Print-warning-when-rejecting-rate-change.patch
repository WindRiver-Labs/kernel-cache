From d0648f70d8ec57407bb48d22c9ae598ada7d29cc Mon Sep 17 00:00:00 2001
From: Soren Brinkmann <soren.brinkmann@xilinx.com>
Date: Thu, 27 Feb 2014 17:54:28 -0800
Subject: [PATCH 199/509] I2C: cadence: Print warning when rejecting rate
 changes

https://github.com/analogdevicesinc/linux.git xcomm_zynq
commit eae41966d171a5c1541c59bbfa2eb162277b1622

In order to make debugging clock notifiers easier, print a warning when
rejecting a rate change (cmp:
http://www.spinics.net/lists/arm-kernel/msg310596.html)

Signed-off-by: Soren Brinkmann <soren.brinkmann@xilinx.com>
Signed-off-by: Michal Simek <michal.simek@xilinx.com>
Signed-off-by: Zhong Hongbo <hongbo.zhong@windriver.com>
---
 drivers/i2c/busses/i2c-cadence.c |    5 ++++-
 1 files changed, 4 insertions(+), 1 deletions(-)

diff --git a/drivers/i2c/busses/i2c-cadence.c b/drivers/i2c/busses/i2c-cadence.c
index 0439943..86713d6 100644
--- a/drivers/i2c/busses/i2c-cadence.c
+++ b/drivers/i2c/busses/i2c-cadence.c
@@ -702,8 +702,11 @@ static int cdns_i2c_clk_notifier_cb(struct notifier_block *nb, unsigned long
 		int ret;
 
 		ret = cdns_i2c_calc_divs(&fscl, input_clk, &div_a, &div_b);
-		if (ret)
+		if (ret) {
+			dev_warn(id->adap.dev.parent,
+					"clock rate change rejected\n");
 			return NOTIFY_STOP;
+		}
 
 		/* scale up */
 		if (ndata->new_rate > ndata->old_rate)
-- 
1.7.5.4

