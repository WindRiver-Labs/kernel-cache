From 186fc77f3a769e28fad440c9291600e9c843bbbe Mon Sep 17 00:00:00 2001
From: Liming Wang <liming.wang@windriver.com>
Date: Fri, 28 Dec 2012 15:27:58 +0800
Subject: [PATCH 3/3] arm/zynq: Reset hardware when initializing to avoid
 backtrace

When starting kdump crash kernel, some pending interrupts of hardware
need to be clear. Otherwise pending interrupts may trigger the ethernet
driver backtrace because the irq system of kernel has not been ready then.

Signed-off-by: Liming Wang <liming.wang@windriver.com>
---
 drivers/net/ethernet/xilinx/xilinx_emacps.c |    3 +++
 1 file changed, 3 insertions(+)

diff --git a/drivers/net/ethernet/xilinx/xilinx_emacps.c b/drivers/net/ethernet/xilinx/xilinx_emacps.c
index 86c83c2..a9e028d 100644
--- a/drivers/net/ethernet/xilinx/xilinx_emacps.c
+++ b/drivers/net/ethernet/xilinx/xilinx_emacps.c
@@ -2415,6 +2415,9 @@ static int __init xemacps_probe(struct platform_device *pdev)
 		rc = -ENOMEM;
 		goto err_out_free_netdev;
 	}
+
+	xemacps_reset_hw(lp);
+
 #ifdef DEBUG
 	printk(KERN_INFO "GEM: BASEADDRESS hw: %p virt: %p\n",
 			(void *)r_mem->start, lp->baseaddr);
-- 
1.7.9.7

