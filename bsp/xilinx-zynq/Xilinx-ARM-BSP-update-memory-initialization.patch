From f3ae9af7bc861e4d42b9cf30d4f65c7ce7b1a6f8 Mon Sep 17 00:00:00 2001
From: John Linn <john.linn@xilinx.com>
Date: Wed, 18 Jul 2012 14:53:58 -0700
Subject: [PATCH 2/3] Xilinx: ARM: BSP: update memory initialization

Taken from git tree git://git.xilinx.com/linux-xlnx.git:
commit 2fd319205a36892149ebad0e9d39c36f1f525ab2

This removes the reserving of memory for video and
also adds conditional compilation for the case where
the memory is not at 0 so as not to hang the kernel.

Signed-off-by: John Linn <john.linn@xilinx.com>
Signed-off-by: Liming Wang <liming.wang@windriver.com>
---
 arch/arm/mach-zynq/common.c |    7 ++-----
 1 file changed, 2 insertions(+), 5 deletions(-)

diff --git a/arch/arm/mach-zynq/common.c b/arch/arm/mach-zynq/common.c
index c6c9c27..0bebc64 100644
--- a/arch/arm/mach-zynq/common.c
+++ b/arch/arm/mach-zynq/common.c
@@ -128,15 +128,12 @@ void __init xilinx_map_io(void)
  */
 void __init xilinx_memory_init(void)
 {
+#if (CONFIG_PHYS_OFFSET == 0)
 	/* Reserve the 0-0x4000 addresses (before page tables and kernel)
 	 * which can't be used for DMA
 	 */
 	memblock_reserve(0, 0x4000);
-
-	/* the video frame buffer is in DDR and shouldn't be used by the kernel
-	 * as it will be ioremapped by the frame buffer driver
-	 */
-	memblock_remove(0xF000000, 0x1000000);
+#endif
 }
 
 void zynq_reset(char mode, const char *cmd)
-- 
1.7.9.7

