From 4d9048ac81958e8042a4a67aba7282c9832b7613 Mon Sep 17 00:00:00 2001
From: SrikanthT <sthokal@xilinx.com>
Date: Thu, 5 Apr 2012 20:55:29 +0530
Subject: [PATCH 359/509] Xilinx: DMA: Support to Reset a channel of VDMA
 device.

https://github.com/analogdevicesinc/linux.git xcomm_zynq
commit 4477f38cb237be8cf1fcc9b5d9e53a8fbdbb7a5b

This patch adds the logic to reset a channel of VDMA.

Signed-off-by: SrikanthT <sthokal@xilinx.com>
Signed-off-by: Zhong Hongbo <hongbo.zhong@windriver.com>
---
 drivers/dma/xilinx_dma.c |    7 ++++++-
 1 files changed, 6 insertions(+), 1 deletions(-)

diff --git a/drivers/dma/xilinx_dma.c b/drivers/dma/xilinx_dma.c
index 567e183..60d5db0 100644
--- a/drivers/dma/xilinx_dma.c
+++ b/drivers/dma/xilinx_dma.c
@@ -1413,7 +1413,12 @@ static int xilinx_vdma_device_control(struct dma_chan *dchan,
 		return 0;
 	} else if (cmd == DMA_SLAVE_CONFIG) {
 		struct xilinx_dma_config *cfg = (struct xilinx_dma_config *)arg;
-		u32 reg = DMA_IN(&chan->regs->cr);
+		u32 reg;
+
+		if (cfg->reset)
+			dma_init(chan);
+
+		reg = DMA_IN(&chan->regs->cr);
 
 		/* If vsize is -1, it is park-related operations */
 		if (cfg->vsize == -1) {
-- 
1.7.5.4

