From b949dcf74bd3878db7134b82d007093748ef9785 Mon Sep 17 00:00:00 2001
From: Srikanth Thokala <srikanth.thokala@xilinx.com>
Date: Fri, 13 Dec 2013 14:37:27 +0530
Subject: [PATCH 012/182] vdma: xilinx: Add safe check if no child compatible
 string is available

This patch comes from:
  https://github.com/Xilinx/linux-xlnx.git

This adds a check condition if child node of VDMA device has
compatible strings neither "xlnx,axi-vdma-mm2s-channel" nor
"xlnx,axi-vdma-s2mm-channel".

Signed-off-by: Srikanth Thokala <sthokal@xilinx.com>
Signed-off-by: Michal Simek <michal.simek@xilinx.com>
(cherry picked from commit 1b189bcf73e16de88f48fa91fdebd7990792e25e)
Signed-off-by: Zumeng Chen <zumeng.chen@windriver.com>
---
 drivers/dma/xilinx/xilinx_axivdma.c |    3 +++
 1 files changed, 3 insertions(+), 0 deletions(-)

diff --git a/drivers/dma/xilinx/xilinx_axivdma.c b/drivers/dma/xilinx/xilinx_axivdma.c
index bb13c8d..28c8853 100644
--- a/drivers/dma/xilinx/xilinx_axivdma.c
+++ b/drivers/dma/xilinx/xilinx_axivdma.c
@@ -1268,6 +1268,9 @@ static int xilinx_vdma_chan_probe(struct xilinx_vdma_device *xdev,
 		if (xdev->flush_on_fsync == XILINX_VDMA_FLUSH_BOTH ||
 		    xdev->flush_on_fsync == XILINX_VDMA_FLUSH_S2MM)
 			chan->flush_on_fsync = true;
+	} else {
+		dev_err(xdev->dev, "Invalid channel compatible node\n");
+		return -EINVAL;
 	}
 
 	/*
-- 
1.7.5.4

