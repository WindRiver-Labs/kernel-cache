From f3836357661963227b85206303923196f0bf8f12 Mon Sep 17 00:00:00 2001
From: Michal Simek <michal.simek@xilinx.com>
Date: Tue, 4 Feb 2014 15:33:44 +0100
Subject: [PATCH 061/509] spi: qspi: Change zynq qspi compat string

https://github.com/analogdevicesinc/linux.git xcomm_zynq
commit 5a4a2f9caf60b4f68d1e890ecd2999446d8d2026

Signed-off-by: Michal Simek <michal.simek@xilinx.com>
Signed-off-by: Zhong Hongbo <hongbo.zhong@windriver.com>
---
 arch/arm/boot/dts/zynq-zc702.dts |    2 +-
 arch/arm/boot/dts/zynq-zc706.dts |    2 +-
 arch/arm/boot/dts/zynq-zed.dts   |    2 +-
 drivers/mtd/devices/m25p80.c     |    4 ++--
 drivers/spi/spi-zynq-qspi.c      |    2 +-
 5 files changed, 6 insertions(+), 6 deletions(-)

diff --git a/arch/arm/boot/dts/zynq-zc702.dts b/arch/arm/boot/dts/zynq-zc702.dts
index 8c1a67c..53e928a 100644
--- a/arch/arm/boot/dts/zynq-zc702.dts
+++ b/arch/arm/boot/dts/zynq-zc702.dts
@@ -267,7 +267,7 @@
 		ps7_qspi_0: ps7-qspi@e000d000 {
 			clock-names = "ref_clk", "aper_clk";
 			clocks = <&clkc 10>, <&clkc 43>;
-			compatible = "xlnx,ps7-qspi-1.00.a";
+			compatible = "xlnx,ps7-qspi-1.00.a", "xlnx,ps7-qspi-1.00.a";
 			interrupt-parent = <&ps7_scugic_0>;
 			interrupts = <0 19 4>;
 			is-dual = <0>;
diff --git a/arch/arm/boot/dts/zynq-zc706.dts b/arch/arm/boot/dts/zynq-zc706.dts
index 1a07143..041e530 100644
--- a/arch/arm/boot/dts/zynq-zc706.dts
+++ b/arch/arm/boot/dts/zynq-zc706.dts
@@ -252,7 +252,7 @@
 		ps7_qspi_0: ps7-qspi@e000d000 {
 			clock-names = "ref_clk", "aper_clk";
 			clocks = <&clkc 10>, <&clkc 43>;
-			compatible = "xlnx,ps7-qspi-1.00.a";
+			compatible = "xlnx,ps7-qspi-1.00.a", "xlnx,ps7-qspi-1.00.a";
 			interrupt-parent = <&ps7_scugic_0>;
 			interrupts = <0 19 4>;
 			is-dual = <1>;
diff --git a/arch/arm/boot/dts/zynq-zed.dts b/arch/arm/boot/dts/zynq-zed.dts
index 85a4705..e3047c8 100644
--- a/arch/arm/boot/dts/zynq-zed.dts
+++ b/arch/arm/boot/dts/zynq-zed.dts
@@ -176,7 +176,7 @@
 		ps7_qspi_0: ps7-qspi@e000d000 {
 			clock-names = "ref_clk", "aper_clk";
 			clocks = <&clkc 10>, <&clkc 43>;
-			compatible = "xlnx,ps7-qspi-1.00.a";
+			compatible = "xlnx,ps7-qspi-1.00.a", "xlnx,ps7-qspi-1.00.a";
 			interrupt-parent = <&ps7_scugic_0>;
 			interrupts = <0 19 4>;
 			is-dual = <0>;
diff --git a/drivers/mtd/devices/m25p80.c b/drivers/mtd/devices/m25p80.c
index 81ddbc0..b466085 100644
--- a/drivers/mtd/devices/m25p80.c
+++ b/drivers/mtd/devices/m25p80.c
@@ -1259,7 +1259,7 @@ static int m25p_probe(struct spi_device *spi)
 		u32 is_dual;
 		np = of_get_next_parent(spi->dev.of_node);
 		of_property_read_string(np, "compatible", &comp_str);
-		if (!strcmp(comp_str, "xlnx,ps7-qspi-1.00.a")) {
+		if (!strcmp(comp_str, "xlnx,zynq-qspi-1.00.a")) {
 			if (of_property_read_u32(np, "is-dual", &is_dual) < 0) {
 				/* Default to single if prop not defined */
 				flash->shift = 0;
@@ -1370,7 +1370,7 @@ static int m25p_probe(struct spi_device *spi)
 			const char *comp_str;
 			np = of_get_next_parent(spi->dev.of_node);
 			of_property_read_string(np, "compatible", &comp_str);
-			if (!strcmp(comp_str, "xlnx,ps7-qspi-1.00.a")) {
+			if (!strcmp(comp_str, "xlnx,zynq-qspi-1.00.a")) {
 				flash->addr_width = 3;
 				set_4byte(flash, info->jedec_id, 0);
 			} else {
diff --git a/drivers/spi/spi-zynq-qspi.c b/drivers/spi/spi-zynq-qspi.c
index 8cc1f8e..0556f04 100644
--- a/drivers/spi/spi-zynq-qspi.c
+++ b/drivers/spi/spi-zynq-qspi.c
@@ -1249,7 +1249,7 @@ static int zynq_qspi_remove(struct platform_device *pdev)
 MODULE_ALIAS("platform:" DRIVER_NAME);
 
 static struct of_device_id zynq_qspi_of_match[] = {
-	{ .compatible = "xlnx,ps7-qspi-1.00.a", },
+	{ .compatible = "xlnx,zynq-qspi-1.00.a", },
 	{ /* end of table */}
 };
 MODULE_DEVICE_TABLE(of, zynq_qspi_of_match);
-- 
1.7.5.4

