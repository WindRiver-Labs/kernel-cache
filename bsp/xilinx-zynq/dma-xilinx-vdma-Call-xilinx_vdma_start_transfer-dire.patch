From 43cb4c94a9714e681f1c85b2571f773f9b177ee7 Mon Sep 17 00:00:00 2001
From: Laurent Pinchart <laurent.pinchart@ideasonboard.com>
Date: Thu, 23 May 2013 13:45:09 +0200
Subject: [PATCH 307/509] dma: xilinx: vdma: Call xilinx_vdma_start_transfer()
 directly

https://github.com/analogdevicesinc/linux.git xcomm_zynq
commit babfcf8e8e29579e6634d9ab4198d28915188a2c

The function pointer is currently stored in the channel structure
start_transfer field and called indirectly. As the start_transfer field
always points to the same function, remove it and call
xilinx_vdma_start_transfer() directly.

Signed-off-by: Laurent Pinchart <laurent.pinchart@ideasonboard.com>
Acked-by: Srikanth Thokala <sthokal@xilinx.com>
Signed-off-by: Zhong Hongbo <hongbo.zhong@windriver.com>
---
 drivers/dma/xilinx/xilinx_axivdma.c |    5 +----
 1 files changed, 1 insertions(+), 4 deletions(-)

diff --git a/drivers/dma/xilinx/xilinx_axivdma.c b/drivers/dma/xilinx/xilinx_axivdma.c
index cb88268..87841c0 100644
--- a/drivers/dma/xilinx/xilinx_axivdma.c
+++ b/drivers/dma/xilinx/xilinx_axivdma.c
@@ -171,7 +171,6 @@ struct xilinx_vdma_chan {
 	struct tasklet_struct tasklet;		/* Cleanup work after irq */
 	u32 private;				/* Match info for
 							channel request */
-	void (*start_transfer)(struct xilinx_vdma_chan *chan);
 	struct xilinx_vdma_config config;	/* Device configuration info */
 	bool flush_fsync;			/* Flush on Fsync */
 };
@@ -652,7 +651,7 @@ static irqreturn_t xilinx_vdma_irq_handler(int irq, void *data)
 		xilinx_vdma_update_completed_cookie(chan);
 
 	if (to_transfer)
-		chan->start_transfer(chan);
+		xilinx_vdma_start_transfer(chan);
 
 	tasklet_schedule(&chan->tasklet);
 	return IRQ_HANDLED;
@@ -1076,8 +1075,6 @@ static int xilinx_vdma_chan_probe(struct xilinx_vdma_device *xdev,
 		return err;
 	}
 
-	chan->start_transfer = xilinx_vdma_start_transfer;
-
 	if (of_device_is_compatible(node, "xlnx,axi-vdma-mm2s-channel")) {
 		chan->direction = DMA_MEM_TO_DEV;
 		chan->id = 0;
-- 
1.7.5.4

