From 0c53de3b2004574b53e11a2007d8f07b35dcce5a Mon Sep 17 00:00:00 2001
From: Michael Hennerich <michael.hennerich@analog.com>
Date: Wed, 23 May 2012 13:47:39 +0200
Subject: [PATCH 363/509] Some DMA fixes

https://github.com/analogdevicesinc/linux.git xcomm_zynq
commit 77921376b543ba19164a3091c6f462038b9f17ce

Signed-off-by: Michael Hennerich <michael.hennerich@analog.com>
Signed-off-by: Zhong Hongbo <hongbo.zhong@windriver.com>
---
 drivers/dma/xilinx_dma.c |    6 +-----
 1 files changed, 1 insertions(+), 5 deletions(-)

diff --git a/drivers/dma/xilinx_dma.c b/drivers/dma/xilinx_dma.c
index 3e3e971..6199503d 100644
--- a/drivers/dma/xilinx_dma.c
+++ b/drivers/dma/xilinx_dma.c
@@ -486,7 +486,6 @@ static int xilinx_dma_wait_status(struct xilinx_dma_chan *chan, uint32_t mask,
 
 	do {
 		status = DMA_IN(&chan->regs->cr);
-		printk("status: %x, mask: %x, value: %x\n", status, mask, value);
 		if ((status & mask) == value)
 			break;
 	} while (--timeout);
@@ -581,10 +580,6 @@ static void xilinx_dma_start_transfer(struct xilinx_dma_chan *chan)
 		goto out_unlock;
 	}
 
-	ret = xilinx_dma_wait_idle(chan);
-	if (ret)
-		xilinx_dma_reset(chan);
-
 
 	/* If hardware is idle, then all descriptors on active list are
 	 * done, start new transfers
@@ -944,6 +939,7 @@ static struct dma_async_tx_descriptor *xilinx_dma_prep_slave_sg(
 			hw = t->descs[j].hw;
 			hw->buf_addr = dma_src;
 			hw->control = num_bytes;
+			sg_used += num_bytes;
 			j++;
 		}
 	}
-- 
1.7.5.4

