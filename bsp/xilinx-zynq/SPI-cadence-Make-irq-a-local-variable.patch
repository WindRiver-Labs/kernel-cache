From 3328a6853fa743454417fc2654fdef75b7b56f06 Mon Sep 17 00:00:00 2001
From: Harini Katakam <harini.katakam@xilinx.com>
Date: Mon, 17 Mar 2014 13:16:51 +0530
Subject: [PATCH 093/509] SPI: cadence: Make irq a local variable

https://github.com/analogdevicesinc/linux.git xcomm_zynq
commit c3a188c3c3f2de2429a7bafd2df769fddf717147

Remove irq from cdns_spi structure and make it a local variable in
probe function because that's the only place where it is used.

Signed-off-by: Harini Katakam <harinik@xilinx.com>
Signed-off-by: Michal Simek <michal.simek@xilinx.com>
Signed-off-by: Zhong Hongbo <hongbo.zhong@windriver.com>
---
 drivers/spi/spi-cadence.c |   12 +++++-------
 1 files changed, 5 insertions(+), 7 deletions(-)

diff --git a/drivers/spi/spi-cadence.c b/drivers/spi/spi-cadence.c
index 960aeb8..89c4e0d 100644
--- a/drivers/spi/spi-cadence.c
+++ b/drivers/spi/spi-cadence.c
@@ -115,7 +115,6 @@ enum driver_state_val {
  * @regs:		Virtual address of the SPI controller registers
  * @ref_clk:		Pointer to the peripheral clock
  * @pclk:		Pointer to the APB clock
- * @irq:		IRQ number
  * @speed_hz:		Current SPI bus clock speed in Hz
  * @txbuf:		Pointer	to the TX buffer
  * @rxbuf:		Pointer to the RX buffer
@@ -129,7 +128,6 @@ struct cdns_spi {
 	void __iomem *regs;
 	struct clk *ref_clk;
 	struct clk *pclk;
-	int irq;
 	u32 speed_hz;
 	const u8 *txbuf;
 	u8 *rxbuf;
@@ -573,7 +571,7 @@ static int cdns_unprepare_transfer_hardware(struct spi_master *master)
  */
 static int cdns_spi_probe(struct platform_device *pdev)
 {
-	int ret = 0;
+	int ret = 0, irq;
 	struct spi_master *master;
 	struct cdns_spi *xspi;
 	struct resource *res;
@@ -594,14 +592,14 @@ static int cdns_spi_probe(struct platform_device *pdev)
 		goto remove_master;
 	}
 
-	xspi->irq = platform_get_irq(pdev, 0);
-	if (xspi->irq < 0) {
+	irq = platform_get_irq(pdev, 0);
+	if (irq < 0) {
 		ret = -ENXIO;
 		dev_err(&pdev->dev, "irq number is negative\n");
 		goto remove_master;
 	}
 
-	ret = devm_request_irq(&pdev->dev, xspi->irq, cdns_spi_irq,
+	ret = devm_request_irq(&pdev->dev, irq, cdns_spi_irq,
 			       0, pdev->name, xspi);
 	if (ret != 0) {
 		ret = -ENXIO;
@@ -663,7 +661,7 @@ static int cdns_spi_probe(struct platform_device *pdev)
 	}
 
 	dev_info(&pdev->dev, "at 0x%08X mapped to 0x%08X, irq=%d\n",
-			res->start, (u32 __force)xspi->regs, xspi->irq);
+			res->start, (u32 __force)xspi->regs, irq);
 
 	return ret;
 
-- 
1.7.5.4

