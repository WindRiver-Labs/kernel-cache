From 351cb033e2c01953eeb2c9ed3acb06ed32d3c0bd Mon Sep 17 00:00:00 2001
From: William Bourque <wbourque@gmail.com>
Date: Fri, 7 Aug 2015 16:42:48 -0400
Subject: [PATCH 79/80] mtd: spi-nor: Fix lock/unlock on Micron with more than
 896 sectors.

This patch comes from:
  https://github.com/Xilinx/linux-xlnx.git

This fix sector pass 56MB to be impossible to unlock on large chip.
Should only affect Micron chip although similar fix might be needed
for chips from other vendors that make use of SR_BP3 bit to lock.

Tested on Micron N25Q512A chip, should apply to all Micron chips that
uses a fourth (SR_BP3) protection bit.

Signed-off-by: William Bourque <wfb@xiphos.com>
Signed-off-by: Michal Simek <michal.simek@xilinx.com>
(cherry picked from commit 6bf52ab36a0de62adbb42341c8f9448582c9db9a)
Signed-off-by: Zumeng Chen <zumeng.chen@windriver.com>
---
 include/linux/mtd/spi-nor.h | 3 ++-
 1 file changed, 2 insertions(+), 1 deletion(-)

diff --git a/include/linux/mtd/spi-nor.h b/include/linux/mtd/spi-nor.h
index e5e6482..fdb8f43 100644
--- a/include/linux/mtd/spi-nor.h
+++ b/include/linux/mtd/spi-nor.h
@@ -73,10 +73,11 @@
 #define SR_BP0			4	/* Block protect 0 */
 #define SR_BP1			8	/* Block protect 1 */
 #define SR_BP2			0x10	/* Block protect 2 */
+/* SR_BP3 only used on some Micron chip; must NOT be in SR_BP_BIT_MASK */
+#define SR_BP3			0x40	/* Block protect 3 */
 #define	SR_BP_BIT_OFFSET	2	/* Offset to Block protect 0 */
 #define	SR_BP_BIT_MASK		(SR_BP2 | SR_BP1 | SR_BP0)
 #define SR_SRWD			0x80	/* SR write protect */
-#define SR_BP3			0x40
 /* Bit to determine whether protection starts from top or bottom */
 #define SR_BP_TB		0x20
 
-- 
2.0.2

