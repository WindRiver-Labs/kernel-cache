From 67b6dac91e40bbfa9af0fd6cfd374cf22ff6b9d0 Mon Sep 17 00:00:00 2001
From: Laurent Pinchart <laurent.pinchart@ideasonboard.com>
Date: Tue, 18 Jun 2013 02:53:03 +0200
Subject: [PATCH 317/509] dma: xilinx: vdma: Clear error flag when resetting
 the DMA engine

https://github.com/analogdevicesinc/linux.git xcomm_zynq
commit a878048dad24caf396b2442ff1019dfe628ee322

Resetting the DMA engine clears the hardware error conditions. Clear the
software error flag as well.

Signed-off-by: Laurent Pinchart <laurent.pinchart@ideasonboard.com>
Acked-by: Srikanth Thokala <sthokal@xilinx.com>
Signed-off-by: Zhong Hongbo <hongbo.zhong@windriver.com>
---
 drivers/dma/xilinx/xilinx_axivdma.c |    3 +--
 1 files changed, 1 insertions(+), 2 deletions(-)

diff --git a/drivers/dma/xilinx/xilinx_axivdma.c b/drivers/dma/xilinx/xilinx_axivdma.c
index 9ac3a76..136ae37 100644
--- a/drivers/dma/xilinx/xilinx_axivdma.c
+++ b/drivers/dma/xilinx/xilinx_axivdma.c
@@ -667,6 +667,7 @@ static int xilinx_vdma_reset(struct xilinx_vdma_chan *chan)
 		return -ETIMEDOUT;
 	}
 
+	chan->err = 0;
 	return 0;
 }
 
@@ -753,8 +754,6 @@ static dma_cookie_t xilinx_vdma_tx_submit(struct dma_async_tx_descriptor *tx)
 		 */
 		if (xilinx_vdma_reset(chan))
 			return -EBUSY;
-
-		chan->err = 0;
 	}
 
 	spin_lock_irqsave(&chan->lock, flags);
-- 
1.7.5.4

