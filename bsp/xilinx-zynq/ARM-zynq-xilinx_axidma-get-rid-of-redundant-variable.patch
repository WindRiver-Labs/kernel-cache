From a477e53997ee84de8a67a654e33da1429f19f2c5 Mon Sep 17 00:00:00 2001
From: Nicolae Rosia <nicolae.rosia@certsign.ro>
Date: Mon, 5 Jan 2015 18:11:23 +0200
Subject: [PATCH 026/456] ARM: zynq: xilinx_axidma: get rid of redundant
 variables in xilinx_dma_update_completed_cookie

cookie and done variables only confuses things.

Signed-off-by: Nicolae Rosia <nicolae.rosia@certsign.ro>
Acked-by: Kedareswara rao Appana <appanad@xilinx.com>
Signed-off-by: Michal Simek <michal.simek@xilinx.com>
(cherry picked from commit 8fe69de6c7040a304b429988a511e579c50245c9)
---
 drivers/dma/xilinx/xilinx_axidma.c |   11 ++---------
 1 files changed, 2 insertions(+), 9 deletions(-)

diff --git a/drivers/dma/xilinx/xilinx_axidma.c b/drivers/dma/xilinx/xilinx_axidma.c
index ca7a619..731b61f 100644
--- a/drivers/dma/xilinx/xilinx_axidma.c
+++ b/drivers/dma/xilinx/xilinx_axidma.c
@@ -433,8 +433,6 @@ static void xilinx_dma_update_completed_cookie(struct xilinx_dma_chan *chan)
 	struct xilinx_dma_desc_sw *desc = NULL;
 	struct xilinx_dma_desc_hw *hw = NULL;
 	unsigned long flags;
-	dma_cookie_t cookie = -EBUSY;
-	int done = 0;
 
 	spin_lock_irqsave(&chan->lock, flags);
 
@@ -452,19 +450,14 @@ static void xilinx_dma_update_completed_cookie(struct xilinx_dma_chan *chan)
 			if (!(hw->status & XILINX_DMA_BD_STS_ALL_MASK)) {
 				break;
 			} else {
-				done = 1;
-				cookie = desc->async_tx.cookie;
+				chan->completed_cookie = desc->async_tx.cookie;
 			}
 		} else {
 			/* In non-SG mode, all active entries are done */
-			done = 1;
-			cookie = desc->async_tx.cookie;
+			chan->completed_cookie = desc->async_tx.cookie;
 		}
 	}
 
-	if (done)
-		chan->completed_cookie = cookie;
-
 out_unlock:
 	spin_unlock_irqrestore(&chan->lock, flags);
 }
-- 
1.7.5.4

