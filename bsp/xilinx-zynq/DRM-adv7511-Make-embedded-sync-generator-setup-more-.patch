From 76d6e84def805946cad1021f10cf0089f05915b8 Mon Sep 17 00:00:00 2001
From: Lars-Peter Clausen <lars@metafoo.de>
Date: Mon, 6 May 2013 10:37:58 +0200
Subject: [PATCH 235/509] DRM: adv7511: Make embedded sync generator setup
 more robust

https://github.com/analogdevicesinc/linux.git xcomm_zynq
commit 1a6cf4fb33baada2c0d7c968c2748b82f7e39772

Apply proper bit mask when writing the vsync and hsync parameters.

Signed-off-by: Lars-Peter Clausen <lars@metafoo.de>
Signed-off-by: Zhong Hongbo <hongbo.zhong@windriver.com>
---
 drivers/gpu/drm/i2c/adv7511_core.c |    6 +++---
 1 files changed, 3 insertions(+), 3 deletions(-)

diff --git a/drivers/gpu/drm/i2c/adv7511_core.c b/drivers/gpu/drm/i2c/adv7511_core.c
index cf91ac1..6642b52 100644
--- a/drivers/gpu/drm/i2c/adv7511_core.c
+++ b/drivers/gpu/drm/i2c/adv7511_core.c
@@ -624,11 +624,11 @@ static void adv7511_encoder_mode_set(struct drm_encoder *encoder,
 		regmap_write(adv7511->regmap, ADV7511_REG_SYNC_DECODER(0),
 			(hsync_offset >> 2) & 0xff);
 		regmap_write(adv7511->regmap, ADV7511_REG_SYNC_DECODER(1),
-			((hsync_offset & 0x3) << 2) | (hsync_len >> 4));
+			((hsync_offset & 0x3) << 6) | ((hsync_len >> 4) & 0x3f));
 		regmap_write(adv7511->regmap, ADV7511_REG_SYNC_DECODER(2),
-			((hsync_len & 0xf) << 4) | (vsync_offset >> 6));
+			((hsync_len & 0xf) << 4) | ((vsync_offset >> 6) & 0xf));
 		regmap_write(adv7511->regmap, ADV7511_REG_SYNC_DECODER(3),
-			((vsync_offset & 0x3f) << 2) | (vsync_len >> 8));
+			((vsync_offset & 0x3f) << 2) | ((vsync_len >> 8) & 0x3));
 		regmap_write(adv7511->regmap, ADV7511_REG_SYNC_DECODER(4),
 			vsync_len & 0xff);
 
-- 
1.7.5.4

