From b2ba55a357d68d9628c613722fa0daf94328d4b1 Mon Sep 17 00:00:00 2001
From: Soren Brinkmann <soren.brinkmann@xilinx.com>
Date: Fri, 24 Jan 2014 09:22:27 -0800
Subject: [PATCH 176/509] I2C: zynq: Reuse platform device ID as adapter
 number

https://github.com/analogdevicesinc/linux.git xcomm_zynq
commit bded9cdb650b51e62262e0413aa48a5fedd72695

Reusing pdev->id for the I2C adapter number allows to remove the
'bus-id' DT property.
Tegra, Omap use it.

Signed-off-by: Soren Brinkmann <soren.brinkmann@xilinx.com>
Signed-off-by: Michal Simek <michal.simek@xilinx.com>
Signed-off-by: Zhong Hongbo <hongbo.zhong@windriver.com>
---
 arch/arm/boot/dts/zynq-zc702.dts |    1 -
 arch/arm/boot/dts/zynq-zc706.dts |    1 -
 drivers/i2c/busses/i2c-zynq.c    |    7 +------
 3 files changed, 1 insertions(+), 8 deletions(-)

diff --git a/arch/arm/boot/dts/zynq-zc702.dts b/arch/arm/boot/dts/zynq-zc702.dts
index 13974c9..bc604b9 100644
--- a/arch/arm/boot/dts/zynq-zc702.dts
+++ b/arch/arm/boot/dts/zynq-zc702.dts
@@ -163,7 +163,6 @@
 			reg = <0xe000a000 0x1000>;
 		} ;
 		ps7_i2c_0: ps7-i2c@e0004000 {
-			bus-id = <0>;
 			clocks = <&clkc 38>;
 			compatible = "xlnx,ps7-i2c-1.00.a";
 			i2c-clk = <400000>;
diff --git a/arch/arm/boot/dts/zynq-zc706.dts b/arch/arm/boot/dts/zynq-zc706.dts
index 56b319a..bbdfdb9 100644
--- a/arch/arm/boot/dts/zynq-zc706.dts
+++ b/arch/arm/boot/dts/zynq-zc706.dts
@@ -155,7 +155,6 @@
 			reg = <0xe000a000 0x1000>;
 		} ;
 		ps7_i2c_0: ps7-i2c@e0004000 {
-			bus-id = <0>;
 			clocks = <&clkc 38>;
 			compatible = "xlnx,ps7-i2c-1.00.a";
 			i2c-clk = <400000>;
diff --git a/drivers/i2c/busses/i2c-zynq.c b/drivers/i2c/busses/i2c-zynq.c
index 411bae8..ea2446a 100644
--- a/drivers/i2c/busses/i2c-zynq.c
+++ b/drivers/i2c/busses/i2c-zynq.c
@@ -815,12 +815,7 @@ static int zynq_i2c_probe(struct platform_device *pdev)
 
 	id->irq = platform_get_irq(pdev, 0);
 
-	ret = of_property_read_u32(pdev->dev.of_node, "bus-id",
-			(u32 *)&id->adap.nr);
-	if (ret) {
-		dev_err(&pdev->dev, "couldn't determine bus-id\n");
-		return -ENXIO;
-	}
+	id->adap.nr = pdev->id;
 	id->adap.dev.of_node = pdev->dev.of_node;
 	id->adap.algo = &zynq_i2c_algo;
 	id->adap.timeout = 0x1F;	/* Default timeout value */
-- 
1.7.5.4

