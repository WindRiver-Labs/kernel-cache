From e5fbb8ce97bd9c4fc7f81c486abdb66f25acb1b8 Mon Sep 17 00:00:00 2001
From: Zhong Hongbo <hongbo.zhong@windriver.com>
Date: Fri, 12 Apr 2013 18:49:17 +0800
Subject: [PATCH 13/13] ARM: zynq: Allow UART1 to be used as DEBUG_LL console.

commit: aaf5e0be79e37d5a8509f09852788fa6a82522b2 upstream

The main UART on the Xilinx ZC702 board is UART1, located at address
e0001000.  Add a Kconfig option to select this device as the low-level
debugging port.  This allows the really early boot printouts to reach
the USB serial adaptor on this board.

For consistency's sake, add a choice entry for UART0 even though it is
the the default if UART1 is not selected.

Signed-off-by: Nick Bowler <nbowler@elliptictech.com>
Tested-by: Josh Cartwright <josh.cartwright@ni.com>
Acked-by: Michal Simek <michal.simek@xilinx.com>
Signed-off-by: Zhong Hongbo <hongbo.zhong@windriver.com>
---
 arch/arm/Kconfig.debug                     |   17 +++++++++++++++++
 arch/arm/mach-zynq/include/mach/zynq_soc.h |    2 +-
 2 files changed, 18 insertions(+), 1 deletions(-)

diff --git a/arch/arm/Kconfig.debug b/arch/arm/Kconfig.debug
index dad2c10..5b1c548 100644
--- a/arch/arm/Kconfig.debug
+++ b/arch/arm/Kconfig.debug
@@ -281,6 +281,23 @@ choice
 		  The uncompressor code port configuration is now handled
 		  by CONFIG_S3C_LOWLEVEL_UART_PORT.
 
+	config DEBUG_ZYNQ_UART0
+		depends on ARCH_ZYNQ
+		bool "Kernel low-level debugging on Xilinx Zynq using UART0"
+		help
+		  Say Y here if you want the debug print routines to direct
+		  their output to UART0 on the Zynq platform.
+
+	config DEBUG_ZYNQ_UART1
+		depends on ARCH_ZYNQ
+		bool "Kernel low-level debugging on Xilinx Zynq using UART1"
+		help
+		  Say Y here if you want the debug print routines to direct
+		  their output to UART1 on the Zynq platform.
+
+		  If you have a ZC702 board and want early boot messages to
+		  appear on the USB serial adaptor, select this option.
+
 	config DEBUG_LL_UART_NONE
 		bool "No low-level debugging UART"
 		help
diff --git a/arch/arm/mach-zynq/include/mach/zynq_soc.h b/arch/arm/mach-zynq/include/mach/zynq_soc.h
index 2bda12a..6f624ea 100644
--- a/arch/arm/mach-zynq/include/mach/zynq_soc.h
+++ b/arch/arm/mach-zynq/include/mach/zynq_soc.h
@@ -88,7 +88,7 @@
 /*
  * Mandatory for CONFIG_LL_DEBUG, UART is mapped virtual = physical
  */
-#ifdef CONFIG_ZYNQ_EARLY_UART1
+#ifdef CONFIG_DEBUG_ZYNQ_UART1
 #define LL_UART_PADDR	UART1_PHYS
 #define LL_UART_VADDR	UART1_VIRT
 #else
-- 
1.7.5.4

