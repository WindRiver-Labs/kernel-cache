From 1051b45e16b6b3ce0d08dc2708430ca45f908f4f Mon Sep 17 00:00:00 2001
From: Michal Simek <michal.simek@xilinx.com>
Date: Thu, 28 Jul 2016 15:39:42 +0200
Subject: [PATCH 145/188] net: macb: Fixed mixed declaration and code warnings

This patch comes from:
  https://github.com/Xilinx/linux-xlnx.git

This patch fixes these warnings:
drivers/net/ethernet/cadence/macb.c: In function macb_handle_txtstamp:
drivers/net/ethernet/cadence/macb.c:683:2: warning: ISO C90 forbids
mixed declarations and code [-Wdeclaration-after-statement]
  struct skb_shared_hwtstamps *shhwtstamps = skb_hwtstamps(skb);
  ^
drivers/net/ethernet/cadence/macb.c: In function macb_handle_rxtstamp:
drivers/net/ethernet/cadence/macb.c:866:2: warning: ISO C90 forbids
mixed declarations and code [-Wdeclaration-after-statement]
  struct skb_shared_hwtstamps *shhwtstamps = skb_hwtstamps(skb);
  ^

Signed-off-by: Michal Simek <michal.simek@xilinx.com>
(cherry picked from commit ff7364697e8e2d48af57fce47f66102b9a51a415)
Signed-off-by: Zumeng Chen <zumeng.chen@windriver.com>
---
 drivers/net/ethernet/cadence/macb.c | 6 ++++--
 1 file changed, 4 insertions(+), 2 deletions(-)

diff --git a/drivers/net/ethernet/cadence/macb.c b/drivers/net/ethernet/cadence/macb.c
index 82789aa..df7a1e1 100644
--- a/drivers/net/ethernet/cadence/macb.c
+++ b/drivers/net/ethernet/cadence/macb.c
@@ -662,6 +662,7 @@ static inline void macb_handle_txtstamp(struct macb *bp, struct sk_buff *skb,
 {
 	u32 ts_s, ts_ns;
 	u8 msg_type;
+	struct skb_shared_hwtstamps *shhwtstamps;
 
 	skb_copy_from_linear_data_offset(skb, GEM_TX_PTPHDR_OFFSET,
 					 &msg_type, 1);
@@ -684,7 +685,7 @@ static inline void macb_handle_txtstamp(struct macb *bp, struct sk_buff *skb,
 		ts_ns = desc->tsl & GEM_TSL_NSEC_MASK;
 	}
 
-	struct skb_shared_hwtstamps *shhwtstamps = skb_hwtstamps(skb);
+	shhwtstamps = skb_hwtstamps(skb);
 
 	memset(shhwtstamps, 0, sizeof(struct skb_shared_hwtstamps));
 	shhwtstamps->hwtstamp = ns_to_ktime((ts_s * NS_PER_SEC) + ts_ns);
@@ -847,6 +848,7 @@ static inline void macb_handle_rxtstamp(struct macb *bp, struct sk_buff *skb,
 {
 	u8 msg_type;
 	u32 ts_ns, ts_s;
+	struct skb_shared_hwtstamps *shhwtstamps;
 
 	skb_copy_from_linear_data_offset(skb, GEM_RX_PTPHDR_OFFSET,
 					 &msg_type, 1);
@@ -869,7 +871,7 @@ static inline void macb_handle_rxtstamp(struct macb *bp, struct sk_buff *skb,
 		ts_ns = desc->tsl & GEM_TSL_NSEC_MASK;
 	}
 
-	struct skb_shared_hwtstamps *shhwtstamps = skb_hwtstamps(skb);
+	shhwtstamps = skb_hwtstamps(skb);
 
 	memset(shhwtstamps, 0, sizeof(struct skb_shared_hwtstamps));
 	shhwtstamps->hwtstamp = ns_to_ktime((ts_s * NS_PER_SEC) + ts_ns);
-- 
2.0.2

