From 1498f9632bbbc1ce1ae15da639f5ac0ead6bf905 Mon Sep 17 00:00:00 2001
From: Kedareswara rao Appana <appana.durga.rao@xilinx.com>
Date: Fri, 1 Apr 2016 00:39:07 +0530
Subject: [PATCH 024/827] cdma: xilinx: Fix compilation warnings in the driver

This patch comes from:
  https://github.com/Xilinx/linux-xlnx.git

This patch fixes the below compilation warnings.

CC      drivers/dma/xilinx/xilinx_cdma.o
drivers/dma/xilinx/xilinx_cdma.c: In function ‘xilinx_cdma_irq_handler’:
drivers/dma/xilinx/xilinx_cdma.c:585:4: warning: cast from pointer to integer of different size [-Wpointer-to-int-cast]
    (u32)chan,
    ^
  CC      drivers/dma/xilinx/cdmatest.o
In file included from include/linux/kobject.h:20:0,
                 from include/linux/device.h:17,
                 from include/linux/dma-mapping.h:6,
                 from include/linux/dma/xilinx_dma.h:15,
                 from drivers/dma/xilinx/xilinx_cdma.c:19:
drivers/dma/xilinx/xilinx_cdma.c: In function ‘xilinx_cdma_start_transfer’:
include/linux/list.h:107:2: warning: ‘desc’ may be used uninitialized in this function [-Wmaybe-uninitialized]
  __list_del(entry->prev, entry->next);
  ^
drivers/dma/xilinx/xilinx_cdma.c:416:36: note: ‘desc’ was declared here
  struct xilinx_cdma_tx_descriptor *desc;

Signed-off-by: Kedareswara rao Appana <appanad@xilinx.com>
Signed-off-by: Michal Simek <michal.simek@xilinx.com>
(cherry picked from commit 8e011928a292d53504ef9dec7f7b61412f8bb259)
Signed-off-by: Zumeng Chen <zumeng.chen@windriver.com>
---
 drivers/dma/xilinx/xilinx_cdma.c | 16 ++++++++--------
 1 file changed, 8 insertions(+), 8 deletions(-)

diff --git a/drivers/dma/xilinx/xilinx_cdma.c b/drivers/dma/xilinx/xilinx_cdma.c
index f2f950c..c8b273a 100644
--- a/drivers/dma/xilinx/xilinx_cdma.c
+++ b/drivers/dma/xilinx/xilinx_cdma.c
@@ -425,6 +425,9 @@ static void xilinx_cdma_start_transfer(struct xilinx_cdma_chan *chan)
 	if (!chan->idle)
 		return;
 
+	desc = list_first_entry(&chan->pending_list,
+				struct xilinx_cdma_tx_descriptor, node);
+
 	/* If hardware is busy, cannot submit */
 	if (chan->has_sg && !xilinx_cdma_is_idle(chan)) {
 		tail = list_entry(desc->segments.prev,
@@ -433,9 +436,6 @@ static void xilinx_cdma_start_transfer(struct xilinx_cdma_chan *chan)
 		goto out_free_desc;
 	}
 
-	desc = list_first_entry(&chan->pending_list,
-				struct xilinx_cdma_tx_descriptor, node);
-
 	if (chan->has_sg) {
 		head = list_first_entry(&desc->segments,
 					struct xilinx_cdma_tx_segment, node);
@@ -583,11 +583,11 @@ static irqreturn_t xilinx_cdma_irq_handler(int irq, void *data)
 
 	if (stat & XILINX_CDMA_XR_IRQ_ERROR_MASK) {
 		dev_err(chan->dev,
-			"Channel %x has errors %x, cdr %x tdr %x\n",
-			(u32)chan,
-			(u32)cdma_read(chan, XILINX_CDMA_STATUS_OFFSET),
-			(u32)cdma_read(chan, XILINX_CDMA_CDESC_OFFSET),
-			(u32)cdma_read(chan, XILINX_CDMA_TDESC_OFFSET));
+			"Channel %p has errors %x, cdr %x tdr %x\n",
+			chan,
+			cdma_read(chan, XILINX_CDMA_STATUS_OFFSET),
+			cdma_read(chan, XILINX_CDMA_CDESC_OFFSET),
+			cdma_read(chan, XILINX_CDMA_TDESC_OFFSET));
 		chan->err = true;
 	}
 
-- 
2.9.3

