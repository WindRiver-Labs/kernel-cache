From 07c8b7a337d78846a92d9ea8462bff9b99ab9377 Mon Sep 17 00:00:00 2001
From: Laurent Pinchart <[laurent.pinchart@ideasonboard.com]>
Date: Wed, 2 Jul 2014 11:27:09 -0700
Subject: [PATCH 545/827] media: xilinx: Remove global control handler

This patch comes from:
  https://github.com/Xilinx/linux-xlnx.git

Follow Up Flag: Follow up
Flag Status: Flagged

Inheriting subdev controls on video nodes doesn't work in the general
case, as we have no control of what IP cores are included in the
pipeline. Even a simple linear pipeline could have several identical
controls when it includes several instances of IP cores of the same
family (two HLS cores for instance).

Controls should be accessed directly on subdev nodes. Remove the global
control handler to prevent control inheritance.

Signed-off-by: Laurent Pinchart <laurent.pinchart@ideasonboard.com>
(cherry picked from commit 683a85575aa3ae5eed0613c359edb32d2614d5f1)
Signed-off-by: Zumeng Chen <zumeng.chen@windriver.com>
---
 drivers/media/platform/xilinx/xilinx-vipp.c | 4 ----
 drivers/media/platform/xilinx/xilinx-vipp.h | 3 ---
 2 files changed, 7 deletions(-)

diff --git a/drivers/media/platform/xilinx/xilinx-vipp.c b/drivers/media/platform/xilinx/xilinx-vipp.c
index c022ddf..d823a64 100644
--- a/drivers/media/platform/xilinx/xilinx-vipp.c
+++ b/drivers/media/platform/xilinx/xilinx-vipp.c
@@ -563,7 +563,6 @@ done:
 
 static void xvip_composite_v4l2_cleanup(struct xvip_composite_device *xdev)
 {
-	v4l2_ctrl_handler_free(&xdev->ctrl_handler);
 	v4l2_device_unregister(&xdev->v4l2_dev);
 	media_device_unregister(&xdev->media_dev);
 }
@@ -593,9 +592,6 @@ static int xvip_composite_v4l2_init(struct xvip_composite_device *xdev)
 		return ret;
 	}
 
-	v4l2_ctrl_handler_init(&xdev->ctrl_handler, 0);
-	xdev->v4l2_dev.ctrl_handler = &xdev->ctrl_handler;
-
 	return 0;
 }
 
diff --git a/drivers/media/platform/xilinx/xilinx-vipp.h b/drivers/media/platform/xilinx/xilinx-vipp.h
index 3437d9c..4edda19 100644
--- a/drivers/media/platform/xilinx/xilinx-vipp.h
+++ b/drivers/media/platform/xilinx/xilinx-vipp.h
@@ -29,7 +29,6 @@
  * @entities: entities in the graph as a list of xvip_graph_entity
  * @num_subdevs: number of subdevs in the pipeline
  * @dmas: list of DMA channels at the pipeline output and input
- * @ctrl_handler: control handler
  */
 struct xvip_composite_device {
 	struct v4l2_device v4l2_dev;
@@ -41,8 +40,6 @@ struct xvip_composite_device {
 	unsigned int num_subdevs;
 
 	struct list_head dmas;
-
-	struct v4l2_ctrl_handler ctrl_handler;
 };
 
 #endif /* __XILINX_VIPP_H__ */
-- 
2.9.3

