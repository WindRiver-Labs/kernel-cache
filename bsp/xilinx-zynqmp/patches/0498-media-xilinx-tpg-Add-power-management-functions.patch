From 29f7adea76b323a5bd2fd31e3328b07f9b0fe5b0 Mon Sep 17 00:00:00 2001
From: Hyun Kwon <hyun.kwon@xilinx.com>
Date: Tue, 18 Mar 2014 09:18:54 -0700
Subject: [PATCH 498/827] media: xilinx: tpg: Add power management functions

This patch comes from:
  https://github.com/Xilinx/linux-xlnx.git

Add power management functions using xvip herlpers.

Signed-off-by: Hyun Kwon <hyun.kwon@xilinx.com>
Acked-by: Laurent Pinchart <laurent.pinchart@ideasonboard.com>
Signed-off-by: Michal Simek <michal.simek@xilinx.com>
(cherry picked from commit 5103a103b476a1072e61897f29116812dff8bbf3)
Signed-off-by: Zumeng Chen <zumeng.chen@windriver.com>
---
 drivers/media/platform/xilinx/xilinx-tpg.c | 25 +++++++++++++++++++++++++
 1 file changed, 25 insertions(+)

diff --git a/drivers/media/platform/xilinx/xilinx-tpg.c b/drivers/media/platform/xilinx/xilinx-tpg.c
index 8e91d34..e600a71 100644
--- a/drivers/media/platform/xilinx/xilinx-tpg.c
+++ b/drivers/media/platform/xilinx/xilinx-tpg.c
@@ -515,6 +515,28 @@ static const struct media_entity_operations xtpg_media_ops = {
 };
 
 /* -----------------------------------------------------------------------------
+ * Power Management
+ */
+
+static int __maybe_unused xtpg_pm_suspend(struct device *dev)
+{
+	struct xtpg_device *xtpg = dev_get_drvdata(dev);
+
+	xvip_suspend(&xtpg->xvip);
+
+	return 0;
+}
+
+static int __maybe_unused xtpg_pm_resume(struct device *dev)
+{
+	struct xtpg_device *xtpg = dev_get_drvdata(dev);
+
+	xvip_resume(&xtpg->xvip);
+
+	return 0;
+}
+
+/* -----------------------------------------------------------------------------
  * Platform Device Driver
  */
 
@@ -633,6 +655,8 @@ static int xtpg_remove(struct platform_device *pdev)
 	return 0;
 }
 
+static SIMPLE_DEV_PM_OPS(xtpg_pm_ops, xtpg_pm_suspend, xtpg_pm_resume);
+
 static const struct of_device_id xtpg_of_id_table[] = {
 	{ .compatible = "xlnx,axi-tpg-5.0" },
 	{ }
@@ -643,6 +667,7 @@ static struct platform_driver xtpg_driver = {
 	.driver			= {
 		.owner		= THIS_MODULE,
 		.name		= "xilinx-axi-tpg",
+		.pm		= &xtpg_pm_ops,
 		.of_match_table	= of_match_ptr(xtpg_of_id_table),
 	},
 	.probe			= xtpg_probe,
-- 
2.9.3

