From 9e63ebf7c2559e7eaeadab59f8e5f8156ff74226 Mon Sep 17 00:00:00 2001
From: Zumeng Chen <zumeng.chen@windriver.com>
Date: Wed, 28 Sep 2016 15:43:17 +0800
Subject: [PATCH 815/827] media: xilinx: fix compiling warnings and add default

  CC      drivers/media/platform/xilinx/xilinx-tpg.o
In file included from include/linux/scatterlist.h:10:0,
                 from include/linux/spi/spi.h:23,
                 from include/media/v4l2-common.h:136,
                 from include/media/v4l2-subdev.h:28,
                 from drivers/media/platform/xilinx/xilinx-tpg.c:24:
drivers/media/platform/xilinx/xilinx-tpg.c: In function 'xtpg_s_stream':
./arch/arm64/include/asm/io.h:55:2: warning: 'fmt' may be used uninitialized in this function [-Wmaybe-uninitialized]
  asm volatile("str %w0, [%1]" : : "r" (val), "r" (addr));
  ^
drivers/media/platform/xilinx/xilinx-tpg.c:262:7: note: 'fmt' was declared here
   u32 fmt;

Signed-off-by: Zumeng Chen <zumeng.chen@windriver.com>
---
 drivers/media/platform/xilinx/xilinx-tpg.c | 6 +++++-
 1 file changed, 5 insertions(+), 1 deletion(-)

diff --git a/drivers/media/platform/xilinx/xilinx-tpg.c b/drivers/media/platform/xilinx/xilinx-tpg.c
index a9216e8..33a21b3 100644
--- a/drivers/media/platform/xilinx/xilinx-tpg.c
+++ b/drivers/media/platform/xilinx/xilinx-tpg.c
@@ -75,6 +75,7 @@
 #define XTPG_HLS_COLOR_FORMAT_YUV_444		1
 #define XTPG_HLS_COLOR_FORMAT_YUV_422		2
 #define XTPG_HLS_COLOR_FORMAT_YUV_420		3
+#define XTPG_HLS_COLOR_FORMAT_YUV_INVALID	0xffff
 #define XTPG_HLS_CROSS_HAIR_HOR			0x0048
 #define XTPG_HLS_CROSS_HAIR_VER			0x0050
 #define XTPG_HLS_ZPLATE_HOR_CNTL_START		0x0058
@@ -259,7 +260,7 @@ static int xtpg_s_stream(struct v4l2_subdev *subdev, int enable)
 	}
 
 	if (xtpg->is_hls) {
-		u32 fmt;
+		u32 fmt = XTPG_HLS_COLOR_FORMAT_YUV_INVALID;
 
 		switch (xtpg->vip_format->code) {
 		case MEDIA_BUS_FMT_UYVY8_1X16:
@@ -271,6 +272,9 @@ static int xtpg_s_stream(struct v4l2_subdev *subdev, int enable)
 		case MEDIA_BUS_FMT_RBG888_1X24:
 			fmt = XTPG_HLS_COLOR_FORMAT_RGB;
 			break;
+		default:
+			if (WARN_ON(fmt == XTPG_HLS_COLOR_FORMAT_YUV_INVALID))
+				pr_err("Invalid color format set for xtpg\n");
 		}
 		xvip_write(&xtpg->xvip, XTPG_HLS_COLOR_FORMAT, fmt);
 		xvip_write(&xtpg->xvip, XHLS_REG_COLS, width);
-- 
2.9.3

