From 895eec779678a4419923c73ae8b2b071d4a7e129 Mon Sep 17 00:00:00 2001
From: Hyun Kwon <hyun.kwon@xilinx.com>
Date: Fri, 22 Nov 2013 10:10:21 -0800
Subject: [PATCH 411/827] drm: xilinx: Merge 3.12 and fix conflicts

This patch comes from:
  https://github.com/Xilinx/linux-xlnx.git

Merge 3.12 and fix conflicts. Fix the prototype of
xilinx_drm_crtc_page_flip(), remove deprecated function call(drm_fasync),
change drm_gem_cma_dumb_destroy() with drm_gem_dumb_destroy(), and
remove #include <linux/of_i2c.h>.

Signed-off-by: Hyun Kwon <hyunk@xilinx.com>
Signed-off-by: Michal Simek <michal.simek@xilinx.com>
(cherry picked from commit 5b81176ffefc41ef6360fcf86c1bc04b0ad4a13d)
Signed-off-by: Zumeng Chen <zumeng.chen@windriver.com>
---
 drivers/gpu/drm/xilinx/xilinx_drm_crtc.c    | 3 ++-
 drivers/gpu/drm/xilinx/xilinx_drm_drv.c     | 3 +--
 drivers/gpu/drm/xilinx/xilinx_drm_encoder.c | 1 -
 3 files changed, 3 insertions(+), 4 deletions(-)

diff --git a/drivers/gpu/drm/xilinx/xilinx_drm_crtc.c b/drivers/gpu/drm/xilinx/xilinx_drm_crtc.c
index 9668c78..3f6a523 100644
--- a/drivers/gpu/drm/xilinx/xilinx_drm_crtc.c
+++ b/drivers/gpu/drm/xilinx/xilinx_drm_crtc.c
@@ -281,7 +281,8 @@ static void xilinx_drm_crtc_finish_page_flip(struct drm_crtc *base_crtc)
 /* page flip functions */
 static int xilinx_drm_crtc_page_flip(struct drm_crtc *base_crtc,
 				     struct drm_framebuffer *fb,
-				     struct drm_pending_vblank_event *event)
+				     struct drm_pending_vblank_event *event,
+				     uint32_t page_flip_flags)
 {
 	struct xilinx_drm_crtc *crtc = to_xilinx_crtc(base_crtc);
 	struct drm_device *drm = base_crtc->dev;
diff --git a/drivers/gpu/drm/xilinx/xilinx_drm_drv.c b/drivers/gpu/drm/xilinx/xilinx_drm_drv.c
index 650d463..6b46030 100644
--- a/drivers/gpu/drm/xilinx/xilinx_drm_drv.c
+++ b/drivers/gpu/drm/xilinx/xilinx_drm_drv.c
@@ -299,7 +299,6 @@ static const struct file_operations xilinx_drm_fops = {
 	.unlocked_ioctl	= drm_ioctl,
 	.mmap		= drm_gem_cma_mmap,
 	.poll		= drm_poll,
-	.fasync		= drm_fasync,
 	.read		= drm_read,
 #ifdef CONFIG_COMPAT
 	.compat_ioctl	= drm_compat_ioctl,
@@ -332,7 +331,7 @@ static struct drm_driver xilinx_drm_driver = {
 	.gem_vm_ops			= &drm_gem_cma_vm_ops,
 	.dumb_create			= drm_gem_cma_dumb_create,
 	.dumb_map_offset		= drm_gem_cma_dumb_map_offset,
-	.dumb_destroy			= drm_gem_cma_dumb_destroy,
+	.dumb_destroy			= drm_gem_dumb_destroy,
 
 	.fops				= &xilinx_drm_fops,
 
diff --git a/drivers/gpu/drm/xilinx/xilinx_drm_encoder.c b/drivers/gpu/drm/xilinx/xilinx_drm_encoder.c
index e02e652..846c87b 100644
--- a/drivers/gpu/drm/xilinx/xilinx_drm_encoder.c
+++ b/drivers/gpu/drm/xilinx/xilinx_drm_encoder.c
@@ -25,7 +25,6 @@
 #include <linux/err.h>
 #include <linux/i2c.h>
 #include <linux/of.h>
-#include <linux/of_i2c.h>
 #include <linux/platform_device.h>
 
 #include "xilinx_drm_drv.h"
-- 
2.9.3

