From c95f6c4b8e8112229c6187d31d74a5c37a9975eb Mon Sep 17 00:00:00 2001
From: Hyun Kwon <hyunk@xilinx.com>
Date: Fri, 4 Oct 2013 14:39:58 -0700
Subject: [PATCH 396/827] drm: xilinx: plane: Check framebuffer format with plane format

This patch comes from:
  https://github.com/Xilinx/linux-xlnx.git

In xilinx_drm_plane_mode_set(), check the framebuffer format
with the plane format before setting the plane with the framebuffer.

Signed-off-by: Hyun Kwon <hyunk@xilinx.com>
Acked-by: Michal Simek <michal.simek@xilinx.com>
(cherry picked from commit 842f7afa3940555f366f5b0e4b3372213318a9f4)
Signed-off-by: Zumeng Chen <zumeng.chen@windriver.com>
---
 drivers/gpu/drm/xilinx/xilinx_drm_plane.c | 5 +++++
 1 file changed, 5 insertions(+)

diff --git a/drivers/gpu/drm/xilinx/xilinx_drm_plane.c b/drivers/gpu/drm/xilinx/xilinx_drm_plane.c
index db91f78..e1c598f 100644
--- a/drivers/gpu/drm/xilinx/xilinx_drm_plane.c
+++ b/drivers/gpu/drm/xilinx/xilinx_drm_plane.c
@@ -199,6 +199,11 @@ int xilinx_drm_plane_mode_set(struct drm_plane *base_plane,
 
 	DRM_DEBUG_KMS("plane->id: %d\n", plane->id);
 
+	if (fb->pixel_format != plane->format) {
+		DRM_ERROR("unsupported pixel format %08x\n", fb->pixel_format);
+		return -EINVAL;
+	}
+
 	obj = drm_fb_cma_get_gem_obj(fb, 0);
 	if (!obj) {
 		DRM_ERROR("failed to get a gem obj for fb\n");
-- 
2.9.3

