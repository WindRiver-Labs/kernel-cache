From 1cba0db4dfffc6ab430b60e09f6368c1eb6188c7 Mon Sep 17 00:00:00 2001
From: Zumeng Chen <zumeng.chen@windriver.com>
Date: Tue, 29 Nov 2016 15:21:05 +0800
Subject: [PATCH 846/846] net: macb: break out when ctrl null

ctrl might be null after having done a reset on RX ZynqMP while addr used bit
is only set by software, so null ctrl should be used here to break out.  Even
if not ZynqMP, ctrl should never be null if there is rx buffer used, so it's
safe for all.

Signed-off-by: Zumeng Chen <zumeng.chen@windriver.com>
---
 drivers/net/ethernet/cadence/macb.c | 3 +--
 1 file changed, 1 insertion(+), 2 deletions(-)

diff --git a/drivers/net/ethernet/cadence/macb.c b/drivers/net/ethernet/cadence/macb.c
index 8c76730..15de7d3 100644
--- a/drivers/net/ethernet/cadence/macb.c
+++ b/drivers/net/ethernet/cadence/macb.c
@@ -902,12 +902,11 @@ static int gem_rx(struct macb *bp, int budget)
 		addr = desc->addr;
 		ctrl = desc->ctrl;
 
-		if (!(addr & MACB_BIT(RX_USED)))
+		if (!(addr & MACB_BIT(RX_USED)) || !ctrl)
 			break;
 
 		bp->rx_tail++;
 		count++;
-
 		if (!(ctrl & MACB_BIT(RX_SOF) && ctrl & MACB_BIT(RX_EOF))) {
 			netdev_err(bp->dev,
 				   "not whole frame pointed by descriptor\n");
-- 
2.9.3

