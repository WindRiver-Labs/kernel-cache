From 8efd9645f6c2182e2f20847775fc205e40e7cfd1 Mon Sep 17 00:00:00 2001
From: Zumeng Chen <zumeng.chen@windriver.com>
Date: Sat, 24 Sep 2016 14:37:49 +0800
Subject: [PATCH 087/827] soc: zynqmp: Compile pm.c always for zynqmp

This patch comes from:
  https://github.com/Xilinx/linux-xlnx.git

commit dcac33d85d5dd383dbf02d1b92f2e2f46ac929b7

The pm.c is actually the plat support.
All the secure transaction go through it.
The clocks, power domains and reset need it so
lets compile it always for zynqmp.

Also remove the ZYNQMP_PM_API dependency for reset controller.

Signed-off-by: Shubhrajyoti Datta <shubhrajyoti.datta@xilinx.com>
Acked-by: SÃ¶ren Brinkmann <soren.brinkmann@xilinx.com>
Signed-off-by: Michal Simek <michal.simek@xilinx.com>
Signed-off-by: Zumeng Chen <zumeng.chen@windriver.com>
---
 drivers/reset/Kconfig              | 1 -
 drivers/soc/xilinx/Kconfig         | 8 --------
 drivers/soc/xilinx/zynqmp/Makefile | 2 +-
 3 files changed, 1 insertion(+), 10 deletions(-)

diff --git a/drivers/reset/Kconfig b/drivers/reset/Kconfig
index 3a5fd10..b73948d 100644
--- a/drivers/reset/Kconfig
+++ b/drivers/reset/Kconfig
@@ -16,7 +16,6 @@ if RESET_CONTROLLER
 
 config ZYNQMP_RESET_CONTROLLER
 	bool "Xilinx ZYNQMP Reset Controller Support"
-	depends on ZYNQMP_PM_API
         help
 	 ZYNQMP Reset Controller support.
 
diff --git a/drivers/soc/xilinx/Kconfig b/drivers/soc/xilinx/Kconfig
index 2c6f44e..ea09eb2 100644
--- a/drivers/soc/xilinx/Kconfig
+++ b/drivers/soc/xilinx/Kconfig
@@ -7,15 +7,8 @@ menuconfig SOC_XILINX_ZYNQMP
 
 if SOC_XILINX_ZYNQMP
 
-config ZYNQMP_PM_API
-	bool "Enable Xilinx Zynq MPSoC Power Management API platform driver"
-	help
-	  Say yes to enable power domain management through API
-	  In doubt, say N
-
 config ZYNQMP_PM_API_DEBUGFS
 	bool "Enable Xilinx Zynq MPSoC Power Management API debugfs functionality"
-	depends on ZYNQMP_PM_API
 	depends on DEBUG_FS
 	help
 	  Say yes to enable power domain management API requests through debugfs
@@ -24,7 +17,6 @@ config ZYNQMP_PM_API_DEBUGFS
 config ZYNQMP_PM_DOMAINS
 	bool "Enable Zynq MPSoC generic PM domains"
 	default y
-	depends on ZYNQMP_PM_API
 	depends on PM
 	select PM_GENERIC_DOMAINS
 	help
diff --git a/drivers/soc/xilinx/zynqmp/Makefile b/drivers/soc/xilinx/zynqmp/Makefile
index b7ac33d..219047c 100644
--- a/drivers/soc/xilinx/zynqmp/Makefile
+++ b/drivers/soc/xilinx/zynqmp/Makefile
@@ -1,2 +1,2 @@
-obj-$(CONFIG_ZYNQMP_PM_API) += pm.o
+obj-$(CONFIG_ARCH_ZYNQMP) += pm.o
 obj-$(CONFIG_ZYNQMP_PM_DOMAINS) += pm_domains.o
-- 
2.9.3

