From 0fdfc77e4b151a25f820a86e7d071fa1ab6b274c Mon Sep 17 00:00:00 2001
From: Soren Brinkmann <soren.brinkmann@xilinx.com>
Date: Tue, 6 Jan 2015 08:15:09 -0800
Subject: [PATCH 068/827] zynqmp: Add suspend support

This patch comes from:
  https://github.com/Xilinx/linux-xlnx.git

Minimal implementation of suspend ops. Not really functional, but basic
suspend paths should be exercisible.

Signed-off-by: Soren Brinkmann <soren.brinkmann@xilinx.com>
Signed-off-by: Michal Simek <michal.simek@xilinx.com>
(cherry picked from commit 334cf538fba05f2b831391d7c1d01f07080778e4)

Conflicts:
	drivers/soc/Makefile
Signed-off-by: Zumeng Chen <zumeng.chen@windriver.com>
---
 drivers/soc/Makefile               |  1 +
 drivers/soc/xilinx/zynqmp/Makefile |  1 +
 drivers/soc/xilinx/zynqmp/pm.c     | 50 ++++++++++++++++++++++++++++++++++++++
 3 files changed, 52 insertions(+)
 create mode 100644 drivers/soc/xilinx/zynqmp/Makefile
 create mode 100644 drivers/soc/xilinx/zynqmp/pm.c

diff --git a/drivers/soc/Makefile b/drivers/soc/Makefile
index 70042b2..374c080 100644
--- a/drivers/soc/Makefile
+++ b/drivers/soc/Makefile
@@ -5,5 +5,6 @@
 obj-$(CONFIG_ARCH_MEDIATEK)	+= mediatek/
 obj-$(CONFIG_ARCH_QCOM)		+= qcom/
 obj-$(CONFIG_ARCH_TEGRA)	+= tegra/
+obj-$(CONFIG_ARCH_ZYNQMP)	+= xilinx/zynqmp/
 obj-$(CONFIG_SOC_TI)		+= ti/
 obj-$(CONFIG_PLAT_VERSATILE)	+= versatile/
diff --git a/drivers/soc/xilinx/zynqmp/Makefile b/drivers/soc/xilinx/zynqmp/Makefile
new file mode 100644
index 0000000..ff5cec8
--- /dev/null
+++ b/drivers/soc/xilinx/zynqmp/Makefile
@@ -0,0 +1 @@
+obj-$(CONFIG_SUSPEND)	+= pm.o
diff --git a/drivers/soc/xilinx/zynqmp/pm.c b/drivers/soc/xilinx/zynqmp/pm.c
new file mode 100644
index 0000000..8144e86
--- /dev/null
+++ b/drivers/soc/xilinx/zynqmp/pm.c
@@ -0,0 +1,50 @@
+/*
+ * Suspend support for ZynqMP
+ *
+ *  Copyright (C) 2015 Xilinx
+ *
+ *  SÃ¶ren Brinkmann <soren.brinkmann@xilinx.com>
+ *
+ * This program is free software: you can redistribute it and/or modify
+ * it under the terms of the GNU General Public License as published by
+ * the Free Software Foundation, either version 2 of the License, or
+ * (at your option) any later version.
+ *
+ * This program is distributed in the hope that it will be useful,
+ * but WITHOUT ANY WARRANTY; without even the implied warranty of
+ * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
+ * GNU General Public License for more details.
+ *
+ * You should have received a copy of the GNU General Public License
+ * along with this program.  If not, see <http://www.gnu.org/licenses/>.
+ */
+
+#include <linux/suspend.h>
+#include <asm/suspend.h>
+
+static int zynqmp_pm_enter(suspend_state_t suspend_state)
+{
+	switch (suspend_state) {
+	case PM_SUSPEND_STANDBY:
+	case PM_SUSPEND_MEM:
+		cpu_suspend(0);
+		break;
+	default:
+		return -EINVAL;
+	}
+
+	return 0;
+}
+
+static const struct platform_suspend_ops zynqmp_pm_ops = {
+	.enter		= zynqmp_pm_enter,
+	.valid		= suspend_valid_only_mem,
+};
+
+int __init zynqmp_pm_late_init(void)
+{
+	suspend_set_ops(&zynqmp_pm_ops);
+
+	return 0;
+}
+late_initcall(zynqmp_pm_late_init);
-- 
2.9.3

