From 75ef31d1ec198860e94a192c8aa538f9bed973e9 Mon Sep 17 00:00:00 2001
From: Hyun Kwon <hyun.kwon@xilinx.com>
Date: Tue, 18 Mar 2014 09:18:40 -0700
Subject: [PATCH 484/827] media: xilinx: tpg: Reset in probe()

This patch comes from:
  https://github.com/Xilinx/linux-xlnx.git

Reset the core in probe() to reinitialize registers. This avoids
inconsistency of default/initial values when the driver is reloaded.

Signed-off-by: Hyun Kwon <hyun.kwon@xilinx.com>
Acked-by: Laurent Pinchart <laurent.pinchart@ideasonboard.com>
Signed-off-by: Michal Simek <michal.simek@xilinx.com>
(cherry picked from commit 6abe5929929b6318598fd73f515a2ed7281b2d49)
Signed-off-by: Zumeng Chen <zumeng.chen@windriver.com>
---
 drivers/media/platform/xilinx/xilinx-tpg.c | 3 +++
 1 file changed, 3 insertions(+)

diff --git a/drivers/media/platform/xilinx/xilinx-tpg.c b/drivers/media/platform/xilinx/xilinx-tpg.c
index b447fc2..0e5f86a 100644
--- a/drivers/media/platform/xilinx/xilinx-tpg.c
+++ b/drivers/media/platform/xilinx/xilinx-tpg.c
@@ -283,6 +283,9 @@ static int xtpg_probe(struct platform_device *pdev)
 	if (xtpg->xvip.iomem == NULL)
 		return -ENODEV;
 
+	/* Reset and initialize the core */
+	xvip_reset(&xtpg->xvip);
+
 	/* Initialize V4L2 subdevice and media entity */
 	subdev = &xtpg->xvip.subdev;
 	v4l2_subdev_init(subdev, &xtpg_ops);
-- 
2.9.3

