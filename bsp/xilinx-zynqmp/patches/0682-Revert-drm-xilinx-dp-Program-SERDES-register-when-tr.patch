From 45dece3a754505859404ba1d3c005f08533270e0 Mon Sep 17 00:00:00 2001
From: Anurag Kumar Vulisha <anurag.kumar.vulisha@xilinx.com>
Date: Tue, 17 May 2016 16:49:07 +0530
Subject: [PATCH 682/827] Revert "drm: xilinx: dp: Program SERDES register when training"

This patch comes from:
  https://github.com/Xilinx/linux-xlnx.git

This reverts commit a06b1a4444e6304039c32d08562554b260f5904a.

Since we are using serdes driver, so no need to program serdes
for DP link training.

Signed-off-by: Anurag Kumar Vulisha <anuragku@xilinx.com>
Tested-by: Hyun Kwon <hyunk@xilinx.com
Signed-off-by: Michal Simek <michal.simek@xilinx.com>
(cherry picked from commit e144f4edaffd6f6d7468a52d9d1eb1f667578ea7)
Signed-off-by: Zumeng Chen <zumeng.chen@windriver.com>
---
 drivers/gpu/drm/xilinx/xilinx_drm_dp.c | 34 ----------------------------------
 1 file changed, 34 deletions(-)

diff --git a/drivers/gpu/drm/xilinx/xilinx_drm_dp.c b/drivers/gpu/drm/xilinx/xilinx_drm_dp.c
index 0381e9d..0558473 100644
--- a/drivers/gpu/drm/xilinx/xilinx_drm_dp.c
+++ b/drivers/gpu/drm/xilinx/xilinx_drm_dp.c
@@ -230,14 +230,6 @@
 #define DP_HIGH_BIT_RATE2				540000
 #define DP_MAX_TRAINING_TRIES				5
 
-/* FIXME: Program SERDES registers directly. This conflicts with the ZynqMP
- * PHY driver, and should be removed when there's the PHY driver
- * This is enabled by default, and can be disbled by bootarg.
- */
-static uint xilinx_drm_dp_gt_prog = 1;
-module_param_named(gt_prog, xilinx_drm_dp_gt_prog, uint, 0400);
-MODULE_PARM_DESC(gt_prog, "dp gt program: 0=dp only, 1=serdes only");
-
 enum dp_version {
 	DP_V1_1A = 0x11,
 	DP_V1_2 = 0x12
@@ -295,7 +287,6 @@ struct xilinx_drm_dp_config {
  * @encoder: pointer to the drm encoder structure
  * @dev: device structure
  * @iomem: device I/O memory for register access
- * @serdes: serdes I/O memory for register access
  * @config: IP core configuration from DTS
  * @aux: aux channel
  * @dp_sub: DisplayPort subsystem
@@ -311,7 +302,6 @@ struct xilinx_drm_dp {
 	struct drm_encoder *encoder;
 	struct device *dev;
 	void __iomem *iomem;
-	void __iomem *serdes;
 
 	struct xilinx_drm_dp_config config;
 	struct drm_dp_aux aux;
@@ -510,23 +500,6 @@ static int xilinx_drm_dp_update_vs_emph(struct xilinx_drm_dp *dp)
 	if (ret < 0)
 		return ret;
 
-	if (xilinx_drm_dp_gt_prog) {
-		for (i = 0; i < dp->mode.lane_cnt; i++) {
-			v_level = (train_set[i] &
-				   DP_TRAIN_VOLTAGE_SWING_MASK) >>
-				  DP_TRAIN_VOLTAGE_SWING_SHIFT;
-			p_level = (train_set[i] & DP_TRAIN_PRE_EMPHASIS_MASK) >>
-				  DP_TRAIN_PRE_EMPHASIS_SHIFT;
-
-			xilinx_drm_writel(dp->serdes, 0xcc0 + i * 0x4000,
-					  vs[p_level][v_level]);
-			xilinx_drm_writel(dp->serdes, 0x48 + i * 0x4000,
-					  pe[p_level][v_level]);
-		}
-
-		return 0;
-	}
-
 	for (i = 0; i < dp->mode.lane_cnt; i++) {
 		v_level = (train_set[i] & DP_TRAIN_VOLTAGE_SWING_MASK) >>
 			  DP_TRAIN_VOLTAGE_SWING_SHIFT;
@@ -1392,13 +1365,6 @@ static int xilinx_drm_dp_probe(struct platform_device *pdev)
 		goto error_dp_sub;
 	}
 
-	if (xilinx_drm_dp_gt_prog) {
-		res = platform_get_resource(pdev, IORESOURCE_MEM, 1);
-		dp->serdes = devm_ioremap_resource(dp->dev, res);
-		if (IS_ERR(dp->serdes))
-			dev_info(dp->dev, "serdes not mapped\n");
-	}
-
 	platform_set_drvdata(pdev, dp);
 
 	xilinx_drm_set(dp->iomem, XILINX_DP_TX_PHY_CONFIG,
-- 
2.9.3

