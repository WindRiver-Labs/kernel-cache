From 2ee4307e568f839c8ed3313805ec790153047ce6 Mon Sep 17 00:00:00 2001
From: Zumeng Chen <zumeng.chen@windriver.com>
Date: Wed, 28 Oct 2015 21:54:47 +0800
Subject: [PATCH 826/827] kgdboc, zynq: rx polling hook for the xilinx_uartps driver

The RX polling hook allows the debugger to hook character input so
as to allow entry to the kernel debugger with a control-c as an
example.

Signed-off-by: Zumeng Chen <zumeng.chen@windriver.com>
(cherry picked from commit 28d1d3d1ec205b59de85c2d5853059347b25fe28)
---
 drivers/tty/serial/xilinx_uartps.c | 4 ++++
 1 file changed, 4 insertions(+)

diff --git a/drivers/tty/serial/xilinx_uartps.c b/drivers/tty/serial/xilinx_uartps.c
index 6f0676b..2ca89ed 100644
--- a/drivers/tty/serial/xilinx_uartps.c
+++ b/drivers/tty/serial/xilinx_uartps.c
@@ -289,6 +289,10 @@ static void cdns_uart_handle_rx(void *dev_id, unsigned int isrstatus)
 				continue;
 		}
 
+#ifdef CONFIG_CONSOLE_POLL
+			if (port->poll_rx_cb && port->poll_rx_cb((unsigned char)data))
+				continue;
+#endif
 #ifdef SUPPORT_SYSRQ
 		/*
 		 * uart_handle_sysrq_char() doesn't work if
-- 
2.9.3

