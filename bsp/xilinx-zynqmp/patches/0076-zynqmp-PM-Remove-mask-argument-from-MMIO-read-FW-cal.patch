From 5043b6194d5ff86ad991a5231652d2feac6845ea Mon Sep 17 00:00:00 2001
From: Soren Brinkmann <soren.brinkmann@xilinx.com>
Date: Mon, 14 Sep 2015 21:06:14 -0700
Subject: [PATCH 076/827] zynqmp: PM: Remove 'mask' argument from MMIO read FW call

This patch comes from:
  https://github.com/Xilinx/linux-xlnx.git

Signed-off-by: Soren Brinkmann <soren.brinkmann@xilinx.com>
Signed-off-by: Michal Simek <michal.simek@xilinx.com>
(cherry picked from commit 73a35e035ad512ddab911d3c5cb199811ce116e1)
Signed-off-by: Zumeng Chen <zumeng.chen@windriver.com>
---
 drivers/soc/xilinx/zynqmp/pm.c       | 16 ++++++----------
 include/linux/soc/xilinx/zynqmp/pm.h |  4 +---
 2 files changed, 7 insertions(+), 13 deletions(-)

diff --git a/drivers/soc/xilinx/zynqmp/pm.c b/drivers/soc/xilinx/zynqmp/pm.c
index c1fe608..84c046e 100644
--- a/drivers/soc/xilinx/zynqmp/pm.c
+++ b/drivers/soc/xilinx/zynqmp/pm.c
@@ -552,7 +552,6 @@ EXPORT_SYMBOL_GPL(zynqmp_pm_mmio_write);
 /**
  * zynqmp_pm_mmio_read - Read value from protected mmio
  * @address:	Address to write to
- * @mask:	Mask to apply
  * @value:	Value to read
  *
  * This function provides access to PM-related control registers
@@ -560,16 +559,14 @@ EXPORT_SYMBOL_GPL(zynqmp_pm_mmio_write);
  *
  * Return:	Returns status, either success or error+reason
  */
-int zynqmp_pm_mmio_read(const u32 address,
-				    const u32 mask,
-				    u32 *value)
+int zynqmp_pm_mmio_read(const u32 address, u32 *value)
 {
 	u32 ret_payload[PAYLOAD_ARG_CNT];
 
-	if (value == NULL)
-		return zynqmp_pm_ret_code(XST_PM_CONFLICT);
+	if (!value)
+		return -EINVAL;
 
-	invoke_pm_fn(MMIO_READ, address, mask, 0, 0, ret_payload);
+	invoke_pm_fn(MMIO_READ, address, 0, 0, 0, ret_payload);
 	*value = ret_payload[1];
 
 	return zynqmp_pm_ret_code((enum pm_ret_status)ret_payload[0]);
@@ -787,9 +784,8 @@ static ssize_t zynqmp_pm_debugfs_api_write(struct file *file,
 		pr_info("%s Reset status: %u\n", __func__, pm_api_arg[1]);
 		break;
 	case MMIO_READ:
-		ret = zynqmp_pm_mmio_read(pm_api_arg[0],
-				     pm_api_arg[1], &pm_api_arg[2]);
-		pr_info("%s MMIO value: %#x\n", __func__, pm_api_arg[2]);
+		ret = zynqmp_pm_mmio_read(pm_api_arg[0], &pm_api_arg[1]);
+		pr_info("%s MMIO value: %#x\n", __func__, pm_api_arg[1]);
 		break;
 	case MMIO_WRITE:
 		ret = zynqmp_pm_mmio_write(pm_api_arg[0],
diff --git a/include/linux/soc/xilinx/zynqmp/pm.h b/include/linux/soc/xilinx/zynqmp/pm.h
index 41c3c1d..3f9863e 100644
--- a/include/linux/soc/xilinx/zynqmp/pm.h
+++ b/include/linux/soc/xilinx/zynqmp/pm.h
@@ -117,8 +117,6 @@ int zynqmp_pm_reset_get_status(const u32 reset,
 int zynqmp_pm_mmio_write(const u32 address,
 				     const u32 mask,
 				     const u32 value);
-int zynqmp_pm_mmio_read(const u32 address,
-				    const u32 mask,
-				    u32 *value);
+int zynqmp_pm_mmio_read(const u32 address, u32 *value);
 
 #endif /* __SOC_ZYNQMP_PM_H__ */
-- 
2.9.3

