From df35796c76fc01701df84ab7067874f58a364b03 Mon Sep 17 00:00:00 2001
From: Hyun Kwon <[hyun.kwon@xilinx.com]>
Date: Thu, 11 Dec 2014 14:32:34 -0800
Subject: [PATCH 598/827] drm: xilinx: encoder: Check device->driver pointer for i2c encoder slave

This patch comes from:
  https://github.com/Xilinx/linux-xlnx.git

When probe is deferred in i2c device driver, device->driver is set to
NULL. So check if the device->driver pointer is NULL before accessing
the i2c encoder slave driver.

Reported-by: Rob Armstrong JR <ra@xilinx.com>
Signed-off-by: Hyun Kwon <hyun.kwon@xilinx.com>
Tested-by: Rob Armstrong JR <ra@xilinx.com>
(cherry picked from commit 3425217a0867867f47f3eb23eada84c2729a9252)
Signed-off-by: Zumeng Chen <zumeng.chen@windriver.com>
---
 drivers/gpu/drm/xilinx/xilinx_drm_encoder.c | 2 +-
 1 file changed, 1 insertion(+), 1 deletion(-)

diff --git a/drivers/gpu/drm/xilinx/xilinx_drm_encoder.c b/drivers/gpu/drm/xilinx/xilinx_drm_encoder.c
index 5ab0a14..df348bd 100644
--- a/drivers/gpu/drm/xilinx/xilinx_drm_encoder.c
+++ b/drivers/gpu/drm/xilinx/xilinx_drm_encoder.c
@@ -190,7 +190,7 @@ struct drm_encoder *xilinx_drm_encoder_create(struct drm_device *drm)
 
 	/* initialize slave encoder */
 	encoder->i2c_slv = of_find_i2c_device_by_node(sub_node);
-	if (encoder->i2c_slv) {
+	if (encoder->i2c_slv && encoder->i2c_slv->dev.driver) {
 		i2c_driver = to_i2c_driver(encoder->i2c_slv->dev.driver);
 		drm_i2c_driver = to_drm_i2c_encoder_driver(i2c_driver);
 		if (!drm_i2c_driver) {
-- 
2.9.3

