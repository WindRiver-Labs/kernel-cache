From dd693ecef151865344f09e7a706d13a7ab8f4a20 Mon Sep 17 00:00:00 2001
From: Harini Katakam <harini.katakam@xilinx.com>
Date: Wed, 9 Mar 2016 12:36:18 +0530
Subject: [PATCH 809/827] net: macb: Enable PCS autonegotiation

This patch comes from:
  https://github.com/Xilinx/linux-xlnx.git

PCS autonegotiation should be enabled along with that of the PHY
for negotiation to happen.

Signed-off-by: Harini Katakam <harinik@xilinx.com>
Signed-off-by: Michal Simek <michal.simek@xilinx.com>
(cherry picked from commit b6d176aa6ff80d65d3a01ced7f7b2dca9a927d82)
Signed-off-by: Zumeng Chen <zumeng.chen@windriver.com>
---
 drivers/net/ethernet/cadence/macb.c | 4 ++--
 1 file changed, 2 insertions(+), 2 deletions(-)

diff --git a/drivers/net/ethernet/cadence/macb.c b/drivers/net/ethernet/cadence/macb.c
index 625de80..ab1e392 100644
--- a/drivers/net/ethernet/cadence/macb.c
+++ b/drivers/net/ethernet/cadence/macb.c
@@ -2019,7 +2019,7 @@ static void macb_init_hw(struct macb *bp)
 	if ((bp->phy_interface == PHY_INTERFACE_MODE_SGMII) &&
 	    (bp->caps & MACB_CAPS_PCS))
 		gem_writel(bp, PCSCNTRL,
-			   gem_readl(bp, PCSCNTRL) & ~GEM_BIT(PCSAUTONEG));
+			   gem_readl(bp, PCSCNTRL) | GEM_BIT(PCSAUTONEG));
 
 	/* Enable TX and RX */
 	macb_writel(bp, NCR, MACB_BIT(RE) | MACB_BIT(TE) | MACB_BIT(MPE) |
@@ -2828,7 +2828,7 @@ static int macb_init(struct platform_device *pdev)
 	if ((bp->phy_interface == PHY_INTERFACE_MODE_SGMII) &&
 	    (bp->caps & MACB_CAPS_PCS))
 		gem_writel(bp, PCSCNTRL,
-			   gem_readl(bp, PCSCNTRL) & ~GEM_BIT(PCSAUTONEG));
+			   gem_readl(bp, PCSCNTRL) | GEM_BIT(PCSAUTONEG));
 
 	return 0;
 }
-- 
2.9.3

