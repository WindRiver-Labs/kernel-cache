From 3586ba88b9607510e56be53572a7120cd2ac7e0b Mon Sep 17 00:00:00 2001
From: Hyun Kwon <hyun.kwon@xilinx.com>
Date: Fri, 19 Aug 2016 16:07:26 -0700
Subject: [PATCH 696/827] drm: xilinx: drv: Enable universal plane for control client

This patch comes from:
  https://github.com/Xilinx/linux-xlnx.git

This allows control applications to access all layer.

Signed-off-by: Hyun Kwon <hyun.kwon@xilinx.com>
Signed-off-by: Michal Simek <michal.simek@xilinx.com>
(cherry picked from commit 95b08fc1a3b18797c55758a21d9e2d8011517541)
Signed-off-by: Zumeng Chen <zumeng.chen@windriver.com>
---
 drivers/gpu/drm/xilinx/xilinx_drm_drv.c | 9 +++++++++
 1 file changed, 9 insertions(+)

diff --git a/drivers/gpu/drm/xilinx/xilinx_drm_drv.c b/drivers/gpu/drm/xilinx/xilinx_drm_drv.c
index e415d80..cc78583 100644
--- a/drivers/gpu/drm/xilinx/xilinx_drm_drv.c
+++ b/drivers/gpu/drm/xilinx/xilinx_drm_drv.c
@@ -364,6 +364,14 @@ static int xilinx_drm_unload(struct drm_device *drm)
 	return 0;
 }
 
+int xilinx_drm_open(struct drm_device *dev, struct drm_file *file)
+{
+	if (drm_is_control_client(file))
+		file->universal_planes = 1;
+
+	return 0;
+}
+
 /* preclose */
 static void xilinx_drm_preclose(struct drm_device *drm, struct drm_file *file)
 {
@@ -402,6 +410,7 @@ static struct drm_driver xilinx_drm_driver = {
 					  DRIVER_PRIME,
 	.load				= xilinx_drm_load,
 	.unload				= xilinx_drm_unload,
+	.open				= xilinx_drm_open,
 	.preclose			= xilinx_drm_preclose,
 	.lastclose			= xilinx_drm_lastclose,
 	.set_busid			= drm_platform_set_busid,
-- 
2.9.3

