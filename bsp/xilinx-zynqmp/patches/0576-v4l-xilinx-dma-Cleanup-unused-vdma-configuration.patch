From 54962e09f5d101ed87bfa91df43888cfa450bd60 Mon Sep 17 00:00:00 2001
From: Radhey Shyam Pandey <radhey.shyam.pandey@xilinx.com>
Date: Tue, 18 Nov 2014 19:43:14 +0530
Subject: [PATCH 576/827] v4l: xilinx: dma: Cleanup unused vdma configuration.

This patch comes from:
  https://github.com/Xilinx/linux-xlnx.git

Remove DMA_SLAVE_CONFIG call as setting vdma channel params 'reset, park
and ext_fsync' is no longer required. However at a later point for
configuring any vdma channel param (i.e non-cyclic mode) we should use
xilinx_vdma_channel_set_config().

Signed-off-by: Radhey Shyam Pandey <radheys@xilinx.com>
Reviewed-by: Hyun Kwon <hyun.kwon@xilinx.com>
Signed-off-by: Laurent Pinchart <laurent.pinchart@ideasonboard.com>
(cherry picked from commit 348dd493c627d7d75ba1d011f3ce9475c04fcff1)
Signed-off-by: Zumeng Chen <zumeng.chen@windriver.com>
---
 drivers/media/platform/xilinx/xilinx-dma.c | 17 -----------------
 1 file changed, 17 deletions(-)

diff --git a/drivers/media/platform/xilinx/xilinx-dma.c b/drivers/media/platform/xilinx/xilinx-dma.c
index 0c18b0f..0b276a8 100644
--- a/drivers/media/platform/xilinx/xilinx-dma.c
+++ b/drivers/media/platform/xilinx/xilinx-dma.c
@@ -473,7 +473,6 @@ static void xvip_dma_stop_streaming(struct vb2_queue *vq)
 	struct xvip_dma *dma = vb2_get_drv_priv(vq);
 	struct xvip_pipeline *pipe = to_xvip_pipeline(&dma->video.entity);
 	struct xvip_dma_buffer *buf, *nbuf;
-	struct xilinx_vdma_config config;
 
 	/* Stop the pipeline. */
 	xvip_pipeline_set_stream(pipe, false);
@@ -481,11 +480,6 @@ static void xvip_dma_stop_streaming(struct vb2_queue *vq)
 	/* Stop and reset the DMA engine. */
 	dmaengine_device_control(dma->dma, DMA_TERMINATE_ALL, 0);
 
-	config.reset = 1;
-
-	dmaengine_device_control(dma->dma, DMA_SLAVE_CONFIG,
-				 (unsigned long)&config);
-
 	/* Cleanup the pipeline and mark it as being stopped. */
 	xvip_pipeline_cleanup(pipe);
 	media_entity_pipeline_stop(&dma->video.entity);
@@ -634,7 +628,6 @@ xvip_dma_set_format(struct file *file, void *fh, struct v4l2_format *format)
 	struct v4l2_fh *vfh = file->private_data;
 	struct xvip_dma *dma = to_xvip_dma(vfh->vdev);
 	const struct xvip_video_format *info;
-	struct xilinx_vdma_config config;
 
 	__xvip_dma_try_format(dma, &format->fmt.pix, &info);
 
@@ -644,16 +637,6 @@ xvip_dma_set_format(struct file *file, void *fh, struct v4l2_format *format)
 	dma->format = format->fmt.pix;
 	dma->fmtinfo = info;
 
-	/* Configure the DMA engine. */
-	memset(&config, 0, sizeof(config));
-
-	config.park = 1;
-	config.park_frm = 0;
-	config.ext_fsync = 2;
-
-	dmaengine_device_control(dma->dma, DMA_SLAVE_CONFIG,
-				 (unsigned long)&config);
-
 	return 0;
 }
 
-- 
2.9.3

