From b10bedc011ec7682fe736200c64194e66a0e1602 Mon Sep 17 00:00:00 2001
From: Zumeng Chen <zumeng.chen@windriver.com>
Date: Wed, 28 Sep 2016 10:59:29 +0800
Subject: [PATCH 100/827] zynqmp: PM: fix the big gaps due to the different base.

This patch comes from:
  https://github.com/Xilinx/linux-xlnx.git

This patch is to fix the gaps because of the different base on pm.c.

Signed-off-by: Zumeng Chen <zumeng.chen@windriver.com>
---
 drivers/soc/xilinx/zynqmp/pm.c | 36 +++++++++++++++++++++++++++++++++++-
 1 file changed, 35 insertions(+), 1 deletion(-)

diff --git a/drivers/soc/xilinx/zynqmp/pm.c b/drivers/soc/xilinx/zynqmp/pm.c
index 67f0507..2db1c33 100644
--- a/drivers/soc/xilinx/zynqmp/pm.c
+++ b/drivers/soc/xilinx/zynqmp/pm.c
@@ -963,12 +963,28 @@ static int zynqmp_pm_api_debugfs_init(void)
 	return err;
 }
 
+/**
+ * zynqmp_pm_api_debugfs_remove - Remove debugfs functionality
+ *
+ * Return:	Returns 0
+ */
+static int zynqmp_pm_api_debugfs_remove(void)
+{
+	debugfs_remove_recursive(zynqmp_pm_debugfs_dir);
+	zynqmp_pm_debugfs_dir = NULL;
+	return 0;
+}
+
 #else
 static int zynqmp_pm_api_debugfs_init(void)
 {
 	return 0;
 }
 
+static int zynqmp_pm_api_debugfs_remove(void)
+{
+	return 0;
+}
 #endif /* CONFIG_ZYNQMP_PM_API_DEBUGFS */
 
 static const struct of_device_id pm_of_match[] = {
@@ -1034,14 +1050,28 @@ static int zynqmp_pm_probe(struct platform_device *pdev)
 	return 0;
 }
 
+/**
+ * zynqmp_pm_remove - Remove debugfs interface
+ *
+ * @pdev:	Pointer to the platform_device structure
+ *
+ * Return:	Returns 0
+ */
+static int zynqmp_pm_remove(struct platform_device *pdev)
+{
+	zynqmp_pm_api_debugfs_remove();
+
+	return 0;
+}
+
 static struct platform_driver zynqmp_pm_platform_driver = {
 	.probe   = zynqmp_pm_probe,
+	.remove  = zynqmp_pm_remove,
 	.driver  = {
 			.name             = DRIVER_NAME,
 			.of_match_table   = pm_of_match,
 		   },
 };
-builtin_platform_driver(zynqmp_pm_platform_driver);
 
 static int __init zynqmp_plat_init(void)
 {
@@ -1077,3 +1107,7 @@ np_err:
 }
 
 early_initcall(zynqmp_plat_init);
+
+module_platform_driver(zynqmp_pm_platform_driver);
+MODULE_DESCRIPTION("Xilinx Zynq MPSoC Power Management API platform driver.");
+MODULE_LICENSE("GPL");
-- 
2.9.3

