From 037443778f6dcdb5b5d7c5cae7f9c58eed1d4a3d Mon Sep 17 00:00:00 2001
From: Hyun Kwon <hyun.kwon@xilinx.com>
Date: Tue, 18 Mar 2014 09:18:51 -0700
Subject: [PATCH 495/827] media: xilinx: tpg: Use xvip_stop()

This patch comes from:
  https://github.com/Xilinx/linux-xlnx.git

Use xvip_stop().

Signed-off-by: Hyun Kwon <hyunk@xilinx.com>
Acked-by: Laurent Pinchart <laurent.pinchart@ideasonboard.com>
Signed-off-by: Michal Simek <michal.simek@xilinx.com>
(cherry picked from commit 6537a9dcce9d06c2512bf23858be1d5e4c6982e6)
Signed-off-by: Zumeng Chen <zumeng.chen@windriver.com>
---
 drivers/media/platform/xilinx/xilinx-tpg.c | 8 +-------
 1 file changed, 1 insertion(+), 7 deletions(-)

diff --git a/drivers/media/platform/xilinx/xilinx-tpg.c b/drivers/media/platform/xilinx/xilinx-tpg.c
index cf5b206..4a2a0d8 100644
--- a/drivers/media/platform/xilinx/xilinx-tpg.c
+++ b/drivers/media/platform/xilinx/xilinx-tpg.c
@@ -130,13 +130,7 @@ static int xtpg_s_stream(struct v4l2_subdev *subdev, int enable)
 	const u32 height = xtpg->format.height;
 
 	if (!enable) {
-		/* Stopping the TPG without resetting it confuses the VDMA and
-		 * results in VDMA errors the next time the stream is started.
-		 * Reset the TPG when stopping the stream for now.
-		 */
-		xvip_write(&xtpg->xvip, XVIP_CTRL_CONTROL,
-			   XVIP_CTRL_CONTROL_SW_RESET);
-		xvip_write(&xtpg->xvip, XVIP_CTRL_CONTROL, 0);
+		xvip_stop(&xtpg->xvip);
 		return 0;
 	}
 
-- 
2.9.3

