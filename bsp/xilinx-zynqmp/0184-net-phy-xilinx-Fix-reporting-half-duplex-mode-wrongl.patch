From 05350985e1174e0952eadfa85771b224ab81565a Mon Sep 17 00:00:00 2001
From: Punnaiah Choudary Kalluri <punnaiah.choudary.kalluri@xilinx.com>
Date: Wed, 18 Nov 2015 09:21:16 +0530
Subject: [PATCH 184/188] net: phy: xilinx: Fix reporting half duplex mode
 wrongly

This patch comes from:
  https://github.com/Xilinx/linux-xlnx.git

Current driver masking the status register value with the speed
mask to get the duplex mode which is wrong and it overwrites the
full duplex status bit. This patch fixes the logic.

Signed-off-by: Punnaiah Choudary Kalluri <punnaia@xilinx.com>
Reviewed-by: Kedareswara rao Appana <appanad@xilinx.com>
(cherry picked from commit 73b5e6b3d759bf24b815cb1a296c1f304db5a5fd)
Signed-off-by: Zumeng Chen <zumeng.chen@windriver.com>
---
 drivers/net/phy/xilinx_phy.c | 3 +--
 1 file changed, 1 insertion(+), 2 deletions(-)

diff --git a/drivers/net/phy/xilinx_phy.c b/drivers/net/phy/xilinx_phy.c
index 2f864cc..0c817b5 100644
--- a/drivers/net/phy/xilinx_phy.c
+++ b/drivers/net/phy/xilinx_phy.c
@@ -43,14 +43,13 @@ static int xilinxphy_read_status(struct phy_device *phydev)
 
 	if (AUTONEG_ENABLE == phydev->autoneg) {
 		status = phy_read(phydev, MII_LPA);
-		status = status & MII_PHY_STATUS_SPD_MASK;
 
 		if (status & MII_PHY_STATUS_FULLDUPLEX)
 			phydev->duplex = DUPLEX_FULL;
 		else
 			phydev->duplex = DUPLEX_HALF;
 
-		switch (status) {
+		switch (status & MII_PHY_STATUS_SPD_MASK) {
 		case MII_PHY_STATUS_1000:
 			phydev->speed = SPEED_1000;
 			break;
-- 
2.0.2

