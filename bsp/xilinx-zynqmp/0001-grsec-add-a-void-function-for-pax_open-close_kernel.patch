From d9c153a590b14912b5b2f4135d6274e057fa86d9 Mon Sep 17 00:00:00 2001
From: Zumeng Chen <zumeng.chen@windriver.com>
Date: Mon, 11 Dec 2017 09:51:37 +0800
Subject: [PATCH 1/1] grsec: add a void function for pax_open/close_kernel

pax_open_kernel/pax_close_kernel are the dumb pair functions on arm,
so does arm64.

Signed-off-by: Zumeng Chen <zumeng.chen@windriver.com>
---
 arch/arm64/include/asm/pgtable.h | 6 ++++++
 grsecurity/gracl.c               | 2 +-
 2 files changed, 7 insertions(+), 1 deletion(-)

diff --git a/arch/arm64/include/asm/pgtable.h b/arch/arm64/include/asm/pgtable.h
index cf73194..77bd91b 100644
--- a/arch/arm64/include/asm/pgtable.h
+++ b/arch/arm64/include/asm/pgtable.h
@@ -21,6 +21,7 @@
 #include <asm/memory.h>
 #include <asm/pgtable-hwdef.h>
 
+
 /*
  * Software defined PTE bits definition.
  */
@@ -505,6 +506,11 @@ extern int kern_addr_valid(unsigned long addr);
 
 #define pgtable_cache_init() do { } while (0)
 
+#ifdef CONFIG_GRKERNSEC
+static inline unsigned long pax_open_kernel(void) { return 0; }
+static inline unsigned long pax_close_kernel(void) { return 0; }
+#endif
+
 #endif /* !__ASSEMBLY__ */
 
 #endif /* __ASM_PGTABLE_H */
diff --git a/grsecurity/gracl.c b/grsecurity/gracl.c
index 7573526..3b370f4 100644
--- a/grsecurity/gracl.c
+++ b/grsecurity/gracl.c
@@ -2450,7 +2450,7 @@ gr_handle_ptrace(struct task_struct *task, const long request)
 		case PTRACE_POKETEXT:
 		case PTRACE_POKEDATA:
 		case PTRACE_POKEUSR:
-#if !defined(CONFIG_PPC32) && !defined(CONFIG_PPC64) && !defined(CONFIG_PARISC) && !defined(CONFIG_ALPHA) && !defined(CONFIG_IA64)
+#if !defined(CONFIG_PPC32) && !defined(CONFIG_PPC64) && !defined(CONFIG_PARISC) && !defined(CONFIG_ALPHA) && !defined(CONFIG_IA64) && !defined(CONFIG_ARM64)
 		case PTRACE_SETREGS:
 		case PTRACE_SETFPREGS:
 #endif
-- 
2.9.3

