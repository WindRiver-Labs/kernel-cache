From cb7016d35614fc5d8e4e133b85a4bdc6e0edaf97 Mon Sep 17 00:00:00 2001
From: b16502 <naveenburmi@freescale.com>
Date: Thu, 20 Oct 2011 18:17:08 +0000
Subject: [PATCH 74/92] hetmgr: add default values of boot parameters

Extracted from 913x_WUSDK_REL_0.9.tar.gz vendor drop.

Below mentioned boot parameters will have following default value if they are not passed through command line.
  dsp_shared_size = 0x1000000,
  dsp_private_addr = 0x38000000,
  dsp_private_size = 0x8000000,
  shared_ctrl_addr = 0x37000000,
  shared_ctrl_size = 0x1000000.

Signed-off-by: Naveen Burmi <NaveenBurmi@freescale.com>
Integrated-by: Jiang Bin <bin.jiang@windriver.com>
---
 drivers/misc/fsl_psc913x_hetmgr.c |   38 +++++++++++++++++++++++++++++++++++++
 1 files changed, 38 insertions(+), 0 deletions(-)

diff --git a/drivers/misc/fsl_psc913x_hetmgr.c b/drivers/misc/fsl_psc913x_hetmgr.c
index 911def4..27fc1f2 100644
--- a/drivers/misc/fsl_psc913x_hetmgr.c
+++ b/drivers/misc/fsl_psc913x_hetmgr.c
@@ -44,6 +44,13 @@
 #define DSP_CORE0_M2	0xb0000000
 #define DSP_CORE0_M2_SZ	(512*1024)
 #define HW_SEM_OFFSET	0x17100
+
+#define	DSP_SHARED_SZ			0x1000000
+#define	SHARED_CTRL_AREA_START_ADDR	0x37000000
+#define	SHARED_CTRL_AREA_SZ		0x1000000
+#define	DSP_PVT_START_ADDR		0x38000000
+#define	DSP_PVT_SZ			0x8000000
+
 #define  SETUP_BOOTARG(A) 	\
 		static char *A; \
 		static long get_##A(void)\
@@ -203,6 +210,11 @@ int get_het_sys_map(sys_map_t *sysmap)
 {
 	/* GETBA(sysmap->pa_shared_size,get_pa_shared_size()); */
 	GETBA(sysmap->dsp_shared_size, get_dsp_shared_size());
+	if (sysmap->dsp_shared_size == 0xffffffff) {
+		printk(KERN_WARNING "Boot Parameter dsp_shared_size is not set"
+		       ". Setting it to default value: %#x\n", DSP_SHARED_SZ);
+		sysmap->dsp_shared_size = DSP_SHARED_SZ;
+	}
 
 	sysmap->pa_ccsrbar.phys_addr = PA_CCSRBAR;
 	sysmap->pa_ccsrbar.size = PA_CCSR_SZ;
@@ -212,10 +224,36 @@ int get_het_sys_map(sys_map_t *sysmap)
 
 	GETBA(sysmap->smart_dsp_os_priv_area.phys_addr,
 					 get_dsp_private_addr());
+	if (sysmap->smart_dsp_os_priv_area.phys_addr == 0xffffffff) {
+		printk(KERN_WARNING "Boot Parameter dsp_private_addr is not "
+		       "set. Setting it to default value: %#x\n",
+			DSP_PVT_START_ADDR);
+		sysmap->smart_dsp_os_priv_area.phys_addr = DSP_PVT_START_ADDR;
+	}
+
 	GETBA(sysmap->smart_dsp_os_priv_area.size, get_dsp_private_size());
+	if (sysmap->smart_dsp_os_priv_area.size == 0xffffffff) {
+		printk(KERN_WARNING "Boot Parameter dsp_private_size is not"
+		       "set. Setting it to default value: %#x\n",
+			DSP_PVT_SZ);
+		sysmap->smart_dsp_os_priv_area.size = DSP_PVT_SZ;
+	}
 
 	GETBA(sysmap->sh_ctrl_area.phys_addr, get_shared_ctrl_addr());
+	if (sysmap->sh_ctrl_area.phys_addr == 0xffffffff) {
+		printk(KERN_WARNING "Boot Parameter shared_ctrl_addr is not"
+		       "set. Setting it to default value: %#x\n",
+			SHARED_CTRL_AREA_START_ADDR);
+		sysmap->sh_ctrl_area.phys_addr = SHARED_CTRL_AREA_START_ADDR;
+	}
+
 	GETBA(sysmap->sh_ctrl_area.size, get_shared_ctrl_size());
+	if (sysmap->sh_ctrl_area.size == 0xffffffff) {
+		printk(KERN_WARNING "Boot Parameter shared_ctrl_size is not"
+		       "set. Setting it to default value: %#x\n",
+			SHARED_CTRL_AREA_SZ);
+		sysmap->sh_ctrl_area.size = SHARED_CTRL_AREA_SZ;
+	}
 
 	sysmap->dsp_core0_m2.phys_addr = DSP_CORE0_M2;
 	sysmap->dsp_core0_m2.size = DSP_CORE0_M2_SZ;
-- 
1.7.0

