From d4fd8434b8398692c2885fad9289e504c2a084f4 Mon Sep 17 00:00:00 2001
From: Akhil Goyal <akhil.goyal@freescale.com>
Date: Tue, 3 Jan 2012 18:02:04 +0000
Subject: [PATCH 66/92] rf: Initialize the antenna value before copy to user

Extracted from 913x_WUSDK_REL_0.9.tar.gz vendor drop.

When Rftool calls the ioctl to get the value of rssi, the copy_to_user
overites the value of assi_buf->ant value which results in junk value
of antenna while printing it in the console.

Signed-off-by: Akhil Goyal <akhil.goyal@freescale.com>
Integrated-by: Jiang Bin <bin.jiang@windriver.com>
---
 drivers/rf/phy/ad_phy.c |    1 +
 1 files changed, 1 insertions(+), 0 deletions(-)

diff --git a/drivers/rf/phy/ad_phy.c b/drivers/rf/phy/ad_phy.c
index 58e9768..acc241c 100644
--- a/drivers/rf/phy/ad_phy.c
+++ b/drivers/rf/phy/ad_phy.c
@@ -479,6 +479,7 @@ static int ad_read_rssi(struct rf_phy_dev *ad_phy, u32 ant,
 	rc = ad_phy_read(ad_phy, RSSI_READBACK_REG,
 			sizeof(reg_val_buf) / sizeof(u32), reg_val_buf);
 
+	rssi_buf->ant = ant;
 	if (ant == 1) {
 		rssi_buf->symbol = RSSI_RESOLUTION *
 				((reg_val_buf[0] << LSB_SHIFT) +
-- 
1.7.0

