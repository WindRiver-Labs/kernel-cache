From 933fdc20572a79f6101c13270e892bcc32da539e Mon Sep 17 00:00:00 2001
From: Pankaj chauhan <pankaj.chauhan@freescale.com>
Date: Mon, 17 Oct 2011 12:19:45 +0000
Subject: [PATCH 46/92] rf: Check device state before starting rfdev

Extracted from 913x_WUSDK_REL_0.9.tar.gz vendor drop.

RF device should not be started until it is intialized.
Add a check for state before starting device.

Signed-off-by: Pankaj Chauhan <pankaj.chauhan@freescale.com>
Integrated-by: Jiang Bin <bin.jiang@windriver.com>
---
 drivers/rf/core/rfdev.c |    5 +++++
 1 files changed, 5 insertions(+), 0 deletions(-)

diff --git a/drivers/rf/core/rfdev.c b/drivers/rf/core/rfdev.c
index dc9b624..b1ae99e 100644
--- a/drivers/rf/core/rfdev.c
+++ b/drivers/rf/core/rfdev.c
@@ -526,6 +526,11 @@ static int rf_ioctl(struct inode *inode, struct file *filep,
 		break;
 
 	case RIF_START:
+
+		if (rf_dev->state < RF_INITIALIZED) {
+			rc = -EAGAIN;
+			goto out;
+		}
 		if (phy) {
 			rc = phy->ops->start(phy);
 			if (rc)
-- 
1.7.0

