From 8427c1fcba522962432cd5f699efa94742cbc157 Mon Sep 17 00:00:00 2001
From: Limeng <Meng.Li@windriver.com>
Date: Tue, 11 Apr 2017 12:14:02 +0800
Subject: [PATCH 1/2] drivers: power: initialize main PMIC driver in advance
MIME-Version: 1.0
Content-Type: text/plain; charset=UTF-8
Content-Transfer-Encoding: 8bit

change late_initcall() into module_init() so that main PIMC driver is
initialized before gauge drvier. Because in gauge driver,
act260x_set_get_cap_point() is called to register callback function
into main PMIC driver. If main PMIC driver is not initialized in
advance, it causes registering callback function fail.

This issues is introduced by commit 09053722fe0b
(“pmu: add atc260x pmu driver”) when merge SDK patch related with
pmu driver.

Signed-off-by: Meng Li <Meng.Li@windriver.com>
---
 drivers/power/atc260x_power/atc260x_power_main.c |    2 +-
 1 files changed, 1 insertions(+), 1 deletions(-)

diff --git a/drivers/power/atc260x_power/atc260x_power_main.c b/drivers/power/atc260x_power/atc260x_power_main.c
index 300bf53..7e74021 100755
--- a/drivers/power/atc260x_power/atc260x_power_main.c
+++ b/drivers/power/atc260x_power/atc260x_power_main.c
@@ -2922,7 +2922,7 @@ static int __init atc260x_power_init(void)
 	log_event_init();
 	return platform_driver_register(&atc260x_power_driver);
 }
-late_initcall(atc260x_power_init);
+module_init(atc260x_power_init);
 
 static void __exit atc260x_power_exit(void)
 {
-- 
1.7.5.4

