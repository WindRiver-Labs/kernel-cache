From 2ed0e51a55e829778d96a900cd1820e54a019ca5 Mon Sep 17 00:00:00 2001
From: Limeng <Meng.Li@windriver.com>
Date: Mon, 24 Apr 2017 16:11:17 +0800
Subject: [PATCH 3/4] arm: mach-owl: add code to set UART0 divider parameter

Set correct divider parameter for UART0 so that it can achieve
reasonable clock frequency.

Signed-off-by: Meng Li <Meng.Li@windriver.com>
---
 arch/arm/mach-owl/clocktree-atm7059.c |    5 +++++
 1 files changed, 5 insertions(+), 0 deletions(-)

diff --git a/arch/arm/mach-owl/clocktree-atm7059.c b/arch/arm/mach-owl/clocktree-atm7059.c
index 6e9018a..1227284 100755
--- a/arch/arm/mach-owl/clocktree-atm7059.c
+++ b/arch/arm/mach-owl/clocktree-atm7059.c
@@ -2732,6 +2732,11 @@ void atm7059_init_clocktree(struct device_node *cum_node)
 			if (i == CLOCK__PRESD1_CLK)
 				clocks[i].divider = clocks[CLOCK__PRESD0_CLK].divider;
 
+			if (i == CLOCK__UART0_CLK) {
+				clocks[i].divsel = read_clkreg_val(clocks[CLOCK__UART2_CLK].actdiv->reg);
+				clocks[i].divider = getdivider(clocks[i].actdiv, clocks[i].divsel);
+			}
+
 			if (i == CLOCK__UART3_CLK)
 				clocks[i].divider = clocks[CLOCK__UART2_CLK].divider;
 
-- 
1.7.5.4

