From 52b275ba9471e3240938c3e4eddc2010d2d43371 Mon Sep 17 00:00:00 2001
From: Limeng <Meng.Li@windriver.com>
Date: Wed, 19 Apr 2017 11:25:31 +0800
Subject: [PATCH] drivers: ethernet: enable rtl8201f phy customized led
 feature

add code to enable rtl8201f phy customized led feature and set related
link and active bits so that green led presents link status and yellow
led presents active status.

Signed-off-by: Meng Li <Meng.Li@windriver.com>
---
 drivers/net/ethernet/acts/ec_hardware.h |    8 ++++++++
 drivers/net/ethernet/acts/ec_phy.c      |    3 +++
 2 files changed, 11 insertions(+), 0 deletions(-)

diff --git a/drivers/net/ethernet/acts/ec_hardware.h b/drivers/net/ethernet/acts/ec_hardware.h
index c8ea525..b3d519d 100755
--- a/drivers/net/ethernet/acts/ec_hardware.h
+++ b/drivers/net/ethernet/acts/ec_hardware.h
@@ -384,6 +384,7 @@ typedef struct buffer_descriptor {
 #define PHY_RTL8201F_REG_INT_LED_FUNC   0x13
 #define PHY_RTL8201F_REG_PAGE_SELECT    0x1F
 #define PHY_RTL8201F_REG_INT_SNR        0x1E
+#define PHY_RTL8201F_REG_CUSTOMIZED_LED	0x11
 
 /* PHY_RTL8201F_PAGE_SELECT */
 #define PHY_RTL8201F_REG_PAGE_SELECT_SEVEN    0x7
@@ -395,6 +396,13 @@ typedef struct buffer_descriptor {
 #define PHY_RTL8201F_RMSR_RMII_RX_OFFSET    (0xF<<4)
 #define PHY_RTL8201F_RMSR_RMII_TX_OFFSET    (0xF<<8)
 #define PHY_RTL8201F_PIN_LINK_STATE_CHANGE  (0x1<<13)
+#define PHY_RTL8201F_CUSTOMIZED_LED_ENABLE	(0x1<<3)
+#define PHY_RTL8201F_CUSTOMIZED_LINK_LED0_10M	(0x1<<0)
+#define PHY_RTL8201F_CUSTOMIZED_LINK_LED0_100M	(0x1<<1)
+#define PHY_RTL8201F_CUSTOMIZED_LINK_LED0_ACT	(0x1<<3)
+#define PHY_RTL8201F_CUSTOMIZED_LINK_LED1_10M	(0x1<<4)
+#define PHY_RTL8201F_CUSTOMIZED_LINK_LED1_100M	(0x1<<5)
+#define PHY_RTL8201F_CUSTOMIZED_LINK_LED1_ACT	(0x1<<7)
 
 /*
  * phy SR8201G
diff --git a/drivers/net/ethernet/acts/ec_phy.c b/drivers/net/ethernet/acts/ec_phy.c
index 14004a2..d7625c8 100755
--- a/drivers/net/ethernet/acts/ec_phy.c
+++ b/drivers/net/ethernet/acts/ec_phy.c
@@ -408,6 +408,9 @@ static int phy_init(ec_priv_t * ecp)
 		/*As datasheet says tx&rx offset's default value is 0xF but be zero in fact.Reset them*/
 		write_phy_reg(ecp, PHY_RTL8201F_REG_RMSR, 
 			PHY_RTL8201F_RMSR_CLK_DIR_INPUT | PHY_RTL8201F_RMSR_RMII_MODE|PHY_RTL8201F_RMSR_RMII_RX_OFFSET|PHY_RTL8201F_RMSR_RMII_TX_OFFSET);
+		/*Enable phy customized led and set link and active bits*/
+		phy_reg_set_bits(ecp, PHY_RTL8201F_REG_INT_LED_FUNC, PHY_RTL8201F_CUSTOMIZED_LED_ENABLE);
+		phy_reg_set_bits(ecp, PHY_RTL8201F_REG_CUSTOMIZED_LED, PHY_RTL8201F_CUSTOMIZED_LINK_LED0_ACT|PHY_RTL8201F_CUSTOMIZED_LINK_LED1_100M);
 		write_phy_reg(ecp, PHY_RTL8201F_REG_PAGE_SELECT, PHY_RTL8201F_REG_PAGE_SELECT_ZERO);
 	} else if (ecp->phy_model == ETH_PHY_MODEL_SR8201G) {
 		write_phy_reg(ecp, PHY_SR8201G_REG_PAGE_SELECT, PHY_SR8201G_REG_PAGE_SELECT_SEVEN);
-- 
1.7.5.4

