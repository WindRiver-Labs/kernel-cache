From 51431b1e8291f98d6d3ab155cf15b9390296c860 Mon Sep 17 00:00:00 2001
From: Zhang Xiao <xiao.zhang@windriver.com>
Date: Tue, 9 Mar 2010 16:05:09 +0800
Subject: [PATCH] comcerto : Fix bugs in the ethtool get ring parameter function

For Comcerto100 NIC, the pre-set ring parameters should fixed to the maximum
number that the device/driver can support. The value of the current setting
ring parameters need no more calculate, just return the current setting is OK.

Signed-off-by: Zhang Xiao <xiao.zhang@windriver.com>
---
 drivers/net/comcerto/comcerto_ethtool.c |   17 ++++++-----------
 1 files changed, 6 insertions(+), 11 deletions(-)

diff --git a/drivers/net/comcerto/comcerto_ethtool.c b/drivers/net/comcerto/comcerto_ethtool.c
index 663cc31..f7f5360 100644
--- a/drivers/net/comcerto/comcerto_ethtool.c
+++ b/drivers/net/comcerto/comcerto_ethtool.c
@@ -198,23 +198,18 @@ static void comcerto_gringparam(struct net_device *dev, struct ethtool_ringparam
 {
 	struct eth_priv *priv = netdev_priv(dev);
 
-	rvals->rx_max_pending = priv->RxRingSize;
-	rvals->rx_mini_max_pending = priv->RxRingSize;
-	rvals->rx_jumbo_max_pending = priv->RxRingSize;
-	rvals->tx_max_pending = priv->TxRingSize;
+	rvals->rx_max_pending = priv->RxMaxRingSize;
+	rvals->rx_mini_max_pending = priv->RxMaxRingSize;
+	rvals->rx_jumbo_max_pending = priv->RxMaxRingSize;
+	rvals->tx_max_pending = priv->TxMaxRingSize;
 
 	/* Values changeable by the user.  The valid values are
 	 * in the range 1 to the "*_max_pending" counterpart above.
 	 */
-	if (priv->RxtocleanIndex >= priv->RxtofillIndex)
-		rvals->rx_pending = (priv->RxtocleanIndex - priv->RxtofillIndex);
-	else
-		rvals->rx_pending = (priv->RxRingSize - 1 - \
-			priv->RxtocleanIndex + priv->RxtofillIndex);
-
+	rvals->rx_pending = priv->RxRingSize;
 	rvals->rx_mini_pending = rvals->rx_pending;
 	rvals->rx_jumbo_pending = rvals->rx_pending;
-	rvals->tx_pending = priv->TxRingSize - 1 - priv->Txavail;
+	rvals->tx_pending = priv->TxRingSize;
 }
 
 /* Change the current ring parameters, stopping the controller if
-- 
1.7.0

