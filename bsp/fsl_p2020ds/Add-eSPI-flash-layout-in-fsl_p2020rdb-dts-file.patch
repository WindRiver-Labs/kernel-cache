From 0a362f2c5866e6236e5e147adf86528c272b1c87 Mon Sep 17 00:00:00 2001
From: Andrew Liu <shengping.liu@windriver.com>
Date: Fri, 22 Jan 2010 16:51:47 +0800
Subject: [PATCH 1/2] Add eSPI flash layout in fsl_p2020rdb dts file.

As with NOR flash, eSPI flash also wants to support to boot
u-boot, kernel and rootfs from it.

However, at this point, this BSP doesn't support to boot u-boot
from eSPI flash, but in future, possibly adds this function, so add
u-boot partition in this dts.

Signed-off-by: Andrew Liu <shengping.liu@windriver.com>
---
 arch/powerpc/boot/dts/p2020rdb.dts |   38 ++++++++++++++++++++++++++++++++++++
 1 files changed, 38 insertions(+), 0 deletions(-)

diff --git a/arch/powerpc/boot/dts/p2020rdb.dts b/arch/powerpc/boot/dts/p2020rdb.dts
index ede4286..d423b2d 100644
--- a/arch/powerpc/boot/dts/p2020rdb.dts
+++ b/arch/powerpc/boot/dts/p2020rdb.dts
@@ -215,10 +215,48 @@
 			mode = "cpu";
 
 			fsl_m25p80@0 {
+				#address-cells = <1>;
+				#size-cells = <1>;
 				compatible = "fsl,espi-flash";
 				reg = <0>;
 				linux,modalias = "fsl_m25p80";
+				modal = "s25sl128b";
 				spi-max-frequency = <50000000>;
+				mode = <0>;
+
+				u-boot@0 {
+					/* 512KB for u-boot Bootloader Image */
+					reg = <0x0 0x00080000>;
+					label = "SPI (RO) U-Boot Image";
+					read-only;
+				};
+
+				dtb@80000 {
+					/* 512KB for DTB Image */
+					reg = <0x00080000 0x00080000>;
+					label = "SPI (RO) DTB Image";
+					read-only;
+				};
+
+				uImage@100000 {
+					/* 4MB for Linux Kernel Image */
+					reg = <0x00100000 0x00400000>;
+					label = "SPI (RO) Linux Kernel Image";
+					read-only;
+				};
+
+				rfs@500000 {
+					/* 4MB for Compressed RFS Image */
+					reg = <0x00500000 0x00400000>;
+					label = "SPI (RO) Compressed RFS Image";
+					read-only;
+				};
+
+				jffs2@900000 {
+					/* 7MB for JFFS2 based RFS */
+					reg = <0x00900000 0x00700000>;
+					label = "SPI (RW) JFFS2 RFS";
+				};
 			};
 		};
 
-- 
1.7.0

