From ad0ba9134ae3d7f268db0f77d651a6648a1f0528 Mon Sep 17 00:00:00 2001
From: Kevin Hao <kexin.hao@windriver.com>
Date: Mon, 24 Jun 2013 10:31:55 +0800
Subject: [PATCH 7/7] rtc/m48t59: return -EINVAL when no irq is configured for
 this device

The -EINVAL is the exact value that the function rtc_alarm_irq_enable
expect when a rtc is configured without irq. By using this return value
the kernel (CONFIG_RTC_INTF_DEV_UIE_EMUL is enabled) will try to
emulate the RTC_UIE ioctls for a rtc device which doesn't have irq
configured.

Signed-off-by: Kevin Hao <kexin.hao@windriver.com>
---
 drivers/rtc/rtc-m48t59.c |    4 ++--
 1 files changed, 2 insertions(+), 2 deletions(-)

diff --git a/drivers/rtc/rtc-m48t59.c b/drivers/rtc/rtc-m48t59.c
index 30ebfec..c5f5854 100644
--- a/drivers/rtc/rtc-m48t59.c
+++ b/drivers/rtc/rtc-m48t59.c
@@ -166,7 +166,7 @@ static int m48t59_rtc_readalarm(struct device *dev, struct rtc_wkalrm *alrm)
 
 	/* If no irq, we don't support ALARM */
 	if (m48t59->irq == NO_IRQ)
-		return -EIO;
+		return -EINVAL;
 
 	spin_lock_irqsave(&m48t59->lock, flags);
 	/* Issue the READ command */
@@ -219,7 +219,7 @@ static int m48t59_rtc_setalarm(struct device *dev, struct rtc_wkalrm *alrm)
 
 	/* If no irq, we don't support ALARM */
 	if (m48t59->irq == NO_IRQ)
-		return -EIO;
+		return -EINVAL;
 
 	if (year < 0)
 		return -EINVAL;
-- 
1.7.5.4

