From b9d562214c4ec18607afd3e004f46ca45e0cf558 Mon Sep 17 00:00:00 2001
From: "Reece R. Pollack" <x0183204@ti.com>
Date: Fri, 26 Sep 2014 17:30:33 -0400
Subject: [PATCH 113/256] hwqueue: keystone: Tune QoS rate parameters for
 smoother output

With larger WRR credit values comes higher throughput, but the output
can become "bursty". This patch lowers the initial byte credit target
from 1500 to 50, resulting in "smoother" output rates while not causing
excessive overhead in the 10000:1 case.

Signed-off-by: Reece R. Pollack <x0183204@ti.com>
(cherry picked from commit 0c06814366ca9d2c0cf100549f0507e5257f6718)
Signed-off-by: Zumeng Chen <zumeng.chen@windriver.com>
---
 drivers/hwqueue/keystone_qos.h |    6 +++---
 1 files changed, 3 insertions(+), 3 deletions(-)

diff --git a/drivers/hwqueue/keystone_qos.h b/drivers/hwqueue/keystone_qos.h
index 94a1396..ce93ae1 100644
--- a/drivers/hwqueue/keystone_qos.h
+++ b/drivers/hwqueue/keystone_qos.h
@@ -67,12 +67,12 @@
 #define QOS_WRR_PACKET_SHIFT		17
 #define QOS_WRR_BYTE_SHIFT		8
 
-#define QOS_BYTE_NORMALIZATION_FACTOR	(1500u << QOS_WRR_BYTE_SHIFT)
+#define QOS_BYTE_NORMALIZATION_FACTOR	(50u << QOS_WRR_BYTE_SHIFT)
 #define QOS_PACKET_NORMALIZATION_FACTOR	(2u << QOS_WRR_PACKET_SHIFT)
 
 #define	QOS_MAX_WEIGHT			U32_MAX
-#define	QOS_MAX_CREDITS			S32_MAX
-#define QOS_MIN_CREDITS_WARN		100
+#define	QOS_MAX_CREDITS			0x1fffffff
+#define QOS_MIN_CREDITS_WARN		(50u << QOS_WRR_BYTE_SHIFT)
 
 #define to_qnode(_n)	container_of(_n, struct khwq_qos_tree_node, node)
 
-- 
1.7.5.4

