From 91619abf2d1e28406e9ec008c45a3f84ddd1969c Mon Sep 17 00:00:00 2001
From: Zumeng Chen <zumeng.chen@windriver.com>
Date: Tue, 28 Apr 2015 16:45:21 +0800
Subject: [PATCH 251/257] arm: keystone: add __virt_to_idmap definition

This patch comes from:
  git://git.ti.com/keystone-linux/linux.git

To add keystone virt_to_idmap definition.

Signed-off-by: Zumeng Chen <zumeng.chen@windriver.com>
---
 arch/arm/mach-keystone/include/mach/memory.h | 14 ++++++++++++++
 1 file changed, 14 insertions(+)

diff --git a/arch/arm/mach-keystone/include/mach/memory.h b/arch/arm/mach-keystone/include/mach/memory.h
index a4f8033..411a4d9 100644
--- a/arch/arm/mach-keystone/include/mach/memory.h
+++ b/arch/arm/mach-keystone/include/mach/memory.h
@@ -43,6 +43,20 @@
 
 #ifndef __ASSEMBLY__
 
+static inline phys_addr_t __virt_to_phys(unsigned long x);
+
+static inline phys_addr_t __virt_to_idmap(unsigned long x)
+{
+#ifdef CONFIG_KEYSTONE_RECOVERY_KERNEL
+	return __virt_to_phys(x) - KEYSTONE_HIGH_PHYS_START +
+#else
+	return (phys_addr_t)(x) - CONFIG_PAGE_OFFSET +
+#endif
+		KEYSTONE_LOW_PHYS_START;
+}
+
+#define virt_to_idmap(x)	__virt_to_idmap((unsigned long)(x))
+
 extern unsigned long __arch_dma_pfn_offset;
 
 #define __arch_pfn_to_dma(dev, pfn)				\
-- 
2.7.4

