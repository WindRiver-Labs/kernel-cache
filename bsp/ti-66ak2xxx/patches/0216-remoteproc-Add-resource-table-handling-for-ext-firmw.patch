From 2b65dd45ed173ebdcaca7ed72acf9ebae6fa40e1 Mon Sep 17 00:00:00 2001
From: Sam Nelson <sam.nelson@ti.com>
Date: Fri, 22 Nov 2013 08:47:52 -0500
Subject: [PATCH 216/257] remoteproc: Add resource table handling for ext
 firmware download

Signed-off-by: Sam Nelson <sam.nelson@ti.com>
(cherry picked from commit 0ba1d7342be992c5a0de58f32eb35639f35337fa)
Signed-off-by: Zumeng Chen <zumeng.chen@windriver.com>
---
 drivers/remoteproc/remoteproc_core.c | 8 +++++++-
 1 file changed, 7 insertions(+), 1 deletion(-)

diff --git a/drivers/remoteproc/remoteproc_core.c b/drivers/remoteproc/remoteproc_core.c
index 94cb6e4..9fb2db5 100644
--- a/drivers/remoteproc/remoteproc_core.c
+++ b/drivers/remoteproc/remoteproc_core.c
@@ -957,7 +957,13 @@ static void rproc_fw_config_virtio(const struct firmware *fw, void *context)
 		goto out;
 
 	rproc->table_ptr = rproc->cached_table;
-
+	if (!fw) {
+		/* handle fw resources which are required to boot rproc */
+		ret = rproc_handle_resources(rproc, tablesz,
+			rproc_loading_handlers);
+		if (ret)
+			goto out;
+	}
 	/* count the number of notify-ids */
 	rproc->max_notifyid = -1;
 	ret = rproc_handle_resources(rproc, tablesz, rproc_count_vrings_handler);
-- 
2.7.4

