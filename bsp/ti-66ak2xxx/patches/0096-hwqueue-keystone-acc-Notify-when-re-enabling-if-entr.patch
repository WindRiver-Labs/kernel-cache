From c685b8f6a450f26af569424dcdd4bfeb1deaeaa5 Mon Sep 17 00:00:00 2001
From: "Reece R. Pollack" <x0183204@ti.com>
Date: Thu, 19 Dec 2013 15:30:07 -0500
Subject: [PATCH 096/257] hwqueue: keystone: acc: Notify when re-enabling if
 entries pending

This patch adds support for the case where notifications are being
re-enabled while there are entries pending for the queue. The previous
patch to optimize notifications didn't support this case.

Signed-off-by: Reece R. Pollack <x0183204@ti.com>
(cherry picked from commit f632601a8398256d6113ba79ba41de2d0aa9e9b3)
Signed-off-by: Zumeng Chen <zumeng.chen@windriver.com>
---
 drivers/hwqueue/keystone_hwqueue_acc.c | 1 +
 1 file changed, 1 insertion(+)

diff --git a/drivers/hwqueue/keystone_hwqueue_acc.c b/drivers/hwqueue/keystone_hwqueue_acc.c
index 4ebcee7..0764780 100644
--- a/drivers/hwqueue/keystone_hwqueue_acc.c
+++ b/drivers/hwqueue/keystone_hwqueue_acc.c
@@ -81,6 +81,7 @@ static int khwq_acc_set_notify(struct khwq_range_info *range,
 	if (!enabled || atomic_read(&kq->desc_count) <= 0)
 		return 0;
 
+	kq->notify_needed = 1;
 	atomic_inc(&kq->acc->retrigger_count);
 	mask = BIT(kq->acc->channel % 32);
 	offset = ACC_INTD_OFFSET_STATUS(kq->acc->channel);
-- 
2.7.4

