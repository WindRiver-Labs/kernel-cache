From 319457c6f35a0e2059697f45d4082b18d234763a Mon Sep 17 00:00:00 2001
From: Tinku Mannan <tmannan@ti.com>
Date: Thu, 20 Nov 2014 14:16:00 -0500
Subject: [PATCH 237/257] crypto: keystone: Fix size argument being passed to
 find_first_free_zero_bit()

find_first_zero_bit() second argument expects the size in amount of bits (512),
but sizeof() is passed so it is passing the number of bytes, causing SA
sideband contexts >64 to be dropped.  The patch changes the second argument to
pass in the number of bits.

Signed-off-by: Tinku Mannan <tmannan@ti.com>
(cherry picked from commit 1a9679f26fd6c957116f2b07b49df791f9bfe908)
Signed-off-by: Zumeng Chen <zumeng.chen@windriver.com>
---
 drivers/crypto/keystone-sa.c | 2 +-
 1 file changed, 1 insertion(+), 1 deletion(-)

diff --git a/drivers/crypto/keystone-sa.c b/drivers/crypto/keystone-sa.c
index 8e44d90..19207b6 100644
--- a/drivers/crypto/keystone-sa.c
+++ b/drivers/crypto/keystone-sa.c
@@ -2433,7 +2433,7 @@ static int sa_init_ctx_info
 		dev_err(&data->pdev->dev, "Out of SC IDs\n");
 		return -1;
 	}
-	bn = find_first_zero_bit(data->ctx_bm, sizeof(data->ctx_bm));
+	bn = find_first_zero_bit(data->ctx_bm, SA_MAX_NUM_CTX);
 	__set_bit(bn, data->ctx_bm);
 	data->sc_id++;
 	spin_unlock(&data->scid_lock);
-- 
2.7.4

