From f4d6e04e9280392cd081b377fe2bf116243963f2 Mon Sep 17 00:00:00 2001
From: Vitaly Andrianov <vitalya@ti.com>
Date: Thu, 25 Jul 2013 10:46:53 -0400
Subject: [PATCH 144/257] Keystone2: add ___GFP_DMA flag to
 __do_page_cache_readahead

The __do_page_cache_readahead allocates pages, which may be used in
DMA operations. The Keystone2 platform cannot use for DMA memory above 2GB.
Adding this flag prevents allocation the pages in high memory.

Signed-off-by: Vitaly Andrianov <vitalya@ti.com>
(cherry picked from commit 562066cb6e4dfe56127049151bd3df6f601b03bc)
Signed-off-by: Zumeng Chen <zumeng.chen@windriver.com>
---
 mm/readahead.c | 2 ++
 1 file changed, 2 insertions(+)

diff --git a/mm/readahead.c b/mm/readahead.c
index 0ca36a7..ac07e0f 100644
--- a/mm/readahead.c
+++ b/mm/readahead.c
@@ -166,6 +166,8 @@ int __do_page_cache_readahead(struct address_space *mapping, struct file *filp,
 
 	end_index = ((isize - 1) >> PAGE_CACHE_SHIFT);
 
+	mapping->flags |= ___GFP_DMA;
+
 	/*
 	 * Preallocate as many pages as we will need.
 	 */
-- 
2.7.4

