From 892bcb8dd464c9f1ca210905b7c31ecf995032da Mon Sep 17 00:00:00 2001
From: Prabhu Kuttiyam <pkuttiyam@ti.com>
Date: Thu, 25 Oct 2012 17:15:37 -0400
Subject: [PATCH 067/257] hwqueue: Region should necessarily contain link-index
 information.

Regions can use any link ram index, but it needs to be present for it to be a
valid region.

Signed-off-by: Prabhu Kuttiyam <pkuttiyam@ti.com>
(cherry picked from commit 631f8779735365f041835fe2e854f7c4e12e2c02)
Signed-off-by: Zumeng Chen <zumeng.chen@windriver.com>
---
 drivers/hwqueue/keystone_hwqueue.c | 5 +++--
 1 file changed, 3 insertions(+), 2 deletions(-)

diff --git a/drivers/hwqueue/keystone_hwqueue.c b/drivers/hwqueue/keystone_hwqueue.c
index 38912d2..6b62908 100644
--- a/drivers/hwqueue/keystone_hwqueue.c
+++ b/drivers/hwqueue/keystone_hwqueue.c
@@ -513,11 +513,12 @@ static int khwq_setup_regions(struct khwq_device *kdev,
 			continue;
 		}
 
-		if (!of_property_read_u32(child, "link-id", &region->link_index)) {
-			dev_err(dev, "invalid link info %s\n", region->name);
+		if (!of_get_property(child, "link-index", NULL)) {
+			dev_err(dev, "No link info for %s\n", region->name);
 			devm_kfree(dev, region);
 			continue;
 		}
+		of_property_read_u32(child, "link-index", &region->link_index);
 
 		list_add_tail(&region->list, &kdev->regions);
 	}
-- 
2.7.4

