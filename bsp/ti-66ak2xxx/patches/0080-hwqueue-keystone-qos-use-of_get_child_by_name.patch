From f4001b6d89b7948bfc27ce4e96408e9e3af53397 Mon Sep 17 00:00:00 2001
From: Cyril Chemparathy <cyril@ti.com>
Date: Tue, 4 Dec 2012 18:58:35 -0500
Subject: [PATCH 080/257] hwqueue: keystone: qos: use of_get_child_by_name()

This patch replaces of_find_child_by_name() with the equivalent
of_get_child_by_name() available in upstream kernels.  In the process, we also
ensure that we put the node reference once we are done with it.
(cherry picked from commit a0eb344f7910b2c83e643987a2ffbee893ce3fc1)

Signed-off-by: Zumeng Chen <zumeng.chen@windriver.com>
---
 drivers/hwqueue/keystone_hwqueue_qos.c | 8 ++++----
 1 file changed, 4 insertions(+), 4 deletions(-)

diff --git a/drivers/hwqueue/keystone_hwqueue_qos.c b/drivers/hwqueue/keystone_hwqueue_qos.c
index 8675f3a..934366b 100644
--- a/drivers/hwqueue/keystone_hwqueue_qos.c
+++ b/drivers/hwqueue/keystone_hwqueue_qos.c
@@ -3499,27 +3499,27 @@ int khwq_init_qos_range(struct khwq_device *kdev, struct device_node *node,
 
 	child = of_parse_phandle(node, "drop-policies", 0);
 	if (!child)
-		child = of_find_child_by_name(node, "drop-policies");
+		child = of_get_child_by_name(node, "drop-policies");
 	if (!child) {
 		dev_err(kdev->dev, "could not find drop policies\n");
 		goto bail;
 	}
-
 	error = khwq_qos_get_drop_policies(kdev, info, child);
 	if (error)
 		goto bail;
+	of_node_put(child);
 
 	child = of_parse_phandle(node, "qos-tree", 0);
 	if (!child)
-		child = of_find_child_by_name(node, "qos-tree");
+		child = of_get_child_by_name(node, "qos-tree");
 	if (!child) {
 		dev_err(kdev->dev, "could not find qos tree\n");
 		goto bail;
 	}
-
 	error = khwq_qos_tree_parse(info, child, NULL);
 	if (error)
 		goto bail;
+	of_node_put(child);
 
 	error = khwq_qos_tree_init(info);
 	if (error)
-- 
2.7.4

