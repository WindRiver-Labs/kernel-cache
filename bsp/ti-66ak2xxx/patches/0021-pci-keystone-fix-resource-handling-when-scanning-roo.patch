From e7569ce5ca5705e665c55b4f8b6081c450a0964b Mon Sep 17 00:00:00 2001
From: Aurelien Jacquiot <a-jacquiot@ti.com>
Date: Tue, 21 May 2013 19:14:26 +0200
Subject: [PATCH 021/257] pci: keystone: fix resource handling when scanning
 root bus

Signed-off-by: Aurelien Jacquiot <a-jacquiot@ti.com>
(cherry picked from commit 90e4b2782c568ef547bb87149ad9f848e01ca864)
Signed-off-by: Zumeng Chen <zumeng.chen@windriver.com>
---
 drivers/pci/host/pcie-keystone.c | 3 ++-
 1 file changed, 2 insertions(+), 1 deletion(-)

diff --git a/drivers/pci/host/pcie-keystone.c b/drivers/pci/host/pcie-keystone.c
index 672060c..7690eb8 100644
--- a/drivers/pci/host/pcie-keystone.c
+++ b/drivers/pci/host/pcie-keystone.c
@@ -1296,7 +1296,8 @@ static struct pci_bus *keystone_pcie_scan(int nr, struct pci_sys_data *sys)
 	pr_info(DRIVER_NAME ": Starting PCI scan...\n");
 	info = (struct keystone_pcie_info *)sys->private_data;
 
-	bus = pci_scan_bus(0, &keystone_pci_ops, sys);
+	bus = pci_scan_root_bus(NULL, sys->busnr, &keystone_pci_ops, sys,
+				&sys->resources);
 
 	/* Post enumeration fixups */
 	set_inbound_trans(info);
-- 
2.7.4

