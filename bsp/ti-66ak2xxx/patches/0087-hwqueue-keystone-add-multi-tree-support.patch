From 95a5511d60d61c8f48f48f52eda0696ab92189a8 Mon Sep 17 00:00:00 2001
From: Sandeep Paulraj <s-paulraj@ti.com>
Date: Mon, 22 Apr 2013 15:23:23 -0400
Subject: [PATCH 087/257] hwqueue: keystone: add multi tree support

The keystone qos driver has support for debugfs/sysfs.
The current version of the driver uses "qos" as the top directory
name for both debugfs/sysfs.
This will potentially create issues when we have multiple trees.
This commit adds support for adding a directory name based on
the node name/instance.

Signed-off-by: Sandeep Paulraj <s-paulraj@ti.com>
(cherry picked from commit dd576e8d036d765ac3e2ef1e7d4cff252229edda)
Signed-off-by: Zumeng Chen <zumeng.chen@windriver.com>
---
 drivers/hwqueue/keystone_hwqueue_qos.c | 7 +++++--
 1 file changed, 5 insertions(+), 2 deletions(-)

diff --git a/drivers/hwqueue/keystone_hwqueue_qos.c b/drivers/hwqueue/keystone_hwqueue_qos.c
index 2add223..bca07d7 100644
--- a/drivers/hwqueue/keystone_hwqueue_qos.c
+++ b/drivers/hwqueue/keystone_hwqueue_qos.c
@@ -3283,6 +3283,7 @@ static int khwq_qos_init_range(struct khwq_range_info *range)
 	struct khwq_device *kdev;
 	u32 command, magic, version;
 	int error, i, idx, timer_config;
+	char name[24];
 
 	info = range->qos_info;
 	pdsp = info->pdsp;
@@ -3290,6 +3291,8 @@ static int khwq_qos_init_range(struct khwq_range_info *range)
 
 	range->inst_ops.push = khwq_qos_push;
 
+	snprintf(name, sizeof(name), "qos-%d", pdsp->id);
+
 	spin_lock_bh(&info->lock);
 
 	magic = __raw_readl(pdsp->command + QOS_MAGIC_OFFSET);
@@ -3358,7 +3361,7 @@ static int khwq_qos_init_range(struct khwq_range_info *range)
 		goto fail;
 	}
 
-	info->root_dir = debugfs_create_dir("qos", NULL);
+	info->root_dir = debugfs_create_dir(name, NULL);
 	if (!info->root_dir)
 		goto fail;
 
@@ -3393,7 +3396,7 @@ int khwq_init_qos_range(struct khwq_device *kdev, struct device_node *node,
 		return -ENOMEM;
 	}
 
-	info->kobj = kobject_create_and_add("qos",
+	info->kobj = kobject_create_and_add(node->name,
 					kobject_get(&dev->kobj));
 	if (!info->kobj) {
 		dev_err(kdev->dev, "could not create sysfs entries for qos\n");
-- 
2.7.4

