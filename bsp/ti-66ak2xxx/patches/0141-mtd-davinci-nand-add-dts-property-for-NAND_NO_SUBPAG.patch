From e9a6314d6e556ec664d6fd86a9abec4933c78146 Mon Sep 17 00:00:00 2001
From: Zumeng Chen <zumeng.chen@windriver.com>
Date: Fri, 17 Apr 2015 10:20:23 +0800
Subject: [PATCH 141/257] mtd: davinci-nand: add dts property for
 NAND_NO_SUBPAGE_WRITE option

This patch comes from:
  git://git.ti.com/keystone-linux/linux.git

Add a property to disable subpage write.

Signed-off-by: Murali Karicheri <m-karicheri2@ti.com>
Signed-off-by: Zumeng Chen <zumeng.chen@windriver.com>
---
 Documentation/devicetree/bindings/mtd/davinci-nand.txt | 2 ++
 drivers/mtd/nand/davinci_nand.c                        | 6 ++++++
 2 files changed, 8 insertions(+)

diff --git a/Documentation/devicetree/bindings/mtd/davinci-nand.txt b/Documentation/devicetree/bindings/mtd/davinci-nand.txt
index cfb18ab..23d6e31 100644
--- a/Documentation/devicetree/bindings/mtd/davinci-nand.txt
+++ b/Documentation/devicetree/bindings/mtd/davinci-nand.txt
@@ -53,6 +53,8 @@ Recommended properties :
 				identifier is saved in OOB area. If not present
 				false.
 
+- ti,davinci-no-subpage-write: disable subpage write for the device.
+
 Deprecated properties:
 
 - ti,davinci-ecc-mode:		operation mode of the NAND ecc mode. ECC mode
diff --git a/drivers/mtd/nand/davinci_nand.c b/drivers/mtd/nand/davinci_nand.c
index 65cf78a..86cb70c 100644
--- a/drivers/mtd/nand/davinci_nand.c
+++ b/drivers/mtd/nand/davinci_nand.c
@@ -560,6 +560,7 @@ static struct davinci_nand_pdata
 		struct davinci_nand_pdata *pdata;
 		const char *mode;
 		u32 prop;
+		int len;
 
 		pdata =  devm_kzalloc(&pdev->dev,
 				sizeof(struct davinci_nand_pdata),
@@ -607,6 +608,11 @@ static struct davinci_nand_pdata
 		    of_property_read_bool(pdev->dev.of_node,
 			"ti,davinci-nand-use-bbt"))
 			pdata->bbt_options = NAND_BBT_USE_FLASH;
+
+		if (of_find_property(pdev->dev.of_node,
+			"ti,davinci-no-subpage-write", &len))
+			pdata->options |= NAND_NO_SUBPAGE_WRITE;
+
 	}
 
 	return dev_get_platdata(&pdev->dev);
-- 
2.7.4

