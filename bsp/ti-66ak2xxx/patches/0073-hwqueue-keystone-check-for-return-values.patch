From 07ac0a1c8e8c12704eceb510d4c068da0e19a75e Mon Sep 17 00:00:00 2001
From: Sandeep Paulraj <s-paulraj@ti.com>
Date: Tue, 27 Nov 2012 13:49:11 -0500
Subject: [PATCH 073/257] hwqueue: keystone: check for return values

This commit adds check for return values.
Also dead code is being factored out.

Signed-off-by: Sandeep Paulraj <s-paulraj@ti.com>

Conflicts:

	drivers/hwqueue/keystone_hwqueue.c
(cherry picked from commit 5e9f4fbbd04daddc35e5e87a2ff7e886e5c09090)
Signed-off-by: Zumeng Chen <zumeng.chen@windriver.com>
---
 drivers/hwqueue/keystone_hwqueue.c | 9 ++++++++-
 1 file changed, 8 insertions(+), 1 deletion(-)

diff --git a/drivers/hwqueue/keystone_hwqueue.c b/drivers/hwqueue/keystone_hwqueue.c
index a5b3bba..002a53a 100644
--- a/drivers/hwqueue/keystone_hwqueue.c
+++ b/drivers/hwqueue/keystone_hwqueue.c
@@ -529,7 +529,14 @@ static int khwq_setup_regions(struct khwq_device *kdev,
 			devm_kfree(dev, region);
 			continue;
 		}
-		of_property_read_u32(child, "link-index", &region->link_index);
+		ret = of_property_read_u32(child, "link-index",
+					   &region->link_index);
+		if (ret) {
+			dev_err(dev, "link index not found for %s\n",
+				region->name);
+			devm_kfree(dev, region);
+			continue;
+		}
 
 		list_add_tail(&region->list, &kdev->regions);
 	}
-- 
2.7.4

