From 57dfd74e03f8efaaaf39b41c9cd554e7d3c8bf53 Mon Sep 17 00:00:00 2001
From: Zumeng Chen <zumeng.chen@windriver.com>
Date: Fri, 17 Apr 2015 13:51:32 +0800
Subject: [PATCH 189/257] Keystone2: [tmp] set bounce_limit to BLK_BOUNCE_HIGH

This patch comes from:
  git://git.ti.com/keystone-linux/linux.git

Keystone2 architecture can support DMA only in the first 2GB of
DDR3 memory. Incorrectly set bounce_limit may cause dma buffer allocation
in not dma supported memory.

This patch sets the bounce_limit to bounce any highmem pages.

Signed-off-by: Vitaly Andrianov <vitalya@ti.com>
Signed-off-by: Zumeng Chen <zumeng.chen@windriver.com>
---
 drivers/scsi/scsi_lib.c | 5 ++++-
 1 file changed, 4 insertions(+), 1 deletion(-)

diff --git a/drivers/scsi/scsi_lib.c b/drivers/scsi/scsi_lib.c
index 384f684..27fc50b 100644
--- a/drivers/scsi/scsi_lib.c
+++ b/drivers/scsi/scsi_lib.c
@@ -1679,8 +1679,11 @@ out:
 u64 scsi_calculate_bounce_limit(struct Scsi_Host *shost)
 {
 	struct device *host_dev;
+#ifdef CONFIG_ARCH_KEYSTONE
+	u64 bounce_limit = BLK_BOUNCE_HIGH;
+#else
 	u64 bounce_limit = 0xffffffff;
-
+#endif
 	if (shost->unchecked_isa_dma)
 		return BLK_BOUNCE_ISA;
 	/*
-- 
2.7.4

