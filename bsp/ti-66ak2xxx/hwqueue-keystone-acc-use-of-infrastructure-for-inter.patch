From 85a28abcf98ac6a40743eedbe2de2b509940a317 Mon Sep 17 00:00:00 2001
From: Cyril Chemparathy <cyril@ti.com>
Date: Fri, 7 Dec 2012 14:13:59 -0500
Subject: [PATCH 085/256] hwqueue: keystone: acc: use of infrastructure for
 interrupts (cherry picked from commit
 f1b33c48044756a91fb452edf92bdf3937fe3230)

Signed-off-by: Zumeng Chen <zumeng.chen@windriver.com>
---
 drivers/hwqueue/keystone_hwqueue_acc.c |    9 ++++++---
 1 files changed, 6 insertions(+), 3 deletions(-)

diff --git a/drivers/hwqueue/keystone_hwqueue_acc.c b/drivers/hwqueue/keystone_hwqueue_acc.c
index be6fd43..bf7d963 100644
--- a/drivers/hwqueue/keystone_hwqueue_acc.c
+++ b/drivers/hwqueue/keystone_hwqueue_acc.c
@@ -112,7 +112,10 @@ static irqreturn_t khwq_acc_int_handler(int irq, void *_instdata)
 	range_base = kdev->base_id + range->queue_base;
 
 	if ((range->flags & RANGE_MULTI_QUEUE) == 0) {
-		queue	 = irq - range->irq_base;
+		/* TODO: this needs extent checks */
+		for (queue = 0; queue < range->num_irqs; queue++)
+			if (range->irqs[queue] == irq)
+				break;
 		inst	 = hwqueue_id_to_inst(hdev, range_base + queue);
 		kq	 = hwqueue_inst_to_priv(inst);
 		acc	+= queue;
@@ -219,10 +222,10 @@ int khwq_range_setup_acc_irq(struct khwq_range_info *range, int queue,
 
 	if (range->flags & RANGE_MULTI_QUEUE) {
 		acc = range->acc;
-		irq = range->irq_base;
+		irq = range->irqs[0];
 	} else {
 		acc = range->acc + queue;
-		irq = range->irq_base + queue;
+		irq = range->irqs[queue];
 	}
 
 	old = acc->open_mask;
-- 
1.7.5.4

