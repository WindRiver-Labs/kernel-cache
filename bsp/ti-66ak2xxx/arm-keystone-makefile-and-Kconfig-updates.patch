From 0af7bfa45eff381e13f3fbd7d06c0951e778cc22 Mon Sep 17 00:00:00 2001
From: Zumeng Chen <zumeng.chen@windriver.com>
Date: Tue, 5 May 2015 21:49:50 +0800
Subject: [PATCH 004/256] arm: keystone: makefile and Kconfig updates

This patch comes from:
  git://git.ti.com/keystone-linux/linux.git

Signed-off-by:Zumeng Chen <zumeng.chen@windriver.com>

Signed-off-by: Zumeng Chen <zumeng.chen@windriver.com>
---
 arch/arm/mach-keystone/Kconfig       |   31 ++++++++++++++++++-------------
 arch/arm/mach-keystone/Makefile      |    5 +----
 arch/arm/mach-keystone/Makefile.boot |    3 ++-
 3 files changed, 21 insertions(+), 18 deletions(-)

diff --git a/arch/arm/mach-keystone/Kconfig b/arch/arm/mach-keystone/Kconfig
index f50bc93..3f4f341 100644
--- a/arch/arm/mach-keystone/Kconfig
+++ b/arch/arm/mach-keystone/Kconfig
@@ -1,13 +1,18 @@
-config ARCH_KEYSTONE
-	bool "Texas Instruments Keystone Devices"
-	depends on ARCH_MULTI_V7
-	select ARM_GIC
-	select HAVE_ARM_ARCH_TIMER
-	select CLKSRC_MMIO
-	select ARM_ERRATA_798181 if SMP
-	select COMMON_CLK_KEYSTONE
-	select ARCH_SUPPORTS_BIG_ENDIAN
-	select ZONE_DMA if ARM_LPAE
-	help
-	  Support for boards based on the Texas Instruments Keystone family of
-	  SoCs.
+if ARCH_KEYSTONE
+
+config TI_KEYSTONE
+	bool
+
+menu "TI KeyStone Implementations"
+
+config KEYSTONE_RECOVERY_KERNEL
+	bool "Build recovery kernel"
+	default n
+
+config KEYSTONE2_DMA_COHERENT
+	bool "MPAX based coherency support"
+	default n
+
+endmenu
+
+endif
diff --git a/arch/arm/mach-keystone/Makefile b/arch/arm/mach-keystone/Makefile
index 25d9239..589a89e 100644
--- a/arch/arm/mach-keystone/Makefile
+++ b/arch/arm/mach-keystone/Makefile
@@ -1,9 +1,6 @@
-obj-y					:= keystone.o smc.o
+obj-y					:= keystone.o pm.o keystone_ecc.o
 
 plus_sec := $(call as-instr,.arch_extension sec,+sec)
 AFLAGS_smc.o				:=-Wa,-march=armv7-a$(plus_sec)
 
 obj-$(CONFIG_SMP)			+= platsmp.o
-
-# PM domain driver for Keystone SOCs
-obj-$(CONFIG_ARCH_KEYSTONE)		+= pm_domain.o
diff --git a/arch/arm/mach-keystone/Makefile.boot b/arch/arm/mach-keystone/Makefile.boot
index f3835c4..987cd83 100644
--- a/arch/arm/mach-keystone/Makefile.boot
+++ b/arch/arm/mach-keystone/Makefile.boot
@@ -1 +1,2 @@
-zreladdr-y	:= 0x80008000
+zreladdr-$(CONFIG_KEYSTONE_RECOVERY_KERNEL)	:= 0x90008000
+zreladdr-y	?= 0x80008000
-- 
1.7.5.4

