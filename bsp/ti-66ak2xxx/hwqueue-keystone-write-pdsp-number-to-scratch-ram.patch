From cc8ba0d150377f8a01be0924020e490c033c0008 Mon Sep 17 00:00:00 2001
From: Sandeep Paulraj <s-paulraj@ti.com>
Date: Tue, 9 Apr 2013 09:55:37 -0400
Subject: [PATCH 089/256] hwqueue: keystone: write pdsp number to scratch ram

While downloading the qmss pdsp firmware we need to
write the 1 based pdsp number to scratch ram.
If this is not done, then the pdsp will spin in a loop.

Signed-off-by: Sandeep Paulraj <s-paulraj@ti.com>
(cherry picked from commit 813670a13e4d601cbccc9b81bde3f5eed5dc1f14)
Signed-off-by: Zumeng Chen <zumeng.chen@windriver.com>
---
 drivers/hwqueue/keystone_hwqueue.c |    2 ++
 1 files changed, 2 insertions(+), 0 deletions(-)

diff --git a/drivers/hwqueue/keystone_hwqueue.c b/drivers/hwqueue/keystone_hwqueue.c
index e5c6eba..b779d10 100644
--- a/drivers/hwqueue/keystone_hwqueue.c
+++ b/drivers/hwqueue/keystone_hwqueue.c
@@ -1003,6 +1003,8 @@ static int khwq_load_pdsp(struct khwq_device *kdev,
 		return ret;
 	}
 
+	__raw_writel(pdsp->id + 1, pdsp->command + 0x18);
+
 	/* download the firmware */
 	fwdata = (u32 *)fw->data;
 	fwlen = (fw->size + sizeof(u32) - 1) / sizeof(u32);
-- 
1.7.5.4

