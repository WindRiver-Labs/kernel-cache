From a0421401b08c0a243e3d60580da8aa94df8921e6 Mon Sep 17 00:00:00 2001
From: Zumeng Chen <zumeng.chen@windriver.com>
Date: Tue, 5 May 2015 21:52:33 +0800
Subject: [PATCH 006/256] arm: keystone: add header file support for 3.14.x

This patch comes from:
  git://git.ti.com/keystone-linux/linux.git

Signed-off-by:Zumeng Chen <zumeng.chen@windriver.com>

Signed-off-by: Zumeng Chen <zumeng.chen@windriver.com>
---
 arch/arm/mach-keystone/include/mach/gpio.h       |    1 +
 arch/arm/mach-keystone/include/mach/memory.h     |   61 ++++++++++++++++++++++
 arch/arm/mach-keystone/include/mach/serial.h     |   48 +++++++++++++++++
 arch/arm/mach-keystone/include/mach/timex.h      |   21 ++++++++
 arch/arm/mach-keystone/include/mach/uncompress.h |   48 +++++++++++++++++
 5 files changed, 179 insertions(+), 0 deletions(-)
 create mode 100644 arch/arm/mach-keystone/include/mach/gpio.h
 create mode 100644 arch/arm/mach-keystone/include/mach/memory.h
 create mode 100644 arch/arm/mach-keystone/include/mach/serial.h
 create mode 100644 arch/arm/mach-keystone/include/mach/timex.h
 create mode 100644 arch/arm/mach-keystone/include/mach/uncompress.h

diff --git a/arch/arm/mach-keystone/include/mach/gpio.h b/arch/arm/mach-keystone/include/mach/gpio.h
new file mode 100644
index 0000000..40a8c17
--- /dev/null
+++ b/arch/arm/mach-keystone/include/mach/gpio.h
@@ -0,0 +1 @@
+/* empty */
diff --git a/arch/arm/mach-keystone/include/mach/memory.h b/arch/arm/mach-keystone/include/mach/memory.h
new file mode 100644
index 0000000..a4f8033
--- /dev/null
+++ b/arch/arm/mach-keystone/include/mach/memory.h
@@ -0,0 +1,61 @@
+/*
+ * Copyright 2010-2012 Texas Instruments, Inc.
+ *
+ * This program is free software; you can redistribute it and/or modify it
+ * under the terms and conditions of the GNU General Public License,
+ * version 2, as published by the Free Software Foundation.
+ *
+ * This program is distributed in the hope it will be useful, but WITHOUT
+ * ANY WARRANTY; without even the implied warranty of MERCHANTABILITY or
+ * FITNESS FOR A PARTICULAR PURPOSE.  See the GNU General Public License for
+ * more details.
+ *
+ * You should have received a copy of the GNU General Public License along with
+ * this program.  If not, see <http://www.gnu.org/licenses/>.
+ */
+#ifndef __ASM_MACH_MEMORY_H
+#define __ASM_MACH_MEMORY_H
+
+#define MAX_PHYSMEM_BITS	36
+#define SECTION_SIZE_BITS	34
+
+#ifdef CONFIG_KEYSTONE_RECOVERY_KERNEL
+#define REC_OFFSET	0x10000000ULL
+#else
+#define REC_OFFSET	0
+#endif
+
+#define KEYSTONE_LOW_PHYS_START		(0x80000000ULL + REC_OFFSET)
+#define KEYSTONE_LOW_PHYS_SIZE		(0x80000000ULL - REC_OFFSET)
+#define KEYSTONE_LOW_PHYS_END		(KEYSTONE_LOW_PHYS_START + \
+					 KEYSTONE_LOW_PHYS_SIZE - 1)
+
+#define KEYSTONE_HIGH_PHYS_START	(0x800000000ULL + REC_OFFSET)
+#define KEYSTONE_HIGH_PHYS_SIZE		(0x400000000ULL - REC_OFFSET)
+#define KEYSTONE_HIGH_PHYS_END		(KEYSTONE_HIGH_PHYS_START + \
+					 KEYSTONE_HIGH_PHYS_SIZE - 1)
+
+#define IDMAP_ADDR_OFFSET	(KEYSTONE_HIGH_PHYS_START - \
+				 KEYSTONE_LOW_PHYS_START)
+#define IDMAP_PFN_OFFSET	(IDMAP_ADDR_OFFSET >> PAGE_SHIFT)
+
+#ifdef CONFIG_ARM_LPAE
+
+#ifndef __ASSEMBLY__
+
+extern unsigned long __arch_dma_pfn_offset;
+
+#define __arch_pfn_to_dma(dev, pfn)				\
+	PFN_PHYS(pfn - __arch_dma_pfn_offset)
+#define __arch_dma_to_pfn(dev, addr)				\
+	(PFN_DOWN(addr) + __arch_dma_pfn_offset)
+#define __arch_dma_to_virt(dev, addr)				\
+	phys_to_virt(addr + PFN_PHYS(__arch_dma_pfn_offset))
+#define __arch_virt_to_dma(dev, addr)				\
+	(virt_to_phys(addr) - PFN_PHYS(__arch_dma_pfn_offset))
+
+#endif /* __ASSEMBLY__ */
+
+#endif /* CONFIG_ARM_LPAE */
+
+#endif /* __ASM_MACH_MEMORY_H */
diff --git a/arch/arm/mach-keystone/include/mach/serial.h b/arch/arm/mach-keystone/include/mach/serial.h
new file mode 100644
index 0000000..eb095a3
--- /dev/null
+++ b/arch/arm/mach-keystone/include/mach/serial.h
@@ -0,0 +1,48 @@
+/*
+ * Serial port register definitions
+ *
+ * Copyright 2010-2012 Texas Instruments, Inc.
+ *
+ * This program is free software; you can redistribute it and/or modify it
+ * under the terms and conditions of the GNU General Public License,
+ * version 2, as published by the Free Software Foundation.
+ *
+ * This program is distributed in the hope it will be useful, but WITHOUT
+ * ANY WARRANTY; without even the implied warranty of MERCHANTABILITY or
+ * FITNESS FOR A PARTICULAR PURPOSE.  See the GNU General Public License for
+ * more details.
+ *
+ * You should have received a copy of the GNU General Public License along with
+ * this program.  If not, see <http://www.gnu.org/licenses/>.
+ */
+
+#ifndef __MACH_KEYSTONE_SERIAL_H__
+#define __MACH_KEYSTONE_SERIAL_H__
+
+#if defined(CONFIG_DEBUG_DAVINCI_TCI6614_UART0)
+
+#define UART_PHYS	0x02540000
+#define UART_VIRT	0xfeb40000
+
+#elif defined(CONFIG_DEBUG_DAVINCI_TCI6614_UART1)
+
+#define UART_PHYS	0x02541000
+#define UART_VIRT	0xfeb41000
+
+#elif defined(CONFIG_DEBUG_DAVINCI_TCI6638_UART0)
+
+#define UART_PHYS	0x02530c00
+#define UART_VIRT	0xfeb30c00
+
+#elif defined(CONFIG_DEBUG_DAVINCI_TCI6638_UART1)
+
+#define UART_PHYS	0x02531000
+#define UART_VIRT	0xfeb31000
+
+#elif defined(CONFIG_DEBUG_EARLY_PRINTK)
+
+#warn unsupported early debug configuration
+
+#endif
+
+#endif
diff --git a/arch/arm/mach-keystone/include/mach/timex.h b/arch/arm/mach-keystone/include/mach/timex.h
new file mode 100644
index 0000000..f355ecb
--- /dev/null
+++ b/arch/arm/mach-keystone/include/mach/timex.h
@@ -0,0 +1,21 @@
+/*
+ * Copyright 2010-2012 Texas Instruments, Inc.
+ *
+ * This program is free software; you can redistribute it and/or modify it
+ * under the terms and conditions of the GNU General Public License,
+ * version 2, as published by the Free Software Foundation.
+ *
+ * This program is distributed in the hope it will be useful, but WITHOUT
+ * ANY WARRANTY; without even the implied warranty of MERCHANTABILITY or
+ * FITNESS FOR A PARTICULAR PURPOSE.  See the GNU General Public License for
+ * more details.
+ *
+ * You should have received a copy of the GNU General Public License along with
+ * this program.  If not, see <http://www.gnu.org/licenses/>.
+ */
+#ifndef __MACH_TIMEX_H
+#define __MACH_TIMEX_H
+
+#define CLOCK_TICK_RATE		1000000
+
+#endif
diff --git a/arch/arm/mach-keystone/include/mach/uncompress.h b/arch/arm/mach-keystone/include/mach/uncompress.h
new file mode 100644
index 0000000..866ea7b
--- /dev/null
+++ b/arch/arm/mach-keystone/include/mach/uncompress.h
@@ -0,0 +1,48 @@
+/*
+ * Copyright 2010-2012 Texas Instruments, Inc.
+ *
+ * This program is free software; you can redistribute it and/or modify it
+ * under the terms and conditions of the GNU General Public License,
+ * version 2, as published by the Free Software Foundation.
+ *
+ * This program is distributed in the hope it will be useful, but WITHOUT
+ * ANY WARRANTY; without even the implied warranty of MERCHANTABILITY or
+ * FITNESS FOR A PARTICULAR PURPOSE.  See the GNU General Public License for
+ * more details.
+ *
+ * You should have received a copy of the GNU General Public License along with
+ * this program.  If not, see <http://www.gnu.org/licenses/>.
+ */
+#ifndef __MACH_KEYSTONE_UNCOMPRESS_H__
+#define __MACH_KEYSTONE_UNCOMPRESS_H__
+
+#include <linux/types.h>
+#include <linux/serial_reg.h>
+
+#include <mach/serial.h>
+
+static void putc(char c)
+{
+#ifdef UART_PHYS
+	u32 *uart = (u32 *)UART_PHYS;
+
+	while (!(uart[UART_LSR] & UART_LSR_THRE))
+		barrier();
+	uart[UART_TX] = c;
+#endif
+}
+
+static inline void flush(void)
+{
+#ifdef UART_PHYS
+	u32 *uart = (u32 *)UART_PHYS;
+
+	while (!(uart[UART_LSR] & UART_LSR_THRE))
+		barrier();
+#endif
+}
+
+#define arch_decomp_setup()
+#define arch_decomp_wdog()
+
+#endif
-- 
1.7.5.4

