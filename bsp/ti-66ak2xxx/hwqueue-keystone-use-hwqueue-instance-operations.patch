From fab12b51e251dd3d4b086cd94d7e81d6a159bc12 Mon Sep 17 00:00:00 2001
From: Sandeep Paulraj <s-paulraj@ti.com>
Date: Thu, 29 Nov 2012 15:49:51 -0500
Subject: [PATCH 079/256] hwqueue: keystone: use hwqueue instance operations

Signed-off-by: Sandeep Paulraj <s-paulraj@ti.com>
(cherry picked from commit 1b3daf946eae48ca4975dc28319ff8acabea0e7f)
Signed-off-by: Zumeng Chen <zumeng.chen@windriver.com>
---
 drivers/hwqueue/keystone_hwqueue.c |    6 ++++++
 drivers/hwqueue/keystone_hwqueue.h |    1 +
 2 files changed, 7 insertions(+), 0 deletions(-)

diff --git a/drivers/hwqueue/keystone_hwqueue.c b/drivers/hwqueue/keystone_hwqueue.c
index 002a53a..817cdda 100644
--- a/drivers/hwqueue/keystone_hwqueue.c
+++ b/drivers/hwqueue/keystone_hwqueue.c
@@ -371,6 +371,9 @@ static struct hwqueue_device_ops khdev_ops = {
 	.open		= khwq_open,
 	.set_notify	= khwq_set_notify,
 	.close		= khwq_close,
+};
+
+static struct hwqueue_inst_ops khdev_inst_ops = {
 	.push		= khwq_push,
 	.pop		= khwq_pop,
 	.get_count	= khwq_get_count,
@@ -1086,6 +1089,8 @@ static int khwq_init_queue(struct khwq_device *kdev,
 	kq->range = range;
 	kq->irq_num = -1;
 
+	inst->ops = &range->inst_ops;
+
 	scnprintf(kq->irq_name, sizeof(kq->irq_name),
 		  "hwqueue-%d", range->queue_base + id);
 
@@ -1102,6 +1107,7 @@ static int khwq_init_queues(struct khwq_device *kdev)
 	int id, ret;
 
 	for_each_queue_range(kdev, range) {
+		range->inst_ops = khdev_inst_ops;
 		if (range->ops && range->ops->init_range)
 			range->ops->init_range(range);
 		for (id = range->queue_base;
diff --git a/drivers/hwqueue/keystone_hwqueue.h b/drivers/hwqueue/keystone_hwqueue.h
index 4721a87..dddc3ec 100644
--- a/drivers/hwqueue/keystone_hwqueue.h
+++ b/drivers/hwqueue/keystone_hwqueue.h
@@ -183,6 +183,7 @@ struct khwq_range_info {
 	unsigned		 flags;
 	struct list_head	 list;
 	struct khwq_range_ops	*ops;
+	struct hwqueue_inst_ops	 inst_ops;
 	struct khwq_acc_info	 acc_info;
 	struct khwq_acc_channel	*acc;
 	struct khwq_qos_info	*qos_info;
-- 
1.7.5.4

