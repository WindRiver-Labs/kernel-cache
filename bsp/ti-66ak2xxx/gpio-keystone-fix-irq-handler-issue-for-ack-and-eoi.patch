From 12dd0daa246e79fb771c520e6744bdd2328146dd Mon Sep 17 00:00:00 2001
From: Murali Karicheri <m-karicheri2@ti.com>
Date: Tue, 14 May 2013 11:51:03 -0400
Subject: [PATCH 195/256] gpio: keystone: fix irq handler issue for ack and
 eoi

GIC IRQ controller doesn't have irq_ack(), but got irq_eoi().
Check and call appropriate API to ack the interrupt.

Signed-off-by: Murali Karicheri <m-karicheri2@ti.com>
(cherry picked from commit ea05bef34042eb3f608839e136556bbf306d0fbd)
Signed-off-by: Zumeng Chen <zumeng.chen@windriver.com>
---
 drivers/gpio/gpio-keystone.c |    5 ++++-
 1 files changed, 4 insertions(+), 1 deletions(-)

diff --git a/drivers/gpio/gpio-keystone.c b/drivers/gpio/gpio-keystone.c
index 6bba4f3..191dee0 100644
--- a/drivers/gpio/gpio-keystone.c
+++ b/drivers/gpio/gpio-keystone.c
@@ -176,7 +176,10 @@ static void keystone_irq_handler(unsigned int irq, struct irq_desc *desc)
 
 	/* temporarily mask (level sensitive) parent IRQ */
 	chip->irq_mask(&desc->irq_data);
-	chip->irq_ack(&desc->irq_data);
+	if (chip->irq_ack)
+		chip->irq_ack(&desc->irq_data);
+	if (chip->irq_eoi)
+		chip->irq_eoi(&desc->irq_data);
 
 	status = __raw_readl(bank->reg_base + regs->intstat) & mask;
 	if (status) {
-- 
1.7.5.4

