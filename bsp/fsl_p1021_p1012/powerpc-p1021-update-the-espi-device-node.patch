From 05d53be7e1424084e1b1b6c5a539c43973228553 Mon Sep 17 00:00:00 2001
From: Jiang Lu <lu.jiang@windriver.com>
Date: Mon, 29 Aug 2011 17:08:58 +0800
Subject: [PATCH 2/2] powerpc/p1021: update the espi device node

Since we begin to use the mainline driver for espi controller and
m25p80 flash, update the espi device node according to this change.

Signed-off-by: Jiang Lu <lu.jiang@windriver.com>
---
 arch/powerpc/boot/dts/p1021mds.dts            |    9 ++++-----
 arch/powerpc/boot/dts/p1021mds_camp_core0.dts |    8 +++-----
 arch/powerpc/boot/dts/p1021mds_tdm.dts        |    8 +++-----
 3 files changed, 10 insertions(+), 15 deletions(-)

diff --git a/arch/powerpc/boot/dts/p1021mds.dts b/arch/powerpc/boot/dts/p1021mds.dts
index ae5fd48..7d646ae 100644
--- a/arch/powerpc/boot/dts/p1021mds.dts
+++ b/arch/powerpc/boot/dts/p1021mds.dts
@@ -291,19 +291,18 @@
 			cell-index = <0>;
 			#address-cells = <1>;
 			#size-cells = <0>;
-			compatible = "fsl,espi";
+			compatible = "fsl,p1021-espi", "fsl,mpc8536-espi";
 			reg = <0x7000 0x1000>;
 			interrupts = <59 0x2>;
 			interrupt-parent = <&mpic>;
-			espi,num-ss-bits = <4>;
-			mode = "cpu";
+			fsl,espi-num-chipselects = <4>;
+
 
 			fsl_m25p80@0 {
 				#address-cells = <1>;
 				#size-cells = <1>;
-				compatible = "fsl,espi-flash";
+				compatible = "spansion,s25sl12801";
 				reg = <0>;
-				linux,modalias = "fsl_m25p80";
 				spi-max-frequency = <40000000>; /* input clock */
 				partition@u-boot {
 					label = "u-boot-spi";
diff --git a/arch/powerpc/boot/dts/p1021mds_camp_core0.dts b/arch/powerpc/boot/dts/p1021mds_camp_core0.dts
index 8fb2af6..65e7063 100644
--- a/arch/powerpc/boot/dts/p1021mds_camp_core0.dts
+++ b/arch/powerpc/boot/dts/p1021mds_camp_core0.dts
@@ -199,19 +199,17 @@
 			cell-index = <0>;
 			#address-cells = <1>;
 			#size-cells = <0>;
-			compatible = "fsl,espi";
+			compatible = "fsl,p1021-espi", "fsl,mpc8536-espi";
 			reg = <0x7000 0x1000>;
 			interrupts = <59 0x2>;
 			interrupt-parent = <&mpic>;
-			espi,num-ss-bits = <4>;
-			mode = "cpu";
+			fsl,espi-num-chipselects = <4>;
 
 			fsl_m25p80@0 {
 				#address-cells = <1>;
 				#size-cells = <1>;
-				compatible = "fsl,espi-flash";
+				compatible = "spansion,s25sl12801";
 				reg = <0>;
-				linux,modalias = "fsl_m25p80";
 				spi-max-frequency = <40000000>; /* input clock */
 				partition@u-boot {
 					label = "u-boot-spi";
diff --git a/arch/powerpc/boot/dts/p1021mds_tdm.dts b/arch/powerpc/boot/dts/p1021mds_tdm.dts
index 6cfe231..2113a4f 100644
--- a/arch/powerpc/boot/dts/p1021mds_tdm.dts
+++ b/arch/powerpc/boot/dts/p1021mds_tdm.dts
@@ -237,19 +237,17 @@
 			cell-index = <0>;
 			#address-cells = <1>;
 			#size-cells = <0>;
-			compatible = "fsl,espi";
+			compatible = "fsl,p1021-espi", "fsl,mpc8536-espi";
 			reg = <0x7000 0x1000>;
 			interrupts = <59 0x2>;
 			interrupt-parent = <&mpic>;
-			espi,num-ss-bits = <4>;
-			mode = "cpu";
+			fsl,espi-num-chipselects = <4>;
 
 			fsl_m25p80@0 {
 				#address-cells = <1>;
 				#size-cells = <1>;
-				compatible = "fsl,espi-flash";
+				compatible = "spansion,s25sl12801";
 				reg = <0>;
-				linux,modalias = "fsl_m25p80";
 				spi-max-frequency = <40000000>; /* input clock */
 				partition@u-boot {
 					label = "u-boot-spi";
-- 
1.7.0.4

