From 3e083e54ab3a8f91c60435267c5e9e13c34d7e30 Mon Sep 17 00:00:00 2001
From: Axel Lin <axel.lin@ingics.com>
Date: Thu, 22 Aug 2013 23:41:34 +0800
Subject: [PATCH 1033/1072] spi: Remove a redundant test for master->running
 in spi_queued_transfer

commit 96b3eace39d2ecfdb07003856ddd8f6973dfe7bb upstream

We have tested master->running immediately after grab the master->queue_lock.
The status of master->running won't be changed until we release the lock.
Thus remove a redundant test for master->running.

Signed-off-by: Axel Lin <axel.lin@ingics.com>
Signed-off-by: Mark Brown <broonie@linaro.org>
Signed-off-by: Hongbo Zhong <hongbo.zhong@windriver.com>
---
 drivers/spi/spi.c |    2 +-
 1 files changed, 1 insertions(+), 1 deletions(-)

diff --git a/drivers/spi/spi.c b/drivers/spi/spi.c
index c19da0f..a8d0752 100644
--- a/drivers/spi/spi.c
+++ b/drivers/spi/spi.c
@@ -790,7 +790,7 @@ static int spi_queued_transfer(struct spi_device *spi, struct spi_message *msg)
 	msg->status = -EINPROGRESS;
 
 	list_add_tail(&msg->queue, &master->queue);
-	if (master->running && !master->busy)
+	if (!master->busy)
 		queue_kthread_work(&master->kworker, &master->pump_messages);
 
 	spin_unlock_irqrestore(&master->queue_lock, flags);
-- 
1.7.5.4

