From 809f71dc17b93b1fd5b9ca5c9166a9c702249ae6 Mon Sep 17 00:00:00 2001
From: Fabio Estevam <fabio.estevam@freescale.com>
Date: Thu, 13 Jun 2013 17:59:51 +0300
Subject: [PATCH 0648/1072] usb: chipidea: ci13xxx_imx: remove 'phy_np'

commit 05f6353b830768d2f3ac34005975e78b4dc7ec45 upstream

There is no need to keep a local 'phy_np' as we can directly use the private
structure in data->phy_np.

Signed-off-by: Fabio Estevam <fabio.estevam@freescale.com>
Signed-off-by: Alexander Shishkin <alexander.shishkin@linux.intel.com>
Signed-off-by: Greg Kroah-Hartman <gregkh@linuxfoundation.org>
Signed-off-by: Hongbo Zhong <hongbo.zhong@windriver.com>
---
 drivers/usb/chipidea/ci13xxx_imx.c |   12 +++++-------
 1 files changed, 5 insertions(+), 7 deletions(-)

diff --git a/drivers/usb/chipidea/ci13xxx_imx.c b/drivers/usb/chipidea/ci13xxx_imx.c
index 75f553b..aef5b5b 100644
--- a/drivers/usb/chipidea/ci13xxx_imx.c
+++ b/drivers/usb/chipidea/ci13xxx_imx.c
@@ -99,7 +99,6 @@ static int ci13xxx_imx_probe(struct platform_device *pdev)
 {
 	struct ci13xxx_imx_data *data;
 	struct platform_device *phy_pdev;
-	struct device_node *phy_np;
 	struct resource *res;
 	int ret;
 
@@ -133,10 +132,9 @@ static int ci13xxx_imx_probe(struct platform_device *pdev)
 		return ret;
 	}
 
-	phy_np = of_parse_phandle(pdev->dev.of_node, "fsl,usbphy", 0);
-	if (phy_np) {
-		data->phy_np = phy_np;
-		phy_pdev = of_find_device_by_node(phy_np);
+	data->phy_np = of_parse_phandle(pdev->dev.of_node, "fsl,usbphy", 0);
+	if (data->phy_np) {
+		phy_pdev = of_find_device_by_node(data->phy_np);
 		if (phy_pdev) {
 			struct usb_phy *phy;
 			phy = pdev_to_phy(phy_pdev);
@@ -211,8 +209,8 @@ err:
 	if (data->reg_vbus)
 		regulator_disable(data->reg_vbus);
 put_np:
-	if (phy_np)
-		of_node_put(phy_np);
+	if (data->phy_np)
+		of_node_put(data->phy_np);
 	clk_disable_unprepare(data->clk);
 	return ret;
 }
-- 
1.7.5.4

