From 6c6a47dfeb81f33d9b9e523bfba953faf222631c Mon Sep 17 00:00:00 2001
From: Anson Huang <b20788@freescale.com>
Date: Mon, 14 Oct 2013 15:06:15 -0400
Subject: [PATCH 0964/1072] ENGR00283508-1 pwm: imx: support pin sleep mode in
 suspend

git://git.freescale.com/imx/linux-2.6-imx.git imx_3.10.17_1.0.0_beta
commit f5fef1524798979c99a1b36afb8e5e489e502888

When system suspend, need to switch pwm pin to sleep mode,
this is to save IO power. Using pinctrl mode switch framework
to make it happen.

Signed-off-by: Anson Huang <b20788@freescale.com>
Signed-off-by: Hongbo Zhong <hongbo.zhong@windriver.com>
---
 drivers/pwm/pwm-imx.c |   25 +++++++++++++++++++++++++
 1 files changed, 25 insertions(+), 0 deletions(-)

diff --git a/drivers/pwm/pwm-imx.c b/drivers/pwm/pwm-imx.c
index c938bae..45ad148 100644
--- a/drivers/pwm/pwm-imx.c
+++ b/drivers/pwm/pwm-imx.c
@@ -1,4 +1,5 @@
 /*
+ * Copyright (C) 2013 Freescale Semiconductor, Inc.
  * simple driver for PWM (Pulse Width Modulator) controller
  *
  * This program is free software; you can redistribute it and/or modify
@@ -292,10 +293,34 @@ static int imx_pwm_remove(struct platform_device *pdev)
 	return pwmchip_remove(&imx->chip);
 }
 
+#ifdef CONFIG_PM
+static int imx_pwm_suspend(struct device *dev)
+{
+	pinctrl_pm_select_sleep_state(dev);
+
+	return 0;
+}
+
+static int imx_pwm_resume(struct device *dev)
+{
+	pinctrl_pm_select_default_state(dev);
+
+	return 0;
+}
+
+static const struct dev_pm_ops imx_pwm_pm_ops = {
+	SET_SYSTEM_SLEEP_PM_OPS(imx_pwm_suspend, imx_pwm_resume)
+};
+#endif
+
+
 static struct platform_driver imx_pwm_driver = {
 	.driver		= {
 		.name	= "imx-pwm",
 		.of_match_table = of_match_ptr(imx_pwm_dt_ids),
+#ifdef CONFIG_PM
+		.pm     = &imx_pwm_pm_ops,
+#endif
 	},
 	.probe		= imx_pwm_probe,
 	.remove		= imx_pwm_remove,
-- 
1.7.5.4

