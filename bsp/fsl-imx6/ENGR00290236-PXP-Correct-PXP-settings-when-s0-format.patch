From ef4af4b2d2ff5fc55e45d17b5a02ab1ffe0366ef Mon Sep 17 00:00:00 2001
From: Fancy Fang <B47543@freescale.com>
Date: Fri, 29 Nov 2013 18:37:45 +0800
Subject: [PATCH 0842/1072] ENGR00290236 PXP: Correct PXP settings when s0
 format is PXP_PIX_FMT_YUV422P

git://git.freescale.com/imx/linux-2.6-imx.git imx_3.10.17_1.0.0_beta
commit 23bf8b3e9650af832cbcf73f8d6e50c017476fb2

When the s0 format is PXP_PIX_FMT_YUV422P, the s0 pitch and U/V
buffer address cannot be set correctly.

Signed-off-by: Fancy Fang <B47543@freescale.com>
(cherry picked from commit eb887a646c992ee455edfc1fe482cfbced95b187)
Signed-off-by: Hongbo Zhong <hongbo.zhong@windriver.com>
---
 drivers/dma/pxp/pxp_dma_v2.c |    8 ++++++--
 1 files changed, 6 insertions(+), 2 deletions(-)

diff --git a/drivers/dma/pxp/pxp_dma_v2.c b/drivers/dma/pxp/pxp_dma_v2.c
index 6ec441b..0cd8c71 100644
--- a/drivers/dma/pxp/pxp_dma_v2.c
+++ b/drivers/dma/pxp/pxp_dma_v2.c
@@ -902,9 +902,12 @@ static void pxp_set_s0buf(struct pxps *pxp)
 	__raw_writel(Y1, pxp->base + HW_PXP_PS_BUF);
 	if ((s0_params->pixel_fmt == PXP_PIX_FMT_YUV420P) ||
 	    (s0_params->pixel_fmt == PXP_PIX_FMT_YVU420P) ||
-	    (s0_params->pixel_fmt == PXP_PIX_FMT_GREY)) {
+	    (s0_params->pixel_fmt == PXP_PIX_FMT_GREY)    ||
+	    (s0_params->pixel_fmt == PXP_PIX_FMT_YUV422P)) {
 		/* Set to 1 if YUV format is 4:2:2 rather than 4:2:0 */
 		int s = 2;
+		if (s0_params->pixel_fmt == PXP_PIX_FMT_YUV422P)
+			s = 1;
 
 		offset = proc_data->srect.top * s0_params->width / 4 +
 			 proc_data->srect.left / 2;
@@ -938,7 +941,8 @@ static void pxp_set_s0buf(struct pxps *pxp)
 	    s0_params->pixel_fmt == PXP_PIX_FMT_NV12 ||
 	    s0_params->pixel_fmt == PXP_PIX_FMT_NV21 ||
 	    s0_params->pixel_fmt == PXP_PIX_FMT_NV16 ||
-	    s0_params->pixel_fmt == PXP_PIX_FMT_NV61) {
+	    s0_params->pixel_fmt == PXP_PIX_FMT_NV61 ||
+	    s0_params->pixel_fmt == PXP_PIX_FMT_YUV422P) {
 		__raw_writel(pitch, pxp->base + HW_PXP_PS_PITCH);
 	}
 	else if (s0_params->pixel_fmt == PXP_PIX_FMT_GY04)
-- 
1.7.5.4

