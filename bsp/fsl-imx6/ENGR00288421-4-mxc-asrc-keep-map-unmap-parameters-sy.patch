From 29ebbde12b900e358529eb48a4c0ca62f0622e64 Mon Sep 17 00:00:00 2001
From: Nicolin Chen <b42378@freescale.com>
Date: Tue, 19 Nov 2013 14:57:00 +0800
Subject: [PATCH 0610/1072] ENGR00288421-4 mxc: asrc: keep map/unmap
 parameters symmetic

git://git.freescale.com/imx/linux-2.6-imx.git imx_3.10.17_1.0.0_beta
commit 25f5bf306813c53ccae471039a4c1f99d765088d

We are using DEV_TO_MEM for dma_map but MEM_TO_DEV for dma_unmap, thus fix it.
It also adds missing device pointer since assigning it to dma_free_coherent().

Acked-by: Wang Shengjiu <b02247@freescale.com>
Signed-off-by: Nicolin Chen <b42378@freescale.com>
(cherry picked from commit fad1c9c08ff32a706624fb52d72e78c68282dda1)
Signed-off-by: Hongbo Zhong <hongbo.zhong@windriver.com>
---
 drivers/mxc/asrc/mxc_asrc.c |    6 +++---
 1 files changed, 3 insertions(+), 3 deletions(-)

diff --git a/drivers/mxc/asrc/mxc_asrc.c b/drivers/mxc/asrc/mxc_asrc.c
index 377de8f..7c1dd8f 100644
--- a/drivers/mxc/asrc/mxc_asrc.c
+++ b/drivers/mxc/asrc/mxc_asrc.c
@@ -668,7 +668,7 @@ static void asrc_output_dma_callback(void *data)
 	struct asrc_pair_params *params = (struct asrc_pair_params *)data;
 
 	dma_unmap_sg(NULL, params->output_sg, params->output_sg_nodes,
-			DMA_MEM_TO_DEV);
+			DMA_DEV_TO_MEM);
 
 	complete(&params->output_complete);
 }
@@ -797,7 +797,7 @@ static int mxc_allocate_dma_buf(struct asrc_pair_params *params)
 	}
 	output_a->dma_paddr = virt_to_dma(NULL, output_a->dma_vaddr);
 
-	last_period->dma_vaddr = dma_alloc_coherent(NULL,
+	last_period->dma_vaddr = dma_alloc_coherent(asrc->dev,
 			1024 * params->last_period_sample,
 			&last_period->dma_paddr, GFP_KERNEL);
 	if (!last_period->dma_vaddr) {
@@ -1146,7 +1146,7 @@ static void asrc_polling_debug(struct asrc_pair_params *params)
 	dma_unmap_sg(NULL, params->input_sg, params->input_sg_nodes,
 			DMA_MEM_TO_DEV);
 	dma_unmap_sg(NULL, params->output_sg, params->output_sg_nodes,
-			DMA_MEM_TO_DEV);
+			DMA_DEV_TO_MEM);
 
 	complete(&params->input_complete);
 	complete(&params->lastperiod_complete);
-- 
1.7.5.4

