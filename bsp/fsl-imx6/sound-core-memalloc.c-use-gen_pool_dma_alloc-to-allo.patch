From 84ce0ec76adebfc52ec6d0a8343ef87b375704fb Mon Sep 17 00:00:00 2001
From: Nicolin Chen <b42378@freescale.com>
Date: Thu, 14 Nov 2013 14:32:15 -0800
Subject: [PATCH 1051/1072] sound/core/memalloc.c: use gen_pool_dma_alloc() to
 allocate iram buffer

commit 07968fe4acec6d49e39520ef407ea7f6874b7c2e upstream

Since gen_pool_dma_alloc() is introduced, we implement it to simplify code.

Signed-off-by: Nicolin Chen <b42378@freescale.com>
Acked-by: Takashi Iwai <tiwai@suse.de>
Signed-off-by: Andrew Morton <akpm@linux-foundation.org>
Signed-off-by: Linus Torvalds <torvalds@linux-foundation.org>
Signed-off-by: Hongbo Zhong <hongbo.zhong@windriver.com>
---
 sound/core/memalloc.c |    6 +-----
 1 files changed, 1 insertions(+), 5 deletions(-)

diff --git a/sound/core/memalloc.c b/sound/core/memalloc.c
index 809fd79..e0af805 100644
--- a/sound/core/memalloc.c
+++ b/sound/core/memalloc.c
@@ -181,11 +181,7 @@ void snd_malloc_dev_iram(struct snd_dma_buffer *dmab, size_t size)
 	/* Assign the pool into private_data field */
 	dmab->private_data = pool;
 
-	dmab->area = (void *)gen_pool_alloc(pool, size);
-	if (!dmab->area)
-		return;
-
-	dmab->addr = gen_pool_virt_to_phys(pool, (unsigned long)dmab->area);
+	dmab->area = gen_pool_dma_alloc(pool, size, &dmab->addr);
 }
 
 /**
-- 
1.7.5.4

