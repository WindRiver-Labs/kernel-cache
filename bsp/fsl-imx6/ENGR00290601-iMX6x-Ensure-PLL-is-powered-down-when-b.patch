From aaabe0964b4143f4297333af01fe25d5ae527b0a Mon Sep 17 00:00:00 2001
From: Ranjani Vaidyanathan <ra5478@freescale.com>
Date: Tue, 3 Dec 2013 11:40:52 -0800
Subject: [PATCH 0365/1072] ENGR00290601 [iMX6x] Ensure PLL is powered down
 when bypass rate is requested.

git://git.freescale.com/imx/linux-2.6-imx.git imx_3.10.17_1.0.0_beta
commit 6cebd8c3ce73d30a482d3b943a965e4f4794eeda

Ensure that PLL is powered down when bypass rate is requested and
power it up when some other rate is requested.

Signed-off-by: Ranjani Vaidyanathan <ra5478@freescale.com>
Signed-off-by: Hongbo Zhong <hongbo.zhong@windriver.com>
---
 arch/arm/mach-imx/clk-pllv3.c |    5 +++--
 1 files changed, 3 insertions(+), 2 deletions(-)

diff --git a/arch/arm/mach-imx/clk-pllv3.c b/arch/arm/mach-imx/clk-pllv3.c
index f187052..b73756e 100644
--- a/arch/arm/mach-imx/clk-pllv3.c
+++ b/arch/arm/mach-imx/clk-pllv3.c
@@ -172,10 +172,11 @@ static int clk_pllv3_set_rate(struct clk_hw *hw, unsigned long rate,
 	if (rate == BYPASS_RATE) {
 		/* Set the bypass bit. */
 		val |= BM_PLL_BYPASS;
+		/* Power down the PLL. */
 		if (pll->powerup_set)
-			val |= BM_PLL_POWER;
-		else
 			val &= ~BM_PLL_POWER;
+		else
+			val |= BM_PLL_POWER;
 		writel_relaxed(val, pll->base);
 
 		return 0;
-- 
1.7.5.4

