From e06b262d48fb9dddb64241112f039d3035aea034 Mon Sep 17 00:00:00 2001
From: Peter Chen <peter.chen@freescale.com>
Date: Thu, 28 Nov 2013 16:06:44 +0800
Subject: [PATCH 0750/1072] ENGR00290034 usb: imx6-usb-charger: disable
 charger if it is not configurated

git://git.freescale.com/imx/linux-2.6-imx.git imx_3.10.17_1.0.0_beta
commit 465aa30deea0cc927186170e63180cb7307366d0

If the user set imx6-usb-charger-detection at dts, but not enable
CONFIG_IMX6_USB_CHARGER, the imx6_usb_create_charger will return
-ENODEV, and the controlller probe will fail, it is not we want,
what we expect is the charger detection has disabled, but controller
function should not be affected.

We are not sure if power supply core will return -ENODEV at some fail
cases, so we use IS_ENABLED(CONFIG_IMX6_USB_CHARGER) to enable
charger function for satety.

Signed-off-by: Peter Chen <peter.chen@freescale.com>
Signed-off-by: Hongbo Zhong <hongbo.zhong@windriver.com>
---
 drivers/usb/chipidea/ci_hdrc_imx.c |    3 ++-
 1 files changed, 2 insertions(+), 1 deletions(-)

diff --git a/drivers/usb/chipidea/ci_hdrc_imx.c b/drivers/usb/chipidea/ci_hdrc_imx.c
index 8994f4b..0cb2961 100644
--- a/drivers/usb/chipidea/ci_hdrc_imx.c
+++ b/drivers/usb/chipidea/ci_hdrc_imx.c
@@ -228,7 +228,8 @@ static int ci_hdrc_imx_probe(struct platform_device *pdev)
 		}
 	}
 
-	if (of_find_property(np, "imx6-usb-charger-detection", NULL))
+	if (of_find_property(np, "imx6-usb-charger-detection", NULL) &&
+			IS_ENABLED(CONFIG_IMX6_USB_CHARGER))
 		data->imx6_usb_charger_detection = true;
 
 	if (data->imx6_usb_charger_detection) {
-- 
1.7.5.4

