From b93f7c5f08ae003f03b4c17ff436f95e6320ee21 Mon Sep 17 00:00:00 2001
From: Zhong Hongbo <hongbo.zhong@windriver.com>
Date: Fri, 7 Jun 2013 11:57:25 +0800
Subject: [PATCH 14/38] fsl_imx6q: Add backlight init for mx6q

Source: Extract from vendor-drop package, L3.0.35_4.0.0_130424_source.tar.gz

Signed-off-by: Zhong Hongbo <hongbo.zhong@windriver.com>
---
 arch/arm/mach-mx6/board-mx6q_arm2.c      |   14 ++++++++++++++
 arch/arm/mach-mx6/board-mx6q_sabreauto.c |   15 +++++++++++++++
 arch/arm/mach-mx6/board-mx6q_sabrelite.c |   14 ++++++++++++++
 arch/arm/mach-mx6/board-mx6q_sabresd.c   |   14 ++++++++++++++
 arch/arm/mach-mx6/board-mx6sl_arm2.c     |   15 +++++++++++++++
 arch/arm/mach-mx6/board-mx6sl_evk.c      |   14 ++++++++++++++
 6 files changed, 86 insertions(+), 0 deletions(-)

diff --git a/arch/arm/mach-mx6/board-mx6q_arm2.c b/arch/arm/mach-mx6/board-mx6q_arm2.c
index 82c1d73..4fa2eb2 100644
--- a/arch/arm/mach-mx6/board-mx6q_arm2.c
+++ b/arch/arm/mach-mx6/board-mx6q_arm2.c
@@ -1514,11 +1514,25 @@ static struct imx_ipuv3_platform_data ipu_data[] = {
 	},
 };
 
+static int check_fb(struct device *dev, struct fb_info *info)
+{
+	char *id = info->fix.id;
+
+	if (!strcmp(id, "DISP3 BG") ||
+		!strcmp(id, "DISP3 BG - DI1") ||
+		!strcmp(id, "DISP4 BG") ||
+		!strcmp(id, "DISP4 BG - DI1"))
+		return 1;
+	else
+		return 0;
+}
+
 static struct platform_pwm_backlight_data mx6_arm2_pwm_backlight_data = {
 	.pwm_id		= 0,
 	.max_brightness	= 255,
 	.dft_brightness	= 128,
 	.pwm_period_ns	= 50000,
+	.check_fb = check_fb,
 };
 
 static struct gpio mx6_flexcan_gpios[] = {
diff --git a/arch/arm/mach-mx6/board-mx6q_sabreauto.c b/arch/arm/mach-mx6/board-mx6q_sabreauto.c
index f4472b2..9156525 100644
--- a/arch/arm/mach-mx6/board-mx6q_sabreauto.c
+++ b/arch/arm/mach-mx6/board-mx6q_sabreauto.c
@@ -1102,12 +1102,26 @@ static struct imx_ipuv3_platform_data ipu_data[] = {
 	},
 };
 
+static int check_fb(struct device *dev, struct fb_info *info)
+{
+	char *id = info->fix.id;
+
+	if (!strcmp(id, "DISP3 BG") ||
+		!strcmp(id, "DISP3 BG - DI1") ||
+		!strcmp(id, "DISP4 BG") ||
+		!strcmp(id, "DISP4 BG - DI1"))
+		return 1;
+	else
+		return 0;
+}
+
 /* Backlight PWM for CPU board lvds*/
 static struct platform_pwm_backlight_data mx6_arm2_pwm_backlight_data3 = {
 	.pwm_id			= 2,
 	.max_brightness		= 255,
 	.dft_brightness		= 128,
 	.pwm_period_ns		= 50000,
+	.check_fb = check_fb,
 };
 
 /* Backlight PWM for Main board lvds*/
@@ -1116,6 +1130,7 @@ static struct platform_pwm_backlight_data mx6_arm2_pwm_backlight_data4 = {
 	.max_brightness		= 255,
 	.dft_brightness		= 128,
 	.pwm_period_ns		= 50000,
+	.check_fb = check_fb,
 };
 static int flexcan0_en;
 static int flexcan1_en;
diff --git a/arch/arm/mach-mx6/board-mx6q_sabrelite.c b/arch/arm/mach-mx6/board-mx6q_sabrelite.c
index 5fa38ac..aa0f850 100644
--- a/arch/arm/mach-mx6/board-mx6q_sabrelite.c
+++ b/arch/arm/mach-mx6/board-mx6q_sabrelite.c
@@ -1097,11 +1097,25 @@ static int imx6q_init_audio(void)
 	return 0;
 }
 
+static int check_fb(struct device *dev, struct fb_info *info)
+{
+	char *id = info->fix.id;
+
+	if (!strcmp(id, "DISP3 BG") ||
+		!strcmp(id, "DISP3 BG - DI1") ||
+		!strcmp(id, "DISP4 BG") ||
+		!strcmp(id, "DISP4 BG - DI1"))
+		return 1;
+	else
+		return 0;
+}
+
 static struct platform_pwm_backlight_data mx6_sabrelite_pwm_backlight_data = {
 	.pwm_id = 3,
 	.max_brightness = 255,
 	.dft_brightness = 128,
 	.pwm_period_ns = 50000,
+	.check_fb = check_fb,
 };
 
 static struct mxc_dvfs_platform_data sabrelite_dvfscore_data = {
diff --git a/arch/arm/mach-mx6/board-mx6q_sabresd.c b/arch/arm/mach-mx6/board-mx6q_sabresd.c
index 591c0ff..b66b4fa 100644
--- a/arch/arm/mach-mx6/board-mx6q_sabresd.c
+++ b/arch/arm/mach-mx6/board-mx6q_sabresd.c
@@ -1622,11 +1622,25 @@ static void __init imx6q_add_device_buttons(void)
 static void __init imx6q_add_device_buttons(void) {}
 #endif
 
+static int check_fb(struct device *dev, struct fb_info *info)
+{
+	char *id = info->fix.id;
+
+	if (!strcmp(id, "DISP3 BG") ||
+		!strcmp(id, "DISP3 BG - DI1") ||
+		!strcmp(id, "DISP4 BG") ||
+		!strcmp(id, "DISP4 BG - DI1"))
+		return 1;
+	else
+		return 0;
+}
+
 static struct platform_pwm_backlight_data mx6_sabresd_pwm_backlight_data = {
 	.pwm_id = 0,
 	.max_brightness = 248,
 	.dft_brightness = 128,
 	.pwm_period_ns = 50000,
+	.check_fb = check_fb,
 };
 
 static struct mxc_dvfs_platform_data sabresd_dvfscore_data = {
diff --git a/arch/arm/mach-mx6/board-mx6sl_arm2.c b/arch/arm/mach-mx6/board-mx6sl_arm2.c
index a1d077e..8a6da00 100644
--- a/arch/arm/mach-mx6/board-mx6sl_arm2.c
+++ b/arch/arm/mach-mx6/board-mx6sl_arm2.c
@@ -1085,12 +1085,27 @@ static void __init mx6_arm2_init_usb(void)
 #endif
 }
 
+static int check_fb(struct device *dev, struct fb_info *info)
+{
+	char *id = info->fix.id;
+
+	if (!strcmp(id, "DISP3 BG") ||
+		!strcmp(id, "DISP3 BG - DI1") ||
+		!strcmp(id, "DISP4 BG") ||
+		!strcmp(id, "DISP4 BG - DI1"))
+		return 1;
+	else
+		return 0;
+}
+
 static struct platform_pwm_backlight_data mx6_arm2_pwm_backlight_data = {
 	.pwm_id		= 0,
 	.max_brightness	= 255,
 	.dft_brightness	= 128,
 	.pwm_period_ns	= 50000,
+	.check_fb = check_fb,
 };
+
 static struct fb_videomode video_modes[] = {
 	{
 	 /* 800x480 @ 57 Hz , pixel clk @ 32MHz */
diff --git a/arch/arm/mach-mx6/board-mx6sl_evk.c b/arch/arm/mach-mx6/board-mx6sl_evk.c
index 4cc9366..86aaed3 100644
--- a/arch/arm/mach-mx6/board-mx6sl_evk.c
+++ b/arch/arm/mach-mx6/board-mx6sl_evk.c
@@ -1288,11 +1288,25 @@ static void __init mx6_evk_init_usb(void)
 #endif
 }
 
+static int check_fb(struct device *dev, struct fb_info *info)
+{
+	char *id = info->fix.id;
+
+	if (!strcmp(id, "DISP3 BG") ||
+		!strcmp(id, "DISP3 BG - DI1") ||
+		!strcmp(id, "DISP4 BG") ||
+		!strcmp(id, "DISP4 BG - DI1"))
+		return 1;
+	else
+		return 0;
+}
+
 static struct platform_pwm_backlight_data mx6_evk_pwm_backlight_data = {
 	.pwm_id		= 0,
 	.max_brightness	= 255,
 	.dft_brightness	= 128,
 	.pwm_period_ns	= 50000,
+	.check_fb = check_fb,
 };
 static struct fb_videomode wvga_video_modes[] = {
 	{
-- 
1.7.5.4

