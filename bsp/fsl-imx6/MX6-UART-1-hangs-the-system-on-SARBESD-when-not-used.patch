From e7281c620c804c38c906c14d8b25f7dc9d544db5 Mon Sep 17 00:00:00 2001
From: Lijun Guo <Lijun.Guo@windriver.com>
Date: Thu, 12 Feb 2015 13:26:33 +0800
Subject: [PATCH] MX6: UART 1 hangs the system on SARBESD when not used a
 console

original patch link:
https://git.congatec.com/arm/qmx6_kernel/commit/4a523565f6783c3361b77c6241afae898fc629ef

The platform hangs if UART 1 is not used a console on MX6 SABRESD. The
issue is because the UART UFCR register is not initialized and the
driver uses values provided by the bootloader  (U-Boot in this case).
This patch initializes the UFCR register and does not rely on the
default or what is configured by the bootloader.

Test method on MX6 SABRESD:
	1. Add 'noconsole' to the kernel command line.
	2. SSH to the board and type the below from the SSH window:
	   echo Hello >/dev/ttymxc1
	3. Platform will hang, with the patch the hang will not be seen.

Signed-off-by: Mahesh Mahadevan <Mahesh.Mahadevan@freescale.com>
Signed-off-by: Lijun Guo <Lijun.Guo@windriver.com>
---
 drivers/tty/serial/imx.c |    2 --
 1 files changed, 0 insertions(+), 2 deletions(-)

diff --git a/drivers/tty/serial/imx.c b/drivers/tty/serial/imx.c
index cfdd353..9a0a8f3 100644
--- a/drivers/tty/serial/imx.c
+++ b/drivers/tty/serial/imx.c
@@ -979,9 +979,7 @@ static int imx_startup(struct uart_port *port)
 
 	clk_enable(sport->clk);
 
-#ifndef CONFIG_SERIAL_CORE_CONSOLE
 	imx_setup_ufcr(sport, 0);
-#endif
 
 	/* disable the DREN bit (Data Ready interrupt enable) before
 	 * requesting IRQs
-- 
1.7.5.4

