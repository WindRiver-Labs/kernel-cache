From 5541da0b08c9a0680ac43e2018b51288ac5e5e4f Mon Sep 17 00:00:00 2001
From: Nicolin Chen <b42378@freescale.com>
Date: Tue, 3 Sep 2013 12:21:47 +0800
Subject: [PATCH 0503/1072] ENGR00277715-1 ASoC: codec: Enable cache-only
 before power down in probe()

git://git.freescale.com/imx/linux-2.6-imx.git imx_3.10.17_1.0.0_beta
commit f85a96590fd19086c188e78093fbf73f6e6b16a4

We need to enable cache-only for regcache before wm8962 being power-down.

Otherwise some configurations via amixer might be invalid before one stream,
playback or record, actually happens.

Acked-by: Wang Shengjiu <b02247@freescale.com>
Signed-off-by: Nicolin Chen <b42378@freescale.com>
Signed-off-by: Hongbo Zhong <hongbo.zhong@windriver.com>
---
 sound/soc/codecs/wm8962.c |    3 +++
 1 files changed, 3 insertions(+), 0 deletions(-)

diff --git a/sound/soc/codecs/wm8962.c b/sound/soc/codecs/wm8962.c
index 9c5da17..a6b9138 100644
--- a/sound/soc/codecs/wm8962.c
+++ b/sound/soc/codecs/wm8962.c
@@ -3755,6 +3755,9 @@ static int wm8962_i2c_probe(struct i2c_client *i2c,
 	if (ret < 0)
 		goto err_enable;
 
+	/* The cache-only should be turned on before we power down the codec */
+	regcache_cache_only(wm8962->regmap, true);
+
 	/* The drivers should power up as needed */
 	regulator_bulk_disable(ARRAY_SIZE(wm8962->supplies), wm8962->supplies);
 
-- 
1.7.5.4

