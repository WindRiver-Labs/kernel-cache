From de74415a507d1bc0e8f60051430569bcbd5adf74 Mon Sep 17 00:00:00 2001
From: Fugang Duan <B38611@freescale.com>
Date: Mon, 4 Nov 2013 17:37:05 +0800
Subject: [PATCH 0318/1072] ENGR00286060 arm: imx6q/dl: fix 1588 clock init
 fail

git://git.freescale.com/imx/linux-2.6-imx.git imx_3.10.17_1.0.0_beta
commit d8df31d4b738e92fc675a22c50d3536c5a886184

Bug log during kernel boot:
...
failed to find fsl,imx6q-iomux-gpr regmap
...

The issue is imx6q_1588_init() is called before of_platform_populate().

of_platform_populate() walks the device tree and creates devices from
nodes. imx6q_1588_init() call syscon_regmap_lookup_by_compatible() to
get the device base on the given device node, since the device cannot
created for the node, so it is failed.

So, move the 1588 init function to behind of of_platform_populate().

Signed-off-by: Fugang Duan  <B38611@freescale.com>
Signed-off-by: Hongbo Zhong <hongbo.zhong@windriver.com>
---
 arch/arm/mach-imx/mach-imx6q.c |    3 +--
 1 files changed, 1 insertions(+), 2 deletions(-)

diff --git a/arch/arm/mach-imx/mach-imx6q.c b/arch/arm/mach-imx/mach-imx6q.c
index 7476785..8df7de7 100644
--- a/arch/arm/mach-imx/mach-imx6q.c
+++ b/arch/arm/mach-imx/mach-imx6q.c
@@ -328,10 +328,9 @@ static void __init imx6q_init_machine(void)
 	if (parent == NULL)
 		pr_warn("failed to initialize soc device\n");
 
-	imx6q_enet_init();
-
 	of_platform_populate(NULL, of_default_bus_match_table, NULL, parent);
 
+	imx6q_enet_init();
 	imx_anatop_init();
 	imx6_pm_init();
 	imx6q_csi_mux_init();
-- 
1.7.5.4

