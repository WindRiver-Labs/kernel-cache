From 288b00d8f8fdf443ea997983a6909bcdf82076c4 Mon Sep 17 00:00:00 2001
From: Zhong Hongbo <hongbo.zhong@windriver.com>
Date: Fri, 14 Feb 2014 10:15:23 +0800
Subject: [PATCH 1066/1072] HDMI: Fix compile fail for hdmi audio

When CONFIG_MFD_MXC_HDMI is not set, The hdmi auido will fail
to compile.

sound/built-in.o: In function `hdmi_set_audio_infoframe':
sound/soc/fsl/fsl_hdmi.c:267: undefined reference to `hdmi_writeb'
sound/soc/fsl/fsl_hdmi.c:268: undefined reference to `hdmi_writeb'
sound/soc/fsl/fsl_hdmi.c:269: undefined reference to `hdmi_writeb'
sound/soc/fsl/fsl_hdmi.c:270: undefined reference to `hdmi_writeb'
sound/built-in.o: In function `fsl_hdmi_soc_prepare':
sound/soc/fsl/fsl_hdmi.c:404: undefined reference to `hdmi_mask_writeb'
sound/soc/fsl/fsl_hdmi.c:406: undefined reference to `hdmi_set_sample_rate'
sound/built-in.o: In function `fsl_hdmi_dai_probe':
sound/soc/fsl/fsl_hdmi.c:509: undefined reference to `hdmi_get_registered'
sound/built-in.o: In function `fsl_hdmi_update_constraints':
sound/soc/fsl/fsl_hdmi.c:339: undefined reference to `hdmi_get_edid_cfg'
sound/built-in.o: In function `fsl_hdmi_soc_startup':
sound/soc/fsl/fsl_hdmi.c:384: undefined reference to `hdmi_mask_writeb'
sound/built-in.o: In function `hdmi_dma_irq_set':
sound/soc/fsl/imx-hdmi-dma.c:192: undefined reference to `hdmi_readb'
sound/soc/fsl/imx-hdmi-dma.c:199: undefined reference to `hdmi_writeb'
sound/built-in.o: In function `hdmi_mask':
sound/soc/fsl/imx-hdmi-dma.c:204: undefined reference to `hdmi_readb'
sound/soc/fsl/imx-hdmi-dma.c:211: undefined reference to `hdmi_writeb'
sound/built-in.o: In function `hdmi_dma_trigger':

Signed-off-by: Zhong Hongbo <hongbo.zhong@windriver.com>
---
 drivers/mfd/mxc-hdmi-core.c |    6 ++++++
 1 files changed, 6 insertions(+), 0 deletions(-)

diff --git a/drivers/mfd/mxc-hdmi-core.c b/drivers/mfd/mxc-hdmi-core.c
index 2b0853c..cd9712e 100644
--- a/drivers/mfd/mxc-hdmi-core.c
+++ b/drivers/mfd/mxc-hdmi-core.c
@@ -98,6 +98,7 @@ unsigned int hdmi_set_blank_state(unsigned int state)
 }
 EXPORT_SYMBOL(hdmi_set_blank_state);
 
+#ifdef CONFIG_SND_SOC_IMX_HDMI_DMA
 static void hdmi_audio_abort_stream(struct snd_pcm_substream *substream)
 {
 	unsigned long flags;
@@ -120,6 +121,9 @@ int mxc_hdmi_abort_stream(void)
 
 	return 0;
 }
+#else
+int mxc_hdmi_abort_stream(void) { return 0; }
+#endif
 EXPORT_SYMBOL(mxc_hdmi_abort_stream);
 
 int check_hdmi_state(void)
@@ -139,6 +143,7 @@ int check_hdmi_state(void)
 }
 EXPORT_SYMBOL(check_hdmi_state);
 
+#ifdef CONFIG_SND_SOC_IMX_HDMI_DMA
 int mxc_hdmi_register_audio(struct snd_pcm_substream *substream)
 {
 	unsigned long flags, flags1;
@@ -172,6 +177,7 @@ void mxc_hdmi_unregister_audio(struct snd_pcm_substream *substream)
 	spin_unlock_irqrestore(&hdmi_audio_lock, flags);
 }
 EXPORT_SYMBOL(mxc_hdmi_unregister_audio);
+#endif
 
 u8 hdmi_readb(unsigned int reg)
 {
-- 
1.7.5.4

