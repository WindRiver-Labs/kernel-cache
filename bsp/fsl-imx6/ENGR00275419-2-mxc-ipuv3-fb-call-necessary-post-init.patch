From 360aec6bbdaeebf66b881546ce724197261d0280 Mon Sep 17 00:00:00 2001
From: Liu Ying <Ying.Liu@freescale.com>
Date: Thu, 15 Aug 2013 18:14:16 +0800
Subject: [PATCH 0554/1072] ENGR00275419-2 mxc ipuv3 fb: call necessary post
 init interface

git://git.freescale.com/imx/linux-2.6-imx.git imx_3.10.17_1.0.0_beta
commit 86d2958aa6de1f5e7426d106604081b3bcc724b9

This patch adds the post init mxc display driver function call
in the .probe() function to give a chance to display encoders
to defer necessary opertions after their dev_ids and disp_ids
pass usage check.

Signed-off-by: Liu Ying <Ying.Liu@freescale.com>
Signed-off-by: Hongbo Zhong <hongbo.zhong@windriver.com>
---
 drivers/video/mxc/mxc_ipuv3_fb.c |   11 +++++++++++
 1 files changed, 11 insertions(+), 0 deletions(-)

diff --git a/drivers/video/mxc/mxc_ipuv3_fb.c b/drivers/video/mxc/mxc_ipuv3_fb.c
index 99bc724..29b7333 100644
--- a/drivers/video/mxc/mxc_ipuv3_fb.c
+++ b/drivers/video/mxc/mxc_ipuv3_fb.c
@@ -2375,6 +2375,16 @@ static int mxcfb_probe(struct platform_device *pdev)
 		goto ipu_in_busy;
 	}
 
+	if (mxcfbi->dispdrv->drv->post_init) {
+		ret = mxcfbi->dispdrv->drv->post_init(mxcfbi->dispdrv,
+						mxcfbi->ipu_id,
+						mxcfbi->ipu_di);
+		if (ret < 0) {
+			dev_err(&pdev->dev, "post init failed\n");
+			goto post_init_failed;
+		}
+	}
+
 	res = platform_get_resource(pdev, IORESOURCE_MEM, 0);
 	if (res && res->start && res->end) {
 		fbi->fix.smem_len = res->end - res->start + 1;
@@ -2463,6 +2473,7 @@ static int mxcfb_probe(struct platform_device *pdev)
 mxcfb_setupoverlay_failed:
 mxcfb_register_failed:
 get_ipu_failed:
+post_init_failed:
 	ipu_clear_usage(mxcfbi->ipu_id, mxcfbi->ipu_di);
 ipu_in_busy:
 init_dispdrv_failed:
-- 
1.7.5.4

