From 2d9b6c23c65741c1c8b7d5b4ecd55b5e63bbe759 Mon Sep 17 00:00:00 2001
From: Zhang Xiao <xiao.zhang@windriver.com>
Date: Wed, 30 Dec 2009 11:04:12 +0800
Subject: [PATCH] Fix bugs of mxc nand flash driver

If only spare data was considered and no error occurred on it, no more error
correct operations needed. Modify the error byte location logic and make the
col value more safe.

Signed-off-by: Zhang Xiao <xiao.zhang@windriver.com>
---
 drivers/mtd/nand/mxc_nand.c |    3 +++
 1 files changed, 3 insertions(+), 0 deletions(-)

diff --git a/drivers/mtd/nand/mxc_nand.c b/drivers/mtd/nand/mxc_nand.c
index 5701c2e..1a3225d 100644
--- a/drivers/mtd/nand/mxc_nand.c
+++ b/drivers/mtd/nand/mxc_nand.c
@@ -335,6 +335,9 @@ static void mxc_nd_correct_ecc(struct mxc_nand_host *host,
 	if(spare && !(ecc_status & 0x3))
 		return;
 
+	if(spare && !(ecc_status & 0x3))
+		return;
+
 	if (((ecc_status & 0xC) == MAIN_SINGLEBIT_ERROR)
 			|| ((ecc_status & 0x3) == SPARE_SINGLEBIT_ERROR)) {
 		if (host->ecc_disabled) {
-- 
1.6.0.4

