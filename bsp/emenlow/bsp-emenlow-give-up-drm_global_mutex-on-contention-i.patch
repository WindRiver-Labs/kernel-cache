From 4ee2ae2967b59300f5acd18292688d34d6387f2e Mon Sep 17 00:00:00 2001
From: Tom Zanussi <tom.zanussi@intel.com>
Date: Wed, 25 Apr 2012 09:11:27 -0500
Subject: [PATCH 2/2] bsp/emenlow: give up drm_global_mutex on contention in
 drm_lock()

If drm_lock_take() fails, give up the global ioctl mutex and allow
other locked ioctls in the meantime.

Signed-off-by: Tom Zanussi <tom.zanussi@intel.com>
---
 drivers/gpu/drm-psb/drm_lock.c |    2 ++
 1 files changed, 2 insertions(+), 0 deletions(-)

diff --git a/drivers/gpu/drm-psb/drm_lock.c b/drivers/gpu/drm-psb/drm_lock.c
index b8e4a5d..ba6630e 100644
--- a/drivers/gpu/drm-psb/drm_lock.c
+++ b/drivers/gpu/drm-psb/drm_lock.c
@@ -89,7 +89,9 @@ int drm_lock(struct drm_device *dev, void *data, struct drm_file *file_priv)
 		}
 
 		/* Contention */
+		mutex_unlock(&drm_global_mutex);
 		schedule();
+		mutex_lock(&drm_global_mutex);
 		if (signal_pending(current)) {
 			ret = -ERESTARTSYS;
 			break;
-- 
1.7.5.4

