From c49e0e383a6baf3565a0248ff6021b45e2c6a719 Mon Sep 17 00:00:00 2001
From: Tonyliu <Bo.Liu@windriver.com>
Date: Fri, 19 Jun 2009 20:38:34 +0800
Subject: [PATCH] fsl_imx31pdk: update pmic core for regulator adaption

Original reference code source taken from Freescale
	BSP Global Package Pool.
	http://www.bitshrine.org/gpp/linux-2.6.24-imx_2.3.2.bz2

fsl_imx31pdk introduces pmic mc13783 regulator power control, so
delay pmic init routine after common regulator framework init done
and add mc13783 regulator registry into pmic init sequence.

Signed-off-by: Tonyliu <Bo.Liu@windriver.com>
---
 drivers/mxc/pmic/core/pmic_core_spi.c |    4 +++-
 1 files changed, 3 insertions(+), 1 deletions(-)

diff --git a/drivers/mxc/pmic/core/pmic_core_spi.c b/drivers/mxc/pmic/core/pmic_core_spi.c
index 18fabc1..c65992c 100644
--- a/drivers/mxc/pmic/core/pmic_core_spi.c
+++ b/drivers/mxc/pmic/core/pmic_core_spi.c
@@ -98,6 +98,8 @@ static void pmic_pdev_register(void)
 	platform_device_register(&rtc_ldm);
 	platform_device_register(&power_ldm);
 	platform_device_register(&light_ldm);
+
+	reg_mc13783_probe();
 }
 
 /*!
@@ -314,7 +316,7 @@ static void __exit pmic_exit(void)
 /*
  * Module entry points
  */
-subsys_initcall(pmic_init);
+subsys_initcall_sync(pmic_init);
 module_exit(pmic_exit);
 
 MODULE_DESCRIPTION("Core/Protocol driver for PMIC");
-- 
1.5.5.1

