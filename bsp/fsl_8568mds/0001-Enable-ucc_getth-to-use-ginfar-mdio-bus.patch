From 8f78edeb3e20b703ce959c85b789c386fc59238a Mon Sep 17 00:00:00 2001
From: Andrew Liu <shengping.liu@windriver.com>
Date: Thu, 2 Apr 2009 19:17:38 +0800
Subject: [PATCH] Enable ucc_getth to use ginfar mdio bus.

Generally, gianfar network uses gianfar_mdio bus,
ucc_geth network uses ucc-mdio,

however, on mpc8568mds board there is an exception due to
hardware default setup:
gianfar network and ucc_geth network both use gianfar_mdio
bus, which gives rise to an issue correspondingly .

In previous kernel, when gianfar network and ucc_geth network
driver connect to a phy on mdio bus, both use bus_id:phy_id as
like:
   e0024520:07               // note, mdio bus_id is eight bytes.

In current kernel, the ginfar mdio bus_id is represented by
five bytes.
ucc_geth network driver connect to a phy
on mdio bus as previous using bus_id:phy_id:
   e0024520:07               // note, mdio bus_id is eight bytes.

gianfar network  driver connect to a phy on mdio bus as previous
using bus_id:phy_id:
   24520:07               // note, bus_id is 5 bytes.

Thus, cause ucc_geth network not to find the given phy.

Signed-off-by: Andrew Liu <shengping.liu@windriver.com>
---
 arch/powerpc/sysdev/fsl_soc.c |    4 ++--
 1 files changed, 2 insertions(+), 2 deletions(-)

diff --git a/arch/powerpc/sysdev/fsl_soc.c b/arch/powerpc/sysdev/fsl_soc.c
index dd1d7ed..a43a366 100644
--- a/arch/powerpc/sysdev/fsl_soc.c
+++ b/arch/powerpc/sysdev/fsl_soc.c
@@ -224,7 +224,7 @@ static int gfar_mdio_of_init_one(struct device_node *np)
 		return ret;
 
 	mdio_dev = platform_device_register_simple("fsl-gianfar_mdio",
-			res.start&0xfffff, &res, 1);
+			res.start, &res, 1);
 	if (IS_ERR(mdio_dev))
 		return PTR_ERR(mdio_dev);
 
@@ -388,7 +388,7 @@ static int __init gfar_of_init(void)
 
 			gfar_data.phy_id = *id;
 			snprintf(gfar_data.bus_id, MII_BUS_ID_SIZE, "%llx",
-				 (unsigned long long)res.start&0xfffff);
+				 (unsigned long long)res.start);
 
 			of_node_put(phy);
 			of_node_put(mdio);
-- 
1.6.0.4

