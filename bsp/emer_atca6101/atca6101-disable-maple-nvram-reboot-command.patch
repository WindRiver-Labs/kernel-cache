From 7d845434036797b9fe62795ae125292a852b9585 Mon Sep 17 00:00:00 2001
From: Jonathan Fournier <jonathan.fournier@windriver.com>
Date: Sat, 31 Jan 2009 20:22:07 -0500
Subject: [PATCH] atca6101: disable maple nvram reboot command

Disabling the Maple nvram command to reboot, because it already
damaged one of our board. Still investigating, but removing those
outb_p() is a noop since the hardware support isn't there. Requires
IPMI support to reboot.

Signed-off-by: Jonathan Fournier <jonathan.fournier@windriver.com>
---
 arch/powerpc/platforms/maple/setup.c |   10 ++++++++--
 1 files changed, 8 insertions(+), 2 deletions(-)

diff --git a/arch/powerpc/platforms/maple/setup.c b/arch/powerpc/platforms/maple/setup.c
index 284ab68..78d8be4 100644
--- a/arch/powerpc/platforms/maple/setup.c
+++ b/arch/powerpc/platforms/maple/setup.c
@@ -117,7 +117,10 @@ static void maple_restart(char *cmd)
 	of_node_put(sp);
 
 	/* send command */
-	outb_p(*maple_nvram_command, maple_nvram_base + *maple_nvram_offset);
+   /* No hardware reset support from the service processor on the
+    * Emerson ATCA-6101 (PowerPC 970), reset handled by using the
+    * IPMI watchdog and by using a register_reboot_notifier()
+	outb_p(*maple_nvram_command, maple_nvram_base + *maple_nvram_offset);*/
 	for (;;) ;
  fail:
 	printk(KERN_EMERG "Maple: Manual Restart Required\n");
@@ -144,7 +147,10 @@ static void maple_power_off(void)
 	of_node_put(sp);
 
 	/* send command */
-	outb_p(*maple_nvram_command, maple_nvram_base + *maple_nvram_offset);
+   /* No hardware reset support from the service processor on the
+    * Emerson ATCA-6101 (PowerPC 970), reset handled by using the
+    * IPMI watchdog and by using a register_reboot_notifier()
+	outb_p(*maple_nvram_command, maple_nvram_base + *maple_nvram_offset);*/
 	for (;;) ;
  fail:
 	printk(KERN_EMERG "Maple: Manual Power-Down Required\n");
-- 
1.6.0.3

