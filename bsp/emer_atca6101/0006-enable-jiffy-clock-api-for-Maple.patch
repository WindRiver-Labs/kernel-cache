From daa7818ea6fed9f1d6b858f1dc3cca313acb9607 Mon Sep 17 00:00:00 2001
From: Weiwei Wang <weiwei.wang@windriver.com>
Date: Mon, 3 Nov 2008 16:38:50 +0800
Subject: [PATCH 6/6] enable jiffy clock api for Maple

Add clock api support for Maple: jiffy clock api is selected,
and openpic clock api is disabled.

Signed-off-by: Weiwei Wang <weiwei.wang@windriver.com>
---
 arch/powerpc/kernel/time.c |    3 +++
 arch/powerpc/sysdev/mpic.c |    2 ++
 2 files changed, 5 insertions(+), 0 deletions(-)

diff --git a/arch/powerpc/kernel/time.c b/arch/powerpc/kernel/time.c
index c496d59..ee397e8 100644
--- a/arch/powerpc/kernel/time.c
+++ b/arch/powerpc/kernel/time.c
@@ -545,6 +545,9 @@ void __init iSeries_time_init_early(void)
 }
 #endif /* CONFIG_PPC_ISERIES */
 
+#if defined(CONFIG_HWTIMER_HOOKS) && (defined(CONFIG_PPC_MAPLE))
+ #define HWTIMER_USE_JIFFY 1
+#endif
 
 #if defined(HWTIMER_USE_JIFFY)
 
diff --git a/arch/powerpc/sysdev/mpic.c b/arch/powerpc/sysdev/mpic.c
index d3e13c1..87fdd89 100644
--- a/arch/powerpc/sysdev/mpic.c
+++ b/arch/powerpc/sysdev/mpic.c
@@ -264,6 +264,8 @@ static inline void _mpic_irq_write(struct mpic *mpic, unsigned int src_no,
 #define mpic_irq_read(s,r)	_mpic_irq_read(mpic,(s),(r))
 #define mpic_irq_write(s,r,v)	_mpic_irq_write(mpic,(s),(r),(v))
 
+/* Discard openpic clock api for Maple */
+#undef CONFIG_HWTIMER_HOOKS
 
 #ifdef CONFIG_HWTIMER_HOOKS
 #include <linux/hwtimer.h>
-- 
1.5.5.1

