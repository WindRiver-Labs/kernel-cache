From 618bd701fc8dfb307186dda0492b3b63665101d6 Mon Sep 17 00:00:00 2001
From: Guoqing Jiang <Guoqing.Jiang@windriver.com>
Date: Sun, 23 Jan 2011 14:19:49 +0800
Subject: [PATCH 07/11] graphic/drm/i915: use DRM_I915_SB option to compile right target

Since some files are conflict with related files(suffix with
gen6) which located in i915_gen6 folder. For stability
and isolation, use CONFIG_DRM_I915_SB to select right compile
target and make distinction between SandyBridge and other
platforms.

Signed-off-by: Guoqing Jiang <Guoqing.Jiang@windriver.com>
---
 drivers/gpu/drm/i915/Makefile |   42 +++++++++++++++++++++++++++++-----------
 1 files changed, 30 insertions(+), 12 deletions(-)

diff --git a/drivers/gpu/drm/i915/Makefile b/drivers/gpu/drm/i915/Makefile
index 9929f84..a45b822 100644
--- a/drivers/gpu/drm/i915/Makefile
+++ b/drivers/gpu/drm/i915/Makefile
@@ -2,34 +2,52 @@
 # Makefile for the drm device driver.  This driver provides support for the
 # Direct Rendering Infrastructure (DRI) in XFree86 4.1.0 and higher.
 
+ifndef CONFIG_DRM_I915_SB
 ccflags-y := -Iinclude/drm
-i915-y := i915_drv.o i915_dma.o i915_irq.o i915_mem.o \
+else
+ccflags-y := -Iinclude/drm -Idrivers/gpu/drm/i915_gen6
+endif
+
+i915-core := i915_mem.o \
 	  i915_debugfs.o \
           i915_suspend.o \
-	  i915_gem.o \
 	  i915_gem_debug.o \
 	  i915_gem_tiling.o \
 	  i915_trace_points.o \
-	  intel_display.o \
 	  intel_crt.o \
-	  intel_lvds.o \
 	  intel_bios.o \
-	  intel_dp.o \
-	  intel_hdmi.o \
-	  intel_sdvo.o \
 	  intel_modes.o \
-	  intel_i2c.o \
 	  intel_fb.o \
-	  intel_tv.o \
-	  intel_dvo.o \
-	  intel_overlay.o \
 	  dvo_ch7xxx.o \
 	  dvo_ch7017.o \
 	  dvo_ivch.o \
 	  dvo_tfp410.o \
 	  dvo_sil164.o
 
-i915-$(CONFIG_ACPI)	+= i915_opregion.o
+ifndef CONFIG_DRM_I915_SB
+i915-y += $(i915-core) i915_dma.o i915_drv.o i915_gem.o i915_irq.o \
+			  intel_display.o intel_dp.o intel_dvo.o intel_hdmi.o \
+			  intel_i2c.o intel_lvds.o intel_overlay.o intel_sdvo.o \
+			  intel_tv.o
+i915-$(CONFIG_ACPI)    +=i915_opregion.o
+else
+i915-y += $(i915-core) ../i915_gen6/i915_dma_gen6.o \
+	../i915_gen6/i915_drv_gen6.o ../i915_gen6/i915_gem_gen6.o \
+	../i915_gen6/i915_irq_gen6.o ../i915_gen6/intel_display_gen6.o \
+	../i915_gen6/intel_dp_gen6.o ../i915_gen6/intel_dvo_gen6.o \
+	../i915_gen6/intel_hdmi_gen6.o ../i915_gen6/intel_i2c_gen6.o \
+	../i915_gen6/intel_lvds_gen6.o ../i915_gen6/intel_overlay_gen6.o \
+	../i915_gen6/intel_sdvo_gen6.o ../i915_gen6/intel_tv_gen6.o \
+	../i915_gen6/intel_acpi.o ../i915_gen6/intel_opregion.o \
+	../i915_gen6/intel_panel.o ../i915_gen6/intel_ringbuffer.o
+
+i915-$(CONFIG_ACPI)	+= ../i915_gen6/intel_acpi.o
+endif
+
 i915-$(CONFIG_COMPAT)   += i915_ioc32.o
 
+ifndef CONFIG_DRM_I915_SB
 obj-$(CONFIG_DRM_I915)  += i915.o
+else
+obj-$(CONFIG_DRM_I915_SB)  += i915.o
+endif
-- 
1.6.5.2

