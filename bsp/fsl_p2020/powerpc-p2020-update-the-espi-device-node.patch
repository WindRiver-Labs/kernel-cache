From ecb20cabb3a1aec314d0084e985906bbed26c577 Mon Sep 17 00:00:00 2001
From: Kevin Hao <kexin.hao@windriver.com>
Date: Thu, 25 Aug 2011 15:09:49 +0800
Subject: [PATCH 1/2] powerpc/p2020: update the espi device node

Since we begin to use the mainline driver for espi controller and
m25p80 flash, update the espi device node according to this change.

Signed-off-by: Kevin Hao <kexin.hao@windriver.com>
---
 arch/powerpc/boot/dts/p2020ds.dts                 |    8 +++-----
 arch/powerpc/boot/dts/p2020ds_36b.dts             |    8 +++-----
 arch/powerpc/boot/dts/p2020ds_camp_core0.dts      |    8 +++-----
 arch/powerpc/boot/dts/p2020ds_camp_core1_36b.dts  |    8 +++-----
 arch/powerpc/boot/dts/p2020rdb.dts                |    8 +++-----
 arch/powerpc/boot/dts/p2020rdb_36b.dts            |    8 +++-----
 arch/powerpc/boot/dts/p2020rdb_camp_core0.dts     |    8 +++-----
 arch/powerpc/boot/dts/p2020rdb_camp_core0_36b.dts |    8 +++-----
 8 files changed, 24 insertions(+), 40 deletions(-)

diff --git a/arch/powerpc/boot/dts/p2020ds.dts b/arch/powerpc/boot/dts/p2020ds.dts
index 491159b..6669d76 100644
--- a/arch/powerpc/boot/dts/p2020ds.dts
+++ b/arch/powerpc/boot/dts/p2020ds.dts
@@ -286,19 +286,17 @@
 			cell-index = <0>;
 			#address-cells = <1>;
 			#size-cells = <0>;
-			compatible = "fsl,espi";
+			compatible = "fsl,p2020-espi", "fsl,mpc8536-espi";
 			reg = <0x7000 0x1000>;
 			interrupts = <59 0x2>;
 			interrupt-parent = <&mpic>;
-			espi,num-ss-bits = <4>;
-			mode = "cpu";
+			fsl,espi-num-chipselects = <4>;
 
 			fsl_m25p80@0 {
 				#address-cells = <1>;
 				#size-cells = <1>;
-				compatible = "fsl,espi-flash";
+				compatible = "spansion,s25sl12801";
 				reg = <0>;
-				linux,modalias = "fsl_m25p80";
 				spi-max-frequency = <40000000>; /* input clock */
 				partition@0 {
 					label = "u-boot-spi";
diff --git a/arch/powerpc/boot/dts/p2020ds_36b.dts b/arch/powerpc/boot/dts/p2020ds_36b.dts
index 964dd74..bbfc159 100644
--- a/arch/powerpc/boot/dts/p2020ds_36b.dts
+++ b/arch/powerpc/boot/dts/p2020ds_36b.dts
@@ -251,19 +251,17 @@
 			cell-index = <0>;
 			#address-cells = <1>;
 			#size-cells = <0>;
-			compatible = "fsl,espi";
+			compatible = "fsl,p2020-espi", "fsl,mpc8536-espi";
 			reg = <0x7000 0x1000>;
 			interrupts = <59 0x2>;
 			interrupt-parent = <&mpic>;
-			espi,num-ss-bits = <4>;
-			mode = "cpu";
+			fsl,espi-num-chipselects = <4>;
 
 			fsl_m25p80@0 {
 				#address-cells = <1>;
 				#size-cells = <1>;
-				compatible = "fsl,espi-flash";
+				compatible = "spansion,s25sl12801";
 				reg = <0>;
-				linux,modalias = "fsl_m25p80";
 				spi-max-frequency = <40000000>; /* input clock */
 				partition@0 {
 					label = "u-boot-spi";
diff --git a/arch/powerpc/boot/dts/p2020ds_camp_core0.dts b/arch/powerpc/boot/dts/p2020ds_camp_core0.dts
index 988391c..7aaf6dd 100644
--- a/arch/powerpc/boot/dts/p2020ds_camp_core0.dts
+++ b/arch/powerpc/boot/dts/p2020ds_camp_core0.dts
@@ -75,19 +75,17 @@
 			cell-index = <0>;
 			#address-cells = <1>;
 			#size-cells = <0>;
-			compatible = "fsl,espi";
+			compatible = "fsl,p2020-espi", "fsl,mpc8536-espi";
 			reg = <0x7000 0x1000>;
 			interrupts = <59 0x2>;
 			interrupt-parent = <&mpic>;
-			espi,num-ss-bits = <4>;
-			mode = "cpu";
+			fsl,espi-num-chipselects = <4>;
 
 			fsl_m25p80@0 {
 				#address-cells = <1>;
 				#size-cells = <1>;
-				compatible = "fsl,espi-flash";
+				compatible = "spansion,s25sl12801";
 				reg = <0>;
-				linux,modalias = "fsl_m25p80";
 				spi-max-frequency = <40000000>; /* input clock */
 				partition@0 {
 					label = "u-boot-spi";
diff --git a/arch/powerpc/boot/dts/p2020ds_camp_core1_36b.dts b/arch/powerpc/boot/dts/p2020ds_camp_core1_36b.dts
index 9b359da..4cce7df 100644
--- a/arch/powerpc/boot/dts/p2020ds_camp_core1_36b.dts
+++ b/arch/powerpc/boot/dts/p2020ds_camp_core1_36b.dts
@@ -196,19 +196,17 @@
 			cell-index = <0>;
 			#address-cells = <1>;
 			#size-cells = <0>;
-			compatible = "fsl,espi";
+			compatible = "fsl,p2020-espi", "fsl,mpc8536-espi";
 			reg = <0x7000 0x1000>;
 			interrupts = <59 0x2>;
 			interrupt-parent = <&mpic>;
-			espi,num-ss-bits = <4>;
-			mode = "cpu";
+			fsl,espi-num-chipselects = <4>;
 
 			fsl_m25p80@0 {
 				#address-cells = <1>;
 				#size-cells = <1>;
-				compatible = "fsl,espi-flash";
+				compatible = "spansion,s25sl12801";
 				reg = <0>;
-				linux,modalias = "fsl_m25p80";
 				spi-max-frequency = <40000000>; /* input clock */
 				partition@0 {
 					label = "u-boot-spi";
diff --git a/arch/powerpc/boot/dts/p2020rdb.dts b/arch/powerpc/boot/dts/p2020rdb.dts
index 93dc6d9..6007ef4 100644
--- a/arch/powerpc/boot/dts/p2020rdb.dts
+++ b/arch/powerpc/boot/dts/p2020rdb.dts
@@ -253,19 +253,17 @@
 			cell-index = <0>;
 			#address-cells = <1>;
 			#size-cells = <0>;
-			compatible = "fsl,espi";
+			compatible = "fsl,p2020-espi", "fsl,mpc8536-espi";
 			reg = <0x7000 0x1000>;
 			interrupts = <59 0x2>;
 			interrupt-parent = <&mpic>;
-			espi,num-ss-bits = <4>;
-			mode = "cpu";
+			fsl,espi-num-chipselects = <4>;
 
 			fsl_m25p80@0 {
 				#address-cells = <1>;
 				#size-cells = <1>;
-				compatible = "fsl,espi-flash";
+				compatible = "spansion,s25sl12801";
 				reg = <0>;
-				linux,modalias = "fsl_m25p80";
 				spi-max-frequency = <40000000>;
 				mode = <0>;
 
diff --git a/arch/powerpc/boot/dts/p2020rdb_36b.dts b/arch/powerpc/boot/dts/p2020rdb_36b.dts
index 974d5c7..741bb4e 100644
--- a/arch/powerpc/boot/dts/p2020rdb_36b.dts
+++ b/arch/powerpc/boot/dts/p2020rdb_36b.dts
@@ -242,19 +242,17 @@
 			cell-index = <0>;
 			#address-cells = <1>;
 			#size-cells = <0>;
-			compatible = "fsl,espi";
+			compatible = "fsl,p2020-espi", "fsl,mpc8536-espi";
 			reg = <0x7000 0x1000>;
 			interrupts = <59 0x2>;
 			interrupt-parent = <&mpic>;
-			espi,num-ss-bits = <4>;
-			mode = "cpu";
+			fsl,espi-num-chipselects = <4>;
 
 			fsl_m25p80@0 {
 				#address-cells = <1>;
 				#size-cells = <1>;
-				compatible = "fsl,espi-flash";
+				compatible = "spansion,s25sl12801";
 				reg = <0>;
-				linux,modalias = "fsl_m25p80";
 				spi-max-frequency = <40000000>;
 
 				partition@0 {
diff --git a/arch/powerpc/boot/dts/p2020rdb_camp_core0.dts b/arch/powerpc/boot/dts/p2020rdb_camp_core0.dts
index 12f31db..c3e66cc 100644
--- a/arch/powerpc/boot/dts/p2020rdb_camp_core0.dts
+++ b/arch/powerpc/boot/dts/p2020rdb_camp_core0.dts
@@ -109,19 +109,17 @@
 			cell-index = <0>;
 			#address-cells = <1>;
 			#size-cells = <0>;
-			compatible = "fsl,espi";
+			compatible = "fsl,p2020-espi", "fsl,mpc8536-espi";
 			reg = <0x7000 0x1000>;
 			interrupts = <59 0x2>;
 			interrupt-parent = <&mpic>;
-			espi,num-ss-bits = <4>;
-			mode = "cpu";
+			fsl,espi-num-chipselects = <4>;
 
 			fsl_m25p80@0 {
 				#address-cells = <1>;
 				#size-cells = <1>;
-				compatible = "fsl,espi-flash";
+				compatible = "spansion,s25sl12801";
 				reg = <0>;
-				linux,modalias = "fsl_m25p80";
 				spi-max-frequency = <40000000>;
 
 				partition@0 {
diff --git a/arch/powerpc/boot/dts/p2020rdb_camp_core0_36b.dts b/arch/powerpc/boot/dts/p2020rdb_camp_core0_36b.dts
index 9be3021..c462935 100644
--- a/arch/powerpc/boot/dts/p2020rdb_camp_core0_36b.dts
+++ b/arch/powerpc/boot/dts/p2020rdb_camp_core0_36b.dts
@@ -109,19 +109,17 @@
 			cell-index = <0>;
 			#address-cells = <1>;
 			#size-cells = <0>;
-			compatible = "fsl,espi";
+			compatible = "fsl,p2020-espi", "fsl,mpc8536-espi";
 			reg = <0x7000 0x1000>;
 			interrupts = <59 0x2>;
 			interrupt-parent = <&mpic>;
-			espi,num-ss-bits = <4>;
-			mode = "cpu";
+			fsl,espi-num-chipselects = <4>;
 
 			fsl_m25p80@0 {
 				#address-cells = <1>;
 				#size-cells = <1>;
-				compatible = "fsl,espi-flash";
+				compatible = "spansion,s25sl12801";
 				reg = <0>;
-				linux,modalias = "fsl_m25p80";
 				spi-max-frequency = <40000000>;
 
 				partition@0 {
-- 
1.7.0.4

