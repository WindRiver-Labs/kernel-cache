From e23bdafec2d896d982e1214cf668441c7e9053d2 Mon Sep 17 00:00:00 2001
From: Andrew Liu <shengping.liu@windriver.com>
Date: Wed, 7 Apr 2010 14:13:43 +0800
Subject: [PATCH 3/7] Add the spi bits_per_word to bitbang file

Extracted from P2020DS_20100317_ltib.iso vendor drop.

When composing the struct spi_transfer, the member bits_per_word
and speed_hz may not be set; however, maybe the member bits_per_word
in struct spi_device has been set; therefore, add the condition
spi->bits_per_word to run bitbang->setup_transfer.

[ Adjusted to apply cleanly to the WRS kernel. Functionality unchanged. ]
Signed-off-by: Jerry Huang <Chang-Ming.Huang@freescale.com>
Integrated-by: Andrew Liu <shengping.liu@windriver.com>
---
 drivers/spi/spi_bitbang.c |    3 ++-
 1 files changed, 2 insertions(+), 1 deletions(-)

diff --git a/drivers/spi/spi_bitbang.c b/drivers/spi/spi_bitbang.c
index f1db395..ea3f020 100644
--- a/drivers/spi/spi_bitbang.c
+++ b/drivers/spi/spi_bitbang.c
@@ -294,7 +294,8 @@ static void bitbang_work(struct work_struct *work)
 		list_for_each_entry (t, &m->transfers, transfer_list) {
 
 			/* override speed or wordsize? */
-			if (t->speed_hz || t->bits_per_word)
+			if (t->speed_hz || t->bits_per_word ||
+					spi->bits_per_word)
 				do_setup = 1;
 
 			/* init (-1) or override (1) transfer params */
-- 
1.6.5.2

