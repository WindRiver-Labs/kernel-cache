From 6b75cac309bbb490c4e55ee69b654ea65275dc34 Mon Sep 17 00:00:00 2001
From: xianchao Zhang <xianchao.zhang@windriver.com>
Date: Mon, 2 Aug 2010 13:25:06 +0800
Subject: [PATCH] Move spi item from p2020ds_camp_core1.dts into p2020ds_camp_core0.dts

Move spi item into p2020ds_camp_core0.dts to avoid MTD SPI driver for ST M25Pxx
blocking during booting up with core1 kernel.
---
 arch/powerpc/boot/dts/p2020ds_camp_core0.dts |   42 ++++++++++++++++++++++++-
 arch/powerpc/boot/dts/p2020ds_camp_core1.dts |   44 +------------------------
 2 files changed, 43 insertions(+), 43 deletions(-)

diff --git a/arch/powerpc/boot/dts/p2020ds_camp_core0.dts b/arch/powerpc/boot/dts/p2020ds_camp_core0.dts
index 2355edc..2299b30 100644
--- a/arch/powerpc/boot/dts/p2020ds_camp_core0.dts
+++ b/arch/powerpc/boot/dts/p2020ds_camp_core0.dts
@@ -4,7 +4,7 @@
  * In CAMP mode, each core needs to have its own dts. Only mpic and L2 cache
  * can be shared, all the other devices must be assigned to one core only.
  * This dts file allows core0 to have memory, l2, i2c, dma1, global-util, eth0,
- * eth1, esdhc, crypto, pci0, pci1.
+ * eth1, esdhc, spi, crypto, pci0, pci1.
  *
  * Copyright 2007-2010 Freescale Semiconductor Inc.
  *
@@ -71,6 +71,46 @@
 			interrupts = <16 2>;
 		};
 
+		spi@7000 {
+			cell-index = <0>;
+			#address-cells = <1>;
+			#size-cells = <0>;
+			compatible = "fsl,espi";
+			reg = <0x7000 0x1000>;
+			interrupts = <59 0x2>;
+			interrupt-parent = <&mpic>;
+			espi,num-ss-bits = <4>;
+			mode = "cpu";
+
+			fsl_m25p80@0 {
+				#address-cells = <1>;
+				#size-cells = <1>;
+				compatible = "fsl,espi-flash";
+				reg = <0>;
+				linux,modalias = "fsl_m25p80";
+				spi-max-frequency = <40000000>; /* input clock */
+				partition@0 {
+					label = "u-boot-spi";
+					reg = <0x00000000 0x00100000>;
+					read-only;
+				};
+				partition@100000 {
+					label = "kernel-spi";
+					reg = <0x00100000 0x00500000>;
+					read-only;
+				};
+				partition@600000 {
+					label = "dtb-spi";
+					reg = <0x00600000 0x00100000>;
+					read-only;
+				};
+				partition@700000 {
+					label = "file system-spi";
+					reg = <0x00700000 0x00900000>;
+				};
+			};
+		};
+
 		i2c@3000 {
 			#address-cells = <1>;
 			#size-cells = <0>;
diff --git a/arch/powerpc/boot/dts/p2020ds_camp_core1.dts b/arch/powerpc/boot/dts/p2020ds_camp_core1.dts
index 97a7d2d..da25f2c 100644
--- a/arch/powerpc/boot/dts/p2020ds_camp_core1.dts
+++ b/arch/powerpc/boot/dts/p2020ds_camp_core1.dts
@@ -3,8 +3,8 @@
  *
  * In CAMP mode, each core needs to have its own dts. Only mpic and L2 cache
  * can be shared, all the other devices must be assigned to one core only.
- * This dts file allows core1 to have l2, dma2, eth2, eth3, pci2, msi,
- * nor flash and spi.
+ * This dts file allows core1 to have l2, dma2, eth2, eth3, pci2, msi and
+ * nor flash.
  *
  * Please note to add "-b 1" for core1's dts compiling.
  *
@@ -192,46 +192,6 @@
 			interrupt-parent = <&mpic>;
 		};
 
-		spi@7000 {
-			cell-index = <0>;
-			#address-cells = <1>;
-			#size-cells = <0>;
-			compatible = "fsl,espi";
-			reg = <0x7000 0x1000>;
-			interrupts = <59 0x2>;
-			interrupt-parent = <&mpic>;
-			espi,num-ss-bits = <4>;
-			mode = "cpu";
-
-			fsl_m25p80@0 {
-				#address-cells = <1>;
-				#size-cells = <1>;
-				compatible = "fsl,espi-flash";
-				reg = <0>;
-				linux,modalias = "fsl_m25p80";
-				spi-max-frequency = <40000000>; /* input clock */
-				partition@0 {
-					label = "u-boot-spi";
-					reg = <0x00000000 0x00100000>;
-					read-only;
-				};
-				partition@100000 {
-					label = "kernel-spi";
-					reg = <0x00100000 0x00500000>;
-					read-only;
-				};
-				partition@600000 {
-					label = "dtb-spi";
-					reg = <0x00600000 0x00100000>;
-					read-only;
-				};
-				partition@700000 {
-					label = "file system-spi";
-					reg = <0x00700000 0x00900000>;
-				};
-			};
-		};
-
 		dma@c300 {
 			#address-cells = <1>;
 			#size-cells = <1>;
-- 
1.6.5.2

