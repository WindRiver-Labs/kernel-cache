From 9148c93dedb90ff6cb0ec523db3c3c87f70e7eca Mon Sep 17 00:00:00 2001
From: Jiang Lu <lu.jiang@windriver.com>
Date: Mon, 18 Apr 2011 13:07:07 +0800
Subject: [PATCH 24/27] PowerPC:ACP34xx:Add LSI ACP34xx board device tree

The PPC ACP34xx board with:
* 4 PPC 476 core,
* 2 pl011 serial port,
* 1 pl022 spi bus controller,
* 1 ci13612 USB controller,
* 1 i2c controller,
* 1 ethernet controller,
* 1 ep501 NAND flash controller, with 1G byte NAND chip,
* 2 pl061 gpio controller.
* 1 PCI-express controller.

This patch add device-tree for ACP34xx board.

Extract from vendor drop patch lsi-patch 3.8.1.12.

Signed-off-by: Jiang Lu <lu.jiang@windriver.com>
---
 arch/powerpc/boot/dts/acpx1.dts |  303 +++++++++++++++++++++++++++++++++++++++
 1 files changed, 303 insertions(+), 0 deletions(-)
 create mode 100644 arch/powerpc/boot/dts/acpx1.dts

diff --git a/arch/powerpc/boot/dts/acpx1.dts b/arch/powerpc/boot/dts/acpx1.dts
new file mode 100644
index 0000000..3b3d926
--- /dev/null
+++ b/arch/powerpc/boot/dts/acpx1.dts
@@ -0,0 +1,303 @@
+/*
+ * Device Tree Source for IBM Embedded PPC 476 Platform
+ *
+ * Copyright 2009 Torez Smith, IBM Corporation.
+ *
+ * Based on earlier code:
+ *     Copyright (c) 2006, 2007 IBM Corp.
+ *     Josh Boyer <jwboyer@linux.vnet.ibm.com>, David Gibson <dwg@au1.ibm.com>
+ *
+ * This file is licensed under the terms of the GNU General Public
+ * License version 2.  This program is licensed "as is" without
+ * any warranty of any kind, whether express or implied.
+ *
+ * These patches add ACP3400 support signed-off-by: john.jacques@lsi.com
+ */
+
+/dts-v1/;
+
+/ {
+	#address-cells = <0x2>;
+	#size-cells = <0x1>;
+	model = "ibm,acpx1-4xx";
+	compatible = "ibm,acpx1-4xx";
+	dcr-parent = <0x1>;
+
+	aliases {
+		serial0 = "/plb/opb/serial@00404000";
+		serial1 = "/plb/opb/serial@00405000";
+	};
+
+	cpus {
+		#address-cells = <0x1>;
+		#size-cells = <0x0>;
+		cpu@0 {
+			device_type = "cpu";
+			model = "PowerPC,4xx";
+			reg = <0x0>;
+			clock-frequency = <0x5f5e1000>;
+			timebase-frequency = <0x5f5e1000>;
+			i-cache-line-size = <0x20>;
+			d-cache-line-size = <0x20>;
+			i-cache-size = <0x8000>;
+			d-cache-size = <0x8000>;
+			dcr-controller;
+			dcr-access-method = "native";
+			status = "ok";
+			linux,phandle = <0x1>;
+		};
+		cpu@1 {
+			device_type = "cpu";
+			model = "PowerPC,4xx";
+			reg = <0x1>;
+			clock-frequency = <0x5f5e1000>;
+			timebase-frequency = <0x5f5e1000>;
+			i-cache-line-size = <0x20>;
+			d-cache-line-size = <0x20>;
+			i-cache-size = <0x8000>;
+			d-cache-size = <0x8000>;
+			dcr-controller;
+			dcr-access-method = "native";
+			status = "disabled";
+			enable-method = "spin-table";
+			cpu-release-addr = <0x0 0x0>;
+		};
+		cpu@2 {
+			device_type = "cpu";
+			model = "PowerPC,4xx";
+			reg = <0x2>;
+			clock-frequency = <0x5f5e1000>;
+			timebase-frequency = <0x5f5e1000>;
+			i-cache-line-size = <0x20>;
+			d-cache-line-size = <0x20>;
+			i-cache-size = <0x8000>;
+			d-cache-size = <0x8000>;
+			dcr-controller;
+			dcr-access-method = "native";
+			status = "disabled";
+			enable-method = "spin-table";
+			cpu-release-addr = <0x0 0x0>;
+		};
+		cpu@3 {
+			device_type = "cpu";
+			model = "PowerPC,4xx";
+			reg = <0x3>;
+			clock-frequency = <0x5f5e1000>;
+			timebase-frequency = <0x5f5e1000>;
+			i-cache-line-size = <0x20>;
+			d-cache-line-size = <0x20>;
+			i-cache-size = <0x8000>;
+			d-cache-size = <0x8000>;
+			dcr-controller;
+			dcr-access-method = "native";
+			status = "disabled";
+			enable-method = "spin-table";
+			cpu-release-addr = <0x0 0x0>;
+		};
+	};
+
+	memory {
+		device_type = "memory";
+		reg = <0x0 0x0 0x0>; // hardcode  252M	starting at 4M
+	};
+	MPIC:interrupt-controller {
+		compatible = "chrp,open-pic";
+		interrupt-controller;
+		dcr-reg = <0xffc00000 0x30000>;
+		#address-cells = <0x0>;
+		#size-cells = <0x0>;
+		#interrupt-cells = <0x2>;
+		linux,phandle = <0x2>;
+	};
+	plb {
+		compatible = "ibm,plb-4xx", "ibm,plb4";
+		#address-cells = <0x2>;
+		#size-cells = <0x1>;
+		ranges;
+		clock-frequency = <0x0>;
+		opb {
+			compatible = "ibm,opb-4xx", "ibm,opb";
+			#address-cells = <0x1>;
+			#size-cells = <0x1>;
+			ranges = <0x0 0x20 0x0 0x80000000 0x80000000 0x20 0x80000000 0x80000000>;
+			clock-frequency = <0x0>;
+			serial@00404000 {
+				device_type = "serial";
+				compatible = "acp-uart0";
+				reg = <0x404000 0x1000>;
+				clock_reg = <0x408000 0x1000>;
+				clock-frequency = <25000000>;
+				current-speed = <0>;
+				interrupt-parent = <&MPIC>;
+				interrupts = <0x16 2>;
+			};
+			serial@00405000 {
+				device_type = "serial";
+				compatible = "acp-uart1";
+				reg = <0x405000 0x100>;
+				clock_reg = <0x408000 0x1000>;
+				clock-frequency = <25000000>;
+				current-speed = <0>;
+				interrupt-parent = <&MPIC>;
+				interrupts = <0x17 2>;
+			};
+
+			nand@00440000 {
+				#address-cells = <1>;
+				#size-cells = <1>;
+				compatible = "ep501-nand";
+				reg = <0x440000 0x10000>;
+
+				partition@0 {
+					/* This location must not be altered  */
+					/* 512KB for 2nd stage u-boot Bootloader Image */
+					reg = <0x0 0x80000>;
+					label = "2nd Stage";
+					read-only;
+				};
+				partition@80000 {
+					/* 512KB for u-boot variables */
+					reg = <0x80000 0x80000>;
+					label = "env-0";
+					read-only;
+				};
+				partition@100000 {
+					/* 512KB for u-boot variables */
+					reg = <0x100000 0x80000>;
+					label = "env-1";
+					read-only;
+				};
+				partition@180000 {
+					/* This location must not be altered  */
+					/* 512KB for 3rd stage u-boot Bootloader Image */
+					reg = <0x180000 0x80000>;
+					label = "3rd Stage";
+					read-only;
+				};
+				partition@200000 {
+					/* 6MB for Linux Image */
+					reg = <0x0200000 0x600000>;
+					label = "linux";
+					read-only;
+				};
+				partition@800000 {
+					/* 1MB for Device Tree */
+					reg = <0x0800000 0x100000>;
+					label = "linux_dtb";
+					read-only;
+				};
+				partition@900000 {
+					/* 497MB for Linux Rootfs*/
+					reg = <0x900000 0x1F100000>;
+					label = "linux_fs";
+				};
+				partition@1FA00000 {
+					/* 32MB for OSE */
+					reg = <0x1FA00000 0x2000000>;
+					label = "ose";
+					read-only;
+				};
+				partition@21A00000 {
+					/* 16MB for OSE backup*/
+					reg = <0x21A00000 0x1000000>;
+					label = "ose backup";
+					read-only;
+				};
+				partition@22A00000 {
+					/* 470MB for OSE Storage*/
+					reg = <0x22A00000 0x1D600000>;
+					label = "ose storage";
+				};
+			};
+
+			usb@004A0000 {
+				compatible = "usb-ehci", "ci13612-ehci";
+				reg = <0x4A0000 0x1000>;
+				interrupt-parent = <&MPIC>;
+				interrupts = <31 0x2>;
+			};
+
+			mac@00480000 {
+				device_type = "network";
+				compatible = "lsi-acpnic";
+				reg = <0x480000 0x40000 0x409000 0x1000>;
+				interrupt-parent = <&MPIC>;
+				interrupts = <33 0x2>;
+				local-mac-address = [ 00 00 00 00 00 00 ];
+			};
+
+			i2c@00403000 {
+				#address-cells = <1>;
+				#size-cells = <0>;
+				cell-index = <0>;
+				compatible = "acp-i2c";
+				reg = <0x403000 0x1000 0x408020 0x1000>;
+				eeprom@50 {
+					compatible = "atmel,24c01";
+					reg = <0x50>;
+				};
+			};
+
+			spi@00402000 {
+				#address-cells = <1>;
+				#size-cells = <0>;
+				cell-index = <0>;
+				compatible = "amba_pl022";
+				clock-frequency = <25000000>;
+				reg = <0x402000 0x1000>;
+				interrupts = <20 0x2>;
+				interrupt-parent = <&MPIC>;
+				num-ss-bits = <5>;
+				enalbe-dma = <0>;
+				eeprom@0{
+					reg = <0>;
+					compatible = "at25";
+					spi-max-frequency = <40000000>; /* input clock */
+				};
+				eeprom@1{
+					reg = <1>;
+					compatible = "at25";
+					spi-max-frequency = <40000000>; /* input clock */
+				};
+			};
+
+			gpio@00400000 {
+				#address-cells = <1>;
+				#size-cells = <0>;
+				cell-index = <0>;
+				compatible = "amba_pl061";
+				reg = <0x400000 0x1000>;
+				pins-map = <0x10>; /* GPIO 4 reserved for HW*/
+			};
+			gpio@00401000 {
+				#address-cells = <1>;
+				#size-cells = <0>;
+				cell-index = <8>;
+				compatible = "amba_pl061";
+				reg = <0x401000 0x1000>;
+				pins-map = <0x29>; /* GPIO 8,11,13 reserved for HW*/
+			};
+		};
+	};
+
+	chosen {
+		linux,stdout-path = "/plb/opb/serial@40000200";
+	};
+
+	pciex@f00c0000 {
+		compatible = "lsi,plb-pciex";
+		device_type = "pci";
+		primary;
+		port = <0x0>;
+		#interrupt-cells = <0x1>;
+		#size-cells = <0x2>;
+		#address-cells = <0x3>;
+		reg = <0x20 0x78000000 0x1000000 0x20 0x4c0000 0x8000>;
+		bus-range = <0x0 0xf>;
+		ranges = <0x2000000 0x0 0xa0000000 0x20 0x40000000 0x0 0x10000000>;
+		dma-ranges = <0x2000000 0x0 0x0 0x0 0x0 0x0 0x80000000>;
+		interrupts = <0x1a 0x2>;
+		interrupt-map-mask = <0x0 0x0 0x0 0x7>;
+		interrupt-map = <0x0 0x0 0x0 0x1 0x2 0x1d 0x2 0x0 0x0 0x0 0x2 0x2 0x1d 0x2 0x0 0x0 0x0 0x3 0x2 0x1d 0x2 0x0 0x0 0x0 0x4 0x2 0x1d 0x2>;
+	};
+};
-- 
1.7.0.5

