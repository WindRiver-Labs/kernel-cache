From 49302c1eea82affb59f977ed8d8b5475e962bbd4 Mon Sep 17 00:00:00 2001
From: Jiang Lu <lu.jiang@windriver.com>
Date: Fri, 8 Apr 2011 15:10:18 +0800
Subject: [PATCH 18/27] PowerPC:ACP34xx:Fix AT24 driver to support LSI I2C controller

Since the i2c controller of ACP34xx can only transfer 4 bytes in each
i2c-io operation, needs to modify the iolimit in AT24 driver to support
the i2c controller.

Signed-off-by: Jiang Lu <lu.jiang@windriver.com>
---
 drivers/misc/eeprom/at24.c |    4 ++++
 1 files changed, 4 insertions(+), 0 deletions(-)

diff --git a/drivers/misc/eeprom/at24.c b/drivers/misc/eeprom/at24.c
index db7d0f2..a53419d 100644
--- a/drivers/misc/eeprom/at24.c
+++ b/drivers/misc/eeprom/at24.c
@@ -623,6 +623,10 @@ static struct i2c_driver at24_driver = {
 static int __init at24_init(void)
 {
 	io_limit = rounddown_pow_of_two(io_limit);
+#ifdef CONFIG_I2C_ACP
+	if (io_limit > 4)
+		io_limit = 4;
+#endif
 	return i2c_add_driver(&at24_driver);
 }
 module_init(at24_init);
-- 
1.7.0.5

