From 69142ef64037391bf7beeb64d05e96320deacae0 Mon Sep 17 00:00:00 2001
From: ltian <le.tian@windriver.com>
Date: Mon, 15 Nov 2010 14:19:09 +0800
Subject: [PATCH 084/132] RapidIO: Octeon: Use 8/16 bit device IDs based on mport.sys_size.

Signed-off-by: Chad Reese <kreese@caviumnetworks.com>
Signed-off-by: ltian <le.tian@windriver.com>
---
 arch/mips/cavium-octeon/octeon-rapidio.c |   14 +++++---------
 1 files changed, 5 insertions(+), 9 deletions(-)

diff --git a/arch/mips/cavium-octeon/octeon-rapidio.c b/arch/mips/cavium-octeon/octeon-rapidio.c
index 8d066ee..e5488d1 100644
--- a/arch/mips/cavium-octeon/octeon-rapidio.c
+++ b/arch/mips/cavium-octeon/octeon-rapidio.c
@@ -119,9 +119,8 @@ static int octeon_rio_cread(struct rio_mport *mport, int mport_id, u16 destid,
 			     0xffff & destid, 0xff & hopcount, offset, len);
 		return -EINVAL;
 	}
-	/* FIXME: rdev->pef & RIO_PEF_CTLS for 16bit flag */
-	if (cvmx_srio_config_read32(mport_id, OCTEON_RIO_ID, destid, 1,
-		hopcount, offset, data))
+	if (cvmx_srio_config_read32(mport_id, OCTEON_RIO_ID, destid,
+				    mport->sys_size, hopcount, offset, data))
 		return -EIO;
 	return 0;
 }
@@ -151,8 +150,7 @@ static int octeon_rio_cwrite(struct rio_mport *mport, int mport_id, u16 destid,
 		return -EINVAL;
 	}
 	if (cvmx_srio_config_write32(mport_id, OCTEON_RIO_ID, destid,
-		1 /* FIXME: rdev->pef & RIO_PEF_CTLS */, hopcount, offset,
-		data))
+		mport->sys_size, hopcount, offset, data))
 		return -EIO;
 	return 0;
 }
@@ -171,8 +169,7 @@ static int octeon_rio_dsend(struct rio_mport *mport, int mport_id, u16 destid,
 			    u16 data)
 {
 	return cvmx_srio_send_doorbell(mport_id, OCTEON_RIO_ID, destid,
-		1 /* FIXME: rdev->pef & RIO_PEF_CTLS */,
-		OCTEON_RIO_DOORBELL_PRIORITY, data);
+		mport->sys_size, OCTEON_RIO_DOORBELL_PRIORITY, data);
 }
 
 /**
@@ -197,8 +194,7 @@ static phys_t octeon_rio_mem_map(struct rio_mport *mport, struct rio_dev *rdev,
 
 	return cvmx_srio_physical_map(mport->id, CVMX_SRIO_WRITE_MODE_AUTO,
 		priority, CVMX_SRIO_READ_MODE_NORMAL, priority,
-		OCTEON_RIO_ID, rdev->destid,
-		rdev->pef & RIO_PEF_CTLS, offset, length);
+		OCTEON_RIO_ID, rdev->destid, mport->sys_size, offset, length);
 }
 
 /**
-- 
1.6.5.2

