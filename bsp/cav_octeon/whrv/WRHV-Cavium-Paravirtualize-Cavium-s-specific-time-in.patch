From 68ece6ea59798423ef99190148ea124b7281c268 Mon Sep 17 00:00:00 2001
From: Yang Shi <yang.shi@windriver.com>
Date: Fri, 25 Feb 2011 10:39:24 +0800
Subject: [PATCH 13/30] WRHV: Cavium: Paravirtualize Cavium's specific time init

In MIPS, each board has its own plat_time_init, so paravirtualize
Cavium's. And, since time init function is common for all of MIPS
GOS, so add the real arch_init_irq into another commit so that
it can be shared by other MIPS GOS BSP.

Signed-off-by: Yang Shi <yang.shi@windriver.com>
---
 arch/mips/cavium-octeon/csrc-octeon.c |   10 +++++++++-
 1 files changed, 9 insertions(+), 1 deletions(-)

diff --git a/arch/mips/cavium-octeon/csrc-octeon.c b/arch/mips/cavium-octeon/csrc-octeon.c
index 6d9973e..dbf9328 100644
--- a/arch/mips/cavium-octeon/csrc-octeon.c
+++ b/arch/mips/cavium-octeon/csrc-octeon.c
@@ -126,13 +126,21 @@ unsigned long long notrace sched_clock(void)
 #endif
 }
 
-void __init plat_time_init(void)
+void paravirt_plat_time_init(void)
+	__attribute__ ((weak, alias("native_plat_time_init")));
+
+void __init native_plat_time_init(void)
 {
 	clocksource_mips.rating = 300;
 	clocksource_set_clock(&clocksource_mips, octeon_get_clock_rate());
 	clocksource_register(&clocksource_mips);
 }
 
+void __init plat_time_init(void)
+{
+	paravirt_plat_time_init();
+}
+
 void __udelay(unsigned int us)
 {
 	u64 cur, end, inc;
-- 
1.6.5.2

