From 04f7e39e94818e7786ec67cf31addc6c489ad869 Mon Sep 17 00:00:00 2001
From: Yang Shi <yang.shi@windriver.com>
Date: Wed, 1 Dec 2010 16:54:27 +0800
Subject: [PATCH 11/30] WRHV: Cavium: hardcode Octeon II icache line size

In probe_octeon, need read config1 to get some cache configuration
info, but GOS can't access config1, so hardcode icache line size
for Octeon II.

Signed-off-by: Yang Shi <yang.shi@windriver.com>
---
 arch/mips/mm/c-octeon.c |    8 ++++++++
 1 files changed, 8 insertions(+), 0 deletions(-)

diff --git a/arch/mips/mm/c-octeon.c b/arch/mips/mm/c-octeon.c
index f92cac5..e53de96 100644
--- a/arch/mips/mm/c-octeon.c
+++ b/arch/mips/mm/c-octeon.c
@@ -181,7 +181,11 @@ static void __cpuinit probe_octeon(void)
 	unsigned int config1;
 	struct cpuinfo_mips *c = &current_cpu_data;
 
+#ifdef CONFIG_WRHV
+	config1 = 0;
+#else
 	config1 = read_c0_config1();
+#endif
 	switch (c->cputype) {
 	case CPU_CAVIUM_OCTEON:
 	case CPU_CAVIUM_OCTEON_PLUS:
@@ -205,7 +209,11 @@ static void __cpuinit probe_octeon(void)
 		break;
 
 	case CPU_CAVIUM_OCTEON2:
+#ifdef CONFIG_WRHV
+		c->icache.linesz = 128;
+#else
 		c->icache.linesz = 2 << ((config1 >> 19) & 7);
+#endif
 		c->icache.sets = 8;
 		c->icache.ways = 37;
 		c->icache.flags |= MIPS_CACHE_VTAG;
-- 
1.6.5.2

