From 68fea6cabf452fee7d7bf08e57814df3024143ea Mon Sep 17 00:00:00 2001
From: Yang Shi <yang.shi@windriver.com>
Date: Tue, 21 Dec 2010 16:22:20 +0800
Subject: [PATCH 28/30] WRHV: Cavium: Set serial IRQs

Get serial ports IRQs from VIOAPIC via VBI instead of Octeon header
file.

Signed-off-by: Yang Shi <yang.shi@windriver.com>
---
 arch/mips/cavium-octeon/serial.c |   13 +++++++++++++
 1 files changed, 13 insertions(+), 0 deletions(-)

diff --git a/arch/mips/cavium-octeon/serial.c b/arch/mips/cavium-octeon/serial.c
index 94fb06d..1ad2149 100644
--- a/arch/mips/cavium-octeon/serial.c
+++ b/arch/mips/cavium-octeon/serial.c
@@ -187,7 +187,12 @@ static int __init octeon_serial_init(void)
 		octeon_uart_set_common(p);
 		p->membase = (void *) CVMX_MIO_UARTX_RBR(0);
 		p->mapbase = CVMX_MIO_UARTX_RBR(0) & ((1ull << 49) - 1);
+#ifdef CONFIG_WRHV
+		/* Set IRQ to zero, will get IRQ via VBI from VIOAPIC */
+		p->irq = 0;
+#else
 		p->irq = OCTEON_IRQ_UART0;
+#endif
 		p++;
 	}
 
@@ -196,7 +201,11 @@ static int __init octeon_serial_init(void)
 		octeon_uart_set_common(p);
 		p->membase = (void *) CVMX_MIO_UARTX_RBR(1);
 		p->mapbase = CVMX_MIO_UARTX_RBR(1) & ((1ull << 49) - 1);
+#ifdef CONFIG_WRHV
+		p->irq = 0;
+#else
 		p->irq = OCTEON_IRQ_UART1;
+#endif
 		p++;
 	}
 	if (enable_uart2) {
@@ -204,7 +213,11 @@ static int __init octeon_serial_init(void)
 		octeon_uart_set_common(p);
 		p->membase = (void *) CVMX_MIO_UART2_RBR;
 		p->mapbase = CVMX_MIO_UART2_RBR & ((1ull << 49) - 1);
+#ifdef CONFIG_WRHV
+		p->irq = 0;
+#else
 		p->irq = OCTEON_IRQ_UART2;
+#endif
 		p++;
 	}
 
-- 
1.6.5.2

