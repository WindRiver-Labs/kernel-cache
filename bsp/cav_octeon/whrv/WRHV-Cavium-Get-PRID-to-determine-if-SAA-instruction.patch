From cac8150703ab41e71ab566fb924323510ce82a00 Mon Sep 17 00:00:00 2001
From: Yang Shi <yang.shi@windriver.com>
Date: Tue, 21 Dec 2010 16:25:26 +0800
Subject: [PATCH 29/30] WRHV: Cavium: Get PRID to determine if SAA instructions supported

Since GOS can't access CP0 PRID register, so hardcode PRID for
Octeon II and Octeon Plus.

Signed-off-by: Yang Shi <yang.shi@windriver.com>
---
 .../asm/mach-cavium-octeon/cpu-feature-overrides.h |    8 ++++++++
 1 files changed, 8 insertions(+), 0 deletions(-)

diff --git a/arch/mips/include/asm/mach-cavium-octeon/cpu-feature-overrides.h b/arch/mips/include/asm/mach-cavium-octeon/cpu-feature-overrides.h
index 76ff3b2..c46c6e2 100644
--- a/arch/mips/include/asm/mach-cavium-octeon/cpu-feature-overrides.h
+++ b/arch/mips/include/asm/mach-cavium-octeon/cpu-feature-overrides.h
@@ -97,7 +97,15 @@ static inline int read_current_timer(unsigned long *result)
 static inline int octeon_has_saa(void)
 {
 	int id;
+#ifdef CONFIG_WRHV
+#ifdef CONFIG_CAVIUM_OCTEON2
+	id = PRID_COMP_CAVIUM | PRID_IMP_CAVIUM_CN63XX;
+#else
+	id = PRID_COMP_CAVIUM | PRID_IMP_CAVIUM_CN58XX;
+#endif
+#else 
 	asm volatile ("mfc0 %0, $15,0" : "=r" (id));
+#endif
 	return id >= 0x000d0300;
 }
 
-- 
1.6.5.2

