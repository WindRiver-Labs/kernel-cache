From d48bf888f507bb5a7cd74427eed6eda39f77b7f4 Mon Sep 17 00:00:00 2001
From: Yang Shi <yang.shi@windriver.com>
Date: Mon, 28 Feb 2011 13:27:03 +0800
Subject: [PATCH 02/30] WRHV: Cavium: Fixed 64bit virt_to_phys

Since MIPS GOS is mapped to KSSEG, and PAGE_OFFSET is started at
KSSEG, so for GOS, virt_to_phys don't need calculate offset from
CKSEG0.

Signed-off-by: Yang Shi <yang.shi@windriver.com>
---
 arch/mips/include/asm/io.h |    2 +-
 1 files changed, 1 insertions(+), 1 deletions(-)

diff --git a/arch/mips/include/asm/io.h b/arch/mips/include/asm/io.h
index 7f88071..7971bd7 100644
--- a/arch/mips/include/asm/io.h
+++ b/arch/mips/include/asm/io.h
@@ -116,7 +116,7 @@ static inline void set_io_port_base(unsigned long base)
  */
 static inline unsigned long virt_to_phys(volatile const void *address)
 {
-#ifdef CONFIG_64BIT
+#if defined(CONFIG_64BIT) && !defined(CONFIG_WRHV)
 	if((unsigned long) address >= CKSEG0)
 		return (unsigned long)address - CKSEG0 + PHYS_OFFSET;
 #endif
-- 
1.6.5.2

