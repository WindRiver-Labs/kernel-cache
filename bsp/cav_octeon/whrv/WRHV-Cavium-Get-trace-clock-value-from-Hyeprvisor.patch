From 1ff054c16e4bcc365bdf6f1db854cdf5ae81c83f Mon Sep 17 00:00:00 2001
From: Yang Shi <yang.shi@windriver.com>
Date: Thu, 16 Dec 2010 15:08:44 +0800
Subject: [PATCH 24/30] WRHV: Cavium: Get trace clock value from Hyeprvisor

GOS can't access CP0 cvmcount register to get high resolution
time for trace clock, so get the time from Hypervisor, but it's
low resolution.

Signed-off-by: Yang Shi <yang.shi@windriver.com>
---
 arch/mips/include/asm/octeon/trace-clock.h |    8 ++++++++
 1 files changed, 8 insertions(+), 0 deletions(-)

diff --git a/arch/mips/include/asm/octeon/trace-clock.h b/arch/mips/include/asm/octeon/trace-clock.h
index e097c4c..db1a7ad 100644
--- a/arch/mips/include/asm/octeon/trace-clock.h
+++ b/arch/mips/include/asm/octeon/trace-clock.h
@@ -13,12 +13,20 @@
 
 static inline u32 trace_clock_read32(void)
 {
+#ifdef CONFIG_WRHV
+	return (u32)VBI_TICK_COUNT_GET();
+#else
 	return (u32)read_c0_cvmcount(); /* only need the 32 LSB */
+#endif
 }
 
 static inline u64 trace_clock_read64(void)
 {
+#ifdef CONFIG_WRHV
+	return (unsigned long)VBI_TICK_COUNT_GET();
+#else
 	return read_c0_cvmcount();
+#endif
 }
 
 static inline u64 trace_clock_frequency(void)
-- 
1.6.5.2

