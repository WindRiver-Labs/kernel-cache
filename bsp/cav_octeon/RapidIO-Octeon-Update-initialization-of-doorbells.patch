From ba08f61b591817dbd14ecb51e56a66b96219e028 Mon Sep 17 00:00:00 2001
From: ltian <le.tian@windriver.com>
Date: Mon, 15 Nov 2010 11:27:14 +0800
Subject: [PATCH 075/132] RapidIO: Octeon: Update initialization of doorbells.

The Octeon SRIO code did not setup the RX doorbell structures correctly.

Signed-off-by: Chad Reese <kreese@caviumnetworks.com>
Signed-off-by: ltian <le.tian@windriver.com>
---
 arch/mips/cavium-octeon/octeon-rapidio.c |    8 ++++++++
 1 files changed, 8 insertions(+), 0 deletions(-)

diff --git a/arch/mips/cavium-octeon/octeon-rapidio.c b/arch/mips/cavium-octeon/octeon-rapidio.c
index 943dfd1..62b81f2 100644
--- a/arch/mips/cavium-octeon/octeon-rapidio.c
+++ b/arch/mips/cavium-octeon/octeon-rapidio.c
@@ -10,6 +10,7 @@
  */
 
 #include <linux/rio.h>
+#include <linux/rio_drv.h>
 #include <linux/interrupt.h>
 #include <linux/netdevice.h>
 
@@ -554,6 +555,13 @@ static int __init octeon_rio_init(void)
 		srio_ports[srio_port].mport.iores.flags = IORESOURCE_MEM;
 		srio_ports[srio_port].mport.iores.name = "SRIO CSRs";
 		srio_ports[srio_port].mport.phy_type = RIO_PHY_SERIAL;
+		INIT_LIST_HEAD(&srio_ports[srio_port].mport.dbells);
+		rio_init_dbell_res(&srio_ports[srio_port].mport.riores[
+			RIO_DOORBELL_RESOURCE], 0, 0xffff);
+		rio_init_mbox_res(&srio_ports[srio_port].mport.riores[
+			RIO_INB_MBOX_RESOURCE], 0, 0);
+		rio_init_mbox_res(&srio_ports[srio_port].mport.riores[
+			RIO_OUTB_MBOX_RESOURCE], 0, 0);
 		sprintf(srio_ports[srio_port].mport.name, "SRIO%d", srio_port);
 		RIO_PRINTK(&srio_ports[srio_port].mport, "Registering port\n");
 		if (cvmx_srio_initialize(srio_port,
-- 
1.6.5.2

