From 05226d853300161483aed8efe0fd468c531388c2 Mon Sep 17 00:00:00 2001
From: ltian <le.tian@windriver.com>
Date: Mon, 15 Nov 2010 14:56:57 +0800
Subject: [PATCH 2/2] Finish randomize mmap for non-cgl configuration

Source: Cavium SDK 2.0.0-366, Split from previous patch

When we apply BSP patches, some of the kernel source files we start
with are different between CGL and standard kernels. In most cases, we
either don't care about the differences, or they don't affect the
files we get in a way that the BSP patches can't be applied.

The case of arch/mips/kernel/syscall.c is slightly different,
however. There is a conflict in that a one-line change that the BSP
patches want to apply has already been applied in the CGL kernel. This
means that the BSP patch fails.

This separates the offending patch hunk so that it can be
conditionally included, depending on whether this is a CGL build or
not.

Signed-off-by: ltian <le.tian@windriver.com>
---
 arch/mips/kernel/syscall.c |    2 +-
 1 files changed, 1 insertions(+), 1 deletions(-)

diff --git a/arch/mips/kernel/syscall.c b/arch/mips/kernel/syscall.c
index f4faa52..fc9b4a5 100644
--- a/arch/mips/kernel/syscall.c
+++ b/arch/mips/kernel/syscall.c
@@ -128,7 +128,7 @@ unsigned long arch_get_unmapped_area(struct file *filp, unsigned long addr,
 		    (!vmm || addr + len <= vmm->vm_start))
 			return addr;
 	}
-	addr = TASK_UNMAPPED_BASE;
+	addr = current->mm->mmap_base;
 	if (do_color_align)
 		addr = COLOUR_ALIGN(addr, pgoff);
 	else
-- 
1.6.5.2

