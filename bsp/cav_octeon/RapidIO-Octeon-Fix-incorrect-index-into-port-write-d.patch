From 6b886da6a685c50ecc0f106e331147b8f0a49cff Mon Sep 17 00:00:00 2001
From: ltian <le.tian@windriver.com>
Date: Mon, 15 Nov 2010 14:23:50 +0800
Subject: [PATCH 090/132] RapidIO: Octeon: Fix incorrect index into port write data.

Port writes arrive into the Octeon hardware with either a
9 or 11 byte header depending on the TT setting. The driver
was skipping 8 or 10, which is incorrect. The error was
caused by not counting the hopcount inside the packet header.
This was found by IDT during switch testing.

Signed-off-by: Chad Reese <kreese@caviumnetworks.com>
Signed-off-by: ltian <le.tian@windriver.com>
---
 arch/mips/cavium-octeon/octeon-rapidio.c |    2 +-
 1 files changed, 1 insertions(+), 1 deletions(-)

diff --git a/arch/mips/cavium-octeon/octeon-rapidio.c b/arch/mips/cavium-octeon/octeon-rapidio.c
index 8cdf4bd..f76e3f0 100644
--- a/arch/mips/cavium-octeon/octeon-rapidio.c
+++ b/arch/mips/cavium-octeon/octeon-rapidio.c
@@ -488,7 +488,7 @@ static void octeon_rio_rx_soft_fifo(struct rio_mport *mport)
 		/* Call the port write handler if this is a port write */
 		if ((ftype == 0x8) && (transaction == 0x4)) {
 			rio_inb_pwrite_handler((union rio_pw_msg *)
-				(skb->data + ((tt) ? 10 : 8)));
+				(skb->data + ((tt) ? 11 : 9)));
 		}
 	}
 	dev_kfree_skb_any(skb);
-- 
1.6.5.2

