From 9f19ef40329ab676963e8269d2477ca65397f07e Mon Sep 17 00:00:00 2001
From: ltian <le.tian@windriver.com>
Date: Mon, 15 Nov 2010 10:11:11 +0800
Subject: [PATCH 056/132] RapidIO: Update the size of the "config" sysfs file.

RapidIO allows a 16MB window.

Signed-off-by: Chad Reese <kreese@caviumnetworks.com>
Signed-off-by: ltian <le.tian@windriver.com>
---
 drivers/rapidio/rio-sysfs.c |   12 ++++++------
 1 files changed, 6 insertions(+), 6 deletions(-)

diff --git a/drivers/rapidio/rio-sysfs.c b/drivers/rapidio/rio-sysfs.c
index b0b832d..cb8f7c7 100644
--- a/drivers/rapidio/rio-sysfs.c
+++ b/drivers/rapidio/rio-sysfs.c
@@ -80,9 +80,9 @@ rio_read_config(struct kobject *kobj, struct bin_attribute *bin_attr,
 
 	/* Several chips lock up trying to read undefined config space */
 	if (capable(CAP_SYS_ADMIN))
-		size = 0x200000;
+		size = bin_attr->size;
 
-	if (off > size)
+	if (off >= size)
 		return 0;
 	if (off + count > size) {
 		size -= off;
@@ -149,10 +149,10 @@ rio_write_config(struct kobject *kobj, struct bin_attribute *bin_attr,
 	loff_t init_off = off;
 	u8 *data = (u8 *) buf;
 
-	if (off > 0x200000)
+	if (off >= bin_attr->size)
 		return 0;
-	if (off + count > 0x200000) {
-		size = 0x200000 - off;
+	if (off + count > bin_attr->size) {
+		size = bin_attr->size - off;
 		count = size;
 	}
 
@@ -202,7 +202,7 @@ static struct bin_attribute rio_config_attr = {
 		 .name = "config",
 		 .mode = S_IRUGO | S_IWUSR,
 		 },
-	.size = 0x200000,
+	.size = 0x1000000, /* 16MB = 21bit dword address */
 	.read = rio_read_config,
 	.write = rio_write_config,
 };
-- 
1.6.5.2

