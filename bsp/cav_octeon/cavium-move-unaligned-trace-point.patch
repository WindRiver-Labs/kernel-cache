From f92b1b2d670dbae9f2fc98691543bf995c467ede Mon Sep 17 00:00:00 2001
From: Bruce Ashfield <bruce.ashfield@windriver.com>
Date: Mon, 31 May 2010 01:17:06 -0400
Subject: [PATCH] cavium: move unaligned trace point

The cavium boards insert code into do_ade, which follows the
existing tracepoint in the function. This gives us mixed
declarations and calls. In order to properly compile, the
cavium boards must move the tracepoint below their code
block.

Signed-off-by: Bruce Ashfield <bruce.ashfield@windriver.com>
---
 arch/mips/kernel/unaligned.c |    3 ++-
 1 files changed, 2 insertions(+), 1 deletions(-)

diff --git a/arch/mips/kernel/unaligned.c b/arch/mips/kernel/unaligned.c
index bcb4897..b2c2060 100644
--- a/arch/mips/kernel/unaligned.c
+++ b/arch/mips/kernel/unaligned.c
@@ -514,7 +514,6 @@ asmlinkage void do_ade(struct pt_regs *regs)
 	unsigned int __user *pc;
 	mm_segment_t seg;
 
-	trace_trap_entry(regs, CAUSE_EXCCODE(regs->cp0_cause));
 
 #if defined(CONFIG_CPU_CAVIUM_OCTEON) && (CONFIG_CAVIUM_OCTEON_CVMSEG_SIZE > 0)
 	/* This section of code allows tasks to access CVMSEG addresses. These are
@@ -552,6 +551,8 @@ asmlinkage void do_ade(struct pt_regs *regs)
 	}
 #endif
  
+	trace_trap_entry(regs, CAUSE_EXCCODE(regs->cp0_cause));
+
 	/*
 	 * Did we catch a fault trying to load an instruction?
 	 * Or are we running in MIPS16 mode?
-- 
1.6.5.2

