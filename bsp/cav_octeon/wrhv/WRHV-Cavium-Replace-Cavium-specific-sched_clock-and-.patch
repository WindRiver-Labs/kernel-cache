From d6d64fa918a344ed266ab9606f717b5cd8a86b6a Mon Sep 17 00:00:00 2001
From: Yang Shi <yang.shi@windriver.com>
Date: Tue, 7 Dec 2010 13:38:02 +0800
Subject: [PATCH 16/30] WRHV: Cavium: Replace Cavium specific sched_clock and delay functions

Since GOS can't read any CP0 registers, so replace sched_clock and delay
related functions to MIPS general ones.

Signed-off-by: Yang Shi <yang.shi@windriver.com>
---
 arch/mips/cavium-octeon/csrc-octeon.c |    5 ++++-
 1 files changed, 4 insertions(+), 1 deletions(-)

diff --git a/arch/mips/cavium-octeon/csrc-octeon.c b/arch/mips/cavium-octeon/csrc-octeon.c
index dbf9328..f671d93 100644
--- a/arch/mips/cavium-octeon/csrc-octeon.c
+++ b/arch/mips/cavium-octeon/csrc-octeon.c
@@ -94,6 +94,7 @@ static struct clocksource clocksource_mips = {
 	.flags		= CLOCK_SOURCE_IS_CONTINUOUS,
 };
 
+#ifndef CONFIG_WRHV
 unsigned long long notrace sched_clock(void)
 {
 	/* 64-bit arithmatic can overflow, so use 128-bit.  */
@@ -125,6 +126,7 @@ unsigned long long notrace sched_clock(void)
 	return (unsigned long long)(t >> clocksource_mips.shift);
 #endif
 }
+#endif
 
 void paravirt_plat_time_init(void)
 	__attribute__ ((weak, alias("native_plat_time_init")));
@@ -141,6 +143,7 @@ void __init plat_time_init(void)
 	paravirt_plat_time_init();
 }
 
+#ifndef CONFIG_WRHV
 void __udelay(unsigned int us)
 {
 	u64 cur, end, inc;
@@ -180,7 +183,7 @@ void __delay(unsigned int loops)
 		cur = read_c0_cvmcount();
 }
 EXPORT_SYMBOL(__delay);
-
+#endif
 
 /**
  * octeon_io_clk_delay - wait for a given number of io clock cycles to pass.
-- 
1.6.5.2

