From 0362299e8d03f553830a70d81ac74ca116ae1f2e Mon Sep 17 00:00:00 2001
From: Phil Staub <Phil.Staub@windriver.com>
Date: Mon, 4 Apr 2011 12:03:42 -0700
Subject: [PATCH 1/5] WRHV: Cavium: Add custom WRHV board type

Hypervisor reports a unique board type that is treated like the
EBB6300 board. Add support for this new type.

Signed-off-by: Phil Staub <Phil.Staub@windriver.com>
---
 drivers/net/octeon/octeon_mgmt.c |    5 +++++
 simple_exec/cvmx-helper-board.c  |    3 +++
 2 files changed, 8 insertions(+), 0 deletions(-)

diff --git a/drivers/net/octeon/octeon_mgmt.c b/drivers/net/octeon/octeon_mgmt.c
index 57e9283..9c41402 100644
--- a/drivers/net/octeon/octeon_mgmt.c
+++ b/drivers/net/octeon/octeon_mgmt.c
@@ -812,7 +812,12 @@ static int octeon_mgmt_init_phy(struct net_device *netdev)
 		 * The 88E1118 Ethernet PHYs on the EBB6300 need the
 		 * M1118_DEV_FLAGS_CLK_TRANSITION flag set.
 		 */
+#ifdef CONFIG_WRHV
+		if (octeon_bootinfo->board_type ==
+		    CVMX_BOARD_TYPE_CUST_WRHV_OCTEON)
+#else
 		if (octeon_bootinfo->board_type == CVMX_BOARD_TYPE_EBB6300)
+#endif
 			flags |= 3;
 
 		p->phydev = phy_connect(netdev, phy_id, octeon_mgmt_adjust_link,
diff --git a/simple_exec/cvmx-helper-board.c b/simple_exec/cvmx-helper-board.c
index c3179c1..a6b503e 100644
--- a/simple_exec/cvmx-helper-board.c
+++ b/simple_exec/cvmx-helper-board.c
@@ -214,6 +214,9 @@ int cvmx_helper_board_get_mii_address(int ipd_port)
                     return -1;
             }
         case CVMX_BOARD_TYPE_EBB6300:
+#ifdef CONFIG_WRHV
+        case CVMX_BOARD_TYPE_CUST_WRHV_OCTEON:
+#endif
             /* Board has 2 management ports */
             if ((ipd_port >= CVMX_HELPER_BOARD_MGMT_IPD_PORT) && (ipd_port < (CVMX_HELPER_BOARD_MGMT_IPD_PORT + 2)))
                 return ipd_port - CVMX_HELPER_BOARD_MGMT_IPD_PORT + 4;
-- 
1.7.0.4

