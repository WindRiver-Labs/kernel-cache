From 7a9d0d998a45d3761f143ad0142bf65dd4619f5c Mon Sep 17 00:00:00 2001
From: Yang Shi <yang.shi@windriver.com>
Date: Mon, 28 Feb 2011 13:05:49 +0800
Subject: [PATCH 23/30] WRHV: Cavium: Hardcode processor id

Since GOS can't access CP0 prid register, so hardcode processor
ID value, the value is 000d9000 (Cavium Octeon II) or 000d3000
(Cavium Octeon Plus) depend on if Octeon II is enabled.

Signed-off-by: Yang Shi <yang.shi@windriver.com>
---
 arch/mips/include/asm/octeon/cvmx.h |   11 +++++++++++
 1 files changed, 11 insertions(+), 0 deletions(-)

diff --git a/arch/mips/include/asm/octeon/cvmx.h b/arch/mips/include/asm/octeon/cvmx.h
index aac806d..39c4a5d 100644
--- a/arch/mips/include/asm/octeon/cvmx.h
+++ b/arch/mips/include/asm/octeon/cvmx.h
@@ -32,6 +32,9 @@
 #include <linux/string.h>
 #include <linux/delay.h>
 #include <asm/byteorder.h>
+#ifdef CONFIG_WRHV
+#include <asm/cpu.h>
+#endif
 
 #ifndef CVMX_ENABLE_CSR_ADDRESS_CHECKING
 #define CVMX_ENABLE_CSR_ADDRESS_CHECKING 0
@@ -73,7 +76,15 @@ static inline uint32_t cvmx_get_proc_id(void) __attribute__ ((pure));
 static inline uint32_t cvmx_get_proc_id(void)
 {
        uint32_t id;
+#ifdef CONFIG_WRHV
+#ifdef CONFIG_CAVIUM_OCTEON2
+ 	id = PRID_COMP_CAVIUM | PRID_IMP_CAVIUM_CN63XX;
+#else
+ 	id = PRID_COMP_CAVIUM | PRID_IMP_CAVIUM_CN58XX;
+#endif
+#else
        asm("mfc0 %0, $15,0" : "=r"(id));
+#endif
        return id;
 }
 
-- 
1.6.5.2

