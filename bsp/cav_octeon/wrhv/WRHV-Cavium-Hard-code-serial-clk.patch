From 85e6520ac4409fde43d60374bc62944e163b37c8 Mon Sep 17 00:00:00 2001
From: Yang Shi <yang.shi@windriver.com>
Date: Thu, 16 Dec 2010 15:16:42 +0800
Subject: [PATCH 26/30] WRHV: Cavium: Hard code serial clk

Hard code UART clk, need get the clk from Hypervisor. 58xx/63xx
core freq is 800MHz so hardcode UART clock to 800M.

Signed-off-by: Yang Shi <yang.shi@windriver.com>
---
 arch/mips/cavium-octeon/serial.c |    8 ++++++++
 1 files changed, 8 insertions(+), 0 deletions(-)

diff --git a/arch/mips/cavium-octeon/serial.c b/arch/mips/cavium-octeon/serial.c
index ce084e5..94fb06d 100644
--- a/arch/mips/cavium-octeon/serial.c
+++ b/arch/mips/cavium-octeon/serial.c
@@ -129,7 +129,15 @@ static void __init octeon_uart_set_common(struct plat_serial8250_port *p)
 		/* Make simulator output fast*/
 		p->uartclk = 115200 * 16;
 	else
+#ifdef CONFIG_WRHV
+		/* Hardcode now, need get the clk from Hyerpvisor
+		 * 58xx/63xx core freq is 800MHz, so hardcode UART
+		 * clock to 800M. 38xx core freq is 500MHz.
+		 */
+		p->uartclk = 800000000;
+#else
 		p->uartclk = octeon_get_io_clock_rate();
+#endif
 	p->serial_in = octeon_serial_in;
 	p->serial_out = octeon_serial_out;
 }
-- 
1.6.5.2

