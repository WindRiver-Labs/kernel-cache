From 100906d0df7e8e16c68b43f4be4132aa10a26ba0 Mon Sep 17 00:00:00 2001
From: Yang Shi <yang.shi@windriver.com>
Date: Fri, 24 Dec 2010 15:55:51 +0800
Subject: [PATCH 30/30] WRHV: Cavium: Trigger kernel panic in CU2 exception handling

Since COP2 is disabled on Hypervisor, and GOS can't enable it, so
trigger kernel panic in CU2 exception handling to notify outside
COP2 is accessed.

Signed-off-by: Yang Shi <yang.shi@windriver.com>
---
 arch/mips/cavium-octeon/cpu.c |    3 +++
 1 files changed, 3 insertions(+), 0 deletions(-)

diff --git a/arch/mips/cavium-octeon/cpu.c b/arch/mips/cavium-octeon/cpu.c
index b6df538..73387ac 100644
--- a/arch/mips/cavium-octeon/cpu.c
+++ b/arch/mips/cavium-octeon/cpu.c
@@ -26,6 +26,9 @@ static int cnmips_cu2_call(struct notifier_block *nfb, unsigned long action,
 
 	switch (action) {
 	case CU2_EXCEPTION:
+#ifdef CONFIG_WRHV
+		panic("COP2 is unsupported on Hypervisor\n");
+#endif
 		prefetch(&current->thread.cp2);
 		local_irq_save(flags);
 		KSTK_STATUS(current) |= ST0_CU2;
-- 
1.6.5.2

