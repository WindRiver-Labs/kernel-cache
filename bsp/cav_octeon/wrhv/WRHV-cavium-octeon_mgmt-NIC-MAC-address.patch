From ee6dcf2ed00daa260d1c4d210bf1e382a314dfdc Mon Sep 17 00:00:00 2001
From: Jeremy McNicoll <jeremy.mcnicoll@windriver.com>
Date: Tue, 24 May 2011 16:12:39 -0400
Subject: [PATCH 1/2] WRHV/cavium: octeon_mgmt NIC MAC address

MIPS guest automatically increments the MAC address provided
on the command line based on the port number.  The driver
now has some added verbosity to display the actual MAC address
on bootup.

Signed-off-by: Jeremy McNicoll <jeremy.mcnicoll@windriver.com>
---
 drivers/net/octeon/octeon_mgmt.c |   12 ++++++++++--
 1 files changed, 10 insertions(+), 2 deletions(-)

diff --git a/drivers/net/octeon/octeon_mgmt.c b/drivers/net/octeon/octeon_mgmt.c
index d021b83..56115bb 100644
--- a/drivers/net/octeon/octeon_mgmt.c
+++ b/drivers/net/octeon/octeon_mgmt.c
@@ -1485,12 +1485,12 @@ static int __init octeon_mgmt_probe(struct platform_device *pdev)
 	netdev->netdev_ops = &octeon_mgmt_ops;
 	netdev->ethtool_ops = &octeon_mgmt_ethtool_ops;
 
-
 	/* The mgmt ports get the first N MACs.  */
 	for (i = 0; i < 6; i++)
 		netdev->dev_addr[i] = octeon_bootinfo->mac_addr_base[i];
-	netdev->dev_addr[5] += p->port;
 
+	/* Increment the mac addr by 1 from the value supplied */
+	netdev->dev_addr[5] += p->port;
 	if (p->port >= octeon_bootinfo->mac_addr_count)
 		dev_err(&pdev->dev,
 			"Error %s: Using MAC outside of the assigned range: "
@@ -1499,6 +1499,14 @@ static int __init octeon_mgmt_probe(struct platform_device *pdev)
 			netdev->dev_addr[2], netdev->dev_addr[3],
 			netdev->dev_addr[4], netdev->dev_addr[5]);
 
+#ifdef CONFIG_WRHV
+	dev_info(&pdev->dev, "WRHV %s using MAC addr "
+			"%02x:%02x:%02x:%02x:%02x:%02x\n", netdev->name,
+			netdev->dev_addr[0], netdev->dev_addr[1],
+			netdev->dev_addr[2], netdev->dev_addr[3],
+			netdev->dev_addr[4], netdev->dev_addr[5]);
+#endif
+
 	if (register_netdev(netdev))
 		goto err;
 
-- 
1.6.5.2

