From 46c6b0582e4ee1701e557e776ab867259ed3e56e Mon Sep 17 00:00:00 2001
From: Yang Shi <yang.shi@windriver.com>
Date: Tue, 28 Dec 2010 16:15:01 +0800
Subject: [PATCH 23/38] WRHV: MIPS: Get current tick count from VB_STATUS

GOS can't access COP0 count register to get current time count, so
calling VBI to get current tick count from VB_STATUS.

Signed-off-by: Yang Shi <yang.shi@windriver.com>
---
 arch/mips/include/asm/timex.h |    4 ++++
 1 files changed, 4 insertions(+), 0 deletions(-)

diff --git a/arch/mips/include/asm/timex.h b/arch/mips/include/asm/timex.h
index 10c8dd8..54f11a1 100644
--- a/arch/mips/include/asm/timex.h
+++ b/arch/mips/include/asm/timex.h
@@ -47,7 +47,11 @@ typedef unsigned int cycles_t;
 #ifdef CONFIG_HAVE_GET_CYCLES_32
 static inline cycles_t get_cycles(void)
 {
+#ifdef CONFIG_WRHV
+	return VBI_TICK_COUNT_GET();
+#else
 	return read_c0_count();
+#endif
 }
 
 static inline void get_cycles_barrier(void)
-- 
1.6.5.2

