From db86d17f06eda8dd2c775d6260a9d3a8a6b5544a Mon Sep 17 00:00:00 2001
From: Liang Li <liang.li@windriver.com>
Date: Tue, 15 Mar 2011 14:50:52 +0800
Subject: [PATCH 2/2] WRHV: MIPS: enable wrload related syscall

When wrload works on syscall mode, the vbi syscalls
need to take care of arch specific information to
enable wrload operate destination VB

Signed-off-by: Liang Li <liang.li@windriver.com>
---
 kernel/vbi/syscall_vbi.c |    5 +++++
 1 files changed, 5 insertions(+), 0 deletions(-)

diff --git a/kernel/vbi/syscall_vbi.c b/kernel/vbi/syscall_vbi.c
index b65d305..3a8b5fe 100644
--- a/kernel/vbi/syscall_vbi.c
+++ b/kernel/vbi/syscall_vbi.c
@@ -96,6 +96,11 @@ asmlinkage long sys_vbi_activate_vb(uint32_t vb, uint32_t addr)
 	rctl.vbiRegSet.hreg32.r[0] = (uint32_t)vb_cfg;
 	rctl.vbiRegSet.hreg32.cpsr = PSR_F_BIT | PSR_I_BIT | SVC_MODE;
 #endif
+#ifdef CONFIG_MIPS
+	rctl.vbiRegSet.hreg64.pc = addr;
+	rctl.vbiRegSet.hreg64.gpreg[4] = vb_cfg;
+	rctl.vbiRegSet.hreg64.intDisable = -1;
+#endif
 
 	retval = vbi_vb_write_reg(&rctl, vb, 0);
 	if (retval) {
-- 
1.7.0.4

