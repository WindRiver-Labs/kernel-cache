From db86d17f06eda8dd2c775d6260a9d3a8a6b5544a Mon Sep 17 00:00:00 2001
From: Liang Li <liang.li@windriver.com>
Date: Tue, 15 Mar 2011 14:50:52 +0800
Subject: [PATCH 2/2] WRHV: MIPS: enable wrload related syscall

When wrload works on syscall mode, the vbi syscalls
need to take care of arch specific information to
enable wrload operate destination VB

Signed-off-by: Liang Li <liang.li@windriver.com>
---
 kernel/vbi/syscall_vbi.c |    5 +++++
 1 files changed, 5 insertions(+), 0 deletions(-)

diff --git a/kernel/vbi/syscall_vbi.c b/kernel/vbi/syscall_vbi.c
index e9011e8..0c435f8 100644
--- a/kernel/vbi/syscall_vbi.c
+++ b/kernel/vbi/syscall_vbi.c
@@ -91,6 +91,11 @@ asmlinkage long sys_vbi_activate_vb(uint32_t vb, uint32_t addr)
 	/* r3, 1st argument pointer to config page */
 	rctl.vbiRegSet.hreg32.gpr[3] = vb_cfg;
 #endif
+#ifdef CONFIG_MIPS
+	rctl.vbiRegSet.hreg64.pc = addr;
+	rctl.vbiRegSet.hreg64.gpreg[4] = vb_cfg;
+	rctl.vbiRegSet.hreg64.intDisable = -1;
+#endif
 
 	retval = vbi_vb_write_reg(&rctl, vb, 0);
 	if (retval) {
-- 
1.7.0.4

