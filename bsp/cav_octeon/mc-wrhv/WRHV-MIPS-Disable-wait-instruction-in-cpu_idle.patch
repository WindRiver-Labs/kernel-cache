From edfa5972f49aa5bd1d28b2dc0bd0b527031fbaba Mon Sep 17 00:00:00 2001
From: Yang Shi <yang.shi@windriver.com>
Date: Wed, 23 Feb 2011 10:39:27 +0800
Subject: [PATCH 29/38] WRHV: MIPS: Disable wait instruction in cpu_idle

For GOS, cpu_idle is used to notify Hypervisor current context
is idle so that Hypervisor can schedule another context to run.
So, disable wait instruction in cpu_idle.

Signed-off-by: Yang Shi <yang.shi@windriver.com>
---
 arch/mips/kernel/process.c |    3 ++-
 1 files changed, 2 insertions(+), 1 deletions(-)

diff --git a/arch/mips/kernel/process.c b/arch/mips/kernel/process.c
index 041d5df..fc39d83 100644
--- a/arch/mips/kernel/process.c
+++ b/arch/mips/kernel/process.c
@@ -70,13 +70,14 @@ void __noreturn cpu_idle(void)
 
 			smtc_idle_loop_hook();
 #endif
-
+#ifndef CONFIG_WRHV
 			if (cpu_wait) {
 				/* Don't trace irqs off for idle */
 				stop_critical_timings();
 				(*cpu_wait)();
 				start_critical_timings();
 			}
+#endif
 		}
 #ifdef CONFIG_HOTPLUG_CPU
 		if (!cpu_online(cpu) && !cpu_isset(cpu, cpu_callin_map) &&
-- 
1.6.5.2

