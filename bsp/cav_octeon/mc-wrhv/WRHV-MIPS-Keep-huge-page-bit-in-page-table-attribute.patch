From bc25d2a90d7e9239e60cfe672cb89379d64d4b1c Mon Sep 17 00:00:00 2001
From: Yang Shi <yang.shi@windriver.com>
Date: Tue, 31 May 2011 10:07:50 +0800
Subject: [PATCH] WRHV: MIPS: Keep huge page bit in page table attribute when WRHV enabled

Since HUGETLB is unsupported on GOS, but huge page bit is hardcoded
into Hypervisor, so keep huge page bit in page table attribute when
WRHV is enabled.

Signed-off-by: Yang Shi <yang.shi@windriver.com>
---
 arch/mips/include/asm/pgtable-bits.h |    2 +-
 1 files changed, 1 insertions(+), 1 deletions(-)

diff --git a/arch/mips/include/asm/pgtable-bits.h b/arch/mips/include/asm/pgtable-bits.h
index e9fe7e9..2253b75 100644
--- a/arch/mips/include/asm/pgtable-bits.h
+++ b/arch/mips/include/asm/pgtable-bits.h
@@ -94,7 +94,7 @@
 /* set:pagecache unset:swap */
 #define _PAGE_FILE		(_PAGE_MODIFIED)
 
-#ifdef CONFIG_HUGETLB_PAGE
+#if defined(CONFIG_HUGETLB_PAGE) || defined(CONFIG_WRHV)
 /* huge tlb page */
 #define _PAGE_HUGE_SHIFT	(_PAGE_MODIFIED_SHIFT + 1)
 #define _PAGE_HUGE		(1 << _PAGE_HUGE_SHIFT)
-- 
1.7.0.4

