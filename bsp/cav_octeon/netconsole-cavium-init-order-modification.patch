From bbea30000c5b39a91d2c57c935ea51ab2c117e6a Mon Sep 17 00:00:00 2001
From: Jason HU <yongqi.hu@windriver.com>
Date: Tue, 6 Jul 2010 01:28:48 -0700
Subject: [PATCH] netconsole/cavium: init order modification

Cavium-ethernet driver is initialized after netconsole and causes
netconsole fail to find device eth0 and will abort.

drivers/Makefile is modified by moving staging ahead of net so that
the Ethernet driver there will be initialized before netconsole.

drivers/net/Makefile is modified by movingthe item for netconsole
or obj-$(CONFIG_NETCONSOLE) += netconsole.o, to the end of the
makefile to make all the NIC drivers initiate before netconsole,
which makes netconsole always work.

Signed-off-by: Jason HU <yongqi.hu@windriver.com>
---
 drivers/Makefile     |    2 +-
 drivers/net/Makefile |    3 ++-
 2 files changed, 3 insertions(+), 2 deletions(-)

diff --git a/drivers/Makefile b/drivers/Makefile
index 6280b72..79c8b07 100644
--- a/drivers/Makefile
+++ b/drivers/Makefile
@@ -46,6 +46,7 @@ obj-$(CONFIG_SCSI)		+= scsi/
 obj-$(CONFIG_ATA)		+= ata/
 obj-$(CONFIG_MTD)		+= mtd/
 obj-$(CONFIG_SPI)		+= spi/
+obj-$(CONFIG_STAGING)		+= staging/
 obj-y				+= net/
 obj-$(CONFIG_ATM)		+= atm/
 obj-$(CONFIG_FUSION)		+= message/
@@ -110,7 +111,6 @@ obj-$(CONFIG_OF)		+= of/
 obj-$(CONFIG_SSB)		+= ssb/
 obj-$(CONFIG_VHOST_NET)		+= vhost/
 obj-$(CONFIG_VLYNQ)		+= vlynq/
-obj-$(CONFIG_STAGING)		+= staging/
 obj-y				+= platform/
 obj-y				+= ieee802154/
 obj-y				+= vbus/
diff --git a/drivers/net/Makefile b/drivers/net/Makefile
index b27c7a3..ca5f17f 100644
--- a/drivers/net/Makefile
+++ b/drivers/net/Makefile
@@ -282,7 +282,6 @@ obj-$(CONFIG_IRDA) += irda/
 obj-$(CONFIG_ETRAX_ETHERNET) += cris/
 obj-$(CONFIG_ENP2611_MSF_NET) += ixp2000/
 
-obj-$(CONFIG_NETCONSOLE) += netconsole.o
 obj-$(CONFIG_KGDBOE) += kgdboe.o
 
 obj-$(CONFIG_FS_ENET) += fs_enet/
@@ -296,3 +295,5 @@ obj-$(CONFIG_SFC) += sfc/
 obj-$(CONFIG_WIMAX) += wimax/
 
 obj-$(CONFIG_OCTEON_MGMT_ETHERNET) += octeon/
+
+obj-$(CONFIG_NETCONSOLE) += netconsole.o
-- 
1.6.5.2

