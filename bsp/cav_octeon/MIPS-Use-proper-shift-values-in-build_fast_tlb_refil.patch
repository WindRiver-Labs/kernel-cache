From 9425c7a1b820bd508688596d58f8f07601bee63f Mon Sep 17 00:00:00 2001
From: ltian <le.tian@windriver.com>
Date: Mon, 15 Nov 2010 14:48:48 +0800
Subject: [PATCH 115/132] MIPS: Use proper shift values in build_fast_tlb_refill_handler().

Use proper shift values in build_fast_tlb_refill_handler(),
instead of hard code.

Signed-off-by: David Daney <ddaney@caviumnetworks.com>
Signed-off-by: ltian <le.tian@windriver.com>
---
 arch/mips/mm/tlbex.c |    4 ++--
 1 files changed, 2 insertions(+), 2 deletions(-)

diff --git a/arch/mips/mm/tlbex.c b/arch/mips/mm/tlbex.c
index e04a265..81d984d 100644
--- a/arch/mips/mm/tlbex.c
+++ b/arch/mips/mm/tlbex.c
@@ -1066,9 +1066,9 @@ build_fast_tlb_refill_handler (u32 **p, struct uasm_label **l,
 		UASM_i_MTC0(p, even, C0_ENTRYLO0); /* load it */
 		uasm_i_drotr(p, odd, odd, ilog2(_PAGE_GLOBAL) - ilog2(_PAGE_NO_EXEC));
 	} else {
-		uasm_i_dsrl_safe(p, even, even, 6);
+		uasm_i_dsrl_safe(p, even, even, ilog2(_PAGE_GLOBAL));
 		UASM_i_MTC0(p, even, C0_ENTRYLO0); /* load it */
-		uasm_i_dsrl_safe(p, odd, odd, 6);
+		uasm_i_dsrl_safe(p, odd, odd, ilog2(_PAGE_GLOBAL));
 	}
 	UASM_i_MTC0(p, odd, C0_ENTRYLO1); /* load it */
 
-- 
1.6.5.2

