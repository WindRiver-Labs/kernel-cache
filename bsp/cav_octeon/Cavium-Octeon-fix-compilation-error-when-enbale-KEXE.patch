From 5e28f127db6ae25138cabe56cbcc8dfeb206356c Mon Sep 17 00:00:00 2001
From: Tian Le <le.tian@windriver.com>
Date: Tue, 7 Dec 2010 12:59:53 +0800
Subject: [PATCH 125/132] Cavium Octeon: fix compilation error when enbale KEXEC.

Fix compilation error, by adding CONFIG_CRASH_DUMP macro.

Signed-off-by: ltian <le.tian@windriver.com>
---
 arch/mips/cavium-octeon/setup.c       |    2 ++
 drivers/net/octeon/octeon-kexec-net.c |   18 +++++++++---------
 2 files changed, 11 insertions(+), 9 deletions(-)

diff --git a/arch/mips/cavium-octeon/setup.c b/arch/mips/cavium-octeon/setup.c
index 2e69fdb..dfc9227 100644
--- a/arch/mips/cavium-octeon/setup.c
+++ b/arch/mips/cavium-octeon/setup.c
@@ -956,6 +956,7 @@ static int __init octeon_l2_cache_lock(void)
 late_initcall(octeon_l2_cache_lock);
 #endif
 
+#ifndef CONFIG_CRASH_DUMP
 /* Exclude a single page from the regions obtained in plat_mem_setup. */
 static __init void memory_exclude_page(u64 addr, u64 *mem, u64 *size)
 {
@@ -971,6 +972,7 @@ static __init void memory_exclude_page(u64 addr, u64 *mem, u64 *size)
                *size -= PAGE_SIZE;
        }
 }
+#endif
 
 void __init plat_mem_setup(void)
 {
diff --git a/drivers/net/octeon/octeon-kexec-net.c b/drivers/net/octeon/octeon-kexec-net.c
index 97d2915..debf5dc 100644
--- a/drivers/net/octeon/octeon-kexec-net.c
+++ b/drivers/net/octeon/octeon-kexec-net.c
@@ -4,15 +4,15 @@
 #include <asm/octeon/cvmx-ipd-defs.h>
 #include <asm/octeon/cvmx-mixx-defs.h>
 #include <linux/netdevice.h>
-#include "cvmx-helper.h"
-#include "cvmx-helper-util.h"
-#include "cvmx-config.h"
-#include "cvmx-fpa-defs.h"
-#include "cvmx-pip-defs.h"
-#include "cvmx-pko-defs.h"
-#include "cvmx-smix-defs.h"
-#include "cvmx-pow.h"
-#include "cvmx-asxx-defs.h"
+#include <asm/octeon/cvmx-helper.h>
+#include <asm/octeon/cvmx-helper-util.h>
+#include <asm/octeon/cvmx-config.h>
+#include <asm/octeon/cvmx-fpa-defs.h>
+#include <asm/octeon/cvmx-pip-defs.h>
+#include <asm/octeon/cvmx-pko-defs.h>
+#include <asm/octeon/cvmx-smix-defs.h>
+#include <asm/octeon/cvmx-pow.h>
+#include <asm/octeon/cvmx-asxx-defs.h>
 
 void octeon_shutdown_network_hw(void)
 {
-- 
1.6.5.2

