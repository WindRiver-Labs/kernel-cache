From a93b0ea01dca554274d1a625df8afe7170fad236 Mon Sep 17 00:00:00 2001
From: zou cao <cao.zou@windriver.com>
Date: Sun, 21 May 2017 13:37:33 +0800
Subject: [PATCH] bcmdhd: use real irq flags to replace IRQRESOURCE

It isn't right to directly use the IRQRESOURCE flags as irq request flags,
here transfer IRQRESOURCE to right irq flags.

Signed-off-by: zou cao <cao.zou@windriver.com>
---
 drivers/net/wireless/bcmdhd/bcmsdh_linux.c |   10 +++++++++-
 1 files changed, 9 insertions(+), 1 deletions(-)

diff --git a/drivers/net/wireless/bcmdhd/bcmsdh_linux.c b/drivers/net/wireless/bcmdhd/bcmsdh_linux.c
index 3eb4a48..f562353 100644
--- a/drivers/net/wireless/bcmdhd/bcmsdh_linux.c
+++ b/drivers/net/wireless/bcmdhd/bcmsdh_linux.c
@@ -338,6 +338,8 @@ int bcmsdh_oob_intr_register(bcmsdh_info_t *bcmsdh, bcmsdh_cb_fn_t oob_irq_handl
 {
 	int err = 0;
 	bcmsdh_os_info_t *bcmsdh_osinfo = bcmsdh->os_cxt;
+	unsigned long irq_flags = 0;
+
 
 	SDLX_MSG(("%s: Enter\n", __FUNCTION__));
 	if (bcmsdh_osinfo->oob_irq_registered) {
@@ -354,8 +356,14 @@ int bcmsdh_oob_intr_register(bcmsdh_info_t *bcmsdh, bcmsdh_cb_fn_t oob_irq_handl
 	err = odin_gpio_sms_request_irq(bcmsdh_osinfo->oob_irq_num, wlan_oob_irq,
 		bcmsdh_osinfo->oob_irq_flags, "bcmsdh_sdmmc", bcmsdh);
 #else
+	if (bcmsdh_osinfo->oob_irq_flags & IORESOURCE_IRQ_SHAREABLE)
+		irq_flags |= IRQF_TRIGGER_PROBE;		
+
+	if (bcmsdh_osinfo->oob_irq_flags & IORESOURCE_IRQ_HIGHLEVEL)
+		irq_flags |= IRQF_TRIGGER_HIGH;
+
 	err = request_irq(bcmsdh_osinfo->oob_irq_num, wlan_oob_irq,
-		bcmsdh_osinfo->oob_irq_flags, "bcmsdh_sdmmc", bcmsdh);
+		irq_flags, "bcmsdh_sdmmc", bcmsdh);
 #endif /* defined(CONFIG_ARCH_ODIN) */
 	if (err) {
 		SDLX_MSG(("%s: request_irq failed with %d\n", __FUNCTION__, err));
-- 
1.7.5.4

