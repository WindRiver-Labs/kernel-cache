From 60a60b03aed71fb9093e38267d814e9a2c480a46 Mon Sep 17 00:00:00 2001
From: Adrian Alonso <adrian.alonso@nxp.com>
Date: Mon, 19 Sep 2016 14:33:58 -0500
Subject: [PATCH 85/85] MLK-13243: arm: imx6q: busfreq: lpddr2 fix system
 clocks audio mode

Fix system clock topology used by lpddr2 for audio mode
Keep pll2_pfd2 as clock root for periph_pre_clk to match
lpddr2_freq_imx6q.S switching mechanism.

(Rework from commit id 427b1b6d628827ca83887b92c8331a261a254151)

Signed-off-by: Adrian Alonso <adrian.alonso@nxp.com>
(Cherry pick from commit 583b09e4d30ec0ce3b3a0494ebd0419d05701ce2)
[zou:Original patch taken from
git://git.freescale.com/imx/linux-imx.git imx_4.1.15_2.0.0_ga]
Signed-off-by: zou cao <cao.zou@windriver.com>
---
 arch/arm/mach-imx/busfreq-imx.c |    5 ++++-
 1 files changed, 4 insertions(+), 1 deletions(-)

diff --git a/arch/arm/mach-imx/busfreq-imx.c b/arch/arm/mach-imx/busfreq-imx.c
index aa228ba..8bafe4b 100644
--- a/arch/arm/mach-imx/busfreq-imx.c
+++ b/arch/arm/mach-imx/busfreq-imx.c
@@ -268,7 +268,10 @@ static void enter_lpm_imx6_smp(void)
 			update_lpddr2_freq_smp(HIGH_AUDIO_CLK);
 		/* Make sure periph clk's parent also got updated */
 		imx_clk_set_parent(periph_clk2_sel_clk, pll3_clk);
-		imx_clk_set_parent(periph_pre_clk, pll2_200_clk);
+		if (ddr_type == MMDC_MDMISC_DDR_TYPE_DDR3)
+			imx_clk_set_parent(periph_pre_clk, pll2_200_clk);
+		else if (ddr_type == MMDC_MDMISC_DDR_TYPE_LPDDR2)
+			imx_clk_set_parent(periph_pre_clk, pll2_400_clk);
 		imx_clk_set_parent(periph_clk, periph_pre_clk);
 		audio_bus_freq_mode = 1;
 		low_bus_freq_mode = 0;
-- 
1.7.5.4

