From af3c401e3b847f540dc4c518aea4c8eef5b824cc Mon Sep 17 00:00:00 2001
From: Dong Aisheng <aisheng.dong@nxp.com>
Date: Wed, 7 Sep 2016 17:25:52 +0800
Subject: [PATCH 82/85] MLK-13190 bcmdhd: fix compile issue if build MMC
 subsystem as module

BCMDHD_SDIO needs to be tristate for the correct dependency
of MMC core subsystem.
And the old driver buildin mode is static defined by DRIVER_TYPE.
Fix it to depend on CONFIG_BCMDHD_SDIO.

Signed-off-by: Dong Aisheng <aisheng.dong@nxp.com>
(cherry picked from commit a240645d6bb8062e5a9e73bc14697d0920e0c34e)
[zou:Original patch taken from
git://git.freescale.com/imx/linux-imx.git imx_4.1.15_2.0.0_ga]
Signed-off-by: zou cao <cao.zou@windriver.com>
---
 drivers/net/wireless/bcmdhd/Kconfig  |    2 +-
 drivers/net/wireless/bcmdhd/Makefile |    4 ++--
 2 files changed, 3 insertions(+), 3 deletions(-)

diff --git a/drivers/net/wireless/bcmdhd/Kconfig b/drivers/net/wireless/bcmdhd/Kconfig
index 2a0856e..e5bc667 100644
--- a/drivers/net/wireless/bcmdhd/Kconfig
+++ b/drivers/net/wireless/bcmdhd/Kconfig
@@ -8,7 +8,7 @@ config BCMDHD
 	  unsure.
 
 config BCMDHD_SDIO
-	bool "SDIO bus interface support"
+	tristate "SDIO bus interface support"
 	depends on BCMDHD && MMC
 
 config BCMDHD_PCIE
diff --git a/drivers/net/wireless/bcmdhd/Makefile b/drivers/net/wireless/bcmdhd/Makefile
index c98a5be..e6ba661 100644
--- a/drivers/net/wireless/bcmdhd/Makefile
+++ b/drivers/net/wireless/bcmdhd/Makefile
@@ -96,7 +96,7 @@ DHDCFLAGS += -DWL_IFACE_COMB_NUM_CHANNELS
 # m: module type driver
 # y: built-in type driver
 ##########################
-DRIVER_TYPE ?= y
+#DRIVER_TYPE ?= y
 
 #########################
 # Chip dependent feature
@@ -184,7 +184,7 @@ ifneq ($(CONFIG_BCMDHD_PCIE),)
 endif
 
 bcmdhd-objs := $(DHDOFILES)
-obj-$(DRIVER_TYPE)   += bcmdhd.o
+obj-$(CONFIG_BCMDHD_SDIO)   += bcmdhd.o
 
 all:
 	@echo "$(MAKE) --no-print-directory -C $(KDIR) SUBDIRS=$(CURDIR) modules"
-- 
1.7.5.4

