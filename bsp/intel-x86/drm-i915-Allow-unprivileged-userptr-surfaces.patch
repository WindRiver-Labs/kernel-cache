From ead61ae0a980a9b0e976136e6744fcf9ef4802df Mon Sep 17 00:00:00 2001
From: Zhipeng Gong <zhipeng.gong@intel.com>
Date: Thu, 10 Jul 2014 10:04:53 +0800
Subject: [PATCH 08/14] drm/i915: Allow unprivileged userptr surfaces

Internal users of userptr want to create unsynchronized surfaces
from unprivileged user accounts. This is not acceptable in the
upstream world so we have to carry this patch forever. Luckily
it is a simple patch so shouldn't be too much of a burden.

[Original patch was taken from Intel MediaSDK]

Signed-off-by: Zhipeng Gong <zhipeng.gong@intel.com>
Signed-off-by: Pengyu Ma <pengyu.ma@windriver.com>
---
 drivers/gpu/drm/i915/i915_gem_userptr.c |    4 ++--
 1 files changed, 2 insertions(+), 2 deletions(-)

diff --git a/drivers/gpu/drm/i915/i915_gem_userptr.c b/drivers/gpu/drm/i915/i915_gem_userptr.c
index d182058..401372c 100644
--- a/drivers/gpu/drm/i915/i915_gem_userptr.c
+++ b/drivers/gpu/drm/i915/i915_gem_userptr.c
@@ -321,7 +321,7 @@ i915_gem_userptr_init__mmu_notifier(struct drm_i915_gem_object *obj,
 	int ret;
 
 	if (flags & I915_USERPTR_UNSYNCHRONIZED)
-		return capable(CAP_SYS_ADMIN) ? 0 : -EPERM;
+		return 0; /* VPG: Allow normal users. */
 
 	if (WARN_ON(obj->userptr.mm == NULL))
 		return -EINVAL;
@@ -375,7 +375,7 @@ i915_gem_userptr_init__mmu_notifier(struct drm_i915_gem_object *obj,
 		return -ENODEV;
 
 	if (!capable(CAP_SYS_ADMIN))
-		return -EPERM;
+		return 0; /* VPG: Allow normal users. */
 
 	return 0;
 }
-- 
1.7.5.4

