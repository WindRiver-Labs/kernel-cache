From 1ef15a2c99c5e52c08064aafe3128f4416706602 Mon Sep 17 00:00:00 2001
From: Alexandru Moise <alexandru.moise@windriver.com>
Date: Fri, 11 Nov 2016 16:36:44 +0200
Subject: [PATCH] i915: wait on per-cpu spinlock rather than disabling irqs on
 preempt-rt

Issue: LIN8-5056

commit fc3ebe "Rever the upgrading of kernel 4.4 i915"
missed this small change and broke preempt-rt kernels running
the i915 driver, this commit fixes it.

This patch only affects RT-enabled kernels.

Signed-off-by: Alexandru Moise <alexandru.moise@windriver.com>
---
 drivers/gpu/drm/i915/intel_sprite.c |    2 +-
 1 files changed, 1 insertions(+), 1 deletions(-)

diff --git a/drivers/gpu/drm/i915/intel_sprite.c b/drivers/gpu/drm/i915/intel_sprite.c
index 56dc132..8f7b337 100644
--- a/drivers/gpu/drm/i915/intel_sprite.c
+++ b/drivers/gpu/drm/i915/intel_sprite.c
@@ -96,7 +96,7 @@ void intel_pipe_update_start(struct intel_crtc *crtc)
 	min = vblank_start - usecs_to_scanlines(adjusted_mode, 100);
 	max = vblank_start - 1;
 
-	local_irq_disable();
+	local_lock_irq(intel_crtc_lock);
 
 	if (min <= 0 || max <= 0)
 		return;
-- 
1.7.5.4

