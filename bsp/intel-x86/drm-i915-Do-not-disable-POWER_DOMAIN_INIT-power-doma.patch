From c8c594edeba0a194db2e1919950b4e909fb82c05 Mon Sep 17 00:00:00 2001
From: Liwei Song <liwei.song@windriver.com>
Date: Tue, 17 Nov 2015 16:31:08 +0800
Subject: [PATCH] drm/i915: Do not disable POWER_DOMAIN_INIT power domain when
 update crtc

This patch can fix the following issue in baytrail platform:
Boot without VGA connected, after boot it successfully, VGA display
does not become active if plugged in the VGA line.

This is due to the power-domain POWER_DOMAIN_INIT was disabled when
update the crtc, at the same time the DISPLAY power-well which belong
to this power-domain is also disabled, without the enable of DISPLAY,
the interrupt in this power-domain also can not be triggered, so when
connected the VGA, the hotplug event which registed in this interrupt
will not be run.

It can be fixed by stop the crtc update event to disable the
POWER_DOMAIN_INIT domain, and mark this power domain will be used
sometimes by transmiting "true" to the function intel_display_set_init_power.

And Upstream also exist this issue.

Signed-off-by: Liwei Song <liwei.song@windriver.com>
---
 drivers/gpu/drm/i915/intel_display.c |    2 +-
 1 files changed, 1 insertions(+), 1 deletions(-)

diff --git a/drivers/gpu/drm/i915/intel_display.c b/drivers/gpu/drm/i915/intel_display.c
index 3220610..4fc2a4d 100644
--- a/drivers/gpu/drm/i915/intel_display.c
+++ b/drivers/gpu/drm/i915/intel_display.c
@@ -4583,7 +4583,7 @@ static void modeset_update_crtc_power_domains(struct drm_device *dev)
 		crtc->enabled_power_domains = pipe_domains[crtc->pipe];
 	}
 
-	intel_display_set_init_power(dev_priv, false);
+	intel_display_set_init_power(dev_priv, true);
 }
 
 /* returns HPLL frequency in kHz */
-- 
1.7.5.4

