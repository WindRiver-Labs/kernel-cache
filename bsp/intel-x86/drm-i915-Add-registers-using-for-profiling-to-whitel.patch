From 58c8e979591a1e9d38c63761d528efae75d249f5 Mon Sep 17 00:00:00 2001
From: Zhipeng Gong <zhipeng.gong@intel.com>
Date: Wed, 9 Jul 2014 15:52:17 +0800
Subject: [PATCH 07/14] drm/i915: Add registers using for profiling to
 whitelist

[Original patch was taken from Intel MediaSDK]

Signed-off-by: Zhipeng Gong <zhipeng.gong@intel.com>
Signed-off-by: Pengyu Ma <pengyu.ma@windriver.com>
---
 drivers/gpu/drm/i915/i915_reg.h     |    3 ++-
 drivers/gpu/drm/i915/intel_uncore.c |    5 ++++-
 2 files changed, 6 insertions(+), 2 deletions(-)

diff --git a/drivers/gpu/drm/i915/i915_reg.h b/drivers/gpu/drm/i915/i915_reg.h
index dae81e8..9d973fb 100644
--- a/drivers/gpu/drm/i915/i915_reg.h
+++ b/drivers/gpu/drm/i915/i915_reg.h
@@ -1108,7 +1108,8 @@ enum punit_power_well {
 #define RING_NOPID(base)	((base)+0x94)
 #define RING_IMR(base)		((base)+0xa8)
 #define RING_HWSTAM(base)	((base)+0x98)
-#define RING_TIMESTAMP(base)	((base)+0x358)
+#define RING_TIMESTAMP_LO(base)	((base)+0x358)
+#define RING_TIMESTAMP_HI(base)	((base)+0x35C)
 #define   TAIL_ADDR		0x001FFFF8
 #define   HEAD_WRAP_COUNT	0xFFE00000
 #define   HEAD_WRAP_ONE		0x00200000
diff --git a/drivers/gpu/drm/i915/intel_uncore.c b/drivers/gpu/drm/i915/intel_uncore.c
index bddc9fd..177ebbc 100644
--- a/drivers/gpu/drm/i915/intel_uncore.c
+++ b/drivers/gpu/drm/i915/intel_uncore.c
@@ -970,7 +970,10 @@ static const struct register_whitelist {
 	/* supported gens, 0x10 for 4, 0x30 for 4 and 5, etc. */
 	uint32_t gen_bitmask;
 } whitelist[] = {
-	{ RING_TIMESTAMP(RENDER_RING_BASE), 8, GEN_RANGE(4, 8) },
+	{ RING_TIMESTAMP_LO(RENDER_RING_BASE), 4, 0xF0 },
+	{ RING_TIMESTAMP_HI(RENDER_RING_BASE), 4, 0xF0 },
+	{ GEN6_RP_STATE_CAP, 4, 0xF0 },
+	{ HSW_EDRAM_PRESENT, 4, 0xF0 }
 };
 
 int i915_reg_read_ioctl(struct drm_device *dev,
-- 
1.7.5.4

