From a09b0576d5cfa0b0d9b93841e09e4b3f5f99fb2a Mon Sep 17 00:00:00 2001
From: Zhang Xiao <xiao.zhang@windriver.com>
Date: Wed, 2 Dec 2015 09:50:59 +0800
Subject: [PATCH] bpf: fix build error for error for lack of bpf_binary_header

Several upstream was introduced caused this build error:
arch/x86/net/bpf_jit_comp.c: In function 'bpf_jit_free_deferred':
arch/x86/net/bpf_jit_comp.c:758:28: error: dereferencing pointer to
incomplete type
  set_memory_rw(addr, header->pages);

The set_memory_rw here is not necessary since no one set it to ro
before. Remove it.

Signed-off-by: Zhang Xiao <xiao.zhang@windriver.com>
---
 arch/x86/net/bpf_jit_comp.c |    1 -
 1 files changed, 0 insertions(+), 1 deletions(-)

diff --git a/arch/x86/net/bpf_jit_comp.c b/arch/x86/net/bpf_jit_comp.c
index a5c4294..6f17188 100644
--- a/arch/x86/net/bpf_jit_comp.c
+++ b/arch/x86/net/bpf_jit_comp.c
@@ -760,7 +760,6 @@ static void bpf_jit_free_deferred(struct work_struct *work)
 	unsigned long addr = (unsigned long)fp->bpf_func & PAGE_MASK;
 	struct bpf_binary_header *header = (void *)addr;
 
-	set_memory_rw(addr, header->pages);
 	module_free(NULL, header);
 	kfree(fp);
 }
-- 
1.7.5.4

