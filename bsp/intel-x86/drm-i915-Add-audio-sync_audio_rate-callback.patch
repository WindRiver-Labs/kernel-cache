From 8c437177ef8cc22a28db1ac8825e92125f514af0 Mon Sep 17 00:00:00 2001
From: Libin Yang <libin.yang@intel.com>
Date: Tue, 21 Jun 2016 02:38:43 -0700
Subject: [PATCH 228/435] drm/i915: Add audio sync_audio_rate callback

commit '5334240c30cb0058fa8c373bf0d653337833230d' upstream

Add the sync_audio_rate callback.

With the callback, audio driver can trigger
i915 driver to set the proper N/CTS or N/M
based on different sample rates.

Signed-off-by: Libin Yang <libin.yang@intel.com>
Reviewed-by: Jani Nikula <jani.nikula@intel.com>
Signed-off-by: Takashi Iwai <tiwai@suse.de>
[yadi:add missing MAX_PORT definitions for i915]
Signed-off-by: Hu <yadi.hu@windriver.com>
---
 include/drm/i915_component.h |   18 ++++++++++++++++++
 1 files changed, 18 insertions(+), 0 deletions(-)

diff --git a/include/drm/i915_component.h b/include/drm/i915_component.h
index ab5bde37..3fd457c 100644
--- a/include/drm/i915_component.h
+++ b/include/drm/i915_component.h
@@ -24,15 +24,33 @@
 #ifndef _I915_COMPONENT_H_
 #define _I915_COMPONENT_H_
 
+/* MAX_PORT is the number of port
+ * It must be sync with I915_MAX_PORTS defined i915_drv.h
+ * 5 should be enough as only HSW, BDW, SKL need such fix.
+ */
+#define MAX_PORTS 5
+
 struct i915_audio_component {
 	struct device *dev;
 
+	/**
+	 * @aud_sample_rate: the array of audio sample rate per port
+	 */
+	int aud_sample_rate[MAX_PORTS];
+
 	const struct i915_audio_component_ops {
 		struct module *owner;
 		void (*get_power)(struct device *);
 		void (*put_power)(struct device *);
 		void (*codec_wake_override)(struct device *, bool enable);
 		int (*get_cdclk_freq)(struct device *);
+		/**
+		 * @sync_audio_rate: set n/cts based on the sample rate
+		 *
+		 * Called from audio driver. After audio driver sets the
+		 * sample rate, it will call this function to set n/cts
+		 */
+		int (*sync_audio_rate)(struct device *, int port, int rate);
 	} *ops;
 
 	const struct i915_audio_component_audio_ops {
-- 
1.7.5.4

