From add19ab743a34c122b1de38a3e9296f1fa2b36a6 Mon Sep 17 00:00:00 2001
From: Xufeng Zhang <xufeng.zhang@windriver.com>
Date: Tue, 21 Aug 2012 11:18:48 +0800
Subject: [PATCH] watchdog/iwdt: Remove __initdata macro from the definition
 of id_table

Don't free the memory of id_table after iwdt driver initialized,
or else kernel Oops may happen when access the id_table of iwdt:
  BUG: unable to handle kernel paging request at ffffffffa0005448
  IP: [<ffffffff812f264c>] pci_match_id+0x5c/0x110
  PGD 1772067 PUD 1776063 PMD 139244067 PTE 0
  Oops: 0000 [#1] PREEMPT SMP
  Call Trace:
  [<ffffffff812f27e4>] pci_match_device+0xe4/0xf0
  [<ffffffff813653b0>] ? __device_attach+0x0/0x50
  [<ffffffff812f2807>] pci_bus_match+0x17/0x30
  [<ffffffff813653dc>] __device_attach+0x2c/0x50
  [<ffffffff81364578>] bus_for_each_drv+0x68/0x90
  [<ffffffff813654b6>] device_attach+0x86/0x90
  [<ffffffff81364375>] bus_probe_device+0x25/0x40
  [<ffffffff81362abd>] device_add+0x4ed/0x5d0
  [<ffffffff812ed4c0>] pci_bus_add_device+0x20/0x50
  [<ffffffff812ed52f>] pci_bus_add_devices+0x3f/0x160
  [<ffffffff8153891c>] pci_rescan_bus+0x8c/0xa0
  [<ffffffffa00413e4>] fmInsertSwitch+0x44/0x60 [focalpoint]
  [<ffffffffa0041505>] fopsIoctl+0xa5/0x310 [focalpoint]
  [<ffffffff810685cc>] ? lock_hrtimer_base+0x2c/0x60
  [<ffffffff8154d1c2>] ? _raw_spin_unlock_irqrestore+0x12/0x40
  [<ffffffff8154d877>] ? _lock_kernel+0x47/0x192
  [<ffffffff81117557>] vfs_ioctl+0x97/0xd0
  [<ffffffff811176a0>] do_vfs_ioctl+0x80/0x560
  [<ffffffff81068b97>] ? hrtimer_nanosleep+0xa7/0x150
  [<ffffffff81108f67>] ? fget_light+0xc7/0x100
  [<ffffffff81117c09>] sys_ioctl+0x89/0x100
  [<ffffffff810024eb>] system_call_done+0x0/0x5
  ---[ end trace f52ce65bddc6a9c2 ]---

Signed-off-by: Xufeng Zhang <xufeng.zhang@windriver.com>
---
 drivers/watchdog/iwdt.c | 2 +-
 1 file changed, 1 insertion(+), 1 deletion(-)

diff --git a/drivers/watchdog/iwdt.c b/drivers/watchdog/iwdt.c
index 6e2eabd..7cfd8a6 100755
--- a/drivers/watchdog/iwdt.c
+++ b/drivers/watchdog/iwdt.c
@@ -257,7 +257,7 @@ STATIC int check_wdt_intr(u8 int_type);
 STATIC int check_wdt_timeout1(u32 val);
 STATIC int check_wdt_timeout2(u32 val);
 
-STATIC struct pci_device_id lpc_pci_tbl[] __initdata = {
+STATIC struct pci_device_id lpc_pci_tbl[] = {
     {PCI_VENDOR_ID_INTEL, PCI_DEVICE_ID_INTEL_E3100, PCI_ANY_ID, PCI_ANY_ID,},
     {PCI_VENDOR_ID_INTEL, PCI_DEVICE_ID_INTEL_WDT,
      PCI_ANY_ID, PCI_ANY_ID, },
-- 
1.7.11

