From c01de4e45e6fb6bd48caafc0a73d04b411a9c257 Mon Sep 17 00:00:00 2001
From: Shinya Kuribayashi <shinya.kuribayashi@necel.com>
Date: Mon, 7 Sep 2009 09:33:30 +0900
Subject: [PATCH 3/4] nec_emma3tl2: Prepare for Kconfig options and the device header

EMMA3TL2 has the following features:
* Multi-processor system (Main 4KEc + Sub 4KEc)
* DDR2 memory interface
* Peripheral interfaces (Ethernet, USB2.0, UART, I2C, GPIO, etc.)
* OneNAND I/F
* etc.

This patch adds minimum basic options as a first step.

Signed-off-by: Shinya Kuribayashi <shinya.kuribayashi@necel.com>
---
 arch/mips/emma/Kconfig           |    9 +++
 include/asm-mips/emma/emma3tl2.h |  137 ++++++++++++++++++++++++++++++++++++++
 include/asm-mips/emma/emmaxxx.h  |    3 +
 3 files changed, 149 insertions(+), 0 deletions(-)
 create mode 100644 include/asm-mips/emma/emma3tl2.h

diff --git a/arch/mips/emma/Kconfig b/arch/mips/emma/Kconfig
index 673fa50..e2f72ba 100644
--- a/arch/mips/emma/Kconfig
+++ b/arch/mips/emma/Kconfig
@@ -23,6 +23,15 @@ config SOC_EMMA3PF
 	select SYS_HAS_CPU_MIPS32_R2
 	select SYS_HAS_CPU_SS1000
 
+config SOC_EMMA3TL2
+	bool
+	select EMMA_HAS_I2C
+	select EMMA_HAS_NEC_CANDY
+	select EMMA_HAS_USB_EHCI
+	select EMMA_HAS_USB_OHCI
+	select SOC_EMMA
+	select SYS_HAS_CPU_MIPS32_R2
+
 config SOC_EMMA
 	bool
 	select CEVT_R4K
diff --git a/include/asm-mips/emma/emma3tl2.h b/include/asm-mips/emma/emma3tl2.h
new file mode 100644
index 0000000..a2470e6
--- /dev/null
+++ b/include/asm-mips/emma/emma3tl2.h
@@ -0,0 +1,137 @@
+/*
+ * EMMA3TL2 register definitions, etc.
+ *
+ * Copyright (C) 2009  NEC Electronics Corporation
+ *
+ * This program is free software; you can redistribute it and/or
+ * modify it under the terms of the GNU General Public License
+ * (version 2) as published by the Free Software Foundation.
+ *
+ * This program is distributed in the hope that it will be useful,
+ * but WITHOUT ANY WARRANTY; without even the implied warranty of
+ * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
+ * GNU General Public License for more details.
+ *
+ * You should have received a copy of the GNU General Public License
+ * along with this program; if not, write to the Free Software Foundation,
+ * Inc., 51 Franklin Street, Fifth Floor, Boston, MA  02110-1301, USA.
+ */
+#ifndef __ASM_EMMA_EMMA3TL2_H
+#define __ASM_EMMA_EMMA3TL2_H
+
+#define EMMA_BHIF_BASE			0x10000000
+#define EMMA_ETHER_BASE			0x10012000
+#define EMMA_PBRD_BASE			0x10100000
+#define EMMA_TIMER_BASE			0x10110000
+#define EMMA_FLIP_BASE			0x10200000
+
+#define EMMA_BHIF_STRAP_0		(EMMA_BHIF_BASE + 0x0010)
+#define EMMA_BHIF_CLKSEL		(EMMA_BHIF_BASE + 0x001c)
+#define EMMA_BHIF_ALTERNATE0		(EMMA_BHIF_BASE + 0x0028)
+#define EMMA_BHIF_ALTERNATE1		(EMMA_BHIF_BASE + 0x0018)
+#define EMMA_BHIF_INT_ST_0		(EMMA_BHIF_BASE + 0x0030)
+#define EMMA_BHIF_INT_ST_1		(EMMA_BHIF_BASE + 0x0034)
+#define EMMA_BHIF_INT_ST_2		(EMMA_BHIF_BASE + 0x0038)
+#define EMMA_BHIF_INT_EN_0		(EMMA_BHIF_BASE + 0x0040)
+#define EMMA_BHIF_INT_EN_1		(EMMA_BHIF_BASE + 0x0044)
+#define EMMA_BHIF_INT_EN_2		(EMMA_BHIF_BASE + 0x0048)
+#define EMMA_BHIF_INT1_EN_0		(EMMA_BHIF_BASE + 0x0050)
+#define EMMA_BHIF_INT1_EN_1		(EMMA_BHIF_BASE + 0x0054)
+#define EMMA_BHIF_INT1_EN_2		(EMMA_BHIF_BASE + 0x0058)
+#define EMMA_BHIF_SUB_INT_ST_0		(EMMA_BHIF_BASE + 0x0100)
+#define EMMA_BHIF_SUB_INT_ST_1		(EMMA_BHIF_BASE + 0x0104)
+#define EMMA_BHIF_SUB_INT_ST_2		(EMMA_BHIF_BASE + 0x0108)
+#define EMMA_BHIF_SUB_INT_EN_0		(EMMA_BHIF_BASE + 0x0110)
+#define EMMA_BHIF_SUB_INT_EN_1		(EMMA_BHIF_BASE + 0x0114)
+#define EMMA_BHIF_SUB_INT_EN_2		(EMMA_BHIF_BASE + 0x0118)
+#define EMMA_BHIF_SUB_INT1_EN_0		(EMMA_BHIF_BASE + 0x0120)
+#define EMMA_BHIF_SUB_INT1_EN_1		(EMMA_BHIF_BASE + 0x0124)
+#define EMMA_BHIF_SUB_INT1_EN_2		(EMMA_BHIF_BASE + 0x0128)
+#define EMMA_BHIF_SW_INT		(EMMA_BHIF_BASE + 0x01a0)
+#define EMMA_BHIF_SW_INT_EN		(EMMA_BHIF_BASE + 0x01a4)
+#define EMMA_BHIF_SW_INT_CLR		(EMMA_BHIF_BASE + 0x01a8)
+
+#define EMMA_PUART0_BASE		(EMMA_PBRD_BASE + 0x1000)
+#define EMMA_PUART1_BASE		(EMMA_PBRD_BASE + 0x2000)
+#define EMMA_PIIC0_BASE			(EMMA_PBRD_BASE + 0x4000)
+#define EMMA_PIIC1_BASE			(EMMA_PBRD_BASE + 0x5000)
+#define EMMA_PIIC2_BASE			(EMMA_PBRD_BASE + 0x6000)
+
+#define EMMA_GPIO0_BASE			(EMMA_TIMER_BASE + 0x0d00)
+#define EMMA_GPIO0_DIR			(EMMA_GPIO0_BASE + 0xc0)
+#define EMMA_GPIO0_INT			(EMMA_GPIO0_BASE + 0xc8)
+#define EMMA_GPIO0_INT_CPUMEN		(EMMA_GPIO0_BASE + 0xd0)
+#define EMMA_GPIO0_INT_CPUSEN		(EMMA_GPIO0_BASE + 0xd8)
+#define EMMA_GPIO0_INT_MODE		(EMMA_GPIO0_BASE + 0xe0)
+#define EMMA_GPIO0_INT_CND_A		(EMMA_GPIO0_BASE + 0xe8)
+#define EMMA_GPIO0_INT_CND_B		(EMMA_GPIO0_BASE + 0xf0)
+#define EMMA_GPIO1_DIR			(EMMA_GPIO0_BASE + 0xc4)
+#define EMMA_GPIO1_INT			(EMMA_GPIO0_BASE + 0xcc)
+#define EMMA_GPIO1_INT_CPUMEN		(EMMA_GPIO0_BASE + 0xd4)
+#define EMMA_GPIO1_INT_CPUSEN		(EMMA_GPIO0_BASE + 0xf8)
+#define EMMA_GPIO1_INT_MODE		(EMMA_GPIO0_BASE + 0xe4)
+#define EMMA_GPIO1_INT_CND_A		(EMMA_GPIO0_BASE + 0xec)
+#define EMMA_GPIO1_INT_CND_B		(EMMA_GPIO0_BASE + 0xf4)
+
+#define EMMA_GPIO2_BASE			(EMMA_TIMER_BASE + 0x0e00)
+#define EMMA_GPIO2_DIR			(EMMA_GPIO2_BASE + 0xc0)
+#define EMMA_GPIO2_INT			(EMMA_GPIO2_BASE + 0xc8)
+#define EMMA_GPIO2_INT_CPUMEN		(EMMA_GPIO2_BASE + 0xd0)
+#define EMMA_GPIO2_INT_CPUSEN		(EMMA_GPIO2_BASE + 0xd8)
+#define EMMA_GPIO2_INT_MODE		(EMMA_GPIO2_BASE + 0xe0)
+#define EMMA_GPIO2_INT_CND_A		(EMMA_GPIO2_BASE + 0xe8)
+#define EMMA_GPIO2_INT_CND_B		(EMMA_GPIO2_BASE + 0xf0)
+#define EMMA_GPIO3_DIR			(EMMA_GPIO0_BASE + 0xc4)
+#define EMMA_GPIO3_INT			(EMMA_GPIO0_BASE + 0xcc)
+#define EMMA_GPIO3_INT_CPUMEN		(EMMA_GPIO0_BASE + 0xd4)
+#define EMMA_GPIO3_INT_CPUSEN		(EMMA_GPIO0_BASE + 0xf8)
+#define EMMA_GPIO3_INT_MODE		(EMMA_GPIO0_BASE + 0xe4)
+#define EMMA_GPIO3_INT_CND_A		(EMMA_GPIO0_BASE + 0xec)
+#define EMMA_GPIO3_INT_CND_B		(EMMA_GPIO0_BASE + 0xf4)
+
+#define EMMA_OHCI_CONFIG_BASE		(EMMA_FLIP_BASE + 0x0200)
+#define EMMA_EHCI_CONFIG_BASE		(EMMA_FLIP_BASE + 0x0500)
+#define EMMA_EHCI_BASE			(EMMA_FLIP_BASE + 0x0f00)
+#define EMMA_OHCI_BASE			(EMMA_FLIP_BASE + 0x1000)
+
+/*
+ *  Memory map (physical address)
+ *
+ *  Note most of the following address must be properly aligned by the
+ *  corresponding size.  For example, if PCI_IO_SIZE is 16MB, then
+ *  PCI_IO_BASE must be aligned along 16MB boundary.
+ */
+
+/* the actual ram size is detected at run-time */
+#define EMMA_RAM_BASE		0x00000000
+#define EMMA_RAM_SIZE		0x10000000	/* 256 MB */
+
+#define EMMA_IO_BASE		0x10000000
+#define EMMA_IO_SIZE		0x01000000	/* 16 MB */
+
+#define EMMA_GIO_BASE		0x11000000
+#define EMMA_GIO_SIZE		0x01000000	/* 16 MB */
+
+/*
+ * IRQ defines
+ */
+#define NUM_EMMA_IRQ		96
+#define NUM_EMMA_IRQ_SW		32
+
+#define EMMA_IRQ_BASE		(MIPS_CPU_IRQ_BASE + 8)
+#define EMMA_SW_IRQ_BASE	(EMMA_IRQ_BASE + NUM_EMMA_IRQ)
+
+#define EMMA_IRQ_INT(n)		(EMMA_IRQ_BASE + (n))
+#define EMMA_SW_IRQ_INT(n)	(EMMA_SW_IRQ_BASE + (n))
+
+#define EMMA_SW_CASCADE		EMMA_IRQ_INT(6)
+
+#define EMMA_IRQ_USB		EMMA_IRQ_INT(33)
+#define EMMA_IRQ_ETHER		EMMA_IRQ_INT(36)
+#define EMMA_IRQ_PUART0		EMMA_IRQ_INT(48)
+#define EMMA_IRQ_PUART1		EMMA_IRQ_INT(49)
+#define EMMA_IRQ_PIIC0		EMMA_IRQ_INT(51)
+#define EMMA_IRQ_PIIC1		EMMA_IRQ_INT(52)
+#define EMMA_IRQ_PIIC2		EMMA_IRQ_INT(53)
+
+#endif	/* __ASM_EMMA_EMMA3TL2_H */
diff --git a/include/asm-mips/emma/emmaxxx.h b/include/asm-mips/emma/emmaxxx.h
index a11f592..3f9b2da 100644
--- a/include/asm-mips/emma/emmaxxx.h
+++ b/include/asm-mips/emma/emmaxxx.h
@@ -14,6 +14,9 @@
 #ifdef CONFIG_SOC_EMMA3PF
 #include <asm/emma/emma3pf.h>
 #endif
+#ifdef CONFIG_SOC_EMMA3TL2
+#include <asm/emma/emma3tl2.h>
+#endif
 
 /* Processor-dependent register abstraction */
 #ifdef CONFIG_EMMA_SUBCPU
-- 
1.6.3.3

