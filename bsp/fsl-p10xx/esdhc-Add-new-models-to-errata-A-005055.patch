From 5f1c5debe81017545fde81138fe20cfb548d6cdd Mon Sep 17 00:00:00 2001
From: Haijun Zhang <Haijun.Zhang@freescale.com>
Date: Thu, 19 Dec 2013 11:21:33 +0800
Subject: [PATCH 3/3] esdhc: Add new models to errata A-005055

A-005055: A glitch is generated on the card clock
due to software reset or a clock change.

Impact list:
T4240-4160-R1.0 B4860-4420-R1.0-R2.0 P3041-R1.0-R1.1-R2.0
P2041-2040-R1.0-R1.1-R2.0 P1010-1014-R1.0 P5020-5010-R1.0-R2.0
P5040-5021-R1.0-R2.0-R2.1

Signed-off-by: Haijun Zhang <haijun.zhang@freescale.com>
Change-Id: Idf4e1fd52ec4b5748cf9cbf86365a70c9952d1be
Reviewed-on: http://git.am.freescale.net:8181/5925
Tested-by: Review Code-CDREVIEW <CDREVIEW@freescale.com>
Reviewed-by: Xiaobo Xie <X.Xie@freescale.com>
Reviewed-by: Jose Rivera <German.Rivera@freescale.com>
[Original patch taken from QorIQ-SDK-V1.6-SOURCE-20140619-yocto.iso]
Signed-off-by: Bin Jiang <bin.jiang@windriver.com>
[Drop unsupported SOC Revisions from quirk2 list]

Signed-off-by: Shan Hai <shan.hai@windriver.com>
---
 drivers/mmc/host/sdhci-of-esdhc.c |   11 ++++++++---
 1 files changed, 8 insertions(+), 3 deletions(-)

diff --git a/drivers/mmc/host/sdhci-of-esdhc.c b/drivers/mmc/host/sdhci-of-esdhc.c
index f66e0cd..69624eb 100644
--- a/drivers/mmc/host/sdhci-of-esdhc.c
+++ b/drivers/mmc/host/sdhci-of-esdhc.c
@@ -373,10 +373,12 @@ static void esdhc_of_platform_init(struct sdhci_host *host)
 	 * Check for A-005055: A glitch is generated on the card clock
 	 * due to software reset or a clock change
 	 * Impact list:
-	 * T4240-R1.0 B4860-R1.0 P3041-R1.0 P3041-R2.0 P2041-R1.0
-	 * P2041-R1.1 P2041-R2.0 P1010-R1.0
+	 * T4240-R1.0 P3041-R1.0-R1.1-R2.0
+	 * P2041-R1.0-R1.1-R2.0 P1010-R1.0 P5020-5010-R1.0-R2.0
+	 * P5040-R1.0
 	 */
 	if ((fsl_svr_is(SVR_T4240) && fsl_svr_rev_is(1, 0)) ||
+		(fsl_svr_is(SVR_T4240) && fsl_svr_rev_is(2, 0)) ||
 		(fsl_svr_is(SVR_B4860) && fsl_svr_rev_is(1, 0)) ||
 		(fsl_svr_is(SVR_B4860) && fsl_svr_rev_is(2, 0)) ||
 		(fsl_svr_is(SVR_P3041) && fsl_svr_rev_is(1, 0)) ||
@@ -384,7 +386,10 @@ static void esdhc_of_platform_init(struct sdhci_host *host)
 		(fsl_svr_is(SVR_P2041) && fsl_svr_rev_is(2, 0)) ||
 		(fsl_svr_is(SVR_P2041) && fsl_svr_rev_is(1, 1)) ||
 		(fsl_svr_is(SVR_P2041) && fsl_svr_rev_is(1, 0)) ||
-		(fsl_svr_is(SVR_P1010) && fsl_svr_rev_is(1, 0)))
+		(fsl_svr_is(SVR_P1010) && fsl_svr_rev_is(1, 0)) ||
+		(fsl_svr_is(SVR_P5040) && fsl_svr_rev_is(2, 1)) ||
+		(fsl_svr_is(SVR_P5020) && fsl_svr_rev_is(2, 0)) ||
+		(fsl_svr_is(SVR_P5010) && fsl_svr_rev_is(2, 0)))
 		host->quirks2 |= SDHCI_QUIRK2_DISABLE_CLOCK_BEFORE_RESET;
 }
 
-- 
1.7.5.4

