From 226359dc546cdd293eb06633ca0d76bcac31773e Mon Sep 17 00:00:00 2001
From: Yang Wei <Wei.Yang@windriver.com>
Date: Thu, 25 Apr 2013 12:49:00 +0800
Subject: [PATCH] dts/p1023rdb:Adjust the layout and size of NOR Flash

Since the u-boot is updated, it already configures enough address
space for 64MB of NOR Flash, and it also changes that address from
which u-boot loads fman ucode at boot stage. So we have to modify
P1023RDB dts file to adapt these changes.

Signed-off-by: Yang Wei <Wei.Yang@windriver.com>
---
 arch/powerpc/boot/dts/p1023rdb.dts |   40 ++++++++++++++++-------------------
 1 files changed, 18 insertions(+), 22 deletions(-)

diff --git a/arch/powerpc/boot/dts/p1023rdb.dts b/arch/powerpc/boot/dts/p1023rdb.dts
index 92c67d4..11d402b 100644
--- a/arch/powerpc/boot/dts/p1023rdb.dts
+++ b/arch/powerpc/boot/dts/p1023rdb.dts
@@ -118,44 +118,40 @@
 		reg = <0 0xff605000 0 0x1000>;
 
 		/* NOR Flash */
-		ranges = <0x0 0x0 0x0 0xee000000 0x02000000
+		ranges = <0x0 0x0 0x0 0xec000000 0x04000000
 		      0x1 0x0 0x0 0xffa00000 0x00008000>;
 
 		nor@0,0 {
 			#address-cells = <1>;
 			#size-cells = <1>;
 			compatible = "cfi-flash";
-			reg = <0x0 0x0 0x02000000>;
+			reg = <0x0 0x0 0x04000000>;
 			bank-width = <2>;
 			device-width = <1>;
 			partition@0 {
-				label = "fs1";
-				reg = <0x00000000 0x01000000>;
+				label = "NOR JFFS2";
+				reg = <0x00000000 0x03a40000>;
 			};
-			partition@1000000 {
-				label = "fman ucode";
-				reg = <0x01000000 0x00020000>;
-			};
-			partition@1020000 {
-				label = "fs2";
-				reg = <0x01020000 0x00c40000>;
+			partition@3a40000 {
+				label = "NOR Linux Kernel Image";
+				reg = <0x03a40000 0x004e0000>;
 			};
-			partition@1c60000 {
-				label = "kernel";
-				reg = <0x01c40000 0x002e0000>;
+			partiton@3f20000 {
+				label = "NOR Linux DTB Image";
+				reg = <0x03f20000 0x00020000>;
 			};
-			partiton@1f40000 {
-				label = "dtb";
-				reg = <0x01f20000 0x00020000>;
+			partition@3f40000 {
+				label = "fman ucode";
+				reg = <0x03f40000 0x00020000>;
 			};
-			partition@1f60000 {
+			partition@3f60000 {
 				label = "u-boot env";
-				reg = <0x01f60000 0x00020000>;
+				reg = <0x03f60000 0x00020000>;
 				read-only;
 			};
-			partition@1f80000 {
-				label = "u-boot";
-				reg = <0x01f80000 0x00080000>;
+			partition@3f80000 {
+				label = "u-boot-nor";
+				reg = <0x03f80000 0x00080000>;
 				read-only;
 			};
 		};
-- 
1.7.5.4

