From 75729cc519a6c27d8c2f06f1708f0fda08de442c Mon Sep 17 00:00:00 2001
From: Wei Yang <Wei.Yang@windriver.com>
Date: Fri, 15 Mar 2013 13:29:59 +0800
Subject: [PATCH 16/21] powerpc/dts: Add ATM support for P1021MDS

This patch add corresponding device node for ATM support.

Signed-off-by: Liu Yu <yu.liu@freescale.com>
[Extracted from P1021MDS_20101124_ltib.iso Just some minor context
mods in order to port to 3.4 kernel]
Signed-off-by: Wei Yang <Wei.Yang@windriver.com>
---
 arch/powerpc/boot/dts/p1021mds.dts |  144 ++++++++++++++++++++++++++++++++++++
 1 files changed, 144 insertions(+), 0 deletions(-)

diff --git a/arch/powerpc/boot/dts/p1021mds.dts b/arch/powerpc/boot/dts/p1021mds.dts
index 97116f1..919f65d 100644
--- a/arch/powerpc/boot/dts/p1021mds.dts
+++ b/arch/powerpc/boot/dts/p1021mds.dts
@@ -106,6 +106,74 @@
 			reg = <3 0 0x10000>;
 		};
 	};
+	qoc3@f8010000 {
+		#address-cells = <1>;
+		#size-cells = <1>;
+		#interrupt-cells = <2>;
+		device_type = "qoc3 atm card";
+		ranges = <0 0 0xf8010000 0x1e00>;
+		compatible = "simple-bus";
+
+		pm5384a: fua-phy@e00 {
+			device_type = "atm phy";
+			compatible = "fua-phy";
+			device-id = <1>;
+			reg = <0xe00 0x200>;
+			interrupt-parent = <&mpic>;
+			interrupts = <4 1>;
+			upc-slot = <&upcs0>;
+			ucc-handle = <&ucc_atm>;
+			line_bitr = <0x93d1cc0>;  /* 155000000 - 0x93d1cc0 */
+			max_bitr = <0x93d1cc0>;   /* 50000000  - 0x2faf080 */
+			min_bitr = <0x2faf080>;
+			port-width = <0>;
+		};
+
+		pm5384b: fua-phy@1600 {
+			device_type = "atm phy";
+			compatible = "fua-phy";
+			device-id = <2>;
+			reg = <0x1600 0x200>;
+			interrupt-parent = <&mpic>;
+			interrupts = <4 1>;
+			upc-slot = <&upcs0>;
+			ucc-handle = <&ucc_atm>;
+			line_bitr = <0x93d1cc0>;
+			max_bitr = <0x93d1cc0>;
+			min_bitr = <0x2faf080>;
+			port-width = <0>;
+		};
+
+		pm5384c: fua-phy@1a00 {
+			device_type = "atm phy";
+			compatible = "fua-phy";
+			device-id = <3>;
+			reg = <0x1a00 0x200>;
+			interrupt-parent = <&mpic>;
+			interrupts = <5 1>;
+			upc-slot = <&upcs0>;
+			ucc-handle = <&ucc_atm>;
+			line_bitr = <0x93d1cc0>;
+			max_bitr = <0x93d1cc0>;
+			min_bitr = <0x2faf080>;
+			port-width = <0>;
+		};
+
+		pm5384d: fua-phy@1c00 {
+			device_type = "atm phy";
+			compatible = "fua-phy";
+			device-id = <4>;
+			reg = <0x1c00 0x200>;
+			interrupt-parent = <&mpic>;
+			interrupts = <5 1>;
+			upc-slot = <&upcs0>;
+			ucc-handle = <&ucc_atm>;
+			line_bitr = <0x93d1cc0>;
+			max_bitr = <0x93d1cc0>;
+			min_bitr = <0x2faf080>;
+			port-width = <0>;
+		};
+	};
 
 	soc: soc@ffe00000 {
 		compatible = "fsl,p1021-immr", "simple-bus";
@@ -239,6 +307,47 @@
 					0x1  0x4  0x2  0x0  0x2  0x0    /* ENET5_RX_DV_SER5_CTS_B */
 					0x1  0x8  0x2  0x0  0x2  0x0>;    /* ENET5_RX_ER_SER5_CD_B */
 			};
+			pio_atm: upc_pin@01 {
+				pio-map = <
+			/* port  pin  dir  open_drain  assignment  has_irq */
+					0x1  0x2  0x2  0x0  0x1  0x0    /* CLK20 */
+					0x1  0x3  0x2  0x0  0x1  0x0    /* CLK19 */
+					0x1  0x1  0x1  0x0  0x3  0x0    /* UPC1_M_TXADDR0 */
+					0x0  0x1d 0x1  0x0  0x3  0x0    /* UPC1_M_TXADDR1 */
+					0x0  0x1e 0x1  0x0  0x3  0x0    /* UPC1_M_TXADDR2 */
+					0x0  0x1  0x1  0x0  0x3  0x0    /* UPC1_M_TXADDR3 */
+					0x1  0x1c 0x1  0x0  0x3  0x0    /* UPC1_M_TXADDR4 */
+					0x0  0x1f 0x1  0x0  0x3  0x0    /* UPC1_M_RXADDR0 */
+					0x1  0x0  0x1  0x0  0x3  0x0    /* UPC1_M_RXADDR1 */
+					0x0  0x1c 0x1  0x0  0x3  0x0    /* UPC1_M_RXADDR2 */
+					0x0  0x3  0x1  0x0  0x3  0x0    /* UPC1_M_RXADDR3 */
+					0x0  0x2  0x1  0x0  0x3  0x0    /* UPC1_M_RXADDR4 */
+					0x0  0x18 0x2  0x0  0x3  0x0    /* UPC1_M_RXCLAV0 */
+					0x0  0x19 0x2  0x0  0x3  0x0    /* UPC1_M_TXCLAV0 */
+					0x0  0x1b 0x1  0x0  0x3  0x0    /* UPC1_M_RXEN */
+					0x0  0x1a 0x1  0x0  0x3  0x0    /* UPC1_M_TXEN */
+					0x0  0x17 0x1  0x0  0x3  0x0    /* UPC1_TXSOC */
+					0x0  0x4  0x1  0x0  0x3  0x0    /* UPC1_TXDATA8 */
+					0x0  0x5  0x1  0x0  0x3  0x0    /* UPC1_TXDATA9 */
+					0x0  0x6  0x1  0x0  0x3  0x0    /* UPC1_TXDATA10 */
+					0x0  0x7  0x1  0x0  0x3  0x0    /* UPC1_TXDATA11 */
+					0x0  0x8  0x1  0x0  0x3  0x0    /* UPC1_TXDATA12 */
+					0x0  0x9  0x1  0x0  0x3  0x0    /* UPC1_TXDATA13 */
+					0x0  0xa  0x1  0x0  0x3  0x0    /* UPC1_TXDATA14 */
+					0x0  0xb  0x1  0x0  0x3  0x0    /* UPC1_TXDATA15 */
+					0x0  0x16 0x2  0x0  0x3  0x0    /* UPC1_RXSOC */
+					0x0  0xc  0x2  0x0  0x3  0x0    /* UPC1_RXDATA8 */
+					0x0  0xd  0x2  0x0  0x3  0x0    /* UPC1_RXDATA9 */
+					0x0  0xe  0x2  0x0  0x3  0x0    /* UPC1_RXDATA10 */
+					0x0  0xf  0x2  0x0  0x3  0x0    /* UPC1_RXDATA11 */
+					0x0  0x10 0x2  0x0  0x3  0x0    /* UPC1_RXDATA12 */
+					0x0  0x11 0x2  0x0  0x3  0x0    /* UPC1_RXDATA13 */
+					0x0  0x12 0x2  0x0  0x3  0x0    /* UPC1_RXDATA14 */
+					0x0  0x13 0x2  0x0  0x3  0x0    /* UPC1_RXDATA15 */
+					0x0  0x15 0x2  0x0  0x3  0x0    /* UPC1_RXPRTY */
+					0x0  0x14 0x1  0x0  0x3  0x0>;    /* UPC1_TXPRTY */
+			};
+
 		};
 	};
 
@@ -278,6 +387,30 @@
 		brg-frequency = <0>;
 		bus-frequency = <0>;
 		status = "disabled"; /* no firmware loaded */
+		fsl,time-stamp1-clock = "qeclk";
+		fsl,time-stamp2-clock = "qeclk";
+
+		upc@2e00 {
+			#address-cells = <1>;
+			#size-cells = <0>;
+			compatible = "fsl,qe-upc";
+			device-id = <1>;
+			reg = <0x2e00 0x200>;
+			fsl,rx-clock = "clk20";
+			fsl,tx-clock = "clk19";
+			fsl,internal-clock = "clk19";
+			fsl,utopia;
+			fsl,tx-slave = <0>;
+			fsl,rx-slave = <0>;
+			fsl,address-mode = <0>;
+			pio-handle = <&pio_atm>;
+
+			upcs0: upc-slot@00 {
+				compatible = "fsl,qe-upc-slot";
+				device-id = <1>;
+				fsl,end-point = <4>;
+			};
+		};
 
 		enet3: ucc@2000 {
 			device_type = "network";
@@ -290,6 +423,17 @@
 			phy-connection-type = "mii";
 		};
 
+		ucc_atm: ucc@2200 {
+			device_type = "network";
+			compatible = "ucc_geth", "fsl,qe-ucc-atm";
+			cell-index = <3>;
+			reg = <0x2200 0x200>;
+			interrupts = <34>;
+			interrupt-parent = <&qeic>;
+			multithread;
+		};
+
+
 		mdio@2120 {
 			qe_phy0: ethernet-phy@0 {
 				interrupt-parent = <&mpic>;
-- 
1.7.5.4

