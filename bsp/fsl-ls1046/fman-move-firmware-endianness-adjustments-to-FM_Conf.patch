From 30dc45ba03941314e9d8615e662b36099f3ff69d Mon Sep 17 00:00:00 2001
From: zou cao <cao.zou@windriver.com>
Date: Wed, 9 Aug 2017 10:25:57 +0800
Subject: [PATCH 2/2] fman: move firmware endianness adjustments to FM_Config

Now the memory property of device tree is read-only, we can not
directly modify the data of firmware in device tree, FM_Config will
copy the firmware data, we can modify the data in after p_Code is
copied.

Signed-off-by: zou cao <cao.zou@windriver.com>
---
 .../freescale/sdk_fman/Peripherals/FM/fm.c         |   11 +++++++++++
 .../freescale/sdk_fman/src/wrapper/lnxwrp_fm.c     |   11 -----------
 2 files changed, 11 insertions(+), 11 deletions(-)

diff --git a/drivers/net/ethernet/freescale/sdk_fman/Peripherals/FM/fm.c b/drivers/net/ethernet/freescale/sdk_fman/Peripherals/FM/fm.c
index a870b47..49c8eb4 100644
--- a/drivers/net/ethernet/freescale/sdk_fman/Peripherals/FM/fm.c
+++ b/drivers/net/ethernet/freescale/sdk_fman/Peripherals/FM/fm.c
@@ -3424,6 +3424,17 @@ t_Handle FM_Config(t_FmParams *p_FmParam)
             return NULL;
         }
         memcpy(p_Fm->firmware.p_Code, p_FmParam->firmware.p_Code ,p_Fm->firmware.size);
+
+#ifdef CONFIG_FMAN_ARM
+	{ /* endianness adjustments: byteswap the ucode retrieved from the f/w blob */
+		int i;
+		int usz = p_Fm->firmware.size;
+		void * p_Code = p_Fm->firmware.p_Code;
+
+		for(i=0; i < usz / 4; ++i)
+			((u32 *)p_Code)[i] = be32_to_cpu(((u32 *)p_Code)[i]);
+	}
+#endif
     }
 
     if (p_Fm->guestId != NCSW_MASTER_ID)
diff --git a/drivers/net/ethernet/freescale/sdk_fman/src/wrapper/lnxwrp_fm.c b/drivers/net/ethernet/freescale/sdk_fman/src/wrapper/lnxwrp_fm.c
index 7ecfdb3..77a4b86 100644
--- a/drivers/net/ethernet/freescale/sdk_fman/src/wrapper/lnxwrp_fm.c
+++ b/drivers/net/ethernet/freescale/sdk_fman/src/wrapper/lnxwrp_fm.c
@@ -1038,17 +1038,6 @@ static t_Error InitFmDev(t_LnxWrpFmDev  *p_LnxWrpFmDev)
                    fw->microcode[0].revision));
     }
 
-#ifdef CONFIG_FMAN_ARM
-	{ /* endianness adjustments: byteswap the ucode retrieved from the f/w blob */
-		int i;
-		int usz = p_LnxWrpFmDev->fmDevSettings.param.firmware.size;
-		void * p_Code = p_LnxWrpFmDev->fmDevSettings.param.firmware.p_Code;
-
-		for(i=0; i < usz / 4; ++i)
-			((u32 *)p_Code)[i] = be32_to_cpu(((u32 *)p_Code)[i]);
-	}
-#endif
-
     p_LnxWrpFmDev->fmDevSettings.param.h_FmMuram = p_LnxWrpFmDev->h_MuramDev;
 
 #if (DPAA_VERSION >= 11)
-- 
1.7.5.4

