From 44354e8f11a949ad01be3da4c77a9f38b8f20acd Mon Sep 17 00:00:00 2001
From: zou cao <cao.zou@windriver.com>
Date: Tue, 15 Aug 2017 17:10:17 +0800
Subject: [PATCH] dpaa_eth: not turn off the carrier if phy is fixed-phy

fixed-phy has not normal phy notify event, if carrier state is off
in default, the carrier state of ethnet dev with fixed-phy will
always be off.

Signed-off-by: zou cao <cao.zou@windriver.com>
---
 .../ethernet/freescale/sdk_dpaa/dpaa_eth_common.c  |    6 +++++-
 1 files changed, 5 insertions(+), 1 deletions(-)

diff --git a/drivers/net/ethernet/freescale/sdk_dpaa/dpaa_eth_common.c b/drivers/net/ethernet/freescale/sdk_dpaa/dpaa_eth_common.c
index fc6272c..7b4adad 100644
--- a/drivers/net/ethernet/freescale/sdk_dpaa/dpaa_eth_common.c
+++ b/drivers/net/ethernet/freescale/sdk_dpaa/dpaa_eth_common.c
@@ -109,6 +109,8 @@ int dpa_netdev_init(struct net_device *net_dev,
 	int err;
 	struct dpa_priv_s *priv = netdev_priv(net_dev);
 	struct device *dev = net_dev->dev.parent;
+	struct mac_device *mac_dev;
+	mac_dev = priv->mac_dev;
 
 	net_dev->hw_features |= DPA_NETIF_FEATURES;
 
@@ -125,7 +127,9 @@ int dpa_netdev_init(struct net_device *net_dev,
 	net_dev->needed_headroom = priv->tx_headroom;
 	net_dev->watchdog_timeo = msecs_to_jiffies(tx_timeout);
 
-	netif_carrier_off(net_dev);
+	if (!mac_dev->fixed_link)
+		netif_carrier_off(net_dev);
+
 	err = register_netdev(net_dev);
 	if (err < 0) {
 		dev_err(dev, "register_netdev() = %d\n", err);
-- 
1.7.5.4

