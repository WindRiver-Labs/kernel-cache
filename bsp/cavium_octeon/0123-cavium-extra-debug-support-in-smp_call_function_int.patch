From ac851bad63fd60a756f1213d0be91ffa30420267 Mon Sep 17 00:00:00 2001
From: Wally Gleemer <Wally.Gleemer@windriver.com>
Date: Tue, 25 Mar 2008 16:21:47 -0700
Subject: [PATCH] cavium: extra debug support in smp_call_function_interrupt

In case we enter smp_call_function_interrupt with no
actual call_data to do work on, catch this and bail
with a warning vs. blowing up.

Signed-off-by: Wally Gleemer <Wally.Gleemer@windriver.com>
---
 arch/mips/kernel/smp.c |   15 ++++++++++++---
 1 files changed, 12 insertions(+), 3 deletions(-)

diff --git a/arch/mips/kernel/smp.c b/arch/mips/kernel/smp.c
index e3c5356..e032439 100644
--- a/arch/mips/kernel/smp.c
+++ b/arch/mips/kernel/smp.c
@@ -220,9 +220,18 @@ int smp_call_function(void (*func) (void *info), void *info, int retry,
 
 void smp_call_function_interrupt(void)
 {
-	void (*func) (void *info) = call_data->func;
-	void *info = call_data->info;
-	int wait = call_data->wait;
+	void (*func) (void *info);
+	void *info;
+	int wait;
+
+	if (call_data == NULL) {
+		printk("CPU %02d: smp_call_function_interrupt with no call_data.\n", smp_processor_id());
+		return;
+	}
+
+	func = call_data->func;
+	info = call_data->info;
+	wait = call_data->wait;
 
 	/*
 	 * Notify initiating CPU that I've grabbed the data and am
-- 
1.5.5.1

