From 26ab269cd06025b5437c6ac416911d437af7f90d Mon Sep 17 00:00:00 2001
From: Wally Gleemer <Wally.Gleemer@windriver.com>
Date: Tue, 25 Mar 2008 16:21:46 -0700
Subject: [PATCH] cavium: fix compile failure in ethernet-mgmt-port

Driver was using some legacy things that simply dont exist
anymore.

Signed-off-by: Wally Gleemer <Wally.Gleemer@windriver.com>
---
 arch/mips/cavium-octeon/ethernet-mgmt-port.c |    7 +++----
 1 files changed, 3 insertions(+), 4 deletions(-)

diff --git a/arch/mips/cavium-octeon/ethernet-mgmt-port.c b/arch/mips/cavium-octeon/ethernet-mgmt-port.c
index 65a40f6..0c428d3 100644
--- a/arch/mips/cavium-octeon/ethernet-mgmt-port.c
+++ b/arch/mips/cavium-octeon/ethernet-mgmt-port.c
@@ -133,7 +133,7 @@ static irqreturn_t do_interrupt(int cpl, void *dev_id)
  */
 static void device_poll_controller(struct net_device *dev)
 {
-	do_interrupt(0, dev, NULL);
+	do_interrupt(0, dev);
 }
 #endif
 
@@ -201,7 +201,6 @@ static int device_init(struct net_device *dev)
 #ifdef CONFIG_NET_POLL_CONTROLLER
 	dev->poll_controller = device_poll_controller;
 #endif
-	dev->weight = 16;
 	dev->dev_addr[0] = (mac >> 40) & 0xff;
 	dev->dev_addr[1] = (mac >> 32) & 0xff;
 	dev->dev_addr[2] = (mac >> 24) & 0xff;
@@ -220,6 +219,7 @@ static int device_init(struct net_device *dev)
  */
 static int __init ethernet_mgmt_port_init(void)
 {
+	int r;
 	struct net_device *dev;
 	device_private_t *priv;
 	cvmx_mixx_irhwm_t mix_irhwm;
@@ -242,7 +242,6 @@ static int __init ethernet_mgmt_port_init(void)
 		return -1;
 	}
 
-	SET_MODULE_OWNER(dev);
 	dev->init = device_init;
 	strcpy(dev->name, "mgmt%d");
 
@@ -261,7 +260,7 @@ static int __init ethernet_mgmt_port_init(void)
 		       cvmx_read_csr(CVMX_MIXX_ISR(priv->port)));
 
 	/* Register an IRQ hander for to receive interrupts */
-	request_irq(8 + 62, do_interrupt, SA_SHIRQ, "Mgmt Ethernet", dev);
+	r = request_irq(8 + 62, do_interrupt, IRQF_SHARED, "Mgmt Ethernet", dev);
 
 	/* Interrupt every single RX packet */
 	mix_irhwm.u64 = 0;
-- 
1.5.5.1

