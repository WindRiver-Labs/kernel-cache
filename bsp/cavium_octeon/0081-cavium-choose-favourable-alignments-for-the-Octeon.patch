From a15eb01835d5ce2d70db7ea5475522a1a2a9b5a8 Mon Sep 17 00:00:00 2001
From: Wally Gleemer <Wally.Gleemer@windriver.com>
Date: Tue, 25 Mar 2008 16:21:41 -0700
Subject: [PATCH] cavium: choose favourable alignments for the Octeon

Adjust the alignments in vmlinux.lds.S to be more favourable to
the Octeon cache.

Signed-off-by: Wally Gleemer <Wally.Gleemer@windriver.com>
---
 arch/mips/kernel/vmlinux.lds.S |    8 ++++++++
 1 files changed, 8 insertions(+), 0 deletions(-)

diff --git a/arch/mips/kernel/vmlinux.lds.S b/arch/mips/kernel/vmlinux.lds.S
index b5470ce..e324739 100644
--- a/arch/mips/kernel/vmlinux.lds.S
+++ b/arch/mips/kernel/vmlinux.lds.S
@@ -103,7 +103,11 @@ SECTIONS
 	. = ALIGN(_PAGE_SIZE);
 	__nosave_end = .;
 
+#ifdef CONFIG_CPU_CAVIUM_OCTEON
+	. = ALIGN(128);
+#else
 	. = ALIGN(32);
+#endif
 	.data.cacheline_aligned : {
 		*(.data.cacheline_aligned)
 	}
@@ -158,7 +162,11 @@ SECTIONS
 	}
 #endif
 	PERCPU(_PAGE_SIZE)
+#ifdef CONFIG_CPU_CAVIUM_OCTEON
+	. = ALIGN(128);
+#else
 	. = ALIGN(_PAGE_SIZE);
+#endif
 	__init_end = .;
 	/* freed after init ends here */
 
-- 
1.5.5.1

