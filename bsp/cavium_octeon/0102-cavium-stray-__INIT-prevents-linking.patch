From 3213ff3bc2d793ffa5b91c7177dea8bf0f97fac7 Mon Sep 17 00:00:00 2001
From: Wally Gleemer <Wally.Gleemer@windriver.com>
Date: Thu, 13 Mar 2008 22:53:04 -0700
Subject: [PATCH] cavium: stray __INIT prevents linking

There is a stray __INIT which will cause a link error.  Looking at
older versions, it appeared to be wrapped in a QEMU #ifdef, so
once again it finds itself in the same boat.

Signed-off-by: Wally Gleemer <Wally.Gleemer@windriver.com>
---
 arch/mips/kernel/head.S |    4 ++++
 1 files changed, 4 insertions(+), 0 deletions(-)

diff --git a/arch/mips/kernel/head.S b/arch/mips/kernel/head.S
index 3613645..3486f24 100644
--- a/arch/mips/kernel/head.S
+++ b/arch/mips/kernel/head.S
@@ -195,7 +195,11 @@ NESTED(kernel_entry, 16, sp)			# kernel entry point
 	j		start_kernel
 	END(kernel_entry)
 
+/* You can't do this on Cavium (or maybe all MIPS64 SMP) or you will error on:
+   relocation truncated to fit: R_MIPS_PC16 against `smp_bootstrap'  */
+#ifndef CONFIG_CPU_CAVIUM_OCTEON
 	__CPUINIT
+#endif
 
 #ifdef CONFIG_SMP
 /*
-- 
1.5.5.1

