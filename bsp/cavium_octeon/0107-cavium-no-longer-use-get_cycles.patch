From b866be624fc1cd27447711241c83cfb9e12cb87a Mon Sep 17 00:00:00 2001
From: Wally Gleemer <Wally.Gleemer@windriver.com>
Date: Thu, 13 Mar 2008 23:01:41 -0700
Subject: [PATCH] cavium: no longer use get_cycles()

kernel.org git commit efb9ca08 rendered get_cycles() to do
nothing -- so either use octeon_get_cycles or go directly to
using read_c0_count().

Signed-off-by: Wally Gleemer <Wally.Gleemer@windriver.com>
---
 arch/mips/cavium-octeon/pci.c |    6 +++---
 arch/mips/cavium-octeon/smp.c |    2 +-
 2 files changed, 4 insertions(+), 4 deletions(-)

diff --git a/arch/mips/cavium-octeon/pci.c b/arch/mips/cavium-octeon/pci.c
index a380b82..c4c78eb 100644
--- a/arch/mips/cavium-octeon/pci.c
+++ b/arch/mips/cavium-octeon/pci.c
@@ -264,12 +264,12 @@ static void octeon_pci_initialize(void)
 	if (OCTEON_IS_MODEL(OCTEON_CN58XX)) {
 		cvmx_pci_cnt_reg_t pci_cnt_reg_start;
 		cvmx_pci_cnt_reg_t pci_cnt_reg_end;
-		cycles_t cycles;
+		unsigned long cycles;
 		pci_cnt_reg_start.u64 = cvmx_read_csr(CVMX_NPI_PCI_CNT_REG);
-		cycles = get_cycles();
+		cycles = octeon_get_cycles();
 		udelay(1000);
 		pci_cnt_reg_end.u64 = cvmx_read_csr(CVMX_NPI_PCI_CNT_REG);
-		cycles = get_cycles() - cycles;
+		cycles = octeon_get_cycles() - cycles;
 		printk("PCI Clock: %lu MHz\n",
 		       (pci_cnt_reg_end.s.pcicnt -
 			pci_cnt_reg_start.s.pcicnt) / (cycles /
diff --git a/arch/mips/cavium-octeon/smp.c b/arch/mips/cavium-octeon/smp.c
index 3f34d1d..cc9cefd 100644
--- a/arch/mips/cavium-octeon/smp.c
+++ b/arch/mips/cavium-octeon/smp.c
@@ -88,7 +88,7 @@ void prom_boot_secondary(int cpu, struct task_struct *idle)
 	__sync();		/* Use sync so all ops are done. This makes the
 				   cycle counter propagate in a more bounded
 				   amount of time */
-	octeon_processor_cycle = get_cycles();
+	octeon_processor_cycle = octeon_get_cycles();
 	octeon_processor_boot = cpu_logical_map(cpu);
 	mb();
 
-- 
1.5.5.1

