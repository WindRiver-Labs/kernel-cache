From 331eb34647b1c573335bfc7db53663b784ed3ddf Mon Sep 17 00:00:00 2001
From: auto commit <unknown@unknown>
Date: Fri, 24 Oct 2008 12:23:09 -0700
Subject: [PATCH] cavium: fix compile failure of ethernet-pow.c

Driver was using some legacy items that simply don't exist anymore.

Signed-off-by: Paul Gortmaker <Paul.Gortmaker@windriver.com>
---
 arch/mips/cavium-octeon/ethernet-pow.c |   12 +++++-------
 1 files changed, 5 insertions(+), 7 deletions(-)

diff --git a/arch/mips/cavium-octeon/ethernet-pow.c b/arch/mips/cavium-octeon/ethernet-pow.c
index 190304f..6f6e132 100644
--- a/arch/mips/cavium-octeon/ethernet-pow.c
+++ b/arch/mips/cavium-octeon/ethernet-pow.c
@@ -347,8 +347,8 @@ static int packet_transmit(struct sk_buff *skb, struct net_device *dev)
 			// work->word2.s.vlan_id = 0; /* FIXME */
 			// work->word2.s.dec_ipcomp = 0; /* FIXME */
 			work->word2.s.tcp_or_udp =
-				(skb->nh.iph->protocol == IP_PROTOCOL_TCP) ||
-				(skb->nh.iph->protocol == IP_PROTOCOL_UDP);
+				(ip_hdr(skb)->protocol == IP_PROTOCOL_TCP) ||
+				(ip_hdr(skb)->protocol == IP_PROTOCOL_UDP);
 			// work->word2.s.dec_ipsec = 0; /* FIXME */
 			// work->word2.s.is_v6 = 0; /* We only support IPv4
 			// right now */
@@ -356,8 +356,8 @@ static int packet_transmit(struct sk_buff *skb, struct net_device *dev)
 			// zero */
 			// work->word2.s.L4_error = 0; /* No error, packet is
 			// internal */
-			work->word2.s.is_frag = !((skb->nh.iph->frag_off == 0)
-						  || (skb->nh.iph->frag_off ==
+			work->word2.s.is_frag = !((ip_hdr(skb)->frag_off == 0)
+						  || (ip_hdr(skb)->frag_off ==
 						      1 << 14));
 			// work->word2.s.IP_exc = 0; /* Assume Linux is sending
 			// a good packet */
@@ -553,7 +553,7 @@ static irqreturn_t do_interrupt(int cpl, void *dev_id)
  */
 static void device_poll_controller(struct net_device *dev)
 {
-	do_interrupt(0, dev, NULL);
+	do_interrupt(0, dev);
 }
 #endif
 
@@ -616,7 +616,6 @@ static int device_init(struct net_device *dev)
 #ifdef CONFIG_NET_POLL_CONTROLLER
 	dev->poll_controller = device_poll_controller;
 #endif
-	dev->weight = 16;
 	dev->features |= NETIF_F_LLTX;	/* We do our own locking, Linux doesn't
 					   need to */
 	dev->dev_addr[0] = 0;
@@ -668,7 +667,6 @@ static int __init ethernet_pow_init(void)
 		return -1;
 	}
 
-	SET_MODULE_OWNER(global_device);
 	global_device->init = device_init;
 	strcpy(global_device->name, "oct%d");
 
-- 
1.5.5.1

