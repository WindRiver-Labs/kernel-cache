From b9a299f8b13e81ff759476ff24a0f20bb22743fe Mon Sep 17 00:00:00 2001
From: auto commit <unknown@unknown>
Date: Fri, 24 Oct 2008 12:23:01 -0700
Subject: [PATCH] cavium: use CPHYSADDR for __pa_symbol

If you don't use CPHYSADDR for __pa_symbol on 64 bit cavium,
the bootmem handling goes awry and you get silent boot death.

Signed-off-by: Paul Gortmaker <Paul.Gortmaker@windriver.com>
---
 include/asm-mips/page.h |    4 ++++
 1 files changed, 4 insertions(+), 0 deletions(-)

diff --git a/include/asm-mips/page.h b/include/asm-mips/page.h
index fe7a88e..ab1487d 100644
--- a/include/asm-mips/page.h
+++ b/include/asm-mips/page.h
@@ -151,7 +151,11 @@ typedef struct { unsigned long pgprot; } pgprot_t;
     ((unsigned long)(x) - PAGE_OFFSET + PHYS_OFFSET)
 #endif
 #define __va(x)		((void *)((unsigned long)(x) + PAGE_OFFSET - PHYS_OFFSET))
+#if (defined (CONFIG_64BIT) && defined(CONFIG_CPU_CAVIUM_OCTEON))
+#define __pa_symbol(x)	CPHYSADDR((unsigned long)(x))
+#else
 #define __pa_symbol(x)	__pa(RELOC_HIDE((unsigned long)(x), 0))
+#endif
 
 #define pfn_to_kaddr(pfn)	__va((pfn) << PAGE_SHIFT)
 
-- 
1.5.5.1

