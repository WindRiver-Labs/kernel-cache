From 843f781763fdf58cfb18c4671f89703c9038fa11 Mon Sep 17 00:00:00 2001
From: Wally Gleemer <Wally.Gleemer@windriver.com>
Date: Thu, 13 Mar 2008 21:40:34 -0700
Subject: [PATCH] cavium: insert wmb into r4k_wait()

For Cavium, insert a wmb() into the beginning of r4k_wait()

Signed-off-by: Wally Gleemer <Wally.Gleemer@windriver.com>
---
 arch/mips/kernel/cpu-probe.c |    3 +++
 1 files changed, 3 insertions(+), 0 deletions(-)

diff --git a/arch/mips/kernel/cpu-probe.c b/arch/mips/kernel/cpu-probe.c
index 89c3304..1266a4f 100644
--- a/arch/mips/kernel/cpu-probe.c
+++ b/arch/mips/kernel/cpu-probe.c
@@ -53,6 +53,9 @@ static void r39xx_wait(void)
  */
 static void r4k_wait(void)
 {
+#ifdef CONFIG_CPU_CAVIUM_OCTEON
+	wmb();
+#endif
 	__asm__("	.set	mips3			\n"
 		"	wait				\n"
 		"	.set	mips0			\n");
-- 
1.5.5.1

