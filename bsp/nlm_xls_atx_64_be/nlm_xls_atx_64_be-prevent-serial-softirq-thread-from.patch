From fec13424839f987b757454a37781cf085dbf88b8 Mon Sep 17 00:00:00 2001
From: Bruce Ashfield <bruce.ashfield@windriver.com>
Date: Sat, 31 Jul 2010 21:50:29 -0400
Subject: [PATCH] nlm_xls_atx_64_be: prevent serial softirq thread from dropping its binding

Serial irq handlers have been shown to not function correctly when
handled in threads. Add IRQF_NODELAY to prevent threading.

Signed-off--by: Jack Tan <jack.tan@windriver.com>

Conflicts:

	drivers/serial/8250.c

Signed-off-by: Bruce Ashfield <bruce.ashfield@windriver.com>
---
 drivers/serial/8250.c |    4 ++++
 1 files changed, 4 insertions(+), 0 deletions(-)

diff --git a/drivers/serial/8250.c b/drivers/serial/8250.c
index 0c55828..282f6b0 100644
--- a/drivers/serial/8250.c
+++ b/drivers/serial/8250.c
@@ -1689,6 +1689,10 @@ static int serial_link_irq_chain(struct uart_8250_port *up)
 	if (irq_flags & IRQF_SHARED)
 		irq_flags |= IRQF_NODELAY;
 
+ #if defined(CONFIG_PREEMPT_HARDIRQS) || defined(CONFIG_PREEMPT_SOFTIRQS)
+	irq_flags |= IRQF_NODELAY;
+ #endif
+
 	mutex_lock(&hash_mutex);
 
 	h = &irq_lists[up->port.irq % NR_IRQ_HASH];
-- 
1.6.5.2

