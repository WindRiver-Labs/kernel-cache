From 636dca6e9d7d31575eee8d164881fe4795c0c1aa Mon Sep 17 00:00:00 2001
From: Thomas Tai <thomas.tai@windriver.com>
Date: Thu, 21 Jun 2012 12:43:13 -0400
Subject: [PATCH] use get_mpic_irq instead of using external proxy register for e500mc

The e500mc have an extra external proxy register which is not supported
in kvm. In order to boot e500mc with interrupts enable, the guest need to
use the normal mpic_get_irq().

Signed-off-by: Thomas Tai <thomas.tai@windriver.com>
---
 arch/powerpc/platforms/85xx/p4080_ds.c |    4 ++++
 1 files changed, 4 insertions(+), 0 deletions(-)

diff --git a/arch/powerpc/platforms/85xx/p4080_ds.c b/arch/powerpc/platforms/85xx/p4080_ds.c
index c92417d..4fceb97 100644
--- a/arch/powerpc/platforms/85xx/p4080_ds.c
+++ b/arch/powerpc/platforms/85xx/p4080_ds.c
@@ -74,7 +74,11 @@ define_machine(p4080_ds) {
 #ifdef CONFIG_PCI
 	.pcibios_fixup_bus	= fsl_pcibios_fixup_bus,
 #endif
+#ifdef CONFIG_KVM_GUEST
+	.get_irq		= mpic_get_irq,
+#else
 	.get_irq		= mpic_get_coreint_irq,
+#endif
 	.restart		= fsl_rstcr_restart,
 	.calibrate_decr		= generic_calibrate_decr,
 	.progress		= udbg_progress,
-- 
1.7.0.4

