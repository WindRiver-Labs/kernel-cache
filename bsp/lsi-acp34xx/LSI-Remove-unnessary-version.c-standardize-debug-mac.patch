From d78cfc11d3627d509a4a657dd6b0018ed0dcf021 Mon Sep 17 00:00:00 2001
From: Jiang Lu <lu.jiang@windriver.com>
Date: Fri, 25 Jan 2013 11:13:50 +0800
Subject: [PATCH 02/16] LSI:Remove unnessary version.c & standardize debug
 macro

Move is_asic() from version.c to ncr.c, for the function is based
on ncr_read() result.

Then Remove drivers/lsi/acp/version.c & version.h

Move debug.h from drivers/lsi into include/asm/lsi/ to provide debug
macros for device drivers on LSI's acp34xx platform.

Signed-off-by: Jiang Lu <lu.jiang@windriver.com>
---
 arch/powerpc/include/asm/lsi/debug.h |   96 ++++++++++
 drivers/lsi/acp/Makefile             |    1 -
 drivers/lsi/acp/clocks.c             |    2 +-
 drivers/lsi/acp/nand.c               |   13 +-
 drivers/lsi/acp/ncr.c                |   25 ++-
 drivers/lsi/acp/ncr.h                |    4 +-
 drivers/lsi/acp/net.c                |   66 +------
 drivers/lsi/acp/serial.c             |    2 +-
 drivers/lsi/acp/ubootenv.c           |   40 +---
 drivers/lsi/acp/version.c            |  352 ----------------------------------
 drivers/lsi/acp/wrappers.c           |    2 +-
 drivers/lsi/common/debug.h           |   63 ------
 drivers/lsi/common/version.h         |   28 ---
 13 files changed, 128 insertions(+), 566 deletions(-)
 create mode 100644 arch/powerpc/include/asm/lsi/debug.h
 delete mode 100644 drivers/lsi/acp/version.c
 delete mode 100644 drivers/lsi/common/debug.h
 delete mode 100644 drivers/lsi/common/version.h

diff --git a/arch/powerpc/include/asm/lsi/debug.h b/arch/powerpc/include/asm/lsi/debug.h
new file mode 100644
index 0000000..3fe17ba
--- /dev/null
+++ b/arch/powerpc/include/asm/lsi/debug.h
@@ -0,0 +1,96 @@
+/*
+ * asm/lsi/debug.h
+ *
+ * Copyright (C) 2010 LSI
+ *
+ * This program is free software; you can redistribute it and/or modify
+ * it under the terms of the GNU General Public License as published by
+ * the Free Software Foundation; either version 2 of the License, or
+ * (at your option) any later version.
+ *
+ * This program is distributed in the hope that it will be useful,
+ * but WITHOUT ANY WARRANTY; without even the implied warranty of
+ * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.	 See the
+ * GNU General Public License for more details.
+ *
+ * You should have received a copy of the GNU General Public License
+ * along with this program; if not, write to the Free Software
+ * Foundation, Inc., 59 Temple Place, Suite 330, Boston, MA  02111-1307	 USA
+ */
+
+#ifndef __DRIVERS_LSI_COMMON_DEBUG_H
+#define __DRIVERS_LSI_COMMON_DEBUG_H
+
+#define LSI_WARN
+#define LSI_ERROR
+
+
+#undef TRACE
+/*#define TRACE*/
+#define TRACE_PRINTK
+#ifdef TRACE
+#ifdef TRACE_PRINTK
+#define TRACE_BEGINNING() \
+printk("nic:%d:%s:Beginning\n", smp_processor_id(), __func__)
+#define TRACE_ENDING() \
+printk("nic:%d:%s:Ending\n", smp_processor_id(), __func__)
+#else
+#define TRACE_BEGINNING() TRACER_POST("Beginning");
+#define TRACE_ENDING() TRACER_POST("Ending");
+#endif
+#else
+#define TRACE_BEGINNING(format, args...)
+#define TRACE_ENDING(format, args...)
+#endif
+
+#undef PHY_DEBUG
+/*#define PHY_DEBUG*/
+#if defined(PHY_DEBUG)
+#define PHY_DEBUG_PRINT(format, args...) do {\
+printk("net:%d - PHY_DEBUG - ", __LINE__); \
+printk(format, ##args); \
+} while (0);
+#else
+#define PHY_DEBUG_PRINT(format, args...)
+#endif
+
+/*
+  DEBUG
+*/
+
+#if defined(LSI_DEBUG)
+#define DEBUG_PRINT(format, args...) do { \
+printk(KERN_INFO "%s:%s:%d - DEBUG - ", __FILE__, __FUNCTION__, __LINE__); \
+printk(format, ##args); \
+} while (0);
+#else
+#define DEBUG_PRINT(format, args...) { }
+#endif
+
+/*
+  WARN
+*/
+
+#if defined(LSI_WARN)
+#define WARN_PRINT(format, args...) do { \
+printk(KERN_WARNING "%s:%s:%d - WARN - ", __FILE__, __FUNCTION__, __LINE__); \
+printk(format, ##args); \
+} while (0);
+#else
+#define WARN_PRINT(format, args...) { }
+#endif
+
+/*
+  ERROR
+*/
+
+#if defined(LSI_ERROR)
+#define ERROR_PRINT(format, args...) do { \
+printk(KERN_ERR "%s:%s:%d - ERROR - ", __FILE__, __FUNCTION__, __LINE__); \
+printk(format, ##args); \
+} while (0);
+#else
+#define ERROR_PRINT(format, args...) { }
+#endif
+
+#endif /* __DRIVERS_LSI_COMMON_DEBUG_H */
diff --git a/drivers/lsi/acp/Makefile b/drivers/lsi/acp/Makefile
index 9f11564..176c138 100644
--- a/drivers/lsi/acp/Makefile
+++ b/drivers/lsi/acp/Makefile
@@ -3,7 +3,6 @@ obj-$(CONFIG_ACP)			+= ncr.o
 obj-$(CONFIG_ACP)			+= clocks.o
 obj-$(CONFIG_LSI_NAND)			+= lsi_nand.o
 obj-$(CONFIG_LSI_UBOOTENV)		+= ubootenv.o
-obj-$(CONFIG_ACP)			+= version.o
 obj-$(CONFIG_SERIAL_ACP)		+= serial.o
 obj-$(CONFIG_ACP)			+= wrappers.o
 obj-$(CONFIG_LSI_NET)			+= net.o
diff --git a/drivers/lsi/acp/clocks.c b/drivers/lsi/acp/clocks.c
index b6cc27c..c3c07c7 100644
--- a/drivers/lsi/acp/clocks.c
+++ b/drivers/lsi/acp/clocks.c
@@ -25,7 +25,7 @@
 
 #define CLK_REF0 125000000
 
-extern int is_asic(void);
+#include "ncr.h"
 
 /*
   ===============================================================================
diff --git a/drivers/lsi/acp/nand.c b/drivers/lsi/acp/nand.c
index 93cb248..97f5cc3 100644
--- a/drivers/lsi/acp/nand.c
+++ b/drivers/lsi/acp/nand.c
@@ -43,18 +43,7 @@
   ======================================================================
 */
 
-/* -- DEBUG --------------------------------------------------------- */
-
-#undef DEBUG
-/*#define DEBUG*/
-#if defined(DEBUG)
-#define DEBUG_PRINT(format, args...) do { \
-printk(KERN_CRIT "appnic:%d - DEBUG - ", __LINE__); \
-printk(KERN_CRIT format, ##args); \
-} while (0);
-#else
-#define DEBUG_PRINT(format, args...)
-#endif
+#include <asm/lsi/debug.h>
 
 /* -- LOGIO --------------------------------------------------------- */
 
diff --git a/drivers/lsi/acp/ncr.c b/drivers/lsi/acp/ncr.c
index 70f80e4..9203f55 100644
--- a/drivers/lsi/acp/ncr.c
+++ b/drivers/lsi/acp/ncr.c
@@ -170,6 +170,27 @@ ncr_read(unsigned long region, unsigned long address, int number,
 
 	return 0;
 }
+EXPORT_SYMBOL(ncr_read);
+/*
+  ------------------------------------------------------------------------------
+  is_asic
+*/
+
+int is_asic(void)
+{
+#ifdef CONFIG_ACPISS
+	return 0;
+#else
+	unsigned long nca_config;
+
+	if (0 == ncr_read(NCP_REGION_ID(0x16, 0xff), 0x10, 4, &nca_config)) {
+		return (0 == (nca_config & 0x80000000));
+	}
+
+	return -1;
+#endif
+}
+EXPORT_SYMBOL(is_asic);
 
 /*
   ----------------------------------------------------------------------
@@ -247,6 +268,7 @@ ncr_write(unsigned long region, unsigned long address, int number,
 
 	return 0;
 }
+EXPORT_SYMBOL(ncr_write);
 
 /*
   ----------------------------------------------------------------------
@@ -285,6 +307,3 @@ module_exit( ncr_exit );
 
 MODULE_LICENSE("GPL");
 MODULE_DESCRIPTION("Register Ring access for LSI's ACP board");
-
-EXPORT_SYMBOL(ncr_read);
-EXPORT_SYMBOL(ncr_write);
diff --git a/drivers/lsi/acp/ncr.h b/drivers/lsi/acp/ncr.h
index f102df5..291c07f 100644
--- a/drivers/lsi/acp/ncr.h
+++ b/drivers/lsi/acp/ncr.h
@@ -1,5 +1,5 @@
 /*
- * drivers/lsi/common/version.h
+ * drivers/lsi/common/ncr.h
  *
  * Copyright (C) 2010 LSI
  *
@@ -37,4 +37,6 @@
 int ncr_read(unsigned long, unsigned long, int, void *);
 int ncr_write(unsigned long, unsigned long, int, void *);
 
+int is_asic(void);
+
 #endif /*  __DRIVERS_LSI_ACP_NCR_H */
diff --git a/drivers/lsi/acp/net.c b/drivers/lsi/acp/net.c
index 8c52ebc..8958908 100644
--- a/drivers/lsi/acp/net.c
+++ b/drivers/lsi/acp/net.c
@@ -43,7 +43,7 @@
 #include <asm/io.h>
 #include <asm/dma.h>
 
-#include "../common/version.h"
+#include "ncr.h"
 
 extern int acp_mdio_read(unsigned long, unsigned long, unsigned short *);
 extern int acp_mdio_write(unsigned long, unsigned long, unsigned short);
@@ -163,69 +163,7 @@ unsigned long total_rx_packets_sent_up_ = 1;
 #define profile_avg_fmt(t,c,d) ((1000*(t/c))/d)
 #endif /* __APPNIC_C_PROFILE__ */
 
-/* -- TRACE --------------------------------------------------------- */
-
-#undef TRACE
-/*#define TRACE*/
-#define TRACE_PRINTK
-#ifdef TRACE
-#ifdef TRACE_PRINTK
-#define TRACE_BEGINNING( ) \
-printk( "nic:%d:%s:Beginning\n", smp_processor_id( ), __FUNCTION__ )
-#define TRACE_ENDING( ) \
-printk( "nic:%d:%s:Ending\n", smp_processor_id( ), __FUNCTION__ )
-#else
-#define TRACE_BEGINNING( ) TRACER_POST( "Beginning" );
-#define TRACE_ENDING( ) TRACER_POST( "Ending" );
-#endif
-#else
-#define TRACE_BEGINNING( format, args... )
-#define TRACE_ENDING( format, args... )
-#endif
-
-/* -- DEBUG --------------------------------------------------------- */
-
-#undef DEBUG
-/*#define DEBUG*/
-#if defined( DEBUG )
-#define DEBUG_PRINT( format, args... ) do { \
-printk( "appnic:%d - DEBUG - ", __LINE__ ); \
-printk( format, ##args ); \
-} while( 0 );
-#else
-#define DEBUG_PRINT( format, args... )
-#endif
-
-#undef PHY_DEBUG
-/*#define PHY_DEBUG*/
-#if defined( PHY_DEBUG )
-#define PHY_DEBUG_PRINT( format, args... ) do { \
-printk( "net:%d - PHY_DEBUG - ", __LINE__ ); \
-printk( format, ##args ); \
-} while( 0 );
-#else
-#define PHY_DEBUG_PRINT( format, args... )
-#endif
-
-/* -- WARN ----------------------------------------------------------- */
-
-#undef WARN
-#define WARN
-#if defined( WARN )
-#define WARN_PRINT( format, args... ) do { \
-printk( "appnic:%d - WARN - ", __LINE__ ); \
-printk( format, ##args ); \
-} while( 0 );
-#else
-#define WARN_PRINT( format, args... )
-#endif
-
-/* -- ERROR --------------------------------------------------------- */
-
-#define ERROR_PRINT( format, args... ) do { \
-printk( "%s:%s:%d - ERROR - ", __FILE__, __FUNCTION__, __LINE__ ); \
-printk( format, ##args ); \
-} while( 0 );
+#include <asm/lsi/debug.h>
 
 /*
   ======================================================================
diff --git a/drivers/lsi/acp/serial.c b/drivers/lsi/acp/serial.c
index 38b6121..bd67d30 100644
--- a/drivers/lsi/acp/serial.c
+++ b/drivers/lsi/acp/serial.c
@@ -52,7 +52,7 @@
 #include <linux/of.h>
 #include <asm/io.h>
 
-#include "../common/version.h"
+#include "ncr.h"
 
 extern int acp_clock_get(int, unsigned long *);
 
diff --git a/drivers/lsi/acp/ubootenv.c b/drivers/lsi/acp/ubootenv.c
index e1c71c3..80a9b77 100644
--- a/drivers/lsi/acp/ubootenv.c
+++ b/drivers/lsi/acp/ubootenv.c
@@ -31,7 +31,6 @@
   Data types and Macros
   ======================================================================
 */
-
 #undef DEBUG_EXPORT_SYMBOLS
 /*#define DEBUG_EXPORT_SYMBOLS*/
 #ifdef DEBUG_EXPORT_SYMBOLS
@@ -40,44 +39,7 @@
 #define STATIC static
 #endif
 
-/*
-  DEBUG
-*/
-
-#undef DEBUG
-/*#define DEBUG*/
-#if defined( DEBUG )
-#define DEBUG_PRINT( format, args... ) do { \
-printk( "ubootenv:%s:%d - DEBUG - ", __FUNCTION__, __LINE__ ); \
-printk( format, ##args ); \
-} while( 0 );
-#else
-#define DEBUG_PRINT( format, args... ) { }
-#endif
-
-/*
-  WARN
-*/
-
-#undef WARN
-#define WARN
-#if defined( WARN )
-#define WARN_PRINT( format, args... ) do { \
-printk( "ubootenv:%s:%d - WARN - ", __FUNCTION__, __LINE__ ); \
-printk( format, ##args ); \
-} while( 0 );
-#else
-#define WARN_PRINT( format, args... ) { }
-#endif
-
-/*
-  ERROR
-*/
-
-#define ERROR_PRINT( format, args... ) do { \
-printk( "ubootenv:%s:%d - ERROR - ", __FUNCTION__, __LINE__ ); \
-printk( format, ##args ); \
-} while( 0 );
+#include <asm/lsi/debug.h>
 
 /*
   ======================================================================
diff --git a/drivers/lsi/acp/version.c b/drivers/lsi/acp/version.c
deleted file mode 100644
index 9306b07..0000000
--- a/drivers/lsi/acp/version.c
+++ /dev/null
@@ -1,352 +0,0 @@
-/*
- * version.c
- *
- * Copyright (C) 2010 LSI
- *
- * This program is free software; you can redistribute it and/or modify
- * it under the terms of the GNU General Public License as published by
- * the Free Software Foundation; either version 2 of the License, or
- * (at your option) any later version.
- *
- * This program is distributed in the hope that it will be useful,
- * but WITHOUT ANY WARRANTY; without even the implied warranty of
- * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.	 See the
- * GNU General Public License for more details.
- *
- * You should have received a copy of the GNU General Public License
- * along with this program; if not, write to the Free Software
- * Foundation, Inc., 59 Temple Place, Suite 330, Boston, MA  021_2_6.17	 USA
- */
-
-#include <linux/module.h>
-#include <linux/init.h>
-#include <linux/kernel.h>
-#include <linux/string.h>
-#include <linux/sched.h>
-#include <linux/time.h>
-#include <linux/proc_fs.h>
-#include <asm/io.h>
-#include <asm/bitops.h>
-
-#include "../common/debug.h"
-#include "../common/version.h"
-#include "ncr.h"
-
-#undef TLBERRORCOUNTER
-/*#define TLBERRORCOUNTER*/
-#ifdef TLBERRORCOUNTER
-unsigned long dtlb_misses = 0;
-unsigned long itlb_misses = 0;
-#endif
-
-extern int ubootenv_get(const char *, char *);
-
-/*
-  MODULE
-*/
-
-MODULE_LICENSE("GPL");
-MODULE_DESCRIPTION("Information about the Agere APP3xx");
-
-/*
- */
-
-unsigned agere_app3xx_revision;
-EXPORT_SYMBOL(agere_app3xx_revision);
-
-/*
-  ----------------------------------------------------------------------
-  timer_test_
-*/
-
-#ifdef TIMER_TEST
-
-static void
-timer_test_(void)
-{
-	const int first_timer_ = 0;
-	const int last_timer_ = 7;
-	int timer_;
-	unsigned long timer_base_[] = {
-		TIMER0_BASE, TIMER1_BASE, TIMER2_BASE, TIMER3_BASE,
-		TIMER4_BASE, TIMER5_BASE, TIMER6_BASE, TIMER7_BASE
-	};
-
-	{
-		const int number_of_reads_ = 200;
-		unsigned long time_[number_of_reads_];
-		int index_;
-
-		for (index_ = 0; index_ < number_of_reads_; ++index_)
-			time_[index_] = ~(readl((TIMER0_BASE + TIMER_n_VALUE)));
-
-		for (index_ = 0; index_ < number_of_reads_; ++index_) {
-			printk(KERN_INFO "%03d : 0x%08x\n", index_, time_[index_]);
-
-			if (0 < index_) {
-				if (time_[index_] <= time_[(index_ - 1)]) {
-					printk(KERN_ERR "WHAT!\n");
-				}
-			}
-		}
-	}
-
-	for (timer_ = first_timer_; timer_ <= last_timer_; ++timer_) {
-		unsigned long base_ = timer_base_[timer_];
-
-		printk(KERN_INFO "load value=0x%x control=0x%x background load=0x%x\n",
-			readl((base_ + TIMER_n_LOAD)),
-			readl((base_ + TIMER_n_CONTROL)),
-			readl((base_ + TIMER_n_BACKGROUND_LOAD)));
-	}
-}
-
-#endif /* TIMER_TEST */
-
-#ifdef SHMEM_TEST
-
-/*
-  ----------------------------------------------------------------------
-  shmem_test
-*/
-
-void
-shmem_test(void)
-{
-	void __iomem *cached_shmem;
-	void __iomem *uncached_shmem;
-	unsigned i;
-	unsigned long start_time;
-
-	uncached_shmem = ioremap_nocache(APP3K_PHYS_SHMEM_BASE, PAGE_SZ);
-	cached_shmem = ioremap_cached(APP3K_PHYS_SHMEM_BASE + PAGE_SZ,
-				       APP_SHMEM_SIZE - PAGE_SZ);
-
-	if ((void __iomem *) 0 == cached_shmem) {
-		printk(KERN_ERR "Unable to map shmem as cached IO\n");
-		return;
-	}
-
-	printk("cached_shmem=0x%08p shmem=0x%08x uncached_shmem=0x%08p\n",
-		cached_shmem, APP_SHMEM_BASE, uncached_shmem);
-
-#if 0
-	i = 0;
-	start_time = jiffies;
-	while (jiffies == start_time)
-		;
-	start_time = jiffies;
-	while (jiffies == start_time) {
-
-		unsigned j;
-		unsigned char * dest = (unsigned char *) APP_SHMEM_BASE;
-
-		for (j = 0; j < APP_SHMEM_SIZE; ++j, ++dest) {
-			*dest = j;
-		}
-
-		++i;
-	}
-
-	printk("%d iterations uncached\n", i);
-
-	i = 0;
-	start_time = jiffies;
-	while (jiffies == start_time)
-		;
-	start_time = jiffies;
-	while (jiffies == start_time) {
-		unsigned j;
-		unsigned char * dest = (unsigned char *) cached_shmem;
-
-		for (j = 0; j < APP_SHMEM_SIZE; ++j, ++dest) {
-			*dest = j;
-		}
-
-		++i;
-	}
-
-	printk(KERN_INFO "%d iterations cached\n", i);
-#endif
-
-	return;
-}
-
-#endif /* SHMEM_TEST */
-
-#ifdef TLBERRORCOUNTER
-
-static int
-tlberror_create_string(char *buffer)
-{
-	int length = 0;
-
-	length = sprintf(buffer,
-			 "Data TLB Errors: %d\n"
-			 "Instruction TLB Errors: %d\n",
-			 dtlb_misses, itlb_misses);
-
-	return length;
-}
-
-/*
-  ----------------------------------------------------------------------
-  tlberror_read_proc
-*/
-
-static int
-tlberror_read_proc(char *page, char **start, off_t offset,
-		   int count, int *eof, void *data)
-{
-	int length = 0;
-
-	length = tlberror_create_string(page);
-	*eof = 1;
-
-	return length;
-}
-
-#endif /* TLBERRORCOUNTER */
-
-/*
-  ------------------------------------------------------------------------------
-  is_asic
-*/
-
-int
-is_asic(void)
-{
-#ifdef CONFIG_ACPISS
-	return 0;
-#else
-#if 1
-	unsigned long nca_config;
-
-	if (0 == ncr_read(NCP_REGION_ID(0x16, 0xff), 0x10, 4, &nca_config)) {
-		return (0 == (nca_config & 0x80000000));
-	}
-
-	return -1;
-#else
-	printk("%s:%s:%d - Writing 0x%x to 0x%x (NCA=0x%x)\n",
-		__FILE__, __FUNCTION__, __LINE_,
-		value, address, NCA); /* ZZZ */
-	return 0;
-#endif
-#endif
-}
-
-/*
-  ----------------------------------------------------------------------
-  info_create_string
-*/
-
-static int
-info_create_string(char *buffer)
-{
-	int length = 0;
-	char uboot_version2[80];
-	char uboot_version3[80];
-
-#ifdef CONFIG_ACPISS
-	sprintf(uboot_version2, "Unknown");
-	sprintf(uboot_version3, "Unknown");
-#else
-#ifdef CONFIG_LSI_UBOOTENV
-	if (0 != ubootenv_get("version2", uboot_version2)) {
-		sprintf(uboot_version2, "Unknown");
-	}
-
-	if (0 != ubootenv_get("version3", uboot_version3)) {
-		sprintf(uboot_version3, "Unknown");
-	}
-#else
-	sprintf(uboot_version2, "Unknown");
-	sprintf(uboot_version3, "Unknown");
-#endif
-#endif
-
-	length = sprintf(buffer,
-			 "LSI ACP Info\n" \
-			 "LSI Version %s\n" \
-			 "Platform: %s\n" \
-			 "U-Boot Version (2nd Stage) %s\n" \
-			 "U-Boot Version (3rd Stage) %s\n",
-			 ACP_VERSION, (is_asic() ? "ASIC" : "FPGA"),
-			 uboot_version2, uboot_version3);
-
-	/* that's all */
-	return length;
-
-}
-
-/*
-  ----------------------------------------------------------------------
-  info_read_proc
-*/
-
-static int
-info_read_proc(char *page, char **start, off_t offset,
-		int count, int *eof, void *data)
-{
-	int length_ = 0;
-
-#ifdef SHMEM_TEST
-	shmem_test();
-#endif /* SHMEM_TEST */
-
-#ifdef TIMER_TEST
-	timer_test_();
-#endif /* TIMER_TEST */
-
-#if !defined(SHMEM_TEST) && !defined(TIMER_TEST)
-	length_ = info_create_string(page);
-#endif
-	*eof = 1;
-
-	return length_;
-}
-
-/*
-  ----------------------------------------------------------------------
-  info_module_init
-*/
-
-int __init
-info_module_init(void)
-{
-
-	char buffer_[256];
-
-	create_proc_read_entry("driver/version", 0, NULL, info_read_proc, NULL);
-	info_create_string(buffer_);
-	printk("%s", buffer_);
-
-#ifdef TLBERRORCOUNTER
-	create_proc_read_entry("driver/tlberrors",
-			       0, NULL, tlberror_read_proc, NULL);
-#endif
-
-	return 0;
-
-}
-
-module_init(info_module_init);
-
-/*
-  ----------------------------------------------------------------------
-  info_module_exit
-*/
-
-void __exit
-info_module_exit(void)
-{
-#ifdef TLBERRORCOUNTER
-	remove_proc_entry("driver/tlberrors", NULL);
-#endif
-	remove_proc_entry("driver/version", NULL);
-
-	return;
-}
-
-module_exit(info_module_exit);
diff --git a/drivers/lsi/acp/wrappers.c b/drivers/lsi/acp/wrappers.c
index fbb2f19..eaee753 100644
--- a/drivers/lsi/acp/wrappers.c
+++ b/drivers/lsi/acp/wrappers.c
@@ -23,7 +23,7 @@
 #include <asm/irq.h>
 #include <asm/io.h>
 
-extern int is_asic(void);
+#include "ncr.h"
 extern int acp_clock_get(int, unsigned long *);
 
 /*
diff --git a/drivers/lsi/common/debug.h b/drivers/lsi/common/debug.h
deleted file mode 100644
index 71581e9..0000000
--- a/drivers/lsi/common/debug.h
+++ /dev/null
@@ -1,63 +0,0 @@
-/*
- * drivers/acp/common/debug.h
- *
- * Copyright (C) 2010 LSI
- *
- * This program is free software; you can redistribute it and/or modify
- * it under the terms of the GNU General Public License as published by
- * the Free Software Foundation; either version 2 of the License, or
- * (at your option) any later version.
- *
- * This program is distributed in the hope that it will be useful,
- * but WITHOUT ANY WARRANTY; without even the implied warranty of
- * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.	 See the
- * GNU General Public License for more details.
- *
- * You should have received a copy of the GNU General Public License
- * along with this program; if not, write to the Free Software
- * Foundation, Inc., 59 Temple Place, Suite 330, Boston, MA  02111-1307	 USA
- */
-
-#ifndef __DRIVERS_LSI_COMMON_DEBUG_H
-#define __DRIVERS_LSI_COMMON_DEBUG_H
-
-/*
-  DEBUG
-*/
-
-#if defined(DEBUG)
-#define DEBUG_PRINT(format, args...) do { \
-printk("%s:%s:%d - DEBUG - ", __FILE__, __FUNCTION__, __LINE__); \
-printk(format, ##args); \
-} while (0);
-#else
-#define DEBUG_PRINT(format, args...) { }
-#endif
-
-/*
-  WARN
-*/
-
-#if defined(WARN)
-#define WARN_PRINT(format, args...) do { \
-printk("%s:%s:%d - WARN - ", __FILE__, __FUNCTION__, __LINE__); \
-printk(format, ##args); \
-} while (0);
-#else
-#define WARN_PRINT(format, args...) { }
-#endif
-
-/*
-  ERROR
-*/
-
-#if defined(ERROR)
-#define ERROR_PRINT(format, args...) do { \
-printk("%s:%s:%d - ERROR - ", __FILE__, __FUNCTION__, __LINE__); \
-printk(format, ##args); \
-} while (0);
-#else
-#define ERROR_PRINT(format, args...) { }
-#endif
-
-#endif /* __DRIVERS_LSI_COMMON_DEBUG_H */
diff --git a/drivers/lsi/common/version.h b/drivers/lsi/common/version.h
deleted file mode 100644
index 6dbdb5d..0000000
--- a/drivers/lsi/common/version.h
+++ /dev/null
@@ -1,28 +0,0 @@
-/*
- * drivers/lsi/common/version.h
- *
- * Copyright (C) 2009 LSI
- *
- * This program is free software; you can redistribute it and/or modify
- * it under the terms of the GNU General Public License as published by
- * the Free Software Foundation; either version 2 of the License, or
- * (at your option) any later version.
- *
- * This program is distributed in the hope that it will be useful,
- * but WITHOUT ANY WARRANTY; without even the implied warranty of
- * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
- * GNU General Public License for more details.
- *
- * You should have received a copy of the GNU General Public License
- * along with this program; if not, write to the Free Software
- * Foundation, Inc., 59 Temple Place, Suite 330, Boston, MA  02111-1307  USA
- */
-
-#ifndef __DRIVERS_ACP_VERSION_H
-#define __DRIVERS_ACP_VERSION_H
-
-#define ACP_VERSION "3.8.1.28"
-
-int is_asic(void);
-
-#endif /* __DRIVERS_ACP_VERSION_H */
-- 
1.7.9.7

