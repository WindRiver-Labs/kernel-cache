From 9f4af01f07199acfa2334dac1d4daf2fb12e5269 Mon Sep 17 00:00:00 2001
From: Jiang Lu <lu.jiang@windriver.com>
Date: Wed, 23 Jan 2013 15:39:14 +0800
Subject: [PATCH 01/16] ACP34xx:Fix a few mismatch section warnings

Fix a few mismatch section warnings introduced by this BSP, includes:

WARNING: vmlinux.o(.text+0x228): Section mismatch in reference from the variable start_secondary_47x to the function .cpuinit.text:mmu_init_secondary()
The function start_secondary_47x() references
the function __cpuinit mmu_init_secondary().
This is often because start_secondary_47x lacks a __cpuinit
annotation or the annotation of mmu_init_secondary is wrong.

WARNING: vmlinux.o(.text+0x24c): Section mismatch in reference from the variable start_secondary_47x to the function .devinit.text:start_secondary()
The function start_secondary_47x() references
the function __devinit start_secondary().
This is often because start_secondary_47x lacks a __devinit
annotation or the annotation of start_secondary is wrong.

WARNING: vmlinux.o(.data+0x29880): Section mismatch in reference from the variable pl061_gpio_driver to the function .init.text:pl061_of_probe()
The variable pl061_gpio_driver references
the function __init pl061_of_probe()
If the reference is valid then annotate the
variable with __init* or __refdata (see linux/init.h) or name the variable:
*_template, *_timer, *_sht, *_ops, *_probe, *_probe_one, *_console

WARNING: vmlinux.o(.data+0x31cc8): Section mismatch in reference from the variable pl022_driver to the function .init.text:pl022_of_probe()
The variable pl022_driver references
the function __init pl022_of_probe()
If the reference is valid then annotate the
variable with __init* or __refdata (see linux/init.h) or name the variable:
*_template, *_timer, *_sht, *_ops, *_probe, *_probe_one, *_console

Signed-off-by: Jiang Lu <lu.jiang@windriver.com>
---
 arch/powerpc/kernel/head_44x.S |    6 +++---
 drivers/gpio/gpio-pl061.c      |    4 ++--
 drivers/spi/spi-pl022.c        |    6 +++---
 3 files changed, 8 insertions(+), 8 deletions(-)

diff --git a/arch/powerpc/kernel/head_44x.S b/arch/powerpc/kernel/head_44x.S
index e5ce673..cb9b539 100644
--- a/arch/powerpc/kernel/head_44x.S
+++ b/arch/powerpc/kernel/head_44x.S
@@ -1038,9 +1038,9 @@ END_FTR_SECTION_IFSET(CPU_FTR_476_DD2)
 	blr
 
 #ifdef CONFIG_SMP
-
 /* Entry point for secondary 47x processors */
-_GLOBAL(start_secondary_47x)
+__CPUINIT
+_ENTRY(start_secondary_47x)
         mr      r24,r3          /* CPU number */
 
 	bl	init_cpu_state
@@ -1077,7 +1077,7 @@ _GLOBAL(start_secondary_47x)
 	mtspr	SPRN_SPRG3,r4
 
 	b	start_secondary
-
+__FINIT
 #endif /* CONFIG_SMP */
 
 /*
diff --git a/drivers/gpio/gpio-pl061.c b/drivers/gpio/gpio-pl061.c
index 7ca1cde..9d35136 100644
--- a/drivers/gpio/gpio-pl061.c
+++ b/drivers/gpio/gpio-pl061.c
@@ -240,7 +240,7 @@ static void __init pl061_init_gc(struct pl061_gpio *chip, int irq_base)
 			       IRQ_GC_INIT_NESTED_LOCK, IRQ_NOREQUEST, 0);
 }
 
-static int __init pl061_probe(struct device *dev,
+static int __devinit pl061_probe(struct device *dev,
 	struct resource *res, int irq, struct pl061_gpio **retchip)
 {
 	struct pl061_platform_data *pdata;
@@ -416,7 +416,7 @@ static struct amba_driver pl061_gpio_driver = {
 	.probe		= pl061_amba_probe,
 };
 #else
-static int __init pl061_of_probe(struct platform_device *ofdev)
+static int __devinit pl061_of_probe(struct platform_device *ofdev)
 {
 	struct resource r_mem;
 	struct pl061_platform_data pl061_data = {0};
diff --git a/drivers/spi/spi-pl022.c b/drivers/spi/spi-pl022.c
index 143f891..7220716 100644
--- a/drivers/spi/spi-pl022.c
+++ b/drivers/spi/spi-pl022.c
@@ -2002,7 +2002,7 @@ static void pl022_cleanup(struct spi_device *spi)
 	kfree(chip);
 }
 
-static int __init pl022_probe(
+static int __devinit pl022_probe(
 	struct device *dev,
 	struct vendor_data *vendor,
 	struct resource *res,
@@ -2515,7 +2515,7 @@ static void register_spi_device(struct pl022 *pl022)
 
 static struct of_device_id pl022_match[];
 
-static int __init
+static int __devinit
 pl022_of_probe(struct platform_device *ofdev)
 {
 	struct pl022_ssp_controller *platform_info;
@@ -2580,7 +2580,7 @@ err_data:
 	return ret;
 }
 
-static int __exit
+static int __devexit
 pl022_of_remove(struct platform_device *ofdev)
 {
 	struct resource r_mem;
-- 
1.7.9.7

