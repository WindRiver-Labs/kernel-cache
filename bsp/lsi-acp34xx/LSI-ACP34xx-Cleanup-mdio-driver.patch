From ccf9b593cbe2880122be85595783401c66ccaf4d Mon Sep 17 00:00:00 2001
From: Jiang Lu <lu.jiang@windriver.com>
Date: Thu, 31 Jan 2013 15:33:03 +0800
Subject: [PATCH 09/16] LSI:ACP34xx:Cleanup mdio driver

Cleanup acp34xx's mdio driver with following modification:
1.Remove unnecessary debug macros.
2.Fix code indent issues.
3.Remove dead code.

Signed-off-by: Jiang Lu <lu.jiang@windriver.com>
---
 drivers/lsi/acp/wrappers.c |   42 +++++++++++++++++++-----------------------
 1 file changed, 19 insertions(+), 23 deletions(-)

diff --git a/drivers/lsi/acp/wrappers.c b/drivers/lsi/acp/wrappers.c
index eaee753..04bb3c0 100644
--- a/drivers/lsi/acp/wrappers.c
+++ b/drivers/lsi/acp/wrappers.c
@@ -21,7 +21,7 @@
 #include <linux/module.h>
 #include <linux/of.h>
 #include <asm/irq.h>
-#include <asm/io.h>
+#include <linux/io.h>
 
 #include "ncr.h"
 extern int acp_clock_get(int, unsigned long *);
@@ -36,7 +36,6 @@ extern int acp_clock_get(int, unsigned long *);
 
 #ifndef CONFIG_ACPISS
 
-#undef BZ33327_WA
 #define BZ33327_WA
 
 static unsigned long mdio_base;
@@ -53,7 +52,8 @@ static DEFINE_SPINLOCK(mdio_lock);
 */
 
 int
-acp_mdio_read(unsigned long address, unsigned long offset, unsigned short *value)
+acp_mdio_read(unsigned long address, unsigned long offset,
+	      unsigned short *value)
 {
 	unsigned long command = 0;
 	unsigned long status;
@@ -65,12 +65,12 @@ acp_mdio_read(unsigned long address, unsigned long offset, unsigned short *value
 	status = in_le32(MDIO_STATUS_RD_DATA);
 	status |= 0x40000000;
 	out_le32(MDIO_STATUS_RD_DATA, status);
-#endif /* BZ33327_WA */
+#endif				/* BZ33327_WA */
 
-	/* Write the command.*/
+	/* Write the command. */
 	command |= 0x10000000;	/* op_code: read */
-	command |= (address & 0x1f) << 16; /* port_addr (target device) */
-	command |= (offset & 0x1f) << 21; /* device_addr (target register) */
+	command |= (address & 0x1f) << 16;	/* port_addr (target device) */
+	command |= (offset & 0x1f) << 21;/* device_addr (target register) */
 	out_le32(MDIO_CONTROL_RD_DATA, command);
 
 #if defined(BZ33327_WA)
@@ -82,15 +82,14 @@ acp_mdio_read(unsigned long address, unsigned long offset, unsigned short *value
 	/* Wait for the mdio_busy (control) bit to clear. */
 	do {
 		command = in_le32(MDIO_CONTROL_RD_DATA);
-	} while(0 != (command & 0x80000000));
+	} while (0 != (command & 0x80000000));
 
 	*value = (unsigned short)(command & 0xffff);
-#endif /* BZ33327_WA */
+#endif				/* BZ33327_WA */
 	spin_unlock_irqrestore(&mdio_lock, flags);
 
 	return 0;
 }
-
 EXPORT_SYMBOL(acp_mdio_read);
 
 /*
@@ -99,7 +98,8 @@ EXPORT_SYMBOL(acp_mdio_read);
 */
 
 int
-acp_mdio_write(unsigned long address, unsigned long offset, unsigned short value)
+acp_mdio_write(unsigned long address, unsigned long offset,
+	       unsigned short value)
 {
 	unsigned long command = 0;
 	unsigned long status;
@@ -117,13 +117,13 @@ acp_mdio_write(unsigned long address, unsigned long offset, unsigned short value
 	status = in_le32(MDIO_STATUS_RD_DATA);
 	status |= 0x40000000;
 	out_le32(MDIO_STATUS_RD_DATA, status);
-#endif /* BZ33327_WA */
+#endif				/* BZ33327_WA */
 
 	/* Write the command. */
 	command = 0x08000000;	/* op_code: write */
-	command |= (address & 0x1f) << 16; /* port_addr (target device) */
-	command |= (offset & 0x1f) << 21; /* device_addr (target register) */
-	command |= (value & 0xffff); /* value */
+	command |= (address & 0x1f) << 16;	/* port_addr (target device) */
+	command |= (offset & 0x1f) << 21;/* device_addr (target register) */
+	command |= (value & 0xffff);	/* value */
 	out_le32(MDIO_CONTROL_RD_DATA, command);
 
 #if defined(BZ33327_WA)
@@ -131,7 +131,7 @@ acp_mdio_write(unsigned long address, unsigned long offset, unsigned short value
 	do {
 		status = in_le32(MDIO_STATUS_RD_DATA);
 	} while (0 != (status & 0x40000000));
-#endif /* BZ33327_WA */
+#endif				/* BZ33327_WA */
 
 	/* Wait for the mdio_busy (control) bit to clear. */
 	do {
@@ -142,7 +142,6 @@ acp_mdio_write(unsigned long address, unsigned long offset, unsigned short value
 
 	return 0;
 }
-
 EXPORT_SYMBOL(acp_mdio_write);
 
 /*
@@ -164,7 +163,7 @@ acp_mdio_initialize(void)
 	return 0;
 }
 
-#endif /* CONFIG_ACPISS */
+#endif				/* CONFIG_ACPISS */
 
 /*
   ==============================================================================
@@ -200,8 +199,7 @@ acp_wrappers_init(void)
 		field = of_get_property(np, "enabled", NULL);
 
 		if (!field || (field && (0 == *field))) {
-			printk(KERN_WARNING
-			       "Networking is Not Enabled.\n");
+			printk(KERN_WARNING "Networking is Not Enabled.\n");
 			goto acp_wrappers_init_done;
 		}
 
@@ -231,11 +229,9 @@ acp_wrappers_init(void)
 	if (0 != rc)
 		printk(KERN_ERR "MDIO Initiailzation Failed!\n");
 
- acp_wrappers_init_done:
-
+acp_wrappers_init_done:
 	return 0;
 }
-
 module_init(acp_wrappers_init);
 
 MODULE_AUTHOR("LSI Corporation");
-- 
1.7.9.7

