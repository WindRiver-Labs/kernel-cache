From d27ab0fcc665409a7bc142108be11b2e547a7538 Mon Sep 17 00:00:00 2001
From: Wei Yang <Wei.Yang@windriver.com>
Date: Tue, 20 Nov 2012 14:40:40 +0800
Subject: [PATCH 4/5] powerpc/prom: remove the illegal reversed memory region

When the MEMORY_START is larger than 0 we need to ensure that kernel
does not reserve the range from 0 to MEMORY_START in memblock. Because
the range is out of the available memory.

Signed-off-by: Wei Yang <Wei.Yang@windriver.com>
---
 arch/powerpc/kernel/prom.c |    5 +++++
 1 file changed, 5 insertions(+)

diff --git a/arch/powerpc/kernel/prom.c b/arch/powerpc/kernel/prom.c
index f191bf0..8f1d4ec 100644
--- a/arch/powerpc/kernel/prom.c
+++ b/arch/powerpc/kernel/prom.c
@@ -678,6 +678,11 @@ void __init early_init_devtree(void *params)
 #endif
 		reserve_crashkernel();
 	early_reserve_mem();
+	/*
+	 * The range of reserved memory region is out of memory while MEMORY_START is larger than 0.
+	 * so we should remove it.
+	 */
+	memblock_free(0, MEMORY_START);
 
 	/*
 	 * Ensure that total memory size is page-aligned, because otherwise
-- 
1.7.9.7

