From 01017e7d308b4ea8944becb6a6e5529449c69c0e Mon Sep 17 00:00:00 2001
From: Greg Moffatt <greg.moffatt@windriver.com>
Date: Wed, 23 Sep 2009 13:17:25 -0400
Subject: [PATCH 50/77] powerpc: Fix build errors when CONFIG_SMP is not set

If the P4080 is compiled without SMP support, some of the newly introduced
drivers will not compile due to incomplete handling of CONFIG_SMP in the
associated header files.

Signed-off-by: Greg Moffatt <greg.moffatt@windriver.com>
---
 arch/powerpc/include/asm/smp.h |    8 +++-----
 drivers/hwalloc/bman_driver.c  |    1 +
 drivers/hwqueue/qman_driver.c  |    1 +
 3 files changed, 5 insertions(+), 5 deletions(-)

diff --git a/arch/powerpc/include/asm/smp.h b/arch/powerpc/include/asm/smp.h
index d7267ce..3d7c105 100644
--- a/arch/powerpc/include/asm/smp.h
+++ b/arch/powerpc/include/asm/smp.h
@@ -91,8 +91,6 @@ extern void __cpu_die(unsigned int cpu);
 #define hard_smp_processor_id()		0
 #define smp_setup_cpu_maps()
 
-#endif /* CONFIG_SMP */
-
 #ifdef CONFIG_PPC64
 #define get_hard_smp_processor_id(CPU) (paca[(CPU)].hw_cpu_id)
 #define set_hard_smp_processor_id(CPU, VAL) \
@@ -102,12 +100,12 @@ extern void smp_release_cpus(void);
 
 #else
 /* 32-bit */
-#ifndef CONFIG_SMP
 extern int boot_cpuid_phys;
 #define get_hard_smp_processor_id(cpu) 	boot_cpuid_phys
 #define set_hard_smp_processor_id(cpu, phys)
-#endif
-#endif
+#endif /* CONFIG_PPC64 */
+
+#endif /* CONFIG_SMP */
 
 extern int smt_enabled_at_boot;
 
diff --git a/drivers/hwalloc/bman_driver.c b/drivers/hwalloc/bman_driver.c
index 2455370..a6cfddf 100644
--- a/drivers/hwalloc/bman_driver.c
+++ b/drivers/hwalloc/bman_driver.c
@@ -31,6 +31,7 @@
  */
 
 #include "bman_private.h"
+#include <asm/smp.h>
 
 /*****************/
 /* Portal driver */
diff --git a/drivers/hwqueue/qman_driver.c b/drivers/hwqueue/qman_driver.c
index 3687ec2..76b6fca 100644
--- a/drivers/hwqueue/qman_driver.c
+++ b/drivers/hwqueue/qman_driver.c
@@ -31,6 +31,7 @@
  */
 
 #include "qman_private.h"
+#include <asm/smp.h>
 
 /*****************/
 /* Portal driver */
-- 
1.6.5.2

