From 1aae074201e90e65394a01e60b88d95553bfcc29 Mon Sep 17 00:00:00 2001
From: Andrew Liu <shengping.liu@windriver.com>
Date: Mon, 9 Aug 2010 18:58:29 +0800
Subject: [PATCH 19/26] p4080ds_mdio_reset: each device locks the bus, remove the overall one

CONFIG_PROVE_LOCKING warns on nested locks, and this patch
adresses the source of the warning: the lock is first locked
before the bus reset is called and then each device themselves
also take the lock. Removing the overall lock removes the
CONFIG_PROVE_LOCKING warning.

Signed-off-by: Daniel Stenberg <daniel.stenberg@windriver.com>
Integrated-by: Andrew Liu <shengping.liu@windriver.com>
---
 arch/powerpc/platforms/85xx/p4080ds_mdio.c |    4 ++--
 1 files changed, 2 insertions(+), 2 deletions(-)

diff --git a/arch/powerpc/platforms/85xx/p4080ds_mdio.c b/arch/powerpc/platforms/85xx/p4080ds_mdio.c
index 2d4d97c..96e6e68 100644
--- a/arch/powerpc/platforms/85xx/p4080ds_mdio.c
+++ b/arch/powerpc/platforms/85xx/p4080ds_mdio.c
@@ -79,9 +79,9 @@ static int p4080ds_mdio_reset(struct mii_bus *bus)
 {
 	struct p4080ds_mdio *priv = bus->priv;
 
-	mutex_lock(&bus->mdio_lock);
+	 /* each device already locks this themselves when called, don't lock
+	  * &bus->mdio_lock here! */
 	priv->real_bus->reset(priv->real_bus);
-	mutex_unlock(&bus->mdio_lock);
 
 	return 0;
 }
-- 
1.6.5.2

