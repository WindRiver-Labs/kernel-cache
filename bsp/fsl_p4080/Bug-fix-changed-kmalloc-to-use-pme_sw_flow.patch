From b3d5406c226d50a45170788b6d098796c93e66a6 Mon Sep 17 00:00:00 2001
From: Paul Barrette <paul.barrette@freescale.com>
Date: Thu, 13 Aug 2009 10:55:41 -0400
Subject: [PATCH 024/148] Bug fix: changed kmalloc to use pme_sw_flow.

Signed-off-by: Paul Barrette <paul.barrette@freescale.com>
[Cleanly applied the FSL SDK 2.0.3 patch:
"0005-Bug-fix-changed-kmalloc-to-use-pme_sw_flow.patch"]
Integrated-by: Yuri Nedel <Yuri.Nedel@windriver.com>
---
 drivers/match/pme2_test_scan.c |    3 ++-
 1 files changed, 2 insertions(+), 1 deletions(-)

diff --git a/drivers/match/pme2_test_scan.c b/drivers/match/pme2_test_scan.c
index 0ef9d6e..2f9ba0f 100644
--- a/drivers/match/pme2_test_scan.c
+++ b/drivers/match/pme2_test_scan.c
@@ -399,7 +399,7 @@ void pme2_test_scan(void)
 	/* read back flow settings */
 	{
 		struct pme_flow *rb_flow;
-		rb_flow = kmalloc(sizeof(struct pme_flow), GFP_KERNEL);
+		rb_flow = pme_sw_flow_new();
 		memset(rb_flow, 0, sizeof(struct pme_flow));
 		ret = pme_ctx_ctrl_read_flow(&a_scan_ctx.base_ctx,
 			PME_CTX_OP_WAIT |
@@ -409,6 +409,7 @@ void pme2_test_scan(void)
 		pr_info("st: read Flow Context;\n");
 		hexdump(rb_flow, sizeof(*rb_flow));
 		kfree(rb_flow);
+		pme_sw_flow_free(rb_flow);
 	}
 
 	/* Disable */
-- 
1.6.5.2

