From 45c5aeee37a5a061a7da41130d3fd11a292e1ff0 Mon Sep 17 00:00:00 2001
From: Kim Phillips <kim.phillips@freescale.com>
Date: Wed, 7 Oct 2009 16:05:04 -0500
Subject: [PATCH] crypto: caam - fix range of input/output ring size

The SEC4 h/w can only handle up to 1023 entries in
its ring buffer size register field.  The driver
uses bitwise ops, so reduce '10' to '9' (i.e,
max. 512 entries).

Also annotate/clarify range on coalescing the
number of descriptors, and erratum SEC #4 verbage.

This fixes Bug 4411.

Signed-off-by: Kim Phillips <kim.phillips@freescale.com>
[Kevin: Original patch taken from Freescale p4080 SDK 2.0 ISO image.
Apply cleanly to kernel 2.6.27]
Integrated-by: Kevin Hao <kexin.hao@windriver.com>
---
 drivers/crypto/caam/Kconfig |    9 +++++----
 1 files changed, 5 insertions(+), 4 deletions(-)

diff --git a/drivers/crypto/caam/Kconfig b/drivers/crypto/caam/Kconfig
index 6912ec5..f764317 100644
--- a/drivers/crypto/caam/Kconfig
+++ b/drivers/crypto/caam/Kconfig
@@ -9,11 +9,11 @@ config CRYPTO_DEV_FSL_CAAM
 config CRYPTO_DEV_FSL_CAAM_RINGSIZE
 	int "Job Queue ring size"
 	depends on CRYPTO_DEV_FSL_CAAM
-	range 2 10
+	range 2 9
 	default "8"
 	help
 	  Select size of Job Queue rings as a power of 2, within the
-	  range 2-10 (ring size 4-1024).
+	  range 2-9 (ring size 4-512).
 	  Examples:
 		2 => 4
 		3 => 8
@@ -23,13 +23,14 @@ config CRYPTO_DEV_FSL_CAAM_RINGSIZE
 		7 => 128
 		8 => 256
 		9 => 512
-		10 => 1024
 
 config CRYPTO_DEV_FSL_CAAM_INTC
 	bool "Job Queue interrupt coalescing"
 	depends on CRYPTO_DEV_FSL_CAAM
+	default y
 	help
 	  Enable the Job Queue's interrupt coalescing feature.
+	  Note: rev. 1 silicon erratum SEC #4 requires this be set.
 
 config CRYPTO_DEV_FSL_CAAM_INTC_COUNT_THLD
 	int "Job Queue interrupt coalescing count threshold"
@@ -50,7 +51,7 @@ config CRYPTO_DEV_FSL_CAAM_INTC_TIME_THLD
 	help
 	  Select number of bus clocks/64 to timeout in the case that one or
 	  more descriptor completions are queued without reaching the count
-	  threshold.
+	  threshold. Range is 1-65535.
 
 config CRYPTO_DEV_FSL_CAAM_DC_LIB
 	tristate "Freescale CAAM Descriptor Library (EXPERIMENTAL)"
-- 
1.6.0.4

