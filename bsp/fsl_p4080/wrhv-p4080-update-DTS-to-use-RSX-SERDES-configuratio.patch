From 84202a7947213ae7dbed943a5800c1359beb5438 Mon Sep 17 00:00:00 2001
From: Kevin Hao <kexin.hao@windriver.com>
Date: Tue, 3 Aug 2010 13:22:53 +0800
Subject: [PATCH] wrhv/p4080: update DTS to use RSX SERDES configuration for rev1

It is possible to use the same SERDES configuration as rev2 on
rev1 board. That means both the rev1 and rev2 use the same DTS
now.

Signed-off-by: Kevin Hao <kexin.hao@windriver.com>
---
 arch/powerpc/boot/dts/wrhv_p4080ds.dts |   35 +++++++++++++++++++++----------
 1 files changed, 24 insertions(+), 11 deletions(-)

diff --git a/arch/powerpc/boot/dts/wrhv_p4080ds.dts b/arch/powerpc/boot/dts/wrhv_p4080ds.dts
index c191982..37d7d6a 100644
--- a/arch/powerpc/boot/dts/wrhv_p4080ds.dts
+++ b/arch/powerpc/boot/dts/wrhv_p4080ds.dts
@@ -1283,7 +1283,7 @@
 				fsl,port-handles = <&fman0_rx0 &fman0_tx0>;
 				local-mac-address = [ 00 01 02 03 04 05 ];
 				tbi-handle = <&tbi0>;
-				phy-handle = <&phy0>;
+				phy-handle = <&phydummy>;
 				phy-connection-type = "sgmii";
 			};
 
@@ -1317,6 +1317,7 @@
 					compatible = "fsl,p4080ds-mdio";
 					fsl,mdio-handle = <&mdio0>;
 					fsl,muxval = <1>;
+					status = "disabled";
 
 					phy5: ethernet-phy@1c {
 						reg = <0x1c>;
@@ -1338,7 +1339,6 @@
 					compatible = "fsl,p4080ds-mdio";
 					fsl,mdio-handle = <&mdio0>;
 					fsl,muxval = <2>;
-					status = "disabled";
 
 					phy5slot3: ethernet-phy@1c {
 						reg = <0x1c>;
@@ -1360,6 +1360,11 @@
 					compatible = "fsl,p4080ds-mdio";
 					fsl,mdio-handle = <&mdio0>;
 					fsl,muxval = <3>;
+					status = "disabled";
+
+					phydummy: ethernet-phy@dummy {
+						reg = <0x10>;
+					};
 
 					phy0: ethernet-phy@1c {
 						reg = <0x1c>;
@@ -1383,8 +1388,8 @@
 				fsl,port-handles = <&fman0_rx1 &fman0_tx1>;
 				local-mac-address = [ 00 01 02 03 04 06 ];
 				tbi-handle = <&tbi1>;
-				phy-handle = <&phy1>;
-				phy-connection-type = "sgmii";
+				phy-handle = <&phyrgmii>;
+				phy-connection-type = "rgmii";
 			};
 
 			mdio@e3120 {
@@ -1407,7 +1412,7 @@
 				fsl,port-handles = <&fman0_rx2 &fman0_tx2>;
 				local-mac-address = [ 00 01 02 03 04 07 ];
 				tbi-handle = <&tbi2>;
-				phy-handle = <&phy2>;
+				phy-handle = <&phydummy>;
 				phy-connection-type = "sgmii";
 			};
 
@@ -1431,7 +1436,7 @@
 				fsl,port-handles = <&fman0_rx3 &fman0_tx3>;
 				local-mac-address = [ 00 01 02 03 04 08 ];
 				tbi-handle = <&tbi3>;
-				phy-handle = <&phy3>;
+				phy-handle = <&phydummy>;
 				phy-connection-type = "sgmii";
 			};
 
@@ -1642,8 +1647,8 @@
 				fsl,port-handles = <&fman1_rx0 &fman1_tx0>;
 				local-mac-address = [ 00 01 02 03 04 0a ];
 				tbi-handle = <&tbi5>;
-				phy-handle = <&phyrgmii>;
-				phy-connection-type = "rgmii";
+				phy-handle = <&phy5slot3>;
+				phy-connection-type = "sgmii";
 			};
 			mdio@e1120 {
 				#address-cells = <1>;
@@ -1663,8 +1668,9 @@
 				compatible = "fsl,p4080-fman-1g-mac", "fsl,fman-1g-mac";
 				reg = <0xe2000 0x1000>;
 				fsl,port-handles = <&fman1_rx1 &fman1_tx1>;
+				local-mac-address = [ 00 01 02 03 04 0b ];
 				tbi-handle = <&tbi6>;
-				phy-handle = <&phy6>;
+				phy-handle = <&phy6slot3>;
 				phy-connection-type = "sgmii";
 			};
 
@@ -1686,8 +1692,9 @@
 				compatible = "fsl,p4080-fman-1g-mac", "fsl,fman-1g-mac";
 				reg = <0xe4000 0x1000>;
 				fsl,port-handles = <&fman1_rx2 &fman1_tx2>;
+				local-mac-address = [ 00 01 02 03 04 0c ];
 				tbi-handle = <&tbi7>;
-				phy-handle = <&phy7>;
+				phy-handle = <&phy7slot3>;
 				phy-connection-type = "sgmii";
 			};
 
@@ -1709,8 +1716,9 @@
 				compatible = "fsl,p4080-fman-1g-mac", "fsl,fman-1g-mac";
 				reg = <0xe6000 0x1000>;
 				fsl,port-handles = <&fman1_rx3 &fman1_tx3>;
+				local-mac-address = [ 00 01 02 03 04 0d ];
 				tbi-handle = <&tbi8>;
-				phy-handle = <&phy8>;
+				phy-handle = <&phy8slot3>;
 				phy-connection-type = "sgmii";
 			};
 
@@ -1730,6 +1738,7 @@
 			enet9: ethernet@f0000 {
 				cell-index = <0>;
 				compatible = "fsl,p4080-fman-10g-mac", "fsl,fman-10g-mac";
+				local-mac-address = [ 00 01 02 03 04 0e ];
 				reg = <0xf0000 0x1000>;
 				fsl,port-handles = <&fman1_rx4 &fman1_tx4>;
 				phy-handle = <&phy11>;
@@ -1792,16 +1801,19 @@
 	fsl,dpaa {
 		compatible = "fsl,p4080-dpaa", "fsl,dpaa";
 
+/*
 		ethernet@0 {
 			compatible = "fsl,p4080-dpa-ethernet", "fsl,dpa-ethernet";
 			fsl,qman-channel = <&qpool1>;
 			fsl,fman-mac = <&enet0>;
 		};
+*/
 		ethernet@1 {
 			compatible = "fsl,p4080-dpa-ethernet", "fsl,dpa-ethernet";
 			fsl,qman-channel = <&qpool1>;
 			fsl,fman-mac = <&enet1>;
 		};
+/*
 		ethernet@2 {
 			compatible = "fsl,p4080-dpa-ethernet", "fsl,dpa-ethernet";
 			fsl,qman-channel = <&qpool1>;
@@ -1817,6 +1829,7 @@
 			fsl,qman-channel = <&qportal0>;
 			fsl,fman-mac = <&enet4>;
 		};
+*/
 		ethernet@5 {
 			compatible = "fsl,p4080-dpa-ethernet", "fsl,dpa-ethernet";
 			fsl,qman-channel = <&qportal7>;
-- 
1.6.0.3

