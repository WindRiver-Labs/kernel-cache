From 4b36caaf6b02666c3f4b77da244ff9e12b018550 Mon Sep 17 00:00:00 2001
From: Andrew Liu <shengping.liu@windriver.com>
Date: Wed, 4 Aug 2010 15:02:22 +0800
Subject: [PATCH 17/26] Use idle hcall.

It is from FSL vendor SDK 2.x.

The previous wait idle loop is generalized into a "simple" loop
for power_save callbacks that don't poll and are entered with
interrupts enabled.

This patch is a subset of the kernel-2.6.30-Use-idle-hcall.patch
from FSL's SDK 2.1.

Signed-off-by: Scott Wood <scottwood@freescale.com>
Integrated-by: Andrew Liu <shengping.liu@windriver.com>
---
 arch/powerpc/platforms/85xx/p4080_ds.c |    4 +++-
 1 files changed, 3 insertions(+), 1 deletions(-)

diff --git a/arch/powerpc/platforms/85xx/p4080_ds.c b/arch/powerpc/platforms/85xx/p4080_ds.c
index e6210de..4b8a09b 100644
--- a/arch/powerpc/platforms/85xx/p4080_ds.c
+++ b/arch/powerpc/platforms/85xx/p4080_ds.c
@@ -2,7 +2,7 @@
  * P4080 DS Setup
  *
  * Maintained by Kumar Gala (see MAINTAINERS for contact information)
- * Copyright 2009 Freescale Semiconductor Inc.
+ * Copyright 2009-2010 Freescale Semiconductor Inc.
  *
  * This program is free software; you can redistribute  it and/or modify it
  * under  the terms of  the GNU General  Public License as published by the
@@ -129,6 +129,8 @@ define_machine(p4080_ds) {
 	.calibrate_decr		= generic_calibrate_decr,
 	.progress		= udbg_progress,
 	.init_early		= p4080_init_early,
+	.idle_loop              = cpu_idle_simple,
+	.power_save             = ppc_wait,
 };
 
 machine_device_initcall(p4080_ds, corenet_ds_publish_devices);
-- 
1.6.5.2

