From baf0b52eea80c9ce2f23297f83a7605ca97dfb71 Mon Sep 17 00:00:00 2001
From: Tiejun Chen <tiejun.chen@windriver.com>
Date: Fri, 4 Dec 2009 22:58:35 -0800
Subject: [PATCH 77/77] WRHV/fsl_p4080: Fix some compiling errors.

Fix some compiling errors when building WRHV P4080.

Signed-off-by: Tiejun Chen <tiejun.chen@windriver.com>
---
 arch/powerpc/kernel/head_wrhv.S   |    4 ++++
 arch/powerpc/platforms/85xx/smp.c |    8 ++++++++
 arch/powerpc/sysdev/mpic.c        |    2 ++
 3 files changed, 14 insertions(+), 0 deletions(-)

diff --git a/arch/powerpc/kernel/head_wrhv.S b/arch/powerpc/kernel/head_wrhv.S
index 39cc255..af6006c 100644
--- a/arch/powerpc/kernel/head_wrhv.S
+++ b/arch/powerpc/kernel/head_wrhv.S
@@ -962,8 +962,12 @@ END_FTR_SECTION_IFSET(CPU_FTR_BIG_PHYS)
 	EXCEPTION(0x2040, SPEFloatingPointData, unknown_exception, EXC_XFER_EE)
 #endif /* CONFIG_SPE */
 
+#ifdef CONFIG_SPE
 	/* SPE Floating Point Round */
 	EXCEPTION(0x2050, SPEFloatingPointRound, SPEFloatingPointException_Round, EXC_XFER_EE)
+#else
+	EXCEPTION(0x2050, SPEFloatingPointRound, unknown_exception, EXC_XFER_EE)
+#endif
 
 	/* Performance Monitor */
 	EXCEPTION(0x2060, PerformanceMonitor, performance_monitor_exception, EXC_XFER_STD)
diff --git a/arch/powerpc/platforms/85xx/smp.c b/arch/powerpc/platforms/85xx/smp.c
index 06128ff..58d5f84 100644
--- a/arch/powerpc/platforms/85xx/smp.c
+++ b/arch/powerpc/platforms/85xx/smp.c
@@ -141,7 +141,9 @@ smp_85xx_setup_cpu(int cpu_nr)
 #define DOORBELL_MSG_CRITICAL		(0x08000000)		/* critical priority message */
 
 unsigned long mpc85xx_smp_message[NR_CPUS];
+#ifdef CONFIG_PPC_E500MC
 extern void send_lowpri_doorbell(unsigned int x);
+#endif
 
 static void smp_mpc85xx_message_pass(int target, int msg)
 {
@@ -149,20 +151,26 @@ static void smp_mpc85xx_message_pass(int target, int msg)
 
 	if(target < NR_CPUS) {
 		set_bit(msg, &mpc85xx_smp_message[target]);
+#ifdef CONFIG_PPC_E500MC
 		send_lowpri_doorbell(target);
+#endif
 	}
 	else if(target == MSG_ALL_BUT_SELF) {
 		for_each_online_cpu(i) {
 			if (i == smp_processor_id())
 				continue;
 			set_bit(msg, &mpc85xx_smp_message[i]);
+#ifdef CONFIG_PPC_E500MC
 			send_lowpri_doorbell(i);
+#endif
 		}
 	}
 	else { /* target == MSG_ALL */
 		for_each_online_cpu(i)
 			set_bit(msg, &mpc85xx_smp_message[i]);
+#ifdef CONFIG_PPC_E500MC
 		send_lowpri_doorbell(DOORBELL_MSG_BROADCAST);
+#endif
 	}
 }
 
diff --git a/arch/powerpc/sysdev/mpic.c b/arch/powerpc/sysdev/mpic.c
index a76a928..6083d7d 100644
--- a/arch/powerpc/sysdev/mpic.c
+++ b/arch/powerpc/sysdev/mpic.c
@@ -1178,11 +1178,13 @@ static int mpic_host_match(struct irq_host *h, struct device_node *node)
 	return h->of_node == NULL || h->of_node == node;
 }
 
+#if defined(CONFIG_SMP) || defined(CONFIG_AMP)
 static void __mpic_setup_irqchip(struct mpic *mpic, unsigned int virq)
 {
 	set_irq_chip_data(virq, mpic);
 	set_irq_chip_and_handler(virq, &mpic->hc_ipi, handle_percpu_irq);
 }
+#endif
 
 static int mpic_host_map(struct irq_host *h, unsigned int virq,
 			 irq_hw_number_t hw)
-- 
1.6.5.2

