From d5874d4ef252d2535ad62da9f3b5a665219dcb18 Mon Sep 17 00:00:00 2001
From: Tiejun Chen <tiejun.chen@windriver.com>
Date: Wed, 12 May 2010 14:57:49 +0800
Subject: [PATCH 02/15] WRHV/fsl_p4080: Undefine cpu_setup

We don't need some ivors/cache setup because under the Wind River
hypervisor they aren't used or the conditions cannot occur.

Signed-off-by: Tiejun Chen <tiejun.chen@windriver.com>
---
 arch/powerpc/kernel/cpu_setup_fsl_booke.S |   27 +++++++++++++++++++++++++++
 1 files changed, 27 insertions(+), 0 deletions(-)

diff --git a/arch/powerpc/kernel/cpu_setup_fsl_booke.S b/arch/powerpc/kernel/cpu_setup_fsl_booke.S
index 0adb50a..e40d9b2 100644
--- a/arch/powerpc/kernel/cpu_setup_fsl_booke.S
+++ b/arch/powerpc/kernel/cpu_setup_fsl_booke.S
@@ -17,6 +17,7 @@
 #include <asm/cputable.h>
 #include <asm/ppc_asm.h>
 
+#ifndef CONFIG_WRHV
 _GLOBAL(__e500_icache_setup)
 	mfspr	r0, SPRN_L1CSR1
 	andi.	r3, r0, L1CSR1_ICE
@@ -51,6 +52,32 @@ _GLOBAL(__e500_dcache_setup)
 	isync
 	blr
 
+#else
+/* Only weak for WRHV. */
+	.globl	__e500_icache_setup
+__e500_icache_setup:
+	blr
+
+	.globl	__e500_dcache_setup
+__e500_dcache_setup:
+	blr
+
+	.weak	__setup_e200_ivors
+	.globl	__setup_e200_ivors
+__setup_e200_ivors:
+	blr
+
+	.weak	__setup_e500_ivors
+	.globl	__setup_e500_ivors
+__setup_e500_ivors:
+	blr
+
+	.weak	__setup_e500mc_ivors
+	.globl	__setup_e500mc_ivors
+__setup_e500mc_ivors:
+	blr
+#endif
+
 _GLOBAL(__setup_cpu_e200)
 	/* enable dedicated debug exception handling resources (Debug APU) */
 	mfspr	r3,SPRN_HID0
-- 
1.6.5.2

