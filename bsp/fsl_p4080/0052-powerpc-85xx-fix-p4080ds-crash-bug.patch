From 4b4d61e072ab07dc84002120920f67fc63847458 Mon Sep 17 00:00:00 2001
From: Kevin Hao <kexin.hao@windriver.com>
Date: Tue, 29 Sep 2009 10:37:11 +0800
Subject: [PATCH 52/77] powerpc/85xx: fix p4080ds crash bug

mpc85xx_smp_init is not local but instead implemented in
arch/powerpc/platforms/85xx/smp.c so change the incorrect
local function prototype with the proper extern (as is done in
arch/powerpc/platforms/85xx/mpc85xx_ds.c). Unlike in mpc85xx_ds.c
we want to use smp_mpc85xx_message_pass so we pass 1 for use_msgsnd.

Signed-off-by: Kevin Hao <kexin.hao@windriver.com>
---
 arch/powerpc/platforms/85xx/p4080_ds.c |    4 ++--
 1 files changed, 2 insertions(+), 2 deletions(-)

diff --git a/arch/powerpc/platforms/85xx/p4080_ds.c b/arch/powerpc/platforms/85xx/p4080_ds.c
index 159d2e6..d61de5f 100644
--- a/arch/powerpc/platforms/85xx/p4080_ds.c
+++ b/arch/powerpc/platforms/85xx/p4080_ds.c
@@ -72,7 +72,7 @@ static int primary_phb_addr;
  * Setup the architecture
  */
 #ifdef CONFIG_SMP
-void __init mpc85xx_smp_init(void);
+extern void __init mpc85xx_smp_init(int use_msgsnd, int has_mpic);
 #endif
 static void __init mpc85xx_ds_setup_arch(void)
 {
@@ -84,7 +84,7 @@ static void __init mpc85xx_ds_setup_arch(void)
 		ppc_md.progress("mpc85xx_ds_setup_arch()", 0);
 
 #ifdef CONFIG_SMP
-	mpc85xx_smp_init();
+        mpc85xx_smp_init(1, 1);
 #endif
 
 #ifdef CONFIG_PCI
-- 
1.6.5.2

