From f8ca86d34158a12454c842a469f3dd90cba9a623 Mon Sep 17 00:00:00 2001
From: Shlomi Gridish <gridish@freescale.com>
Date: Mon, 10 Aug 2009 16:20:44 +0300
Subject: [PATCH 027/148] FMD5.3.1 Fixing Bugzilla BUGs #3940, #4006

Signed-off-by: Shlomi Gridish <gridish@freescale.com>
[Cleanly applied the FSL SDK 2.0.3 patch:
"0001-FMD5.3.1.patch"]
Integrated-by: Yuri Nedel <Yuri.Nedel@windriver.com>
---
 .../kernel/2.6/wrappers/Peripherals/FM/lnxwrp_fm.c |    8 +++-----
 1 files changed, 3 insertions(+), 5 deletions(-)

diff --git a/drivers/net/dpa/NetCommSw/user/env/linux/kernel/2.6/wrappers/Peripherals/FM/lnxwrp_fm.c b/drivers/net/dpa/NetCommSw/user/env/linux/kernel/2.6/wrappers/Peripherals/FM/lnxwrp_fm.c
index 07aaf94..dbd24c9 100644
--- a/drivers/net/dpa/NetCommSw/user/env/linux/kernel/2.6/wrappers/Peripherals/FM/lnxwrp_fm.c
+++ b/drivers/net/dpa/NetCommSw/user/env/linux/kernel/2.6/wrappers/Peripherals/FM/lnxwrp_fm.c
@@ -607,10 +607,8 @@ static t_LnxWrpFmDev * ReadFmDevTreeNode (struct of_device *of_dev)
         const phandle       *phandle_prop;
 
         phandle_prop = (typeof(phandle_prop))of_get_property(dpa_node, "fsl,fman-mac", &lenp);
-        if (phandle_prop == NULL) {
-            REPORT_ERROR(MAJOR, E_INVALID_VALUE, ("of_get_property(%s, fsl,fman-mac) failed", dpa_node->full_name));
-            return NULL;
-        }
+        if (phandle_prop == NULL)
+            continue;
 
         BUG_ON(lenp != sizeof(phandle));
 
@@ -625,6 +623,7 @@ static t_LnxWrpFmDev * ReadFmDevTreeNode (struct of_device *of_dev)
             REPORT_ERROR(MAJOR, E_NO_DEVICE, ("of_get_parent() = %d", _errno));
             return NULL;
         }
+        of_node_put(mac_node);
 
         uint32_prop = (uint32_t *)of_get_property(fm_node, "cell-index", &lenp);
         if (unlikely(uint32_prop == NULL)) {
@@ -659,7 +658,6 @@ static t_LnxWrpFmDev * ReadFmDevTreeNode (struct of_device *of_dev)
             break;
         }
 
-        of_node_put(mac_node);
         of_node_put(fm_node);
     }
 
-- 
1.6.5.2

