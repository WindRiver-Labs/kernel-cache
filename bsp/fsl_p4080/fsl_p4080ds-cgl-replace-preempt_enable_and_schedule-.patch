From 224e9ba010f6b1ea5f9a8cc9835892bd03ee3508 Mon Sep 17 00:00:00 2001
From: Tiejun Chen <tiejun.chen@windriver.com>
Date: Fri, 2 Jul 2010 13:05:58 +0800
Subject: [PATCH 6/7] fsl_p4080ds/cgl: replace preempt_enable_and_schedule as the preempt kernel expect

We should use preempt_enable_and_schedule to replace those original implementation,
preempt_enable_no_resched() & schedule() since the function, preempt_enable_no_resched,
was improved to debug missed preemption checks.

Signed-off-by: Tiejun Chen <tiejun.chen@windriver.com>
---
 arch/powerpc/kernel/idle.c |    3 +--
 1 files changed, 1 insertions(+), 2 deletions(-)

diff --git a/arch/powerpc/kernel/idle.c b/arch/powerpc/kernel/idle.c
index e45eaf8..52641fc 100644
--- a/arch/powerpc/kernel/idle.c
+++ b/arch/powerpc/kernel/idle.c
@@ -129,8 +129,7 @@ void cpu_idle_simple(void)
 		if (cpu_should_die())
 			cpu_die();
 
-		preempt_enable_no_resched();
-		schedule();
+		preempt_enable_and_schedule();
 		preempt_disable();
 	}
 }
-- 
1.6.5.2

