From 6c5183aaeb0438f5f52f30ac0a04eae476f3b203 Mon Sep 17 00:00:00 2001
From: Kevin Hao <kexin.hao@windriver.com>
Date: Wed, 8 Sep 2010 01:15:15 -0700
Subject: [PATCH] bman: wake up the process waiting for the bman event

In bman some functions such as wait_rel_start/wait_rel_commit
are put to affini_queue wait queue and wait for a bman event.
But they are not waked up by any function in the current driver,
and will block forever. So wake up these processes in the bman
interrupt handler.

Signed-off-by: Kevin Hao <kexin.hao@windriver.com>
---
 drivers/hwalloc/bman_high.c |    1 +
 1 files changed, 1 insertions(+), 0 deletions(-)

diff --git a/drivers/hwalloc/bman_high.c b/drivers/hwalloc/bman_high.c
index a6e2937..edf0c22 100644
--- a/drivers/hwalloc/bman_high.c
+++ b/drivers/hwalloc/bman_high.c
@@ -323,6 +323,7 @@ static u32 __poll_portal_slow(struct bman_portal *p, struct bm_portal *lowp,
 
 	/* There should be no status register bits left undefined */
 	BM_ASSERT(!is);
+	wake_up_all(&affine_queue);
 	return ret;
 }
 
-- 
1.6.5.2

