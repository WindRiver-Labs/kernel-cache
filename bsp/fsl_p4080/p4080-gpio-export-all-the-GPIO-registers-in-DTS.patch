From 939cbaddd923e2db3052ccb655af2e4bf93e6d37 Mon Sep 17 00:00:00 2001
From: Kevin Hao <kexin.hao@windriver.com>
Date: Tue, 14 Dec 2010 13:51:00 +0800
Subject: [PATCH 1/5] p4080/gpio: export all the GPIO registers in DTS

Currently only part of the GPIO registers are exported via DTS.
And the registers GPDIR and GPODR are missed. But in some cases
we need to access them. So export all the GPIO registers in DTS.
Also adjust the p4080ds mdio driver for this change.

Signed-off-by: Kevin Hao <kexin.hao@windriver.com>
---
 arch/powerpc/boot/dts/p4080ds.dts          |    2 +-
 arch/powerpc/boot/dts/p4080ds_36b.dts      |    2 +-
 arch/powerpc/boot/dts/p4080ds_srio.dts     |    2 +-
 arch/powerpc/boot/dts/wrhv_p4080ds.dts     |    2 +-
 arch/powerpc/platforms/85xx/p4080ds_mdio.c |    4 ++++
 5 files changed, 8 insertions(+), 4 deletions(-)

diff --git a/arch/powerpc/boot/dts/p4080ds.dts b/arch/powerpc/boot/dts/p4080ds.dts
index 9985a17..5655f0c 100644
--- a/arch/powerpc/boot/dts/p4080ds.dts
+++ b/arch/powerpc/boot/dts/p4080ds.dts
@@ -1027,7 +1027,7 @@
 
 		gpio: gpio@130008 {
 			compatible = "fsl,qoriq-gpio";
-			reg = <0x130008 0xff8>;
+			reg = <0x130000 0x1000>;
 		};
 
 		crypto: crypto@300000 {
diff --git a/arch/powerpc/boot/dts/p4080ds_36b.dts b/arch/powerpc/boot/dts/p4080ds_36b.dts
index 04f6398..83a9b5c 100644
--- a/arch/powerpc/boot/dts/p4080ds_36b.dts
+++ b/arch/powerpc/boot/dts/p4080ds_36b.dts
@@ -1031,7 +1031,7 @@
 
 		gpio: gpio@130008 {
 			compatible = "fsl,qoriq-gpio";
-			reg = <0x130008 0xff8>;
+			reg = <0x130000 0x1000>;
 		};
 
 		crypto: crypto@300000 {
diff --git a/arch/powerpc/boot/dts/p4080ds_srio.dts b/arch/powerpc/boot/dts/p4080ds_srio.dts
index beca2da..3a6087b 100644
--- a/arch/powerpc/boot/dts/p4080ds_srio.dts
+++ b/arch/powerpc/boot/dts/p4080ds_srio.dts
@@ -1023,7 +1023,7 @@
 
 		gpio: gpio@130008 {
 			compatible = "fsl,qoriq-gpio";
-			reg = <0x130008 0xff8>;
+			reg = <0x130000 0x1000>;
 		};
 
 		crypto: crypto@300000 {
diff --git a/arch/powerpc/boot/dts/wrhv_p4080ds.dts b/arch/powerpc/boot/dts/wrhv_p4080ds.dts
index 37d7d6a..c2ca9e5 100644
--- a/arch/powerpc/boot/dts/wrhv_p4080ds.dts
+++ b/arch/powerpc/boot/dts/wrhv_p4080ds.dts
@@ -1029,7 +1029,7 @@
 
 		gpio: gpio@130008 {
 			compatible = "fsl,qoriq-gpio";
-			reg = <0x130008 0xff8>;
+			reg = <0x130000 0x1000>;
 		};
 
 		crypto: crypto@300000 {
diff --git a/arch/powerpc/platforms/85xx/p4080ds_mdio.c b/arch/powerpc/platforms/85xx/p4080ds_mdio.c
index fb63334..e789ef2 100644
--- a/arch/powerpc/platforms/85xx/p4080ds_mdio.c
+++ b/arch/powerpc/platforms/85xx/p4080ds_mdio.c
@@ -88,6 +88,8 @@ static int p4080ds_mdio_reset(struct mii_bus *bus)
 }
 
 
+#define GPIO_GPDAT_OFFSET	2
+
 static int p4080ds_mdio_probe(struct of_device *ofdev,
 		const struct of_device_id *match)
 {
@@ -185,6 +187,8 @@ static int p4080ds_mdio_probe(struct of_device *ofdev,
 		goto err_ioremap;
 	}
 
+	priv->gpio_reg += GPIO_GPDAT_OFFSET;
+
 	/* Grab the value to write to the GPIO */
 	val = of_get_property(np, "fsl,muxval", NULL);
 
-- 
1.7.0

