From 910bc7366d89289d948ea4c7c16279b03fbb0b8e Mon Sep 17 00:00:00 2001
From: Jeremy McNicoll <jeremy.mcnicoll@windriver.com>
Date: Fri, 28 Nov 2008 15:05:40 -0500
Subject: [PATCH 10/77] Fix 85xx CPU Hotplug and UBoot CPU address

There is a problem that exists such that when a CPU is offlined
it will not ever finish because the time synchronization is never
completed.

U-Boot has modified the CPU address from a 32bit number to a
64bit number.  This is used with hot-plug when bring CPU's up
or down.

Signed-off-by: Jeremy McNicoll <jeremy.mcnicoll@windriver.com>
---
 arch/powerpc/platforms/85xx/amp.c |    2 +-
 arch/powerpc/platforms/85xx/smp.c |    2 ++
 2 files changed, 3 insertions(+), 1 deletions(-)

diff --git a/arch/powerpc/platforms/85xx/amp.c b/arch/powerpc/platforms/85xx/amp.c
index aa8e191..c5984b0 100755
--- a/arch/powerpc/platforms/85xx/amp.c
+++ b/arch/powerpc/platforms/85xx/amp.c
@@ -40,7 +40,7 @@ extern void __early_start(void);
 static void startcore(char *entryPt, int nr)
 {
 	unsigned long flags;
-	const u32 *cpu_rel_addr;
+	const u64 *cpu_rel_addr;
 	struct device_node *np;
 	__iomem u32 *bptr_vaddr;
 
diff --git a/arch/powerpc/platforms/85xx/smp.c b/arch/powerpc/platforms/85xx/smp.c
index b732b42..06128ff 100644
--- a/arch/powerpc/platforms/85xx/smp.c
+++ b/arch/powerpc/platforms/85xx/smp.c
@@ -175,6 +175,8 @@ struct smp_ops_t smp_85xx_ops = {
 	.cpu_disable = generic_cpu_disable,
 	.cpu_die = generic_cpu_die,
 #endif
+	.take_timebase = smp_generic_take_timebase,
+	.give_timebase = smp_generic_give_timebase,
 };
 
 static int __init smp_dummy_probe(void)
-- 
1.6.5.2

