From 593869df358f7937d1a8febe06ce4f10cb3eddae Mon Sep 17 00:00:00 2001
From: Andrew Liu <shengping.liu@windriver.com>
Date: Thu, 24 Feb 2011 13:35:41 +0800
Subject: [PATCH 3/3] mpc8xxx_gpio: add qoriq-gpio node and its probe code.

Patch taken from FSL vendor SDK 2.2.

In dts, add qoriq gpio node and its reference in mdio node.

Add code to probe qoriq gpio and add it during boot up.

Integrated-by: Andrew Liu <shengping.liu@windriver.com>

[Move chagnes for p4080ds_36b.dts to an independent patch, because
 this file is platform level.]

Integrated-by: Hui Wang <Hui.Wang@windriver.com>
---
 arch/powerpc/boot/dts/p4080ds_36b.dts |   17 ++++++++++++-----
 1 files changed, 12 insertions(+), 5 deletions(-)

diff --git a/arch/powerpc/boot/dts/p4080ds_36b.dts b/arch/powerpc/boot/dts/p4080ds_36b.dts
index d3839c4..703e741 100644
--- a/arch/powerpc/boot/dts/p4080ds_36b.dts
+++ b/arch/powerpc/boot/dts/p4080ds_36b.dts
@@ -753,6 +753,14 @@
 			};
 		};
 
+		gpio0: gpio@130000 {
+			compatible = "fsl,p4080-gpio", "fsl,qoriq-gpio";
+			reg = <0x130000 0x1000>;
+			interrupts = <55 2 0 0>;
+			#gpio-cells = <2>;
+			gpio-controller;
+		};
+
 		usb0: usb@210000 {
 			compatible = "fsl,p4080-usb2-mph",
 					"fsl,mpc85xx-usb2-mph", "fsl-usb2-mph";
@@ -863,11 +871,6 @@
 			clock-frequency = <0>;
 		};
 
-		gpio: gpio@130008 {
-			compatible = "fsl,qoriq-gpio";
-			reg = <0x130000 0x1000>;
-		};
-
 		crypto: crypto@300000 {
 			compatible = "fsl,p4080-sec4.0", "fsl,sec4.0";
 			#address-cells = <1>;
@@ -1122,6 +1125,8 @@
 				compatible = "fsl,fman-mdio";
 				reg = <0xe1120 0xee0>;
 				interrupts = <100 1 0 0>;
+				gpios = <&gpio0 0 0
+					 &gpio0 1 0>;
 
 				tbi0: tbi-phy@8 {
 					reg = <0x8>;
@@ -1288,6 +1293,8 @@
 				compatible = "fsl,fman-xmdio";
 				reg = <0xf1000 0x1000>;
 				interrupts = <100 1 0 0>;
+					gpios = <&gpio0 2 0
+						 &gpio0 3 0>;
 
 				p4080xmdio1: p4080ds-xmdio1 {
 					#address-cells = <1>;
-- 
1.6.5.2

