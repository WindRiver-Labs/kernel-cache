From cfc77323fa6f6e803ee943714749a288f21de9bd Mon Sep 17 00:00:00 2001
From: Tiejun Chen <tiejun.chen@windriver.com>
Date: Wed, 12 May 2010 16:39:48 +0800
Subject: [PATCH] WRHV/fsl_p4080: disable paravirt-pvr for E500mc.

On E500mc the guest OS can access PVR so undefine paravirt-pvr implementation.

Signed-off-by: Tiejun Chen <tiejun.chen@windriver.com>
---
 arch/powerpc/kernel/vbi/wrhv.c |    3 +++
 1 files changed, 3 insertions(+), 0 deletions(-)

diff --git a/arch/powerpc/kernel/vbi/wrhv.c b/arch/powerpc/kernel/vbi/wrhv.c
index 28c3b24..07f1a2b 100644
--- a/arch/powerpc/kernel/vbi/wrhv.c
+++ b/arch/powerpc/kernel/vbi/wrhv.c
@@ -1440,8 +1440,11 @@ void wrhv_init(void)
 	pv_irq_ops.irq_of_parse_and_map =
 			wrhv_irq_of_parse_and_map;
 
+#ifndef CONFIG_PPC85xx_VT_MODE
 	pv_cpu_ops.get_pvr = wrhv_get_pvr;
 	pv_cpu_ops.get_svr = wrhv_get_svr;
+#endif
+
 	pv_cpu_ops.DebugException = wrhv_DebugException;
 	pv_cpu_ops.kgdb_arch_handle_exception =
 		wrhv_kgdb_arch_handle_exception;
-- 
1.6.0.3

