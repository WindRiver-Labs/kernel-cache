From 2266c1c533a46445837c576faa5714e9a78a9543 Mon Sep 17 00:00:00 2001
From: Tiejun Chen <tiejun.chen@windriver.com>
Date: Fri, 2 Jul 2010 16:43:35 +0800
Subject: [PATCH 2/2] fsl_p4080ds/cgl: Don't thread Q/B man irqs.

While bootstrap phase Q/B man have to interact their queues with interrupt mode.
This will be blocked as if those threaded irqs are suspended. So don't thread
Q/B man irqs here with IRQF_NODELAY flag when request their irqs.

Signed-off-by: Tiejun Chen <tiejun.chen@windriver.com>
---
 drivers/hwalloc/bman_high.c |    2 +-
 drivers/hwqueue/qman_high.c |    2 +-
 2 files changed, 2 insertions(+), 2 deletions(-)

diff --git a/drivers/hwalloc/bman_high.c b/drivers/hwalloc/bman_high.c
index a6e2937..b348f84 100644
--- a/drivers/hwalloc/bman_high.c
+++ b/drivers/hwalloc/bman_high.c
@@ -189,7 +189,7 @@ struct bman_portal *bman_create_portal(struct bm_portal *__p,
 	bm_isr_status_clear(portal->p, 0xffffffff);
 #ifdef CONFIG_FSL_BMAN_HAVE_IRQ
 	snprintf(portal->irqname, MAX_IRQNAME, IRQNAME, config->cpu);
-	if (request_irq(config->irq, portal_isr, 0, portal->irqname, portal)) {
+	if (request_irq(config->irq, portal_isr, IRQF_NODELAY, portal->irqname, portal)) {
 		pr_err("request_irq() failed\n");
 		goto fail_irq;
 	}
diff --git a/drivers/hwqueue/qman_high.c b/drivers/hwqueue/qman_high.c
index 83ebf63..be8a34c 100644
--- a/drivers/hwqueue/qman_high.c
+++ b/drivers/hwqueue/qman_high.c
@@ -300,7 +300,7 @@ struct qman_portal *qman_create_portal(struct qm_portal *__p, u32 flags,
 	qm_isr_status_clear(portal->p, 0xffffffff);
 #ifdef CONFIG_FSL_QMAN_HAVE_IRQ
 	snprintf(portal->irqname, MAX_IRQNAME, IRQNAME, config->cpu);
-	if (request_irq(config->irq, portal_isr, 0, portal->irqname, portal)) {
+	if (request_irq(config->irq, portal_isr, IRQF_NODELAY, portal->irqname, portal)) {
 		pr_err("request_irq() failed\n");
 		goto fail_irq;
 	}
-- 
1.6.5.2

