From 2b1ba17ac83741393a8ca8a1f7f254186de9f3ec Mon Sep 17 00:00:00 2001
From: Andy Fleming <afleming@freescale.com>
Date: Wed, 28 Oct 2009 01:12:05 -0500
Subject: [PATCH 078/148] p4080: Add a PHY fixup to make the RGMII PHY use delay

Apparently the p4080ds continues the long tradition of requiring clock
skew on the RX and TX lines in order to work.  Have the board code set
this now, as rgmii-id is deprecated in favor of this approach.

Signed-off-by: Andy Fleming <afleming@freescale.com>
[Applied FSL SDK 2.0.3 patch
"kernel-2.6.30-p4080-Add-a-PHY-fixup-to-make-the-RGMII-PHY-.patch"]
Integrated-by: Yuri Nedel <Yuri.Nedel@windriver.com>
---
 arch/powerpc/platforms/85xx/p4080_ds.c |   11 +++++++++++
 1 files changed, 11 insertions(+), 0 deletions(-)

diff --git a/arch/powerpc/platforms/85xx/p4080_ds.c b/arch/powerpc/platforms/85xx/p4080_ds.c
index 1f373d8..446d5e9 100644
--- a/arch/powerpc/platforms/85xx/p4080_ds.c
+++ b/arch/powerpc/platforms/85xx/p4080_ds.c
@@ -15,6 +15,7 @@
 #include <linux/kdev_t.h>
 #include <linux/delay.h>
 #include <linux/interrupt.h>
+#include <linux/phy.h>
 
 #include <asm/system.h>
 #include <asm/time.h>
@@ -96,6 +97,16 @@ static void __init mpc85xx_ds_setup_arch(void)
 	printk(KERN_INFO "P4080 DS board from Freescale Semiconductor\n");
 }
 
+int vsc824x_add_skew(struct phy_device *phydev);
+#define PHY_ID_VSC8244                  0x000fc6c0
+static int __init board_fixups(void)
+{
+	phy_register_fixup_for_uid(PHY_ID_VSC8244, 0xfffff, vsc824x_add_skew);
+
+	return 0;
+}
+machine_device_initcall(p4080_ds, board_fixups);
+
 static const struct of_device_id of_device_ids[] __devinitconst = {
 	{
 		.compatible	= "simple-bus"
-- 
1.6.5.2

