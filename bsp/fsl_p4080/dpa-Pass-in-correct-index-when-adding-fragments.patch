From 94c5263f3c4b5bd94e6598af267682b41e8fe2f4 Mon Sep 17 00:00:00 2001
From: Andy Fleming <afleming@freescale.com>
Date: Tue, 10 Nov 2009 22:52:55 +0000
Subject: [PATCH] dpa: Pass in correct index when adding fragments

The code was passing in "0" for the index, even though when we are
adding pages, we want to place the fragment in the next available slot.
So we use skb_shinfo(skb)->nr_frags as the index.

Signed-off-by: Andy Fleming <afleming@freescale.com
[Kevin: Original patch taken from Freescale p4080 SDK 2.0.1 ISO
image. Apply cleanly to kernel 2.6.27]
Integrated-by: Kevin Hao <kexin.hao@windriver.com>
---
 drivers/net/dpa/dpa.c |    2 +-
 1 files changed, 1 insertions(+), 1 deletions(-)

diff --git a/drivers/net/dpa/dpa.c b/drivers/net/dpa/dpa.c
index 11b8d85..a4a0675 100644
--- a/drivers/net/dpa/dpa.c
+++ b/drivers/net/dpa/dpa.c
@@ -1302,7 +1302,7 @@ static void __cold dpa_change_rx_flags(struct net_device *net_dev, int flags)
 static void dpa_rx_skb_add_page(struct sk_buff *skb, struct page *page,
 				u32 offset, u32 size)
 {
-	skb_fill_page_desc(skb, 0, page, offset, size);
+	skb_fill_page_desc(skb, skb_shinfo(skb)->nr_frags, page, offset, size);
 
 	skb->len	+= size;
 	skb->data_len	+= size;
-- 
1.6.0.4

