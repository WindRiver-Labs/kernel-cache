From a8bc613c518e64a21c848177ef612b16176b7164 Mon Sep 17 00:00:00 2001
From: Kim Phillips <kim.phillips@freescale.com>
Date: Thu, 1 Oct 2009 21:34:13 +0000
Subject: [PATCH] powerpc: p4080: fix multiple definitions of sim vs. board platform code

following build failure when CONFIG_P4080_SIM and CONFIG_P4080_DS are both
configured:

  LD      arch/powerpc/platforms/85xx/built-in.o
arch/powerpc/platforms/85xx/p4080_ds.o: In function `mpc85xx_ds_pic_init':
/home/r1aaha/git/caam/arch/powerpc/platforms/85xx/p4080_ds.c:33: multiple definition of `mpc85xx_ds_pic_init'
arch/powerpc/platforms/85xx/p4080_sim.o:/home/r1aaha/git/caam/arch/powerpc/platforms/85xx/p4080_sim.c:43: first defined here
make[2]: *** [arch/powerpc/platforms/85xx/built-in.o] Error 1

Signed-off-by: Kim Phillips <kim.phillips@freescale.com>
[Kevin: Original patch taken from Freescale p4080 SDK 2.0 ISO image.
Apply cleanly to kernel 2.6.27]
Integrated-by: Kevin Hao <kexin.hao@windriver.com>
---
 arch/powerpc/platforms/85xx/p4080_sim.c |   18 +++++++++---------
 1 files changed, 9 insertions(+), 9 deletions(-)

diff --git a/arch/powerpc/platforms/85xx/p4080_sim.c b/arch/powerpc/platforms/85xx/p4080_sim.c
index 8f83e72..8783ad1 100644
--- a/arch/powerpc/platforms/85xx/p4080_sim.c
+++ b/arch/powerpc/platforms/85xx/p4080_sim.c
@@ -39,7 +39,7 @@
 #define DBG(fmt, args...)
 #endif
 
-void __init mpc85xx_ds_pic_init(void)
+void __init mpc85xx_sim_pic_init(void)
 {
 	struct mpic *mpic;
 	struct resource r;
@@ -84,14 +84,14 @@ static int primary_phb_addr;
 #ifdef CONFIG_SMP
 extern void __init mpc85xx_smp_init(int use_msgsnd, int has_mpic);
 #endif
-static void __init mpc85xx_ds_setup_arch(void)
+static void __init mpc85xx_sim_setup_arch(void)
 {
 #ifdef CONFIG_PCI
 	struct device_node *np;
 #endif
 
 	if (ppc_md.progress)
-		ppc_md.progress("mpc85xx_ds_setup_arch()", 0);
+		ppc_md.progress("mpc85xx_sim_setup_arch()", 0);
 
 #ifdef CONFIG_SMP
         mpc85xx_smp_init(1, 1);
@@ -130,12 +130,12 @@ static int __init declare_of_platform_devices(void)
 {
 	return of_platform_bus_probe(NULL, of_device_ids, NULL);
 }
-machine_device_initcall(p4080_ds, declare_of_platform_devices);
+machine_device_initcall(p4080_sim, declare_of_platform_devices);
 
 /*
  * Called very early, device-tree isn't unflattened
  */
-static int __init p4080_ds_probe(void)
+static int __init p4080_sim_probe(void)
 {
 	unsigned long root = of_get_flat_dt_root();
 
@@ -170,11 +170,11 @@ static __init void p4080_init_early(void)
 #endif
 }
 
-define_machine(p4080_ds) {
+define_machine(p4080_sim) {
 	.name			= "P4080 SIM",
-	.probe			= p4080_ds_probe,
-	.setup_arch		= mpc85xx_ds_setup_arch,
-	.init_IRQ		= mpc85xx_ds_pic_init,
+	.probe			= p4080_sim_probe,
+	.setup_arch		= mpc85xx_sim_setup_arch,
+	.init_IRQ		= mpc85xx_sim_pic_init,
 #ifdef CONFIG_PCI
 	.pcibios_fixup_bus	= fsl_pcibios_fixup_bus,
 #endif
-- 
1.6.0.4

