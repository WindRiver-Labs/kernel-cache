From 1e0f4ad14dd3751dfbdb72dbd58e9d8c499482ba Mon Sep 17 00:00:00 2001
From: Yongli He <yongli.he@windriver.com>
Date: Thu, 10 Dec 2009 21:35:25 -0800
Subject: [PATCH 1/7] fsl-p4080/smp: disable tlbsync

tlbsync will now execute in the hypervisor, not in the guest.

Signed-off-by: Yongli He <yongli.he@windriver.com>
---
 arch/powerpc/include/asm/ppc_asm.h |    4 ++++
 1 files changed, 4 insertions(+), 0 deletions(-)

diff --git a/arch/powerpc/include/asm/ppc_asm.h b/arch/powerpc/include/asm/ppc_asm.h
index d0c7f33..ae6162d 100644
--- a/arch/powerpc/include/asm/ppc_asm.h
+++ b/arch/powerpc/include/asm/ppc_asm.h
@@ -355,6 +355,9 @@ END_FTR_SECTION_NESTED(CPU_FTR_CELL_TB_BUG, CPU_FTR_CELL_TB_BUG, 96)
 #ifndef CONFIG_SMP
 #define TLBSYNC
 #else /* CONFIG_SMP */
+#ifdef CONFIG_PPC85xx_VT_MODE
+#define TLBSYNC 
+#else /* ! PPC85xx_VT_MODE*/
 /* tlbsync is not implemented on 601 */
 #define TLBSYNC				\
 BEGIN_FTR_SECTION			\
@@ -362,6 +365,7 @@ BEGIN_FTR_SECTION			\
 	sync;				\
 END_FTR_SECTION_IFCLR(CPU_FTR_601)
 #endif
+#endif
 
 	
 /*
-- 
1.6.5.2

