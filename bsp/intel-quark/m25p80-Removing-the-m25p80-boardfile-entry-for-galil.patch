From eb1d59de0ef3efe76b6806f3f57918eab01c8ad1 Mon Sep 17 00:00:00 2001
From: "vasudevan,krishna prasath" <krishna.prasathx.k.vasudevan@intel.com>
Date: Thu, 6 Aug 2015 17:09:58 +0700
Subject: [PATCH 7/8] m25p80:Removing the m25p80 boardfile entry for galileo
 gen1 & gen2 (RTC#116413)

The flash mtd partitions are not exposed to the kernel by BIOS,eventhough m25p80
entries are present in the board file it serves no purpose,hence the m25p80
entries are commented out to disable it,it can be enabled once BIOS is updated
to support mtd partitions.

Signed-off-by: vasudevan,krishna prasath <krishna.prasathx.k.vasudevan@intel.com>
Change-Id: Ib6f98be62be450e2eaa2ce096c8c36d708a94f9f
Reviewed-on: https://git-gar-1.devtools.intel.com/gerrit/6008
Reviewed-by: Fung, Joshua <joshua.fung@intel.com>
Tested-by: Fung, Joshua <joshua.fung@intel.com>
Signed-off-by: Pengyu Ma <pengyu.ma@windriver.com>
---
 .../x86/intel-quark/intel_quark_platform_galileo.c |   20 +++++++++++++++++++-
 .../intel_quark_platform_galileo_gen2.c            |   18 +++++++++++++++++-
 2 files changed, 36 insertions(+), 2 deletions(-)

diff --git a/drivers/platform/x86/intel-quark/intel_quark_platform_galileo.c b/drivers/platform/x86/intel-quark/intel_quark_platform_galileo.c
index 942278b..63f9d04 100644
--- a/drivers/platform/x86/intel-quark/intel_quark_platform_galileo.c
+++ b/drivers/platform/x86/intel-quark/intel_quark_platform_galileo.c
@@ -174,7 +174,14 @@ static struct pxa2xx_spi_chip qrk_ffrd_spi_1_cs_0 = {
 
 #define LPC_SCH_SPI_BUS_ID 0x03
 
-/* TODO: extract this data from layout.conf encoded in flash */
+/**
+ * Eventhough the board file has the entry for m25p80,
+ * the mtd partitions are not exposed by BIOS to the kernel,
+ * hence removing the entry in the board file ,May be useful
+ * in future if BIOS provides the mtd partitions to the kernel
+ */
+
+#if 0
 struct mtd_partition ilb_partitions[] = {
 	{
 		.name		= "grub",
@@ -204,19 +211,30 @@ struct mtd_partition ilb_partitions[] = {
 	},
 };
 
+
+
 static struct flash_platform_data ilb_flash = {
 	.type = "s25fl064k",
 	.parts = ilb_partitions,
 	.nr_parts = ARRAY_SIZE(ilb_partitions),
 };
+#endif
 
 static struct spi_board_info spi_onboard_devs[] = {
+
+/**
+ * Eventhough the board file has the entry for m25p80,
+ * the mtd partitions are not exposed by BIOS to the kernel,
+ * hence disabling the entry in the board file
+ */
+#if 0
 	{
 		.modalias = "m25p80",
 		.platform_data = &ilb_flash,
 		.bus_num = LPC_SCH_SPI_BUS_ID,
 		.chip_select = 0,
 	},
+#endif
 	{
 		.modalias = "ad7298",
 		.max_speed_hz = 5000000,
diff --git a/drivers/platform/x86/intel-quark/intel_quark_platform_galileo_gen2.c b/drivers/platform/x86/intel-quark/intel_quark_platform_galileo_gen2.c
index 3b8ec90..b68b031 100644
--- a/drivers/platform/x86/intel-quark/intel_quark_platform_galileo_gen2.c
+++ b/drivers/platform/x86/intel-quark/intel_quark_platform_galileo_gen2.c
@@ -165,7 +165,15 @@ static struct pxa2xx_spi_chip qrk_ffrd_spi_1_cs_0 = {
 
 #define LPC_SCH_SPI_BUS_ID 0x03
 
-/* TODO: extract this data from layout.conf encoded in flash */
+/**
+ * Eventhough the board file has the entry for m25p80,
+ * the mtd partitions are not exposed by BIOS to the kernel,
+ * hence removing the entry in the board file ,May be useful
+ * in future if BIOS provides the mtd partitions to the kernel
+ */
+
+#if 0
+
 struct mtd_partition galileo_gen2_ilb_partitions[] = {
 	{
 		.name		= "grub",
@@ -200,14 +208,22 @@ static struct flash_platform_data ilb_flash = {
 	.parts = galileo_gen2_ilb_partitions,
 	.nr_parts = ARRAY_SIZE(galileo_gen2_ilb_partitions),
 };
+#endif
 
 static struct spi_board_info spi0_onboard_devs_gen2[] = {
+/**
+ * Eventhough the board file has the entry for m25p80,
+ * the mtd partitions are not exposed by BIOS to the kernel,
+ * hence disabling the entry in the board file
+ */
+#if 0
 	{
 		.modalias = "m25p80",
 		.platform_data = &ilb_flash,
 		.bus_num = LPC_SCH_SPI_BUS_ID,
 		.chip_select = 0,
 	},
+#endif
 	{
 		.modalias = "adc1x8s102",
 		.max_speed_hz = 16667000,
-- 
1.7.5.4

