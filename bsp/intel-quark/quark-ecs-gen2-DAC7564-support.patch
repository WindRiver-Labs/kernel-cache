From 8ba5ea24da15137780b32176073e84f27f3b6483 Mon Sep 17 00:00:00 2001
From: Adrian Bradianu <adrian.bradianu@windriver.com>
Date: Thu, 19 Jun 2014 18:04:38 +0300
Subject: [PATCH] quark: ecs gen2: DAC7564 support

Add support for Texas Instruments DAC7564 quad channel
Digital to Analog Converter.

Signed-off-by: Adrian Bradianu <adrian.bradianu@windriver.com>
---
 .../platform/x86/quark/intel_qrk_plat_ecsgen2.c    |   26 +++++++++++++++++--
 1 files changed, 23 insertions(+), 3 deletions(-)

diff --git a/drivers/platform/x86/quark/intel_qrk_plat_ecsgen2.c b/drivers/platform/x86/quark/intel_qrk_plat_ecsgen2.c
index 3b46e6d..0506580 100644
--- a/drivers/platform/x86/quark/intel_qrk_plat_ecsgen2.c
+++ b/drivers/platform/x86/quark/intel_qrk_plat_ecsgen2.c
@@ -58,6 +58,9 @@
 /* GPIO line Cypress interrupts are routed to (in S3 power state) */
 #define GPIO_CYPRESS_INT_S3		2
 
+/* GPIO line used for LDAC on DAC7564 */
+#define GPIO_DAC7564_LDAC		9
+
 /* Cypress i2c address depending on A0 value */
 #define CYPRESS_ADDR_A0_1		0x20
 #define CYPRESS_ADDR_A0_0		0x21
@@ -203,6 +206,16 @@ static struct at24_platform_data at24_platform_data = {
 };
 
 /******************************************************************************
+ *             Texas Instruments DAC7564 SPI Device Platform Data
+ ******************************************************************************/
+#include "linux/platform_data/dac7564.h"
+
+static struct dac7564_platform_data dac7564_platform_data = {
+	.address = 0,
+	.int_vref = false
+};
+
+/******************************************************************************
  *                        i2c clients
  ******************************************************************************/
 static struct i2c_board_info probed_i2c_cypress_0 = {
@@ -297,11 +310,13 @@ static struct spi_board_info spi_onboard_devs[] = {
 		.controller_data = &qrk_ffrd_spi_0_cs_0,
 	},
 	{
-		.modalias = "spidev",
-		.chip_select = 0,
-		.controller_data = &qrk_ffrd_spi_1_cs_0,
+		.modalias = "dac7564",
 		.max_speed_hz = 50000000,
+		.platform_data = &dac7564_platform_data,
+		.mode = SPI_MODE_2,
 		.bus_num = 1,
+		.chip_select = 0,
+		.controller_data = &qrk_ffrd_spi_1_cs_0,
 	},
 };
 
@@ -326,6 +341,11 @@ static struct gpio reserved_gpios[] = {
 		GPIOF_IN,
 		"cy8c9540a-int-s3",
 	},
+	{
+		GPIO_DAC7564_LDAC,
+		GPIOF_OUT_INIT_LOW,
+		"dac7564-ldac",
+	},
 };
 
 static int eeprom_0_i2c_probe(struct i2c_adapter *adap, unsigned short addr)
-- 
1.7.5.4

