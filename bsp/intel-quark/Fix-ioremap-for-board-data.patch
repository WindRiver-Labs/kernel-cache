From 164e2f8c50153d8c916ec62890a97639b917cbe6 Mon Sep 17 00:00:00 2001
From: Lans Zhang <jia.zhang@windriver.com>
Date: Mon, 5 Jan 2015 16:01:00 +0800
Subject: [PATCH 23/31] Fix ioremap for board data.

The failure of ioremap() -> no cln-plat -> cannot get platform id item
within mfh -> intel_cln_plat_get_id() returns CLANTON_PLAT_UNDEFINED ->
stmmac driver cannot be initialized properly.

To fix this issue from root, be aware of using a proper value of mapped
area determined by the maximum size of MFH and platform data area,
which cannot conflict with other MFH items.

Signed-off-by: Lans Zhang <jia.zhang@windriver.com>
---
 drivers/platform/x86/quark/intel_qrk_board_data.c |    3 ++-
 1 files changed, 2 insertions(+), 1 deletions(-)

diff --git a/drivers/platform/x86/quark/intel_qrk_board_data.c b/drivers/platform/x86/quark/intel_qrk_board_data.c
index d57ca30..d3d09de 100644
--- a/drivers/platform/x86/quark/intel_qrk_board_data.c
+++ b/drivers/platform/x86/quark/intel_qrk_board_data.c
@@ -32,6 +32,7 @@
 #define SPIFLASH_BASEADDR			0xFFF00000
 #define MFH_OFFSET				0x00008000
 #define PLATFORM_DATA_OFFSET			0x00010000
+#define PLATFORM_DATA_SIZE			0x20000
 #define MTD_PART_OFFSET				0x00050000
 #define MTD_PART_LEN				0x00040000
 #define MFH_PADDING				0x1E8
@@ -167,7 +168,7 @@ static int __init intel_qrk_board_data_init_legacy(void)
 	void __iomem * spi_data;
 	int ret = 0;
 
-	spi_data = ioremap(SPIFLASH_BASEADDR, FLASH_SIZE);
+	spi_data = ioremap(SPIFLASH_BASEADDR, PLATFORM_DATA_OFFSET + PLATFORM_DATA_SIZE);
 	if (!spi_data)
 		return -ENODEV;
 
-- 
1.7.5.4

