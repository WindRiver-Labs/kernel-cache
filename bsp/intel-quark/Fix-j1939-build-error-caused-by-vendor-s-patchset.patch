From 78c2e3d5b02d185aca71312d0fa7d9561100d722 Mon Sep 17 00:00:00 2001
From: Lans Zhang <jia.zhang@windriver.com>
Date: Wed, 24 Dec 2014 16:01:48 +0800
Subject: [PATCH 16/31] Fix j1939 build error caused by vendor's patchset.

Fix the following build errors:

expected 'rtnl_doit_func' but argument is of type 'int (*)(struct sk_buff *, struct nlmsghdr *, void *)'

The 3rd parameter is removed since 3.10 kernel.

Signed-off-by: Lans Zhang <jia.zhang@windriver.com>
---
 net/can/af_can.c           |    4 ++--
 net/can/j1939/j1939-priv.h |    4 ++--
 net/can/j1939/rtnl.c       |    4 ++--
 3 files changed, 6 insertions(+), 6 deletions(-)

diff --git a/net/can/af_can.c b/net/can/af_can.c
index 92aa593..7aca738 100644
--- a/net/can/af_can.c
+++ b/net/can/af_can.c
@@ -872,7 +872,7 @@ static struct notifier_block can_netdev_notifier = {
 /*
  * RTNETLINK
  */
-static int can_rtnl_doit(struct sk_buff *skb, struct nlmsghdr *nlh, void *arg)
+static int can_rtnl_doit(struct sk_buff *skb, struct nlmsghdr *nlh)
 {
 	int ret, protocol;
 	const struct can_proto *cp;
@@ -896,7 +896,7 @@ static int can_rtnl_doit(struct sk_buff *skb, struct nlmsghdr *nlh, void *arg)
 		break;
 	}
 	if (fn)
-		ret = fn(skb, nlh, arg);
+		ret = fn(skb, nlh);
 	else
 		ret = -EPROTONOSUPPORT;
 	can_put_proto(cp);
diff --git a/net/can/j1939/j1939-priv.h b/net/can/j1939/j1939-priv.h
index 5adc8bf..b6de553 100644
--- a/net/can/j1939/j1939-priv.h
+++ b/net/can/j1939/j1939-priv.h
@@ -308,8 +308,8 @@ extern void j1939tp_module_exit(void);
 
 /* rtnetlink */
 extern const struct rtnl_af_ops j1939_rtnl_af_ops;
-extern int j1939rtnl_new_addr(struct sk_buff *, struct nlmsghdr *, void *arg);
-extern int j1939rtnl_del_addr(struct sk_buff *, struct nlmsghdr *, void *arg);
+extern int j1939rtnl_new_addr(struct sk_buff *, struct nlmsghdr *);
+extern int j1939rtnl_del_addr(struct sk_buff *, struct nlmsghdr *);
 extern int j1939rtnl_dump_addr(struct sk_buff *, struct netlink_callback *);
 
 #endif /* _J1939_PRIV_H_ */
diff --git a/net/can/j1939/rtnl.c b/net/can/j1939/rtnl.c
index 1e18317..6a9bc43 100644
--- a/net/can/j1939/rtnl.c
+++ b/net/can/j1939/rtnl.c
@@ -26,7 +26,7 @@ static const struct nla_policy j1939_ifa_policy[IFA_J1939_MAX] = {
 	[IFA_J1939_NAME] = { .type = NLA_U64, },
 };
 
-int j1939rtnl_del_addr(struct sk_buff *skb, struct nlmsghdr *nlh, void *arg)
+int j1939rtnl_del_addr(struct sk_buff *skb, struct nlmsghdr *nlh)
 {
 	int ret;
 	struct ifaddrmsg *ifm;
@@ -86,7 +86,7 @@ int j1939rtnl_del_addr(struct sk_buff *skb, struct nlmsghdr *nlh, void *arg)
 	return ret;
 }
 
-int j1939rtnl_new_addr(struct sk_buff *skb, struct nlmsghdr *nlh, void *arg)
+int j1939rtnl_new_addr(struct sk_buff *skb, struct nlmsghdr *nlh)
 {
 	struct ifaddrmsg *ifm;
 	struct j1939_segment *jseg;
-- 
1.7.5.4

