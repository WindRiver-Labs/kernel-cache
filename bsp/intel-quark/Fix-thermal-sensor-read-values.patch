From c18daaa2d07760f42e9c99c5c78d269cc350af84 Mon Sep 17 00:00:00 2001
From: Yury Kylulin <yury.kylulin@intel.com>
Date: Mon, 9 Mar 2015 19:33:49 +0300
Subject: [PATCH] Fix thermal sensor read values

Read only thermal sensor temperature (0-7 bits).

Signed-off-by: Yury Kylulin <yury.kylulin@intel.com>
---
 drivers/platform/x86/quark/intel_qrk_thermal.c |    5 +++++
 1 files changed, 5 insertions(+), 0 deletions(-)

diff --git a/drivers/platform/x86/quark/intel_qrk_thermal.c b/drivers/platform/x86/quark/intel_qrk_thermal.c
index 53a014c..c450a6a 100644
--- a/drivers/platform/x86/quark/intel_qrk_thermal.c
+++ b/drivers/platform/x86/quark/intel_qrk_thermal.c
@@ -123,6 +123,11 @@ static int intel_qrk_thermal_get_temp(struct thermal_zone_device *tz,
 	sb_read(SB_ID_RMU, THRM_CTRL_READ, THRM_TEMP_REG, (u32 *)temp, 1);
 	*temp -= RAW2CELSIUS_DIFF;
 
+	/* Need to apply mask */
+	/* Bits 16-23: Thermal sensor relative temperature */
+	/* Bits 0-7: Thermal sensor temperature */
+	*temp &= 0x000000FF;
+
 	/* Clip to unsigned output value if sensor is reporting sub-zero */
 	if ((int)*temp < 0)
 		*temp = 0;
-- 
1.7.5.4

