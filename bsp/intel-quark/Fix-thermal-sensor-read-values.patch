From f729f60a4cae523b733aa9e7dd1a27ddac05218f Mon Sep 17 00:00:00 2001
From: Yury Kylulin <yury.kylulin@intel.com>
Date: Mon, 9 Mar 2015 19:33:49 +0300
Subject: [PATCH] Fix thermal sensor read values

Read only thermal sensor temperature (0-7 bits).

Signed-off-by: Yury Kylulin <yury.kylulin@intel.com>
---
 drivers/platform/x86/quark/intel_qrk_thermal.c |    6 ++++++
 1 files changed, 6 insertions(+), 0 deletions(-)

diff --git a/drivers/platform/x86/quark/intel_qrk_thermal.c b/drivers/platform/x86/quark/intel_qrk_thermal.c
index 8caec0c..027fdad 100644
--- a/drivers/platform/x86/quark/intel_qrk_thermal.c
+++ b/drivers/platform/x86/quark/intel_qrk_thermal.c
@@ -128,6 +128,12 @@ static int intel_qrk_thermal_get_temp(struct thermal_zone_device *tz,
 				unsigned long *temp)
 {
 	sb_read(SB_ID_THERMAL, THRM_CTRL_READ, THRM_TEMP_REG, (u32 *)temp, 1);
+
+	/* Need to apply mask */
+	/* Bits 16-23: Thermal sensor relative temperature */
+	/* Bits 0-7: Thermal sensor temperature */
+	*temp &= 0x000000FF;
+
 	*temp -= RAW2CELSIUS_DIFF;
 
 	/* Clip to unsigned output value if sensor is reporting sub-zero */
-- 
1.7.5.4

