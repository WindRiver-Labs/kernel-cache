From 6536961468b12fa2c5c53c4902228a75136e4fe8 Mon Sep 17 00:00:00 2001
From: Lans Zhang <jia.zhang@windriver.com>
Date: Tue, 13 Jan 2015 12:13:16 +0800
Subject: [PATCH] Fix the layout of flash partition.

The setting of partition table should align to layout.conf defined by
spi-layout-tools.

Signed-off-by: Lans Zhang <jia.zhang@windriver.com>
---
 .../platform/x86/quark/intel_qrk_plat_galileo.c    |    8 ++++----
 .../x86/quark/intel_qrk_plat_galileo_gen2.c        |   10 +++++-----
 2 files changed, 9 insertions(+), 9 deletions(-)

diff --git a/drivers/platform/x86/quark/intel_qrk_plat_galileo.c b/drivers/platform/x86/quark/intel_qrk_plat_galileo.c
index 3777bc2..df08174 100755
--- a/drivers/platform/x86/quark/intel_qrk_plat_galileo.c
+++ b/drivers/platform/x86/quark/intel_qrk_plat_galileo.c
@@ -180,13 +180,13 @@ static struct pxa2xx_spi_chip qrk_ffrd_spi_1_cs_0 = {
 struct mtd_partition ilb_partitions [] = {
 	{
 		.name		= "grub",
-		.size		= 0x80400,
+		.size		= 0x80000,
 		.offset		= 0,
 	},
 	{
 		.name		= "grub.conf",
-		.size		= 0xA00,
-		.offset		= 0x80400,
+		.size		= 4096,
+		.offset		= 0x4FE000,
 	},
 	{
 		.name		= "layout.conf",
@@ -196,7 +196,7 @@ struct mtd_partition ilb_partitions [] = {
 	{
 		.name		= "sketch",
 		.size		= 0x40000,
-		.offset		= 0x750000,
+		.offset		= 0x100000,
 	},
 	{
 		.name		= "raw",
diff --git a/drivers/platform/x86/quark/intel_qrk_plat_galileo_gen2.c b/drivers/platform/x86/quark/intel_qrk_plat_galileo_gen2.c
index 7c09add..0b3f719 100644
--- a/drivers/platform/x86/quark/intel_qrk_plat_galileo_gen2.c
+++ b/drivers/platform/x86/quark/intel_qrk_plat_galileo_gen2.c
@@ -163,23 +163,23 @@ static struct pxa2xx_spi_chip qrk_ffrd_spi_1_cs_0 = {
 struct mtd_partition galileo_gen2_ilb_partitions[] = {
 	{
 		.name		= "grub",
-		.size		= 4096,
+		.size		= 0x80000,
 		.offset		= 0,
 	},
 	{
 		.name		= "grub.conf",
-		.size		= 0xA00,
-		.offset		= 0x50500,
+		.size		= 4096,
+		.offset		= 0x4FE000,
 	},
 	{
 		.name		= "layout.conf",
 		.size		= 4096,
-		.offset		= 0x708000,
+		.offset		= 0x4FF000,
 	},
 	{
 		.name		= "sketch",
 		.size		= 0x40000,
-		.offset		= 0x750000,
+		.offset		= 0x100000,
 	},
 	{
 		.name		= "raw",
-- 
1.7.5.4

