From a721f87bd2acbd9370c23a02fe4f668056b0ea27 Mon Sep 17 00:00:00 2001
From: Lans Zhang <jia.zhang@windriver.com>
Date: Thu, 10 Oct 2013 10:59:04 +0800
Subject: [PATCH 1185/1187] Fix spi build error.

Signed-off-by: Lans Zhang <jia.zhang@windriver.com>
---
 drivers/spi/spi.c       |   29 +++++++++++++++++++++++++++++
 include/linux/spi/spi.h |    3 +++
 2 files changed, 32 insertions(+), 0 deletions(-)

diff --git a/drivers/spi/spi.c b/drivers/spi/spi.c
index bdfe665..b9ec003 100644
--- a/drivers/spi/spi.c
+++ b/drivers/spi/spi.c
@@ -484,7 +484,11 @@ static void spi_match_master_to_boardinfo(struct spi_master *master,
  * The board info passed can safely be __initdata ... but be careful of
  * any embedded pointers (platform_data, etc), they're copied as-is.
  */
+#ifdef CONFIG_GEN3_SPI
+int
+#else
 int __devinit
+#endif
 spi_register_board_info(struct spi_board_info const *info, unsigned n)
 {
 	struct boardinfo *bi;
@@ -508,6 +512,31 @@ spi_register_board_info(struct spi_board_info const *info, unsigned n)
 	return 0;
 }
 
+#ifdef CONFIG_GEN3_SPI
+EXPORT_SYMBOL_GPL(spi_register_board_info);
+
+int spi_unregister_board_info(struct spi_board_info  *info, unsigned n)
+{
+       struct boardinfo        *bi,*temp;
+    int i;
+
+       for (i = 0; i < n; i++, info++) {
+           mutex_lock(&board_lock);
+           list_for_each_entry_safe(bi, temp, &board_list, list) {
+               if (!memcmp(&bi->board_info, info, sizeof(*info))) {
+                   list_del(&bi->list);
+                   kfree(bi);
+                break;
+               }
+           }
+           mutex_unlock(&board_lock);
+    }    
+       return 0;
+}
+
+EXPORT_SYMBOL_GPL(spi_unregister_board_info);
+#endif
+
 /*-------------------------------------------------------------------------*/
 
 /**
diff --git a/include/linux/spi/spi.h b/include/linux/spi/spi.h
index 96862bf..f0b8d33 100644
--- a/include/linux/spi/spi.h
+++ b/include/linux/spi/spi.h
@@ -820,6 +820,9 @@ struct spi_board_info {
 #ifdef	CONFIG_SPI
 extern int
 spi_register_board_info(struct spi_board_info const *info, unsigned n);
+#ifdef CONFIG_GEN3_SPI
+extern int spi_unregister_board_info(struct spi_board_info *info, unsigned n);
+#endif
 #else
 /* board init code may ignore whether SPI is configured or not */
 static inline int
-- 
1.7.5.4

