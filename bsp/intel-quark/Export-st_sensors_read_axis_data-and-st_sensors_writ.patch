From 8e5a75cdeca82c71a0f9a9b3e5085a7ae2b21f12 Mon Sep 17 00:00:00 2001
From: Lans Zhang <jia.zhang@windriver.com>
Date: Sun, 4 Jan 2015 10:10:21 +0800
Subject: [PATCH 20/31] Export st_sensors_read_axis_data and
 st_sensors_write_data_with_mask.

iio driver lis331dlh introduced by Intel vendor drop 1.1.0-rc2 requires
these functions to be exported to skip st_sensors_set_enable() and reading
new data what sensor core currently provides. These behaviors should be
not allowed but we just keep it here for a temporary solution and change
it then when a formal release fixes this.

Signed-off-by: Lans Zhang <jia.zhang@windriver.com>
---
 drivers/iio/common/st_sensors/st_sensors_core.c |    6 ++++--
 include/linux/iio/common/st_sensors.h           |    6 ++++++
 2 files changed, 10 insertions(+), 2 deletions(-)

diff --git a/drivers/iio/common/st_sensors/st_sensors_core.c b/drivers/iio/common/st_sensors/st_sensors_core.c
index ed9bc8a..7b8a7ab 100644
--- a/drivers/iio/common/st_sensors/st_sensors_core.c
+++ b/drivers/iio/common/st_sensors/st_sensors_core.c
@@ -20,7 +20,7 @@
 
 #define ST_SENSORS_WAI_ADDRESS		0x0f
 
-static int st_sensors_write_data_with_mask(struct iio_dev *indio_dev,
+int st_sensors_write_data_with_mask(struct iio_dev *indio_dev,
 						u8 reg_addr, u8 mask, u8 data)
 {
 	int err;
@@ -37,6 +37,7 @@ static int st_sensors_write_data_with_mask(struct iio_dev *indio_dev,
 st_sensors_write_data_with_mask_error:
 	return err;
 }
+EXPORT_SYMBOL(st_sensors_write_data_with_mask);
 
 static int st_sensors_match_odr(struct st_sensors *sensor,
 			unsigned int odr, struct st_sensor_odr_avl *odr_out)
@@ -272,7 +273,7 @@ st_sensors_match_scale_error:
 }
 EXPORT_SYMBOL(st_sensors_set_fullscale_by_gain);
 
-static int st_sensors_read_axis_data(struct iio_dev *indio_dev,
+int st_sensors_read_axis_data(struct iio_dev *indio_dev,
 							u8 ch_addr, int *data)
 {
 	int err;
@@ -290,6 +291,7 @@ static int st_sensors_read_axis_data(struct iio_dev *indio_dev,
 read_error:
 	return err;
 }
+EXPORT_SYMBOL(st_sensors_read_axis_data);
 
 int st_sensors_read_info_raw(struct iio_dev *indio_dev,
 				struct iio_chan_spec const *ch, int *val)
diff --git a/include/linux/iio/common/st_sensors.h b/include/linux/iio/common/st_sensors.h
index 172c5b2..e68002f 100644
--- a/include/linux/iio/common/st_sensors.h
+++ b/include/linux/iio/common/st_sensors.h
@@ -281,4 +281,10 @@ ssize_t st_sensors_sysfs_sampling_frequency_avail(struct device *dev,
 ssize_t st_sensors_sysfs_scale_avail(struct device *dev,
 				struct device_attribute *attr, char *buf);
 
+int st_sensors_read_axis_data(struct iio_dev *indio_dev,
+			      u8 ch_addr, int *data);
+
+int st_sensors_write_data_with_mask(struct iio_dev *indio_dev,
+					u8 reg_addr, u8 mask, u8 data);
+
 #endif /* ST_SENSORS_H */
-- 
1.7.5.4

