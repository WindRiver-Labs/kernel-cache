From 5f89a9a342ae11df3d1ec742eebb765be966aa93 Mon Sep 17 00:00:00 2001
From: Adrian Hunter <adrian.hunter@intel.com>
Date: Mon, 10 Dec 2012 21:18:48 +0100
Subject: [PATCH 049/129] mmc: sdhci-acpi: enable runtime-pm for device HID
 INT33C6

upstream: e5571397175be315bc6177ba39945dab538793b1

sdhci-acpi supports ACPI devices which have compatibility ID
PNP0D40, however it is not possible to know if those devices
will all work correctly with runtime-pm, so that must be configured
per hardware ID.

For INT33C6, several related quirks, capabilities and flags are set:

	MMC_CAP_NONREMOVABLE
		The SDIO card will never be removable

	SDHCI_ACPI_RUNTIME_PM
		Enable runtime-pm of the host controller

	MMC_CAP_POWER_OFF_CARD
		Enable runtime-pm of the SDIO card

	MMC_PM_KEEP_POWER
		SDIO card has the capability to remain powered up
		during system suspend

	SDHCI_QUIRK2_HOST_OFF_CARD_ON
		Always do a full reset during system resume
		because the card may be already initialized having
		not been powered off.

Wake-ups from the INT33C6 host controller are not supported, so the
following capability must *not* be set:

	MMC_PM_WAKE_SDIO_IRQ
		Enable wake on card interrupt

Signed-off-by: Adrian Hunter <adrian.hunter@intel.com>
Acked-by: Chris Ball <cjb@laptop.org>
Signed-off-by: Rafael J. Wysocki <rafael.j.wysocki@intel.com>
Signed-off-by: fupan li <fupan.li@windriver.com>
---
 drivers/mmc/host/sdhci-acpi.c |    8 ++++++++
 1 files changed, 8 insertions(+), 0 deletions(-)

diff --git a/drivers/mmc/host/sdhci-acpi.c b/drivers/mmc/host/sdhci-acpi.c
index 6ac3617..12b0a78 100644
--- a/drivers/mmc/host/sdhci-acpi.c
+++ b/drivers/mmc/host/sdhci-acpi.c
@@ -87,7 +87,15 @@ static const struct sdhci_ops sdhci_acpi_ops_dflt = {
 	.enable_dma = sdhci_acpi_enable_dma,
 };
 
+static const struct sdhci_acpi_slot sdhci_acpi_slot_int_sdio = {
+	.quirks2 = SDHCI_QUIRK2_HOST_OFF_CARD_ON,
+	.caps    = MMC_CAP_NONREMOVABLE | MMC_CAP_POWER_OFF_CARD,
+	.flags   = SDHCI_ACPI_RUNTIME_PM,
+	.pm_caps = MMC_PM_KEEP_POWER,
+};
+
 static const struct acpi_device_id sdhci_acpi_ids[] = {
+	{ "INT33C6", (kernel_ulong_t)&sdhci_acpi_slot_int_sdio },
 	{ "PNP0D40" },
 	{ },
 };
-- 
1.7.5.4

