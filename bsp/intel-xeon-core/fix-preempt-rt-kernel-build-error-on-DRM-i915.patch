From 3479c17274a8cd5480a62a89ca2d247fa2b8a198 Mon Sep 17 00:00:00 2001
From: fupan li <fupan.li@windriver.com>
Date: Mon, 3 Jun 2013 11:18:14 +0800
Subject: [PATCH] fix preempt-rt kernel build error on DRM/i915

preempt-rt kernel will build failed on
DRM/i915 as below:

drivers/gpu/drm/i915/i915_gem.c: In function 'mutex_is_locked_by':
drivers/gpu/drm/i915/i915_gem.c:4370:14: error: 'struct mutex' has no member named 'owner'.
For more information about this bug/fix, please refer
http://www.spinics.net/lists/linux-rt-users/msg09598.html

Signed-off-by: fupan li <fupan.li@windriver.com>
---
 drivers/gpu/drm/i915/i915_gem.c |    4 ++++
 1 files changed, 4 insertions(+), 0 deletions(-)

diff --git a/drivers/gpu/drm/i915/i915_gem.c b/drivers/gpu/drm/i915/i915_gem.c
index 3b9d18b..917be60 100644
--- a/drivers/gpu/drm/i915/i915_gem.c
+++ b/drivers/gpu/drm/i915/i915_gem.c
@@ -4385,7 +4385,11 @@ static bool mutex_is_locked_by(struct mutex *mutex, struct task_struct *task)
 		return false;
 
 #if defined(CONFIG_SMP) || defined(CONFIG_DEBUG_MUTEXES)
+#ifdef CONFIG_PREEMPT_RT_FULL
+	return mutex->lock.owner == task;
+#else
 	return mutex->owner == task;
+#endif
 #else
 	/* Since UP may be pre-empted, we cannot assume that we own the lock */
 	return false;
-- 
1.7.5.4

