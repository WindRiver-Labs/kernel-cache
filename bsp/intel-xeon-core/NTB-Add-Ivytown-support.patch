From a9f0e64ff8215cdee2682329ae8fc175ec81c7c0 Mon Sep 17 00:00:00 2001
From: Jon Mason <jon.mason@intel.com>
Date: Fri, 28 Sep 2012 11:38:48 -0700
Subject: [PATCH 37/70] NTB: Add Ivytown support

This patch is provided by dave.jiang@intel.com via e-mail, and not
committed to mainline yet.

Since Ivytown NTB is the same as Jaketown, all that is necessary for
support is adding the Device ID.

Signed-off-by: Jon Mason <jon.mason@intel.com>
Signed-off-by: Yunguo Wei <yunguo.wei@windriver.com>
---
 drivers/ntb/ntb_hw.c |    2 ++
 drivers/ntb/ntb_hw.h |    1 +
 2 files changed, 3 insertions(+), 0 deletions(-)

diff --git a/drivers/ntb/ntb_hw.c b/drivers/ntb/ntb_hw.c
index ad0a066..46b4439 100644
--- a/drivers/ntb/ntb_hw.c
+++ b/drivers/ntb/ntb_hw.c
@@ -86,6 +86,7 @@ enum {
 #define MW_TO_BAR(mw)	(mw * 2 + 2)
 
 static DEFINE_PCI_DEVICE_TABLE(ntb_pci_tbl) = {
+	{PCI_VDEVICE(INTEL, PCI_DEVICE_ID_INTEL_NTB_B2B_IVT)},
 	{PCI_VDEVICE(INTEL, PCI_DEVICE_ID_INTEL_NTB_B2B_BWD)},
 	{PCI_VDEVICE(INTEL, PCI_DEVICE_ID_INTEL_NTB_B2B_JSF)},
 	{PCI_VDEVICE(INTEL, PCI_DEVICE_ID_INTEL_NTB_CLASSIC_JSF)},
@@ -767,6 +768,7 @@ static int ntb_device_setup(struct ntb_device *ndev)
 	case PCI_DEVICE_ID_INTEL_NTB_CLASSIC_SNB:
 	case PCI_DEVICE_ID_INTEL_NTB_B2B_JSF:
 	case PCI_DEVICE_ID_INTEL_NTB_B2B_SNB:
+	case PCI_DEVICE_ID_INTEL_NTB_B2B_IVT:
 		rc = ntb_xeon_setup(ndev);
 		break;
 	case PCI_DEVICE_ID_INTEL_NTB_B2B_BWD:
diff --git a/drivers/ntb/ntb_hw.h b/drivers/ntb/ntb_hw.h
index 30b25b6..119175c 100644
--- a/drivers/ntb/ntb_hw.h
+++ b/drivers/ntb/ntb_hw.h
@@ -54,6 +54,7 @@
 #define PCI_DEVICE_ID_INTEL_NTB_CLASSIC_SNB	0x3C0E
 #define PCI_DEVICE_ID_INTEL_NTB_2ND_SNB		0x3C0F
 #define PCI_DEVICE_ID_INTEL_NTB_B2B_BWD		0x0C4E
+#define PCI_DEVICE_ID_INTEL_NTB_B2B_IVT		0x0E0D
 
 #define msix_table_size(control)	((control & PCI_MSIX_FLAGS_QSIZE)+1)
 
-- 
1.7.5.4

