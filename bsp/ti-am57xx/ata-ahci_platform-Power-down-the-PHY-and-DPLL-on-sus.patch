From f2731a2c8ae74f53d5b2c57b6abc741a89ff9067 Mon Sep 17 00:00:00 2001
From: Roger Quadros <rogerq@ti.com>
Date: Tue, 21 Jan 2014 15:31:53 +0200
Subject: [PATCH 038/263] ata: ahci_platform: Power down the PHY and DPLL on
 suspend

This commit comes from branch ti-linux-3.12.y:
  git://git.ti.com/ti-linux-kernel/ti-linux-kernel.git

To save power on system suspend power down the SATA PHY and
DPLL by calling phy_power_off() and phy_exit() respectively.

Do the reverse in resume to get SATA back to life.

Signed-off-by: Roger Quadros <rogerq@ti.com>
(cherry picked from commit db764522dbd373fb1106315e29b74b58a1842081)
Signed-off-by: Zumeng Chen <zumeng.chen@windriver.com>
---
 drivers/ata/ahci_platform.c |   10 ++++++++++
 1 files changed, 10 insertions(+), 0 deletions(-)

diff --git a/drivers/ata/ahci_platform.c b/drivers/ata/ahci_platform.c
index b3d4835..7530505 100644
--- a/drivers/ata/ahci_platform.c
+++ b/drivers/ata/ahci_platform.c
@@ -304,6 +304,11 @@ static int ahci_suspend(struct device *dev)
 	if (pdata && pdata->suspend)
 		return pdata->suspend(dev);
 
+	if (!IS_ERR(hpriv->phy)) {
+		phy_power_off(hpriv->phy);
+		phy_exit(hpriv->phy);
+	}
+
 	if (!IS_ERR(hpriv->clk))
 		clk_disable_unprepare(hpriv->clk);
 
@@ -325,6 +330,11 @@ static int ahci_resume(struct device *dev)
 		}
 	}
 
+	if (!IS_ERR(hpriv->phy)) {
+		phy_init(hpriv->phy);
+		phy_power_on(hpriv->phy);
+	}
+
 	if (pdata && pdata->resume) {
 		rc = pdata->resume(dev);
 		if (rc)
-- 
1.7.5.4

