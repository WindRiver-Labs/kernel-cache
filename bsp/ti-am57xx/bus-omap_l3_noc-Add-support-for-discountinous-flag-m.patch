From 5ce19ef26c9aeda9582905cb4dd90551d8520d2b Mon Sep 17 00:00:00 2001
From: Rajendra Nayak <rnayak@ti.com>
Date: Thu, 14 Nov 2013 18:29:57 +0530
Subject: [PATCH 043/263] bus: omap_l3_noc: Add support for discountinous flag
 mux input numbers

This commit comes from branch ti-linux-3.12.y:
  git://git.ti.com/ti-linux-kernel/ti-linux-kernel.git

On DRA7, unlike on OMAP4 and OMAP5, the flag mux input numbers used to indicate
the source of errors are not continous. Have a way in the driver to catch these
and WARN the user of the flag mux input thats either undocumented or wrong.

Signed-off-by: Rajendra Nayak <rnayak@ti.com>
(cherry picked from commit e6bf566352cc73ad38df9358032ada79f04136b6)
Signed-off-by: Zumeng Chen <zumeng.chen@windriver.com>
---
 drivers/bus/omap_l3_noc.c |    6 ++++++
 1 files changed, 6 insertions(+), 0 deletions(-)

diff --git a/drivers/bus/omap_l3_noc.c b/drivers/bus/omap_l3_noc.c
index 32fac96..3ec8b7b 100644
--- a/drivers/bus/omap_l3_noc.c
+++ b/drivers/bus/omap_l3_noc.c
@@ -82,6 +82,12 @@ static irqreturn_t l3_interrupt_handler(int irq, void *_l3)
 			/* Identify the source from control status register */
 			err_src = __ffs(err_reg);
 
+			if (*(l3->l3_targets[i] + err_src) == 0xdeadbeef) {
+				WARN(true, "L3 error for UN IDENTIFIED TARGET: %d\n",
+				     err_src);
+				break;
+			}
+
 			/* Read the stderrlog_main_source from clk domain */
 			l3_targ_base = base + *(l3->l3_targets[i] + err_src);
 			std_err_main =  __raw_readl(l3_targ_base +
-- 
1.7.5.4

