From f2177e97d9d8d8395b4cf58f4d12a82e21a82131 Mon Sep 17 00:00:00 2001
From: Zumeng Chen <zumeng.chen@windriver.com>
Date: Mon, 14 Jul 2014 12:41:21 +0800
Subject: [PATCH 257/263] arm: dra7: fix mask bit error for reboot

According to the original prm-regbits-7xx.h, rstst sw reset
bit should be shown like in this file, so fix it to reboot
well.

Signed-off-by: Zumeng Chen <zumeng.chen@windriver.com>
---
 arch/arm/mach-omap2/prminst44xx.c |    6 +++++-
 1 files changed, 5 insertions(+), 1 deletions(-)

diff --git a/arch/arm/mach-omap2/prminst44xx.c b/arch/arm/mach-omap2/prminst44xx.c
index 5fb9bfa..7827aec 100644
--- a/arch/arm/mach-omap2/prminst44xx.c
+++ b/arch/arm/mach-omap2/prminst44xx.c
@@ -27,6 +27,7 @@
 #include "prcm44xx.h"
 #include "prcm_mpu44xx.h"
 #include "soc.h"
+#include "prm-regbits-7xx.h"
 
 static void __iomem *_prm_bases[OMAP4_MAX_PRCM_PARTITIONS];
 
@@ -181,7 +182,10 @@ void omap4_prminst_global_warm_sw_reset(void)
 
 	v = omap4_prminst_read_inst_reg(OMAP4430_PRM_PARTITION, dev_inst,
 					OMAP4_PRM_RSTCTRL_OFFSET);
-	v |= OMAP4430_RST_GLOBAL_WARM_SW_MASK;
+	if (soc_is_dra7xx())
+		v |= DRA7XX_GLOBAL_WARM_SW_RST_MASK;
+	else
+		v |= OMAP4430_RST_GLOBAL_WARM_SW_MASK;
 	omap4_prminst_write_inst_reg(v, OMAP4430_PRM_PARTITION, dev_inst,
 				 OMAP4_PRM_RSTCTRL_OFFSET);
 
-- 
1.7.5.4

