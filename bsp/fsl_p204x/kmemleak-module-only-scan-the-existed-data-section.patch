From 7730fb75c06d0279aae608f69447d1940b899fee Mon Sep 17 00:00:00 2001
From: Tiejun Chen <tiejun.chen@windriver.com>
Date: Wed, 21 Dec 2011 10:01:16 +0800
Subject: [PATCH 16/35] kmemleak/module: only scan the existed data section

We should only scan the sections containing data and it's size is not
zero as well.

Signed-off-by: Tiejun Chen <tiejun.chen@windriver.com>
---
 kernel/module.c |    2 ++
 1 file changed, 2 insertions(+)

diff --git a/kernel/module.c b/kernel/module.c
index 13170d5..9c6e7fb 100644
--- a/kernel/module.c
+++ b/kernel/module.c
@@ -2018,6 +2018,8 @@ static void kmemleak_load_module(struct module *mod, Elf_Ehdr *hdr,
 		if (strncmp(secstrings + sechdrs[i].sh_name, ".data", 5) != 0
 		    && strncmp(secstrings + sechdrs[i].sh_name, ".bss", 4) != 0)
 			continue;
+		if (sechdrs[i].sh_size == 0)
+			continue;
 
 		kmemleak_scan_area((void *)sechdrs[i].sh_addr,
 				   sechdrs[i].sh_size, GFP_KERNEL);
-- 
1.7.9.7

