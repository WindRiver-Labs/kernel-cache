From c545a0f266c1c81efd014b82f1fd4a061cbf2533 Mon Sep 17 00:00:00 2001
From: Zhong Hongbo <hongbo.zhong@windriver.com>
Date: Wed, 4 May 2011 13:01:13 +0800
Subject: [PATCH 5/9] imx25pdk/smsc911x: add imx cpld spi register access

On fsl imx25 pdk, smsc911x phy is controled by CPLD connected
on SPI bus, so add specifc register read/write methods to access it.

[Original code taken from L2.6.31_09.12.01_SDK.tar.gz BSP package:
http://www.freescale.com/webapp/sps/site/prod_summary.jsp?code=
IMX25PDK&fpsp=1&tab=Design_Tools_Tab]

Signed-off-by: Zhong Hongbo <hongbo.zhong@windriver.com>
---
 drivers/net/smsc911x.c |    8 ++++++++
 1 files changed, 8 insertions(+), 0 deletions(-)

diff --git a/drivers/net/smsc911x.c b/drivers/net/smsc911x.c
index 4ec480a..2d85228 100644
--- a/drivers/net/smsc911x.c
+++ b/drivers/net/smsc911x.c
@@ -122,6 +122,10 @@ static inline u32 __smsc911x_reg_read(struct smsc911x_data *pdata, u32 reg)
 	if (pdata->config.flags & SMSC911X_USE_32BIT)
 		return readl(pdata->ioaddr + reg);
 
+#ifdef CONFIG_ARCH_MX25
+	return spi_cpld_read(reg);
+#endif
+
 	if (pdata->config.flags & SMSC911X_USE_16BIT)
 		return ((readw(pdata->ioaddr + reg) & 0xFFFF) |
 			((readw(pdata->ioaddr + reg + 2) & 0xFFFF) << 16));
@@ -150,6 +154,10 @@ static inline void __smsc911x_reg_write(struct smsc911x_data *pdata, u32 reg,
 		return;
 	}
 
+#ifdef CONFIG_ARCH_MX25
+	spi_cpld_write(reg, val);
+#endif
+
 	if (pdata->config.flags & SMSC911X_USE_16BIT) {
 		writew(val & 0xFFFF, pdata->ioaddr + reg);
 		writew((val >> 16) & 0xFFFF, pdata->ioaddr + reg + 2);
-- 
1.7.0.4

