From 8d683a3bffaa36e25dbdf124785f0ab6dc18f134 Mon Sep 17 00:00:00 2001
From: "Hebbar, Gururaja" <gururaja.hebbar@ti.com>
Date: Thu, 3 May 2012 15:26:11 +0530
Subject: [PATCH 221/609] ARM: OMAP2+: am335x: Add MMC0 support for EVM-SK

Original commit: d367fe5185d1c4630e483097e123b0d32cedc2b4

  From git://arago-project.org/git/projects/linux-am33x.git
  And ti-sdk-am335x-evm-05.05.00.00-Linux-x86-Install image

This patch adds initial MMC0 support for EVM-SK board.
Since this Board has Micro-SD slot, write-protect detection is disabled.

Signed-off-by: Hebbar, Gururaja <gururaja.hebbar@ti.com>
---
 arch/arm/mach-omap2/board-am335xevm.c |    5 +++++
 1 files changed, 5 insertions(+), 0 deletions(-)

diff --git a/arch/arm/mach-omap2/board-am335xevm.c b/arch/arm/mach-omap2/board-am335xevm.c
index 7510b13..68925be 100644
--- a/arch/arm/mach-omap2/board-am335xevm.c
+++ b/arch/arm/mach-omap2/board-am335xevm.c
@@ -1531,6 +1531,7 @@ static void mmc0_init(int evm_id, int profile)
 	switch (evm_id) {
 	case BEAGLE_BONE_A3:
 	case BEAGLE_BONE_OLD:
+	case EVM_SK:
 		setup_pin_mux(mmc0_common_pin_mux);
 		setup_pin_mux(mmc0_cd_only_pin_mux);
 		break;
@@ -1713,6 +1714,7 @@ static struct evm_dev_cfg beaglebone_dev_cfg[] = {
 
 /* EVM - Starter Kit */
 static struct evm_dev_cfg evm_sk_dev_cfg[] = {
+	{mmc0_init,	DEV_ON_BASEBOARD, PROFILE_ALL},
 	{NULL, 0, 0},
 };
 
@@ -1797,6 +1799,9 @@ static void setup_starterkit(void)
 {
 	pr_info("The board is a AM335x Starter Kit.\n");
 
+	/* Starter Kit has Micro-SD slot which doesn't have Write Protect pin */
+	am335x_mmc[0].gpio_wp = -EINVAL;
+
 	_configure_device(EVM_SK, evm_sk_dev_cfg, PROFILE_NONE);
 }
 
-- 
1.7.5.4

