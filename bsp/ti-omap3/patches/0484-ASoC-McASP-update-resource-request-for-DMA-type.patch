From b0b40db71767cdd14bd29e0472c7560978e3007c Mon Sep 17 00:00:00 2001
From: "Hebbar, Gururaja" <gururaja.hebbar@ti.com>
Date: Tue, 28 Feb 2012 15:04:50 +0530
Subject: [PATCH 484/609] ASoC: McASP: update resource request for DMA type

Original commit: 95d60f4b17ce41dcb6355cc9e46c294b0a48ba58

  From git://arago-project.org/git/projects/linux-am33x.git
  And ti-sdk-am335x-evm-05.05.00.00-Linux-x86-Install image

McASP device registration now uses omap_device api. This method
doesn't declare resource in order. Hence this patch replaces
platform_get_resource() with platform_get_resource_byname()

Signed-off-by: Hebbar, Gururaja <gururaja.hebbar@ti.com>
---
 sound/soc/davinci/davinci-mcasp.c |   14 +++++++++++---
 1 files changed, 11 insertions(+), 3 deletions(-)

diff --git a/sound/soc/davinci/davinci-mcasp.c b/sound/soc/davinci/davinci-mcasp.c
index 6aa42dc..6004f9f 100644
--- a/sound/soc/davinci/davinci-mcasp.c
+++ b/sound/soc/davinci/davinci-mcasp.c
@@ -969,8 +969,12 @@ static int davinci_mcasp_probe(struct platform_device *pdev)
 		dma_data->dma_addr = (dma_addr_t) (pdata->tx_dma_offset +
 							mem->start);
 
-	/* first TX, then RX */
-	res = platform_get_resource(pdev, IORESOURCE_DMA, 0);
+	if (dev->version == MCASP_VERSION_3)
+		res = platform_get_resource_byname(pdev, IORESOURCE_DMA, "tx");
+	else
+		/* first TX, then RX */
+		res = platform_get_resource(pdev, IORESOURCE_DMA, 0);
+
 	if (!res) {
 		dev_err(&pdev->dev, "no DMA resource\n");
 		ret = -ENODEV;
@@ -989,7 +993,11 @@ static int davinci_mcasp_probe(struct platform_device *pdev)
 		dma_data->dma_addr = (dma_addr_t)(pdata->rx_dma_offset +
 							mem->start);
 
-	res = platform_get_resource(pdev, IORESOURCE_DMA, 1);
+	if (dev->version == MCASP_VERSION_3)
+		res = platform_get_resource_byname(pdev, IORESOURCE_DMA, "rx");
+	else
+		res = platform_get_resource(pdev, IORESOURCE_DMA, 1);
+
 	if (!res) {
 		dev_err(&pdev->dev, "no DMA resource\n");
 		ret = -ENODEV;
-- 
1.7.5.4

