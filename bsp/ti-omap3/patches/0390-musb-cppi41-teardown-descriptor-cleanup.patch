From cf7163f7f0758a52bf880b550e150f246fbaa97d Mon Sep 17 00:00:00 2001
From: Ajay Kumar Gupta <ajay.gupta@ti.com>
Date: Tue, 1 Feb 2011 16:58:07 +0530
Subject: [PATCH 390/609] musb: cppi41: teardown descriptor cleanup

Original commit: 4f512f7078beaa2462eb04b4878057d657a634fc

  From git://arago-project.org/git/projects/linux-am33x.git
  And ti-sdk-am335x-evm-05.05.00.00-Linux-x86-Install image

Signed-off-by: Vaibhav Hiremath <hvaibhav@ti.com>
---
 drivers/usb/musb/cppi41_dma.c |    2 +-
 1 files changed, 1 insertions(+), 1 deletions(-)

diff --git a/drivers/usb/musb/cppi41_dma.c b/drivers/usb/musb/cppi41_dma.c
index a0abca5..6d3ae73 100644
--- a/drivers/usb/musb/cppi41_dma.c
+++ b/drivers/usb/musb/cppi41_dma.c
@@ -988,7 +988,7 @@ static void usb_rx_ch_teardown(struct cppi41_channel *rx_ch)
 			pd_addr = cppi41_queue_pop(&cppi->queue_obj);
 		} while (!pd_addr && timeout--);
 
-		if (timeout <= 0) {
+		if (timeout <= 0 || !pd_addr) {
 			ERR("teardown Desc not found\n");
 			break;
 		}
-- 
1.7.5.4

