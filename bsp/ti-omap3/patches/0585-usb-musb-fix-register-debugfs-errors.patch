From cb399259c9f5e120be72caceb666e965890940b8 Mon Sep 17 00:00:00 2001
From: Zumeng Chen <zumeng.chen@windriver.com>
Date: Thu, 30 Aug 2012 23:11:03 +0800
Subject: [PATCH 585/609] usb: musb: fix register debugfs errors

when multi-controllers exist, musb_init_debugfs will be failure
because the same dir can't be created.

Signed-off-by: Zumeng Chen <zumeng.chen@windriver.com>
---
 drivers/usb/musb/musb_debugfs.c |    2 +-
 drivers/usb/musb/musb_virthub.c |    2 --
 drivers/usb/otg/nop-usb-xceiv.c |    2 +-
 3 files changed, 2 insertions(+), 4 deletions(-)

diff --git a/drivers/usb/musb/musb_debugfs.c b/drivers/usb/musb/musb_debugfs.c
index 40a37c9..e162784 100644
--- a/drivers/usb/musb/musb_debugfs.c
+++ b/drivers/usb/musb/musb_debugfs.c
@@ -241,7 +241,7 @@ int __devinit musb_init_debugfs(struct musb *musb)
 	struct dentry		*file;
 	int			ret;
 
-	root = debugfs_create_dir("musb", NULL);
+	root = debugfs_create_dir(dev_name(musb->controller), NULL);
 	if (!root) {
 		ret = -ENOMEM;
 		goto err0;
diff --git a/drivers/usb/musb/musb_virthub.c b/drivers/usb/musb/musb_virthub.c
index 95b3b2f..c6be95a 100644
--- a/drivers/usb/musb/musb_virthub.c
+++ b/drivers/usb/musb/musb_virthub.c
@@ -178,8 +178,6 @@ static void musb_port_reset(struct musb *musb, bool do_reset)
 
 void musb_root_disconnect(struct musb *musb)
 {
-	struct usb_otg	*otg = musb->xceiv->otg;
-
 	musb->port1_status = USB_PORT_STAT_POWER
 			| (USB_PORT_STAT_C_CONNECTION << 16);
 
diff --git a/drivers/usb/otg/nop-usb-xceiv.c b/drivers/usb/otg/nop-usb-xceiv.c
index c4dfa11..3956c16 100644
--- a/drivers/usb/otg/nop-usb-xceiv.c
+++ b/drivers/usb/otg/nop-usb-xceiv.c
@@ -141,7 +141,7 @@ static int __devexit nop_usb_xceiv_remove(struct platform_device *pdev)
 	struct nop_usb_xceiv *nop = platform_get_drvdata(pdev);
 
 	/*TI introduces this multi-id, but it's safe for this operation */
-	otg_reset_transceiver(&nop->phy.otg);
+	otg_reset_transceiver(&nop->phy);
 
 	platform_set_drvdata(pdev, NULL);
 	kfree(nop->phy.otg);
-- 
1.7.5.4

