From 55676a2deeba77067d4dd98eb030f7357807d8f9 Mon Sep 17 00:00:00 2001
From: Ming Lei <tom.leiming@gmail.com>
Date: Thu, 23 Dec 2010 23:13:39 +0800
Subject: [PATCH 328/609] usb: musb: support to compile hw glue layer driver
 as module

Original commit: 5ceca9986c95f71c54f3f62f3b5d15c668ac7f24

  From git://arago-project.org/git/projects/linux-am33x.git
  And ti-sdk-am335x-evm-05.05.00.00-Linux-x86-Install image

Obviously hw glue layer driver should be compiled as module,
which can help to build one single image to support multiple machines.

also merged
usb: musb: allow all hw glue modules built into one single image

This patch allows all hw glue drivers to be built into one single
image, so that we can support one single image to be run in multiple
machines.

Signed-off-by: Ming Lei <tom.leiming@gmail.com>
Signed-off-by: Felipe Balbi <balbi@ti.com>
Signed-off-by: Ajay Kumar Gupta <ajay.gupta@ti.com>
Signed-off-by: Sriramakrishnan A G <srk@ti.com>
Signed-off-by: Vaibhav Hiremath <hvaibhav@ti.com>
---
 drivers/usb/musb/Kconfig  |   59 ++++++++++++++++++++++++++++++++------------
 drivers/usb/musb/Makefile |   14 +++++-----
 2 files changed, 50 insertions(+), 23 deletions(-)

diff --git a/drivers/usb/musb/Kconfig b/drivers/usb/musb/Kconfig
index f70cab3..7724c6b 100644
--- a/drivers/usb/musb/Kconfig
+++ b/drivers/usb/musb/Kconfig
@@ -32,37 +32,64 @@ config USB_MUSB_HDRC
 
 if USB_MUSB_HDRC
 
-choice
-	prompt "Platform Glue Layer"
+comment "Platform Glue Layer"
 
-config USB_MUSB_DAVINCI
+config USB_MUSB_DAVINCI_GLUE
+	select USB_MUSB_DAVINCI
 	tristate "DaVinci"
-	depends on ARCH_DAVINCI_DMx
+	depends on ARCH_DAVINCI_DMx && USB_MUSB_HDRC
 
-config USB_MUSB_DA8XX
+config USB_MUSB_DA8XX_GLUE
+	select USB_MUSB_DA8XX
 	tristate "DA8xx/OMAP-L1x"
-	depends on ARCH_DAVINCI_DA8XX
+	depends on ARCH_DAVINCI_DA8XX && USB_MUSB_HDRC
 
-config USB_MUSB_TUSB6010
+config USB_MUSB_TUSB6010_GLUE
+	select USB_MUSB_TUSB6010
 	tristate "TUSB6010"
+	depends on ARCH_OMAP && USB_MUSB_HDRC
 
-config USB_MUSB_OMAP2PLUS
+config USB_MUSB_OMAP2PLUS_GLUE
+	select USB_MUSB_OMAP2PLUS
 	tristate "OMAP2430 and onwards"
-	depends on ARCH_OMAP2PLUS
+	depends on ARCH_OMAP2PLUS && USB_MUSB_HDRC
 
-config USB_MUSB_AM35X
+config USB_MUSB_AM35X_GLUE
+	select USB_MUSB_AM35X
 	tristate "AM35x"
-	depends on ARCH_OMAP
+	depends on ARCH_OMAP && USB_MUSB_HDRC
 
-config USB_MUSB_BLACKFIN
+config USB_MUSB_BLACKFIN_GLUE
+	select USB_MUSB_BLACKFIN
 	tristate "Blackfin"
-	depends on (BF54x && !BF544) || (BF52x && ! BF522 && !BF523)
+	depends on (BF54x && !BF544) || (BF52x && ! BF522 && !BF523) && USB_MUSB_HDRC
 
-config USB_MUSB_UX500
+config USB_MUSB_UX500_GLUE
+	select USB_MUSB_UX500
 	tristate "U8500 and U5500"
-	depends on (ARCH_U8500 && AB8500_USB)
+	depends on (ARCH_U8500 && AB8500_USB) && USB_MUSB_HDRC
 
-endchoice
+config USB_MUSB_DAVINCI
+	bool
+	default n
+config USB_MUSB_DA8XX
+	bool
+	default n
+config USB_MUSB_TUSB6010
+	bool
+	default n
+config USB_MUSB_OMAP2PLUS
+	bool
+	default n
+config USB_MUSB_AM35X
+	bool
+	default n
+config USB_MUSB_BLACKFIN
+	bool
+	default n
+config USB_MUSB_UX500
+	bool
+	default n
 
 choice
 	prompt 'MUSB DMA mode'
diff --git a/drivers/usb/musb/Makefile b/drivers/usb/musb/Makefile
index 88bfb9d..faf6a81 100644
--- a/drivers/usb/musb/Makefile
+++ b/drivers/usb/musb/Makefile
@@ -11,13 +11,13 @@ musb_hdrc-y					+= musb_virthub.o musb_host.o
 musb_hdrc-$(CONFIG_DEBUG_FS)			+= musb_debugfs.o
 
 # Hardware Glue Layer
-obj-$(CONFIG_USB_MUSB_OMAP2PLUS)		+= omap2430.o
-obj-$(CONFIG_USB_MUSB_AM35X)			+= am35x.o
-obj-$(CONFIG_USB_MUSB_TUSB6010)			+= tusb6010.o
-obj-$(CONFIG_USB_MUSB_DAVINCI)			+= davinci.o
-obj-$(CONFIG_USB_MUSB_DA8XX)			+= da8xx.o
-obj-$(CONFIG_USB_MUSB_BLACKFIN)			+= blackfin.o
-obj-$(CONFIG_USB_MUSB_UX500)			+= ux500.o
+obj-$(CONFIG_USB_MUSB_OMAP2PLUS_GLUE)		+= omap2430.o
+obj-$(CONFIG_USB_MUSB_AM35X_GLUE)			+= am35x.o
+obj-$(CONFIG_USB_MUSB_TUSB6010_GLUE)		+= tusb6010.o
+obj-$(CONFIG_USB_MUSB_DAVINCI_GLUE)			+= davinci.o
+obj-$(CONFIG_USB_MUSB_DA8XX_GLUE)			+= da8xx.o
+obj-$(CONFIG_USB_MUSB_BLACKFIN_GLUE)		+= blackfin.o
+obj-$(CONFIG_USB_MUSB_UX500_GLUE)			+= ux500.o
 
 # the kconfig must guarantee that only one of the
 # possible I/O schemes will be enabled at a time ...
-- 
1.7.5.4

