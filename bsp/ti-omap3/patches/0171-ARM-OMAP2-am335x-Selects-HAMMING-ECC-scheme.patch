From b86af48930d10d90ae7bb619bd555d2af3335678 Mon Sep 17 00:00:00 2001
From: "Philip, Avinash" <avinashphilip@ti.com>
Date: Tue, 6 Mar 2012 10:06:26 +0530
Subject: [PATCH 171/609] ARM: OMAP2+: am335x: Selects HAMMING ECC scheme.

Original commit: 42f87b50dc5d9064c1a49c9867c81c0390f78b4e

  From git://arago-project.org/git/projects/linux-am33x.git
  And ti-sdk-am335x-evm-05.05.00.00-Linux-x86-Install image

Selects ECC scheme to Hamming code for NAND.

Signed-off-by: Philip, Avinash <avinashphilip@ti.com>
---
 arch/arm/mach-omap2/board-am335xevm.c |    6 +++++-
 1 files changed, 5 insertions(+), 1 deletions(-)

diff --git a/arch/arm/mach-omap2/board-am335xevm.c b/arch/arm/mach-omap2/board-am335xevm.c
index 393e6a3..87110e3 100644
--- a/arch/arm/mach-omap2/board-am335xevm.c
+++ b/arch/arm/mach-omap2/board-am335xevm.c
@@ -56,6 +56,7 @@
 #include <plat/usb.h>
 #include <plat/mmc.h>
 #include <plat/emif.h>
+#include <plat/nand.h>
 
 #include "board-flash.h"
 #include "cpuidle33xx.h"
@@ -1116,15 +1117,18 @@ static struct gpmc_timings am335x_nand_timings = {
 
 static void evm_nand_init(int evm_id, int profile)
 {
+	struct omap_nand_platform_data *pdata;
 	struct gpmc_devices_info gpmc_device[2] = {
 		{ NULL, 0 },
 		{ NULL, 0 },
 	};
 
 	setup_pin_mux(nand_pin_mux);
-	gpmc_device[0].pdata = omap_nand_init(am335x_nand_partitions,
+	pdata = omap_nand_init(am335x_nand_partitions,
 		ARRAY_SIZE(am335x_nand_partitions), 0, 0,
 		&am335x_nand_timings);
+	pdata->ecc_opt = OMAP_ECC_HAMMING_CODE_DEFAULT;
+	gpmc_device[0].pdata = pdata;
 	gpmc_device[0].flag = GPMC_DEVICE_NAND;
 
 	omap_init_gpmc(gpmc_device, sizeof(gpmc_device));
-- 
1.7.5.4

