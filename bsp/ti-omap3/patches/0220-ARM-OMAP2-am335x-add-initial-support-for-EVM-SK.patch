From 2aff90447e453201212adfe832433ee553caa71b Mon Sep 17 00:00:00 2001
From: "Hebbar, Gururaja" <gururaja.hebbar@ti.com>
Date: Mon, 13 Aug 2012 10:39:03 +0800
Subject: [PATCH 220/609] ARM: OMAP2+: am335x: add initial support for EVM-SK

Original commit: c7a368382403f53fb43731bcabe9290d26b915d9

  From git://arago-project.org/git/projects/linux-am33x.git
  And ti-sdk-am335x-evm-05.05.00.00-Linux-x86-Install image

This patch adds initial support new EVM-Starter Kit (EVM-SK).
Only board detection support is added.

Signed-off-by: Hebbar, Gururaja <gururaja.hebbar@ti.com>
---
 arch/arm/mach-omap2/board-am335xevm.c              |   22 +++++++++++++++++--
 arch/arm/mach-omap2/include/mach/board-am335xevm.h |    1 +
 2 files changed, 20 insertions(+), 3 deletions(-)

diff --git a/arch/arm/mach-omap2/board-am335xevm.c b/arch/arm/mach-omap2/board-am335xevm.c
index 3f73ff3..7510b13 100644
--- a/arch/arm/mach-omap2/board-am335xevm.c
+++ b/arch/arm/mach-omap2/board-am335xevm.c
@@ -1636,6 +1636,12 @@ static int beaglebone_phy_fixup(struct phy_device *phydev)
 	return 0;
 }
 
+static void profibus_init(int evm_id, int profile)
+{
+	setup_pin_mux(profibus_pin_mux);
+	return;
+}
+
 /* General Purpose EVM */
 static struct evm_dev_cfg gen_purp_evm_dev_cfg[] = {
 	{enable_ecap0,	DEV_ON_DGHTR_BRD, (PROFILE_0 | PROFILE_1 |
@@ -1705,6 +1711,11 @@ static struct evm_dev_cfg beaglebone_dev_cfg[] = {
 	{NULL, 0, 0},
 };
 
+/* EVM - Starter Kit */
+static struct evm_dev_cfg evm_sk_dev_cfg[] = {
+	{NULL, 0, 0},
+};
+
 static void setup_general_purpose_evm(void)
 {
 	u32 prof_sel = am335x_get_profile_selection();
@@ -1781,10 +1792,12 @@ static void setup_beaglebone(void)
 	am33xx_evmid_fillup(BEAGLE_BONE_A3);
 }
 
-static void profibus_init(int evm_id, int profile)
+/* EVM - Starter Kit */
+static void setup_starterkit(void)
 {
-	setup_pin_mux(profibus_pin_mux);
-	return;
+	pr_info("The board is a AM335x Starter Kit.\n");
+
+	_configure_device(EVM_SK, evm_sk_dev_cfg, PROFILE_NONE);
 }
 
 static void am335x_setup_daughter_board(struct memory_accessor *m, void *c)
@@ -1863,6 +1876,9 @@ static void am335x_evm_setup(struct memory_accessor *mem_acc, void *context)
 			setup_beaglebone_old();
 		else
 			setup_beaglebone();
+	} else if (!strncmp("A335X_SK", config.name, 8)) {
+		daughter_brd_detected = false;
+		setup_starterkit();
 	} else {
 		/* only 6 characters of options string used for now */
 		snprintf(tmp, 7, "%s", config.opt);
diff --git a/arch/arm/mach-omap2/include/mach/board-am335xevm.h b/arch/arm/mach-omap2/include/mach/board-am335xevm.h
index 8bfefcf..2da3096 100644
--- a/arch/arm/mach-omap2/include/mach/board-am335xevm.h
+++ b/arch/arm/mach-omap2/include/mach/board-am335xevm.h
@@ -24,6 +24,7 @@
 #define IND_AUT_MTR_EVM		1
 #define BEAGLE_BONE_OLD		2
 #define BEAGLE_BONE_A3		3
+#define EVM_SK			4
 
 /* REVIST : check posibility of PROFILE_(x) syntax usage */
 #define PROFILE_NONE	-1	/* Few EVM doesn't have profiles */
-- 
1.7.5.4

