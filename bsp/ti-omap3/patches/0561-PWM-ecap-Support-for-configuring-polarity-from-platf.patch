From fb5fe0a5aa9b4731a06e11ff3f981d8714380412 Mon Sep 17 00:00:00 2001
From: "Philip, Avinash" <avinashphilip@ti.com>
Date: Thu, 17 May 2012 11:56:47 +0530
Subject: [PATCH 561/609] PWM: ecap: Support for configuring polarity from
 platform data

Original commit: f8bf3b61e338de7109917733599ee144ff8b6dc5

  From git://arago-project.org/git/projects/linux-am33x.git
  And ti-sdk-am335x-evm-05.05.00.00-Linux-x86-Install image

On some boards (like AM335x EVM-SK board), polarity of PWM wave has to
be inversed. Hence add support for configuring PWM polarity during
initialization.

Signed-off-by: Philip, Avinash <avinashphilip@ti.com>
---
 drivers/pwm/ecap.c |    5 +++++
 1 files changed, 5 insertions(+), 0 deletions(-)

diff --git a/drivers/pwm/ecap.c b/drivers/pwm/ecap.c
index 614be36..a75ef36 100644
--- a/drivers/pwm/ecap.c
+++ b/drivers/pwm/ecap.c
@@ -327,6 +327,11 @@ static int ecap_probe(struct platform_device *pdev)
 	pwm_set_drvdata(&ep->pwm, ep);
 	ret =  pwm_register(&ep->pwm, &pdev->dev, -1);
 	platform_set_drvdata(pdev, ep);
+	/* Inverse the polarity of PWM wave */
+	if (pdata->chan_attrib[0].inverse_pol) {
+		ep->pwm.active_high = 1;
+		ecap_pwm_set_polarity(&ep->pwm, 1);
+	}
 	return 0;
 
 err_ioremap:
-- 
1.7.5.4

