From 48870487ffdea291526a5ac8c0020ad94f613cee Mon Sep 17 00:00:00 2001
From: Zumeng Chen <zumeng.chen@windriver.com>
Date: Wed, 11 Jul 2012 16:58:56 +0800
Subject: [PATCH 574/609] Watchdog: AM335X: give the right PRM_RSTST offset

This patch shows the boot status based on the right PRM_RSTST offset.

Signed-off-by: Zumeng Chen <zumeng.chen@windriver.com>
---
 arch/arm/mach-omap2/prcm.c |    5 +++++
 1 files changed, 5 insertions(+), 0 deletions(-)

diff --git a/arch/arm/mach-omap2/prcm.c b/arch/arm/mach-omap2/prcm.c
index 1271b24..cc105b3 100644
--- a/arch/arm/mach-omap2/prcm.c
+++ b/arch/arm/mach-omap2/prcm.c
@@ -51,6 +51,11 @@ u32 omap_prcm_get_reset_sources(void)
 	/* XXX This presumably needs modification for 34XX */
 	if (cpu_is_omap24xx())
 		return omap2_prm_read_mod_reg(WKUP_MOD, OMAP2_RM_RSTST) & 0x7f;
+
+	if (cpu_is_am335x())
+		return omap2_prm_read_mod_reg(AM33XX_PRM_DEVICE_MOD,
+			AM33XX_PRM_RSTST_OFFSET) & 0x7f;
+
 	if (cpu_is_omap34xx())
 		return omap2_prm_read_mod_reg(OMAP3430_GR_MOD, OMAP2_RM_RSTST) &
 		       0x7f;
-- 
1.7.5.4

