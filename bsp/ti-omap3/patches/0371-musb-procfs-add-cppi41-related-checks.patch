From 741d411878123574e52f9b76af377c83a7f5c041 Mon Sep 17 00:00:00 2001
From: Ajay Kumar Gupta <ajay.gupta@ti.com>
Date: Thu, 23 Jul 2009 12:02:09 +0530
Subject: [PATCH 371/609] musb: procfs: add cppi41 related checks

Original commit: c2df7a065734cbcdcbc5217ecf4b1ff869176163

  From git://arago-project.org/git/projects/linux-am33x.git
  And ti-sdk-am335x-evm-05.05.00.00-Linux-x86-Install image

Signed-off-by: Ajay Kumar Gupta <ajay.gupta@ti.com>
Signed-off-by: Vaibhav Hiremath <hvaibhav@ti.com>
---
 drivers/usb/musb/musb_procfs.c |   12 ++++++++----
 1 files changed, 8 insertions(+), 4 deletions(-)

diff --git a/drivers/usb/musb/musb_procfs.c b/drivers/usb/musb/musb_procfs.c
index fb9de70..17db2c7 100644
--- a/drivers/usb/musb/musb_procfs.c
+++ b/drivers/usb/musb/musb_procfs.c
@@ -143,7 +143,8 @@ static int dump_ep(struct musb_ep *ep, char *buffer, unsigned max)
 		buf += code;
 		max -= code;
 
-		if (is_cppi_enabled(ep->musb) && ep->current_epnum) {
+		if ((is_cppi_enabled(ep->musb) || is_cppi41_enabled(ep->musb))
+				&& ep->current_epnum) {
 			unsigned	cppi = ep->current_epnum - 1;
 			void __iomem	*base = ep->musb->ctrl_base;
 			unsigned	off1 = cppi << 2;
@@ -273,7 +274,8 @@ dump_end_info(struct musb *musb, u8 epnum, char *aBuffer, unsigned max)
 				buf += code;
 				max -= code;
 
-				if (is_cppi_enabled(musb)
+				if ((is_cppi_enabled(musb) ||
+						is_cppi41_enabled(musb))
 						&& epnum
 						&& hw_ep->rx_channel) {
 					unsigned	cppi = epnum - 1;
@@ -361,7 +363,8 @@ dump_end_info(struct musb *musb, u8 epnum, char *aBuffer, unsigned max)
 				buf += code;
 				max -= code;
 
-				if (is_cppi_enabled(musb)
+				if ((is_cppi_enabled(musb) ||
+						is_cppi41_enabled(musb))
 						&& epnum
 						&& hw_ep->tx_channel) {
 					unsigned	cppi = epnum - 1;
@@ -567,7 +570,8 @@ static int dump_header_stats(struct musb *musb, char *buffer)
 	buffer += code;
 #endif	/* DAVINCI */
 
-	if (is_cppi_enabled(musb) && musb->dma_controller) {
+	if ((is_cppi_enabled(musb) || is_cppi41_enabled(musb))
+		&& musb->dma_controller) {
 		code = sprintf(buffer,
 				"CPPI: txcr=%d txsrc=%01x txena=%01x; "
 				"rxcr=%d rxsrc=%01x rxena=%01x "
-- 
1.7.5.4

