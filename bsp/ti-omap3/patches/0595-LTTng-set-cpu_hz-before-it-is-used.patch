From d7f400366c6e4852135714f68610fd33a9447b5b Mon Sep 17 00:00:00 2001
From: Zumeng Chen <zumeng.chen@windriver.com>
Date: Tue, 11 Sep 2012 22:27:13 +0800
Subject: [PATCH 595/609] LTTng: set cpu_hz before it is used.

We have to set cpu_hz before it is used in trace_clock_frequency,
otherwise the kernel will hang due to zero div.

Signed-off-by: Zumeng Chen <zumeng.chen@windriver.com>
---
 arch/arm/mach-omap2/clock33xx_data.c |    3 +++
 1 files changed, 3 insertions(+), 0 deletions(-)

diff --git a/arch/arm/mach-omap2/clock33xx_data.c b/arch/arm/mach-omap2/clock33xx_data.c
index f0f5498..3db7bbc 100644
--- a/arch/arm/mach-omap2/clock33xx_data.c
+++ b/arch/arm/mach-omap2/clock33xx_data.c
@@ -18,6 +18,7 @@
 #include <linux/clk.h>
 #include <plat/clkdev_omap.h>
 #include <mach/io.h>
+#include <asm/trace-clock.h>
 
 #include "control.h"
 #include "clock.h"
@@ -2230,5 +2231,7 @@ int __init am33xx_clk_init(void)
 	 */
 	clk_enable_init_clocks();
 
+	cpu_hz = mpu_fck.rate;
+
 	return 0;
 }
-- 
1.7.5.4

