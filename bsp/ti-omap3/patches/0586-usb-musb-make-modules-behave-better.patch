From 021d8e6bd75fa7b4b88cf9a470a5d2c651b3a79c Mon Sep 17 00:00:00 2001
From: Zumeng Chen <zumeng.chen@windriver.com>
Date: Fri, 31 Aug 2012 05:54:02 +0800
Subject: [PATCH 586/609] usb: musb: make modules behave better

There's really no point in doing this initcall trickery,
and we can safely let udev handle module probing.

Remove the trickery, by moving everybody to module_init()
and making proper use of platform_device_register() rather
than platform_device_probe().

Signed-off-by: Zumeng Chen <zumeng.chen@windriver.com>
---
 drivers/usb/musb/ti81xx.c |   11 ++++++-----
 1 files changed, 6 insertions(+), 5 deletions(-)

diff --git a/drivers/usb/musb/ti81xx.c b/drivers/usb/musb/ti81xx.c
index ec9fbe9..15168a0 100644
--- a/drivers/usb/musb/ti81xx.c
+++ b/drivers/usb/musb/ti81xx.c
@@ -1342,7 +1342,7 @@ err0:
 	return ret;
 }
 
-static int __init ti81xx_probe(struct platform_device *pdev)
+static int __devinit ti81xx_probe(struct platform_device *pdev)
 {
 	struct ti81xx_glue *glue;
 	struct device *dev = &pdev->dev;
@@ -1430,7 +1430,7 @@ err0:
 	return ret;
 }
 
-static int __exit ti81xx_remove(struct platform_device *pdev)
+static int __devexit ti81xx_remove(struct platform_device *pdev)
 {
 	struct ti81xx_glue *glue = platform_get_drvdata(pdev);
 	struct device *dev = &pdev->dev;
@@ -1681,7 +1681,8 @@ static const struct dev_pm_ops ti81xx_pm_ops = {
 #endif
 
 static struct platform_driver ti81xx_musb_driver = {
-	.remove         = __exit_p(ti81xx_remove),
+	.probe		= ti81xx_probe,
+	.remove         = __devexit_p(ti81xx_remove),
 	.driver         = {
 		.name   = "musb-ti81xx",
 		.pm	= DEV_PM_OPS,
@@ -1694,9 +1695,9 @@ MODULE_LICENSE("GPL v2");
 
 static int __init ti81xx_glue_init(void)
 {
-	return platform_driver_probe(&ti81xx_musb_driver, ti81xx_probe);
+	return platform_driver_register(&ti81xx_musb_driver);
 }
-subsys_initcall(ti81xx_glue_init);
+module_init(ti81xx_glue_init);
 
 static void __exit ti81xx_glue_exit(void)
 {
-- 
1.7.5.4

