From 82ed679a5229aca8bfbecfc76059c9a9e1b18afd Mon Sep 17 00:00:00 2001
From: "Hebbar, Gururaja" <gururaja.hebbar@ti.com>
Date: Mon, 13 Aug 2012 10:54:26 +0800
Subject: [PATCH 228/609] ARM: OMAP2+: am335x: add provision to detct EVM type

Original commit: e11c4ce40b3d4f6201c9d8b92293e767396d4c83

  From git://arago-project.org/git/projects/linux-am33x.git
  And ti-sdk-am335x-evm-05.05.00.00-Linux-x86-Install image

Many modules (currently Audio, PM) reguire to know the EVM type to
decide its next step. (i2c bus, DDR type).

This Patch adds support by providing an api for the same.

Signed-off-by: Hebbar, Gururaja <gururaja.hebbar@ti.com>
---
 arch/arm/mach-omap2/devices.c                      |    9 ++++++++-
 arch/arm/mach-omap2/include/mach/board-am335xevm.h |    1 +
 2 files changed, 9 insertions(+), 1 deletions(-)

diff --git a/arch/arm/mach-omap2/devices.c b/arch/arm/mach-omap2/devices.c
index d939ac9..b535cb4 100644
--- a/arch/arm/mach-omap2/devices.c
+++ b/arch/arm/mach-omap2/devices.c
@@ -15,6 +15,7 @@
 #include <linux/io.h>
 #include <linux/clk.h>
 #include <linux/err.h>
+#include <linux/export.h>
 #include <linux/slab.h>
 #include <linux/of.h>
 #include <linux/davinci_emac.h>
@@ -1290,7 +1291,7 @@ static struct platform_device am33xx_cpsw_device = {
 
 static unsigned char  am33xx_macid0[ETH_ALEN];
 static unsigned char  am33xx_macid1[ETH_ALEN];
-static unsigned int   am33xx_evmid;
+static unsigned int   am33xx_evmid = GEN_PURP_EVM;
 
 /*
 * am33xx_evmid_fillup - set up board evmid
@@ -1307,6 +1308,12 @@ void am33xx_evmid_fillup(unsigned int evmid)
 	return;
 }
 
+unsigned int get_am33xx_evmid(void)
+{
+	return am33xx_evmid;
+}
+EXPORT_SYMBOL(get_am33xx_evmid);
+
 /*
 * am33xx_cpsw_macidfillup - setup mac adrresses
 * @eeprommacid0 - mac id 0 which needs to be configured
diff --git a/arch/arm/mach-omap2/include/mach/board-am335xevm.h b/arch/arm/mach-omap2/include/mach/board-am335xevm.h
index 2da3096..a3d0b2b 100644
--- a/arch/arm/mach-omap2/include/mach/board-am335xevm.h
+++ b/arch/arm/mach-omap2/include/mach/board-am335xevm.h
@@ -39,6 +39,7 @@
 #define PROFILE_ALL		0xFF
 
 void am335x_evmid_fillup(unsigned int evmid);
+unsigned int get_am33xx_evmid(void);
 void am335x_cpsw_macidfillup(char *eeprommacid0, char *eeprommacid1);
 void am33xx_cpsw_init(unsigned int gigen);
 void am33xx_d_can_init(unsigned int instance);
-- 
1.7.5.4

