From 27a71b3ec25ca4f9915b1ad8e9a53062157f2433 Mon Sep 17 00:00:00 2001
From: "Patil, Rachna" <rachna@ti.com>
Date: Sat, 30 Jun 2012 22:11:05 +0800
Subject: [PATCH 514/609] input: TSC: Add support for suspend/resume

Original commit: 8591db519a3f401fdedb470035affc09c758329b

  From git://arago-project.org/git/projects/linux-am33x.git
  And ti-sdk-am335x-evm-05.05.00.00-Linux-x86-Install image

This patch adds support for suspend and resume
in touchscreen ti_tscadc

Signed-off-by: Patil, Rachna <rachna@ti.com>
---
 drivers/input/touchscreen/ti_tscadc.c |   32 ++++++++++++++++++++++++++++++++
 1 files changed, 32 insertions(+), 0 deletions(-)

diff --git a/drivers/input/touchscreen/ti_tscadc.c b/drivers/input/touchscreen/ti_tscadc.c
index d229c74..f417113 100644
--- a/drivers/input/touchscreen/ti_tscadc.c
+++ b/drivers/input/touchscreen/ti_tscadc.c
@@ -471,6 +471,36 @@ static int __devexit tscadc_remove(struct platform_device *pdev)
 	return 0;
 }
 
+static int tscadc_suspend(struct platform_device *pdev)
+{
+	struct tscadc *ts_dev = platform_get_drvdata(pdev);
+	unsigned int  status;
+
+	status = tscadc_readl(ts_dev, TSCADC_REG_CTRL);
+	status &= ~(TSCADC_CNTRLREG_TSCSSENB);
+	tscadc_writel(ts_dev, TSCADC_REG_CTRL, status);
+
+	clk_disable(ts_dev->tsc_ick);
+	clk_put(ts_dev->tsc_ick);
+
+	return 0;
+
+}
+
+static int tscadc_resume(struct platform_device *pdev)
+{
+	struct tscadc *ts_dev = platform_get_drvdata(pdev);
+	unsigned int  status;
+
+	clk_enable(ts_dev->tsc_ick);
+
+	status = tscadc_readl(ts_dev, TSCADC_REG_CTRL);
+	tscadc_writel(ts_dev, TSCADC_REG_CTRL,
+			(status | TSCADC_CNTRLREG_TSCSSENB));
+
+	return 0;
+}
+
 static struct platform_driver ti_tsc_driver = {
 	.probe	= tscadc_probe,
 	.remove	= __devexit_p(tscadc_remove),
@@ -478,6 +508,8 @@ static struct platform_driver ti_tsc_driver = {
 		.name   = "tsc",
 		.owner	= THIS_MODULE,
 	},
+	.suspend = tscadc_suspend,
+	.resume  = tscadc_resume,
 };
 module_platform_driver(ti_tsc_driver);
 
-- 
1.7.5.4

