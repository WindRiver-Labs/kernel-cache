From c81fdc12f25f9991f4b73dccebb8a374535e565a Mon Sep 17 00:00:00 2001
From: Mugunthan V N <mugunthanvnm@ti.com>
Date: Wed, 18 Jul 2012 17:07:59 +0530
Subject: [PATCH 323/609] ethernet: cpsw: enable multicast packet forward to
 host port in dual emac

Original commit: d7e124e8074cccf9958290e773c88a4b2b36412b

  From git://arago-project.org/git/projects/linux-am33x.git
  And ti-sdk-am335x-evm-05.05.00.00-Linux-x86-Install image

In Dual EMAC mode, multicast packets are not received by the host as CPSW is
in VLAN aware mode and unknown multicast port mask0 is 0 in the VLAN entry.
Enabling the unknown multicast port mask with host port and down stream port
to the VLAN entry.

Signed-off-by: Mugunthan V N <mugunthanvnm@ti.com>
---
 drivers/net/ethernet/ti/cpsw.c |    3 ++-
 1 files changed, 2 insertions(+), 1 deletions(-)

diff --git a/drivers/net/ethernet/ti/cpsw.c b/drivers/net/ethernet/ti/cpsw.c
index c0cb4d1..78ce517 100644
--- a/drivers/net/ethernet/ti/cpsw.c
+++ b/drivers/net/ethernet/ti/cpsw.c
@@ -383,7 +383,8 @@ static inline void cpsw_add_dual_emac_mode_default_ale_entries(
 	writel(slave->port_vlan, &slave->regs->port_vlan);
 	cpsw_ale_add_vlan(priv->ale, slave->port_vlan,
 		1 << slave_port | 1 << priv->host_port, 0,
-		1 << slave_port | 1 << priv->host_port, 0);
+		1 << slave_port | 1 << priv->host_port,
+		1 << slave_port | 1 << priv->host_port);
 	cpsw_ale_vlan_add_mcast(priv->ale,
 		priv->ndev->broadcast,
 		1 << slave_port | 1 << priv->host_port,
-- 
1.7.5.4

