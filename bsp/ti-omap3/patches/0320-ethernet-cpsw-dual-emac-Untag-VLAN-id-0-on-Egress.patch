From 0355974d2ce67e723bc0e8c236ec0893b5003874 Mon Sep 17 00:00:00 2001
From: Mugunthan V N <mugunthanvnm@ti.com>
Date: Tue, 19 Jun 2012 17:41:40 +0530
Subject: [PATCH 320/609] ethernet: cpsw: dual-emac: Untag VLAN id 0 on Egress

Original commit: e7035955ebcfb6dde8bebb5f6a4b22d03c2b61a1

  From git://arago-project.org/git/projects/linux-am33x.git
  And ti-sdk-am335x-evm-05.05.00.00-Linux-x86-Install image

On egress, packets are sent with VLAN id 0, as ALE is in VLAN-aware mode and
port VLAN of host port is zero. Due to VLAN id 0 tagged packet, VLAN unaware
external device will drop the packet so VLAN id 0 must be untagged on egress

Signed-off-by: Mugunthan V N <mugunthanvnm@ti.com>
---
 drivers/net/ethernet/ti/cpsw.c |    3 ++-
 1 files changed, 2 insertions(+), 1 deletions(-)

diff --git a/drivers/net/ethernet/ti/cpsw.c b/drivers/net/ethernet/ti/cpsw.c
index 69a11cd..07979e0 100644
--- a/drivers/net/ethernet/ti/cpsw.c
+++ b/drivers/net/ethernet/ti/cpsw.c
@@ -389,7 +389,8 @@ static inline void cpsw_add_dual_emac_mode_default_ale_entries(
 	cpsw_ale_add_ucast(priv->ale, priv->mac_addr,
 		priv->host_port, 0);
 	cpsw_ale_add_vlan(priv->ale, 0,
-		ALE_ALL_PORTS << priv->host_port, 1, 1, 0);
+		ALE_ALL_PORTS << priv->host_port,
+		ALE_ALL_PORTS << priv->host_port, priv->host_port, 0);
 }
 
 static int cpsw_common_res_usage_state(struct cpsw_priv *priv)
-- 
1.7.5.4

