From aa251112b342188f74396440cd80395420e7189e Mon Sep 17 00:00:00 2001
From: "Shankarmurthy, Akshay" <akshay.s@ti.com>
Date: Wed, 1 Aug 2012 14:42:19 +0800
Subject: [PATCH 206/609] ARM: OMAP2+: am335x: Update CPLD version handling
 method

Original commit: 88dcc46017b970660ff113c1bb4e7d832c5a3693

  From git://arago-project.org/git/projects/linux-am33x.git
  And ti-sdk-am335x-evm-05.05.00.00-Linux-x86-Install image

Since current version of the board doesn't populate cpld version,
removed the cpld_version variable. Prints the cpld version
read from the eeprom only if its a valid string (CPLDxxx).

Signed-off-by: Shankarmurthy, Akshay <akshay.s@ti.com>
---
 arch/arm/mach-omap2/board-am335xevm.c |   22 ++++++----------------
 1 files changed, 6 insertions(+), 16 deletions(-)

diff --git a/arch/arm/mach-omap2/board-am335xevm.c b/arch/arm/mach-omap2/board-am335xevm.c
index 283a48d..e8f2314 100644
--- a/arch/arm/mach-omap2/board-am335xevm.c
+++ b/arch/arm/mach-omap2/board-am335xevm.c
@@ -294,11 +294,6 @@ static bool daughter_brd_detected;
 static unsigned int gp_evm_revision = GP_EVM_REV_IS_UNKNOWN;
 unsigned int gigabit_enable = 1;
 
-#define CPLD_REV_1_0A			0x1
-#define CPLD_REV_1_1A			0x2
-#define CPLD_UNKNOWN			0xFF
-static unsigned int cpld_version = CPLD_UNKNOWN;
-
 #define EEPROM_MAC_ADDRESS_OFFSET	60 /* 4+8+4+12+32 */
 #define EEPROM_NO_OF_MAC_ADDR		3
 static char am335x_mac_addr[EEPROM_NO_OF_MAC_ADDR][ETH_ALEN];
@@ -1789,9 +1784,8 @@ static void am335x_setup_daughter_board(struct memory_accessor *m, void *c)
 	int ret;
 
 	/*
-	 * Read from the EEPROM to see the presence
-	 * of daughter board. If present, get daughter board
-	 * specific data.
+	 * Read from the EEPROM to see the presence of daughter board.
+	 * If present, print the cpld version.
 	 */
 
 	ret = m->read(m, (char *)&config1, 0, sizeof(config1));
@@ -1805,14 +1799,10 @@ static void am335x_setup_daughter_board(struct memory_accessor *m, void *c)
 		return;
 	}
 
-	if (!strncmp("CPLD1.0A", config1.cpld_ver, 8))
-		cpld_version = CPLD_REV_1_0A;
-	else if (!strncmp("CPLD1.1A", config1.cpld_ver, 8))
-		cpld_version = CPLD_REV_1_1A;
-	else {
-		pr_err("Unknown CPLD version found, falling back to 1.0A\n");
-		cpld_version = CPLD_REV_1_0A;
-	}
+	if (!strncmp("CPLD", config1.cpld_ver, 4))
+		pr_info("CPLD version: %s\n", config1.cpld_ver);
+	else
+		pr_err("Unknown CPLD version found\n");
 }
 
 static void am335x_evm_setup(struct memory_accessor *mem_acc, void *context)
-- 
1.7.5.4

