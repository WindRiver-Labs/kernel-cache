From 45706b820f6f349df5d9a8ba18ffb4a53fa3ad09 Mon Sep 17 00:00:00 2001
From: Zumeng Chen <zumeng.chen@windriver.com>
Date: Thu, 16 Aug 2012 10:29:28 +0800
Subject: [PATCH 275/609] arm: omap: am33xx: some cosmetic fixes

This patch fixes some compiling errors, which caters for the updates
of 3.4 kernel from 3.2.

Signed-off-by: Zumeng Chen <zumeng.chen@windriver.com>
---
 arch/arm/mach-omap2/board-am335xevm.c              |   20 +++++++-------------
 arch/arm/mach-omap2/clock33xx_data.c               |    1 +
 arch/arm/mach-omap2/control.h                      |    2 ++
 arch/arm/mach-omap2/devices.c                      |    1 -
 arch/arm/mach-omap2/include/mach/board-am335xevm.h |    2 +-
 arch/arm/mach-omap2/mailbox.c                      |    3 ---
 arch/arm/mach-omap2/pm33xx.c                       |    1 +
 arch/arm/plat-omap/include/plat/gpio.h             |    4 ++++
 8 files changed, 16 insertions(+), 18 deletions(-)

diff --git a/arch/arm/mach-omap2/board-am335xevm.c b/arch/arm/mach-omap2/board-am335xevm.c
index c56fd14..b46328c 100644
--- a/arch/arm/mach-omap2/board-am335xevm.c
+++ b/arch/arm/mach-omap2/board-am335xevm.c
@@ -1729,9 +1729,8 @@ static int wl12xx_set_power(struct device *dev, int slot, int on, int vdd)
 
 static void wl12xx_init(int evm_id, int profile)
 {
-	struct device *dev;
-	struct omap_mmc_platform_data *pdata;
 	int ret;
+	struct omap_mmc_platform_data *mmc_data;
 
 	if (evm_id == EVM_SK) {
 		am335xevm_wlan_data.wlan_enable_gpio = GPIO_TO_PIN(0, 31);
@@ -1747,17 +1746,12 @@ static void wl12xx_init(int evm_id, int profile)
 	if (wl12xx_set_platform_data(&am335xevm_wlan_data))
 		pr_err("error setting wl12xx data\n");
 
-	dev = am335x_mmc[1].dev;
-	if (!dev) {
-		pr_err("wl12xx mmc device initialization failed\n");
+	if (!am335x_mmc[1].pdev) {
+		pr_err("wl12xx mmc device initialization failed \n");
 		goto out;
 	}
 
-	pdata = dev->platform_data;
-	if (!pdata) {
-		pr_err("Platfrom data of wl12xx device not set\n");
-		goto out;
-	}
+	mmc_data = am335x_mmc[1].pdev->dev.platform_data;
 
 	ret = gpio_request_one(am335xevm_wlan_data.wlan_enable_gpio,
 		GPIOF_OUT_INIT_LOW, "wlan_en");
@@ -1767,7 +1761,7 @@ static void wl12xx_init(int evm_id, int profile)
 	}
 
 
-	pdata->slots[0].set_power = wl12xx_set_power;
+	mmc_data->slots[0].set_power = wl12xx_set_power;
 out:
 	return;
 }
@@ -1810,7 +1804,7 @@ static void mmc0_init(int evm_id, int profile)
 		break;
 	}
 
-	omap2_hsmmc_init(am335x_mmc);
+	omap_hsmmc_init(am335x_mmc);
 	return;
 }
 
@@ -1875,7 +1869,7 @@ static void mmc0_no_cd_init(int evm_id, int profile)
 	setup_pin_mux(mmc0_common_pin_mux);
 	setup_pin_mux(mmc0_wp_only_pin_mux);
 
-	omap2_hsmmc_init(am335x_mmc);
+	omap_hsmmc_init(am335x_mmc);
 	return;
 }
 
diff --git a/arch/arm/mach-omap2/clock33xx_data.c b/arch/arm/mach-omap2/clock33xx_data.c
index 2dcd452..f0f5498 100644
--- a/arch/arm/mach-omap2/clock33xx_data.c
+++ b/arch/arm/mach-omap2/clock33xx_data.c
@@ -17,6 +17,7 @@
 #include <linux/list.h>
 #include <linux/clk.h>
 #include <plat/clkdev_omap.h>
+#include <mach/io.h>
 
 #include "control.h"
 #include "clock.h"
diff --git a/arch/arm/mach-omap2/control.h b/arch/arm/mach-omap2/control.h
index a1ea403..590e9e6 100644
--- a/arch/arm/mach-omap2/control.h
+++ b/arch/arm/mach-omap2/control.h
@@ -20,6 +20,8 @@
 #include <mach/ctrl_module_wkup_44xx.h>
 #include <mach/ctrl_module_pad_core_44xx.h>
 #include <mach/ctrl_module_pad_wkup_44xx.h>
+#include <plat/am33xx.h>
+#include "iomap.h"
 
 #ifndef __ASSEMBLY__
 #define OMAP242X_CTRL_REGADDR(reg)					\
diff --git a/arch/arm/mach-omap2/devices.c b/arch/arm/mach-omap2/devices.c
index ebcd3c6..c2c7036 100644
--- a/arch/arm/mach-omap2/devices.c
+++ b/arch/arm/mach-omap2/devices.c
@@ -1223,7 +1223,6 @@ static struct cpsw_platform_data am33xx_cpsw_pdata = {
 	.bd_ram_size		= SZ_8K,
 	.rx_descs               = 64,
 	.mac_control            = BIT(5), /* MIIEN */
-	.gigabit_en		= 1,
 	.host_port_num		= 0,
 	.no_bd_ram		= false,
 	.version		= CPSW_VERSION_2,
diff --git a/arch/arm/mach-omap2/include/mach/board-am335xevm.h b/arch/arm/mach-omap2/include/mach/board-am335xevm.h
index 691ec96..0a6c824 100644
--- a/arch/arm/mach-omap2/include/mach/board-am335xevm.h
+++ b/arch/arm/mach-omap2/include/mach/board-am335xevm.h
@@ -41,7 +41,7 @@
 #ifndef __ASSEMBLER__
 void am335x_evm_set_id(unsigned int evmid);
 int am335x_evm_get_id(void);
-void am335x_cpsw_macidfillup(char *eeprommacid0, char *eeprommacid1);
+void am33xx_cpsw_macidfillup(char *eeprommacid0, char *eeprommacid1);
 void am33xx_d_can_init(unsigned int instance);
 
 #endif
diff --git a/arch/arm/mach-omap2/mailbox.c b/arch/arm/mach-omap2/mailbox.c
index 12bd5df..582967d 100644
--- a/arch/arm/mach-omap2/mailbox.c
+++ b/arch/arm/mach-omap2/mailbox.c
@@ -297,12 +297,9 @@ static struct omap_mbox mbox_iva_info = {
 	.priv	= &omap2_mbox_iva_priv,
 };
 
-#ifdef CONFIG_ARCH_OMAP2
 struct omap_mbox *omap2_mboxes[] = {
 	&mbox_dsp_info,
-#ifdef CONFIG_SOC_OMAP2420
 	&mbox_iva_info,
-#endif
 	NULL
 };
 
diff --git a/arch/arm/mach-omap2/pm33xx.c b/arch/arm/mach-omap2/pm33xx.c
index 34d5366..80c354e 100644
--- a/arch/arm/mach-omap2/pm33xx.c
+++ b/arch/arm/mach-omap2/pm33xx.c
@@ -37,6 +37,7 @@
 #include <asm/suspend.h>
 #include <asm/proc-fns.h>
 #include <asm/sizes.h>
+#include <asm/system_misc.h>
 
 #include "pm.h"
 #include "cm33xx.h"
diff --git a/arch/arm/plat-omap/include/plat/gpio.h b/arch/arm/plat-omap/include/plat/gpio.h
index 9775c6d..a1c81a5 100644
--- a/arch/arm/plat-omap/include/plat/gpio.h
+++ b/arch/arm/plat-omap/include/plat/gpio.h
@@ -160,6 +160,10 @@
 #define OMAP_MPUIO(nr)		(OMAP_MAX_GPIO_LINES + (nr))
 #define OMAP_GPIO_IS_MPUIO(nr)	((nr) >= OMAP_MAX_GPIO_LINES)
 
+#define OMAP_GPIO_IRQ(nr)	(OMAP_GPIO_IS_MPUIO(nr) ? \
+				IH_MPUIO_BASE + ((nr) & 0x0f) : \
+				IH_GPIO_BASE + (nr))
+
 #ifndef __ASSEMBLER__
 struct omap_gpio_dev_attr {
 	int bank_width;		/* GPIO bank width */
-- 
1.7.5.4

