From 189f7217f7d2663f17a96af2a582696b7b7ca368 Mon Sep 17 00:00:00 2001
From: Vaibhav Bedia <vaibhav.bedia@ti.com>
Date: Tue, 6 Mar 2012 21:18:02 +0530
Subject: [PATCH 125/609] ARM: OMAP: AM33XX: Don't idle during suspend

Original commit: 617dcbec64b07e761de511f9b08bb4513601c7cd

  From git://arago-project.org/git/projects/linux-am33x.git
  And ti-sdk-am335x-evm-05.05.00.00-Linux-x86-Install image

Signed-off-by: Vaibhav Bedia <vaibhav.bedia@ti.com>
---
 arch/arm/mach-omap2/pm33xx.c |    4 ++++
 1 files changed, 4 insertions(+), 0 deletions(-)

diff --git a/arch/arm/mach-omap2/pm33xx.c b/arch/arm/mach-omap2/pm33xx.c
index 09b96d5..eaf5be6 100644
--- a/arch/arm/mach-omap2/pm33xx.c
+++ b/arch/arm/mach-omap2/pm33xx.c
@@ -122,6 +122,8 @@ static int am33xx_pm_begin(suspend_state_t state)
 {
 	int ret = 0;
 
+	disable_hlt();
+
 	am33xx_lp_ipc.resume_addr = DS_RESUME_ADDR;
 	am33xx_lp_ipc.sleep_mode  = DS_MODE;
 	am33xx_lp_ipc.ipc_data1	  = DS_IPC_DEFAULT;
@@ -180,6 +182,8 @@ static void am33xx_pm_end(void)
 	 */
 	am33xx_m3_state_machine_reset();
 
+	enable_hlt();
+
 	return;
 }
 
-- 
1.7.5.4

