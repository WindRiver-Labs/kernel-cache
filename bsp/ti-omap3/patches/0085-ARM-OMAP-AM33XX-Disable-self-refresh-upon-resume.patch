From 86dd965a8b20ad518a1cbde91199d77f320b92fe Mon Sep 17 00:00:00 2001
From: Vaibhav Bedia <vaibhav.bedia@ti.com>
Date: Tue, 24 Jan 2012 17:15:38 +0530
Subject: [PATCH 085/609] ARM: OMAP: AM33XX: Disable self-refresh upon resume

Original commit: ad815f880edd8dd939b6181d2c718bc974dbf5ea

  From git://arago-project.org/git/projects/linux-am33x.git
  And ti-sdk-am335x-evm-05.05.00.00-Linux-x86-Install image

During suspend, we put the SDRAM in self-refresh mode.
If we don't clear this mode in the resume path SDRAM
can automatically enter self-refresh when the CPU is idle.

While this looks to be right behavior, this causes flickers
on the LCD specifically on ICS. So, when coming out of
suspend disable self-refresh mode.

Signed-off-by: Vaibhav Bedia <vaibhav.bedia@ti.com>
---
 arch/arm/mach-omap2/sleep33xx.S |    3 +++
 1 files changed, 3 insertions(+), 0 deletions(-)

diff --git a/arch/arm/mach-omap2/sleep33xx.S b/arch/arm/mach-omap2/sleep33xx.S
index 4b56589..f80b1c3 100644
--- a/arch/arm/mach-omap2/sleep33xx.S
+++ b/arch/arm/mach-omap2/sleep33xx.S
@@ -394,6 +394,9 @@ misc_config:
 
 config_emif_timings:
 	mov	r3, #1275068416	@ 0x4c000000
+disable_sr:
+	mov	r4, #0
+	str	r4, [r3, #56]	@ 0x38
 	ldr	r4, emif_rd_lat_val
 	mov	r2, r4
 rd_lat:
-- 
1.7.5.4

