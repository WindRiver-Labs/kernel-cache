From ec2db819b783831c259dc12b3a85f0076c04646f Mon Sep 17 00:00:00 2001
From: Vaibhav Bedia <vaibhav.bedia@ti.com>
Date: Sat, 30 Jun 2012 15:33:07 +0800
Subject: [PATCH 061/609] arm:omap:am33xx: Don't register non-existent or
 unused devices

Original commit: ef7e409d131fbc96553c9323adbe81533beca614

  From git://arago-project.org/git/projects/linux-am33x.git
  And ti-sdk-am335x-evm-05.05.00.00-Linux-x86-Install image

Remove some of the platform devices which either do
not exist or are not being used right now.

Signed-off-by: Vaibhav Bedia <vaibhav.bedia@ti.com>
---
 arch/arm/mach-omap2/devices.c |    8 ++++----
 1 files changed, 4 insertions(+), 4 deletions(-)

diff --git a/arch/arm/mach-omap2/devices.c b/arch/arm/mach-omap2/devices.c
index 175a991..bd91857 100644
--- a/arch/arm/mach-omap2/devices.c
+++ b/arch/arm/mach-omap2/devices.c
@@ -69,7 +69,7 @@ static int __init omap3_l3_init(void)
 	 * To avoid code running on other OMAPs in
 	 * multi-omap builds
 	 */
-	if (!(cpu_is_omap34xx()))
+	if (!(cpu_is_omap34xx()) || (cpu_is_am33xx()))
 		return -ENODEV;
 
 	l = snprintf(oh_name, L3_MODULES_MAX_LEN, "l3_main");
@@ -535,7 +535,7 @@ static void omap_init_pmu(void)
 {
 	if (cpu_is_omap24xx())
 		omap_pmu_device.resource = &omap2_pmu_resource;
-	else if (cpu_is_omap34xx())
+	else if (cpu_is_omap34xx() && !cpu_is_am33xx())
 		omap_pmu_device.resource = &omap3_pmu_resource;
 	else
 		return;
@@ -596,7 +596,7 @@ static void omap_init_sham(void)
 	if (cpu_is_omap24xx()) {
 		sham_device.resource = omap2_sham_resources;
 		sham_device.num_resources = omap2_sham_resources_sz;
-	} else if (cpu_is_omap34xx()) {
+	} else if (cpu_is_omap34xx() && !cpu_is_am33xx()) {
 		sham_device.resource = omap3_sham_resources;
 		sham_device.num_resources = omap3_sham_resources_sz;
 	} else {
@@ -665,7 +665,7 @@ static void omap_init_aes(void)
 	if (cpu_is_omap24xx()) {
 		aes_device.resource = omap2_aes_resources;
 		aes_device.num_resources = omap2_aes_resources_sz;
-	} else if (cpu_is_omap34xx()) {
+	} else if (cpu_is_omap34xx() && !cpu_is_am33xx()) {
 		aes_device.resource = omap3_aes_resources;
 		aes_device.num_resources = omap3_aes_resources_sz;
 	} else {
-- 
1.7.5.4

