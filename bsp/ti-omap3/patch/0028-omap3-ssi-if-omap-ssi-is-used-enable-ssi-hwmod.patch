From ec4f2c330c295bff42e8f6a6a4701780dcb68308 Mon Sep 17 00:00:00 2001
From: czou <cao.zou@windriver.com>
Date: Mon, 7 Sep 2015 12:52:03 +0800
Subject: [PATCH 28/29] omap3: ssi: if omap ssi is used, enable ssi hwmod

thourgh omap ssi, enable ssi hwmod, otherwise some warning will be
printed as follow:

WARNING: CPU: 0 PID: 1 at arch/arm/mach-omap2/omap_hwmod.c:2542
_init+0x39c/0x3e4()
omap_hwmod: ssi: doesn't have mpu register target base
Modules linked in:
CPU: 0 PID: 1 Comm: swapper Not tainted 3.14.29ltsi-WR7.0.0.0_standard+
[<c001bc80>] (unwind_backtrace) from [<c0017998>] (show_stack+0x20/0x24)
[<c0017998>] (show_stack) from [<c0624c24>] (dump_stack+0x20/0x28)
[<c0624c24>] (dump_stack) from [<c0040e70>]
(warn_slowpath_common+0x78/0x98)
[<c0040e70>] (warn_slowpath_common) from [<c0040f4c>]
(warn_slowpath_fmt+0x40/0x48)
[<c0040f4c>] (warn_slowpath_fmt) from [<c089d31c>] (_init+0x39c/0x3e4)
[<c089d31c>] (_init) from [<c002d064>] (omap_hwmod_for_each+0x40/0x70)
[<c002d064>] (omap_hwmod_for_each) from [<c089d838>]
(__omap_hwmod_setup_all+0x2c/0x48)
[<c089d838>] (__omap_hwmod_setup_all) from [<c00089f8>]
(do_one_initcall+0xa4/0x148)
[<c00089f8>] (do_one_initcall) from [<c0891c98>]
(kernel_init_freeable+0x168/0x260)
[<c0891c98>] (kernel_init_freeable) from [<c061f5b4>]
(kernel_init+0x18/0xf4)
[<c061f5b4>] (kernel_init) from [<c0013f18>] (ret_from_fork+0x14/0x20)
---[ end trace 6511f9d0d40ff15f ]---

Signed-off-by: czou <cao.zou@windriver.com>
---
 arch/arm/mach-omap2/omap_hwmod_3xxx_data.c | 5 +++++
 1 file changed, 5 insertions(+)

diff --git a/arch/arm/mach-omap2/omap_hwmod_3xxx_data.c b/arch/arm/mach-omap2/omap_hwmod_3xxx_data.c
index ea4643a..b76ff38 100644
--- a/arch/arm/mach-omap2/omap_hwmod_3xxx_data.c
+++ b/arch/arm/mach-omap2/omap_hwmod_3xxx_data.c
@@ -3686,6 +3686,7 @@ static struct omap_hwmod_ocp_if omap3xxx_l4_core__aes = {
 	.user		= OCP_USER_MPU | OCP_USER_SDMA,
 };
 
+#ifdef CONFIG_SSI_OMAP
 /*
  * 'ssi' class
  * synchronous serial interface (multichannel and full-duplex serial if)
@@ -3732,6 +3733,7 @@ static struct omap_hwmod_ocp_if omap34xx_l4_core__ssi = {
 	.clk		= "ssi_ick",
 	.user		= OCP_USER_MPU | OCP_USER_SDMA,
 };
+#endif
 
 static struct omap_hwmod_ocp_if *omap3xxx_hwmod_ocp_ifs[] __initdata = {
 	&omap3xxx_l3_main__l4_core,
@@ -3858,7 +3860,10 @@ static struct omap_hwmod_ocp_if *omap34xx_hwmod_ocp_ifs[] __initdata = {
 #ifdef CONFIG_OMAP_IOMMU_IVA2
 	&omap3xxx_l3_main__mmu_iva,
 #endif
+
+#ifdef CONFIG_OMAP_SSI
 	&omap34xx_l4_core__ssi,
+#endif
 	NULL
 };
 
-- 
1.9.1

