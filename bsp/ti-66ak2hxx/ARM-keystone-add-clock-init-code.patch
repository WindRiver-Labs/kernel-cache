From 0ff527f8c3acca65474bd74f7dd2b50b14e5f0c2 Mon Sep 17 00:00:00 2001
From: Guoqing Jiang <Guoqing.Jiang@windriver.com>
Date: Wed, 17 Jul 2013 16:11:37 +0800
Subject: [PATCH 24/61] ARM: keystone: add clock init code

Commit f5fb9fc1b4ffcd3a3a63fa16822d7a3d54a6c580 from arago tree
git://arago-project.org/git/projects/linux-keystone.git releases/03.00.00.11/master

re-use the davinci_of_clk_init() function to initialize the
clock for Keystone. This functions requires the clock providers
to be configured through device tree bindings. Also enable
required common clk options for Keystone.

Signed-off-by: Murali Karicheri <m-karicheri2@ti.com>
Signed-off-by: Guoqing Jiang <Guoqing.Jiang@windriver.com>
---
 arch/arm/Kconfig                  |    2 ++
 arch/arm/mach-keystone/keystone.c |    2 ++
 2 files changed, 4 insertions(+), 0 deletions(-)

diff --git a/arch/arm/Kconfig b/arch/arm/Kconfig
index 2c7e362..cf15d87 100644
--- a/arch/arm/Kconfig
+++ b/arch/arm/Kconfig
@@ -399,6 +399,8 @@ config ARCH_KEYSTONE
 	select MULTI_IRQ_HANDLER
 	select CLKDEV_LOOKUP
 	select COMMON_CLK
+	select CLK_KEYSTONE_PLL
+	select DAVINCI_CLKS
 	select CLKSRC_MMIO
 	select CPU_V7
 	select GENERIC_CLOCKEVENTS
diff --git a/arch/arm/mach-keystone/keystone.c b/arch/arm/mach-keystone/keystone.c
index a4f1f7e..a0d2702 100644
--- a/arch/arm/mach-keystone/keystone.c
+++ b/arch/arm/mach-keystone/keystone.c
@@ -18,6 +18,7 @@
 #include <linux/init.h>
 #include <linux/of_irq.h>
 #include <linux/of_platform.h>
+#include <linux/platform_data/davinci-clock.h>
 
 #include <asm/setup.h>
 #include <asm/mach/map.h>
@@ -58,6 +59,7 @@ static void __init keystone_init_irq(void)
 
 static void __init keystone_timer_init(void)
 {
+	davinci_of_clk_init();
 	arch_timer_of_register();
 	arch_timer_sched_clock_init();
 }
-- 
1.7.5.4

