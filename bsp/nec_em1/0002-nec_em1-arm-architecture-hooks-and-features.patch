From 85a6ecc2daf793e4aa55ff3a7b48134022f33f2a Mon Sep 17 00:00:00 2001
From: Kazuya Tsukamoto <kazuya.tsukamoto@necel.com>
Date: Mon, 9 Nov 2009 10:50:52 +0900
Subject: [PATCH 02/29] nec_em1: arm architecture hooks and features

Add the MP200 arch subarchitecture to the build system. This also
adds required features to the kbuild system.

Signed-off-by: Kazuya Tsukamoto <kazuya.tsukamoto@necel.com>
---
 arch/arm/Kconfig       |   24 ++++++++++++++++++++++--
 arch/arm/Makefile      |    1 +
 arch/arm/boot/Makefile |    3 ++-
 3 files changed, 25 insertions(+), 3 deletions(-)

diff --git a/arch/arm/Kconfig b/arch/arm/Kconfig
index b28379d..dbe9807 100644
--- a/arch/arm/Kconfig
+++ b/arch/arm/Kconfig
@@ -16,8 +16,6 @@ config ARM
 	select HAVE_LTT_DUMP_TABLES
 	select HAVE_KPROBES if (!XIP_KERNEL)
 	select HAVE_KRETPROBES if (HAVE_KPROBES)
-	select HAVE_FTRACE_MCOUNT_RECORD
-	select HAVE_DYNAMIC_FTRACE if (!XIP_KERNEL)
 	select HAVE_FTRACE if (!XIP_KERNEL)
 	select HAVE_DYNAMIC_FTRACE if (HAVE_FTRACE)
 	select HAVE_GENERIC_DMA_COHERENT
@@ -52,6 +50,10 @@ config GENERIC_CLOCKEVENTS_BROADCAST
 	depends on GENERIC_CLOCKEVENTS
 	default y if SMP && !LOCAL_TIMERS
 
+config STACKTRACE_SUPPORT
+	bool
+	default y
+
 config MMU
 	bool
 	default y
@@ -543,6 +545,15 @@ config ARCH_MSM7X00A
 	  and controls some vital subsystems (clock and power control, etc).
 	  <http://www.cdmatech.com/products/msm7200_chipset_solution.jsp>
 
+config ARCH_MP200
+	bool "NEC MP200"
+	select GENERIC_GPIO
+	select MP200_SPI0
+	select MP200_PWC
+	select ARCH_DISCONTIGMEM_ENABLE
+	help
+	  Support for NEC MP series paltform.
+
 endchoice
 
 source "arch/arm/mach-clps711x/Kconfig"
@@ -621,6 +632,8 @@ source "arch/arm/mach-ks8695/Kconfig"
 
 source "arch/arm/mach-msm/Kconfig"
 
+source "arch/arm/mach-mp200/Kconfig"
+
 # Definitions to make life easier
 config ARCH_ACORN
 	bool
@@ -868,6 +881,9 @@ config ARCH_FLATMEM_HAS_HOLES
 	default y
 	depends on FLATMEM
 
+config ARCH_FLATMEM_ENABLE
+       bool "Flat Memory support"
+
 config ARCH_DISCONTIGMEM_ENABLE
 	bool
 	default (ARCH_LH7A40X && !LH7A40X_CONTIGMEM)
@@ -1278,6 +1294,10 @@ source "drivers/mfd/Kconfig"
 
 source "drivers/media/Kconfig"
 
+source "drivers/ipu/Kconfig"
+
+source "drivers/avc/Kconfig"
+
 source "drivers/video/Kconfig"
 
 source "sound/Kconfig"
diff --git a/arch/arm/Makefile b/arch/arm/Makefile
index c3fadbe..b6796b9 100644
--- a/arch/arm/Makefile
+++ b/arch/arm/Makefile
@@ -145,6 +145,7 @@ endif
  machine-$(CONFIG_ARCH_MSM7X00A)   := msm
  machine-$(CONFIG_ARCH_LOKI)       := loki
  machine-$(CONFIG_ARCH_MV78XX0)    := mv78xx0
+ machine-$(CONFIG_ARCH_MP200)      := mp200
 
 ifeq ($(CONFIG_ARCH_EBSA110),y)
 # This is what happens if you forget the IOCS16 line.
diff --git a/arch/arm/boot/Makefile b/arch/arm/boot/Makefile
index 4bb7c69..cff8ad5 100644
--- a/arch/arm/boot/Makefile
+++ b/arch/arm/boot/Makefile
@@ -92,7 +92,8 @@ $(obj)/uImage: FORCE
 	@true
 else
 
-$(obj)/uImage:	$(obj)/zImage FORCE
+#$(obj)/uImage:	$(obj)/zImage FORCE
+$(obj)/uImage:	$(obj)/Image FORCE
 	$(call if_changed,uimage)
 	@echo '  Image $@ is ready'
 
-- 
1.6.5.2

