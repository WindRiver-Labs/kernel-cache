From b5cc74e3a36e74384efe7b0036b4d3452bcea129 Mon Sep 17 00:00:00 2001
From: Kazuya Tsukamoto <kazuya.tsukamoto@necel.com>
Date: Mon, 9 Nov 2009 10:54:08 +0900
Subject: [PATCH 03/29] nec_em1: allow bootmem_node_data to be accessed after init

When CONFIG_DISCONTIGMEM is specified, bootmem_node_data must
be accessed outside of system init. To allow this, we'll remove
the __initdata tag from the declaration when CONFIG_DISCONTIGMEM
is enabled.

Signed-off-by: Kazuya Tsukamoto <kazuya.tsukamoto@necel.com>
---
 mm/bootmem.c |    4 ++++
 1 files changed, 4 insertions(+), 0 deletions(-)

diff --git a/mm/bootmem.c b/mm/bootmem.c
index ad8eec6..6f65023 100644
--- a/mm/bootmem.c
+++ b/mm/bootmem.c
@@ -31,7 +31,11 @@ unsigned long max_pfn;
 unsigned long saved_max_pfn;
 #endif
 
+#ifdef CONFIG_DISCONTIGMEM
+bootmem_data_t bootmem_node_data[MAX_NUMNODES];
+#else
 bootmem_data_t bootmem_node_data[MAX_NUMNODES] __initdata;
+#endif
 
 static struct list_head bdata_list __initdata = LIST_HEAD_INIT(bdata_list);
 
-- 
1.6.5.2

