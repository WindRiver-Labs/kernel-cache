From 58f0370bc917a8ab10307d6307110725aa100aa6 Mon Sep 17 00:00:00 2001
From: Peng Chao <chao.peng@windriver.com>
Date: Wed, 26 Jun 2013 13:40:04 +0800
Subject: [PATCH 124/134] intel-atom: Add baytrail USB support

Add USB EHCI and XHCI support for Intel Baytrail platform.

Signed-off-by: Peng Chao <chao.peng@windriver.com>
---
 drivers/usb/host/ehci-pci.c   |    3 ++-
 drivers/usb/host/pci-quirks.c |   12 +++++++++++-
 2 files changed, 13 insertions(+), 2 deletions(-)

diff --git a/drivers/usb/host/ehci-pci.c b/drivers/usb/host/ehci-pci.c
index 0909783..0fe8880 100644
--- a/drivers/usb/host/ehci-pci.c
+++ b/drivers/usb/host/ehci-pci.c
@@ -363,7 +363,8 @@ static bool usb_is_intel_switchable_ehci(struct pci_dev *pdev)
 		(pdev->device == 0x1E26 ||
 		 pdev->device == 0x8C2D ||
 		 pdev->device == 0x8C26 ||
-		 pdev->device == 0x9C26);
+		 pdev->device == 0x9c26 ||
+		 pdev->device == 0x0F34);
 }
 
 static void ehci_enable_xhci_companion(void)
diff --git a/drivers/usb/host/pci-quirks.c b/drivers/usb/host/pci-quirks.c
index 54a1e31..482451d 100644
--- a/drivers/usb/host/pci-quirks.c
+++ b/drivers/usb/host/pci-quirks.c
@@ -734,6 +734,7 @@ static int handshake(void __iomem *ptr, u32 mask, u32 done,
 
 #define PCI_DEVICE_ID_INTEL_LYNX_POINT_XHCI	0x8C31
 #define PCI_DEVICE_ID_INTEL_LYNX_POINT_LP_XHCI	0x9C31
+#define PCI_DEVICE_ID_INTEL_BYT_XHCI		0x0F35
 
 bool usb_is_intel_ppt_switchable_xhci(struct pci_dev *pdev)
 {
@@ -751,10 +752,19 @@ bool usb_is_intel_lpt_switchable_xhci(struct pci_dev *pdev)
 		 pdev->device == PCI_DEVICE_ID_INTEL_LYNX_POINT_LP_XHCI);
 }
 
+/* The Intel BYT also has switchable ports. */
+bool usb_is_intel_byt_switchable_xhci(struct pci_dev *pdev)
+{
+        return pdev->class == PCI_CLASS_SERIAL_USB_XHCI &&
+                pdev->vendor == PCI_VENDOR_ID_INTEL &&
+                pdev->device == PCI_DEVICE_ID_INTEL_BYT_XHCI;
+}
+
 bool usb_is_intel_switchable_xhci(struct pci_dev *pdev)
 {
 	return usb_is_intel_ppt_switchable_xhci(pdev) ||
-		usb_is_intel_lpt_switchable_xhci(pdev);
+		usb_is_intel_lpt_switchable_xhci(pdev)||
+		usb_is_intel_byt_switchable_xhci(pdev);
 }
 EXPORT_SYMBOL_GPL(usb_is_intel_switchable_xhci);
 
-- 
1.7.5.4

