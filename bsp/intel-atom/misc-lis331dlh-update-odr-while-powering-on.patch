From d737850c246e5b43ada0f5b7cc278cf35dd98c23 Mon Sep 17 00:00:00 2001
From: Wei Yang <Wei.Yang@windriver.com>
Date: Mon, 2 Jul 2012 10:17:57 +0800
Subject: [PATCH 7/8] misc/lis331dlh: update odr while powering on

update odr to make the device work in normal mode

Signed-off-by: Yang Wei <wei.yang@windriver.com>
---
 drivers/misc/lis331dlh/lis331dlh_acc.c |    6 ++++--
 1 files changed, 4 insertions(+), 2 deletions(-)

diff --git a/drivers/misc/lis331dlh/lis331dlh_acc.c b/drivers/misc/lis331dlh/lis331dlh_acc.c
index 3d46666..59b5a97 100644
--- a/drivers/misc/lis331dlh/lis331dlh_acc.c
+++ b/drivers/misc/lis331dlh/lis331dlh_acc.c
@@ -173,6 +173,8 @@ struct lis331dlh_acc_data {
 	u8 reg_addr;
 #endif
 };
+int lis331dlh_acc_update_odr(struct lis331dlh_acc_data *acc,
+							int poll_interval_ms);
 struct lis331dlh_acc_platform_data fri2_lis331dlh_data = {
 	.poll_interval = 20,
 	.g_range = LIS331DLH_ACC_G_8G,
@@ -360,6 +362,8 @@ static int lis331dlh_acc_device_power_on(struct lis331dlh_acc_data *acc)
 		}
 	}
 
+	lis331dlh_acc_update_odr(acc, acc->pdata->poll_interval);
+
 	if (acc->hw_initialized) {
 		if (acc->pdata->gpio_int1 >= 0)
 			enable_irq(acc->irq1);
@@ -513,8 +517,6 @@ error:
 
 	return ret;
 }
-
-
 static int lis331dlh_acc_register_write(struct lis331dlh_acc_data *acc, u8 *buf,
 		u8 reg_address, u8 new_value)
 {
-- 
1.7.7

