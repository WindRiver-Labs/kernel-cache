From f1dc07217359c344c37000c0baeab50e895c3e3c Mon Sep 17 00:00:00 2001
From: fli <fupan.li@windriver.com>
Date: Thu, 12 Dec 2013 18:36:11 +0800
Subject: [PATCH 021/142] clk: add the DW DMA clk

BayTrail has two DMA engines, which can be enumerated by PCI and ACPI.
When they are PCI enumerated, their dev ids are expressed as their pci
ids, instead of the dw_dmac0, dw_dmac1; On the other hand, when they
are ACPI enumerated, their dev ids are expressed as INTL9C60:00 & INTL9C60:01.
So correct them when registering their clks.

We add the missing clock registration that was not part of the Yocto
Project BSP.

Signed-off-by: fupan li <fupan.li@windriver.com>
---
 drivers/clk/x86/clk-byt.c |   10 ++++++----
 1 files changed, 6 insertions(+), 4 deletions(-)

diff --git a/drivers/clk/x86/clk-byt.c b/drivers/clk/x86/clk-byt.c
index 7f92833..79c0116 100644
--- a/drivers/clk/x86/clk-byt.c
+++ b/drivers/clk/x86/clk-byt.c
@@ -33,9 +33,9 @@ static int byt_clk_probe(struct platform_device *pdev)
 	if (IS_ERR(clk))
 		return PTR_ERR(clk);
 
-	/* Shared DMA controllers */
-	clk_register_clkdev(clk, "hclk", "INTL9C60.0.auto");
-	clk_register_clkdev(clk, "hclk", "INTL9C60.1.auto");
+	/* Shared DMA controllers for ACPI enumeration mode*/
+	clk_register_clkdev(clk, "hclk", "INTL9C60:00");
+	clk_register_clkdev(clk, "hclk", "INTL9C60:01");
 
 	/* SPI clock */
 	clk = clk_register_fixed_rate(NULL, "spi_clk", "lpss_clk", 0, 50000000);
@@ -69,7 +69,9 @@ static int byt_clk_probe(struct platform_device *pdev)
 		return PTR_ERR(clk);
 
 	clk_register_clkdev(clk, NULL, "0000:00:1e.5");
-	clk_register_clkdev(clk, "hclk", "dw_dmac.0");
+        /*register the clock for DMA engines*/
+	clk_register_clkdev(clk, "hclk", "0000:00:18.0");
+	clk_register_clkdev(clk, "hclk", "0000:00:1e.0");
 	clk_register_clkdev(clk, NULL, "80860F41:00");
 	clk_register_clkdev(clk, NULL, "80860F41:01");
 	clk_register_clkdev(clk, NULL, "80860F41:02");
-- 
1.7.5.4

