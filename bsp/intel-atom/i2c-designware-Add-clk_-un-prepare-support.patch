From d79445dcd0df9c8dd979001aa7ea831c442774f4 Mon Sep 17 00:00:00 2001
From: Viresh Kumar <viresh.kumar@st.com>
Date: Tue, 17 Apr 2012 17:04:31 +0530
Subject: [PATCH 002/142] i2c: designware: Add clk_{un}prepare() support

commit e1fac69f3b2c0430f56f47bf98eebac8b2da395c upstream

clk_{un}prepare is mandatory for platforms using common clock framework. Since
this driver is used by SPEAr platform, which supports common clock framework,
add clk_{un}prepare() support for designware i2c.

Signed-off-by: Viresh Kumar <viresh.kumar@st.com>
Signed-off-by: Wolfram Sang <w.sang@pengutronix.de>
Signed-off-by: fupan li <fupan.li@windriver.com>
---
 drivers/i2c/busses/i2c-designware-platdrv.c |    2 +-
 1 files changed, 1 insertions(+), 1 deletions(-)

diff --git a/drivers/i2c/busses/i2c-designware-platdrv.c b/drivers/i2c/busses/i2c-designware-platdrv.c
index 3c38fbf..9fcb8e6 100644
--- a/drivers/i2c/busses/i2c-designware-platdrv.c
+++ b/drivers/i2c/busses/i2c-designware-platdrv.c
@@ -163,7 +163,7 @@ static int __devinit dw_i2c_probe(struct platform_device *pdev)
 	if (IS_ERR(dev->clk))
 		return PTR_ERR(dev->clk);
 
-	clk_enable(dev->clk);
+	clk_prepare_enable(dev->clk);
 
 	if (pdev->dev.of_node)
 		of_property_read_u32(pdev->dev.of_node, "sda-hold-time",
-- 
1.7.5.4

