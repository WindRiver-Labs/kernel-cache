From 5ec2fe661cf75a9ea9f77a634f4a4dbf5ad32951 Mon Sep 17 00:00:00 2001
From: Wei Yang <Wei.Yang@windriver.com>
Date: Fri, 29 Jun 2012 14:55:55 +0800
Subject: [PATCH 4/8] misc/lis331dlh: reorganize code

modify from lis331dlh_acc_i2c_write_reg8 to lis331dlh_acc_i2c_write, or
reverse since it is more efficient to write a block of data into
registers with lis331dlh_acc_i2c_write than lis331dlh_acc_i2c_write_reg8.

Signed-off-by: Yang Wei <wei.yang@windriver.com>
---
 drivers/misc/lis331dlh/lis331dlh_acc.c |   35 ++++++++-----------------------
 1 files changed, 9 insertions(+), 26 deletions(-)

diff --git a/drivers/misc/lis331dlh/lis331dlh_acc.c b/drivers/misc/lis331dlh/lis331dlh_acc.c
index 50cef47..e58728e 100644
--- a/drivers/misc/lis331dlh/lis331dlh_acc.c
+++ b/drivers/misc/lis331dlh/lis331dlh_acc.c
@@ -266,30 +266,23 @@ static int lis331dlh_acc_hw_init(struct lis331dlh_acc_data *acc)
 	buf[0] = (I2C_AUTO_INCREMENT | INT_THS1);
 	buf[1] = acc->resume_state[RES_INT_THS1];
 	buf[2] = acc->resume_state[RES_INT_DUR1];
-	err = lis331dlh_acc_i2c_write_reg8(acc->client, INT_THS1, buf[1]);
+	err = lis331dlh_acc_i2c_write(acc->client, buf, 2);
 	if (err < 0)
 		goto err_resume_state;
-	err = lis331dlh_acc_i2c_write_reg8(acc->client, INT_DUR1, buf[2]);
-	if (err < 0)
-		goto err_resume_state;
-	buf[0] = INT_CFG1;
-	buf[1] = acc->resume_state[RES_INT_CFG1];
-	err = lis331dlh_acc_i2c_write_reg8(acc->client, INT_CFG1, buf[1]);
+
+	buf[0] = acc->resume_state[RES_INT_CFG1];
+	err = lis331dlh_acc_i2c_write_reg8(acc->client, INT_CFG1, buf[0]);
 	if (err < 0)
 		goto err_resume_state;
 
 	buf[0] = (I2C_AUTO_INCREMENT | INT_THS2);
 	buf[1] = acc->resume_state[RES_INT_THS2];
 	buf[2] = acc->resume_state[RES_INT_DUR2];
-	err = lis331dlh_acc_i2c_write_reg8(acc->client, INT_THS2, buf[1]);
+	err = lis331dlh_acc_i2c_write(acc->client, buf, 2);
 	if (err < 0)
 		goto err_resume_state;
-	err = lis331dlh_acc_i2c_write_reg8(acc->client, INT_DUR2, buf[2]);
-	if (err < 0)
-		goto err_resume_state;
-	buf[0] = INT_CFG2;
-	buf[1] = acc->resume_state[RES_INT_CFG2];
-	err = lis331dlh_acc_i2c_write_reg8(acc->client, INT_CFG2, buf[1]);
+	buf[0] = acc->resume_state[RES_INT_CFG2];
+	err = lis331dlh_acc_i2c_write_reg8(acc->client, INT_CFG2, buf[0]);
 	if (err < 0)
 		goto err_resume_state;
 
@@ -298,16 +291,7 @@ static int lis331dlh_acc_hw_init(struct lis331dlh_acc_data *acc)
 	buf[2] = acc->resume_state[RES_CTRL_REG3];
 	buf[3] = acc->resume_state[RES_CTRL_REG4];
 	buf[4] = acc->resume_state[RES_CTRL_REG5];
-	err = lis331dlh_acc_i2c_write_reg8(acc->client, CTRL_REG2, buf[1]);
-	if (err < 0)
-		goto err_resume_state;
-	err = lis331dlh_acc_i2c_write_reg8(acc->client, CTRL_REG3, buf[2]);
-	if (err < 0)
-		goto err_resume_state;
-	err = lis331dlh_acc_i2c_write_reg8(acc->client, CTRL_REG4, buf[3]);
-	if (err < 0)
-		goto err_resume_state;
-	err = lis331dlh_acc_i2c_write_reg8(acc->client, CTRL_REG5, buf[4]);
+	err = lis331dlh_acc_i2c_write(acc->client, buf, 4);
 	if (err < 0)
 		goto err_resume_state;
 
@@ -328,9 +312,8 @@ err_resume_state:
 static void lis331dlh_acc_device_power_off(struct lis331dlh_acc_data *acc)
 {
 	int err;
-	u8 buf[2] = { CTRL_REG1, LIS331DLH_ACC_PM_OFF };
 
-	err = lis331dlh_acc_i2c_write(acc->client, buf, 1);
+	err = lis331dlh_acc_i2c_write_reg8(acc->client, CTRL_REG1, LIS331DLH_ACC_PM_OFF);
 	if (err < 0)
 		dev_err(&acc->client->dev, "soft power off failed: %d\n", err);
 
-- 
1.7.7

