From 68633030f9d49b40ced8a5715f5a90b08ebf58d5 Mon Sep 17 00:00:00 2001
From: fli <fupan.li@windriver.com>
Date: Wed, 4 Sep 2013 15:42:04 +0800
Subject: [PATCH] fix preempt-rt kernel build error on i915_gem.c

preempt-rt kernel will build failed on
i915/i915_gem.c as below:

drivers/gpu/drm/emgd/src/core/i915/i915_gem.c: In function 'mutex_is_locked_by':
drivers/gpu/drm/emgd/src/core/i915/i915_gem.c:4849:14: error: 'struct mutex' has no member named 'owner'

For more information about this bug/fix, please refer
http://www.spinics.net/lists/linux-rt-users/msg09598.html

Signed-off-by: fli <fupan.li@windriver.com>
---
 drivers/gpu/drm/emgd/src/core/i915/i915_gem.c | 6 +++++-
 1 file changed, 5 insertions(+), 1 deletion(-)

diff --git a/drivers/gpu/drm/emgd/src/core/i915/i915_gem.c b/drivers/gpu/drm/emgd/src/core/i915/i915_gem.c
index 4fe5483..f43baf0 100644
--- a/drivers/gpu/drm/emgd/src/core/i915/i915_gem.c
+++ b/drivers/gpu/drm/emgd/src/core/i915/i915_gem.c
@@ -26,7 +26,7 @@
  */
 
 #include <linux/version.h>
-#include "drmP.h"
+#include <drm/drmP.h>
 #if LINUX_VERSION_CODE < KERNEL_VERSION(3,4,0)
 #include "drm.h"
 #endif
@@ -4846,7 +4846,11 @@ static bool mutex_is_locked_by(struct mutex *mutex, struct task_struct *task)
 		return false;
 
 #if defined(CONFIG_SMP) || defined(CONFIG_DEBUG_MUTEXES)
+#ifdef CONFIG_PREEMPT_RT_FULL
+	return mutex->lock.owner == task;
+#else
 	return mutex->owner == task;
+#endif
 #else
 	/* Since UP may be pre-empted, we cannot assume that we own the lock */
 	return false;
-- 
1.8.1.2

