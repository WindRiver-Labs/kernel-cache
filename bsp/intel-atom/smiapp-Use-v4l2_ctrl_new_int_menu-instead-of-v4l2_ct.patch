From 09cf582557c59a04c9c99a4b5d347c02d8e464e3 Mon Sep 17 00:00:00 2001
From: Sakari Ailus <sakari.ailus@maxwell.research.nokia.com>
Date: Sun, 6 May 2012 07:03:46 -0300
Subject: [PATCH 189/252] smiapp: Use v4l2_ctrl_new_int_menu() instead of
 v4l2_ctrl_new_custom()

commit 06b491fb9a8a13225d6c9fd798b5feb92f26d126 upstream

Signed-off-by: Sakari Ailus <sakari.ailus@maxwell.research.nokia.com>
Signed-off-by: Mauro Carvalho Chehab <mchehab@redhat.com>
Signed-off-by: fupan li <fupan.li@windriver.com>
---
 drivers/media/video/smiapp/smiapp-core.c |   17 ++++++-----------
 1 files changed, 6 insertions(+), 11 deletions(-)

diff --git a/drivers/media/video/smiapp/smiapp-core.c b/drivers/media/video/smiapp/smiapp-core.c
index ffc6eb7..f518026 100644
--- a/drivers/media/video/smiapp/smiapp-core.c
+++ b/drivers/media/video/smiapp/smiapp-core.c
@@ -508,7 +508,7 @@ static const struct v4l2_ctrl_ops smiapp_ctrl_ops = {
 static int smiapp_init_controls(struct smiapp_sensor *sensor)
 {
 	struct i2c_client *client = v4l2_get_subdevdata(&sensor->src->sd);
-	struct v4l2_ctrl_config cfg;
+	unsigned int max;
 	int rval;
 
 	rval = v4l2_ctrl_handler_init(&sensor->pixel_array->ctrl_handler, 7);
@@ -572,17 +572,12 @@ static int smiapp_init_controls(struct smiapp_sensor *sensor)
 		goto error;
 	sensor->src->ctrl_handler.lock = &sensor->mutex;
 
-	memset(&cfg, 0, sizeof(cfg));
+	for (max = 0; sensor->platform_data->op_sys_clock[max + 1]; max++);
 
-	cfg.ops = &smiapp_ctrl_ops;
-	cfg.id = V4L2_CID_LINK_FREQ;
-	cfg.type = V4L2_CTRL_TYPE_INTEGER_MENU;
-	while (sensor->platform_data->op_sys_clock[cfg.max + 1])
-		cfg.max++;
-	cfg.qmenu_int = sensor->platform_data->op_sys_clock;
-
-	sensor->link_freq = v4l2_ctrl_new_custom(
-		&sensor->src->ctrl_handler, &cfg, NULL);
+	sensor->link_freq = v4l2_ctrl_new_int_menu(
+		&sensor->src->ctrl_handler, &smiapp_ctrl_ops,
+		V4L2_CID_LINK_FREQ, max, 0,
+		sensor->platform_data->op_sys_clock);
 
 	sensor->pixel_rate_csi = v4l2_ctrl_new_std(
 		&sensor->src->ctrl_handler, &smiapp_ctrl_ops,
-- 
1.7.5.4

