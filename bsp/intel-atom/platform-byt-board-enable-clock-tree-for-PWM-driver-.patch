From 27360ea7671d7d38e6f893431a720162aacc2018 Mon Sep 17 00:00:00 2001
From: fli <fupan.li@windriver.com>
Date: Mon, 30 Dec 2013 13:54:45 +0800
Subject: [PATCH 064/142] platform: byt-board: enable clock tree for PWM
 driver in board file

Signed-off-by: fupan li <fupan.li@windriver.com>
---
 drivers/clk/x86/clk-byt.c |   19 ++++++++++++++-----
 1 files changed, 14 insertions(+), 5 deletions(-)

diff --git a/drivers/clk/x86/clk-byt.c b/drivers/clk/x86/clk-byt.c
index 79c0116..48999f2 100644
--- a/drivers/clk/x86/clk-byt.c
+++ b/drivers/clk/x86/clk-byt.c
@@ -33,14 +33,17 @@ static int byt_clk_probe(struct platform_device *pdev)
 	if (IS_ERR(clk))
 		return PTR_ERR(clk);
 
-	/* Shared DMA controllers for ACPI enumeration mode*/
+	/* Shared DMA controllers for ACPI/PCI enumeration mode*/
 	clk_register_clkdev(clk, "hclk", "INTL9C60:00");
 	clk_register_clkdev(clk, "hclk", "INTL9C60:01");
+	clk_register_clkdev(clk, "hclk", "0000:00:18.0");
+	clk_register_clkdev(clk, "hclk", "0000:00:1e.0");
 
 	/* SPI clock */
 	clk = clk_register_fixed_rate(NULL, "spi_clk", "lpss_clk", 0, 50000000);
 	if (IS_ERR(clk))
 		return PTR_ERR(clk);
+	clk_register_clkdev(clk, NULL, "0000:00:1e.5");
 
 	clk = clk_register_lpss_gate("spi0_clk", "spi_clk", "80860F0E", NULL,
 				     PRV_CLOCK_PARAMS_SPI);
@@ -68,10 +71,6 @@ static int byt_clk_probe(struct platform_device *pdev)
 	if (IS_ERR(clk))
 		return PTR_ERR(clk);
 
-	clk_register_clkdev(clk, NULL, "0000:00:1e.5");
-        /*register the clock for DMA engines*/
-	clk_register_clkdev(clk, "hclk", "0000:00:18.0");
-	clk_register_clkdev(clk, "hclk", "0000:00:1e.0");
 	clk_register_clkdev(clk, NULL, "80860F41:00");
 	clk_register_clkdev(clk, NULL, "80860F41:01");
 	clk_register_clkdev(clk, NULL, "80860F41:02");
@@ -80,6 +79,16 @@ static int byt_clk_probe(struct platform_device *pdev)
 	clk_register_clkdev(clk, NULL, "80860F41:05");
 	clk_register_clkdev(clk, NULL, "80860F41:06");
 
+	/* Make clock tree required by the PWM driver */
+	clk = clk_register_fixed_rate(NULL, "pwm_clk", "lpss_clk", 0, 25000000);
+	if (IS_ERR(clk))
+		return PTR_ERR(clk);
+
+	clk_register_clkdev(clk, NULL, "80860F09:00");
+	clk_register_clkdev(clk, NULL, "80860F09:01");
+	clk_register_clkdev(clk, NULL, "0000:00:1e.1");
+	clk_register_clkdev(clk, NULL, "0000:00:1e.2");
+
 	return 0;
 }
 
-- 
1.7.5.4

