From f2d350d626ea80e499d2d8777cfad60b8fec2385 Mon Sep 17 00:00:00 2001
From: Jiang Lu <lu.jiang@windriver.com>
Date: Tue, 22 Apr 2014 16:06:18 +0800
Subject: [PATCH 5/5] ARM:armada:add CONFIG_MV_FLASH_MAP kernel option

On armada platform, both NOR flash driver & SPI flash driver in hal
need compile flashmap.c. We need update makefile to update the compiling
rule for this file.

This patch adds CONFIG_MV_FLASH_MAP kernel option for armada platform,
which selects by MV_INCLUDE_SFLASH_MTD or MV_INCLUDE_NOR.

Signed-off-by: Jiang Lu <lu.jiang@windriver.com>
---
 arch/arm/plat-armada/Kconfig |    6 ++++++
 drivers/mtd/maps/Makefile    |    2 +-
 2 files changed, 7 insertions(+), 1 deletions(-)

diff --git a/arch/arm/plat-armada/Kconfig b/arch/arm/plat-armada/Kconfig
index 6b89bc8..dee7fc3 100644
--- a/arch/arm/plat-armada/Kconfig
+++ b/arch/arm/plat-armada/Kconfig
@@ -158,6 +158,7 @@ config MV_INCLUDE_SPI
 config MV_INCLUDE_NOR
 	bool "NOR Support"
 	depends on MV88F6500 || MV88F6281 || (MV78XX0 && !MV78XX0_Z0) || ARMADA_XP
+	select MV_FLASH_MAP
 	default y
         ---help---
         Please don't change this configs unless you know what you are doing.
@@ -282,9 +283,14 @@ config MV_FLASH_CTRL
 	bool
 	default n
 
+config MV_FLASH_MAP
+	bool
+	default n
+
 config MV_INCLUDE_SFLASH_MTD
     bool "Marvell support for MTD SPI flash device"
     select MV_FLASH_CTRL
+	select MV_FLASH_MAP
     depends on MTD && MV_INCLUDE_SPI
    	default y
 
diff --git a/drivers/mtd/maps/Makefile b/drivers/mtd/maps/Makefile
index 6d4c957..683ae09 100644
--- a/drivers/mtd/maps/Makefile
+++ b/drivers/mtd/maps/Makefile
@@ -60,5 +60,5 @@ obj-$(CONFIG_MTD_LANTIQ)	+= lantiq-flash.o
 
 ifeq ($(CONFIG_ARCH_ARMADA_XP),y)
 	include $(srctree)/arch/arm/mach-armadaxp/config/mvRules.mk
-	obj-$(CONFIG_MV_INCLUDE_SPI) += ../../../arch/arm/mach-armadaxp/flashmap.o
+	obj-$(CONFIG_MV_FLASH_MAP) += ../../../arch/arm/mach-armadaxp/flashmap.o
 endif
-- 
1.7.5.4

