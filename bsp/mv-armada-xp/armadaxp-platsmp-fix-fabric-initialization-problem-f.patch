From 9eb04fb9b84c880173c97784e599ad2428394260 Mon Sep 17 00:00:00 2001
From: Wang Hui <Hui.Wang@windriver.com>
Date: Thu, 20 Dec 2012 16:58:26 +0800
Subject: [PATCH 43/50] armadaxp: platsmp: fix fabric initialization problem for no_smp

If we pass no_smp to the kernel, the kernel will crash randomly, this
is because we enabled fabric (snooper) but doesn't enable cores on
the fabric.

The function of enabling cores on the fabric is called in the
platform_smp_prepare_cpus(), but with no_smp, this function won't be
called anymore, so add the calling function in the smp_init_cpus().

Signed-off-by: Wang Hui <Hui.Wang@windriver.com>
---
 arch/arm/mach-armadaxp/platsmp.c |    1 +
 1 files changed, 1 insertions(+), 0 deletions(-)

diff --git a/arch/arm/mach-armadaxp/platsmp.c b/arch/arm/mach-armadaxp/platsmp.c
index d262aac..d18fdcb 100644
--- a/arch/arm/mach-armadaxp/platsmp.c
+++ b/arch/arm/mach-armadaxp/platsmp.c
@@ -315,6 +315,7 @@ void __init smp_init_cpus(void)
 		set_cpu_possible(i, true);
 	set_smp_cross_call(axp_smp_cross_call);
 
+	initialize_bridge(1);
 }
 
 void __init platform_smp_prepare_cpus(unsigned int max_cpus)
-- 
1.7.0

