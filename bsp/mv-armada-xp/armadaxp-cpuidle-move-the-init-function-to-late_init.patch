From f33be34385b4d866f69c0aa558b60a0a8052b6b9 Mon Sep 17 00:00:00 2001
From: Wang Hui <Hui.Wang@windriver.com>
Date: Fri, 18 Jan 2013 16:30:19 +0800
Subject: [PATCH 37/50] armadaxp: cpuidle: move the init function to late_initcall_sync

In the cpuidle hooker function, it will call fpu_save() and
fpu_restore(), if we call those functions while fpu is not
initialzed, the system will crash.

To guarantee the cpuidle init is called later than fpu_init, we
put cpuidle init to late_initcall_sync.

Signed-off-by: Wang Hui <Hui.Wang@windriver.com>
---
 arch/arm/plat-armada/cpuidle.c |    2 +-
 1 files changed, 1 insertions(+), 1 deletions(-)

diff --git a/arch/arm/plat-armada/cpuidle.c b/arch/arm/plat-armada/cpuidle.c
index 6a064bc..4e6ee9c 100644
--- a/arch/arm/plat-armada/cpuidle.c
+++ b/arch/arm/plat-armada/cpuidle.c
@@ -493,6 +493,6 @@ int armadaxp_init_cpuidle(void)
 	return 0;
 }
 
-device_initcall(armadaxp_init_cpuidle);
+late_initcall_sync(armadaxp_init_cpuidle);
 
 #endif
-- 
1.7.0

