From ed6fdb82cd8614e2056d54a7a8b189f6c7b0e578 Mon Sep 17 00:00:00 2001
From: Wang Hui <Hui.Wang@windriver.com>
Date: Mon, 26 Nov 2012 11:40:32 +0800
Subject: [PATCH 36/50] armadaxp: neta: add net poll interface

Add net poll function to support kgdboe.

Signed-off-by: Wang Hui <Hui.Wang@windriver.com>
---
 .../mv_drivers_lsp/mv_neta/net_dev/mv_netdev.c     |   15 +++++++++++++++
 1 files changed, 15 insertions(+), 0 deletions(-)

diff --git a/arch/arm/plat-armada/mv_drivers_lsp/mv_neta/net_dev/mv_netdev.c b/arch/arm/plat-armada/mv_drivers_lsp/mv_neta/net_dev/mv_netdev.c
index 13a89ef..6c92288 100755
--- a/arch/arm/plat-armada/mv_drivers_lsp/mv_neta/net_dev/mv_netdev.c
+++ b/arch/arm/plat-armada/mv_drivers_lsp/mv_neta/net_dev/mv_netdev.c
@@ -34,6 +34,7 @@ disclaimer.
 #include <linux/skbuff.h>
 #include <linux/inetdevice.h>
 #include <linux/mv_neta.h>
+#include <linux/interrupt.h>
 #include <net/ip.h>
 #include <net/ipv6.h>
 #include <linux/module.h>
@@ -955,6 +956,17 @@ static int mv_eth_set_features(struct net_device *dev, u32 features)
 }
 #endif
 
+#ifdef CONFIG_NET_POLL_CONTROLLER
+void mv_eth_poll_controller(struct net_device *dev)
+{
+	struct eth_port *pp = MV_ETH_PRIV(dev);
+
+	disable_irq(dev->irq);
+	mv_eth_isr(dev->irq, pp);
+	enable_irq(dev->irq);
+}
+#endif
+
 static const struct net_device_ops mv_eth_netdev_ops = {
 	.ndo_open = mv_eth_open,
 	.ndo_stop = mv_eth_stop,
@@ -964,6 +976,9 @@ static const struct net_device_ops mv_eth_netdev_ops = {
 	.ndo_change_mtu = mv_eth_change_mtu,
 	.ndo_tx_timeout = mv_eth_tx_timeout,
 	.ndo_select_queue = mv_eth_select_txq,
+#ifdef CONFIG_NET_POLL_CONTROLLER
+	.ndo_poll_controller	= mv_eth_poll_controller,
+#endif
 #if defined(MV_ETH_PNC_LB) && defined(CONFIG_MV_ETH_PNC)
 	.ndo_set_features = mv_eth_set_features,
 #endif
-- 
1.7.0

