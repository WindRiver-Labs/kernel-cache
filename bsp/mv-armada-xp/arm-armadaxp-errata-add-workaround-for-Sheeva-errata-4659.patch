From 97152e68aaca6b16dedad324e0b457be237304dd Mon Sep 17 00:00:00 2001
From: Wang Hui <Hui.Wang@windriver.com>
Date: Tue, 15 Jan 2013 16:44:53 +0800
Subject: [PATCH 4/5] arm: armadaxp: errata: add workaround for Sheeva errata 4659

Sheeva Errata 4659: Add ISB following L1 I$ Invalidate by MVA.

The code is extracted from linux-3.2.27-axp_a370-2012_Q4.1, which
can be downloaded from:
https://extranet.marvell.com/extranet/dms/documents.do?groupID=4&\
subGroupID=53015

Signed-off-by: Wang Hui <Hui.Wang@windriver.com>
---
 arch/arm/mm/cache-v7.S |    3 +++
 1 files changed, 3 insertions(+), 0 deletions(-)

diff --git a/arch/arm/mm/cache-v7.S b/arch/arm/mm/cache-v7.S
index 8df01c6..ac1ab0b 100644
--- a/arch/arm/mm/cache-v7.S
+++ b/arch/arm/mm/cache-v7.S
@@ -207,6 +207,9 @@ ENTRY(v7_coherent_user_range)
 	bic	r12, r0, r3
 2:
  USER(	mcr	p15, 0, r12, c7, c5, 1	)	@ invalidate I line
+#ifdef CONFIG_SHEEVA_ERRATA_ARM_CPU_4659
+	isb
+#endif
 	add	r12, r12, r2
 	cmp	r12, r1
 	blo	2b
-- 
1.7.0.2

