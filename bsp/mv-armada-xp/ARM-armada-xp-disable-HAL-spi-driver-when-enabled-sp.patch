From a4fe5110a1049d956cb6e6f11b8ddf652fd0a822 Mon Sep 17 00:00:00 2001
From: Jiang Lu <lu.jiang@windriver.com>
Date: Tue, 22 Apr 2014 11:18:05 +0800
Subject: [PATCH 4/5] ARM:armada-xp:disable HAL spi driver when enabled
 spi-orion

When enabled spi-orion spi controller driver, need disable the spi
driver in HAL on armada-xp platform.

Signed-off-by: Jiang Lu <lu.jiang@windriver.com>
---
 arch/arm/mach-armadaxp/export.c |    3 +++
 arch/arm/plat-armada/Kconfig    |    2 +-
 2 files changed, 4 insertions(+), 1 deletions(-)

diff --git a/arch/arm/mach-armadaxp/export.c b/arch/arm/mach-armadaxp/export.c
index 92733f0..08d3328 100644
--- a/arch/arm/mach-armadaxp/export.c
+++ b/arch/arm/mach-armadaxp/export.c
@@ -62,14 +62,17 @@ EXPORT_SYMBOL(mvBoardTdmSpiModeGet);
 EXPORT_SYMBOL(mvBoardTdmSpiCsGet);
 EXPORT_SYMBOL(mvBoardTdmDevicesCountGet);
 
+#ifdef MV_INCLUDE_SPI
 #include "spi/mvSpiCmnd.h"
 EXPORT_SYMBOL(mvSpiWriteThenWrite);
 EXPORT_SYMBOL(mvSpiWriteThenRead);
 #include "spi/mvSpi.h"
 EXPORT_SYMBOL(mvSpiParamsSet);
+#endif
 #include "gpp/mvGpp.h"
 EXPORT_SYMBOL(mvGppValueSet);
 
+
 /*************************************************************************************************************
  * TDM
  *************************************************************************************************************/
diff --git a/arch/arm/plat-armada/Kconfig b/arch/arm/plat-armada/Kconfig
index fd55ab0..6b89bc8 100644
--- a/arch/arm/plat-armada/Kconfig
+++ b/arch/arm/plat-armada/Kconfig
@@ -150,7 +150,7 @@ config MV_INCLUDE_GIG_ETH
 
 config MV_INCLUDE_SPI
 	bool "SPI Support"
-	depends on MV88F6500 || MV88F6281 || (MV78XX0 && !MV78XX0_Z0) || ARMADA_XP || ARMADA_370
+	depends on (MV88F6500 || MV88F6281 || (MV78XX0 && !MV78XX0_Z0) || ARMADA_XP || ARMADA_370) && !SPI_ORION
 	default y
         ---help---
         Please don't change this configs unless you know what you are doing.
-- 
1.7.5.4

