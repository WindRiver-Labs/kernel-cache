From a0b18f13577eb9afd15fe962423ee6bd7f9c4c6b Mon Sep 17 00:00:00 2001
From: Zhong Hongbo <hongbo.zhong@windriver.com>
Date: Mon, 14 Jan 2013 19:52:19 +0800
Subject: [PATCH 3/5] mv_ethernet: Fix nfs server not responding

IRQF_DISABLED is depreciated and useless here, so discard it.

To avoid NFS root issues with the following symptoms:

VFS: Mounted root (nfs filesystem) on device 0:12.
devtmpfs: mounted
Freeing init memory: 300K
nfs: server ${server ip} not responding, still trying
nfs: server ${server ip} not responding, still trying
nfs: server ${server ip} not responding, still trying
nfs: server ${server ip} not responding, still trying
nfs: server ${server ip} not responding, still trying

the Marvel ethernet driver is forced to be non-threaded. This has
limited -rt impact and allows the NFS root to work.

Signed-off-by: Zhong Hongbo <hongbo.zhong@windriver.com>
---
 .../mv_drivers_lsp/mv_neta/net_dev/mv_ethernet.c   |    2 +-
 1 files changed, 1 insertions(+), 1 deletions(-)

diff --git a/arch/arm/plat-armada/mv_drivers_lsp/mv_neta/net_dev/mv_ethernet.c b/arch/arm/plat-armada/mv_drivers_lsp/mv_neta/net_dev/mv_ethernet.c
index 02aa3d1..f6b3ea3 100644
--- a/arch/arm/plat-armada/mv_drivers_lsp/mv_neta/net_dev/mv_ethernet.c
+++ b/arch/arm/plat-armada/mv_drivers_lsp/mv_neta/net_dev/mv_ethernet.c
@@ -101,7 +101,7 @@ static int mv_eth_start(struct net_device *dev)
 
 	if (priv->flags & MV_ETH_F_CONNECT_LINUX) {
 		/* connect to port interrupt line */
-		if (request_irq(dev->irq, mv_eth_isr, (IRQF_DISABLED|IRQF_SAMPLE_RANDOM), "mv_eth", priv)) {
+		if (request_irq(dev->irq, mv_eth_isr, (IRQF_NO_THREAD|IRQF_SAMPLE_RANDOM), "mv_eth", priv)) {
 			printk(KERN_ERR "cannot request irq %d for %s port %d\n", dev->irq, dev->name, priv->port);
 			if (priv->flags & MV_ETH_F_CONNECT_LINUX)
 				napi_disable(priv->napiGroup[CPU_GROUP_DEF]);
-- 
1.7.0

