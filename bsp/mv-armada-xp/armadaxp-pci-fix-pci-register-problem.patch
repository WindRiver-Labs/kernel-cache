From 5caec47c23941ffa71715b4c3c8f4ef58c86d035 Mon Sep 17 00:00:00 2001
From: Wang Hui <Hui.Wang@windriver.com>
Date: Tue, 20 Nov 2012 16:19:17 +0800
Subject: [PATCH 35/50] armadaxp: pci: fix pci register problem

Original code use pci_scan_bus() to scan all pci devices, but this
funcition is deprecated, and this function is already replaced by
pci_scan_root_bus().

Please the comment of pci_scan_bus() in the drivers/pci/probe.c.

Signed-off-by: Wang Hui <Hui.Wang@windriver.com>
---
 arch/arm/mach-armadaxp/pci.c |    2 +-
 arch/arm/mach-armadaxp/pex.c |    2 +-
 2 files changed, 2 insertions(+), 2 deletions(-)

diff --git a/arch/arm/mach-armadaxp/pci.c b/arch/arm/mach-armadaxp/pci.c
index d00793b..2476456 100644
--- a/arch/arm/mach-armadaxp/pci.c
+++ b/arch/arm/mach-armadaxp/pci.c
@@ -209,7 +209,7 @@ struct pci_bus *mv_pci_scan_bus(int nr, struct pci_sys_data *sys)
 		panic("Single PCI is supported ONLY!");
 
 	ops = &mv_pci_ops;
-	bus = pci_scan_bus(sys->busnr, ops, sys);
+	bus = pci_scan_root_bus(NULL, sys->busnr, ops, sys, &sys->resources);
 	return bus;
 }
 
diff --git a/arch/arm/mach-armadaxp/pex.c b/arch/arm/mach-armadaxp/pex.c
index 6063cd2..6e558c7 100644
--- a/arch/arm/mach-armadaxp/pex.c
+++ b/arch/arm/mach-armadaxp/pex.c
@@ -313,7 +313,7 @@ struct pci_bus *mv_pex_scan_bus(int nr, struct pci_sys_data *sys)
 	MV_BOARD_PEX_INFO* boardPexInfo = mvBoardPexInfoGet();
 	MV_U32 pexNextHWInf, ifnum;
 
-	bus = pci_scan_bus(sys->busnr, ops, sys);
+	bus = pci_scan_root_bus(NULL, sys->busnr, ops, sys, &sys->resources);
 
 	/* Set the bus number in the following controller */
 	for (ifnum = (nr+1); ifnum < boardPexInfo->boardPexIfNum; ifnum++) {
-- 
1.7.0

