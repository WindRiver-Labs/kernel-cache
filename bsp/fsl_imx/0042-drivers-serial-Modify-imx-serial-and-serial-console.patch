From 7de5d672484d8d3f24caf03052ee3cbf96fbc847 Mon Sep 17 00:00:00 2001
From: Wang Hui <Hui.Wang@windriver.com>
Date: Wed, 2 Sep 2009 15:22:07 +0800
Subject: [PATCH] drivers/serial: Modify imx serial and serial console driver

Modify the imx serial driver to support i.MX5 MCU.

Signed-off-by: Wang Hui <Hui.Wang@windriver.com>
---
 drivers/serial/imx.c |   15 ++++++++++-----
 1 files changed, 10 insertions(+), 5 deletions(-)

diff --git a/drivers/serial/imx.c b/drivers/serial/imx.c
index 3f90f1b..59a9af1 100644
--- a/drivers/serial/imx.c
+++ b/drivers/serial/imx.c
@@ -62,7 +62,8 @@
 #define UBIR  0xa4 /* BRM Incremental Register */
 #define UBMR  0xa8 /* BRM Modulator Register */
 #define UBRC  0xac /* Baud Rate Count Register */
-#if defined CONFIG_ARCH_MX3 || defined CONFIG_ARCH_MX2
+#if defined CONFIG_ARCH_MX3 || defined CONFIG_ARCH_MX2 || \
+    defined CONFIG_ARCH_MX5
 #define ONEMS 0xb0 /* One Millisecond register */
 #define UTS   0xb4 /* UART Test Register */
 #endif
@@ -99,7 +100,8 @@
 #ifdef CONFIG_ARCH_IMX
 #define  UCR1_UARTCLKEN  (1<<2)	 /* UART clock enabled */
 #endif
-#if defined CONFIG_ARCH_MX3 || defined CONFIG_ARCH_MX2
+#if defined CONFIG_ARCH_MX3 || defined CONFIG_ARCH_MX2 || \
+    defined CONFIG_ARCH_MX5
 #define  UCR1_UARTCLKEN  (0)	 /* not present on mx2/mx3 */
 #endif
 #define  UCR1_DOZE       (1<<1)	 /* Doze */
@@ -131,7 +133,8 @@
 #define  UCR3_REF25 	 (1<<3)  /* Ref freq 25 MHz, only on mx1 */
 #define  UCR3_REF30 	 (1<<2)  /* Ref Freq 30 MHz, only on mx1 */
 #endif
-#if defined CONFIG_ARCH_MX2 || defined CONFIG_ARCH_MX3
+#if defined CONFIG_ARCH_MX2 || defined CONFIG_ARCH_MX3 || \
+    defined CONFIG_ARCH_MX5
 #define  UCR3_RXDMUXSEL	 (1<<2)  /* RXD Muxed Input Select, on mx2/mx3 */
 #endif
 #define  UCR3_INVT  	 (1<<1)  /* Inverted Infrared transmission */
@@ -187,7 +190,8 @@
 #define MAX_INTERNAL_IRQ	IMX_IRQS
 #endif
 
-#if defined CONFIG_ARCH_MX3 || defined CONFIG_ARCH_MX2
+#if defined CONFIG_ARCH_MX3 || defined CONFIG_ARCH_MX2 || \
+    defined CONFIG_ARCH_MX5
 #define SERIAL_IMX_MAJOR        207
 #define MINOR_START	        16
 #define DEV_NAME		"ttymxc"
@@ -603,7 +607,8 @@ static int imx_startup(struct uart_port *port)
 	temp |= (UCR2_RXEN | UCR2_TXEN);
 	writel(temp, sport->port.membase + UCR2);
 
-#if defined CONFIG_ARCH_MX2 || defined CONFIG_ARCH_MX3
+#if defined CONFIG_ARCH_MX2 || defined CONFIG_ARCH_MX3 || \
+					defined CONFIG_ARCH_MX5
 	temp = readl(sport->port.membase + UCR3);
 	temp |= UCR3_RXDMUXSEL;
 	writel(temp, sport->port.membase + UCR3);
-- 
1.5.5.1

