From 3f35b1380d88d87bf2beb0b6648beea03f496230 Mon Sep 17 00:00:00 2001
From: henry shao <hshao@netlogicmicro.com>
Date: Tue, 28 Dec 2010 01:55:12 -0800
Subject: [PATCH 255/761] modify Makefile Kconfig and platform.c to support
 spi_xlp host driver

Based on Broadcom SDK 2.3.

Signed-off-by: henry shao <hshao@netlogicmicro.com>
Signed-off-by: Yanjiang Jin <yanjiang.jin@windriver.com>
---
 arch/mips/netlogic/xlp/platform.c |    1 +
 drivers/spi/Kconfig               |    7 +++++++
 drivers/spi/Makefile              |    5 ++++-
 3 files changed, 12 insertions(+), 1 deletion(-)

diff --git a/arch/mips/netlogic/xlp/platform.c b/arch/mips/netlogic/xlp/platform.c
index 5239afe..cd402eb 100644
--- a/arch/mips/netlogic/xlp/platform.c
+++ b/arch/mips/netlogic/xlp/platform.c
@@ -135,6 +135,7 @@ struct dev2drv dev2drv_table[MAX_DEV2DRV] = {
 	{XLP_DEVID_UART, "serial8250",	11,	0,	PLAT_DRV},
 	{XLP_DEVID_I2C,	 "i2c-xlp",	8,	0, 	PLAT_DRV},
 	{XLP_DEVID_MMC,	 "mmc-xlp",	8,	0, 	PLAT_DRV},
+	{XLP_DEVID_SPI,	 "spi-xlp",	8,	0, 	PLAT_DRV},
 	{0x0, 			 "",	0,	0,	PLAT_DRV},
 };
 
diff --git a/drivers/spi/Kconfig b/drivers/spi/Kconfig
index 00c0240..f280363 100644
--- a/drivers/spi/Kconfig
+++ b/drivers/spi/Kconfig
@@ -403,6 +403,13 @@ config SPI_NUC900
 	help
 	  SPI driver for Nuvoton NUC900 series ARM SoCs
 
+config SPI_XLP
+	tristate "Netlogic XLP SPI controller"
+	depends on NLM_XLP
+	select SPI_BITBANG
+	help
+	  SPI driver for Netlogic XLP MIPS SoCs
+
 #
 # Add new SPI master controllers in alphabetical order above this line
 #
diff --git a/drivers/spi/Makefile b/drivers/spi/Makefile
index 9d75d21..facf6a8 100644
--- a/drivers/spi/Makefile
+++ b/drivers/spi/Makefile
@@ -1,6 +1,9 @@
 #
 # Makefile for kernel SPI drivers.
 #
+ifeq ($(CONFIG_NLM_XLP),y)
+EXTRA_CFLAGS := $(CFLAGS) -DNLM_HAL_LINUX_KERNEL
+endif
 
 ccflags-$(CONFIG_SPI_DEBUG) := -DDEBUG
 
@@ -62,4 +65,4 @@ obj-$(CONFIG_SPI_TLE62X0)		+= spi-tle62x0.o
 obj-$(CONFIG_SPI_TOPCLIFF_PCH)		+= spi-topcliff-pch.o
 obj-$(CONFIG_SPI_TXX9)			+= spi-txx9.o
 obj-$(CONFIG_SPI_XILINX)		+= spi-xilinx.o
-
+obj-$(CONFIG_SPI_XLP)			+= spi_xlp.o
-- 
1.7.10.4

