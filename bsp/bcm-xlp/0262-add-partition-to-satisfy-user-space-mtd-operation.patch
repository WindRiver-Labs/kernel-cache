From 5a67365513fe9be70f019df28c0479ecdfb58646 Mon Sep 17 00:00:00 2001
From: henry shao <hshao@netlogicmicro.com>
Date: Thu, 21 Apr 2011 19:47:00 -0700
Subject: [PATCH 262/762] add partition to satisfy user space mtd operation

Based on Broadcom SDK 2.3.

Signed-off-by: henry shao <hshao@netlogicmicro.com>
Signed-off-by: Yanjiang Jin <yanjiang.jin@windriver.com>
---
 drivers/mtd/devices/m25p80.c |   12 ++++++++++++
 1 files changed, 12 insertions(+), 0 deletions(-)

diff --git a/drivers/mtd/devices/m25p80.c b/drivers/mtd/devices/m25p80.c
index 4bd4ef8..b44b464 100644
--- a/drivers/mtd/devices/m25p80.c
+++ b/drivers/mtd/devices/m25p80.c
@@ -794,6 +794,13 @@ static const struct spi_device_id *__devinit jedec_probe(struct spi_device *spi)
 }
 
 #ifdef CONFIG_NLM_XLP
+static struct mtd_partition xlp_spi_parti[] = {
+        {
+                .name = "SPI NOR FLASH",
+                .offset = 0x00000000,
+                .size = MTDPART_SIZ_FULL,
+        }
+};
 static void m25p_test(struct m25p * flash)
 {
 	int i, xfer_len;
@@ -1001,6 +1008,11 @@ static int __devinit m25p_probe(struct spi_device *spi)
 	/* partitions should match sector boundaries; and it may be good to
 	 * use readonly partitions for writeprotected sectors (BP2..BP0).
 	 */
+#ifdef CONFIG_NLM_XLP
+	if (data == NULL)
+		return mtd_device_parse_register(&flash->mtd, NULL, &ppdata,
+				xlp_spi_parti, ARRAY_SIZE(xlp_spi_parti));
+#endif
 	return mtd_device_parse_register(&flash->mtd, NULL, &ppdata,
 			data ? data->parts : NULL,
 			data ? data->nr_parts : 0);
-- 
1.7.0.4

