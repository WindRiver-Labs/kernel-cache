From c1e8bbd9b6452b36e0a54f6e445d86b9e5d6e7d2 Mon Sep 17 00:00:00 2001
From: reshmic <reshmic@broadcom.com>
Date: Mon, 3 Dec 2012 15:20:08 +0530
Subject: [PATCH 739/761] bcm_xlp: SAE: drivers/crypto/sae :

program the frequency of sae with the value given in fdt.

Based on Broadcom SDK 2.3.

Signed-off-by: reshmic <reshmic@broadcom.com>
Signed-off-by: Yanjiang Jin <yanjiang.jin@windriver.com>
---
 drivers/crypto/sae/nlm_crypto.c |   13 +++++++++++++
 1 file changed, 13 insertions(+)

diff --git a/drivers/crypto/sae/nlm_crypto.c b/drivers/crypto/sae/nlm_crypto.c
index ff659a8..afb8ff6 100644
--- a/drivers/crypto/sae/nlm_crypto.c
+++ b/drivers/crypto/sae/nlm_crypto.c
@@ -708,10 +708,23 @@ nlm_crypto_init(void)
 
 static void  init_sae(void)
 {
+	extern void *fdt;
+	int freq;
+	int node;
+
+	freq = nlm_hal_get_fdt_freq(fdt, NLM_SAE);
+
+	for_each_node(node) {
+
+		nlm_hal_set_sae_freq(node, freq);
+		nlm_hal_set_sae_engine_sel(node);
+	}
+
 	if( is_nlm_xlp2xx())
 		chip_feature = (ZUC | DES3_KEY_SWAP); 
 	else
 		chip_feature = 0x0;
+
 }
 
     static int __init
-- 
1.7.10.4

