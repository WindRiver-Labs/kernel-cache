From 2e73ad0d67b54b6c9c6815703fb5764913b0d6fd Mon Sep 17 00:00:00 2001
From: Lakshan Dias <ldias@broadcom.com>
Date: Fri, 8 Mar 2013 16:29:13 -0800
Subject: [PATCH 697/761] nae: add necessary delay between PMA register writes

Based on Broadcom SDK 2.3.

Signed-off-by: Lakshan Dias <ldias@broadcom.com>
Signed-off-by: Yanjiang Jin <yanjiang.jin@windriver.com>
---
 arch/mips/netlogic/common/nlm_hal_nae.c |    4 ++++
 1 file changed, 4 insertions(+)

diff --git a/arch/mips/netlogic/common/nlm_hal_nae.c b/arch/mips/netlogic/common/nlm_hal_nae.c
index 6588d45..3219d8c 100644
--- a/arch/mips/netlogic/common/nlm_hal_nae.c
+++ b/arch/mips/netlogic/common/nlm_hal_nae.c
@@ -288,24 +288,28 @@ int xlp3xx_8xxb0_nae_lane_reset_txpll(int node, int block, int lane_ctrl, int mo
 	val &= ~( (1 << 29) | (0x7ffff));
 	nlm_hal_write_mac_reg(node, block, PHY, lane_ctrl, val);
 	NAE_DEBUG("PHY LANE CTRL REG that was just written is :  %x\n",  nlm_hal_read_mac_reg(node, block, PHY, lane_ctrl));
+	nlm_mdelay(1);
 
 	NAE_DEBUG("Setting the PMA Register Bit(Bit 20)\n");
 	val = nlm_hal_read_mac_reg(node, block, PHY, lane_ctrl);
 	val |= 0x100000;  /* Bit20: serdes reg reset Storm & Eagle B0 */
 	nlm_hal_write_mac_reg(node, block, PHY, lane_ctrl,val);
 	NAE_DEBUG("PHY LANE CTRL REG that was just written is :  %x\n",  nlm_hal_read_mac_reg(node, block, PHY, lane_ctrl));
+	nlm_mdelay(1);
 
 	NAE_DEBUG("Setting PMA Controller reset bit(Bit 30)\n");
 	val = nlm_hal_read_mac_reg(node, block, PHY, lane_ctrl);
 	val |= 0x40000000; /* Unset the reset (inverse logic) : Bit30: epcs reset */
 	nlm_hal_write_mac_reg(node, block, PHY, lane_ctrl,val);
 	NAE_DEBUG("PHY LANE CTRL REG that was just written is :  %x\n",  nlm_hal_read_mac_reg(node, block, PHY, lane_ctrl));
+	nlm_mdelay(1);
 
 	/* Setting Rext_Sel*/
 	val = nlm_hal_read_mac_reg(node, block, PHY, lane_ctrl);
 	val |= rext_sel;
 	nlm_hal_write_mac_reg(node, block, PHY, lane_ctrl,val);
 	NAE_DEBUG("Setting the Rext_sel register\n");
+	nlm_mdelay(1);
 
 	while ((nlm_hal_read_mac_reg(node, block, PHY, (lane_ctrl - 4)) & (PHY_LANE_STAT_PCR)) != (PHY_LANE_STAT_PCR) && count!=count_max)
 	{
-- 
1.7.10.4

