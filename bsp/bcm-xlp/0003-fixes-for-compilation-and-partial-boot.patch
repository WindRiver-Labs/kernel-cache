From 0ec1af8e6a83bcf7c0928fa9effa6e94a5a04116 Mon Sep 17 00:00:00 2001
From: Venu Vadapalli <vvadapalli@netlogicmicro.com>
Date: Sat, 27 Feb 2010 18:18:18 -0800
Subject: [PATCH 003/762] fixes for compilation and partial boot

Based on Broadcom SDK 2.3.

Signed-off-by: Venu Vadapalli <vvadapalli@netlogicmicro.com>
Signed-off-by: Yanjiang Jin <yanjiang.jin@windriver.com>
---
 arch/mips/kernel/asm-offsets.c |    6 ++++++
 arch/mips/rmi/xlp/mmu.c        |    8 ++++++++
 2 files changed, 14 insertions(+), 0 deletions(-)

diff --git a/arch/mips/kernel/asm-offsets.c b/arch/mips/kernel/asm-offsets.c
index 420565e..6e0589b 100644
--- a/arch/mips/kernel/asm-offsets.c
+++ b/arch/mips/kernel/asm-offsets.c
@@ -18,6 +18,12 @@
 #include <asm/ptrace.h>
 #include <asm/processor.h>
 
+#ifdef CONFIG_PAGE_SIZE_64KB
+#include <asm-generic/pgtable-nopmd.h>
+#else
+#include <asm-generic/pgtable-nopud.h>
+#endif
+
 void output_ptreg_defines(void)
 {
 	COMMENT("MIPS pt_regs offsets.");
diff --git a/arch/mips/rmi/xlp/mmu.c b/arch/mips/rmi/xlp/mmu.c
index b685ec5..8fe6408 100644
--- a/arch/mips/rmi/xlp/mmu.c
+++ b/arch/mips/rmi/xlp/mmu.c
@@ -6,6 +6,12 @@
 #include <asm/page.h>
 #include <asm/pgtable.h>
 
+#ifdef CONFIG_PAGE_SIZE_64KB
+#include <asm-generic/pgtable-nopmd.h>
+#else
+#include <asm-generic/pgtable-nopud.h>
+#endif
+
 #define READ_INHIBIT (1 << 31)
 #define EXEC_INHIBIT (1 << 30)
 
@@ -78,6 +84,8 @@ static int pgtable_levels = PGD | PMD | PTE;
 static int pgtable_levels = PGD | PTE;
 #endif
 
+#define _PMD_T_LOG2 3 /* PMD_T_LOG2	 # */
+
 void pgwalker_init(void)
 {
 	unsigned int value;
-- 
1.7.0.4

