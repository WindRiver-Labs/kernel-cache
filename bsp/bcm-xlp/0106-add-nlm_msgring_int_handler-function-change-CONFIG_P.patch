From 4b1ba5806541cf80ac0163afb98b5142a3befabb Mon Sep 17 00:00:00 2001
From: henry shao <hshao@netlogicmicro.com>
Date: Wed, 7 Jul 2010 18:10:03 -0700
Subject: [PATCH 106/762] add nlm_msgring_int_handler function, change CONFIG_PHOENIX_IP_FLOW_AFFINITY to CONFIG_NLMCOMMON_IP_FLOW_AFFINITY

Based on Broadcom SDK 2.3.

Signed-off-by: henry shao <hshao@netlogicmicro.com>
Signed-off-by: Yanjiang Jin <yanjiang.jin@windriver.com>
---
 arch/mips/netlogic/xlr/irq.c |   15 +++++++++++----
 1 files changed, 11 insertions(+), 4 deletions(-)

diff --git a/arch/mips/netlogic/xlr/irq.c b/arch/mips/netlogic/xlr/irq.c
index 7bddaa0..f31019d 100644
--- a/arch/mips/netlogic/xlr/irq.c
+++ b/arch/mips/netlogic/xlr/irq.c
@@ -59,7 +59,7 @@ THE POSSIBILITY OF SUCH DAMAGE.
 
 /* Externs */
 extern void xlr_timer_interrupt(struct pt_regs *regs, int irq);
-
+extern void nlm_xlr_msgring_int_handler(unsigned int irq, struct pt_regs *regs);
 #ifdef XLP_MERGE_TODO
 extern void xlr_smp_time_init(void);
 #endif
@@ -397,7 +397,7 @@ extern void nlm_smp_resched_ipi_handler(unsigned int irq,
 					struct irq_desc *desc);
 extern void nlm_ip_flow_ipi_handler(unsigned int irq, 
 						struct irq_desc *desc);
-extern void nlm_msgring_int_handler(unsigned int irq, struct irq_desc *desc);
+void nlm_msgring_int_handler(unsigned int irq, struct irq_desc *desc);
 
 void __init init_xlr_irqs(void)
 {
@@ -422,13 +422,13 @@ void __init init_xlr_irqs(void)
 	phnx_irq_mask |=
 	    ((1ULL << IRQ_IPI_SMP_FUNCTION) | (1ULL << IRQ_IPI_SMP_RESCHEDULE));
 
-#ifdef CONFIG_PHOENIX_IP_FLOW_AFFINITY
+#ifdef CONFIG_NLMCOMMON_IP_FLOW_AFFINITY
 	/* PR: New IPI added here for netrx balancing */
 	irq_desc[IRQ_IPI_NETRX].chip = &phnx_rsvd_pic;
 	irq_desc[IRQ_IPI_NETRX].action = &xlr_rsvd_action;
 	phnx_irq_mask |= (1ULL << IRQ_IPI_NETRX);
 	set_irq_handler(IRQ_IPI_NETRX, nlm_ip_flow_ipi_handler);
-#endif				/* CONFIG_PHOENIX_IP_FLOW_AFFINITY */
+#endif				/* CONFIG_NLMCOMMON_IP_FLOW_AFFINITY */
 
 #endif
 
@@ -643,3 +643,10 @@ void pic_setup_threadmask(unsigned int irt, uint32_t mask)
  	netlogic_write_reg(mmio, PIC_IRT_0_BASE + irt, mask);
 	return;
 }
+
+void nlm_msgring_int_handler(unsigned int irq, struct irq_desc *desc)
+{
+        struct pt_regs *pt_regs = current_thread_info()->regs;
+
+        nlm_xlr_msgring_int_handler(irq, pt_regs);
+}
-- 
1.7.0.4

