From 39cb99452131e2e65a2cc1695fc59c0190a55712 Mon Sep 17 00:00:00 2001
From: Jack Tan <jiankemeng@gmail.com>
Date: Thu, 26 Jun 2014 22:20:10 +0800
Subject: [PATCH] bcm-xlp2: fixup i2c build error in cgl

Signed-off-by: Jack Tan <jack.tan@windriver.com>
Signed-off-by: Jack Tan <jiankemeng@gmail.com>
---
 drivers/i2c/busses/i2c-xlp9xx.c |    3 ++-
 drivers/i2c/i2c-core.c          |    4 ++--
 2 files changed, 4 insertions(+), 3 deletions(-)

diff --git a/drivers/i2c/busses/i2c-xlp9xx.c b/drivers/i2c/busses/i2c-xlp9xx.c
index d9203d3..dfaaca7 100644
--- a/drivers/i2c/busses/i2c-xlp9xx.c
+++ b/drivers/i2c/busses/i2c-xlp9xx.c
@@ -42,7 +42,7 @@
 #include <linux/i2c.h>
 #include <linux/io.h>
 #include <linux/platform_device.h>
-#include <linux/of_i2c.h>
+//#include <linux/of_i2c.h>
 
 #include <asm/netlogic/haldefs.h>
 #include <asm/netlogic/xlp-hal/iomap.h>
@@ -419,6 +419,7 @@ static int xlp9xx_i2c_of_probe(struct platform_device *pdev,
 #define xlp9xx_i2c_of_probe(pdev,i2c) -ENODEV
 #endif
 
+extern void of_i2c_register_devices(struct i2c_adapter *adap);
 
 static int xlp9xx_i2c_probe(struct platform_device *pdev)
 {
diff --git a/drivers/i2c/i2c-core.c b/drivers/i2c/i2c-core.c
index a4dfba8..f7e3f9f 100644
--- a/drivers/i2c/i2c-core.c
+++ b/drivers/i2c/i2c-core.c
@@ -963,7 +963,7 @@ static void i2c_scan_static_board_info(struct i2c_adapter *adapter)
 /* OF support code */
 
 #if IS_ENABLED(CONFIG_OF)
-static void of_i2c_register_devices(struct i2c_adapter *adap)
+void of_i2c_register_devices(struct i2c_adapter *adap)
 {
 	void *result;
 	struct device_node *node;
@@ -1055,7 +1055,7 @@ struct i2c_adapter *of_find_i2c_adapter_by_node(struct device_node *node)
 }
 EXPORT_SYMBOL(of_find_i2c_adapter_by_node);
 #else
-static void of_i2c_register_devices(struct i2c_adapter *adap) { }
+void of_i2c_register_devices(struct i2c_adapter *adap) { }
 #endif /* CONFIG_OF */
 
 /* ACPI support code */
-- 
1.7.9.5

