From 8c9c237ec9a7800b5393e6f97690ca9a27348bde Mon Sep 17 00:00:00 2001
From: Jayachandran C <jchandra@broadcom.com>
Date: Wed, 22 May 2013 19:12:33 +0530
Subject: [PATCH 014/163] MIPS: Support for SWIOTLB in default dma operations

Provide default implentation of phys_to_dma and dma_to_phys in
dma_coherence.h and setup the dma_length in mips_dma_map_sg.

Signed-off-by: Jayachandran C <jchandra@broadcom.com>
Signed-off-by: Jack Tan <jack.tan@windriver.com>
---
 arch/mips/mm/dma-default.c |    3 +++
 1 file changed, 3 insertions(+)

diff --git a/arch/mips/mm/dma-default.c b/arch/mips/mm/dma-default.c
index caf92ec..aaccf1c 100644
--- a/arch/mips/mm/dma-default.c
+++ b/arch/mips/mm/dma-default.c
@@ -246,6 +246,9 @@ static int mips_dma_map_sg(struct device *dev, struct scatterlist *sg,
 		if (!plat_device_is_coherent(dev))
 			__dma_sync(sg_page(sg), sg->offset, sg->length,
 				   direction);
+#ifdef CONFIG_NEED_SG_DMA_LENGTH
+		sg->dma_length = sg->length;
+#endif
 		sg->dma_address = plat_map_dma_mem_page(dev, sg_page(sg)) +
 				  sg->offset;
 	}
-- 
1.7.9.5

