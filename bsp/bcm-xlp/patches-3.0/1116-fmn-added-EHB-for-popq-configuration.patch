From 18b9c2e08004e55f1d844b5961efddc4c1257765 Mon Sep 17 00:00:00 2001
From: Saswat Dash <saswat.dash@broadcom.com>
Date: Mon, 3 Feb 2014 15:19:14 +0530
Subject: [PATCH 116/163] fmn: added EHB for popq configuration

Signed-off-by: Jack Tan <jack.tan@windriver.com>
---
 arch/mips/netlogic/lib/fmnlib/nlm_hal_fmn.h |    3 +++
 1 file changed, 3 insertions(+)

diff --git a/arch/mips/netlogic/lib/fmnlib/nlm_hal_fmn.h b/arch/mips/netlogic/lib/fmnlib/nlm_hal_fmn.h
index 95b2c8e..0bf80f4 100644
--- a/arch/mips/netlogic/lib/fmnlib/nlm_hal_fmn.h
+++ b/arch/mips/netlogic/lib/fmnlib/nlm_hal_fmn.h
@@ -180,6 +180,8 @@ static inline unsigned long long nlh_qid_to_virt_addr(int node, int reg, int sel
 #define nlm_hal_write_outq_config(node, qid, val) \
 	nlh_write_cfg_reg64(nlh_qid_to_virt_addr(node, XLP_OUTQ_CONFIG_REG, qid), val)
 
+#define _ehb() __asm__ __volatile__("ehb" : : : "memory")
+
 /* */
 #define xlp_enable(flags)                        \
 do {                                                \
@@ -239,6 +241,7 @@ static inline int nlm_hal_pop_cfg_update (uint32_t vc_mask)
 	config &= ~(0x1e);
 	config |= vc;
 	xlp_write_config(config);
+	_ehb();
 
 	return 0;
 }
-- 
1.7.9.5

