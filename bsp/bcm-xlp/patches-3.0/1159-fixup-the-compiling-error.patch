From 37c6be7ea88d5f83d92708175da30bf69d664449 Mon Sep 17 00:00:00 2001
From: Jack Tan <jack.tan@windriver.com>
Date: Thu, 19 Jun 2014 11:24:45 +0800
Subject: [PATCH 159/160] fixup the compiling error

rebase to sdk 3.0.2

Signed-off-by: Jack Tan <jack.tan@windriver.com>
Signed-off-by: Jack Tan <jiankemeng@gmail.com>
---
 arch/mips/include/asm/netlogic/xlp-hal/xlp.h |    7 +++++++
 arch/mips/netlogic/xlp/dt.c                  |    3 +++
 arch/mips/pci/pci-xlp.c                      |    8 ++++----
 drivers/char/hw_random/netlogic-rng.c        |    6 +++---
 drivers/watchdog/nlm_common_wdt.c            |    6 +++---
 5 files changed, 20 insertions(+), 10 deletions(-)

diff --git a/arch/mips/include/asm/netlogic/xlp-hal/xlp.h b/arch/mips/include/asm/netlogic/xlp-hal/xlp.h
index ac2b6a8..7948d1e 100644
--- a/arch/mips/include/asm/netlogic/xlp-hal/xlp.h
+++ b/arch/mips/include/asm/netlogic/xlp-hal/xlp.h
@@ -127,5 +127,12 @@ static inline int cpu_is_xlp9xx(void)
 	return chip == PRID_IMP_NETLOGIC_XLP9XX ||
 		chip == PRID_IMP_NETLOGIC_XLP5XX;
 }
+
+static inline int cpu_is_xlp2xx(void)
+{
+	int chip = read_c0_prid() & 0xff00;
+
+	return chip == PRID_IMP_NETLOGIC_XLP2XX;
+}
 #endif /* !__ASSEMBLY__ */
 #endif /* _ASM_NLM_XLP_H */
diff --git a/arch/mips/netlogic/xlp/dt.c b/arch/mips/netlogic/xlp/dt.c
index 2010ef3..6f011b2 100644
--- a/arch/mips/netlogic/xlp/dt.c
+++ b/arch/mips/netlogic/xlp/dt.c
@@ -43,6 +43,9 @@
 extern u32 __dtb_xlp_evp_begin[], __dtb_xlp_svp_begin[],
 	__dtb_xlp_fvp_begin[], __dtb_xlp_gvp_begin[], __dtb_start[];
 
+void *fdt;
+EXPORT_SYMBOL(fdt);
+
 void __init *xlp_dt_init(void *fdtp)
 {
 	if (!fdtp) {
diff --git a/arch/mips/pci/pci-xlp.c b/arch/mips/pci/pci-xlp.c
index 12a20ba..0fe8c42 100644
--- a/arch/mips/pci/pci-xlp.c
+++ b/arch/mips/pci/pci-xlp.c
@@ -440,10 +440,10 @@ static int __init xlp_pci_hot_reset_init(void)
 	uint32_t irq, pciintenable;
 
 	if(!(cpu_is_xlp2xx()))
-	  {
-		  pr_err("Hot Reset not handled\n");
-		  return 0;
-	  }
+	{
+		pr_err("Hot Reset not handled\n");
+		return 0;
+	}
 	pr_info("Sysreg is 0x%x \n", sysreg);
 	if(((sysreg >> 8) & 0xf) & 0x1)
 	{
diff --git a/drivers/char/hw_random/netlogic-rng.c b/drivers/char/hw_random/netlogic-rng.c
index 30878e7..87bb35d 100644
--- a/drivers/char/hw_random/netlogic-rng.c
+++ b/drivers/char/hw_random/netlogic-rng.c
@@ -211,7 +211,7 @@ static int nlm_drng_read(struct hwrng *rng, void *buffer,
 	return count;
 }
 
-static int __devinit nlm_drng_probe(struct platform_device *pdev)
+static int nlm_drng_probe(struct platform_device *pdev)
 {
 	int ret = 0;
 	struct xlp_rng_data_priv *priv;
@@ -274,7 +274,7 @@ out:
 
 }
 
-static int __devexit nlm_drng_remove(struct platform_device *pdev)
+static int nlm_drng_remove(struct platform_device *pdev)
 {
 	struct xlp_rng_data_priv *priv = platform_get_drvdata(pdev);
 	devm_kfree(&pdev->dev, priv);
@@ -288,7 +288,7 @@ static const struct of_device_id nlm_drng_match[] = {
 
 static struct platform_driver nlm_drng_driver = {
 	.probe		= nlm_drng_probe,
-	.remove		= __devexit_p(nlm_drng_remove),
+	.remove		= nlm_drng_remove,
 	.driver		= {
 		.name	= "nlm-drng",
 		.owner	= THIS_MODULE,
diff --git a/drivers/watchdog/nlm_common_wdt.c b/drivers/watchdog/nlm_common_wdt.c
index 73cf2ea..9b1ee1b 100644
--- a/drivers/watchdog/nlm_common_wdt.c
+++ b/drivers/watchdog/nlm_common_wdt.c
@@ -253,7 +253,7 @@ static struct watchdog_device nlm_wdt_wdd = {
 
 /* hotplug */
 
-static int __devinit nlm_wdt_probe(struct platform_device *pdev)
+static int nlm_wdt_probe(struct platform_device *pdev)
 {
 
 	struct nlm_wdt_data *wdt;
@@ -307,7 +307,7 @@ free_out:
 
 }
 
-static int __devexit nlm_wdt_remove(struct platform_device *pdev)
+static int nlm_wdt_remove(struct platform_device *pdev)
 {
 	struct nlm_wdt_data *wdt = dev_get_drvdata(&pdev->dev);
 
@@ -329,7 +329,7 @@ static const struct of_device_id nlm_wdt_match[] = {
 
 static struct platform_driver nlm_wdt_driver = {
 	.probe = nlm_wdt_probe,
-	.remove = __devexit_p(nlm_wdt_remove),
+	.remove = nlm_wdt_remove,
 	.driver = {
 		.owner = THIS_MODULE,
 		.name = "nlm-wdt",
-- 
1.7.9.5

