From 6389072c146f19704ee5cd3fa676df215612864c Mon Sep 17 00:00:00 2001
From: Jack Tan <jack.tan@windriver.com>
Date: Fri, 14 Mar 2014 14:05:03 +0800
Subject: [PATCH 3/7] bcm-xlp: make NAE MAC address to follow SMSC911X

For all XLP on-board Ethernet ports, include SMSC911X and NAE, Kernel
generates a series of continual MAC addresses according to the value
of U-BOOT parameter "ethaddr".
SMSC911X always occupies the first MAC address on XLP2XX/3XX, so make NAE MAC
addresses to follow it. Else system would get the duplicate MAC addresses on
SMSC911X and the first NAE port.

Signed-off-by: Yanjiang Jin <yanjiang.jin@windriver.com>
Signed-off-by: Jack Tan <jack.tan@windriver.com>
---
 drivers/netlogic/nae/xlpge_board.c |    5 +++++
 1 file changed, 5 insertions(+)

diff --git a/drivers/netlogic/nae/xlpge_board.c b/drivers/netlogic/nae/xlpge_board.c
index bf5c3ee..9fdd795 100644
--- a/drivers/netlogic/nae/xlpge_board.c
+++ b/drivers/netlogic/nae/xlpge_board.c
@@ -77,6 +77,11 @@ void gen_mac_address(void)
         if( ((mac0_set | mac1_set) && if_mac_set) == 0){
                 random_ether_addr(mac_base);
         }
+
+	/* SMSC911X occupies the first MAC address on XLP2XX/3XX */
+	if (is_nlm_xlp3xx() || is_nlm_xlp2xx())
+		mac_base[5] += 1;
+
 	for(i=0 ; i<NLM_MAX_NODES; i++){ /*poppulate the eth_hw_add array according to the get mac address*/
                 for(j=0;j<18;j++){
                         memcpy(eth_hw_addr[i][j], mac_base, 6);
-- 
1.7.9.5

