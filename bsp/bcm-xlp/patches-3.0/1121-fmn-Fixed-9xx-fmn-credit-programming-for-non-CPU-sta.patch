From 50645be9d309787484b2021198e14d6bd6444d91 Mon Sep 17 00:00:00 2001
From: Virendra Pathak <vpathak@broadcom.com>
Date: Fri, 21 Feb 2014 12:19:22 +0530
Subject: [PATCH 121/160] fmn: Fixed 9xx fmn credit programming for non CPU
 stations

Signed-off-by: Jack Tan <jack.tan@windriver.com>
Signed-off-by: Jack Tan <jiankemeng@gmail.com>
---
 arch/mips/netlogic/lib/fmnlib/nlm_hal_fmn_config.c |    6 +++++-
 1 file changed, 5 insertions(+), 1 deletion(-)

diff --git a/arch/mips/netlogic/lib/fmnlib/nlm_hal_fmn_config.c b/arch/mips/netlogic/lib/fmnlib/nlm_hal_fmn_config.c
index 6882a87..2dfc858 100644
--- a/arch/mips/netlogic/lib/fmnlib/nlm_hal_fmn_config.c
+++ b/arch/mips/netlogic/lib/fmnlib/nlm_hal_fmn_config.c
@@ -974,7 +974,11 @@ static void nlm_hal_write_fmn_credit(int node, int max_nodes)
 					/* go through all valid stations and all valid vc's */
 					for (qid = 0; qid <= XLP_9XX_POPQ_VC_LIMIT; qid++) {
 							/* FIXME: define/config fmn_cfg_value properly for XLP9XX */
-							credits = fmn_cfg_value[qid] - 1;
+							if ((base_vc >= XLP_STNID_CPU0) && (base_vc <= XLP_STNID_CPU19)) {
+								credits = fmn_cfg_value[qid] - 1;
+							} else {
+								credits = fmn_cfg_value[qid];
+							}
 #ifdef FMN_DEBUG
 							if ((credits+1) != nlm_node_cfg.fmn_cfg[node]->fmn_default_credits)
 								nlm_print("Overriding credis from source %d qid %d credits %d \n", base_vc, qid, credits);
-- 
1.7.9.5

