From 20b0388f1a8c2b2f5a3272e2414ae9592c68c904 Mon Sep 17 00:00:00 2001
From: Jayachandran C <jchandra@broadcom.com>
Date: Wed, 19 Feb 2014 21:02:51 +0530
Subject: [PATCH 091/163] wakeup: Extend Errata workaround for mapped kernel

Commit 2ed91629bb8e427396b7375c9f895d04f23e40a3 "wakeup: Handle errata for
unmapped kernel" needs to be done for the mapped kernel case as well.

Take out the ifdef.

The original errata was:
    Require a new CPU Control Register setting to protect against a new
    Product Alert for CPU hang, correlated to XLPERRATA-179.
    Software would have write to the Branch Update Buffer Reservation
    Control register at address 0x007 with the value of 0x55 to reserve
    5 entries each.

Signed-off-by: Jack Tan <jack.tan@windriver.com>
---
 arch/mips/netlogic/common/reset.S |    2 --
 1 file changed, 2 deletions(-)

diff --git a/arch/mips/netlogic/common/reset.S b/arch/mips/netlogic/common/reset.S
index 8c07836..9c8ebb0 100644
--- a/arch/mips/netlogic/common/reset.S
+++ b/arch/mips/netlogic/common/reset.S
@@ -239,7 +239,6 @@ EXPORT(nlm_boot_siblings)
 	mfc0	v0, CP0_EBASE, 1
 	andi	v0, 0x3ff		/* v0 <- node/core */
 
-#ifndef CONFIG_MAPPED_KERNEL
 	/* Errata: to avoid potential live lock, only apply to 4
 	 * thread per core mode */
 	andi	v1, v0, 0x3             /* v1 <- thread id */
@@ -258,7 +257,6 @@ EXPORT(nlm_boot_siblings)
 	mtcr	t1, t0
 	_ehb
 2:
-#endif
 	beqz	v0, 4f		/* boot cpu (cpuid == 0)? */
 	nop
 
-- 
1.7.9.5

