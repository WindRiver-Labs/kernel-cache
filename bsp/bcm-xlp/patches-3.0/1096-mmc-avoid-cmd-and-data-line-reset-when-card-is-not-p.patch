From 04dd7dee44c495fc615d74d655d847de7291c29e Mon Sep 17 00:00:00 2001
From: Kamlakant Patel <kamlakant.patel@broadcom.com>
Date: Fri, 28 Feb 2014 17:01:09 +0530
Subject: [PATCH 096/163] mmc: avoid cmd and data line reset when card is not
 present

The cmd and data lines are not getting cleared by hardware if
card is not present in the slots.
Adding quirks SDHCI_QUIRK_NO_CARD_NO_RESET to avoid the situation.

Signed-off-by: Jack Tan <jack.tan@windriver.com>
---
 drivers/mmc/host/sdhci-xlp.c |   11 ++++++++---
 1 file changed, 8 insertions(+), 3 deletions(-)

diff --git a/drivers/mmc/host/sdhci-xlp.c b/drivers/mmc/host/sdhci-xlp.c
index a5bc2e8..896583b 100644
--- a/drivers/mmc/host/sdhci-xlp.c
+++ b/drivers/mmc/host/sdhci-xlp.c
@@ -101,10 +101,15 @@ static int sdhci_xlp_probe_slot(struct pci_dev *pdev,
 	sd_host->irq = pdev->irq;
 
 	/*
-	 * The capabilites register reports block size as 3 for 4096,
-	 * force it to 2048
+	 * The capabilities register reports block size as 3 for 4096,
+	 * force it to 2048.
+	 * The cmd and data lines are not getting cleared by hardware on writing
+	 * 0x2 and 0x4 to MMC_SWRESET [2,1] register, if the card is not present
+	 * in the slot.
+	 * Avoid reset if the card is not present.
 	 */
-	sd_host->quirks = SDHCI_QUIRK_FORCE_BLK_SZ_2048;
+	sd_host->quirks = SDHCI_QUIRK_FORCE_BLK_SZ_2048 |
+				SDHCI_QUIRK_NO_CARD_NO_RESET;
 
 	ret = pci_request_region(pdev, sltno, mmc_hostname(sd_host->mmc));
 	if (ret) {
-- 
1.7.9.5

