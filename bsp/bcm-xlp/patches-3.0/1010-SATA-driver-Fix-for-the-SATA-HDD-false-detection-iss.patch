From 61296aa721aa59b57d408b95901682e2bfd7bf86 Mon Sep 17 00:00:00 2001
From: johuang <john.huang@broadcom.com>
Date: Wed, 11 Dec 2013 11:29:05 -0800
Subject: [PATCH 010/160] SATA driver: Fix for the SATA HDD false detection
 issue Increasing the Detection Threshold and Signal
 detect threshold to ignore the false SATA HDD
 detection issue.

Signed-off-by: johuang <john.huang@broadcom.com>
Signed-off-by: Jack Tan <jack.tan@windriver.com>
Signed-off-by: Jack Tan <jiankemeng@gmail.com>
---
 arch/mips/netlogic/xlp/ahci-init-xlp2.c |    7 +++++++
 1 file changed, 7 insertions(+)

diff --git a/arch/mips/netlogic/xlp/ahci-init-xlp2.c b/arch/mips/netlogic/xlp/ahci-init-xlp2.c
index 26fcff5..ac292af 100644
--- a/arch/mips/netlogic/xlp/ahci-init-xlp2.c
+++ b/arch/mips/netlogic/xlp/ahci-init-xlp2.c
@@ -140,6 +140,9 @@
 #define RXDPIF			0x8065
 #define PPMDRIFTMAX_HI		0x80A4
 
+#define D15				0x800F
+#define D15_CONFIG_VAL	0x1F
+
 #define nlm_read_sata_reg(b, r)		nlm_read_reg(b, r)
 #define nlm_write_sata_reg(b, r, v)	nlm_write_reg(b, r, v)
 #define nlm_get_sata_pcibase(node)	\
@@ -194,6 +197,8 @@ static void config_vsemi_phy(u64 regbase, u32 node)
 	for (port = 0; port < 2; port++) {
 		for (i = 0, reg = RXCDRCALFOSC0; reg <= CALDUTY; reg++, i++)
 			write_phy_reg(regbase, reg, port, vsemi_config1[i]);
+		
+		//write_phy_reg(regbase, D15, port, D15_CONFIG_VAL);
 
 		for (i = 0, reg = RXDPIF; reg <= PPMDRIFTMAX_HI; reg++, i++)
 			write_phy_reg(regbase, reg, port, vsemi_config2[i]);
@@ -231,6 +236,8 @@ static void verify_vsemi_config(u64 regbase, u32 node)
 			check_phy_register(regbase, node, reg, port,
 					vsemi_config1[i]);
 
+		check_phy_register(regbase, node, D15, port, D15_CONFIG_VAL);
+		
 		for (i = 0, reg = RXDPIF; reg <= PPMDRIFTMAX_HI; reg++, i++)
 			check_phy_register(regbase, node, reg, port,
 					vsemi_config2[i]);
-- 
1.7.9.5

