From 3c21e8437bbf294cc8fb15015522cac47e715f18 Mon Sep 17 00:00:00 2001
From: Vikas Gupta <vikas.gupta@broadcom.com>
Date: Tue, 11 Mar 2014 16:24:02 +0530
Subject: [PATCH 136/163] xlp9xx: Fix on chip LIFO configuration in
 port-fifo-mode for RXAUI.

Signed-off-by: Jack Tan <jack.tan@windriver.com>
---
 arch/mips/netlogic/lib/netlib/src/netsoc_nae.c |   12 ++++++++++++
 1 file changed, 12 insertions(+)

diff --git a/arch/mips/netlogic/lib/netlib/src/netsoc_nae.c b/arch/mips/netlogic/lib/netlib/src/netsoc_nae.c
index 269a561..cc2b398 100644
--- a/arch/mips/netlogic/lib/netlib/src/netsoc_nae.c
+++ b/arch/mips/netlogic/lib/netlib/src/netsoc_nae.c
@@ -3977,6 +3977,18 @@ static int __netsoc_config_freein_fifo(nae_t *nae)
                         }
                 }
 		if (is_nlm_xlp9xx()) {
+			/*rxaui has two physical ports in a quad*/
+			blk_cmplx_map = nae->rxaui_complex_map;
+			for(i = 0; blk_cmplx_map; i++) {
+                               if(!(blk_cmplx_map & 0x1))  {
+                                       blk_cmplx_map = blk_cmplx_map >> 1;
+                                       continue;
+                               }
+                               blk_cmplx_map = blk_cmplx_map >> 1;
+                               sfifo = i * MAX_PORTS_PERBLOCK;
+                               nae->freein_fifo_onchip_num_descs[sfifo] = nae->freein_fifo_onchip_num_descs[sfifo+2] = nae->freein_fifo_onchip_num_descs[sfifo]/2;             
+			}
+                       /*rest make them zero*/
 			sfifo = current_netsoc->max_ports;
 			for(fifo = sfifo; fifo < freein_fifo_total_queues; fifo++) {
                                 nae->freein_fifo_onchip_num_descs[fifo] = 0;
-- 
1.7.9.5

