From 4df696b230e77f651aa001f9bda0a80b21364073 Mon Sep 17 00:00:00 2001
From: Divya Sakthidharan <divyas@broadcom.com>
Date: Mon, 11 Feb 2013 18:38:10 +0530
Subject: [PATCH 704/762] nand: Fix ecc calculation for subpage read

Based on Broadcom SDK 2.3.

Signed-off-by: Divya Sakthidharan <divyas@broadcom.com>
Signed-off-by: Yanjiang Jin <yanjiang.jin@windriver.com>
---
 drivers/mtd/nand/nand_base.c |    3 +++
 1 files changed, 3 insertions(+), 0 deletions(-)

diff --git a/drivers/mtd/nand/nand_base.c b/drivers/mtd/nand/nand_base.c
index 7ade1d1..f466657 100644
--- a/drivers/mtd/nand/nand_base.c
+++ b/drivers/mtd/nand/nand_base.c
@@ -1234,6 +1234,9 @@ static int nand_read_subpage(struct mtd_info *mtd, struct nand_chip *chip,
 					mtd->writesize + aligned_pos, -1);
 		chip->read_buf(mtd, &chip->oob_poi[aligned_pos], aligned_len);
 	}
+#ifdef	CONFIG_NLM_XLP 
+	index = start_step * chip->ecc.bytes;
+#endif
 
 	for (i = 0; i < eccfrag_len; i++)
 		chip->buffers->ecccode[i] = chip->oob_poi[eccpos[i + index]];
-- 
1.7.0.4

