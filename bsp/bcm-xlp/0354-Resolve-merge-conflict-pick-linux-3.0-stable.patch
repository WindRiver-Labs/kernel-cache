From e5fba7fe3b369146c5c118ba472b42e0eb9b0a83 Mon Sep 17 00:00:00 2001
From: Zi Shen Lim <zlim@netlogicmicro.com>
Date: Thu, 29 Sep 2011 14:55:10 -0700
Subject: [PATCH 354/762] Resolve merge conflict: pick linux-3.0-stable

Based on Broadcom SDK 2.3.

Signed-off-by: Zi Shen Lim <zlim@netlogicmicro.com>
Signed-off-by: Yanjiang Jin <yanjiang.jin@windriver.com>
---
 arch/mips/kernel/cevt-r4k.c |   12 +-----------
 1 files changed, 1 insertions(+), 11 deletions(-)

diff --git a/arch/mips/kernel/cevt-r4k.c b/arch/mips/kernel/cevt-r4k.c
index ed32894..b7698ac 100644
--- a/arch/mips/kernel/cevt-r4k.c
+++ b/arch/mips/kernel/cevt-r4k.c
@@ -172,11 +172,9 @@ int __cpuinit r4k_clockevent_init(void)
 	if (!cpu_has_counter || !mips_hpt_frequency)
 		return -ENXIO;
 
-	/* XLP_MERGE_TODO */
-#if !defined(CONFIG_NLM_XLP_SIM)
 	if (!c0_compare_int_usable())
 		return -ENXIO;
-#endif
+
 	/*
 	 * With vectored interrupts things are getting platform specific.
 	 * get_c0_compare_int is a hook to allow a platform to return the
@@ -194,14 +192,6 @@ int __cpuinit r4k_clockevent_init(void)
 	clockevent_set_clock(cd, mips_hpt_frequency);
 
 	/* Calculate the min / max delta */
-#ifdef CONFIG_NLM_COMMON
-	/* for 1GHz (and lesser), div_sc returns zero if shift = 32 */
-	cd->mult	= div_sc((unsigned long) mips_freq, NSEC_PER_SEC, 30);
-	cd->shift		= 30;
-#else
-	cd->mult	= div_sc((unsigned long) mips_freq, NSEC_PER_SEC, 32);
-	cd->shift		= 32;
-#endif
 	cd->max_delta_ns	= clockevent_delta2ns(0x7fffffff, cd);
 	cd->min_delta_ns	= clockevent_delta2ns(0x300, cd);
 
-- 
1.7.0.4

