From a473080aa70dca8a7a176ef6e3646a8e4c380d23 Mon Sep 17 00:00:00 2001
From: Hareesh R <hareeshr@broadcom.com>
Date: Wed, 5 Dec 2012 15:05:14 +0530
Subject: [PATCH 639/761] crypto: O32 ABI support

Based on Broadcom SDK 2.3.

Signed-off-by: Hareesh R <hareeshr@broadcom.com>
Signed-off-by: Yanjiang Jin <yanjiang.jin@windriver.com>
---
 drivers/char/nlm_cmem.c |    8 +++++++-
 drivers/char/nlm_cmem.h |   10 +++++-----
 2 files changed, 12 insertions(+), 6 deletions(-)

diff --git a/drivers/char/nlm_cmem.c b/drivers/char/nlm_cmem.c
index a6fce70..a9749b6 100644
--- a/drivers/char/nlm_cmem.c
+++ b/drivers/char/nlm_cmem.c
@@ -615,8 +615,14 @@ static long nlm_cmem_driver_ioctl(struct file *filp, unsigned int cmd,
 static long nlm_cmem_driver_compat_ioctl(struct file *filp, unsigned int cmd,
 	       			unsigned long arg)
 {
+	unsigned long ret = -1;
 	Message("%s %d\n", __FUNCTION__, __LINE__);
-	return 0;
+	ret = nlm_cmem_driver_ioctl(filp,cmd,arg);
+	if(ret){
+		printk("%s returned with an error.\n", __FUNCTION__);
+		return -ENOIOCTLCMD;
+	}
+	return ret;
 }
 
 /*
diff --git a/drivers/char/nlm_cmem.h b/drivers/char/nlm_cmem.h
index aa629c7..47d20e3 100644
--- a/drivers/char/nlm_cmem.h
+++ b/drivers/char/nlm_cmem.h
@@ -27,10 +27,10 @@ THE POSSIBILITY OF SUCH DAMAGE.
 
 #define NLM_CMEM_IOC 'n'
 
-#define NLM_CMEM_SET_APP_PAGE_SIZE 	_IOWR(NLM_CMEM_IOC, 1, unsigned long long *)
-#define NLM_CMEM_MADVISE_DONT_NEED 	_IOWR(NLM_CMEM_IOC, 2, unsigned long long *)
-#define NLM_CMEM_MADVISE_NEED 		_IOWR(NLM_CMEM_IOC, 3, unsigned long long *)
-#define NLM_CMEM_POST_CHILD_ATFORK	_IOWR(NLM_CMEM_IOC, 6, unsigned long long *)
-#define NLM_CMEM_GET_VA_PA_INFO		_IOWR(NLM_CMEM_IOC, 7, unsigned long long *)
+#define NLM_CMEM_SET_APP_PAGE_SIZE 	_IOWR(NLM_CMEM_IOC, 1, unsigned long long )
+#define NLM_CMEM_MADVISE_DONT_NEED 	_IOWR(NLM_CMEM_IOC, 2, unsigned long long )
+#define NLM_CMEM_MADVISE_NEED 		_IOWR(NLM_CMEM_IOC, 3, unsigned long long )
+#define NLM_CMEM_POST_CHILD_ATFORK	_IOWR(NLM_CMEM_IOC, 6, unsigned long long )
+#define NLM_CMEM_GET_VA_PA_INFO		_IOWR(NLM_CMEM_IOC, 7, unsigned long long )
 
 #endif /* NLM_CMEM_H_ */
-- 
1.7.10.4

