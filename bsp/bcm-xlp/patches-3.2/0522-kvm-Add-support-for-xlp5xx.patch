From d50f12d3749e6b17cbcc856a54cc3c10aeac1b1b Mon Sep 17 00:00:00 2001
From: Saswat Kumar Dash <saswat.dash@broadcom.com>
Date: Thu, 8 May 2014 03:43:31 -0700
Subject: kvm: Add support for xlp5xx.

Remove SMSC from Kernel configuration since it is not emulated.
[Based on SDK 3.2]
Signed-off-by: Quanyang Wang <quanyang.wang@windriver.com>
Signed-off-by: Nam Ninh <nam.ninh@windriver.com>

diff --git a/arch/mips/boot/dts/xlp5xx-helinux-guest.dts b/arch/mips/boot/dts/xlp5xx-helinux-guest.dts
new file mode 100644
index 0000000..3644d87
--- /dev/null
+++ b/arch/mips/boot/dts/xlp5xx-helinux-guest.dts
@@ -0,0 +1,82 @@
+/* XLP9XX Device Tree Source
+ *
+ */
+
+/dts-v1/;
+/ {
+	model = "netlogic,XLP-GVP";
+        compatible = "netlogic,xlp";
+        #address-cells = <2>;
+        #size-cells = <2>;
+
+        memory {
+                device_type = "memory";
+                reg =  <0 0x00100000 0 0x0FF00000       // 255M at 1M
+                        0 0x20000000 0 0x10000000>;     // 256M at 512M
+        };
+
+        /* memory range for HEv2 pkt mem. Only one contig memory per node supported */
+	/* size 0 will be ignored. */
+        pktmem {
+                device_type = "pktmem";
+
+                /* format: node number, 64-bit addr, 64-bit size */
+                reg = <0 0x0 0x30000000 0x0 0x3000000
+                       1 0x0 0x0 0x0 0x0
+                       2 0x0 0x0 0x0 0x0
+                       3 0x0 0x0 0x0 0x0>;
+        };
+
+	doms {
+		#address-cells = <1>;
+		#size-cells = <1>;
+
+		/* dom@0 is used when this dtb is actually used at root,
+		 * at guest, the device has been initialized by root so dom@0 is not used.
+		 */
+		dom@0 {
+			device_type = "domain";
+			os = "linux";
+
+			fmn {
+				node_0_vc_mask = <0x22222222 0x22222222 0x22222222 0x22222222>;
+				node_1_vc_mask = <0x22222222 0x22222222 0x22222222 0x22222222>;
+				node_2_vc_mask = <0x22222222 0x22222222 0x22222222 0x22222222>;
+				node_3_vc_mask = <0x22222222 0x22222222 0x22222222 0x22222222>;
+                        };
+			dtre {
+				dtre_init_only = <0>;
+			};
+			owner-config {
+				fmn = <0x1>;
+			};
+		};
+
+		dom@1 {
+			device_type = "domain";
+			os = "linux";
+
+			cpu {
+				dtre-rx-vc = <2>;
+			};
+			app-param {
+				onlinemask = <0x1>;
+			};
+		};
+	};
+
+	chosen {
+		netlogic,cpumask = <0x1>;
+		bootargs = " console=ttyS0,115200  rhash_entries=1048576";
+		linux,initrd-start=<0x0>;
+		linux,initrd-end=<0x0>;
+	};
+
+	soc {
+		nodes {
+			num-nodes = <1>;
+		};
+
+	};
+};
+
diff --git a/arch/mips/boot/dts/xlp5xx-linux-guest.dts b/arch/mips/boot/dts/xlp5xx-linux-guest.dts
new file mode 100644
index 0000000..1a4ae64
--- /dev/null
+++ b/arch/mips/boot/dts/xlp5xx-linux-guest.dts
@@ -0,0 +1,86 @@
+/* XLP9XX Device Tree Source
+ *
+ */
+
+/dts-v1/;
+/ {
+	model = "netlogic,XLP-GVP";
+        compatible = "netlogic,xlp";
+        #address-cells = <2>;
+        #size-cells = <2>;
+
+        memory {
+                device_type = "memory";
+                reg =  <0 0x00100000 0 0x0FF00000       // 255M at 1M
+                        0 0x20000000 0 0x10000000>;     // 256M at 512M
+        };
+
+        /* memory range for HEv2 pkt mem. Only one contig memory per node supported */
+	/* size 0 will be ignored. */
+        pktmem {
+                device_type = "pktmem";
+
+                /* format: node number, 64-bit addr, 64-bit size */
+                reg = <0 0x0 0x30000000 0x0 0x1000000
+                       1 0x0 0x0 0x0 0x0
+                       2 0x0 0x0 0x0 0x0
+                       3 0x0 0x0 0x0 0x0>;
+        };
+
+	doms {
+		#address-cells = <1>;
+		#size-cells = <1>;
+		dom@0 {
+			device_type = "domain";
+			os = "linux";
+
+			fmn {
+				node_0_vc_mask = <0x22222222 0x22222222 0x22222222 0x22222222>;
+                        };
+			dtre {
+				dtre_init_only = <0>;
+			};
+			owner-config {
+				fmn = <0x1>;
+			};
+		};
+		dom@1 {
+			device_type = "domain";
+
+			cpu {   
+                                onlinemask = <0xffff>; 
+                                nae-rx-vc = <2>;
+			};
+
+			resource-allocation {
+				net@0 {
+					port-mask = <0x3 0 0 0>;
+					frinlifo-mask = <0xff 0 0 0>;
+					frinlifo-shared-mode = <0 0 0 0>;
+					vfbid-sw-offset = <0 0 0 0>;
+					vfbid-sw-entries = <0 0 0 0>;
+					ucore-mask = <0x2 0 0 0>;
+					sram-off = <0 0 0 0>;
+				};
+			};
+			app-param{
+                                onlinemask = <0xffff>;
+			};
+		};
+	};
+
+	chosen {
+		netlogic,cpumask = <0xffff>;
+		bootargs = " console=ttyS0,115200  rhash_entries=1048576";
+		linux,initrd-start=<0x0>;
+		linux,initrd-end=<0x0>;
+	};
+
+	soc {
+		nodes {
+			num-nodes = <1>;
+		};
+
+	};
+};
+
-- 
1.7.1

