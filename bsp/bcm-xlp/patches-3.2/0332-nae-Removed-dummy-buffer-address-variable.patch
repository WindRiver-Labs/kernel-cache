From e7d9b0667ca0aff41cbe24af7e79ad4e36d3508d Mon Sep 17 00:00:00 2001
From: Hareesh R <hareeshr@broadcom.com>
Date: Mon, 10 Sep 2012 16:50:43 +0530
Subject: nae : Removed dummy buffer address variable

Added support to specify the descriptor memory range, size etc
for the nae rx lifos so that nae owner can initialize all the
lifos. Removed the dummy buffer usage.
[Based on SDK 3.2]
Signed-off-by: Quanyang Wang <quanyang.wang@windriver.com>
Signed-off-by: Nam Ninh <nam.ninh@windriver.com>

diff --git a/arch/mips/boot/dts/mnxlp8xx-helinux-nat.dts b/arch/mips/boot/dts/mnxlp8xx-helinux-nat.dts
index 10af712..3f3c4ed 100644
--- a/arch/mips/boot/dts/mnxlp8xx-helinux-nat.dts
+++ b/arch/mips/boot/dts/mnxlp8xx-helinux-nat.dts
@@ -61,7 +61,6 @@
 				/* hw entries */
 				vfbtbl-hw-offset = <32 32 32 32>;
 				vfbtbl-hw-nentries = <0 0 0 0>;
-				dummy-pktdata-addr = <0x0 0x0ff00000>; // 255 MB
 			};
 			owner-config {
 				nae = <0x3>;   // currently for node0 and node1
@@ -119,7 +118,15 @@
 				/* hw entries */
 				vfbtbl-hw-offset = <32 32 32 32>;
 				vfbtbl-hw-nentries = <20 20 20 20>;
-				dummy-pktdata-addr = <0x0 0x0ff00000>; // 255 MB
+				/* replenish info syntax */
+				freein-fifo-replenish-by-owner = <1>;
+				/* < node paddr-H32bits paddr-L32bits size-H32bits size-L32bits */
+				freein-fifo-replenish-addr-info = <0x0 0x0 0x88000000 0x0 0x10000000>; /* 256M @2176M*/
+				/* < node fifomask descsize headroom ndescs > */
+				freein-fifo-replenish-desc-info = <0 0xffff 2048 0 1800>;
+
+
+
 			};
 			owner-config {
 				nae = <0x0>;   
@@ -174,7 +181,13 @@
 				vfbtbl-hw-offset = <32 32 32 32>;
 				vfbtbl-hw-nentries = <20 20 20 20>;
 
-				dummy-pktdata-addr = <0x0 0x0ff00000>; // 255 MB
+				/* replenish info syntax */
+				freein-fifo-replenish-by-owner = <1>;
+				/* < node paddr-H32bits paddr-L32bits size-H32bits size-L32bits */
+				freein-fifo-replenish-addr-info = <0x1 0x3 0xe8000000 0x0 0x10000000>; /* 256M @ 16000M*/
+				/* < node fifomask descsize headroom ndescs > */
+				freein-fifo-replenish-desc-info = <1 0xffff 2048 0 1800>;
+
 			};
 			owner-config {
 				nae = <0x0>;
diff --git a/arch/mips/boot/dts/mnxlp8xx-hybrid-nae-helinux.dts b/arch/mips/boot/dts/mnxlp8xx-hybrid-nae-helinux.dts
index 49b5358..caff28e 100644
--- a/arch/mips/boot/dts/mnxlp8xx-hybrid-nae-helinux.dts
+++ b/arch/mips/boot/dts/mnxlp8xx-hybrid-nae-helinux.dts
@@ -54,7 +54,6 @@
 				vfbtbl-sw-nentries = <32 32 32 32>;
 				vfbtbl-hw-offset = <0 0 0 0>;
 				vfbtbl-hw-nentries = <0 0 0 0>;
-				dummy-pktdata-addr = <0x0 0x0ff00000>; // 255 MB
 			};
 			owner-config {
 				nae = <0x3>;   // currently for node0 and node1
@@ -115,8 +114,14 @@
 				vfbtbl-sw-nentries = <0 0 0 0>;
 				vfbtbl-hw-offset = <32 32 32 32>;
 				vfbtbl-hw-nentries = <20 20 20 20>;
+				/* replenish info syntax */
+				freein-fifo-replenish-by-owner = <1>;
+				/* < node paddr-H32bits paddr-L32bits size-H32bits size-L32bits */
+				freein-fifo-replenish-addr-info = <0x0 0x1 0x08000000 0x0 0x10000000>; /* 256M @4096M*/
+				/* < node fifomask descsize headroom ndescs > */
+				freein-fifo-replenish-desc-info = <0 0xffff 2048 0 64>;
+
 
-				dummy-pktdata-addr = <0x0 0x0ff00000>; // 255 MB
 			};
 			owner-config {
 				nae = <0x0>;
@@ -169,8 +174,15 @@
 				vfbtbl-sw-nentries = <0 0 0 0>;
 				vfbtbl-hw-offset = <32 32 32 32>;
 				vfbtbl-hw-nentries = <20 20 20 20>;
+	
+				/* replenish info syntax */
+				freein-fifo-replenish-by-owner = <1>;
+				/* < node paddr-H32bits paddr-L32bits size-H32bits size-L32bits */
+				freein-fifo-replenish-addr-info = <0x1 0x3 0x00c00000 0x0 0x10000000>; /* 256M @12300m*/
+				/* < node fifomask descsize headroom ndescs > */
+				freein-fifo-replenish-desc-info = <1 0xffff 2048 0 64>;
+
 
-				dummy-pktdata-addr = <0x0 0x0ff00000>; // 255 MB
 			};
 			owner-config {
 				nae = <0x0>;   // currently for node 0
diff --git a/arch/mips/boot/dts/mnxlp8xx-linux.dts b/arch/mips/boot/dts/mnxlp8xx-linux.dts
index 6ec8002..e81ec9d 100644
--- a/arch/mips/boot/dts/mnxlp8xx-linux.dts
+++ b/arch/mips/boot/dts/mnxlp8xx-linux.dts
@@ -64,7 +64,6 @@
 				/* hw entries 40 for 2 nodes , 20 fifos each */
 				vfbtbl-hw-offset = <32 32 32 32>;
 				vfbtbl-hw-nentries = <40 40 40 40>;
-				dummy-pktdata-addr = <0x0 0x0ff00000>; // 255 MB
 			};
 			owner-config {
 				nae = <0x3>;   // currently for node0 and node1
diff --git a/arch/mips/boot/dts/xlp4xx-linux.dts b/arch/mips/boot/dts/xlp4xx-linux.dts
index 059327e..21262f9 100644
--- a/arch/mips/boot/dts/xlp4xx-linux.dts
+++ b/arch/mips/boot/dts/xlp4xx-linux.dts
@@ -62,7 +62,6 @@
 				/* hw entries */
 				vfbtbl-hw-offset = <32 32 32 32>;
 				vfbtbl-hw-nentries = <20 20 20 20>;
-				dummy-pktdata-addr = <0x0 0x0ff00000>; // 255 MB
 			};
 			owner-config {
 				nae = <0x1>;   // currently for node 0
diff --git a/arch/mips/boot/dts/xlp8xx-helinux-nat.dts b/arch/mips/boot/dts/xlp8xx-helinux-nat.dts
index a4972e4..369d2c7 100644
--- a/arch/mips/boot/dts/xlp8xx-helinux-nat.dts
+++ b/arch/mips/boot/dts/xlp8xx-helinux-nat.dts
@@ -59,7 +59,6 @@
 				/* hw entries */
 				vfbtbl-hw-offset = <32 32 32 32>;
 				vfbtbl-hw-nentries = <0 0 0 0>;
-				dummy-pktdata-addr = <0x0 0x0ff00000>; // 255 MB
 			};
 			owner-config {
 				nae = <0x1>;   // currently for node 0
@@ -117,7 +116,15 @@
 				/* hw entries */
 				vfbtbl-hw-offset = <32 32 32 32>;
 				vfbtbl-hw-nentries = <20 20 20 20>;
-				dummy-pktdata-addr = <0x0 0x0ff00000>; // 255 MB
+				/* replenish info syntax */
+				freein-fifo-replenish-by-owner = <1>;
+				/* < node paddr-H32bits paddr-L32bits size-H32bits size-L32bits */
+				freein-fifo-replenish-addr-info = <0x0 0x0 0x88000000 0x0 0x10000000>; /* 256M @2176M*/
+				/* < node fifomask descsize headroom ndescs > */
+				freein-fifo-replenish-desc-info = <0 0xffff 2048 0 1800>;
+
+
+
 			};
 			owner-config {
 				nae = <0x0>;
diff --git a/arch/mips/boot/dts/xlp8xx-hybrid-nae-netos.dts b/arch/mips/boot/dts/xlp8xx-hybrid-nae-netos.dts
index 2d24c5a..5bc4266 100644
--- a/arch/mips/boot/dts/xlp8xx-hybrid-nae-netos.dts
+++ b/arch/mips/boot/dts/xlp8xx-hybrid-nae-netos.dts
@@ -52,7 +52,6 @@
 				vfbtbl-sw-nentries = <32 32 32 32>;
 				vfbtbl-hw-offset = <0 0 0 0>;
 				vfbtbl-hw-nentries = <0 0 0 0>;
-				dummy-pktdata-addr = <0x0 0x0ff00000>; // 255 MB
 			};
 			owner-config {
 				nae = <0x1>;   // currently for node 0
@@ -113,7 +112,12 @@
 				vfbtbl-sw-nentries = <0 0 0 0>;
 				vfbtbl-hw-offset = <32 32 32 32>;
 				vfbtbl-hw-nentries = <20 20 20 20>;
-				dummy-pktdata-addr = <0x0 0x0ff00000>; // 255 MB
+				/* replenish info syntax */
+				freein-fifo-replenish-by-owner = <1>;
+				/* < node paddr-H32bits paddr-L32bits size-H32bits size-L32bits */
+				freein-fifo-replenish-addr-info = <0x0 0x0 0x80000000 0x0 0x10000000>; /* 256M @2048M*/
+				/* < node fifomask descsize headroom ndescs > */
+				freein-fifo-replenish-desc-info = <0 0xffff 2048 0 64>;
 			};
 			owner-config {
 				nae = <0x0>;
diff --git a/arch/mips/boot/dts/xlp8xx-linux.dts b/arch/mips/boot/dts/xlp8xx-linux.dts
index 4c54c5e..c8606cb 100644
--- a/arch/mips/boot/dts/xlp8xx-linux.dts
+++ b/arch/mips/boot/dts/xlp8xx-linux.dts
@@ -62,7 +62,6 @@
 				/* hw entries */
 				vfbtbl-hw-offset = <32 32 32 32>;
 				vfbtbl-hw-nentries = <20 20 20 20>;
-				dummy-pktdata-addr = <0x0 0x0ff00000>; // 255 MB
 			};
 			owner-config {
 				nae = <0x1>;   // currently for node 0
diff --git a/arch/mips/boot/dts/xlp8xx-netos-nat.dts b/arch/mips/boot/dts/xlp8xx-netos-nat.dts
index ca47402..68ed779 100644
--- a/arch/mips/boot/dts/xlp8xx-netos-nat.dts
+++ b/arch/mips/boot/dts/xlp8xx-netos-nat.dts
@@ -68,7 +68,6 @@
 				/* hw entries */
 				vfbtbl-hw-offset = <32 32 32 32>;
 				vfbtbl-hw-nentries = <20 20 20 20>;
-				dummy-pktdata-addr = <0x0 0x0ff00000>; // 255 MB
 			};
 			owner-config {
 				nae = <0x1>;   // currently for node 0
-- 
1.7.1

