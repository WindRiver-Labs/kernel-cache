From 0806e81a50b993bbf25a639201b60a8dd5ed22fa Mon Sep 17 00:00:00 2001
From: Rahul Gupta <guptar@broadcom.com>
Date: Thu, 13 Feb 2014 15:43:52 +0530
Subject: pcie_net_app, pcie_perf: Following changes done here: 1. Added 4xx-pcie dts file. 2. Updated build-dtb.sh with BUILDTYPE=XLPPCIE, for building dtb for both 8xx-pcie, 4xx-pcie smart nic.

[Based on SDK 3.2]
Signed-off-by: Quanyang Wang <quanyang.wang@windriver.com>
Signed-off-by: Nam Ninh <nam.ninh@windriver.com>

diff --git a/arch/mips/boot/dts/xlp4xx-helinux-pcienet.dts b/arch/mips/boot/dts/xlp4xx-helinux-pcienet.dts
new file mode 100644
index 0000000..43382ae
--- /dev/null
+++ b/arch/mips/boot/dts/xlp4xx-helinux-pcienet.dts
@@ -0,0 +1,132 @@
+/* XLP4XX Device Tree Source 
+ *
+ */
+
+/dts-v1/;
+/ {
+
+	model = "netlogic,XLP-EVP";
+        compatible = "netlogic,xlp";
+        #address-cells = <2>;
+        #size-cells = <2>;
+	/*memory range for linux. This will not appear in dom0*/
+        memory {
+                device_type = "memory";
+                reg =  <0 0x01000000 0 0x0B000000   /*16M to 176M */
+                        0 0x20000000 0 0x26000000>; /*512M to 1120M */
+        };
+
+        pktmem {
+            device_type = "pktmem";
+             /* format: node number, 64-bit addr, 64-bit size */
+             reg = <0 0x0 0x50000000 0x0 0x20000000 // 512M @ 1.25GB
+                    1 0x0 0x0 0x0 0x0
+                    2 0x0 0x0 0x0 0x0
+                    3 0x0 0x0 0x0 0x0>;
+        };
+ 
+	hypervisor {
+		hypervisor-name = "Xen";
+		alloc_dom0_memory = <1>;
+		bootargs = "dom0_loadaddr=0x72000000 dom0_cpumask=0x0f -- ";
+		domain_heap = <0x50000000 0x20000000>;
+	};
+
+	doms {
+		#address-cells = <1>;
+		#size-cells = <1>;
+		dom@0 {
+			device_type = "domain";
+			os = "linux";
+
+			#address-cells = <1>;
+			#size-cells = <1>;
+
+			cpu {
+				onlinemask = <0xffff>;
+                		napi-vc-mask = <0x8>;
+			};
+			uart {
+				id = <0>;
+				owner = <1>;
+				sharedcfg = <0x1f000000>;
+			};
+			fmn {
+           			node_0_vc_mask = <0x88888888 0x88888888 0x88888888 0x88888888>;
+	           		node_1_vc_mask = <0x00000000 0x00000000 0x00000000 0x00000000>;
+        	   		node_2_vc_mask = <0x00000000 0x00000000 0x00000000 0x00000000>;
+           			node_3_vc_mask = <0x00000000 0x00000000 0x00000000 0x00000000>;
+			};
+			owner-config {
+				nae = <0x0>;   // currently for node 0
+				sae = <0x0>;
+				rsa = <0x0>;
+				fmn = <0x1>;
+			};
+		};
+
+		dom@1 {
+			device_type = "domain";
+			os = "uspace";
+
+			heap-size = <0x0 0x2000000>; // 32M
+			shared-mem = <0x0 0x50000000 0x0 0x20000000>; // 512M @ 1.25GB
+
+			#address-cells = <1>;
+			#size-cells = <1>;
+
+			app-bootcmd = "smpload";
+			app-loadaddr = "0xf0000000"; // 3.75GB
+
+			kernel {
+				/* Kernel Memory allocated from xen domain-heap */
+				size = <0x02000000>;  // 32M
+
+
+				/* Domain destroy currently doesn't work with hyperexec */
+				dom_destroy_hack = <0>;
+			};
+
+			cpu {
+				onlinemask = <0xffff>;
+                nae-rx-vc = <2>;
+                nae-fb-vc = <3>;
+			};
+			uart {
+				id = <0>;
+			};
+			memory {
+				//reg = <0x60000000 0x60000000>;  // 1.5GB @ 1.5GB
+				reg = <0x75000000 0x2bc00000>;  // 1.5GB @ 1.5GB
+			};
+			app-param{
+				onlinemask = <0xffff>;
+			};
+			owner-config {
+				nae = <0x1>;
+				fmn = <0x0>;
+				sae = <0x0>;
+				rsa = <0x0>;
+			};
+		};
+	};
+
+	chosen {
+        netlogic,cpumask = <0xffff>;
+		bootargs = " xlp_noi2c console=ttyS0,115200 autoboot_pciedrv_4xx";
+        /*bootargs = " xlp_noi2c console=ttyS0,115200 autoboot_pciedrv_4xx console_over_pcie";*/
+	};
+
+	soc {
+		nodes {
+			num-nodes = <1>;
+		};
+	};
+	frequency-config {
+		nae = <500>;
+		sae = <500>;
+		rsa = <500>;
+		dtre = <250>;
+		cde = <250>;
+	};
+};
diff --git a/arch/mips/boot/dts/xlp4xx-helinux-pcieperf.dts b/arch/mips/boot/dts/xlp4xx-helinux-pcieperf.dts
new file mode 100644
index 0000000..8c63340
--- /dev/null
+++ b/arch/mips/boot/dts/xlp4xx-helinux-pcieperf.dts
@@ -0,0 +1,131 @@
+/* XLP8XX Device Tree Source 
+ *
+ */
+
+/dts-v1/;
+/ {
+
+	model = "netlogic,XLP-EVP";
+        compatible = "netlogic,xlp";
+        #address-cells = <2>;
+        #size-cells = <2>;
+		/*memory range for linux. This will not appear in dom0*/
+        memory {
+                device_type = "memory";
+                reg =  <0 0x01000000 0 0x0B000000   
+                        0 0x20000000 0 0x26000000>;
+        };
+	       /* memory range for HEv2 pkt mem. Only one contig memory per node supported */
+        pktmem {
+                device_type = "pktmem";
+
+                /* format: node number, 64-bit addr, 64-bit size */
+                reg = <0 0 0x80000000 0 0x08000000
+                       1 0x0 0x0 0x0 0x0
+                       2 0x0 0x0 0x0 0x0
+                       3 0x0 0x0 0x0 0x0>;
+        };
+        hypervisor {
+                hypervisor-name = "Xen";
+                alloc_dom0_memory = <1>;
+                bootargs = "dom0_loadaddr=0x72000000 dom0_cpumask=0x0f -- ";
+                domain_heap = <0x50000000 0x20000000>;
+        };
+
+
+	doms {
+		#address-cells = <1>;
+		#size-cells = <1>;
+		dom@0 {
+			device_type = "domain";
+			os = "linux";
+
+			#address-cells = <1>;
+			#size-cells = <1>;
+
+			cpu {
+				onlinemask = <0xffffffff>;
+           		napi-vc-mask = <0x0>;
+			};
+			uart {
+				id = <0>;
+				owner = <1>;
+				sharedcfg = <0x1f000000>;
+			};
+			fmn {
+           			node_0_vc_mask = <0x88888888 0x88888888 0x88888888 0x88888888>;
+	           		node_1_vc_mask = <0x00000000 0x00000000 0x00000000 0x00000000>;
+        	   		node_2_vc_mask = <0x00000000 0x00000000 0x00000000 0x00000000>;
+           			node_3_vc_mask = <0x00000000 0x00000000 0x00000000 0x00000000>;
+			};
+			owner-config {
+				nae = <0x0>;   // currently for node 0
+				sae = <0x0>;
+				rsa = <0x0>;
+				fmn = <0x1>;
+			};
+		};
+
+		dom@1 {
+			device_type = "domain";
+			os = "netos";
+
+			heap-size = <0x0 0x2000000>; // 32M
+			shared-mem = <0x0 0x50000000 0x0 0x20000000>; // 512M @ 1.25GB
+
+			#address-cells = <1>;
+			#size-cells = <1>;
+
+			app-bootcmd = "smpload";
+			app-loadaddr = "0xf0000000"; // 3.75GB
+
+			kernel {
+				/* Kernel Memory allocated from xen domain-heap */
+				size = <0x02000000>;  // 32M
+
+				/* Location in Dom0 ramdisk */
+				location = "/tmp/xen/netos.elf";
+
+				/* Domain destroy currently doesn't work with hyperexec */
+				dom_destroy_hack = <0>;
+			};
+
+			cpu {
+				onlinemask = <0xffffffff>;
+                		nae-rx-vc = <2>;
+                		nae-fb-vc = <3>;
+			};
+			uart {
+				id = <0>;
+			};
+			memory {
+				reg = <0x60000000 0x60000000>;  // 1.5GB @ 1.5GB
+			};
+			app-param{
+				onlinemask = <0xffffffff>;
+			};
+			owner-config {
+				nae = <0x1>;
+				fmn = <0x0>;
+				sae = <0x0>;
+				rsa = <0x0>;
+			};
+		};
+	};
+
+	chosen {
+        netlogic,cpumask = <0xffffffff>;
+		bootargs = " xlp_noi2c console=ttyS0,115200 ";
+		/*"autoboot_pciedrv";*/
+		/*bootargs = " xlp_noi2c console=ttyS0,115200 console=pcie_co,115200 autoboot_pciedrv console_over_pcie"; */
+	};
+
+	soc {
+		nodes {
+			num-nodes = <1>;
+		};
+	};
+	frequency-config {
+		nae = <250>;
+	};
+};
-- 
1.7.1

