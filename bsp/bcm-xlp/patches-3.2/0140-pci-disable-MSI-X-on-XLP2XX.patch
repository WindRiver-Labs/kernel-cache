From 869153eb0159a05569b982e2b6800a5d20412607 Mon Sep 17 00:00:00 2001
From: Jayachandran C <jchandra@broadcom.com>
Date: Wed, 30 Jul 2014 10:50:27 +0530
Subject: pci: disable MSI-X on XLP2XX

MSI-X interrupt delivery does not work on 2XX yet, disable this.
[Based on SDK 3.2]
Signed-off-by: Quanyang Wang <quanyang.wang@windriver.com>
Signed-off-by: Nam Ninh <nam.ninh@windriver.com>

diff --git a/arch/mips/pci/msi-xlp.c b/arch/mips/pci/msi-xlp.c
index 83e8b75..7506840 100644
--- a/arch/mips/pci/msi-xlp.c
+++ b/arch/mips/pci/msi-xlp.c
@@ -447,6 +447,10 @@ int arch_setup_msi_irq(struct pci_dev *dev, struct msi_desc *desc)
 	uint64_t lnkbase;
 	int node, link, slot;
 
+	/* HW issues, disable MSI-X on xlp2xx for now */
+	if (desc->msi_attrib.is_msix && cpu_is_xlp2xx())
+		return 1;
+
 	lnkdev = xlp_get_pcie_link(dev);
 	if (lnkdev == NULL) {
 		dev_err(&dev->dev, "Could not find bridge\n");
-- 
1.7.1

