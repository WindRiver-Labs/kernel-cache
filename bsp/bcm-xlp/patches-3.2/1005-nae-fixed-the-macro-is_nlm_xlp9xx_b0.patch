From 1813b1c3d5227f8e504220d26c66331b735c4d2a Mon Sep 17 00:00:00 2001
From: kopal <kopal@broadcom.com>
Date: Fri, 26 Sep 2014 09:28:42 +0530
Subject: nae: fixed the macro is_nlm_xlp9xx_b0()

[Based on SDK 3.2]
Signed-off-by: Quanyang Wang <quanyang.wang@windriver.com>
Signed-off-by: Nam Ninh <nam.ninh@windriver.com>

diff --git a/arch/mips/netlogic/lib/syslib/include/nlm_hal_xlp_dev.h b/arch/mips/netlogic/lib/syslib/include/nlm_hal_xlp_dev.h
index 0e5cbc2..a338653 100644
--- a/arch/mips/netlogic/lib/syslib/include/nlm_hal_xlp_dev.h
+++ b/arch/mips/netlogic/lib/syslib/include/nlm_hal_xlp_dev.h
@@ -210,6 +210,7 @@ extern int is_nlm_xlp(unsigned int chipid, unsigned int rev,  unsigned int ext);
 #define is_nlm_xlp9xx()	    	is_nlm_xlp(0x9000, XLP_REVISION_ANY,  0)
 #define is_nlm_xlp9xx_ax()	is_nlm_xlp(0x9000, XLP_REVISION_AX,  0)
 #define is_nlm_xlp9xx_b0()   	is_nlm_xlp(0x9000, XLP_REVISION_B0, 0)
+#define is_nlm_xlp9xx_bx()   	is_nlm_xlp(0x9000, XLP_REVISION_BX, 0)
 
 #define is_nlm_xlp5xx_B(rev)      ( is_nlm_xlp(0x5000, rev, CPU_EXTPID_XLP_5XX_BASE))
 #define is_nlm_xlp532_B(rev)      ( is_nlm_xlp(0x5084, rev, CPU_EXTPID_XLP_5XX_BASE))
diff --git a/arch/mips/netlogic/lib/syslib/src/nlm_hal_cpu_info.c b/arch/mips/netlogic/lib/syslib/src/nlm_hal_cpu_info.c
index f8f0db1..5c0c178 100644
--- a/arch/mips/netlogic/lib/syslib/src/nlm_hal_cpu_info.c
+++ b/arch/mips/netlogic/lib/syslib/src/nlm_hal_cpu_info.c
@@ -183,6 +183,22 @@ static __inline__ int is_nlm_xlp5xx_rev_xx(uint32_t rev)
 /***************************************************************************************
 * match the chip revision with 'rev'
  * rev:  revision number
+****************************************************************************************/
+static __inline__ int is_nlm_xlp9xx_rev_xx(uint32_t rev)
+{
+	int sw_rev=get_nlm_xlp9xx_rev();
+        uint32_t rev_b0 = XLP_REVISION_B0;
+        if( rev==sw_rev)        return 1;
+        if( rev==XLP_REVISION_AX && sw_rev<rev_b0)      return 1;
+        if( rev==XLP_REVISION_BX && (rev_b0<=sw_rev))   return 1;
+        if( rev==XLP_REVISION_ANY)                      return 1;
+
+        return 0;   
+}
+
+/***************************************************************************************
+* match the chip revision with 'rev'
+ * rev:  revision number
 		single match: XLP_REVISION_A0 etc
 		multi-match:  XLP_REVISION_AX/_BX/_XX
 ****************************************************************************************/
@@ -446,6 +462,10 @@ static inline int is_xlp2xx(uint8_t num_cores, uint8_t num_threads, uint32_t rev
 static inline int is_xlp9xx(uint8_t num_cpus, uint32_t rev)
 {
 	uint32_t pid;
+	int ret;
+	ret = is_nlm_xlp9xx_rev_xx(rev);
+	if(ret!=1)  return 0;
+
 	pid = get_proc_id();
 	if (pid == CHIP_PROCESSOR_ID_XLP_9XX)
 		return 1;
-- 
1.7.1

