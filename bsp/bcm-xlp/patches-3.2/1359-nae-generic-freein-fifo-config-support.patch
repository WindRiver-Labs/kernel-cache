From 313af7de0b2be7621dd8cffda0db1316a39e8f89 Mon Sep 17 00:00:00 2001
From: Sreenidhi BR <sreenira@broadcom.com>
Date: Mon, 7 May 2012 17:07:07 +0530
Subject: nae: generic freein-fifo config support

Updated freein-fifo-onchip-num-descs to an array so that
independent per-queue-config is possible.  Also removed freein-fifo-shared.
[Based on SDK 3.2]
Signed-off-by: Quanyang Wang <quanyang.wang@windriver.com>
Signed-off-by: Nam Ninh <nam.ninh@windriver.com>

diff --git a/drivers/net/ethernet/broadcom/nae/init_nae.c b/drivers/net/ethernet/broadcom/nae/init_nae.c
index bcb4173..4ef64d9 100644
--- a/drivers/net/ethernet/broadcom/nae/init_nae.c
+++ b/drivers/net/ethernet/broadcom/nae/init_nae.c
@@ -159,13 +159,6 @@ int initialize_nae(unsigned int *phys_cpu_map, int mode, int *jumbo_enabled)
 		if (nae_cfg == NULL) 
 			continue;
 		
-		/* This driver works only with freein-fifo shared mode */
-		if(!nae_cfg->freein_fifo_shared) {
-			printk("%s, Error, Driver works only with freein fifo shared mode\n", __FUNCTION__);
-			goto err;
-		}
-		
-
 		for(i = 0; i <= NLM_NAE_MAX_SHARED_DOMS; i++) {
 			lnx_shinfo[i].valid = nae_cfg->shinfo[i].valid;
 			lnx_shinfo[i].rxvc = nae_cfg->shinfo[i].rxvc;
@@ -329,9 +322,9 @@ int replenish_freein_fifos(void)
 			continue;
 
 		/* configure the descs */
-		max_descs_pqueue = nae_cfg->freein_fifo_onchip_num_descs +  nae_cfg->freein_fifo_spill_num_descs;
 
 		for(i = 0; i < nae_cfg->frin_total_queue; i++) {
+			max_descs_pqueue = nae_cfg->freein_fifo_onchip_num_descs[i] +  nae_cfg->freein_fifo_spill_num_descs;
 			if((1 << i) & lnx_normal_mask)
 				num_descs = num_descs_per_normalq <= max_descs_pqueue ? num_descs_per_normalq : max_descs_pqueue;
 			else if((1 << i) & lnx_jumbo_mask)
-- 
1.7.1

