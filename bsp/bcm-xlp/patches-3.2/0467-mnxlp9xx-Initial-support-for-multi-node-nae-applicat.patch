From f723d48567565be2d73e759a09352308ddf1174f Mon Sep 17 00:00:00 2001
From: Pavani Reddy <pavani@broadcom.com>
Date: Wed, 11 Dec 2013 17:38:37 +0530
Subject: mnxlp9xx : Initial support for multi-node nae application in 9xx

[Based on SDK 3.2]
Signed-off-by: Quanyang Wang <quanyang.wang@windriver.com>
Signed-off-by: Nam Ninh <nam.ninh@windriver.com>

diff --git a/arch/mips/boot/dts/mnxlp9xx-helinux-nae.dts b/arch/mips/boot/dts/mnxlp9xx-helinux-nae.dts
new file mode 100644
index 0000000..0e59d32
--- /dev/null
+++ b/arch/mips/boot/dts/mnxlp9xx-helinux-nae.dts
@@ -0,0 +1,216 @@
+/* XLP8XX Device Tree Source
+ *
+ */
+
+/dts-v1/;
+/ {
+	model = "netlogic,XLP-EVP";
+        compatible = "netlogic,xlp";
+        #address-cells = <2>;
+        #size-cells = <2>;
+	/*memory range for linux. This will not appear in dom0*/
+        memory {
+                device_type = "memory";
+                reg =  <0 0x00000000 0 0x0B000000   
+                        0 0x20000000 0 0xa0000000
+                        0 0xe0000000 0 0x20000000
+                        0x2 0x80000000 0 0x80000000>;
+        };
+	
+	hypervisor {
+		hypervisor-name = "Xen";
+		alloc_dom0_memory = <0>;
+		bootargs = "ncores=8 dom0_loadaddr=0x72000000 dom0_size=0x1c000000 dom0_cpumask=0x0f -- ";
+		domain_heap = <0xf0000000 0xc0000000>; /* 3584MB -> 6656MB */
+	};
+	/* memory range for HEv2 pkt mem. Only one contig memory per node supported */
+	pktmem {
+		    device_type = "pktmem";
+
+	               /* format: node number, 64-bit addr, 64-bit size */
+	         reg = <0 0 0x80000000 0 0x08000000
+	                1 0x0 0x0 0x0 0x0
+	                2 0x0 0x0 0x0 0x0
+	                3 0x0 0x0 0x0 0x0>;
+			        };
+
+	doms {
+		#address-cells = <1>;
+		#size-cells = <1>;
+		dom@0 {
+			device_type = "domain";
+			os = "linux";
+
+			#address-cells = <1>;
+			#size-cells = <1>;
+			#nodes = <2>;
+			#cpumask-cells=<2>;
+
+			cpu {
+				onlinemask = <0xffffffff 0xffffffff>;
+				nae-rx-vc = <0>;
+				nae-fb-vc = <1>;
+				napi-vc-mask = <0x3>;
+			};
+			uart {
+				id = <0>;
+				owner = <1>;
+				sharedcfg = <0x1f000000>;
+			};
+			fmn {
+                                node_0_vc_mask = <0x00000000 0x00000000 0x00000000 0x00000000>;
+                                node_1_vc_mask = <0x33333333 0x33333333 0x33333333 0x33333333>;
+                                node_2_vc_mask = <0x33333333 0x33333333 0x33333333 0x33333333>;
+                                node_3_vc_mask = <0x33333333 0x33333333 0x33333333 0x33333333>;                       
+			};
+			ici-config{
+				enable = <1>;
+				total_credits = <673>;	
+				node_0_link_mask = <0x2>;	//Bit mask of active links
+				node_1_link_mask = <0x2>;	//Bit mask of active links
+				node_2_link_mask = <0x0>;	//Bit mask of active links
+				node_3_link_mask = <0x0>;	//Bit mask of active links
+				gcu{
+					own_credit = <75 12 75 75 75 75 75 12>;	/*VC1 and VC7 always shows 0 transactions.*/
+					shared_credit = <1 1 1 1 1 1 1 1>;
+					txwght = <63 12 63 63 63 63 63 12>;	/*Scheduling Priority, Higher Value = More Time Slot*/
+					segth  = <34 34 34 34 34 34 34 34>;	/*Maximum number of tx entries*/
+				};
+				fmn{
+					own_credit = <75 12 12 75>;	/*VC1 and VC2 always shows 0 transactions.*/
+					shared_credit = <1 1 1 1>;
+					txwght = <8 2 2 8 >;	/*Scheduling Priority, Higher Value = More Time Slot*/
+					segth  = <34 34 34 34>;	/*Maximum number of tx entries*/
+				};
+				pic{
+					own_credit = <12>;
+					shared_credit = <1>;
+					txwght = <1>;	/*Scheduling Priority, Higher Value = More Time Slot*/
+					segth  = <34>;	/*Maximum number of tx entries*/
+				};
+			};
+			owner-config {
+				nae = <0x0>;
+				sae = <0x1>;   // for node0
+				rsa = <0x1>;
+				fmn = <0x3>;
+			};
+		};
+		dom@1 {
+			device_type = "domain";
+			os = "netos";
+
+			heap-size = <0x0 0x2000000>;		   // 32M
+			shared-mem = <0x1 0x00000000 0x0 0x04000000>;  // 64MB @ 4G
+
+			#address-cells = <1>;
+			#size-cells = <1>;
+
+			app-bootcmd = "smpload";
+			app-loadaddr = "0xf4000000"; // 3.75 GB + 64 MB
+
+			kernel {
+				/* Kernel Memory allocated from xen domain-heap */
+				size = <0x02000000>;  // 32M
+
+				/* Location in Dom0 ramdisk */
+				location = "/tmp/xen/netos.elf";
+
+				/* Domain destroy currently doesn't work with hyperexec */
+				dom_destroy_hack = <0>;
+			};
+
+			cpu {
+				onlinemask = <0xffffffff 0xffffffff>;
+				nae-rx-vc = <2>;
+				nae-fb-vc = <2>;
+			};
+			uart {
+				id = <0>;
+				sharedcfg = <0x1f000000>;
+			};
+			memory {
+				reg = <0x50000000 0x10000000>;  // 1280M -> 1536M (256M)
+			};
+			nae {
+			};
+			owner-config {
+				nae = <0x3>;   // currently for node0 and node1
+				sae = <0x1>;   // for node0
+				rsa = <0x1>;
+				fmn = <0x0>;
+			};
+			app-param{
+				onlinemask = <0xffff 0xffffffff 0xffffffff
+					      0xffff 0xffffffff 0xffffffff>;
+				enable_ici_pkt_traffic = <0>;
+				
+				//Enable this for mode #1 and #2 Local Node Memory - For 16G+16G
+				nae_0_pkt_pool_start = <0x140>;	//Multiple of 16MB
+				nae_0_pkt_pool_size = <0x1000000>;
+				nae_1_pkt_pool_start = <0x540>;	//Multiple of 16MB
+				nae_1_pkt_pool_size = <0x1000000>;
+
+				
+/*
+				//Enable this for mode #1 and #2 Local Node Memory - For 16G+16G
+				nae_0_pkt_pool_start = <0x140>;	//Multiple of 16MB
+				nae_0_pkt_pool_size = <0x1000000>;
+				nae_1_pkt_pool_start = <0x241>;	//Multiple of 16MB
+				nae_1_pkt_pool_size = <0x1000000>;
+*/
+
+/*
+				//Enable this for mode #1 and #2 Local Node Memory - For 8G+8G
+				nae_0_pkt_pool_start = <0x140>;	//Multiple of 16MB
+				nae_0_pkt_pool_size = <0x1000000>;
+				nae_1_pkt_pool_start = <0x241>;	//Multiple of 16MB
+				nae_1_pkt_pool_size = <0x1000000>;
+
+				//Enable this for mode #3 Remote Node Memory  - For 8G+8G
+				nae_0_pkt_pool_start = <0x241>;	//Multiple of 16MB
+				nae_0_pkt_pool_size = <0x1000000>;
+				nae_1_pkt_pool_start = <0x140>;	//Multiple of 16MB
+				nae_1_pkt_pool_size = <0x1000000>;
+
+*/
+			};
+		};
+	};
+
+	chosen {
+		netlogic,cpumask = <0x0 0x0 0xffffffff 0xffffffff
+				    0x0 0x0 0xffffffff 0xffffffff>;
+		bootargs = " console=ttyS0,115200";
+	};
+
+	/* These binaries are downloaded at the resp physical memory locations
+	 * by their corresponding bootstrapping loaders. For example,
+	 * u-boot is loaded by x-load at 193M, sysconfig is loaded by u-boot
+	 * at 1M, hypervisor by u-boot hypervisor at 136M.
+	 * On simulator all these binaries are pre-loaded by using '-F' option
+	 * for convenience. On silicon, they will be loaded by their corresponding
+	 * temporary download locations the stage-1/stage-2 firmware
+	 */
+	firmware-download {
+		u-boot	= <0x0c100000 0x3f00000>;  /* 63M @ 193M */
+		sysconfig     = <0x00100000 0x00100000>; /* 1M @ 1M */
+		hypervisor    = <0x08800000 0x00800000>; /* 8M @ 136M */
+		dom0	  = <0x09000000 0x03000000>; /* 48M @ 144M */
+		domU-ramdisk  = <0x60000000 0x60800000>; /* 8M @ 1536M */
+	};
+
+	soc {
+		nodes {
+		num-nodes = <2>;
+		};
+	};
+	frequency-config {
+		nae = <500>;
+		sae = <500>;
+		rsa = <500>;
+		dtre = <250>;
+		cde = <250>;
+	};
+};
+
-- 
1.7.1

