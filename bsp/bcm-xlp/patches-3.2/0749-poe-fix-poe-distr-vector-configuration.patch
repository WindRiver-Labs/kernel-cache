From c6d7b0e809c0e3a7a40ce5d5837dfd92f688e407 Mon Sep 17 00:00:00 2001
From: Ashok Kumar <ashoks@broadcom.com>
Date: Wed, 17 Jul 2013 06:13:50 +0530
Subject: poe: fix poe distr vector configuration.

[Based on SDK 3.2]
Signed-off-by: Quanyang Wang <quanyang.wang@windriver.com>
Signed-off-by: Nam Ninh <nam.ninh@windriver.com>

diff --git a/arch/mips/netlogic/lib/netlib/src/netsoc_poe.c b/arch/mips/netlogic/lib/netlib/src/netsoc_poe.c
index 2d9adf6..60161f6 100644
--- a/arch/mips/netlogic/lib/netlib/src/netsoc_poe.c
+++ b/arch/mips/netlogic/lib/netlib/src/netsoc_poe.c
@@ -342,8 +342,9 @@ int __netsoc_v1_init_poe_distvec(poe_t *poe, uint32_t vec, cpu_mask_t *cpumap, u
     for(node = 0; node < NETVER1_NUM_NODES; node++) {
          coremask = 0; 
          for(core=0; core < NETVER1_MAX_CORES; core++) {  //FIXME
-               maskindex = ((node * NETVER1_MAX_CORES) + core) / 8;
-               cpumask = (cpumap->mask[maskindex] >> (core * 4)) & 0xF;
+               maskindex = ((node * NETVER1_MAX_CORES) + core);
+               cpumask = (cpumap->mask[maskindex / 8] >> ((maskindex % 8) * 4)) & 0xF;
+
                if (cpumask) {
                     coremask |= (1<<core);
                     for(thread=0; thread<4; thread++) {
-- 
1.7.1

