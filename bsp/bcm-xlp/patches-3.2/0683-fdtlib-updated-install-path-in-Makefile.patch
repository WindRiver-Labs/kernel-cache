From 591c65dad3ba22ebb8f0209b6250a10ab7357ef6 Mon Sep 17 00:00:00 2001
From: Jayanthi A <jayanthi.annadurai@broadcom.com>
Date: Mon, 6 May 2013 16:14:41 -0700
Subject: fdtlib: updated install path in Makefile

[Based on SDK 3.2]
Signed-off-by: Quanyang Wang <quanyang.wang@windriver.com>
Signed-off-by: Nam Ninh <nam.ninh@windriver.com>

diff --git a/libfdt/Makefile b/libfdt/Makefile
index 7014338..6a2220f 100644
--- a/libfdt/Makefile
+++ b/libfdt/Makefile
@@ -1,21 +1,35 @@
 
 FDTLIB_DIR = $(SDK_ROOT)/libraries/fdt/libfdt
-FDTLIB_OBJS = fdt.o fdt_ro.o fdt_wip.o fdt_sw.o fdt_rw.o fdt_strerror.o contrib/fdt_export.o contrib/fdt_helper.o
-FDTLIB = libfdtlib.a
 
 include $(SDK_ROOT)/linux-userspace/Makefile.mk
 
-CFLAGS += -DNLM_HAL_LINUX_USER -I./ -I./contrib/
+SRC = $(addprefix $(FDTLIB_DIR)/,$(shell cd $(FDTLIB_DIR) && ls *.c))
+SRC += $(addprefix $(FDTLIB_DIR)/contrib/,$(shell cd $(FDTLIB_DIR)/contrib && ls *.c))
 
-$(FDTLIB): $(FDTLIB_OBJS)
+FDTLIB_OBJS = $(patsubst %.c,%.o,$(SRC))
+	 
+FDT_LIB = libfdt.a
+
+include $(SDK_ROOT)/linux-userspace/Makefile.mk
+
+CFLAGS += -I$(FDTLIB_DIR) -I$(FDTLIB_DIR)/contrib
+
+ifeq ("$(HAL_INSTALL_PATH)","")
+HAL_INSTALL_PATH=$(SDK_ROOT)/libraries/install
+endif
+
+$(FDT_LIB): $(FDTLIB_OBJS)
 	echo "Build fdtlib library"
-	$(AR) -rcsP $(FDTLIB) $(FDTLIB_OBJS)
+	$(AR) -rcsP $(FDT_LIB) $(FDTLIB_OBJS)
 
-all: $(FDTLIB)
+all: $(FDT_LIB) 
 
 clean:
 	$(RM) *.a $(FDTLIB_OBJS)
 
 install:
+	cp -r $(FDTLIB_DIR)/contrib/fdt_helper.h $(HAL_INSTALL_PATH)/include/
+	cp -r $(FDTLIB_DIR)/libfdt.h  $(HAL_INSTALL_PATH)/include/
+	cp -r $(FDT_LIB) $(HAL_INSTALL_PATH)/lib/
 
-.PHONY: all clean install $(FDTLIB)
+.PHONY: all clean install $(FDT_LIB) 
-- 
1.7.1

