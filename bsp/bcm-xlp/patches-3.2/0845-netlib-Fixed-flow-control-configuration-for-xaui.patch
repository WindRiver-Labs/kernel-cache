From 51c3a592af58583d5291b38ed7dbd7a8449c3c3a Mon Sep 17 00:00:00 2001
From: Jayanthi A <jayanthi.annadurai@broadcom.com>
Date: Thu, 14 Nov 2013 13:12:14 -0800
Subject: netlib: Fixed flow control configuration for xaui

[Based on SDK 3.2]
Signed-off-by: Quanyang Wang <quanyang.wang@windriver.com>
Signed-off-by: Nam Ninh <nam.ninh@windriver.com>

diff --git a/arch/mips/netlogic/lib/netlib/src/netsoc_nae.c b/arch/mips/netlogic/lib/netlib/src/netsoc_nae.c
index 9469c5c..6a51a99 100644
--- a/arch/mips/netlogic/lib/netlib/src/netsoc_nae.c
+++ b/arch/mips/netlogic/lib/netlib/src/netsoc_nae.c
@@ -3063,6 +3063,12 @@ int __netsoc_config_flow_control(net_port_t *netport, uint32_t enable)
 			}
 
 			if (enable) {
+                                if (netport->iftype != XFI_IF) {
+                                   val = netsoc_read_mac_reg(mac_base, XAUI_CONFIG_1);
+                                   val |= (1<<31) | (1<<29);
+                                   netsoc_write_mac_reg(mac_base, XAUI_CONFIG_1, val);
+                                }
+
 				val = netsoc_read_mac_reg(mac_base, NETIOR_XGMAC_CTRL1);
 				mask = (1 << NETIOR_XGMAC_TX_PFC_EN_POS) | (1<<NETIOR_XGMAC_RX_PFC_EN_POS) | (1 << NETIOR_XGMAC_TX_PAUSE_POS);
 				val &= ~(mask);
@@ -3077,6 +3083,12 @@ int __netsoc_config_flow_control(net_port_t *netport, uint32_t enable)
 				}
                         }
                         else {
+			        if (netport->iftype != XFI_IF) {
+                                   val = netsoc_read_mac_reg(mac_base, XAUI_CONFIG_1);
+                                   val &= ~((1<<31) | (1<<29));
+                                   netsoc_write_mac_reg(mac_base, XAUI_CONFIG_1, val);
+                                }
+
 				val = netsoc_read_mac_reg(mac_base, NETIOR_XGMAC_CTRL1);
                                 mask = (1 << NETIOR_XGMAC_TX_PFC_EN_POS) | (1<<NETIOR_XGMAC_RX_PFC_EN_POS) | (1 << NETIOR_XGMAC_TX_PAUSE_POS);
                                 val &= ~(mask);
-- 
1.7.1

