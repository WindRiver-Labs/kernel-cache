From c0406861e28476e259d68b637fcdcab4488c46aa Mon Sep 17 00:00:00 2001
From: Debayan Ghosh <debayan.ghosh@broadcom.com>
Date: Tue, 15 Apr 2014 20:06:13 +0530
Subject: Compression: Added userspace compression library

[Based on SDK 3.2]
Signed-off-by: Quanyang Wang <quanyang.wang@windriver.com>
Signed-off-by: Nam Ninh <nam.ninh@windriver.com>

diff --git a/arch/mips/netlogic/lib/syslib/include/nlm_hal_cde.h b/arch/mips/netlogic/lib/syslib/include/nlm_hal_cde.h
index cfe9b94..421d85b 100644
--- a/arch/mips/netlogic/lib/syslib/include/nlm_hal_cde.h
+++ b/arch/mips/netlogic/lib/syslib/include/nlm_hal_cde.h
@@ -130,12 +130,14 @@ static __inline__ int nlm_hal_cde_send_request_2(uint32_t dst_vc, uint64_t entry
 
 }
 
-static __inline__ void nlm_hal_cde_receive_response(uint32_t rx_vc, uint64_t *entry0, uint64_t *entry1)
+static __inline__ int nlm_hal_cde_receive_response(uint32_t rx_vc, uint64_t *entry0, uint64_t *entry1)
 {
-        uint32_t size = 0, code = 0, src = 0;
-/*        uint64_t entry0 = 0, entry1 = 0; */
+	uint32_t size = 0, code = 0, src = 0, status = -1;
+	volatile uint64_t  max_retries = 0xffffff;
+	while(status != 0 && max_retries-- > 0)
+		status = nlm_hal_recv_msg2(rx_vc, &src, &size, &code, entry0, entry1);
 
-        nlm_hal_recv_msg2(rx_vc, &src, &size, &code, entry0, entry1);
+	return status;
 }
 #endif				/*#ifndef _NLM_HAL_CDE_H_ */
 
-- 
1.7.1

