From abfb817577b0aeb9a770a525b6aede200ab07853 Mon Sep 17 00:00:00 2001
From: Yonghong Song <ysong@broadcom.com>
Date: Fri, 9 Mar 2012 13:47:07 -0800
Subject: Do not use -static when building shared objects

 o Also add push/pop if inline assembly sets mipss64 architecture
[Based on SDK 3.2]
Signed-off-by: Quanyang Wang <quanyang.wang@windriver.com>
Signed-off-by: Nam Ninh <nam.ninh@windriver.com>

diff --git a/drivers/misc/netlogic/linux-loader/xlr_lib_launch.c b/drivers/misc/netlogic/linux-loader/xlr_lib_launch.c
index 02a38ce..d2a5092 100644
--- a/drivers/misc/netlogic/linux-loader/xlr_lib_launch.c
+++ b/drivers/misc/netlogic/linux-loader/xlr_lib_launch.c
@@ -248,6 +248,7 @@ void xlr_start_app(void)
 		/*Case where we are launching kseg application on vcpu not running 
 		  loader, Setup all the required arguments accordingly.*/
 		__asm__ volatile(
+				".set push\n"
 				".set noreorder\n"
 				".set mips64\n"
 				"move $4, %0\n"
@@ -257,6 +258,7 @@ void xlr_start_app(void)
 				"nop\n"
 				"nop\n"
 				".set reorder\n"
+				".set pop\n"
 				::"r"(t->argc),"r"(t->argv),"r"(t->envs),
 				//			"r"((unsigned long)xlr_lib_boot1_info)
 				"r"((unsigned long)0)
@@ -266,6 +268,7 @@ void xlr_start_app(void)
 	else
 	{
 		__asm__ volatile(
+				".set push\n"
 				".set noreorder\n"
 				".set mips64\n"
 				"move $4, %0\n"
@@ -273,6 +276,7 @@ void xlr_start_app(void)
 				"nop\n"
 				"nop\n"
 				".set reorder\n"
+				".set pop\n"
 				::"r"(t->args)
 				:"$4","$5"
 				);
-- 
1.7.1

