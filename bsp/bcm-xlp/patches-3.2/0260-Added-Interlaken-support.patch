From aa993fd9027a82bad470aed05ae75164933ff4b9 Mon Sep 17 00:00:00 2001
From: Jayanthi A <jayanthia@netlogicmicro.com>
Date: Wed, 19 Oct 2011 10:18:13 +0530
Subject: Added Interlaken support.

[Based on SDK 3.2]
Signed-off-by: Quanyang Wang <quanyang.wang@windriver.com>
Signed-off-by: Nam Ninh <nam.ninh@windriver.com>

diff --git a/arch/mips/boot/dts/nae-il.dts b/arch/mips/boot/dts/nae-il.dts
index e7bdc9d..2f91298 100644
--- a/arch/mips/boot/dts/nae-il.dts
+++ b/arch/mips/boot/dts/nae-il.dts
@@ -14,18 +14,19 @@
 	// (each entry is a pair of (vfbid , dest-vc)
 	// Legal range: (vfbid (0 - 126), dest-vc (0 - 4095))
 	vfbid-map = <
-                     0 0 1 1 2 2 3 3 4 4 
-
-/*
 		     // NAE -> CPU mapping 
-		      0   0  1   4  2   8  3  12
-		      4  16  5  20  6  24  7  28
-		      8  32  9  36 10  40 11  44
-	 	     12  48 13  52 14  56 15  60
-		     16  64 17  68 18  72 19  76
-		     20  80 21  84 22  88 23  92
-		     24  96 25 100 26 104 27 108
-		     28 112 29 116 30 120 31 124
+		     // Each thread uses vc 1 as freeback VC.
+		     // This is tied with fb-vc field.
+
+		      0    1    1    5    2   9    3    13 
+		      4    17   5    21   6   25   7    29
+                      8    33   9    37   10  41   11   45
+                      12   49   13   53   14  57   15   61
+		      16   65   17   69   18  73   19   77
+                      20   81   21   85   22  89   23   93
+		      24   97   25  101   26 105   27  109
+		      28  113   29  117   30 121   31  125	  
+
 		     // NAE -> NAE mapping 
 		     32	1000 33 1001 34 1002 35 1003
 		     36	1004 37 1005 38 1006 39 1007
@@ -35,8 +36,7 @@
 
 		     // NULL FBID Should map to cpu0 to detect NAE send message errors 
 		     127 0
-*/
-		>;
+	>;
 
         // FLOW Table Generation: CRC16 polynomial
   	flow_crc_poly = <0xffff>;
@@ -51,6 +51,9 @@
 	// Packet Ordering Engine (POE)
 	poe {	
 	
+		// Supported modes are 'enque', 'serial', 'bypass'
+		mode = "bypass";
+
 		// Each vector is 512 bit with masb indicating vc 512 and lsb indicating vc 0
 		// Format : 512-bit-vector is specified as 16 32-bit words
 		// Left most word has the vc range 511-479 right most word has vc range 31 - 0
@@ -73,89 +76,46 @@
 				     dv14 = <0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0>;
 				     dv15 = <0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0>;
 		};
-	};
 
-	complex@0 {
-		device_type = "nae-complex";
-		// In Interlaken mode, 2 complexes are used per interface. If complex 0 is used as
-		// interlaken, complex 1 must not exists in this file. Either complex 0 or 2 can be
-		// configured as interlaken
-		mode = "interlaken";
-		loopback_mode = <0>;
-		
-		// Maximum number of lanes per interface = 8 (from 2 complexes)
-		num_lanes = <4>;
-
-		// Max ingress fifo size 256 units (size of one unit is 64 byte)
-		iface_fifo_sizes = <55>;
-
-		// Max parser sequence fifo size 1024 packets 
-		// (if 1588 Timestamp is not required, then max size increases to 2048)
-		parser_sequence_fifo_sizes = <225>;
-
-		// Since rx_buffer is per context, we can have a few different ways
-		//  to populate the operand
-		// Maximum number of channels available for interlaken = 256
-		num_channels = <4>;
-		rx_buffer_sizes = <240 240 240 240>;
-		// rx_buffer_sizes = <944>;
-
-		// Max available descriptors are 1024  (across all complexes).
-		// Per port num_free_descriptors must be even number
-		num_free_descs = <150>;
-		free_desc_sizes = <2048>;
-		ucore_mask = <0xffff>;
 	};
-	complex@2 {
-		device_type = "nae-complex";
-		mode = "xaui";
-		loopback_mode = <0>;
-
-		// Max ingress fifo size 256 units (size of one unit is 64 byte)
-		iface_fifo_sizes = <55>;
 
-		// Max parser sequence fifo size 1024 packets 
-		// (if 1588 Timestamp is not required, then max size increases to 2048)
-		parser_sequence_fifo_sizes = <225>;
-
-		// Since rx_buffer is per context, we can have a few different ways
-		//  to populate the operand
-//		num_channels = <8>;
-//		rx_buffer_sizes = <120 120 120 120 120 120 120 120>;
-		num_channels = <1>;
-		rx_buffer_sizes = <944>;
-
-		// Max available descriptors are 1024  (across all complexes).
-		// Per port num_free_descriptors must be even number
-		num_free_descs = <150>;
-		free_desc_sizes = <2048>;
-		ucore_mask = <0xffff>;
-	};
-	complex@3 {
-		device_type = "nae-complex";
-		mode = "xaui";
-		loopback_mode = <0>;
-
-		// Max ingress fifo size 256 units (size of one unit is 64 byte)
-		iface_fifo_sizes = <55>;
-
-		// Max parser sequence fifo size 1024 packets 
-		// (if 1588 Timestamp is not required, then max size increases to 2048)
-		parser_sequence_fifo_sizes = <225>;
-
-		// Since rx_buffer is per context, we can have a few different ways
-		//  to populate the operand
-//		num_channels = <8>;
-//		rx_buffer_sizes = <120 120 120 120 120 120 120 120>;
-		num_channels = <1>;
-		rx_buffer_sizes = <944>;
-
-		// Max available descriptors are 1024  (across all complexes).
-		// Per port num_free_descriptors must be even number
-		num_free_descs = <150>;
-		free_desc_sizes = <2048>;
-		ucore_mask = <0xffff>;
+	complex@0 {
+                device_type = "nae-complex";
+                // In Interlaken mode, 2 complexes are used per interface. If complex 0 is used as
+                // interlaken, complex 1 must not exists in this file. Either complex 0 or 2 can be
+                // configured as interlaken
+                mode = "interlaken";
+		//select daughter board : cortina or loopback
+		db = "cortina";
+
+                loopback_mode = <0>;
+
+                // Maximum number of lanes per interface = 8 (from 2 complexes)
+                num_lanes = <4>;
+		// lanerate 0 = 3.125Gbps , 1 = 6.25Gbps
+		lane_rate = <0>;
+
+                // Max ingress fifo size 256 units (size of one unit is 64 byte)
+                iface_fifo_sizes = <110>;
+
+                // Max parser sequence fifo size 1024 packets
+                // (if 1588 Timestamp is not required, then max size increases to 2048)
+                parser_sequence_fifo_sizes = <225>;
+
+                // Since rx_buffer is per context, we can have a few different ways
+                //  to populate the operand
+                num_channels = <4>;
+                rx_buffer_sizes = <460 460 460 460>;
+                //num_channels = <1>;
+                //rx_buffer_sizes = <944>;
+
+                // Max available descriptors are 1024  (across all complexes).
+                // Per port num_free_descriptors must be even number
+                num_free_descs = <300>;
+                free_desc_sizes = <2048>;
+                ucore_mask = <0xffff>;
 	};
+/*
 	complex@4 {
 		device_type = "nae-complex";
 		mode = "sgmii";
@@ -164,6 +124,9 @@
 
 		// Max ingress fifo size 256 units (size of one unit is 64 byte)
 		iface_fifo_sizes = <13 13>;
+                
+		ext_phy_addr = <17 16>;
+                ext_phy_bus = <0 0>;
 
 		// Max parser sequence fifo size 1024 packets 
 		// (if 1588 Timestamp is not required, then max size increases to 2048)
@@ -181,4 +144,7 @@
 		free_desc_sizes = <2048 2048>;
 		ucore_mask = <0xffff 0xffff>;
 	};
+*/
 };
+
+
-- 
1.7.1

