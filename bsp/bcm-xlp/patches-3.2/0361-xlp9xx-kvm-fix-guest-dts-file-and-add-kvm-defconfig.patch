From fb30257a868cc50c79acd54de6aa20605088a964 Mon Sep 17 00:00:00 2001
From: Yonghong Song <ysong@broadcom.com>
Date: Wed, 8 May 2013 13:05:11 -0700
Subject: xlp9xx: kvm: fix guest dts file and add kvm defconfig

  o add correct memory map and cpumask for guest dts file
  o add default kvm defconfig, the config file is generated based on
    nlm_xlp_evp_kvm_defconfig by running "make menuconfig" to enable
     . Virtualization
          Kernel Virtual Machine support
     . Kernel type
          Preemption Model (Preemptible Kernel (Low-Latency Desktop))
   	    Preemptible Kernel (Low-Latency Desktop)
[Based on SDK 3.2]
Signed-off-by: Quanyang Wang <quanyang.wang@windriver.com>
Signed-off-by: Nam Ninh <nam.ninh@windriver.com>

diff --git a/arch/mips/boot/dts/xlp9xx-linux-guest.dts b/arch/mips/boot/dts/xlp9xx-linux-guest.dts
index d7dc065..c774ab8 100644
--- a/arch/mips/boot/dts/xlp9xx-linux-guest.dts
+++ b/arch/mips/boot/dts/xlp9xx-linux-guest.dts
@@ -5,73 +5,25 @@
 /dts-v1/;
 / {
 	model = "netlogic,XLP-GVP";
-	compatible = "netlogic,xlp";
+        compatible = "netlogic,xlp";
+        #address-cells = <2>;
+        #size-cells = <2>;
 
-	#address-cells = <1>;
-	#size-cells = <1>;
-
-	hypervisor {
-		hypervisor-name = "Xen";
-		alloc_dom0_memory = <0>;
-		bootargs = "ncores=8 dom0_loadaddr=0x72000000 dom0_size=0x1c000000 dom0_cpumask=0xffffffff -- ";
-		domain_heap = <0x80000000 0x20000000>;
-	};
-	doms {
-		#address-cells = <1>;
-		#size-cells = <1>;
-		dom@0 {
-			device_type = "domain";
-			os = "linux";
-
-			#address-cells = <1>;
-			#size-cells = <1>;
-
-			cpu {
-				onlinemask = <0x1>;
-                                nae-rx-vc = <0>;
-                                nae-fb-vc = <1>;
-			};
-			uart {
-				id = <0>;
-				owner = <1>;
-				sharedcfg = <0x1f000000>;
-			};
-			memory {
-				reg = <0x01000000 0x0f000000   // 240M @ 16M
-					0x20000000 0x20000000>; // 512M @ 512M
-			};
-                        fmn {
-                                node_0_vc_mask = <0xffffffff 0xffffffff 0xffffffff 0xffffffff>;
-                                node_1_vc_mask = <0xffffffff 0xffffffff 0xffffffff 0xffffffff>;
-                                node_2_vc_mask = <0xffffffff 0xffffffff 0xffffffff 0xffffffff>;
-                                node_3_vc_mask = <0xffffffff 0xffffffff 0xffffffff 0xffffffff>;
-                        };
-			pic {
-			};
-		};
-	};
+        memory {
+                device_type = "memory";
+                reg =  <0 0x00100000 0 0x0FF00000       // 255M at 1M
+                        0 0x20000000 0 0x10000000>;     // 256M at 512M
+        };
 
 	chosen {
-		bootargs = " xlp_noi2c console=ttyS0,115200 rdinit=/sbin/init ";
-	};
-
-	/* These binaries are downloaded at the resp physical memory locations
-	 * by their corresponding bootstrapping loaders. For example,
-	 * u-boot is loaded by x-load at 193M, sysconfig is loaded by u-boot
-	 * at 1M, hypervisor by u-boot hypervisor at 136M.
-	 * On simulator all these binaries are pre-loaded by using '-F' option
-	 * for convenience. On silicon, they will be loaded by their corresponding
-	 * temporary download locations the stage-1/stage-2 firmware
-	 */
-	firmware-download {
-		u-boot        = <0x0c100000 0x3f00000>;  /* 63M @ 193M */
-		sysconfig     = <0x00100000 0x00100000>; /* 1M @ 1M */
-		hypervisor    = <0x08800000 0x00800000>; /* 8M @ 136M */
-		dom0          = <0x09000000 0x03000000>; /* 48M @ 144M */
-		domU-ramdisk  = <0x60000000 0x60800000>; /* 8M @ 1536M */
+		netlogic,cpumask = <0xff>; /* This is only for simulator and temporary. should be fixed later */
+		bootargs = " console=ttyS0,115200  rhash_entries=1048576";
 	};
 
 	soc {
+		nodes {
+			num-nodes = <1>;
+		};
 
 	};
 };
-- 
1.7.1

