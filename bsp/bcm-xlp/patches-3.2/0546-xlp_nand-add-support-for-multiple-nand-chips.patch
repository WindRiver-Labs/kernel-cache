From cbb640afb0191630523845d437b1f3ce7caae728 Mon Sep 17 00:00:00 2001
From: Kamlakant Patel <kamlakant.patel@broadcom.com>
Date: Wed, 16 Apr 2014 12:00:16 +0530
Subject: xlp_nand: add support for multiple nand chips

This patch adds support for multiple nand chips connected to nand
controller via chip selects.
[Based on SDK 3.2]
Signed-off-by: Quanyang Wang <quanyang.wang@windriver.com>
Signed-off-by: Nam Ninh <nam.ninh@windriver.com>

diff --git a/arch/mips/boot/dts/xlp2xx-ep-linux-tmpl.dts b/arch/mips/boot/dts/xlp2xx-ep-linux-tmpl.dts
index 0d023aa..4fec35f 100644
--- a/arch/mips/boot/dts/xlp2xx-ep-linux-tmpl.dts
+++ b/arch/mips/boot/dts/xlp2xx-ep-linux-tmpl.dts
@@ -130,29 +130,35 @@
 			};
 		};
 
-		nand_flash@0,0 {
+		nand_flash@39000 {
 			compatible = "netlogic,xlp-nand";
 			#address-cells = <1>;
-			#size-cells = <1>;
+			#size-cells = <0>;
 			reg = <0 0x39000 0x1000>;
 
 			interrupts = <43>;
 			interrupt-parent = <&pic>;
 			nand-ecc-mode = "hw";
 
-			partition@0 {
-				label = "firmware";
-				reg = <0x0 0x20000000>;
-			};
+			nand_cs1 {
+				#address-cells = <1>;
+				#size-cells = <1>;
+				reg = <1>;
 
-			partition@1 {
-				label = "kernel";
-				reg = <0x20000000 0x20000000>;
-			};
+				partition@0 {
+					label = "firmware";
+					reg = <0x0 0x20000000>;
+				};
+
+				partition@1 {
+					label = "kernel";
+					reg = <0x20000000 0x20000000>;
+				};
 
-			partition@2 {
-				label = "user";
-				reg = <0x40000000 0x0>;
+				partition@2 {
+					label = "user";
+					reg = <0x40000000 0x0>;
+				};
 			};
 		};
 
diff --git a/arch/mips/boot/dts/xlp2xx-linux-tmpl.dts b/arch/mips/boot/dts/xlp2xx-linux-tmpl.dts
index fbc2736..4feab86 100644
--- a/arch/mips/boot/dts/xlp2xx-linux-tmpl.dts
+++ b/arch/mips/boot/dts/xlp2xx-linux-tmpl.dts
@@ -130,29 +130,35 @@
 			};
 		};
 
-		nand_flash@0,0 {
+		nand_flash@39000 {
 			compatible = "netlogic,xlp-nand";
 			#address-cells = <1>;
-			#size-cells = <1>;
+			#size-cells = <0>;
 			reg = <0 0x39000 0x1000>;
 
 			interrupts = <43>;
 			interrupt-parent = <&pic>;
 			nand-ecc-mode = "hw";
 
-			partition@0 {
-				label = "firmware";
-				reg = <0x0 0x20000000>;
-			};
+			nand_cs1 {
+				#address-cells = <1>;
+				#size-cells = <1>;
+				reg = <1>;
 
-			partition@1 {
-				label = "kernel";
-				reg = <0x20000000 0x20000000>;
-			};
+				partition@0 {
+					label = "firmware";
+					reg = <0x0 0x20000000>;
+				};
+
+				partition@1 {
+					label = "kernel";
+					reg = <0x20000000 0x20000000>;
+				};
 
-			partition@2 {
-				label = "user";
-				reg = <0x40000000 0x0>;
+				partition@2 {
+					label = "user";
+					reg = <0x40000000 0x0>;
+				};
 			};
 		};
 
diff --git a/arch/mips/boot/dts/xlp2xx-pcie-linux-tmpl.dts b/arch/mips/boot/dts/xlp2xx-pcie-linux-tmpl.dts
index a40b8e5..9e56e4c 100644
--- a/arch/mips/boot/dts/xlp2xx-pcie-linux-tmpl.dts
+++ b/arch/mips/boot/dts/xlp2xx-pcie-linux-tmpl.dts
@@ -95,29 +95,35 @@
 			reg = <0 0x2a000 0x30>;
 		};
 
-		nand_flash@0,0 {
+		nand_flash@39000 {
 			compatible = "netlogic,xlp-nand";
 			#address-cells = <1>;
-			#size-cells = <1>;
+			#size-cells = <0>;
 			reg = <0 0x39000 0x1000>;
 
 			interrupts = <43>;
 			interrupt-parent = <&pic>;
 			nand-ecc-mode = "hw";
 
-			partition@0 {
-				label = "firmware";
-				reg = <0x0 0x20000000>;
-			};
-
-			partition@1 {
-				label = "kernel";
-				reg = <0x20000000 0x20000000>;
-			};
-
-			partition@2 {
-				label = "user";
-				reg = <0x40000000 0x0>;
+			nand_cs1 {
+				#address-cells = <1>;
+				#size-cells = <1>;
+				reg = <1>;
+
+				partition@0 {
+					label = "firmware";
+					reg = <0x0 0x20000000>;
+				};
+
+				partition@1 {
+					label = "kernel";
+					reg = <0x20000000 0x20000000>;
+				};
+
+				partition@2 {
+					label = "user";
+					reg = <0x40000000 0x0>;
+				};
 			};
 		};
 
diff --git a/arch/mips/boot/dts/xlp3xx-linux-tmpl.dts b/arch/mips/boot/dts/xlp3xx-linux-tmpl.dts
index 05a157a..1143b3b 100644
--- a/arch/mips/boot/dts/xlp3xx-linux-tmpl.dts
+++ b/arch/mips/boot/dts/xlp3xx-linux-tmpl.dts
@@ -131,29 +131,35 @@
 			};
 		};
 
-		nand_flash@0,0 {
+		nand_flash@39000 {
 			compatible = "netlogic,xlp-nand";
 			#address-cells = <1>;
-			#size-cells = <1>;
+			#size-cells = <0>;
 			reg = <0 0x39000 0x1000>;
 
 			interrupts = <43>;
 			interrupt-parent = <&pic>;
 			nand-ecc-mode = "hw";
 
-			partition@0 {
-				label = "firmware";
-				reg = <0x0 0x20000000>;
-			};
+			nand_cs1 {
+				#address-cells = <1>;
+				#size-cells = <1>;
+				reg = <1>;
 
-			partition@1 {
-				label = "kernel";
-				reg = <0x20000000 0x20000000>;
-			};
+				partition@0 {
+					label = "firmware";
+					reg = <0x0 0x20000000>;
+				};
+
+				partition@1 {
+					label = "kernel";
+					reg = <0x20000000 0x20000000>;
+				};
 
-			partition@2 {
-				label = "user";
-				reg = <0x40000000 0x0>;
+				partition@2 {
+					label = "user";
+					reg = <0x40000000 0x0>;
+				};
 			};
 		};
 
diff --git a/arch/mips/boot/dts/xlp4xx-linux-tmpl.dts b/arch/mips/boot/dts/xlp4xx-linux-tmpl.dts
index c25f0e5..6c02121 100644
--- a/arch/mips/boot/dts/xlp4xx-linux-tmpl.dts
+++ b/arch/mips/boot/dts/xlp4xx-linux-tmpl.dts
@@ -96,29 +96,35 @@
 			reg = <0 0x2a000 0x30>;
 		};
 
-		nand_flash@0,0 {
+		nand_flash@39000 {
 			compatible = "netlogic,xlp-nand";
 			#address-cells = <1>;
-			#size-cells = <1>;
+			#size-cells = <0>;
 			reg = <0 0x39000 0x1000>;
 
 			interrupts = <43>;
 			interrupt-parent = <&pic>;
 			nand-ecc-mode = "hw";
 
-			partition@0 {
-				label = "firmware";
-				reg = <0x0 0x20000000>;
-			};
+			nand_cs1 {
+				#address-cells = <1>;
+				#size-cells = <1>;
+				reg = <1>;
 
-			partition@1 {
-				label = "kernel";
-				reg = <0x20000000 0x20000000>;
-			};
+				partition@0 {
+					label = "firmware";
+					reg = <0x0 0x20000000>;
+				};
+
+				partition@1 {
+					label = "kernel";
+					reg = <0x20000000 0x20000000>;
+				};
 
-			partition@2 {
-				label = "user";
-				reg = <0x40000000 0x0>;
+				partition@2 {
+					label = "user";
+					reg = <0x40000000 0x0>;
+				};
 			};
 		};
 
diff --git a/arch/mips/boot/dts/xlp8xx-linux-mn-tmpl.dts b/arch/mips/boot/dts/xlp8xx-linux-mn-tmpl.dts
index ea21add..cd0d176 100644
--- a/arch/mips/boot/dts/xlp8xx-linux-mn-tmpl.dts
+++ b/arch/mips/boot/dts/xlp8xx-linux-mn-tmpl.dts
@@ -97,29 +97,35 @@
 			};
 		};
 
-		nand_flash@0,0 {
+		nand_flash@39000 {
 			compatible = "netlogic,xlp-nand";
 			#address-cells = <1>;
-			#size-cells = <1>;
+			#size-cells = <0>;
 			reg = <0 0x39000 0x1000>;
 
 			interrupts = <43>;
 			interrupt-parent = <&pic0>;
 			nand-ecc-mode = "hw";
 
-			partition@0 {
-				label = "firmware";
-				reg = <0x0 0x20000000>;
-			};
-
-			partition@1 {
-				label = "kernel";
-				reg = <0x20000000 0x20000000>;
-			};
-
-			partition@2 {
-				label = "user";
-				reg = <0x40000000 0x0>;
+			nand_cs1 {
+				#address-cells = <1>;
+				#size-cells = <1>;
+				reg = <1>;
+
+				partition@0 {
+					label = "firmware";
+					reg = <0x0 0x20000000>;
+				};
+
+				partition@1 {
+					label = "kernel";
+					reg = <0x20000000 0x20000000>;
+				};
+
+				partition@2 {
+					label = "user";
+					reg = <0x40000000 0x0>;
+				};
 			};
 		};
 
diff --git a/arch/mips/boot/dts/xlp8xx-linux-mn4-tmpl.dts b/arch/mips/boot/dts/xlp8xx-linux-mn4-tmpl.dts
index ffc0f47..2244908 100644
--- a/arch/mips/boot/dts/xlp8xx-linux-mn4-tmpl.dts
+++ b/arch/mips/boot/dts/xlp8xx-linux-mn4-tmpl.dts
@@ -97,29 +97,35 @@
 			};
 		};
 
-		nand_flash@0,0 {
+		nand_flash@39000 {
 			compatible = "netlogic,xlp-nand";
 			#address-cells = <1>;
-			#size-cells = <1>;
+			#size-cells = <0>;
 			reg = <0 0x39000 0x1000>;
 
 			interrupts = <43>;
 			interrupt-parent = <&pic0>;
 			nand-ecc-mode = "hw";
 
-			partition@0 {
-				label = "firmware";
-				reg = <0x0 0x20000000>;
-			};
-
-			partition@1 {
-				label = "kernel";
-				reg = <0x20000000 0x20000000>;
-			};
-
-			partition@2 {
-				label = "user";
-				reg = <0x40000000 0x0>;
+			nand_cs1 {
+				#address-cells = <1>;
+				#size-cells = <1>;
+				reg = <1>;
+
+				partition@0 {
+					label = "firmware";
+					reg = <0x0 0x20000000>;
+				};
+
+				partition@1 {
+					label = "kernel";
+					reg = <0x20000000 0x20000000>;
+				};
+
+				partition@2 {
+					label = "user";
+					reg = <0x40000000 0x0>;
+				};
 			};
 		};
 
diff --git a/arch/mips/boot/dts/xlp8xx-linux-tmpl.dts b/arch/mips/boot/dts/xlp8xx-linux-tmpl.dts
index dac46fb..b3fe975 100644
--- a/arch/mips/boot/dts/xlp8xx-linux-tmpl.dts
+++ b/arch/mips/boot/dts/xlp8xx-linux-tmpl.dts
@@ -131,29 +131,35 @@
 			};
 		};
 
-		nand_flash@0,0 {
+		nand_flash@39000 {
 			compatible = "netlogic,xlp-nand";
 			#address-cells = <1>;
-			#size-cells = <1>;
+			#size-cells = <0>;
 			reg = <0 0x39000 0x1000>;
 
 			interrupts = <43>;
 			interrupt-parent = <&pic>;
 			nand-ecc-mode = "hw";
 
-			partition@0 {
-				label = "firmware";
-				reg = <0x0 0x20000000>;
-			};
+			nand_cs1 {
+				#address-cells = <1>;
+				#size-cells = <1>;
+				reg = <1>;
 
-			partition@1 {
-				label = "kernel";
-				reg = <0x20000000 0x20000000>;
-			};
+				partition@0 {
+					label = "firmware";
+					reg = <0x0 0x20000000>;
+				};
+
+				partition@1 {
+					label = "kernel";
+					reg = <0x20000000 0x20000000>;
+				};
 
-			partition@2 {
-				label = "user";
-				reg = <0x40000000 0x0>;
+				partition@2 {
+					label = "user";
+					reg = <0x40000000 0x0>;
+				};
 			};
 		};
 
-- 
1.7.1

