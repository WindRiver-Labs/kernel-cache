From cc070f6e8eb7102d80dc82cc6d3ab8ef16d4109e Mon Sep 17 00:00:00 2001
From: kopal <kopal@broadcom.com>
Date: Tue, 25 Mar 2014 16:24:45 +0530
Subject: syslib: Correct detection of 2XX_B0

	Added new macros to differentiate between B0 Revision
	of 2XX/3XX and 8XX boards.
[Based on SDK 3.2]
Signed-off-by: Quanyang Wang <quanyang.wang@windriver.com>
Signed-off-by: Nam Ninh <nam.ninh@windriver.com>

diff --git a/arch/mips/netlogic/lib/syslib/include/nlm_hal_xlp_dev.h b/arch/mips/netlogic/lib/syslib/include/nlm_hal_xlp_dev.h
index 400cec1..260187a 100644
--- a/arch/mips/netlogic/lib/syslib/include/nlm_hal_xlp_dev.h
+++ b/arch/mips/netlogic/lib/syslib/include/nlm_hal_xlp_dev.h
@@ -65,12 +65,14 @@
 #define CHIP_PROCESSOR_ID_XLP_204   0xB7
 #define CHIP_PROCESSOR_ID_XLP_104   0xF7
 
-/*Software Revision Number        XLP8XX  XLP3XX */
-#define XLP_REVISION_A0  0x00 /*    0        0   */
-#define XLP_REVISION_A1  0x01 /*    1        1   */
-#define XLP_REVISION_A2  0x02 /*    2            */
-#define XLP_REVISION_B0  0x03 /*    3        2   */
-#define XLP_REVISION_B1  0x04 /*    4        3   */
+/*Software Revision Number              XLP8XX  XLP3XX/2XX  */
+#define XLP_REVISION_A0  	0x00 /*    0        0       */
+#define XLP_REVISION_A1  	0x01 /*    1        1       */
+#define XLP_REVISION_A2  	0x02 /*    2        -       */
+#define XLP_REVISION_B0  	0x02 /*    -        2       */
+#define XLP_REVISION_8XX_B0  	0x03 /*    3        -       */
+#define XLP_REVISION_8XX_B1  	0x04 /*    4        -       */
+
 
 #define XLP_REVISION_AX  0xAF
 #define XLP_REVISION_BX  0xBF
@@ -130,8 +132,8 @@ extern int is_nlm_xlp(unsigned int chipid, unsigned int rev,  unsigned int ext);
 #endif /* is_nlm_xlp8xx */
 
 #define is_nlm_xlp8xx_ax()   ( is_nlm_xlp(0x8000, XLP_REVISION_AX,  0) || is_nlm_xlp(0x4000, XLP_REVISION_AX, 0))
-#define is_nlm_xlp8xx_b0()   ( is_nlm_xlp(0x8000, XLP_REVISION_B0,  0) || is_nlm_xlp(0x4000, XLP_REVISION_B0, 0))
-#define is_nlm_xlp8xx_b1()   ( is_nlm_xlp(0x8000, XLP_REVISION_B1,  0) || is_nlm_xlp(0x4000, XLP_REVISION_B1, 0))
+#define is_nlm_xlp8xx_b0()   ( is_nlm_xlp(0x8000, XLP_REVISION_8XX_B0,  0) || is_nlm_xlp(0x4000, XLP_REVISION_8XX_B0, 0))
+#define is_nlm_xlp8xx_b1()   ( is_nlm_xlp(0x8000, XLP_REVISION_8XX_B1,  0) || is_nlm_xlp(0x4000, XLP_REVISION_8XX_B1, 0))
 #define is_nlm_xlp8xx_bx()   ( is_nlm_xlp(0x8000, XLP_REVISION_BX,  0) || is_nlm_xlp(0x4000, XLP_REVISION_BX, 0))
 #define is_nlm_xlp832_ax()   ( is_nlm_xlp(0x8084, XLP_REVISION_AX,  0))
 
diff --git a/arch/mips/netlogic/lib/syslib/src/nlm_hal_cpu_info.c b/arch/mips/netlogic/lib/syslib/src/nlm_hal_cpu_info.c
index f068177..3f27ae4 100644
--- a/arch/mips/netlogic/lib/syslib/src/nlm_hal_cpu_info.c
+++ b/arch/mips/netlogic/lib/syslib/src/nlm_hal_cpu_info.c
@@ -153,7 +153,7 @@ static __inline__ int get_nlm_xlp2xx_rev(void)
 static __inline__ int is_nlm_xlp8xx_rev_xx(uint32_t rev)
 {
 	int sw_rev=get_nlm_xlp8xx_rev();
-	uint32_t rev_b0 = XLP_REVISION_B0;
+	uint32_t rev_b0 = XLP_REVISION_8XX_B0;
 	if( rev==sw_rev)        return 1;
 	if( rev==XLP_REVISION_AX && sw_rev<rev_b0)	return 1;
 	if( rev==XLP_REVISION_BX && (rev_b0<=sw_rev))  	return 1;
@@ -204,7 +204,7 @@ static inline int is_xlp8xx_legacy(int chipid, uint32_t rev)
 
 	if( rev==XLP_REVISION_ANY )	rev=XLP_REVISION_AX;
 	if( sw_rev!=rev && rev!=XLP_REVISION_AX )	return 0;
-	if( XLP_REVISION_B0<=sw_rev ) return 0;
+	if( XLP_REVISION_8XX_B0<=sw_rev ) return 0;
 	if(	(( (chipid==0x8084) || (chipid==0x8000) ) &&  (pid==CHIP_PROCESSOR_ID_XLP_832)) ||
 		(( (chipid==0x8044) || (chipid==0x8000) ) &&  (pid==CHIP_PROCESSOR_ID_XLP_816)) ||
 		(( (chipid==0x4084) || (chipid==0x4000) ) &&  (pid==CHIP_PROCESSOR_ID_XLP_432)) ||
@@ -590,7 +590,7 @@ int  nlm_hal_get_cpuinfo(struct nlm_netl_proc_info* cpu_info)
 		sw_rev = get_nlm_xlp8xx_rev();
 		cpu_info->revision= sw_rev;
 		sprintf(cpu_info->cpu_info_str, "%s Rev %c%1d",
-			chipid_str,(char)('A'+sw_rev/XLP_REVISION_B0), sw_rev%XLP_REVISION_B0);
+			chipid_str,(char)('A'+sw_rev/XLP_REVISION_8XX_B0), sw_rev%XLP_REVISION_8XX_B0);
 	}
 	else
 	{
-- 
1.7.1

