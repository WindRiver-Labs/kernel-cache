From 73d720221e8cd139ef9641af2be96660d0ae477d Mon Sep 17 00:00:00 2001
From: Ganesan Ramalingam <ganesanr@broadcom.com>
Date: Thu, 10 Oct 2013 16:34:31 +0530
Subject: sys/build: Remove memory range and cpumask for multi-node

* Fix to take dual mode dts for dual-node build
* Remove memory range and cpumask setting from dts, memory ranges
  are taken care in Linux, if need to set in dts shall set according
  to available memory on board and compile the dts.
* cpumask are skipped in dts, which is taken care by Linux, if need
  a particulaer range of cpumask, shall set in dts and compile.
[Based on SDK 3.2]
Signed-off-by: Quanyang Wang <quanyang.wang@windriver.com>
Signed-off-by: Nam Ninh <nam.ninh@windriver.com>

diff --git a/arch/mips/boot/dts/mn4xlp8xx-linux.dts b/arch/mips/boot/dts/mn4xlp8xx-linux.dts
index e75c99a..e665a32 100644
--- a/arch/mips/boot/dts/mn4xlp8xx-linux.dts
+++ b/arch/mips/boot/dts/mn4xlp8xx-linux.dts
@@ -8,16 +8,22 @@
         compatible = "netlogic,xlp";
         #address-cells = <2>;
         #size-cells = <2>;
-	/*memory range for linux. This will not appear in dom0*/
-        memory {
-                device_type = "memory";
-                reg =  <0 0x00000000 0 0x0B000000
-                        0 0x20000000 0 0xa0000000
-                        0 0xe0000000 0 0x20000000
-                        1 0x00000000 1 0x00000000
-                        2 0x00000000 1 0x00000000
-                        3 0x00000000 1 0x00000000>;
-        };
+
+	/* Memory ranges for linux. On multi-node, the range below should
+	 * include local memory of all the nodes.
+	 * When the memory is not provided, linux will use the DRAM BARs
+	 * to determine the memory available.
+	 *
+	 * memory {
+	 *       device_type = "memory";
+	 *       reg =  <0 0x00000000 0 0x0B000000
+	 *               0 0x20000000 0 0xa0000000
+	 *               0 0xe0000000 0 0x20000000
+	 *               1 0x00000000 1 0x00000000
+	 *               2 0x00000000 1 0x00000000
+	 *               3 0x00000000 1 0x00000000>;
+	 * };
+	 */
 
 	hypervisor {
 		hypervisor-name = "Xen";
diff --git a/arch/mips/boot/dts/mnxlp8xx-linux.dts b/arch/mips/boot/dts/mnxlp8xx-linux.dts
index bde5332..1585b88 100644
--- a/arch/mips/boot/dts/mnxlp8xx-linux.dts
+++ b/arch/mips/boot/dts/mnxlp8xx-linux.dts
@@ -8,13 +8,19 @@
         compatible = "netlogic,xlp";
         #address-cells = <2>;
         #size-cells = <2>;
-	/*memory range for linux. This will not appear in dom0*/
-        memory {
-                device_type = "memory";
-                reg =  <0 0x00000000 0 0x0B000000
-                        0 0x20000000 0 0xa0000000
-                        0 0xe0000000 0 0x20000000>;
-        };
+
+	/* Memory ranges for linux. On multi-node, the range below should
+	 * include local memory of all the nodes.
+	 * When the memory is not provided, linux will use the DRAM BARs
+	 * to determine the memory available.
+	 *
+	 * memory {
+	 *       device_type = "memory";
+	 *       reg =  <0 0x00000000 0 0x0B000000
+	 *               0 0x20000000 0 0xa0000000
+	 *               0 0xe0000000 0 0x20000000>;
+	 * };
+	 */
 
 	hypervisor {
 		hypervisor-name = "Xen";
diff --git a/arch/mips/boot/dts/mnxlp9xx-linux.dts b/arch/mips/boot/dts/mnxlp9xx-linux.dts
index bdc509e..a8991a1 100644
--- a/arch/mips/boot/dts/mnxlp9xx-linux.dts
+++ b/arch/mips/boot/dts/mnxlp9xx-linux.dts
@@ -9,11 +9,16 @@
         #address-cells = <2>;
         #size-cells = <2>;
 
-        memory {
-                device_type = "memory";
-                reg =  <0 0x00000000 0 0x0FF00000       // 255M at 1M
-                        0 0x20000000 0 0xa0000000>;     // 2560M at 512M
-        };
+	/* Memory ranges for linux. On multi-node, the range below should
+	 * include local memory of all the nodes.
+	 *
+	 * memory {
+	 *       device_type = "memory";
+	 *       reg =  <0 0x00000000 0 0x0B000000
+	 *               0 0x20000000 0 0xa0000000
+	 *               0 0xe0000000 0 0x20000000>;
+	 * };
+	 */
 
         /* memory range for HEv2 pkt mem. Only one contig memory per node supported */
         pktmem {
@@ -192,12 +197,13 @@
 
 	};
 	chosen {
-		/* examples for different core/thread models.
-		 * 16core: netlogic,cpumask=<0xffffffff 0xffffffff>
-		 * 20core: netlogic,cpumask=<0xffff 0xffffffff 0xffffffff>
-		 * 15 core, skipping core #5: netlogic,cpumask=<0xffffffff 0xff0fffff>
+		/* Examples for different core/thread models.
+		 * 16 core: netlogic,cpumask=<0xffffffff 0xffffffff>;
+		 * 20 core: netlogic,cpumask=<0 0xffff 0xffffffff 0xffffffff>;
+		 * 40 core: netlogic,cpumask=<0 0xffff 0xffffffff 0xffffffff
+		 *			     0 0xffff 0xffffffff 0xffffffff>;
+		 * 15 core(core 5 disabled): netlogic,cpumask=<0xffffffff 0xff0fffff>;
 		 */
-		netlogic,cpumask = <0x01>;
 		bootargs = " console=ttyS0,115200  rhash_entries=1048576";
 		/*linux,initrd-start=<0x00c00000>;
 		linux,initrd-end=<0x02c00000>;*/
diff --git a/arch/mips/boot/dts/xlp9xx-linux-mn-tmpl.dts b/arch/mips/boot/dts/xlp9xx-linux-mn-tmpl.dts
index dc05462..501463f 100644
--- a/arch/mips/boot/dts/xlp9xx-linux-mn-tmpl.dts
+++ b/arch/mips/boot/dts/xlp9xx-linux-mn-tmpl.dts
@@ -9,12 +9,6 @@
 	#address-cells = <2>;
 	#size-cells = <2>;
 
-	memory {
-		device_type = "memory";
-		reg =  <0 0x00100000 0 0x0FF00000	// 255M at 1M
-			0 0x20000000 0 0xa0000000>;	// 2560M at 512M
-	};
-
 	soc {
 		#address-cells = <2>;
 		#size-cells = <1>;
-- 
1.7.1

