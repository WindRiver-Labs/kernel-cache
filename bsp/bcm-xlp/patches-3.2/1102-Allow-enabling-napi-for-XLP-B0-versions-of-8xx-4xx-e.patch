From c60aa9e286722b1fa64b4264dcab98226dda0a6a Mon Sep 17 00:00:00 2001
From: Krishnamurthy D V <kmurthy@netlogicmicro.com>
Date: Tue, 7 Feb 2012 00:21:43 -0800
Subject: Allow enabling napi for XLP B0 versions of 8xx 4xx etc

[Based on SDK 3.2]
Signed-off-by: Quanyang Wang <quanyang.wang@windriver.com>
Signed-off-by: Nam Ninh <nam.ninh@windriver.com>

diff --git a/drivers/misc/netlogic/nae-perf/xlp_nae.c b/drivers/misc/netlogic/nae-perf/xlp_nae.c
index ed9ecf8..e6e1039 100755
--- a/drivers/misc/netlogic/nae-perf/xlp_nae.c
+++ b/drivers/misc/netlogic/nae-perf/xlp_nae.c
@@ -1201,9 +1201,11 @@ static void nlm_xlp_nae_init(void)
 	printk("num_descs_perq=%d perf_mode=%s enable_napi=%d enable_lro=%d\n",
 	       num_descs_perq, mode_str[perf_mode], enable_napi, enable_lro);
 
-	/* msgring intr may not work in 8xx, disabling the napi */
-	if(is_nlm_xlp8xx() || is_nlm_xlp832_ax() || is_nlm_xlp8xx_ax()) 
+	/* msgring intr may not work in [8421]xxAx parts, disabling the napi */
+	if(is_nlm_xlp8xx_ax() && enable_napi) {
+		printk("NAPI cannot be enabled on XLP Ax parts\n");
 		enable_napi = 0;
+	}
 	
 	for(i=0; i<NR_CPUS; i++)
 		nlm_mode[LAST_RCVD_INDEX(i)] = perf_mode;
-- 
1.7.1

