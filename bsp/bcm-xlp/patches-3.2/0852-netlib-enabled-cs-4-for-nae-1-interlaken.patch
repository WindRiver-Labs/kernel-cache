From 00548a5bce84438c2c158c8dda92c21e3b445935 Mon Sep 17 00:00:00 2001
From: Alok Agrawat <alok@broadcom.com>
Date: Mon, 18 Nov 2013 05:05:07 -0800
Subject: netlib: enabled cs=4 for nae-1 interlaken.

[Based on SDK 3.2]
Signed-off-by: Quanyang Wang <quanyang.wang@windriver.com>
Signed-off-by: Nam Ninh <nam.ninh@windriver.com>

diff --git a/arch/mips/netlogic/lib/netlib/external/cortina_cs34x7/nlm_cortina_cs34x7.c b/arch/mips/netlogic/lib/netlib/external/cortina_cs34x7/nlm_cortina_cs34x7.c
index 3525d22..a344331 100644
--- a/arch/mips/netlogic/lib/netlib/external/cortina_cs34x7/nlm_cortina_cs34x7.c
+++ b/arch/mips/netlogic/lib/netlib/external/cortina_cs34x7/nlm_cortina_cs34x7.c
@@ -346,7 +346,7 @@ int cortina_set_max_framesize(int hwport, int port, uint16_t framesize)
 	return 0;
 }
 
-int nlm_hal_init_cs34x7(int hwport,int num_lanes, int lane_rate)
+int nlm_hal_init_cs34x7(int hwport,int num_lanes, int lane_rate, int nae_id)
 {
 #if !defined(XLP_SIM) || defined(NLM_BOARD)
 	int physport = 0;
@@ -378,6 +378,8 @@ int nlm_hal_init_cs34x7(int hwport,int num_lanes, int lane_rate)
 	}
 #endif
 
+	if(nae_id == 1)
+		hwport += 8;
 	switch(hwport) {
 		case XLP_ILK_PORT_0:
 			cortina_cs34x7_init(XLP_ILK_PORT0_CS, (XLP_ILK_MAX_LANES - num_lanes), lane_rate);
diff --git a/arch/mips/netlogic/lib/netlib/include/nlm_hal_nae.h b/arch/mips/netlogic/lib/netlib/include/nlm_hal_nae.h
index 7ab767f..3e58996 100644
--- a/arch/mips/netlogic/lib/netlib/include/nlm_hal_nae.h
+++ b/arch/mips/netlogic/lib/netlib/include/nlm_hal_nae.h
@@ -495,7 +495,7 @@ extern void nlm_hal_mdio_init(int node);
 extern void nlm_hal_sgmii_pcs_init(int node, int sgmii_cplx_mask);
 extern void nlm_hal_xaui_pcs_init(int node, nlm_nae_config_ptr nae_cfg);
 extern int nlm_hal_ilk_pcs_init(int node, uint32_t ilk_complex_map);
-extern int nlm_hal_init_cs34x7(int hwport,int num_lanes, int lane_rate);
+extern int nlm_hal_init_cs34x7(int hwport,int num_lanes, int lane_rate, int nae_id);
 extern int cortina_set_max_framesize(int hwport, int port, uint16_t framesize);
 #ifdef NLM_HAL_LINUX_KERNEL
 #ifdef NLM_CORTINA_SUPPORT
diff --git a/arch/mips/netlogic/lib/netlib/src/netsoc_nae.c b/arch/mips/netlogic/lib/netlib/src/netsoc_nae.c
index e3c1bcd..3c42ba7 100644
--- a/arch/mips/netlogic/lib/netlib/src/netsoc_nae.c
+++ b/arch/mips/netlogic/lib/netlib/src/netsoc_nae.c
@@ -4122,7 +4122,7 @@ static int __netsoc_init_net_port(net_port_t *netport, uint32_t context)
 #if defined(NLM_CORTINA_SUPPORT)
         if (netport->iftype == INTERLAKEN_IF) {
 	        if ((nlm_hal_init_cs34x7(hw_port, nae->num_lanes[hw_port / XLP_ILK_MAX_LANES],
-        	        nae->lane_rate[hw_port / XLP_ILK_MAX_LANES]) == 0) &&
+        	        nae->lane_rate[hw_port / XLP_ILK_MAX_LANES], nae->nae_id) == 0) &&
                 	        (is_ilk_lanealigned(nae, hw_port/4))) {
                         netsoc_api_print(NETSOC_APIDBG_PORT, "Interlaken lanes on port %d are aligned\n", hw_port);
 		}
diff --git a/arch/mips/netlogic/lib/netlib/src/nlm_hal_nae.c b/arch/mips/netlogic/lib/netlib/src/nlm_hal_nae.c
index 8a84ce8..f27ba3d 100644
--- a/arch/mips/netlogic/lib/netlib/src/nlm_hal_nae.c
+++ b/arch/mips/netlogic/lib/netlib/src/nlm_hal_nae.c
@@ -3700,7 +3700,7 @@ static void parse_fdt_nae_config(void *fdt, int node, nlm_nae_config_ptr nae_cfg
 #if !defined(NLM_HAL_UBOOT) && defined(NLM_CORTINA_SUPPORT)
                 if (nae_cfg->ports[port].iftype == INTERLAKEN_IF) {
                         if ((nlm_hal_init_cs34x7(hw_port, nae_cfg->num_lanes[hw_port / XLP_ILK_MAX_LANES],
-			 nae_cfg->lane_rate[hw_port / XLP_ILK_MAX_LANES]) == 0) && 
+			 nae_cfg->lane_rate[hw_port / XLP_ILK_MAX_LANES], 0) == 0) && 
 				(is_xlp_ilk_lanealigned(node, hw_port/4)))
 				nlm_print("Interlaken lanes on port %d are aligned\n", hw_port);
 			else
diff --git a/arch/mips/netlogic/lib/syslib/include/xlp9xx_sys.h b/arch/mips/netlogic/lib/syslib/include/xlp9xx_sys.h
index 412534a..2643f72 100644
--- a/arch/mips/netlogic/lib/syslib/include/xlp9xx_sys.h
+++ b/arch/mips/netlogic/lib/syslib/include/xlp9xx_sys.h
@@ -184,8 +184,6 @@ static inline int xlp9xx_set_gbu_frequency(int node, uint64_t freq)
     int dev_freq = freq / mhz;
     uint32_t val, dev_id = XLP9XX_CLKDEV_GBU;
     uint64_t sys_base = XLP9XX_SYS_CLKDEV_BASE(node);
-
-nlm_print("\n ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^%s freq = %d\n",__FUNCTION__, freq);
 		
     switch (dev_freq) {
         case 133: sel = 0; div = 0; break;
@@ -433,7 +431,6 @@ static inline int xlp9xx_set_soc_frequency(int node, int dev_id, uint64_t freq)
 			xlp9xx_set_nae_frequency(node, freq);
 			break;
 		case XLP9XX_CLKDEV_GBU:
-nlm_print("\n ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^%s freq = %d\n",__FUNCTION__, freq);
 			xlp9xx_set_gbu_frequency(node, freq);
 			break;
                 case XLP9XX_CLKDEV_SEC:
-- 
1.7.1

