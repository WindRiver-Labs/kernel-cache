From 55306c1ff66243820a644d2a58ebfc3f53c16a62 Mon Sep 17 00:00:00 2001
From: Lakshman Garlapati <kumarga@broadcom.com>
Date: Fri, 30 Aug 2013 12:55:50 +0530
Subject: DPI: Fixed nae driver failures when using dpi dts files

[Based on SDK 3.2]
Signed-off-by: Quanyang Wang <quanyang.wang@windriver.com>
Signed-off-by: Nam Ninh <nam.ninh@windriver.com>

diff --git a/arch/mips/boot/dts/xlp9xx-linux-dpi.dts b/arch/mips/boot/dts/xlp9xx-linux-dpi.dts
index a2603a2..37eb310 100644
--- a/arch/mips/boot/dts/xlp9xx-linux-dpi.dts
+++ b/arch/mips/boot/dts/xlp9xx-linux-dpi.dts
@@ -50,7 +50,7 @@
                                 nae-fb-vc = <1>;
 				napi-vc-mask = <0xb>;
 				sae-rx-vc = <0>; /* sharing with nae */
-				sae-rx-sync-vc  = <3>; /* should be exclusive */
+				sae-rx-sync-vc  = <2>; /* should be exclusive */
 				ipsec-async-vc  = <3>;
 				ipsec-sync-vc   = <2>;
 
@@ -60,21 +60,35 @@
 				owner = <1>;
 				sharedcfg = <0x1f000000>;
 			};
-                        fmn {
-                                node_0_vc_mask = <0x00000000 0x00000000 0x00000000 0x00000000>;
-                                node_1_vc_mask = <0x00000000 0x00000000 0x00000000 0x00000000>;
-                                node_2_vc_mask = <0x00000000 0x00000000 0x00000000 0x00000000>;
-                                node_3_vc_mask = <0x00000000 0x00000000 0x00000000 0x00000000>;
-                        };
+      fmn {
+				node_0_vc_mask = <0x00000000 0x00000000 0x00000000 0x00000000 0x00000000 0x00000000 0x00000000 0x00000000 0x00000000 0x00000000>;
+				node_1_vc_mask = <0x00000000 0x00000000 0x00000000 0x00000000 0x00000000 0x00000000 0x00000000 0x00000000 0x00000000 0x00000000>;
+				node_2_vc_mask = <0x00000000 0x00000000 0x00000000 0x00000000 0x00000000 0x00000000 0x00000000 0x00000000 0x00000000 0x00000000>;
+				node_3_vc_mask = <0x00000000 0x00000000 0x00000000 0x00000000 0x00000000 0x00000000 0x00000000 0x00000000 0x00000000 0x00000000>;
+				node_4_vc_mask = <0x00000000 0x00000000 0x00000000 0x00000000 0x00000000 0x00000000 0x00000000 0x00000000 0x00000000 0x00000000>;
+				node_5_vc_mask = <0x00000000 0x00000000 0x00000000 0x00000000 0x00000000 0x00000000 0x00000000 0x00000000 0x00000000 0x00000000>;
+				node_6_vc_mask = <0x00000000 0x00000000 0x00000000 0x00000000 0x00000000 0x00000000 0x00000000 0x00000000 0x00000000 0x00000000>;
+				node_7_vc_mask = <0x00000000 0x00000000 0x00000000 0x00000000 0x00000000 0x00000000 0x00000000 0x00000000 0x00000000 0x00000000>;
+      };
 			pic {
 			};
-			nae {
+			nae-0 {
+				freein-fifo-mask = <0xffff 0 0 0>;
+				/* node offsets and size */
+				vfbtbl-sw-offset = <0 0 0 0>;
+				vfbtbl-sw-nentries = <80 32 32 80>;
+				/* hw entries */
+				vfbtbl-hw-offset = <80 32 32 80>;
+				vfbtbl-hw-nentries = <20 20 20 20>;
+				dummy-pktdata-addr = <0x0 0x0ff00000>; // 255 MB
+			};
+			nae-1 {
 				freein-fifo-mask = <0xffff 0 0 0>;
 				/* node offsets and size */
 				vfbtbl-sw-offset = <0 0 0 0>;
-				vfbtbl-sw-nentries = <32 32 32 32>;
+				vfbtbl-sw-nentries = <80 80 80 80>;
 				/* hw entries */
-				vfbtbl-hw-offset = <32 32 32 32>;
+				vfbtbl-hw-offset = <80 80 80 80>;
 				vfbtbl-hw-nentries = <20 20 20 20>;
 				dummy-pktdata-addr = <0x0 0x0ff00000>; // 255 MB
 			};
@@ -84,7 +98,98 @@
 				rsa = <0x1>;
 				fmn = <0x1>;
 			};
+			resource-allocation {
+                                net@0 {
+                                        port-mask = <0x4 0 0 0>;
+                                        frinlifo-mask = <0xffff 0 0 0>;
+                                        frinlifo-shared-mode = <0 0 0 0>;
+                                        vfbid-sw-offset = <0 0 0 0>;
+                                        vfbid-sw-entries = <0 0 0 0>;
+                                        ucore-mask = <0x1 0 0 0>;
+                                        sram-off = <0 0 0 0>;
+                                };
+				net@1 { 
+                                        port-mask = <0x4 0 0 0>;
+                                        frinlifo-mask = <0xffff 0 0 0>;
+                                        frinlifo-shared-mode = <0 0 0 0>;
+                                        vfbid-sw-offset = <0 0 0 0>;
+                                        vfbid-sw-entries = <0 0 0 0>;
+                                        ucore-mask = <0x1 0 0 0>;
+                                        sram-off = <0 0 0 0>;
+                                };
+                        };
+		};
+		dom@1 {
+			device_type = "domain";
+
+			cpu {   
+                                onlinemask = <0xffff 0x0 0x0>; 
+                                nae-rx-vc = <2>;
+			};
+
+			resource-allocation {
+				net@0 {
+					port-mask = <0x3 0 0 0>;
+					frinlifo-mask = <0xff 0 0 0>;
+					frinlifo-shared-mode = <0 0 0 0>;
+					vfbid-sw-offset = <0 0 0 0>;
+					vfbid-sw-entries = <0 0 0 0>;
+					ucore-mask = <0x2 0 0 0>;
+					sram-off = <0 0 0 0>;
+				};
+				net@1 {
+                                        port-mask = <0 0 0 0>;
+                                        frinlifo-mask = <0 0 0 0>;
+                                        frinlifo-shared-mode = <0 0 0 0>;
+                                        vfbid-sw-offset = <0 0 0 0>;
+                                        vfbid-sw-entries = <0 0 0 0>;
+                                        ucore-mask = <0 0 0 0>;
+                                        sram-off = <0 0 0 0>;
+                                };
+			};
+			app-param{
+                                onlinemask = <0xffff>;
+			};
 		};
+                dom@2 { 
+                        device_type = "domain";
+
+                        cpu {   
+                                onlinemask = <0xffff0000 0x0 0x0>;
+                                nae-rx-vc = <2>;
+                        };
+
+                        resource-allocation {
+                                net@0 { 
+                                        port-mask = <0x0 0 0 0>;
+                                        frinlifo-mask = <0x00 0 0 0>;
+                                        frinlifo-shared-mode = <0 0 0 0>;
+                                        vfbid-sw-offset = <0 0 0 0>;
+                                        vfbid-sw-entries = <0 0 0 0>;
+                                        ucore-mask = <0x0 0 0 0>;
+                                        sram-off = <0 0 0 0>;
+					max-l3rules = <0 0 0 0>;
+					max-l4rules = <0 0 0 0>;
+                                };
+                                net@1 { 
+                                        port-mask = <0x3 0 0 0>;
+                                        frinlifo-mask = <0xff 0 0 0>;
+                                        frinlifo-shared-mode = <0xff 0 0 0>;
+                                        vfbid-sw-offset = <0 0 0 0>;
+                                        vfbid-sw-entries = <0 0 0 0>;
+                                        ucore-mask = <0xc 0 0 0>;
+                                        sram-off = <0 0 0 0>;
+					max-l3rules = <1 0 0 0>;
+					max-l4rules = <2 0 0 0>;
+                                };
+                        };
+			app-param{
+                                onlinemask = <0xffff0000>;
+                        };
+
+                };
+
+
 	};
 	chosen {
 		/* examples for different core/thread models.
@@ -94,6 +199,8 @@
 		 */
 		netlogic,cpumask = <0x01>;
 		bootargs = " console=ttyS0,115200  rhash_entries=1048576";
+		/*linux,initrd-start=<0x00c00000>;
+		linux,initrd-end=<0x02c00000>;*/
 	};
 
 	/* These binaries are downloaded at the resp physical memory locations
-- 
1.7.1

