From 27e47dfaf96b0d037db55e8089504377007818a5 Mon Sep 17 00:00:00 2001
From: vmopuri <vmopuri@netlogicmicro.com>
Date: Tue, 8 Nov 2011 14:37:32 +0530
Subject: added multi-os dts for XLP3XX and XLPPCIE

[Based on SDK 3.2]
Signed-off-by: Quanyang Wang <quanyang.wang@windriver.com>
Signed-off-by: Nam Ninh <nam.ninh@windriver.com>

diff --git a/arch/mips/boot/dts/storm-multi-os.dts b/arch/mips/boot/dts/storm-multi-os.dts
index 717a804..f701d58 100644
--- a/arch/mips/boot/dts/storm-multi-os.dts
+++ b/arch/mips/boot/dts/storm-multi-os.dts
@@ -1,11 +1,11 @@
-/* XLP3XX Device Tree Source
+/* XLP8XX Device Tree Source
  *
  */
 
 /dts-v1/;
 / {
-	model = "MIPS,XLP3XX";
-	compatible = "NETL,XLP3XX_A0";
+	model = "MIPS,XLP8XX";
+	compatible = "NETL,XLP8XX_A0";
 
 	#address-cells = <1>;
 	#size-cells = <1>;
@@ -37,8 +37,7 @@
 				sharedcfg = <0x1f000000>;
 			};
 			memory {
-				reg = <0x01000000 0x0F000000	// 240M at 16M
-				       0x20000000 0x10000000>;  // 256M at 512M
+				reg = <0x01000000 0x0f000000>;	// 240M at 16M
 			};
 			pic {
 			};
@@ -48,13 +47,13 @@
 			os = "netos";
 
 			heap-size = <0x0 0x2000000>;                   // 32M
-			shared-mem = <0x0 0xe0000000 0x0 0x04000000>;  // 3584MB -> 3648 MB (64MB)
+			shared-mem = <0x0 0x62800000 0x0 0x02000000>;  // 1576MB -> 1608MB (32MB)
 
 			#address-cells = <1>;
 			#size-cells = <1>;
 
 			app-bootcmd = "ampload";
-			app-loadaddr = "0xf4000000"; // 3.75 GB + 64 MB
+			app-loadaddr = "0x82800000"; // 2088 MB
 
 			kernel {
 				/* Kernel Memory allocated from xen domain-heap */
@@ -77,7 +76,7 @@
 				sharedcfg = <0x1f000000>;
 			};
 			memory {
-				reg = <0x50000000 0x10000000>;  // 1280M -> 1536M (256M)
+				reg = <0x5E800000 0x04000000>;  // 1512M -> 1576M (64M)
 			};
 			nae {
 				owner = <0>;
@@ -88,13 +87,13 @@
 			os = "netos";
 
 			heap-size = <0x0 0x2000000>;                   // 32M
-			shared-mem = <0x0 0xe4000000 0x0 0x04000000>;  // 3648MB -> 3712 (64MB)
+			shared-mem = <0x0 0x68800000 0x0 0x02000000>;  // 1672MB -> 1704MB (32MB)
 
 			#address-cells = <1>;
 			#size-cells = <1>;
 
 			app-bootcmd = "smpload";
-			app-loadaddr = "0xf4000000"; // 3.75 GB + 64 MB
+			app-loadaddr = "0x82800000"; // 2088 MB
 
 			kernel {
 				/* Kernel Memory allocated from xen domain-heap */
@@ -108,7 +107,7 @@
 			};
 
 			cpu {
-				onlinemask = <0xf00>;
+				onlinemask = <0x0f00>;
                                 nae-rx-vc = <0>;
                                 nae-fb-vc = <1>;
 			};
@@ -117,52 +116,53 @@
 				sharedcfg = <0x1f000000>;
 			};
 			memory {
-				reg = <0x60000000 0x30000000>;  // 1536M -> 2304M (768M)
+				reg = <0x64800000 0x04000000>;  // 1608M ->1672 M (64M) 
 			};
 			nae {
 				owner = <0>;
 			};
 		};
-		dom@3 {
-			device_type = "domain";
-			os = "netos";
+	        dom@3 {
+                        device_type = "domain";
+                        os = "netos";
 
-			heap-size = <0x0 0x2000000>;                   // 32M
-			shared-mem = <0x0 0xe8000000 0x0 0x04000000>;  // 3712MB -> 3776 MB (64MB)
+                        heap-size = <0x0 0x2000000>;                   // 32M
+                        shared-mem = <0x0 0x7a800000 0x0 0x02000000>;  // 1960MB -> 1992MB (32MB)
 
-			#address-cells = <1>;
-			#size-cells = <1>;
+                        #address-cells = <1>;
+                        #size-cells = <1>;
 
-			app-bootcmd = "ampload";
-			app-loadaddr = "0xf4000000"; // 3.75 GB + 64 MB
+                        app-bootcmd = "ampload";
+                        app-loadaddr = "0x82800000"; // 2088Mb
 
-			kernel {
-				/* Kernel Memory allocated from xen domain-heap */
-				size = <0x02000000>;  // 32M
+                        kernel {
+                                /* Kernel Memory allocated from xen domain-heap */
+                                size = <0x02000000>;  // 32M
 
-				/* Location in Dom0 ramdisk */
-				location = "/tmp/xen/netos.elf";
+                                /* Location in Dom0 ramdisk */
+                                location = "/tmp/xen/netos.elf";
 
-				/* Domain destroy currently doesn't work with hyperexec */
-				dom_destroy_hack = <0>;
-			};
+                                /* Domain destroy currently doesn't work with hyperexec */
+                                dom_destroy_hack = <0>;
+                        };
 
-			cpu {
-				onlinemask = <0xf000>;
+                        cpu {
+                                onlinemask = <0xf000>;
                                 nae-rx-vc = <0>;
                                 nae-fb-vc = <1>;
-			};
-			uart {
-				id = <0>;
-				sharedcfg = <0x1f000000>;
-			};
-			memory {
-				reg = <0x90000000 0x30000000>;  // 2304M -> 3072M (768MB)
-			};
-			nae {
-				owner = <0>;
-			};
-		};
+                        };
+                        uart {
+                                id = <0>;
+                                sharedcfg = <0x1f000000>;
+                        };
+                        memory {
+                                reg = <0x6a800000 0x10000000>;  // 1704M -> 1960M (256MB)
+                        };
+                        nae {
+                                owner = <0>;
+                        };
+                };
+	
 	};
 
 	chosen {
diff --git a/arch/mips/boot/dts/xlppcie-multi-os.dts b/arch/mips/boot/dts/xlppcie-multi-os.dts
new file mode 100644
index 0000000..f701d58
--- /dev/null
+++ b/arch/mips/boot/dts/xlppcie-multi-os.dts
@@ -0,0 +1,192 @@
+/* XLP8XX Device Tree Source
+ *
+ */
+
+/dts-v1/;
+/ {
+	model = "MIPS,XLP8XX";
+	compatible = "NETL,XLP8XX_A0";
+
+	#address-cells = <1>;
+	#size-cells = <1>;
+
+	hypervisor {
+		hypervisor-name = "Xen";
+		alloc_dom0_memory = <0>;
+		bootargs = "ncores=4 dom0_loadaddr=0x72000000 dom0_size=0x1c000000 dom0_cpumask=0x0f -- ";
+		domain_heap = <0x30000000 0x20000000>; /* 0.75 GB -> 1.25 GB */
+	};
+	doms {
+		#address-cells = <1>;
+		#size-cells = <1>;
+		dom@0 {
+			device_type = "domain";
+			os = "linux";
+
+			#address-cells = <1>;
+			#size-cells = <1>;
+
+			cpu {
+				onlinemask = <0x0f>;
+                                nae-rx-vc = <0>;
+                                nae-fb-vc = <1>;
+			};
+			uart {
+				id = <0>;
+				owner = <1>;
+				sharedcfg = <0x1f000000>;
+			};
+			memory {
+				reg = <0x01000000 0x0f000000>;	// 240M at 16M
+			};
+			pic {
+			};
+		};
+		dom@1 {
+			device_type = "domain";
+			os = "netos";
+
+			heap-size = <0x0 0x2000000>;                   // 32M
+			shared-mem = <0x0 0x62800000 0x0 0x02000000>;  // 1576MB -> 1608MB (32MB)
+
+			#address-cells = <1>;
+			#size-cells = <1>;
+
+			app-bootcmd = "ampload";
+			app-loadaddr = "0x82800000"; // 2088 MB
+
+			kernel {
+				/* Kernel Memory allocated from xen domain-heap */
+				size = <0x02000000>;  // 32M
+
+				/* Location in Dom0 ramdisk */
+				location = "/tmp/xen/netos.elf";
+
+				/* Domain destroy currently doesn't work with hyperexec */
+				dom_destroy_hack = <1>;
+			};
+
+			cpu {
+				onlinemask = <0xf0>;
+                                nae-rx-vc = <0>;
+                                nae-fb-vc = <1>;
+			};
+			uart {
+				id = <0>;
+				sharedcfg = <0x1f000000>;
+			};
+			memory {
+				reg = <0x5E800000 0x04000000>;  // 1512M -> 1576M (64M)
+			};
+			nae {
+				owner = <0>;
+			};
+		};
+		dom@2 {
+			device_type = "domain";
+			os = "netos";
+
+			heap-size = <0x0 0x2000000>;                   // 32M
+			shared-mem = <0x0 0x68800000 0x0 0x02000000>;  // 1672MB -> 1704MB (32MB)
+
+			#address-cells = <1>;
+			#size-cells = <1>;
+
+			app-bootcmd = "smpload";
+			app-loadaddr = "0x82800000"; // 2088 MB
+
+			kernel {
+				/* Kernel Memory allocated from xen domain-heap */
+				size = <0x02000000>;  // 32M
+
+				/* Location in Dom0 ramdisk */
+				location = "/tmp/xen/netos.elf";
+
+				/* Domain destroy currently doesn't work with hyperexec */
+				dom_destroy_hack = <0>;
+			};
+
+			cpu {
+				onlinemask = <0x0f00>;
+                                nae-rx-vc = <0>;
+                                nae-fb-vc = <1>;
+			};
+			uart {
+				id = <0>;
+				sharedcfg = <0x1f000000>;
+			};
+			memory {
+				reg = <0x64800000 0x04000000>;  // 1608M ->1672 M (64M) 
+			};
+			nae {
+				owner = <0>;
+			};
+		};
+	        dom@3 {
+                        device_type = "domain";
+                        os = "netos";
+
+                        heap-size = <0x0 0x2000000>;                   // 32M
+                        shared-mem = <0x0 0x7a800000 0x0 0x02000000>;  // 1960MB -> 1992MB (32MB)
+
+                        #address-cells = <1>;
+                        #size-cells = <1>;
+
+                        app-bootcmd = "ampload";
+                        app-loadaddr = "0x82800000"; // 2088Mb
+
+                        kernel {
+                                /* Kernel Memory allocated from xen domain-heap */
+                                size = <0x02000000>;  // 32M
+
+                                /* Location in Dom0 ramdisk */
+                                location = "/tmp/xen/netos.elf";
+
+                                /* Domain destroy currently doesn't work with hyperexec */
+                                dom_destroy_hack = <0>;
+                        };
+
+                        cpu {
+                                onlinemask = <0xf000>;
+                                nae-rx-vc = <0>;
+                                nae-fb-vc = <1>;
+                        };
+                        uart {
+                                id = <0>;
+                                sharedcfg = <0x1f000000>;
+                        };
+                        memory {
+                                reg = <0x6a800000 0x10000000>;  // 1704M -> 1960M (256MB)
+                        };
+                        nae {
+                                owner = <0>;
+                        };
+                };
+	
+	};
+
+	chosen {
+		bootargs = " xlp_noi2c console=ttyS0,115200 ";
+	};
+
+	/* These binaries are downloaded at the resp physical memory locations
+	 * by their corresponding bootstrapping loaders. For example,
+	 * u-boot is loaded by x-load at 193M, sysconfig is loaded by u-boot
+	 * at 1M, hypervisor by u-boot hypervisor at 136M.
+	 * On simulator all these binaries are pre-loaded by using '-F' option
+	 * for convenience. On silicon, they will be loaded by their corresponding
+	 * temporary download locations the stage-1/stage-2 firmware
+	 */
+	firmware-download {
+		u-boot        = <0x0c100000 0x3f00000>;  /* 63M @ 193M */
+		sysconfig     = <0x00100000 0x00100000>; /* 1M @ 1M */
+		hypervisor    = <0x08800000 0x00800000>; /* 8M @ 136M */
+		dom0          = <0x09000000 0x03000000>; /* 48M @ 144M */
+		domU-ramdisk  = <0x60000000 0x60800000>; /* 8M @ 1536M */
+	};
+
+	soc {
+
+	};
+};
+
-- 
1.7.1

