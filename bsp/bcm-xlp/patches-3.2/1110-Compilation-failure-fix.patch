From cfc0aefddac830d9b3e4ffdca89d7e052da5e2a4 Mon Sep 17 00:00:00 2001
From: Om Narasimhan <omn@broadcom.com>
Date: Wed, 29 Feb 2012 11:05:29 -0800
Subject: Compilation failure fix

After changing the APIs and some #defines in linux (commi id : 4ea9294757fc3d11b4aa427dbe9f077368d85d2a)
these changes were required to fix a compilation failure.
[Based on SDK 3.2]
Signed-off-by: Quanyang Wang <quanyang.wang@windriver.com>
Signed-off-by: Nam Ninh <nam.ninh@windriver.com>

diff --git a/drivers/misc/netlogic/nae-perf/xlp_nae.c b/drivers/misc/netlogic/nae-perf/xlp_nae.c
index 1e5f51b..0eff5cb 100755
--- a/drivers/misc/netlogic/nae-perf/xlp_nae.c
+++ b/drivers/misc/netlogic/nae-perf/xlp_nae.c
@@ -59,7 +59,8 @@
 
 #include <asm/netlogic/hal/nlm_hal_fmn.h>
 #include <asm/netlogic/hal/nlm_hal_nae.h>
-#include <asm/netlogic/xlp_hal_pic.h>
+#include <asm/netlogic/xlp.h>
+#include <asm/netlogic/xlp_irq.h>
 
 #include "net_common.h"
 #include "xlp_nae.h"
@@ -2039,8 +2040,6 @@ static void nlm_xlp_mac_timer(unsigned long data)
 		uint32_t cpumask = cpumask_to_uint32(&cpu_present_map); /* doesn't handle non-n0 nodes */
 		uint32_t cpumask_lo;
 		uint32_t cpumask_hi;
-
-		pic_reg_t *mmio = nlm_hal_pic_offset();
 		int cpu = hard_smp_processor_id();
 
 		cpumask = cpumask & ~(1 << cpu);
@@ -2049,14 +2048,14 @@ static void nlm_xlp_mac_timer(unsigned long data)
 
 		/* Send IRQ_MSGRING vector in an IPI to all cpus but the current one */
 		if (cpumask_lo)
-			nlm_hal_write_pic_reg(mmio, PIC_IPI_CTL, (XLP_IRQ_MSGRING << 20) | cpumask_lo );
+			nlh_pic_w64r(cpu/NLM_MAX_CPU_PER_NODE, XLP_PIC_IPI_CTL, (XLP_IRQ_MSGRING_RVEC << 20) | cpumask_lo );
 
 		if (cpumask_hi)
-			nlm_hal_write_pic_reg(mmio, PIC_IPI_CTL, (XLP_IRQ_MSGRING << 20) | (1 << 16)
+			nlh_pic_w64r(cpu/NLM_MAX_CPU_PER_NODE, XLP_PIC_IPI_CTL, (XLP_IRQ_MSGRING_RVEC << 20) | (1 << 16)
 					      | (cpumask_hi));
 
 		/* Run IPI handler on this cpu too */
-		nlm_xlp_msgring_int_handler(XLP_IRQ_MSGRING, NULL);
+		nlm_xlp_msgring_int_handler(XLP_IRQ_MSGRING_RVEC, NULL);
 	}
 
         priv->link_timer.expires = jiffies + next_tick;
-- 
1.7.1

