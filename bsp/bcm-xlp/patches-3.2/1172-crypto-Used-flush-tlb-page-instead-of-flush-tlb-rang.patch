From f1579e52312bd62f053d9cffde4de22e0c559738 Mon Sep 17 00:00:00 2001
From: Hareesh R <hareeshr@broadcom.com>
Date: Fri, 9 Aug 2013 08:38:21 +0530
Subject: crypto: Used flush tlb page instead of flush tlb range 1. Disabled the sae & rsa frequency setting for xlp9xx

[Based on SDK 3.2]
Delete the function "flush_tlb_range", use kernel's "flush_tlb_range"
instead of this.

Signed-off-by: Quanyang Wang <quanyang.wang@windriver.com>
Signed-off-by: Nam Ninh <nam.ninh@windriver.com>

diff --git a/drivers/misc/netlogic/cmem/cmem.c b/drivers/misc/netlogic/cmem/cmem.c
index a6c2607..02a6f80 100644
--- a/drivers/misc/netlogic/cmem/cmem.c
+++ b/drivers/misc/netlogic/cmem/cmem.c
@@ -317,6 +317,12 @@ static int dump_pte_fn(pte_t *pte, struct page *pmd_page,
 }
 #endif
 
+/*void flush_tlb_range(struct vm_area_struct *vma, unsigned long start, unsigned long end)
+{
+	unsigned long i;
+	for(i = start; i < end; i+= PAGE_SIZE)
+		flush_tlb_page(vma, i);
+}*/
 	
 /*
  * Called from madvise, Both start and end should be 
@@ -371,7 +377,7 @@ static inline int nlm_cmem_unmap_pinfo_entry(struct file_priv_data *fpriv,
 			goto err_exit;
 		}
 
-		//flush_tlb_range(vma, start, e);
+		flush_tlb_range(vma, start, e);
 	
 		for(; start < e; start += app_pagesize, page_idx++) {
 			/* If fault handler is accessing this page and allocated a new page for this index
@@ -880,7 +886,7 @@ static int nlm_cmem_vma_fault(struct vm_area_struct *vma, struct vm_fault *vmf)
 		rv = VM_FAULT_ERROR;
 		goto err_exit;
 	}
-	//flush_tlb_range(vma, start, start + app_pagesize); 
+	flush_tlb_range(vma, start, start + app_pagesize); 
 	rv =  VM_FAULT_NOPAGE;
 err_exit:
 	spin_unlock(&vinfo->pinfo[off].lock);
-- 
1.7.1

