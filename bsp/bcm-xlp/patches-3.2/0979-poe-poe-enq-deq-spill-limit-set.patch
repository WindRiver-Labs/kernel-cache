From 4c4b69f19e278ad2111336e02b6777b761fe6e3e Mon Sep 17 00:00:00 2001
From: Shashank Shekhar <shekhars@broadcom.com>
Date: Fri, 6 Jun 2014 06:57:13 -0700
Subject: poe: poe enq deq spill limit set

[Based on SDK 3.2]
Signed-off-by: Quanyang Wang <quanyang.wang@windriver.com>
Signed-off-by: Nam Ninh <nam.ninh@windriver.com>

diff --git a/arch/mips/netlogic/lib/netlib/src/netsoc_poe.c b/arch/mips/netlogic/lib/netlib/src/netsoc_poe.c
index f790472..8a93ded 100644
--- a/arch/mips/netlogic/lib/netlib/src/netsoc_poe.c
+++ b/arch/mips/netlogic/lib/netlib/src/netsoc_poe.c
@@ -42,7 +42,7 @@
 #define NUM_DISTVEC_CPUMASKS 4
 
 #define POE_DIST_VEC0 0x100
-
+#define MAXPOESPILL  0xFFF400
 int __netsoc_alloc_poe_enq_storage(poe_t *poe)
 {       
         uint32_t addr, num_messages;
@@ -371,7 +371,10 @@ int __netsoc_init_poe_enq_deq_spill(poe_t *poe, uint64_t spill_base, uint32_t sp
 	uint64_t poe_pcie_base = poe->pcie_base;
 
 	netsoc_api_print(NETSOC_APIDBG_GLOBAL, "poe enq_deq spill base 0x%llx spillsz %d KB\n",(unsigned long long)spill_base, spill_sz/1024);
-
+	if(spill_sz > MAXPOESPILL){
+		spill_sz = MAXPOESPILL;
+		nlm_print("Warning: poe enq/deq spill exceeding its maxlimit, reshaping poe spill length to max limit  0x%x\n", MAXPOESPILL);
+	}
         spill_sz_perclass = spill_sz/ (MAX_POE_CLASSES * 2);
         enq_spill_base = spill_base;
         deq_spill_base = spill_base + spill_sz_perclass;
-- 
1.7.1

