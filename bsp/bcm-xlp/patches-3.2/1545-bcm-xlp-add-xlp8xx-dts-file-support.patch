From b7628c565c016b138c13020a3172019abe45b926 Mon Sep 17 00:00:00 2001
From: Quanyang Wang <quanyang.wang@windriver.com>
Date: Tue, 31 Mar 2015 22:13:20 +0800
Subject: bcm-xlp: add xlp8xx dts file support

The patch merge arch/mips/boot/dts/xlp-config.dts into
xlp8xx-linux-kernel.dts because we need nae alive when
booting. And xlp8xx use generic-nae.dtsi shared with xlp2xx.

Signed-off-by: Quanyang Wang <quanyang.wang@windriver.com>
Signed-off-by: Nam Ninh <nam.ninh@windriver.com>

diff --git a/arch/mips/boot/dts/xlp8xx-linux-kernel.dts b/arch/mips/boot/dts/xlp8xx-linux-kernel.dts
index 4e91261..9be7a93 100644
--- a/arch/mips/boot/dts/xlp8xx-linux-kernel.dts
+++ b/arch/mips/boot/dts/xlp8xx-linux-kernel.dts
@@ -283,6 +283,8 @@
 				};
 			};
 		};
+	/include/ "generic-fmn.dtsi"
+	/include/ "generic-nae.dtsi"
 	};
 
 	chosen {
@@ -292,4 +294,215 @@
 		netlogic,frfifo-mem = <128>;
 		netlogic,spill-mem = <32>;
 	};
+
+	doms {
+		#address-cells = <1>;
+		#size-cells = <1>;
+
+		dom@0 {
+			device_type = "domain";
+			os = "linux";
+
+			#address-cells = <1>;
+			#size-cells = <1>;
+
+			cpu {
+				/* onlinemask (if 0 then dynamically set, else takes specified value) */
+				onlinemask = <0x0>;
+				nae-rx-vc = <0>;
+				nae-fb-vc = <1>;
+				napi-vc-mask = <0xb>;
+				sae-rx-vc = <0>; /* sharing with nae */
+				sae-rx-sync-vc  = <3>; /* should be exclusive */
+				ipsec-async-vc  = <3>;
+				ipsec-sync-vc   = <2>;
+			};
+
+			nae {
+				freein-fifo-mask = <0x3ffff 0x3ffff 0 0>; /* Node-0 Node-1 Node-2 Node-3 */
+				/* node offsets and size */
+				vfbtbl-sw-offset = <0 0 0 0>;
+				vfbtbl-sw-nentries = <32 32 32 32>;
+				vfbtbl-hw-offset = <32 32 32 32>;
+				vfbtbl-hw-nentries = <20 20 20 20>;
+			};
+
+			fmn {
+                                node_0_vc_mask = <0xbbbbbbbb 0xbbbbbbbb 0xbbbbbbbb 0xbbbbbbbb>;
+                                node_1_vc_mask = <0xbbbbbbbb 0xbbbbbbbb 0xbbbbbbbb 0xbbbbbbbb>;
+                                node_2_vc_mask = <0xbbbbbbbb 0xbbbbbbbb 0xbbbbbbbb 0xbbbbbbbb>;
+                                node_3_vc_mask = <0xbbbbbbbb 0xbbbbbbbb 0xbbbbbbbb 0xbbbbbbbb>;
+			};
+
+			owner-config {
+				nae = <0x1>;
+				sae = <0x1>;
+				rsa = <0x1>;
+				fmn = <0x1>;
+			};
+		};
+
+		dom@1 {
+			device_type = "domain";
+			os = "uspace";
+
+			#address-cells = <1>;
+			#size-cells = <1>;
+
+			cpu {
+				onlinemask = <0xffff>;
+				nae-rx-vc = <2>;
+				nae-fb-vc = <2>;
+				dtre-rx-vc = <2>;
+				sae-rx-sync-vc = <2>;  /* sharing with nae */
+				sae-rx-vc = <2>; /* sharing with nae */
+				/* helinux, as only 1 thread per cpu, it should poll for both nae and sae
+				   responses. Also there is no other vc as linux is using other 2 vcs */
+			};
+
+			app-param {
+				onlinemask = <0xffffffff>;
+				enable-nae-hw-parser = <0>;
+				enable-nae-jumbo = <0>;
+				enable-nae-p2p = <0>;
+				enable-poe = <0>;
+				enable-microstruct = <0>;
+				enable-popq-mode = <0>; /* If set to 1, popq mode is enabled else disabled */
+				launch-mode = "smp";	/* smp or amp */
+				timer-service-vc = <2>;
+			};
+
+			nae {
+				freein-fifo-mask = <0xffff 0 0 0>;
+				/* node offsets and size */
+				vfbtbl-sw-offset = <0 0 0 0>;
+				vfbtbl-sw-nentries = <0 0 0 0>;
+				vfbtbl-hw-offset = <32 32 32 32>;
+				vfbtbl-hw-nentries = <20 20 20 20>;
+				/* replenish info syntax */
+				freein-fifo-replenish-by-owner = <1>;
+				/* Switched to dyanmic allocation based on frfifo-mem given in bootup fdt */
+				/* 0 - dynamic allocation else specify the address and size */
+				/* < node paddr-H32bits paddr-L32bits size-H32bits size-L32bits */
+				freein-fifo-replenish-addr-info = <0x0 0x0 0x0 0x0 0x0>;
+				/* < node fifomask descsize headroom ndescs > */
+				freein-fifo-replenish-desc-info = <0 0xffff 2048 0 64>;
+			};
+
+			owner-config {
+				nae = <0x0>;   /* currently for node */
+				sae = <0x1>;
+				rsa = <0x1>;
+				fmn = <0x1>;
+				dtr = <0x1>;
+			};
+
+			kbp {
+				/* Distribute total of 4096 buffer id across cpus.
+				 * Required only for cpus sending requests.
+				 * Note : KBP compare/search instructions must use even-numbered buffers.
+				 * i.e. (buffer_id & 0x1 == 0) is True
+				 */
+				buffers-cpuid-offset-quantity = <  0    0   64
+								   1   64   64
+								   2  128   64
+								   3  192   64
+								   4  256   64
+								   5  320   64
+								   6  384   64
+								   7  448   64
+								   8  512   64
+								   9  576   64
+								  10  640   64
+								  11  704   64
+								  12  768   64
+								  13  832   64
+								  14  896   64
+								  15  960   64
+								  16 1024   64
+								  17 1088   64
+								  18 1152   64
+								  19 1216   64
+								  20 1280   64
+								  21 1344   64
+								  22 1408   64
+								  23 1472   64
+								  24 1536   64
+								  25 1600   64
+								  26 1664   64
+								  27 1728   64
+								  28 1792   64
+								  29 1856   64
+								  30 1920   64
+								  31 1984   64>;
+				/* starting address for KBP Driver Data.
+				 * Two 32-bit unsigned integers forms one 64-bit memory address.
+				 * KBP driver requires 2 MBytes of dedicated memory space to store data.
+				 */
+				memory-offsethigh-offsetlow = <0x00000001 0x00000000>;
+			};
+		};
+
+		dom@2 {
+			device_type = "domain";
+			os = "uspace";
+
+			#address-cells = <1>;
+			#size-cells = <1>;
+
+			cpu {
+				onlinemask = <0xffff0000>;
+				nae-rx-vc = <0>;
+				nae-fb-vc = <1>;
+				/* Setting this to '1' makes NAE driver to skip buf alloction and initial
+				   sending of packet buffers*/
+				nae-buf-alloc-by-app = <1>;
+			};
+
+			app-param {
+				onlinemask = <0xffff0000>;
+			};
+
+			nae {
+				freein-fifo-mask = <0xffff 0 0 0>;
+				sh-domains = <0>;
+				/* node offsets and size */
+				vfbtbl-sw-offset = <0 0 0 0>;
+				vfbtbl-sw-nentries = <0 0 0 0>;
+				vfbtbl-hw-offset = <32 32 32 32>;
+				vfbtbl-hw-nentries = <20 20 20 20>;
+				/* replenish info syntax */
+				freein-fifo-replenish-by-owner = <1>;
+				/* Switched to dyanmic allocation based on frfifo-mem given in bootup fdt */
+				/* 0 - dynamic allocation else specify the address and size */
+				/* < node paddr-H32bits paddr-L32bits size-H32bits size-L32bits */
+				freein-fifo-replenish-addr-info = <0x0 0x0 0x0 0x0 0x0>;
+				/* < node fifomask descsize headroom ndescs > */
+				freein-fifo-replenish-desc-info = <1 0xffff 2048 0 64>;
+			};
+
+			owner-config {
+				nae = <0x0>;
+				sae = <0x0>;
+				rsa = <0x0>;
+			};
+		};
+	};
+
+	kernel-params {
+	};
+
+
+	frequency-config {
+		/*
+		 * All device frequency parameters are set 0 and get initialized to the default values when the
+		 * 'fdtconf' kernel module is loaded at runtime.
+		 * If a value other than 0 is specified, the value is not modified by the module.
+		 */
+		nae = <0>;	/* Default - 500 Mhz (400 Mhz for XLP2XX) */
+		sae = <0>;	/* Default - 500 Mhz */
+		rsa = <0>;	/* Default - 500 Mhz */
+		dtre = <0>;	/* Default - 500 Mhz */
+		cde = <0>;	/* Default - 250 Mhz */
+	};
 };
-- 
1.7.1

