From 7da30b8fd51c0bcf0b7b28e90294b1179707a3cb Mon Sep 17 00:00:00 2001
From: kopal <kopal@broadcom.com>
Date: Tue, 26 Nov 2013 10:47:54 +0530
Subject: XLP3xx_xmc: Add support for XLP3xx_XMC

[Based on SDK 3.2]
Signed-off-by: Quanyang Wang <quanyang.wang@windriver.com>
Signed-off-by: Nam Ninh <nam.ninh@windriver.com>

diff --git a/arch/mips/boot/dts/xlp3xx-xmc-linux.dts b/arch/mips/boot/dts/xlp3xx-xmc-linux.dts
index f7b7eda..8f59d8c 100644
--- a/arch/mips/boot/dts/xlp3xx-xmc-linux.dts
+++ b/arch/mips/boot/dts/xlp3xx-xmc-linux.dts
@@ -12,9 +12,10 @@
         memory {
                 device_type = "memory";
                 reg =  <0 0x00000000 0 0x0B000000
-                        0 0x20000000 0 0x28a00000>;
+                        0 0x20000000 0 0x68a00000>;
         };
 
+
 	hypervisor {
 		hypervisor-name = "Xen";
 		alloc_dom0_memory = <0>;
@@ -76,7 +77,8 @@
 	};
 
 	chosen {
-		bootargs = " console=ttyS0,115200 rhash_entries=1048576 ";
+		bootargs = " console=ttyS0,115200 rhash_entries=1048576";
+		netlogic,cpumask = <0xffff>;
 		/*linux,initrd-start=<0x00c00000>;
 		linux,initrd-end=<0x02c00000>;*/
 	};
@@ -119,5 +121,12 @@
                };
 
 	};
+	frequency-config {
+		nae = <250>;
+		sae = <500>;
+		rsa = <500>;
+		dtre = <250>;
+		cde = <250>;
+	};
 };
 
diff --git a/arch/mips/boot/dts/xlp3xx-xmc-tiny.dts b/arch/mips/boot/dts/xlp3xx-xmc-tiny.dts
index ff175f9..f568039 100644
--- a/arch/mips/boot/dts/xlp3xx-xmc-tiny.dts
+++ b/arch/mips/boot/dts/xlp3xx-xmc-tiny.dts
@@ -90,36 +90,70 @@
         	        };
 	        };
 
-	        complex@0 {
-        	        device_type = "nae-complex";
-                	mode = "sgmii";
+		/* if xaui functionality on complex@0 is required,
+		   then enable xaui and update mode = xaui/sgmii parameter, as appropriate */
+		complex@0 {
+			device_type = "nae-complex";
+			mode = "sgmii";
 			cpld = "no";
+			/*
+			xaui {
+				loopback = <0>;
 
-        	        sgmii {
-                	        loopback = <0 0 0 0>;
+				// Max ingress fifo size 256 units (size of one unit is 64 byte)
+				iface-fifo-size = <55>;
 
-                        	// Max ingress fifo size 256 units (size of one unit is 64 byte)
-	                        iface-fifo-size = <13 13 13 13>;
+				// Max parser sequence fifo size 1024 packets
+				// (if 1588 Timestamp is not required, then max size increases to 2048)
+				parser-sequence-fifo-size = <225>;
 
-        	                ext-phy-addr = <1 7 6 5>;
-                	        ext-phy-bus = <0 0 0 0>;
-                        	// Max parser sequence fifo size 1024 packets
-	                        // (if 1588 Timestamp is not required, then max size increases to 2048)
-        	                num-channels = <1 1 1 1>;
-                	        parser-sequence-fifo-size = <30 30 30 30>;
+				// Since rx_buffer is per context, the buffer size given here will be divided by num-channels
+				num-channels = <1>;
+				rx-buffer-size = <944>;
 
-                        	// Since rx_buffer is per context, we can have a few different ways
-	                        //  to populate the operand
-        	                rx-buffer-size = <128 128 128 128>;
+				// Max available descriptors are 1024  (across all complexes).
+				// Per port num_free_descriptors must be even number
+				num-free-descs = <150>;
+				free-desc-size = <2048>;
+				higig-mode = <0>;
+				xgmii-speed = <10>;
+				// In xlp3xx number of ucores available is 8. so, ucore_mask for xlp3xx is (ucore-mask & 0xFF)
+				ucore-mask = <0xffff>;
+				vlan-pri-en = <0x0>;
+				// To enable change it to  <1>
+				msec-port-enable  = <0>;
+			};
+			*/
+			sgmii {
+				loopback = <0 0 0 0>;
+				mgmt-port = <0 0 0 0>;
+				// Max ingress fifo size 256 units (size of one unit is 64 byte)
+				iface-fifo-size = <13 13 13 13>;
+
+				ext-phy-addr = <1 7 6 5>;
+				ext-phy-bus = <0 0 0 0>;
+
+				// Max parser sequence fifo size 1024 packets
+				// (if 1588 Timestamp is not required, then max size increases to 2048)
+				num-channels = <1 1 1 1>;
+				parser-sequence-fifo-size = <30 30 30 30>;
 
+				rx-buffer-size = <128 128 128 128>;
 
-                	        // Max available descriptors are 1024 (across all complexes).
-                        	// Per port num_free_descriptors must be even number
-	                        num-free-descs = <52 52 52 52>;
-        	                free-desc-size = <2048 2048 2048 2048>;
-                	        ucore-mask = <0xff 0xff 0xff 0xff>;
-	                };
-        	};
+				// Max available descriptors are 1024 (across all complexes).
+				// Per port num_free_descriptors must be even number
+				num-free-descs = <52 52 52 52>;
+				free-desc-size = <2048 2048 2048 2048>;
+				ucore-mask = <0xff 0xff 0xff 0xff>;
+			};
+		};
 	   };
 	};
+	frequency-config {
+		nae = <250>;
+		sae = <500>;
+		rsa = <500>;
+		dtre = <250>;
+		cde = <250>;
+	};
 };
-- 
1.7.1

