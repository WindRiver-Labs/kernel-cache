From 7fa805aee33544a359ba8de206717c5a24d1dedd Mon Sep 17 00:00:00 2001
From: Yonghong Song <ysong@broadcom.com>
Date: Sun, 14 Jul 2013 13:09:40 -0700
Subject: xlp9xx: kvm: add xlp9xx-helinux-guest dts file and build corresponding dtb file

[Based on SDK 3.2]
Signed-off-by: Quanyang Wang <quanyang.wang@windriver.com>
Signed-off-by: Nam Ninh <nam.ninh@windriver.com>

diff --git a/arch/mips/boot/dts/xlp9xx-helinux-guest.dts b/arch/mips/boot/dts/xlp9xx-helinux-guest.dts
new file mode 100644
index 0000000..342cb16
--- /dev/null
+++ b/arch/mips/boot/dts/xlp9xx-helinux-guest.dts
@@ -0,0 +1,82 @@
+/* XLP9XX Device Tree Source
+ *
+ */
+
+/dts-v1/;
+/ {
+	model = "netlogic,XLP-GVP";
+        compatible = "netlogic,xlp";
+        #address-cells = <2>;
+        #size-cells = <2>;
+
+        memory {
+                device_type = "memory";
+                reg =  <0 0x00100000 0 0x0FF00000       // 255M at 1M
+                        0 0x20000000 0 0x10000000>;     // 256M at 512M
+        };
+
+        /* memory range for HEv2 pkt mem. Only one contig memory per node supported */
+	/* size 0 will be ignored. */
+        pktmem {
+                device_type = "pktmem";
+
+                /* format: node number, 64-bit addr, 64-bit size */
+                reg = <0 0x0 0x30000000 0x0 0x1000000
+                       1 0x0 0x0 0x0 0x0
+                       2 0x0 0x0 0x0 0x0
+                       3 0x0 0x0 0x0 0x0>;
+        };
+
+	doms {
+		#address-cells = <1>;
+		#size-cells = <1>;
+
+		/* dom@0 is used when this dtb is actually used at root,
+		 * at guest, the device has been initialized by root so dom@0 is not used.
+		 */
+		dom@0 {
+			device_type = "domain";
+			os = "linux";
+
+			fmn {
+				node_0_vc_mask = <0x22222222 0x22222222 0x22222222 0x22222222>;
+				node_1_vc_mask = <0x22222222 0x22222222 0x22222222 0x22222222>;
+				node_2_vc_mask = <0x22222222 0x22222222 0x22222222 0x22222222>;
+				node_3_vc_mask = <0x22222222 0x22222222 0x22222222 0x22222222>;
+                        };
+			dtre {
+				dtre_init_only = <0>;
+			};
+			owner-config {
+				fmn = <0x1>;
+			};
+		};
+
+		dom@1 {
+			device_type = "domain";
+			os = "linux";
+
+			cpu {
+				dtre-rx-vc = <2>;
+			};
+			app-param {
+				onlinemask = <0x1>;
+			};
+		};
+	};
+
+	chosen {
+		netlogic,cpumask = <0x1>;
+		bootargs = " console=ttyS0,115200  rhash_entries=1048576";
+		linux,initrd-start=<0x00c00000>;
+		linux,initrd-end=<0x02c00000>;
+	};
+
+	soc {
+		nodes {
+			num-nodes = <1>;
+		};
+
+	};
+};
+
diff --git a/arch/mips/boot/dts/xlp9xx-linux-guest.dts b/arch/mips/boot/dts/xlp9xx-linux-guest.dts
index 9647b14..7cd0b45 100644
--- a/arch/mips/boot/dts/xlp9xx-linux-guest.dts
+++ b/arch/mips/boot/dts/xlp9xx-linux-guest.dts
@@ -27,25 +27,11 @@
                        3 0x0 0x0 0x0 0x0>;
         };
 
-	doms {
-		#address-cells = <1>;
-		#size-cells = <1>;
-
-		dom@1 {
-			device_type = "domain";
-			os = "linux";
-
-			cpu {
-				dtre-rx-vc = <2>;
-			};
-		};
-	};
-
 	chosen {
 		netlogic,cpumask = <0x1>;
 		bootargs = " console=ttyS0,115200  rhash_entries=1048576";
-		/*linux,initrd-start=<0x00c00000>;
-		linux,initrd-end=<0x02c00000>;*/
+		linux,initrd-start=<0x00c00000>;
+		linux,initrd-end=<0x02c00000>;
 	};
 
 	soc {
-- 
1.7.1

