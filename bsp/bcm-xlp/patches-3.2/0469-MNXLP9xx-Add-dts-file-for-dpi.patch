From 0555c6d623994526c2b2b9c0129917cdbca0834b Mon Sep 17 00:00:00 2001
From: P. Sadik <psadik@broadcom.com>
Date: Sun, 15 Dec 2013 12:46:51 +0530
Subject: MNXLP9xx: Add dts file for dpi.

[Based on SDK 3.2]
Signed-off-by: Quanyang Wang <quanyang.wang@windriver.com>
Signed-off-by: Nam Ninh <nam.ninh@windriver.com>

diff --git a/arch/mips/boot/dts/mnxlp9xx-linux-dpi.dts b/arch/mips/boot/dts/mnxlp9xx-linux-dpi.dts
new file mode 100644
index 0000000..e26c3f8
--- /dev/null
+++ b/arch/mips/boot/dts/mnxlp9xx-linux-dpi.dts
@@ -0,0 +1,272 @@
+/* XLP9XX Device Tree Source
+ *
+ */
+
+/dts-v1/;
+/ {
+	model = "netlogic,XLP-GVP";
+        compatible = "netlogic,xlp";
+        #address-cells = <2>;
+        #size-cells = <2>;
+
+	/* Memory ranges for linux. On multi-node, the range below should
+	 * include local memory of all the nodes.
+	 *
+	 * memory {
+	 *       device_type = "memory";
+	 *       reg =  <0 0x00000000 0 0x0B000000
+	 *               0 0x20000000 0 0xa0000000
+	 *               0 0xe0000000 0 0x20000000>;
+	 * };
+	 */
+		memory {
+                device_type = "memory";
+                reg =  <0 0x00000000 0 0x0B000000
+                        0 0x20000000 0 0xa0000000
+                        0 0xe0000000 0 0x20000000
+                        0x2 0x80000000 0 0x80000000>;
+        };
+
+
+        /* memory range for HEv2 pkt mem. Only one contig memory per node supported */
+        pktmem {
+                device_type = "pktmem";
+
+                /* format: node number, 64-bit addr, 64-bit size */
+                reg = <0 0x0 0xe0000000 0x0 0x20000000
+                       1 0x0 0x0 0x0 0x0
+                       2 0x0 0x0 0x0 0x0
+                       3 0x0 0x0 0x0 0x0>;
+        };
+
+	hypervisor {
+		hypervisor-name = "Xen";
+		alloc_dom0_memory = <0>;
+		bootargs = "ncores=8 dom0_loadaddr=0x72000000 dom0_size=0x1c000000 dom0_cpumask=0xffffffff -- ";
+		domain_heap = <0x80000000 0x20000000>;
+	};
+	doms {
+		#address-cells = <1>;
+		#size-cells = <1>;
+		dom@0 {
+			device_type = "domain";
+			os = "linux";
+
+			#address-cells = <1>;
+			#size-cells = <1>;
+			#nodes = <2>;
+			#cpumask-cells=<4>;
+
+			cpu {
+			onlinemask = <0x0 0x0 0xffffffff 0xffffffff>; /* */
+                                nae-rx-vc = <0>;
+                                nae-fb-vc = <1>;
+				napi-vc-mask = <0xb>;
+				sae-rx-vc = <0>; /* sharing with nae */
+				sae-rx-sync-vc  = <2>; /* should be exclusive */
+				ipsec-async-vc  = <3>;
+				ipsec-sync-vc   = <2>;
+
+			};
+			uart {
+				id = <0>;
+				owner = <1>;
+				sharedcfg = <0x1f000000>;
+			};
+                        fmn {
+				node_0_vc_mask = <0xbbbbbbbb 0xbbbbbbbb 0xbbbbbbbb 0xbbbbbbbb 0xbbbbbbbb 0xbbbbbbbb 0xbbbbbbbb 0xbbbbbbbb 0xbbbbbbbb 0xbbbbbbbb>;
+				node_1_vc_mask = <0xbbbbbbbb 0xbbbbbbbb 0xbbbbbbbb 0xbbbbbbbb 0xbbbbbbbb 0xbbbbbbbb 0xbbbbbbbb 0xbbbbbbbb 0xbbbbbbbb 0xbbbbbbbb>;
+				node_2_vc_mask = <0xbbbbbbbb 0xbbbbbbbb 0xbbbbbbbb 0xbbbbbbbb 0xbbbbbbbb 0xbbbbbbbb 0xbbbbbbbb 0xbbbbbbbb 0xbbbbbbbb 0xbbbbbbbb>;
+				node_3_vc_mask = <0xbbbbbbbb 0xbbbbbbbb 0xbbbbbbbb 0xbbbbbbbb 0xbbbbbbbb 0xbbbbbbbb 0xbbbbbbbb 0xbbbbbbbb 0xbbbbbbbb 0xbbbbbbbb>;
+				node_4_vc_mask = <0xbbbbbbbb 0xbbbbbbbb 0xbbbbbbbb 0xbbbbbbbb 0xbbbbbbbb 0xbbbbbbbb 0xbbbbbbbb 0xbbbbbbbb 0xbbbbbbbb 0xbbbbbbbb>;
+				node_5_vc_mask = <0xbbbbbbbb 0xbbbbbbbb 0xbbbbbbbb 0xbbbbbbbb 0xbbbbbbbb 0xbbbbbbbb 0xbbbbbbbb 0xbbbbbbbb 0xbbbbbbbb 0xbbbbbbbb>;
+				node_6_vc_mask = <0xbbbbbbbb 0xbbbbbbbb 0xbbbbbbbb 0xbbbbbbbb 0xbbbbbbbb 0xbbbbbbbb 0xbbbbbbbb 0xbbbbbbbb 0xbbbbbbbb 0xbbbbbbbb>;
+				node_7_vc_mask = <0xbbbbbbbb 0xbbbbbbbb 0xbbbbbbbb 0xbbbbbbbb 0xbbbbbbbb 0xbbbbbbbb 0xbbbbbbbb 0xbbbbbbbb 0xbbbbbbbb 0xbbbbbbbb>;
+                        };
+			pic {
+			};
+			ici-config{
+                enable = <1>;
+                total_credits = <673>;
+                node_0_link_mask = <0x2>;   //Bit mask of active links
+                node_1_link_mask = <0x2>;   //Bit mask of active links
+                node_2_link_mask = <0x0>;   //Bit mask of active links
+                node_3_link_mask = <0x0>;   //Bit mask of active links
+                gcu{
+                    own_credit = <75 12 75 75 75 75 75 12>; /*VC1 and VC7 always shows 0 transactions.*/
+                    shared_credit = <1 1 1 1 1 1 1 1>;
+                    txwght = <63 12 63 63 63 63 63 12>; /*Scheduling Priority, Higher Value = More Time Slot*/
+                    segth  = <34 34 34 34 34 34 34 34>; /*Maximum number of tx entries*/
+                };
+                fmn{
+                    own_credit = <75 12 12 75>; /*VC1 and VC2 always shows 0 transactions.*/
+                    shared_credit = <1 1 1 1>;
+                    txwght = <8 2 2 8 >;    /*Scheduling Priority, Higher Value = More Time Slot*/
+                    segth  = <34 34 34 34>; /*Maximum number of tx entries*/
+                };
+                pic{
+                    own_credit = <12>;
+                    shared_credit = <1>;
+                    txwght = <1>;   /*Scheduling Priority, Higher Value = More Time Slot*/
+                    segth  = <34>;  /*Maximum number of tx entries*/
+                };
+            };
+
+			nae-0 {
+				freein-fifo-mask = <0xffff 0 0 0>;
+				/* node offsets and size */
+				vfbtbl-sw-offset = <0 0 0 0>;
+				vfbtbl-sw-nentries = <80 32 32 80>;
+				/* hw entries */
+				vfbtbl-hw-offset = <80 32 32 80>;
+				vfbtbl-hw-nentries = <20 20 20 20>;
+				dummy-pktdata-addr = <0x0 0x0ff00000>; // 255 MB
+			};
+			nae-1 {
+				freein-fifo-mask = <0xffff 0 0 0>;
+				/* node offsets and size */
+				vfbtbl-sw-offset = <0 0 0 0>;
+				vfbtbl-sw-nentries = <80 80 80 80>;
+				/* hw entries */
+				vfbtbl-hw-offset = <80 80 80 80>;
+				vfbtbl-hw-nentries = <20 20 20 20>;
+				dummy-pktdata-addr = <0x0 0x0ff00000>; // 255 MB
+			};
+			owner-config {
+				nae = <0x3>;   // currently for node 0
+				sae = <0x1>;
+				rsa = <0x1>;
+				fmn = <0x3>;
+			};
+			resource-allocation {
+                                net@0 {
+                                        port-mask = <0x4 0 0 0>;
+                                        frinlifo-mask = <0xffff 0 0 0>;
+                                        frinlifo-shared-mode = <0 0 0 0>;
+                                        vfbid-sw-offset = <0 0 0 0>;
+                                        vfbid-sw-entries = <0 0 0 0>;
+                                        ucore-mask = <0x1 0 0 0>;
+                                        sram-off = <0 0 0 0>;
+                                };
+				net@1 { 
+                                        port-mask = <0x4 0 0 0>;
+                                        frinlifo-mask = <0xffff 0 0 0>;
+                                        frinlifo-shared-mode = <0 0 0 0>;
+                                        vfbid-sw-offset = <0 0 0 0>;
+                                        vfbid-sw-entries = <0 0 0 0>;
+                                        ucore-mask = <0x1 0 0 0>;
+                                        sram-off = <0 0 0 0>;
+                                };
+                        };
+		};
+		dom@1 {
+			device_type = "domain";
+
+			cpu {   
+                                onlinemask = <0xffff>; 
+                                nae-rx-vc = <2>;
+			};
+
+			resource-allocation {
+				net@0 {
+					port-mask = <0x3 0 0 0>;
+					frinlifo-mask = <0xff 0 0 0>;
+					frinlifo-shared-mode = <0 0 0 0>;
+					vfbid-sw-offset = <0 0 0 0>;
+					vfbid-sw-entries = <0 0 0 0>;
+					ucore-mask = <0x2 0 0 0>;
+					sram-off = <0 0 0 0>;
+				};
+				net@1 {
+                                        port-mask = <0 0 0 0>;
+                                        frinlifo-mask = <0 0 0 0>;
+                                        frinlifo-shared-mode = <0 0 0 0>;
+                                        vfbid-sw-offset = <0 0 0 0>;
+                                        vfbid-sw-entries = <0 0 0 0>;
+                                        ucore-mask = <0 0 0 0>;
+                                        sram-off = <0 0 0 0>;
+                                };
+			};
+			app-param{
+                                onlinemask = <0xffff>;
+			};
+		};
+                dom@2 { 
+                        device_type = "domain";
+
+                        cpu {   
+                                onlinemask = <0xffff0000 0x0 0x0>;
+                                nae-rx-vc = <2>;
+                        };
+
+                        resource-allocation {
+                                net@0 { 
+                                        port-mask = <0x0 0 0 0>;
+                                        frinlifo-mask = <0x00 0 0 0>;
+                                        frinlifo-shared-mode = <0 0 0 0>;
+                                        vfbid-sw-offset = <0 0 0 0>;
+                                        vfbid-sw-entries = <0 0 0 0>;
+                                        ucore-mask = <0x0 0 0 0>;
+                                        sram-off = <0 0 0 0>;
+					max-l3rules = <0 0 0 0>;
+					max-l4rules = <0 0 0 0>;
+                                };
+                                net@1 { 
+                                        port-mask = <0x3 0 0 0>;
+                                        frinlifo-mask = <0xff 0 0 0>;
+                                        frinlifo-shared-mode = <0xff 0 0 0>;
+                                        vfbid-sw-offset = <0 0 0 0>;
+                                        vfbid-sw-entries = <0 0 0 0>;
+                                        ucore-mask = <0xc 0 0 0>;
+                                        sram-off = <0 0 0 0>;
+					max-l3rules = <1 0 0 0>;
+					max-l4rules = <2 0 0 0>;
+                                };
+                        };
+			app-param{
+                                onlinemask = <0xffff0000>;
+                        };
+
+                };
+
+
+	};
+	chosen {
+		/* Examples for different core/thread models.
+		 * 16 core: netlogic,cpumask=<0xffffffff 0xffffffff>;
+		 * 20 core: netlogic,cpumask=<0 0xffff 0xffffffff 0xffffffff>;
+		 * 40 core: netlogic,cpumask=<0 0xffff 0xffffffff 0xffffffff
+		 *			     0 0xffff 0xffffffff 0xffffffff>;
+		 * 15 core(core 5 disabled): netlogic,cpumask=<0xffffffff 0xff0fffff>;
+		 */
+		netlogic,cpumask = <0x0 0x0 0xffffffff 0xffffffff
+		                    0x0 0x0 0xffffffff 0xffffffff>;					
+		bootargs = " console=ttyS0,115200  rhash_entries=1048576";
+		/*linux,initrd-start=<0x00c00000>;
+		linux,initrd-end=<0x02c00000>;*/
+	};
+
+	/* These binaries are downloaded at the resp physical memory locations
+	 * by their corresponding bootstrapping loaders. For example,
+	 * u-boot is loaded by x-load at 193M, sysconfig is loaded by u-boot
+	 * at 1M, hypervisor by u-boot hypervisor at 136M.
+	 * On simulator all these binaries are pre-loaded by using '-F' option
+	 * for convenience. On silicon, they will be loaded by their corresponding
+	 * temporary download locations the stage-1/stage-2 firmware
+	 */
+	firmware-download {
+		u-boot        = <0x0c100000 0x3f00000>;  /* 63M @ 193M */
+		sysconfig     = <0x00100000 0x00100000>; /* 1M @ 1M */
+		hypervisor    = <0x08800000 0x00800000>; /* 8M @ 136M */
+		dom0          = <0x09000000 0x03000000>; /* 48M @ 144M */
+		domU-ramdisk  = <0x60000000 0x60800000>; /* 8M @ 1536M */
+	};
+
+	soc {
+		nodes {
+			num-nodes = <2>;
+		};
+
+	};
+};
+
-- 
1.7.1

