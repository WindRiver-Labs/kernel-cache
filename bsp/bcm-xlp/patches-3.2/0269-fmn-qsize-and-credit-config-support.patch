From c3c68819df1fc8fd7c9e2acc82fb83d802091623 Mon Sep 17 00:00:00 2001
From: Hareesh R <hareesh@netlogicmicro.com>
Date: Tue, 22 Nov 2011 10:23:19 +0530
Subject: fmn qsize and credit config support

[Based on SDK 3.2]
Signed-off-by: Quanyang Wang <quanyang.wang@windriver.com>
Signed-off-by: Nam Ninh <nam.ninh@windriver.com>

diff --git a/arch/mips/boot/dts/linux-perf.dts b/arch/mips/boot/dts/linux-perf.dts
index 91dd8eb..013867c 100644
--- a/arch/mips/boot/dts/linux-perf.dts
+++ b/arch/mips/boot/dts/linux-perf.dts
@@ -51,6 +51,33 @@
 		};
 	};
 
+	fmn-config {
+		/* credit and queue size configuration, 
+		   A single entry message consumes 12 byte, 2 entry 20 byte etc. 
+		   so queue size of 16K can store 16 * 1024 /12 = 1365 single 
+		   entry messages 
+		   Stations which are not specified in the list will be configured
+		   with the default values given below 
+		   Names are cpu, popq, pcie, gdx, regx, rsa, crypto, srio, cmp, poe, nae 
+		*/
+
+		default-credits = <50>;
+		default-queue-size = <16384>;
+		cpu {
+			queue-size = <32768>; /* queue size for all the cpu vcs */
+			nae = <100>;	/* credits from cpu to nae */
+		};
+		poe {
+			cpu = <500>;
+		};
+	};
+
+	extra-mem-config {
+		/* used only if spill enabled */
+		freein-fifo-spill-mem-range = <0x00000000 0x0fe00000 0x00000000 0x00100000>; // 1MB @ 254MB
+		fmn-spill-mem-range = <0x00000000 0x10000000 0x00000000 0x02000000>; //32MB @ 256MB
+	};
+
 	chosen {
 		bootargs = " xlp_noi2c console=ttyS0,115200  rhash_entries=1048576";
 	};
diff --git a/arch/mips/boot/dts/perf-nae.dts b/arch/mips/boot/dts/perf-nae.dts
index 94cda41..e2e9ddc 100644
--- a/arch/mips/boot/dts/perf-nae.dts
+++ b/arch/mips/boot/dts/perf-nae.dts
@@ -44,6 +44,24 @@
 		};
 	};
 
+	
+
+	freein-fifo-config {
+		/* If shared is true, 
+			1. Ucore is going to use upto max queues(16 for XLP, 8 for storm) for buffer mgmt
+		   	2. Onnchip desc size per queue, same value will be configured for all the queues.
+		   If shared is false, 
+	 		1. Onchip desc size per queue will be configured using num_free_desc specified at the port level.
+		   If spill descs per queue is specified,  
+			1. spill will be enabled for all the queues(except mgmt) using the spill memory specified in the OS config file.
+		*/
+
+		freein-fifo-shared = <1>;
+		freein-fifo-onchip-num-descs = <56>;
+		freein-fifo-spill-num-descs = <1200>;
+	};
+
+
 	// Packet Ordering Engine (POE)
 	poe {	
 		// Supported modes are 'enque', 'serial', 'bypass'
diff --git a/arch/mips/boot/dts/storm-linux-perf.dts b/arch/mips/boot/dts/storm-linux-perf.dts
index c0c8477..dc74415 100644
--- a/arch/mips/boot/dts/storm-linux-perf.dts
+++ b/arch/mips/boot/dts/storm-linux-perf.dts
@@ -51,6 +51,34 @@
 		};
 	};
 
+	fmn-config {
+		/* credit and queue size configuration, 
+		   A single entry message consumes 12 byte, 2 entry 20 byte etc. 
+		   so queue size of 16K can store 16 * 1024 /12 = 1365 single 
+		   entry messages 
+		   Stations which are not specified in the list will be configured
+		   with the default values given below 
+		   Names are cpu, popq, pcie, gdx, regx, rsa, crypto, srio, cmp, poe, nae 
+		*/
+
+		default-credits = <50>;
+		default-queue-size = <16384>;
+		cpu {
+			queue-size = <32768>; /* queue size for all the cpu vcs */
+			nae = <100>;	/* credits from cpu to nae */
+		};
+		poe {
+			cpu = <500>;
+		};
+	};
+
+	extra-mem-config {
+		/* used only if spill enabled */
+		freein-fifo-spill-mem-range = <0x00000000 0x0fe00000 0x00000000 0x00100000>; // 1MB @ 254MB
+		fmn-spill-mem-range = <0x00000000 0x10000000 0x00000000 0x02000000>; //32MB @ 256MB
+	};
+
+
 	chosen {
 		bootargs = " xlp_noi2c console=ttyS0,115200  rhash_entries=1048576";
 	};
-- 
1.7.1

