From be8d8cbaeee1bee44a38a86b6201ad6a19958010 Mon Sep 17 00:00:00 2001
From: Kamlakant Patel <kamlakant.patel@broadcom.com>
Date: Mon, 31 Mar 2014 15:46:28 +0530
Subject: mtd: add support for multiple nand chips

xlp2xx-xmc and xlp3xx-xmc has two nand flash chips connected to
chip select 0 and 1 on nand bus.
[Based on SDK 3.2]
Signed-off-by: Quanyang Wang <quanyang.wang@windriver.com>
Signed-off-by: Nam Ninh <nam.ninh@windriver.com>

diff --git a/arch/mips/boot/dts/xlp2xx-xmc-linux-tmpl.dts b/arch/mips/boot/dts/xlp2xx-xmc-linux-tmpl.dts
index bdc875a..4c6e39c 100644
--- a/arch/mips/boot/dts/xlp2xx-xmc-linux-tmpl.dts
+++ b/arch/mips/boot/dts/xlp2xx-xmc-linux-tmpl.dts
@@ -95,41 +95,42 @@
 			reg = <0 0x2a000 0x30>;
 		};
 
-		nand_flash@0,0 {
+		nand_flash@39000 {
 			compatible = "netlogic,xlp-nand";
 			#address-cells = <1>;
-			#size-cells = <1>;
+			#size-cells = <0>;
 			reg = <0 0x39000 0x1000>;
 
 			interrupts = <43>;
 			interrupt-parent = <&pic>;
 			nand-ecc-mode = "hw";
 
-			partition@0 {
-				label = "x-loader";
-				reg = <0x0 0x80000>;
+			nand_cs0 {
+				#address-cells = <1>;
+				#size-cells = <1>;
+				reg = <0>;
+
+				partition@0 {
+					label = "firmware";
+					reg = <0x0 0xA00000>;
+					read-only;
+				};
+
+				partition@1 {
+					label = "kernel";
+					reg = <0xA00000 0x0>;
+				};
 			};
 
-			partition@1 {
-				label = "u-boot";
-				reg = <0x80000 0x100000>;
-			};
+			nand_cs1 {
+				#address-cells = <1>;
+				#size-cells = <1>;
+				reg = <1>;
 
-			partition@2 {
-				label = "u-boot env";
-				reg = <0x180000 0x020000>;
-			};
-			partition@3 {
-				label = "u-boot env copy";
-				reg = <0x1a0000 0x020000>;
-			};
-			partition@4 {
-				label = "sysconfig";
-				reg = <0x1c0000 0x040000>;
-			};
-			partition@5 {
-				label = "user";
-				reg = <0x200000 0x1fe00000>;
+				partition@0 {
+					label = "filesystem";
+					reg = <0x0 0x0>;
+				};
 			};
 		};
 
diff --git a/arch/mips/boot/dts/xlp3xx-xmc-linux-tmpl.dts b/arch/mips/boot/dts/xlp3xx-xmc-linux-tmpl.dts
index 335c26b..b1588f8 100644
--- a/arch/mips/boot/dts/xlp3xx-xmc-linux-tmpl.dts
+++ b/arch/mips/boot/dts/xlp3xx-xmc-linux-tmpl.dts
@@ -97,42 +97,43 @@
 			reg = <0 0x2a000 0x30>;
 		};
 
-		nand_flash@0,0 {
+		nand_flash@39000 {
 			compatible = "netlogic,xlp-nand";
 			#address-cells = <1>;
-			#size-cells = <1>;
+			#size-cells = <0>;
 			reg = <0 0x39000 0x1000>;
 
 			interrupts = <43>;
 			interrupt-parent = <&pic>;
 			nand-ecc-mode = "hw";
 
-			partition@0 {
-				label = "x-loader";
-				reg = <0x0 0x80000>;
+			nand_cs0 {
+				#address-cells = <1>;
+				#size-cells = <1>;
+				reg = <0>;
+
+				partition@0 {
+					label = "firmware";
+					reg = <0x0 0xA00000>;
+					read-only;
+				};
+
+				partition@1 {
+					label = "kernel";
+					reg = <0xA00000 0x0>;
+				};
 			};
 
-			partition@1 {
-				label = "u-boot";
-				reg = <0x80000 0x100000>;
+			nand_cs1 {
+				#address-cells = <1>;
+				#size-cells = <1>;
+				reg = <1>;
+
+				partition@0 {
+					label = "filesystem";
+					reg = <0x0 0x0>;
+				};
 			};
-			
-			partition@2 {
-                                label = "u-boot env";
-                                reg = <0x180000 0x020000>;
-                        };
-                        partition@3 {
-                                label = "u-boot env copy";
-                                reg = <0x1a0000 0x020000>;
-                        };
-                        partition@4 {
-                                label = "sysconfig";
-                                reg = <0x1c0000 0x040000>;
-                        };
-                        partition@5 {
-                                label = "user";
-                                reg = <0x200000 0x1fe00000>;
-                        };
 		};
 
 		gpio: xlp_gpio@34000 {
-- 
1.7.1

