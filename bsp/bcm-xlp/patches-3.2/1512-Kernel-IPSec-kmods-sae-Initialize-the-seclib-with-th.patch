From 93a2683faa3f747db3795148b0ce1d90b0ac5cb7 Mon Sep 17 00:00:00 2001
From: Manoj Vellala <manojv@broadcom.com>
Date: Sat, 7 Sep 2013 22:16:49 -0700
Subject: Kernel IPSec: kmods/sae : Initialize the seclib with the correct arch of the chip

	set cryptosoc_ptype_gen to gen2/gen1 depending on if
        the chip is 9xx/8xx.
[Based on SDK 3.2]
Signed-off-by: Quanyang Wang <quanyang.wang@windriver.com>
Signed-off-by: Nam Ninh <nam.ninh@windriver.com>

diff --git a/drivers/crypto/sae/nlm_crypto.c b/drivers/crypto/sae/nlm_crypto.c
index 95ea6b1..8f0dc2d 100644
--- a/drivers/crypto/sae/nlm_crypto.c
+++ b/drivers/crypto/sae/nlm_crypto.c
@@ -423,6 +423,10 @@ xlp_sae_init(void)
 
     printk(KERN_ERR ",\n XLP SAE/Crypto Initialization \n");
     printk("ipsec_sync_vc %d ipsec_async_vc %d\n",ipsec_sync_vc,ipsec_async_vc);
+    if (is_nlm_xlp9xx())
+        cryptosoc_ptype_gen = CRYPTOSOC_PTYPE_IS_GEN2;
+    else
+        cryptosoc_ptype_gen = CRYPTOSOC_PTYPE_IS_GEN1;
 
     xlp_sae_major = register_chrdev(0, "NLM_XLP_SAE", &xlp_sae_fops);
     if (xlp_sae_major < 0) {
-- 
1.7.1

