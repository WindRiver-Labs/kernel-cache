From c17bdba79d0d5622c66818b50d490fba26725a3e Mon Sep 17 00:00:00 2001
From: Bin Jiang <bin.jiang@windriver.com>
Date: Sat, 15 Nov 2014 03:19:01 +0000
Subject: MIPS: get_user: fix compile problem

According to the description of get_user function, the variable @x is
set to zero on error.
But the variable @x is not set on error and cause following warning:

fs/compat_ioctl.c: In function 'compat_sys_ioctl':
arch/mips/include/asm/uaccess.h:367:2: warning: 'length' may be used
			uninitialized in this function [-Wmaybe-uninitialized]
  __asm__ __volatile__( \
  ^
fs/compat_ioctl.c:208:6: note: 'length' was declared here
  int length, err;
      ^

Signed-off-by: Bin Jiang <bin.jiang@windriver.com>
Signed-off-by: Quanyang Wang <quanyang.wang@windriver.com>
Signed-off-by: Nam Ninh <nam.ninh@windriver.com>

diff --git a/arch/mips/include/asm/uaccess.h b/arch/mips/include/asm/uaccess.h
index f3fa375..8e10aa3 100644
--- a/arch/mips/include/asm/uaccess.h
+++ b/arch/mips/include/asm/uaccess.h
@@ -259,7 +259,8 @@ do {									\
 	might_fault();							\
 	if (likely(access_ok(VERIFY_READ,  __gu_ptr, size)))		\
 		__get_user_common((x), size, __gu_ptr);			\
-									\
+	else								\
+		(x) = (__typeof__(*(ptr)))0;				\
 	__gu_err;							\
 })
 
-- 
1.7.1

