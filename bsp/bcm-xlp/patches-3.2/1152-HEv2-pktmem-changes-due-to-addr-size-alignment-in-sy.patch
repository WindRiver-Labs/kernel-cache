From 5cdf3936361ecedad38b215018e925a109306fcf Mon Sep 17 00:00:00 2001
From: Sreenidhi B R <sreenira@broadcom.com>
Date: Fri, 21 Jun 2013 15:28:20 +0530
Subject: HEv2: pktmem - changes due to addr,size alignment in sysconfig.

[Based on SDK 3.2]
Signed-off-by: Quanyang Wang <quanyang.wang@windriver.com>
Signed-off-by: Nam Ninh <nam.ninh@windriver.com>

diff --git a/drivers/misc/netlogic/pkt_pool_mem/pkt_pool_mem.c b/drivers/misc/netlogic/pkt_pool_mem/pkt_pool_mem.c
index a64d11d..4440d1a 100644
--- a/drivers/misc/netlogic/pkt_pool_mem/pkt_pool_mem.c
+++ b/drivers/misc/netlogic/pkt_pool_mem/pkt_pool_mem.c
@@ -21,7 +21,7 @@ typedef struct memory_pool
 } memory_pool_t;
 
 memory_pool_t mem_pool_data[MAX_NODES];
-uint32_t pktregs[MAX_NODES * 4];
+uint32_t pktregs[MAX_NODES * 5];
 
 typedef struct brcm_devmem_ioctl {
 	unsigned int node_id;
@@ -249,20 +249,20 @@ static int __init brcm_xlp_ppm_init (void)
 		return i;
 	}
 
-	for (i=0; i<MAX_NODES*4; i++) pktregs[i] = 0;
+	for (i=0; i<MAX_NODES*5; i++) pktregs[i] = 0;
 
 	/* read from FDT and fill the array */
 	fdt = initial_boot_params;
 	if (get_fdt_prop(fdt, "/pktmem", "reg", pktregs, 1) == 0)
 	{
-		for (i=0; i<MAX_NODES*4; i=i+4)
+		for (i=0; i<MAX_NODES*5; i=i+5)
 		{
-			node = i/4;
+			node = i/5;
 			mem_pool_data[node].next = NULL;
 			memset(mem_pool_data[node].shr_id, '\0', 64);
 			mem_pool_data[node].in_use = 0;
-			mem_pool_data[node].start = pktregs[i+1];
-			mem_pool_data[node].size = pktregs[i+3];
+			mem_pool_data[node].start = ((pktregs[i+1]<<32) | (pktregs[i+2]));
+			mem_pool_data[node].size = ((pktregs[i+3]<<32) | (pktregs[i+4]));
 		}
 	}
 	else
-- 
1.7.1

