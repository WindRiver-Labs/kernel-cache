From 35d3d23b33156f3c36973a154ea9b82774ace54b Mon Sep 17 00:00:00 2001
From: Saswat Kumar Dash <saswat.dash@broadcom.com>
Date: Wed, 17 Dec 2014 02:05:17 -0800
Subject: fmn spill: handled error condition

[Based on SDK 3.2]
Signed-off-by: Quanyang Wang <quanyang.wang@windriver.com>
Signed-off-by: Nam Ninh <nam.ninh@windriver.com>

diff --git a/arch/mips/netlogic/lib/fmnlib/nlm_hal_fmn_config.c b/arch/mips/netlogic/lib/fmnlib/nlm_hal_fmn_config.c
index 29446dd..a4be5aa 100644
--- a/arch/mips/netlogic/lib/fmnlib/nlm_hal_fmn_config.c
+++ b/arch/mips/netlogic/lib/fmnlib/nlm_hal_fmn_config.c
@@ -68,6 +68,8 @@
 #define XLP5XX_MAX_OUT_Q_BASE	16
 #define XLP9XX_MAX_OUT_Q_BASE	32
 
+#define MAGIC_NUM	0xffffffff
+
 nlm_fmn_config_t xlp3xx_fmn_config[] = {
 [XLP_MSG_HANDLE_CPU0] = {XLP_STNID_CPU0, XLP_CPU0_VC_LIMIT},
 [XLP_MSG_HANDLE_CPU1] = {XLP_STNID_CPU1, XLP_CPU1_VC_LIMIT},
@@ -1731,6 +1733,10 @@ int parse_fdt_fmn_config(void *fdt)
 
 #ifdef NLM_HAL_LINUX_KERNEL
 		if (nlm_node_cfg.fmn_cfg[node]->fmn_spill_size == 0ULL) {
+			if (spill_mem_size == MAGIC_NUM) {
+				nlm_print("netlogic,spill-mem not found!\nAborting!\n");
+				return -1;
+			}
 			nlm_node_cfg.fmn_cfg[node]->fmn_spill_size = spill_mem_size;
 			spill_base = spill_mem_address[node];
 		}
-- 
1.7.1

