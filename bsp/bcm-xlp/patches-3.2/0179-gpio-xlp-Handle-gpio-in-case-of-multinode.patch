From 0d475d10fca2080603d9ff6cc3fe314465adfaba Mon Sep 17 00:00:00 2001
From: Kamlakant Patel <kamlakant.patel@broadcom.com>
Date: Mon, 15 Dec 2014 16:37:01 +0530
Subject: gpio: xlp: Handle gpio in case of multinode

We shift gpio base by 128 for each node.
[Based on SDK 3.2]
Signed-off-by: Quanyang Wang <quanyang.wang@windriver.com>
Signed-off-by: Nam Ninh <nam.ninh@windriver.com>

diff --git a/drivers/gpio/gpio-xlp.c b/drivers/gpio/gpio-xlp.c
index fcbcb7f..4c89aea 100644
--- a/drivers/gpio/gpio-xlp.c
+++ b/drivers/gpio/gpio-xlp.c
@@ -48,6 +48,7 @@
 
 #define	SYS_EFUSE_DEVICE_CFG_STATUS0	0x8
 #define	NR_IRQS_PER_NODE		1024
+#define	NR_GPIOS_PER_NODE		128
 #define NLM_GPIO_VEC_BASE		768
 
 #define GPIO_OUTPUT_EN		0x00
@@ -325,7 +326,7 @@ static int xlp_gpio_probe(struct platform_device *pdev)
 			return ret;
 		}
 
-		priv->bgc[i].gc.base = i * 32;
+		priv->bgc[i].gc.base =  node * NR_GPIOS_PER_NODE + i * 32;
 		priv->bgc[i].gc.label = "gpio-xlp";
 		priv->bgc[i].gc.ngpio = ((i + 1) < idx) ? 32 :
 						priv->ngpio - (i * 32);
-- 
1.7.1

