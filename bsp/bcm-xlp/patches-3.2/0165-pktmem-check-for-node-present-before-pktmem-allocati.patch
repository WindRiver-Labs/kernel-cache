From ccc943bc9d991eda1f88aa3fdf0d47ca0aa5e014 Mon Sep 17 00:00:00 2001
From: Jayachandran C <jchandra@broadcom.com>
Date: Sun, 7 Dec 2014 17:28:28 +0530
Subject: pktmem: check for node present before pktmem allocation

Allocate pktmem only if node is present
[Based on SDK 3.2]
Signed-off-by: Quanyang Wang <quanyang.wang@windriver.com>
Signed-off-by: Nam Ninh <nam.ninh@windriver.com>

diff --git a/arch/mips/netlogic/xlp/dt.c b/arch/mips/netlogic/xlp/dt.c
index 8464250..57d05cb 100644
--- a/arch/mips/netlogic/xlp/dt.c
+++ b/arch/mips/netlogic/xlp/dt.c
@@ -122,6 +122,8 @@ static int __init xlp_reserve_memory(unsigned long node, const char *uname,
 	val = be32_to_cpup(p);
 	pktmem_size = val * 1024 * 1024;
 	for (i = 0; i < NLM_NR_NODES; i++) {
+		if (!nlm_node_present(i))
+			continue;
 		addr = alloc_bootmem_node(NODE_DATA(i), pktmem_size);
 		if (addr == NULL) {
 			pr_err("Alloc bootmem failed for %ld MB on node %d\n",
-- 
1.7.1

