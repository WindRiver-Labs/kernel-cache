From d6184b55d7f5ff2e437e30d537c932bc486c535c Mon Sep 17 00:00:00 2001
From: Jayachandran C <jchandra@broadcom.com>
Date: Wed, 10 Dec 2014 13:10:28 +0530
Subject: xlp: Add processor id to system type

Useful for finding the chip type without looking at the boot log.
[Based on SDK 3.2]
Signed-off-by: Quanyang Wang <quanyang.wang@windriver.com>
Signed-off-by: Nam Ninh <nam.ninh@windriver.com>

diff --git a/arch/mips/netlogic/xlp/setup.c b/arch/mips/netlogic/xlp/setup.c
index 856310e..309c88e 100644
--- a/arch/mips/netlogic/xlp/setup.c
+++ b/arch/mips/netlogic/xlp/setup.c
@@ -128,16 +128,29 @@ void __init plat_mem_setup(void)
 	xlp_numa_init();
 }
 
-const char *get_system_type(void)
+static char nlm_system_type[64];
+static void __init set_system_type(void)
 {
+	const char *pname;
+	u32 prid = read_c0_prid();
+
 	switch (read_c0_prid() & PRID_IMP_MASK) {
 	case PRID_IMP_NETLOGIC_XLP9XX:
 	case PRID_IMP_NETLOGIC_XLP5XX:
 	case PRID_IMP_NETLOGIC_XLP2XX:
-		return "Broadcom XLPII Series";
+		pname = "Broadcom XLPII Series";
+		break;
 	default:
-		return "Netlogic XLP Series";
+		pname = "Netlogic XLP Series";
+		break;
 	}
+	snprintf(nlm_system_type, sizeof(nlm_system_type),
+		"%s [Id %x Rev %x]", pname, (prid >> 8) & 0xff, prid & 0xff);
+}
+
+const char *get_system_type(void)
+{
+	return nlm_system_type;
 }
 
 void __init prom_free_prom_memory(void)
@@ -192,4 +205,5 @@ void __init prom_init(void)
 	memcpy(reset_vec, (void *)nlm_reset_entry,
 			(nlm_reset_entry_end - nlm_reset_entry));
 
+	set_system_type();
 }
-- 
1.7.1

