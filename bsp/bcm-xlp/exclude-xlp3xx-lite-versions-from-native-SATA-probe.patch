From d1aceeb9b3c69b85e8930a68fd83988bb77e2c78 Mon Sep 17 00:00:00 2001
From: Sreenidhi BR <sreenidhibr@netlogicmicro.com>
Date: Tue, 7 Feb 2012 16:31:52 +0530
Subject: [PATCH 538/761] exclude xlp3xx lite versions from native SATA probe.

Based on Broadcom SDK 2.3.

Signed-off-by: Sreenidhi BR <sreenidhibr@netlogicmicro.com>
Signed-off-by: Yanjiang Jin <yanjiang.jin@windriver.com>
---
 drivers/ata/xlp-ahci.c |   15 +++++++++++----
 1 file changed, 11 insertions(+), 4 deletions(-)

diff --git a/drivers/ata/xlp-ahci.c b/drivers/ata/xlp-ahci.c
index 8544313..587ea7d 100644
--- a/drivers/ata/xlp-ahci.c
+++ b/drivers/ata/xlp-ahci.c
@@ -2120,7 +2120,7 @@ static void ahci_port_intr(struct ata_port *ap)
 extern void nlm_hal_sata_init(void);
 extern void nlm_hal_sata_intr_setup(void);
 extern void nlm_hal_sata_intr_ack(void);
-extern int is_nlm_xlp3xx(void);
+extern int is_nlm_xlp3xx_lite(void);
 static int nlm_sata_init_done = 0;
 #endif
 
@@ -2899,10 +2899,17 @@ static int ahci_init_one(struct pci_dev *pdev, const struct pci_device_id *ent)
 
 	VPRINTK("ENTER\n");
 
-	if ((is_nlm_xlp3xx()) && !nlm_sata_init_done)
+	if (!is_nlm_xlp3xx_lite())
 	{
-		nlm_hal_sata_init();
-		nlm_sata_init_done = 1;
+		if (!nlm_sata_init_done)
+		{
+			nlm_hal_sata_init();
+			nlm_sata_init_done = 1;
+		}
+	}
+	else
+	{
+		return -1;
 	}
 
 	WARN_ON(ATA_MAX_QUEUE > AHCI_MAX_CMDS);
-- 
1.7.10.4

