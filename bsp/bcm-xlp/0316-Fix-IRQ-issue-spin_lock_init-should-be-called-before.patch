From 7bbe69bd65971dc1ac45a31a1b7de8457d02540e Mon Sep 17 00:00:00 2001
From: Vikas Gupta <vikasg@netlogicmicro.com>
Date: Tue, 30 Aug 2011 16:17:19 +0530
Subject: [PATCH 316/762] Fix IRQ issue: spin_lock_init should be called before request_irq.

Based on Broadcom SDK 2.3.

Signed-off-by: Vikas Gupta <vikasg@netlogicmicro.com>
Signed-off-by: Yanjiang Jin <yanjiang.jin@windriver.com>
---
 drivers/mmc/host/xlpmmc.c |    2 +-
 1 files changed, 1 insertions(+), 1 deletions(-)

diff --git a/drivers/mmc/host/xlpmmc.c b/drivers/mmc/host/xlpmmc.c
index 94d04a8..b0d2254 100644
--- a/drivers/mmc/host/xlpmmc.c
+++ b/drivers/mmc/host/xlpmmc.c
@@ -694,6 +694,7 @@ static int __devinit xlpmmc_probe(struct platform_device *pdev)
 	host->mmc = mmc;
 	host->platdata = pdev->dev.platform_data;
 	host->pdev = pdev;
+	spin_lock_init(&host->irq_lock);
 
 	ret = -ENODEV;
 	r = platform_get_resource(pdev, IORESOURCE_MEM, 0);
@@ -733,7 +734,6 @@ static int __devinit xlpmmc_probe(struct platform_device *pdev)
 
 	mmc->f_min =     260000; /* From bootloader */
 	mmc->f_max =   16667000;  
-	spin_lock_init(&host->irq_lock);
 
 	mmc->max_blk_size = 512;
 	mmc->max_blk_count = 2048;
-- 
1.7.0.4

