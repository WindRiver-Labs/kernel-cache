From 2983e612617258883269cedb6f2503a46edf7d37 Mon Sep 17 00:00:00 2001
From: "P. Sadik" <psadik@broadcom.com>
Date: Sat, 24 Nov 2012 00:17:26 +0530
Subject: [PATCH 632/761] Fix: Resolve compilation error when initrd is
 disabled.

Based on Broadcom SDK 2.3.

Signed-off-by: P. Sadik <psadik@broadcom.com>
Signed-off-by: Yanjiang Jin <yanjiang.jin@windriver.com>
---
 arch/mips/netlogic/xlp/setup.c |   10 ++++++++--
 1 file changed, 8 insertions(+), 2 deletions(-)

diff --git a/arch/mips/netlogic/xlp/setup.c b/arch/mips/netlogic/xlp/setup.c
index b284411..a130f6b 100644
--- a/arch/mips/netlogic/xlp/setup.c
+++ b/arch/mips/netlogic/xlp/setup.c
@@ -1138,6 +1138,7 @@ static int __init nlm_proc_setup(void)
 }
 rootfs_initcall(nlm_proc_setup);
 
+#ifdef CONFIG_BLK_DEV_INITRD
 extern unsigned long initrd_start, initrd_end;
 
 static int __init initrd_setup(char *str)
@@ -1178,12 +1179,13 @@ static int __init initrd_setup(char *str)
 	*(tmp-1) = '@';
 	initrd_start = simple_strtoul(tmp, &endptr, 16);
 
+
 #if defined(CONFIG_32BIT) && defined (CONFIG_MAPPED_KERNEL)
 	initrd_start = CKSEG2ADDR(initrd_start);
 #else
 	initrd_start = CKSEG1ADDR(initrd_start);
 #endif
-	
+
 	if (*endptr) {
 		goto fail;
 	}
@@ -1196,7 +1198,7 @@ static int __init initrd_setup(char *str)
 	initrd_end = 0;
 	return 1;
 }
-
+#endif
 
 /*
  * Init routine which accepts the variables from u-boot
@@ -1211,7 +1213,11 @@ void parse_cmdline(void)
 			ptr++;
 		}
 		if (!strncmp(ptr, "initrd=", 7)) {
+#ifdef CONFIG_BLK_DEV_INITRD
 			initrd_setup(ptr+7);
+#else
+			printk("initrd is disabled in Kernel\n");
+#endif
 			break;
 		} else {
 			while (*ptr && (*ptr != ' ')) {
-- 
1.7.10.4

