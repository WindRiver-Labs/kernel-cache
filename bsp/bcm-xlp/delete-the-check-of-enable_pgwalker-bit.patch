From b2d8497f698bcda3d9fa345cf3d4182b49f8dcf0 Mon Sep 17 00:00:00 2001
From: Prasad Boddupalli <pboddupalli@netlogicmicro.com>
Date: Wed, 22 Jun 2011 15:28:15 -0700
Subject: [PATCH 294/761] delete the check of enable_pgwalker bit

the pgd base corresponding user processes' page table is populated
with page walker turned off. Due to the above reason, current code
does not populate the pgd base correctly, leading to spurious page
faults. the patch deletes the check as populating the pgd base is
benign when page walker is not used

Based on Broadcom SDK 2.3.

Signed-off-by: Prasad Boddupalli <pboddupalli@netlogicmicro.com>
Signed-off-by: Yanjiang Jin <yanjiang.jin@windriver.com>
---
 arch/mips/include/asm/mach-netlogic/xlp-mmu.h |    6 ++----
 1 file changed, 2 insertions(+), 4 deletions(-)

diff --git a/arch/mips/include/asm/mach-netlogic/xlp-mmu.h b/arch/mips/include/asm/mach-netlogic/xlp-mmu.h
index 28ca984..f52ca2e 100644
--- a/arch/mips/include/asm/mach-netlogic/xlp-mmu.h
+++ b/arch/mips/include/asm/mach-netlogic/xlp-mmu.h
@@ -27,10 +27,8 @@ extern DEFINE_PER_CPU(unsigned long [NR_ADDR_SEGMENTS], pgd_bases);
 
 static inline void setup_user_pgd(pgd_t *pgd)
 {
-	if (read_c0_config6() & ENABLE_PGWALKER) {
-		get_cpu_var(pgd_bases)[USER_SEG] = (unsigned long) pgd;
-		put_cpu_var(pgd_bases);
-	}
+	get_cpu_var(pgd_bases)[USER_SEG] = (unsigned long) pgd;
+	put_cpu_var(pgd_bases);
 };
 
 static __inline__ void pipeline_flush(void)
-- 
1.7.10.4

