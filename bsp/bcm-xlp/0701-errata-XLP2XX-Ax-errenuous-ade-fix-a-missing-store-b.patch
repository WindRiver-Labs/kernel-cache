From b7ed22dbcd661feb7b79bb44fe00d470965a0bb0 Mon Sep 17 00:00:00 2001
From: Yonghong Song <ysong@broadcom.com>
Date: Fri, 8 Feb 2013 09:05:00 -0800
Subject: [PATCH 701/762] errata: XLP2XX Ax errenuous ade: fix a missing store badvaddr register to stack

Based on Broadcom SDK 2.3.

Signed-off-by: Yonghong Song <ysong@broadcom.com>
Signed-off-by: Yanjiang Jin <yanjiang.jin@windriver.com>
---
 arch/mips/include/asm/stackframe.h |    2 ++
 1 files changed, 2 insertions(+), 0 deletions(-)

diff --git a/arch/mips/include/asm/stackframe.h b/arch/mips/include/asm/stackframe.h
index 2a2be4b..dc5ffde 100644
--- a/arch/mips/include/asm/stackframe.h
+++ b/arch/mips/include/asm/stackframe.h
@@ -253,6 +253,8 @@
 		andi    v0, v0, 0x1f
 		xori    v0, v0, 0x4
 		bnez    v0, 10f
+		mfc0	v0, CP0_BADVADDR
+		LONG_S	v0, PT_BVADDR(sp)
 		move    a0, sp
 		jal     xlp_check_ade_errata
 		10:
-- 
1.7.0.4

