From 789d8802133b62270406af7771c65d526716f41b Mon Sep 17 00:00:00 2001
From: P. Sadik <psadik@netlogicmicro.com>
Date: Wed, 30 Mar 2011 11:57:52 -0700
Subject: [PATCH 247/762] Fix per cpu interrupt count.

With XLP kernel, per cpu timer interrupt count was 2 times more than what it should be.
If HZ is 1000, interrupts per second in 2000. This issue is fixed.

Based on Broadcom SDK 2.3.

Signed-off-by: P. Sadik <psadik@netlogicmicro.com>
Signed-off-by: Yanjiang Jin <yanjiang.jin@windriver.com>
---
 arch/mips/netlogic/xlp/irq.c |    4 +++-
 1 files changed, 3 insertions(+), 1 deletions(-)

diff --git a/arch/mips/netlogic/xlp/irq.c b/arch/mips/netlogic/xlp/irq.c
index 11c689e..b529955 100644
--- a/arch/mips/netlogic/xlp/irq.c
+++ b/arch/mips/netlogic/xlp/irq.c
@@ -468,8 +468,10 @@ asmlinkage void plat_irq_dispatch(void)
 
 	eirr = read_64bit_cp0_eirr() & read_64bit_cp0_eimr();
 
-	if (eirr & (1 << IRQ_TIMER))
+	if (eirr & (1 << IRQ_TIMER)) {
 		nlm_common_timer_interrupt(pt_regs, IRQ_TIMER);
+		return;
+	}
 
 	i = __ilog2_u64(eirr);
 	if (i == -1)
-- 
1.7.0.4

