From ea6fc6d7f9130fc91eabeeb58a31369a457e6c7e Mon Sep 17 00:00:00 2001
From: Jayanthi A <jayanthi.annadurai@broadcom.com>
Date: Thu, 19 Jul 2012 12:40:47 +0530
Subject: [PATCH 548/761] XLP base port: Enable backup timer only for
 xlp8xx-Ax

Based on Broadcom SDK 2.3.

Signed-off-by: Jayanthi A <jayanthi.annadurai@broadcom.com>
Signed-off-by: Yanjiang Jin <yanjiang.jin@windriver.com>
---
 arch/mips/netlogic/xlp/on_chip.c |   14 ++++++++------
 1 file changed, 8 insertions(+), 6 deletions(-)

diff --git a/arch/mips/netlogic/xlp/on_chip.c b/arch/mips/netlogic/xlp/on_chip.c
index 5e52ca1..a681a60 100644
--- a/arch/mips/netlogic/xlp/on_chip.c
+++ b/arch/mips/netlogic/xlp/on_chip.c
@@ -465,12 +465,14 @@ int register_xlp_msgring_handler(int major,
 	if(!xlp_fmn_init_done)
 		xlp_fmn_init_done = 1;
 
-	if(msg_handler_timer_enabled == 0) {
-		msg_handler_timer_enabled = 1;
-		spin_unlock_irqrestore(&msgrng_lock, flags);
-		// init_msg_bkp_timer(0);	Not required, taken care by on_each_cpu()
-		on_each_cpu(init_msg_bkp_timer, 0, 1);
-		spin_lock_irqsave(&msgrng_lock, flags);
+	if (is_nlm_xlp8xx_ax()) {
+		if(msg_handler_timer_enabled == 0) {
+			msg_handler_timer_enabled = 1;
+			spin_unlock_irqrestore(&msgrng_lock, flags);
+			// init_msg_bkp_timer(0);	Not required, taken care by on_each_cpu()
+			on_each_cpu(init_msg_bkp_timer, 0, 1);
+			spin_lock_irqsave(&msgrng_lock, flags);
+		}
 	}
 
 	msg_handler_map[major].action = action;
-- 
1.7.10.4

