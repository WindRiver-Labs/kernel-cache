From a2d719fe33e74aabe8985708b0669c617c519f2c Mon Sep 17 00:00:00 2001
From: Yanjiang Jin <yanjiang.jin@windriver.com>
Date: Tue, 23 Apr 2013 16:12:14 +0800
Subject: [PATCH 699/761] bcm_xlp: clean some NAE obsolete code

Clean some NAE obsolete code to suit kernel 3.4.

Based on Broadcom SDK 2.3.

Signed-off-by: Yanjiang Jin <yanjiang.jin@windriver.com>
---
 drivers/net/nae/xlpge_nae.c |    1 -
 drivers/net/nae/xlpge_tso.c |    9 ++-------
 2 files changed, 2 insertions(+), 8 deletions(-)

diff --git a/drivers/net/nae/xlpge_nae.c b/drivers/net/nae/xlpge_nae.c
index dc0f9b3..16e2a24 100644
--- a/drivers/net/nae/xlpge_nae.c
+++ b/drivers/net/nae/xlpge_nae.c
@@ -1315,7 +1315,6 @@ static const struct net_device_ops nlm_xlp_nae_ops = {
 	.ndo_open			= nlm_xlp_nae_open,
 	.ndo_stop			= nlm_xlp_nae_stop,
 	.ndo_start_xmit			= nlm_xlp_nae_start_xmit,
-	.ndo_set_multicast_list		= nlm_xlp_set_multicast_list,
 	.ndo_do_ioctl			= nlm_xlp_nae_ioctl,
 	.ndo_tx_timeout 		= nlm_xlp_nae_tx_timeout,
 	.ndo_change_mtu			= nlm_xlp_nae_change_mtu,
diff --git a/drivers/net/nae/xlpge_tso.c b/drivers/net/nae/xlpge_tso.c
index 53ef6b5..3f8e33c 100644
--- a/drivers/net/nae/xlpge_tso.c
+++ b/drivers/net/nae/xlpge_tso.c
@@ -229,7 +229,7 @@ inline int tso_xmit_skb(struct sk_buff *skb, struct net_device *dev)
 	for (i = 0; i < sp->nr_frags; i++)  {
 		skb_frag_t *fp = &sp->frags[i];
 		idx = create_p2p_desc(virt_to_bus(((char *)
-				page_address(fp->page)) + fp->page_offset),
+				page_address((fp->page).p)) + fp->page_offset),
 				fp->size, p2pdesc, idx);
 	}
 
@@ -285,12 +285,7 @@ out_unlock:
 
 int tso_enable(struct net_device *dev, u32 data)
 {
-	int rv;
-	rv = ethtool_op_set_tso(dev, data);
-	if(rv == 0)
-		rv = ethtool_op_set_tx_csum(dev, data);
-	if(rv == 0)
-		rv = ethtool_op_set_sg(dev, data);
+	int rv = 0;
 	dev->features |= NETIF_F_FRAGLIST | NETIF_F_HIGHDMA;
 	return rv;
 }
-- 
1.7.10.4

