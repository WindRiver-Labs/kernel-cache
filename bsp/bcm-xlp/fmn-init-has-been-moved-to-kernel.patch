From 963c626518b9cd1e0953bf303e87e957007320c2 Mon Sep 17 00:00:00 2001
From: Hareesh R <hareesh@netlogicmicro.com>
Date: Tue, 22 Nov 2011 09:59:13 +0530
Subject: [PATCH 483/761] fmn init has been moved to kernel

Based on Broadcom SDK 2.3.

Signed-off-by: Hareesh R <hareesh@netlogicmicro.com>
Signed-off-by: Yanjiang Jin <yanjiang.jin@windriver.com>
---
 arch/mips/netlogic/xlp/smp.c |    4 ++++
 drivers/dma/nlm_adma.c       |    3 ---
 2 files changed, 4 insertions(+), 3 deletions(-)

diff --git a/arch/mips/netlogic/xlp/smp.c b/arch/mips/netlogic/xlp/smp.c
index a85fc71..e43336c 100644
--- a/arch/mips/netlogic/xlp/smp.c
+++ b/arch/mips/netlogic/xlp/smp.c
@@ -40,6 +40,7 @@ THE POSSIBILITY OF SUCH DAMAGE.
 #include <asm/netlogic/mips-exts.h>
 #include <asm/netlogic/interrupt.h>
 #include <asm/netlogic/xlp_hal_pic.h>
+#include <asm/netlogic/hal/nlm_hal_fmn.h>
 #include <linux/module.h>
 
 #include <asm/asm.h>
@@ -131,6 +132,9 @@ void nlm_smp_finish(void)
 
 void nlm_cpus_done(void)
 {
+	int node = 0;
+	extern void *fdt;
+	nlm_hal_fmn_init(fdt, (void *)(long)node);
 }
 
 /*
diff --git a/drivers/dma/nlm_adma.c b/drivers/dma/nlm_adma.c
index b4ca868..a27470c 100644
--- a/drivers/dma/nlm_adma.c
+++ b/drivers/dma/nlm_adma.c
@@ -1548,9 +1548,6 @@ static int __devinit nlm_adma_probe(struct platform_device *pdev)
 	value = nlm_hal_read_32bit_reg (base, 0x40);
 	nlm_hal_write_32bit_reg (base, 0x40, value | (0x10));
 
-	/* Configure credits to non-n0c0 cores */
-	nlm_hal_fmn_init(0x10000000, 0x02000000, 50);
-
 	return 0;
 }
 
-- 
1.7.10.4

