From 500cd56274b08053f9d1ff9fae336831cc5f121a Mon Sep 17 00:00:00 2001
From: Zi Shen Lim <zlim@netlogicmicro.com>
Date: Thu, 29 Sep 2011 15:42:44 -0700
Subject: [PATCH 370/761] Resolve merge conflict: cleanup

deprecate CONFIG_PERFCTR

Based on Broadcom SDK 2.3.

Signed-off-by: Zi Shen Lim <zlim@netlogicmicro.com>
Signed-off-by: Yanjiang Jin <yanjiang.jin@windriver.com>
---
 arch/mips/netlogic/xlp/time.c |   18 +++---------------
 1 file changed, 3 insertions(+), 15 deletions(-)

diff --git a/arch/mips/netlogic/xlp/time.c b/arch/mips/netlogic/xlp/time.c
index 4e2c4f3..4acef9f 100644
--- a/arch/mips/netlogic/xlp/time.c
+++ b/arch/mips/netlogic/xlp/time.c
@@ -33,7 +33,6 @@ THE POSSIBILITY OF SUCH DAMAGE.
 #include <asm/time.h>
 #include <asm/cpu.h>
 #include <asm/cpu-features.h>
-#include <asm/perfctr.h>
 #include <linux/oprofile.h>
 
 #include <linux/proc_fs.h>
@@ -41,10 +40,6 @@ THE POSSIBILITY OF SUCH DAMAGE.
 
 extern spinlock_t xlp_pic_lock;
 
-#if defined(CONFIG_PERFCTR) && defined(CONFIG_OPROFILE)
-#error "Cannot enable both VPERF and OProfile at the same time"
-#endif
-
 #ifndef CONFIG_NLMCOMMON_MAC
 void nlm_common_user_mac_update_time(void)
 {
@@ -81,7 +76,7 @@ void nlm_common_timer_interrupt(struct pt_regs *regs, int irq)
 	nlm_hal_write_pic_reg(mmio, PIC_WD_HEARTBEAT_0(0), 1 << cpu_logical_map(cpu));
 #endif
 
-#if defined (CONFIG_OPROFILE) || defined (CONFIG_PERFCTR_INTERRUPT_SUPPORT)
+#if defined (CONFIG_OPROFILE)
 	int    perfctr_overflow = 0;
 #endif
 
@@ -95,7 +90,7 @@ void nlm_common_timer_interrupt(struct pt_regs *regs, int irq)
 		BUG();
 	}
 
-#if defined (CONFIG_PERFCTR_INTERRUPT_SUPPORT) || defined (CONFIG_OPROFILE)
+#if defined (CONFIG_OPROFILE)
     perfctr_overflow = ((read_c0_cause() >> 26) & 0x1);
 
     if(perfctr_overflow == 0)
@@ -109,18 +104,11 @@ void nlm_common_timer_interrupt(struct pt_regs *regs, int irq)
         }
     }
 
-#if defined (CONFIG_PERFCTR_INTERRUPT_SUPPORT) || defined (CONFIG_OPROFILE)
-	if (perfctr_overflow) {
-#ifdef CONFIG_PERFCTR_INTERRUPT_SUPPORT
-		(*perfctr_ihandler) (instruction_pointer(regs));
-#endif
-    }
-#ifdef CONFIG_OPROFILE
+#if defined (CONFIG_OPROFILE)
 	if (perfctr_overflow) {
 			nlm_common_oprofile_int_handler (irq, NULL, regs);
 		}
 #endif
-#endif
 
 }
 
-- 
1.7.10.4

