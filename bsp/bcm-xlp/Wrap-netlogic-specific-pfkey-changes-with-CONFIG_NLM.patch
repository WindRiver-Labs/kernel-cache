From f51ca040023545cc40ccf7d8d6557efdac37bd1c Mon Sep 17 00:00:00 2001
From: Joa-Yu Wu <jywu@netlogicmicro.com>
Date: Wed, 21 Dec 2011 10:24:08 -0800
Subject: [PATCH 493/761] Wrap netlogic specific pfkey changes with
 CONFIG_NLM_NET_KEY compilation flag.

Based on Broadcom SDK 2.3.

Signed-off-by: Joa-Yu Wu <jywu@netlogicmicro.com>
Signed-off-by: Yanjiang Jin <yanjiang.jin@windriver.com>
---
 include/linux/pfkeyv2.h |    4 ++++
 net/key/af_key.c        |    2 ++
 2 files changed, 6 insertions(+)

diff --git a/include/linux/pfkeyv2.h b/include/linux/pfkeyv2.h
index 30ad6ef..3ba0d45 100644
--- a/include/linux/pfkeyv2.h
+++ b/include/linux/pfkeyv2.h
@@ -261,8 +261,12 @@ struct sadb_x_kmaddress {
 #define SADB_X_SPDDELETE2	22
 #define SADB_X_NAT_T_NEW_MAPPING	23
 #define SADB_X_MIGRATE		24
+#ifdef CONFIG_NLM_NET_KEY
 #define SADB_X_NLMS_PRIVATE	25
 #define SADB_MAX		25
+#else
+#define SADB_MAX		24
+#endif
 
 /* Security Association flags */
 #define SADB_SAFLAGS_PFS	1
diff --git a/net/key/af_key.c b/net/key/af_key.c
index 705f9a6..e01eb52 100644
--- a/net/key/af_key.c
+++ b/net/key/af_key.c
@@ -2722,6 +2722,7 @@ static int pfkey_spdflush(struct sock *sk, struct sk_buff *skb, const struct sad
 typedef int (*pfkey_handler)(struct sock *sk, struct sk_buff *skb,
 			     const struct sadb_msg *hdr, void * const *ext_hdrs);
 
+#ifdef CONFIG_NLM_NET_KEY
 /*
  * PFKEY handlers specific to NetLogic IPSec implementation.
  */
@@ -2742,6 +2743,7 @@ static int pfkey_nlms_op(struct sock *sk, struct sk_buff *skb,
 	}
 	return 0;
 }
+#endif
 
 static pfkey_handler pfkey_funcs[SADB_MAX + 1] = {
 #ifndef CONFIG_NLM_NET_KEY
-- 
1.7.10.4

