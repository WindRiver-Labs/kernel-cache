From 18eb268238d4a145436aa0fb35d93bab779e0821 Mon Sep 17 00:00:00 2001
From: Lakshan Dias <ldias@netlogicmicro.com>
Date: Fri, 4 Nov 2011 11:27:19 -0700
Subject: [PATCH 472/762] Fix CPU frequency calculation

Based on Broadcom SDK 2.3.

Signed-off-by: Lakshan Dias <ldias@netlogicmicro.com>
Signed-off-by: Yanjiang Jin <yanjiang.jin@windriver.com>
---
 arch/mips/netlogic/xlp/cpu_control.c |    6 +++---
 1 files changed, 3 insertions(+), 3 deletions(-)

diff --git a/arch/mips/netlogic/xlp/cpu_control.c b/arch/mips/netlogic/xlp/cpu_control.c
index 1561c19..a0f3a84 100644
--- a/arch/mips/netlogic/xlp/cpu_control.c
+++ b/arch/mips/netlogic/xlp/cpu_control.c
@@ -228,7 +228,7 @@ static u32 get_pll_period(int divf,int divr) {
 
 /* Return frequency in Hz
  */
-static u32 get_pll_freq(int divf,int divr)
+static uint64_t get_pll_freq(int divf,int divr)
 {
 	uint64_t hz_freq;
 	uint64_t hz_mult = (1000ULL * 1000ULL * 1000ULL * 1000ULL * 1000ULL); /* 1e15 */
@@ -236,7 +236,7 @@ static u32 get_pll_freq(int divf,int divr)
 
 	hz_freq   = hz_mult/((uint64_t) pll_period_fs);
 
-	return (u32) hz_freq;
+	return hz_freq;
 }
 
 /* Return frequency in Hz
@@ -257,7 +257,7 @@ u32 get_cpu_freq(int cpu_num)
 	ext_div = SYS_PWRON_EXTDIV(pwron_rst_reg) + 1;
 	dfs  = SYS_CORE_DFS(core_dfs,core) + 1;
 
-	return (get_pll_freq(divf,divr)/(ext_div * dfs));
+	return ((u32)(get_pll_freq(divf,divr)/((uint64_t)(ext_div * dfs))));
 }
 
 EXPORT_SYMBOL(get_cpu_freq);
-- 
1.7.0.4

