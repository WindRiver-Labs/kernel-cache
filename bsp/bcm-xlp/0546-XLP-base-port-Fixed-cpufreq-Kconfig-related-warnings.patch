From 717fecb9f0b4bb1f480a47d88a990fde2f0441ea Mon Sep 17 00:00:00 2001
From: Jayanthi A <jayanthi.annadurai@broadcom.com>
Date: Thu, 19 Jul 2012 07:14:34 +0530
Subject: [PATCH 546/762] XLP base port: Fixed cpufreq Kconfig related warnings.

Based on Broadcom SDK 2.3.

Signed-off-by: Jayanthi A <jayanthi.annadurai@broadcom.com>
Signed-off-by: Yanjiang Jin <yanjiang.jin@windriver.com>
---
 arch/mips/Kconfig                |   31 +------------------------------
 arch/mips/Makefile               |   26 +++++++++++---------------
 arch/mips/kernel/cpufreq/Kconfig |    2 --
 arch/mips/kernel/vmlinux.lds.S   |   24 +++++-------------------
 arch/mips/netlogic/Platform      |    4 ++--
 5 files changed, 19 insertions(+), 68 deletions(-)

diff --git a/arch/mips/Kconfig b/arch/mips/Kconfig
index fd2838b..c652494 100644
--- a/arch/mips/Kconfig
+++ b/arch/mips/Kconfig
@@ -714,33 +714,6 @@ config WR_PPMC
 	  This enables support for the Wind River MIPS32 4KC PPMC evaluation
 	  board, which is based on GT64120 bridge chip.
 
-config NLM_PTR
-	bool "Support for Netlogic ATX board"
-	depends on EXPERIMENTAL
-	select SMP
-	select BOOT_ELF32
-	select NLM_COMMON
-	select NLM_XLR
-	select SYS_HAS_CPU_XLR
-	select SYS_SUPPORTS_SMP
-	select HW_HAS_PCI
-	select SWAP_IO_SPACE
-	select SYS_SUPPORTS_32BIT_KERNEL
-    	select SYS_SUPPORTS_64BIT_KERNEL
-	select 64BIT_PHYS_ADDR
-	select SYS_SUPPORTS_BIG_ENDIAN
-	select SYS_SUPPORTS_HIGHMEM
-	select DMA_COHERENT
-	select CEVT_R4K
-	select CSRC_R4K
-	select IRQ_CPU
-	select ZONE_DMA if 64BIT
-	select SYNC_R4K
-	select SYS_HAS_EARLY_PRINTK
-	help
-	  This board is based on Netlogic XLR processor. 
-	  Say Y here to support this machine type
-
 config CAVIUM_OCTEON_SIMULATOR
 	bool "Cavium Networks Octeon Simulator"
 	select CEVT_R4K
@@ -761,7 +734,6 @@ config NLM_XLP_SIM
 	depends on EXPERIMENTAL
 	select SMP
 	select BOOT_ELF32
-	select NLM_COMMON
 	select NLMCOMMON
 	select NLM_XLP
 	select SYS_HAS_CPU_XLP
@@ -790,7 +762,6 @@ config NLM_XLP_EVP_BOARD
         depends on EXPERIMENTAL
         select SMP
         select BOOT_ELF32
-	select NLM_COMMON
 	select NLMCOMMON
         select NLM_XLP
         select SYS_HAS_CPU_XLP
@@ -877,7 +848,7 @@ config NLM_XLP_BOARD
 	bool "Netlogic XLP based systems"
 	depends on EXPERIMENTAL
 	select BOOT_ELF32
-	select NLM_COMMON
+	select NLMCOMMON
 	select NLM_XLP
 	select SYS_HAS_CPU_XLP
 	select SYS_SUPPORTS_SMP
diff --git a/arch/mips/Makefile b/arch/mips/Makefile
index 9ac049d..5f43626 100644
--- a/arch/mips/Makefile
+++ b/arch/mips/Makefile
@@ -196,9 +196,9 @@ cflags-y			+= -I$(srctree)/arch/mips/include/asm/mach-generic
 #
 #
 # NETLOGIC SOC Common (common)
-core-$(CONFIG_NLM_COMMON)      	+= arch/mips/netlogic/common/
-cflags-$(CONFIG_NLM_COMMON)    	+= -DXLS -I$(srctree)/arch/mips/include/asm/mach-netlogic
-cflags-$(CONFIG_NLM_COMMON)    	+= -I$(srctree)/arch/mips/include/asm/netlogic
+core-$(CONFIG_NLMCOMMON)      	+= arch/mips/netlogic/common/
+cflags-$(CONFIG_NLMCOMMON)    	+= -DXLS -I$(srctree)/arch/mips/include/asm/mach-netlogic
+cflags-$(CONFIG_NLMCOMMON)    	+= -I$(srctree)/arch/mips/include/asm/netlogic
 
 core-$(CONFIG_NLM_XLP) 		+= arch/mips/netlogic/xlp/
 cflags-$(CONFIG_NLM_XLP_SIM)        	+= -DXLP_SIM=1
@@ -214,10 +214,10 @@ include $(srctree)/arch/mips/Kbuild.platforms
 core-$(CONFIG_NLM_XLP) 		+= arch/mips/netlogic/boot/
 cflags-$(CONFIG_NLM_XLP)	+= -I$(srctree)/arch/mips/include/asm/netlogic/hal
 cflags-$(CONFIG_NLM_XLP)	+= -I$(srctree)/arch/mips/netlogic/boot
-cflags-$(CONFIG_NLM_COMMON)    	+= -DXLP -I$(srctree)/arch/mips/include/asm/mach-netlogic
-cflags-$(CONFIG_NLM_COMMON)    	+= -I$(srctree)/arch/mips/include/asm/netlogic
-load-$(CONFIG_NLM_XLP_EVP_BOARD) += $(CONFIG_NLM_COMMON_LOAD_ADDRESS)
-load-$(CONFIG_NLM_XLP_BOARD) += $(CONFIG_NLM_COMMON_LOAD_ADDRESS)
+cflags-$(CONFIG_NLMCOMMON)    	+= -DXLP -I$(srctree)/arch/mips/include/asm/mach-netlogic
+cflags-$(CONFIG_NLMCOMMON)    	+= -I$(srctree)/arch/mips/include/asm/netlogic
+load-$(CONFIG_NLM_XLP_EVP_BOARD) += $(CONFIG_NLMCOMMON_LOAD_ADDRESS)
+load-$(CONFIG_NLM_XLP_BOARD) += $(CONFIG_NLMCOMMON_LOAD_ADDRESS)
 
 drivers-$(CONFIG_PCI)		+= arch/mips/pci/
 
@@ -250,6 +250,10 @@ KBUILD_CPPFLAGS += -D"DATAOFFSET=$(if $(dataoffset-y),$(dataoffset-y),0)"
 
 LDFLAGS			+= -m $(ld-emul)
 
+ifdef CONFIG_MAPPED_KERNEL
+KBUILD_CPPFLAGS	+= -D"LOADADDR=$(load-y)" -D"PHYSADDR=$(CONFIG_PHYS_LOAD_ADDRESS)"
+endif
+
 ifdef CONFIG_MIPS
 CHECKFLAGS += $(shell $(CC) $(KBUILD_CFLAGS) -dM -E -x c /dev/null | \
 	egrep -vw '__GNUC_(|MINOR_|PATCHLEVEL_)_' | \
@@ -261,14 +265,6 @@ endif
 
 OBJCOPYFLAGS		+= --remove-section=.reginfo
 
-ifdef CONFIG_MAPPED_KERNEL
-PHYS_LOAD_ADDRESS = -D"PHYSADDR=$(CONFIG_PHYS_LOAD_ADDRESS)"
-endif
-
-ifdef CONFIG_MAPPED_KERNEL
-KBUILD_CFLAGS += -D"LOADADDR=$(load-y)ULL" -D"PHYSADDR=$(CONFIG_PHYS_LOAD_ADDRESS)ULL"
-KBUILD_CFLAGS += -D"LOADADDR_ASM=$(load-y)" -D"PHYSADDR_ASM=$(CONFIG_PHYS_LOAD_ADDRESS)"
-endif
 head-y := arch/mips/kernel/head.o arch/mips/kernel/init_task.o
 
 libs-y			+= arch/mips/lib/
diff --git a/arch/mips/kernel/cpufreq/Kconfig b/arch/mips/kernel/cpufreq/Kconfig
index 58c601e..92f8eeb 100644
--- a/arch/mips/kernel/cpufreq/Kconfig
+++ b/arch/mips/kernel/cpufreq/Kconfig
@@ -14,8 +14,6 @@ if MIPS_CPUFREQ
 
 menu "CPU Frequency scaling"
 
-source "drivers/cpufreq/Kconfig"
-
 if CPU_FREQ
 
 comment "CPUFreq processor drivers"
diff --git a/arch/mips/kernel/vmlinux.lds.S b/arch/mips/kernel/vmlinux.lds.S
index 9340a3d..c0c051c 100644
--- a/arch/mips/kernel/vmlinux.lds.S
+++ b/arch/mips/kernel/vmlinux.lds.S
@@ -1,6 +1,5 @@
 #include <asm/asm-offsets.h>
 #include <asm/page.h>
-#include <asm/thread_info.h>
 #include <asm-generic/vmlinux.lds.h>
 
 #undef mips
@@ -8,27 +7,15 @@
 OUTPUT_ARCH(mips)
 
 #ifdef CONFIG_MAPPED_KERNEL
-#define AT_LOCATION
-#endif
-
-PHDRS {
-#ifdef CONFIG_MAPPED_KERNEL
-	text PT_LOAD AT_LOCATION FLAGS(7);	/* RWX */
-#else
-	text PT_LOAD FLAGS(7);  /* RWX */
-#endif
-	note PT_NOTE FLAGS(4);	/* R__ */
-}
-
-#ifdef CONFIG_MAPPED_KERNEL
-#ifdef PHYSADDR
-phys_entry = kernel_entry - LOADADDR_ASM + PHYSADDR_ASM;
-#endif
+phys_entry = kernel_entry - LOADADDR + PHYSADDR;
 ENTRY(phys_entry)
 #else
 ENTRY(kernel_entry)
 #endif
-
+PHDRS {
+	text PT_LOAD FLAGS(7);	/* RWX */
+	note PT_NOTE FLAGS(4);	/* R__ */
+}
 
 #ifdef CONFIG_32BIT
 	#ifdef CONFIG_CPU_LITTLE_ENDIAN
@@ -57,7 +44,6 @@ SECTIONS
 	/* . = 0xa800000000300000; */
 	. = 0xffffffff80300000;
 #endif
-
 	. = VMLINUX_LOAD_ADDRESS;
 	/* read-only */
 	_text = .;	/* Text and read-only data */
diff --git a/arch/mips/netlogic/Platform b/arch/mips/netlogic/Platform
index b1b54d6..04ff9aa 100644
--- a/arch/mips/netlogic/Platform
+++ b/arch/mips/netlogic/Platform
@@ -1,8 +1,8 @@
 #
 # NETLOGIC includes
 #
-cflags-$(CONFIG_NLM_COMMON)	+= -I$(srctree)/arch/mips/include/asm/mach-netlogic
-cflags-$(CONFIG_NLM_COMMON)	+= -I$(srctree)/arch/mips/include/asm/netlogic
+cflags-$(CONFIG_NLMCOMMON)	+= -I$(srctree)/arch/mips/include/asm/mach-netlogic
+cflags-$(CONFIG_NLMCOMMON)	+= -I$(srctree)/arch/mips/include/asm/netlogic
 
 #
 # use mips64 if xlr is not available
-- 
1.7.0.4

