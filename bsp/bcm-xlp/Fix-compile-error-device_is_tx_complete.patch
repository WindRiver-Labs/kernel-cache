From 38a9a238d853b262c5100f8dd2ad9dcfab9cff5b Mon Sep 17 00:00:00 2001
From: Zi Shen Lim <zlim@netlogicmicro.com>
Date: Fri, 30 Sep 2011 19:59:08 -0700
Subject: [PATCH 426/761] Fix compile error: device_is_tx_complete

device_is_tx_complete converted to device_tx_status in mainline.

Based on Broadcom SDK 2.3.

Signed-off-by: Zi Shen Lim <zlim@netlogicmicro.com>
Signed-off-by: Yanjiang Jin <yanjiang.jin@windriver.com>
---
 drivers/dma/nlm_adma.c |   23 ++++++++++-------------
 1 file changed, 10 insertions(+), 13 deletions(-)

diff --git a/drivers/dma/nlm_adma.c b/drivers/dma/nlm_adma.c
index c7ef891..25f0829 100644
--- a/drivers/dma/nlm_adma.c
+++ b/drivers/dma/nlm_adma.c
@@ -672,8 +672,7 @@ static void nlm_adma_free_chan_resources(struct dma_chan *chan)
  */
 static enum dma_status nlm_adma_is_complete(struct dma_chan *chan,
 		dma_cookie_t cookie, 
-		dma_cookie_t *done, 
-		dma_cookie_t *used)
+		struct dma_tx_state *txstate)
 {
 	struct nlm_adma_chan *nlm_chan = to_nlm_adma_chan(chan);
 	dma_cookie_t last_used;
@@ -684,11 +683,10 @@ static enum dma_status nlm_adma_is_complete(struct dma_chan *chan,
 	last_used = chan->cookie;
 	last_complete = nlm_chan->completed_cookie;
 
-	if (done)
-		*done = last_complete;
-
-	if (used)
-		*used = last_used;
+	if (txstate) {
+		txstate->last = last_complete;
+		txstate->used = last_used;
+	}
 
 	ret = dma_async_is_complete(cookie, last_complete, last_used);
 	if (ret == DMA_SUCCESS)
@@ -700,11 +698,10 @@ static enum dma_status nlm_adma_is_complete(struct dma_chan *chan,
 	last_used = chan->cookie;
 	last_complete = nlm_chan->completed_cookie;
 
-	if (done)
-		*done = last_complete;
-
-	if (used)
-		*used = last_used;
+	if (txstate) {
+		txstate->last = last_complete;
+		txstate->used = last_used;
+	}
 
 	ret = dma_async_is_complete(cookie, last_complete, last_used);
 
@@ -1514,7 +1511,7 @@ static int __devinit nlm_adma_probe(struct platform_device *pdev)
 
 		dma_dev->device_alloc_chan_resources = nlm_adma_alloc_chan_resources;
 		dma_dev->device_free_chan_resources = nlm_adma_free_chan_resources;
-		dma_dev->device_is_tx_complete = nlm_adma_is_complete;
+		dma_dev->device_tx_status = nlm_adma_is_complete;
 		dma_dev->device_issue_pending = nlm_adma_issue_pending;
 
 		// dma_cap_set(DMA_INTERRUPT, dma_dev->cap_mask);
-- 
1.7.10.4

