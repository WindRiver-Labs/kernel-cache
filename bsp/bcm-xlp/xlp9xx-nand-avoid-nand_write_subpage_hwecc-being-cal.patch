From 06f13900c7658d05e14154d91bd48e01db653a40 Mon Sep 17 00:00:00 2001
From: Lijun Guo <Lijun.Guo@windriver.com>
Date: Wed, 31 Dec 2014 10:49:47 +0000
Subject: [PATCH] xlp9xx nand: avoid nand_write_subpage_hwecc being called

When mounting ubifs using preempt-rt kernel on xlp board, ubiattach
exits because of "segmentation fault". This is because the kernel
will call nand_write_subpage_hwecc during attaching. But xlp's nand
driver didn't support sub-page write. So, add "NAND_NO_SUBPAGE_WRITE"
option into the "chip.options" of the xlp's nand driver. This option
means the driver doesn't support sub-page write.

Signed-off-by: Lijun Guo <Lijun.Guo@windriver.com>
---
 drivers/mtd/nand/xlp9xx_nand.c |    2 +-
 1 files changed, 1 insertions(+), 1 deletions(-)

diff --git a/drivers/mtd/nand/xlp9xx_nand.c b/drivers/mtd/nand/xlp9xx_nand.c
index d0efd78..5e742c1 100644
--- a/drivers/mtd/nand/xlp9xx_nand.c
+++ b/drivers/mtd/nand/xlp9xx_nand.c
@@ -809,7 +809,7 @@ static int xlp9xx_nand_probe(struct platform_device *pdev)
 	data->chip.write_buf	= xlp9xx_nand_write_buf;
 	data->chip.cmdfunc	= xlp9xx_nand_cmdfunc;
 	data->chip.select_chip	= xlp9xx_select_chip;
-	data->chip.options	= NAND_SKIP_BBTSCAN;
+	data->chip.options  = NAND_SKIP_BBTSCAN | NAND_NO_SUBPAGE_WRITE;
 
 	xlp9xx_nand_write_reg(data, NAND_RYBYSEL, 0x1);
 	val = wait_nand_ready(data);
-- 
1.7.5.4

