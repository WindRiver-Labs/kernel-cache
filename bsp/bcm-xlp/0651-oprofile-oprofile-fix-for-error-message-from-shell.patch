From e6caf27c6040d82802cea7ec747a04dd90c0f99a Mon Sep 17 00:00:00 2001
From: kopal <kopal@broadcom.com>
Date: Thu, 3 Jan 2013 13:02:46 +0530
Subject: [PATCH 651/762] oprofile: oprofile fix for error message from shell

"opcontrol --start" was giving an error message as it was trying to
write to /dev/oprofile/backtrace.

Based on Broadcom SDK 2.3.

Signed-off-by: kopal <kopal@broadcom.com>
Signed-off-by: Yanjiang Jin <yanjiang.jin@windriver.com>
---
 drivers/oprofile/oprofile_files.c |    3 ++-
 1 files changed, 2 insertions(+), 1 deletions(-)

diff --git a/drivers/oprofile/oprofile_files.c b/drivers/oprofile/oprofile_files.c
index 84a208d..c50c59a 100644
--- a/drivers/oprofile/oprofile_files.c
+++ b/drivers/oprofile/oprofile_files.c
@@ -190,7 +190,8 @@ void oprofile_create_files(struct super_block *sb, struct dentry *root)
 	oprofilefs_create_ulong(sb, root, "buffer_watershed", &oprofile_buffer_watershed);
 	oprofilefs_create_ulong(sb, root, "cpu_buffer_size", &oprofile_cpu_buffer_size);
 	oprofilefs_create_file(sb, root, "cpu_type", &cpu_type_fops);
-	oprofilefs_create_file(sb, root, "backtrace_depth", &depth_fops);
+	if(oprofile_ops.backtrace)
+		oprofilefs_create_file(sb, root, "backtrace_depth", &depth_fops);
 	oprofilefs_create_file(sb, root, "pointer_size", &pointer_size_fops);
 #ifdef CONFIG_OPROFILE_EVENT_MULTIPLEX
 	oprofilefs_create_file(sb, root, "time_slice", &timeout_fops);
-- 
1.7.0.4

