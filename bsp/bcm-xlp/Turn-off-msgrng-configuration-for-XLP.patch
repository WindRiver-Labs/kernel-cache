From 92b94d8449c53edb324e8440c6c5af827386a4d6 Mon Sep 17 00:00:00 2001
From: Venu Vadapalli <vvadapalli@netlogicmicro.com>
Date: Fri, 15 Oct 2010 18:06:58 -0700
Subject: [PATCH 201/761] Turn off msgrng configuration for XLP

Based on Broadcom SDK 2.3.

Signed-off-by: Venu Vadapalli <vvadapalli@netlogicmicro.com>
Signed-off-by: Yanjiang Jin <yanjiang.jin@windriver.com>
---
 arch/mips/netlogic/common/Makefile |    8 ++++----
 arch/mips/netlogic/msgcfg/Makefile |   11 ++++++++---
 2 files changed, 12 insertions(+), 7 deletions(-)

diff --git a/arch/mips/netlogic/common/Makefile b/arch/mips/netlogic/common/Makefile
index 2f6292a..4b2d13a 100644
--- a/arch/mips/netlogic/common/Makefile
+++ b/arch/mips/netlogic/common/Makefile
@@ -1,13 +1,13 @@
 #EXTRA_CFLAGS := -Werror
 EXTRA_CFLAGS := $(CFLAGS) -DNLM_HAL_LINUX_KERNEL -Iarch/mips/include/asm/netlogic/hal
-obj-y :=   platform.o cpu_proc.o memory.o
+obj-y :=   cpu_proc.o memory.o bootinfo.o
 
 obj-y 					+= msgring.o
 obj-y 					+= msgring_xls.o
 obj-y 					+= msgring_shared.o
-obj-$(CONFIG_NLM_XLP)			+= nlm_hal_fmn_config.o
 
-obj-$(CONFIG_NLM_XLP)			+= nlm_hal.o
+obj-$(CONFIG_NLM_XLP)			+= nlm_hal_fmn_config.o
+obj-$(CONFIG_NLM_XLP)			+= nlm_hal.o nlm_hal_nae.o
 
 obj-$(CONFIG_RAPIDIO)             	+= srio.o
 obj-$(CONFIG_NLMCOMMON_IP_OVER_PCI) 	+= dma.o
@@ -17,6 +17,6 @@ EXTRA_AFLAGS := $(CFLAGS)
 
 clean-files += msgring.o msgring_xls.o msgring_shared.o nlm_hal_fmn_config.o
 clean-files += nlm_hal.o
-clean-files += srio.o dma.o smp.o platform.o cpu_proc.o
+clean-files += srio.o dma.o smp.o cpu_proc.o
 clean-files += msgring.c msgring_xls.c msgring_shared.c nlm_hal.c
 
diff --git a/arch/mips/netlogic/msgcfg/Makefile b/arch/mips/netlogic/msgcfg/Makefile
index 76f5e26..83b16c9 100644
--- a/arch/mips/netlogic/msgcfg/Makefile
+++ b/arch/mips/netlogic/msgcfg/Makefile
@@ -3,6 +3,7 @@ LOCAL_HAL_DIR :=$(srctree)/arch/mips/include/asm/netlogic/hal
 EXTRA_CFLAGS := $(CFLAGS) -DNLM_HAL_LINUX_KERNEL -I$(LOCAL_HAL_DIR)
 EXTRA_AFLAGS := $(CFLAGS)
 
+ifdef CONFIG_NLM_XLR
 clean-files += msgring_shared.lex.c
 clean-files += msgring_xls.lex.c
 clean-files += msgring.yacc.c
@@ -15,19 +16,23 @@ clean-files += msgring_xls
 clean-files += msgring_xls.yacc.h
 clean-files += msgring_shared.yacc.h
 clean-files += msgring.lex.c
+endif
 
 shared_sources:
 	$(Q)mkdir -p $(LOCAL_HAL_DIR)
 ifneq ("$(HAL_DIR)", "")
 	$(Q) echo "***Caching NLM HAL code from $(HAL_DIR)***"
-	$(Q)cp -fr $(HAL_DIR)/* $(LOCAL_HAL_DIR)/
+	$(Q)cp -fr $(HAL_DIR)/*.h $(LOCAL_HAL_DIR)/
+	$(Q)cp -fr $(HAL_DIR)/nlm_hal.c  ../common
+	$(Q)cp -fr $(HAL_DIR)/nlm_hal_fmn_config.c  ../common
+	$(Q)cp -fr $(HAL_DIR)/nlm_hal_nae.c  ../common
 endif
-	$(Q)cp $(LOCAL_HAL_DIR)/nlm_hal.c  ../common
-	$(Q)cp $(LOCAL_HAL_DIR)/nlm_hal_fmn_config.c  ../common
 
 msgring:
+ifdef CONFIG_NLM_XLR
 	make -f Makefile.msgring all
 	make -f Makefile.msgring.xls all
 	make -f Makefile.msgring.shared all
+endif
 
 .PHONY: msgring
-- 
1.7.10.4

