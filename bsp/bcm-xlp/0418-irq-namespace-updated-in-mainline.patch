From 9f967a658a2cea451978e2e8f7982dc281ab324d Mon Sep 17 00:00:00 2001
From: Zi Shen Lim <zlim@netlogicmicro.com>
Date: Fri, 30 Sep 2011 15:26:15 -0700
Subject: [PATCH 418/762] irq: namespace updated in mainline

Based on Broadcom SDK 2.3.

Signed-off-by: Zi Shen Lim <zlim@netlogicmicro.com>
Signed-off-by: Yanjiang Jin <yanjiang.jin@windriver.com>
---
 arch/mips/netlogic/xlp/irq.c |   17 +++++++++++------
 1 files changed, 11 insertions(+), 6 deletions(-)

diff --git a/arch/mips/netlogic/xlp/irq.c b/arch/mips/netlogic/xlp/irq.c
index ac9446e..adaa86f 100644
--- a/arch/mips/netlogic/xlp/irq.c
+++ b/arch/mips/netlogic/xlp/irq.c
@@ -1470,6 +1470,11 @@ int arch_setup_msi_irqs(struct pci_dev *dev, int nvec, int type)
 EXPORT_SYMBOL(arch_setup_msi_irqs);
 #endif
 
+static inline void irq_desc_set_chip(struct irq_desc *desc, struct irq_chip *chip)
+{
+	irq_desc_get_irq_data(desc)->chip = chip;
+}
+
 void __init init_nlm_common_irqs(void)
 {
 	int i;
@@ -1487,21 +1492,21 @@ void __init init_nlm_common_irqs(void)
 #endif
 
 #ifdef CONFIG_REMOTE_DEBUG
-	irq_desc[XLP_IRQ_REMOTE_DEBUG].chip = &nlm_common_rsvd_pic;
-	irq_desc[XLP_IRQ_REMOTE_DEBUG].action = nlm_common_rsvd_action;
+	irq_desc_set_chip(&irq_desc[XLP_IRQ_REMOTE_DEBUG], &nlm_common_rsvd_pic);
+	irq_desc[XLP_IRQ_REMOTE_DEBUG].action = &nlm_common_rsvd_action;
 	xlp_irq_mask |= (1ULL << XLP_IRQ_REMOTE_DEBUG);
 #endif
 
 #ifdef CONFIG_SMP
-	irq_desc[XLP_IRQ_IPI_SMP_FUNCTION].chip = &nlm_common_rsvd_pic;
+	irq_desc_set_chip(&irq_desc[XLP_IRQ_IPI_SMP_FUNCTION], &nlm_common_rsvd_pic);
 	irq_desc[XLP_IRQ_IPI_SMP_FUNCTION].action = &nlm_common_rsvd_action;
 
-	irq_desc[XLP_IRQ_IPI_SMP_RESCHEDULE].chip = &nlm_common_rsvd_pic;
+	irq_desc_set_chip(&irq_desc[XLP_IRQ_IPI_SMP_RESCHEDULE], &nlm_common_rsvd_pic);
 	irq_desc[XLP_IRQ_IPI_SMP_RESCHEDULE].action = &nlm_common_rsvd_action;
 
 #ifdef CONFIG_NLMCOMMON_IP_FLOW_AFFINITY
 	/* PR: New IPI added here for netrx balancing */
-	irq_desc[XLP_IRQ_IPI_NETRX].chip = &nlm_common_rsvd_pic;
+	irq_desc_set_chip(&irq_desc[XLP_IRQ_IPI_NETRX], &nlm_common_rsvd_pic);
 	irq_desc[XLP_IRQ_IPI_NETRX].action = &nlm_common_rsvd_action;
 	xlp_irq_mask |= (1ULL << XLP_IRQ_IPI_NETRX);
 #endif				/* CONFIG_NLMCOMMON_IP_FLOW_AFFINITY */
@@ -1511,7 +1516,7 @@ void __init init_nlm_common_irqs(void)
 #endif
 
 	/* msgring interrupt */
-	irq_desc[XLP_IRQ_MSGRING].chip = &nlm_common_rsvd_pic;
+	irq_desc_set_chip(&irq_desc[XLP_IRQ_MSGRING], &nlm_common_rsvd_pic);
 	irq_desc[XLP_IRQ_MSGRING].action = &nlm_common_rsvd_action;
 	xlp_irq_mask |= (1ULL << XLP_IRQ_MSGRING);
 
-- 
1.7.0.4

