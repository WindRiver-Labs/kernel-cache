From 540a842e92cb8609c75d3feb9abe6282008342f3 Mon Sep 17 00:00:00 2001
From: Divya Sakthidharan <divyas@broadcom.com>
Date: Tue, 30 Oct 2012 12:54:46 +0530
Subject: [PATCH 614/761] NAND: Support for onfi 3.0 & 3.1

Added support for onfi 3.0, 3.1 compliant nand chip.
and changed nand size calculation for the multi lun chips.

Based on Broadcom SDK 2.3.

Signed-off-by: Divya Sakthidharan <divyas@broadcom.com>
Signed-off-by: Yanjiang Jin <yanjiang.jin@windriver.com>
---
 drivers/mtd/nand/nand_base.c |    6 +++++-
 1 file changed, 5 insertions(+), 1 deletion(-)

diff --git a/drivers/mtd/nand/nand_base.c b/drivers/mtd/nand/nand_base.c
index 821644a..7ade1d1 100644
--- a/drivers/mtd/nand/nand_base.c
+++ b/drivers/mtd/nand/nand_base.c
@@ -2877,7 +2877,11 @@ static int nand_flash_detect_onfi(struct mtd_info *mtd, struct nand_chip *chip,
 
 	/* Check version */
 	val = le16_to_cpu(p->revision);
-	if (val & (1 << 5))
+	if (val & (1 << 7))
+		chip->onfi_version = 31;
+	else if (val & (1 << 6))
+		chip->onfi_version = 30;
+	else if (val & (1 << 5))
 		chip->onfi_version = 23;
 	else if (val & (1 << 4))
 		chip->onfi_version = 22;
-- 
1.7.10.4

