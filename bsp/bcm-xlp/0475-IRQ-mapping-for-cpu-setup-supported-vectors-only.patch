From 8ae135c34fbed53f031d28b32b3debfe49f86848 Mon Sep 17 00:00:00 2001
From: Zi Shen Lim <zlim@netlogicmicro.com>
Date: Wed, 9 Nov 2011 11:12:59 -0800
Subject: [PATCH 475/762] IRQ mapping for cpu: setup supported vectors only

Based on Broadcom SDK 2.3.

Signed-off-by: Zi Shen Lim <zlim@netlogicmicro.com>
Signed-off-by: Yanjiang Jin <yanjiang.jin@windriver.com>
---
 arch/mips/netlogic/xlp/irq.c |   15 +++++++++++++--
 1 files changed, 13 insertions(+), 2 deletions(-)

diff --git a/arch/mips/netlogic/xlp/irq.c b/arch/mips/netlogic/xlp/irq.c
index 4d367fb..c8d306b 100644
--- a/arch/mips/netlogic/xlp/irq.c
+++ b/arch/mips/netlogic/xlp/irq.c
@@ -79,8 +79,19 @@ static void __init init_xlp_irq_map(void)
 	for (i = 0; i < NR_IRQS; i++)
 		xlp_irq_to_rvec_map[i] = -1;
 
-	for (i = 0; i < XLP_PIC_IRQ_BASE; i++)
-		set_irq_mapping(i, i);
+	for (i = 0; i < XLP_IRQ_RESERVED_MAX; i++) {
+		switch (i) {
+#ifdef CONFIG_SMP
+		case XLP_IRQ_IPI_SMP_FUNCTION:
+		case XLP_IRQ_IPI_SMP_RESCHEDULE:
+#endif /* CONFIG_SMP */
+		case XLP_IRQ_TIMER:
+			set_irq_mapping(i, i);
+			break;
+		default:
+			break;
+		}
+	}
 
 	for (i = XLP_PIC_IRQ_BASE; i < NR_IRQS; i++) {
 		switch (i) {
-- 
1.7.0.4

