From 3a4132a6673b5acdd5086859e081687f06e6549c Mon Sep 17 00:00:00 2001
From: Zi Shen Lim <zlim@netlogicmicro.com>
Date: Thu, 29 Sep 2011 14:16:56 -0700
Subject: [PATCH 346/762] Resolve merge conflict: merge

rixi

Based on Broadcom SDK 2.3.

Signed-off-by: Zi Shen Lim <zlim@netlogicmicro.com>
Signed-off-by: Yanjiang Jin <yanjiang.jin@windriver.com>
---
 arch/mips/include/asm/pgtable-bits.h |   26 +++++++++++++++-----------
 1 files changed, 15 insertions(+), 11 deletions(-)

diff --git a/arch/mips/include/asm/pgtable-bits.h b/arch/mips/include/asm/pgtable-bits.h
index 7e2325c..d76e368 100644
--- a/arch/mips/include/asm/pgtable-bits.h
+++ b/arch/mips/include/asm/pgtable-bits.h
@@ -104,19 +104,23 @@
 #endif
 
 #ifdef CONFIG_NLM_XLP
-/*XLP has bit 57,56 in entrylo0/1 as RI:XI. We will use pte bits 63:62 to store
- *ri:xi, after right shift by 6, these bits will come to proper position.
-*/
+/* XLP has bit 57,56 in entrylo0/1 as RI:XI.
+ * We will use pte bits 63:62 to store ri:xi,
+ * after right shift by 6, these bits will come to proper position.
+ */
 /* Page cannot be executed */
-#define _PAGE_NO_EXEC_SHIFT    (kernel_uses_smartmips_rixi ? 62: _PAGE_HUGE_SHIFT)
-#define _PAGE_NO_EXEC      ({if (!kernel_uses_smartmips_rixi) BUG(); 1ULL << _PAGE_NO_EXEC_SHIFT; })
+#define _PAGE_NO_EXEC_SHIFT	(kernel_uses_smartmips_rixi ? 62 : _PAGE_HUGE_SHIFT)
+#define _PAGE_NO_EXEC		({if (!kernel_uses_smartmips_rixi) BUG(); 1 << _PAGE_NO_EXEC_SHIFT; })
+
 /* Page cannot be read */
-#define _PAGE_NO_READ_SHIFT    (kernel_uses_smartmips_rixi ? 63: _PAGE_NO_EXEC_SHIFT)
-#define _PAGE_NO_READ      ({if (!kernel_uses_smartmips_rixi) BUG(); 1ULL << _PAGE_NO_READ_SHIFT; })
+#define _PAGE_NO_READ_SHIFT	(kernel_uses_smartmips_rixi ? 63 : _PAGE_NO_EXEC_SHIFT)
+#define _PAGE_NO_READ		({if (!kernel_uses_smartmips_rixi) BUG(); 1 << _PAGE_NO_READ_SHIFT; })
+
+#define _PAGE_GLOBAL_SHIFT	(6)
+#define _PAGE_GLOBAL		(1 << _PAGE_GLOBAL_SHIFT)
 
-#define _PAGE_GLOBAL_SHIFT 6
+#else /* CONFIG_NLM_XLP */
 
-#else
 /* Page cannot be executed */
 #define _PAGE_NO_EXEC_SHIFT	(kernel_uses_smartmips_rixi ? _PAGE_HUGE_SHIFT + 1 : _PAGE_HUGE_SHIFT)
 #define _PAGE_NO_EXEC		({if (!kernel_uses_smartmips_rixi) BUG(); 1 << _PAGE_NO_EXEC_SHIFT; })
@@ -126,9 +130,10 @@
 #define _PAGE_NO_READ		({if (!kernel_uses_smartmips_rixi) BUG(); 1 << _PAGE_NO_READ_SHIFT; })
 
 #define _PAGE_GLOBAL_SHIFT	(_PAGE_NO_READ_SHIFT + 1)
-#endif
 #define _PAGE_GLOBAL		(1 << _PAGE_GLOBAL_SHIFT)
 
+#endif /* CONFIG_NLM_XLP */
+
 #define _PAGE_VALID_SHIFT	(_PAGE_GLOBAL_SHIFT + 1)
 #define _PAGE_VALID		(1 << _PAGE_VALID_SHIFT)
 /* synonym                 */
@@ -187,7 +192,6 @@ static inline uint64_t pte_to_entrylo(unsigned long pte_val)
 		 */
 		return (pte_val >> _PAGE_GLOBAL_SHIFT) |
 			((pte_val & (_PAGE_NO_EXEC | _PAGE_NO_READ)) << sa);
-#endif
 	}
 
 	return pte_val >> _PAGE_GLOBAL_SHIFT;
-- 
1.7.0.4

