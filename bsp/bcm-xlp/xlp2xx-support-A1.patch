From c19640380381ba9cf9b841465302f3abf66a5fda Mon Sep 17 00:00:00 2001
From: ShengLiang Song <shengliang.song@broadcom.com>
Date: Thu, 6 Dec 2012 15:43:51 -0800
Subject: [PATCH 647/761] xlp2xx: support A1

Based on Broadcom SDK 2.3.

Signed-off-by: ShengLiang Song <shengliang.song@broadcom.com>
Signed-off-by: Yanjiang Jin <yanjiang.jin@windriver.com>
---
 arch/mips/netlogic/xlp/cpu_control_asm.S |   11 +++++++++--
 1 file changed, 9 insertions(+), 2 deletions(-)

diff --git a/arch/mips/netlogic/xlp/cpu_control_asm.S b/arch/mips/netlogic/xlp/cpu_control_asm.S
index 6a119a7..20c9bef 100644
--- a/arch/mips/netlogic/xlp/cpu_control_asm.S
+++ b/arch/mips/netlogic/xlp/cpu_control_asm.S
@@ -113,8 +113,15 @@
 
         mfc0    t0,$15,0
         andi    t0,t0,0xffff
-        addiu   t0,t0,-0x1200
-        bne     t0,$0,12f
+
+        /* if(v<0x1200) skip workaround */
+        slt     t1,t0,0x1200
+        bne     t1,$0,12f
+        nop
+
+        /* if(v<0x1202) apply workaround : disable 2way L1D*/
+        slt     t1,t0,0x1202
+        beq     t1,$0,12f
         nop
 
 	li    t0, 0x80000000
-- 
1.7.10.4

