From 51802105b8542852d283b0d23b8bf78a34a03f7b Mon Sep 17 00:00:00 2001
From: henry shao <hshao@netlogicmicro.com>
Date: Thu, 13 Jan 2011 15:55:08 -0800
Subject: [PATCH 259/762] add gpiolib to support xlp_gpio driver

Based on Broadcom SDK 2.3.

Signed-off-by: henry shao <hshao@netlogicmicro.com>
Signed-off-by: Yanjiang Jin <yanjiang.jin@windriver.com>
---
 arch/mips/Kconfig                     |    3 +++
 arch/mips/include/asm/netlogic/gpio.h |    7 +++++++
 arch/mips/netlogic/xlp/Makefile       |    2 +-
 3 files changed, 11 insertions(+), 1 deletions(-)

diff --git a/arch/mips/Kconfig b/arch/mips/Kconfig
index c0ce0cc..46b05b6 100644
--- a/arch/mips/Kconfig
+++ b/arch/mips/Kconfig
@@ -1625,6 +1625,9 @@ config CPU_XLP
 	select WEAK_REORDERING_BEYOND_LLSC
 	select CPU_HAS_PREFETCH
 	select HAVE_EFFICIENT_UNALIGNED_ACCESS
+        select GENERIC_GPIO
+        select GPIO_SYSFS
+        select ARCH_REQUIRE_GPIOLIB
 	help
 	  Netlogic Microsystems XLP processors.
 endchoice
diff --git a/arch/mips/include/asm/netlogic/gpio.h b/arch/mips/include/asm/netlogic/gpio.h
index 40e63c0..33dce08 100644
--- a/arch/mips/include/asm/netlogic/gpio.h
+++ b/arch/mips/include/asm/netlogic/gpio.h
@@ -69,4 +69,11 @@ THE POSSIBILITY OF SUCH DAMAGE.
 #define NETLOGIC_GPIO_LED_OUTPUT_CODE_SOFT_RESET 0x03
 #define NETLOGIC_GPIO_LED_OUTPUT_CODE_MAIN 0x04
 
+#ifdef CONFIG_NLM_XLP
+#include <asm-generic/gpio.h>
+#define gpio_get_value __gpio_get_value
+#define gpio_set_value __gpio_set_value
+#define gpio_cansleep __gpio_cansleep
+#define gpio_to_irq(gpio) NULL
+#endif
 #endif
diff --git a/arch/mips/netlogic/xlp/Makefile b/arch/mips/netlogic/xlp/Makefile
index 50bbe4f..de03bde 100644
--- a/arch/mips/netlogic/xlp/Makefile
+++ b/arch/mips/netlogic/xlp/Makefile
@@ -3,7 +3,7 @@ EXTRA_CFLAGS := $(CFLAGS) -DNLM_HAL_LINUX_KERNEL -Iarch/mips/include/asm/netlogi
 
 obj-y                    	= setup.o nmi.o
 obj-y 				+= irq.o time.o on_chip.o mmu.o
-obj-$(CONFIG_NLM_XLP) 		+= platform.o board.o
+obj-$(CONFIG_NLM_XLP) 		+= platform.o board.o  xlp_gpio.o
 obj-$(CONFIG_SMP)       	+= smp.o
 
 obj-$(CONFIG_KGDB)      += nmi.o
-- 
1.7.0.4

