From 369745a27a2487adeee022cf7768a08392a196e4 Mon Sep 17 00:00:00 2001
From: henry shao <hshao@netlogicmicro.com>
Date: Sat, 19 Jun 2010 18:47:20 -0700
Subject: [PATCH 062/762] make cpu node aware when process ebase(5) register

Based on Broadcom SDK 2.3.

Signed-off-by: henry shao <hshao@netlogicmicro.com>
Signed-off-by: Yanjiang Jin <yanjiang.jin@windriver.com>
---
 arch/mips/netlogic/xlp/smpboot.S |    4 ++++
 1 files changed, 4 insertions(+), 0 deletions(-)

diff --git a/arch/mips/netlogic/xlp/smpboot.S b/arch/mips/netlogic/xlp/smpboot.S
index 78b9ec2..60673a8 100644
--- a/arch/mips/netlogic/xlp/smpboot.S
+++ b/arch/mips/netlogic/xlp/smpboot.S
@@ -48,7 +48,11 @@ NESTED(prom_pre_boot_secondary_cpus, 16, sp)
 	SET_MIPS64
 	MAPPED_KERNEL_SETUP_TLB
 	mfc0 t0, $15, 1 #read ebase
+	mfc0 t2, $15, 1 #read ebase
+	andi t2, 0x180 # get node id
+	srl  t2, 2
 	andi t0, 0x1f #t0 has the processor_id()
+	or   t0, t0, t2 #now t0 has node_id + process_id
 	PTR_LA	t1, xlr_stack_pages_temp
 	li   t2, _THREAD_SIZE
 	srl  t2, 2
-- 
1.7.0.4

