From 6d8ec500b4e38046160427a20aa776e7f5d99459 Mon Sep 17 00:00:00 2001
From: Yanjiang Jin <yanjiang.jin@windriver.com>
Date: Thu, 14 Nov 2013 11:17:52 +0800
Subject: [PATCH] bcm-xlp: make NAE MAC address to follow SMSC911X

For all XLP on-board Ethernet ports, include SMSC911X and NAE, Kernel
generates a series of continual MAC addresses according to the value
of U-BOOT parameter "ethaddr".
SMSC911X always occupies the first MAC address on XLP2XX/3XX, so make NAE MAC
addresses to follow it. Else system would get the duplicate MAC addresses on
SMSC911X and the first NAE port.

Signed-off-by: Yanjiang Jin <yanjiang.jin@windriver.com>
---
 drivers/net/nae/xlpge_board.c | 4 ++++
 1 file changed, 4 insertions(+)

diff --git a/drivers/net/nae/xlpge_board.c b/drivers/net/nae/xlpge_board.c
index 355d0aa..9e6e6a0 100644
--- a/drivers/net/nae/xlpge_board.c
+++ b/drivers/net/nae/xlpge_board.c
@@ -78,6 +78,10 @@ void gen_mac_address(void)
                 random_ether_addr(mac_base);
         }
 
+	/* SMSC911X occupies the first MAC address on XLP2XX/3XX */
+	if (is_nlm_xlp3xx() || is_nlm_xlp2xx())
+		mac_base[5] += 1;
+
 	for(i=0 ; i<NLM_MAX_NODES; i++){ /*poppulate the eth_hw_add array according to the get mac address*/
                 for(j=0;j<18;j++){
                         memcpy(eth_hw_addr[i][j], mac_base, 6);
-- 
1.8.4.93.g57e4c17

