From e6ca3c6c9d484dab386ae057e360c960443f3b3c Mon Sep 17 00:00:00 2001
From: Siva Pochiraju <sivap@netlogicmicro.com>
Date: Mon, 25 Oct 2010 20:39:28 -0700
Subject: [PATCH 219/762] Removed Duplicate types from libfdt_env.h and added HAL based FDT files to hal compilation

Based on Broadcom SDK 2.3.

Signed-off-by: Siva Pochiraju <sivap@netlogicmicro.com>
Signed-off-by: Yanjiang Jin <yanjiang.jin@windriver.com>
---
 arch/mips/netlogic/boot/libfdt_env.h |    7 +------
 arch/mips/netlogic/common/Makefile   |    2 +-
 arch/mips/netlogic/msgcfg/Makefile   |    2 ++
 arch/mips/netlogic/xlp/setup.c       |    1 +
 4 files changed, 5 insertions(+), 7 deletions(-)

diff --git a/arch/mips/netlogic/boot/libfdt_env.h b/arch/mips/netlogic/boot/libfdt_env.h
index 931d718..a8b29f6 100644
--- a/arch/mips/netlogic/boot/libfdt_env.h
+++ b/arch/mips/netlogic/boot/libfdt_env.h
@@ -1,14 +1,9 @@
 #ifndef _ARCH_MIPS_BOOT_LIBFDT_ENV_H
 #define _ARCH_MIPS_BOOT_LIBFDT_ENV_H
 
-#include <types.h>
+#include <linux/types.h>
 #include <string.h>
 
-typedef unsigned char uint8_t;
-typedef unsigned int uint32_t;
-typedef unsigned long long uint64_t;
-typedef unsigned long uintptr_t;
-
 #define _B(n)	((unsigned long long)((uint8_t *)&x)[n])
 static inline uint32_t fdt32_to_cpu(uint32_t x)
 {
diff --git a/arch/mips/netlogic/common/Makefile b/arch/mips/netlogic/common/Makefile
index 89d055d..dafba61 100644
--- a/arch/mips/netlogic/common/Makefile
+++ b/arch/mips/netlogic/common/Makefile
@@ -7,7 +7,7 @@ obj-$(CONFIG_NLM_XLR)			+= msgring_xls.o
 obj-$(CONFIG_NLM_XLR)			+= msgring_shared.o
 
 obj-$(CONFIG_NLM_XLP)			+= nlm_hal_fmn_config.o
-obj-$(CONFIG_NLM_XLP)			+= nlm_hal.o nlm_hal_nae.o
+obj-$(CONFIG_NLM_XLP)			+= nlm_hal.o nlm_hal_nae.o fdt_helper.o
 
 obj-$(CONFIG_RAPIDIO)             	+= srio.o
 obj-$(CONFIG_NLMCOMMON_IP_OVER_PCI) 	+= dma.o
diff --git a/arch/mips/netlogic/msgcfg/Makefile b/arch/mips/netlogic/msgcfg/Makefile
index 124d1ee..17066ac 100644
--- a/arch/mips/netlogic/msgcfg/Makefile
+++ b/arch/mips/netlogic/msgcfg/Makefile
@@ -23,9 +23,11 @@ shared_sources:
 ifneq ("$(HAL_DIR)", "")
 	$(Q) echo "***Caching NLM HAL code from $(HAL_DIR)***"
 	$(Q)cp -fr $(HAL_DIR)/*.h $(LOCAL_HAL_DIR)/
+	$(Q)cp -fr $(FDT_DIR)/libfdt/contrib/fdt_helper.h $(LOCAL_HAL_DIR)/
 	$(Q)cp -fr $(HAL_DIR)/nlm_hal.c  ../common
 	$(Q)cp -fr $(HAL_DIR)/nlm_hal_fmn_config.c  ../common
 	$(Q)cp -fr $(HAL_DIR)/nlm_hal_nae.c  ../common
+	$(Q)cp -fr $(FDT_DIR)/libfdt/contrib/fdt_helper.c  ../common
 endif
 
 ifneq ($(CONFIG_NLM_XLR), "")
diff --git a/arch/mips/netlogic/xlp/setup.c b/arch/mips/netlogic/xlp/setup.c
index ad9ecd5..2eb6f86 100644
--- a/arch/mips/netlogic/xlp/setup.c
+++ b/arch/mips/netlogic/xlp/setup.c
@@ -84,6 +84,7 @@
 extern char _end;
 extern void *fdt;
 
+EXPORT_SYMBOL(fdt);
 EXPORT_SYMBOL(dt_ops);
 
 extern void *fdt_init(void *blob);
-- 
1.7.0.4

