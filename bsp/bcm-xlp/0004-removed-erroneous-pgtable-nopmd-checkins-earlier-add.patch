From 07d9749d5230a0ec7726da1d63e779eb81715fc2 Mon Sep 17 00:00:00 2001
From: Venu Vadapalli <vvadapalli@netlogicmicro.com>
Date: Sun, 28 Feb 2010 13:00:48 -0800
Subject: [PATCH 004/762] removed erroneous pgtable-nopmd checkins earlier added to netl bsp to fix functional issues with 2.6.33 merge

Based on Broadcom SDK 2.3.

Signed-off-by: Venu Vadapalli <vvadapalli@netlogicmicro.com>
Signed-off-by: Yanjiang Jin <yanjiang.jin@windriver.com>
---
 arch/mips/kernel/asm-offsets.c |    6 ------
 arch/mips/rmi/ptr/setup.c      |    8 +++++---
 arch/mips/rmi/xlp/mmu.c        |    6 ------
 3 files changed, 5 insertions(+), 15 deletions(-)

diff --git a/arch/mips/kernel/asm-offsets.c b/arch/mips/kernel/asm-offsets.c
index 6e0589b..420565e 100644
--- a/arch/mips/kernel/asm-offsets.c
+++ b/arch/mips/kernel/asm-offsets.c
@@ -18,12 +18,6 @@
 #include <asm/ptrace.h>
 #include <asm/processor.h>
 
-#ifdef CONFIG_PAGE_SIZE_64KB
-#include <asm-generic/pgtable-nopmd.h>
-#else
-#include <asm-generic/pgtable-nopud.h>
-#endif
-
 void output_ptreg_defines(void)
 {
 	COMMENT("MIPS pt_regs offsets.");
diff --git a/arch/mips/rmi/ptr/setup.c b/arch/mips/rmi/ptr/setup.c
index 27f7076..e687735 100644
--- a/arch/mips/rmi/ptr/setup.c
+++ b/arch/mips/rmi/ptr/setup.c
@@ -1464,10 +1464,11 @@ void __init prom_init(void)
 		if(wakeup != 0x0) {
 			wakeup((void *)secondary_cpus_bootup_func, 0, (__u32)prom_info->rmi_cpu_online_map & (~smp_boot.online_map));
 #if defined(CONFIG_RMI_XLP_SIM)
-			unsigned int wait_count = 0;
+			{
+				unsigned int wait_count = 0;
 
-			while (smp_boot.online_map != prom_info->rmi_cpu_online_map) {
-				if ((wait_count++ % 1000000) == 0) {
+				while (smp_boot.online_map != prom_info->rmi_cpu_online_map) {
+					if ((wait_count++ % 1000000) == 0) {
 					printk("[%s%d]: Master cpu waiting for slave cpus to wakeup from bootloader (%x != %llx)\n",
 					       __FUNCTION__, __LINE__, smp_boot.online_map, 
 						   (unsigned long long) prom_info->rmi_cpu_online_map);
@@ -1475,6 +1476,7 @@ void __init prom_init(void)
 			}
 			printk("[%s@%d]: woke up prom_info->rmi_cpu_online_map=%016llx\n", __FILE__, __LINE__, 
 				   (unsigned long long) prom_info->rmi_cpu_online_map);
+			}
 #endif
 		}
 	}
diff --git a/arch/mips/rmi/xlp/mmu.c b/arch/mips/rmi/xlp/mmu.c
index 8fe6408..8812b34 100644
--- a/arch/mips/rmi/xlp/mmu.c
+++ b/arch/mips/rmi/xlp/mmu.c
@@ -6,12 +6,6 @@
 #include <asm/page.h>
 #include <asm/pgtable.h>
 
-#ifdef CONFIG_PAGE_SIZE_64KB
-#include <asm-generic/pgtable-nopmd.h>
-#else
-#include <asm-generic/pgtable-nopud.h>
-#endif
-
 #define READ_INHIBIT (1 << 31)
 #define EXEC_INHIBIT (1 << 30)
 
-- 
1.7.0.4

