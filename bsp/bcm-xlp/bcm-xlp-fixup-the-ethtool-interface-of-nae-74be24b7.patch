From acf8927d75dc6678a3215f60e6a3747f45f172e7 Mon Sep 17 00:00:00 2001
From: Jack Tan <jiankemeng@gmail.com>
Date: Thu, 17 Jul 2014 18:04:11 +0800
Subject: [PATCH] bcm-xlp: fixup the ethtool interface of nae

update the get_link function

Signed-off-by: Jack Tan <jack.tan@windriver.com>
---
 drivers/netlogic/nae/xlpge_ethtool.c |   13 +++++++------
 1 files changed, 7 insertions(+), 6 deletions(-)

diff --git a/drivers/netlogic/nae/xlpge_ethtool.c b/drivers/netlogic/nae/xlpge_ethtool.c
index 3ed091b..b3c9baa 100644
--- a/drivers/netlogic/nae/xlpge_ethtool.c
+++ b/drivers/netlogic/nae/xlpge_ethtool.c
@@ -291,18 +291,19 @@ static int xlp_nway_reset(struct net_device *dev)
 static u32 xlp_get_link(struct net_device *dev)
 {
 	struct dev_data *priv = netdev_priv(dev);
-	struct nlm_hal_mii_info mii_info;
+	net_port_t* nae_port = priv->nae_port;
+
 	ulong flags;
-	if (priv->type != SGMII_IF)
-		return -EIO;
 
+	uint32_t duplex, speed;	
 	spin_lock_irqsave(&priv->lock, flags);
-	//nlm_hal_status_ext_phy( priv->node, priv->phy.addr, &mii_info);
+
+	netsoc_get_phy_status(nae_port, &duplex, &speed);
 
 	spin_unlock_irqrestore(&priv->lock, flags);
 
-	if(mii_info.link_stat==1)
-                return 1;
+        if(nae_port->link_stat==1)        
+		return 1;
 
 	return 0;
 }
-- 
1.7.5.4

