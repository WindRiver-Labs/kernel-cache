From 5fedf8944eebf81cf3cced35c696b169a56c1f54 Mon Sep 17 00:00:00 2001
From: Ashok Kumar <ashoks@broadcom.com>
Date: Mon, 17 Mar 2014 00:33:08 -0700
Subject: [PATCH] kvm: restore hi/lo registers properly.

Commit 14462eb6e3b3d902d9350f884319e661fca7d995 from Broadcom SDK 3.0.2

lo register is not restored properly when
hypervisor resumes guest execution after guest's request for
hypervisor service is done.

Signed-off-by: Ashok Kumar <ashoks@broadcom.com>
Signed-off-by: Nam Ninh <nam.ninh@windriver.com>

diff --git a/arch/mips/kvm/context_switch.S b/arch/mips/kvm/context_switch.S
index 1b4958b..ceb683b 100644
--- a/arch/mips/kvm/context_switch.S
+++ b/arch/mips/kvm/context_switch.S
@@ -305,7 +305,7 @@ FEXPORT(__kvm_vcpu_run_guest)
 	LONG_L 	$31, VCPU_G_R31(sp)
 	LONG_L 	k0,  VCPU_G_HI(sp)
 	mthi 	k0
-	LONG_L 	k0,  VCPU_G_HI(sp)
+	LONG_L 	k0,  VCPU_G_LO(sp)
 	mtlo 	k0
 
 	LONG_L 	$26, VCPU_G_R26(sp)
-- 
1.9.1

