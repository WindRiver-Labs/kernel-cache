From 4c8dbe817595d8bb32dc47180b29eceb863300da Mon Sep 17 00:00:00 2001
From: Prasad Boddupalli <pboddupalli@netlogicmicro.com>
Date: Tue, 29 Jun 2010 12:45:13 -0700
Subject: [PATCH 047/761] Changes required by userspace domain control tools
 to launch domains

The changes were made by Anu to get domain control tools working. Some
of the changes are temporary in nature till functionality such as
grant tables are implemented in Xen hypervisor

Based on Broadcom SDK 2.3.

Signed-off-by: Prasad Boddupalli <pboddupalli@netlogicmicro.com>
Signed-off-by: Yanjiang Jin <yanjiang.jin@windriver.com>
---
 arch/mips/xen/enlighten.c         |    2 +-
 drivers/xen/xenbus/xenbus_probe.c |    2 ++
 2 files changed, 3 insertions(+), 1 deletion(-)

diff --git a/arch/mips/xen/enlighten.c b/arch/mips/xen/enlighten.c
index 9fda1eb..3a7f68a 100644
--- a/arch/mips/xen/enlighten.c
+++ b/arch/mips/xen/enlighten.c
@@ -54,7 +54,7 @@ EXPORT_SYMBOL_GPL(hypercall_page);
 DEFINE_PER_CPU(struct vcpu_info *, xen_vcpu);
 DEFINE_PER_CPU(struct vcpu_info, xen_vcpu_info);
 
-enum xen_domain_type xen_domain_type = XEN_NATIVE;
+enum xen_domain_type xen_domain_type = XEN_PV_DOMAIN;
 EXPORT_SYMBOL_GPL(xen_domain_type);
 
 /* unsigned long *machine_to_phys_mapping = (void *)MACH2PHYS_VIRT_START; */
diff --git a/drivers/xen/xenbus/xenbus_probe.c b/drivers/xen/xenbus/xenbus_probe.c
index b793723..d7f2b62 100644
--- a/drivers/xen/xenbus/xenbus_probe.c
+++ b/drivers/xen/xenbus/xenbus_probe.c
@@ -188,6 +188,7 @@ void xenbus_otherend_changed(struct xenbus_watch *watch,
 		state, xenbus_strstate(state), dev->otherend_watch.node,
 		vec[XS_WATCH_PATH]);
 
+#ifdef NETL_USE_X86_PORT
 	/*
 	 * Ignore xenbus transitions during shutdown. This prevents us doing
 	 * work that can fail e.g., when the rootfs is gone.
@@ -240,6 +241,7 @@ int xenbus_dev_probe(struct device *_dev)
 		       dev->nodename);
 		return err;
 	}
+#endif
 
 	return 0;
 fail:
-- 
1.7.10.4

