From a78ca397cfac6cc91c52008e6f2d9ab08d30a89c Mon Sep 17 00:00:00 2001
From: henry shao <hshao@netlogicmicro.com>
Date: Sat, 28 Aug 2010 05:19:24 -0700
Subject: [PATCH 158/761] fix ipi value

Based on Broadcom SDK 2.3.

Signed-off-by: henry shao <hshao@netlogicmicro.com>
Signed-off-by: Yanjiang Jin <yanjiang.jin@windriver.com>
---
 arch/mips/netlogic/xlp/smp.c |    9 ++++-----
 1 file changed, 4 insertions(+), 5 deletions(-)

diff --git a/arch/mips/netlogic/xlp/smp.c b/arch/mips/netlogic/xlp/smp.c
index d003263..9685191 100644
--- a/arch/mips/netlogic/xlp/smp.c
+++ b/arch/mips/netlogic/xlp/smp.c
@@ -67,9 +67,7 @@ void nlm_send_ipi_single(int cpu, unsigned int action)
 {
 printk("[%s] cpu: %d\n",__func__,  cpu);
         __u32 node = cpu / 32;
-        __u32 tid = cpu & 0x3;
-        __u32 pid = (cpu >> 2) & 0x07;
-        __u32 ipi = (tid << 16) | (pid << 20);
+        __u32 ipi = 0;
 
         if (action & SMP_CALL_FUNCTION) {
                 ipi |= IRQ_IPI_SMP_FUNCTION;
@@ -80,8 +78,9 @@ printk("[%s] cpu: %d\n",__func__,  cpu);
 	} else if (action & SMP_OPROFILE_IPI) {
                 ipi |= IRQ_IPI_OPROFILE;
         } else
-                BUG();
-        nlm_hal_pic_send_ipi(0, (ipi & 0x3f), node , cpu);
+		return;
+
+        nlm_hal_pic_send_ipi(0, (ipi & 0x3f), node, cpu);
 }
 
 void nlm_send_ipi_mask(const struct cpumask * mask, unsigned int action)
-- 
1.7.10.4

