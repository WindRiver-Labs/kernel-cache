From 39d6b77cd902be04b2b872b23c8dfcda609665dd Mon Sep 17 00:00:00 2001
From: Yonghong Song <ysong@broadcom.com>
Date: Fri, 22 Jun 2012 14:26:03 -0700
Subject: [PATCH 566/761] errata: add "ehb" as the first instruction of NMI
 exception handler

   o This is to work around the hardware issue for an interrupt occurring
     after a branch-likely instruction has executed but before its
     delay-slot has.

Based on Broadcom SDK 2.3.

Signed-off-by: Yonghong Song <ysong@broadcom.com>
Signed-off-by: Yanjiang Jin <yanjiang.jin@windriver.com>
---
 arch/mips/netlogic/xlp/nmi.S |    1 +
 1 file changed, 1 insertion(+)

diff --git a/arch/mips/netlogic/xlp/nmi.S b/arch/mips/netlogic/xlp/nmi.S
index e539a12..e3c75b5 100644
--- a/arch/mips/netlogic/xlp/nmi.S
+++ b/arch/mips/netlogic/xlp/nmi.S
@@ -45,6 +45,7 @@ NESTED(nlm_except_vec_nmi, 0, sp)
 	.set noat
 	.set mips64
 	.set noreorder
+	sll 	zero, 3              # ehb
 #ifdef CONFIG_KGDB
 	MTC0	k0, OS_KGDB_SCRATCH_REG6
 	nop
-- 
1.7.10.4

