From 54f5e1a4b65f336a10b80a022f04fdafac690fd0 Mon Sep 17 00:00:00 2001
From: Jayanthi Annadurai <jayanthia@netlogicmicro.com>
Date: Wed, 23 Mar 2011 21:05:30 -0700
Subject: [PATCH 243/762] COP2 is enabled in config file.

Based on Broadcom SDK 2.3.

Signed-off-by: Jayanthi Annadurai <jayanthia@netlogicmicro.com>
Signed-off-by: Yanjiang Jin <yanjiang.jin@windriver.com>
---
 arch/mips/include/asm/netlogic/msgring.h |   22 ++++++++++++++++++++--
 1 files changed, 20 insertions(+), 2 deletions(-)

diff --git a/arch/mips/include/asm/netlogic/msgring.h b/arch/mips/include/asm/netlogic/msgring.h
index a588c77..cd0d775 100644
--- a/arch/mips/include/asm/netlogic/msgring.h
+++ b/arch/mips/include/asm/netlogic/msgring.h
@@ -392,6 +392,13 @@ static inline void msgrng_wait(unsigned int mask)
 		    );
 }
 
+#ifdef CONFIG_NLM_ENABLE_COP2
+
+#define msgrng_enable(flags) 
+#define msgrng_disable(flags) 
+
+#else
+
 #define msgrng_enable(flags)                \
 do {                                        \
   preempt_disable(); \
@@ -412,10 +419,11 @@ do {                                        \
 		    );                              \
   preempt_enable(); \
 } while (0)
-
 #define msgrng_disable(flags) __asm__ volatile (    \
                  "mtc0 %0, $12" : : "r" (flags))
 
+#endif
+
 #define msgrng_flags_save(flags) msgrng_enable(flags)
 #define msgrng_flags_restore(flags) msgrng_disable(flags)
 
@@ -598,6 +606,15 @@ extern struct stn_cc shared_cc_table_cpu_7;
 extern struct stn_cc shared_cc_table_gmac;
 extern struct stn_cc shared_cc_table_dma;
 
+#ifdef CONFIG_NLM_ENABLE_COP2
+
+#define msgrng_access_save(lock, iflags, mflags)
+#define msgrng_access_restore(lock, iflags, mflags)
+
+#define msgrng_access_enable(mflags) 
+#define msgrng_access_disable(mflags) 
+
+#else
 
 #define msgrng_access_save(lock, iflags, mflags) do {        \
   spin_lock_irqsave(lock, iflags);                           \
@@ -613,12 +630,13 @@ extern struct stn_cc shared_cc_table_dma;
   preempt_disable();                        \
   msgrng_flags_save(mflags);                \
 } while(0)
-
 #define msgrng_access_disable(mflags) do {   \
   msgrng_flags_restore(mflags);              \
   preempt_enable();                          \
 } while(0)
 
+#endif
+
 enum {
   TX_STN_CPU_0,
   TX_STN_CPU_1,
-- 
1.7.0.4

