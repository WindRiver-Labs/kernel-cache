From 4a0706ca4a7931ad78ae7b255a41a2384aa2a1db Mon Sep 17 00:00:00 2001
From: henry shao <hshao@netlogicmicro.com>
Date: Tue, 14 Dec 2010 11:14:56 -0800
Subject: [PATCH 236/762] make changes to support i2c-xlp driver and rtc-ds1374 rtc driver and max6657 driver

Based on Broadcom SDK 2.3.

Signed-off-by: henry shao <hshao@netlogicmicro.com>
Signed-off-by: Yanjiang Jin <yanjiang.jin@windriver.com>
---
 arch/mips/netlogic/xlp/Makefile   |    2 +-
 arch/mips/netlogic/xlp/platform.c |    5 ++---
 drivers/i2c/busses/Kconfig        |   10 ++++++++++
 drivers/i2c/busses/Makefile       |    4 ++++
 4 files changed, 17 insertions(+), 4 deletions(-)

diff --git a/arch/mips/netlogic/xlp/Makefile b/arch/mips/netlogic/xlp/Makefile
index 4c66980..50bbe4f 100644
--- a/arch/mips/netlogic/xlp/Makefile
+++ b/arch/mips/netlogic/xlp/Makefile
@@ -3,7 +3,7 @@ EXTRA_CFLAGS := $(CFLAGS) -DNLM_HAL_LINUX_KERNEL -Iarch/mips/include/asm/netlogi
 
 obj-y                    	= setup.o nmi.o
 obj-y 				+= irq.o time.o on_chip.o mmu.o
-obj-$(CONFIG_NLM_XLP) 		+= platform.o
+obj-$(CONFIG_NLM_XLP) 		+= platform.o board.o
 obj-$(CONFIG_SMP)       	+= smp.o
 
 obj-$(CONFIG_KGDB)      += nmi.o
diff --git a/arch/mips/netlogic/xlp/platform.c b/arch/mips/netlogic/xlp/platform.c
index 3e1f4b9..f804a64 100644
--- a/arch/mips/netlogic/xlp/platform.c
+++ b/arch/mips/netlogic/xlp/platform.c
@@ -133,8 +133,8 @@ static void xlp_usb_hw_start(int ctrl_no)
 
 struct dev2drv dev2drv_table[MAX_DEV2DRV] = {
 	{XLP_DEVID_UART, "serial8250",	11,	0,	PLAT_DRV},
-	{XLP_DEVID_I2C,	 "i2c-xlp",		8,	0, 	PLAT_DRV},
-	{0x0, 			 "",			0,	0,	PLAT_DRV},
+	{XLP_DEVID_I2C,	 "i2c-xlp",	8,	0, 	PLAT_DRV},
+	{0x0, 			 "",	0,	0,	PLAT_DRV},
 };
 
 static int get_dev2drv(uint32_t x) 
@@ -240,7 +240,6 @@ static int xlp_find_pci_dev(void)
 	kfree(pres);
 	return 0;	
 }
-
 static int __init platform_devinit(void)
 {
 	xlp_find_pci_dev();
diff --git a/drivers/i2c/busses/Kconfig b/drivers/i2c/busses/Kconfig
index 33ac4e7..84f5bb6 100644
--- a/drivers/i2c/busses/Kconfig
+++ b/drivers/i2c/busses/Kconfig
@@ -932,5 +932,15 @@ config SCx200_ACB
 
 	  This support is also available as a module.  If so, the module
 	  will be called scx200_acb.
+config I2C_NLM_XLP
+	tristate "Netlogic XLP SMBus interface"
+	depends on NLM_XLP
+	help
+	  If you say yes to this option, support will be included for the
+	  Netlogic XLP SMBus interface.
+
+	  This driver can also be built as a module.  If so, the module
+	  will be called i2c-xlp.
+
 
 endmenu
diff --git a/drivers/i2c/busses/Makefile b/drivers/i2c/busses/Makefile
index 16ccde9..0a6c709 100644
--- a/drivers/i2c/busses/Makefile
+++ b/drivers/i2c/busses/Makefile
@@ -1,6 +1,9 @@
 #
 # Makefile for the i2c bus drivers.
 #
+ifeq ($(CONFIG_NLM_XLP),y)
+EXTRA_CFLAGS := $(CFLAGS) -DNLM_HAL_LINUX_KERNEL
+endif
 
 # ACPI drivers
 obj-$(CONFIG_I2C_SCMI)		+= i2c-scmi.o
@@ -70,6 +73,7 @@ obj-$(CONFIG_I2C_SIRF)		+= i2c-sirf.o
 obj-$(CONFIG_I2C_STU300)	+= i2c-stu300.o
 obj-$(CONFIG_I2C_TEGRA)		+= i2c-tegra.o
 obj-$(CONFIG_I2C_VERSATILE)	+= i2c-versatile.o
+obj-$(CONFIG_I2C_NLM_XLP)	+= i2c-xlp.o
 obj-$(CONFIG_I2C_OCTEON)	+= i2c-octeon.o
 obj-$(CONFIG_I2C_XILINX)	+= i2c-xiic.o
 obj-$(CONFIG_I2C_XLR)		+= i2c-xlr.o
-- 
1.7.0.4

