From 39f27761f74858c1414cd3fd802f59cc3ee091f4 Mon Sep 17 00:00:00 2001
From: Zi Shen Lim <zlim@netlogicmicro.com>
Date: Mon, 16 Jan 2012 18:26:14 -0800
Subject: [PATCH 518/762] cleanup

Based on Broadcom SDK 2.3.

Signed-off-by: Zi Shen Lim <zlim@netlogicmicro.com>
Signed-off-by: Yanjiang Jin <yanjiang.jin@windriver.com>
---
 arch/mips/include/asm/stackframe.h |    8 +++-----
 1 files changed, 3 insertions(+), 5 deletions(-)

diff --git a/arch/mips/include/asm/stackframe.h b/arch/mips/include/asm/stackframe.h
index e62f346..236148c 100644
--- a/arch/mips/include/asm/stackframe.h
+++ b/arch/mips/include/asm/stackframe.h
@@ -217,7 +217,6 @@
 		LONG_S	v1, PT_EPC(sp)
 		ori	$28, sp, _THREAD_MASK
 		xori	$28, _THREAD_MASK
-
 #ifdef CONFIG_NLM_ENABLE_COP2
 		.set    mips64
 		dla k0, nlm_cop2_save
@@ -226,7 +225,6 @@
 		LONG_L  ra, PT_R31(sp)
 		LONG_L	k0, PT_R29(sp)
 #endif
-
 #ifdef CONFIG_CPU_CAVIUM_OCTEON
 		.set    mips64
 		pref    0, 0($28)       /* Prefetch the current pointer */
@@ -378,14 +376,14 @@
 		ori	a0, STATMASK
 		xori	a0, STATMASK
 		mtc0	a0, CP0_STATUS
-
 #ifdef CONFIG_NLM_ENABLE_COP2
 		dla v1, nlm_cop2_restore
 		jalr v1
 		nop
-#endif
-
 		li	v1, 0x4000ff00
+#else
+		li	v1, 0xff00
+#endif
 		and	a0, v1
 		LONG_L	v0, PT_STATUS(sp)
 		nor	v1, $0, v1
-- 
1.7.0.4

