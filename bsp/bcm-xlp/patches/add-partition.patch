From 27c61505bbb4c1b5816630ba24d5ba1fb6a15ac4 Mon Sep 17 00:00:00 2001
From: henry shao <hshao@netlogicmicro.com>
Date: Thu, 21 Apr 2011 19:47:00 -0700
Subject: [PATCH 209/565] add partition

Add partition to satisfy user space mtd operation

Based on Broadcom SDK 2.3.

Signed-off-by: henry shao <hshao@netlogicmicro.com>
Signed-off-by: Yanjiang Jin <yanjiang.jin@windriver.com>
---
 drivers/mtd/devices/m25p80.c | 12 ++++++++++++
 1 file changed, 12 insertions(+)

diff --git a/drivers/mtd/devices/m25p80.c b/drivers/mtd/devices/m25p80.c
index e7bb2fa..8cbcf4a 100644
--- a/drivers/mtd/devices/m25p80.c
+++ b/drivers/mtd/devices/m25p80.c
@@ -925,6 +925,13 @@ static const struct spi_device_id *jedec_probe(struct spi_device *spi)
 }
 
 #ifdef CONFIG_NLM_XLP
+static struct mtd_partition xlp_spi_parti[] = {
+        {
+                .name = "SPI NOR FLASH",
+                .offset = 0x00000000,
+                .size = MTDPART_SIZ_FULL,
+        }
+};
 static void m25p_test(struct m25p * flash)
 {
 	int i, xfer_len;
@@ -1150,6 +1157,11 @@ static int m25p_probe(struct spi_device *spi)
 	/* partitions should match sector boundaries; and it may be good to
 	 * use readonly partitions for writeprotected sectors (BP2..BP0).
 	 */
+#ifdef CONFIG_NLM_XLP
+	if (data == NULL)
+		return mtd_device_parse_register(&flash->mtd, NULL, &ppdata,
+				xlp_spi_parti, ARRAY_SIZE(xlp_spi_parti));
+#endif
 	return mtd_device_parse_register(&flash->mtd, NULL, &ppdata,
 			data ? data->parts : NULL,
 			data ? data->nr_parts : 0);
-- 
1.8.4.93.g57e4c17

