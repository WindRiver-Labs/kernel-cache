From 0f9bc1edd7a4dbd6cdcf52a61ccc89d6c58dea32 Mon Sep 17 00:00:00 2001
From: Yanjiang Jin <yanjiang.jin@windriver.com>
Date: Thu, 25 Apr 2013 14:38:18 +0800
Subject: [PATCH 490/565] bcm_xlp: add interrupt statistic of FMN

Add interrupt statistic of FMN.

Based on Broadcom SDK 2.3.

Signed-off-by: Yanjiang Jin <yanjiang.jin@windriver.com>
---
 arch/mips/netlogic/xlp/irq.c | 4 ++++
 1 file changed, 4 insertions(+)

diff --git a/arch/mips/netlogic/xlp/irq.c b/arch/mips/netlogic/xlp/irq.c
index c53dd6c..18c9c8e 100644
--- a/arch/mips/netlogic/xlp/irq.c
+++ b/arch/mips/netlogic/xlp/irq.c
@@ -28,6 +28,7 @@
  * #BRCM_2# */
 
 #include <linux/kernel.h>
+#include <linux/kernel_stat.h>
 #include <linux/init.h>
 #include <linux/linkage.h>
 #include <linux/interrupt.h>
@@ -408,6 +409,7 @@ asmlinkage void plat_irq_dispatch(void)
 	struct pt_regs *pt_regs = current_thread_info()->regs;
 	int rvec = 0, idx = 0, base_irq;
 	struct pic_dev *pic;
+	int lirq;
 #ifdef CONFIG_PCI_MSI
 	int fn;
 #endif
@@ -447,6 +449,8 @@ asmlinkage void plat_irq_dispatch(void)
 	if (rvec < XLP_IRQ_RESERVED_MAX) {
 		if (rvec == XLP_IRQ_MSGRING_RVEC) {
 			nlm_xlp_msgring_int_handler(rvec, pt_regs);
+			lirq = rvec % XLP_IRQS_PER_NODE;
+			kstat_incr_irqs_this_cpu(lirq, irq_to_desc(lirq));
 		} else if ((rvec == XLP_IRQ_IPI_SMP_FUNCTION_RVEC) ||
 				(rvec == XLP_IRQ_IPI_SMP_RESCHEDULE_RVEC) ||
 				(rvec == XLP_IRQ_IPI_SMP_KGDB_RVEC)) {
-- 
1.8.4.93.g57e4c17

