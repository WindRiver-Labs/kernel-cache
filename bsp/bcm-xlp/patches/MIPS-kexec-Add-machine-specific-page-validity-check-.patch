From af11c288f584f69255569ad1442eb2c08b0b60fd Mon Sep 17 00:00:00 2001
From: Benjamin Walsh <benjamin.walsh@windriver.com>
Date: Thu, 27 May 2010 17:38:10 -0400
Subject: [PATCH 546/565] MIPS/kexec: Add machine-specific page validity check
 in vmcore

Some systems need to verify the validity of pages referenced by
vmcore when accessing them, some do not. By default, the check
returns all pages valid. Systems that need a different implementation
can install their own.

Signed-off-by: Benjamin Walsh <benjamin.walsh@windriver.com>
Signed-off-by: Guojian Zhou <guojian.zhou@windriver.com>
---
 arch/mips/kernel/crash_dump.c | 8 ++++++++
 1 file changed, 8 insertions(+)

diff --git a/arch/mips/kernel/crash_dump.c b/arch/mips/kernel/crash_dump.c
index 88eb12d..0c70679 100644
--- a/arch/mips/kernel/crash_dump.c
+++ b/arch/mips/kernel/crash_dump.c
@@ -16,6 +16,14 @@ __setup("savemaxmem=", parse_savemaxmem);
 
 static void *kdump_buf_page;
 
+static int default_machine_check_pfn_validity(unsigned long pfn)
+{
+	return 1;
+}
+/* Do NOT set this to NULL */
+int (*_machine_check_pfn_validity)(unsigned long pfn) =
+	default_machine_check_pfn_validity;
+
 /**
  * copy_oldmem_page - copy one page from "oldmem"
  * @pfn: page frame number to be copied
-- 
1.8.4.93.g57e4c17

