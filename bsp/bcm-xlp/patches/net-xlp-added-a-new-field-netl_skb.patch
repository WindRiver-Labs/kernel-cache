From c65d813ecd6271ad3146788bf76f113b2a027438 Mon Sep 17 00:00:00 2001
From: Mehul <vmehul@netlogicmicro.com>
Date: Fri, 2 Dec 2011 18:30:11 +0530
Subject: [PATCH 308/565] net: xlp: added a new field 'netl_skb'

This will be used by nae-perf driver to decide to perform hardware
replenishment or not.

Based on Broadcom SDK 2.3.

Signed-off-by: Mehul <vmehul@netlogicmicro.com>
Signed-off-by: Yanjiang Jin <yanjiang.jin@windriver.com>
---
 net/core/skbuff.c | 9 +++++++++
 1 file changed, 9 insertions(+)

diff --git a/net/core/skbuff.c b/net/core/skbuff.c
index d3fc483..7d59b6c 100644
--- a/net/core/skbuff.c
+++ b/net/core/skbuff.c
@@ -275,6 +275,9 @@ struct sk_buff *__alloc_skb(unsigned int size, gfp_t gfp_mask,
 	skb->data = data;
 	skb_reset_tail_pointer(skb);
 	skb->end = skb->tail + size;
+#ifdef CONFIG_NLM_NET_OPTS
+	skb->netl_skb = NULL;
+#endif
 #ifdef NET_SKBUFF_DATA_USES_OFFSET
 	skb->mac_header = ~0U;
 	skb->transport_header = ~0U;
@@ -297,6 +300,9 @@ struct sk_buff *__alloc_skb(unsigned int size, gfp_t gfp_mask,
 
 		child->fclone = SKB_FCLONE_UNAVAILABLE;
 		child->pfmemalloc = pfmemalloc;
+#ifdef CONFIG_NLM_NET_OPTS
+		child->netl_skb = NULL;
+#endif
 	}
 out:
 	return skb;
@@ -715,6 +721,9 @@ static void __copy_skb_header(struct sk_buff *new, const struct sk_buff *old)
 #ifdef CONFIG_XFRM
 	new->sp			= secpath_get(old->sp);
 #endif
+#ifdef CONFIG_NLM_NET_OPTS
+	new->netl_skb = NULL;
+#endif
 	memcpy(new->cb, old->cb, sizeof(old->cb));
 	new->csum		= old->csum;
 	new->local_df		= old->local_df;
-- 
1.8.4.93.g57e4c17

