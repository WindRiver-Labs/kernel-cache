From 56ac9f4e382136492565acf68d05a9b1723a5da2 Mon Sep 17 00:00:00 2001
From: Anurag <anurag.gopinath@broadcom.com>
Date: Wed, 4 Jul 2012 19:11:55 +0530
Subject: [PATCH 378/565] numa : read_node_bars to use HAL functions

read_node_bars to use HAL functions to read/write

Based on Broadcom SDK 2.3.

Signed-off-by: Anurag <anurag.gopinath@broadcom.com>
Signed-off-by: Yanjiang Jin <yanjiang.jin@windriver.com>
---
 arch/mips/netlogic/xlp/setup.c | 12 +++++-------
 1 file changed, 5 insertions(+), 7 deletions(-)

diff --git a/arch/mips/netlogic/xlp/setup.c b/arch/mips/netlogic/xlp/setup.c
index 2a69499..a572185 100644
--- a/arch/mips/netlogic/xlp/setup.c
+++ b/arch/mips/netlogic/xlp/setup.c
@@ -185,8 +185,6 @@ struct xlp_dram_mapping  dram_map[NLM_NODES_MAX_DRAM_REGION];
 #define NLM_DRAM_NODEADDR_XLAT  36 
 #define HDR_OFFSET      0x100      
 #define BRIDGE  (0x00<<20) | (0x00<<15) | (0x00<<12)        
-#define cpu_io_mmio_setup(node,offset)  ((__u32 *)(DEFAULT_NETLOGIC_IO_BASE + \
-                         (node<<18) + (offset) + HDR_OFFSET))    
 
 int nlm_common_get_pgprot(unsigned long address)
 {
@@ -229,13 +227,13 @@ int valid_mmap_nlm_common_addr_range(unsigned long pfn)
 void read_node_bars(int node)    
 {         
         int i, idx;
-        uint32_t *membase = cpu_io_mmio_setup(node, BRIDGE);      
+        uint32_t *membase = cpu_io_mmio(node, BRIDGE);      
           
         for (i = 0; i < NLM_MAX_DRAM_REGION; i++) {
-                uint64_t base_reg  = *(membase + NLM_DRAM_BASE_REG_0  + i); 
-                uint64_t limit_reg = *(membase + NLM_DRAM_LIMIT_REG_0 + i); 
-                uint32_t node_reg = *(membase + NLM_DRAM_NODEADDR_XLAT + i);
-          
+                uint64_t base_reg  = nlm_hal_read_32bit_reg((uint64_t)membase, NLM_DRAM_BASE_REG_0 + i);
+                uint64_t limit_reg = nlm_hal_read_32bit_reg((uint64_t)membase, NLM_DRAM_LIMIT_REG_0 + i);
+                uint32_t node_reg =  nlm_hal_read_32bit_reg((uint64_t)membase, NLM_DRAM_NODEADDR_XLAT + i);
+
                 if(((node_reg >> 1) & 0x3) != node) {       
                         continue;  
                 }  
-- 
1.8.4.93.g57e4c17

