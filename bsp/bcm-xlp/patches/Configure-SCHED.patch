From b3a1cf49daea8696ddcb9909450db8c41d9bcd16 Mon Sep 17 00:00:00 2001
From: Siva Pochiraju <sivap@netlogicmicro.com>
Date: Tue, 26 Oct 2010 22:46:30 -0700
Subject: [PATCH 167/565] Configure SCHED

Configure SCHED (BRU skipping ALU ops).

Based on Broadcom SDK 2.3.

Signed-off-by: Siva Pochiraju <sivap@netlogicmicro.com>
Signed-off-by: Yanjiang Jin <yanjiang.jin@windriver.com>
---
 arch/mips/netlogic/xlp/cpu_control.c     | 3 +++
 arch/mips/netlogic/xlp/cpu_control_asm.S | 5 +++++
 2 files changed, 8 insertions(+)

diff --git a/arch/mips/netlogic/xlp/cpu_control.c b/arch/mips/netlogic/xlp/cpu_control.c
index c855a08..1fd9090 100644
--- a/arch/mips/netlogic/xlp/cpu_control.c
+++ b/arch/mips/netlogic/xlp/cpu_control.c
@@ -84,6 +84,9 @@ static inline void config_lsu(void)
 		"li	 %2, ~0xe\n"
 		"and	 %1, %1, %2\n"
 		"mtcr    %1, %0\n"
+		"li      %0, "STR(SCHED_DEFEATURE)"\n"
+		"lui     %1, 0x0100\n"
+		"mtcr    %1, %0\n"
 		".set pop\n"
 		: "=r" (tmp0), "=r" (tmp1), "=r" (tmp2)
 	);
diff --git a/arch/mips/netlogic/xlp/cpu_control_asm.S b/arch/mips/netlogic/xlp/cpu_control_asm.S
index 6385c8f..12fce72 100644
--- a/arch/mips/netlogic/xlp/cpu_control_asm.S
+++ b/arch/mips/netlogic/xlp/cpu_control_asm.S
@@ -74,6 +74,11 @@
 	and	t1, t1, t2
 
 	mtcr    t1, t0
+	
+	li      t0, LSU_DEFEATURE
+	lui     t1, 0x0100 # Experimental: Disable BRU accepting ALU ops
+	mtcr    t1, t0
+	
 	.set pop
 .endm
 
-- 
1.8.4.93.g57e4c17

