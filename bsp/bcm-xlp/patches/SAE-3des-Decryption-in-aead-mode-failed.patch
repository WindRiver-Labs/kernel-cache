From a4cbd76fdfca2e7ff353f9f38e3c1f16a288bd02 Mon Sep 17 00:00:00 2001
From: reshmic <reshmic@broadcom.com>
Date: Fri, 14 Dec 2012 09:55:15 +0530
Subject: [PATCH 528/565] SAE: 3des Decryption in aead mode failed

Fix by passing the original key as the key swap now takes place in
nlm_crypto_fill_pkt_ctrl.

Based on Broadcom SDK 2.3.

Signed-off-by: reshmic <reshmic@broadcom.com>
Signed-off-by: Yanjiang Jin <yanjiang.jin@windriver.com>
---
 drivers/crypto/sae/nlm_aead.c | 3 +--
 1 file changed, 1 insertion(+), 2 deletions(-)

diff --git a/drivers/crypto/sae/nlm_aead.c b/drivers/crypto/sae/nlm_aead.c
index c90566f..a5a29ea 100755
--- a/drivers/crypto/sae/nlm_aead.c
+++ b/drivers/crypto/sae/nlm_aead.c
@@ -386,7 +386,6 @@ static int  xlp_3des_setkey(struct crypto_aead *tfm, u8 *key, unsigned int keyle
 	struct nlm_crypto_pkt_ctrl *ctrl = &ctx->ctrl;
         int ret;
 	uint8_t auth_key[128];
-	uint64_t d_key[3] ;
 	int cipher_alg = NLM_CIPHER_3DES;
 	struct rtattr *rta = (struct rtattr *)key;
 	uint8_t *cipher_key;
@@ -417,7 +416,7 @@ static int  xlp_3des_setkey(struct crypto_aead *tfm, u8 *key, unsigned int keyle
 	
 	nlm_ctx->stat = TDES_CBC_STAT | h_stat << 8;;
 	ret =  nlm_crypto_fill_pkt_ctrl(&nlm_ctx->ctrl, hmac, hash,
-			mode, cipher_alg, NLM_CIPHER_MODE_CBC, 0, ( unsigned char * )d_key,
+			mode, cipher_alg, NLM_CIPHER_MODE_CBC, 0, cipher_key,
 			cipher_keylen, auth_key, auth_keylen,0);
 	#ifdef NLM_CRYPTO_DEBUG 
 	print_buf("ENC_KEY:", cipher_key, cipher_keylen);
-- 
1.8.4.93.g57e4c17

