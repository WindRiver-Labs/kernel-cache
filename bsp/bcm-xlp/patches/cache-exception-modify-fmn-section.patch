From 500a62d6fc335d53205336e3eed5a277845d361d Mon Sep 17 00:00:00 2001
From: Lakshan Dias <ldias@broadcom.com>
Date: Thu, 2 Aug 2012 01:12:02 -0700
Subject: [PATCH 383/565] cache-exception: modify fmn section

cache-exception: modify fmn section to read correct error registers

Based on Broadcom SDK 2.3.

Signed-off-by: Lakshan Dias <ldias@broadcom.com>
Signed-off-by: Yanjiang Jin <yanjiang.jin@windriver.com>
---
 arch/mips/mm/cerr-nlm.c | 26 +++++---------------------
 1 file changed, 5 insertions(+), 21 deletions(-)

diff --git a/arch/mips/mm/cerr-nlm.c b/arch/mips/mm/cerr-nlm.c
index beed0cd..645cefc 100644
--- a/arch/mips/mm/cerr-nlm.c
+++ b/arch/mips/mm/cerr-nlm.c
@@ -193,21 +193,14 @@ static void dump_cerr_info(void)
 	uint32_t l3_reg1 = nlm_hal_read_32bit_reg(mmio, 0xDA);
 	uint32_t l3_reg2 = nlm_hal_read_32bit_reg(mmio, 0xDB);
 
-	uint32_t cop2_txmsgstatus, cop2_msgstatus1, cop2_msgerr0;
-	uint32_t cop2_msgerr1, cop2_msgerr2, cop2_msgerr3;
+	uint32_t cop2_txmsgstatus, cop2_msgstatus1;
+
 	cop2_txmsgstatus = (uint32_t) _read_32bit_cp2_register($2);
 	cop2_msgstatus1  = (uint32_t) _read_32bit_cp2_register($4);
-	cop2_msgerr0 = (uint32_t) _read_32bit_cp2_register_sel($6, 0);
-	cop2_msgerr1 = (uint32_t) _read_32bit_cp2_register_sel($6, 1);
-	cop2_msgerr2 = (uint32_t) _read_32bit_cp2_register_sel($6, 2);
-	cop2_msgerr3 = (uint32_t) _read_32bit_cp2_register_sel($6, 3);
-	cop2_msgerr3 = (uint32_t) _read_32bit_cp2_register_sel($6, 3);
 
 	cerr_printk("CPU (XLP specific) registers dump: Node=%d \n", node);
-	cerr_printk("    COP2: TxMsgStatus = 0x%08x, MsgStatus1 = 0x%08x, MsgError0 = 0x%08x\n",
-				cop2_txmsgstatus, cop2_msgstatus1, cop2_msgerr0 );
-	cerr_printk("          MsgError1 = 0x%08x, MsgError2 = 0x%08x, MsgError3 = 0x%08x\n",
-				cop2_msgerr1, cop2_msgerr2, cop2_msgerr3 );
+	cerr_printk("    COP2: TxMsgStatus = 0x%08x, MsgStatus1 = 0x%08x\n",
+				cop2_txmsgstatus, cop2_msgstatus1 );
 
 	cerr_printk("     ICU: log0 = 0x%08x, log1 = 0x%08x, log2 = 0x%08x\n",
 				icu_log0, icu_log1, icu_log2);
@@ -247,14 +240,9 @@ static void dump_cerr_info(void)
 
 static int check_COP2_error(void)
 {
-	uint32_t cop2_txmsgstatus, cop2_msgstatus1, cop2_msgerr0;
-	uint32_t cop2_msgerr1, cop2_msgerr2, cop2_msgerr3;
+	uint32_t cop2_txmsgstatus, cop2_msgstatus1;
 	cop2_txmsgstatus = (uint32_t)_read_32bit_cp2_register( $2 );
 	cop2_msgstatus1  = (uint32_t)_read_32bit_cp2_register( $4 );
-	cop2_msgerr0 = (uint32_t)_read_32bit_cp2_register_sel($6, 0);
-	cop2_msgerr1 = (uint32_t)_read_32bit_cp2_register_sel($6, 1);
-	cop2_msgerr2 = (uint32_t)_read_32bit_cp2_register_sel($6, 2);
-	cop2_msgerr3 = (uint32_t)_read_32bit_cp2_register_sel($6, 3);
 
 	if( ((cop2_txmsgstatus >> 3) & 1) == 0 && ((cop2_msgstatus1 >> 12) & 1) == 0 ) return 0;
 
@@ -281,10 +269,6 @@ static int check_COP2_error(void)
 		cerr_printk("     OQID: 0x%03x\n", cop2_msgstatus1 & 0xFFF );
 	}
 
-	cerr_printk("  The receive massage that has error:\n");
-	cerr_printk("    bits[31:0]=0x%08x, bits[63:32]=0x%08x, bits[95:64]=0x%08x, bits[103:96]=0x%x\n",
-				cop2_msgerr0, cop2_msgerr1, cop2_msgerr2, cop2_msgerr3);
-
 	return -1;
 }
 
-- 
1.8.4.93.g57e4c17

