From 79fafdb5a475340a5dc2bc2dfc6bf8b63696afc5 Mon Sep 17 00:00:00 2001
From: Mehul <vmehul@netlogicmicro.com>
Date: Wed, 23 Mar 2011 18:20:42 +0530
Subject: [PATCH 190/565] bcm-xlp: fix typo in vc_to_handle_map array.

Fix typo in vc_to_handle_map array.
Add an api to read application specific parameters from fdt.

Based on Broadcom SDK 2.3.

Signed-off-by: Mehul <vmehul@netlogicmicro.com>
Signed-off-by: Yanjiang Jin <yanjiang.jin@windriver.com>
---
 arch/mips/netlogic/xlp/on_chip.c |  2 +-
 arch/mips/netlogic/xlp/setup.c   | 14 +++++++++++++-
 2 files changed, 14 insertions(+), 2 deletions(-)

diff --git a/arch/mips/netlogic/xlp/on_chip.c b/arch/mips/netlogic/xlp/on_chip.c
index b41a685..82fee52 100644
--- a/arch/mips/netlogic/xlp/on_chip.c
+++ b/arch/mips/netlogic/xlp/on_chip.c
@@ -70,7 +70,7 @@ static uint16_t vc_to_handle_map[MAX_VC] = {
 	[32 ... 47] = XLP_MSG_HANDLE_CPU2,
 	[48 ... 63] = XLP_MSG_HANDLE_CPU3,
 	[64 ... 79] = XLP_MSG_HANDLE_CPU4,
-	[80 ... 85] = XLP_MSG_HANDLE_CPU5,
+	[80 ... 95] = XLP_MSG_HANDLE_CPU5,
 	[96 ... 111] = XLP_MSG_HANDLE_CPU6,
 	[112 ... 127] = XLP_MSG_HANDLE_CPU7,
 	[128 ... 143] = XLP_MSG_HANDLE_CPU0,
diff --git a/arch/mips/netlogic/xlp/setup.c b/arch/mips/netlogic/xlp/setup.c
index cac8f3c..5688711 100644
--- a/arch/mips/netlogic/xlp/setup.c
+++ b/arch/mips/netlogic/xlp/setup.c
@@ -405,11 +405,23 @@ extern struct plat_smp_ops nlm_smp_ops;
 #define MAX_CPUMASK_CELLS 4
 #define fdt32_to_cpu(x) be32_to_cpu(x)
 
+int nlm_get_fdt_app_param(const char *param, void *data, int size)
+{
+	void *node;
+	node = finddevice("/doms/dom@0/app-param");
+	if(node) {
+		if (getprop(node, param, data, size) > 0)
+			return 0;
+	}
+	return -1;
+}
+EXPORT_SYMBOL(nlm_get_fdt_app_param);
+
 static int fdt_process(void)
 {
 	int  domain=0;
 	char domstr[32] = "";
-	int  i, na, ns, regs[4], entries, cpu_cells;
+	uint32_t  i, na, ns, regs[16], entries, cpu_cells;
 	uint32_t node_vc_mask[4] = {0};
 	extern uint32_t nlm_cpu_vc_mask[NLM_MAX_CPU_NODE*NLM_MAX_CPU_PER_NODE];
 	unsigned char buf[30];	
-- 
1.8.4.93.g57e4c17

