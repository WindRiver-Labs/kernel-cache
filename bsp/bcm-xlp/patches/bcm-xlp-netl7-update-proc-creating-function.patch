From eb67be6895305ab3e56fcadf8af1833c45e84843 Mon Sep 17 00:00:00 2001
From: Yanjiang Jin <yanjiang.jin@windriver.com>
Date: Mon, 2 Dec 2013 14:35:39 +0800
Subject: [PATCH 3/3] bcm-xlp: netl7: update proc creating function

Use new proc_create_data function to create proc entry.

Signed-off-by: Yanjiang Jin <yanjiang.jin@windriver.com>
---
 drivers/misc/netl7driver/netl7driver.c | 42 ++++++++++++++++++----------------
 1 file changed, 22 insertions(+), 20 deletions(-)

diff --git a/drivers/misc/netl7driver/netl7driver.c b/drivers/misc/netl7driver/netl7driver.c
index 994292f..7927d6b 100644
--- a/drivers/misc/netl7driver/netl7driver.c
+++ b/drivers/misc/netl7driver/netl7driver.c
@@ -670,15 +670,15 @@ static int create_proc_entries(void)
 			break;
 		}
 		mars1_id++;
-		entry = create_proc_entry(buf,
-		S_IFREG | S_IRUGO | S_IWUGO, nlm_proc_root);
+		entry = proc_create_data(buf, S_IFREG | S_IRUGO | S_IWUGO,
+						nlm_proc_root,	/* parent */
+						&device_proc_fops,
+						&device_list[i]);
 		if (entry == NULL) {
 			failure = 1;
 			break;
 		}
 
-		entry->proc_fops = &device_proc_fops;
-		entry->data = &device_list[i];
 		strcpy(device_list[i].proc_name, buf);
 		device_list[i].proc_entry = entry;
 		break;
@@ -690,15 +690,15 @@ static int create_proc_entries(void)
 			break;
 		}
 		mars2_id++;
-		entry = create_proc_entry(buf,
-			S_IFREG | S_IRUGO | S_IWUGO, nlm_proc_root);
+		entry = proc_create_data(buf, S_IFREG | S_IRUGO | S_IWUGO,
+						nlm_proc_root,	/* parent */
+						&device_proc_fops,
+						&device_list[i]);
 		if (entry == NULL) {
 			failure = 1;
 			break;
 		}
 
-		entry->proc_fops = &device_proc_fops;
-		entry->data = &device_list[i];
 		strcpy(device_list[i].proc_name, buf);
 		device_list[i].proc_entry = entry;
 		break;
@@ -712,15 +712,16 @@ static int create_proc_entries(void)
 				failure = 1;
 				break;
 			}
-			entry = create_proc_entry(buf,
-			S_IFREG | S_IRUGO | S_IWUGO, nlm_proc_root);
+			entry = proc_create_data(buf,
+				S_IFREG | S_IRUGO | S_IWUGO,
+				nlm_proc_root,	/* parent */
+				&device_proc_fops,
+				&device_list[i]);
 			if (entry == NULL) {
 				failure = 1;
 				break;
 			}
 
-			entry->proc_fops = &device_proc_fops;
-			entry->data = &device_list[i];
 			strcpy(device_list[i].proc_name, buf);
 			device_list[i].proc_entry = entry;
 			i++;
@@ -737,15 +738,16 @@ static int create_proc_entries(void)
 				failure = 1;
 				break;
 			}
-			entry = create_proc_entry(buf,
-				S_IFREG | S_IRUGO | S_IWUGO, nlm_proc_root);
+			entry = proc_create_data(buf,
+				S_IFREG | S_IRUGO | S_IWUGO,
+				nlm_proc_root,	/* parent */
+				&device_proc_fops,
+				&device_list[i]);
 			if (entry == NULL) {
 				failure = 1;
 				break;
 			}
 
-			entry->proc_fops = &device_proc_fops;
-			entry->data = &device_list[i];
 			strcpy(device_list[i].proc_name, buf);
 			device_list[i].proc_entry = entry;
 			i++;
@@ -760,15 +762,15 @@ static int create_proc_entries(void)
 			break;
 		}
 		mars3_id++;
-		entry = create_proc_entry(buf, S_IFREG | S_IRUGO | S_IWUGO,
-		nlm_proc_root);
+		entry = proc_create_data(buf, S_IFREG | S_IRUGO | S_IWUGO,
+						nlm_proc_root,	/* parent */
+						&device_proc_fops,
+						&device_list[i]);
 		if (entry == NULL) {
 			failure = 1;
 			break;
 		}
 
-		entry->proc_fops = &device_proc_fops;
-		entry->data = &device_list[i];
 		strcpy(device_list[i].proc_name, buf);
 		device_list[i].proc_entry = entry;
 		break;
-- 
1.8.4.93.g57e4c17

