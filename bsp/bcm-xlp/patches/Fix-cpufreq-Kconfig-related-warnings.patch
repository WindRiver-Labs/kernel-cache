From 764ccd1b89add07fc86950c8a70e3b037f67035c Mon Sep 17 00:00:00 2001
From: Jayanthi A <jayanthi.annadurai@broadcom.com>
Date: Thu, 19 Jul 2012 07:14:34 +0530
Subject: [PATCH 354/565] Fix cpufreq Kconfig related warnings.

XLP base port: Fix cpufreq Kconfig related warnings.

Based on Broadcom SDK 2.3.

Signed-off-by: Jayanthi A <jayanthi.annadurai@broadcom.com>
Signed-off-by: Yanjiang Jin <yanjiang.jin@windriver.com>
---
 arch/mips/Makefile             | 24 ++++++++++--------------
 arch/mips/kernel/vmlinux.lds.S | 24 +++++-------------------
 arch/mips/netlogic/Platform    |  4 ++--
 3 files changed, 17 insertions(+), 35 deletions(-)

diff --git a/arch/mips/Makefile b/arch/mips/Makefile
index 6c4f1fd..fab7604 100644
--- a/arch/mips/Makefile
+++ b/arch/mips/Makefile
@@ -196,9 +196,9 @@ cflags-y			+= -I$(srctree)/arch/mips/include/asm/mach-generic
 #
 #
 # NETLOGIC SOC Common (common)
-core-$(CONFIG_NLM_COMMON)      	+= arch/mips/netlogic/common/
-cflags-$(CONFIG_NLM_COMMON)    	+= -DXLS -I$(srctree)/arch/mips/include/asm/mach-netlogic
-cflags-$(CONFIG_NLM_COMMON)    	+= -I$(srctree)/arch/mips/include/asm/netlogic
+core-$(CONFIG_NLMCOMMON)      	+= arch/mips/netlogic/common/
+cflags-$(CONFIG_NLMCOMMON)    	+= -DXLS -I$(srctree)/arch/mips/include/asm/mach-netlogic
+cflags-$(CONFIG_NLMCOMMON)    	+= -I$(srctree)/arch/mips/include/asm/netlogic
 
 core-$(CONFIG_NLM_XLP) 		+= arch/mips/netlogic/xlp/
 cflags-$(CONFIG_NLM_XLP_SIM)        	+= -DXLP_SIM=1
@@ -214,9 +214,9 @@ include $(srctree)/arch/mips/Kbuild.platforms
 core-$(CONFIG_NLM_XLP) 		+= arch/mips/netlogic/boot/
 cflags-$(CONFIG_NLM_XLP)	+= -I$(srctree)/arch/mips/include/asm/netlogic/hal
 cflags-$(CONFIG_NLM_XLP)	+= -I$(srctree)/arch/mips/netlogic/boot
-cflags-$(CONFIG_NLM_COMMON)    	+= -DXLP -I$(srctree)/arch/mips/include/asm/mach-netlogic
-cflags-$(CONFIG_NLM_COMMON)    	+= -I$(srctree)/arch/mips/include/asm/netlogic
-load-$(CONFIG_NLM_XLP_BOARD) += $(CONFIG_NLM_COMMON_LOAD_ADDRESS)
+cflags-$(CONFIG_NLMCOMMON)	+= -DXLP -I$(srctree)/arch/mips/include/asm/mach-netlogic
+cflags-$(CONFIG_NLMCOMMON)	+= -I$(srctree)/arch/mips/include/asm/netlogic
+load-$(CONFIG_NLM_XLP_BOARD)	+= $(CONFIG_NLMCOMMON_LOAD_ADDRESS)
 
 drivers-$(CONFIG_PCI)		+= arch/mips/pci/
 
@@ -249,6 +249,10 @@ KBUILD_CPPFLAGS += -D"DATAOFFSET=$(if $(dataoffset-y),$(dataoffset-y),0)"
 
 LDFLAGS			+= -m $(ld-emul)
 
+ifdef CONFIG_MAPPED_KERNEL
+KBUILD_CPPFLAGS	+= -D"LOADADDR=$(load-y)" -D"PHYSADDR=$(CONFIG_PHYS_LOAD_ADDRESS)"
+endif
+
 ifdef CONFIG_MIPS
 CHECKFLAGS += $(shell $(CC) $(KBUILD_CFLAGS) -dM -E -x c /dev/null | \
 	egrep -vw '__GNUC_(|MINOR_|PATCHLEVEL_)_' | \
@@ -260,14 +264,6 @@ endif
 
 OBJCOPYFLAGS		+= --remove-section=.reginfo
 
-ifdef CONFIG_MAPPED_KERNEL
-PHYS_LOAD_ADDRESS = -D"PHYSADDR=$(CONFIG_PHYS_LOAD_ADDRESS)"
-endif
-
-ifdef CONFIG_MAPPED_KERNEL
-KBUILD_CFLAGS += -D"LOADADDR=$(load-y)ULL" -D"PHYSADDR=$(CONFIG_PHYS_LOAD_ADDRESS)ULL"
-KBUILD_CFLAGS += -D"LOADADDR_ASM=$(load-y)" -D"PHYSADDR_ASM=$(CONFIG_PHYS_LOAD_ADDRESS)"
-endif
 head-y := arch/mips/kernel/head.o arch/mips/kernel/init_task.o
 
 libs-y			+= arch/mips/lib/
diff --git a/arch/mips/kernel/vmlinux.lds.S b/arch/mips/kernel/vmlinux.lds.S
index c5a8994..0fd90af 100644
--- a/arch/mips/kernel/vmlinux.lds.S
+++ b/arch/mips/kernel/vmlinux.lds.S
@@ -1,6 +1,5 @@
 #include <asm/asm-offsets.h>
 #include <asm/page.h>
-#include <asm/thread_info.h>
 #include <asm-generic/vmlinux.lds.h>
 
 #undef mips
@@ -8,27 +7,15 @@
 OUTPUT_ARCH(mips)
 
 #ifdef CONFIG_MAPPED_KERNEL
-#define AT_LOCATION
-#endif
-
-PHDRS {
-#ifdef CONFIG_MAPPED_KERNEL
-	text PT_LOAD AT_LOCATION FLAGS(7);	/* RWX */
-#else
-	text PT_LOAD FLAGS(7);  /* RWX */
-#endif
-	note PT_NOTE FLAGS(4);	/* R__ */
-}
-
-#ifdef CONFIG_MAPPED_KERNEL
-#ifdef PHYSADDR
-phys_entry = kernel_entry - LOADADDR_ASM + PHYSADDR_ASM;
-#endif
+phys_entry = kernel_entry - LOADADDR + PHYSADDR;
 ENTRY(phys_entry)
 #else
 ENTRY(kernel_entry)
 #endif
-
+PHDRS {
+	text PT_LOAD FLAGS(7);	/* RWX */
+	note PT_NOTE FLAGS(4);	/* R__ */
+}
 
 #ifdef CONFIG_32BIT
 	#ifdef CONFIG_CPU_LITTLE_ENDIAN
@@ -57,7 +44,6 @@ SECTIONS
 	/* . = 0xa800000000300000; */
 	. = 0xffffffff80300000;
 #endif
-
 	. = VMLINUX_LOAD_ADDRESS;
 	/* read-only */
 	_text = .;	/* Text and read-only data */
diff --git a/arch/mips/netlogic/Platform b/arch/mips/netlogic/Platform
index b1b54d6..04ff9aa 100644
--- a/arch/mips/netlogic/Platform
+++ b/arch/mips/netlogic/Platform
@@ -1,8 +1,8 @@
 #
 # NETLOGIC includes
 #
-cflags-$(CONFIG_NLM_COMMON)	+= -I$(srctree)/arch/mips/include/asm/mach-netlogic
-cflags-$(CONFIG_NLM_COMMON)	+= -I$(srctree)/arch/mips/include/asm/netlogic
+cflags-$(CONFIG_NLMCOMMON)	+= -I$(srctree)/arch/mips/include/asm/mach-netlogic
+cflags-$(CONFIG_NLMCOMMON)	+= -I$(srctree)/arch/mips/include/asm/netlogic
 
 #
 # use mips64 if xlr is not available
-- 
1.8.4.93.g57e4c17

