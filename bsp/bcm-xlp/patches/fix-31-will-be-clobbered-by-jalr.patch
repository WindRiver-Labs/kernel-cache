From 1988f1a9bed81cf752b6c9062e82b3a46f18ef24 Mon Sep 17 00:00:00 2001
From: Prasad Boddupalli <pboddupalli@netlogicmicro.com>
Date: Tue, 29 Jun 2010 12:09:42 -0700
Subject: [PATCH 031/565] fix $31 will be clobbered by jalr

_hypercall*() use jalr to invoke Xen function and ra register
($31) needs to be saved and restored automatically.

Based on Broadcom SDK 2.3.

Signed-off-by: Prasad Boddupalli <pboddupalli@netlogicmicro.com>
Signed-off-by: Yanjiang Jin <yanjiang.jin@windriver.com>
---
 arch/mips/include/asm/xen/hypercall.h | 2 +-
 1 file changed, 1 insertion(+), 1 deletion(-)

diff --git a/arch/mips/include/asm/xen/hypercall.h b/arch/mips/include/asm/xen/hypercall.h
index 7c26873..35bc7d5 100644
--- a/arch/mips/include/asm/xen/hypercall.h
+++ b/arch/mips/include/asm/xen/hypercall.h
@@ -165,7 +165,7 @@ extern struct { unsigned long _entry; } hypercall_page[];
 #define __HYPERCALL_5ARG(a1,a2,a3,a4,a5)				\
 	__HYPERCALL_4ARG(a1,a2,a3,a4)	__arg5 = (unsigned long)(a5);
 
-#define __HYPERCALL_CLOBBER5	"memory"
+#define __HYPERCALL_CLOBBER5	"memory", "$31"
 #define __HYPERCALL_CLOBBER4	__HYPERCALL_CLOBBER5, __HYPERCALL_ARG5REG
 #define __HYPERCALL_CLOBBER3	__HYPERCALL_CLOBBER4, __HYPERCALL_ARG4REG
 #define __HYPERCALL_CLOBBER2	__HYPERCALL_CLOBBER3, __HYPERCALL_ARG3REG
-- 
1.8.4.93.g57e4c17

