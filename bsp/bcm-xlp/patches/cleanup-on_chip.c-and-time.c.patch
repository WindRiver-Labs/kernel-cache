From d32957a8480521a1aa798f8dddc76d71deb47e47 Mon Sep 17 00:00:00 2001
From: Zi Shen Lim <zlim@netlogicmicro.com>
Date: Thu, 19 Jan 2012 16:53:49 -0800
Subject: [PATCH 334/565] cleanup on_chip.c and time.c

Cleanup on_chip.c and time.c.

Based on Broadcom SDK 2.3.

Signed-off-by: Zi Shen Lim <zlim@netlogicmicro.com>
Signed-off-by: Yanjiang Jin <yanjiang.jin@windriver.com>
---
 arch/mips/netlogic/xlp/on_chip.c | 51 ----------------------------------------
 arch/mips/netlogic/xlp/time.c    | 24 ++-----------------
 2 files changed, 2 insertions(+), 73 deletions(-)

diff --git a/arch/mips/netlogic/xlp/on_chip.c b/arch/mips/netlogic/xlp/on_chip.c
index b969aa4..6fe4b9b 100644
--- a/arch/mips/netlogic/xlp/on_chip.c
+++ b/arch/mips/netlogic/xlp/on_chip.c
@@ -466,28 +466,6 @@ int unregister_xlp_msgring_handler(int major, void *dev_id)
 EXPORT_SYMBOL(unregister_xlp_msgring_handler);
 
 #include <asm/netlogic/cpumask.h>
-void nlm_nmi_cpus(unsigned int mask)
-{
-	uint32_t cpumask = cpumask_to_uint32(&cpu_present_map); /* doesn't handle non-n0 nodes */
-	uint32_t cpumask_lo;
-	uint32_t cpumask_hi;
-	const int nmi = 1;
-
-	pic_reg_t *mmio = nlm_hal_pic_offset();
-
-	cpumask = cpumask & mask;
-
-	cpumask_hi = cpumask >> 16;;
-	cpumask_lo = cpumask & 0xffff;
-
-	/* Send IRQ_MSGRING vector in an IPI to all cpus but the current one */
-	if (cpumask_lo)
-		nlm_hal_write_pic_reg(mmio, PIC_IPI_CTL, (nmi << 31) | cpumask_lo );
-
-	if (cpumask_hi)
-		nlm_hal_write_pic_reg(mmio, PIC_IPI_CTL, (nmi << 31) | (1 << 16) | (cpumask_hi));
-}
-
 
 /*********************************************************************
  * enable_msgconfig_int 
@@ -506,35 +484,6 @@ void enable_msgconfig_int(void)
 atomic_t nlm_common_counters[NR_CPUS][NLM_MAX_COUNTERS] __cacheline_aligned;
 
 /*********************************************************************
- *  nlm_usb_init 
- *
- ********************************************************************/
-static void nlm_usb_init (void) __attribute__((unused));
-static void nlm_usb_init (void)
-{
-	volatile unsigned int value;
-
-        nlm_reg_t * gpio_mmio = netlogic_io_mmio(NETLOGIC_IO_GPIO_OFFSET);
-        nlm_reg_t * usb_mmio  = netlogic_io_mmio(NETLOGIC_IO_USB_1_OFFSET);
-
-	netlogic_write_reg(usb_mmio, 49, 0x10000000); //Clear Rogue Phy INTs
-	netlogic_write_reg(usb_mmio, 50, 0x1f000000);
-
-        netlogic_write_reg(usb_mmio,  1, 0x07000500);
-
-	value = gpio_mmio[21];
-	if ((value >> 22) & 0x01) {
-		printk("Detected USB Host mode..\n");
-		netlogic_write_reg(usb_mmio,  0, 0x02000000);
-	}
-	else {
-		printk("Detected USB Device mode..\n");
-		netlogic_write_reg(usb_mmio,  0, 0x01000000);
-	}
-}
-
-
-/*********************************************************************
  * nlm_enable_vc_intr
  *********************************************************************/
 void nlm_enable_vc_intr(void)
diff --git a/arch/mips/netlogic/xlp/time.c b/arch/mips/netlogic/xlp/time.c
index cec45ce..d540d7e 100644
--- a/arch/mips/netlogic/xlp/time.c
+++ b/arch/mips/netlogic/xlp/time.c
@@ -22,36 +22,16 @@ CONTRACT, STRICT LIABILITY, OR TORT (INCLUDING NEGLIGENCE OR OTHERWISE)
 ARISING IN ANY WAY OUT OF THE USE OF THIS SOFTWARE, EVEN IF ADVISED OF
 THE POSSIBILITY OF SUCH DAMAGE.
 *****************************#NETL_2#********************************/
-
-#include <linux/interrupt.h>
-#include <linux/sched.h>
+#include <linux/module.h>
+#include <linux/proc_fs.h>
 #include <linux/spinlock.h>
 
-#include <asm/irq.h>
-#include <asm/ptrace.h>
-#include <asm/addrspace.h>
 #include <asm/time.h>
-#include <asm/cpu.h>
-#include <asm/cpu-features.h>
-#include <linux/oprofile.h>
 
-#include <linux/proc_fs.h>
 #include <asm/netlogic/xlp_hal_pic.h>
 
 extern spinlock_t xlp_pic_lock;
 
-void save_epc(unsigned long *epc)
-{
-	__asm__ __volatile__(".set push\n"
-			     ".set noreorder\n"
-			     "mfc0 %0, $14\n" ".set pop\n":"=r"(*epc));
-}
-
-#ifdef CONFIG_OPROFILE
-extern void nlm_common_oprofile_int_handler(int irq, void *dev_id,
-					 struct pt_regs *regs);
-#endif
-
 /* Use PIC Timer 6 as a free running counter */
 #define FRC        6
 #define FRC_MAXVAL PIC_SYSTIMER_MAXVAL
-- 
1.8.4.93.g57e4c17

