From c2c0b34736998572324246bc28cc69da400a8d17 Mon Sep 17 00:00:00 2001
From: henry shao <hshao@netlogicmicro.com>
Date: Tue, 1 Feb 2011 15:54:39 -0800
Subject: [PATCH 186/565] Update XLP processor/revision IDs

Update XLP processor/revision IDs.

Based on Broadcom SDK 2.3.

Signed-off-by: henry shao <hshao@netlogicmicro.com>
Signed-off-by: Yanjiang Jin <yanjiang.jin@windriver.com>
---
 arch/mips/include/asm/netlogic/xlp.h | 26 +++++++-----
 arch/mips/netlogic/xlp/setup.c       | 77 +++++++++++++++++++++++++++++-------
 2 files changed, 79 insertions(+), 24 deletions(-)

diff --git a/arch/mips/include/asm/netlogic/xlp.h b/arch/mips/include/asm/netlogic/xlp.h
index 3ca893e..cbb1ab8 100644
--- a/arch/mips/include/asm/netlogic/xlp.h
+++ b/arch/mips/include/asm/netlogic/xlp.h
@@ -30,17 +30,23 @@ THE POSSIBILITY OF SUCH DAMAGE.
 #include <asm/cpu.h>
 #include <asm/mipsregs.h>
 
-#if defined(CONFIG_NLM_XLP)
-/* Fake Values for bring-up */
-#define CHIP_PROCESSOR_ID_XLP_A_832   0x00
-#define CHIP_PROCESSOR_ID_XLR_C_732   0xff
-#else
-/* Real Values */
-#define CHIP_PROCESSOR_ID_XLP_A_832   0x90
-#define CHIP_PROCESSOR_ID_XLR_C_732   0x00
-#endif
+#define CHIP_PROCESSOR_ID_XLP_8XX   0x00
+#define CHIP_PROCESSOR_ID_XLP_832   0x10
+#define CHIP_PROCESSOR_ID_XLP_816   0x14
+#define CHIP_PROCESSOR_ID_XLP_432   0x90
+#define CHIP_PROCESSOR_ID_XLP_416   0x94
+#define CHIP_PROCESSOR_ID_XLP_408   0x95
+#define CHIP_PROCESSOR_ID_XLP_316   0xD4
+#define CHIP_PROCESSOR_ID_XLP_308   0xD5
+#define CHIP_PROCESSOR_ID_XLP_304   0xD7
+#define CHIP_PROCESSOR_ID_XLP_208   0xB5
+#define CHIP_PROCESSOR_ID_XLP_204   0xB7
+#define CHIP_PROCESSOR_ID_XLP_104   0xF7
+
+#define XLP_REVISION_A0 	0x00
+#define XLP_REVISION_A1 	0x01
+#define XLP_REVISION_A2 	0x02
 
-#define XLP_REVISION_A0 	0xc0010
 #define MAX_CPU_REV_LEN		100
 #define NLM_MAX_CPU_NODE		4
 #define NLM_MAX_CPU_PER_NODE	32
diff --git a/arch/mips/netlogic/xlp/setup.c b/arch/mips/netlogic/xlp/setup.c
index 6a16eeb..5c771dd 100644
--- a/arch/mips/netlogic/xlp/setup.c
+++ b/arch/mips/netlogic/xlp/setup.c
@@ -590,24 +590,73 @@ static int fdt_process(void)
 	return 0;
 }
 
-static int get_xlp_proc_name(void )
+static int get_xlp_proc_name(void)
 {
-        strcpy(cpu_model_info,"XLP832");
-        return 0;
+	int processor_id = ((read_c0_prid() & 0xff00) >> 8);
+
+	switch (processor_id) {
+	case CHIP_PROCESSOR_ID_XLP_8XX:
+	case CHIP_PROCESSOR_ID_XLP_832:
+		strcpy(cpu_model_info, "XLP832");
+		break;
+	case CHIP_PROCESSOR_ID_XLP_816:
+		strcpy(cpu_model_info, "XLP816");
+		break;
+	case CHIP_PROCESSOR_ID_XLP_432:
+		strcpy(cpu_model_info, "XLP432");
+		break;
+	case CHIP_PROCESSOR_ID_XLP_416:
+		strcpy(cpu_model_info, "XLP416");
+		break;
+	case CHIP_PROCESSOR_ID_XLP_408:
+		strcpy(cpu_model_info, "XLP408");
+		break;
+	case CHIP_PROCESSOR_ID_XLP_316:
+		strcpy(cpu_model_info, "XLP316");
+		break;
+	case CHIP_PROCESSOR_ID_XLP_308:
+		strcpy(cpu_model_info, "XLP308");
+		break;
+	case CHIP_PROCESSOR_ID_XLP_304:
+		strcpy(cpu_model_info, "XLP304");
+		break;
+	case CHIP_PROCESSOR_ID_XLP_208:
+		strcpy(cpu_model_info, "XLP208");
+		break;
+	case CHIP_PROCESSOR_ID_XLP_204:
+		strcpy(cpu_model_info, "XLP204");
+		break;
+	case CHIP_PROCESSOR_ID_XLP_104:
+		strcpy(cpu_model_info, "XLP104");
+		break;
+	default:
+		strcpy(cpu_model_info, "XLP???");
+		return -1;
+	}
+
+	return 0;
 }
 
-static int get_xlp_revision(void )
+static int get_xlp_revision(void)
 {
-        int revision = read_c0_prid() & 0xff00ff;
-        switch( revision ) {
-        case XLP_REVISION_A0:
-                strcpy(cpu_model_info+PROCESSOR_ID_MAX_LEN," Rev A0");
-                break;
-        default:
-                strcpy(cpu_model_info+PROCESSOR_ID_MAX_LEN," Rev ??");
-                return -1;
-        }
-        return 0;
+	int revision = read_c0_prid() & 0xff;
+
+	switch (revision) {
+	case XLP_REVISION_A0:
+		strcpy(cpu_model_info + PROCESSOR_ID_MAX_LEN, " Rev A0");
+		break;
+	case XLP_REVISION_A1:
+		strcpy(cpu_model_info + PROCESSOR_ID_MAX_LEN, " Rev A1");
+		break;
+	case XLP_REVISION_A2:
+		strcpy(cpu_model_info + PROCESSOR_ID_MAX_LEN, " Rev A2");
+		break;
+	default:
+		strcpy(cpu_model_info + PROCESSOR_ID_MAX_LEN, " Rev ??");
+		return -1;
+	}
+
+	return 0;
 }
 
 char* get_cpu_info(void)
-- 
1.8.4.93.g57e4c17

