From 58ca53cccc49a31796a9be699caecbf42d8386c5 Mon Sep 17 00:00:00 2001
From: henry shao <hshao@netlogicmicro.com>
Date: Tue, 23 Nov 2010 17:05:50 -0800
Subject: [PATCH 174/565] fix usb

1. Make usb module simulator safe;
2. Fix bad irq handler warning bug

Based on Broadcom SDK 2.3.

Signed-off-by: henry shao <hshao@netlogicmicro.com>
Signed-off-by: Yanjiang Jin <yanjiang.jin@windriver.com>
---
 drivers/usb/host/ehci-pci.c | 6 +++---
 1 file changed, 3 insertions(+), 3 deletions(-)

diff --git a/drivers/usb/host/ehci-pci.c b/drivers/usb/host/ehci-pci.c
index 687cabd..25e8b30 100644
--- a/drivers/usb/host/ehci-pci.c
+++ b/drivers/usb/host/ehci-pci.c
@@ -42,7 +42,7 @@ static const char hcd_name[] = "ehci-pci";
 /* defined here to avoid adding to pci_ids.h for single instance use */
 #define PCI_DEVICE_ID_INTEL_CE4100_USB	0x2e70
 
-#ifdef CONFIG_NLM_XLP
+#if defined(CONFIG_NLM_XLP) && defined(CONFIG_USB)
 
 #include <asm/netlogic/hal/nlm_hal.h>
 #include <asm/netlogic/hal/nlm_hal_pic.h>
@@ -443,7 +443,7 @@ static const struct ehci_driver_overrides pci_overrides __initconst = {
 
 /* PCI driver selection metadata; PCI hotplugging uses this */
 static const struct pci_device_id pci_ids [] = { {
-#ifdef CONFIG_NLM_XLP
+#if defined(CONFIG_NLM_XLP) && defined(CONFIG_USB)
 	{
 		.vendor		 = PCI_VENDOR_ID_NETLOGIC,
 		.device		 = XLP_DEVID_EHCI,
@@ -470,7 +470,7 @@ MODULE_DEVICE_TABLE(pci, pci_ids);
 static struct pci_driver ehci_pci_driver = {
 	.name =		(char *) hcd_name,
 	.id_table =	pci_ids,
-#ifdef CONFIG_NLM_XLP
+#if defined(CONFIG_NLM_XLP) && defined(CONFIG_USB)
 	.probe =	xlp_ehci_hcd_pci_probe,
 #else
 	.probe =	usb_hcd_pci_probe,
-- 
1.8.4.93.g57e4c17

