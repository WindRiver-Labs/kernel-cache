From 370e95ff83bf9b17a177e749921b7c4007ac252c Mon Sep 17 00:00:00 2001
From: henry shao <hshao@netlogicmicro.com>
Date: Mon, 28 Jun 2010 08:02:29 -0700
Subject: [PATCH 051/565] use eth_hw_addr

Use eth_hw_addr to replace myeth in RUN_ON_SIM macro.

Based on Broadcom SDK 2.3.

Signed-off-by: henry shao <hshao@netlogicmicro.com>
Signed-off-by: Yanjiang Jin <yanjiang.jin@windriver.com>
---
 drivers/net/xlp_nae/xlp_nae.c | 29 ++++++++++-------------------
 1 file changed, 10 insertions(+), 19 deletions(-)

diff --git a/drivers/net/xlp_nae/xlp_nae.c b/drivers/net/xlp_nae/xlp_nae.c
index f80d135..cc16a62 100644
--- a/drivers/net/xlp_nae/xlp_nae.c
+++ b/drivers/net/xlp_nae/xlp_nae.c
@@ -74,15 +74,6 @@
 #define MIN_FRIN_DESC_THRESHD		8	
 #define MAX_NET_INF             	18
 #define XLP_SGMII_RCV_CONTEXT_NUM	8
-unsigned char icmp_pck[200] = {0x00,0x22,0x19,0x05,0xf0,0xb8,0x00,
-                      0xd0,0xd3,0x3a,0xbd,0x50,0x08,0x00,0x45,0x00,0x00,
-                      0x3c,0x92,0x42,0x00,0x00,0x7f,0x01,0x06,0xb4,0x0a,
-                      0x1a,0x72,0x18,0xc0,0xa8,0x65,0xf0,0x08,0x00,0x0b,
-                      0x12,0x04,0x00,0x3e,0x4a,0x61,0x62,0x63,0x64,0x65,
-                      0x66,0x67,0x68,0x69,0x6a,0x6b,0x6c,0x6d,0x6e,0x6f,
-                      0x70,0x71,0x72,0x73,0x74,0x75,0x76,0x77,0x61,0x62,
-                      0x63,0x64,0x65,0x66,0x67,0x68,0x69  };
-
 
 #define MSG_DST_FC_FAIL                 0x01
 #define MSG_INFLIGHT_MSG_EX             0x02
@@ -90,15 +81,6 @@ unsigned char icmp_pck[200] = {0x00,0x22,0x19,0x05,0xf0,0xb8,0x00,
 #define ICMP_LEN                     	74
 #define MAX_GMAC_PORT               	18
 
-#define MYIP_OFFSET	30				
-#define  RUN_ON_SIM()					\
-uint8_t broadcast[6] = {0xff,0xff,0xff,0xff,0xff,0xff};	\
-uint8_t myeth[6]     = {0x00,0x01,0x02,0x03,0x04,0x05};	\
-uint8_t hosteth[6]   = {0x00,0x1a,0xa0,0x1e,0x5d,0xc9};	\
-uint8_t myip[4]	     = {0x0a,0x1a,0x70,0xd6};		\
-	if(memcmp(buf, hosteth, 6) == 0)		\
-		if(memcmp(&buf[MYIP_OFFSET],myip,4)==0)	\
-			memcpy(buf,myeth,6); 		 
 
 #define  DUMP_RCV_PKT				0	
 #define  DUMP_XMIT_PKT				0
@@ -141,6 +123,15 @@ static struct pci_device_id soc_pci_table[] __devinitdata = {
         {}
 };
 
+#define MYIP_OFFSET	30				
+#define  RUN_ON_SIM()					\
+uint8_t hosteth[6]   = {0x00,0x1a,0xa0,0x1e,0x5d,0xc9};	\
+uint8_t myip[4]	     = {10,26,112,214};			\
+	if(memcmp(buf, hosteth, 6) == 0)		\
+		if(memcmp(&buf[MYIP_OFFSET],myip,4)==0)	\
+			memcpy(buf,&eth_hw_addr[0],6); 		 
+
+uint8_t myeth[6]     = {0x00,0x01,0x02,0x03,0x04,0x05};	
 extern int  xlp_with_mac_driver;
 extern void xlp_set_ethtool_ops(struct net_device *netdev);
 extern void xlp_get_mac_stats(struct net_device* dev, struct net_device_stats* stats);
@@ -1030,7 +1021,7 @@ static irqreturn_t nlm_xlp_nae_int_handler(int irq, void * dev_id)
 }
 /**********************************************************************
  * nlm_xlp_nae_msgring_handler -  message ring interrupt handler
- * @irq     -  irq number
+ * @vc-  virtual channel number
  * @dev_id  -  this device 
  * 
  **********************************************************************/
-- 
1.8.4.93.g57e4c17

