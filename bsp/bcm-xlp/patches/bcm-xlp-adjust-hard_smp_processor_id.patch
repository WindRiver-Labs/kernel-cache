From 772b1c4e19b2fa90cbf4768ad2e9bda99f44aa35 Mon Sep 17 00:00:00 2001
From: henry shao <hshao@netlogicmicro.com>
Date: Wed, 9 Jun 2010 15:20:08 -0700
Subject: [PATCH 043/565] bcm-xlp: adjust hard_smp_processor_id()

Make hard_smp_processor_id() node aware, so return value is
node[6-5]|cpu[4-2]|thread[1-0].

Based on Broadcom SDK 2.3.

Signed-off-by: henry shao <hshao@netlogicmicro.com>
Signed-off-by: Yanjiang Jin <yanjiang.jin@windriver.com>
---
 arch/mips/include/asm/netlogic/mips-exts.h | 2 +-
 1 file changed, 1 insertion(+), 1 deletion(-)

diff --git a/arch/mips/include/asm/netlogic/mips-exts.h b/arch/mips/include/asm/netlogic/mips-exts.h
index 5b7e3f4..1162075 100644
--- a/arch/mips/include/asm/netlogic/mips-exts.h
+++ b/arch/mips/include/asm/netlogic/mips-exts.h
@@ -288,7 +288,7 @@ static __inline__ int hard_smp_processor_id(void)
 		: "=&r"(cpu) : : "$8"
 		);
 
-	return cpu;
+	return ((cpu & 0x1f) | ((cpu & 0xc0) >> 1));
 }
 
 #define netlogic_cpu_to_thrid(cpu) (phys_proc_id[(cpu)] >> 2)
-- 
1.8.4.93.g57e4c17

