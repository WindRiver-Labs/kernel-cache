From 0aceb77068f3a76cc69bb466057ce8341a014fac Mon Sep 17 00:00:00 2001
From: Zi Shen Lim <zlim@netlogicmicro.com>
Date: Fri, 4 Nov 2011 16:52:58 -0700
Subject: [PATCH 471/761] Mark IPIs as per-cpu and cannot be threaded.

Based on Broadcom SDK 2.3.

Signed-off-by: Zi Shen Lim <zlim@netlogicmicro.com>
Signed-off-by: Yanjiang Jin <yanjiang.jin@windriver.com>
---
 arch/mips/netlogic/xlp/smp.c |    6 ++++--
 1 file changed, 4 insertions(+), 2 deletions(-)

diff --git a/arch/mips/netlogic/xlp/smp.c b/arch/mips/netlogic/xlp/smp.c
index 79e3bfa..a85fc71 100644
--- a/arch/mips/netlogic/xlp/smp.c
+++ b/arch/mips/netlogic/xlp/smp.c
@@ -284,11 +284,13 @@ static irqreturn_t smp_function_ipi_handler(int irq, void *dev_id)
 
 void nlm_prepare_cpus(unsigned int max_cpus)
 {
-	if (request_irq(XLP_IRQ_IPI_SMP_FUNCTION, smp_function_ipi_handler, 0,
+	if (request_irq(XLP_IRQ_IPI_SMP_FUNCTION, smp_function_ipi_handler,
+			IRQF_PERCPU | IRQF_NO_THREAD,
 			"IPI:smp function", NULL)) {
 		panic("Cannot request_irq(XLP_IRQ_IPI_SMP_FUNCTION)\n");
 	}
-	if (request_irq(XLP_IRQ_IPI_SMP_RESCHEDULE, smp_resched_ipi_handler, 0,
+	if (request_irq(XLP_IRQ_IPI_SMP_RESCHEDULE, smp_resched_ipi_handler,
+			IRQF_PERCPU | IRQF_NO_THREAD,
 			"IPI:smp reschedule", NULL)) {
 		panic("Cannot request_irq(XLP_IRQ_IPI_SMP_RESCHEDULE)\n");
 	}
-- 
1.7.10.4

