From 081db3a1f939558dfbd6557e96322430ad24e2a5 Mon Sep 17 00:00:00 2001
From: Yong Zhang <yong.zhang@windriver.com>
Date: Wed, 12 Nov 2014 10:34:56 +0800
Subject: [PATCH 2/2] MIPS: XLP: irq: mark xlp_pic IRQCHIP_ONESHOT_SAFE

Testing shows that the irq chip is oneshot safe.

And look at the source code, xlp_pic_mask_ack()/xlp_pic_unmask()
must be called on the local cpu; once it's called in irq thread,
it's possible that the irq will leave masked. So mark it
IRQCHIP_ONESHOT_SAFE to resolve the issue.

Signed-off-by: Yong Zhang <yong.zhang@windriver.com>
---
 arch/mips/netlogic/common/irq.c |    1 +
 1 files changed, 1 insertions(+), 0 deletions(-)

diff --git a/arch/mips/netlogic/common/irq.c b/arch/mips/netlogic/common/irq.c
index 963fd8b..f853177 100644
--- a/arch/mips/netlogic/common/irq.c
+++ b/arch/mips/netlogic/common/irq.c
@@ -180,6 +180,7 @@ static struct irq_chip xlp_pic = {
 	.irq_mask_ack	= xlp_pic_mask_ack,
 	.irq_unmask	= xlp_pic_unmask,
 	.irq_set_affinity = xlp_pic_set_affinity,
+	.flags		= IRQCHIP_ONESHOT_SAFE,
 };
 
 static void cpuintr_disable(struct irq_data *d)
-- 
1.7.5.4

