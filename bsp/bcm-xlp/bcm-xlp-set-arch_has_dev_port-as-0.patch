From 1603ab2d638e00dc98747d81200647e1237a1fc2 Mon Sep 17 00:00:00 2001
From: Yanjiang Jin <yanjiang.jin@windriver.com>
Date: Wed, 13 Nov 2013 17:47:26 +0800
Subject: [PATCH] bcm-xlp: set arch_has_dev_port as "0"

XLP boards do not have legacy ISA devices. "/dev/port" is not a valid
interface on them, so define arch_has_dev_port as "0". Else system
would report the below errors when accessing "/dev/port".

Probing for Supe*******************************************
cpu_5 received a bus/cache error(warning)
**********************************************************
CPU (XLP specific) registers dump: Node=0
    COP2: TxMsgStatus = 0x00000000, MsgStatus1 = 0x0f000000
     ICU: log0 = 0x00000000, log1 = 0x00000000, log2 = 0x00000000
     LSU: log0 = 0x00000000, log1 = 0x000000cdfff7fe36
     SCU: log0 = 0x00000000, log1 = 0x00000000, log2 = 0x00000000
     TCU: reg0 = 0x00000000, reg1 = 0x00000000, reg2 = 0x00000000
     NBU: reg0 = 0x000000cc, reg1 = 0x1400002e, reg2 = 0x00000000
  DRAM_A: reg1 = 0x00000000, reg2 = 0x00000000

     CPU: epc = 0x77020d64, errorepc = 0xffffffffc15014e4, cacheerr = 0x00000000
*******************************************************************************************
LSU Cache Warning:
   log0=0x0000000000000000, phyaddr=0xcdfff7fe36
NBU Cache Error:
   log0=0x000000cc, phyaddr=0x000000001400002e
          ReqSrc: Core 1
         ReqType: Writeback
        Overflow: 1
	  Error Valid: 1
Can not handle bus/cache error - Halting cpu

Signed-off-by: Yanjiang Jin <yanjiang.jin@windriver.com>
---
 arch/mips/include/asm/io.h | 7 +++++++
 1 file changed, 7 insertions(+)

diff --git a/arch/mips/include/asm/io.h b/arch/mips/include/asm/io.h
index 5f24397..55957ec 100644
--- a/arch/mips/include/asm/io.h
+++ b/arch/mips/include/asm/io.h
@@ -175,6 +175,13 @@ struct pci_dev;
 static inline void pci_iounmap(struct pci_dev *dev, void __iomem *addr) {}
 #endif
 
+#ifdef CONFIG_NLM_XLP
+/*
+ * XLP boards don't have legacy ISA devices
+ */
+#define arch_has_dev_port()     (0)
+#endif
+
 static inline void __iomem * __ioremap_mode(phys_t offset, unsigned long size,
 	unsigned long flags)
 {
-- 
1.8.4.93.g57e4c17

