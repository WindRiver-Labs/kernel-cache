From 73e1055f8ad7e7948ac6b4dc668e0080be99eedb Mon Sep 17 00:00:00 2001
From: Zi Shen Lim <zlim@netlogicmicro.com>
Date: Sat, 25 Sep 2010 20:57:27 -0700
Subject: [PATCH 187/762] Bugfix: Little Endian FDT parsing

Based on Broadcom SDK 2.3.

Signed-off-by: Zi Shen Lim <zlim@netlogicmicro.com>
Signed-off-by: Yanjiang Jin <yanjiang.jin@windriver.com>
---
 arch/mips/netlogic/xlp/setup.c |   13 ++++++++++---
 1 files changed, 10 insertions(+), 3 deletions(-)

diff --git a/arch/mips/netlogic/xlp/setup.c b/arch/mips/netlogic/xlp/setup.c
index 692c475..2f4a4cb 100644
--- a/arch/mips/netlogic/xlp/setup.c
+++ b/arch/mips/netlogic/xlp/setup.c
@@ -441,17 +441,24 @@ static int fdt_process(void)
 	if (node) {
 		if (getprop(node, "#address-cells", &na, sizeof(na)) < 0)
 			na = 1;
-		na = fdt32_to_cpu(na);
+		else
+			na = fdt32_to_cpu(na);
 		if (na < 1 || na > 2)
 			printk("Can't cope with #address-cells == %d.\n\r", na);
+
 		if (getprop(node, "#size-cells", &ns, sizeof(ns)) < 0)
 			ns = 1;
-		ns = fdt32_to_cpu(ns);
+		else
+			ns = fdt32_to_cpu(ns);
 		if (ns < 1 || ns > 2)
 			printk("Can't cope with #size-cells == %d.\n\r", ns);
+
 		if (getprop(node, "#cpumask-cells", &cpu_nodes, sizeof(cpu_nodes)) < 0)
 			cpu_nodes = 1;
-		cpu_nodes = fdt32_to_cpu(cpu_nodes);
+		else
+			cpu_nodes = fdt32_to_cpu(cpu_nodes);
+		if (cpu_nodes < 1 || cpu_nodes > 4)
+			printk("Can't cope with #cpumask-cells == %d.\n\r", ns);
 	}
 
 	node = finddevice("/doms/dom@0/memory");
-- 
1.7.0.4

