From ed7461d86a7dca54c2903c57c238667ee56d1334 Mon Sep 17 00:00:00 2001
From: Zi Shen Lim <zlim@netlogicmicro.com>
Date: Fri, 20 Jan 2012 18:38:02 -0800
Subject: [PATCH 525/761] smp.c cleanup

Based on Broadcom SDK 2.3.

Signed-off-by: Zi Shen Lim <zlim@netlogicmicro.com>
Signed-off-by: Yanjiang Jin <yanjiang.jin@windriver.com>
---
 arch/mips/kernel/smp.c       |    7 -------
 arch/mips/netlogic/xlp/smp.c |    1 +
 2 files changed, 1 insertion(+), 7 deletions(-)

diff --git a/arch/mips/kernel/smp.c b/arch/mips/kernel/smp.c
index 34b973a..f10f5f4 100644
--- a/arch/mips/kernel/smp.c
+++ b/arch/mips/kernel/smp.c
@@ -107,13 +107,7 @@ asmlinkage __cpuinit void start_secondary(void)
 	cpu_probe();
 	cpu_report();
 	per_cpu_trap_init();
-#ifdef CONFIG_NLM_XLP
-	if (mips_clockevent_init() != 0) {
-		printk("[%s]: unable to setup timer interrupt!!\n", __FUNCTION__);
-	}
-#else
 	mips_clockevent_init();
-#endif
 	mp_ops->init_secondary();
 
 	/*
@@ -121,7 +115,6 @@ asmlinkage __cpuinit void start_secondary(void)
 	 * to an option instead of something based on .cputype
 	 */
 
-	local_irq_enable();
 	calibrate_delay();
 	preempt_disable();
 	cpu = smp_processor_id();
diff --git a/arch/mips/netlogic/xlp/smp.c b/arch/mips/netlogic/xlp/smp.c
index 7f1b840..38740b6 100644
--- a/arch/mips/netlogic/xlp/smp.c
+++ b/arch/mips/netlogic/xlp/smp.c
@@ -128,6 +128,7 @@ static void __cpuinit nlm_init_secondary(void)
 
 void nlm_smp_finish(void)
 {
+	local_irq_enable();
 }
 
 void nlm_cpus_done(void)
-- 
1.7.10.4

