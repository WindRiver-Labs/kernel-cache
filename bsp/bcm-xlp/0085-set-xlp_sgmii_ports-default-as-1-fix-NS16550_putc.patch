From 7ffe5fb1039f2c1c464edb35311d852261e7751a Mon Sep 17 00:00:00 2001
From: henry shao <hshao@netlogicmicro.com>
Date: Thu, 1 Jul 2010 18:40:09 -0700
Subject: [PATCH 085/762] set xlp_sgmii_ports default as 1, fix NS16550_putc

Based on Broadcom SDK 2.3.

Signed-off-by: henry shao <hshao@netlogicmicro.com>
Signed-off-by: Yanjiang Jin <yanjiang.jin@windriver.com>
---
 arch/mips/netlogic/xlp/setup.c |   14 ++++++++++----
 1 files changed, 10 insertions(+), 4 deletions(-)

diff --git a/arch/mips/netlogic/xlp/setup.c b/arch/mips/netlogic/xlp/setup.c
index 8ea634e..077c2e8 100644
--- a/arch/mips/netlogic/xlp/setup.c
+++ b/arch/mips/netlogic/xlp/setup.c
@@ -162,8 +162,9 @@ EXPORT_SYMBOL(chip_is_xls_b0);
 EXPORT_SYMBOL(chip_is_xls6xx_b0);
 EXPORT_SYMBOL(chip_is_xls4xx_b0);
 
-int xlp_sgmii_ports = 0;
+int xlp_sgmii_ports = 1;
 EXPORT_SYMBOL(xlp_sgmii_ports);
+uint32_t xlp_linux_cpu_mask;
 
 /* Environment Variables
  */
@@ -579,7 +580,8 @@ static int fdt_process(void)
 	if (!onlinemask) 
 		/* something went wrong ? */
 		onlinemask = 0x1;
-
+	
+	xlp_linux_cpu_mask = onlinemask;
 	return 0;
 }
 #else
@@ -620,8 +622,12 @@ void prom_free_prom_memory(void)
 #ifdef CONFIG_EARLY_PRINTK
 static void NS16550_putc(char c)
 {
-        nlm_hal_write_32bit_reg(xlp_uart_0_base, 0x0, c);
-	netlogic_write_reg(mmio, 0x0, c);
+        nlm_reg_t *mmio =
+                netlogic_io_mmio(NETLOGIC_IO_UART_0_OFFSET);
+
+        while (netlogic_read_reg( mmio, 0x5) == 0);
+        	netlogic_write_reg( mmio, 0x0, c);
+
 }
 
 void prom_putchar(char c)
-- 
1.7.0.4

