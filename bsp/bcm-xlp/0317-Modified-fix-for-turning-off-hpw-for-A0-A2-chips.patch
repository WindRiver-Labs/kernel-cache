From a2e8c2e4466ebcba31ee986403a1e1dd69d5af8b Mon Sep 17 00:00:00 2001
From: Ryan Emmett <remmett@netlogicmicro.com>
Date: Mon, 27 Jun 2011 11:28:37 -0700
Subject: [PATCH 317/762] Modified fix for turning off hpw for A0-A2 chips

Based on Broadcom SDK 2.3.

Signed-off-by: Ryan Emmett <remmett@netlogicmicro.com>
Signed-off-by: Yanjiang Jin <yanjiang.jin@windriver.com>
---
 arch/mips/netlogic/xlp/mmu.c |    6 ++++--
 1 files changed, 4 insertions(+), 2 deletions(-)

diff --git a/arch/mips/netlogic/xlp/mmu.c b/arch/mips/netlogic/xlp/mmu.c
index cc927eb..dd7a002 100644
--- a/arch/mips/netlogic/xlp/mmu.c
+++ b/arch/mips/netlogic/xlp/mmu.c
@@ -176,10 +176,12 @@ static void pgwalker_workaround_setup(void)
 	chip_id = (prid >> 8) & 0xff;
 	rev_id  = prid & 0xff;
 
-	/* Disable hardware page walker for XLP832 (with fake chip id),
+	/* Disable hardware page walker for XLP A0/1/2 chips (832-408), 
 	 * Revision A0/A1/A2 chips.
 	 */
-	if (chip_id == 0x0) {
+	if (chip_id == CHIP_PROCESSOR_ID_XLP_8XX || chip_id == CHIP_PROCESSOR_ID_XLP_832 
+	|| chip_id == CHIP_PROCESSOR_ID_XLP_816 || chip_id == CHIP_PROCESSOR_ID_XLP_432 
+	|| chip_id == CHIP_PROCESSOR_ID_XLP_416 || chip_id == CHIP_PROCESSOR_ID_XLP_408) {
 		if (rev_id == XLP_REVISION_A0 || rev_id == XLP_REVISION_A1
 			|| rev_id == XLP_REVISION_A2)
 			tlb_config &= ~ENABLE_PGWALKER;
-- 
1.7.0.4

