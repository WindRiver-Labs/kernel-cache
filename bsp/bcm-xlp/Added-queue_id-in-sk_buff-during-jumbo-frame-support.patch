From 26ed352b5315e8e591211feb0c2fa3fb836253bd Mon Sep 17 00:00:00 2001
From: Rahul Jain <rajain@netlogicmicro.com>
Date: Fri, 27 Jan 2012 15:04:47 +0530
Subject: [PATCH 541/761] Added queue_id in sk_buff during jumbo frame support
 in nae-perf

Based on Broadcom SDK 2.3.

Signed-off-by: Rahul Jain <rajain@netlogicmicro.com>
Signed-off-by: Yanjiang Jin <yanjiang.jin@windriver.com>
---
 include/linux/skbuff.h |    3 ++-
 net/core/skbuff.c      |    3 +++
 2 files changed, 5 insertions(+), 1 deletion(-)

diff --git a/include/linux/skbuff.h b/include/linux/skbuff.h
index ec07237..1750471 100644
--- a/include/linux/skbuff.h
+++ b/include/linux/skbuff.h
@@ -493,7 +493,8 @@ struct sk_buff {
 	unsigned int		truesize;
 	atomic_t		users;
 #ifdef CONFIG_NLM_NET_OPTS
-	struct sk_buff *netl_skb;
+	struct sk_buff 		*netl_skb;
+	unsigned int 		queue_id;
 #endif
 };
 
diff --git a/net/core/skbuff.c b/net/core/skbuff.c
index bb0c468..e3758db 100644
--- a/net/core/skbuff.c
+++ b/net/core/skbuff.c
@@ -215,6 +215,7 @@ struct sk_buff *__alloc_skb(unsigned int size, gfp_t gfp_mask,
 	skb->end = skb->tail + size;
 #ifdef CONFIG_NLM_NET_OPTS
 	skb->netl_skb = NULL;
+	skb->queue_id = -1;
 #endif
 #ifdef NET_SKBUFF_DATA_USES_OFFSET
 	skb->mac_header = ~0U;
@@ -238,6 +239,7 @@ struct sk_buff *__alloc_skb(unsigned int size, gfp_t gfp_mask,
 		child->fclone = SKB_FCLONE_UNAVAILABLE;
 #ifdef CONFIG_NLM_NET_OPTS
 		child->netl_skb = NULL;
+		child->queue_id = -1;
 #endif
 	}
 out:
@@ -603,6 +605,7 @@ static void __copy_skb_header(struct sk_buff *new, const struct sk_buff *old)
 #endif
 #ifdef CONFIG_NLM_NET_OPTS
 	new->netl_skb = NULL;
+	new->queue_id = -1;
 #endif
 	memcpy(new->cb, old->cb, sizeof(old->cb));
 	new->csum		= old->csum;
-- 
1.7.10.4

