From bc5f2e5726842f64a6f5cd897043d96e141a6b39 Mon Sep 17 00:00:00 2001
From: Alexander Smirnov <asmirnov@embeddedalley.com>
Date: Mon, 29 Dec 2008 18:49:39 +0300
Subject: [PATCH] Add RTC support for i.MX27ads

Add RTC support for i.MX27ads

Signed-off-by: Alexander Smirnov <asmirnov@embeddedalley.com>
---
 arch/arm/mach-mx2/devices.c |   24 ++++++++++++++++++++++++
 arch/arm/mach-mx2/devices.h |    1 +
 arch/arm/mach-mx2/mx27ads.c |    1 +
 3 files changed, 26 insertions(+), 0 deletions(-)

diff --git a/arch/arm/mach-mx2/devices.c b/arch/arm/mach-mx2/devices.c
index 0207be3..78bd8f7 100644
--- a/arch/arm/mach-mx2/devices.c
+++ b/arch/arm/mach-mx2/devices.c
@@ -341,6 +341,30 @@ struct platform_device mxc_wdt = {
 	.resource = mxc_wdt_resources,
 };
 
+/* RTC:
+ * - i.MX1
+ * - i.MX21
+ * - i.MX27
+ */
+static struct resource mxc_rtc_resources[] = {
+	{
+		.start	= RTC_BASE_ADDR,
+		.end	= RTC_BASE_ADDR + 0x30,
+		.flags	= IORESOURCE_MEM,
+	}, {
+		.start	= MXC_INT_RTC,
+		.end	= MXC_INT_RTC,
+		.flags	= IORESOURCE_IRQ,
+	},
+};
+
+struct platform_device mxc_rtc = {
+	.name = "mxc_rtc",
+	.id = 0,
+	.num_resources = ARRAY_SIZE(mxc_rtc_resources),
+	.resource = mxc_rtc_resources,
+};
+
 static struct resource mxc_nand_resources[] = {
 	{
 		.start	= NFC_BASE_ADDR,
diff --git a/arch/arm/mach-mx2/devices.h b/arch/arm/mach-mx2/devices.h
index 07b7cd5..e228b91 100644
--- a/arch/arm/mach-mx2/devices.h
+++ b/arch/arm/mach-mx2/devices.h
@@ -5,6 +5,7 @@ extern struct platform_device mxc_gpt3;
 extern struct platform_device mxc_gpt4;
 extern struct platform_device mxc_gpt5;
 extern struct platform_device mxc_wdt;
+extern struct platform_device mxc_rtc;
 extern struct platform_device mxc_irda_device;
 extern struct platform_device mxc_uart_device0;
 extern struct platform_device mxc_uart_device1;
diff --git a/arch/arm/mach-mx2/mx27ads.c b/arch/arm/mach-mx2/mx27ads.c
index 222e5f0..b2e2699 100644
--- a/arch/arm/mach-mx2/mx27ads.c
+++ b/arch/arm/mach-mx2/mx27ads.c
@@ -640,6 +640,7 @@ static void __init mx27ads_board_init(void)
 				ARRAY_SIZE(mx27ads_spi_board_info));
 #endif
 	mxc_register_device(&mxc_wdt, NULL);
+	mxc_register_device(&mxc_rtc, NULL);
 
 	platform_add_devices(platform_devices, ARRAY_SIZE(platform_devices));
 }
-- 
1.6.0.3

