From c7d0ad828b568ce2fef2cca0fdb70ac60865d2e9 Mon Sep 17 00:00:00 2001
From: Wang Hui <Hui.Wang@windriver.com>
Date: Wed, 27 May 2009 09:58:40 +0800
Subject: [PATCH 61/77] mxc_nor: fix mtd-nor partitions parse defect

mtd-nor partitions parser will return 0 when no partitions are found,
or return -1 when parser encounter an error. If one of these two
situation occurs, the driver should try the pre-defined partitions
maps defined in platform device level.

Signed-off-by: Wang Hui <Hui.Wang@windriver.com>
---
 drivers/mtd/maps/mxc_nor.c |    2 +-
 1 files changed, 1 insertions(+), 1 deletions(-)

diff --git a/drivers/mtd/maps/mxc_nor.c b/drivers/mtd/maps/mxc_nor.c
index 30b5ce3..daa5b32 100644
--- a/drivers/mtd/maps/mxc_nor.c
+++ b/drivers/mtd/maps/mxc_nor.c
@@ -91,7 +91,7 @@ static int __devinit mxcflash_probe(struct platform_device *pdev)
 		parse_mtd_partitions(info->mtd, part_probes, &info->parts, 0);
 	if (nr_parts > 0) {
 		add_mtd_partitions(info->mtd, info->parts, nr_parts);
-	} else if (nr_parts < 0 && flash->parts) {
+	} else if (nr_parts <= 0 && flash->parts) {
 		add_mtd_partitions(info->mtd, flash->parts, flash->nr_parts);
 	} else
 #endif
-- 
1.6.3.1

