From ff709d689a49339f1c80c241e5461960af48364b Mon Sep 17 00:00:00 2001
From: Wang Hui <Hui.Wang@windriver.com>
Date: Wed, 27 May 2009 09:58:51 +0800
Subject: [PATCH 70/77] imx27_mach/TVout: modify clock set method for TVout function

The TVout will only work when a valid clock rate for the controller
is selected. For the clock rate to be valid, the parent clock rate
has to be divisible by the selected rate.  There is already an
existing function that rounds the requested rate to the nearest
valid rate -- this just makes use of that function.

Signed-off-by: Wang Hui <Hui.Wang@windriver.com>
---
 arch/arm/mach-mx2/mx27ads.c |    6 ++++--
 1 files changed, 4 insertions(+), 2 deletions(-)

diff --git a/arch/arm/mach-mx2/mx27ads.c b/arch/arm/mach-mx2/mx27ads.c
index a56e8a4..4a06b3b 100644
--- a/arch/arm/mach-mx2/mx27ads.c
+++ b/arch/arm/mach-mx2/mx27ads.c
@@ -1657,8 +1657,10 @@ static void __init mx27ads_board_init(void)
 		fb_clk = clk_get(NULL, "lcdc_clk");
 		if (IS_ERR(fb_clk))
 			printk(KERN_ERR "Unable to set lcdc_clk to 133MHz\n");
-		else
-			clk_set_rate(fb_clk, 133000000);
+		else {
+			u32 rate = clk_round_rate(fb_clk, 134000000);
+			clk_set_rate(fb_clk, rate);
+		}
 		clk_put(fb_clk);
 	}
 #endif
-- 
1.6.3.1

