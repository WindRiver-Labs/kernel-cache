From c8b50d9f3bdf01daec19a259b4fa2a26734e4129 Mon Sep 17 00:00:00 2001
From: Weiwei Wang <weiwei.wang@windriver.com>
Date: Wed, 17 Jun 2009 17:32:05 +0800
Subject: [PATCH 77/77] mx27ads: fix up board specific code for isp1301

Marcos for isp1301 usb host and udc are mismatched,
switch them back here. And also add usb clock check
function in isp1301 udc init function.

Signed-off-by: Weiwei Wang <weiwei.wang@windriver.com>
---
 arch/arm/mach-mx2/mx27ads.c |    7 +++++--
 1 files changed, 5 insertions(+), 2 deletions(-)

diff --git a/arch/arm/mach-mx2/mx27ads.c b/arch/arm/mach-mx2/mx27ads.c
index 2bc7d8d..d7808d4 100644
--- a/arch/arm/mach-mx2/mx27ads.c
+++ b/arch/arm/mach-mx2/mx27ads.c
@@ -1468,12 +1468,15 @@ static int mxc_otg_pins[] = {
 	PB23_PF_USB_PWR,
 };
 
-#if defined(CONFIG_USB_EHCI_ARC_OTGFS) && defined(CONFIG_I2C)
+#if defined(CONFIG_USB_GADGET_ARC_OTGFS) && defined(CONFIG_I2C)
 static int mx27ads_1301_udc_init(struct platform_device *pdev)
 {
 	int ret;
 	uint32_t temp;
 
+	if (check_usbclk() != 0)
+		return -EINVAL;
+
 	ret = mxc_gpio_setup_multiple_pins(mxc_otg_pins,
 					   ARRAY_SIZE(mxc_otg_pins),
 					   MXC_GPIO_ALLOC_MODE_NORMAL,
@@ -1533,7 +1536,7 @@ struct fsl_usb2_platform_data pdata_1301_udc = {
 };
 #endif
 
-#if defined(CONFIG_USB_GADGET_ARC_OTGFS) && defined(CONFIG_I2C)
+#if defined(CONFIG_USB_EHCI_ARC_OTGFS) && defined(CONFIG_I2C)
 static int mx27ads_1301_host_init(void)
 {
 	int ret;
-- 
1.6.3.1

