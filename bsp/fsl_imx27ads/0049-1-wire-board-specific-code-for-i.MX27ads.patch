From 72dbb5ab566b7949b53900d46482734263c1c9b3 Mon Sep 17 00:00:00 2001
From: Alexander Smirnov <asmirnov@embeddedalley.com>
Date: Mon, 29 Dec 2008 22:53:36 +0300
Subject: [PATCH] 1-wire board specific code for i.MX27ads

1-wire board specific code for i.MX27ads

Signed-off-by: Alexander Smirnov <asmirnov@embeddedalley.com>
---
 arch/arm/mach-mx2/mx27ads.c |   31 +++++++++++++++++++++++++++++++
 1 files changed, 31 insertions(+), 0 deletions(-)

diff --git a/arch/arm/mach-mx2/mx27ads.c b/arch/arm/mach-mx2/mx27ads.c
index 4e6bbb3..5a82812 100644
--- a/arch/arm/mach-mx2/mx27ads.c
+++ b/arch/arm/mach-mx2/mx27ads.c
@@ -1050,6 +1050,34 @@ struct mxc_usb2_platform_data ehci2_pdata = {
 };
 #endif
 
+#ifdef CONFIG_W1_MASTER_MXC
+static struct platform_device mx27ads_w1_device = {
+	.name = "mxc_w1",
+	.id = 0
+};
+
+static int mxc_owire_pins[] = {
+	PE16_AF_RTCK
+};
+
+void gpio_owire_active(void)
+{
+	mxc_gpio_setup_multiple_pins(mxc_owire_pins,
+			ARRAY_SIZE(mxc_owire_pins),
+			MXC_GPIO_ALLOC_MODE_NORMAL, "1-WIRE");
+}
+EXPORT_SYMBOL(gpio_owire_active);
+
+void gpio_owire_inactive(void)
+{
+	mxc_gpio_setup_multiple_pins(mxc_owire_pins,
+			ARRAY_SIZE(mxc_owire_pins),
+			MXC_GPIO_ALLOC_MODE_RELEASE, "1-WIRE");
+}
+EXPORT_SYMBOL(gpio_owire_inactive);
+
+#endif /* W1_MASTER_MXC */
+
 static struct platform_device *platform_devices[] __initdata = {
 	&mx27ads_nor_mtd_device,
 #ifdef CONFIG_SND
@@ -1058,6 +1086,9 @@ static struct platform_device *platform_devices[] __initdata = {
 #ifdef CONFIG_KEYBOARD_MXC
 	&mx27ads_keypad_device,
 #endif /* KEYBOARD_MXC */
+#ifdef CONFIG_W1_MASTER_MXC
+	&mx27ads_w1_device,
+#endif /* W1_MASTER_MXC */
 };
 
 static void __init mx27ads_board_init(void)
-- 
1.6.0.3

