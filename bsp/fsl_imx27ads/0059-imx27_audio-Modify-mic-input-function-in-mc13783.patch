From 8603655a55087ca8555c4cca72eb1c6ce41c292d Mon Sep 17 00:00:00 2001
From: Wang Hui <Hui.Wang@windriver.com>
Date: Wed, 27 May 2009 09:58:38 +0800
Subject: [PATCH 59/77] imx27_audio: Modify mic input function in mc13783

As the mc13783 hardware document point out, when recording voice
via mc13783's MIC module, the bias voltage should be applied by
setting corresponding registers.

Signed-off-by: Wang Hui <Hui.Wang@windriver.com>
---
 sound/arm/mc13783.c |   18 ++++++++++--------
 1 files changed, 10 insertions(+), 8 deletions(-)

diff --git a/sound/arm/mc13783.c b/sound/arm/mc13783.c
index ff1d475..45e668f 100644
--- a/sound/arm/mc13783.c
+++ b/sound/arm/mc13783.c
@@ -390,6 +390,8 @@ static int mc13783_get_capture(struct snd_kcontrol *kcontrol,
         return 0;
 }
 
+#define MIC1BEN (1 << 0)
+#define MIC2BEN (1 << 1)
 #define AMC1REN (1 << 5)
 #define AMC2EN  (1 << 9)
 #define ATXINEN (1 << 11)
@@ -405,7 +407,7 @@ static int mc13783_put_capture(struct snd_kcontrol *kcontrol,
 
 	change = (mc13783_capure_cache != ucontrol->value.enumerated.item[0]);
 	mc13783_capure_cache = ucontrol->value.enumerated.item[0];
-	r38 &= ~(AMC1REN | AMC2EN | ATXINEN | RXINREC | AMC1LEN);
+	r38 &= ~(MIC1BEN | MIC2BEN | AMC1REN | AMC2EN | ATXINEN | RXINREC | AMC1LEN);
 	printk("%s: %d\n", __func__, mc13783_capure_cache);
 	switch (mc13783_capure_cache) {
 	case 0:
@@ -414,28 +416,28 @@ static int mc13783_put_capture(struct snd_kcontrol *kcontrol,
 		r38 |= RXINREC;
 		break;
 	case 2:
-		r38 |= AMC1REN | AMC1LEN;
+		r38 |= AMC1REN | AMC1LEN | MIC1BEN;
 		break;
 	case 3:
-		r38 |= AMC1REN;
+		r38 |= AMC1REN | MIC1BEN;
 		break;
 	case 4:
-		r38 |= AMC2EN;
+		r38 |= AMC2EN | MIC2BEN;
 		break;
 	case 5:
-		r38 |= AMC1LEN | AMC2EN;
+		r38 |= AMC1LEN | AMC2EN | MIC1BEN | MIC2BEN;
 		break;
 	case 6:
 		r38 |= ATXINEN;
 		break;
 	case 7:
-		r38 |= AMC1LEN | ATXINEN;
+		r38 |= AMC1LEN | ATXINEN | MIC1BEN;
 		break;
 	case 8:
-		r38 |= AMC1LEN | RXINREC;
+		r38 |= AMC1LEN | RXINREC | MIC1BEN;
 		break;
 	case 9:
-		r38 |= AMC1LEN;
+		r38 |= AMC1LEN | MIC1BEN;
 		break;
 	default:
 		break;
-- 
1.6.3.1

