From 8c7d227de9c9c4917cd03618bd06a22987f70b42 Mon Sep 17 00:00:00 2001
From: Alexander Smirnov <asmirnov@embeddedalley.com>
Date: Mon, 29 Dec 2008 20:00:49 +0300
Subject: [PATCH] MX27: Add USB resources and platform devices

Add USB OTG and EHCI resources and platform devices for the i.mx27ads.

Signed-off-by: Sascha Hauer <s.hauer@pengutronix.de>
Signed-off-by: Alexander Smirnov <asmirnov@embeddedalley.com>

Merged from pengutronix.de
---
 arch/arm/mach-mx2/devices.c |   73 +++++++++++++++++++++++++++++++++++++++++++
 arch/arm/mach-mx2/devices.h |    4 ++-
 2 files changed, 76 insertions(+), 1 deletions(-)

diff --git a/arch/arm/mach-mx2/devices.c b/arch/arm/mach-mx2/devices.c
index 78bd8f7..902aba3 100644
--- a/arch/arm/mach-mx2/devices.c
+++ b/arch/arm/mach-mx2/devices.c
@@ -521,6 +521,79 @@ struct platform_device mxc_dam_device = {
 	.resource = &mxc_dam_resources
 };
 
+static u64 otg_dmamask = ~(u32) 0;
+
+static struct resource mxc_otg_resources[] = {
+	{
+		.start = OTG_BASE_ADDR + 0x000,
+		.end   = OTG_BASE_ADDR + 0x1ff,
+		.flags = IORESOURCE_MEM,
+	}, {
+		.start = MXC_INT_USB1,
+		.flags = IORESOURCE_IRQ,
+	},
+};
+
+struct platform_device mxc_otg = {
+	.name = "mxc-ehci",
+	.id = 0,
+	.dev = {
+		.coherent_dma_mask = 0xffffffff,
+		.dma_mask = &otg_dmamask,
+	},
+	.resource = mxc_otg_resources,
+	.num_resources = ARRAY_SIZE(mxc_otg_resources),
+};
+
+static struct resource mxc_ehci1_resources[] = {
+	{
+		.start = OTG_BASE_ADDR + 0x200,
+		.end   = OTG_BASE_ADDR + 0x3ff,
+		.flags = IORESOURCE_MEM,
+	}, {
+		.start = MXC_INT_USB1,
+		.flags = IORESOURCE_IRQ,
+	},
+};
+
+static u64 ehci1_dmamask = ~(u32) 0;
+
+struct platform_device mxc_ehci1 = {
+	.name = "mxc-ehci",
+	.id = 0,
+	.dev = {
+		.coherent_dma_mask = 0xffffffff,
+		.dma_mask = &ehci1_dmamask,
+	},
+	.num_resources = ARRAY_SIZE(mxc_ehci1_resources),
+	.resource = mxc_ehci1_resources,
+};
+
+static struct resource mxc_ehci2_resources[] = {
+	{
+		.start = OTG_BASE_ADDR + 0x400,
+		.end   = OTG_BASE_ADDR + 0x5ff,
+		.flags = IORESOURCE_MEM,
+	}, {
+		.start = MXC_INT_USB2,
+		.flags = IORESOURCE_IRQ,
+	},
+};
+
+static u64 ehci2_dmamask = ~(u32) 0;
+
+struct platform_device mxc_ehci2 = {
+	.name = "mxc-ehci",
+	.id = 1,
+	.dev = {
+		.coherent_dma_mask = 0xffffffff,
+		.dma_mask = &ehci2_dmamask,
+	},
+	.num_resources = ARRAY_SIZE(mxc_ehci2_resources),
+	.resource = mxc_ehci2_resources,
+};
+
+
 /* GPIO port description */
 static struct mxc_gpio_port imx_gpio_ports[] = {
 	[0] = {
diff --git a/arch/arm/mach-mx2/devices.h b/arch/arm/mach-mx2/devices.h
index e228b91..6ceedcd 100644
--- a/arch/arm/mach-mx2/devices.h
+++ b/arch/arm/mach-mx2/devices.h
@@ -25,4 +25,6 @@ extern struct platform_device mxc_fb_device;
 extern struct platform_device imx_ssi_device0;
 extern struct platform_device imx_ssi_device1;
 extern struct platform_device mxc_dam_device;
-
+extern struct platform_device mxc_otg;
+extern struct platform_device mxc_ehci1;
+extern struct platform_device mxc_ehci2;
-- 
1.6.0.3

