From 87ca234ea06c6f871795b0b02c06c052d6289b81 Mon Sep 17 00:00:00 2001
From: Wang Hui <Hui.Wang@windriver.com>
Date: Wed, 27 May 2009 09:58:43 +0800
Subject: [PATCH] imx27_lcd: fix pm interface defect in lcd driver

The imxfb_info is not returned by platform_get_drvdata() but
rather is the value of the 'par' member of the fb_info structure.
This change not only fix the compile warnings, but also prevent
kernel crash when calling these two functions.

Signed-off-by: Wang Hui <Hui.Wang@windriver.com>
---
 drivers/video/imxfb.c |   10 ++++++----
 1 files changed, 6 insertions(+), 4 deletions(-)

diff --git a/drivers/video/imxfb.c b/drivers/video/imxfb.c
index 1a1cbca..6a3bf28 100644
--- a/drivers/video/imxfb.c
+++ b/drivers/video/imxfb.c
@@ -525,21 +525,23 @@ static void imxfb_setup_display(struct imxfb_info *fbi)
  */
 static int imxfb_suspend(struct platform_device *dev, pm_message_t state)
 {
-	struct imxfb_info *fbi = platform_get_drvdata(dev);
+	struct fb_info *fbi = platform_get_drvdata(dev);
+	struct imxfb_info *fb_info = fbi->par;
 
 	pr_debug("%s\n", __func__);
 
-	imxfb_disable_controller(fbi);
+	imxfb_disable_controller(fb_info);
 	return 0;
 }
 
 static int imxfb_resume(struct platform_device *dev)
 {
-	struct imxfb_info *fbi = platform_get_drvdata(dev);
+	struct fb_info *fbi = platform_get_drvdata(dev);
+	struct imxfb_info *fb_info = fbi->par;
 
 	pr_debug("%s\n", __func__);
 
-	imxfb_enable_controller(fbi);
+	imxfb_enable_controller(fb_info);
 	return 0;
 }
 #else
-- 
1.5.5.1

