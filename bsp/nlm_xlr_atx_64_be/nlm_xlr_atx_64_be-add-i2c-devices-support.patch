From 59877c694ca6a486f9aa1215d97390b886e178e2 Mon Sep 17 00:00:00 2001
From: Wu Zhangjin <zhangjin.wu@windriver.com>
Date: Mon, 6 Dec 2010 20:17:40 +0800
Subject: [PATCH 21/47] nlm_xlr_atx_64_be: add i2c devices support

Two i2c devices are enabled:
	o ds1374 RTC
	o max6657 temperature sensor, it is lm90 compatible

Signed-off-by: Wu Zhangjin <zhangjin.wu@windriver.com>
---
 arch/mips/rmi/phoenix/Makefile   |    2 +-
 arch/mips/rmi/phoenix/platform.c |   36 ++++++++++++++++++++++++++++++++++++
 2 files changed, 37 insertions(+), 1 deletions(-)
 create mode 100644 arch/mips/rmi/phoenix/platform.c

diff --git a/arch/mips/rmi/phoenix/Makefile b/arch/mips/rmi/phoenix/Makefile
index e37ffaa..422e7b1 100644
--- a/arch/mips/rmi/phoenix/Makefile
+++ b/arch/mips/rmi/phoenix/Makefile
@@ -1,4 +1,4 @@
-obj-y := irq.o cpu.o time.o memory.o on_chip.o msgring.o
+obj-y := irq.o cpu.o time.o memory.o on_chip.o msgring.o platform.o
 
 obj-$(CONFIG_SMP) += smp.o
 
diff --git a/arch/mips/rmi/phoenix/platform.c b/arch/mips/rmi/phoenix/platform.c
new file mode 100644
index 0000000..b59c868
--- /dev/null
+++ b/arch/mips/rmi/phoenix/platform.c
@@ -0,0 +1,36 @@
+/*
+ * This file is subject to the terms and conditions of the GNU General Public
+ * License.  See the file "COPYING" in the main directory of this archive
+ * for more details.
+ *
+ * Copyright (C) 2010 Wind River Systems,
+ * Author: Wu Zhangjin <zhangjin.wu@windriver.com>
+ */
+
+#include <linux/i2c.h>
+
+static struct i2c_board_info rmi_i2c_info[] __initdata = {
+	{
+		I2C_BOARD_INFO("ds1374", 0x68),
+	},
+	{
+		I2C_BOARD_INFO("lm90", 0x4c),
+	},
+};
+
+int xlr_platform_init(void)
+{
+	int err;
+
+	pr_info("%s: Register I2C RTC ds1374@0x68 & Tempearture Sensor max6657@0x4c.\n", __func__);
+
+	err = i2c_register_board_info(0, rmi_i2c_info,
+			ARRAY_SIZE(rmi_i2c_info));
+
+	if (err < 0)
+		pr_err("phoenix-i2c: cannot register board I2C devices\n");
+
+	return err;
+}
+
+arch_initcall(xlr_platform_init);
-- 
1.7.0.4

