From 79440da33b49ee1a8372f151a18eac3cf6c82af1 Mon Sep 17 00:00:00 2001
From: Jack Tan <jack.tan@windriver.com>
Date: Wed, 19 May 2010 23:57:28 +0800
Subject: [PATCH 14/47] nlm_xlr_atx_64_be: add arch kconfig and makefile support

The XLR's configuration and building system support.

Signed-off-by: Jack Tan <jack.tan@windriver.com>
---
 arch/mips/Kconfig  |   38 ++++++++++++++++++++++++++++++++++++++
 arch/mips/Makefile |   12 ++++++++++++
 2 files changed, 50 insertions(+), 0 deletions(-)

diff --git a/arch/mips/Kconfig b/arch/mips/Kconfig
index cf2a482..67f5c2c 100644
--- a/arch/mips/Kconfig
+++ b/arch/mips/Kconfig
@@ -682,6 +682,30 @@ config CAVIUM_OCTEON_REFERENCE_BOARD
 		Hikari
 	  Say Y here for most Octeon reference boards.
 
+config RMI_PTR
+	bool "Support for RMI ATX I/II board"
+	depends on EXPERIMENTAL
+	select SMP
+	select BOOT_ELF32
+	select RMI_PHOENIX
+	select SYS_HAS_CPU_PHOENIX
+	select SYS_SUPPORTS_SMP
+	select HW_HAS_PCI
+	select SWAP_IO_SPACE
+	select SYS_SUPPORTS_32BIT_KERNEL
+	select SYS_SUPPORTS_64BIT_KERNEL
+	select SYS_SUPPORTS_BIG_ENDIAN
+	select SYS_SUPPORTS_HIGHMEM
+	select DMA_COHERENT
+	select CEVT_R4K
+	select CSRC_R4K
+	select IRQ_CPU
+	select ZONE_DMA if 64BIT
+	select SYNC_R4K
+	help
+	  This board is based on RMI XLR processor(XLR732 Rev C4).
+	  Say Y here to support this machine type
+
 endchoice
 
 source "arch/mips/alchemy/Kconfig"
@@ -696,6 +720,7 @@ source "arch/mips/txx9/Kconfig"
 source "arch/mips/vr41xx/Kconfig"
 source "arch/mips/cavium-octeon/Kconfig"
 source "arch/mips/loongson/Kconfig"
+source "arch/mips/rmi/Kconfig"
 
 endmenu
 
@@ -1306,6 +1331,16 @@ config CPU_CAVIUM_OCTEON
 	  can have up to 16 Mips64v2 cores and 8 integrated gigabit ethernets.
 	  Full details can be found at http://www.caviumnetworks.com.
 
+config CPU_PHOENIX
+	bool "XLR"
+	depends on SYS_HAS_CPU_PHOENIX
+	select CPU_SUPPORTS_32BIT_KERNEL
+	select CPU_SUPPORTS_64BIT_KERNEL
+	select CPU_SUPPORTS_HIGHMEM
+	select CPU_HAS_LLSC
+	select WEAK_ORDERING
+	select WEAK_REORDERING_BEYOND_LLSC
+
 endchoice
 
 if CPU_LOONGSON2F
@@ -1424,6 +1459,9 @@ config SYS_HAS_CPU_SB1
 config SYS_HAS_CPU_CAVIUM_OCTEON
 	bool
 
+config SYS_HAS_CPU_PHOENIX
+	bool
+
 #
 # CPU may reorder R->R, R->W, W->R, W->W
 # Reordering beyond LL and SC is handled in WEAK_REORDERING_BEYOND_LLSC
diff --git a/arch/mips/Makefile b/arch/mips/Makefile
index efe7fd7..49f2114 100644
--- a/arch/mips/Makefile
+++ b/arch/mips/Makefile
@@ -179,6 +179,8 @@ ifeq (,$(findstring march=octeon, $(cflags-$(CONFIG_CPU_CAVIUM_OCTEON))))
 cflags-$(CONFIG_CPU_CAVIUM_OCTEON) += -Wa,-march=octeon
 endif
 
+cflags-$(CONFIG_CPU_PHOENIX)    += $(call cc-option,-march=xlr) -Wa,--trap -DRMI_BRIDGE_WKAROUND
+
 cflags-$(CONFIG_CPU_R4000_WORKAROUNDS)	+= $(call cc-option,-mfix-r4000,)
 cflags-$(CONFIG_CPU_R4400_WORKAROUNDS)	+= $(call cc-option,-mfix-r4400,)
 cflags-$(CONFIG_CPU_DADDI_WORKAROUNDS)	+= $(call cc-option,-mno-daddi,)
@@ -663,6 +665,16 @@ ifdef CONFIG_PHYSICAL_START
 load-y				= $(CONFIG_PHYSICAL_START)
 endif
 
+# RMI Phoenix SOC
+core-$(CONFIG_RMI_PHOENIX)      += arch/mips/rmi/phoenix/
+
+# RMI PTR board
+core-$(CONFIG_RMI_PTR)          += arch/mips/rmi/ptr/
+cflags-$(CONFIG_RMI_PTR)	+= -Iarch/mips/include/asm/mach-rmi
+cflags-$(CONFIG_CRYPTO_XLR)	+= -Idrivers/crypto/rmi/common
+# This address is now configured via kernel configuration file
+load-$(CONFIG_RMI_PTR)		+= $(CONFIG_RMI_PHOENIX_LOAD_ADDRESS)
+
 cflags-y			+= -I$(srctree)/arch/mips/include/asm/mach-generic
 drivers-$(CONFIG_PCI)		+= arch/mips/pci/
 
-- 
1.7.0.4

