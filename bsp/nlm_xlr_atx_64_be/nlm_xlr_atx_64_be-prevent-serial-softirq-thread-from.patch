From 7d416e4d8bd60f9cceb7cce008addb9321370007 Mon Sep 17 00:00:00 2001
From: Bruce Ashfield <bruce.ashfield@windriver.com>
Date: Sat, 31 Jul 2010 21:50:29 -0400
Subject: [PATCH] nlm_xlr_atx_64_be: prevent serial softirq thread from dropping its binding

Serial irq handlers have been shown to not function correctly when
handled in threads. Add IRQF_NODELAY to prevent threading.

Signed-off-by: Bruce Ashfield <bruce.ashfield@windriver.com>
---
 drivers/serial/8250.c |    6 ++++++
 1 files changed, 6 insertions(+), 0 deletions(-)

diff --git a/drivers/serial/8250.c b/drivers/serial/8250.c
index 49bc04d..dd81d7a 100644
--- a/drivers/serial/8250.c
+++ b/drivers/serial/8250.c
@@ -1847,6 +1847,12 @@ static int serial_link_irq_chain(struct uart_8250_port *up)
 	if (irq_flags & IRQF_SHARED)
 		irq_flags |= IRQF_NODELAY;
 
+#ifdef CONFIG_RMI_PHOENIX
+#if defined(CONFIG_PREEMPT_HARDIRQS) || defined(CONFIG_PREEMPT_SOFTIRQS)
+	irq_flags |= IRQF_NODELAY;
+#endif
+#endif
+
 	mutex_lock(&hash_mutex);
 
 	h = &irq_lists[up->port.irq % NR_IRQ_HASH];
-- 
1.7.0.4

