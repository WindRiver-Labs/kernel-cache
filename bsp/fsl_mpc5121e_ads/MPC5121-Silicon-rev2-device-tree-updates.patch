From 6c6c5589e4b3dd8d99e2e92ffa1fab3f5464cde8 Mon Sep 17 00:00:00 2001
From: Andrew Liu <shengping.liu@windriver.com>
Date: Thu, 18 Jun 2009 15:33:44 +0800
Subject: [PATCH 03/25] MPC5121: Silicon rev2 device tree updates

Original patch taken from rev 4 board support ISO image:
   mpc5121ads-20081208_ltib-beta.iso
   http://www.freescale.com/webapp/sps/site/overview.jsp?
   nodeId=0127260061033202A5621E

Add MSCAN nodes that are new in rev 2.
Change compatible for all mscan nodes to fsl,mpc5121rev2-mscan
so driver can differentiate between old and new versions.

Add new VIU node.

Signed-off-by: John Rigby <jrigby@freescale.com>
Integrated-by: Andrew Liu <shengping.liu@windriver.com>
---
 arch/powerpc/boot/dts/mpc5121ads.dts |   33 +++++++++++++++++++++++++++++----
 1 files changed, 29 insertions(+), 4 deletions(-)

diff --git a/arch/powerpc/boot/dts/mpc5121ads.dts b/arch/powerpc/boot/dts/mpc5121ads.dts
index b81645d..fdbe99c 100644
--- a/arch/powerpc/boot/dts/mpc5121ads.dts
+++ b/arch/powerpc/boot/dts/mpc5121ads.dts
@@ -214,7 +214,7 @@
 		};
 
 		mscan@1300 {
-			compatible = "fsl,mpc5121-mscan";
+			compatible = "fsl,mpc5121rev2-mscan";
 			cell-index = <0>;
 			interrupts = <12 0x8>;
 			interrupt-parent = < &ipic >;
@@ -222,19 +222,19 @@
 		};
 
 		mscan@1380 {
-			compatible = "fsl,mpc5121-mscan";
+			compatible = "fsl,mpc5121rev2-mscan";
 			cell-index = <1>;
 			interrupts = <13 0x8>;
 			interrupt-parent = < &ipic >;
 			reg = <0x1380 0x80>;
 		};
-
+		
 		sdhc@1500 {    //added for sdhc device driver, removed the clk part
 			compatible = "fsl,mpc5121-esdhc";
 			interrupts = <8 0x8>;
 			interrupt-parent = < &ipic >;
 			reg = <0x1500 0x100>;
-		};
+		 };
 
 		i2c@1700 {
 			#address-cells = <1>;
@@ -292,6 +292,31 @@
 			interrupt-parent = < &ipic >;
 		};
 
+		// MPC5121e rev2 silicon has two more CAN ports than rev1
+		// but they are not used on ADS5121
+		//mscan@2300 {
+		//	compatible = "fsl,mpc5121rev2-mscan";
+		//	cell-index = <2>;
+		//	interrupts = <90 0x8>;
+		//	interrupt-parent = < &ipic >;
+		//	reg = <0x2300 0x80>;
+		//};
+
+		//mscan@2380 {
+		//	compatible = "fsl,mpc5121rev2-mscan";
+		//	cell-index = <3>;
+		//	interrupts = <91 0x8>;
+		//	interrupt-parent = < &ipic >;
+		//	reg = <0x2380 0x80>;
+		//};
+
+		viu@2400 {
+			compatible = "fsl,mpc5121-viu";
+			reg = <0x2400 0x400>;
+			interrupts = <67 0x8>;
+			interrupt-parent = < &ipic >;
+		};
+
 		// 5121e has two dr usb modules
 		// mpc5121_ads only uses USB0
 
-- 
1.6.3.1

