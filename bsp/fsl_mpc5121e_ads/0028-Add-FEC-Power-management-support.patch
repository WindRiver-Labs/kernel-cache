From fbd1cc838e415c2876b4d79bbcf857751424145c Mon Sep 17 00:00:00 2001
From: Andrew Liu <shengping.liu@windriver.com>
Date: Tue, 4 Nov 2008 14:46:15 +0800
Subject: [PATCH] Add FEC Power management support

Added suspend/resume methods to fs_enet driver

Signed-off-by: Andrew Liu <shengping.liu@windriver.com>
---
 drivers/net/fs_enet/fs_enet-main.c |   29 +++++++++++++++++++++++++++++
 1 files changed, 29 insertions(+), 0 deletions(-)

diff --git a/drivers/net/fs_enet/fs_enet-main.c b/drivers/net/fs_enet/fs_enet-main.c
index 4c08c8c..31706e1 100644
--- a/drivers/net/fs_enet/fs_enet-main.c
+++ b/drivers/net/fs_enet/fs_enet-main.c
@@ -1169,6 +1169,31 @@ static int fs_enet_remove(struct of_device *ofdev)
 	return 0;
 }
 
+#ifdef CONFIG_PM
+static int fs_enet_suspend(struct of_device *op, pm_message_t state)
+{
+	struct net_device *ndev = dev_get_drvdata(&op->dev);
+
+	if (netif_running(ndev))
+		fs_enet_close(ndev);
+
+	return 0;
+}
+
+static int fs_enet_resume(struct of_device *op)
+{
+	struct net_device *ndev = dev_get_drvdata(&op->dev);
+
+	if (netif_running(ndev))
+		fs_enet_open(ndev);
+
+	return 0;
+}
+#else
+#define fs_enet_suspend	NULL
+#define fs_enet_resume	NULL
+#endif
+
 static struct of_device_id fs_enet_match[] = {
 #ifdef CONFIG_FS_ENET_HAS_SCC
 	{
@@ -1200,6 +1225,10 @@ static struct of_platform_driver fs_enet_driver = {
 	.match_table = fs_enet_match,
 	.probe = fs_enet_probe,
 	.remove = fs_enet_remove,
+#ifdef CONFIG_PM
+	.suspend = fs_enet_suspend,
+	.resume = fs_enet_resume,
+#endif
 };
 
 static int __init fs_init(void)
-- 
1.6.0.90.g436ed

