From 27a60a72aa2d6fd224a67509ebfbc7bf81609dd8 Mon Sep 17 00:00:00 2001
From: Andrew Liu <shengping.liu@windriver.com>
Date: Tue, 4 Nov 2008 14:45:51 +0800
Subject: [PATCH] Enable I2C controller

The I2C of MPC512x uses mpc-i2c(i2c-mpc.c) driver
which is shared by many other boards.

Signed-off-by: Andrew Liu <shengping.liu@windriver.com>
---
 arch/powerpc/platforms/512x/mpc5121_ads.c |   16 ++++++++++++++++
 1 files changed, 16 insertions(+), 0 deletions(-)

diff --git a/arch/powerpc/platforms/512x/mpc5121_ads.c b/arch/powerpc/platforms/512x/mpc5121_ads.c
index 5ebf693..12bb375 100644
--- a/arch/powerpc/platforms/512x/mpc5121_ads.c
+++ b/arch/powerpc/platforms/512x/mpc5121_ads.c
@@ -27,11 +27,27 @@
 
 static void __init mpc5121_ads_setup_arch(void)
 {
+	struct device_node *np;
+	void __iomem *i2cctl;
+
 	printk(KERN_INFO "MPC5121 ADS board from Freescale Semiconductor\n");
 	/*
 	 * cpld regs are needed early
 	 */
 	mpc5121_ads_cpld_map();
+
+	/*
+	 * turn on i2c interrupts
+	 */
+	np = of_find_compatible_node(NULL, NULL, "fsl,mpc5121-i2c-ctrl");
+	if (np) {
+		i2cctl = of_iomap(np, 0);
+		of_node_put(np);
+		if (i2cctl) {
+			out_be32(i2cctl, 0x15000000);
+			iounmap(i2cctl);
+		}
+	}
 }
 
 static void __init mpc5121_ads_init_IRQ(void)
-- 
1.6.0.90.g436ed

