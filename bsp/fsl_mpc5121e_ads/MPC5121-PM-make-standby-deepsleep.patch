From e2d8557ae13e9a28416d6069434c3f9af574890e Mon Sep 17 00:00:00 2001
From: Andrew Liu <shengping.liu@windriver.com>
Date: Tue, 23 Jun 2009 17:00:33 +0800
Subject: [PATCH 17/25] MPC5121 PM: make standby deepsleep

Original patch taken from rev 4 board support ISO image:
  mpc5121ads-20081208_ltib-beta.iso
  http://www.freescale.com/webapp/sps/site/overview.jsp?
  nodeId=0127260061033202A5621E

Changes to earlier PM implementation so that "standby" is now
Deep Sleep Mode instead of "mem", so that "mem" can be used for
Hibernate in later patches.

Also clean up some formatting issues

Signed-off-by: John Rigby <jrigby@freescale.com>
Signed-off-by: Andrew Liu <shengping.liu@windriver.com>
---
 arch/powerpc/platforms/512x/mpc512x_pm.c |   13 +++++++------
 1 files changed, 7 insertions(+), 6 deletions(-)

diff --git a/arch/powerpc/platforms/512x/mpc512x_pm.c b/arch/powerpc/platforms/512x/mpc512x_pm.c
index 7be38a9..267d97f 100644
--- a/arch/powerpc/platforms/512x/mpc512x_pm.c
+++ b/arch/powerpc/platforms/512x/mpc512x_pm.c
@@ -374,8 +374,6 @@ static int mpc512x_pm_prepare(void)
 
 	switch (mpc512x_targeted_state) {
 	case MPC512x_PM_STANDBY:
-		break;
-	case MPC512x_PM_SUSP_MEM:
 		mpc512x_set_ddr_selfrefresh();
 
 		/*
@@ -384,6 +382,8 @@ static int mpc512x_pm_prepare(void)
 		 */
 		mpc512x_set_rtc_wakeup();
 		break;
+	case MPC512x_PM_SUSP_MEM:
+		break;
 	}
 	return 0;
 }
@@ -460,12 +460,13 @@ static int mpc512x_pm_enter(suspend_state_t state)
 
 	switch (mpc512x_targeted_state) {
 	case MPC512x_PM_STANDBY:
-		mpc512x_sleep();
+		mpc512x_enter_deepsleep();
 		break;
 	case MPC512x_PM_SUSP_MEM:
-		mpc512x_enter_deepsleep();
+		printk(KERN_ERR "Suspend to RAM not implemented\n");
 	default:
 		break;
+
 	}
 	return 0;
 }
@@ -483,12 +484,12 @@ static void mpc512x_pm_finish(void)
 {
 	switch (mpc512x_targeted_state) {
 	case MPC512x_PM_STANDBY:
-		break;
-	case MPC512x_PM_SUSP_MEM:
 		/* Restore the DDR and RTC registers on wake-up.*/
 		mpc512x_restore_ddr_regs();
 		mpc512x_restore_rtc_regs();
 		break;
+	case MPC512x_PM_SUSP_MEM:
+		break;
 	}
 	mpc512x_targeted_state = MPC512x_PM_NONE;
 
-- 
1.6.3.1

