From 39789139a9b98911dbdc4b3349ff330a39be5f46 Mon Sep 17 00:00:00 2001
From: Dinh Nguyen <dinguyen@altera.com>
Date: Thu, 11 Oct 2012 15:10:39 -0600
Subject: [PATCH 191/254] mmc: dw-mmc: Interrupt status: Data starvation by

Upstream: git://git.rocketboards.org/linux-socfpga.git
 host timeout (bit-10)

According to Synopsys, the data starvation interrupt (HTO) should not treat
as error. Software should continue the data transfer. We have verified this
in Virtual Target. Remove this fogbugz after verify this in actual
hardware.

Signed-off-by: Ley Foon Tan <lftan@altera.com>
(cherry picked from commit 81d20b05f4c88292c292a8258e3643b24d7120e3)
Signed-off-by: Zumeng Chen <zumeng.chen@windriver.com>
---
 drivers/mmc/host/dw_mmc.c |   18 +++++++++++++++---
 1 files changed, 15 insertions(+), 3 deletions(-)

diff --git a/drivers/mmc/host/dw_mmc.c b/drivers/mmc/host/dw_mmc.c
index a68f796..a0e1758 100644
--- a/drivers/mmc/host/dw_mmc.c
+++ b/drivers/mmc/host/dw_mmc.c
@@ -38,9 +38,21 @@
 #include "dw_mmc.h"
 
 /* Common flag combinations */
-#define DW_MCI_DATA_ERROR_FLAGS	(SDMMC_INT_DTO | SDMMC_INT_DCRC | \
-				 SDMMC_INT_HTO | SDMMC_INT_SBE  | \
-				 SDMMC_INT_EBE)
+
+/* According to Synopsys, the data starvation interrupt (HTO) should not treat
+ * as error. Software should continue the data transfer. We have verified this
+ * in Virtual Target. Remove this fogbugz after verify this in actual
+ * hardware.
+ */
+#ifdef FOGBUGZ_13909
+ #define DW_MCI_DATA_ERROR_FLAGS	(SDMMC_INT_DTO | SDMMC_INT_DCRC | \
+ 				 SDMMC_INT_HTO | SDMMC_INT_SBE  | \
+ 				 SDMMC_INT_EBE)
+#else
+#define DW_MCI_DATA_ERROR_FLAGS (SDMMC_INT_DTO | SDMMC_INT_DCRC | \
+				 SDMMC_INT_SBE | SDMMC_INT_EBE)
+#endif
+
 #define DW_MCI_CMD_ERROR_FLAGS	(SDMMC_INT_RTO | SDMMC_INT_RCRC | \
 				 SDMMC_INT_RESP_ERR)
 #define DW_MCI_ERROR_FLAGS	(DW_MCI_DATA_ERROR_FLAGS | \
-- 
1.7.5.4

