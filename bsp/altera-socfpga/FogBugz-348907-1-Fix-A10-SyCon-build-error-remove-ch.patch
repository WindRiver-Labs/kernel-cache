From 806a1f4e1a60becaafbfc3bc8592496a1664b831 Mon Sep 17 00:00:00 2001
From: Thor Thayer <tthayer@opensource.altera.com>
Date: Tue, 19 Jan 2016 10:44:41 -0600
Subject: [PATCH 44/73] FogBugz #348907-1: Fix A10 SyCon build error - remove
 child->parent select

In this patch, make the children dependent upon MFD_A10SYCON and
remove the selection of MFD_A10SYCON by the children.

A zero day test script discovered a bug when building with allyesconfig.
The dependency tree needed to be cleaned up because the children (Reset
controller, GPIO, HWMON) would select the MFD_A10SYCON config.  The fix
is to make the children dependent upon MFD_A10SYCON config and change
the default config to enable MFD_A10SYCON.

Error message was:
warning: (A10SYCON_RESET && GPIO_A10SYCON && SENSORS_A10_SYCON) selects
 MFD_A10SYSCON which has unmet direct dependencies (HAS_IOMEM &&
 ARCH_SOCFPGA && SPI_MASTER)

Signed-off-by: Thor Thayer <tthayer@opensource.altera.com>
[mli1:Original patch taken from
https://github.com/altera-opensource/linux-socfpga.git socfpga-4.1-ltsi]
Signed-off-by: Meng Li <Meng.Li@windriver.com>
---
 drivers/gpio/Kconfig  |    3 +--
 drivers/hwmon/Kconfig |    2 +-
 drivers/reset/Kconfig |    3 +--
 3 files changed, 3 insertions(+), 5 deletions(-)

diff --git a/drivers/gpio/Kconfig b/drivers/gpio/Kconfig
index 876dd2a..c7f30ba 100644
--- a/drivers/gpio/Kconfig
+++ b/drivers/gpio/Kconfig
@@ -972,8 +972,7 @@ config GPIO_MC33880
 
 config GPIO_A10SYCON
 	tristate "Altera Arria10 System Controller GPIO"
-	depends on ARCH_SOCFPGA
-	select MFD_A10SYCON
+	depends on MFD_A10SYCON
 	help
 	  Driver for Arria10 GPIO expansion which includes reads of
 	  pushbuttons and DIP switches as well as writes to LEDs and
diff --git a/drivers/hwmon/Kconfig b/drivers/hwmon/Kconfig
index 9f55c8d..3a8a0e4 100644
--- a/drivers/hwmon/Kconfig
+++ b/drivers/hwmon/Kconfig
@@ -41,7 +41,7 @@ comment "Native drivers"
 
 config SENSORS_A10SYCON
 	bool "Altera Arria10 System Status"
-	select MFD_A10SYCON
+	depends on MFD_A10SYCON
 	help
 	  If you say yes here you get support for the power ready status
 	  for the Arria10's external power supplies. These values are read
diff --git a/drivers/reset/Kconfig b/drivers/reset/Kconfig
index 5457101..f2af323 100644
--- a/drivers/reset/Kconfig
+++ b/drivers/reset/Kconfig
@@ -16,8 +16,7 @@ source "drivers/reset/sti/Kconfig"
 
 config A10SYCON_RESET
 	tristate "Altera Arria10 System Control Reset"
-	depends on ARCH_SOCFPGA && RESET_CONTROLLER
-	select MFD_A10SYCON
+	depends on RESET_CONTROLLER && MFD_A10SYCON
 	help
 	  This option enables support for the external reset functions
 	  on the Altera Arria10 System Controller.
-- 
1.7.5.4

