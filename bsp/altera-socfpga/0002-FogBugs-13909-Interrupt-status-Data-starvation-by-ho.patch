From ca2c61329476eb506e21d097223cc90d7c847a3a Mon Sep 17 00:00:00 2001
From: Dinh Nguyen <dinguyen@altera.com>
Date: Thu, 11 Oct 2012 15:10:39 -0600
Subject: [PATCH 002/248] FogBugs #13909: Interrupt status: Data starvation by
 host timeout (bit-10)

According to Synopsys, the data starvation interrupt (HTO) should not treat
as error. Software should continue the data transfer. We have verified this
in Virtual Target. Remove this fogbugz after verify this in actual
hardware.

[Original patch taken from
git://git.rocketboards.org/linux-socfpga.git socfpga-3.14]

Signed-off-by: Yanjiang Jin <yanjiang.jin@windriver.com>
Signed-off-by: Ley Foon Tan <lftan@altera.com>
---
 drivers/mmc/host/dw_mmc.c | 18 +++++++++++++++---
 1 file changed, 15 insertions(+), 3 deletions(-)

diff --git a/drivers/mmc/host/dw_mmc.c b/drivers/mmc/host/dw_mmc.c
index 3f0f20a..7f66059 100644
--- a/drivers/mmc/host/dw_mmc.c
+++ b/drivers/mmc/host/dw_mmc.c
@@ -41,9 +41,21 @@
 #include "dw_mmc.h"
 
 /* Common flag combinations */
-#define DW_MCI_DATA_ERROR_FLAGS	(SDMMC_INT_DRTO | SDMMC_INT_DCRC | \
-				 SDMMC_INT_HTO | SDMMC_INT_SBE  | \
-				 SDMMC_INT_EBE)
+
+/* According to Synopsys, the data starvation interrupt (HTO) should not treat
+ * as error. Software should continue the data transfer. We have verified this
+ * in Virtual Target. Remove this fogbugz after verify this in actual
+ * hardware.
+ */
+#ifdef FOGBUGZ_13909
+ #define DW_MCI_DATA_ERROR_FLAGS	(SDMMC_INT_DTO | SDMMC_INT_DCRC | \
+ 				 SDMMC_INT_HTO | SDMMC_INT_SBE  | \
+ 				 SDMMC_INT_EBE)
+#else
+#define DW_MCI_DATA_ERROR_FLAGS (SDMMC_INT_DTO | SDMMC_INT_DCRC | \
+				 SDMMC_INT_SBE | SDMMC_INT_EBE)
+#endif
+
 #define DW_MCI_CMD_ERROR_FLAGS	(SDMMC_INT_RTO | SDMMC_INT_RCRC | \
 				 SDMMC_INT_RESP_ERR)
 #define DW_MCI_ERROR_FLAGS	(DW_MCI_DATA_ERROR_FLAGS | \
-- 
1.9.1

