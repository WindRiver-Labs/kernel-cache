From ec840be4add95d264b5935c162a2d75febdbbe14 Mon Sep 17 00:00:00 2001
From: Xulin Sun <xulin.sun@windriver.com>
Date: Fri, 5 Sep 2014 16:26:18 +0800
Subject: [PATCH] Add PCIe RP for ALTERA Arria V target

Original patch is from
http://releases.rocketboards.org/release/2014.08/av-pcie-ed/src/altera_pcierp_driver.patch

Since original patch misses the dts stuff, so we need to add them. I got them via sparsing socfpga.dtb file
located at the following tar file.

http://releases.rocketboards.org/release/2014.08/av-pcie-ed/bin/linux-socfpga-pcierp-13.1-av-bin.tar.gz

Signed-off-by: Xulin Sun <xulin.sun@windriver.com>
---
 arch/arm/boot/dts/socfpga_arria5.dts |   40 ++++++++++++++++++++++++++++++++++
 1 files changed, 40 insertions(+), 0 deletions(-)

diff --git a/arch/arm/boot/dts/socfpga_arria5.dts b/arch/arm/boot/dts/socfpga_arria5.dts
index a243b80..ff01e10 100644
--- a/arch/arm/boot/dts/socfpga_arria5.dts
+++ b/arch/arm/boot/dts/socfpga_arria5.dts
@@ -39,6 +39,46 @@
 	};
 
 	soc {
+		bridge@0xc0000000 {
+			compatible = "altr,bridge-1.0", "simple-bus";
+			reg = <0xc0000000 0x20000000 0xff200000 0x200000>;
+			reg-names = "axi_h2f", "axi_h2f_lw";
+			#address-cells = <0x2>;
+			#size-cells = <0x1>;
+			ranges = <0x0 0x0 0xc0000000 0x20000000
+				0x0 0x20000000 0xe0000000 0x40000
+				0x1 0x10000 0xff210000 0x8
+				0x1 0x10040 0xff210040 0x10
+				0x1 0x100e0 0xff2100e0 0x20
+				0x1 0x10020 0xff210020 0x8
+				0x1 0x80 0xff200080 0x10
+				0x1 0x0 0xff200000 0x80
+				0x1 0x24000 0xff224000 0x20
+				0x1 0x24020 0xff224020 0x10
+				0x1 0x20000 0xff220000 0x4000>;
+
+			pcie@0x000000000 {
+				compatible = "ALTR,pcie-root-port-13.1", "altr,pcie-root-port-1.0";
+				reg = <0x0 0x0 0x20000000 0x1 0x20000 0x4000>;
+				reg-names = "Txs", "Cra";
+				interrupt-parent = <&intc>;
+				interrupts = <0x0 0x28 0x4>;
+				interrupt-controller;
+				#interrupt-cells = <0x1>;
+				altr,msi = <&msi_to_gic_gen_0>;
+				device_type = "pci";
+			};
+			msi_to_gic_gen_0: msi@0x100000080 {
+				compatible = "ALTR,msi-1.0", "altr,msi-1.0";
+				reg = <0x1 0x80 0x10 0x1 0x0 0x80>;
+				reg-names = "csr", "vector_slave";
+				interrupt-parent = <&intc>;
+				interrupts = <0x0 0x2a 0x4>;
+				msi-controller = <0x1>;
+				num-vectors = <0x20>;
+			};
+		};
+
 		clkmgr@ffd04000 {
 			clocks {
 				osc1 {
-- 
1.7.5.4

