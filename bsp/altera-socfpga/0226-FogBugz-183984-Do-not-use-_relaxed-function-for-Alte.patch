From 476ef0630436e19637c6c10e686b8d9c9974cbb8 Mon Sep 17 00:00:00 2001
From: Tien Hock Loh <thloh@altera.com>
Date: Tue, 1 Apr 2014 10:35:18 +0800
Subject: [PATCH 226/248] FogBugz #183984: Do not use _relaxed() function for
 Altera PIO driver

This is to remove the use of _relaxed() function from Altera PIO driver.
The FPGA driver should be more generic and not use _relaxed() function
since not all architecture supports _relaxed() function

[Original patch taken from
git://git.rocketboards.org/linux-socfpga.git socfpga-3.14]

Signed-off-by: Yanjiang Jin <yanjiang.jin@windriver.com>
Signed-off-by: Tien Hock Loh <thloh@altera.com>
---
 drivers/gpio/gpio-altera.c | 11 +++++------
 1 file changed, 5 insertions(+), 6 deletions(-)

diff --git a/drivers/gpio/gpio-altera.c b/drivers/gpio/gpio-altera.c
index ab0738f..79d7a789 100644
--- a/drivers/gpio/gpio-altera.c
+++ b/drivers/gpio/gpio-altera.c
@@ -230,8 +230,8 @@ static void altera_gpio_irq_handler(unsigned int irq, struct irq_desc *desc)
 	chained_irq_enter(chip, desc);
 	/* Handling for level trigger and edge trigger is different */
 	if (altera_gc->interrupt_trigger == IRQ_TYPE_LEVEL_HIGH) {
-		status = readl_relaxed(mm_gc->regs + ALTERA_GPIO_DATA);
-		status &= readl_relaxed(mm_gc->regs + ALTERA_GPIO_IRQ_MASK);
+		status = readl(mm_gc->regs + ALTERA_GPIO_DATA);
+		status &= readl(mm_gc->regs + ALTERA_GPIO_IRQ_MASK);
 
 		for (i = 0; i < mm_gc->gc.ngpio; i++) {
 			if (status & BIT(i)) {
@@ -241,10 +241,9 @@ static void altera_gpio_irq_handler(unsigned int irq, struct irq_desc *desc)
 		}
 	} else {
 		while ((status =
-			(readl_relaxed(mm_gc->regs + ALTERA_GPIO_EDGE_CAP) &
-			readl_relaxed(mm_gc->regs + ALTERA_GPIO_IRQ_MASK)))) {
-			writel_relaxed(status,
-				mm_gc->regs + ALTERA_GPIO_EDGE_CAP);
+			(readl(mm_gc->regs + ALTERA_GPIO_EDGE_CAP) &
+			readl(mm_gc->regs + ALTERA_GPIO_IRQ_MASK)))) {
+			writel(status, mm_gc->regs + ALTERA_GPIO_EDGE_CAP);
 			for (i = 0; i < mm_gc->gc.ngpio; i++) {
 				if (status & BIT(i)) {
 					generic_handle_irq(irq_find_mapping(
-- 
1.9.1

