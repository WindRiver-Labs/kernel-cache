From 18be215a4b28a998d828181cc64c19e40b26f4be Mon Sep 17 00:00:00 2001
From: Dinh Nguyen <dinguyen@altera.com>
Date: Tue, 3 Dec 2013 17:12:43 -0600
Subject: [PATCH 163/248] FogBugz #171612: Remove hard-coded frequencies for
 Timers and UARTs

Update the UART and timers clock node so that the driver can query for the
frequency, instead of hard-coding the frequency values.

[Original patch taken from
git://git.rocketboards.org/linux-socfpga.git socfpga-3.14]

Signed-off-by: Yanjiang Jin <yanjiang.jin@windriver.com>
Signed-off-by: Dinh Nguyen <dinguyen@altera.com>
---
 arch/arm/boot/dts/socfpga.dtsi          | 12 ++++++++++++
 arch/arm/boot/dts/socfpga_cyclone5.dtsi | 22 +---------------------
 arch/arm/boot/dts/socfpga_ice.dts       | 22 +---------------------
 arch/arm/boot/dts/socfpga_vt.dts        | 22 +---------------------
 4 files changed, 15 insertions(+), 63 deletions(-)

diff --git a/arch/arm/boot/dts/socfpga.dtsi b/arch/arm/boot/dts/socfpga.dtsi
index 96ec845..f253797 100644
--- a/arch/arm/boot/dts/socfpga.dtsi
+++ b/arch/arm/boot/dts/socfpga.dtsi
@@ -746,24 +746,32 @@
 			compatible = "snps,dw-apb-timer";
 			interrupts = <0 167 4>;
 			reg = <0xffc08000 0x1000>;
+			clocks = <&l4_sp_clk>;
+			clock-names = "timer";
 		};
 
 		timer1: timer1@ffc09000 {
 			compatible = "snps,dw-apb-timer";
 			interrupts = <0 168 4>;
 			reg = <0xffc09000 0x1000>;
+			clocks = <&l4_sp_clk>;
+			clock-names = "timer";
 		};
 
 		timer2: timer2@ffd00000 {
 			compatible = "snps,dw-apb-timer";
 			interrupts = <0 169 4>;
 			reg = <0xffd00000 0x1000>;
+			clocks = <&osc>;
+			clock-names = "timer";
 		};
 
 		timer3: timer3@ffd01000 {
 			compatible = "snps,dw-apb-timer";
 			interrupts = <0 170 4>;
 			reg = <0xffd01000 0x1000>;
+			clocks = <&osc>;
+			clock-names = "timer";
 		};
 
 		uart0: serial0@ffc02000 {
@@ -772,6 +780,8 @@
 			interrupts = <0 162 4>;
 			reg-shift = <2>;
 			reg-io-width = <4>;
+			clocks = <&l4_sp_clk>;
+			status = "disabled";
 		};
 
 		uart1: serial1@ffc03000 {
@@ -780,6 +790,8 @@
 			interrupts = <0 163 4>;
 			reg-shift = <2>;
 			reg-io-width = <4>;
+			clocks = <&l4_sp_clk>;
+			status = "disabled";
 		};
 
 		usbphy0: usbphy@0 {
diff --git a/arch/arm/boot/dts/socfpga_cyclone5.dtsi b/arch/arm/boot/dts/socfpga_cyclone5.dtsi
index 5b5cabc..e10a657 100644
--- a/arch/arm/boot/dts/socfpga_cyclone5.dtsi
+++ b/arch/arm/boot/dts/socfpga_cyclone5.dtsi
@@ -111,28 +111,8 @@
 			};
 		};
 
-		timer0@ffc08000 {
-			clock-frequency = <100000000>;
-		};
-
-		timer1@ffc09000 {
-			clock-frequency = <100000000>;
-		};
-
-		timer2@ffd00000 {
-			clock-frequency = <25000000>;
-		};
-
-		timer3@ffd01000 {
-			clock-frequency = <25000000>;
-		};
-
 		serial0@ffc02000 {
-			clock-frequency = <100000000>;
-		};
-
-		serial1@ffc03000 {
-			clock-frequency = <100000000>;
+			status = "okay";
 		};
 
 		sysmgr@ffd08000 {
diff --git a/arch/arm/boot/dts/socfpga_ice.dts b/arch/arm/boot/dts/socfpga_ice.dts
index 34215921..bcd3fb0 100644
--- a/arch/arm/boot/dts/socfpga_ice.dts
+++ b/arch/arm/boot/dts/socfpga_ice.dts
@@ -106,28 +106,8 @@
 			cpu1-start-addr = <0xffd080c4>;
 		};
 
-		timer0@ffc08000 {
-			clock-frequency = <77161>;
-		};
-
-		timer1@ffc09000 {
-			clock-frequency = <77161>;
-		};
-
-		timer2@ffd00000 {
-			clock-frequency = <19290>;
-		};
-
-		timer3@ffd01000 {
-			clock-frequency = <19290>;
-		};
-
 		serial0@ffc02000 {
-			clock-frequency = <77161>;
-		};
-
-		serial1@ffc03000 {
-			clock-frequency = <77161>;
+			status = "okay";
 		};
 
 		watchdog0: wd@ffd02000 {
diff --git a/arch/arm/boot/dts/socfpga_vt.dts b/arch/arm/boot/dts/socfpga_vt.dts
index 68b75f9..54edc2c 100644
--- a/arch/arm/boot/dts/socfpga_vt.dts
+++ b/arch/arm/boot/dts/socfpga_vt.dts
@@ -120,28 +120,8 @@
 			};
 		};
 
-		timer0@ffc08000 {
-			clock-frequency = <7000000>;
-		};
-
-		timer1@ffc09000 {
-			clock-frequency = <7000000>;
-		};
-
-		timer2@ffd00000 {
-			clock-frequency = <7000000>;
-		};
-
-		timer3@ffd01000 {
-			clock-frequency = <7000000>;
-		};
-
 		serial0@ffc02000 {
-			clock-frequency = <7372800>;
-		};
-
-		serial1@ffc03000 {
-			clock-frequency = <7372800>;
+			status = "okay";
 		};
 
 		sysmgr@ffd08000 {
-- 
1.9.1

