From d283cb0e8f1d095f2c704761c522a91e851dfd98 Mon Sep 17 00:00:00 2001
From: Dinh Nguyen <dinguyen@altera.com>
Date: Fri, 24 May 2013 13:07:30 -0500
Subject: [PATCH 246/254] usb: Fix split transactions for USB Host on SoCFPGA

Upstream: git://git.rocketboards.org/linux-socfpga.git

Fix a bug that prevented LS/FS devices from being recognized through
a HS hub.

Signed-off-by: Dinh Nguyen <dinguyen@altera.com>
(cherry picked from commit 96fed3737128e871c82a73f6f285f393f2a670a8)
Signed-off-by: Zumeng Chen <zumeng.chen@windriver.com>
---
 drivers/usb/otg/dwc/hcd.c |    3 ++-
 1 files changed, 2 insertions(+), 1 deletions(-)

diff --git a/drivers/usb/otg/dwc/hcd.c b/drivers/usb/otg/dwc/hcd.c
index 95e5119..0d5a3eb 100644
--- a/drivers/usb/otg/dwc/hcd.c
+++ b/drivers/usb/otg/dwc/hcd.c
@@ -2106,7 +2106,8 @@ static void dwc_otg_hc_start_transfer(struct dwc_hcd *hcd,
 		u32 hcsplt;
 
 		hcsplt = dwc_reg_read(hc_regs, DWC_HCSPLT);
-		hcsplt = DWC_HCSPLT_COMP_SPLT_RW(hcsplt, 1);
+		hcsplt = DWC_HCSPLT_COMP_SPLT_RW(hcsplt, hc->complete_split);
+		hcsplt = DWC_HCSPLT_ENA_RW(hcsplt, 1);
 		dwc_reg_write(hc_regs, DWC_HCSPLT, hcsplt);
 	}
 
-- 
1.7.5.4

