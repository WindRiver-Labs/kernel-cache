From 0749ff85821e6f2858a7ef5fe96acd42196f3e14 Mon Sep 17 00:00:00 2001
From: Graham Moore <grmoore@altera.com>
Date: Tue, 3 Jun 2014 11:52:39 -0500
Subject: [PATCH 247/248] FogBugz #208682: Denali NAND driver misidentifies
 Hynix chips

The denali driver was not reading enough id bytes to determine the
parameters for a Hynix chip.  The chip was therefore not identified
properly, and the page size and oob size were calculated incorrectly.

This resulted in a message stating the OOB area was not big enough
for 8-bit ECC.

[Original patch taken from
git://git.rocketboards.org/linux-socfpga.git socfpga-3.14]

Signed-off-by: Yanjiang Jin <yanjiang.jin@windriver.com>
Signed-off-by: Graham Moore <grmoore@altera.com>
---
 drivers/mtd/nand/denali.c | 4 ++--
 1 file changed, 2 insertions(+), 2 deletions(-)

diff --git a/drivers/mtd/nand/denali.c b/drivers/mtd/nand/denali.c
index 08b39f2..e0e7262 100644
--- a/drivers/mtd/nand/denali.c
+++ b/drivers/mtd/nand/denali.c
@@ -494,7 +494,7 @@ static uint16_t denali_nand_timing_set(struct denali_nand_info *denali)
 	addr = (uint32_t)MODE_11 | BANK(denali->flash_bank);
 	index_addr(denali, (uint32_t)addr | 0, 0x90);
 	index_addr(denali, (uint32_t)addr | 1, 0);
-	for (i = 0; i < 5; i++)
+	for (i = 0; i < 8; i++)
 		index_addr_read_data(denali, addr | 2, &id_bytes[i]);
 	maf_id = id_bytes[0];
 	device_id = id_bytes[1];
@@ -1317,7 +1317,7 @@ static void denali_cmdfunc(struct mtd_info *mtd, unsigned int cmd, int col,
 		addr = (uint32_t)MODE_11 | BANK(denali->flash_bank);
 		index_addr(denali, (uint32_t)addr | 0, cmd);
 		index_addr(denali, (uint32_t)addr | 1, col & 0xFF);
-		for (i = 0; i < 5; i++) {
+		for (i = 0; i < 8; i++) {
 			index_addr_read_data(denali,
 						(uint32_t)addr | 2,
 						&id);
-- 
1.9.1

