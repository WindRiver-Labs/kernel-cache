From 33befa7e1c9491ab1443fbee5132b1330e4fe279 Mon Sep 17 00:00:00 2001
From: Thor Thayer <tthayer@altera.com>
Date: Tue, 17 Sep 2013 11:23:20 -0500
Subject: [PATCH 11/13] dts/socfpga: Fixes for Linux CAN Support

commit 01e91a87e593024c1eb3127d1483a152a356bc56
git://git.rocketboards.org/linux-socfpga.git socfpga-3.10-ltsi branch

The community C_CAN/D_CAN driver works with the SoCFPGA CycloneV board
but requires a few changes to the Altera SoCFPGA device tree.
Add changes to socfpga.dtsi :
- Update of IRQs (needed to add the CAN Message Object IRQ.
- Define the CAN clocks
- Leave CAN0 and CAN1 disabled.
Add changes to socfpga_cyclone5.dts
- Turn on CAN0 on Cyclone5 boards.
CAN should be compiled into kernel for Altera SoCFPGA.
- Configure CAN by default in socfpga_defconfig

Signed-off-by: Thor Thayer <tthayer@altera.com>
[Just a minor modification to rebase to current context]
Signed-off-by: Yang Wei <Wei.Yang@windriver.com>
---
 arch/arm/boot/dts/socfpga.dtsi         |    8 ++++++--
 arch/arm/boot/dts/socfpga_cyclone5.dts |    6 +-----
 2 files changed, 7 insertions(+), 7 deletions(-)

diff --git a/arch/arm/boot/dts/socfpga.dtsi b/arch/arm/boot/dts/socfpga.dtsi
index cd59a7c..479c6fb 100644
--- a/arch/arm/boot/dts/socfpga.dtsi
+++ b/arch/arm/boot/dts/socfpga.dtsi
@@ -438,13 +438,17 @@
 		dcan0: d_can@ffc00000 {
 			compatible = "bosch,d_can";
 			reg = <0xffc00000 0x1000>;
-			interrupts = <0 131 4>;
+			interrupts = <0 131 4>, <0 132 4>;
+			clocks = <&can0_clk>;
+ 			status = "disabled";
 		};
 
 		dcan1: d_can@ffc10000 {
 			compatible = "bosch,d_can";
 			reg = <0xffc10000 0x1000>;
-			interrupts = <0 135 4>;
+			interrupts = <0 135 4>, <0 136 4>;
+			clocks = <&can1_clk>;
+ 			status = "disabled";
 		};
 
 		gmac0: ethernet@ff700000 {
diff --git a/arch/arm/boot/dts/socfpga_cyclone5.dts b/arch/arm/boot/dts/socfpga_cyclone5.dts
index 3531eec..beb1a5e 100644
--- a/arch/arm/boot/dts/socfpga_cyclone5.dts
+++ b/arch/arm/boot/dts/socfpga_cyclone5.dts
@@ -49,11 +49,7 @@
 		};
 
 		dcan0: d_can@ffc00000 {
-			status = "disabled";
-		};
-
-		dcan1: d_can@ffc10000 {
-			status = "disabled";
+			status = "okay";
 		};
 
 		dwmmc0@ff704000 {
-- 
1.7.5.4

