From 15b690802bdf7ff561f4c6907ac4a1147b506216 Mon Sep 17 00:00:00 2001
From: Padmavathi Venna <padma.v@samsung.com>
Date: Mon, 4 Mar 2013 11:04:28 +0530
Subject: [PATCH 01/10] Arm: socfpga: pl330: Add #dma-cells for generic dma
 binding support

commit 0d8abbfd96e6ebd0b97e0f740614cc5e62d94d84
git://git.rocketboards.org/linux-socfpga.git socfpga-3.10-ltsi branch

This patch adds #dma-cells property to PL330 DMA controller nodes for
supporting generic dma dt bindings on SOCFPGA platform. #dma-channels
and #dma-requests are not required now but added in advance.

Signed-off-by: Padmavathi Venna <padma.v@samsung.com>
Signed-off-by: Arnd Bergmann <arnd@arndb.de>
[The modification on Documentation is from 42cf20980cde upstream]
Signed-off-by: Yang Wei <Wei.Yang@windriver.com>
---
 .../devicetree/bindings/dma/arm-pl330.txt          |   14 ++++++++++++--
 arch/arm/boot/dts/socfpga.dtsi                     |    3 +++
 2 files changed, 15 insertions(+), 2 deletions(-)

diff --git a/Documentation/devicetree/bindings/dma/arm-pl330.txt b/Documentation/devicetree/bindings/dma/arm-pl330.txt
index a4cd273..6b8b403 100644
--- a/Documentation/devicetree/bindings/dma/arm-pl330.txt
+++ b/Documentation/devicetree/bindings/dma/arm-pl330.txt
@@ -9,19 +9,29 @@ Required properties:
     region.
   - interrupts: interrupt number to the cpu.
 
+Optional properties:
+ - dma-coherent      : Present if dma operations are coherent
+ - #dma-cells: must be <1>. used to represent the number of integer
+   cells in the dmas property of client device.
+ - dma-channels: contains the total number of DMA channels supported by the DMAC
+ - dma-requests: contains the total number of DMA requests supported by the DMAC
+
 Example:
 
 	pdma0: pdma@12680000 {
 		compatible = "arm,pl330", "arm,primecell";
 		reg = <0x12680000 0x1000>;
 		interrupts = <99>;
+        #dma-cells = <1>;
+        #dma-channels = <8>;
+        #dma-requests = <32>;
 	};
 
 Client drivers (device nodes requiring dma transfers from dev-to-mem or
-mem-to-dev) should specify the DMA channel numbers using a two-value pair
+mem-to-dev) should specify the DMA channel numbers and dma channel names
 as shown below.
 
-  [property name]  = <[phandle of the dma controller] [dma request id]>;
+  [property name]  = <[dma channel name]>;
 
       where 'dma request id' is the dma request number which is connected
       to the client controller. The 'property name' is recommended to be
diff --git a/arch/arm/boot/dts/socfpga.dtsi b/arch/arm/boot/dts/socfpga.dtsi
index ea44a14..4f4c1d7 100644
--- a/arch/arm/boot/dts/socfpga.dtsi
+++ b/arch/arm/boot/dts/socfpga.dtsi
@@ -76,6 +76,9 @@
 				compatible = "arm,pl330", "arm,primecell";
 				reg = <0xffe01000 0x1000>;
 				interrupts = <0 180 4>;
+				#dma-cells = <1>;
+				#dma-channels = <8>;
+				#dma-requests = <32>;
 			};
 		};
 
-- 
1.7.5.4

