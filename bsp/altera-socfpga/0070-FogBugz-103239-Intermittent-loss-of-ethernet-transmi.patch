From 2d924035a70ad7494ea5acb09baa3eaf799a3b03 Mon Sep 17 00:00:00 2001
From: Matthew Gerlach <mgerlach@altera.com>
Date: Fri, 5 Apr 2013 09:10:26 -0700
Subject: [PATCH 070/248] FogBugz #103239: Intermittent loss of ethernet
 transmission.

This bug does not really have anything to do with ethernet.
The problem was a memory coherency problem between the cpu
and a dma engine, in this case the ethernet mac.  In short,
while dma writes by the ethernet were not getting cached in L2,
they were getting cached in L1.  The good news is a single bit
change to the programming of the PL310 fixes the problem.

[Original patch taken from
git://git.rocketboards.org/linux-socfpga.git socfpga-3.14]

Signed-off-by: Yanjiang Jin <yanjiang.jin@windriver.com>
Signed-off-by: Matthew Gerlach <mgerlach@altera.com>
---
 arch/arm/mach-socfpga/socfpga.c | 3 ++-
 1 file changed, 2 insertions(+), 1 deletion(-)

diff --git a/arch/arm/mach-socfpga/socfpga.c b/arch/arm/mach-socfpga/socfpga.c
index 090ca41..3ab8457 100644
--- a/arch/arm/mach-socfpga/socfpga.c
+++ b/arch/arm/mach-socfpga/socfpga.c
@@ -349,7 +349,8 @@ static void __init socfpga_cyclone5_init(void)
 {
 #ifdef CONFIG_CACHE_L2X0
 	u32 aux_ctrl = 0;
-	aux_ctrl |= (1 << L2X0_AUX_CTRL_DATA_PREFETCH_SHIFT) |
+	aux_ctrl |= (1 << L2X0_AUX_CTRL_SHARE_OVERRIDE_SHIFT) |
+			(1 << L2X0_AUX_CTRL_DATA_PREFETCH_SHIFT) |
 			(1 << L2X0_AUX_CTRL_INSTR_PREFETCH_SHIFT);
 	l2x0_of_init(aux_ctrl, ~0UL);
 #endif
-- 
1.9.1

