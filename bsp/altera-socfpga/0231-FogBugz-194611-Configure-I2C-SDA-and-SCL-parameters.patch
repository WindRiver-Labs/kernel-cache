From 38a6197983c384715d4fae13d29f57973167edb7 Mon Sep 17 00:00:00 2001
From: Chris Rauer <crauer@altera.com>
Date: Fri, 4 Apr 2014 10:05:51 -0700
Subject: [PATCH 231/248] FogBugz #194611: Configure I2C SDA and SCL parameters

This patch slows down the i2c frequency from 100khz to 50khz to
make the LCD work

v2:
rebased to new dts changes
fixed falling time values and verified with logical analyzer

[Original patch taken from
git://git.rocketboards.org/linux-socfpga.git socfpga-3.14]

Signed-off-by: Yanjiang Jin <yanjiang.jin@windriver.com>
Signed-off-by: Chris Rauer <crauer@altera.com>
---
 arch/arm/boot/dts/socfpga_arria5_socdk.dts   | 6 ++++++
 arch/arm/boot/dts/socfpga_cyclone5_socdk.dts | 6 ++++++
 2 files changed, 12 insertions(+)

diff --git a/arch/arm/boot/dts/socfpga_arria5_socdk.dts b/arch/arm/boot/dts/socfpga_arria5_socdk.dts
index b4c4e3e..75688df 100644
--- a/arch/arm/boot/dts/socfpga_arria5_socdk.dts
+++ b/arch/arm/boot/dts/socfpga_arria5_socdk.dts
@@ -94,6 +94,12 @@
 &i2c0 {
 	status = "okay";
 	speed-mode = <0>;
+	/*
+	 * adjust the falling times to decrease the i2c frequency to 50Khz
+	 * because the LCD module does not work at the standard 100Khz
+	 */
+	i2c-sda-falling-time-ns = <5000>;
+	i2c-scl-falling-time-ns = <5000>;
 
 	lcd: lcd@28 {
 		compatible = "newhaven,nhd-0216k3z-nsw-bbw";
diff --git a/arch/arm/boot/dts/socfpga_cyclone5_socdk.dts b/arch/arm/boot/dts/socfpga_cyclone5_socdk.dts
index c5b4ac0..e6cd08a 100644
--- a/arch/arm/boot/dts/socfpga_cyclone5_socdk.dts
+++ b/arch/arm/boot/dts/socfpga_cyclone5_socdk.dts
@@ -98,6 +98,12 @@
 &i2c0 {
 	status = "okay";
 	speed-mode = <0>;
+	/*
+	 * adjust the falling times to decrease the i2c frequency to 50Khz
+	 * because the LCD module does not work at the standard 100Khz
+	 */
+	i2c-sda-falling-time-ns = <5000>;
+	i2c-scl-falling-time-ns = <5000>;
 
 	lcd: lcd@28 {
 		compatible = "newhaven,nhd-0216k3z-nsw-bbw";
-- 
1.9.1

