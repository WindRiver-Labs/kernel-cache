From aa06c550d3cda9bc31d77b6192c2be5ea491da96 Mon Sep 17 00:00:00 2001
From: Yves Vandervennet <yvanderv@altera.com>
Date: Fri, 6 Dec 2013 12:39:36 -0600
Subject: [PATCH 164/248] GCOV fix for GCC 4.7.x

Changes the data structures of GCOV to handle GCC 4.7 code

[Original patch taken from
git://git.rocketboards.org/linux-socfpga.git socfpga-3.14]

Signed-off-by: Yanjiang Jin <yanjiang.jin@windriver.com>
Signed-off-by: Yves Vandervennet <yvanderv@altera.com>
---
 include/linux/module.h | 2 ++
 kernel/module.c        | 3 +++
 2 files changed, 5 insertions(+)

diff --git a/include/linux/module.h b/include/linux/module.h
index 73d58cc..34c7310 100644
--- a/include/linux/module.h
+++ b/include/linux/module.h
@@ -378,6 +378,8 @@ struct module {
 	/* Constructor functions. */
 	ctor_fn_t *ctors;
 	unsigned int num_ctors;
+	ctor_fn_t *init_array;
+	unsigned int num_init_array;
 #endif
 };
 #ifndef MODULE_ARCH_INIT
diff --git a/kernel/module.c b/kernel/module.c
index c2da7c8..4596a60 100644
--- a/kernel/module.c
+++ b/kernel/module.c
@@ -3005,6 +3005,9 @@ static void do_mod_ctors(struct module *mod)
 
 	for (i = 0; i < mod->num_ctors; i++)
 		mod->ctors[i]();
+
+	for (i = 0; i < mod->num_init_array; i++)
+		mod->init_array[i]();
 #endif
 }
 
-- 
1.9.1

