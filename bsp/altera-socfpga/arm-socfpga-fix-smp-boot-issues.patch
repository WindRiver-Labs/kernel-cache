From dbe9f9a530d23bd0a50d105964a7385cc5a55c91 Mon Sep 17 00:00:00 2001
From: Zumeng Chen <zumeng.chen@windriver.com>
Date: Fri, 19 Apr 2013 10:56:42 +0800
Subject: [PATCH 216/254] arm: socfpga: fix smp boot issues

Upstream: git://git.rocketboards.org/linux-socfpga.git

This patch is to cater for back-porting from kernel 3.9
to boot smp wery well.

Signed-off-by: Zumeng Chen <zumeng.chen@windriver.com>
---
 arch/arm/mach-socfpga/platsmp.c |   18 +++++++++++++++++-
 1 files changed, 17 insertions(+), 1 deletions(-)

diff --git a/arch/arm/mach-socfpga/platsmp.c b/arch/arm/mach-socfpga/platsmp.c
index a7eba56..787b0a5 100644
--- a/arch/arm/mach-socfpga/platsmp.c
+++ b/arch/arm/mach-socfpga/platsmp.c
@@ -93,7 +93,7 @@ void __init smp_init_cpus(void)
 
 void __init platform_smp_prepare_cpus(unsigned int max_cpus)
 {
-	scu_enable(scu_base_addr());
+	scu_enable(socfpga_scu_base_addr);
 
 	/*
 	 * Write the address of secondary startup into the
@@ -136,3 +136,19 @@ void platform_cpu_die(unsigned int cpu)
 	.cpu_die		= socfpga_cpu_die,
 #endif
 }; */
+
+#ifdef CONFIG_HOTPLUG_CPU
+int platform_cpu_kill(unsigned int cpu)
+{
+	return 1;
+}
+
+int platform_cpu_disable(unsigned int cpu)
+{
+	/*
+	 * we don't allow CPU 0 to be shutdown (it is still too special
+	 * e.g. clock tick interrupts)
+	 */
+	return cpu == 0 ? -EPERM : 0;
+}
+#endif
-- 
1.7.5.4

