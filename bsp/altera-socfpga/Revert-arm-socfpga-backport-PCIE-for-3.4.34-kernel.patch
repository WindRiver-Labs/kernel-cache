From f86def2fc11daf2085047afe29a759884b63efeb Mon Sep 17 00:00:00 2001
From: Yang Wei <Wei.Yang@windriver.com>
Date: Thu, 22 May 2014 16:39:20 +0800
Subject: [PATCH 1/7] Revert "arm: socfpga: backport PCIE for 3.4.34 kernel"

This reverts commit e86993ea964c081e8dbacd0c438fa1618c133d3b.

We need to upgrade pcie driver to 13.1, so firstly revert the
previous 13.0 pcie driver.

Signed-off-by: Yang Wei <Wei.Yang@windriver.com>
---
 arch/arm/Kconfig                    |    8 --------
 arch/arm/mach-socfpga/altera_pcie.c |    8 +-------
 2 files changed, 1 insertions(+), 15 deletions(-)

diff --git a/arch/arm/Kconfig b/arch/arm/Kconfig
index bda8129..801a574 100644
--- a/arch/arm/Kconfig
+++ b/arch/arm/Kconfig
@@ -313,14 +313,6 @@ config FPGA_SDRAM
 	help
 		This enables the SDRAM controller that is connected to the FGPA.
 
-config ALTERA_PCIE_RP
-        bool "Altera PCIe Root Port Driver"
-	select PCI
-	select PCIEPORTBUS
-	depends on ARCH_SOCFPGA
-	help
-	  The Altera PCI Express Root Port driver.
-
 config ARCH_INTEGRATOR
 	bool "ARM Ltd. Integrator family"
 	select ARM_AMBA
diff --git a/arch/arm/mach-socfpga/altera_pcie.c b/arch/arm/mach-socfpga/altera_pcie.c
index f52bae7..0e09d79 100644
--- a/arch/arm/mach-socfpga/altera_pcie.c
+++ b/arch/arm/mach-socfpga/altera_pcie.c
@@ -392,18 +392,12 @@ static int altrpcierp_map_irq(const struct pci_dev *dev, u8 slot, u8 pin)
 	return altrpcierp_info.hwirq;
 }
 
-/* register pci hw read/write functions */
-struct pci_bus * __init altera_pcie_scan_bus(int nr, struct pci_sys_data *sys)
-{
-	return pci_scan_root_bus(NULL, 0, &altrpcierp_ops, sys, &sys->resources);
-}
-
 /* hw_pci */
 static struct hw_pci altrpcierp_hw __initdata = {
 #ifdef CONFIG_PCI_DOMAINS
 	.domain			= 0,
 #endif
-	.scan			= altera_pcie_scan_bus,
+	.ops			= &altrpcierp_ops,
 	.nr_controllers		= 1,
 	.setup			= altrpcierp_setup,
 	.map_irq		= altrpcierp_map_irq,
-- 
1.7.5.4

