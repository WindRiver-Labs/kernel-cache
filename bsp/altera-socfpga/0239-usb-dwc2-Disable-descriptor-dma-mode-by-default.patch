From 68322ea4360f374b19115a58cd05eab9e8f4f863 Mon Sep 17 00:00:00 2001
From: Dinh Nguyen <dinguyen@altera.com>
Date: Mon, 5 May 2014 10:26:49 -0500
Subject: [PATCH 239/248] usb: dwc2: Disable descriptor dma mode by default

Even though the IP supports Descriptor DMA mode, it does not support SPLIT
transactions in this mode. So the driver, in its currently form, will not
support LS/FS devices when connected to a HS Hub if Descriptor DMA mode is
enabled.

So we should just default to disable descriptor dma mode.

[Original patch taken from
git://git.rocketboards.org/linux-socfpga.git socfpga-3.14]

Signed-off-by: Yanjiang Jin <yanjiang.jin@windriver.com>
Signed-off-by: Dinh Nguyen <dinguyen@altera.com>
Acked-by: Paul Zimmerman <paulz@synopsys.com>
---
 drivers/usb/dwc2/platform.c | 1 +
 1 file changed, 1 insertion(+)

diff --git a/drivers/usb/dwc2/platform.c b/drivers/usb/dwc2/platform.c
index bab32e1..21ebac1 100644
--- a/drivers/usb/dwc2/platform.c
+++ b/drivers/usb/dwc2/platform.c
@@ -135,6 +135,7 @@ static int dwc2_driver_probe(struct platform_device *dev)
 		return -ENODEV;
 
 	dwc2_set_all_params(&params, -1);
+	params.dma_desc_enable = 0;
 
 	hsotg = devm_kzalloc(&dev->dev, sizeof(*hsotg), GFP_KERNEL);
 	if (!hsotg)
-- 
1.9.1

