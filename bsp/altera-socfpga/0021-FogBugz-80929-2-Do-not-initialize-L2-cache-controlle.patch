From 50ffc46d36f9f63f0ac0a1ce582e92503a66de23 Mon Sep 17 00:00:00 2001
From: Dinh Nguyen <dinguyen@altera.com>
Date: Wed, 7 Nov 2012 10:47:50 -0700
Subject: [PATCH 021/248] FogBugz #80929:-2 Do not initialize L2 cache
 controller

Follow up to FogBugz #80929.

If CONFIG_CACHE_L2X0 is not selected, then there is no need to
initialize the L2 cache controller.

[Original patch taken from
git://git.rocketboards.org/linux-socfpga.git socfpga-3.14]

Signed-off-by: Yanjiang Jin <yanjiang.jin@windriver.com>
Signed-off-by: Dinh Nguyen <dinguyen@altera.com>
---
 arch/arm/mach-socfpga/socfpga.c | 5 ++++-
 1 file changed, 4 insertions(+), 1 deletion(-)

diff --git a/arch/arm/mach-socfpga/socfpga.c b/arch/arm/mach-socfpga/socfpga.c
index e4be3aa..e14b06b 100644
--- a/arch/arm/mach-socfpga/socfpga.c
+++ b/arch/arm/mach-socfpga/socfpga.c
@@ -152,8 +152,11 @@ static void socfpga_cyclone5_restart(enum reboot_mode mode, const char *cmd)
 
 static void __init socfpga_cyclone5_init(void)
 {
+#ifdef CONFIG_CACHE_L2X0
 	l2x0_of_init(0, ~0UL);
-	of_platform_populate(NULL, of_default_bus_match_table, NULL, NULL);
+	of_platform_populate(NULL, of_default_bus_match_table,
+		socfpga_auxdata_lookup, NULL);
+#endif
 	socfpga_init_clocks();
 	enable_periphs();
 }
-- 
1.9.1

