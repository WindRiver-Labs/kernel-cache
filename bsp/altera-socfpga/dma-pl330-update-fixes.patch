From 2a59735ff18311825fef0bfbe3124514bb840e68 Mon Sep 17 00:00:00 2001
From: Zumeng Chen <zumeng.chen@windriver.com>
Date: Mon, 1 Apr 2013 10:36:05 +0800
Subject: [PATCH 214/254] dma: pl330: update fixes

Upstream: git://git.rocketboards.org/linux-socfpga.git

 1. no clk in struct dma_pl330_dmac {
 2. err5 is not necessary.

Signed-off-by: Zumeng Chen <zumeng.chen@windriver.com>
---
 drivers/dma/pl330.c |    7 ++-----
 1 files changed, 2 insertions(+), 5 deletions(-)

diff --git a/drivers/dma/pl330.c b/drivers/dma/pl330.c
index 5f8ba35..981ce04 100755
--- a/drivers/dma/pl330.c
+++ b/drivers/dma/pl330.c
@@ -585,6 +585,8 @@ struct dma_pl330_dmac {
 
 	/* Peripheral channels connected to this DMAC */
 	struct dma_pl330_chan *peripherals; /* keep at end */
+
+	struct clk *clk;
 };
 
 struct dma_pl330_desc {
@@ -2921,11 +2923,6 @@ pl330_probe(struct amba_device *adev, const struct amba_id *id)
 		num_chan = max_t(int, pi->pcfg.num_peri, pi->pcfg.num_chan);
 
 	pdmac->peripherals = kzalloc(num_chan * sizeof(*pch), GFP_KERNEL);
-	if (!pdmac->peripherals) {
-		ret = -ENOMEM;
-		dev_err(&adev->dev, "unable to allocate pdmac->peripherals\n");
-		goto probe_err5;
-	}
 
 	for (i = 0; i < num_chan; i++) {
 		pch = &pdmac->peripherals[i];
-- 
1.7.5.4

