From d237a33eba3734a5db8bf9fffb7639da99b65c68 Mon Sep 17 00:00:00 2001
From: Yang Wei <Wei.Yang@windriver.com>
Date: Thu, 17 Apr 2014 16:54:47 +0800
Subject: [PATCH 03/24] dts/socfpga: update dts entry to use latest USB driver

The patch is part of 77f7f4eadff3, since Dinh finally does not
use DWC2 USB driver to support USB Host mode, so I only pick a
part of original patch.

[
FogBugz #152188: Switch to use DWC2 USB driver

Switch to use the latest USB driver from Synopsys, which is currently
in drivers/staging/dwc2. The driver currently only supports Host mode and DMA.

This patch enables the DWC2 driver for host mode and uses the 'old' driver
for peripheral mode.

By default, socfpga_defconfig will support Host mode. To enable Peripheral
mode, rebuild the kernel with CONFIG_USB_DWC_OTG=y.

Signed-off-by: Dinh Nguyen <dinguyen@altera.com>
]

Signed-off-by: Yang Wei <Wei.Yang@windriver.com>
---
 arch/arm/boot/dts/socfpga.dtsi |   18 ++++++++++++------
 1 files changed, 12 insertions(+), 6 deletions(-)

diff --git a/arch/arm/boot/dts/socfpga.dtsi b/arch/arm/boot/dts/socfpga.dtsi
index 6d5a5a2..efb1505 100644
--- a/arch/arm/boot/dts/socfpga.dtsi
+++ b/arch/arm/boot/dts/socfpga.dtsi
@@ -715,31 +715,37 @@
 		};
 
 		usb0: usb@ffb00000 {
-			compatible = "snps,dwc-otg";
+			compatible = "snps,dwc2";
 			reg = <0xffb00000 0xffff>;
 			interrupts = <0 125 4>;
-			dma-mask = <0xffffffff>;
-			host-rx-fifo-size = <512>;
 			dev-rx-fifo-size = <512>;
 			dev-nperio-tx-fifo-size = <4096>;
 			dev-perio-tx-fifo-size = <512 512 512 512 512 512
 				512 512 512 512 512 512 512 512 512>;
 			dev-tx-fifo-size = <512 512 512 512 512 512
 				512 512 512 512 512 512 512 512 512>;
+			enable-dynamic-fifo = <1>;
+			host-rx-fifo-size = <0xa00>;
+			host-perio-tx-fifo-size = <0xa00>;
+			host-nperio-tx-fifo-size = <0xa00>;
+			dma-desc-enable = <0>;
 		};
 
 		usb1: usb@ffb40000 {
-			compatible = "snps,dwc-otg";
+			compatible = "snps,dwc2";
 			reg = <0xffb40000 0xffff>;
 			interrupts = <0 128 4>;
-			dma-mask = <0xffffffff>;
-			host-rx-fifo-size = <512>;
 			dev-rx-fifo-size = <512>;
 			dev-nperio-tx-fifo-size = <4096>;
 			dev-perio-tx-fifo-size = <512 512 512 512 512 512
 				512 512 512 512 512 512 512 512 512>;
 			dev-tx-fifo-size = <512 512 512 512 512 512
 				512 512 512 512 512 512 512 512 512>;
+			enable-dynamic-fifo = <1>;
+			host-rx-fifo-size = <0xa00>;
+			host-perio-tx-fifo-size = <0xa00>;
+			host-nperio-tx-fifo-size = <0xa00>;
+			dma-desc-enable = <0>;
 		};
 
 		watchdog0: wd@ffd02000 {
-- 
1.7.5.4

