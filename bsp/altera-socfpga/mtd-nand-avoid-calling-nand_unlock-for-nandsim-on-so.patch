From 8de9a7582dfc035808e95667bd054fb3ae2be1df Mon Sep 17 00:00:00 2001
From: Zhenbo Gao <zhenbo.gao@windriver.com>
Date: Thu, 20 Apr 2017 15:47:44 +0800
Subject: [PATCH] mtd: nand: avoid calling nand_unlock() for nandsim on
 socfpga platform

The following error will be got when typing `ubiformat /dev/mtd0 -y`:
---
 drivers/mtd/nand/nand_base.c |    5 +++++
 1 files changed, 5 insertions(+), 0 deletions(-)

diff --git a/drivers/mtd/nand/nand_base.c b/drivers/mtd/nand/nand_base.c
index c2e1232..a2ec3ea 100644
--- a/drivers/mtd/nand/nand_base.c
+++ b/drivers/mtd/nand/nand_base.c
@@ -977,6 +977,7 @@ static int __nand_unlock(struct mtd_info *mtd, loff_t ofs,
  *
  * Returns unlock status.
  */
+#ifdef CONFIG_MTD_NAND_DENALI
 int nand_unlock(struct mtd_info *mtd, loff_t ofs, uint64_t len)
 {
 	int ret = 0;
@@ -1025,6 +1026,10 @@ out:
 
 	return ret;
 }
+#else
+int nand_unlock(struct mtd_info *mtd, loff_t ofs, uint64_t len)
+{}
+#endif
 EXPORT_SYMBOL(nand_unlock);
 
 /**
-- 
1.7.5.4

