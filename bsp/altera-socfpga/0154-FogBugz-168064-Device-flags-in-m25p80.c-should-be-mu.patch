From 77b99cf76c3d82b170f0233e8ede988b061f0b5d Mon Sep 17 00:00:00 2001
From: Graham Moore <grmoore@altera.com>
Date: Thu, 14 Nov 2013 15:03:42 -0600
Subject: [PATCH 154/248] FogBugz #168064: Device flags in m25p80.c should be
 mutually exclusive

The merge to version 3.12 duplicated device flags 0x08 and 0x10, resulting in
incorrect behavior on CycloneV.  The fix was to change the definitions of
USE_FSR and SHUTDOWN_3BYTE flags to 0x20 and 0x40.

[Original patch taken from
git://git.rocketboards.org/linux-socfpga.git socfpga-3.14]

Signed-off-by: Yanjiang Jin <yanjiang.jin@windriver.com>
Signed-off-by: Graham Moore <grmoore@altera.com>
---
 drivers/mtd/devices/m25p80.c | 5 ++---
 1 file changed, 2 insertions(+), 3 deletions(-)

diff --git a/drivers/mtd/devices/m25p80.c b/drivers/mtd/devices/m25p80.c
index 706b724..d8be6e2 100644
--- a/drivers/mtd/devices/m25p80.c
+++ b/drivers/mtd/devices/m25p80.c
@@ -970,9 +970,8 @@ struct flash_info {
 #define	SST_WRITE	0x04		/* use SST byte programming */
 #define	M25P_NO_FR	0x08		/* Can't do fastread */
 #define	SECT_4K_PMC	0x10		/* OPCODE_BE_4K_PMC works uniformly */
-#define	M25P80_QUAD_READ	0x20    /* Flash supports Quad Read */
-#define	USE_FSR   0x08    /* use flag status register */
-#define	SHUTDOWN_3BYTE   0x10    /* set 3-byte mode on shutdown */
+#define	USE_FSR		0x20		/* use flag status register */
+#define	SHUTDOWN_3BYTE	0x40		/* set 3-byte mode on shutdown */
 };
 
 #define INFO(_jedec_id, _ext_id, _sector_size, _n_sectors, _flags)	\
-- 
1.9.1

