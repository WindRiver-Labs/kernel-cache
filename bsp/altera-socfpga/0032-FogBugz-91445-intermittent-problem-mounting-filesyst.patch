From 4cb70e610d6f96cd4790524ff80326ef1b9de5c8 Mon Sep 17 00:00:00 2001
From: Dinh Nguyen <dinguyen@linux-builds1>
Date: Fri, 18 Jan 2013 09:51:57 -0600
Subject: [PATCH 032/248] FogBugz #91445: intermittent problem mounting
 filesystem on SD/MMC

Disable DMA mode for the SD/MMC controller. It's causing the hang.
Further debugging will be done with DMA enabled, but until the
final solution can be found with DMA, we disable it to reliability
boot with a FS on SD/MMC.

[Original patch taken from
git://git.rocketboards.org/linux-socfpga.git socfpga-3.14]

Signed-off-by: Yanjiang Jin <yanjiang.jin@windriver.com>
Signed-off-by: Dinh Nguyen <dinguyen@altera.com>
---
 arch/arm/boot/dts/socfpga.dtsi     | 2 +-
 arch/arm/configs/socfpga_defconfig | 1 -
 2 files changed, 1 insertion(+), 2 deletions(-)

diff --git a/arch/arm/boot/dts/socfpga.dtsi b/arch/arm/boot/dts/socfpga.dtsi
index f81b3ea..23a0c7b 100644
--- a/arch/arm/boot/dts/socfpga.dtsi
+++ b/arch/arm/boot/dts/socfpga.dtsi
@@ -526,7 +526,7 @@
 			compatible = "snps,dw-mshc";
 			reg = <0xff704000 0x1000>;
 			interrupts = <0 139 4>;
-			bus-hz = <50000000>; /*50 MHz*/
+			bus-hz = <12500000>; /*12.5 MHz*/
 			#address-cells = <1>;
 			#size-cells = <0>;
 			num-slots = <1>;
diff --git a/arch/arm/configs/socfpga_defconfig b/arch/arm/configs/socfpga_defconfig
index 9361864..b3ee96b 100644
--- a/arch/arm/configs/socfpga_defconfig
+++ b/arch/arm/configs/socfpga_defconfig
@@ -74,7 +74,6 @@ CONFIG_USB_GADGET=y
 CONFIG_DWC_OTG_MODE=y
 CONFIG_MMC=y
 CONFIG_MMC_DW=y
-CONFIG_MMC_DW_IDMAC=y
 CONFIG_SPI=y
 CONFIG_SPI_CADENCE_QSPI=y
 CONFIG_SPI_DESIGNWARE=y
-- 
1.9.1

