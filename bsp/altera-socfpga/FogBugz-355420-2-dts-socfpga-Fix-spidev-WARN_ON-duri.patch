From 7b241e9706e8d46d408d3659e8025c6c6e860b44 Mon Sep 17 00:00:00 2001
From: Thor Thayer <tthayer@opensource.altera.com>
Date: Tue, 9 Feb 2016 10:21:10 -0600
Subject: [PATCH 51/73] FogBugz #355420-2: dts: socfpga: Fix spidev WARN_ON()
 during boot.

A WARN_ON() was added to the spidev framework and the spidef compatible
string was removed. The preference is to use an actual part. In our
case, the SPI port is unused but still needs to be tested with each
release. The fix is to spoof spidev using the existing ROHM DAC
compatible string.

Signed-off-by: Thor Thayer <tthayer@opensource.altera.com>
[mli1:Original patch taken from
https://github.com/altera-opensource/linux-socfpga.git socfpga-4.1-ltsi]
Signed-off-by: Meng Li <Meng.Li@windriver.com>
---
 arch/arm/boot/dts/socfpga_cyclone5_socdk.dts |    5 +++--
 1 files changed, 3 insertions(+), 2 deletions(-)

diff --git a/arch/arm/boot/dts/socfpga_cyclone5_socdk.dts b/arch/arm/boot/dts/socfpga_cyclone5_socdk.dts
index 891d939..7f7fa4f 100644
--- a/arch/arm/boot/dts/socfpga_cyclone5_socdk.dts
+++ b/arch/arm/boot/dts/socfpga_cyclone5_socdk.dts
@@ -168,10 +168,11 @@
 };
 
 &spi0 {
-	status = "disabled";
+	status = "okay";
 
 	spidev@0 {
-		compatible = "spidev";
+		/* spidev causes a WARN_ON() so spoof with DAC compat */
+		compatible = "rohm,dh2228fv";
 		reg = <0>;	/* chip select */
 		spi-max-frequency = <1000000>;
 		enable-dma = <1>;
-- 
1.7.5.4

