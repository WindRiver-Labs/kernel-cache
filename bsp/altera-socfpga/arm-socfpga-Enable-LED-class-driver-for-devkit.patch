From f6153bc34f26fffb83d765cd45deae548c6032f2 Mon Sep 17 00:00:00 2001
From: Alan Tull <atull@altera.com>
Date: Wed, 6 Feb 2013 09:45:12 -0600
Subject: [PATCH 189/254] arm: socfpga: Enable LED class driver for devkit

Upstream: git://git.rocketboards.org/linux-socfpga.git
 GPIO LEDs

Set up such that LED names under /sys/class/leds correspond to
the names on the dev board silkscreen, i.e.
 fpga_led0 through fpga_led3 and
 hps_led0 through hps_led3

To turn on an led:
  echo 1 > /sys/class/leds/fpga_led3/brightness

To turn off an led:
  echo 0 > /sys/class/leds/fpga_led3/brightness

Built as modules, so you have to insert them in the right order:
 gpio-dw.ko and gpio-altera.ko
 ledtrig-gpio.ko
 led-class.ko
 leds-gpio.ko

Signed-off-by: Alan Tull <atull@altera.com>
(cherry picked from commit 1e4cc665ad449fe1eef31471bd26aa093546ff3c)
Signed-off-by: Zumeng Chen <zumeng.chen@windriver.com>
---
 arch/arm/boot/dts/socfpga_cyclone5.dts |   59 ++++++++++++++++++++++++++++++++
 arch/arm/configs/socfpga_defconfig     |    5 +++
 2 files changed, 64 insertions(+), 0 deletions(-)

diff --git a/arch/arm/boot/dts/socfpga_cyclone5.dts b/arch/arm/boot/dts/socfpga_cyclone5.dts
index 58bd36e..a25e225 100644
--- a/arch/arm/boot/dts/socfpga_cyclone5.dts
+++ b/arch/arm/boot/dts/socfpga_cyclone5.dts
@@ -131,6 +131,65 @@
 		i2c0: i2c@ffc04000 {
 			speed-mode = <0>;
 		};
+
+		leds {
+			compatible = "gpio-leds";
+			fpga0 {
+				label = "fpga_led0";
+				gpios = <&agpio0 0 1>;
+				linux,default-trigger = "gpio";
+				default-state = "on";
+			};
+
+			fpga1 {
+				label = "fpga_led1";
+				gpios = <&agpio0 1 1>;
+				linux,default-trigger = "gpio";
+				default-state = "on";
+			};
+
+			fpga2 {
+				label = "fpga_led2";
+				gpios = <&agpio0 2 1>;
+				linux,default-trigger = "gpio";
+				default-state = "on";
+			};
+
+			fpga3 {
+				label = "fpga_led3";
+				gpios = <&agpio0 3 1>;
+				linux,default-trigger = "gpio";
+				default-state = "on";
+			};
+
+			hps0 {
+				label = "hps_led0";
+				gpios = <&gpio1 15 1>;
+				linux,default-trigger = "gpio";
+				default-state = "on";
+			};
+
+			hps1 {
+				label = "hps_led1";
+				gpios = <&gpio1 14 1>;
+				linux,default-trigger = "gpio";
+				default-state = "on";
+			};
+
+			hps2 {
+				label = "hps_led2";
+				gpios = <&gpio1 13 1>;
+				linux,default-trigger = "gpio";
+				default-state = "on";
+			};
+
+			hps3 {
+				label = "hps_led3";
+				gpios = <&gpio1 12 1>;
+				linux,default-trigger = "gpio";
+				default-state = "on";
+			};
+		};
 	};
 };
 
diff --git a/arch/arm/configs/socfpga_defconfig b/arch/arm/configs/socfpga_defconfig
index 811f8c7..feeab0a 100644
--- a/arch/arm/configs/socfpga_defconfig
+++ b/arch/arm/configs/socfpga_defconfig
@@ -125,3 +125,8 @@ CONFIG_NFS_V3=y
 CONFIG_NFS_V4=y
 CONFIG_ROOT_NFS=y
 CONFIG_NFS_USE_KERNEL_DNS=y
+CONFIG_NEW_LEDS=y
+CONFIG_LEDS_CLASS=m
+CONFIG_LEDS_GPIO=m
+CONFIG_LEDS_TRIGGERS=y
+CONFIG_LEDS_TRIGGER_GPIO=m
-- 
1.7.5.4

