From 38e6673fd40ad6071e26be34e3ffc304e1e8d56b Mon Sep 17 00:00:00 2001
From: Dinh Nguyen <dinguyen@altera.com>
Date: Fri, 7 Dec 2012 12:15:06 -0600
Subject: [PATCH 169/254] arm: socfpga: Boot Linux on actual hardware

Upstream: git://git.rocketboards.org/linux-socfpga.git

Boot up Linux on devkit using SDRAM on FPGA with an address
location of 0xC0000000. A kconfig option CONFIG_FPGA_SDRAM
has been introduced. This kconfig option is for booting
Linux using the SDRAM on the FPGA.

Also remove NAND support from socfpga_defconfig. Can always
be enabled by menuconfig.

NOTE: To boot Linux on VT or ICE, need to make sure that
CONFIG_FPGA_SDRAM is not selected.

Signed-off-by: Dinh Nguyen <dinguyen@altera.com>
(cherry picked from commit 7e468a46deeb550984645da7554dd714aaa11839)

Conflicts:
	arch/arm/mach-socfpga/Kconfig
Signed-off-by: Zumeng Chen <zumeng.chen@windriver.com>
---
 arch/arm/Kconfig                       |    6 ++++++
 arch/arm/boot/dts/socfpga_cyclone5.dts |   16 ++++++++--------
 arch/arm/configs/socfpga_defconfig     |    6 +-----
 3 files changed, 15 insertions(+), 13 deletions(-)

diff --git a/arch/arm/Kconfig b/arch/arm/Kconfig
index 86c7001..2d42f14 100644
--- a/arch/arm/Kconfig
+++ b/arch/arm/Kconfig
@@ -298,6 +298,12 @@ config ARCH_SOCFPGA
 	help
 	  This enables support for Altera SOCFPGA Cyclone V platform
 
+config FPGA_SDRAM
+	bool "Enables FPGA SDRAM"
+	depends on ARCH_SOCFPGA
+	help
+		This enables the SDRAM controller that is connected to the FGPA.
+
 config ARCH_INTEGRATOR
 	bool "ARM Ltd. Integrator family"
 	select ARM_AMBA
diff --git a/arch/arm/boot/dts/socfpga_cyclone5.dts b/arch/arm/boot/dts/socfpga_cyclone5.dts
index 51a2a04..2016f26 100644
--- a/arch/arm/boot/dts/socfpga_cyclone5.dts
+++ b/arch/arm/boot/dts/socfpga_cyclone5.dts
@@ -23,13 +23,13 @@
 	compatible = "altr,socfpga-cyclone5";
 
 	chosen {
-		bootargs = "console=ttyS0,115200";
+		bootargs = "console=ttyS0,57600";
 	};
 
 	memory {
 		name = "memory";
 		device_type = "memory";
-		reg = <0x0 0x40000000>; /* 1GB */
+		reg = <0xC0000000 0x20000000>; /* 512MB */
 	};
 
 	soc {
@@ -97,35 +97,35 @@
 		timer0: timer@ffc08000 {
 			compatible = "snps,dw-apb-timer-sp";
 			interrupts = <0 167 4>;
-			clock-frequency = <77161>;
+			clock-frequency = <100000000>;
 			reg = <0xffc08000 0x1000>;
 		};
 
 		timer1: timer@ffc09000 {
 			compatible = "snps,dw-apb-timer-sp";
 			interrupts = <0 168 4>;
-			clock-frequency = <77161>;
+			clock-frequency = <100000000>;
 			reg = <0xffc09000 0x1000>;
 		};
 
 		timer2: timer@ffd00000 {
 			compatible = "snps,dw-apb-timer-osc";
 			interrupts = <0 169 4>;
-			clock-frequency = <19290>;
+			clock-frequency = <25000000>;
 			reg = <0xffd00000 0x1000>;
 		};
 
 		timer3: timer@ffd01000 {
 			compatible = "snps,dw-apb-timer-osc";
 			interrupts = <0 170 4>;
-			clock-frequency = <19290>;
+			clock-frequency = <25000000>;
 			reg = <0xffd01000 0x1000>;
 		};
 
 		uart0: uart@ffc02000 {
 			compatible = "snps,dw-apb-uart";
 			reg = <0xffc02000 0x1000>;
-			clock-frequency = <77161>;
+			clock-frequency = <100000000>;
 			interrupts = <0 162 4>;
 			reg-shift = <2>;
 			reg-io-width = <4>;
@@ -134,7 +134,7 @@
 		uart1: uart@ffc03000 {
 			compatible = "snps,dw-apb-uart";
 			reg = <0xffc03000 0x1000>;
-			clock-frequency = <77161>;
+			clock-frequency = <100000000>;
 			interrupts = <0 163 4>;
 			reg-shift = <2>;
 			reg-io-width = <4>;
diff --git a/arch/arm/configs/socfpga_defconfig b/arch/arm/configs/socfpga_defconfig
index 50ce2c0..19112e2 100644
--- a/arch/arm/configs/socfpga_defconfig
+++ b/arch/arm/configs/socfpga_defconfig
@@ -17,6 +17,7 @@ CONFIG_MODULE_UNLOAD=y
 # CONFIG_IOSCHED_CFQ is not set
 CONFIG_ARCH_SOCFPGA=y
 CONFIG_MACH_SOCFPGA_CYCLONE5=y
+CONFIG_FPGA_SDRAM=y
 CONFIG_ARM_THUMBEE=y
 # CONFIG_ARCH_VEXPRESS_CORTEX_A5_A9_ERRATA is not set
 # CONFIG_CACHE_L2X0 is not set
@@ -46,11 +47,6 @@ CONFIG_MTD=y
 CONFIG_MTD_CHAR=y
 CONFIG_MTD_BLOCK=y
 CONFIG_MTD_M25P80=y
-CONFIG_MTD_NAND_ECC=y
-CONFIG_MTD_NAND=y
-CONFIG_MTD_NAND_DENALI=y
-CONFIG_MTD_NAND_DENALI_DT=y
-CONFIG_MTD_NAND_IDS=y
 CONFIG_PROC_DEVICETREE=y
 CONFIG_BLK_DEV_RAM=y
 CONFIG_BLK_DEV_RAM_COUNT=2
-- 
1.7.5.4

