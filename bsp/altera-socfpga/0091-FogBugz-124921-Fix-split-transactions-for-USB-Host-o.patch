From f4cdaf32b9c876b166e3a93493cd0ba25c8febdd Mon Sep 17 00:00:00 2001
From: Dinh Nguyen <dinguyen@altera.com>
Date: Fri, 24 May 2013 13:07:30 -0500
Subject: [PATCH 091/248] FogBugz #124921: Fix split transactions for USB Host
 on SoCFPGA

Fix a bug that prevented LS/FS devices from being recognized through
a HS hub.

[Original patch taken from
git://git.rocketboards.org/linux-socfpga.git socfpga-3.14]

Signed-off-by: Yanjiang Jin <yanjiang.jin@windriver.com>
Signed-off-by: Dinh Nguyen <dinguyen@altera.com>
---
 drivers/usb/otg/dwc/hcd.c | 3 ++-
 1 file changed, 2 insertions(+), 1 deletion(-)

diff --git a/drivers/usb/otg/dwc/hcd.c b/drivers/usb/otg/dwc/hcd.c
index 43fe2d0..fd336e0 100644
--- a/drivers/usb/otg/dwc/hcd.c
+++ b/drivers/usb/otg/dwc/hcd.c
@@ -2106,7 +2106,8 @@ static void dwc_otg_hc_start_transfer(struct dwc_hcd *hcd,
 		u32 hcsplt;
 
 		hcsplt = dwc_reg_read(hc_regs, DWC_HCSPLT);
-		hcsplt = DWC_HCSPLT_COMP_SPLT_RW(hcsplt, 1);
+		hcsplt = DWC_HCSPLT_COMP_SPLT_RW(hcsplt, hc->complete_split);
+		hcsplt = DWC_HCSPLT_ENA_RW(hcsplt, 1);
 		dwc_reg_write(hc_regs, DWC_HCSPLT, hcsplt);
 	}
 
-- 
1.9.1

