From e264524c543ecebc7190aaf8df0f28eda5604d42 Mon Sep 17 00:00:00 2001
From: Thor Thayer <tthayer@opensource.altera.com>
Date: Tue, 26 Jan 2016 13:39:49 -0600
Subject: [PATCH 48/73] FogBugz #352782: Fix A10SyCon Button Indexing

The indexing of the A10 System Controller GPIO Buttons is incorrect
in the current GPIO read implementation. The GPIO requires an offset
into the LED register which is the first GPIO register.

Signed-off-by: Thor Thayer <tthayer@opensource.altera.com>
[mli1:Original patch taken from
https://github.com/altera-opensource/linux-socfpga.git socfpga-4.1-ltsi]
Signed-off-by: Meng Li <Meng.Li@windriver.com>
---
 drivers/gpio/gpio-a10sycon.c |    5 +++--
 1 files changed, 3 insertions(+), 2 deletions(-)

diff --git a/drivers/gpio/gpio-a10sycon.c b/drivers/gpio/gpio-a10sycon.c
index d53e593..1f4cb0ce 100644
--- a/drivers/gpio/gpio-a10sycon.c
+++ b/drivers/gpio/gpio-a10sycon.c
@@ -40,9 +40,10 @@ static int a10sycon_gpio_get(struct gpio_chip *gc, unsigned nr)
 {
 	struct a10sycon_gpio *gpio = to_a10sycon_gpio(gc);
 	int ret;
+	unsigned char reg = A10SYCON_LED_RD_REG + A10SYCON_REG_OFFSET(nr);
+
+	ret = a10sycon_reg_read(gpio->a10sc, reg);
 
-	ret = a10sycon_reg_read(gpio->a10sc,
-				A10SYCON_REG_OFFSET(nr >> 1));
 	if (ret < 0)
 		return ret;
 
-- 
1.7.5.4

