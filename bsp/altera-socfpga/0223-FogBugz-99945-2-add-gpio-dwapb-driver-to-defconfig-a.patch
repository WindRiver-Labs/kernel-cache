From 6a455a9883d6eb9036a0d68737955e32a5f4c68c Mon Sep 17 00:00:00 2001
From: Alan Tull <atull@altera.com>
Date: Thu, 6 Mar 2014 16:22:27 -0600
Subject: [PATCH 223/248] FogBugz #99945-2: add gpio-dwapb driver to defconfig
 and dts

* Add the gpio-dwapb driver to the defconfig and device tree.
* Fix LED definitions in device tree
* Move the LED definitions that are specific to the Altera
  CycloneV socdk board to the proper device tree file.

[Original patch taken from
git://git.rocketboards.org/linux-socfpga.git socfpga-3.14]

Signed-off-by: Yanjiang Jin <yanjiang.jin@windriver.com>
Signed-off-by: Alan Tull <atull@altera.com>

v4: remove socfpga.dtsi changes which were upstreamed
    fix led definitions to match upstream socfpga.dtsi
    enable gpios in cyclone5 and arria5 dtsi
v3: fix arria5 socdk led definitions
    move cyclone5 led definitions to cyclone5 socdk dts
    move clock property to gpio main node, not gpio port nodes
v2: fix cyclone5 led definitions
---
 arch/arm/boot/dts/socfpga_arria5.dtsi        | 12 ++++++++++
 arch/arm/boot/dts/socfpga_cyclone5.dtsi      | 35 ++++++++++------------------
 arch/arm/boot/dts/socfpga_cyclone5_socdk.dts | 23 ++++++++++++++++++
 arch/arm/configs/socfpga_defconfig           |  1 +
 4 files changed, 48 insertions(+), 23 deletions(-)

diff --git a/arch/arm/boot/dts/socfpga_arria5.dtsi b/arch/arm/boot/dts/socfpga_arria5.dtsi
index 98bade3..ac46fed 100644
--- a/arch/arm/boot/dts/socfpga_arria5.dtsi
+++ b/arch/arm/boot/dts/socfpga_arria5.dtsi
@@ -32,6 +32,18 @@
 			};
 		};
 
+		gpio@ff708000 {
+			status = "okay";
+		};
+
+		gpio@ff709000 {
+			status = "okay";
+		};
+
+		gpio@ff70a000 {
+			status = "okay";
+		};
+
 		i2c0: i2c@ffc04000 {
 			speed-mode = <0>;
 			status = "okay";
diff --git a/arch/arm/boot/dts/socfpga_cyclone5.dtsi b/arch/arm/boot/dts/socfpga_cyclone5.dtsi
index 34edbea..01985f1 100644
--- a/arch/arm/boot/dts/socfpga_cyclone5.dtsi
+++ b/arch/arm/boot/dts/socfpga_cyclone5.dtsi
@@ -64,6 +64,18 @@
 			};
 		};
 
+		gpio@ff708000 {
+			status = "okay";
+		};
+
+		gpio@ff709000 {
+			status = "okay";
+		};
+
+		gpio@ff70a000 {
+			status = "okay";
+		};
+
 		i2c0: i2c@ffc04000 {
 			speed-mode = <0>;
 			status = "okay";
@@ -88,29 +100,6 @@
 		watchdog0: wd@ffd02000 {
 			status = "okay";
 		};
-
-		leds {
-			compatible = "gpio-leds";
-			hps0 {
-				label = "hps_led0";
-				gpios = <&gpio1 15 1>;
-			};
-
-			hps1 {
-				label = "hps_led1";
-				gpios = <&gpio1 14 1>;
-			};
-
-			hps2 {
-				label = "hps_led2";
-				gpios = <&gpio1 13 1>;
-			};
-
-			hps3 {
-				label = "hps_led3";
-				gpios = <&gpio1 12 1>;
-			};
-		};
 	};
 };
 
diff --git a/arch/arm/boot/dts/socfpga_cyclone5_socdk.dts b/arch/arm/boot/dts/socfpga_cyclone5_socdk.dts
index 322df65..891536b 100644
--- a/arch/arm/boot/dts/socfpga_cyclone5_socdk.dts
+++ b/arch/arm/boot/dts/socfpga_cyclone5_socdk.dts
@@ -36,6 +36,29 @@
 		 */
 		ethernet0 = &gmac1;
 	};
+
+	leds {
+		compatible = "gpio-leds";
+		hps0 {
+			label = "hps_led0";
+			gpios = <&gpio1 15 1>;
+		};
+
+		hps1 {
+			label = "hps_led1";
+			gpios = <&gpio1 14 1>;
+		};
+
+		hps2 {
+			label = "hps_led2";
+			gpios = <&gpio1 13 1>;
+		};
+
+		hps3 {
+			label = "hps_led3";
+			gpios = <&gpio1 12 1>;
+		};
+	};
 };
 
 &qspi {
diff --git a/arch/arm/configs/socfpga_defconfig b/arch/arm/configs/socfpga_defconfig
index 1aea1ed..6497453 100644
--- a/arch/arm/configs/socfpga_defconfig
+++ b/arch/arm/configs/socfpga_defconfig
@@ -104,6 +104,7 @@ CONFIG_SPI_DW_MMIO=y
 CONFIG_SPI_SPIDEV=y
 CONFIG_GPIOLIB=y
 CONFIG_GPIO_SYSFS=y
+CONFIG_GPIO_DWAPB=y
 CONFIG_GPIO_ALTERA=m
 # CONFIG_RTC_HCTOSYS is not set
 CONFIG_WATCHDOG=y
-- 
1.9.1

