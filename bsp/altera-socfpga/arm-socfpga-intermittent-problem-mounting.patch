From 23b90b43b9f1d1f14a50f0dcbe9939fb522bdd91 Mon Sep 17 00:00:00 2001
From: Dinh Nguyen <dinguyen@linux-builds1>
Date: Fri, 18 Jan 2013 09:51:57 -0600
Subject: [PATCH 177/254] arm: socfpga: intermittent problem mounting

Upstream: git://git.rocketboards.org/linux-socfpga.git
 filesystem on SD/MMC

Disable DMA mode for the SD/MMC controller. It's causing the hang.
Further debugging will be done with DMA enabled, but until the
final solution can be found with DMA, we disable it to reliability
boot with a FS on SD/MMC.

Signed-off-by: Dinh Nguyen <dinguyen@altera.com>
(cherry picked from commit a6b282bdbd6b77f90a533cfcbb298a9f3354bb6c)
Signed-off-by: Zumeng Chen <zumeng.chen@windriver.com>
---
 arch/arm/boot/dts/socfpga.dtsi     |    2 +-
 arch/arm/configs/socfpga_defconfig |    1 -
 2 files changed, 1 insertions(+), 2 deletions(-)

diff --git a/arch/arm/boot/dts/socfpga.dtsi b/arch/arm/boot/dts/socfpga.dtsi
index 15dd1c7..3cd2916 100644
--- a/arch/arm/boot/dts/socfpga.dtsi
+++ b/arch/arm/boot/dts/socfpga.dtsi
@@ -149,7 +149,7 @@
 			compatible = "snps,dw-mshc";
 			reg = <0xff704000 0x1000>;
 			interrupts = <0 139 4>;
-			bus-hz = <50000000>; /*50 MHz*/
+			bus-hz = <12500000>; /*12.5 MHz*/
 			#address-cells = <1>;
 			#size-cells = <0>;
 			num-slots = <1>;
diff --git a/arch/arm/configs/socfpga_defconfig b/arch/arm/configs/socfpga_defconfig
index 9361864..b3ee96b 100644
--- a/arch/arm/configs/socfpga_defconfig
+++ b/arch/arm/configs/socfpga_defconfig
@@ -74,7 +74,6 @@ CONFIG_USB_GADGET=y
 CONFIG_DWC_OTG_MODE=y
 CONFIG_MMC=y
 CONFIG_MMC_DW=y
-CONFIG_MMC_DW_IDMAC=y
 CONFIG_SPI=y
 CONFIG_SPI_CADENCE_QSPI=y
 CONFIG_SPI_DESIGNWARE=y
-- 
1.7.5.4

