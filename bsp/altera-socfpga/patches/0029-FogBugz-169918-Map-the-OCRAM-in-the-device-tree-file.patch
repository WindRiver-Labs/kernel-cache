From 450433ccca8b0ba473d1b831662119c8e525be22 Mon Sep 17 00:00:00 2001
From: Dinh Nguyen <dinguyen@altera.com>
Date: Sat, 23 Nov 2013 21:16:35 -0600
Subject: [PATCH 029/172] FogBugz #169918: Map the OCRAM in the device tree
 file.

By mapping the OCRAM in the device tree, this enables peripheral(s) to make
use of the OCRAM by a assigning an iram node, and using:

of_get_named_gen_pool(np, "iram", 0);

This patch also enables the generic SRAM driver that will map the OCRAM into
a generic mempool.

Signed-off-by: Dinh Nguyen <dinguyen@altera.com>
[czou:Original patch taken from
https://github.com/altera-opensource/linux-socfpga.git socfpga-4.1]
Signed-off-by: czou <cao.zou@windriver.com>
---
 arch/arm/boot/dts/socfpga.dtsi     |  5 +++++
 arch/arm/configs/socfpga_defconfig |  1 +
 drivers/misc/Kconfig               | 11 +++++++++++
 3 files changed, 17 insertions(+)

diff --git a/arch/arm/boot/dts/socfpga.dtsi b/arch/arm/boot/dts/socfpga.dtsi
index 4a1e88f..607fbd0 100644
--- a/arch/arm/boot/dts/socfpga.dtsi
+++ b/arch/arm/boot/dts/socfpga.dtsi
@@ -705,6 +705,11 @@
 			};
 		};
 
+		ocram: sram@ffff0000 {
+			compatible = "mmio-sram";
+			reg = <0xffff0000 0x10000>;
+		};
+
 		pmu {
 			#address-cells = <1>;
 			#size-cells = <1>;
diff --git a/arch/arm/configs/socfpga_defconfig b/arch/arm/configs/socfpga_defconfig
index 338bc33..e11e15a 100644
--- a/arch/arm/configs/socfpga_defconfig
+++ b/arch/arm/configs/socfpga_defconfig
@@ -129,3 +129,4 @@ CONFIG_FPGA=y
 CONFIG_FPGA_MGR_ALTERA=y
 CONFIG_FPGA_BRIDGE=y
 CONFIG_ALTERA_SOCFPGA_BRIDGE=y
+CONFIG_SRAM=y
diff --git a/drivers/misc/Kconfig b/drivers/misc/Kconfig
index 17fb257..bd788d5 100644
--- a/drivers/misc/Kconfig
+++ b/drivers/misc/Kconfig
@@ -553,6 +553,17 @@ config VEXPRESS_SYSCFG
 	  bus. System Configuration interface is one of the possible means
 	  of generating transactions on this bus.
 
+config ALTERA_HWMUTEX
+	tristate "Altera Hardware Mutex"
+	help
+	  This option enables device driver support for Altera Hardware Mutex.
+	  Say Y here if you want to use the Altera hardware mutex support.
+
+config ALTERA_SYSID
+	tristate "Altera System ID"
+	help
+   	  This enables Altera System ID soft core driver.
+
 source "drivers/misc/c2port/Kconfig"
 source "drivers/misc/eeprom/Kconfig"
 source "drivers/misc/cb710/Kconfig"
-- 
1.9.1

