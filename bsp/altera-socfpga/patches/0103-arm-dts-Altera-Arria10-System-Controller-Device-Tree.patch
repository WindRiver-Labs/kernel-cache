From 77f1f1c4f674c6651689de9087911303f33ec005 Mon Sep 17 00:00:00 2001
From: Thor Thayer <tthayer@opensource.altera.com>
Date: Mon, 22 Dec 2014 14:46:09 -0600
Subject: [PATCH 103/172] arm: dts: Altera Arria10 System Controller Device
 Tree entries

This patch adds the device tree entries that enable the Arria 10 System
Controller. The LEDs and Inputs are completely enabled by the device tree.

Signed-off-by: Thor Thayer <tthayer@opensource.altera.com>
[czou:Original patch taken from
https://github.com/altera-opensource/linux-socfpga.git socfpga-4.1]
Signed-off-by: czou <cao.zou@windriver.com>
---
 Documentation/devicetree/bindings/mfd/a10sycon.txt |  51 +++++++++
 arch/arm/boot/dts/socfpga_arria10.dtsi             |  12 +++
 arch/arm/boot/dts/socfpga_arria10_socdk.dts        | 114 +++++++++++++++++++++
 3 files changed, 177 insertions(+)
 create mode 100644 Documentation/devicetree/bindings/mfd/a10sycon.txt

diff --git a/Documentation/devicetree/bindings/mfd/a10sycon.txt b/Documentation/devicetree/bindings/mfd/a10sycon.txt
new file mode 100644
index 0000000..56a194b
--- /dev/null
+++ b/Documentation/devicetree/bindings/mfd/a10sycon.txt
@@ -0,0 +1,51 @@
+* Altera Arria10 System Control IC
+
+Required parent device properties:
+- compatible : "altr,a10sycon"
+- spi-max-frequency : Maximum SPI frequency.
+- reg : the SPI Chip Select address for the Arria10 System Controller chip
+- interrupts : IRQ line for the Arria10 System Controller chip
+- interrupt-controller: describes the Arria10 System Controller as an
+  interrupt controller  (has its own domain)
+- interrupt-parent: The GPIO line that is used for key interrupts.
+- #interrupt-cells : should be 2.
+
+The A10SyCon consists of this varied group of sub-devices:
+
+Device			 Supply Names	 Description
+------			 ------------	 -----------
+a10sycon-gpio		:		: GPIO Controller
+a10sycon-hwmon		:		: Hardware Monitor
+a10sycon-reset		:		: Reset Manager
+
+The input key and LEDs are implemented entirely in the device tree using
+the gpio-leds and gpio-keys frameworks.
+
+Example:
+
+        a10_sysctl: a10_sysctl@0 {
+		compatible = "altr,a10sycon";
+		reg = <0>;
+		interrupt-parent = <&gpio1>;
+		/* low-level active IRQ at GPIO1_5 */
+		interrupts = <5 0x8>;
+		interrupt-controller;
+		#interrupt-cells = <2>;
+		spi-max-frequency = <100000>;
+
+		gpio4: gpio-controller {
+			compatible = "altr,a10sycon-gpio";
+			gpio-controller;
+			#gpio-cells = <2>;
+			ngpios = <16>;
+		};
+
+		hwmon: a10hwmon {
+			compatible = "altr,a10sycon-hwmon";
+		};
+
+		a10rst: a10rst {
+			compatible = "altr,a10sycon-reset";
+			#reset-cells = <1>;
+		};
+	};
diff --git a/arch/arm/boot/dts/socfpga_arria10.dtsi b/arch/arm/boot/dts/socfpga_arria10.dtsi
index 69d616a..539e40f 100644
--- a/arch/arm/boot/dts/socfpga_arria10.dtsi
+++ b/arch/arm/boot/dts/socfpga_arria10.dtsi
@@ -253,6 +253,18 @@
 			status = "disabled";
 		};
 
+		spi0: spi@ffda4000 {
+			compatible = "snps,dw-spi-mmio";
+			#address-cells = <1>;
+			#size-cells = <0>;
+			reg = <0xffda4000 0x100>;
+			interrupts = <0 101 4>;
+			num-chipselect = <4>;
+			bus-num = <0>;
+			tx-dma-channel = <&pdma 16>;
+			rx-dma-channel = <&pdma 17>;
+		};
+
 		L2: l2-cache@fffff000 {
 			compatible = "arm,pl310-cache";
 			reg = <0xfffff000 0x1000>;
diff --git a/arch/arm/boot/dts/socfpga_arria10_socdk.dts b/arch/arm/boot/dts/socfpga_arria10_socdk.dts
index 3015ce8..b9e33ef 100755
--- a/arch/arm/boot/dts/socfpga_arria10_socdk.dts
+++ b/arch/arm/boot/dts/socfpga_arria10_socdk.dts
@@ -32,6 +32,91 @@
 		reg = <0x0 0x40000000>; /* 1GB */
 	};
 
+	a10_leds {
+		compatible = "gpio-leds";
+
+		a10sycon0 {
+			label = "a10sycon_led0";
+			gpios = <&gpio4 4 1>;
+		};
+
+		a10sycon1 {
+			label = "a10sycon_led1";
+			gpios = <&gpio4 5 1>;
+		};
+
+		a10sycon2 {
+			label = "a10sycon_led2";
+			gpios = <&gpio4 6 1>;
+		};
+
+		a10sycon03 {
+			label = "a10sycon_led3";
+			gpios = <&gpio4 7 1>;
+		};
+	};
+
+	a10_keys {
+		compatible = "gpio-keys";
+		#address-cells = <1>;
+		#size-cells = <0>;
+
+		dip_sw0 {
+			label = "DIP_SW0";
+			gpios = <&gpio4 8 1>;
+			linux,code = <0x40>;
+			debounce-interval = <50>;
+		};
+
+		dip_sw1 {
+			label = "DIP_SW1";
+			gpios = <&gpio4 9 1>;
+			linux,code = <0x41>;
+			debounce-interval = <50>;
+		};
+
+		dip_sw2 {
+			label = "DIP_SW2";
+			gpios = <&gpio4 10 1>;
+			linux,code = <0x42>;
+			debounce-interval = <50>;
+		};
+
+		dip_sw3 {
+			label = "DIP_SW3";
+			gpios = <&gpio4 11 1>;
+			linux,code = <0x43>;
+			debounce-interval = <50>;
+		};
+
+		pb_sw0 {
+			label = "PB_SW0";
+			gpios = <&gpio4 12 1>;
+			linux,code = <0x44>;
+			debounce-interval = <50>;
+		};
+
+		pb_sw1 {
+			label = "PB_SW1";
+			gpios = <&gpio4 13 1>;
+			linux,code = <0x45>;
+			debounce-interval = <50>;
+		};
+
+		pb_sw2 {
+			label = "PB_SW2";
+			gpios = <&gpio4 14 1>;
+			linux,code = <0x46>;
+			debounce-interval = <50>;
+		};
+
+		pb_sw3 {
+			label = "PB_SW3";
+			gpios = <&gpio4 15 1>;
+			linux,code = <0x47>;
+			debounce-interval = <50>;
+		};
+	};
 	soc {
 		clkmgr@ffd04000 {
 			clocks {
@@ -46,3 +131,32 @@
 		};
 	};
 };
+
+&spi0 {
+	a10_sysctl: a10_sysctl@0 {
+		compatible = "altr,a10sycon";
+		reg = <0>;
+		interrupt-parent = <&gpio1>;
+		/* low-level active IRQ at GPIO1_5 */
+		interrupts = <5 0x8>;
+		interrupt-controller;
+		#interrupt-cells = <2>;
+		spi-max-frequency = <100000>;
+
+		gpio4: gpio-controller {
+			compatible = "altr,a10sycon-gpio";
+			gpio-controller;
+			#gpio-cells = <2>;
+			ngpios = <16>;
+		};
+
+		hwmon: a10hwmon {
+			compatible = "altr,a10sycon-hwmon";
+		};
+
+		a10rst: a10rst {
+			compatible = "altr,a10sycon-reset";
+			#reset-cells = <1>;
+		};
+	};
+};
-- 
1.9.1

