From 69f29eab5ff0216c7688cfb2be01726d603dd6f4 Mon Sep 17 00:00:00 2001
From: Dinh Nguyen <dinguyen@altera.com>
Date: Thu, 1 Aug 2013 22:21:55 -0500
Subject: [PATCH 004/172] FogBugz #142858: Fix intermittent SD/MMC RFS from not
 mounting

This bug was uncovered during a kernel upgrade to v3.10. The SD/MMC
Hardware Locked Write Error(HLE) was intermittently getting triggered.
The driver does not have any mechanism for handling this interrupt.

Clear the HLE interrupt when it gets triggered.

Signed-off-by: Dinh Nguyen <dinguyen@altera.com>
[czou:Original patch taken from
https://github.com/altera-opensource/linux-socfpga.git socfpga-4.1]
Signed-off-by: czou <cao.zou@windriver.com>
---
 drivers/mmc/host/dw_mmc.c | 3 +++
 1 file changed, 3 insertions(+)

diff --git a/drivers/mmc/host/dw_mmc.c b/drivers/mmc/host/dw_mmc.c
index 83d9366..7ed9148 100644
--- a/drivers/mmc/host/dw_mmc.c
+++ b/drivers/mmc/host/dw_mmc.c
@@ -2272,6 +2272,9 @@ static irqreturn_t dw_mci_interrupt(int irq, void *dev_id)
 			dw_mci_handle_cd(host);
 		}
 
+		if (pending & SDMMC_INT_HLE)
+			mci_writel(host, RINTSTS, SDMMC_INT_HLE);
+
 		/* Handle SDIO Interrupts */
 		for (i = 0; i < host->num_slots; i++) {
 			struct dw_mci_slot *slot = host->slot[i];
-- 
1.9.1

