From 90a9c48893c55e2f4710c560e4b2fb3e09f249ac Mon Sep 17 00:00:00 2001
From: Alan Tull <atull@altera.com>
Date: Tue, 16 Jul 2013 15:18:58 -0500
Subject: [PATCH 017/172] FogBugz #102675: do not touch fpga bridge resets by
 default

Previously we were bringing all FPGA-hps bridges out of reset
without checking to see if the FPGA was programmed.  This patch
changes the behavior to not bring the bridges out of reset
or to set them to be in reset.

Signed-off-by: Alan Tull <atull@altera.com>
[czou:Original patch taken from
https://github.com/altera-opensource/linux-socfpga.git socfpga-4.1]
Signed-off-by: czou <cao.zou@windriver.com>

Conflicts:

	arch/arm/mach-socfpga/socfpga.c
---
 arch/arm/mach-socfpga/socfpga.c | 6 ++++++
 1 file changed, 6 insertions(+)

diff --git a/arch/arm/mach-socfpga/socfpga.c b/arch/arm/mach-socfpga/socfpga.c
index 7e9db6c..07fa754 100644
--- a/arch/arm/mach-socfpga/socfpga.c
+++ b/arch/arm/mach-socfpga/socfpga.c
@@ -133,6 +133,12 @@ static void __init socfpga_scu_map_io(void)
 	iotable_init(&scu_io_desc, 1);
 }
 
+static void __init enable_periphs(void)
+{
+	/* Release all peripherals from reset.*/
+	__raw_writel(0, rst_manager_base_addr + SOCFPGA_RSTMGR_MODPERRST);
+}
+
 static void __init socfpga_map_io(void)
 {
 	socfpga_scu_map_io();
-- 
1.9.1

