From 46459d740c13260d85d42c8e22d7b6fe134e1c0c Mon Sep 17 00:00:00 2001
From: Graham Moore <grmoore@opensource.altera.com>
Date: Tue, 14 Jul 2015 10:30:36 -0500
Subject: [PATCH 147/172] FogBugz #311020-2: qspi: dts: update the dts to use
 upstream qspi patch

The upstream patches for the QSPI driver has several differences from what
was being used downstream. The compatible string changed from "cadence,qspi"
to "cnds,qspi-nor".

Signed-off-by: Graham Moore <grmoore@opensource.altera.com>
Signed-off-by: Dinh Nguyen <dinguyen@opensource.altera.com>
[czou:Original patch taken from 
https://github.com/altera-opensource/linux-socfpga.git socfpga-4.1]
Signed-off-by: czou <cao.zou@windriver.com>
---
 arch/arm/boot/dts/socfpga.dtsi                   |  7 +++---
 arch/arm/boot/dts/socfpga_arria10.dtsi           | 15 ------------
 arch/arm/boot/dts/socfpga_arria10_socdk_qspi.dts | 30 ++++++++++++++----------
 arch/arm/boot/dts/socfpga_arria5_socdk.dts       | 16 ++++++-------
 arch/arm/boot/dts/socfpga_cyclone5_socdk.dts     | 16 ++++++-------
 5 files changed, 36 insertions(+), 48 deletions(-)

diff --git a/arch/arm/boot/dts/socfpga.dtsi b/arch/arm/boot/dts/socfpga.dtsi
index 4de319c..420120e 100644
--- a/arch/arm/boot/dts/socfpga.dtsi
+++ b/arch/arm/boot/dts/socfpga.dtsi
@@ -798,18 +798,17 @@
 		};
 
 		qspi: spi@ff705000 {
-			compatible = "cadence,qspi";
+			compatible = "cdns,qspi-nor";
 			#address-cells = <1>;
 			#size-cells = <0>;
 			reg = <0xff705000 0x1000>,
 				<0xffa00000 0x1000>;
 			interrupts = <0 151 4>;
 			clocks = <&qspi_clk>;
-			ext-decoder = <0>;  /* external decoder */
-			num-chipselect = <4>;
+			is-decoded-cs = <1>;
 			fifo-depth = <128>;
-			bus-num = <2>;
 			status = "disabled";
+			m25p,fast-read;
 		};
 
 		spi0: spi@fff00000 {
diff --git a/arch/arm/boot/dts/socfpga_arria10.dtsi b/arch/arm/boot/dts/socfpga_arria10.dtsi
index 3878c52..35863c4 100644
--- a/arch/arm/boot/dts/socfpga_arria10.dtsi
+++ b/arch/arm/boot/dts/socfpga_arria10.dtsi
@@ -605,21 +605,6 @@
 			reg = <0xffe00000 0x40000>;
 		};
 
-		qspi: spi@ff809000 {
-			#address-cells = <1>;
-			#size-cells = <0>;
-			compatible = "cadence,qspi";
-			reg = <0xff809000 0x100>,
-				<0xffa00000 0x100000>;
-			interrupts = <0 100 IRQ_TYPE_LEVEL_HIGH>;
-			clocks = <&qspi_clk>;
-			ext-decoder = <0>;  /* external decoder */
-			num-chipselect = <4>;
-			fifo-depth = <128>;
-			bus-num = <2>;
-			status = "disabled";
-		};
-
 		rst: rstmgr@ffd05000 {
 			#reset-cells = <1>;
 			compatible = "altr,rst-mgr";
diff --git a/arch/arm/boot/dts/socfpga_arria10_socdk_qspi.dts b/arch/arm/boot/dts/socfpga_arria10_socdk_qspi.dts
index 00eb4d8..586687b 100644
--- a/arch/arm/boot/dts/socfpga_arria10_socdk_qspi.dts
+++ b/arch/arm/boot/dts/socfpga_arria10_socdk_qspi.dts
@@ -20,32 +20,32 @@
 / {
 	soc {
 		qspi: spi@ff809000 {
-			compatible = "cadence,qspi";
+			compatible = "cdns,qspi-nor";
 			#address-cells = <1>;
 			#size-cells = <0>;
 			reg = <0xff809000 0x100>,
 				<0xffa00000 0x100000>;
 			interrupts = <0 100 IRQ_TYPE_LEVEL_HIGH>;
 			clocks = <&l4_main_clk>;
-			ext-decoder = <0>;  /* external decoder */
-			num-chipselect = <4>;
+			is-decoded-cs = <1>;
 			fifo-depth = <128>;
-			bus-num = <2>;
 			status = "okay";
+			m25p,fast-read;
+
 			flash0: n25q00@0 {
 				#address-cells = <1>;
 				#size-cells = <1>;
 				compatible = "n25q00aa";
-				reg = <0>;      /* chip select */
+				reg = <0>;
 				spi-max-frequency = <100000000>;
-				m25p,fast-read;
-				page-size = <256>;
-				block-size = <16>; /* 2^16, 64KB */
-				read-delay = <4>;  /* delay value in read data capture register */
-				tshsl-ns = <50>;
-				tsd2d-ns = <50>;
-				tchsh-ns = <4>;
-				tslch-ns = <4>;
+
+				cdns,page-size = <256>;
+				cdns,block-size = <16>;
+				cdns,read-delay = <4>;
+				cdns,tshsl-ns = <50>;
+				cdns,tsd2d-ns = <50>;
+				cdns,tchsh-ns = <4>;
+				cdns,tslch-ns = <4>;
 
 				partition@qspi-boot {
 					label = "Boot and fpga data";
@@ -59,3 +59,7 @@
 		};
 	};
 };
+
+&usb0 {
+	status = "disabled";
+};
diff --git a/arch/arm/boot/dts/socfpga_arria5_socdk.dts b/arch/arm/boot/dts/socfpga_arria5_socdk.dts
index e768287..6ffd70c 100644
--- a/arch/arm/boot/dts/socfpga_arria5_socdk.dts
+++ b/arch/arm/boot/dts/socfpga_arria5_socdk.dts
@@ -140,14 +140,14 @@
 		compatible = "n25q512a";
 		reg = <0>;      /* chip select */
 		spi-max-frequency = <100000000>;
-		m25p,fast-read;
-		page-size = <256>;
-		block-size = <16>; /* 2^16, 64KB */
-		read-delay = <4>;  /* delay value in read data capture register */
-		tshsl-ns = <50>;
-		tsd2d-ns = <50>;
-		tchsh-ns = <4>;
-		tslch-ns = <4>;
+
+		cdns,page-size = <256>;
+		cdns,block-size = <16>;
+		cdns,read-delay = <4>;
+		cdns,tshsl-ns = <50>;
+		cdns,tsd2d-ns = <50>;
+		cdns,tchsh-ns = <4>;
+		cdns,tslch-ns = <4>;
 
 		partition@qspi-boot {
 			/* 8MB for raw data. */
diff --git a/arch/arm/boot/dts/socfpga_cyclone5_socdk.dts b/arch/arm/boot/dts/socfpga_cyclone5_socdk.dts
index f0a2575..fea06fa 100644
--- a/arch/arm/boot/dts/socfpga_cyclone5_socdk.dts
+++ b/arch/arm/boot/dts/socfpga_cyclone5_socdk.dts
@@ -144,14 +144,14 @@
 		compatible = "n25q00";
 		reg = <0>;      /* chip select */
 		spi-max-frequency = <100000000>;
-		m25p,fast-read;
-		page-size = <256>;
-		block-size = <16>; /* 2^16, 64KB */
-		read-delay = <4>;  /* delay value in read data capture register */
-		tshsl-ns = <50>;
-		tsd2d-ns = <50>;
-		tchsh-ns = <4>;
-		tslch-ns = <4>;
+
+		cdns,page-size = <256>;
+		cdns,block-size = <16>;
+		cdns,read-delay = <4>;
+		cdns,tshsl-ns = <50>;
+		cdns,tsd2d-ns = <50>;
+		cdns,tchsh-ns = <4>;
+		cdns,tslch-ns = <4>;
 
 		partition@qspi-boot {
 			/* 8MB for raw data. */
-- 
1.9.1

