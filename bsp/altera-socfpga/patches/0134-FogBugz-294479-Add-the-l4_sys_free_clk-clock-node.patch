From f20f5755df1d375f4b6d68cc03b74439c74803d4 Mon Sep 17 00:00:00 2001
From: Dinh Nguyen <dinguyen@opensource.altera.com>
Date: Thu, 23 Apr 2015 15:41:51 -0500
Subject: [PATCH 134/172] FogBugz #294479: Add the l4_sys_free_clk clock node

The l4_sys_free_clk is noc_free_clk that goes through a fixed divider of 4
and cannot get gated. The l4_sys_free_clk is also the correct clock for
timers 2 and 3.

Signed-off-by: Dinh Nguyen <dinguyen@opensource.altera.com>
[czou:Original patch taken from
https://github.com/altera-opensource/linux-socfpga.git socfpga-4.1]
Signed-off-by: czou <cao.zou@windriver.com>
---
 arch/arm/boot/dts/socfpga_arria10.dtsi | 11 ++++++++++-
 1 file changed, 10 insertions(+), 1 deletion(-)

diff --git a/arch/arm/boot/dts/socfpga_arria10.dtsi b/arch/arm/boot/dts/socfpga_arria10.dtsi
index 4731ac6..e13f14e 100644
--- a/arch/arm/boot/dts/socfpga_arria10.dtsi
+++ b/arch/arm/boot/dts/socfpga_arria10.dtsi
@@ -311,6 +311,13 @@
 						reg = <0xF8>;
 					};
 
+					l4_sys_free_clk: l4_sys_free_clk {
+						#clock-cells = <0>;
+						compatible = "altr,socfpga-a10-perip-clk";
+						clocks = <&noc_free_clk>;
+						fixed-divider = <4>;
+					};
+
 					l4_main_clk: l4_main_clk {
 						#clock-cells = <0>;
 						compatible = "altr,socfpga-a10-gate-clk";
@@ -642,7 +649,7 @@
 			compatible = "snps,dw-apb-timer-osc";
 			interrupts = <0 117 IRQ_TYPE_LEVEL_HIGH>;
 			reg = <0xffd00000 0x100>;
-			clocks = <&l4_sp_clk>;
+			clocks = <&l4_sys_free_clk>;
 			clock-names = "timer";
 		};
 
@@ -650,6 +657,8 @@
 			compatible = "snps,dw-apb-timer-osc";
 			interrupts = <0 118 IRQ_TYPE_LEVEL_HIGH>;
 			reg = <0xffd01000 0x100>;
+			clocks = <&l4_sys_free_clk>;
+			clock-names = "timer";
 		};
 
 		uart0: serial0@ffc02000 {
-- 
1.9.1

