From 782686e7865f28149c8619e38f08977ad0169cac Mon Sep 17 00:00:00 2001
From: Dinh Nguyen <dinguyen@opensource.altera.com>
Date: Wed, 8 Oct 2014 14:40:21 -0500
Subject: [PATCH 077/172] reset: socfpga: use arch_initcall for early
 initialization

Signed-off-by: Dinh Nguyen <dinguyen@opensource.altera.com>
[czou:Original patch taken from
https://github.com/altera-opensource/linux-socfpga.git socfpga-4.1]
Signed-off-by: czou <cao.zou@windriver.com>
---
 drivers/reset/reset-socfpga.c | 15 ++++++++++++++-
 1 file changed, 14 insertions(+), 1 deletion(-)

diff --git a/drivers/reset/reset-socfpga.c b/drivers/reset/reset-socfpga.c
index 0a8def3..59fe190 100644
--- a/drivers/reset/reset-socfpga.c
+++ b/drivers/reset/reset-socfpga.c
@@ -153,7 +153,20 @@ static struct platform_driver socfpga_reset_driver = {
 		.of_match_table	= socfpga_reset_dt_ids,
 	},
 };
-module_platform_driver(socfpga_reset_driver);
+
+static int __init socfpga_reset_init(void)
+{
+        return platform_driver_probe(&socfpga_reset_driver,
+                                     socfpga_reset_probe);
+}
+
+static void __exit socfpga_reset_exit(void)
+{
+        platform_driver_unregister(&socfpga_reset_driver);
+}
+
+arch_initcall(socfpga_reset_init);
+module_exit(socfpga_reset_exit);
 
 MODULE_AUTHOR("Steffen Trumtrar <s.trumtrar@pengutronix.de");
 MODULE_DESCRIPTION("Socfpga Reset Controller Driver");
-- 
1.9.1

