From a3fb8f70cdc749ffe592a541ff14c1da11192a78 Mon Sep 17 00:00:00 2001
From: Graham Moore <grmoore@altera.com>
Date: Mon, 11 Aug 2014 14:22:14 -0500
Subject: [PATCH 061/172] Set spi_master addr_width parameter in m25p80, needed
 by Cadence QSPI driver.

[czou:Original patch taken from
https://github.com/altera-opensource/linux-socfpga.git socfpga-4.1]
Signed-off-by: czou <cao.zou@windriver.com>
---
 drivers/mtd/devices/m25p80.c | 3 +++
 1 file changed, 3 insertions(+)

diff --git a/drivers/mtd/devices/m25p80.c b/drivers/mtd/devices/m25p80.c
index 3af137f..d13cce8 100644
--- a/drivers/mtd/devices/m25p80.c
+++ b/drivers/mtd/devices/m25p80.c
@@ -232,6 +232,9 @@ static int m25p_probe(struct spi_device *spi)
 	if (ret)
 		return ret;
 
+	spi->addr_width = nor->addr_width;
+
+	data = dev_get_platdata(&spi->dev);
 	ppdata.of_node = spi->dev.of_node;
 
 	return mtd_device_parse_register(&flash->mtd, NULL, &ppdata,
-- 
1.9.1

