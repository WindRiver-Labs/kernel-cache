From 293a592febfa27c1d8d35b681750d105d27a0f15 Mon Sep 17 00:00:00 2001
From: Thor Thayer <tthayer@opensource.altera.com>
Date: Mon, 9 Mar 2015 10:51:47 -0500
Subject: [PATCH 116/172] FogBugz #270904-15: SPI: A10SYCON fixes for 3.18

The device tree compatiblity string for the SPI device needs to
be updated. A change to the gpiochip_remove() function required
a change to the gpio-a10sycon.c file.

Signed-off-by: Thor Thayer <tthayer@opensource.altera.com>
[czou:Original patch taken from
https://github.com/altera-opensource/linux-socfpga.git socfpga-4.1]
Signed-off-by: czou <cao.zou@windriver.com>
---
 arch/arm/boot/dts/socfpga_arria10.dtsi | 2 +-
 drivers/gpio/gpio-a10sycon.c           | 4 +++-
 2 files changed, 4 insertions(+), 2 deletions(-)

diff --git a/arch/arm/boot/dts/socfpga_arria10.dtsi b/arch/arm/boot/dts/socfpga_arria10.dtsi
index a9b3028..1b795b6 100644
--- a/arch/arm/boot/dts/socfpga_arria10.dtsi
+++ b/arch/arm/boot/dts/socfpga_arria10.dtsi
@@ -537,7 +537,7 @@
 		};
 
 		spi1: spi@ffda5000 {
-			compatible = "snps,dw-spi-mmio";
+			compatible = "snps,dw-apb-ssi";
 			#address-cells = <1>;
 			#size-cells = <0>;
 			reg = <0xffda5000 0x100>;
diff --git a/drivers/gpio/gpio-a10sycon.c b/drivers/gpio/gpio-a10sycon.c
index bd913f7..d53e593 100644
--- a/drivers/gpio/gpio-a10sycon.c
+++ b/drivers/gpio/gpio-a10sycon.c
@@ -137,7 +137,9 @@ static int a10sycon_gpio_remove(struct platform_device *pdev)
 {
 	struct a10sycon_gpio *gpio = platform_get_drvdata(pdev);
 
-	return gpiochip_remove(&gpio->gp);
+	gpiochip_remove(&gpio->gp);
+
+	return 0;
 }
 
 static const struct of_device_id a10sycon_gpio_of_match[] = {
-- 
1.9.1

