From a538b7fc4b6118c5802ad4e1f088626782e05cb5 Mon Sep 17 00:00:00 2001
From: Haiqing Bai <Haiqing.Bai@windriver.com>
Date: Fri, 14 Oct 2011 19:20:14 +0800
Subject: [PATCH 2/3] ARM:CNS34xx:Adjust mapping method between BUS addr and PHYS addr

Mapping functions between BUS address and PHYS address take macro PHYS_OFFSET
as address offset, so, as a result of PHYS_OFFSET changed from 0x00000000 to
0x20000000 in mach-cns3xxx/include/mach/memory.h, the functions works abnormal,
and will lead to BUG_ON() when validate memory addr when invoking PCI mapping
routine pci_dma_sync_single_for_device().

Signed-off-by: Haiqing Bai <Haiqing.Bai@windriver.com>
---
 arch/arm/mach-cns3xxx/include/mach/memory.h |    4 ++--
 1 files changed, 2 insertions(+), 2 deletions(-)

diff --git a/arch/arm/mach-cns3xxx/include/mach/memory.h b/arch/arm/mach-cns3xxx/include/mach/memory.h
index 04bc3b0..dd36f4c 100644
--- a/arch/arm/mach-cns3xxx/include/mach/memory.h
+++ b/arch/arm/mach-cns3xxx/include/mach/memory.h
@@ -15,8 +15,8 @@
  */
 #define PHYS_OFFSET		UL(0x20000000)
 
-#define __phys_to_bus(x)	((x) + PHYS_OFFSET)
-#define __bus_to_phys(x)	((x) - PHYS_OFFSET)
+#define __phys_to_bus(x)	((x))
+#define __bus_to_phys(x)	((x))
 
 #define __virt_to_bus(v)	__phys_to_bus(__virt_to_phys(v))
 #define __bus_to_virt(b)	__phys_to_virt(__bus_to_phys(b))
-- 
1.7.0

