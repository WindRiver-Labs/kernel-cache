From 6883428353f0b0d9901baab64d8be9a1e6e66907 Mon Sep 17 00:00:00 2001
From: Tonyliu <Bo.Liu@windriver.com>
Date: Mon, 18 Oct 2010 15:54:15 +0800
Subject: [PATCH] lsi_app3300: add platform specific sched clock

Add platform specific sched_clock() to replace kernel default implementation
for sched_clock precision improvment.

Signed-off-by: Tonyliu <Bo.Liu@windriver.com>
---
 arch/arm/mach-app/timer.c |    8 ++++++++
 1 files changed, 8 insertions(+), 0 deletions(-)

diff --git a/arch/arm/mach-app/timer.c b/arch/arm/mach-app/timer.c
index b972b28..77d189e 100644
--- a/arch/arm/mach-app/timer.c
+++ b/arch/arm/mach-app/timer.c
@@ -41,6 +41,7 @@
 #include <linux/irq.h>
 #include <linux/clockchips.h>
 #include <linux/cpumask.h>
+#include <linux/sched.h>
 
 #include <asm/mach/time.h>
 #include <asm/smp_twd.h>
@@ -155,6 +156,13 @@ static struct clocksource clocksource_app = {
 	.flags	 = CLOCK_SOURCE_IS_CONTINUOUS,
 };
 
+/* Returns current time from boot in nsecs. */
+unsigned long long notrace sched_clock(void)
+{
+	return clocksource_cyc2ns(clocksource_app.read(&clocksource_app),
+			clocksource_app.mult, clocksource_app.shift);
+}
+
 static void __init app_clocksource_init(void)
 {
 	unsigned long core_speed = get_core_speed() / 2;
-- 
1.6.5.2

