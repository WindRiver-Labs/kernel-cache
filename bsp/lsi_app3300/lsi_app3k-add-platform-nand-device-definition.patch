From 99695dcad10c3cdf1e36d7bdd1d76eef49e90386 Mon Sep 17 00:00:00 2001
From: Tony Liu <Bo.Liu@windriver.com>
Date: Tue, 18 May 2010 11:04:41 +0800
Subject: [PATCH 2/7] lsi_app3k: add platform nand device definition

Add on-board 128M nandflash platform device definition and registration.

Signed-off-by: Tony Liu <Bo.Liu@windriver.com>
---
 arch/arm/mach-app/mach-app3k.c |   34 ++++++++++++++++++++++++++++++++++
 1 files changed, 34 insertions(+), 0 deletions(-)

diff --git a/arch/arm/mach-app/mach-app3k.c b/arch/arm/mach-app/mach-app3k.c
index 2ed0b5d..0c616e6 100644
--- a/arch/arm/mach-app/mach-app3k.c
+++ b/arch/arm/mach-app/mach-app3k.c
@@ -86,6 +86,39 @@ static struct platform_device app3k_flash_dev = {
 	.resource = &app3k_flash_res,
 };
 
+static struct mtd_partition app3k_flash_nand_partitions[] = {
+	{
+		.name = "kernel",
+		.size = 0x400000,
+		.offset = 0,
+		.mask_flags = MTD_WRITEABLE,
+	}, {
+		.name = "rootfs",
+		.size = MTDPART_SIZ_FULL,
+		.offset = MTDPART_OFS_APPEND,
+	},
+};
+
+static struct flash_platform_data app3k_flash_nand_data = {
+	.parts = app3k_flash_nand_partitions,
+	.nr_parts = ARRAY_SIZE(app3k_flash_nand_partitions),
+};
+
+static struct resource app3k_flash_nand_res = {
+	.start  = APP3K_PHYS_NAND_BASE,
+	.end    = APP3K_PHYS_NAND_BASE + APP_NAND_SIZE,
+	.flags  = IORESOURCE_MEM,
+};
+
+static struct platform_device app3k_flash_nand_dev = {
+    .name = "app3k-flash-nand",
+    .dev = {
+	.platform_data = &app3k_flash_nand_data,
+    },
+    .num_resources = 1,
+    .resource = &app3k_flash_nand_res,
+};
+
 static struct amba_device uart0_device = {
 	.dev	= {
 		.init_name = "amba:uart0",
@@ -133,6 +166,7 @@ static void app3k_mach_init(void)
 
 	/*register platform devices*/
 	platform_device_register(&app3k_flash_dev);
+	platform_device_register(&app3k_flash_nand_dev);
 	platform_device_register(&appnic_dev);
 }
 
-- 
1.6.5.2

