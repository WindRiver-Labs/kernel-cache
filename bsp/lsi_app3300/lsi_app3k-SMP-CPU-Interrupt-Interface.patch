From daa6798ee791187bedf6208bd2fcbb940299c74a Mon Sep 17 00:00:00 2001
From: Tony Liu <Bo.Liu@windriver.com>
Date: Tue, 18 May 2010 12:57:03 +0800
Subject: [PATCH 5/7] lsi_app3k: SMP CPU Interrupt Interface

Each MP11 CPU can access its own CPU interrupt interface at the same address for
software coherency through all MP11 CPUs. The SCU is responsible for redirecting
MP11 CPU access to the correct MP11 CPU interrupt interface depending on its ID.
Add global variable for cores to initialize it's individual CPU interrupt interface
in platform_secondary_init().

Signed-off-by: Tony Liu <Bo.Liu@windriver.com>
---
 arch/arm/mach-app/include/mach/common.h |    1 +
 arch/arm/mach-app/irq.c                 |    8 +++++++-
 2 files changed, 8 insertions(+), 1 deletions(-)

diff --git a/arch/arm/mach-app/include/mach/common.h b/arch/arm/mach-app/include/mach/common.h
index 23f3a01..c12f68d 100644
--- a/arch/arm/mach-app/include/mach/common.h
+++ b/arch/arm/mach-app/include/mach/common.h
@@ -23,5 +23,6 @@ struct sys_timer;
 
 extern void app_map_io(void);
 extern struct sys_timer app_timer;
+extern void __iomem *gic_cpu_base_addr;
 
 #endif /*__ASM_ARCH_COMMON_H*/
diff --git a/arch/arm/mach-app/irq.c b/arch/arm/mach-app/irq.c
index 586fec4..a7f24e9 100644
--- a/arch/arm/mach-app/irq.c
+++ b/arch/arm/mach-app/irq.c
@@ -21,9 +21,15 @@
 
 #include <asm/hardware/gic.h>
 #include <mach/hardware.h>
+#include <mach/common.h>
+
+/*duplicated GIC base address of CPU interface registers*/
+void __iomem *gic_cpu_base_addr;
 
 void __init app_init_irq_gic(void)
 {
 	gic_dist_init(0, (void __iomem *)(APP_PMR_BASE + 0x1000), 29);
-	gic_cpu_init(0, (void __iomem *)(APP_PMR_BASE + 0x100));
+
+	gic_cpu_base_addr = (void __iomem *)(APP_PMR_BASE + 0x100);
+	gic_cpu_init(0, gic_cpu_base_addr);
 }
-- 
1.6.5.2

