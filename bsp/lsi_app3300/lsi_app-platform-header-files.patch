From 90df6d78d71918b8b4d72a88c54ee0c826c89e8a Mon Sep 17 00:00:00 2001
From: Tony Liu <Bo.Liu@windriver.com>
Date: Tue, 30 Mar 2010 15:37:23 +0800
Subject: [PATCH 09/13] lsi_app: platform header files

Merge hardware definitions and platform dependent macros from vendor drop --
Agere APP Linux Version 2.6.1.5.pre10 05/07/2009.

Signed-off-by: Tonyliu <Bo.Liu@windriver.com>
---
 arch/arm/mach-app/include/mach/debug-macro.S |   39 ++++++++++
 arch/arm/mach-app/include/mach/hardware.h    |   28 ++++++++
 arch/arm/mach-app/include/mach/pmr.h         |   97 ++++++++++++++++++++++++++
 arch/arm/mach-app/include/mach/system.h      |   61 ++++++++++++++++
 arch/arm/mach-app/include/mach/uncompress.h  |   51 ++++++++++++++
 5 files changed, 276 insertions(+), 0 deletions(-)
 create mode 100644 arch/arm/mach-app/include/mach/debug-macro.S
 create mode 100644 arch/arm/mach-app/include/mach/hardware.h
 create mode 100644 arch/arm/mach-app/include/mach/pmr.h
 create mode 100644 arch/arm/mach-app/include/mach/system.h
 create mode 100644 arch/arm/mach-app/include/mach/uncompress.h

diff --git a/arch/arm/mach-app/include/mach/debug-macro.S b/arch/arm/mach-app/include/mach/debug-macro.S
new file mode 100644
index 0000000..019387d
--- /dev/null
+++ b/arch/arm/mach-app/include/mach/debug-macro.S
@@ -0,0 +1,39 @@
+/* include/mach/debug-macro.S
+ *
+ * Debugging macro include header
+ *
+ * Copyright (C) 1994-1999 Russell King
+ * Moved from linux/arch/arm/kernel/debug.S by Ben Dooks
+ *
+ * Copyright (c) 2010 Wind River Systems, Inc.
+ *
+ * This program is free software you can redistribute it and/or modify
+ * it under the terms of the GNU General Public License version 2 as
+ * published by the Free Software Foundation.
+ *
+*/
+
+#include <mach/hardware.h>
+#include <mach/io.h>
+
+	.macro  addruart, rx, tmp
+	mrc p15, 0, \rx, c1, c0
+	tst \rx, #1         @MMU enabled?
+#ifdef CONFIG_ARCH_APP3K
+	ldreq   \rx, =(APP3K_PHYS_UART_BASE) @physical base address
+	ldrne   \rx, =(APP_UART_BASE) @virtual base address
+#endif
+	.endm
+
+	.macro	senduart, rd, rx
+	str     \rd, [\rx]
+	.endm
+
+	.macro	waituart, rd, rx
+1001:	ldr \rd, [\rx, #0x18]
+	tst \rd, #0x20
+	bne 1001b
+	.endm
+
+	.macro	busyuart, rd, rx
+	.endm
diff --git a/arch/arm/mach-app/include/mach/hardware.h b/arch/arm/mach-app/include/mach/hardware.h
new file mode 100644
index 0000000..5189c36
--- /dev/null
+++ b/arch/arm/mach-app/include/mach/hardware.h
@@ -0,0 +1,28 @@
+/*
+ * include/mach/hardware.h
+ *
+ * Copyright (c) 2010 Wind River Systems, Inc.
+ *
+ * This program is free software; you can redistribute it and/or modify
+ * it under the terms of the GNU General Public License as published by
+ * the Free Software Foundation; either version 2 of the License, or
+ * (at your option) any later version.
+ *
+ * This program is distributed in the hope that it will be useful,
+ * but WITHOUT ANY WARRANTY; without even the implied warranty of
+ * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
+ * GNU General Public License for more details.
+ *
+ * You should have received a copy of the GNU General Public License
+ * along with this program; if not, write to the Free Software
+ * Foundation, Inc., 59 Temple Place, Suite 330, Boston, MA  02111-1307  USA
+ */
+
+#ifndef __ASM_ARCH_HARDWARE_H
+#define __ASM_ARCH_HARDWARE_H
+
+#ifdef CONFIG_ARCH_APP3K
+#include <mach/app3k.h>
+#endif /*CONFIG_ARCH_APP3K*/
+
+#endif /*__ASM_ARCH_HARDWARE_H*/
diff --git a/arch/arm/mach-app/include/mach/pmr.h b/arch/arm/mach-app/include/mach/pmr.h
new file mode 100644
index 0000000..ec0dee0
--- /dev/null
+++ b/arch/arm/mach-app/include/mach/pmr.h
@@ -0,0 +1,97 @@
+/*
+ * include/mach/pmr.h
+ *
+ * Copyright (C) 2007 LSI Logic
+ *
+ * This program is free software; you can redistribute it and/or modify
+ * it under the terms of the GNU General Public License as published by
+ * the Free Software Foundation; either version 2 of the License, or
+ * (at your option) any later version.
+ *
+ * This program is distributed in the hope that it will be useful,
+ * but WITHOUT ANY WARRANTY; without even the implied warranty of
+ * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
+ * GNU General Public License for more details.
+ *
+ * You should have received a copy of the GNU General Public License
+ * along with this program; if not, write to the Free Software
+ * Foundation, Inc., 59 Temple Place, Suite 330, Boston, MA  02111-1307  USA
+ */
+
+#ifndef __ASM_ARCH_PMR_H
+#define __ASM_ARCH_PMR_H
+
+#include <mach/hardware.h>
+
+#ifdef CONFIG_ARCH_APP3K
+
+/*
+ * CPU Interrupt Interfaces
+ */
+#define PMR_CII_BASE (APP_PMR_BASE + 0x100)
+
+#define PMR_CII_CONTROL             (PMR_CII_BASE + 0x000)
+#define PMR_CII_PRIORITY_MASK       (PMR_CII_BASE + 0x004)
+#define PMR_CII_BINARY_POINT        (PMR_CII_BASE + 0x008)
+#define PMR_CII_INT_ACK             (PMR_CII_BASE + 0x00c)
+#define PMR_CII_END_OF_INT          (PMR_CII_BASE + 0x010)
+#define PMR_CII_RUNNING_PRI         (PMR_CII_BASE + 0x014)
+#define PMR_CII_HIGHEST_PENDING_INT (PMR_CII_BASE + 0x018)
+
+/*
+ * Global Interrupt Distributer
+ */
+#define PMR_GID_BASE (APP_PMR_BASE + 0x1000)
+
+#define PMR_GID_CONTROL             (PMR_GID_BASE + 0x000)
+#define PMR_GID_CONTROLLER_TYPE     (PMR_GID_BASE + 0x004)
+#define PMR_GID_SET_ENABLE_00_31    (PMR_GID_BASE + 0x100)
+#define PMR_GID_SET_ENABLE_32_63    (PMR_GID_BASE + 0x104)
+#define PMR_GID_CLEAR_ENABLE_00_31  (PMR_GID_BASE + 0x180)
+#define PMR_GID_CLEAR_ENABLE_32_63  (PMR_GID_BASE + 0x184)
+#define PMR_GID_SET_PENDING_00_31   (PMR_GID_BASE + 0x200)
+#define PMR_GID_SET_PENDING_32_63   (PMR_GID_BASE + 0x204)
+#define PMR_GID_CLEAR_PENDING_00_31 (PMR_GID_BASE + 0x280)
+#define PMR_GID_CLEAR_PENDING_32_63 (PMR_GID_BASE + 0x284)
+#define PMR_GID_ACTIVE_00_31        (PMR_GID_BASE + 0x300)
+#define PMR_GID_ACTIVE_32_63        (PMR_GID_BASE + 0x304)
+#define PMR_GID_PRIORITY_00_03      (PMR_GID_BASE + 0x400)
+#define PMR_GID_PRIORITY_04_07      (PMR_GID_BASE + 0x404)
+#define PMR_GID_PRIORITY_08_11      (PMR_GID_BASE + 0x408)
+#define PMR_GID_PRIORITY_12_15      (PMR_GID_BASE + 0x40c)
+#define PMR_GID_PRIORITY_16_19      (PMR_GID_BASE + 0x410)
+#define PMR_GID_PRIORITY_20_23      (PMR_GID_BASE + 0x414)
+#define PMR_GID_PRIORITY_24_27      (PMR_GID_BASE + 0x418)
+#define PMR_GID_PRIORITY_28_31      (PMR_GID_BASE + 0x41c)
+#define PMR_GID_PRIORITY_32_35      (PMR_GID_BASE + 0x420)
+#define PMR_GID_PRIORITY_36_39      (PMR_GID_BASE + 0x424)
+#define PMR_GID_PRIORITY_40_43      (PMR_GID_BASE + 0x428)
+#define PMR_GID_PRIORITY_44_47      (PMR_GID_BASE + 0x42c)
+#define PMR_GID_PRIORITY_48_51      (PMR_GID_BASE + 0x430)
+#define PMR_GID_PRIORITY_52_55      (PMR_GID_BASE + 0x434)
+#define PMR_GID_PRIORITY_56_59      (PMR_GID_BASE + 0x438)
+#define PMR_GID_PRIORITY_60_63      (PMR_GID_BASE + 0x43c)
+#define PMR_GID_CPU_TARGET_00_03    (PMR_GID_BASE + 0x800)
+#define PMR_GID_CPU_TARGET_04_07    (PMR_GID_BASE + 0x804)
+#define PMR_GID_CPU_TARGET_08_11    (PMR_GID_BASE + 0x808)
+#define PMR_GID_CPU_TARGET_12_15    (PMR_GID_BASE + 0x80c)
+#define PMR_GID_CPU_TARGET_16_19    (PMR_GID_BASE + 0x810)
+#define PMR_GID_CPU_TARGET_20_23    (PMR_GID_BASE + 0x814)
+#define PMR_GID_CPU_TARGET_24_27    (PMR_GID_BASE + 0x818)
+#define PMR_GID_CPU_TARGET_28_31    (PMR_GID_BASE + 0x81c)
+#define PMR_GID_CPU_TARGET_32_35    (PMR_GID_BASE + 0x820)
+#define PMR_GID_CPU_TARGET_36_39    (PMR_GID_BASE + 0x824)
+#define PMR_GID_CPU_TARGET_40_43    (PMR_GID_BASE + 0x828)
+#define PMR_GID_CPU_TARGET_44_47    (PMR_GID_BASE + 0x82c)
+#define PMR_GID_CPU_TARGET_48_51    (PMR_GID_BASE + 0x830)
+#define PMR_GID_CPU_TARGET_52_55    (PMR_GID_BASE + 0x834)
+#define PMR_GID_CPU_TARGET_56_59    (PMR_GID_BASE + 0x838)
+#define PMR_GID_CPU_TARGET_60_63    (PMR_GID_BASE + 0x83c)
+#define PMR_GID_CONFIG_00_15        (PMR_GID_BASE + 0xc00)
+#define PMR_GID_CONFIG_16_31        (PMR_GID_BASE + 0xc04)
+#define PMR_GID_CONFIG_32_47        (PMR_GID_BASE + 0xc08)
+#define PMR_GID_CONFIG_48_63        (PMR_GID_BASE + 0xc0c)
+
+#endif /* CONFIG_ARCH_APP3K */
+
+#endif /*__ASM_ARCH_PMR_H*/
diff --git a/arch/arm/mach-app/include/mach/system.h b/arch/arm/mach-app/include/mach/system.h
new file mode 100644
index 0000000..bf428a3
--- /dev/null
+++ b/arch/arm/mach-app/include/mach/system.h
@@ -0,0 +1,61 @@
+/*
+ *  include/mach/system.h
+ *
+ *  Copyright (C) 2004 Agere Systems Inc.
+ *
+ * This program is free software; you can redistribute it and/or modify
+ * it under the terms of the GNU General Public License as published by
+ * the Free Software Foundation; either version 2 of the License, or
+ * (at your option) any later version.
+ *
+ * This program is distributed in the hope that it will be useful,
+ * but WITHOUT ANY WARRANTY; without even the implied warranty of
+ * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
+ * GNU General Public License for more details.
+ *
+ * You should have received a copy of the GNU General Public License
+ * along with this program; if not, write to the Free Software
+ * Foundation, Inc., 59 Temple Place, Suite 330, Boston, MA  02111-1307  USA
+ */
+
+#ifndef __ASM_ARCH_SYSTEM_H
+#define __ASM_ARCH_SYSTEM_H
+
+#include <mach/hardware.h>
+#include <mach/pll.h>
+
+static inline void arch_idle(void)
+{
+	cpu_do_idle();
+}
+
+static inline void arch_reset(char mode, const char *cmd)
+{
+	unsigned long value;
+
+	if ('h' == mode) {
+		value = pll_read(RECONFIG_CONTROL_OFFSET);
+
+	/* This is intended to start a PLL reconfiguration and reset the
+	 * chip.  The other bits in the top nibble (reconfig_ram and
+	 * reconfig_core) are untouched.  The RTE should set them, along
+	 * with the other PLL registers, appropriately before requesting a
+	 * reset.
+	 */
+		value |= 0xc0;
+		pll_write(RECONFIG_CONTROL_OFFSET, value);
+	} else {
+		value = pll_read(RECONFIG_CONTROL_OFFSET);
+
+		if (0 == (value & 0xf)) {
+			value = 0xaabb5544;
+			__asm__ ("mov r9, %0" : : "r" (value));
+		}
+
+		cpu_reset(APP3K_PHYS_NOR_BASE);
+	}
+
+	printk(KERN_ERR "Reset Failed!\n");
+}
+
+#endif /*__ASM_ARCH_SYSTEM_H*/
diff --git a/arch/arm/mach-app/include/mach/uncompress.h b/arch/arm/mach-app/include/mach/uncompress.h
new file mode 100644
index 0000000..feca3c7
--- /dev/null
+++ b/arch/arm/mach-app/include/mach/uncompress.h
@@ -0,0 +1,51 @@
+/*
+ * include/mach/uncompress.h
+ *
+ * Copyright (c) 2010 Wind River Systems, Inc.
+ *
+ * Based on the original file arch/arm/plat-mxc/include/mach/uncompress.h
+ *
+ * This program is free software; you can redistribute it and/or modify
+ * it under the terms of the GNU General Public License as published by
+ * the Free Software Foundation; either version 2 of the License, or
+ * (at your option) any later version.
+ *
+ * This program is distributed in the hope that it will be useful,
+ * but WITHOUT ANY WARRANTY; without even the implied warranty of
+ * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
+ * GNU General Public License for more details.
+ *
+ * You should have received a copy of the GNU General Public License
+ * along with this program; if not, write to the Free Software
+ * Foundation, Inc., 59 Temple Place, Suite 330, Boston, MA  02111-1307  USA
+ */
+#ifndef __ASM_ARCH_UNCOMPRESS_H
+#define __ASM_ARCH_UNCOMPRESS_H
+
+#include <linux/io.h>
+#include <linux/amba/serial.h>
+
+#include <mach/hardware.h>
+
+#define UART_DR   (APP3K_PHYS_UART_BASE + UART01x_DR)
+#define UART_FR   (APP3K_PHYS_UART_BASE + UART01x_FR)
+
+static void putc(int c)
+{
+	while (__raw_readw(UART_FR) & UART01x_FR_TXFF)
+		barrier();
+
+	__raw_writew((c & 0xff), UART_DR);
+}
+
+static inline void flush(void)
+{
+}
+
+/*
+ * nothing to do
+ */
+#define arch_decomp_setup()
+#define arch_decomp_wdog()
+
+#endif /*__ASM_ARCH_UNCOMPRESS_H*/
-- 
1.6.5.2

