From 5f87aab387eee1b782b1fe5df6ed3167fe4c40cf Mon Sep 17 00:00:00 2001
From: Jeremy McNicoll <jeremy.mcnicoll@windriver.com>
Date: Mon, 24 May 2010 16:55:28 -0400
Subject: [PATCH 2/3] WRHV/8572: use common PCI

Enable the needed pieces to utilize the common PCI
infrastructure that is shared between PPC boards.
The DTS now stores the associated offset which is
used to set up the PCI LAW.

Signed-off-by: Jeremy McNicoll <jeremy.mcnicoll@windriver.com>
---
 arch/powerpc/boot/dts/wrhv_mpc8572ds.dts  |    2 ++
 arch/powerpc/platforms/85xx/wrhv_8572ds.c |    3 +++
 2 files changed, 5 insertions(+), 0 deletions(-)

diff --git a/arch/powerpc/boot/dts/wrhv_mpc8572ds.dts b/arch/powerpc/boot/dts/wrhv_mpc8572ds.dts
index afbea54..ab01b92 100644
--- a/arch/powerpc/boot/dts/wrhv_mpc8572ds.dts
+++ b/arch/powerpc/boot/dts/wrhv_mpc8572ds.dts
@@ -200,6 +200,8 @@
 			compatible = "fsl,corenet-law";
 			reg = <0x0 0x1000>;
 			fsl,num-laws = <6>;
+			high-base = <0xc08>;
+			law-attrib = <0xc10>;
 		};
 
 		memory-controller@2000 {
diff --git a/arch/powerpc/platforms/85xx/wrhv_8572ds.c b/arch/powerpc/platforms/85xx/wrhv_8572ds.c
index c5f29fd..b9d69c0 100644
--- a/arch/powerpc/platforms/85xx/wrhv_8572ds.c
+++ b/arch/powerpc/platforms/85xx/wrhv_8572ds.c
@@ -250,6 +250,9 @@ define_machine(mpc8572_ds) {
 	.calibrate_decr		= wrhv_calibrate_decr,
 	.progress		= udbg_progress,
 	.earlycon_setup		= wrhv_earlycon_setup,
+	.set_law_base		= wrhv_set_law_base,
+	.set_law_attr		= wrhv_set_law_attr,
+	.get_law_attr		= wrhv_get_law_attr,
 };
 
 define_machine(p2020_ds) {
-- 
1.6.5.2

