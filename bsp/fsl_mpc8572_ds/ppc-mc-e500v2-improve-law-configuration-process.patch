From 86344ac38615608949d203394c677095aa54daca Mon Sep 17 00:00:00 2001
From: Tiejun Chen <tiejun.chen@windriver.com>
Date: Thu, 12 Aug 2010 14:18:00 +0800
Subject: [PATCH] ppc-mc/e500v2: improve law configuration process

Looks the law register offset is different platform so define one variable
for this given case. And it's safe to invalid those address space which are
same as PCIE space so provide the newbie to check if we reuse the same space
then invalid them.

Additionally fix incorrect base address offset while configuring LAW since
we have 36-bit physical address on e500v2.

We should provide .get_law_base to support PCIe.

Signed-off-by: Tiejun Chen <tiejun.chen@windriver.com>
---
 arch/powerpc/platforms/85xx/wrhv_8572ds.c |    2 ++
 1 files changed, 2 insertions(+), 0 deletions(-)

diff --git a/arch/powerpc/platforms/85xx/wrhv_8572ds.c b/arch/powerpc/platforms/85xx/wrhv_8572ds.c
index eebf4b2..c395eb0 100644
--- a/arch/powerpc/platforms/85xx/wrhv_8572ds.c
+++ b/arch/powerpc/platforms/85xx/wrhv_8572ds.c
@@ -43,6 +43,7 @@ extern struct vb_config *wr_config;
 extern struct vb_status *wr_status;
 extern struct vb_control *wr_control;
 extern int wrhv_set_law_base(int index, unsigned long long addr);
+extern unsigned long long wrhv_get_law_base(int index);
 extern int wrhv_set_law_attr(int index, unsigned int attr);
 extern int wrhv_get_law_attr(int index);
 
@@ -261,6 +262,7 @@ define_machine(mpc8572_ds) {
 	.pcibios_fixup_bus	= fsl_pcibios_fixup_bus,
 	.enable_pci_law		= wrhv_enable_pci_law,
 	.set_law_base		= wrhv_set_law_base,
+	.get_law_base		= wrhv_get_law_base,
 	.set_law_attr		= wrhv_set_law_attr,
 	.get_law_attr		= wrhv_get_law_attr,
 #endif
-- 
1.6.5.2

