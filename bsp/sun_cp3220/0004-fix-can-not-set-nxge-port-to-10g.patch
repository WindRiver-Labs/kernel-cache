From dceb802a4f5397d7cc28876df73b14fb99b2af9d Mon Sep 17 00:00:00 2001
From: Jack Tan <jack.tan@windriver.com>
Date: Fri, 31 Oct 2008 16:48:50 +0800
Subject: [PATCH] fix can not set nxge port to 10g

Current driver version can not set phy_type[] to "xgsd" which is needed by
10G port mode, so add support for it.

The original patch is made by Fei Wu.

Signed-off-by: Jack Tan <jack.tan@windriver.com>
Signed-off-by: Fei Wu <fei.wu@windriver.com>
---
 drivers/net/nxge/nxge_main.c |   38 ++++++++++++++++++++++++++------------
 1 files changed, 26 insertions(+), 12 deletions(-)

diff --git a/drivers/net/nxge/nxge_main.c b/drivers/net/nxge/nxge_main.c
index 753780f..4cf906d 100644
--- a/drivers/net/nxge/nxge_main.c
+++ b/drivers/net/nxge/nxge_main.c
@@ -1195,19 +1195,33 @@ nxge_get_eeprom_config(p_nxge_t nxgep)
 				phy_type[3] = '\0';
 				break;
 			case PORT_TYPE_XMAC:
-				if ((nxgep->mac.portnum == 1) &&
-					(nxge_atca_port_mode & NXGE_ATCA_PORT1_1G)) {
-					phy_type[0] = 'g';
-					phy_type[1] = 's';
-					phy_type[2] = 'd';
-					phy_type[3] = '\0';
+				if (nxgep->mac.portnum == 1) {
+					if (nxge_atca_port_mode & NXGE_ATCA_PORT1_1G) {
+						phy_type[0] = 'g';
+						phy_type[1] = 's';
+						phy_type[2] = 'd';
+						phy_type[3] = '\0';
+					} else {
+						phy_type[0] = 'x';
+						phy_type[1] = 'g';
+						phy_type[2] = 's';
+						phy_type[3] = 'd';
+						phy_type[4] = '\0';
+					}
 				}
-				if ((nxgep->mac.portnum == 0) &&
-					(nxge_atca_port_mode & NXGE_ATCA_PORT0_1G)) {
-					phy_type[0] = 'g';
-					phy_type[1] = 's';
-					phy_type[2] = 'd';
-					phy_type[3] = '\0';
+				if (nxgep->mac.portnum == 0) {
+					if (nxge_atca_port_mode & NXGE_ATCA_PORT0_1G) {
+						phy_type[0] = 'g';
+						phy_type[1] = 's';
+						phy_type[2] = 'd';
+						phy_type[3] = '\0';
+					} else {
+						phy_type[0] = 'x';
+						phy_type[1] = 'g';
+						phy_type[2] = 's';
+						phy_type[3] = 'd';
+						phy_type[4] = '\0';
+					}
 				}
 
 				break;
-- 
1.6.0.90.g436ed

