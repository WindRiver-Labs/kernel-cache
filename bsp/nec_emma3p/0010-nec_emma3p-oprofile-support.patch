From: Mark Asselstine <mark.asselstine@windriver.com>

Enable building and use of performance register driver

Enable oprofile support for the R9721 CPU type used
by the emma3p. This will allow the performance register
driver to be build and used.

Signed-off-by: Mark Asselstine <mark.asselstine@windriver.com>
diff --git a/arch/mips/oprofile/Makefile b/arch/mips/oprofile/Makefile
index 977a828..63c3f00 100644
--- a/arch/mips/oprofile/Makefile
+++ b/arch/mips/oprofile/Makefile
@@ -14,5 +14,7 @@ oprofile-$(CONFIG_CPU_MIPS32)		+= op_model_mipsxx.o
 oprofile-$(CONFIG_CPU_MIPS64)		+= op_model_mipsxx.o
 oprofile-$(CONFIG_CPU_R10000)		+= op_model_mipsxx.o
 oprofile-$(CONFIG_CPU_SB1)		+= op_model_mipsxx.o
+oprofile-$(CONFIG_CPU_R9721)		+= op_model_vr5500.o
+oprofile-$(CONFIG_SYS_HAS_CPU_R9721)	+= op_model_vr5500.o
 oprofile-$(CONFIG_CPU_VR5500)		+= op_model_vr5500.o
 oprofile-$(CONFIG_CPU_RM9000)		+= op_model_rm9000.o
diff --git a/arch/mips/oprofile/common.c b/arch/mips/oprofile/common.c
index 68aad99..0b7a449 100644
--- a/arch/mips/oprofile/common.c
+++ b/arch/mips/oprofile/common.c
@@ -96,6 +96,7 @@ int __init oprofile_arch_init(struct oprofile_operations *ops)
 		lmodel = &op_model_rm9000_ops;
 		break;
 
+	case CPU_R9721:
 	case CPU_R5500:
 		lmodel = &op_model_vr5500_ops;
 		break;
diff --git a/arch/mips/oprofile/op_model_vr5500.c b/arch/mips/oprofile/op_model_vr5500.c
index 75fae6a..ecd3952 100644
--- a/arch/mips/oprofile/op_model_vr5500.c
+++ b/arch/mips/oprofile/op_model_vr5500.c
@@ -145,6 +145,7 @@ static int __init vr5500_init(void)
 	on_each_cpu(reset_counters, NULL, 1);
 
 	switch (current_cpu_type()) {
+	case CPU_R9721:
 	case CPU_R5500:
 		op_model_vr5500_ops.cpu_type = "mips/vr5500";
 		break;
