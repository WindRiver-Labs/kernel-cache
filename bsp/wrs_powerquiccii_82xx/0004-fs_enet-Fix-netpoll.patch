From 862298d1c18550d73561ea76f6fd70a419a392dd Mon Sep 17 00:00:00 2001
From: Jeremy McNicoll <jeremy.mcnicoll@windriver.com>
Date: Mon, 9 Mar 2009 00:32:54 -0400
Subject: [PATCH] fs_enet: Fix netpoll

In order to use KGDBoE netpoll must be enabled and functional.
Unfortunately during the transition to CONFIG_PPC_CPM_NEW_BINDING
the call was dropped.  This fix is a portion of the larger commit
7385d595751 that can be found upstream from the 2.6.28 development
cycle.

Signed-off-by: Jeremy McNicoll <jeremy.mcnicoll@windriver.com>
---
 drivers/net/fs_enet/fs_enet-main.c |    4 ++++
 1 files changed, 4 insertions(+), 0 deletions(-)

diff --git a/drivers/net/fs_enet/fs_enet-main.c b/drivers/net/fs_enet/fs_enet-main.c
index b75d27e..f987b26 100644
--- a/drivers/net/fs_enet/fs_enet-main.c
+++ b/drivers/net/fs_enet/fs_enet-main.c
@@ -1116,6 +1116,10 @@ static int __devinit fs_enet_probe(struct of_device *ofdev,
 	ndev->get_stats = fs_enet_get_stats;
 	ndev->set_multicast_list = fs_set_multicast_list;
 
+#ifdef CONFIG_NET_POLL_CONTROLLER
+	ndev->poll_controller = fs_enet_netpoll;
+#endif
+
 	if (fpi->use_napi)
 		netif_napi_add(ndev, &fep->napi, fs_enet_rx_napi,
 		               fpi->napi_weight);
-- 
1.6.0.4

