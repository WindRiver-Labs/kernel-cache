From: Tiejun Chen <tiejun.chen@windriver.com>
Subject: emer_atcaf101 dts updates for flash protection
Date: Tue, 23 Dec 2008 17:31:33 +0800

This modifies the flash portions of the dts to protect vulnerable
blocks. Other changes include additional flash support and a
bootargs template.

Signed-off-by: Tiejun Chen <tiejun.chen@windriver.com>
diff --git a/arch/powerpc/boot/dts/prpmc2800.dts b/arch/powerpc/boot/dts/prpmc2800.dts
index 8011dda..cbe33d5 100644
--- a/arch/powerpc/boot/dts/prpmc2800.dts
+++ b/arch/powerpc/boot/dts/prpmc2800.dts
@@ -54,7 +54,8 @@
 			  0x80000000 0x80000000 0x8000000 /* PCI 0 MEM Space */
 			  0xa0000000 0xa0000000 0x4000000 /* User FLASH */
 			  0x00000000 0xf1000000 0x0010000 /* Bridge's regs */
-			  0xf2000000 0xf2000000 0x0040000>;/* Integrated SRAM */
+			  0xf2000000 0xf2000000 0x0040000 /* Integrated SRAM */
+			  0xfff00000 0xfff00000 0x0100000>;/* BOOT FLASH */
 
 		flash@a0000000 {
 			device_type = "rom";
@@ -62,14 +63,25 @@
 			reg = <0xa0000000 0x4000000>; /* Default (64MB) */
 			probe-type = "CFI";
 			bank-width = <4>;
-			partitions = <0x00000000 0x00100000 /* RO */
-				      0x00100000 0x00040001 /* RW */
-				      0x00140000 0x00400000 /* RO */
-				      0x00540000 0x039c0000 /* RO */
-				      0x03f00000 0x00100000>; /* RO */
+			partitions = <0x00000000 0x00100001 /* RO */
+				      0x00100000 0x00040001 /* RO */
+				      0x00140000 0x00400000 /* RW */
+				      0x00540000 0x039c0000 /* RW */
+				      0x03f00000 0x00100001>; /* RO */
 			partition-names = "FW Image A", "FW Config Data", "Kernel Image", "Filesystem", "FW Image B";
 		};
 
+		boot-flash@fff00000 {
+			compatible = "jedec-flash";
+			reg = <0xfff00000 0x100000>; /* 1MB */
+			probe-type = "JEDEC";
+			bank-width = <1>;
+			vendor-id = <01>;
+			device-id = <37>;
+			partitions = <0x00000000 0x00100001>; /* RO */
+			partition-names = "Boot-Flash ";
+		};
+
 		mdio {
 			#address-cells = <1>;
 			#size-cells = <0>;
@@ -331,7 +343,7 @@
 	};
 
 	chosen {
-		bootargs = "ip=on";
+		bootargs = "root=/dev/nfs rw ip=::::ATCAF101:eth2:dhcp console=ttyMM0,9600";
 		linux,stdout-path = &MPSC0;
 	};
 };

