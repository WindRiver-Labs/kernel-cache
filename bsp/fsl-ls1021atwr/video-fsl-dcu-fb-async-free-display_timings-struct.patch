From 8900b52840ce2406a950bf654eaaa22e54935e55 Mon Sep 17 00:00:00 2001
From: Zumeng Chen <zumeng.chen@windriver.com>
Date: Mon, 14 Aug 2017 09:35:26 +0800
Subject: [PATCH 1/2] video: fsl-dcu-fb: async free display_timings struct

This patch is to free dt from both situation by async due to the ugly design
of display timings function. And the different goto path is used for timings
since the release will refer to timings->struct_mem at first.

Signed-off-by: Zumeng Chen <zumeng.chen@windriver.com>
---
 drivers/video/fbdev/fsl-dcu-fb.c | 5 ++++-
 1 file changed, 4 insertions(+), 1 deletion(-)

diff --git a/drivers/video/fbdev/fsl-dcu-fb.c b/drivers/video/fbdev/fsl-dcu-fb.c
index a7f3d7a..89f7917 100644
--- a/drivers/video/fbdev/fsl-dcu-fb.c
+++ b/drivers/video/fbdev/fsl-dcu-fb.c
@@ -829,7 +829,7 @@ static int fsl_dcu_init_fbinfo(struct fb_info *info)
 	if (!timings_np) {
 		dev_err(dcufb->dev, "failed to find display-timings node\n");
 		ret = -ENOENT;
-		goto put_display_node;
+		goto free_timings_and_display_node;
 	}
 
 	for (i = 0; i < of_get_child_count(timings_np); i++) {
@@ -847,9 +847,12 @@ static int fsl_dcu_init_fbinfo(struct fb_info *info)
 		fb_add_videomode(&fb_vm, &info->modelist);
 	}
 
+	display_timings_release(timings);
 	return 0;
 put_timings_node:
 	of_node_put(timings_np);
+free_timings_and_display_node:
+	display_timings_release(timings);
 put_display_node:
 	of_node_put(display_np);
 	return ret;
-- 
2.9.3

