From 737c98b3080be6b9534d523008d5f474e375d5da Mon Sep 17 00:00:00 2001
From: Jack Tan <jack.tan@windriver.com>
Date: Tue, 16 Dec 2008 19:07:10 +0800
Subject: [PATCH] rmi xlr unaligned support

Some revisions of XLR support unaligned accesses for lb/lh/lw/ld but
not ll. So, use ll for all XLR revisions instead.

Signed-off-by: Jack Tan <jack.tan@windriver.com>
---
 arch/mips/math-emu/dsemul.h |    8 ++++++++
 1 files changed, 8 insertions(+), 0 deletions(-)

diff --git a/arch/mips/math-emu/dsemul.h b/arch/mips/math-emu/dsemul.h
index 091f0e7..af9b12d 100644
--- a/arch/mips/math-emu/dsemul.h
+++ b/arch/mips/math-emu/dsemul.h
@@ -2,7 +2,15 @@ extern int mips_dsemul(struct pt_regs *regs, mips_instruction ir, unsigned long
 extern int do_dsemulret(struct pt_regs *xcp);
 
 /* Instruction which will always cause an address error */
+#ifdef CONFIG_RMI_PHOENIX
+/* Some revisions of XLR support unaligned accesses for
+ * lb/lh/lw/ld but not ll. So, use ll for all XLR revisions
+ * instead
+*/
+#define AdELOAD 0xc0000001 /* ll $0,1($0) */
+#else
 #define AdELOAD 0x8c000001	/* lw $0,1($0) */
+#endif
 /* Instruction which will plainly cause a CP1 exception when FPU is disabled */
 #define CP1UNDEF 0x44400001    /* cfc1 $0,$0 undef  */
 
-- 
1.6.0.2.GIT

