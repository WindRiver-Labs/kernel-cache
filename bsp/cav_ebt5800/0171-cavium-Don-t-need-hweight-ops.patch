From 77b03da7c8d70994d1eadf1ab99544ac4abbb3f1 Mon Sep 17 00:00:00 2001
From: auto commit <unknown@unknown>
Date: Fri, 24 Oct 2008 12:23:16 -0700
Subject: [PATCH] cavium: Don't need hweight ops

The cavium doesn't need the hweight functions from lib

Signed-off-by: Paul Gortmaker <Paul.Gortmaker@windriver.com>
---
 include/asm-mips/bitops.h |   23 ++++++++++++++++++++++-
 lib/hweight.c             |    3 ++-
 2 files changed, 24 insertions(+), 2 deletions(-)

diff --git a/include/asm-mips/bitops.h b/include/asm-mips/bitops.h
index a2a2106..77667fb 100644
--- a/include/asm-mips/bitops.h
+++ b/include/asm-mips/bitops.h
@@ -664,11 +664,32 @@ static inline int ffs(int word)
 #ifdef __KERNEL__
 
 #include <asm-generic/bitops/sched.h>
+#ifdef CONFIG_CPU_CAVIUM_OCTEON
+static inline int hweight64(unsigned long x)
+{
+     return __builtin_popcountl(x);
+}
+
+static inline int hweight32(unsigned int x)
+{
+     return __builtin_popcount(x);
+}
+
+static inline int hweight16(unsigned short x)
+{
+     return __builtin_popcount(x);
+}
+
+static inline int hweight8(unsigned char x)
+{
+     return __builtin_popcount(x);
+}
+#else
 #include <asm-generic/bitops/hweight.h>
+#endif
 #include <asm-generic/bitops/ext2-non-atomic.h>
 #include <asm-generic/bitops/ext2-atomic.h>
 #include <asm-generic/bitops/minix.h>
 
 #endif /* __KERNEL__ */
-
 #endif /* _ASM_BITOPS_H */
diff --git a/lib/hweight.c b/lib/hweight.c
index 389424e..088fa5c 100644
--- a/lib/hweight.c
+++ b/lib/hweight.c
@@ -8,7 +8,7 @@
  *
  * The Hamming Weight of a number is the total number of bits set in it.
  */
-
+#ifndef CONFIG_CPU_CAVIUM_OCTEON
 unsigned int hweight32(unsigned int w)
 {
 	unsigned int res = w - ((w >> 1) & 0x55555555);
@@ -57,3 +57,4 @@ unsigned long hweight64(__u64 w)
 #endif
 }
 EXPORT_SYMBOL(hweight64);
+#endif
-- 
1.5.5.1

