From e62739095b54b779a65ad559d6fc62434c2a0f98 Mon Sep 17 00:00:00 2001
From: auto commit <unknown@unknown>
Date: Fri, 24 Oct 2008 12:23:01 -0700
Subject: [PATCH] cavium: pgtable init changes

On Cavium, change pgd_init and pmd_init to allow for the different
page table usage.

Signed-off-by: Tomaso Paoletti <tpaoletti@caviumnetworks.com>
Signed-off-by: Paul Gortmaker <Paul.Gortmaker@windriver.com>
---
 arch/mips/mm/pgtable-64.c |   10 ++++++++++
 1 files changed, 10 insertions(+), 0 deletions(-)

diff --git a/arch/mips/mm/pgtable-64.c b/arch/mips/mm/pgtable-64.c
index e4b565a..2951e08 100644
--- a/arch/mips/mm/pgtable-64.c
+++ b/arch/mips/mm/pgtable-64.c
@@ -27,8 +27,13 @@ void pgd_init(unsigned long page)
 		p[4] = (unsigned long) invalid_pmd_table;
 		p[5] = (unsigned long) invalid_pmd_table;
 		p[6] = (unsigned long) invalid_pmd_table;
+#ifndef CONFIG_CPU_CAVIUM_OCTEON
 		p[7] = (unsigned long) invalid_pmd_table;
+#endif
 		p += 8;
+#ifdef CONFIG_CPU_CAVIUM_OCTEON
+		p[-1] = (unsigned long) invalid_pmd_table;
+#endif
 	}
 }
 
@@ -47,8 +52,13 @@ void pmd_init(unsigned long addr, unsigned long pagetable)
 		p[4] = (unsigned long)pagetable;
 		p[5] = (unsigned long)pagetable;
 		p[6] = (unsigned long)pagetable;
+#ifndef CONFIG_CPU_CAVIUM_OCTEON
 		p[7] = (unsigned long)pagetable;
+#endif
 		p += 8;
+#ifdef CONFIG_CPU_CAVIUM_OCTEON
+		p[-1] = (unsigned long)pagetable;
+#endif
 	}
 }
 
-- 
1.5.5.1

