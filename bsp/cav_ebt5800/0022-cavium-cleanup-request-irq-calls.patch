From 1a105383db50676d93887a0421b5f1b838fba954 Mon Sep 17 00:00:00 2001
From: auto commit <unknown@unknown>
Date: Fri, 24 Oct 2008 12:22:37 -0700
Subject: [PATCH] cavium: cleanup request irq calls

Signed-off-by: Tomaso Paoletti <tpaoletti@caviumnetworks.com>
---
 arch/mips/cavium-octeon/i8259.c |   10 ++++++----
 arch/mips/cavium-octeon/setup.c |    5 +++--
 arch/mips/cavium-octeon/smp.c   |   10 ++++++----
 3 files changed, 15 insertions(+), 10 deletions(-)

diff --git a/arch/mips/cavium-octeon/i8259.c b/arch/mips/cavium-octeon/i8259.c
index 48dede9..842147f 100644
--- a/arch/mips/cavium-octeon/i8259.c
+++ b/arch/mips/cavium-octeon/i8259.c
@@ -158,12 +158,14 @@ void octeon_i8259_setup(int irq_line)
 		printk("8259: Setting GPIO %d for the interrupt\n",
 		       irq_line - 24);
 		cvmx_write_csr(CVMX_GPIO_BIT_CFGX(irq_line - 24), 0x114);
-		request_irq(irq_line, octeon_i8259_interrupt, IRQF_SHARED, "8259",
-			    octeon_i8259_interrupt);
+		if (request_irq(irq_line, octeon_i8259_interrupt, IRQF_SHARED, "8259",
+			    octeon_i8259_interrupt)) {
+		}
 	} else if ((irq_line >= 44) && (irq_line <= 47)) {
 		printk("8259: Using PCI INT-%c\n", irq_line - 44 + 'A');
-		request_irq(irq_line, octeon_i8259_interrupt, IRQF_SHARED, "8259",
-			    octeon_i8259_interrupt);
+		if (request_irq(irq_line, octeon_i8259_interrupt, IRQF_SHARED, "8259",
+			    octeon_i8259_interrupt)) {
+		}
 	} else {
 		panic("8259: Don't know how to setup the interrupt IRQ %d\n",
 		      irq_line);
diff --git a/arch/mips/cavium-octeon/setup.c b/arch/mips/cavium-octeon/setup.c
index 8ce5941..5d6cef9 100644
--- a/arch/mips/cavium-octeon/setup.c
+++ b/arch/mips/cavium-octeon/setup.c
@@ -351,8 +351,9 @@ void prom_free_prom_memory(void)
 	cvmx_interrupt_rsl_enable();
 
 	/* Add an interrupt handler for general failures. */
-	request_irq(OCTEON_IRQ_RML, octeon_rlm_interrupt, IRQF_SHARED, "RML/RSL",
-		    octeon_rlm_interrupt);
+	if (request_irq(OCTEON_IRQ_RML, octeon_rlm_interrupt, IRQF_SHARED, "RML/RSL",
+		    octeon_rlm_interrupt)) {
+	}
 
 	/* This call is here so that it is performed after any TLB
 	   initializations. It needs to be after these in case the
diff --git a/arch/mips/cavium-octeon/smp.c b/arch/mips/cavium-octeon/smp.c
index d492bc0..18b7004 100644
--- a/arch/mips/cavium-octeon/smp.c
+++ b/arch/mips/cavium-octeon/smp.c
@@ -166,10 +166,12 @@ static void octeon_init_secondary(void)
 void octeon_prepare_cpus(unsigned int max_cpus)
 {
 	cvmx_write_csr(CVMX_CIU_MBOX_CLRX(cvmx_get_core_num()), 0xffffffff);
-	request_irq(OCTEON_IRQ_MBOX0, mailbox_interrupt, IRQF_SHARED, "mailbox0",
-		    mailbox_interrupt);
-	request_irq(OCTEON_IRQ_MBOX1, mailbox_interrupt, IRQF_SHARED, "mailbox1",
-		    mailbox_interrupt);
+	if (request_irq(OCTEON_IRQ_MBOX0, mailbox_interrupt, IRQF_SHARED, "mailbox0",
+		    mailbox_interrupt)) {
+	}
+	if (request_irq(OCTEON_IRQ_MBOX1, mailbox_interrupt, IRQF_SHARED, "mailbox1",
+		    mailbox_interrupt)) {
+	}
 }
 
 
-- 
1.5.5.1

