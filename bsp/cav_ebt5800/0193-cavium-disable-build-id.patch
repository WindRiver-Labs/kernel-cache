From a2385da34c2cea21370ab7d51c2e2427bf640bf4 Mon Sep 17 00:00:00 2001
From: auto commit <unknown@unknown>
Date: Fri, 24 Oct 2008 12:23:20 -0700
Subject: [PATCH] cavium: disable build-id

Cavium u-boot does not know how to deal with non-empty NOTES program
header. Provide the ability to disable the 'build-id' feature, which
places data in the .notes section.

Signed-off-by: Phil Staub <phil.staub@windriver.com>
---
 Makefile                        |    2 ++
 arch/mips/cavium-octeon/Kconfig |   12 ++++++++++++
 2 files changed, 14 insertions(+), 0 deletions(-)

diff --git a/Makefile b/Makefile
index 3d5929f..6d157d5 100644
--- a/Makefile
+++ b/Makefile
@@ -588,8 +588,10 @@ ifneq ($(KCFLAGS),)
 endif
 
 # Use --build-id when available.
+ifndef CONFIG_BUILD_ID_DISABLE
 LDFLAGS_BUILD_ID = $(patsubst -Wl$(comma)%,%,\
 			      $(call ld-option, -Wl$(comma)--build-id,))
+endif
 LDFLAGS_MODULE += $(LDFLAGS_BUILD_ID)
 LDFLAGS_vmlinux += $(LDFLAGS_BUILD_ID)
 
diff --git a/arch/mips/cavium-octeon/Kconfig b/arch/mips/cavium-octeon/Kconfig
index 0798588..169fb62 100644
--- a/arch/mips/cavium-octeon/Kconfig
+++ b/arch/mips/cavium-octeon/Kconfig
@@ -307,3 +307,15 @@ config CAVIUM_OCTEON_SYNC
 	default "n"
 	help
 	   This enables Cavium multi-core clock synchronisation using perf counters.
+
+config BUILD_ID_DISABLE
+	bool "Disable the build-id feature of the linker"
+	default "y"
+	help
+	   Currently, the u-boot bootloader does not know how to
+	   handle the presence of a non-empty NOTES program header
+	   in the kernel load file. This occurs when the linker 
+	   option '--build-id' is specified. Setting this option
+	   to 'y' prevents use of the build-id feature and allows
+	   u-boot to load the kernel.
+
-- 
1.6.0.4

