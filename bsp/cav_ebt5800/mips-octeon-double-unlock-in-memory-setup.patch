From d1108d8eb961bc6bc99bedd2fb7a2e28da928729 Mon Sep 17 00:00:00 2001
From: Greg Moffatt <greg.moffatt@windriver.com>
Date: Mon, 10 Aug 2009 11:28:08 -0400
Subject: [PATCH 1/2] mips/octeon: double unlock in memory setup

For cavium the bootmem semaphore is unlocked twice during boot.
This fix changes it so that the semaphore is only unlocked once
in all scenarios.

Signed-off-by: Greg Moffatt <greg.moffatt@windriver.com>
---
 arch/mips/cavium-octeon/setup.c |    2 +-
 1 files changed, 1 insertions(+), 1 deletions(-)

diff --git a/arch/mips/cavium-octeon/setup.c b/arch/mips/cavium-octeon/setup.c
index c34fa1a..4a79979 100644
--- a/arch/mips/cavium-octeon/setup.c
+++ b/arch/mips/cavium-octeon/setup.c
@@ -478,8 +478,8 @@ void __init plat_mem_setup(void)
 		} else
 			break;
 		}
+		cvmx_bootmem_unlock();
 	}
-	cvmx_bootmem_unlock();
 
 #if CONFIG_CAVIUM_RESERVE32
 	/* Now that we've allocated the kernel memory it is safe to free the
-- 
1.6.3.3

