From e0404a2c9abcb7483682c8b89da40a857711baa7 Mon Sep 17 00:00:00 2001
From: auto commit <unknown@unknown>
Date: Fri, 24 Oct 2008 12:22:45 -0700
Subject: [PATCH] cavium: Treat hardware writes differently for cache

Enable cache mode 7 for Cavium -- this allows the hardware writes
to be treated independently from user writes.

Signed-off-by: Tomaso Paoletti <tpaoletti@caviumnetworks.com>
Signed-off-by: Paul Gortmaker <Paul.Gortmaker@windriver.com>
---
 arch/mips/mm/c-r4k.c |    7 +++++--
 1 files changed, 5 insertions(+), 2 deletions(-)

diff --git a/arch/mips/mm/c-r4k.c b/arch/mips/mm/c-r4k.c
index b8317c6..1b4e6e0 100644
--- a/arch/mips/mm/c-r4k.c
+++ b/arch/mips/mm/c-r4k.c
@@ -1269,8 +1269,11 @@ __setup("cca=", cca_setup);
 
 static void __cpuinit coherency_setup(void)
 {
-	if (cca < 0 || cca > 7)
-		cca = read_c0_config() & CONF_CM_CMASK;
+	cca = read_c0_config() & CONF_CM_CMASK;
+#ifdef CONFIG_CPU_CAVIUM_OCTEON
+	if (cca != 7)
+		panic("PAGE CACHABLE DEFAULT is not 7\n");
+#endif /* CONFIG_CPU_CAVIUM_OCTEON */
 	_page_cachable_default = cca << _CACHE_SHIFT;
 
 	pr_debug("Using cache attribute %d\n", cca);
-- 
1.5.5.1

