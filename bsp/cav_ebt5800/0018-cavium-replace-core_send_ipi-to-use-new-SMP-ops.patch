From 49a7d4c5a7aa2854595dfb96c3178e4162cda849 Mon Sep 17 00:00:00 2001
From: auto commit <unknown@unknown>
Date: Fri, 24 Oct 2008 12:22:36 -0700
Subject: [PATCH] cavium: replace core_send_ipi to use new SMP ops

Replace the uses of core_send_ipi to go after the proper
function within the SMP ops struct.

Signed-off-by: Tomaso Paoletti <tpaoletti@caviumnetworks.com>
Signed-off-by: Paul Gortmaker <Paul.Gortmaker@windriver.com>
---
 arch/mips/mm/c-octeon.c |    6 ++++--
 1 files changed, 4 insertions(+), 2 deletions(-)

diff --git a/arch/mips/mm/c-octeon.c b/arch/mips/mm/c-octeon.c
index d373ea6..5da2586 100644
--- a/arch/mips/mm/c-octeon.c
+++ b/arch/mips/mm/c-octeon.c
@@ -27,6 +27,8 @@
 
 unsigned long long cache_err_dcache[NR_CPUS];
 
+extern struct plat_smp_ops *mp_ops;	/* private */
+
 /**
  * Octeon automatically flushes the dcache on tlb changes, so
  * from Linux's viewpoint it acts much like a physically
@@ -65,7 +67,7 @@ static void octeon_flush_icache_all_cores(struct vm_area_struct *vma)
 #ifdef CONFIG_SMP
         for (i = 0; i < NR_CPUS; i++)
             if (cpu_isset(i, vma->vm_mm->cpu_vm_mask) && i != cpu)
-                core_send_ipi(i, SMP_ICACHE_FLUSH);
+                mp_ops->send_ipi_single(i, SMP_ICACHE_FLUSH);
 #endif
         asm volatile ("synci 0($0)\n");
     }
@@ -76,7 +78,7 @@ static void octeon_flush_icache_all_cores(struct vm_area_struct *vma)
 #ifdef CONFIG_SMP
         for (i = 0; i < NR_CPUS; i++)
             if (cpu_online(i) && i != cpu)
-                core_send_ipi(i, SMP_ICACHE_FLUSH);
+                mp_ops->send_ipi_single(i, SMP_ICACHE_FLUSH);
 #endif
         asm volatile ("synci 0($0)\n");
     }
-- 
1.5.5.1

