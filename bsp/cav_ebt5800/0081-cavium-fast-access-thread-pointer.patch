From 7c9ae58dabd6d063b70b9ad8bbacda1c0cdf627f Mon Sep 17 00:00:00 2001
From: auto commit <unknown@unknown>
Date: Fri, 24 Oct 2008 12:22:59 -0700
Subject: [PATCH] cavium: fast access thread pointer

If CONFIG_FAST_ACCESS_TO_THREAD_POINTER is enabled, then deploy the
FAST_ACCESS_THREAD_OFFSET and the FAST_ACCESS_THREAD_REGISTER to
bounce through the reserved hardware cache area for speed.

Signed-off-by: Tomaso Paoletti <tpaoletti@caviumnetworks.com>
Signed-off-by: Paul Gortmaker <Paul.Gortmaker@windriver.com>
---
 include/asm-mips/mipsregs.h |   10 ++++++++++
 1 files changed, 10 insertions(+), 0 deletions(-)

diff --git a/include/asm-mips/mipsregs.h b/include/asm-mips/mipsregs.h
index 04dae1f..c89de00 100644
--- a/include/asm-mips/mipsregs.h
+++ b/include/asm-mips/mipsregs.h
@@ -553,6 +553,16 @@
 #define MIPS_FPIR_L		(_ULCAST_(1) << 21)
 #define MIPS_FPIR_F64		(_ULCAST_(1) << 22)
 
+/*
+ * These defines are used on Octeon to implement fast access to the thread pointer
+ * from userspace. Octeon uses a 64bit location in CVMSEG to store the thread pointer
+ * for quick access.
+ */
+#ifdef CONFIG_FAST_ACCESS_TO_THREAD_POINTER
+#define FAST_ACCESS_THREAD_OFFSET       CONFIG_CAVIUM_OCTEON_CVMSEG_SIZE*128-8-32768
+#define FAST_ACCESS_THREAD_REGISTER     *(unsigned long *)(FAST_ACCESS_THREAD_OFFSET)
+#endif
+
 #ifndef __ASSEMBLY__
 
 /*
-- 
1.5.5.1

