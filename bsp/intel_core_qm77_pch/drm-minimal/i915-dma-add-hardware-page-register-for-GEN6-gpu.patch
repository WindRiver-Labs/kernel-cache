From 7c720090733c67802d02a7aa7191afbf9ce7ef43 Mon Sep 17 00:00:00 2001
From: Hui Wang <Hui.Wang@windriver.com>
Date: Fri, 28 Jan 2011 16:34:36 +0800
Subject: [PATCH 10/25] i915/dma: add hardware page register for GEN6 gpu

Refer to upstream: 8187a2b7

Signed-off-by: Zou Nan hai <nanhai.zou@intel.com>
Signed-off-by: Xiang Hai hao <haihao.xiang@intel.com>
[anholt: Fixed up whitespace fail and rebased against prep patches]
Signed-off-by: Eric Anholt <eric@anholt.net>

[GEN6 gpu has different hardware page status register, when we want
to monitor ringbuffer's status, we should use GEN6's specific page
status register.
Only pick change page status register relating codes from this commit]

Signed-off-by: Hui Wang <Hui.Wang@windriver.com>
---
 drivers/gpu/drm/i915/i915_dma.c |   17 +++++++++++++----
 1 files changed, 13 insertions(+), 4 deletions(-)

diff --git a/drivers/gpu/drm/i915/i915_dma.c b/drivers/gpu/drm/i915/i915_dma.c
index ea24c48..d3ec6bf 100644
--- a/drivers/gpu/drm/i915/i915_dma.c
+++ b/drivers/gpu/drm/i915/i915_dma.c
@@ -296,10 +296,19 @@ static int i915_dma_resume(struct drm_device * dev)
 	DRM_DEBUG_DRIVER("hw status page @ %p\n",
 				dev_priv->hw_status_page);
 
-	if (dev_priv->status_gfx_addr != 0)
-		I915_WRITE(HWS_PGA, dev_priv->status_gfx_addr);
-	else
-		I915_WRITE(HWS_PGA, dev_priv->dma_status_page);
+	if (dev_priv->status_gfx_addr != 0) {
+		if (IS_GEN6(dev)) {
+			I915_WRITE(HWS_PGA_GEN6, dev_priv->status_gfx_addr);
+			I915_READ(HWS_PGA_GEN6); /* posting read */
+		} else
+			I915_WRITE(HWS_PGA, dev_priv->status_gfx_addr);
+	} else {
+		if (IS_GEN6(dev)) {
+			I915_WRITE(HWS_PGA_GEN6, dev_priv->dma_status_page);
+			I915_READ(HWS_PGA_GEN6); /* posting read */
+		} else
+			I915_WRITE(HWS_PGA, dev_priv->dma_status_page);
+	}
 	DRM_DEBUG_DRIVER("Enabled hardware status page\n");
 
 	return 0;
-- 
1.6.5.2

