From e2b7411a5fa20162372c8db6f57e8f2387730704 Mon Sep 17 00:00:00 2001
From: "Yadav, PramodX K" <pramodx.k.yadav@intel.com>
Date: Tue, 28 Jun 2016 17:46:00 +0530
Subject: [PATCH 2056/2508] ASoC: Intel: Skylake: Fix BXT/CNL dsp cleanup
 function

commit 0379c15f7988745b0a08f0962a266ffaf1267c49 from
https://github.com/01org/linux-apollolake-i

1. code loader DMA is not applicable for BXT/CNL.
   So remove code loader DMA related code.
2. iounmap is done later in the code flow.
   So remove iounmap from this function.

Change-Id: Ifd7945efef18627d9cac7fcb997a94e063887aa8
Signed-off-by: Yadav, PramodX K <pramodx.k.yadav@intel.com>
Reviewed-on: https://git-gar-1.devtools.intel.com/gerrit/9866
Reviewed-by: Babu, Ramesh <ramesh.babu@intel.com>
Tested-by: Jayanti, Satya Charitardha <satya.charitardha.jayanti@intel.com>
---
 sound/soc/intel/skylake/bxt-sst.c |    4 ----
 sound/soc/intel/skylake/cnl-sst.c |    4 ----
 2 files changed, 0 insertions(+), 8 deletions(-)

diff --git a/sound/soc/intel/skylake/bxt-sst.c b/sound/soc/intel/skylake/bxt-sst.c
index b8d55c9..64090c8 100644
--- a/sound/soc/intel/skylake/bxt-sst.c
+++ b/sound/soc/intel/skylake/bxt-sst.c
@@ -677,10 +677,6 @@ load_library_failed:
 void bxt_sst_dsp_cleanup(struct device *dev, struct skl_sst *ctx)
 {
 	skl_ipc_free(&ctx->ipc);
-	ctx->dsp->cl_dev.ops.cl_cleanup_controller(ctx->dsp);
-	if (ctx->dsp->addr.lpe)
-		iounmap(ctx->dsp->addr.lpe);
-
 	ctx->dsp->ops->free(ctx->dsp);
 }
 EXPORT_SYMBOL_GPL(bxt_sst_dsp_cleanup);
diff --git a/sound/soc/intel/skylake/cnl-sst.c b/sound/soc/intel/skylake/cnl-sst.c
index 50aeabe..c1dedde 100644
--- a/sound/soc/intel/skylake/cnl-sst.c
+++ b/sound/soc/intel/skylake/cnl-sst.c
@@ -789,10 +789,6 @@ EXPORT_SYMBOL_GPL(cnl_sst_dsp_init_fw);
 void cnl_sst_dsp_cleanup(struct device *dev, struct skl_sst *ctx)
 {
 	cnl_ipc_free(&ctx->ipc);
-	ctx->dsp->cl_dev.ops.cl_cleanup_controller(ctx->dsp);
-	if (ctx->dsp->addr.lpe)
-		iounmap(ctx->dsp->addr.lpe);
-
 	ctx->dsp->ops->free(ctx->dsp);
 }
 EXPORT_SYMBOL_GPL(cnl_sst_dsp_cleanup);
-- 
1.7.5.4

