From 3eef841495959c23d21e929008967764dbff99ee Mon Sep 17 00:00:00 2001
From: Matt Roper <matthew.d.roper@intel.com>
Date: Thu, 19 May 2016 14:35:26 -0700
Subject: [PATCH 1443/2508] drm/i915: Avoid integer overflow in data rate
 calculation

commit 4134dea17a864e65bd2b5c06ce6137c80d05909f from
https://github.com/01org/linux-apollolake-i

We need to upcast our plane data rate calculations to 64-bit since we're
working with numbers in 16.16 form.  Before we shift the bits off, we
could potentially have 48-bit values.

HSD: 1604167939
Signed-off-by: Matt Roper <matthew.d.roper@intel.com>
---
 drivers/gpu/drm/i915/intel_pm.c |    2 +-
 1 files changed, 1 insertions(+), 1 deletions(-)

diff --git a/drivers/gpu/drm/i915/intel_pm.c b/drivers/gpu/drm/i915/intel_pm.c
index a823b08..d944cb5 100644
--- a/drivers/gpu/drm/i915/intel_pm.c
+++ b/drivers/gpu/drm/i915/intel_pm.c
@@ -3025,7 +3025,7 @@ skl_plane_relative_data_rate(const struct intel_crtc_state *cstate,
 
 	down_scale_amount = skl_plane_downscale_amount(intel_pstate);
 
-	return data_rate * down_scale_amount >> 16;
+	return (uint64_t)data_rate * down_scale_amount >> 16;
 }
 
 /*
-- 
1.7.5.4

