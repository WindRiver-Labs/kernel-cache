From 3d9c136edd3036393468a22877f6a42a0fe0c00d Mon Sep 17 00:00:00 2001
From: Bob Paauwe <bob.j.paauwe@intel.com>
Date: Wed, 20 Apr 2016 13:38:21 -0700
Subject: [PATCH 1436/2508] drm/i915: Get audio power domain during initial hw
 readout (v2)
MIME-Version: 1.0
Content-Type: text/plain; charset=UTF-8
Content-Transfer-Encoding: 8bit

commit c6c162989cdc10514d7d229a26acc32418e8fca4 from
https://github.com/01org/linux-apollolake-i

if the crtc has audio is enabled. Otherwise, when the first atomic
modeset happens it will warn when trying to drop the audio power
domain.

v2: move this to get_crtc_power_domains to be consistent with other
    power domain setup (Ville)

Signed-off-by: Bob Paauwe <bob.j.paauwe@intel.com>
Cc: Ville Syrjälä <ville.syrjala@linux.intel.com>
Reviewed-by: James Xiong <james.xiong@intel.com>
Tested-by: James Xiong <james.xiong@intel.com>
Signed-off-by: Matt Roper <matthew.d.roper@intel.com>
---
 drivers/gpu/drm/i915/intel_display.c |    3 +++
 1 files changed, 3 insertions(+), 0 deletions(-)

diff --git a/drivers/gpu/drm/i915/intel_display.c b/drivers/gpu/drm/i915/intel_display.c
index 6aa2828..f48f468 100644
--- a/drivers/gpu/drm/i915/intel_display.c
+++ b/drivers/gpu/drm/i915/intel_display.c
@@ -5266,6 +5266,9 @@ static unsigned long get_crtc_power_domains(struct drm_crtc *crtc,
 	if (crtc_state->shared_dpll)
 		mask |= BIT(POWER_DOMAIN_PLLS);
 
+	if (crtc_state->has_audio)
+		mask |= BIT(POWER_DOMAIN_AUDIO);
+
 	return mask;
 }
 
-- 
1.7.5.4

