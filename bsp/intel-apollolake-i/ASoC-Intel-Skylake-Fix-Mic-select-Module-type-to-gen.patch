From f684939d42518374834b330e811d8af8b7472d0c Mon Sep 17 00:00:00 2001
From: Jeeja KP <jeeja.kp@intel.com>
Date: Wed, 9 Sep 2015 18:55:59 +0530
Subject: [PATCH 1714/2508] ASoC: Intel: Skylake: Fix Mic select Module type
 to generic

commit 6f3419ba84d08f4ae3a8e1e95becd5ccb45f9bab from
https://github.com/01org/linux-apollolake-i

Mic Select module takes base format and output format as
module configuration. There are other modules also which
takes base and out format. This patch changes the MIC_SELECT
type to a generic type

Signed-off-by: Jeeja KP <jeeja.kp@intel.com>
---
 sound/soc/intel/skylake/skl-messages.c       |   26 ++++++++++++++------------
 sound/soc/intel/skylake/skl-topology.h       |    2 +-
 sound/soc/intel/skylake/skl-tplg-interface.h |    2 +-
 3 files changed, 16 insertions(+), 14 deletions(-)

diff --git a/sound/soc/intel/skylake/skl-messages.c b/sound/soc/intel/skylake/skl-messages.c
index 5db3f63..c9248f6 100644
--- a/sound/soc/intel/skylake/skl-messages.c
+++ b/sound/soc/intel/skylake/skl-messages.c
@@ -427,15 +427,16 @@ static void skl_set_algo_format(struct skl_sst *ctx,
 }
 
 /*
- * Mic select module allows input to output channel map. mic select
- * module take base module configuration and out format configuration
+ * Some modules require base and out format configuration like mic
+ * select module. These module take base module configuration and
+ * out format configuration
  */
-static void skl_set_mic_select_format(struct skl_sst *ctx,
+static void skl_set_base_outfmt_format(struct skl_sst *ctx,
 			struct skl_module_cfg *mconfig,
-			struct skl_mic_select_cfg *mic_sel_mcfg)
+			struct skl_base_outfmt_cfg *base_outfmt_mcfg)
 {
-	struct skl_audio_data_format *out_fmt = &mic_sel_mcfg->out_fmt;
-	struct skl_base_cfg *base_cfg = (struct skl_base_cfg *)mic_sel_mcfg;
+	struct skl_audio_data_format *out_fmt = &base_outfmt_mcfg->out_fmt;
+	struct skl_base_cfg *base_cfg = (struct skl_base_cfg *)base_outfmt_mcfg;
 
 	skl_set_base_module_format(ctx, mconfig, base_cfg);
 
@@ -464,8 +465,8 @@ static u16 skl_get_module_param_size(struct skl_sst *ctx,
 		param_size += mconfig->formats_config.caps_size;
 		return param_size;
 
-	case SKL_MODULE_TYPE_MIC_SELECT:
-		return sizeof(struct skl_mic_select_cfg);
+	case SKL_MODULE_TYPE_BASE_OUTFMT:
+		return sizeof(struct skl_base_outfmt_cfg);
 
 	default:
 		/*
@@ -515,9 +516,10 @@ static int skl_set_module_format(struct skl_sst *ctx,
 
 	case SKL_MODULE_TYPE_ALGO:
 		skl_set_algo_format(ctx, module_config, *param_data);
+		break;
 
-	case SKL_MODULE_TYPE_MIC_SELECT:
-		skl_set_mic_select_format(ctx, module_config, *param_data);
+	case SKL_MODULE_TYPE_BASE_OUTFMT:
+		skl_set_base_outfmt_format(ctx, module_config, *param_data);
 		break;
 
 	default:
@@ -526,8 +528,8 @@ static int skl_set_module_format(struct skl_sst *ctx,
 
 	}
 
-	dev_dbg(ctx->dev, "Module type=%d config size: %d bytes\n",
-			module_config->id.module_id, param_size);
+	dev_dbg(ctx->dev, "Module id = %d, type=%d config size: %d bytes\n",
+			module_config->id.module_id, module_config->m_type, param_size);
 	return 0;
 }
 
diff --git a/sound/soc/intel/skylake/skl-topology.h b/sound/soc/intel/skylake/skl-topology.h
index 23dbbdd..87b7acd 100644
--- a/sound/soc/intel/skylake/skl-topology.h
+++ b/sound/soc/intel/skylake/skl-topology.h
@@ -145,7 +145,7 @@ struct skl_algo_cfg {
 	char params[0];
 } __packed;
 
-struct skl_mic_select_cfg {
+struct skl_base_outfmt_cfg {
 	struct skl_base_cfg base_cfg;
 	struct skl_audio_data_format out_fmt;
 } __packed;
diff --git a/sound/soc/intel/skylake/skl-tplg-interface.h b/sound/soc/intel/skylake/skl-tplg-interface.h
index 964567b..87c049f 100644
--- a/sound/soc/intel/skylake/skl-tplg-interface.h
+++ b/sound/soc/intel/skylake/skl-tplg-interface.h
@@ -79,7 +79,7 @@ enum skl_module_type {
 	SKL_MODULE_TYPE_UPDWMIX,
 	SKL_MODULE_TYPE_SRCINT,
 	SKL_MODULE_TYPE_ALGO,
-	SKL_MODULE_TYPE_MIC_SELECT
+	SKL_MODULE_TYPE_BASE_OUTFMT
 };
 
 enum skl_core_affinity {
-- 
1.7.5.4

