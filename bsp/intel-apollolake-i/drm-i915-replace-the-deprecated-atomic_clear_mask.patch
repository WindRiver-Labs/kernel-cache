From 695d4fb746b82dba6f8ecfd7dc906343506f3b57 Mon Sep 17 00:00:00 2001
From: Kevin Hao <kexin.hao@windriver.com>
Date: Wed, 19 Apr 2017 18:30:06 +0800
Subject: [PATCH 3/7] drm/i915: replace the deprecated atomic_clear_mask()

Fix the following warning:
drivers/gpu/drm/i915/i915_gem.c: In function 'i915_gem_track_fb':
drivers/gpu/drm/i915/i915_gem.c:5129:3: warning: 'atomic_clear_mask' is deprecated [-Wdeprecated-declarations]
   atomic_clear_mask(frontbuffer_bits, &old->frontbuffer_bits);

Signed-off-by: Kevin Hao <kexin.hao@windriver>
---
 drivers/gpu/drm/i915/i915_gem.c |    2 +-
 1 files changed, 1 insertions(+), 1 deletions(-)

diff --git a/drivers/gpu/drm/i915/i915_gem.c b/drivers/gpu/drm/i915/i915_gem.c
index 9428d46..6e52f31 100644
--- a/drivers/gpu/drm/i915/i915_gem.c
+++ b/drivers/gpu/drm/i915/i915_gem.c
@@ -5126,7 +5126,7 @@ void i915_gem_track_fb(struct drm_i915_gem_object *old,
 
 	if (old) {
 		WARN_ON(!(atomic_read(&old->frontbuffer_bits) & frontbuffer_bits));
-		atomic_clear_mask(frontbuffer_bits, &old->frontbuffer_bits);
+		atomic_and(~frontbuffer_bits, &old->frontbuffer_bits);
 	}
 
 	if (new) {
-- 
1.7.5.4

