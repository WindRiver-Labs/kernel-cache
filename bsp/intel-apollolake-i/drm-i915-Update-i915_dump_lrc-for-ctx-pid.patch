From 4d9202491d63fdba5ab99a7ac13fa531f578fa29 Mon Sep 17 00:00:00 2001
From: Sagar Arun Kamble <sagar.a.kamble@intel.com>
Date: Tue, 24 Jan 2017 08:41:54 -0800
Subject: [PATCH 4489/4706] drm/i915: Update i915_dump_lrc for ctx pid

commit ba057c0b809b1dba570f9dc66c8a38b149fac506 from
git://git.yoctoproject.org/linux-yocto-4.1

This patch resolves kernel panic due to invalid access to file_priv/file
of ctx. file_priv/file may not be available for all contexts and pid is
already cached in ctx.

Signed-off-by: Sagar Arun Kamble <sagar.a.kamble@intel.com>
Signed-off-by: Jeff McGee <jeff.mcgee@intel.com>
Signed-off-by: Matt Roper <matthew.d.roper@intel.com>
---
 drivers/gpu/drm/i915/i915_debugfs.c |    2 +-
 1 files changed, 1 insertions(+), 1 deletions(-)

diff --git a/drivers/gpu/drm/i915/i915_debugfs.c b/drivers/gpu/drm/i915/i915_debugfs.c
index 687acaa..78783b7 100644
--- a/drivers/gpu/drm/i915/i915_debugfs.c
+++ b/drivers/gpu/drm/i915/i915_debugfs.c
@@ -2213,7 +2213,7 @@ static int i915_dump_lrc(struct seq_file *m, void *unused)
 			if (ctx->file_priv) {
 				seq_printf(m, "CONTEXT: %s (PID: %u, UH:%d)\n",
 					   engine->name,
-					   pid_nr(ctx->file_priv->file->pid),
+					   pid_nr(ctx->pid),
 					   ctx->user_handle);
 				i915_dump_lrc_obj(m, ctx, engine, dump_flag);
 			}
-- 
1.7.5.4

