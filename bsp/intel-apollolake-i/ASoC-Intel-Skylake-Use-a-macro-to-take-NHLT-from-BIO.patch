From ebeb4f213db6041cffaa9b17cdfd13e4e966c9dc Mon Sep 17 00:00:00 2001
From: "Kranthikumar, GudishaX" <gudishax.kranthikumar@intel.com>
Date: Mon, 18 Jul 2016 01:58:30 +0530
Subject: [PATCH 2125/2508] ASoC: Intel: Skylake: Use a macro to take NHLT
 from BIOS

commit 2c1eb33e0ac03ca2f0318cac22ac8f63f7b525b1 from
https://github.com/01org/linux-apollolake-i

Use a macro to enable or disable obtaining NHLT from
BIOS. Enable it if the bios supports it. Other wise
disable it and use alternative methods like debugfs if
available.

Change-Id: I6600fb0adce982952f25fccd339f2dd98faf72d6
Signed-off-by: Kranthikumar, GudishaX <gudishax.kranthikumar@intel.com>
Reviewed-on: https://git-gar-1.devtools.intel.com/gerrit/10337
Reviewed-by: Jayanti, Satya Charitardha <satya.charitardha.jayanti@intel.com>
Tested-by: Jayanti, Satya Charitardha <satya.charitardha.jayanti@intel.com>
---
 sound/soc/intel/skylake/skl.c |   11 ++++++++++-
 1 files changed, 10 insertions(+), 1 deletions(-)

diff --git a/sound/soc/intel/skylake/skl.c b/sound/soc/intel/skylake/skl.c
index 0f68eec..5181132 100644
--- a/sound/soc/intel/skylake/skl.c
+++ b/sound/soc/intel/skylake/skl.c
@@ -35,6 +35,11 @@
 #include "skl-sst-dsp.h"
 #include "skl-sst-ipc.h"
 
+/* Use the following macro to enable or disable obtaining NHLT from
+ * BIOS. Enable it if the bios supports it. Other wise disable it
+ * and use alternative methods like debugfs if available
+ */
+#define SKL_USE_NHLT_FROM_BIOS 0
 static char *machine = NULL;
 
 module_param(machine, charp, 0444);
@@ -767,7 +772,7 @@ static int skl_probe(struct pci_dev *pci,
 		goto out_free;
 
 	device_disable_async_suspend(bus->dev);
-#if 0
+#if SKL_USE_NHLT_FROM_BIOS
 	/* NO NHLT On FPGA */
 	skl->nhlt = skl_nhlt_init(bus->dev);
 
@@ -826,7 +831,9 @@ out_dmic_free:
 out_mach_free:
 	skl_machine_device_unregister(skl);
 out_nhlt_free:
+#if SKL_USE_NHLT_FROM_BIOS
 	skl_nhlt_free(skl->nhlt);
+#endif
 out_dsp_free:
 	skl_free_dsp(skl);
 out_free:
@@ -884,7 +891,9 @@ static void skl_remove(struct pci_dev *pci)
 	skl_free_dsp(skl);
 	skl_machine_device_unregister(skl);
 	skl_dmic_device_unregister(skl);
+#if SKL_USE_NHLT_FROM_BIOS
 	skl_nhlt_free(skl->nhlt);
+#endif
 	skl_free(ebus);
 	dev_set_drvdata(&pci->dev, NULL);
 }
-- 
1.7.5.4

