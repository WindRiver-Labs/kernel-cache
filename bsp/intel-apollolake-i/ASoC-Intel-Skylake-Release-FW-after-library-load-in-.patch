From 7b935f8feb321ac13104f3d255b59ccc44f6be56 Mon Sep 17 00:00:00 2001
From: "Kranthikumar, G" <gudishax.kranthikumar@intel.com>
Date: Wed, 3 Aug 2016 01:46:54 +0530
Subject: [PATCH 4693/4706] ASoC: Intel: Skylake: Release FW after library
 load in cnl

commit c732637a76a1f1361988023e949a6004192a108f from
git://git.yoctoproject.org/linux-yocto-4.1

This patch fixes the following KW issues:

1.Possible memory leak. Dynamic memory stored in 'fw'
  allocated through function 'request_firmware' can be
  lost.
2.Possible memory leak. Dynamic memory stored in 'ret'
  allocated through function 'request_firmware' can be
  lost.

Change-Id: Ifcbe4f62546e9c93643d8ebd8f1d581b5f2396b1
Signed-off-by: Kranthikumar, G <gudishax.kranthikumar@intel.com>
Reviewed-on: https://git-gar-1.devtools.intel.com/gerrit/10728
Reviewed-by: Jayanti, Satya Charitardha <satya.charitardha.jayanti@intel.com>
Tested-by: Jayanti, Satya Charitardha <satya.charitardha.jayanti@intel.com>
---
 sound/soc/intel/skylake/cnl-sst.c |    1 +
 1 files changed, 1 insertions(+), 0 deletions(-)

diff --git a/sound/soc/intel/skylake/cnl-sst.c b/sound/soc/intel/skylake/cnl-sst.c
index 1b2d4dd..54f9844 100644
--- a/sound/soc/intel/skylake/cnl-sst.c
+++ b/sound/soc/intel/skylake/cnl-sst.c
@@ -557,6 +557,7 @@ static int cnl_load_library(struct sst_dsp *ctx)
 
 		ctx->dsp_ops.trigger(ctx->dev, false, stream_tag);
 		ctx->dsp_ops.cleanup(ctx->dev, &dmab, stream_tag);
+		release_firmware(fw);
 	}
 
 	return 0;
-- 
1.7.5.4

