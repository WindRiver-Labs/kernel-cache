From 6bebe9dad7f76ab57891591595c80aaf3b140595 Mon Sep 17 00:00:00 2001
From: "Dharageswari.R" <dharageswari.r@intel.com>
Date: Mon, 7 Sep 2015 11:46:48 +0530
Subject: [PATCH 1713/2508] ASoC: Intel: Skylake: Fix for handling DSP safe
 mode

commit c7217207619c7b09d4bf2047207be2810d4bb14a from
https://github.com/01org/linux-apollolake-i

With HD AUDIO SAFE MODE disable, After phrase detection, capture
data is silence. This patch adds 1 ms delay after phrase detection
which fixed the issue.

Signed-off-by: Dharageswari.R <dharageswari.r@intel.com>
Signed-off-by: Jeeja KP <jeeja.kp@intel.com>
---
 sound/soc/intel/skylake/skl-sst-ipc.c |    6 ++++++
 1 files changed, 6 insertions(+), 0 deletions(-)

diff --git a/sound/soc/intel/skylake/skl-sst-ipc.c b/sound/soc/intel/skylake/skl-sst-ipc.c
index 24f6336..d2a8d67 100644
--- a/sound/soc/intel/skylake/skl-sst-ipc.c
+++ b/sound/soc/intel/skylake/skl-sst-ipc.c
@@ -13,6 +13,7 @@
  * General Public License for more details.
  */
 #include <linux/device.h>
+#include <linux/delay.h>
 
 #include "../common/sst-dsp.h"
 #include "../common/sst-dsp-priv.h"
@@ -322,6 +323,11 @@ static int skl_ipc_process_notification(struct sst_generic_ipc *ipc,
 			wake_up(&skl->boot_wait);
 			break;
 
+		case IPC_GLB_NOTIFY_PHRASE_DETECTED:
+			dev_err(ipc->dev, "*****Pharse Detected **********\n");
+			mdelay(1);
+			break;
+
 		default:
 			dev_err(ipc->dev, "ipc: Unhandled error msg=%x",
 						header.primary);
-- 
1.7.5.4

