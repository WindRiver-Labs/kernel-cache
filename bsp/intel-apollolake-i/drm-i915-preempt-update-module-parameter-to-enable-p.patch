From a3957c144732823203f393e32815a39ac06dee3b Mon Sep 17 00:00:00 2001
From: Dave Gordon <david.s.gordon@intel.com>
Date: Fri, 8 Apr 2016 13:53:27 -0700
Subject: [PATCH 1373/2508] drm/i915/preempt: update module parameter to
 enable preemption

commit 3dad97d3234f06cc0aeb1715f4d28a96a18a778c from
https://github.com/01org/linux-apollolake-i

For: VIZ-2021
Signed-off-by: Dave Gordon <david.s.gordon@intel.com>
Signed-off-by: Jeff McGee <jeff.mcgee@intel.com>
Signed-off-by: Matt Roper <matthew.d.roper@intel.com>
---
 drivers/gpu/drm/i915/i915_params.c    |    4 ++--
 drivers/gpu/drm/i915/i915_scheduler.c |    2 +-
 2 files changed, 3 insertions(+), 3 deletions(-)

diff --git a/drivers/gpu/drm/i915/i915_params.c b/drivers/gpu/drm/i915/i915_params.c
index 2488b1d..17dc7d5 100644
--- a/drivers/gpu/drm/i915/i915_params.c
+++ b/drivers/gpu/drm/i915/i915_params.c
@@ -62,7 +62,7 @@ struct i915_params i915 __read_mostly = {
 	.hpd_sense_invert = -1,
 	.enable_ipc = 0,
 	.enable_scheduler = 1,
-	.enable_preemption = 0,
+	.enable_preemption = 1,
 };
 
 module_param_named(modeset, i915.modeset, int, 0400);
@@ -233,4 +233,4 @@ module_param_named_unsafe(enable_scheduler, i915.enable_scheduler, int, 0600);
 MODULE_PARM_DESC(enable_scheduler, "Enable scheduler (0 = disable, 1 = enable [default])");
 
 module_param_named_unsafe(enable_preemption, i915.enable_preemption, int, 0600);
-MODULE_PARM_DESC(enable_preemption, "Enable pre-emption within scheduler  (0 = disable [default], 1 = enable)");
+MODULE_PARM_DESC(enable_preemption, "Enable pre-emption within scheduler  (0 = disable, 1 = enable [default])");
diff --git a/drivers/gpu/drm/i915/i915_scheduler.c b/drivers/gpu/drm/i915/i915_scheduler.c
index 21ce76b..251e007 100644
--- a/drivers/gpu/drm/i915/i915_scheduler.c
+++ b/drivers/gpu/drm/i915/i915_scheduler.c
@@ -205,7 +205,7 @@ int i915_scheduler_init(struct drm_device *dev)
 	scheduler->priority_level_max     = 1023;
 	scheduler->priority_level_bump    = 50;
 	scheduler->priority_level_preempt = 900;
-	scheduler->min_flying             = 2;
+	scheduler->min_flying             = 8;
 	scheduler->file_queue_max         = 64;
 	scheduler->dump_flags             = I915_SF_DUMP_FORCE   |
 					    I915_SF_DUMP_DETAILS |
-- 
1.7.5.4

