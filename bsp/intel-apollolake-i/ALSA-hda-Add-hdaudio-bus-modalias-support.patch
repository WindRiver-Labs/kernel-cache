From f10663eddf32e55fb96a25cfcca1e7f609c2de13 Mon Sep 17 00:00:00 2001
From: "Subhransu S. Prusty" <subhransu.s.prusty@intel.com>
Date: Tue, 29 Sep 2015 13:56:47 +0530
Subject: [PATCH 1670/2508] ALSA: hda: Add hdaudio bus modalias support

commit 2a13d7b24b3bd46fa1f97bd6996b2681274917cb from
https://github.com/01org/linux-apollolake-i

Signed-off-by: Subhransu S. Prusty <subhransu.s.prusty@intel.com>
---
 sound/hda/hdac_sysfs.c |   15 +++++++++++++++
 1 files changed, 15 insertions(+), 0 deletions(-)

diff --git a/sound/hda/hdac_sysfs.c b/sound/hda/hdac_sysfs.c
index 089b35f..3fe84f6 100644
--- a/sound/hda/hdac_sysfs.c
+++ b/sound/hda/hdac_sysfs.c
@@ -36,6 +36,20 @@ static ssize_t type##_show(struct device *dev,			\
 } \
 static DEVICE_ATTR_RO(type)
 
+static ssize_t modalias_show(struct device *dev, struct device_attribute *attr,
+			     char *buf)
+{
+	struct hdac_device *hdac_dev = container_of(dev, struct hdac_device, dev);
+
+	if (hdac_dev->type == HDA_DEV_LEGACY)
+		return sprintf(buf, "hdaudio:v%08Xr%08X\n", hdac_dev->vendor_id, hdac_dev->revision_id);
+	else if (hdac_dev->type == HDA_DEV_ASOC)
+		return sprintf(buf, "ehdaudio:v%08Xr%08X\n", hdac_dev->vendor_id, hdac_dev->revision_id);
+
+	return -EINVAL;
+}
+static DEVICE_ATTR_RO(modalias);
+
 CODEC_ATTR(type);
 CODEC_ATTR(vendor_id);
 CODEC_ATTR(subsystem_id);
@@ -54,6 +68,7 @@ static struct attribute *hdac_dev_attrs[] = {
 	&dev_attr_mfg.attr,
 	&dev_attr_vendor_name.attr,
 	&dev_attr_chip_name.attr,
+	&dev_attr_modalias.attr,
 	NULL
 };
 
-- 
1.7.5.4

