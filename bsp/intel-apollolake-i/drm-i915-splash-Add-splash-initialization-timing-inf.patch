From 3c18e8f4557b3ce29494821d2e3def6ee3bc80b5 Mon Sep 17 00:00:00 2001
From: Bob Paauwe <bob.j.paauwe@intel.com>
Date: Fri, 22 Apr 2016 16:43:28 -0700
Subject: [PATCH 1431/2508] drm/i915/splash: Add splash initialization timing
 info.

commit 4b4f7a3d5a17499b4e368249e4c74eec0283364c from
https://github.com/01org/linux-apollolake-i

Signed-off-by: Bob Paauwe <bob.j.paauwe@intel.com>
Reviewed-by: James Xiong <james.xiong@intel.com>
Reviewed-by: Matt Roper <matthew.d.roper@intel.com>
Signed-off-by: Matt Roper <matthew.d.roper@intel.com>
---
 drivers/gpu/drm/i915/i915_debugfs.c          |    2 ++
 drivers/gpu/drm/i915/i915_drv.h              |    1 +
 drivers/gpu/drm/i915/intel_initial_modeset.c |    2 ++
 3 files changed, 5 insertions(+), 0 deletions(-)

diff --git a/drivers/gpu/drm/i915/i915_debugfs.c b/drivers/gpu/drm/i915/i915_debugfs.c
index c27bf2a..f3ebaf5 100644
--- a/drivers/gpu/drm/i915/i915_debugfs.c
+++ b/drivers/gpu/drm/i915/i915_debugfs.c
@@ -2693,6 +2693,8 @@ static int i915_timing_info(struct seq_file *m, void *data)
 		   (dev_priv->profile.csr_load / 1000000));
 	seq_printf(m, "  Initial mode run time:       %4lldms\n",
 		   (dev_priv->profile.initial_mode_run / 1000000));
+	seq_printf(m, "  Initial mode splash init time:        %4lldms\n",
+		   (dev_priv->profile.initial_mode_init_splash / 1000000));
 	seq_printf(m, "  Initial mode get config time:         %4lldms\n",
 		   (dev_priv->profile.initial_mode_get_config / 1000000));
 
diff --git a/drivers/gpu/drm/i915/i915_drv.h b/drivers/gpu/drm/i915/i915_drv.h
index 1b1f68d..beb4535 100644
--- a/drivers/gpu/drm/i915/i915_drv.h
+++ b/drivers/gpu/drm/i915/i915_drv.h
@@ -1750,6 +1750,7 @@ struct intel_load_profiles {
 	unsigned long long csr_load;
 	unsigned long long initial_mode_run;
 	unsigned long long initial_mode_get_config;
+	unsigned long long initial_mode_init_splash;
 };
 
 struct i915_frontbuffer_tracking {
diff --git a/drivers/gpu/drm/i915/intel_initial_modeset.c b/drivers/gpu/drm/i915/intel_initial_modeset.c
index 2a852be..8e64fe0 100644
--- a/drivers/gpu/drm/i915/intel_initial_modeset.c
+++ b/drivers/gpu/drm/i915/intel_initial_modeset.c
@@ -189,6 +189,7 @@ static void intel_splash_screen_init(struct drm_device *dev)
 	char *splash_str;
 	char *sep;
 	u32 fw_npages;
+	unsigned long long start = sched_clock();
 
 	INIT_LIST_HEAD(&dev_priv->splash_list);
 
@@ -278,6 +279,7 @@ static void intel_splash_screen_init(struct drm_device *dev)
 	}
 
 	kfree(splash_dup);
+	dev_priv->profile.initial_mode_init_splash = sched_clock() - start;
 	return;
 
 fail:
-- 
1.7.5.4

