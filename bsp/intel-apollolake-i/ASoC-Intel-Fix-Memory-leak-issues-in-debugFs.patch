From 3baef5f0a176b9e08f8663f15a328af1e51ab6e3 Mon Sep 17 00:00:00 2001
From: Pardha Saradhi K <pardha.saradhi.kesapragada@intel.com>
Date: Thu, 18 Feb 2016 16:55:19 +0530
Subject: [PATCH 1878/2508] ASoC: Intel: Fix Memory leak issues in debugFs

commit 7e5c2c8a9d72cb6d1b90cec75a98f55ac58ab6ac from
https://github.com/01org/linux-apollolake-i

DebugFs feature that exposes a generic interface to send IPC
commands has memory leak issues. Two buffers have been
allocated but not freed after their usage. This patch fixes
the issues by releasing the two buffers after use.

Change-Id: Ib71479e2d62b867d10d4b92e459974c90e528ee0
Signed-off-by: Pardha Saradhi K <pardha.saradhi.kesapragada@intel.com>
Reviewed-on: https://git-gar-1.devtools.intel.com/gerrit/8193
Reviewed-by: Babu, Ramesh <ramesh.babu@intel.com>
Tested-by: Babu, Ramesh <ramesh.babu@intel.com>
---
 sound/soc/intel/skylake/skl-debug.c |    3 ++-
 1 files changed, 2 insertions(+), 1 deletions(-)

diff --git a/sound/soc/intel/skylake/skl-debug.c b/sound/soc/intel/skylake/skl-debug.c
index 1bf0c20..30b68a2 100644
--- a/sound/soc/intel/skylake/skl-debug.c
+++ b/sound/soc/intel/skylake/skl-debug.c
@@ -245,6 +245,7 @@ static ssize_t mod_control_write(struct file *file,
 
 		d->ipc_data[0] = msg.param_data_size;
 		memcpy(&d->ipc_data[1], large_data, msg.param_data_size);
+		kfree(large_data);
 		break;
 
 	case IPC_MOD_LARGE_CONFIG_SET:
@@ -279,7 +280,7 @@ static ssize_t mod_control_write(struct file *file,
 
 	/* Userspace has been fiddling around behind the kernel's back */
 	add_taint(TAINT_USER, LOCKDEP_NOW_UNRELIABLE);
-
+	kfree(buf);
 	return written;
 }
 
-- 
1.7.5.4

