From a7a4d32ffc611e55333ca8f6d28d0734aa1fc332 Mon Sep 17 00:00:00 2001
From: Bob Paauwe <bob.j.paauwe@intel.com>
Date: Tue, 19 Apr 2016 14:46:31 -0700
Subject: [PATCH 4384/4706] drm/i915/profiling: Add profiling of global GTT
 initialization.

commit ce81267a258cb441117319aa84cabeae05b74841 from
git://git.yoctoproject.org/linux-yocto-4.1

Signed-off-by: Bob Paauwe <bob.j.paauwe@intel.com>
Signed-off-by: Matt Roper <matthew.d.roper@intel.com>
---
 drivers/gpu/drm/i915/i915_debugfs.c |    2 ++
 drivers/gpu/drm/i915/i915_drv.h     |    1 +
 drivers/gpu/drm/i915/i915_gem_gtt.c |    2 ++
 3 files changed, 5 insertions(+), 0 deletions(-)

diff --git a/drivers/gpu/drm/i915/i915_debugfs.c b/drivers/gpu/drm/i915/i915_debugfs.c
index d1362a7..764efc5 100644
--- a/drivers/gpu/drm/i915/i915_debugfs.c
+++ b/drivers/gpu/drm/i915/i915_debugfs.c
@@ -2400,6 +2400,8 @@ static int i915_timing_info(struct seq_file *m, void *data)
 		   (dev_priv->profile.guc_init / 1000000));
 	seq_printf(m, "    GUC firmware load time:             %lldms\n",
 		   (dev_priv->profile.guc_load / 1000000));
+	seq_printf(m, "    Global GTT init time:               %lldms\n",
+		   (dev_priv->profile.gtt_init / 1000000));
 	seq_printf(m, "  Frambuffer device load time: %lldms\n",
 		   (dev_priv->profile.fbdev_load / 1000000));
 	seq_printf(m, "  CSR firmware load time:      %lldms\n",
diff --git a/drivers/gpu/drm/i915/i915_drv.h b/drivers/gpu/drm/i915/i915_drv.h
index 48b1c3b..7cddd0a 100644
--- a/drivers/gpu/drm/i915/i915_drv.h
+++ b/drivers/gpu/drm/i915/i915_drv.h
@@ -1703,6 +1703,7 @@ struct intel_pipe_crc {
 
 struct intel_load_profiles {
 	unsigned long long driver_load;
+	unsigned long long gtt_init;
 	unsigned long long fbdev_load;
 	unsigned long long guc_init;
 	unsigned long long guc_load;
diff --git a/drivers/gpu/drm/i915/i915_gem_gtt.c b/drivers/gpu/drm/i915/i915_gem_gtt.c
index 0bb4232..27ae8e7 100644
--- a/drivers/gpu/drm/i915/i915_gem_gtt.c
+++ b/drivers/gpu/drm/i915/i915_gem_gtt.c
@@ -2719,6 +2719,7 @@ int i915_gem_init_ggtt(struct drm_i915_private *dev_priv)
 	unsigned long hole_start, hole_end;
 	struct drm_mm_node *entry;
 	int ret;
+	unsigned long long profile = sched_clock();
 
 	ret = intel_vgt_balloon(dev_priv);
 	if (ret)
@@ -2769,6 +2770,7 @@ int i915_gem_init_ggtt(struct drm_i915_private *dev_priv)
 		ggtt->base.bind_vma = aliasing_gtt_bind_vma;
 	}
 
+	dev_priv->profile.gtt_init = sched_clock() - profile;
 	return 0;
 }
 
-- 
1.7.5.4

