From a3d77bea9e300e8713560f94631c8928ed7cf808 Mon Sep 17 00:00:00 2001
From: Matt Roper <matthew.d.roper@intel.com>
Date: Mon, 9 Nov 2015 16:35:32 -0800
Subject: [PATCH 1240/2508] drm/i915/bxt: [workaround] Use minimum of two
 lanes for DP

commit 2086c87abc897d929cd9967a86a386861288fee8 from
https://github.com/01org/linux-apollolake-i

For unknown reasons, current i915 DisplayPort code fails to link train
on Broxton if only one lane is used.  Both the interlane alignment and
the lane 0 status fail in this situation.  We only need one lane for
resolutions 800x600 and below so we're currently unable to drive those
resolutions without this patch.

This isn't a real fix, just a temporary workaround while we try to
understand what's going wrong.

HSD-ES: 1207101135
Signed-off-by: Matt Roper <matthew.d.roper@intel.com>
Reviewed-by: Bob Paauwe <bob.j.paauwe@intel.com>
---
 drivers/gpu/drm/i915/intel_dp.c |    2 +-
 1 files changed, 1 insertions(+), 1 deletions(-)

diff --git a/drivers/gpu/drm/i915/intel_dp.c b/drivers/gpu/drm/i915/intel_dp.c
index 3ff8f1d..8ac7d8a 100644
--- a/drivers/gpu/drm/i915/intel_dp.c
+++ b/drivers/gpu/drm/i915/intel_dp.c
@@ -1441,7 +1441,7 @@ intel_dp_compute_config(struct intel_encoder *encoder,
 	struct intel_crtc *intel_crtc = to_intel_crtc(pipe_config->base.crtc);
 	struct intel_connector *intel_connector = intel_dp->attached_connector;
 	int lane_count, clock;
-	int min_lane_count = 1;
+	int min_lane_count = IS_BROXTON(dev) ? 2 : 1;
 	int max_lane_count = intel_dp_max_lane_count(intel_dp);
 	/* Conveniently, the link BW constants become indices with a shift...*/
 	int min_clock = 0;
-- 
1.7.5.4

