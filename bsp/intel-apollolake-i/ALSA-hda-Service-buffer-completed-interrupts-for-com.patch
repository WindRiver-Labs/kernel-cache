From 88bbb82dd440d1d740028faa84c9ae8dbb6bbcc6 Mon Sep 17 00:00:00 2001
From: Divya Prakash <divya1.prakash@intel.com>
Date: Wed, 20 Apr 2016 10:04:07 +0530
Subject: [PATCH 1941/2508] ALSA: hda: Service buffer completed interrupts for
 compress streams

commit ef79d5f095c875b06d0056c1b03d59d7811dd85a from
https://github.com/01org/linux-apollolake-i

In case of the IOC bit being enabled, receive and
service the buffer completed interrupts for compress
streams.

Change-Id: Ic391b6757c374379637f1889dbd519b4b757f708
Signed-off-by: Divya Prakash <divya1.prakash@intel.com>
---
 sound/hda/hdac_controller.c |    5 +++--
 1 files changed, 3 insertions(+), 2 deletions(-)

diff --git a/sound/hda/hdac_controller.c b/sound/hda/hdac_controller.c
index b5a17cb..9bc16c1 100644
--- a/sound/hda/hdac_controller.c
+++ b/sound/hda/hdac_controller.c
@@ -438,8 +438,9 @@ void snd_hdac_bus_handle_stream_irq(struct hdac_bus *bus, unsigned int status,
 		if (status & azx_dev->sd_int_sta_mask) {
 			sd_status = snd_hdac_stream_readb(azx_dev, SD_STS);
 			snd_hdac_stream_writeb(azx_dev, SD_STS, SD_INT_MASK);
-			if (!azx_dev->substream || !azx_dev->running ||
-			    !(sd_status & SD_INT_COMPLETE))
+			if ((!azx_dev->substream && !azx_dev->stream)||
+				!azx_dev->running ||
+				!(sd_status & SD_INT_COMPLETE))
 				continue;
 			if (ack)
 				ack(bus, azx_dev);
-- 
1.7.5.4

