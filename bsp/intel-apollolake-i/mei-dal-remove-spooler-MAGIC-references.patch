From 023c70b4f7e41428496d524d8e22a068dbebb6a9 Mon Sep 17 00:00:00 2001
From: Yael Samet <yael.samet@intel.com>
Date: Sun, 27 Nov 2016 14:19:35 +0200
Subject: [PATCH 4646/4706] mei: dal: remove spooler MAGIC references

commit 7b215ebe46aaaf65c1bb04dc2e8675e87927a186 from
git://git.yoctoproject.org/linux-yocto-4.1

Messages to and from the spooler do not carry spooler magic header
but the regular the regular command/response magic headers.
Hence the parsing code is never in use and can be removed.

Change-Id: I4e4ed51ca605636839a862024c55d302c1ddb1e1
Signed-off-by: Yael Samet <yael.samet@intel.com>
Signed-off-by: Tomas Winkler <tomas.winkler@intel.com>
---
 drivers/misc/mei/dal/bhp_impl.h    |    2 --
 drivers/misc/mei/dal/bhp_impl_ta.c |    7 -------
 drivers/misc/mei/dal/dal_class.c   |    4 ----
 3 files changed, 0 insertions(+), 13 deletions(-)

diff --git a/drivers/misc/mei/dal/bhp_impl.h b/drivers/misc/mei/dal/bhp_impl.h
index 3d2d13a..b43cac6 100644
--- a/drivers/misc/mei/dal/bhp_impl.h
+++ b/drivers/misc/mei/dal/bhp_impl.h
@@ -194,9 +194,7 @@ void bh_prep_access_denied_response(const char *cmd,
 				    struct bhp_response_header *res);
 
 bool bh_msg_is_cmd(const char *msg, size_t len);
-
 bool bh_msg_is_response(const char *hdr);
-bool bh_msg_is_spooler(const char *hdr);
 
 #define mutex_enter(s) {}
 #define mutex_exit(s)  {}
diff --git a/drivers/misc/mei/dal/bhp_impl_ta.c b/drivers/misc/mei/dal/bhp_impl_ta.c
index f2a88cf..ac70d092 100644
--- a/drivers/misc/mei/dal/bhp_impl_ta.c
+++ b/drivers/misc/mei/dal/bhp_impl_ta.c
@@ -113,7 +113,6 @@ static int __uuid_be_to_bin(const char *uuid_str, uuid_be *uuid)
 /*
  * 4 bytes array to identify BH headers
  */
-static const u8 BH_MSG_SPLR_MAGIC[]  = {0x53, 0x50, 0x4c, 0x52};
 static const u8 BH_MSG_RESP_MAGIC[]  = {0xff, 0xa5, 0xaa, 0x55};
 static const u8 BH_MSG_CMD_MAGIC[]   = {0xff, 0xa3, 0xaa, 0x55};
 
@@ -123,12 +122,6 @@ bool bh_msg_is_response(const char *hdr)
 	return !memcmp(hdr, BH_MSG_RESP_MAGIC, sizeof(BH_MSG_RESP_MAGIC));
 }
 
-/* Check for spoolar msg */
-bool bh_msg_is_spooler(const char *hdr)
-{
-	return !memcmp(hdr, BH_MSG_SPLR_MAGIC, sizeof(BH_MSG_SPLR_MAGIC));
-}
-
 /* Check for command msg */
 bool bh_msg_is_cmd(const char *msg, size_t len)
 {
diff --git a/drivers/misc/mei/dal/dal_class.c b/drivers/misc/mei/dal/dal_class.c
index 460c5bb..4567591 100644
--- a/drivers/misc/mei/dal/dal_class.c
+++ b/drivers/misc/mei/dal/dal_class.c
@@ -480,10 +480,6 @@ static void dal_recv_cb(struct mei_cl_device *cldev, u32 events, void *context)
 		intf = get_client_by_squence_number(ddev);
 		dev_dbg(&ddev->dev, "recv_cb(): Client set by sequence number");
 		dc = ddev->clients[intf];
-	} else if (bh_msg_is_spooler(ddev->bh_fw_msg.msg)) {
-		intf = DAL_INTF_CDEV;
-		dev_dbg(&ddev->dev, "recv_cb(): EVENT msg received");
-		dc = ddev->clients[intf];
 	} else if (!ddev->current_read_client) {
 		intf = DAL_INTF_CDEV;
 		dev_dbg(&ddev->dev, "recv_cb(): EXTRA msg received - curr == NULL");
-- 
1.7.5.4

