From ffa99b818da8dd0e346529ed540ae3b5ce550f0c Mon Sep 17 00:00:00 2001
From: Yael Samet <yael.samet@intel.com>
Date: Mon, 16 Jan 2017 11:07:22 +0200
Subject: [PATCH 4669/4706] mei: dal: refactor dal_unset_ta_exclusive_access's
 error path

commit 0f9822cbb34d75c0125ad7a3ab862206caa3ffed from
git://git.yoctoproject.org/linux-yocto-4.1

Use goto label instead of unlocking mutex inside the "if".
Change the function to behave the same as dal_set_ta_exclusive_access function.

Change-Id: I2f0b6c8ea2867c99a562365b62a56c46a47d8285
Signed-off-by: Yael Samet <yael.samet@intel.com>
---
 drivers/misc/mei/dal/dal_kdi.c |    7 +++----
 1 files changed, 3 insertions(+), 4 deletions(-)

diff --git a/drivers/misc/mei/dal/dal_kdi.c b/drivers/misc/mei/dal/dal_kdi.c
index 1967be0..b34a6e8 100644
--- a/drivers/misc/mei/dal/dal_kdi.c
+++ b/drivers/misc/mei/dal/dal_kdi.c
@@ -394,9 +394,9 @@ int dal_unset_ta_exclusive_access(uuid_be ta_id)
 
 	dev = dal_find_dev(DAL_MEI_DEVICE_IVM);
 	if (!dev) {
-		mutex_unlock(&kdi_lock);
 		dev_err(dev, "can't find device\n");
-		return -ENODEV;
+		ret = -ENODEV;
+		goto unlock;
 	}
 
 	ddev = to_dal_device(dev);
@@ -405,9 +405,8 @@ int dal_unset_ta_exclusive_access(uuid_be ta_id)
 	ret = dal_access_policy_remove(ddev, ta_id, dc);
 
 	put_device(dev);
-
+unlock:
 	mutex_unlock(&kdi_lock);
-
 	return ret;
 }
 EXPORT_SYMBOL(dal_unset_ta_exclusive_access);
-- 
1.7.5.4

