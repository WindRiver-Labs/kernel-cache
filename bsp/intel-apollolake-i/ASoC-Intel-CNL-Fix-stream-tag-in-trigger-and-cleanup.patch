From 474271576ff0f30557af1a13cfbe4c6ff9d493f2 Mon Sep 17 00:00:00 2001
From: Guneshwor Singh <guneshwor.o.singh@intel.com>
Date: Mon, 25 Apr 2016 20:25:38 +0530
Subject: [PATCH 1953/2508] ASoC: Intel: CNL: Fix stream tag in trigger and
 cleanup during FW transfer

commit df10dd30487dfe7e21865a1b50551de45c6ff448 from
https://github.com/01org/linux-apollolake-i

Change-Id: I09e00f8242512f0c98512b84f07c2cb4d2a6bc74
Signed-off-by: Guneshwor Singh <guneshwor.o.singh@intel.com>
Reviewed-on: https://git-gar-1.devtools.intel.com/gerrit/8967
Reviewed-by: Shah, Hardik T <hardik.t.shah@intel.com>
Tested-by: Shah, Hardik T <hardik.t.shah@intel.com>
---
 sound/soc/intel/skylake/cnl-sst.c |    5 ++---
 1 files changed, 2 insertions(+), 3 deletions(-)

diff --git a/sound/soc/intel/skylake/cnl-sst.c b/sound/soc/intel/skylake/cnl-sst.c
index abcf045..2f3603c 100644
--- a/sound/soc/intel/skylake/cnl-sst.c
+++ b/sound/soc/intel/skylake/cnl-sst.c
@@ -245,7 +245,6 @@ base_fw_load_failed:
 static int sst_transfer_fw_host_dma(struct sst_dsp *ctx)
 {
 	int ret = 0;
-	int stream_tag = 0;
 
 	ctx->dsp_ops.trigger(ctx->dev, true, ctx->dsp_ops.stream_tag);
 	ret = sst_dsp_register_poll(ctx, CNL_ADSP_FW_STATUS, CNL_FW_STS_MASK,
@@ -253,8 +252,8 @@ static int sst_transfer_fw_host_dma(struct sst_dsp *ctx)
 			CNL_FW_ROM_BASEFW_ENTERED_TIMEOUT,
 			"Firmware boot");
 
-	ctx->dsp_ops.trigger(ctx->dev, false, stream_tag);
-	ctx->dsp_ops.cleanup(ctx->dev, &ctx->dmab, stream_tag);
+	ctx->dsp_ops.trigger(ctx->dev, false, ctx->dsp_ops.stream_tag);
+	ctx->dsp_ops.cleanup(ctx->dev, &ctx->dmab, ctx->dsp_ops.stream_tag);
 	return ret;
 }
 
-- 
1.7.5.4

