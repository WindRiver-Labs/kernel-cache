From ea58fd41382892a5ab5a25048a8e3380919695a6 Mon Sep 17 00:00:00 2001
From: Matt Roper <matthew.d.roper@intel.com>
Date: Wed, 14 Dec 2016 13:38:15 -0800
Subject: [PATCH 4361/4706] Minor 4.9 pitchfork deltas

commit b2d6fd2a101dc9d340dad7c63cd5740d689b534f from
git://git.yoctoproject.org/linux-yocto-4.1

Signed-off-by: Matt Roper <matthew.d.roper@intel.com>
---
 drivers/gpu/drm/drm_plane.c          |    2 ++
 drivers/gpu/drm/i915/intel_display.c |   10 +++++-----
 2 files changed, 7 insertions(+), 5 deletions(-)

diff --git a/drivers/gpu/drm/drm_plane.c b/drivers/gpu/drm/drm_plane.c
index 43a88ed..249c0ae 100644
--- a/drivers/gpu/drm/drm_plane.c
+++ b/drivers/gpu/drm/drm_plane.c
@@ -895,6 +895,8 @@ int drm_mode_page_flip_ioctl(struct drm_device *dev,
 out:
 	if (ret && crtc->funcs->page_flip_target)
 		drm_crtc_vblank_put(crtc);
+	if (fb)
+		drm_framebuffer_unreference(fb);
 	if (crtc->primary->old_fb)
 		drm_framebuffer_unreference(crtc->primary->old_fb);
 	crtc->primary->old_fb = NULL;
diff --git a/drivers/gpu/drm/i915/intel_display.c b/drivers/gpu/drm/i915/intel_display.c
index fe6b39d..bf32f1e 100644
--- a/drivers/gpu/drm/i915/intel_display.c
+++ b/drivers/gpu/drm/i915/intel_display.c
@@ -2539,7 +2539,7 @@ intel_fill_fb_info(struct drm_i915_private *dev_priv,
 
 		offset = _intel_compute_tile_offset(dev_priv, &x, &y,
 						    fb, 0, fb->pitches[i],
-						    BIT(DRM_ROTATE_0), tile_size);
+						    DRM_ROTATE_0, tile_size);
 		offset /= tile_size;
 
 		if (fb->modifier[i] != DRM_FORMAT_MOD_NONE) {
@@ -2575,7 +2575,7 @@ intel_fill_fb_info(struct drm_i915_private *dev_priv,
 			drm_rect_rotate(&r,
 					rot_info->plane[i].width * tile_width,
 					rot_info->plane[i].height * tile_height,
-					BIT(DRM_ROTATE_270));
+					DRM_ROTATE_270);
 			x = r.x1;
 			y = r.y1;
 
@@ -14832,9 +14832,9 @@ intel_check_primary_plane(struct drm_plane *plane,
 	}
 
 	ret = drm_plane_helper_check_state(&state->base,
-					    &state->clip,
-					    min_scale, max_scale,
-					    can_position, true);
+					   &state->clip,
+					   min_scale, max_scale,
+					   can_position, true);
 	if (ret)
 		return ret;
 
-- 
1.7.5.4

