From 4c36f7aafd26d1742027464afc9596085f655051 Mon Sep 17 00:00:00 2001
From: Bob Paauwe <bob.j.paauwe@intel.com>
Date: Tue, 1 Mar 2016 13:59:12 -0800
Subject: [PATCH 1435/2508] drm/i915: Don't try to init eDP if forced
 disconnected.

commit c51b3acffefa637ded92fb47cf5ca95f53f45d62 from
https://github.com/01org/linux-apollolake-i

If the eDP port has been marked disconnected by the video= command
line parameter, don't try to initialize it.  Attempting to initialize
the eDP connector when a panel is not connected can take a long (750ms)
time.

Signed-off-by: Bob Paauwe <bob.j.paauwe@intel.com>
Signed-off-by: Matt Roper <matthew.d.roper@intel.com>
---
 drivers/gpu/drm/i915/intel_dp.c |    6 ++++++
 1 files changed, 6 insertions(+), 0 deletions(-)

diff --git a/drivers/gpu/drm/i915/intel_dp.c b/drivers/gpu/drm/i915/intel_dp.c
index 9d44e75..59ca6f3 100644
--- a/drivers/gpu/drm/i915/intel_dp.c
+++ b/drivers/gpu/drm/i915/intel_dp.c
@@ -5891,6 +5891,12 @@ intel_dp_init_connector(struct intel_digital_port *intel_dig_port,
 	    (port == PORT_B || port == PORT_C || port == PORT_D))
 		intel_dp_mst_encoder_init(intel_dig_port,
 					  intel_connector->base.base.id);
+	if (is_edp(intel_dp) &&
+	    connector->cmdline_mode.force == DRM_FORCE_OFF) {
+		intel_dp_aux_fini(intel_dp);
+		intel_dp_mst_encoder_cleanup(intel_dig_port);
+		goto fail;
+	}
 
 	if (!intel_edp_init_connector(intel_dp, intel_connector)) {
 		intel_dp_aux_fini(intel_dp);
-- 
1.7.5.4

