From 839261734b09ad76289e0ca955014aca430c4cee Mon Sep 17 00:00:00 2001
From: "Dharageswari.R" <dharageswari.r@intel.com>
Date: Sat, 19 Mar 2016 00:00:18 +0530
Subject: [PATCH 1938/2508] ASoC: topology: Add support for TLV control for
 DAPM widget type

commit 8bd3199519f02d62a7b8b7c9748845c22e4619e6 from
https://github.com/01org/linux-apollolake-i

Change-Id: I085153280b65d74392cb847cd733d99e81f59fe6
Signed-off-by: Dharageswari.R <dharageswari.r@intel.com>
Reviewed-on: https://git-gar-1.devtools.intel.com/gerrit/8705
Reviewed-by: Babu, Ramesh <ramesh.babu@intel.com>
Tested-by: Babu, Ramesh <ramesh.babu@intel.com>
---
 sound/soc/soc-topology.c |    4 ++++
 1 files changed, 4 insertions(+), 0 deletions(-)

diff --git a/sound/soc/soc-topology.c b/sound/soc/soc-topology.c
index 98b5d37..38e8823 100644
--- a/sound/soc/soc-topology.c
+++ b/sound/soc/soc-topology.c
@@ -1181,12 +1181,16 @@ static struct snd_kcontrol_new *soc_tplg_dapm_widget_dmixer_create(
 			continue;
 		}
 
+		/* create any TLV data */
+		soc_tplg_create_tlv(tplg, &kc[i], &mc->hdr);
+
 		/* pass control to driver for optional further init */
 		err = soc_tplg_init_kcontrol(tplg, &kc[i],
 			(struct snd_soc_tplg_ctl_hdr *)mc);
 		if (err < 0) {
 			dev_err(tplg->dev, "ASoC: failed to init %s\n",
 				mc->hdr.name);
+			soc_tplg_free_tlv(tplg, &kc[i]);
 			kfree(sm);
 			continue;
 		}
-- 
1.7.5.4

