From c7efcc0ce5f5155d3a89d4c589f67df7d6e88437 Mon Sep 17 00:00:00 2001
From: Senthilnathan Veppur <senthilnathanx.veppur@intel.com>
Date: Wed, 23 Mar 2016 16:46:08 +0530
Subject: [PATCH 1922/2508] ASoC: Intel: Skylake: Add check for buffer
 overflow

commit 7244d1859d29fbe47d392cf28c2f47f672a45831 from
https://github.com/01org/linux-apollolake-i

Return error if source buffer would overflow in strncpy.

Change-Id: I8637aa3fed40dd5f042cb041cc5a447506bc15d2
Signed-off-by: Senthilnathan Veppur <senthilnathanx.veppur@intel.com>
---
 sound/soc/intel/skylake/skl-debug.c |    4 ++++
 1 files changed, 4 insertions(+), 0 deletions(-)

diff --git a/sound/soc/intel/skylake/skl-debug.c b/sound/soc/intel/skylake/skl-debug.c
index 61b17ab..8de36fa 100644
--- a/sound/soc/intel/skylake/skl-debug.c
+++ b/sound/soc/intel/skylake/skl-debug.c
@@ -514,6 +514,10 @@ static ssize_t adsp_control_write(struct file *file,
 
 	while (buf[j] != '\0') {
 		if (buf[j] == ',') {
+			if ((bufsize-j) > sizeof(id)) {
+				dev_err(d->dev, "ID buffer overflow\n");
+				return -EINVAL;
+			}
 			strncpy(id, &buf[j+1], (bufsize-j));
 			buf[j] = '\0';
 			tx_param = 1;
-- 
1.7.5.4

