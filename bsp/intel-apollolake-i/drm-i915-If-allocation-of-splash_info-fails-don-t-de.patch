From f290b5914f67628d154a3e65194be04148a1fde5 Mon Sep 17 00:00:00 2001
From: Matt Roper <matthew.d.roper@intel.com>
Date: Mon, 16 May 2016 16:27:08 -0700
Subject: [PATCH 1441/2508] drm/i915: If allocation of splash_info fails,
 don't deref on cleanup

commit 44542a9b9d6a2f525dbba45800c680b302b65958 from
https://github.com/01org/linux-apollolake-i

KW: 1114945
Signed-off-by: Matt Roper <matthew.d.roper@intel.com>
Reviewed-by: Bob Paauwe <bob.j.paauwe@intel.com>
---
 drivers/gpu/drm/i915/intel_initial_modeset.c |    8 +++++---
 1 files changed, 5 insertions(+), 3 deletions(-)

diff --git a/drivers/gpu/drm/i915/intel_initial_modeset.c b/drivers/gpu/drm/i915/intel_initial_modeset.c
index 8e64fe0..031fe3d 100644
--- a/drivers/gpu/drm/i915/intel_initial_modeset.c
+++ b/drivers/gpu/drm/i915/intel_initial_modeset.c
@@ -284,9 +284,11 @@ static void intel_splash_screen_init(struct drm_device *dev)
 
 fail:
 	/* Clean up failed entry data */
-	release_firmware(splash_info->fw);
-	kfree(splash_info->connector_name);
-	kfree(splash_info->image_name);
+	if (splash_info) {
+		release_firmware(splash_info->fw);
+		kfree(splash_info->connector_name);
+		kfree(splash_info->image_name);
+	}
 	kfree(splash_info);
 	kfree(splash_dup);
 	return;
-- 
1.7.5.4

