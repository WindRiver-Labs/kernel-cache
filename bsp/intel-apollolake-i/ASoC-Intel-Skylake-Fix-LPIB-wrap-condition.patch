From d10ff824300c4afefd0d29ab8ec36388d3a89c01 Mon Sep 17 00:00:00 2001
From: Guneshwor Singh <guneshwor.o.singh@intel.com>
Date: Wed, 30 Dec 2015 18:13:37 +0530
Subject: [PATCH 1861/2508] ASoC: Intel: Skylake: Fix LPIB wrap condition

commit 81f87cd50dc902b02f96984a3712a58e711512d1 from
https://github.com/01org/linux-apollolake-i

Change-Id: I33415201de5319ef2a24d5192a16b38d38a9f07d
Signed-off-by: Guneshwor Singh <guneshwor.o.singh@intel.com>
Tracked-On: https://jira01.devtools.intel.com/browse/OAM-15919
Signed-off-by: Andy Ross <andrew.j.ross@intel.com>
Reviewed-on: https://git-gar-1.devtools.intel.com/gerrit/8272
Reviewed-by: Babu, Ramesh <ramesh.babu@intel.com>
Tested-by: Babu, Ramesh <ramesh.babu@intel.com>
---
 sound/soc/intel/skylake/skl-pcm.c |    2 ++
 1 files changed, 2 insertions(+), 0 deletions(-)

diff --git a/sound/soc/intel/skylake/skl-pcm.c b/sound/soc/intel/skylake/skl-pcm.c
index 7aa9d80..5868c78 100644
--- a/sound/soc/intel/skylake/skl-pcm.c
+++ b/sound/soc/intel/skylake/skl-pcm.c
@@ -1170,6 +1170,8 @@ static int skl_get_delay_from_lpib(struct hdac_ext_bus *ebus,
 			delay += hstream->bufsize;
 	}
 
+	delay = (hstream->bufsize == delay) ? 0 : delay;
+
 	if (delay >= hstream->period_bytes) {
 		dev_info(bus->dev,
 			 "Unstable LPIB (%d >= %d); disabling LPIB delay counting\n",
-- 
1.7.5.4

