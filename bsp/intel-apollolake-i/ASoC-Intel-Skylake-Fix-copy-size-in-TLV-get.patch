From 95f829c424ad65085a7b150c72a362a1076a5432 Mon Sep 17 00:00:00 2001
From: "Pawse, GuruprasadX" <guruprasadx.pawse@intel.com>
Date: Mon, 29 Feb 2016 15:49:29 +0530
Subject: [PATCH 1908/2508] ASoC: Intel: Skylake: Fix copy size in TLV get()

commit 746ffbfe2d4f2ce662e7ed2b5bde91ac91a6fe9e from
https://github.com/01org/linux-apollolake-i

The size passed to TLV get and put handler
includes 8 byte TLV header. Currently 8 extra
bytes are copied to user, thus corrupting
user memory.
While copying the data to user, copy actual
TLV payload.

Change-Id: Ib5896f95a0014096be6a913c416f6f1d1072bab9
Tracked-On: https://jira01.devtools.intel.com/browse/OAM-22016
Signed-off-by: Pawse, GuruprasadX <guruprasadx.pawse@intel.com>
Reviewed-on: https://git-gar-1.devtools.intel.com/gerrit/8365
Reviewed-by: Babu, Ramesh <ramesh.babu@intel.com>
Tested-by: Babu, Ramesh <ramesh.babu@intel.com>
---
 sound/soc/intel/skylake/skl-topology.c |    2 +-
 1 files changed, 1 insertions(+), 1 deletions(-)

diff --git a/sound/soc/intel/skylake/skl-topology.c b/sound/soc/intel/skylake/skl-topology.c
index 9e13a9f..44032d9 100644
--- a/sound/soc/intel/skylake/skl-topology.c
+++ b/sound/soc/intel/skylake/skl-topology.c
@@ -940,7 +940,7 @@ static int skl_tplg_tlv_control_get(struct snd_kcontrol *kcontrol,
 		int ret;
 		ret = copy_to_user(data, &bc->param_id, sizeof(u32));
 		ret = copy_to_user(((unsigned char *)data) + sizeof(u32), &size, sizeof(u32));
-		ret = copy_to_user(((unsigned char *)data) + 2*sizeof(u32), bc->params, size);
+		ret = copy_to_user(((unsigned char *)data) + 2*sizeof(u32), bc->params, size - 2*sizeof(u32));
 
 		return  ret;
 	}
-- 
1.7.5.4

