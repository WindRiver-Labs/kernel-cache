From 39cc4de95a5aefe73a11098a1660c1cf7700b06e Mon Sep 17 00:00:00 2001
From: "Yadav, PramodX K" <pramodx.k.yadav@intel.com>
Date: Thu, 7 Jul 2016 11:05:40 +0530
Subject: [PATCH 2141/2508] ASoC: Intel: Skylake: Fix compilation warnings.

commit 8d8c3be2f370f7f15c7b04136a80fae012a7363a from
https://github.com/01org/linux-apollolake-i

Change-Id: I1aae13a06bb2a6df687e8294ec00eec1cbdb43ad
Signed-off-by: Yadav, PramodX K <pramodx.k.yadav@intel.com>
Reviewed-on: https://git-gar-1.devtools.intel.com/gerrit/10021
Reviewed-by: Babu, Ramesh <ramesh.babu@intel.com>
Tested-by: Jayanti, Satya Charitardha <satya.charitardha.jayanti@intel.com>
---
 sound/soc/intel/skylake/bxt-sst.c      |    6 +++---
 sound/soc/intel/skylake/skl-debug.c    |    2 +-
 sound/soc/intel/skylake/skl-fwlog.c    |    1 -
 sound/soc/intel/skylake/skl-fwlog.h    |    1 +
 sound/soc/intel/skylake/skl-probe.c    |    2 +-
 sound/soc/intel/skylake/skl-probe.h    |    2 +-
 sound/soc/intel/skylake/skl-topology.c |   10 +++++-----
 sound/soc/intel/skylake/skl-topology.h |    1 +
 sound/soc/intel/skylake/skl.c          |   10 +++++++++-
 sound/soc/intel/skylake/skl.h          |    1 +
 10 files changed, 23 insertions(+), 13 deletions(-)

diff --git a/sound/soc/intel/skylake/bxt-sst.c b/sound/soc/intel/skylake/bxt-sst.c
index 1ae8b91..e2502b2 100644
--- a/sound/soc/intel/skylake/bxt-sst.c
+++ b/sound/soc/intel/skylake/bxt-sst.c
@@ -554,7 +554,7 @@ static int bxt_load_base_firmware(struct sst_dsp *ctx)
 	u32 size;
 	const void *data;
 	int ret = 0;
-	struct firmware *fw = NULL;
+	const struct firmware *fw = NULL;
 	struct skl_sst *skl = ctx->thread_context;
 
 	dev_dbg(ctx->dev, "In %s\n", __func__);
@@ -629,7 +629,7 @@ static int bxt_load_library(struct sst_dsp *ctx)
 	struct snd_dma_buffer dmab;
 	struct skl_sst *skl = ctx->thread_context;
 	struct skl_dfw_manifest *minfo = &skl->manifest;
-	struct firmware *fw = NULL;
+	const struct firmware *fw = NULL;
 	struct skl_ext_manifest_header *hdr;
 	u32 size;
 	const void *data;
@@ -659,7 +659,7 @@ static int bxt_load_library(struct sst_dsp *ctx)
 		}
 
 		dev_dbg(ctx->dev, "Starting to preapre host dma for library name \
-			: %s of size:%zx\n", minfo->lib[i].name, size);
+			: %s of size:%zx\n", minfo->lib[i].name, (size_t)size);
 		stream_tag = ctx->dsp_ops.prepare(ctx->dev, 0x40, size,
 						&dmab);
 		if (stream_tag <= 0) {
diff --git a/sound/soc/intel/skylake/skl-debug.c b/sound/soc/intel/skylake/skl-debug.c
index 8f53c38..2099189 100644
--- a/sound/soc/intel/skylake/skl-debug.c
+++ b/sound/soc/intel/skylake/skl-debug.c
@@ -830,7 +830,7 @@ struct skl_debug *skl_debugfs_init(struct skl *skl)
 	if (!debugfs_create_file("fw_soft_regs_rd", 0644, d->fs, d,
 				 &soft_regs_ctrl_fops)) {
 		dev_err(d->dev, "fw soft regs control debugfs init failed\n");
-		return -EIO;
+		goto err;
 	}
 
 	if (!debugfs_create_file("core_power", 0644, d->fs, d,
diff --git a/sound/soc/intel/skylake/skl-fwlog.c b/sound/soc/intel/skylake/skl-fwlog.c
index 564c58b..10a3232 100644
--- a/sound/soc/intel/skylake/skl-fwlog.c
+++ b/sound/soc/intel/skylake/skl-fwlog.c
@@ -101,7 +101,6 @@ EXPORT_SYMBOL_GPL(update_dsp_log_priority);
 
 int get_dsp_log_priority(struct skl *skl)
 {
-	int ret = 0;
 	u32 value;
 	struct skl_sst *ctx = skl->skl_sst;
 
diff --git a/sound/soc/intel/skylake/skl-fwlog.h b/sound/soc/intel/skylake/skl-fwlog.h
index a10c258..207e289 100644
--- a/sound/soc/intel/skylake/skl-fwlog.h
+++ b/sound/soc/intel/skylake/skl-fwlog.h
@@ -1,4 +1,5 @@
 #include "../common/sst-dsp-priv.h"
+#include "skl.h"
 
 int skl_dsp_init_trace_window(struct sst_dsp *sst, u32 *wp, u32 offset,
 				u32 size, int nr_cores);
diff --git a/sound/soc/intel/skylake/skl-probe.c b/sound/soc/intel/skylake/skl-probe.c
index 6640f3a..f216c5a 100644
--- a/sound/soc/intel/skylake/skl-probe.c
+++ b/sound/soc/intel/skylake/skl-probe.c
@@ -61,7 +61,7 @@ int skl_probe_compr_open(struct snd_compr_stream *substream,
 						struct snd_soc_dai *dai)
 {
 	struct hdac_ext_bus *ebus = dev_get_drvdata(dai->dev);
-	struct hdac_ext_stream *stream;
+	struct hdac_ext_stream *stream = NULL;
 	struct snd_compr_runtime *runtime = substream->runtime;
 	struct skl *skl = get_skl_ctx(dai->dev);
 	struct skl_probe_config *pconfig =  &skl->skl_sst->probe_config;
diff --git a/sound/soc/intel/skylake/skl-probe.h b/sound/soc/intel/skylake/skl-probe.h
index 69e0115..a7b8f34 100644
--- a/sound/soc/intel/skylake/skl-probe.h
+++ b/sound/soc/intel/skylake/skl-probe.h
@@ -27,7 +27,7 @@ int skl_probe_compr_set_params(struct snd_compr_stream *substream,
 
 int skl_probe_compr_tstamp(struct snd_compr_stream *stream,
 			struct snd_compr_tstamp *tstamp, struct snd_soc_dai *dai);
-void skl_probe_compr_close(struct snd_compr_stream *substream,
+int skl_probe_compr_close(struct snd_compr_stream *substream,
 					struct snd_soc_dai *dai);
 int skl_probe_compr_ack(struct snd_compr_stream *substream, size_t bytes,
 					struct snd_soc_dai *dai);
diff --git a/sound/soc/intel/skylake/skl-topology.c b/sound/soc/intel/skylake/skl-topology.c
index d47d7ba..c0ca762 100644
--- a/sound/soc/intel/skylake/skl-topology.c
+++ b/sound/soc/intel/skylake/skl-topology.c
@@ -658,8 +658,8 @@ int skl_tplg_attach_probe_dma(struct snd_soc_dapm_widget *w,
 		ad.dma_buff_size = SKL_INJECT_PROBE_DMA_BUFF_SIZE;
 	}
 
-	ret = skl_set_module_params(ctx, &ad, sizeof(struct skl_attach_probe_dma),
-						1, mconfig);
+	ret = skl_set_module_params(ctx, (u32 *)&ad,
+				sizeof(struct skl_attach_probe_dma), 1, mconfig);
 	return ret;
 
 }
@@ -674,7 +674,7 @@ int skl_tplg_set_probe_params(struct snd_soc_dapm_widget *w,
 	struct soc_bytes_ext *sb;
 	struct skl_probe_data *bc;
 	struct skl_probe_config *pconfig = &ctx->probe_config;
-	struct probe_pt_param prb_pt_param[8] = {0};
+	struct probe_pt_param prb_pt_param[8] = { {0} };
 
 	if (direction == SND_COMPRESS_PLAYBACK) {
 
@@ -2103,7 +2103,7 @@ static int skl_tplg_notification_log_get(struct snd_kcontrol *kcontrol,
 	events = (struct skl_tcn_events *)sb->dobj.private;
 	ret = copy_to_user(data, &type, sizeof(u32));
 	ret = copy_to_user(((unsigned char *)data) + sizeof(u32),
-				sb->max, sizeof(u32));
+				&(sb->max), sizeof(u32));
 	ret = copy_to_user(((unsigned char *)data) + 2*sizeof(u32),
 				events, sizeof(struct skl_tcn_events));
 
@@ -2112,7 +2112,7 @@ static int skl_tplg_notification_log_get(struct snd_kcontrol *kcontrol,
 }
 
 static int skl_tplg_notification_log_put(struct snd_kcontrol *kcontrol,
-		unsigned int __user *data, unsigned int size)
+		const unsigned int __user *data, unsigned int size)
 {
 	return 0;
 }
diff --git a/sound/soc/intel/skylake/skl-topology.h b/sound/soc/intel/skylake/skl-topology.h
index 48fa5f0..98a5db8 100644
--- a/sound/soc/intel/skylake/skl-topology.h
+++ b/sound/soc/intel/skylake/skl-topology.h
@@ -27,6 +27,7 @@
 #include <sound/soc.h>
 #include "skl.h"
 #include "skl-tplg-interface.h"
+#include "skl-sst-ipc.h"
 
 #define BITS_PER_BYTE 8
 #define MAX_TS_GROUPS 8
diff --git a/sound/soc/intel/skylake/skl.c b/sound/soc/intel/skylake/skl.c
index 24f48da..6d10221 100644
--- a/sound/soc/intel/skylake/skl.c
+++ b/sound/soc/intel/skylake/skl.c
@@ -675,6 +675,12 @@ static int skl_create(struct pci_dev *pci,
 	return 0;
 }
 
+/*
+ * Enable this section of the code if HDMI audio(i.e. audio
+ * via iDISP codec of the SoC) is to be enabled and the
+ * necessary graphics driver support is available.
+ */
+#if 0
 static int skl_i915_init(struct hdac_bus *bus)
 {
 	int err;
@@ -695,6 +701,7 @@ static int skl_i915_init(struct hdac_bus *bus)
 
 	return err;
 }
+#endif
 
 static int skl_first_init(struct hdac_ext_bus *ebus)
 {
@@ -786,7 +793,9 @@ static int skl_probe(struct pci_dev *pci,
 	struct hdac_ext_bus *ebus = NULL;
 	struct hdac_bus *bus = NULL;
 	struct hdac_ext_link *hlink = NULL;
+#ifdef CONFIG_SND_SOC_INTEL_CNL_FPGA
 	const struct firmware *nhlt_fw = NULL;
+#endif
 	int err;
 
 	/* we use ext core ops, so provide NULL for ops here */
@@ -883,7 +892,6 @@ out_nhlt_free:
 #if SKL_USE_NHLT_FROM_BIOS
 	skl_nhlt_free(skl->nhlt);
 #endif
-out_dsp_free:
 	skl_free_dsp(skl);
 out_free:
 	skl->init_failed = 1;
diff --git a/sound/soc/intel/skylake/skl.h b/sound/soc/intel/skylake/skl.h
index 9a46d35..9fc09490 100644
--- a/sound/soc/intel/skylake/skl.h
+++ b/sound/soc/intel/skylake/skl.h
@@ -65,6 +65,7 @@ struct skl_dsp_resource {
 };
 
 struct skl_debug;
+struct snd_soc_dapm_widget;
 
 struct skl {
 	struct hdac_ext_bus ebus;
-- 
1.7.5.4

