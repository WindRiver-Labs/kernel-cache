From ec837544554f35539baa8520836ec5a9df0b97b2 Mon Sep 17 00:00:00 2001
From: Jeeja KP <jeeja.kp@intel.com>
Date: Tue, 17 Feb 2015 23:54:57 +0530
Subject: [PATCH 1691/2508] ASoC: dapm: Add kcontrol support for PGA

commit e1f5da0e53348f30304ab820ec98c0ca265ccd84 from
https://github.com/01org/linux-apollolake-i

This adds support to add kcontrol for PGA widget.

Signed-off-by: Jeeja KP <jeeja.kp@intel.com>
Signed-off-by: Mythri P K <mythri.p.k@intel.com>
---
 sound/soc/soc-dapm.c |   22 +++++++++++++++-------
 1 files changed, 15 insertions(+), 7 deletions(-)

diff --git a/sound/soc/soc-dapm.c b/sound/soc/soc-dapm.c
index 1f47768..9f11617 100644
--- a/sound/soc/soc-dapm.c
+++ b/sound/soc/soc-dapm.c
@@ -754,8 +754,8 @@ static int dapm_is_shared_kcontrol(struct snd_soc_dapm_context *dapm,
  * Determine if a kcontrol is shared. If it is, look it up. If it isn't,
  * create it. Either way, add the widget into the control's widget list
  */
-static int dapm_create_or_share_mixmux_kcontrol(struct snd_soc_dapm_widget *w,
-	int kci)
+static int dapm_create_or_share_mixmuxpga_kcontrol(
+	struct snd_soc_dapm_widget *w, int kci)
 {
 	struct snd_soc_dapm_context *dapm = w->dapm;
 	struct snd_card *card = dapm->card->snd_card;
@@ -797,6 +797,10 @@ static int dapm_create_or_share_mixmux_kcontrol(struct snd_soc_dapm_widget *w,
 				wname_in_long_name = true;
 				kcname_in_long_name = false;
 				break;
+			case snd_soc_dapm_pga:
+				wname_in_long_name = true;
+				kcname_in_long_name = true;
+				break;
 			default:
 				return -EINVAL;
 			}
@@ -874,7 +878,7 @@ static int dapm_new_mixer(struct snd_soc_dapm_widget *w)
 				continue;
 
 			if (!w->kcontrols[i]) {
-				ret = dapm_create_or_share_mixmux_kcontrol(w, i);
+				ret = dapm_create_or_share_mixmuxpga_kcontrol(w, i);
 				if (ret < 0)
 					return ret;
 			}
@@ -927,7 +931,7 @@ static int dapm_new_mux(struct snd_soc_dapm_widget *w)
 		return -EINVAL;
 	}
 
-	ret = dapm_create_or_share_mixmux_kcontrol(w, 0);
+	ret = dapm_create_or_share_mixmuxpga_kcontrol(w, 0);
 	if (ret < 0)
 		return ret;
 
@@ -949,9 +953,13 @@ static int dapm_new_mux(struct snd_soc_dapm_widget *w)
 /* create new dapm volume control */
 static int dapm_new_pga(struct snd_soc_dapm_widget *w)
 {
-	if (w->num_kcontrols)
-		dev_err(w->dapm->dev,
-			"ASoC: PGA controls not supported: '%s'\n", w->name);
+	int i, ret;
+
+	for (i = 0; i < w->num_kcontrols; i++) {
+		ret = dapm_create_or_share_mixmuxpga_kcontrol(w, i);
+		if (ret < 0)
+			return ret;
+	}
 
 	return 0;
 }
-- 
1.7.5.4

