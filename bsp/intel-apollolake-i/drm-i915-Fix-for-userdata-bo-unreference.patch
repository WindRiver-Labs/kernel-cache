From c186cc3773599b216526d2291eb32893efc5580c Mon Sep 17 00:00:00 2001
From: Jeff McGee <jeff.mcgee@intel.com>
Date: Thu, 7 Jul 2016 09:40:48 -0700
Subject: [PATCH 1980/2508] drm/i915: Fix for userdata bo unreference

commit d411cd66f306a7fefef68d6d1ef56cc71aa16afa from
https://github.com/01org/linux-apollolake-i

i915_gem_userdata() must use drm_gem_object_unreference_unlocked
since it is not holding dev->struct_mutex.

Fixes: 65a0ac7d10ec ("drm/i915: Support for bo userdata")
Signed-off-by: Jeff McGee <jeff.mcgee@intel.com>
Signed-off-by: Matt Roper <matthew.d.roper@intel.com>
---
 drivers/gpu/drm/i915/i915_gem_userdata.c |    2 +-
 1 files changed, 1 insertions(+), 1 deletions(-)

diff --git a/drivers/gpu/drm/i915/i915_gem_userdata.c b/drivers/gpu/drm/i915/i915_gem_userdata.c
index fcd6088..849df94 100644
--- a/drivers/gpu/drm/i915/i915_gem_userdata.c
+++ b/drivers/gpu/drm/i915/i915_gem_userdata.c
@@ -190,7 +190,7 @@ i915_gem_userdata(struct drm_device *dev,
 	}
 
 unref:
-	drm_gem_object_unreference(&obj->base);
+	drm_gem_object_unreference_unlocked(&obj->base);
 
 	return ret;
 #undef SIZE_LIMIT
-- 
1.7.5.4

