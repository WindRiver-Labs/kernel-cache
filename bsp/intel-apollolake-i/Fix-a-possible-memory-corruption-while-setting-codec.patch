From 8933fbaea23bd72d288f11872322498ba8fa9ae7 Mon Sep 17 00:00:00 2001
From: "Subhransu S. Prusty" <subhransu.s.prusty@intel.com>
Date: Fri, 18 Sep 2015 12:19:37 +0530
Subject: [PATCH 1667/2508] Fix a possible memory corruption while setting
 codec dai dma params

commit 20df2d274b574e4d4a04cd7ef73f31bfb8084975 from
https://github.com/01org/linux-apollolake-i

Signed-off-by: Subhransu S. Prusty <subhransu.s.prusty@intel.com>

Conflicts:
	sound/soc/intel/skylake/skl-pcm.c

Change-Id: Ic29fc67e520841dca2a5dcbc21746200614a3b06
---
 sound/soc/intel/skylake/skl-pcm.c |    5 ++---
 1 files changed, 2 insertions(+), 3 deletions(-)

diff --git a/sound/soc/intel/skylake/skl-pcm.c b/sound/soc/intel/skylake/skl-pcm.c
index 253eec4..aed9284 100644
--- a/sound/soc/intel/skylake/skl-pcm.c
+++ b/sound/soc/intel/skylake/skl-pcm.c
@@ -327,7 +327,7 @@ static int skl_link_hw_params(struct snd_pcm_substream *substream,
 	struct hdac_ext_bus *ebus = dev_get_drvdata(dai->dev);
 	struct hdac_ext_stream *link_dev;
 	struct snd_soc_pcm_runtime *rtd = snd_pcm_substream_chip(substream);
-	struct skl_dma_params *dma_params;
+	struct hdac_ext_dma_params *dma_params;
 	struct snd_soc_dai *codec_dai = rtd->codec_dai;
 	struct skl_pipe_params p_params = {0};
 
@@ -339,11 +339,10 @@ static int skl_link_hw_params(struct snd_pcm_substream *substream,
 	snd_soc_dai_set_dma_data(dai, substream, (void *)link_dev);
 
 	/* set the stream tag in the codec dai dma params  */
-	dma_params = (struct skl_dma_params *)
+	dma_params = (struct hdac_ext_dma_params *)
 			snd_soc_dai_get_dma_data(codec_dai, substream);
 	if (dma_params)
 		dma_params->stream_tag =  hdac_stream(link_dev)->stream_tag;
-	snd_soc_dai_set_dma_data(codec_dai, substream, (void *)dma_params);
 
 	p_params.s_fmt = snd_pcm_format_width(params_format(params));
 	p_params.ch = params_channels(params);
-- 
1.7.5.4

