From 8083c2e68b31efcf8c16767a963957bf70897f7d Mon Sep 17 00:00:00 2001
From: "Ooi, Joyce" <joyce.ooi@intel.com>
Date: Fri, 2 Dec 2016 10:58:53 +0800
Subject: [PATCH 4563/4706] Revert "hid: intel-ish-hid: ishtp: Disable the use
 of DMA"

commit b941065fc53fb85dc461ef509c175c32b2ef0876 from
git://git.yoctoproject.org/linux-yocto-4.1

This reverts commit c90bef9c7d8f ("hid: intel-ish-hid: ishtp: Disable the
use of DMA").
This workaround is no longer needed as upstream ISH drivers have resolved
the DMA issue.

Signed-off-by: Ooi, Joyce <joyce.ooi@intel.com>
---
 drivers/hid/intel-ish-hid/ishtp/hbm.c |    6 ++----
 1 files changed, 2 insertions(+), 4 deletions(-)

diff --git a/drivers/hid/intel-ish-hid/ishtp/hbm.c b/drivers/hid/intel-ish-hid/ishtp/hbm.c
index 2ff5dca..7ea9d94 100644
--- a/drivers/hid/intel-ish-hid/ishtp/hbm.c
+++ b/drivers/hid/intel-ish-hid/ishtp/hbm.c
@@ -507,10 +507,8 @@ void ishtp_hbm_dispatch(struct ishtp_device *dev,
 	struct hbm_client_connect_request *disconnect_req;
 	struct hbm_props_response *props_res;
 	struct hbm_host_enum_response *enum_res;
-#if 0
 	struct ishtp_msg_hdr ishtp_hdr;
 	struct dma_alloc_notify	dma_alloc_notify;
-#endif
 	struct dma_xfer_hbm	*dma_xfer;
 
 	ishtp_msg = hdr;
@@ -591,7 +589,7 @@ void ishtp_hbm_dispatch(struct ishtp_device *dev,
 
 		if (dev->dev_state != ISHTP_DEV_ENABLED)
 			break;
-#if 0
+
 		ishtp_cl_alloc_dma_buf(dev);
 		if (dev->ishtp_host_dma_rx_buf) {
 			const size_t len = sizeof(dma_alloc_notify);
@@ -606,7 +604,7 @@ void ishtp_hbm_dispatch(struct ishtp_device *dev,
 			ishtp_write_message(dev, &ishtp_hdr,
 				(unsigned char *)&dma_alloc_notify);
 		}
-#endif
+
 		break;
 
 	case HOST_ENUM_RES_CMD:
-- 
1.7.5.4

