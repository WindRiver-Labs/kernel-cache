From 794a2a8f0d930f5750ac7065e66feec83bbcb3dc Mon Sep 17 00:00:00 2001
From: Bard Liao <bardliao@realtek.com>
Date: Fri, 5 Sep 2014 13:41:29 +0800
Subject: [PATCH 1673/2508] ASoC: rt286: Set cbj_en for ACPI devices

commit 3abcb011b534cde349906f8b64145683c6be138f from
https://github.com/01org/linux-apollolake-i

This patch set cbj_en value for ACPI devices.

Signed-off-by: Bard Liao <bardliao@realtek.com>
---
 sound/soc/codecs/rt286.c |   18 +++++++++++++++++-
 1 files changed, 17 insertions(+), 1 deletions(-)

diff --git a/sound/soc/codecs/rt286.c b/sound/soc/codecs/rt286.c
index d5be4f9..764c155 100644
--- a/sound/soc/codecs/rt286.c
+++ b/sound/soc/codecs/rt286.c
@@ -1101,8 +1101,14 @@ static const struct i2c_device_id rt286_i2c_id[] = {
 };
 MODULE_DEVICE_TABLE(i2c, rt286_i2c_id);
 
+/* the default platform data for acpi devices */
+static struct rt286_platform_data rt286_acpi_data = {
+	.cbj_en = true,
+	.gpio2_en = false,
+};
+
 static const struct acpi_device_id rt286_acpi_match[] = {
-	{ "INT343A", 0 },
+	{ "INT343A", (unsigned long)&rt286_acpi_data },
 	{},
 };
 MODULE_DEVICE_TABLE(acpi, rt286_acpi_match);
@@ -1134,6 +1140,8 @@ static int rt286_i2c_probe(struct i2c_client *i2c,
 	struct rt286_platform_data *pdata = dev_get_platdata(&i2c->dev);
 	struct rt286_priv *rt286;
 	int i, ret, val;
+	struct device *dev = &i2c->dev;
+	const struct acpi_device_id *acpiid;
 
 	rt286 = devm_kzalloc(&i2c->dev,	sizeof(*rt286),
 				GFP_KERNEL);
@@ -1180,6 +1188,14 @@ static int rt286_i2c_probe(struct i2c_client *i2c,
 		dmi_check_system(dmi_dell_dino))
 		rt286->pdata.cbj_en = true;
 
+	/* enable jack combo mode on supported devices */
+	acpiid = acpi_match_device(dev->driver->acpi_match_table, dev);
+	if (acpiid) {
+		rt286->pdata = *(struct rt286_platform_data *)
+			acpiid->driver_data;
+	}
+
+
 	regmap_write(rt286->regmap, RT286_SET_AUDIO_POWER, AC_PWRST_D3);
 
 	for (i = 0; i < RT286_POWER_REG_LEN; i++)
-- 
1.7.5.4

