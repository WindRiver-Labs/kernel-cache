From 07424f598be52f86eb35431af98f8b16cb8ee66d Mon Sep 17 00:00:00 2001
From: Jayachandran B <jayachandran.b@intel.com>
Date: Tue, 19 Jul 2016 09:57:18 +0530
Subject: [PATCH 2144/2508] ASoC: Intel: Skylake: Enable/Disable notification
 only if FW is loaded

commit a852812d574c7631b814e28422c76e1a645e93d7 from
https://github.com/01org/linux-apollolake-i

It is correct for skl_dsp_wake() to return success without
loading the FW if it gets called before first boot, say
because of runtime PM resume. In this case, call the
notification enable function only if FW is loaded since
this function sends an IPC

Change-Id: I282a489d2a65926ef126ed4a225959c46ebaeef1
Signed-off-by: Jayachandran B <jayachandran.b@intel.com>
Reviewed-on: https://git-gar-1.devtools.intel.com/gerrit/10454
Reviewed-by: Babu, Ramesh <ramesh.babu@intel.com>
Tested-by: Jayanti, Satya Charitardha <satya.charitardha.jayanti@intel.com>
---
 sound/soc/intel/skylake/skl-messages.c |    9 ++++++++-
 1 files changed, 8 insertions(+), 1 deletions(-)

diff --git a/sound/soc/intel/skylake/skl-messages.c b/sound/soc/intel/skylake/skl-messages.c
index 78670c2..e24708a 100644
--- a/sound/soc/intel/skylake/skl-messages.c
+++ b/sound/soc/intel/skylake/skl-messages.c
@@ -369,7 +369,14 @@ int skl_resume_dsp(struct skl *skl)
 		ret = skl_dsp_wake(ctx->dsp);
 		if (ret < 0)
 			return ret;
-		skl_dsp_enable_notification(skl->skl_sst, false);
+		/*
+		 * It is correct for skl_dsp_wake() to return success without
+		 * loading the FW if it gets called before first boot, say
+		 * because of runtime PM resume. In this case, call the
+		 * notification enable function only if FW is loaded since
+		 * this function sends an IPC */
+		if (ctx->fw_loaded)
+			skl_dsp_enable_notification(skl->skl_sst, false);
 	}
 
 	return ret;
-- 
1.7.5.4

