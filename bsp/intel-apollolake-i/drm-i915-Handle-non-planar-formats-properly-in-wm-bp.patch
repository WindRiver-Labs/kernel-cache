From 7341721d59e37bb9cd79e1ad83478ab1f0deb3d3 Mon Sep 17 00:00:00 2001
From: Matt Roper <matthew.d.roper@intel.com>
Date: Fri, 20 May 2016 09:36:13 -0700
Subject: [PATCH 1444/2508] drm/i915: Handle non-planar formats properly in wm
 bpp calculation

commit 756c49e0496a9722740b0f86c12e0ebeacb760ef from
https://github.com/01org/linux-apollolake-i

Signed-off-by: Matt Roper <matthew.d.roper@intel.com>
---
 drivers/gpu/drm/i915/intel_pm.c |    6 ++++--
 1 files changed, 4 insertions(+), 2 deletions(-)

diff --git a/drivers/gpu/drm/i915/intel_pm.c b/drivers/gpu/drm/i915/intel_pm.c
index d944cb5..1b28503 100644
--- a/drivers/gpu/drm/i915/intel_pm.c
+++ b/drivers/gpu/drm/i915/intel_pm.c
@@ -3118,8 +3118,10 @@ skl_ddb_min_alloc(const struct drm_plane_state *pstate,
 		src_h /= 2;
 	}
 
-	plane_bpp = y ? drm_format_plane_cpp(fb->pixel_format, 0) :
-		drm_format_plane_cpp(fb->pixel_format, 1);
+	if (fb->pixel_format == DRM_FORMAT_NV12 && !y)
+		plane_bpp = drm_format_plane_cpp(fb->pixel_format, 1);
+	else
+		plane_bpp = drm_format_plane_cpp(fb->pixel_format, 0);
 
 	if (intel_rotation_90_or_270(pstate->rotation)) {
 		switch (plane_bpp) {
-- 
1.7.5.4

