From ff4f9a22023b858cbb593737be9cfefb3d5e15b2 Mon Sep 17 00:00:00 2001
From: "Pawse, GuruprasadX" <guruprasadx.pawse@intel.com>
Date: Mon, 7 Sep 2015 16:07:35 +0530
Subject: [PATCH 1780/2508] WORKAROUND: Avoid NHLT Init during probe

commit d3e48e0ea4edb2703344ff7e447d03708bd29d88 from
https://github.com/01org/linux-apollolake-i

Change-Id: I5ec452c0b73697e8e0491571942f7b69491ec910
Signed-off-by: Pawse, GuruprasadX <guruprasadx.pawse@intel.com>
Reviewed-on: https://git-gar-1.devtools.intel.com/gerrit/7400
Reviewed-by: Babu, Ramesh <ramesh.babu@intel.com>
Tested-by: Babu, Ramesh <ramesh.babu@intel.com>
---
 sound/soc/intel/skylake/skl-nhlt.c |    7 ++++++-
 sound/soc/intel/skylake/skl.c      |    5 +++--
 2 files changed, 9 insertions(+), 3 deletions(-)

diff --git a/sound/soc/intel/skylake/skl-nhlt.c b/sound/soc/intel/skylake/skl-nhlt.c
index 2be8b64..41df83b 100644
--- a/sound/soc/intel/skylake/skl-nhlt.c
+++ b/sound/soc/intel/skylake/skl-nhlt.c
@@ -128,7 +128,12 @@ struct nhlt_specific_cfg
 
 	dump_config(dev, instance, link_type, s_fmt, num_ch, s_rate, dirn, bps);
 
-	epnt = (struct nhlt_endpoint *)nhlt->desc;
+	if (nhlt != NULL)
+		epnt = (struct nhlt_endpoint *)nhlt->desc;
+	else {
+		dev_dbg(dev, "nhlt is NULL\n");
+		return NULL;
+	}
 
 	dev_dbg(dev, "endpoint count =%d\n", nhlt->endpoint_count);
 
diff --git a/sound/soc/intel/skylake/skl.c b/sound/soc/intel/skylake/skl.c
index 67fda882..bad0b01 100644
--- a/sound/soc/intel/skylake/skl.c
+++ b/sound/soc/intel/skylake/skl.c
@@ -562,12 +562,13 @@ static int skl_probe(struct pci_dev *pci,
 	err = skl_first_init(ebus);
 	if (err < 0)
 		goto out_free;
-
+#if 0
+	/* NO NHLT On FPGA */
 	skl->nhlt = skl_nhlt_init(bus->dev);
 
 	if (skl->nhlt == NULL)
 		goto out_free;
-
+#endif
 	pci_set_drvdata(skl->pci, ebus);
 
 	/* check if dsp is there */
-- 
1.7.5.4

