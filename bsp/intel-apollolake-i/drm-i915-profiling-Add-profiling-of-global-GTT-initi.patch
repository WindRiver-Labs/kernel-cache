From 57b12ecc4b70a264c3cc53819dff266498727be2 Mon Sep 17 00:00:00 2001
From: Bob Paauwe <bob.j.paauwe@intel.com>
Date: Tue, 19 Apr 2016 14:46:31 -0700
Subject: [PATCH 1254/2508] drm/i915/profiling: Add profiling of global GTT
 initialization.

commit aca7255a864838e92cf06563a6cae551d7c74c86 from
https://github.com/01org/linux-apollolake-i

Signed-off-by: Bob Paauwe <bob.j.paauwe@intel.com>
Signed-off-by: Matt Roper <matthew.d.roper@intel.com>
---
 drivers/gpu/drm/i915/i915_debugfs.c |    2 ++
 drivers/gpu/drm/i915/i915_drv.h     |    1 +
 drivers/gpu/drm/i915/i915_gem_gtt.c |    2 ++
 3 files changed, 5 insertions(+), 0 deletions(-)

diff --git a/drivers/gpu/drm/i915/i915_debugfs.c b/drivers/gpu/drm/i915/i915_debugfs.c
index 1177b6d..c6f22eb 100644
--- a/drivers/gpu/drm/i915/i915_debugfs.c
+++ b/drivers/gpu/drm/i915/i915_debugfs.c
@@ -2402,6 +2402,8 @@ static int i915_timing_info(struct seq_file *m, void *data)
 		   (dev_priv->profile.guc_init / 1000000));
 	seq_printf(m, "    GUC firmware load time:             %lldms\n",
 		   (dev_priv->profile.guc_load / 1000000));
+	seq_printf(m, "    Global GTT init time:               %lldms\n",
+		   (dev_priv->profile.gtt_init / 1000000));
 	seq_printf(m, "  Frambuffer device load time: %lldms\n",
 		   (dev_priv->profile.fbdev_load / 1000000));
 	seq_printf(m, "  CSR firmware load time:      %lldms\n",
diff --git a/drivers/gpu/drm/i915/i915_drv.h b/drivers/gpu/drm/i915/i915_drv.h
index 068e150..866a6ef 100644
--- a/drivers/gpu/drm/i915/i915_drv.h
+++ b/drivers/gpu/drm/i915/i915_drv.h
@@ -1637,6 +1637,7 @@ struct intel_pipe_crc {
 
 struct intel_load_profiles {
 	unsigned long long driver_load;
+	unsigned long long gtt_init;
 	unsigned long long fbdev_load;
 	unsigned long long guc_init;
 	unsigned long long guc_load;
diff --git a/drivers/gpu/drm/i915/i915_gem_gtt.c b/drivers/gpu/drm/i915/i915_gem_gtt.c
index 7cfafdc..fed1508 100644
--- a/drivers/gpu/drm/i915/i915_gem_gtt.c
+++ b/drivers/gpu/drm/i915/i915_gem_gtt.c
@@ -2719,6 +2719,7 @@ static int i915_gem_setup_global_gtt(struct drm_device *dev,
 	struct drm_i915_gem_object *obj;
 	unsigned long hole_start, hole_end;
 	int ret;
+	unsigned long long profile = sched_clock();
 
 	BUG_ON(mappable_end > end);
 
@@ -2801,6 +2802,7 @@ static int i915_gem_setup_global_gtt(struct drm_device *dev,
 		dev_priv->ggtt.base.bind_vma = aliasing_gtt_bind_vma;
 	}
 
+	dev_priv->profile.gtt_init = sched_clock() - profile;
 	return 0;
 }
 
-- 
1.7.5.4

