From df080c38793045bb903e1c17b6cdb2d5209a40ba Mon Sep 17 00:00:00 2001
From: Jeff McGee <jeff.mcgee@intel.com>
Date: Thu, 7 Jul 2016 09:40:49 -0700
Subject: [PATCH 1981/2508] drm/i915: Allow userdata GET to query data
 existence

commit 5a85d37047fd9b689cb587a8a6584a368bbd8a83 from
https://github.com/01org/linux-apollolake-i

Client should be allowed to use the GET operation to (1) see if
userdata has been created, and if so (2) retrieve it. Continue
to return -EINVAL if userdata has not been created, but do not
spam the log with error messages.

Signed-off-by: Jeff McGee <jeff.mcgee@intel.com>
Signed-off-by: Matt Roper <matthew.d.roper@intel.com>
---
 drivers/gpu/drm/i915/i915_ext_ioctl.c    |    2 +-
 drivers/gpu/drm/i915/i915_gem_userdata.c |   10 +++++++++-
 2 files changed, 10 insertions(+), 2 deletions(-)

diff --git a/drivers/gpu/drm/i915/i915_ext_ioctl.c b/drivers/gpu/drm/i915/i915_ext_ioctl.c
index ea7608b..c3d0d6e 100644
--- a/drivers/gpu/drm/i915/i915_ext_ioctl.c
+++ b/drivers/gpu/drm/i915/i915_ext_ioctl.c
@@ -147,7 +147,7 @@ err_i1:
 	if (kdata != stack_kdata)
 		kfree(kdata);
 	if (retcode)
-		DRM_ERROR("ret = %d\n", retcode);
+		DRM_DEBUG("ret = %d\n", retcode);
 	return retcode;
 }
 
diff --git a/drivers/gpu/drm/i915/i915_gem_userdata.c b/drivers/gpu/drm/i915/i915_gem_userdata.c
index 849df94..a403b13 100644
--- a/drivers/gpu/drm/i915/i915_gem_userdata.c
+++ b/drivers/gpu/drm/i915/i915_gem_userdata.c
@@ -139,7 +139,15 @@ i915_gem_userdata(struct drm_device *dev,
 		set = 1;
 	case I915_USERDATA_GET_OP:
 		if (!userdata_blk) {
-			DRM_ERROR("Can't set/get: userdata not created\n");
+			if (set)
+				DRM_ERROR("Can't set: userdata not created\n");
+			else
+				/*
+				 * Not necessarily an error if client is using
+				 * GET to determine if userdata has been
+				 * created.
+				*/
+				DRM_DEBUG("Can't get: userdata not created\n");
 			goto unref;
 		}
 
-- 
1.7.5.4

