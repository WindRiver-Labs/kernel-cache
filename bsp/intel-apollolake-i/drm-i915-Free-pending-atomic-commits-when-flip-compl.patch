From 349f84fbf187da1cce600d4cea4966b966759f46 Mon Sep 17 00:00:00 2001
From: Matt Roper <matthew.d.roper@intel.com>
Date: Mon, 16 May 2016 16:16:50 -0700
Subject: [PATCH 1440/2508] drm/i915: Free pending atomic commits when flip
 completes

commit 67dce9d8e843f84a3858351dd3b7d95c1d4c92f1 from
https://github.com/01org/linux-apollolake-i

The structure we use to tracking outstanding non-blocking work needs to
be freed when the flip completes.

KW: 1114939
Signed-off-by: Matt Roper <matthew.d.roper@intel.com>
Reviewed-by: Bob Paauwe <bob.j.paauwe@intel.com>
---
 drivers/gpu/drm/i915/intel_display.c |    1 +
 1 files changed, 1 insertions(+), 0 deletions(-)

diff --git a/drivers/gpu/drm/i915/intel_display.c b/drivers/gpu/drm/i915/intel_display.c
index 39da9ff..ec76ff5 100644
--- a/drivers/gpu/drm/i915/intel_display.c
+++ b/drivers/gpu/drm/i915/intel_display.c
@@ -13835,6 +13835,7 @@ static void finish_atomic_commit(struct work_struct *work)
 
 	/* Unblock other commits against these CRTC's */
 	flip_completion(commit);
+	kfree(commit);
 
 	drm_atomic_state_free(state);
 
-- 
1.7.5.4

