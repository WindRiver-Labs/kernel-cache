From d2b66746bb608c528c9aa4b9236fc3bfde6fedf5 Mon Sep 17 00:00:00 2001
From: "Pawse, GuruprasadX" <guruprasadx.pawse@intel.com>
Date: Wed, 10 Aug 2016 11:55:58 +0530
Subject: [PATCH 4700/4706] ASoC: Intel: Skylake: Avoid skl_sst context check
 in dsp suspend/resume

commit 99a9a5d4f37add3b66f2b7ded9c8e5f3d88d425f from
git://git.yoctoproject.org/linux-yocto-4.1

skl_sst context is guaranteed to be allocated by the time dsp suspend or
resume is called. Hence avoid checking this pointer for null.

Change-Id: I9ab2b05ebb751184eab5d7054ded6e258d27bb64
Signed-off-by: Pawse, GuruprasadX <guruprasadx.pawse@intel.com>
Reviewed-on: https://git-gar-1.devtools.intel.com/gerrit/10838
Reviewed-by: B, Jayachandran <jayachandran.b@intel.com>
Reviewed-by: Kale, Sanyog R <sanyog.r.kale@intel.com>
Reviewed-by: Babu, Ramesh <ramesh.babu@intel.com>
Tested-by: Jayanti, Satya Charitardha <satya.charitardha.jayanti@intel.com>
---
 sound/soc/intel/skylake/skl-messages.c |   26 ++++++++++++--------------
 1 files changed, 12 insertions(+), 14 deletions(-)

diff --git a/sound/soc/intel/skylake/skl-messages.c b/sound/soc/intel/skylake/skl-messages.c
index 8f079a5..e72f7e1 100644
--- a/sound/soc/intel/skylake/skl-messages.c
+++ b/sound/soc/intel/skylake/skl-messages.c
@@ -352,7 +352,7 @@ int skl_suspend_dsp(struct skl *skl)
 	if (ctx->is_first_boot == true)
 		goto disable_ppcap;
 
-	if (ctx && ctx->fw_loaded) {
+	if (ctx->fw_loaded) {
 		ret = skl_dsp_sleep(ctx->dsp);
 		if (ret < 0)
 			return ret;
@@ -383,19 +383,17 @@ int skl_resume_dsp(struct skl *skl)
 	if (ctx->is_first_boot == true)
 		return 0;
 
-	if (ctx) {
-		ret = skl_dsp_wake(ctx->dsp);
-		if (ret < 0)
-			return ret;
-		/*
-		 * It is correct for skl_dsp_wake() to return success without
-		 * loading the FW if it gets called before first boot, say
-		 * because of runtime PM resume. In this case, call the
-		 * notification enable function only if FW is loaded since
-		 * this function sends an IPC */
-		if (ctx->fw_loaded)
-			skl_dsp_enable_notification(skl->skl_sst, false);
-	}
+	ret = skl_dsp_wake(ctx->dsp);
+	if (ret < 0)
+		return ret;
+	/*
+	 * It is correct for skl_dsp_wake() to return success without
+	 * loading the FW if it gets called before first boot, say
+	 * because of runtime PM resume. In this case, call the
+	 * notification enable function only if FW is loaded since
+	 * this function sends an IPC */
+	if (ctx->fw_loaded)
+		skl_dsp_enable_notification(skl->skl_sst, false);
 
 	return ret;
 }
-- 
1.7.5.4

