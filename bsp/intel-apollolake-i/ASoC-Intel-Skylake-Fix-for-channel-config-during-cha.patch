From 7d4430d2c4974a3b5b61db5d46a7a1c3260245ab Mon Sep 17 00:00:00 2001
From: Senthilnathan Veppur <senthilnathanx.veppur@intel.com>
Date: Tue, 10 Nov 2015 14:30:01 +0530
Subject: [PATCH 1805/2508] ASoC: Intel: Skylake: Fix for channel config
 during channel fixup

commit 36684b63884b49fbc3a9b4cfd12f3d0e88d16df4 from
https://github.com/01org/linux-apollolake-i

As there is no fixup available for channel config, based on number of
channels passed during channel fixup, channel config is set.This fix
sets a MONO config for one channel and STEREO config for two channels.

Change-Id: I5284219cf282a73223aca27ffae89afc91049fa4
Signed-off-by: Senthilnathan Veppur <senthilnathanx.veppur@intel.com>
Reviewed-on: https://git-gar-1.devtools.intel.com/gerrit/7565
Reviewed-by: Babu, Ramesh <ramesh.babu@intel.com>
Tested-by: Babu, Ramesh <ramesh.babu@intel.com>
[Kevin: Just some minor context mods in order to port to wrlinux]
Signed-off-by: Kevin Hao <kexin.hao@windriver.com>
---
 sound/soc/intel/skylake/skl-topology.c |    7 ++++++-
 1 files changed, 6 insertions(+), 1 deletions(-)

diff --git a/sound/soc/intel/skylake/skl-topology.c b/sound/soc/intel/skylake/skl-topology.c
index b9ee129..12bdce1 100644
--- a/sound/soc/intel/skylake/skl-topology.c
+++ b/sound/soc/intel/skylake/skl-topology.c
@@ -145,8 +145,13 @@ static void skl_tplg_update_params(struct skl_module_fmt *fmt,
 {
 	if (fixup & SKL_RATE_FIXUP_MASK)
 		fmt->s_freq = params->s_freq;
-	if (fixup & SKL_CH_FIXUP_MASK)
+	if (fixup & SKL_CH_FIXUP_MASK) {
 		fmt->channels = params->ch;
+		if(fmt->channels == 1)
+			fmt->ch_cfg = SKL_CH_CFG_MONO;
+		if(fmt->channels == 2)
+			fmt->ch_cfg = SKL_CH_CFG_STEREO;
+	}
 	if (fixup & SKL_FMT_FIXUP_MASK) {
 		fmt->valid_bit_depth = skl_get_bit_depth(params->s_fmt);
 
-- 
1.7.5.4

