From c35814ae832cda6ac499fc84b9c607c23450716b Mon Sep 17 00:00:00 2001
From: Pramod Kumar Yadav <pramodx.k.yadav@intel.com>
Date: Fri, 3 Jun 2016 14:18:26 +0530
Subject: [PATCH 1991/2508] ASoC: Intel: Skylake: get dma buf size for modules

commit a5b04234cbd8849664c2f3a91811dce91b0bd9d1 from
https://github.com/01org/linux-apollolake-i

DMA buffer size for a module is now can be fetched
from topology binary. This buffer size is applicable
for  gateway copier modules.

Change-Id: I57847071a1732cc9ff866a39594618ac7e0b5cf0
Signed-off-by: Pramod Kumar Yadav <pramodx.k.yadav@intel.com>
Signed-off-by: Ramesh Babu <ramesh.babu@intel.com>
Reviewed-on: https://git-gar-1.devtools.intel.com/gerrit/9502
---
 sound/soc/intel/skylake/skl-topology.c       |    1 +
 sound/soc/intel/skylake/skl-topology.h       |    1 +
 sound/soc/intel/skylake/skl-tplg-interface.h |    1 +
 3 files changed, 3 insertions(+), 0 deletions(-)

diff --git a/sound/soc/intel/skylake/skl-topology.c b/sound/soc/intel/skylake/skl-topology.c
index 5ae1049..f652eb2 100644
--- a/sound/soc/intel/skylake/skl-topology.c
+++ b/sound/soc/intel/skylake/skl-topology.c
@@ -2012,6 +2012,7 @@ static int skl_tplg_widget_load(struct snd_soc_component *cmpnt,
 	mconfig->fast_mode = dfw_config->fast_mode;
 	mconfig->in_frame_size = dfw_config->in_frame_size;
 	mconfig->out_frame_size = dfw_config->out_frame_size;
+	mconfig->dma_buffer_size = dfw_config->dma_buffer_size;
 
 	pipe = skl_tplg_add_pipe(bus->dev, skl, &dfw_config->pipe);
 	if (pipe)
diff --git a/sound/soc/intel/skylake/skl-topology.h b/sound/soc/intel/skylake/skl-topology.h
index 39a333c..ca9fb16 100644
--- a/sound/soc/intel/skylake/skl-topology.h
+++ b/sound/soc/intel/skylake/skl-topology.h
@@ -321,6 +321,7 @@ struct skl_module_cfg {
 	u32 vbus_id;
 	u32 mem_pages;
 	u32 fast_mode;
+	u32 dma_buffer_size; /* in milli seconds */
 	u32 in_frame_size;
 	u32 out_frame_size;
 	struct skl_module_pin *m_in_pin;
diff --git a/sound/soc/intel/skylake/skl-tplg-interface.h b/sound/soc/intel/skylake/skl-tplg-interface.h
index cf8a315..dc2e66f 100644
--- a/sound/soc/intel/skylake/skl-tplg-interface.h
+++ b/sound/soc/intel/skylake/skl-tplg-interface.h
@@ -210,6 +210,7 @@ struct skl_dfw_module {
 	u32 obs;
 	u32 ibs;
 	u32 vbus_id;
+	u32 dma_buffer_size; /* in milli sec */
 
 	u32 max_in_queue:8;
 	u32 max_out_queue:8;
-- 
1.7.5.4

