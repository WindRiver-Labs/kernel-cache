From 4598c33507c6b0d75f7c7e10086e8e5c698361e7 Mon Sep 17 00:00:00 2001
From: Senthilnathan Veppur <senthilnathanx.veppur@intel.com>
Date: Mon, 21 Mar 2016 18:21:29 +0530
Subject: [PATCH 1915/2508] ASoC: Intel: Skylake: Fix memory leak issue

commit c019514942d16396038178b4f22ec793ecc474e2 from
https://github.com/01org/linux-apollolake-i

Release memory before exiting the function
from an error condition.

Change-Id: I52acfd1c61c45dd613addb83d20892a8af39c967
Signed-off-by: Senthilnathan Veppur <senthilnathanx.veppur@intel.com>
---
 sound/soc/intel/skylake/skl.c |    4 ++++
 1 files changed, 4 insertions(+), 0 deletions(-)

diff --git a/sound/soc/intel/skylake/skl.c b/sound/soc/intel/skylake/skl.c
index 2f826a5..0816742 100644
--- a/sound/soc/intel/skylake/skl.c
+++ b/sound/soc/intel/skylake/skl.c
@@ -391,6 +391,8 @@ cnl_continue:
 	pdev = platform_device_alloc(mach->machine, -1);
 	if (pdev == NULL) {
 		dev_err(bus->dev, "platform device alloc failed\n");
+		if (machine)
+			kfree(mach);
 		return -EIO;
 	}
 
@@ -398,6 +400,8 @@ cnl_continue:
 	if (ret) {
 		dev_err(bus->dev, "failed to add machine device\n");
 		platform_device_put(pdev);
+		if (machine)
+			kfree(mach);
 		return -EIO;
 	}
 	skl->i2s_dev = pdev;
-- 
1.7.5.4

