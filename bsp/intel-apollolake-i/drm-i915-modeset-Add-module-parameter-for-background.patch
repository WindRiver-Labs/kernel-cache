From f8a253686a26d9341007d369769049d743d14edc Mon Sep 17 00:00:00 2001
From: Bob Paauwe <bob.j.paauwe@intel.com>
Date: Fri, 22 Apr 2016 16:43:23 -0700
Subject: [PATCH 1426/2508] drm/i915/modeset: Add module parameter for
 background color. (v4)

commit c2ff3c31b678cb6fbe7471dd2a8343515aa4d8d8 from
https://github.com/01org/linux-apollolake-i

v2: improve description of bg_color module parameter (Matt)
v3: use unsigned int for parameter type as we only need 32 bits (James)
v4: change description to state xrgb and little endian (Matt)

Signed-off-by: Bob Paauwe <bob.j.paauwe@intel.com>
Reviewed-by: Matt Roper <matthew.d.roper@intel.com>
Signed-off-by: Matt Roper <matthew.d.roper@intel.com>
---
 drivers/gpu/drm/i915/intel_initial_modeset.c |   15 +++++++++++++--
 1 files changed, 13 insertions(+), 2 deletions(-)

diff --git a/drivers/gpu/drm/i915/intel_initial_modeset.c b/drivers/gpu/drm/i915/intel_initial_modeset.c
index 27a201c..c490e76 100644
--- a/drivers/gpu/drm/i915/intel_initial_modeset.c
+++ b/drivers/gpu/drm/i915/intel_initial_modeset.c
@@ -41,6 +41,12 @@
 #include "intel_drv.h"
 #include "i915_drv.h"
 
+static unsigned int bg_color = 0x00000000;
+
+module_param_named(bg_color, bg_color, uint, 0400);
+MODULE_PARM_DESC(bg_color, "Set the background (canvas) color while "
+		 "doing initial mode set. In XRGB8888 little endian format.");
+
 /*
  * This makes use of the video= kernel command line to determine what
  * connectors to configure. See Documentation/fb/modedb.txt for details
@@ -183,8 +189,13 @@ static int update_crtc_state(struct drm_atomic_state *state,
 	if (!IS_GEN9(state->dev))
 	    return 0;
 
-	/* Set the background color */
-	bgcolor = drm_rgba(16, 0, 0, 0, 0xffff);
+	/* Set the background color based on module parameter */
+	bgcolor =drm_rgba(8,
+			  (bg_color & 0x000000ff),
+			  (bg_color & 0x0000ff00) >> 8,
+			  (bg_color & 0x00ff0000) >> 16,
+			  (bg_color & 0xff000000) >> 24);
+
 	ret = drm_atomic_crtc_set_property(crtc, crtc_state,
 					   state->dev->mode_config.prop_background_color,
 					   bgcolor.v);
-- 
1.7.5.4

