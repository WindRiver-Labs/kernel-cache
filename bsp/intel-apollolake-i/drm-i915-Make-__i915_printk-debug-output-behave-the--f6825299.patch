From 9ebb1c64021451c395d62e0063a41c08d1318e11 Mon Sep 17 00:00:00 2001
From: Imre Deak <imre.deak@intel.com>
Date: Mon, 21 Mar 2016 17:08:57 +0200
Subject: [PATCH 2635/4706] drm/i915: Make __i915_printk debug output behave
 the same as DRM_DEBUG_DRIVER

commit ad45d83968caf8e757cf895f4fd53903a092fad8 upstream

Joonas and Daniel remarked that our debugging output should stay compatible
with the core DRM's debug facility. The recently added __i915_printk() would
output debug messages even if debugging is completely disabled via the
drm.debug option. To fix this make __i915_printk behave the same as
DRM_DEBUG_DRIVER in this case.

CC: Joonas Lahtinen <joonas.lahtinen@linux.intel.com>
CC: Daniel Vetter <daniel.vetter@ffwll.ch>
CC: Chris Wilson <chris@chris-wilson.co.uk>
Signed-off-by: Imre Deak <imre.deak@intel.com>
Reviewed-by: Chris Wilson <chris@chris-wilson.co.uk>
Link: http://patchwork.freedesktop.org/patch/msgid/1458572937-21712-1-git-send-email-imre.deak@intel.com
---
 drivers/gpu/drm/i915/i915_dma.c |    4 ++++
 1 files changed, 4 insertions(+), 0 deletions(-)

diff --git a/drivers/gpu/drm/i915/i915_dma.c b/drivers/gpu/drm/i915/i915_dma.c
index 3f439a0..a3458fc 100644
--- a/drivers/gpu/drm/i915/i915_dma.c
+++ b/drivers/gpu/drm/i915/i915_dma.c
@@ -77,9 +77,13 @@ __i915_printk(struct drm_i915_private *dev_priv, const char *level,
 	static bool shown_bug_once;
 	struct device *dev = dev_priv->dev->dev;
 	bool is_error = level[1] <= KERN_ERR[1];
+	bool is_debug = level[1] == KERN_DEBUG[1];
 	struct va_format vaf;
 	va_list args;
 
+	if (is_debug && !(drm_debug & DRM_UT_DRIVER))
+		return;
+
 	va_start(args, fmt);
 
 	vaf.fmt = fmt;
-- 
1.7.5.4

