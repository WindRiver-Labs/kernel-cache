From c74309ee79428e824dfef09ffa683006f695b54a Mon Sep 17 00:00:00 2001
From: Matt Roper <matthew.d.roper@intel.com>
Date: Mon, 16 May 2016 16:27:08 -0700
Subject: [PATCH 4428/4706] drm/i915: If allocation of splash_info fails,
 don't deref on cleanup

commit 3e790da246fd35d82c895b936204ff8e94adbcb1 from
git://git.yoctoproject.org/linux-yocto-4.1

KW: 1114945
Signed-off-by: Matt Roper <matthew.d.roper@intel.com>
Reviewed-by: Bob Paauwe <bob.j.paauwe@intel.com>
---
 drivers/gpu/drm/i915/intel_initial_modeset.c |    8 +++++---
 1 files changed, 5 insertions(+), 3 deletions(-)

diff --git a/drivers/gpu/drm/i915/intel_initial_modeset.c b/drivers/gpu/drm/i915/intel_initial_modeset.c
index 968ec1f9..21886fa 100644
--- a/drivers/gpu/drm/i915/intel_initial_modeset.c
+++ b/drivers/gpu/drm/i915/intel_initial_modeset.c
@@ -282,9 +282,11 @@ static void intel_splash_screen_init(struct drm_device *dev)
 
 fail:
 	/* Clean up failed entry data */
-	release_firmware(splash_info->fw);
-	kfree(splash_info->connector_name);
-	kfree(splash_info->image_name);
+	if (splash_info) {
+		release_firmware(splash_info->fw);
+		kfree(splash_info->connector_name);
+		kfree(splash_info->image_name);
+	}
 	kfree(splash_info);
 	kfree(splash_dup);
 	return;
-- 
1.7.5.4

