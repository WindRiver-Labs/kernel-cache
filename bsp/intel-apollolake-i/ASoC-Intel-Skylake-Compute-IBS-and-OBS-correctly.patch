From fbef3e5c6ba1dbbc67498d0497ad29f2973a3f16 Mon Sep 17 00:00:00 2001
From: Pardha Saradhi K <pardha.saradhi.kesapragada@intel.com>
Date: Mon, 7 Dec 2015 12:18:05 +0530
Subject: [PATCH 1813/2508] ASoC: Intel: Skylake: Compute IBS and OBS
 correctly

commit d487fa20ac0089477adf5bff09a8cb533f180eae from
https://github.com/01org/linux-apollolake-i

For fractional rates, it is recommended to round the IBS/OBS
to the next integer. For example, for 1ms of 44100Hz stream,
the buffer size should be 45, instead of 44

Change-Id: I068538b6008028824c09923775683a37d8832ab5
Signed-off-by: Pardha Saradhi K <pardha.saradhi.kesapragada@intel.com>
Reviewed-on: https://git-gar-1.devtools.intel.com/gerrit/7839
Reviewed-by: Babu, Ramesh <ramesh.babu@intel.com>
Tested-by: Babu, Ramesh <ramesh.babu@intel.com>
---
 sound/soc/intel/skylake/skl-topology.c |    5 +++--
 1 files changed, 3 insertions(+), 2 deletions(-)

diff --git a/sound/soc/intel/skylake/skl-topology.c b/sound/soc/intel/skylake/skl-topology.c
index 66144b7..757f07e 100644
--- a/sound/soc/intel/skylake/skl-topology.c
+++ b/sound/soc/intel/skylake/skl-topology.c
@@ -1006,12 +1006,13 @@ int skl_tplg_update_pipe_params(struct device *dev,
 		return -EINVAL;
 	}
 
+	/* take care of fractional rates, round to next integer */
 	if (params->stream == SNDRV_PCM_STREAM_PLAYBACK) {
-		mconfig->ibs = (format->s_freq / 1000) *
+		mconfig->ibs = ((format->s_freq + 999) / 1000) *
 				(format->channels) *
 				(format->bit_depth >> 3);
 	} else {
-		mconfig->obs = (format->s_freq / 1000) *
+		mconfig->obs = ((format->s_freq + 999) / 1000) *
 				(format->channels) *
 				(format->bit_depth >> 3);
 	}
-- 
1.7.5.4

