From a59f6645c4012eb42e2a5e81859c69f4268325da Mon Sep 17 00:00:00 2001
From: Robert Beckett <robert.beckett@intel.com>
Date: Fri, 11 Mar 2016 13:04:12 -0800
Subject: [PATCH 1384/2508] drm/i915/bxt: WaDisablePooledEuLoadBalancingFix

commit 1674163609e8ad34b63d026b6ef127791f7ebc1f from
https://github.com/01org/linux-apollolake-i

Implement WaDisablePooledEuLoadBalancingFix

Tracked-On:
For: GMINL-10254
Change-Id: I0c7ec878db3e7b2d80c2fa617ac10db94bab2bd4
Signed-off-by: Robert Beckett <robert.beckett@intel.com>
Signed-off-by: Jeff McGee <jeff.mcgee@intel.com>
Signed-off-by: Matt Roper <matthew.d.roper@intel.com>
---
 drivers/gpu/drm/i915/i915_reg.h         |    1 +
 drivers/gpu/drm/i915/intel_ringbuffer.c |    4 ++++
 2 files changed, 5 insertions(+), 0 deletions(-)

diff --git a/drivers/gpu/drm/i915/i915_reg.h b/drivers/gpu/drm/i915/i915_reg.h
index d7e9105..5d38f52 100644
--- a/drivers/gpu/drm/i915/i915_reg.h
+++ b/drivers/gpu/drm/i915/i915_reg.h
@@ -6068,6 +6068,7 @@ enum skl_disp_power_wells {
 #define   GEN9_FFSC_PERCTX_PREEMPT_CTRL	(1<<14)
 
 #define FF_SLICE_CS_CHICKEN2			_MMIO(0x20e4)
+#define  GEN9_POOLED_EU_LOAD_BALANCE_FIX_DISABLE (1<<10)
 #define  GEN9_TSG_BARRIER_ACK_DISABLE		(1<<8)
 
 #define GEN9_CS_DEBUG_MODE1		_MMIO(0x20ec)
diff --git a/drivers/gpu/drm/i915/intel_ringbuffer.c b/drivers/gpu/drm/i915/intel_ringbuffer.c
index f6c1b0c..a0d932e 100644
--- a/drivers/gpu/drm/i915/intel_ringbuffer.c
+++ b/drivers/gpu/drm/i915/intel_ringbuffer.c
@@ -1192,6 +1192,10 @@ static int bxt_init_workarounds(struct intel_engine_cs *engine)
 	if (IS_BXT_REVID(dev, BXT_REVID_B0, REVID_FOREVER))
 		I915_WRITE(GEN8_L3SQCREG1, BXT_WA_L3SQCREG1_DEFAULT);
 
+	/* WaDisablePooledEuLoadBalancingFix:bxt */
+	WA_SET_BIT_MASKED(FF_SLICE_CS_CHICKEN2,
+			  GEN9_POOLED_EU_LOAD_BALANCE_FIX_DISABLE);
+
 	return 0;
 }
 
-- 
1.7.5.4

