From 06d3fd766059daeecdb0edbc93916c40c6747abc Mon Sep 17 00:00:00 2001
From: "Pawse, GuruprasadX" <guruprasadx.pawse@intel.com>
Date: Thu, 30 Jun 2016 11:00:49 +0530
Subject: [PATCH 2057/2508] ASoC: Intel: Skylake: Fix incorrect caching of
 injector params

commit 970856e8d77ded7231dda86427389a4e701c3923 from
https://github.com/01org/linux-apollolake-i

If userspace sets an Injector control, then the driver was caching
connection_type param under extractor_data instead of caching under
injector_data.

This patch ensures that the injector param is cached under injector_data.

Change-Id: Ieb50bc3b2c1f98fcece091df26f6d4090966e258
Signed-off-by: Pawse, GuruprasadX <guruprasadx.pawse@intel.com>
Reviewed-on: https://git-gar-1.devtools.intel.com/gerrit/9941
Reviewed-by: B, Jayachandran <jayachandran.b@intel.com>
Reviewed-by: Babu, Ramesh <ramesh.babu@intel.com>
Tested-by: Jayanti, Satya Charitardha <satya.charitardha.jayanti@intel.com>
---
 sound/soc/intel/skylake/skl-topology.c |   10 ++++++----
 1 files changed, 6 insertions(+), 4 deletions(-)

diff --git a/sound/soc/intel/skylake/skl-topology.c b/sound/soc/intel/skylake/skl-topology.c
index 8b64f6b..f621876 100644
--- a/sound/soc/intel/skylake/skl-topology.c
+++ b/sound/soc/intel/skylake/skl-topology.c
@@ -698,8 +698,10 @@ int skl_tplg_set_probe_params(struct snd_soc_dapm_widget *w,
 				}
 			}
 		}
-		ret = skl_set_module_params(ctx, (void *)prb_pt_param, n * sizeof(struct probe_pt_param),
-					SKL_PROBE_CONNECT, mconfig);
+
+		if (n > 0)
+			ret = skl_set_module_params(ctx, (void *)prb_pt_param, n * sizeof(struct probe_pt_param),
+						SKL_PROBE_CONNECT, mconfig);
 
 	}
 	return ret;
@@ -1662,9 +1664,9 @@ static int skl_cache_probe_param(struct snd_kcontrol *kctl,
 		node_id.node.vindex = pconfig->iprobe[index].dma_id;
 		memcpy(&ap->node_id, &node_id, sizeof(u32));
 		if (ap->is_connect == SKL_PROBE_CONNECT)
-			pconfig->eprobe[index].set = 1;
+			pconfig->iprobe[index].set = 1;
 		else if (ap->is_connect == SKL_PROBE_DISCONNECT)
-			pconfig->eprobe[index].set = -1;
+			pconfig->iprobe[index].set = -1;
 	}
 	return 0;
 }
-- 
1.7.5.4

