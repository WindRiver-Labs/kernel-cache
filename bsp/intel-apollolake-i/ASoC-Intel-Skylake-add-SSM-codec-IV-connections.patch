From 76f70e8f345245cf2ff5563bee650a409a0ce240 Mon Sep 17 00:00:00 2001
From: Omair M Abdullah <omair.m.abdullah@intel.com>
Date: Fri, 11 Sep 2015 16:44:58 +0530
Subject: [PATCH 1719/2508] ASoC: Intel: Skylake: add SSM codec IV connections

commit 363bc30bfa7654042acb1e703507416d010e409a from
https://github.com/01org/linux-apollolake-i

Signed-off-by: Omair M Abdullah <omair.m.abdullah@intel.com>

Conflicts:

	sound/soc/intel/boards/skl_nau88l25_ssm4567.c
---
 sound/soc/intel/boards/skl_nau88l25_ssm4567.c |   24 ++++++++++++++++++++++++
 1 files changed, 24 insertions(+), 0 deletions(-)

diff --git a/sound/soc/intel/boards/skl_nau88l25_ssm4567.c b/sound/soc/intel/boards/skl_nau88l25_ssm4567.c
index 15ecd33..325b3aa 100644
--- a/sound/soc/intel/boards/skl_nau88l25_ssm4567.c
+++ b/sound/soc/intel/boards/skl_nau88l25_ssm4567.c
@@ -93,6 +93,10 @@ static const struct snd_soc_dapm_route skylake_map[] = {
 	{ "Left Playback", NULL, "ssp0 Tx"},
 	{ "Right Playback", NULL, "ssp0 Tx"},
 	{ "ssp0 Tx", NULL, "codec0_out"},
+	/* IV feedback path */
+	{ "codec0_lp_in", NULL, "ssp0 Rx"},
+	{ "ssp0 Rx", NULL, "Left Capture"},
+	{ "ssp0 Rx", NULL, "Right Capture"},
 
 	{ "AIF1 Playback", NULL, "ssp1 Tx"},
 	{ "ssp1 Tx", NULL, "codec1_out"},
@@ -205,6 +209,14 @@ static struct snd_soc_ops skylake_nau8825_ops = {
 	.hw_params = skylake_nau8825_hw_params,
 };
 
+static const struct snd_soc_pcm_stream skl_ssm4567_loop_params = {
+	.formats = SNDRV_PCM_FMTBIT_S24_LE,
+	.rate_min = 48000,
+	.rate_max = 48000,
+	.channels_min = 4,
+	.channels_max = 4,
+};
+
 /* skylake digital audio interface glue - connects codec <--> CPU */
 static struct snd_soc_dai_link skylake_dais[] = {
 	/* Front End DAI links */
@@ -247,6 +259,17 @@ static struct snd_soc_dai_link skylake_dais[] = {
 		.nonatomic = 1,
 		.dynamic = 1,
 	},
+	/* Codec-codec link */
+	{
+		.name = "Skylake IV loop",
+		.stream_name = "SKL IV Loop",
+		.cpu_dai_name = "SSP0 Pin",
+		.platform_name = "0000:00:1f.3",
+		.codecs = ssm4567_codec_components,
+		.num_codecs = ARRAY_SIZE(ssm4567_codec_components),
+		.params = &skl_ssm4567_loop_params,
+		.dsp_loopback = true,
+	},
 	/* Back End DAI links */
 	{
 		/* SSP0 - Codec */
@@ -313,6 +336,7 @@ static struct snd_soc_card skylake_audio_card = {
 	.codec_conf = ssm4567_codec_conf,
 	.num_configs = ARRAY_SIZE(ssm4567_codec_conf),
 	.controls = skylake_controls,
+	.fully_routed = false,
 };
 
 
-- 
1.7.5.4

