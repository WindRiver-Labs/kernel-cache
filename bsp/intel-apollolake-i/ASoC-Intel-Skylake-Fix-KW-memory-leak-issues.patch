From 00e7a55438552482ab1fc4fc3d4286e63694eef3 Mon Sep 17 00:00:00 2001
From: Senthilnathan Veppur <senthilnathanx.veppur@intel.com>
Date: Wed, 23 Mar 2016 16:13:43 +0530
Subject: [PATCH 1921/2508] ASoC: Intel: Skylake: Fix KW memory leak issues

commit 54fff3eb0159b25a3afd936340dd9780cf631970 from
https://github.com/01org/linux-apollolake-i

Change-Id: I358ca30313a90a27b7783f9237dda37c3cafe6d4
Signed-off-by: Senthilnathan Veppur <senthilnathanx.veppur@intel.com>
---
 sound/soc/intel/skylake/skl.c |   14 ++++++++++----
 1 files changed, 10 insertions(+), 4 deletions(-)

diff --git a/sound/soc/intel/skylake/skl.c b/sound/soc/intel/skylake/skl.c
index 0816742..fc3542b 100644
--- a/sound/soc/intel/skylake/skl.c
+++ b/sound/soc/intel/skylake/skl.c
@@ -614,12 +614,16 @@ static int skl_first_init(struct hdac_ext_bus *ebus)
 	ebus->num_streams = cp_streams + pb_streams;
 
 	/* initialize streams */
-	snd_hdac_ext_stream_init_all
+	err = snd_hdac_ext_stream_init_all
 		(ebus, 0, cp_streams, SNDRV_PCM_STREAM_CAPTURE);
+	if (err < 0)
+		return err;
+
 	start_idx = cp_streams;
-	snd_hdac_ext_stream_init_all
+	err = snd_hdac_ext_stream_init_all
 		(ebus, start_idx, pb_streams, SNDRV_PCM_STREAM_PLAYBACK);
-
+	if (err < 0)
+		return err;
 	err = snd_hdac_bus_alloc_stream_pages(bus);
 	if (err < 0)
 		return err;
@@ -681,7 +685,9 @@ static int skl_probe(struct pci_dev *pci,
 
 	}
 	if (ebus->mlcap)
-		snd_hdac_ext_bus_get_ml_capabilities(ebus);
+		err = snd_hdac_ext_bus_get_ml_capabilities(ebus);
+		if (err < 0)
+			goto out_mach_free;
 
 	/* create device for soc dmic */
 	err = skl_dmic_device_register(skl);
-- 
1.7.5.4

