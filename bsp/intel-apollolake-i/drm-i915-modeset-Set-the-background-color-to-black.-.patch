From 84d005820c4c8b7794f987f16256e23e31fbcb27 Mon Sep 17 00:00:00 2001
From: Bob Paauwe <bob.j.paauwe@intel.com>
Date: Fri, 22 Apr 2016 16:43:22 -0700
Subject: [PATCH 1425/2508] drm/i915/modeset: Set the background color to
 black. (v2)

commit a5c289d69ca36c9d65dc7b00ed0c64f8a542983d from
https://github.com/01org/linux-apollolake-i

v2: use state->dev instead of passing in dev (Matt)
    only try and set property on gen9+ (Matt)

Signed-off-by: Bob Paauwe <bob.j.paauwe@intel.com>
Reviewed-by: James Xiong <james.xiong@intel.com>
Reviewed-by: Matt Roper <matthew.d.roper@intel.com>
Signed-off-by: Matt Roper <matthew.d.roper@intel.com>
---
 drivers/gpu/drm/i915/intel_initial_modeset.c |   12 ++++++++++++
 1 files changed, 12 insertions(+), 0 deletions(-)

diff --git a/drivers/gpu/drm/i915/intel_initial_modeset.c b/drivers/gpu/drm/i915/intel_initial_modeset.c
index 534fc98..27a201c 100644
--- a/drivers/gpu/drm/i915/intel_initial_modeset.c
+++ b/drivers/gpu/drm/i915/intel_initial_modeset.c
@@ -165,6 +165,7 @@ static int update_crtc_state(struct drm_atomic_state *state,
 			     struct drm_crtc *crtc)
 {
 	struct drm_crtc_state *crtc_state;
+	struct drm_rgba bgcolor;
 	int ret;
 
 	crtc_state = drm_atomic_get_crtc_state(state, crtc);
@@ -178,6 +179,17 @@ static int update_crtc_state(struct drm_atomic_state *state,
 	}
 
 	crtc_state->active = true;
+
+	if (!IS_GEN9(state->dev))
+	    return 0;
+
+	/* Set the background color */
+	bgcolor = drm_rgba(16, 0, 0, 0, 0xffff);
+	ret = drm_atomic_crtc_set_property(crtc, crtc_state,
+					   state->dev->mode_config.prop_background_color,
+					   bgcolor.v);
+	WARN_ON(ret);
+
 	return 0;
 }
 
-- 
1.7.5.4

