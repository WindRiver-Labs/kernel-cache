From 5b41ff1049631e76944eb664c0baf4ea5cb7589d Mon Sep 17 00:00:00 2001
From: John Harrison <John.C.Harrison@Intel.com>
Date: Fri, 8 Apr 2016 13:44:05 -0700
Subject: [PATCH 1302/2508] drm/i915: Add total count to context status
 debugfs output

commit b5e90335c182fdd7c5dda00e43c8461e1f5eb4d3 from
https://github.com/01org/linux-apollolake-i

When there are lots and lots and even more lots of contexts (e.g. when
running with execlists) it is useful to be able to immediately see
what the total context count is.

v4: Re-typed a variable (review feedback from Joonas)

For: VIZ-1587
Signed-off-by: John Harrison <John.C.Harrison@Intel.com>
Reviewed-by: Joonas Lahtinen <joonas.lahtinen@linux.intel.com>
Signed-off-by: Jeff McGee <jeff.mcgee@intel.com>
Signed-off-by: Matt Roper <matthew.d.roper@intel.com>
---
 drivers/gpu/drm/i915/i915_debugfs.c |    5 ++++-
 1 files changed, 4 insertions(+), 1 deletions(-)

diff --git a/drivers/gpu/drm/i915/i915_debugfs.c b/drivers/gpu/drm/i915/i915_debugfs.c
index c39d5722..d7911a3 100644
--- a/drivers/gpu/drm/i915/i915_debugfs.c
+++ b/drivers/gpu/drm/i915/i915_debugfs.c
@@ -1950,7 +1950,7 @@ static int i915_context_status(struct seq_file *m, void *unused)
 	struct intel_engine_cs *engine;
 	struct intel_context *ctx;
 	enum intel_engine_id id;
-	int ret;
+	int ret, count = 0;
 
 	ret = mutex_lock_interruptible(&dev->struct_mutex);
 	if (ret)
@@ -1965,6 +1965,7 @@ static int i915_context_status(struct seq_file *m, void *unused)
 		describe_ctx(m, ctx);
 		if (ctx == dev_priv->kernel_context)
 			seq_printf(m, "(kernel context) ");
+		count++;
 
 		if (i915.enable_execlists) {
 			seq_putc(m, '\n');
@@ -1988,6 +1989,8 @@ static int i915_context_status(struct seq_file *m, void *unused)
 		seq_putc(m, '\n');
 	}
 
+	seq_printf(m, "Total: %d contexts\n", count);
+
 	mutex_unlock(&dev->struct_mutex);
 
 	return 0;
-- 
1.7.5.4

