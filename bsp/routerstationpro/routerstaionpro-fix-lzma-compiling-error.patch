From a0a1a0200e9a58a9ddb1640c329da0c35227fef3 Mon Sep 17 00:00:00 2001
From: Zumeng Chen <zumeng.chen@windriver.com>
Date: Sun, 9 Jan 2011 22:04:09 +0800
Subject: [PATCH 03/10] routerstaionpro: fix lzma compiling error

Signed-off-by: Zumeng Chen <zumeng.chen@windriver.com>
---
 fs/squashfs/Kconfig        |    1 +
 fs/squashfs/lzma_wrapper.c |    1 +
 lib/Kconfig                |    3 +++
 3 files changed, 5 insertions(+), 0 deletions(-)

diff --git a/fs/squashfs/Kconfig b/fs/squashfs/Kconfig
index 3131534..4b7398a 100644
--- a/fs/squashfs/Kconfig
+++ b/fs/squashfs/Kconfig
@@ -57,6 +57,7 @@ config SQUASHFS_LZMA
 	bool "Include support for LZMA compressed file systems"
 	depends on SQUASHFS
 	select DECOMPRESS_LZMA
+	select DECOMPRESS_LZMA_NEEDED
 
 config SQUASHFS_EMBEDDED
 	bool "Additional option for memory-constrained systems"
diff --git a/fs/squashfs/lzma_wrapper.c b/fs/squashfs/lzma_wrapper.c
index fd8467c..a903dd1 100644
--- a/fs/squashfs/lzma_wrapper.c
+++ b/fs/squashfs/lzma_wrapper.c
@@ -25,6 +25,7 @@
 #include <linux/buffer_head.h>
 #include <linux/mutex.h>
 #include <linux/vmalloc.h>
+#include <linux/slab.h>
 #include <linux/decompress/unlzma.h>
 
 #include "squashfs_fs.h"
diff --git a/lib/Kconfig b/lib/Kconfig
index fa9bf2c..fe63853 100644
--- a/lib/Kconfig
+++ b/lib/Kconfig
@@ -120,6 +120,9 @@ config DECOMPRESS_BZIP2
 config DECOMPRESS_LZMA
 	tristate
 
+config DECOMPRESS_LZMA_NEEDED
+	 boolean
+
 config DECOMPRESS_LZO
 	select LZO_DECOMPRESS
 	tristate
-- 
1.7.0.4

