From 3391c9d4c1dbe41fa7668e7762445c7ea976c37a Mon Sep 17 00:00:00 2001
From: tonyliu <Bo.Liu@windriver.com>
Date: Thu, 2 Apr 2009 17:58:13 +0800
Subject: [PATCH] imx31lite_board_entry-diff

Switch to sys platform device style according to common mxc nand driver
implementation.

Add device's dedicated resource declaration and platform parameter definition.

Signed-off-by: Tonyliu <Bo.Liu@windriver.com>
---
 arch/arm/mach-mx3/mx31lite.c |   25 +++++++++++++++++++++++--
 1 files changed, 23 insertions(+), 2 deletions(-)

diff --git a/arch/arm/mach-mx3/mx31lite.c b/arch/arm/mach-mx3/mx31lite.c
index 9abfb94..473eb1b 100644
--- a/arch/arm/mach-mx3/mx31lite.c
+++ b/arch/arm/mach-mx3/mx31lite.c
@@ -55,6 +55,7 @@
 #include <mach/imx-uart.h>
 #include <mach/iomux-mx3.h>
 #include <mach/spba.h>
+#include <mach/mxc_nand.h>
 
 #include "crm_regs.h"
 
@@ -196,12 +197,32 @@ static struct flash_platform_data mxc_nand_data = {
 	.width = 1,
 };
 
+static struct mxc_nand_platform_data mxc_nand_plat_data = {
+    .width = 1,
+	.hw_ecc = 1,
+	.flash_data = &mxc_nand_data,
+};
+
+static struct resource mxc_nand_resources[] = {
+    {
+		.start  = NFC_BASE_ADDR,
+		.end    = NFC_BASE_ADDR + SZ_4K - 1,
+		.flags  = IORESOURCE_MEM,
+	}, {
+		.start  = MXC_INT_NANDFC,
+		.end    = MXC_INT_NANDFC,
+		.flags  = IORESOURCE_IRQ,
+	},
+};
+
 static struct platform_device mxc_nand_mtd_device = {
-	.name = "mxc_nand_flash",
+	.name = "mxc_nand",
 	.id = 0,
 	.dev = {
-		.platform_data = &mxc_nand_data,
+		.platform_data = &mxc_nand_plat_data,
 	},
+	.num_resources = 2,
+	.resource = mxc_nand_resources,
 };
 
 static void mxc_init_nand_mtd(void)
-- 
1.5.5.1

