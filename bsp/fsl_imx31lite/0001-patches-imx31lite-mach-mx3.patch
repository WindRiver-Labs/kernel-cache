From a2ccce875635a79fc4c7a355ff43b6932c567d91 Mon Sep 17 00:00:00 2001
From: Kevin Hao <kexin.hao@windriver.com>
Date: Fri, 18 Apr 2008 16:23:08 +0800
Subject: [PATCH] patches-imx31lite/mach-mx3

Signed-off-by: Liming Wang <liming.wang@windriver.com>
---
 arch/arm/mach-mx3/Kconfig    |    7 +++
 arch/arm/mach-mx3/Makefile   |    1 +
 arch/arm/mach-mx3/mx31lite.c |   87 ++++++++++++++++++++++++++++++++++++++++++
 3 files changed, 95 insertions(+), 0 deletions(-)
 create mode 100644 arch/arm/mach-mx3/mx31lite.c

diff --git a/arch/arm/mach-mx3/Kconfig b/arch/arm/mach-mx3/Kconfig
index 8f19587..aa3ce91 100644
--- a/arch/arm/mach-mx3/Kconfig
+++ b/arch/arm/mach-mx3/Kconfig
@@ -8,6 +8,13 @@ config MACH_MX31ADS
 	  Include support for MX31ADS platform. This includes specific
 	  configurations for the board and its peripherals.
 
+config MACH_MX31LITE
+	bool "Support MX31LITE platforms"
+	default n
+	help
+	  Include support for MX31LITE platform. This includes specific
+	  configurations for the board and its peripherals.
+
 config MXC_SDMA_API
         bool "Use SDMA API"
         default y
diff --git a/arch/arm/mach-mx3/Makefile b/arch/arm/mach-mx3/Makefile
index f3f0d89..f5ed9c5 100644
--- a/arch/arm/mach-mx3/Makefile
+++ b/arch/arm/mach-mx3/Makefile
@@ -6,3 +6,4 @@
 
 obj-y			:= mm.o time.o dma.o clock.o mx31_gpio.o devices.o iomux.o serial.o
 obj-$(CONFIG_MACH_MX31ADS)	+= mx31ads.o
+obj-$(CONFIG_MACH_MX31LITE)	+= mx31lite.o
diff --git a/arch/arm/mach-mx3/mx31lite.c b/arch/arm/mach-mx3/mx31lite.c
new file mode 100644
index 0000000..93141aa
--- /dev/null
+++ b/arch/arm/mach-mx3/mx31lite.c
@@ -0,0 +1,87 @@
+/*
+ * This file contains the board specific initialization routines.
+ *
+ * Author: Vitaly Wool <source@embeddedalley.com>
+ *
+ * Copyright 2005-2006 Freescale Semiconductor, Inc.
+ * Copyright 2007-2008 WindRiver Solutions, Inc.
+ * Copyright 2007 Embedded Alley Solutions, Inc.
+ *
+ * This file is licensed under the terms of the GNU General Public License
+ * version 2.  This program  is licensed "as is" without any warranty of any
+ * kind, whether express or implied.
+ */
+
+#include <linux/types.h>
+#include <linux/sched.h>
+#include <linux/interrupt.h>
+#include <linux/init.h>
+#include <linux/input.h>
+#include <linux/delay.h>
+#include <linux/device.h>
+#include <linux/platform_device.h>
+#include <linux/nodemask.h>
+#include <linux/mtd/mtd.h>
+#include <linux/mtd/map.h>
+#include <linux/mtd/partitions.h>
+#include <linux/spi/spi.h>
+
+#include <asm/mach/flash.h>
+
+#include <asm/hardware.h>
+#include <asm/irq.h>
+#include <asm/setup.h>
+#include <asm/mach-types.h>
+#include <asm/mach/arch.h>
+#include <asm/mach/irq.h>
+#include <asm/arch/memory.h>
+#include <asm/arch-mxc/common.h>
+
+
+static struct resource smc911x_resources[] = {
+	[0] = {
+		.start	= CS4_BASE_ADDR,
+		.end	= CS4_BASE_ADDR + 0xffff,
+		.flags	= IORESOURCE_MEM,
+	},
+	[1] = {
+		.start	= MX31LITE_LAN_INT,
+		.end	= MX31LITE_LAN_INT,
+		.flags	= IORESOURCE_IRQ,
+	}
+};
+
+static struct platform_device smc911x_device = {
+	.name		= "smc911x",
+	.id		= 0,
+	.num_resources	= ARRAY_SIZE(smc911x_resources),
+	.resource	= smc911x_resources,
+};
+
+/*!
+ * Board specific initialization.
+ */
+void mx31lite_gpio_init(void);
+int mxc_gpio_init(void);
+
+static void __init mxc_board_init(void)
+{
+	mxc_gpio_init();
+	mx31lite_gpio_init();
+	platform_device_register(&smc911x_device);
+}
+
+/*
+ * The following uses standard kernel macros define in arch.h in order to
+ * initialize __mach_desc_MX31LITE data structure.
+ */
+/* *INDENT-OFF* */
+MACHINE_START(MX31LITE, "Freescale MX31LITE")
+	.phys_io        = AIPS1_BASE_ADDR,
+	.io_pg_offst    = ((AIPS1_BASE_ADDR_VIRT) >> 18) & 0xfffc,
+	.boot_params    = PHYS_OFFSET_ASM + 0x100,
+	.map_io         = mxc_map_io,
+	.init_irq       = mxc_init_irq,
+	.init_machine   = mxc_board_init,
+	.timer          = &mxc_timer,
+MACHINE_END
-- 
1.5.5.1

