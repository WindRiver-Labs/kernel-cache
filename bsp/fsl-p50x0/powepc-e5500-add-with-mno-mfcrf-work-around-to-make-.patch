From 4d2876cecd290e34d7067bc6519243692888ff06 Mon Sep 17 00:00:00 2001
From: Tiejun Chen <tiejun.chen@windriver.com>
Date: Fri, 13 Jul 2012 13:20:18 +0800
Subject: [PATCH] powepc/e5500: add with -mno-mfcrf work around to make e5500
 work

CC      init/do_mounts_rd.o
powerpc-wrs-linux-gnu-gcc: warning: -pipe ignored because -save-temps specified
do_mounts_rd.s: Assembler messages:
do_mounts_rd.s:908: Error: junk at end of line: `1'

.LBE168:
        .loc 1 173 0
        cmpdi 7,3,0      #, tmp373, tmp302
        mfcr 28,1        # tmp374, tmp373   /* the 908, junk at end of line '1' */

"mfcr 28,1" is not a valid instruction generated since mfcr take only one
argument like "mfcr RT".

So looks our current gcc is assuming -mmfcrf for e5500 which doesn't have
'mfcrf' actually. Here we have to add -mno-mfcrf as work around to make sure
gcc don't generate mfcr with two args.

{
This should be squashed into commit 1ee2a40fccae61073ba50232313ff3a98bf2b66b

    powerpc: update compilation flags to support e5500 instructions
}

Signed-off-by: Tiejun Chen <tiejun.chen@windriver.com>
---
 arch/powerpc/Makefile |    2 +-
 1 file changed, 1 insertion(+), 1 deletion(-)

diff --git a/arch/powerpc/Makefile b/arch/powerpc/Makefile
index 0292e98..311e6c0 100644
--- a/arch/powerpc/Makefile
+++ b/arch/powerpc/Makefile
@@ -133,7 +133,7 @@ endif
 cpu-as-$(CONFIG_4xx)		+= -Wa,-m405
 cpu-as-$(CONFIG_ALTIVEC)	+= -Wa,-maltivec
 cpu-as-$(CONFIG_E500)		+= -Wa,-me500
-cpu-as-$(CONFIG_WORKAROUND_E5500_MFCR) += -mcpu=e5500
+cpu-as-$(CONFIG_WORKAROUND_E5500_MFCR) += -mno-mfcrf
 cpu-as-$(CONFIG_E200)		+= -Wa,-me200
 
 KBUILD_AFLAGS += $(cpu-as-y)
-- 
1.7.9.7

