From 06bb435dbdf518f67e328dbb63fb152112b1bd06 Mon Sep 17 00:00:00 2001
From: Yongli He <yongli.he@windriver.com>
Date: Fri, 1 Apr 2011 15:10:01 +0800
Subject: [PATCH 1/4] powerpc: update compilation flags to support e5500
 instructions

ptrace.c compiled failed via GCC4.4a-329:

  CC      arch/powerpc/kernel/prtace.o
{standard input}: Assembler messages:
{standard input}:1522: Error: junk at end of line: `1'
{standard input}:1977: Error: junk at end of line: `1'

 AS can not assemble  the "mfcr"  instruction correctly,
need pass " -mcpu=e5500 " to AS.

Signed-off-by: Yongli He <yongli.he@windriver.com>
---
 arch/powerpc/Makefile               |    1 +
 arch/powerpc/platforms/85xx/Kconfig |    4 ++++
 2 files changed, 5 insertions(+), 0 deletions(-)

diff --git a/arch/powerpc/Makefile b/arch/powerpc/Makefile
index 89e25df..0292e98 100644
--- a/arch/powerpc/Makefile
+++ b/arch/powerpc/Makefile
@@ -133,6 +133,7 @@ endif
 cpu-as-$(CONFIG_4xx)		+= -Wa,-m405
 cpu-as-$(CONFIG_ALTIVEC)	+= -Wa,-maltivec
 cpu-as-$(CONFIG_E500)		+= -Wa,-me500
+cpu-as-$(CONFIG_WORKAROUND_E5500_MFCR) += -mcpu=e5500
 cpu-as-$(CONFIG_E200)		+= -Wa,-me200
 
 KBUILD_AFLAGS += $(cpu-as-y)
diff --git a/arch/powerpc/platforms/85xx/Kconfig b/arch/powerpc/platforms/85xx/Kconfig
index c22089b..98baf2e 100644
--- a/arch/powerpc/platforms/85xx/Kconfig
+++ b/arch/powerpc/platforms/85xx/Kconfig
@@ -274,9 +274,13 @@ config P5020_DS
 	select HAS_FSL_QBMAN
 	select HAS_FSL_PME
 	select FSL_HYDRA_DS_MDIO if PHYLIB
+	select WORKAROUND_E5500_MFCR
 	help
 	  This option enables support for the P5020 DS board
 
+config WORKAROUND_E5500_MFCR
+	bool
+
 endif # FSL_SOC_BOOKE
 
 config FSL_P4080_DS_MDIO
-- 
1.7.7

