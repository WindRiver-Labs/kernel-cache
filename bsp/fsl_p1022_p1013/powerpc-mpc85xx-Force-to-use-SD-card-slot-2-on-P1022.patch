From e157bcb8fdd15d33f6db11b49d7e4776aed2044c Mon Sep 17 00:00:00 2001
From: Yang Shi <yang.shi@windriver.com>
Date: Tue, 10 Aug 2010 13:33:10 +0800
Subject: [PATCH 10/14] powerpc: mpc85xx: Force to use SD card slot #2 on P1022DS board

SD card slot #1 is enabled by default, but it's at the bottom
and internal of the board, if want to use it need disassemble
the board. So, change PX_BRDCFG0 register to force to use SD
card slot #2 which is the slot at the back panel of the board.

Signed-off-by: Yang Shi <yang.shi@windriver.com>
---
 arch/powerpc/platforms/85xx/p1022_ds.c |    2 ++
 1 files changed, 2 insertions(+), 0 deletions(-)

diff --git a/arch/powerpc/platforms/85xx/p1022_ds.c b/arch/powerpc/platforms/85xx/p1022_ds.c
index 7761a33..0c2b972 100644
--- a/arch/powerpc/platforms/85xx/p1022_ds.c
+++ b/arch/powerpc/platforms/85xx/p1022_ds.c
@@ -103,12 +103,14 @@ static void __init p1022_ds_setup_arch(void)
 #define PIXIS_BASE	0xFFDF0000
 #define PX_BRDCFG0	0x8
 #define ELBC_SPI	0x80000000
+#define SDHC_PORT       0x04000000
 
 	pixis = ioremap(PIXIS_BASE + PX_BRDCFG0, 4);
 	if (!pixis)
 		return;
 
 	out_be32(pixis, in_be32(pixis) | ELBC_SPI);
+	out_be32(pixis, in_be32(pixis) | SDHC_PORT);
 
 	iounmap(pixis);
 
-- 
1.6.5.2

