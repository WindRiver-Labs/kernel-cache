From f0f7ebd6fae626b4d90513d32e8f1c6b4cd70ad1 Mon Sep 17 00:00:00 2001
From: Jiang Lu <lu.jiang@windriver.com>
Date: Mon, 27 Sep 2010 14:07:08 +0800
Subject: [PATCH 08/14] SDHCI: workaround for eSDHC 1.8v errata on P1022

Extracted from the P1022DS_20100330-ltib.iso vendor drop.

P1022 eSDHC does not support 1.8V and ADMA.

Signed-off-by: Jerry Huang <Chang-Ming.Huang@freescale.com>
Integrated-by: Yang Shi <yang.shi@windriver.com>

[Jiang Lu:
Use "#ifdef CONFIG_P1022_DS" brace new added code to force them affect
P1022 platform only.]

Signed-off-by: Jiang Lu <lu.jiang@windriver.com>
---
 drivers/mmc/host/sdhci.c |    5 +++++
 1 files changed, 5 insertions(+), 0 deletions(-)

diff --git a/drivers/mmc/host/sdhci.c b/drivers/mmc/host/sdhci.c
index f3a3980..471d14c 100644
--- a/drivers/mmc/host/sdhci.c
+++ b/drivers/mmc/host/sdhci.c
@@ -1695,6 +1695,11 @@ int sdhci_add_host(struct sdhci_host *host)
 
 	caps = sdhci_readl(host, SDHCI_CAPABILITIES);
 
+#ifdef CONFIG_P1022_DS	
+	/* Workaround for eSDHC errata of P1022 */
+	caps &= (~SDHCI_CAN_DO_ADMA1) & (~SDHCI_CAN_VDD_180);
+#endif
+
 	if (host->quirks & SDHCI_QUIRK_FORCE_DMA)
 		host->flags |= SDHCI_USE_SDMA;
 	else if (!(caps & SDHCI_CAN_DO_SDMA))
-- 
1.6.5.2

