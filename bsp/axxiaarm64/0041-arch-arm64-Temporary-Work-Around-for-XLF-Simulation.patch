From 684396b8ad88db9941bd85c6b859c9ab3469682e Mon Sep 17 00:00:00 2001
From: John Jacques <john.jacques@intel.com>
Date: Fri, 26 Jun 2015 19:51:20 -0500
Subject: [PATCH 041/131] arch/arm64: Temporary Work-Around for XLF Simulation

Bit 17 of the GICD TYPER register is set in simulation;
it shouldn't be. Ignore it for now.

Signed-off-by: John Jacques <john.jacques@intel.com>
[Original patch is from linux-yocto-4.1 axxia/base branch.]
Signed-off-by: Yanjiang Jin <yanjiang.jin@windriver.com>
---
 drivers/irqchip/irq-gic-v3-its.c | 6 +++---
 1 file changed, 3 insertions(+), 3 deletions(-)

diff --git a/drivers/irqchip/irq-gic-v3-its.c b/drivers/irqchip/irq-gic-v3-its.c
index 9a791dd..5731ae3 100644
--- a/drivers/irqchip/irq-gic-v3-its.c
+++ b/drivers/irqchip/irq-gic-v3-its.c
@@ -1598,14 +1598,14 @@ int its_init(struct device_node *node, struct rdists *rdists,
 		its_probe(np, parent_domain);
 	}
 
+	gic_rdists = rdists;
+	gic_root_node = node;
+
 	if (list_empty(&its_nodes)) {
 		pr_warn("ITS: No ITS available, not enabling LPIs\n");
 		return -ENXIO;
 	}
 
-	gic_rdists = rdists;
-	gic_root_node = node;
-
 	its_alloc_lpi_tables();
 	its_lpi_init(rdists->id_bits);
 
-- 
2.8.1

