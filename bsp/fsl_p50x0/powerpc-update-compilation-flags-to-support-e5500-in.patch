From 5813cff0d53eabc970484c62a0059de6af40724d Mon Sep 17 00:00:00 2001
From: Yongli He <yongli.he@windriver.com>
Date: Fri, 1 Apr 2011 15:10:01 +0800
Subject: [PATCH 1/8] powerpc: update compilation flags to support e5500 instructions

ptrace 'mfcr 0,1' need flags -mcpu=e5500. workaround for
P5020DS under GCC4.4a-329.

Signed-off-by: Yongli He <yongli.he@windriver.com>
---
 arch/powerpc/Makefile               |    1 +
 arch/powerpc/platforms/85xx/Kconfig |    5 +++++
 2 files changed, 6 insertions(+), 0 deletions(-)

diff --git a/arch/powerpc/Makefile b/arch/powerpc/Makefile
index 1316ca7..69dee9d 100644
--- a/arch/powerpc/Makefile
+++ b/arch/powerpc/Makefile
@@ -131,6 +131,7 @@ cpu-as-$(CONFIG_4xx)		+= -Wa,-m405
 cpu-as-$(CONFIG_6xx)		+= -Wa,-maltivec
 cpu-as-$(CONFIG_POWER4)		+= -Wa,-maltivec
 cpu-as-$(CONFIG_E500)		+= -Wa,-me500
+cpu-as-$(CONFIG_WORKAROUND_E5500_MFCR) += -mcpu=e5500
 cpu-as-$(CONFIG_E200)		+= -Wa,-me200
 
 KBUILD_AFLAGS += $(cpu-as-y)
diff --git a/arch/powerpc/platforms/85xx/Kconfig b/arch/powerpc/platforms/85xx/Kconfig
index b8ab04c..2bb047b 100644
--- a/arch/powerpc/platforms/85xx/Kconfig
+++ b/arch/powerpc/platforms/85xx/Kconfig
@@ -252,9 +252,14 @@ config P5020_DS
 	select HAS_FSL_QBMAN
 	select HAS_FSL_PME
 	select FSL_HYDRA_DS_MDIO if PHYLIB
+	select WORKAROUND_E5500_MFCR
 	help
 	  This option enables support for the P5020 DS board
 
+config WORKAROUND_E5500_MFCR
+	bool
+
+
 endif # FSL_SOC_BOOKE
 
 config FSL_CORENET_DS_MDIO
-- 
1.7.0.4

