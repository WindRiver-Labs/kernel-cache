From 62fec6b5ed2a1d897e00d05be7cfc5e0ad146482 Mon Sep 17 00:00:00 2001
From: Kevin Hao <kexin.hao@windriver.com>
Date: Thu, 2 Aug 2012 11:02:29 +0800
Subject: [PATCH 22/23] powerpc/smp: fix the build error when cpu hotplug is enabled on 64bit kernel

The cpu_die is defined in both platforms/85xx/smp.c and
kernel/setup_64.c, and abort is only implemented in the ppc32 code.
So protect them with CONFIG_PPC32.

Signed-off-by: Kevin Hao <kexin.hao@windriver.com>
---
 arch/powerpc/kernel/smp.c         |    2 ++
 arch/powerpc/platforms/85xx/smp.c |    2 +-
 2 files changed, 3 insertions(+), 1 deletions(-)

diff --git a/arch/powerpc/kernel/smp.c b/arch/powerpc/kernel/smp.c
index fda290c..b967717 100644
--- a/arch/powerpc/kernel/smp.c
+++ b/arch/powerpc/kernel/smp.c
@@ -374,7 +374,9 @@ void generic_mach_cpu_die(void)
 	__get_cpu_var(cpu_state) = CPU_DEAD;
 	smp_wmb();
 
+#ifdef CONFIG_PPC32
 	abort();
+#endif
 
 	while (__get_cpu_var(cpu_state) != CPU_UP_PREPARE)
 		cpu_relax();
diff --git a/arch/powerpc/platforms/85xx/smp.c b/arch/powerpc/platforms/85xx/smp.c
index e5949b2..c4c6166 100644
--- a/arch/powerpc/platforms/85xx/smp.c
+++ b/arch/powerpc/platforms/85xx/smp.c
@@ -321,7 +321,7 @@ struct smp_ops_t smp_85xx_ops = {
 #endif
 };
 
-#if defined(CONFIG_HOTPLUG_CPU) && !defined(CONFIG_WRHV)
+#if defined(CONFIG_HOTPLUG_CPU) && !defined(CONFIG_WRHV) && defined(CONFIG_PPC32)
 void cpu_die(void)
 {
 #if defined CONFIG_E500 && defined CONFIG_SUSPEND
-- 
1.7.0

