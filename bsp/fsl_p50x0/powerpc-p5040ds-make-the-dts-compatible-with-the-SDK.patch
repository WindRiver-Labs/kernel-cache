From 1600ba6dd5aacbf961e08dca8280cc74a1474496 Mon Sep 17 00:00:00 2001
From: Kevin Hao <kexin.hao@windriver.com>
Date: Thu, 5 Jul 2012 13:28:26 +0800
Subject: [PATCH 10/23] powerpc/p5040ds: make the dts compatible with the SDK 1.1 driver

Update the FSL p5040ds dts from the SDK 1.2 ISO to work with a SDK 1.1
based BSP.

Signed-off-by: Kevin Hao <kexin.hao@windriver.com>
---
 arch/powerpc/boot/dts/p5040ds.dts |   73 ++++++++++++++++++++++++++++++++++---
 1 files changed, 67 insertions(+), 6 deletions(-)

diff --git a/arch/powerpc/boot/dts/p5040ds.dts b/arch/powerpc/boot/dts/p5040ds.dts
index c607cfd..30bdd58 100644
--- a/arch/powerpc/boot/dts/p5040ds.dts
+++ b/arch/powerpc/boot/dts/p5040ds.dts
@@ -310,9 +310,10 @@
 			reg = <0x24000 0x4000 0x109000 0x1000>;
 			interrupts = <123 2 0 0>;
 		};
-		bman-bpids@0 {
-			compatible = "fsl,bpid-range";
-			fsl,bpid-range = <32 32>;
+		buffer-pool@0 {
+			compatible = "fsl,bpool";
+			fsl,bpid = <0>;
+			fsl,bpool-cfg = <0 0x100 0 1 0 0x100>;
 		};
 	};
 
@@ -818,7 +819,7 @@
 			reg = <0x114000 0x1000>;
 			interrupts = <48 2 0 0>;
 			clock-frequency = <0>;
-			sdhci,auto-cmd12;
+			fsl,sdhci-auto-cmd12;
 		};
 
 		i2c@118000 {
@@ -1904,7 +1905,7 @@
 	};
 
 	lbc: localbus@ffe124000 {
-		compatible = "fsl,p5040-rev1.0-elbc", "simple-bus";
+		compatible = "fsl,p3041-rev1.0-elbc", "simple-bus";
 		interrupts = <
 			25 2 0 0
 			16 2 1 19
@@ -1921,6 +1922,54 @@
 			reg = <0 0 0x08000000>;
 			bank-width = <2>;
 			device-width = <2>;
+			#size-cells = <1>;
+			#address-cells = <1>;
+
+			partition@0 {
+				label = "rcw";
+				reg = <0x0 0x20000>;
+				read-only;
+			};
+			partition@20000 {
+				label = "kernel";
+				reg = <0x20000 0x500000>;
+			};
+			partition@520000 {
+				label = "dtb";
+				reg = <0x520000 0x20000>;
+			};
+			partition@540000 {
+				label = "fs1";
+				reg = <0x540000 0x3a40000>;
+			};
+			partition@3f80000 {
+				label = "alt-u-boot";
+				reg = <0x3f80000 0x80000>;
+				read-only;
+			};
+			partition@4000000 {
+				label = "alt-rcw";
+				reg = <0x4000000 0x20000>;
+				read-only;
+			};
+			partition@4020000 {
+				label = "fs2";
+				reg = <0x4020000  0x2fe0000>;
+			};
+			partition@7000000 {
+				label = "fman-firmware";
+				reg = <0x7000000 0x20000>;
+				read-only;
+			};
+			partition@7020000 {
+				label = "fs3";
+				reg = <0x7020000  0xf60000>;
+			};
+			partition@7f80000 {
+				label = "u-boot";
+				reg = <0x7f80000 0x80000>;
+				read-only;
+			};
 		};
 
 		nand@2,0 {
@@ -1962,7 +2011,7 @@
 		};
 
 		board-control@3,0 {
-			compatible = "fsl,p5040ds-fpga", "fsl,fpga-ngpixis";
+			compatible = "fsl,p5040ds-pixis", "fsl,fpga-ngpixis";
 			reg = <3 0 0x40>;
 		};
 	};
@@ -2081,52 +2130,64 @@
 		ethernet@0 {
 			compatible = "fsl,p5040-dpa-ethernet", "fsl,dpa-ethernet";
 			fsl,fman-mac = <&fm1dtsec1>;
+			fsl,qman-channel = <&qpool1>;
 			status = "disabled";
 		};
 		ethernet@1 {
 			compatible = "fsl,p5040-dpa-ethernet", "fsl,dpa-ethernet";
 			fsl,fman-mac = <&fm1dtsec2>;
+			fsl,qman-channel = <&qpool1>;
 		};
 		ethernet@2 {
 			compatible = "fsl,p5040-dpa-ethernet", "fsl,dpa-ethernet";
 			fsl,fman-mac = <&fm1dtsec3>;
+			fsl,qman-channel = <&qpool1>;
 		};
 		ethernet@3 {
 			compatible = "fsl,p5040-dpa-ethernet", "fsl,dpa-ethernet";
 			fsl,fman-mac = <&fm1dtsec4>;
+			fsl,qman-channel = <&qpool1>;
 		};
 		ethernet@4 {
 			compatible = "fsl,p5040-dpa-ethernet", "fsl,dpa-ethernet";
 			fsl,fman-mac = <&fm1dtsec5>;
+			fsl,qman-channel = <&qpool1>;
 		};
 		ethernet@5 {
 			compatible = "fsl,p5040-dpa-ethernet", "fsl,dpa-ethernet";
 			fsl,fman-mac = <&fm1tgec>;
+			fsl,qman-channel = <&qpool1>;
 		};
 		ethernet@6 {
 			compatible = "fsl,p5040-dpa-ethernet", "fsl,dpa-ethernet";
 			fsl,fman-mac = <&fm2dtsec1>;
+			fsl,qman-channel = <&qpool1>;
 			status = "disabled";
 		};
 		ethernet@7 {
 			compatible = "fsl,p5040-dpa-ethernet", "fsl,dpa-ethernet";
 			fsl,fman-mac = <&fm2dtsec2>;
+			fsl,qman-channel = <&qpool1>;
 		};
 		ethernet@8 {
 			compatible = "fsl,p5040-dpa-ethernet", "fsl,dpa-ethernet";
 			fsl,fman-mac = <&fm2dtsec3>;
+			fsl,qman-channel = <&qpool1>;
 		};
 		ethernet@9 {
 			compatible = "fsl,p5040-dpa-ethernet", "fsl,dpa-ethernet";
 			fsl,fman-mac = <&fm2dtsec4>;
+			fsl,qman-channel = <&qpool1>;
 		};
 		ethernet@10 {
 			compatible = "fsl,p5040-dpa-ethernet", "fsl,dpa-ethernet";
 			fsl,fman-mac = <&fm2dtsec5>;
+			fsl,qman-channel = <&qpool1>;
 		};
 		ethernet@11 {
 			compatible = "fsl,p5040-dpa-ethernet", "fsl,dpa-ethernet";
 			fsl,fman-mac = <&fm2tgec>;
+			fsl,qman-channel = <&qpool1>;
 		};
 	};
 };
-- 
1.7.0

