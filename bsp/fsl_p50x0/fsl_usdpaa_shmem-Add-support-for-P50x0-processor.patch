From 11b5c1de06ba1efd3ef21d828e9b1507c008f531 Mon Sep 17 00:00:00 2001
From: Jiang Lu <lu.jiang@windriver.com>
Date: Wed, 28 Dec 2011 10:19:15 +0800
Subject: [PATCH 13/25] fsl_usdpaa_shmem:Add support for P50x0 processor

The patch exports settlbcam() routine for PPC64, which is called by
usdpaa_shmem driver.
Besides, the patch updates usdpaa_shmem's dependency to support P50x0
processor.

The patch is extracted from
QorIQ-DPAA-SDK-v1.1-20111026-systembuilder.iso.

Integrated-by: Jiang Lu <lu.jiang@windriver.com>
---
 arch/powerpc/mm/mmu_decl.h |    5 +++--
 drivers/misc/Kconfig       |    2 +-
 2 files changed, 4 insertions(+), 3 deletions(-)

diff --git a/arch/powerpc/mm/mmu_decl.h b/arch/powerpc/mm/mmu_decl.h
index c1cf576..80f2bd6 100644
--- a/arch/powerpc/mm/mmu_decl.h
+++ b/arch/powerpc/mm/mmu_decl.h
@@ -96,14 +96,15 @@ extern void _tlbia(void);
 
 #endif /* CONFIG_PPC_MMU_NOHASH */
 
+void settlbcam(int index, unsigned long virt, phys_addr_t phys,
+	unsigned long size, unsigned long flags, unsigned int pid);
+
 #ifdef CONFIG_PPC32
 
 extern void mapin_ram(void);
 extern int map_page(unsigned long va, phys_addr_t pa, int flags);
 extern void setbat(int index, unsigned long virt, phys_addr_t phys,
 		   unsigned int size, int flags);
-void settlbcam(int index, unsigned long virt, phys_addr_t phys,
-		unsigned long size, unsigned long flags, unsigned int pid);
 
 extern int __map_without_bats;
 extern int __allow_ioremap_reserved;
diff --git a/drivers/misc/Kconfig b/drivers/misc/Kconfig
index a98566d..6e3a26b 100644
--- a/drivers/misc/Kconfig
+++ b/drivers/misc/Kconfig
@@ -175,7 +175,7 @@ config ENCLOSURE_SERVICES
 
 config FSL_USDPAA_SHMEM
 	bool "Freescale USDPAA shared memory driver"
-	depends on PPC_85xx
+	depends on PPC_85xx || PPC_E500MC
 	help
 	  This driver provides user-space access to a large contiguous
 	  memory allocation, reserved for use by Freescale USDPAA (User
-- 
1.7.9.7

