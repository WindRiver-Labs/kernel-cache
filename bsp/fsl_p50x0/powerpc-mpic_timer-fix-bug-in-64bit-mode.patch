From 348dcc1401d57a23a9626b072277c7e447e73c5d Mon Sep 17 00:00:00 2001
From: Kevin Hao <kexin.hao@windriver.com>
Date: Thu, 5 Jul 2012 13:29:14 +0800
Subject: [PATCH 04/23] powerpc/mpic_timer: fix bug in 64bit mode

Use void * for the register virtual address and also cast priv->regs
to void * instead of u32 before adding the tcr offset. Otherwise we
will get the wrong value in 64bit mode.

Signed-off-by: Kevin Hao <kexin.hao@windriver.com>
---
 arch/powerpc/sysdev/mpic_timer.c |    4 ++--
 1 files changed, 2 insertions(+), 2 deletions(-)

diff --git a/arch/powerpc/sysdev/mpic_timer.c b/arch/powerpc/sysdev/mpic_timer.c
index 29e9fc2..98a1de9 100644
--- a/arch/powerpc/sysdev/mpic_timer.c
+++ b/arch/powerpc/sysdev/mpic_timer.c
@@ -184,8 +184,8 @@ static int __devinit mpic_tm_probe(struct of_device *dev,
 	if (!has_tcr) {
 		priv->ticks_per_sec = busfreq / 8;
 	} else {
-		u32 __iomem *tcr;
-		tcr = (u32 __iomem *)((u32)priv->regs + MPIC_TIMER_TCR_OFFSET);
+		void __iomem *tcr;
+		tcr = (void *)priv->regs + MPIC_TIMER_TCR_OFFSET;
 		out_be32(tcr, in_be32(tcr) | MPIC_TIMER_TCR_CLKDIV_64);
 		priv->ticks_per_sec = busfreq / 64;
 	}
-- 
1.7.0

