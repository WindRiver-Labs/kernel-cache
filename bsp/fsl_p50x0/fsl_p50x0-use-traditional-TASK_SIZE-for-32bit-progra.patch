From ed4466cc6fe630aa63426ea6499121026a0c673f Mon Sep 17 00:00:00 2001
From: Yongli He <yongli.he@windriver.com>
Date: Sun, 16 Oct 2011 10:58:52 +0800
Subject: [PATCH] fsl_p50x0: use traditional TASK_SIZE for 32bit program

64bit kernel extended 32bit program address space to 4G introduce
unexpected behavior, i.e:
mmap(0x7ffff000, 2147479552, PROT_WRITE, MAP_ANONYMOUS, 0, 0)
will lead program to segment fault instead of return ENOMEM.

Signed-off-by: Yongli He <yongli.he@windriver.com>
---
 arch/powerpc/include/asm/processor.h |    2 +-
 1 files changed, 1 insertions(+), 1 deletions(-)

diff --git a/arch/powerpc/include/asm/processor.h b/arch/powerpc/include/asm/processor.h
index dafce2b..9f21a91 100644
--- a/arch/powerpc/include/asm/processor.h
+++ b/arch/powerpc/include/asm/processor.h
@@ -113,7 +113,7 @@ extern struct task_struct *last_task_used_spe;
  * 32-bit user address space is 4GB - 1 page 
  * (this 1 page is needed so referencing of 0xFFFFFFFF generates EFAULT
  */
-#define TASK_SIZE_USER32 (0x0000000100000000UL - (1*PAGE_SIZE))
+#define TASK_SIZE_USER32 (0x0000000c0000000UL - (1*PAGE_SIZE))
 
 #define TASK_SIZE_OF(tsk) (test_tsk_thread_flag(tsk, TIF_32BIT) ? \
 		TASK_SIZE_USER32 : TASK_SIZE_USER64)
-- 
1.7.0.4

