From 67c67d375ad980fb83f972560b80ebd56ffe80eb Mon Sep 17 00:00:00 2001
From: Guoqing Jiang <Guoqing.Jiang@windriver.com>
Date: Mon, 4 Jul 2011 16:50:37 +0800
Subject: [PATCH 04/13] TI816x preempt_rt: make the lock in usbotg_ss to be raw

1. change the definition of lock to raw lock.
2. replace all the spin_lock/unlock to raw_spin_lock*/unlock*

Signed-off-by: Guoqing Jiang <Guoqing.Jiang@windriver.com>
---
 drivers/usb/musb/ti816x.c |   12 ++++++------
 1 files changed, 6 insertions(+), 6 deletions(-)

diff --git a/drivers/usb/musb/ti816x.c b/drivers/usb/musb/ti816x.c
index 14a6b83..24532da 100644
--- a/drivers/usb/musb/ti816x.c
+++ b/drivers/usb/musb/ti816x.c
@@ -99,7 +99,7 @@ static irqreturn_t cppi41dma_Interrupt(int irq, void *hci);
 
 struct usbotg_ss {
 	/* usbss access lock */
-	spinlock_t	lock;
+	raw_spinlock_t	lock;
 	void		*base;
 	void		*intc_base;
 	int		init_done;
@@ -115,9 +115,9 @@ u32 usbss_read(u32 offs)
 	if (!usbss.init_done)
 		return val;
 
-	spin_lock_irqsave(&usbss.lock, flags);
+	raw_spin_lock_irqsave(&usbss.lock, flags);
 	val = *(volatile u32 *)(u32)((u32)usbss.base + offs);
-	spin_unlock_irqrestore(&usbss.lock, flags);
+	raw_spin_unlock_irqrestore(&usbss.lock, flags);
 
 	return val;
 }
@@ -129,9 +129,9 @@ void usbss_write(u32 offs, u32 val)
 	if (!usbss.init_done)
 		return;
 
-	spin_lock_irqsave(&usbss.lock, flags);
+	raw_spin_lock_irqsave(&usbss.lock, flags);
 	*(volatile u32 *)((u32)usbss.base + offs) = val;
-	spin_unlock_irqrestore(&usbss.lock, flags);
+	raw_spin_unlock_irqrestore(&usbss.lock, flags);
 }
 
 int usbotg_ss_init(struct musb *musb)
@@ -142,7 +142,7 @@ int usbotg_ss_init(struct musb *musb)
 		usbss.base = ioremap(TI816X_USBSS_BASE,
 				TI816X_USBSS_LEN);
 		usbss.intc_base = ioremap(0x50000000, 0x400);
-		spin_lock_init(&usbss.lock);
+		raw_spin_lock_init(&usbss.lock);
 		usbss.init_done = 1;
 		/* eoi to usbss */
 		usbss_write(USBSS_IRQ_EOI, 0);
-- 
1.7.0.4

