From 79e8f3c30c1d6746b70c464f7c9b2b44cd7c5d74 Mon Sep 17 00:00:00 2001
From: Tiejun Chen <tiejun.chen@windriver.com>
Date: Tue, 12 May 2009 10:14:05 +0800
Subject: [PATCH] fsl_mpc8360e: Use the correct SPI flash

According to the board pkgs from the Freescale m25p40 is used on MPC836x_MDS,
not m25p80.

[This patch should be folded into commit ID
05432e80cb88ae2990b049ef2dcddc75c9b9a0d4]

Signed-off-by: Tiejun Chen <tiejun.chen@windriver.com>
---
 arch/powerpc/platforms/83xx/mpc836x_mds.c |    2 +-
 drivers/mtd/devices/m25p80.c              |    5 +++++
 2 files changed, 6 insertions(+), 1 deletions(-)

diff --git a/arch/powerpc/platforms/83xx/mpc836x_mds.c b/arch/powerpc/platforms/83xx/mpc836x_mds.c
index 9c16a08..0a74f94 100644
--- a/arch/powerpc/platforms/83xx/mpc836x_mds.c
+++ b/arch/powerpc/platforms/83xx/mpc836x_mds.c
@@ -74,7 +74,7 @@ static struct flash_platform_data mpc836x_spi_flash_data = {
 	.name = "m25p80",
 	.parts = mpc836x_spi_flash_partitions,
 	.nr_parts = ARRAY_SIZE(mpc836x_spi_flash_partitions),
-	.type = "m25p80",
+	.type = "m25p40",
 };
 
 static void mpc83xx_spi_activate_cs(u8 cs, u8 polarity)
diff --git a/drivers/mtd/devices/m25p80.c b/drivers/mtd/devices/m25p80.c
index b35c333..2e4efc1 100644
--- a/drivers/mtd/devices/m25p80.c
+++ b/drivers/mtd/devices/m25p80.c
@@ -486,7 +486,12 @@ static struct flash_info __devinitdata m25p_data [] = {
 	{ "m25p05",  0x202010,  32 * 1024, 2, },
 	{ "m25p10",  0x202011,  32 * 1024, 4, },
 	{ "m25p20",  0x202012,  64 * 1024, 4, },
+#ifdef CONFIG_MPC836x_MDS
+	/* Use m25p40 as the default on MPC836x_MDS by setting jedec_id to 0 */
+	{ "m25p40",         0,  64 * 1024, 8, },
+#else
 	{ "m25p40",  0x202013,  64 * 1024, 8, },
+#endif
 	{ "m25p80",         0,  64 * 1024, 16, },
 	{ "m25p16",  0x202015,  64 * 1024, 32, },
 	{ "m25p32",  0x202016,  64 * 1024, 64, },
-- 
1.6.0.4

