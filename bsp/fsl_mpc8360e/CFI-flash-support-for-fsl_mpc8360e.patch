From 52662d78501854e6aabfde32ea56a2cf5da62c0c Mon Sep 17 00:00:00 2001
From: Andrei Dolnikov <adolnikov@embeddedalley.com>
Date: Tue, 2 Dec 2008 18:49:55 +0300
Subject: [PATCH] CFI flash support for fsl_mpc8360e.

Adding CFI flash device tree node and partition map for the
Freescale MPC8360e MDS board.

Signed-off-by: Andrei Dolnikov <adolnikov@embeddedalley.com>
Signed-off-by: Bruce Ashfield <bruce.ashfield@windriver.com>
---
 arch/powerpc/boot/dts/mpc836x_mds.dts |   56 +++++++++++++++++++++++++++++++--
 1 files changed, 53 insertions(+), 3 deletions(-)

diff --git a/arch/powerpc/boot/dts/mpc836x_mds.dts b/arch/powerpc/boot/dts/mpc836x_mds.dts
index 948ee22..f301f59 100644
--- a/arch/powerpc/boot/dts/mpc836x_mds.dts
+++ b/arch/powerpc/boot/dts/mpc836x_mds.dts
@@ -52,9 +52,59 @@
 		reg = <0x00000000 0x10000000>;
 	};
 
-	bcsr@f8000000 {
-		device_type = "board-control";
-		reg = <0xf8000000 0x8000>;
+	localbus@e0005000 {
+		#address-cells = <2>;
+		#size-cells = <1>;
+		compatible = "fsl,mpc8360-localbus", "fsl,pq2pro-localbus",
+			     "simple-bus";
+		reg = <0xe0005000 0xd8>;
+		ranges = <0 0 0xfe000000 0x02000000
+			  1 0 0xf8000000 0x00008000>;
+
+		flash@0,0 {
+			#address-cells = <1>;
+			#size-cells = <1>;
+			compatible = "cfi-flash";
+			reg = <0 0 0x2000000>;
+			bank-width = <2>;
+			device-width = <1>;
+
+			partition@0 {
+				label = "U-Boot";
+				reg = <0x0 0x100000>;
+			};
+
+			partition@100000 {
+				label = "JFFS2";
+				reg = <0x100000 0x800000>;
+			};
+
+			partition@900000 {
+				label = "Ramdisk";
+				reg = <0x900000 0x400000>;
+			};
+
+			partition@d00000 {
+				label = "Reserved";
+				reg = <0xd00000 0x1000000>;
+			};
+
+			partition@1d00000 {
+				label = "Kernel";
+				reg = <0x1d00000 0x200000>;
+			};
+
+			partition@1f00000 {
+				label = "dtb";
+				reg = <0x1f00000 0x100000>;
+			};
+
+		};
+
+		bcsr@1,0 {
+ 			compatible = "fsl,mpc8360mds-bcsr";
+			reg = <1 0 0x8000>;
+		};
 	};
 
 	soc8360@e0000000 {
-- 
1.6.0.2.GIT

