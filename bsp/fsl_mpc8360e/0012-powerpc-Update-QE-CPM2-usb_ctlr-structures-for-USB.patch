From 5942365da9f6d432ca95031a57e6905d434486cc Mon Sep 17 00:00:00 2001
From: Andrei Dolnikov <adolnikov@embeddedalley.com>
Date: Wed, 17 Dec 2008 20:13:57 +0300
Subject: [PATCH] powerpc: Update QE/CPM2 usb_ctlr structures for USB support

link:	http://git.kernel.org/?p=linux/kernel/git/paulus/powerpc.git;a=commit;h=2b48706560cd4811654582a4a194c67a8562d602
git:	git://git.kernel.org/pub/scm/linux/kernel/git/paulus/powerpc.git
commit id: 2b48706560cd4811654582a4a194c67a8562d602

[
 Fixes following build error:

 CC drivers/usb/gadget/fsl_qe_udc.o
 drivers/usb/gadget/fsl_qe_udc.c: In function 'qe_eprx_stall_change':
 drivers/usb/gadget/fsl_qe_udc.c:156: error: 'struct usb_ctlr' has no member named 'usb_usep'
 drivers/usb/gadget/fsl_qe_udc.c:163: error: 'struct usb_ctlr' has no member named 'usb_usep'
 drivers/usb/gadget/fsl_qe_udc.c: In function 'qe_eptx_stall_change':
 drivers/usb/gadget/fsl_qe_udc.c:173: error: 'struct usb_ctlr' has no member named 'usb_usep'
 drivers/usb/gadget/fsl_qe_udc.c:180: error: 'struct usb_ctlr' has no member named 'usb_usep'
 drivers/usb/gadget/fsl_qe_udc.c: In function 'qe_eprx_nack':
 drivers/usb/gadget/fsl_qe_udc.c:201: error: 'struct usb_ctlr' has no member named 'usb_usep'
 drivers/usb/gadget/fsl_qe_udc.c:201: error: 'struct usb_ctlr' has no member named 'usb_usep'
 drivers/usb/gadget/fsl_qe_udc.c: In function 'qe_eprx_normal':
 drivers/usb/gadget/fsl_qe_udc.c:218: error: 'struct usb_ctlr' has no member named 'usb_usep'
 drivers/usb/gadget/fsl_qe_udc.c:218: error: 'struct usb_ctlr' has no member named 'usb_usep'
 drivers/usb/gadget/fsl_qe_udc.c: In function 'qe_ep_reset':
 drivers/usb/gadget/fsl_qe_udc.c:325: error: 'struct usb_ctlr' has no member named 'usb_usep'
 drivers/usb/gadget/fsl_qe_udc.c:342: error: 'struct usb_ctlr' has no member named 'usb_usep'
 drivers/usb/gadget/fsl_qe_udc.c: In function 'qe_ep_register_init':
 drivers/usb/gadget/fsl_qe_udc.c:515: error: 'struct usb_ctlr' has no member named 'usb_usep'
 drivers/usb/gadget/fsl_qe_udc.c: In function 'ch9getstatus':
 drivers/usb/gadget/fsl_qe_udc.c:1981: error: 'struct usb_ctlr' has no member named 'usb_usep'
 make[2]: *** [drivers/usb/gadget/fsl_qe_udc.o] Error 1

 Signed-off-by: Li Yang <leoli@freescale.com>
 Signed-off-by: Anton Vorontsov <avorontsov@ru.mvista.com>
 Signed-off-by: Kumar Gala <galak@kernel.crashing.org>
]

Integrated-by: Andrei Dolnikov <adolnikov@embeddedalley.com>
---
 arch/powerpc/include/asm/immap_cpm2.h |    9 +++------
 arch/powerpc/include/asm/immap_qe.h   |    5 +----
 2 files changed, 4 insertions(+), 10 deletions(-)

diff --git a/arch/powerpc/include/asm/immap_cpm2.h b/arch/powerpc/include/asm/immap_cpm2.h
index 4080bab..d4f069b 100644
--- a/arch/powerpc/include/asm/immap_cpm2.h
+++ b/arch/powerpc/include/asm/immap_cpm2.h
@@ -554,14 +554,11 @@ typedef struct usb_ctlr {
 	u8	usb_usadr;
 	u8	usb_uscom;
 	u8	res1[1];
-	u16	usb_usep1;
-	u16	usb_usep2;
-	u16	usb_usep3;
-	u16	usb_usep4;
+	__be16  usb_usep[4];
 	u8	res2[4];
-	u16	usb_usber;
+	__be16  usb_usber;
 	u8	res3[2];
-	u16	usb_usbmr;
+	__be16  usb_usbmr;
 	u8	usb_usbs;
 	u8	res4[7];
 } usb_cpm2_t;
diff --git a/arch/powerpc/include/asm/immap_qe.h b/arch/powerpc/include/asm/immap_qe.h
index 3c2fced..c346d0b 100644
--- a/arch/powerpc/include/asm/immap_qe.h
+++ b/arch/powerpc/include/asm/immap_qe.h
@@ -215,10 +215,7 @@ struct usb_ctlr {
 	u8	usb_usadr;
 	u8	usb_uscom;
 	u8	res1[1];
-	__be16	usb_usep1;
-	__be16	usb_usep2;
-	__be16	usb_usep3;
-	__be16	usb_usep4;
+	__be16  usb_usep[4];
 	u8	res2[4];
 	__be16	usb_usber;
 	u8	res3[2];
-- 
1.6.0.2.GIT

