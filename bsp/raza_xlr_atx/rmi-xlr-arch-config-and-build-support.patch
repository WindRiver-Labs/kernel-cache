From ec7241ea3ae02c464858dd40130be90e1bd55cce Mon Sep 17 00:00:00 2001
From: Jack Tan <jack.tan@windriver.com>
Date: Tue, 16 Dec 2008 19:07:05 +0800
Subject: [PATCH] rmi xlr arch config and build support

XLR's configuration and building system support.

Signed-off-by: Jack Tan <jack.tan@windriver.com>
---
 arch/mips/Kconfig         |   39 +++++++++++++++++++++++++++++++++++++++
 arch/mips/Makefile        |   11 +++++++++++
 arch/mips/kernel/Makefile |    2 ++
 3 files changed, 52 insertions(+), 0 deletions(-)

diff --git a/arch/mips/Kconfig b/arch/mips/Kconfig
index 37ef41e..b8da063 100644
--- a/arch/mips/Kconfig
+++ b/arch/mips/Kconfig
@@ -598,6 +598,28 @@ config WR_PPMC
 	  This enables support for the Wind River MIPS32 4KC PPMC evaluation
 	  board, which is based on GT64120 bridge chip.
 
+config RMI_PTR
+	bool "Support for RMI ATX board"
+	depends on EXPERIMENTAL
+	select CEVT_R4K
+	select CSRC_PHOENIX
+	select BOOT_ELF32
+	select RMI_PHOENIX
+	select SYS_R4K_CVET_HWTIMER
+	select SYS_HAS_CPU_PHOENIX
+	select SYS_SUPPORTS_SMP
+	select HW_HAS_PCI
+	select SWAP_IO_SPACE
+	select SYS_SUPPORTS_32BIT_KERNEL
+	select SYS_SUPPORTS_BIG_ENDIAN
+	select SYS_SUPPORTS_HIGHMEM
+	select ZONE_DMA if 64BIT
+	select DMA_COHERENT
+        select SYS_SUPPORTS_64BIT_KERNEL if EXPERIMENTAL
+	help
+	  This board is based on RMI XLR processor. 
+	  Say Y here to support this machine type
+
 endchoice
 
 source "arch/mips/au1000/Kconfig"
@@ -609,6 +631,7 @@ source "arch/mips/sgi-ip27/Kconfig"
 source "arch/mips/sibyte/Kconfig"
 source "arch/mips/txx9/Kconfig"
 source "arch/mips/vr41xx/Kconfig"
+source "arch/mips/rmi/Kconfig"
 
 endmenu
 
@@ -710,6 +733,9 @@ config CSRC_R4K
 config CSRC_SB1250
 	bool
 
+config CSRC_PHOENIX
+	bool
+
 config GPIO_TXX9
 	select GENERIC_GPIO
 	select ARCH_REQUIRE_GPIOLIB
@@ -1176,6 +1202,16 @@ config CPU_SB1
 	select CPU_SUPPORTS_HIGHMEM
 	select WEAK_ORDERING
 
+config CPU_PHOENIX
+	bool "XLR"
+	depends on SYS_HAS_CPU_PHOENIX
+	select CPU_SUPPORTS_32BIT_KERNEL
+	select CPU_SUPPORTS_64BIT_KERNEL
+	select CPU_SUPPORTS_HIGHMEM
+	select CPU_HAS_LLSC
+	select WEAK_ORDERING
+	select CPU_HAS_PREFETCH
+
 endchoice
 
 config SYS_HAS_CPU_LOONGSON2
@@ -1247,6 +1283,9 @@ config SYS_R4K_CVET_HWTIMER
 config WEAK_ORDERING
 	bool
 
+config SYS_HAS_CPU_PHOENIX
+	bool
+
 #
 # CPU may reorder reads and writes beyond LL/SC
 # CPU may reorder R->LL, R->LL, W->LL, W->LL, R->SC, R->SC, W->SC, W->SC
diff --git a/arch/mips/Makefile b/arch/mips/Makefile
index 84b5241..5dea3be 100644
--- a/arch/mips/Makefile
+++ b/arch/mips/Makefile
@@ -579,6 +579,17 @@ core-$(CONFIG_TOSHIBA_RBTX4927)	+= arch/mips/txx9/rbtx4927/
 #
 core-$(CONFIG_TOSHIBA_RBTX4938) += arch/mips/txx9/rbtx4938/
 
+#
+# RMI Phoenix SOC
+core-$(CONFIG_RMI_PHOENIX)      += arch/mips/rmi/phoenix/ 
+cflags-$(CONFIG_RMI_PHOENIX) += -Iinclude/asm-mips/mach-phoenix/
+
+#
+# RMI PTR board
+core-$(CONFIG_RMI_PTR)          += arch/mips/rmi/ptr/
+load-$(CONFIG_RMI_PTR)          += $(CONFIG_RMI_PHOENIX_LOAD_ADDRESS)
+
+
 cflags-y			+= -Iinclude/asm-mips/mach-generic
 drivers-$(CONFIG_PCI)		+= arch/mips/pci/
 
diff --git a/arch/mips/kernel/Makefile b/arch/mips/kernel/Makefile
index 8972f5e..cb024a5 100644
--- a/arch/mips/kernel/Makefile
+++ b/arch/mips/kernel/Makefile
@@ -19,6 +19,7 @@ obj-$(CONFIG_CSRC_BCM1480)	+= csrc-bcm1480.o
 obj-$(CONFIG_CSRC_IOASIC)	+= csrc-ioasic.o
 obj-$(CONFIG_CSRC_R4K)		+= csrc-r4k.o
 obj-$(CONFIG_CSRC_SB1250)	+= csrc-sb1250.o
+obj-$(CONFIG_CSRC_PHOENIX)	+= csrc-phoenix.o
 obj-$(CONFIG_SYNC_R4K)		+= sync-r4k.o
 
 obj-$(CONFIG_STACKTRACE)	+= stacktrace.o
@@ -42,6 +43,7 @@ obj-$(CONFIG_CPU_SB1)		+= r4k_fpu.o r4k_switch.o
 obj-$(CONFIG_CPU_TX39XX)	+= r2300_fpu.o r2300_switch.o
 obj-$(CONFIG_CPU_TX49XX)	+= r4k_fpu.o r4k_switch.o
 obj-$(CONFIG_CPU_VR41XX)	+= r4k_fpu.o r4k_switch.o
+obj-$(CONFIG_CPU_PHOENIX)	+= r4k_fpu.o r4k_switch.o
 
 obj-$(CONFIG_DYNAMIC_FTRACE)	+= ftrace.o
 
-- 
1.6.0.4

