From eefba65edab60cd0462894a75868a052d1f95ff2 Mon Sep 17 00:00:00 2001
From: Guijin Gao <guijin.gao@windriver.com>
Date: Tue, 3 Nov 2009 20:38:46 -0800
Subject: [PATCH] raza: Fix a problem with raza irq dispatch

Currently it dispatches all requested irqs regardless of irq mask
register. Now change the code to only dispatch unmasked irqs.

Signed-off-by: Guijin Gao <guijin.gao@windriver.com>
---
 arch/mips/rmi/phoenix/irq.c |    4 ++--
 1 files changed, 2 insertions(+), 2 deletions(-)

diff --git a/arch/mips/rmi/phoenix/irq.c b/arch/mips/rmi/phoenix/irq.c
index 940c688..6f2e27e 100644
--- a/arch/mips/rmi/phoenix/irq.c
+++ b/arch/mips/rmi/phoenix/irq.c
@@ -485,13 +485,13 @@ asmlinkage void plat_irq_dispatch(void)
 		return;
 	}
 
-	if (eirr & (1 << IRQ_TIMER)) {
+	if (pending & (1 << IRQ_TIMER)) {
 		do_IRQ(IRQ_TIMER);
 		return;
 	}
 
 	for (irq = 63; irq != -1; irq--) {
-		if (eirr & (1ULL << irq))
+		if (pending & (1ULL << irq))
 			break;
 		else if (eirr & (1ULL << irq)) {/* eirr also must be cleared */
 			write_64bit_cp0_eirr(1ULL << irq);
-- 
1.6.0.4

