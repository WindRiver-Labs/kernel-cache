From d54f8abb266232a65b92a41151210e747c1eb10a Mon Sep 17 00:00:00 2001
From: Ralf Baechle <ralf.baechle@windriver.com>
Date: Tue, 11 Aug 2009 15:47:16 +0100
Subject: [PATCH] rmi: EDAC fixes

In violation of all Linux conventions the macros to access on-chip register
on RMI take a register number, not a register address.  So divide all the
offsets from the base register address by 4.  We can miraculously seem to
get away with this bug most of the time if the rmi-edac-dram driver is
compiled into the kernel while the bug manifests itself consistently if the
driver is a module.

Signed-off-by: Ralf Baechle <ralf.baechle@windriver.com>
---
 drivers/edac/rmi-edac-dram.c |   16 ++++++++--------
 1 files changed, 8 insertions(+), 8 deletions(-)

diff --git a/drivers/edac/rmi-edac-dram.c b/drivers/edac/rmi-edac-dram.c
index 5a1a189..f8c6865 100644
--- a/drivers/edac/rmi-edac-dram.c
+++ b/drivers/edac/rmi-edac-dram.c
@@ -27,14 +27,14 @@ struct rmi_lmc_priv {
 /*
  * There should be a header file for these
  */
-#define DDR_GLB_PARAMS			0x01c
-#define   ECC_REPORT_EN			(1 << 11)
-#define   ECC_EN			(1 <<  5)	/* B stepping only */
-#define   ECC_DETECT_EN			(1 <<  5)
-
-#define DDR_CFG_REG_RMW_ECC_LOG_HI	0x08c
-#define   ECC_LOG_C			(1 <<  1)
-#define   ECC_LOG_U			(1 <<  0)
+#define DDR_GLB_PARAMS			(0x01c >> 2)
+#define   ECC_REPORT_EN			(1    << 11)
+#define   ECC_EN			(1    <<  5)	/* B stepping only */
+#define   ECC_DETECT_EN			(1    <<  5)
+
+#define DDR_CFG_REG_RMW_ECC_LOG_HI	(0x08c >> 2)
+#define   ECC_LOG_C			(1    <<  1)
+#define   ECC_LOG_U			(1    <<  0)
 
 
 static void rmi_lmc_poll_channel(struct mem_ctl_info *mci, unsigned long offset,
-- 
1.6.0.4

