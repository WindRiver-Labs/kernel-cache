From dbb956ae6a9aaf0ded8de8f9926c9474c62a7cbe Mon Sep 17 00:00:00 2001
From: Jack Tan <jack.tan@windriver.com>
Date: Tue, 16 Dec 2008 19:06:59 +0800
Subject: [PATCH] rmi xlr tlb management support

Add XLR's TLB refill, TLB load, TLB store and TLB modify handler support.

XLR TLB's coherency attribute bit has a little diffrence so add its private
defination.

Signed-off-by: Jack Tan <jack.tan@windriver.com>
---
 arch/mips/lib/Makefile          |    1 +
 arch/mips/mm/tlbex.c            |    1 +
 include/asm-mips/pgtable-bits.h |    6 ++++++
 3 files changed, 8 insertions(+), 0 deletions(-)

diff --git a/arch/mips/lib/Makefile b/arch/mips/lib/Makefile
index f454a97..06e2576 100644
--- a/arch/mips/lib/Makefile
+++ b/arch/mips/lib/Makefile
@@ -28,6 +28,7 @@ obj-$(CONFIG_CPU_SB1)		+= dump_tlb.o
 obj-$(CONFIG_CPU_TX39XX)	+= r3k_dump_tlb.o
 obj-$(CONFIG_CPU_TX49XX)	+= dump_tlb.o
 obj-$(CONFIG_CPU_VR41XX)	+= dump_tlb.o
+obj-$(CONFIG_CPU_PHOENIX)	+= dump_tlb.o
 
 # libgcc-style stuff needed in the kernel
 obj-y += ashldi3.o ashrdi3.o cmpdi2.o lshrdi3.o ucmpdi2.o
diff --git a/arch/mips/mm/tlbex.c b/arch/mips/mm/tlbex.c
index 51a8116..86b5698 100644
--- a/arch/mips/mm/tlbex.c
+++ b/arch/mips/mm/tlbex.c
@@ -336,6 +336,7 @@ static void __cpuinit build_tlb_write_entry(u32 **p, struct uasm_label **l,
 	case CPU_BCM4710:
 	case CPU_LOONGSON2:
 	case CPU_R5500:
+	case CPU_PHOENIX:
 		if (m4kc_tlbp_war())
 			uasm_i_nop(p);
 		tlbw(p);
diff --git a/include/asm-mips/pgtable-bits.h b/include/asm-mips/pgtable-bits.h
index 51b34a4..1efa42b 100644
--- a/include/asm-mips/pgtable-bits.h
+++ b/include/asm-mips/pgtable-bits.h
@@ -101,6 +101,12 @@
 #define _CACHE_CACHABLE_NONCOHERENT (5<<_CACHE_SHIFT)
 #define _CACHE_UNCACHED_ACCELERATED (7<<_CACHE_SHIFT)
 
+#elif defined(CONFIG_CPU_PHOENIX)
+
+#define _CACHE_UNCACHED             (2<<9)
+#define _CACHE_CACHABLE_COW         (3<<9)
+#define _CACHE_CACHABLE_NONCOHERENT (3<<9)
+
 #elif defined(CONFIG_CPU_RM9000)
 
 #define _CACHE_WT		    (0<<_CACHE_SHIFT)
-- 
1.7.0

