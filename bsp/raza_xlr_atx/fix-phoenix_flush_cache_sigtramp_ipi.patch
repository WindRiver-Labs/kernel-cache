From d789dc467e2d574394110d3b0e30363b50447f7c Mon Sep 17 00:00:00 2001
From: Lans Zhang <jia.zhang@windriver.com>
Date: Tue, 12 Oct 2010 10:08:32 +0800
Subject: [PATCH] fix phoenix_flush_cache_sigtramp_ipi

The typecasting from unsigned int to unsigned long is performed on target
address which is to be flushed, which will lead to a zero-extending, hence a
potential cache coherence error may occurs in future.

Signed-off-by: Lans Zhang <jia.zhang@windriver.com>
---
 arch/mips/mm/c-phoenix.c |    2 +-
 1 files changed, 1 insertions(+), 1 deletions(-)

diff --git a/arch/mips/mm/c-phoenix.c b/arch/mips/mm/c-phoenix.c
index 05404fd..43be84f 100644
--- a/arch/mips/mm/c-phoenix.c
+++ b/arch/mips/mm/c-phoenix.c
@@ -178,7 +178,7 @@ static void phoenix_flush_cache_sigtramp_ipi(void *info)
 
 	optimize_thread_flush();
 
-	addr = addr & ~(icache_linesz - 1);
+	addr = addr & ~((unsigned long)(icache_linesz - 1));
 	cacheop_extable(Hit_Invalidate_I, addr);
 	cacheop_sync_istream();
 }
-- 
1.7.0.4

