From 5d50c668d9204d6f2168af3201c30c77b01efaaa Mon Sep 17 00:00:00 2001
From: Paul Gortmaker <paul.gortmaker@windriver.com>
Date: Sun, 21 Jun 2009 12:44:09 -0400
Subject: [PATCH] rmi: delete duplicate pic function

There was a pic_unmask introduced that was just a direct
copy of pic_startup, and there was also assignments of
these to irq_chip fields that weren't previously assigned
in the 2.6.21 based kernel.  Delete the clone and set the
assignments back to what they were in 2.6.21 since I see
no justification for the change.

Signed-off-by: Paul Gortmaker <paul.gortmaker@windriver.com>
---
 arch/mips/rmi/phoenix/irq.c |   33 ++-------------------------------
 1 files changed, 2 insertions(+), 31 deletions(-)

diff --git a/arch/mips/rmi/phoenix/irq.c b/arch/mips/rmi/phoenix/irq.c
index 723db5b..8be3b7b 100644
--- a/arch/mips/rmi/phoenix/irq.c
+++ b/arch/mips/rmi/phoenix/irq.c
@@ -95,35 +95,6 @@ static unsigned int pic_startup(unsigned int irq)
 	return 0;
 }
 
-static void pic_unmask(unsigned int irq)
-{
-	phoenix_reg_t *mmio = phoenix_io_mmio(PHOENIX_IO_PIC_OFFSET);
-	unsigned long flags;
-	phoenix_reg_t reg;
-
-	if (!PIC_IRQ_IS_IRT(irq))
-		return;
-
-	spin_lock_irqsave(&phnx_pic_lock, flags);
-
-	/*
-	 * What happens if this irq was previously not ack'ed? 
-	 * Assume, that doesn't happen?
-	*/
-	reg = phoenix_read_reg(mmio, PIC_IRT_1_BASE + irq - PIC_IRQ_BASE);
-
-	/* 
-	 * By default all the interrupts are initialized as level senstive 
-	 * fix for the PCMCIA flash 
-	*/
-	phoenix_write_reg(mmio, PIC_IRT_1_BASE + irq - PIC_IRQ_BASE,
-					  reg | (1 << 6) | (1 << 30) | (1 << 31));
-
-	spin_unlock_irqrestore(&phnx_pic_lock, flags);
-
-	return;
-}
-
 static void pic_ack(unsigned int irq)
 {
 	phoenix_reg_t *mmio = phoenix_io_mmio(PHOENIX_IO_PIC_OFFSET);
@@ -291,8 +262,8 @@ static void pic_set_affinity(unsigned int irq, cpumask_t mask)
 
 static struct irq_chip phnx_pic = {
 	.name = "Phoenix-PIC",
-	.unmask = pic_unmask,
-	.mask = pic_shutdown,
+	.startup = pic_startup,
+	.shutdown = pic_shutdown,
 	.ack = pic_ack,
 	.end = pic_end,
 	.set_affinity = pic_set_affinity
-- 
1.6.0.4

