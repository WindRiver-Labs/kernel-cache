From 07597c22781b2fc4177ac638ab251e9fb28ce0f1 Mon Sep 17 00:00:00 2001
From: David Daney <ddaney@caviumnetworks.com>
Date: Wed, 8 Sep 2010 10:32:58 -0700
Subject: [PATCH 64/97] netdev: octeon-ethernet: Use IRQF_DISABLED in RX interrupts.

Source: Cavium SDK 2.1.0-407

Stack overflows have been seen.  There is no reason to nest interrupts
here, so run with IRQF_DISABLED.

Signed-off-by: David Daney <ddaney@caviumnetworks.com>
Integrated-by: Phil Staub <Phil.Staub@windriver.com>
---
 drivers/net/octeon/ethernet-rx.c |    2 ++
 1 files changed, 2 insertions(+), 0 deletions(-)

diff --git a/drivers/net/octeon/ethernet-rx.c b/drivers/net/octeon/ethernet-rx.c
index abfe5fd..09c91a9 100644
--- a/drivers/net/octeon/ethernet-rx.c
+++ b/drivers/net/octeon/ethernet-rx.c
@@ -345,6 +345,8 @@ void cvm_oct_rx_initialize(int num_wqe)
 	/* Register an IRQ hander for to receive POW interrupts */
 #ifdef  CONFIG_PREEMPT_HARDIRQS
 	irq_flags = IRQF_NODELAY;
+#else
+	irq_flags = IRQF_DISABLED;
 #endif
 	i = request_irq(OCTEON_IRQ_WORKQ0 + pow_receive_group,
 			cvm_oct_do_interrupt, irq_flags, dev_for_napi->name, &cvm_oct_list);
-- 
1.7.0

