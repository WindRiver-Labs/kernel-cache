From afd7052da98e34fece4f3aad14ee68d06082cde8 Mon Sep 17 00:00:00 2001
From: Chad Reese <kreese@caviumnetworks.com>
Date: Wed, 1 Dec 2010 08:58:45 -0800
Subject: [PATCH 78/97] Octeon: Wrap PTP clock workaround for CN63XXp1

Source: Cavium SDK 2.1.0-407

Use wrapper function for reading PTP clock so CN63XXp1 errata
workaround is only applied when necessary.

Signed-off-by: Chad Reese <kreese@caviumnetworks.com>
Integrated-by: Phil Staub <Phil.Staub@windriver.com>
---
 drivers/net/octeon/octeon_mgmt.c |    4 +---
 1 files changed, 1 insertions(+), 3 deletions(-)

diff --git a/drivers/net/octeon/octeon_mgmt.c b/drivers/net/octeon/octeon_mgmt.c
index 5763f84..6adadd1 100644
--- a/drivers/net/octeon/octeon_mgmt.c
+++ b/drivers/net/octeon/octeon_mgmt.c
@@ -215,9 +215,7 @@ static ktime_t ptp_to_ktime(uint64_t ptptime)
 	    important that this sequence take the same amount of time to
 	    reduce jitter */
 	ktimebase = ktime_get_real();
-	/* FIXME: Needed for CN63XX errata */
-	cvmx_read_csr(CVMX_MIO_PTP_CLOCK_HI);
-	ptpbase = cvmx_read_csr(CVMX_MIO_PTP_CLOCK_HI);
+	ptpbase = octeon_read_ptp_csr(CVMX_MIO_PTP_CLOCK_HI);
 	local_irq_restore(flags);
 
 	return ktime_sub_ns(ktimebase, ptpbase - ptptime);
-- 
1.7.0

