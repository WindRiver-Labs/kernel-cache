From 106a21c8c4fcfc05443f0c41a66a6018b79a024c Mon Sep 17 00:00:00 2001
From: David Daney <ddaney@caviumnetworks.com>
Date: Mon, 9 May 2011 16:09:51 -0700
Subject: [PATCH 38/97] MIPS: Octeon: PCIe initialization

Source: Cavium SDK 2.1.0-407

Always call octeon_pci_dma_init() for PCIe. It was only being called
if PCIe port 1 was in host mode.

Signed-off-by: David Daney <ddaney@caviumnetworks.com>
Integrated-by: Phil Staub <Phil.Staub@windriver.com>
---
 arch/mips/pci/pcie-octeon.c |    3 ++-
 1 files changed, 2 insertions(+), 1 deletions(-)

diff --git a/arch/mips/pci/pcie-octeon.c b/arch/mips/pci/pcie-octeon.c
index 0252d89..84e8915 100644
--- a/arch/mips/pci/pcie-octeon.c
+++ b/arch/mips/pci/pcie-octeon.c
@@ -675,7 +675,6 @@ static int __init octeon_pcie_setup(void)
 			enable_pcie_bus_num_war[1] =
 				device_needs_bus_num_war(device0);
 		}
-		octeon_pci_dma_init();
 	} else {
 		pr_notice("PCIe: Port 1 not in root complex mode, skipping.\n");
 		/* CN63XX pass 1_x/2.0 errata PCIe-15205  */
@@ -715,6 +714,8 @@ static int __init octeon_pcie_setup(void)
 		}
 	}
 
+	octeon_pci_dma_init();
+
 	return 0;
 }
 arch_initcall(octeon_pcie_setup);
-- 
1.7.0

