From f8b40419e2dd4cf0be213300e0456a6c0b0fe2ce Mon Sep 17 00:00:00 2001
From: Fan Du <fan.du@windriver.com>
Date: Wed, 5 Dec 2012 13:46:12 +0800
Subject: [PATCH 5/5] nlm_xlp_64_be : modify config option for more than 16GB memory support

More than 16GB memory feature is NLM_XLP bsp specific, so modify Kconfig accordingly.

Signed-off-by: Fan Du <fan.du@windriver.com>
---
 arch/mips/Kconfig |   14 ++++++++------
 1 files changed, 8 insertions(+), 6 deletions(-)

diff --git a/arch/mips/Kconfig b/arch/mips/Kconfig
index 9116736..4e07d8a 100644
--- a/arch/mips/Kconfig
+++ b/arch/mips/Kconfig
@@ -1602,7 +1602,9 @@ config 64BIT
 
 config NLM_16G_MEM_SUPPORT
 	bool "more than 16GB memory support"
-	depends on 64BIT
+	depends on 64BIT && NLM_XLP
+	select PAGE_SIZE_64KB
+	select HUGETLBFS
 	help
 	  Support more than 16GB memory
 
@@ -1614,7 +1616,7 @@ choice
 
 config PAGE_SIZE_4KB
 	bool "4kB"
-	depends on !CPU_LOONGSON2
+	depends on !CPU_LOONGSON2 && !NLM_16G_MEM_SUPPORT
 	help
 	 This option select the standard 4kB Linux page size.  On some
 	 R3000-family processors this is the only available page size.  Using
@@ -1623,7 +1625,7 @@ config PAGE_SIZE_4KB
 
 config PAGE_SIZE_8KB
 	bool "8kB"
-	depends on (EXPERIMENTAL && CPU_R8000) || CPU_CAVIUM_OCTEON
+	depends on ((EXPERIMENTAL && CPU_R8000) || CPU_CAVIUM_OCTEON) && !NLM_16G_MEM_SUPPORT
 	help
 	  Using 8kB page size will result in higher performance kernel at
 	  the price of higher memory consumption.  This option is available
@@ -1632,7 +1634,7 @@ config PAGE_SIZE_8KB
 
 config PAGE_SIZE_16KB
 	bool "16kB"
-	depends on !CPU_R3000 && !CPU_TX39XX
+	depends on !CPU_R3000 && !CPU_TX39XX && !NLM_16G_MEM_SUPPORT
 	help
 	  Using 16kB page size will result in higher performance kernel at
 	  the price of higher memory consumption.  This option is available on
@@ -1641,7 +1643,7 @@ config PAGE_SIZE_16KB
 
 config PAGE_SIZE_32KB
 	bool "32kB"
-	depends on CPU_CAVIUM_OCTEON
+	depends on CPU_CAVIUM_OCTEON && !NLM_16G_MEM_SUPPORT
 	help
 	  Using 32kB page size will result in higher performance kernel at
 	  the price of higher memory consumption.  This option is available
@@ -1650,7 +1652,7 @@ config PAGE_SIZE_32KB
 
 config PAGE_SIZE_64KB
 	bool "64kB"
-	depends on EXPERIMENTAL && !CPU_R3000 && !CPU_TX39XX
+	depends on EXPERIMENTAL && !CPU_R3000 && !CPU_TX39XX && NLM_16G_MEM_SUPPORT
 	help
 	  Using 64kB page size will result in higher performance kernel at
 	  the price of higher memory consumption.  This option is available on
-- 
1.7.0

