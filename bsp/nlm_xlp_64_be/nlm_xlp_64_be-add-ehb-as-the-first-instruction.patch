From 69416ccbeb8ae10aed16b3caaffc6e041f60ffe9 Mon Sep 17 00:00:00 2001
From: Yanjiang Jin <yanjiang.jin@windriver.com>
Date: Tue, 21 Aug 2012 13:17:05 +0800
Subject: [PATCH 2/2] nlm_xlp_64_be: add "ehb" as the first instruction

errata: add "ehb" as the first instruction of NMI exception handler

This is to work around the hardware issue for an interrupt occurring
after a branch-likely instruction has executed but before its
delay-slot has.

Signed-off-by: Yonghong Song <ysong@broadcom.com>
Integrated-by: Yanjiang Jin <yanjiang.jin@windriver.com>
---
 arch/mips/netlogic/xlp/nmi.S |    1 +
 1 files changed, 1 insertions(+), 0 deletions(-)

diff --git a/arch/mips/netlogic/xlp/nmi.S b/arch/mips/netlogic/xlp/nmi.S
index 0a1d321..13bc72a 100644
--- a/arch/mips/netlogic/xlp/nmi.S
+++ b/arch/mips/netlogic/xlp/nmi.S
@@ -44,6 +44,7 @@ NESTED(nlm_except_vec_nmi, 0, sp)
 	.set noat
 	.set mips64
 	.set noreorder
+	sll 	zero, 3		# ehb
 1:	wait
 	b	1b
 	nop
-- 
1.7.0

