From 6a1306fd0596acf80f04dd7e6ed360264529f2e4 Mon Sep 17 00:00:00 2001
From: Yanjiang Jin <yanjiang.jin@windriver.com>
Date: Mon, 27 Aug 2012 14:34:41 +0800
Subject: [PATCH 1/3] nlm_xlp_64_be: Restore SCHED_DEFEATURE workaround

errata: Scheduler Q3 priority of BR/ALU ops can encounter a livelock state.

Restore SCHED_DEFEATURE workaround for XLP Bx too.

Signed-off-by: Yonghong Song <ysong@broadcom.com>
Integrated-by: Yanjiang Jin <yanjiang.jin@windriver.com>
---
 arch/mips/netlogic/xlp/cpu_control.c | 3 +++
 1 file changed, 3 insertions(+)

diff --git a/arch/mips/netlogic/xlp/cpu_control.c b/arch/mips/netlogic/xlp/cpu_control.c
index 874a9b4..4ec469f 100644
--- a/arch/mips/netlogic/xlp/cpu_control.c
+++ b/arch/mips/netlogic/xlp/cpu_control.c
@@ -102,6 +102,9 @@ static inline void config_lsu(void)
 			"lui     %2, 0x4080\n"
 			"or      %1, %1, %2\n"
 			"mtcr    %1, %0\n"
+			"li      %0, "STR(SCHED_DEFEATURE)"\n"
+			"lui     %1, 0x0100\n"
+			"mtcr    %1, %0\n"
 			".set pop\n"
 			: "=r" (tmp0), "=r" (tmp1), "=r" (tmp2)
 		);
-- 
1.7.11

