From d0558f8b42deffab917c107653e99fa98d1fb0eb Mon Sep 17 00:00:00 2001
From: Lavi Mandy-R52568 <R52568@freescale.com>
Date: Fri, 22 Feb 2013 00:06:02 +0000
Subject: [PATCH 061/518] FMD: remove the duplicate execution of 10GMAC_A004

Rich,
I'm OK with it. Please apply.
Thanks,
 Mandy

-----Original Message-----
From: Wang Haiying-R54964
Sent: Thursday, February 21, 2013 19:16
To: linuxppc-dev@linux.freescale.net; Lavi Mandy-R52568
Subject: [PATCH v2 sdkv1.3.x] FMD: remove the duplicate execution of 10GMAC_A004

The 10GMAC_A004 is applied twice in TgecInit(), which returns error before executing tgec_init() and breaks the 10G initialization. In kerenl bootup, it
prints:
"
cpu2: Applying 10G TX ECC workaround (10GMAC-A004) ...
cpu2: done.
cpu2: Applying 10G TX ECC workaround (10GMAC-A004) ...
cpu2: FAILED!
cpu2: ! MINOR FM-MAC Error [CPU02, drivers/net/ethernet/freescale/dpa/NetCommSw/Peripherals/FM/MAC/tgec.c:840 TgecInit]: Operation Timed Out;
cpu2: TgecTxEccWorkaround FAILED
"
This patch fixes this error.

Signed-off-by: Haiying Wang <Haiying.Wang@freescale.com>
[Grabbed from the branch, LINUX_IR5.2.0, of
https://git.freescale.com/git-private/cgit.cgi/ppc/alu-b4860/linux.git.]
Signed-off-by: Tiejun Chen <tiejun.chen@windriver.com>
---
 .../dpa/NetCommSw/Peripherals/FM/MAC/tgec.c        |   12 ------------
 1 files changed, 0 insertions(+), 12 deletions(-)

diff --git a/drivers/net/ethernet/freescale/dpa/NetCommSw/Peripherals/FM/MAC/tgec.c b/drivers/net/ethernet/freescale/dpa/NetCommSw/Peripherals/FM/MAC/tgec.c
index 3cc1440..522d64b 100644
--- a/drivers/net/ethernet/freescale/dpa/NetCommSw/Peripherals/FM/MAC/tgec.c
+++ b/drivers/net/ethernet/freescale/dpa/NetCommSw/Peripherals/FM/MAC/tgec.c
@@ -805,18 +805,6 @@ static t_Error TgecInit(t_Handle h_Tgec)
     FM_GetRevision(p_Tgec->fmMacControllerDriver.h_Fm, &p_Tgec->fmMacControllerDriver.fmRevInfo);
     CHECK_INIT_PARAMETERS(p_Tgec, CheckInitParameters);
 
-#ifdef FM_TX_ECC_FRMS_ERRATA_10GMAC_A004
-    if (p_Tgec->fmMacControllerDriver.fmRevInfo.majorRev <= 6 /*fixed for rev3 */)
-    {
-        if (!p_Tgec->p_TgecDriverParam->skip_fman11_workaround &&
-            ((err = TgecTxEccWorkaround(p_Tgec)) != E_OK))
-        {
-            FreeInitResources(p_Tgec);
-            RETURN_ERROR(MAJOR, err, ("TgecTxEccWorkaround FAILED"));
-        }
-    }
-#endif /* FM_TX_ECC_FRMS_ERRATA_10GMAC_A004 */
-
     p_TgecDriverParam = p_Tgec->p_TgecDriverParam;
 
     MAKE_ENET_ADDR_FROM_UINT64(p_Tgec->addr, ethAddr);
-- 
1.7.5.4

