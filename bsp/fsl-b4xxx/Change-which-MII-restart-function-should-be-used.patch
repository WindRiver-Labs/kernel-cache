From 3321e8917f647d0e0858885889ca3185ba566485 Mon Sep 17 00:00:00 2001
From: Mandy Lavi <mandy.lavi@freescale.com>
Date: Sun, 7 Apr 2013 18:38:24 +0300
Subject: [PATCH 21/36] Change which MII restart function should be used

DtsecRestartTbiAN() no longer exists

Signed-off-by: Mandy Lavi <mandy.lavi@freescale.com>
[Grabbed from the branch, LINUX_IR5.3.0_ALPHA, of
https://git.freescale.com/git-private/cgit.cgi/ppc/dpaa-offload/linux.git.]
Signed-off-by: Tiejun Chen <tiejun.chen@windriver.com>
---
 .../dpa/NetCommSw/src/wrapper/lnxwrp_fm_port.c     |    1 -
 drivers/net/ethernet/freescale/dpa/mac-api.c       |    5 ++---
 2 files changed, 2 insertions(+), 4 deletions(-)

diff --git a/drivers/net/ethernet/freescale/dpa/NetCommSw/src/wrapper/lnxwrp_fm_port.c b/drivers/net/ethernet/freescale/dpa/NetCommSw/src/wrapper/lnxwrp_fm_port.c
index be169be..7c83f83 100644
--- a/drivers/net/ethernet/freescale/dpa/NetCommSw/src/wrapper/lnxwrp_fm_port.c
+++ b/drivers/net/ethernet/freescale/dpa/NetCommSw/src/wrapper/lnxwrp_fm_port.c
@@ -1212,7 +1212,6 @@ static int /*__devinit*/ fm_port_probe(struct platform_device *of_dev)
 		       p_LnxWrpFmDev->name, p_LnxWrpFmPortDev->id);
 		p_LnxWrpFmPortDev->minor =
 			p_LnxWrpFmPortDev->id + DEV_FM_OH_PORTS_MINOR_BASE;
-//		p_LnxWrpFmPortDev->h_Dev = FM_PCD_GetHcDevH(p_LnxWrpFmDev->h_PcdDev);
 	} else if (p_LnxWrpFmPortDev->settings.param.portType ==
 		 e_FM_PORT_TYPE_OH_OFFLINE_PARSING) {
 		Sprint(p_LnxWrpFmPortDev->name, "%s-port-oh%d",
diff --git a/drivers/net/ethernet/freescale/dpa/mac-api.c b/drivers/net/ethernet/freescale/dpa/mac-api.c
index 43e0b8d..4dce072 100644
--- a/drivers/net/ethernet/freescale/dpa/mac-api.c
+++ b/drivers/net/ethernet/freescale/dpa/mac-api.c
@@ -442,9 +442,8 @@ static void adjust_link(struct net_device *net_dev)
 		fsl_pq_mdio_lock(NULL);
 
 		mac_priv = (struct mac_priv_s *)macdev_priv(mac_dev);
-//		DtsecRestartTbiAN(mac_priv->mac);
-
-		fsl_pq_mdio_unlock(NULL);
+	        FM_MAC_RestartAutoneg(mac_priv->mac);
+	        fsl_pq_mdio_unlock(NULL);
 		return;
 	}
 
-- 
1.7.5.4

