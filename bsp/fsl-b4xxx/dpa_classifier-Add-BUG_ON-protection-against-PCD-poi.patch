From 17b5f9defb1b57e2751f41273134401a59889404 Mon Sep 17 00:00:00 2001
From: Marian Chereji <marian.chereji@freescale.com>
Date: Wed, 12 Sep 2012 16:08:11 +0000
Subject: [PATCH 317/518] dpa_classifier: Add BUG_ON protection against PCD
 pointer errors

Occasionally, the PCD handle received from FMLib was noticed to
be NULL. As this is an abnormal result, a BUG_ON statement was
added to protect against such NULL handles.

Signed-off-by: Marian Chereji <marian.chereji@freescale.com>
[Grabbed from the branch, LINUX_IR5.2.0, of
https://git.freescale.com/git-private/cgit.cgi/ppc/alu-b4860/linux.git.]
Signed-off-by: Tiejun Chen <tiejun.chen@windriver.com>
---
 .../staging/fsl_dpa_offload/wrp_dpa_classifier.c   |    4 +++-
 1 files changed, 3 insertions(+), 1 deletions(-)

diff --git a/drivers/staging/fsl_dpa_offload/wrp_dpa_classifier.c b/drivers/staging/fsl_dpa_offload/wrp_dpa_classifier.c
index 7c9b24e..a75b212 100644
--- a/drivers/staging/fsl_dpa_offload/wrp_dpa_classifier.c
+++ b/drivers/staging/fsl_dpa_offload/wrp_dpa_classifier.c
@@ -1978,7 +1978,9 @@ void *translate_fm_pcd_handle(void *fm_pcd)
 			__FILE__, __func__, __LINE__);
 		return NULL;
 	}
-	fm_wrapper_dev = ((t_LnxWrpFmDev *)fm_pcd_file->private_data);
+	fm_wrapper_dev = (t_LnxWrpFmDev *)fm_pcd_file->private_data;
+	BUG_ON(!fm_wrapper_dev);
+	BUG_ON(!fm_wrapper_dev->h_PcdDev);
 
 	return (void *)fm_wrapper_dev->h_PcdDev;
 }
-- 
1.7.5.4

