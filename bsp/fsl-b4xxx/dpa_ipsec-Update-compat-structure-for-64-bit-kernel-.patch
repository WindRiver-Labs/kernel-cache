From c78ca02dae39af6c6b6d5b7329e6b6933fcbce3d Mon Sep 17 00:00:00 2001
From: Bulie Radu-Andrei-B37577 <radu.bulie@freescale.com>
Date: Fri, 9 Nov 2012 19:35:08 +0000
Subject: [PATCH 399/518] dpa_ipsec: Update compat structure for 64 bit kernel
 due to changes in ipsec API

New changes were made in policy_dir_param structure - external manip
descriptor was added.

This patch updates the corresponding compat structure used during
ioctl system calls.

Signed-off-by: Bulie Radu-Andrei-B37577 <radu.bulie@freescale.com>
[Grabbed from the branch, LINUX_IR5.2.0, of
https://git.freescale.com/git-private/cgit.cgi/ppc/alu-b4860/linux.git.]
Signed-off-by: Tiejun Chen <tiejun.chen@windriver.com>
---
 drivers/staging/fsl_dpa_offload/dpa_ipsec_ioctl.h |    2 +-
 drivers/staging/fsl_dpa_offload/wrp_dpa_ipsec.c   |   12 ++++++------
 2 files changed, 7 insertions(+), 7 deletions(-)

diff --git a/drivers/staging/fsl_dpa_offload/dpa_ipsec_ioctl.h b/drivers/staging/fsl_dpa_offload/dpa_ipsec_ioctl.h
index 2dbe01c..3d385ba 100644
--- a/drivers/staging/fsl_dpa_offload/dpa_ipsec_ioctl.h
+++ b/drivers/staging/fsl_dpa_offload/dpa_ipsec_ioctl.h
@@ -144,7 +144,7 @@ struct ioc_dpa_ipsec_add_rem_policy {
 struct ioc_compat_pol_dir_params {
 	enum dpa_ipsec_pol_dir_params_type type;
 	union {
-		struct dpa_ipsec_pol_frag_params out_frag;
+		int manip_desc;
 		struct dpa_cls_compat_tbl_action in_action;
 	};
 };
diff --git a/drivers/staging/fsl_dpa_offload/wrp_dpa_ipsec.c b/drivers/staging/fsl_dpa_offload/wrp_dpa_ipsec.c
index 70ed191..24dae25 100644
--- a/drivers/staging/fsl_dpa_offload/wrp_dpa_ipsec.c
+++ b/drivers/staging/fsl_dpa_offload/wrp_dpa_ipsec.c
@@ -287,9 +287,9 @@ static void compat_copy_dpa_ipsec_add_rem_policy(
 		memset(&prm->pol_params.dir_params, 0,
 					    sizeof(prm->pol_params.dir_params));
 		if (compat_prm->pol_params.dir_params.type ==
-						DPA_IPSEC_POL_DIR_PARAMS_FRAG)
-			prm->pol_params.dir_params.out_frag =
-				     compat_prm->pol_params.dir_params.out_frag;
+						DPA_IPSEC_POL_DIR_PARAMS_MANIP)
+			prm->pol_params.dir_params.manip_desc =
+				   compat_prm->pol_params.dir_params.manip_desc;
 		else if (compat_prm->pol_params.dir_params.type ==
 						 DPA_IPSEC_POL_DIR_PARAMS_ACT) {
 			dpa_cls_tbl_action_params_compatcpy(
@@ -313,9 +313,9 @@ static void compat_copy_dpa_ipsec_add_rem_policy(
 		memset(&compat_prm->pol_params.dir_params, 0,
 		       sizeof(compat_prm->pol_params.dir_params));
 		if (prm->pol_params.dir_params.type ==
-						DPA_IPSEC_POL_DIR_PARAMS_FRAG)
-			compat_prm->pol_params.dir_params.out_frag =
-					    prm->pol_params.dir_params.out_frag;
+						DPA_IPSEC_POL_DIR_PARAMS_MANIP)
+			compat_prm->pol_params.dir_params.manip_desc =
+					  prm->pol_params.dir_params.manip_desc;
 		else if (prm->pol_params.dir_params.type ==
 						 DPA_IPSEC_POL_DIR_PARAMS_ACT) {
 			dpa_cls_tbl_action_params_rcompatcpy(
-- 
1.7.5.4

