From 769e618e5d54a4d6c185d066a8a9ad7a19289fed Mon Sep 17 00:00:00 2001
From: Mihai Serb <mihai.serb@freescale.com>
Date: Thu, 9 Aug 2012 15:02:21 +0000
Subject: [PATCH 274/518] dpa_ipsec: Remove precision loss warnings

Add explicit cast to remove compiler and static analysis tools
warnings about precision loss when dealing with flowID values and
key sizes.

Although the flowID can take values in the range 0 to max(uint16_t)
the indexed tables used to classify frames based on the value of
this field can hold maximum 256 entries so the key in such a table is
actually an uint8_t value.

Similarly the maximum key size is 56 bytes.

Signed-off-by: Mihai Serb <mihai.serb@freescale.com>
[Grabbed from the branch, LINUX_IR5.2.0, of
https://git.freescale.com/git-private/cgit.cgi/ppc/alu-b4860/linux.git.]
Signed-off-by: Tiejun Chen <tiejun.chen@windriver.com>
---
 drivers/staging/fsl_dpa_offload/dpa_ipsec.c |    7 ++++---
 1 files changed, 4 insertions(+), 3 deletions(-)

diff --git a/drivers/staging/fsl_dpa_offload/dpa_ipsec.c b/drivers/staging/fsl_dpa_offload/dpa_ipsec.c
index e8a0169..d983610 100644
--- a/drivers/staging/fsl_dpa_offload/dpa_ipsec.c
+++ b/drivers/staging/fsl_dpa_offload/dpa_ipsec.c
@@ -977,8 +977,8 @@ static int set_in_sa_default_action(struct dpa_ipsec_sa *sa)
 	dpa_ipsec = (struct dpa_ipsec *)sa->dpa_ipsec;
 	BUG_ON(!dpa_ipsec);
 
-	/* AV's note: TODO - case when inbound_flowid is greater than 255 */
-	key_data	= sa->inbound_flowid;
+	/* Currently the flowid cannot be greater than 255 */
+	key_data	= (uint8_t)sa->inbound_flowid;
 	tbl_key.byte	= &key_data;
 	tbl_key.mask	= NULL;
 	tbl_key.size	= 1;
@@ -1559,7 +1559,8 @@ static int update_pre_sec_inbound_table(struct dpa_ipsec_sa *sa,
 			offset = tbl_key_size;
 		}
 
-		tbl_key.size = offset;
+		/* Key size cannot be greater than 56 bytes */
+		tbl_key.size = (uint8_t)offset;
 
 		/* Complete the parameters for table insert function */
 		memset(&action, 0, sizeof(action));
-- 
1.7.5.4

