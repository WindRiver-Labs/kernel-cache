From 780d6e2e2da7183e8d6ff039621ee68a458f105c Mon Sep 17 00:00:00 2001
From: Mihai Serb <mihai.serb@freescale.com>
Date: Thu, 15 Mar 2012 22:07:50 +0000
Subject: [PATCH 118/518] Remove duplicate definition of IPv4 header structure

Remove structure definition for IPv4 header from dpa_ipsec.h and
replace it with the system defined one (in ip.h) throughout the
DPA IPsec code.

Signed-off-by: Mihai Serb <mihai.serb@freescale.com>
[Grabbed from the branch, LINUX_IR5.2.0, of
https://git.freescale.com/git-private/cgit.cgi/ppc/alu-b4860/linux.git.]
Signed-off-by: Tiejun Chen <tiejun.chen@windriver.com>
---
 drivers/staging/fsl_dpa_offload/dpa_ipsec.c |    6 +++---
 drivers/staging/fsl_dpa_offload/dpa_ipsec.h |   17 +++--------------
 2 files changed, 6 insertions(+), 17 deletions(-)

diff --git a/drivers/staging/fsl_dpa_offload/dpa_ipsec.c b/drivers/staging/fsl_dpa_offload/dpa_ipsec.c
index 41b9055..db97f57 100644
--- a/drivers/staging/fsl_dpa_offload/dpa_ipsec.c
+++ b/drivers/staging/fsl_dpa_offload/dpa_ipsec.c
@@ -1800,7 +1800,7 @@ static inline int set_cipher_auth_alg(enum dpa_ipsec_cipher_alg alg_suite,
 static int copy_sa_params_to_out_sa(struct dpa_ipsec_sa *sa,
 				    struct dpa_ipsec_sa_params *sa_params)
 {
-	struct ip_header *outer_ip_hdr;
+	struct iphdr *outer_ip_hdr;
 	int err;
 
 	/* sanity checks */
@@ -1886,7 +1886,7 @@ static int copy_sa_params_to_out_sa(struct dpa_ipsec_sa *sa,
 				sa_params->sa_out_params.ip_hdr_size;
 	}
 
-	outer_ip_hdr = (struct ip_header *) &sa->sec_desc->pdb_en.ip_hdr[0];
+	outer_ip_hdr = (struct iphdr *) &sa->sec_desc->pdb_en.ip_hdr[0];
 	outer_ip_hdr->check = ip_fast_csum((unsigned char *)outer_ip_hdr,
 					   outer_ip_hdr->ihl);
 
@@ -1987,7 +1987,7 @@ static int copy_sa_params_to_in_sa(struct dpa_ipsec_sa *sa,
 	/* Updated the offset to the point in frame were the encrypted
 	 * stuff starts.*/
 	sa->sec_desc->pdb_dec.hmo_ip_hdr_len =
-					(uint16_t) sizeof(struct ip_header);
+					(uint16_t) sizeof(struct iphdr);
 	if (sa->use_udp_encap)
 		sa->sec_desc->pdb_dec.hmo_ip_hdr_len += UDP_HEADER_LEN;
 
diff --git a/drivers/staging/fsl_dpa_offload/dpa_ipsec.h b/drivers/staging/fsl_dpa_offload/dpa_ipsec.h
index 9412f27..ad6a577 100644
--- a/drivers/staging/fsl_dpa_offload/dpa_ipsec.h
+++ b/drivers/staging/fsl_dpa_offload/dpa_ipsec.h
@@ -40,6 +40,9 @@
 #include <linux/compiler.h>
 #include <linux/workqueue.h>
 
+/*For IP header structure definition */
+#include <linux/ip.h>
+
 #include "desc.h"
 
 #include "dpa_compat.h"
@@ -196,20 +199,6 @@ struct auth_params {
 	uint32_t split_key_pad_len;/* Length in bytes of the padded split key */
 };
 
-/* DPA IPsec IP Header */
-struct ip_header {
-	uint8_t version:4, ihl:4;
-	uint8_t tos;
-	uint16_t tot_len;
-	uint16_t id;
-	uint16_t frag_off;
-	uint8_t ttl;
-	uint8_t protocol;
-	uint16_t check;
-	uint32_t saddr;
-	uint32_t daddr;
-};
-
 /*
  * DPA IPsec Security Association
  * This structure will represent a SA. All SA structures will be allocated
-- 
1.7.5.4

