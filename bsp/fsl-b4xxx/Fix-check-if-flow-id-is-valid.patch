From f992aa054aec98a9e839dd37bab004398ce9378d Mon Sep 17 00:00:00 2001
From: andrei varvara <andrei.varvara@freescale.com>
Date: Mon, 21 May 2012 22:04:44 +0000
Subject: [PATCH 197/518] Fix check if flow id is valid.

uint16 inbound_floqid always greater than 0

Signed-off-by: Andrei Varvara <andrei.varvara@freescale.com>
Acked-by: Mihai Serb <mihai.serb@freescale.com>
[Grabbed from the branch, LINUX_IR5.2.0, of
https://git.freescale.com/git-private/cgit.cgi/ppc/alu-b4860/linux.git.]
Signed-off-by: Tiejun Chen <tiejun.chen@windriver.com>
---
 drivers/staging/fsl_dpa_offload/dpa_ipsec.c |    3 ++-
 1 files changed, 2 insertions(+), 1 deletions(-)

diff --git a/drivers/staging/fsl_dpa_offload/dpa_ipsec.c b/drivers/staging/fsl_dpa_offload/dpa_ipsec.c
index f09c1f2..3dc108c 100644
--- a/drivers/staging/fsl_dpa_offload/dpa_ipsec.c
+++ b/drivers/staging/fsl_dpa_offload/dpa_ipsec.c
@@ -2737,7 +2737,8 @@ static int rollback_create_sa(struct dpa_ipsec_sa *sa)
 	}
 
 	/* Free the SA id and FlowID (for inbound SAs only).*/
-	if (sa->sa_dir == DPA_IPSEC_INBOUND && sa->inbound_flowid >= 0)
+	if (sa->sa_dir == DPA_IPSEC_INBOUND &&
+	    sa->inbound_flowid != INVALID_INB_FLOW_ID)
 		put_inbound_flowid(dpa_ipsec, sa->inbound_flowid);
 
 	err_rb = put_sa(sa);
-- 
1.7.5.4

