From f4cab43f4f7f86f2afad7cace40a3ae337f05955 Mon Sep 17 00:00:00 2001
From: Radu-Andrei BULIE <radu.bulie@freescale.com>
Date: Wed, 23 May 2012 20:37:20 +0000
Subject: [PATCH 207/518] dpa_offload_use_case: Modifiy the number of ways and
 sets for hash table

This modification fixes the error that could appear due to MURAM allocation
failure on P5020 for DL_RX ccnode.

Signed-off-by: Radu-Andrei BULIE <radu.bulie@freescale.com>
[Grabbed from the branch, LINUX_IR5.2.0, of
https://git.freescale.com/git-private/cgit.cgi/ppc/alu-b4860/linux.git.]
Signed-off-by: Tiejun Chen <tiejun.chen@windriver.com>
---
 .../staging/fsl_dpa_offload/usecases/ipsec_init.c  |    6 +++---
 1 files changed, 3 insertions(+), 3 deletions(-)

diff --git a/drivers/staging/fsl_dpa_offload/usecases/ipsec_init.c b/drivers/staging/fsl_dpa_offload/usecases/ipsec_init.c
index d44f01e..f5ed386 100644
--- a/drivers/staging/fsl_dpa_offload/usecases/ipsec_init.c
+++ b/drivers/staging/fsl_dpa_offload/usecases/ipsec_init.c
@@ -41,8 +41,8 @@
 #include "dbgfs_ctl.h"
 
 #define IN_SA_PCD_HASH_OFF      0
-#define IN_SA_PCD_HASH_SETS     2
-#define CCNODE_MAX_NUM_OF_KEYS  16
+#define IN_SA_PCD_HASH_SETS     8
+#define CCNODE_MAX_NUM_OF_WAYS  4
 
 static struct dpa_ipsec_params ipsec_params;
 static int ipsec_initialized = 0;
@@ -78,7 +78,7 @@ int init_ipsec_offload(int *dpa_ipsec_id, struct ipsec_uparms *params)
 	cls_tbl_params.type = DPA_CLS_TBL_HASH;
 	cls_tbl_params.entry_mgmt = DPA_CLS_TBL_MANAGE_BY_REF;
 	cls_tbl_params.hash_params.hash_offs = IN_SA_PCD_HASH_OFF;
-	cls_tbl_params.hash_params.max_ways = CCNODE_MAX_NUM_OF_KEYS;
+	cls_tbl_params.hash_params.max_ways = CCNODE_MAX_NUM_OF_WAYS;
 	cls_tbl_params.hash_params.num_sets = IN_SA_PCD_HASH_SETS;
 	cls_tbl_params.hash_params.key_size = MAX_SIZE_IP_UDP_SPI_KEY;
 	ret = dpa_classif_table_create(&cls_tbl_params, &cls_td);
-- 
1.7.5.4

