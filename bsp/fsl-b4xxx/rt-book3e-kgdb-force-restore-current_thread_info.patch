From 65cdf5c3378f81eab51061a3014cc3315b578d31 Mon Sep 17 00:00:00 2001
From: Tiejun Chen <tiejun.chen@windriver.com>
Date: Mon, 3 Jun 2013 11:19:40 +0800
Subject: [PATCH] rt/book3e/kgdb: force restore current_thread_info

In RT case we always need to retore current_thread_info to
make sure kgdb work well.

Signed-off-by: Tiejun Chen <tiejun.chen@windriver.com>
---
 arch/powerpc/kernel/irq.c |    5 +++++
 1 files changed, 5 insertions(+), 0 deletions(-)

diff --git a/arch/powerpc/kernel/irq.c b/arch/powerpc/kernel/irq.c
index 4803295..ed2d119 100644
--- a/arch/powerpc/kernel/irq.c
+++ b/arch/powerpc/kernel/irq.c
@@ -333,7 +333,12 @@ bool prep_irq_for_idle(void)
 }
 notrace unsigned int check_irq_replay(void)
 {
+#ifdef CONFIG_PREEMPT_RT_FULL
+	/* In RT case we always should restore current_thread_info. */
+	return 0;
+#else
 	return __check_irq_replay();
+#endif
 }
 #else
 notrace unsigned int check_irq_replay(void)
-- 
1.7.5.4

