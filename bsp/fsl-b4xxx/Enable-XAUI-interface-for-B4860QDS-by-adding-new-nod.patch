From 9972bbac2ef21ac0d7b47069741684c1c46fd5fc Mon Sep 17 00:00:00 2001
From: Suresh Gupta <suresh.gupta@freescale.com>
Date: Mon, 28 Jan 2013 20:35:21 +0000
Subject: [PATCH 026/518] Enable XAUI interface for B4860QDS by adding new
 node for 10Gig mdio

- Added new node for 10Gig MDIO under FMAN node
- Added entries for 10G port mEMAC
- Default Phy Addresses for Teranetics PHY on XAUI card
	The PHY addresses of Teranetics PHY on XAUI riser card are assigned
	based on the slot it is in. Switches SW4[2:4] and SW6[2:4] on
	AMC2PEX-2S On B4860QDS, AMC2PEX card decide the PHY addresses on slot1
	and slot2
- Changed ethernet port name to match with ifconfig names

Signed-off-by: Suresh Gupta <suresh.gupta@freescale.com>
Signed-off-by: Andy Fleming <afleming@freescale.com>
[Grabbed from the branch, LINUX_IR5.2.0, of
https://git.freescale.com/git-private/cgit.cgi/ppc/alu-b4860/linux.git.]
Signed-off-by: Tiejun Chen <tiejun.chen@windriver.com>
---
 arch/powerpc/boot/dts/b4860qds.dts          |   66 +++++++++++++++++++-------
 arch/powerpc/boot/dts/fsl/b4860si-post.dtsi |    2 +
 2 files changed, 50 insertions(+), 18 deletions(-)

diff --git a/arch/powerpc/boot/dts/b4860qds.dts b/arch/powerpc/boot/dts/b4860qds.dts
index 83e2015..2b4a67c 100644
--- a/arch/powerpc/boot/dts/b4860qds.dts
+++ b/arch/powerpc/boot/dts/b4860qds.dts
@@ -42,12 +42,14 @@
 	interrupt-parent = <&mpic>;
 
 	aliases{
-		ethernet0 = &enet0;
-		ethernet1 = &enet1;
-		ethernet2 = &enet2;
-		ethernet3 = &enet3;
-		ethernet4 = &enet4;
-		ethernet5 = &enet5;
+		ethernet0 = &fm1mac1;
+		ethernet1 = &fm1mac2;
+		ethernet2 = &fm1mac3;
+		ethernet3 = &fm1mac4;
+		ethernet4 = &fm1mac5;
+		ethernet5 = &fm1mac6;
+		ethernet6 = &fm1mac9;
+		ethernet7 = &fm1mac10;
 	};
 
 	ifc: localbus@ffe124000 {
@@ -163,30 +165,50 @@
 		};
 
 		fman0: fman@400000 {
-			enet0: ethernet@e0000 {
+			fm1mac1: ethernet@e0000 {
 				fixed-link = <1 1 1000 0 0 >;
 				phy-connection-type = "sgmii";
 			};
-			enet1: ethernet@e2000 {
+			fm1mac2: ethernet@e2000 {
 				fixed-link = <2 1 1000 0 0 >;
 				phy-connection-type = "sgmii";
 			};
-			enet2: ethernet@e4000 {
+			fm1mac3: ethernet@e4000 {
 				fixed-link = <3 1 1000 0 0 >;
 				phy-connection-type = "sgmii";
 			};
-			enet3: ethernet@e6000 {
+			fm1mac4: ethernet@e6000 {
 				fixed-link = <4 1 1000 0 0 >;
 				phy-connection-type = "sgmii";
 			};
-			enet4: ethernet@e8000 {
+			fm1mac5: ethernet@e8000 {
 				fixed-link = <5 1 1000 0 0 >;
 				phy-connection-type = "sgmii";
 			};
-			enet5: ethernet@ea000 {
+			fm1mac6: ethernet@ea000 {
 				fixed-link = <6 1 1000 0 0 >;
 				phy-connection-type = "sgmii";
 			};
+			fm1mac9: ethernet@f0000 { /* FM1@TGEC2 */
+				phy-handle = <&b4860xmdio1>;
+				phy-connection-type = "xgmii";
+			};
+			fm1mac10: ethernet@f2000 { /* FM1@TGEC1 */
+				phy-handle = <&b4860xmdio2>;
+				phy-connection-type = "xgmii";
+			};
+
+			xmdio0: mdio@fd000 {
+				/* For 10g interfaces */
+				b4860xmdio1: xaui-phy@slot1 {
+					compatible = "ethernet-phy-ieee802.3-c45";
+					reg = <0x7>; /* default switch setting on slot1 of AMC2PEX */
+				};
+				b4860xmdio2: xaui-phy@slot2 {
+					compatible = "ethernet-phy-ieee802.3-c45";
+					reg = <0x6>; /* default switch setting on slot1 of AMC2PEX */
+				};
+			};
 		};
 	};
 
@@ -220,27 +242,35 @@
 		compatible = "fsl,b4860-dpaa", "fsl,dpaa";
 		ethernet@0 {
 			compatible = "fsl,b4860-dpa-ethernet", "fsl,dpa-ethernet";
-			fsl,fman-mac = <&enet0>;
+			fsl,fman-mac = <&fm1mac1>;
 		};
 		ethernet@1 {
 			compatible = "fsl,b4860-dpa-ethernet", "fsl,dpa-ethernet";
-			fsl,fman-mac = <&enet1>;
+			fsl,fman-mac = <&fm1mac2>;
 		};
 		ethernet@2 {
 			compatible = "fsl,b4860-dpa-ethernet", "fsl,dpa-ethernet";
-			fsl,fman-mac = <&enet2>;
+			fsl,fman-mac = <&fm1mac3>;
 		};
 		ethernet@3 {
 			compatible = "fsl,b4860-dpa-ethernet", "fsl,dpa-ethernet";
-			fsl,fman-mac = <&enet3>;
+			fsl,fman-mac = <&fm1mac4>;
 		};
 		ethernet@4 {
 			compatible = "fsl,b4860-dpa-ethernet", "fsl,dpa-ethernet";
-			fsl,fman-mac = <&enet4>;
+			fsl,fman-mac = <&fm1mac5>;
 		};
 		ethernet@5 {
 			compatible = "fsl,b4860-dpa-ethernet", "fsl,dpa-ethernet";
-			fsl,fman-mac = <&enet5>;
+			fsl,fman-mac = <&fm1mac6>;
+		};
+		ethernet@6 {
+			compatible = "fsl,b4860-dpa-ethernet", "fsl,dpa-ethernet";
+			fsl,fman-mac = <&fm1mac9>;
+		};
+		ethernet@7 {
+			compatible = "fsl,b4860-dpa-ethernet", "fsl,dpa-ethernet";
+			fsl,fman-mac = <&fm1mac10>;
 		};
 	};
 };
diff --git a/arch/powerpc/boot/dts/fsl/b4860si-post.dtsi b/arch/powerpc/boot/dts/fsl/b4860si-post.dtsi
index c65b79b..14b16fa 100644
--- a/arch/powerpc/boot/dts/fsl/b4860si-post.dtsi
+++ b/arch/powerpc/boot/dts/fsl/b4860si-post.dtsi
@@ -168,6 +168,8 @@
 /include/ "qoriq-fman3-0-1g-3.dtsi"
 /include/ "qoriq-fman3-0-1g-4.dtsi"
 /include/ "qoriq-fman3-0-1g-5.dtsi"
+/include/ "qoriq-fman3-0-10g-0.dtsi"
+/include/ "qoriq-fman3-0-10g-1.dtsi"
 	fman0: fman@400000 {
 		interrupts = <
 			96 2 0 0
-- 
1.7.5.4

