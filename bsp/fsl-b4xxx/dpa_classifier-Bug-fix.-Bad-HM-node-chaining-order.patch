From 1dea6ce8645726f3b4ca4a4aaa62dd7fea7aa5e8 Mon Sep 17 00:00:00 2001
From: Marian Chereji <marian.chereji@freescale.com>
Date: Wed, 12 Sep 2012 16:08:36 +0000
Subject: [PATCH 319/518] dpa_classifier: Bug fix. Bad HM node chaining order

Function add_local_hm_nodes_to_chain was incorrectly changing the
chain head.

Signed-off-by: Marian Chereji <marian.chereji@freescale.com>
[Grabbed from the branch, LINUX_IR5.2.0, of
https://git.freescale.com/git-private/cgit.cgi/ppc/alu-b4860/linux.git.]
Signed-off-by: Tiejun Chen <tiejun.chen@windriver.com>
---
 drivers/staging/fsl_dpa_offload/dpa_classifier.c |    3 ++-
 1 files changed, 2 insertions(+), 1 deletions(-)

diff --git a/drivers/staging/fsl_dpa_offload/dpa_classifier.c b/drivers/staging/fsl_dpa_offload/dpa_classifier.c
index f0a27ad..4e7b0ac 100644
--- a/drivers/staging/fsl_dpa_offload/dpa_classifier.c
+++ b/drivers/staging/fsl_dpa_offload/dpa_classifier.c
@@ -2792,7 +2792,8 @@ static int add_local_hm_nodes_to_chain(struct dpa_cls_hm *phm)
 			if (phm->hm_chain)
 				list_add_tail(&phm->hm_node[i]->list_node,
 								phm->hm_chain);
-			phm->hm_chain = &phm->hm_node[i]->list_node;
+			else
+				phm->hm_chain = &phm->hm_node[i]->list_node;
 		}
 
 	if (pnext_hm)
-- 
1.7.5.4

