From aa7066c879132f425fb0a4d375d5712cd9c5360b Mon Sep 17 00:00:00 2001
From: Radu Bulie <radu.bulie@freescale.com>
Date: Tue, 12 Mar 2013 19:26:45 +0000
Subject: [PATCH 2/2] dpa_offload: Add dtsi files for chosen node support on B4860

These files define the chosen nodes used to configure
virtual storage profile (FMAN v3 only) and buffer layout parameters
for specific DPA offloading ports.

For offload_demo there is an O/H (inbound post decryption) port with
virtual storage profile and an O/H (outbound pre encryption) port
with buffer layout params used for enabling fragmentation.
For reassembly_demo there is an Rx port with virtual storage profile.
For fragmentation_demo there is an O/H port with buffer layout params.

Signed-off-by: Radu Bulie <radu.bulie@freescale.com>
[Grabbed from the branch, LINUX_IR5.2.0, of
https://git.freescale.com/git-private/cgit.cgi/ppc/alu-b4860/linux.git.]
Signed-off-by: Tiejun Chen <tiejun.chen@windriver.com>
---
 .../fsl_dpa_offload/dts/b4860si-chosen-offld.dtsi  |   29 ++++++
 .../fsl_dpa_offload/dts/b4860si-chosen-reass.dtsi  |   27 ++++++
 .../staging/fsl_dpa_offload/dts/b4860si-pre.dtsi   |   94 ++++++++++++++++++++
 3 files changed, 150 insertions(+), 0 deletions(-)
 create mode 100644 drivers/staging/fsl_dpa_offload/dts/b4860si-chosen-offld.dtsi
 create mode 100644 drivers/staging/fsl_dpa_offload/dts/b4860si-chosen-reass.dtsi
 create mode 100644 drivers/staging/fsl_dpa_offload/dts/b4860si-pre.dtsi

diff --git a/drivers/staging/fsl_dpa_offload/dts/b4860si-chosen-offld.dtsi b/drivers/staging/fsl_dpa_offload/dts/b4860si-chosen-offld.dtsi
new file mode 100644
index 0000000..b47d8fb
--- /dev/null
+++ b/drivers/staging/fsl_dpa_offload/dts/b4860si-chosen-offld.dtsi
@@ -0,0 +1,29 @@
+chosen {
+	name = "chosen";
+
+	dpaa-extended-args {
+		fman0-extd-args {
+			cell-index = <0>;
+			compatible = "fsl,fman-extended-args";
+			dma-aid-mode = "port";
+			/* Inbound O/H post decryption */
+			fman0_oh2-extd-args {
+				cell-index = <1>;
+				compatible = "fsl,fman-port-op-extended-args";
+				/* Define Virtual storage profile */
+				/* <number of profiles, default profile id> */
+				vsp-window = <8 0>;
+			};
+			/* Outbound O/H pre encryption */
+			fman0_oh3-extd-args {
+				cell-index = <2>;
+				compatible = "fsl,fman-port-op-extended-args";
+				/* Define buffer layout parameters. Can be used
+				 * in fragmentation or header manip operations
+				 */
+				/* <manip extra space, data alignment> */
+				buffer-layout = <128 64>;
+			};
+		};
+	};
+};
diff --git a/drivers/staging/fsl_dpa_offload/dts/b4860si-chosen-reass.dtsi b/drivers/staging/fsl_dpa_offload/dts/b4860si-chosen-reass.dtsi
new file mode 100644
index 0000000..934ff70
--- /dev/null
+++ b/drivers/staging/fsl_dpa_offload/dts/b4860si-chosen-reass.dtsi
@@ -0,0 +1,27 @@
+chosen {
+	name = "chosen";
+
+	dpaa-extended-args {
+		fman0-extd-args {
+			cell-index = <0>;
+			compatible = "fsl,fman-extended-args";
+			dma-aid-mode = "port";
+			fman0_rx5-extd-args {
+				cell-index = <5>;
+				compatible = "fsl,fman-port-1g-rx-extended-args";
+				/* Define Virtual storage profile */
+				/* <number of profiles, default profile id> */
+				vsp-window = <8 0>;
+			};
+			fman0_oh2-extd-args {
+				cell-index = <1>;
+				compatible = "fsl,fman-port-op-extended-args";
+				/* Define buffer layout parameters. Can be used
+				 * in fragmentation or header manip operations
+				 */
+				/* <manip extra space, data alignment> */
+				buffer-layout = <128 64>;
+			};
+		};
+	};
+};
diff --git a/drivers/staging/fsl_dpa_offload/dts/b4860si-pre.dtsi b/drivers/staging/fsl_dpa_offload/dts/b4860si-pre.dtsi
new file mode 100644
index 0000000..5159607
--- /dev/null
+++ b/drivers/staging/fsl_dpa_offload/dts/b4860si-pre.dtsi
@@ -0,0 +1,94 @@
+/*
+ * B4860 Silicon/SoC Device Tree Source (pre include)
+ *
+ * Copyright 2012 Freescale Semiconductor Inc.
+ *
+ * Redistribution and use in source and binary forms, with or without
+ * modification, are permitted provided that the following conditions are met:
+ *     * Redistributions of source code must retain the above copyright
+ *       notice, this list of conditions and the following disclaimer.
+ *     * Redistributions in binary form must reproduce the above copyright
+ *       notice, this list of conditions and the following disclaimer in the
+ *       documentation and/or other materials provided with the distribution.
+ *     * Neither the name of Freescale Semiconductor nor the
+ *       names of its contributors may be used to endorse or promote products
+ *       derived from this software without specific prior written permission.
+ *
+ *
+ * ALTERNATIVELY, this software may be distributed under the terms of the
+ * GNU General Public License ("GPL") as published by the Free Software
+ * Foundation, either version 2 of that License or (at your option) any
+ * later version.
+ *
+ * THIS SOFTWARE IS PROVIDED BY Freescale Semiconductor ``AS IS'' AND ANY
+ * EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE IMPLIED
+ * WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE ARE
+ * DISCLAIMED. IN NO EVENT SHALL Freescale Semiconductor BE LIABLE FOR ANY
+ * DIRECT, INDIRECT, INCIDENTAL, SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES
+ * (INCLUDING, BUT NOT LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES;
+ * LOSS OF USE, DATA, OR PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND
+ * ON ANY THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT
+ * (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE OF THIS
+ * SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.
+ */
+
+/dts-v1/;
+/ {
+	compatible = "fsl,B4860";
+	#address-cells = <2>;
+	#size-cells = <2>;
+	interrupt-parent = <&mpic>;
+
+	aliases {
+		ccsr = &soc;
+
+		serial0 = &serial0;
+		serial1 = &serial1;
+		serial2 = &serial2;
+		serial3 = &serial3;
+		pci0 = &pci0;
+		dma0 = &dma0;
+		dma1 = &dma1;
+		sdhc = &sdhc;
+
+		fman0 = &fman0;
+		crypto = &crypto;
+		sec_jr0 = &sec_jr0;
+		sec_jr1 = &sec_jr1;
+		sec_jr2 = &sec_jr2;
+		sec_jr3 = &sec_jr3;
+		rtic_a = &rtic_a;
+		rtic_b = &rtic_b;
+		rtic_c = &rtic_c;
+		rtic_d = &rtic_d;
+		sec_mon = &sec_mon;
+	};
+
+/include/ "b4860si-chosen.dtsi"
+
+	cpus {
+		#address-cells = <1>;
+		#size-cells = <0>;
+
+		PowerPC,e6500@0 {
+			device_type = "cpu";
+			reg = <0 1>;
+			next-level-cache = <&L2>;
+		};
+		PowerPC,e6500@1 {
+			device_type = "cpu";
+			reg = <2 3>;
+			next-level-cache = <&L2>;
+		};
+		PowerPC,e6500@2 {
+			device_type = "cpu";
+			reg = <4 5>;
+			next-level-cache = <&L2>;
+		};
+		PowerPC,e6500@3 {
+			device_type = "cpu";
+			reg = <6 7>;
+			next-level-cache = <&L2>;
+		};
+	};
+};
-- 
1.7.0.2

