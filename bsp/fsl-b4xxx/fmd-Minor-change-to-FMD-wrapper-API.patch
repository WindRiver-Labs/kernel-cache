From 240b6c42b73fb3846cfcfcee7a294192051dbe7f Mon Sep 17 00:00:00 2001
From: Ioana Radulescu <ruxandra.radulescu@freescale.com>
Date: Fri, 18 Jan 2013 21:58:33 +0000
Subject: [PATCH 006/518] fmd: Minor change to FMD wrapper API

The FMD linux wrapper offers some API functions for the use of the
DPAA Ethernet / DPAA Offline port driver, which must respect the
Linux naming style conventions.

Modify a parameter related to the initialization of OH ports for
IP fragmentation which was not following the Linux style.
This is a non-functional change.

Signed-off-by: Ioana Radulescu <ruxandra.radulescu@freescale.com>
[Grabbed from the branch, LINUX_IR5.2.0, of
https://git.freescale.com/git-private/cgit.cgi/ppc/alu-b4860/linux.git.]
Signed-off-by: Tiejun Chen <tiejun.chen@windriver.com>
---
 .../dpa/NetCommSw/src/inc/wrapper/fsl_fman.h       |    3 ++-
 .../dpa/NetCommSw/src/wrapper/lnxwrp_fm_port.c     |   11 ++++++++++-
 2 files changed, 12 insertions(+), 2 deletions(-)

diff --git a/drivers/net/ethernet/freescale/dpa/NetCommSw/src/inc/wrapper/fsl_fman.h b/drivers/net/ethernet/freescale/dpa/NetCommSw/src/inc/wrapper/fsl_fman.h
index b7f0173..8123550 100644
--- a/drivers/net/ethernet/freescale/dpa/NetCommSw/src/inc/wrapper/fsl_fman.h
+++ b/drivers/net/ethernet/freescale/dpa/NetCommSw/src/inc/wrapper/fsl_fman.h
@@ -127,7 +127,8 @@ struct fm_port_non_rx_params {
     bool                    hash_results;       /**< Whether to have the hash-results in the Received buffer */
     bool                    time_stamp;         /**< Whether to have the time-stamp in the Received buffer */
     bool                    frag_enable;        /**< Whether to call extra config functions for OH, to enable fragmentation */
-    t_FmExtPools            op_ext_pools;       /**< External Buffer Pool params for OH port only */
+    struct fm_port_pool_param pool_param[FM_PORT_MAX_NUM_OF_EXT_POOLS]; /**< External Buffer Pool params for OH port only */
+    uint8_t                 num_pools;          /**< Number of pools use by this port */
 };
 
 
diff --git a/drivers/net/ethernet/freescale/dpa/NetCommSw/src/wrapper/lnxwrp_fm_port.c b/drivers/net/ethernet/freescale/dpa/NetCommSw/src/wrapper/lnxwrp_fm_port.c
index 9918cab..b7b038e 100644
--- a/drivers/net/ethernet/freescale/dpa/NetCommSw/src/wrapper/lnxwrp_fm_port.c
+++ b/drivers/net/ethernet/freescale/dpa/NetCommSw/src/wrapper/lnxwrp_fm_port.c
@@ -708,8 +708,17 @@ void fm_set_tx_port_params(struct fm_port *port,
 	if ((params->frag_enable == TRUE) &&
 	    (p_LnxWrpFmPortDev->settings.param.portType ==
 	     e_FM_PORT_TYPE_OH_OFFLINE_PARSING)) {
+		t_FmExtPools opExtPools;
+		int i;
+
+		memset(&opExtPools, 0, sizeof(opExtPools));
+		opExtPools.numOfPoolsUsed = params->num_pools;
+		for (i = 0; i < params->num_pools; i++) {
+			opExtPools.extBufPool[i].id = params->pool_param[i].id;
+			opExtPools.extBufPool[i].size = params->pool_param[i].size;
+		}
 		ADD_ADV_CONFIG_NO_RET(FM_PORT_ConfigExtBufPools,
-				      ARGS(1, (&params->op_ext_pools)));
+				      ARGS(1, (&opExtPools)));
 	}
 
 	ADD_ADV_CONFIG_END InitFmPortDev(p_LnxWrpFmPortDev);
-- 
1.7.5.4

