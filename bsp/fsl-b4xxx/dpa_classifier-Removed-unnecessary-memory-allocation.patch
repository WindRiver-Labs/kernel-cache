From e21c821c47a41516f6438edbc26d9d8d42d4ece7 Mon Sep 17 00:00:00 2001
From: Marian Chereji <marian.chereji@freescale.com>
Date: Tue, 7 Aug 2012 19:53:47 +0000
Subject: [PATCH 272/518] dpa_classifier: Removed unnecessary memory
 allocation

In function init_update_hm there was an unnecessary allocation of a
"data" pointer. This was removed.

Signed-off-by: Marian Chereji <marian.chereji@freescale.com>
[Grabbed from the branch, LINUX_IR5.2.0, of
https://git.freescale.com/git-private/cgit.cgi/ppc/alu-b4860/linux.git.]
Signed-off-by: Tiejun Chen <tiejun.chen@windriver.com>
---
 drivers/staging/fsl_dpa_offload/dpa_classifier.c |   13 +------------
 1 files changed, 1 insertions(+), 12 deletions(-)

diff --git a/drivers/staging/fsl_dpa_offload/dpa_classifier.c b/drivers/staging/fsl_dpa_offload/dpa_classifier.c
index e301fea..b08aa79 100644
--- a/drivers/staging/fsl_dpa_offload/dpa_classifier.c
+++ b/drivers/staging/fsl_dpa_offload/dpa_classifier.c
@@ -3552,7 +3552,6 @@ static int init_update_hm(struct dpa_cls_hm *pupdate_hm)
 {
 	struct dpa_cls_hm_node *hm_node = NULL;
 	struct dpa_cls_hm *pnext_hm = NULL;
-	uint8_t *data;
 	uint8_t size = 0;
 	int update_ops, replace_ops;
 
@@ -3768,7 +3767,7 @@ static int init_update_hm(struct dpa_cls_hm *pupdate_hm)
 				replaceType =
 				e_FM_PCD_MANIP_HDR_CUSTOM_REPLACE_IPV4_BY_IPV6;
 			hm_node->params.u.hdr.customParams.u.ipHdrReplace.
-				hdrSize = sizeof(struct ipv6_header);
+				hdrSize = (uint8_t)sizeof(struct ipv6_header);
 
 			memcpy(hm_node->params.u.hdr.customParams.u.
 				ipHdrReplace.hdr,
@@ -3784,16 +3783,6 @@ static int init_update_hm(struct dpa_cls_hm *pupdate_hm)
 				e_FM_PCD_MANIP_HDR_CUSTOM_REPLACE_IPV6_BY_IPV4;
 			hm_node->params.u.hdr.customParams.u.ipHdrReplace.
 				hdrSize = sizeof(struct iphdr);
-
-			data = kzalloc(sizeof(struct iphdr), GFP_KERNEL);
-			if (!data) {
-				kfree(hm_node);
-				pr_err("ERROR: %s, %s (%d): No more memory for "
-					"header manipulation.\n", __FILE__,
-					__func__, __LINE__);
-				return -ENOMEM;
-			}
-
 			memcpy(hm_node->params.u.hdr.customParams.u.
 				ipHdrReplace.hdr,
 				&pupdate_hm->params.update.replace.ipv4_hdr,
-- 
1.7.5.4

