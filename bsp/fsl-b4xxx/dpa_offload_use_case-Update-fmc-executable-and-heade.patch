From b94a34fcdc8c83285b4cb8200c392aeb45758af7 Mon Sep 17 00:00:00 2001
From: Radu-Andrei BULIE <radu.bulie@freescale.com>
Date: Mon, 21 May 2012 22:15:02 +0000
Subject: [PATCH 204/518] dpa_offload_use_case: Update fmc executable and
 header file

These files must be in synch with the fmc_exec and fmc header
used in the fmc tool.

Signed-off-by: Radu-Andrei BULIE <radu.bulie@freescale.com>
[Grabbed from the branch, LINUX_IR5.2.0, of
https://git.freescale.com/git-private/cgit.cgi/ppc/alu-b4860/linux.git.]
Signed-off-by: Tiejun Chen <tiejun.chen@windriver.com>
---
 drivers/staging/fsl_dpa_offload/usecases/fmc.h     |    2 ++
 .../staging/fsl_dpa_offload/usecases/fmc_exec.c    |    8 +++++---
 2 files changed, 7 insertions(+), 3 deletions(-)

diff --git a/drivers/staging/fsl_dpa_offload/usecases/fmc.h b/drivers/staging/fsl_dpa_offload/usecases/fmc.h
index ed0faee..9722028 100644
--- a/drivers/staging/fsl_dpa_offload/usecases/fmc.h
+++ b/drivers/staging/fsl_dpa_offload/usecases/fmc.h
@@ -76,6 +76,8 @@ typedef struct fmc_fman_t {
     t_Handle           pcd_handle;
 
 #ifndef P1023
+    unsigned int       offload_support;
+
     unsigned int       reasm_count;
     t_FmPcdManipParams reasm[FMC_MANIP_MAX];
     char               reasm_name[FMC_MANIP_MAX][FMC_NAME_LEN];
diff --git a/drivers/staging/fsl_dpa_offload/usecases/fmc_exec.c b/drivers/staging/fsl_dpa_offload/usecases/fmc_exec.c
index 21023a7..61bb6ee 100644
--- a/drivers/staging/fsl_dpa_offload/usecases/fmc_exec.c
+++ b/drivers/staging/fsl_dpa_offload/usecases/fmc_exec.c
@@ -309,9 +309,11 @@ fmc_exec_engine_start( fmc_model* model, unsigned int index,
         FM_PCD_PrsLoadSw( model->fman[index].pcd_handle, &(model->sp) );
     }
 #ifndef P1023
-	if (model->fman[index].reasm_count > 0 || model->fman[index].frag_count > 0) {
-		FM_PCD_SetAdvancedOffloadSupport(model->fman[index].pcd_handle);
-	}
+    if ( model->fman[index].reasm_count     > 0 ||
+         model->fman[index].frag_count      > 0 ||
+         model->fman[index].offload_support > 0 ) {
+        FM_PCD_SetAdvancedOffloadSupport( model->fman[index].pcd_handle );
+    }
 #endif /* P1023 */
 
     FM_PCD_Enable( model->fman[index].pcd_handle );
-- 
1.7.5.4

