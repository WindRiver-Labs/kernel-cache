From 6a29ca16f6923a3fa068dc4e66702ad8eed95f5d Mon Sep 17 00:00:00 2001
From: Anca-Jeanina Floarea <anca.floarea@freescale.com>
Date: Mon, 18 Feb 2013 21:53:57 +0000
Subject: [PATCH 472/518] dpa_ipsec: Remove the check for Data Path Override
 enable in function
 build_extended_encap_shared_descriptor

The SA parameter "enable_dpovrd" is always TRUE in function
build_extended_encap_shared_descriptor so there is no need
to check it nor to write the code depending on its value.

Signed-off-by: Anca Jeanina FLOAREA <anca.floarea@freescale.com>
[Grabbed from the branch, LINUX_IR5.2.0, of
https://git.freescale.com/git-private/cgit.cgi/ppc/alu-b4860/linux.git.]
Signed-off-by: Tiejun Chen <tiejun.chen@windriver.com>
---
 drivers/staging/fsl_dpa_offload/dpa_ipsec_desc.c |   21 ++++++---------------
 1 files changed, 6 insertions(+), 15 deletions(-)

diff --git a/drivers/staging/fsl_dpa_offload/dpa_ipsec_desc.c b/drivers/staging/fsl_dpa_offload/dpa_ipsec_desc.c
index f792d92..0c5a3eb 100644
--- a/drivers/staging/fsl_dpa_offload/dpa_ipsec_desc.c
+++ b/drivers/staging/fsl_dpa_offload/dpa_ipsec_desc.c
@@ -894,28 +894,19 @@ int build_extended_encap_shared_descriptor(struct dpa_ipsec_sa *sa,
 
 	desc = (uint32_t *)sa->sec_desc->desc;
 
-	sa->enable_dpovrd = TRUE;
-
 	if (sec_era == 2) {
 		if (sa->enable_stats)
-			sa->stats_indx = 29;
-		sa->next_cmd_indx = 31;
+			sa->stats_indx = 27;
+		sa->next_cmd_indx = 29;
 	} else {
 		if (sa->enable_stats)
-			sa->stats_indx = 30 - 0;
-		sa->next_cmd_indx = 32 - 0;
+			sa->stats_indx = 28;
+		sa->next_cmd_indx = 30;
 	}
 
 	/* This code only works when SEC is configured to use PTR on 64 bit
-	 * so the Job Descriptor length is 11 words long when DPOWRD is not
-	 * enabled and 13 words when this feature is present. */
-	job_desc_len = 11;
-	if (sa->enable_dpovrd) {
-		if (sa->enable_stats)
-			sa->stats_indx -= 2;
-		sa->next_cmd_indx -= 2;
-		job_desc_len = 13;
-	}
+	 * so the Job Descriptor length is 13 words long when DPOWRD is set */
+	job_desc_len = 13;
 
 	/* Set CAAM Job Descriptor length */
 	sa->job_desc_len = job_desc_len;
-- 
1.7.5.4

