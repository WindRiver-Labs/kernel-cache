From 86121984008ebd184ddb9f46f75033bdbbeda5da Mon Sep 17 00:00:00 2001
From: Mihai Serb <mihai.serb@freescale.com>
Date: Thu, 17 May 2012 20:37:08 +0000
Subject: [PATCH 155/518] Fix error code reporting in case of policy key size
 greater than table key size

In function fill_pol_key, if the calculated policy key size is
greater than the maximum key size supported by the table in which
this key should be inserted, an invalid error code is returned.

Signed-off-by: Mihai Serb <mihai.serb@freescale.com>
Acked-by: Andrei Varvara <andrei.varvara@freescale.com>
[Grabbed from the branch, LINUX_IR5.2.0, of
https://git.freescale.com/git-private/cgit.cgi/ppc/alu-b4860/linux.git.]
Signed-off-by: Tiejun Chen <tiejun.chen@windriver.com>
---
 drivers/staging/fsl_dpa_offload/dpa_ipsec.c |    2 +-
 1 files changed, 1 insertions(+), 1 deletions(-)

diff --git a/drivers/staging/fsl_dpa_offload/dpa_ipsec.c b/drivers/staging/fsl_dpa_offload/dpa_ipsec.c
index f05f007..bd37c77 100644
--- a/drivers/staging/fsl_dpa_offload/dpa_ipsec.c
+++ b/drivers/staging/fsl_dpa_offload/dpa_ipsec.c
@@ -1048,7 +1048,7 @@ static int fill_policy_key(int td,
 
 	if (tbl_key_size < offset) {
 		xx_pr_err("Policy key is greater than maximum table key size\n");
-		return err;
+		return -EINVAL;
 	}
 
 	if (tbl_key_size > offset) {
-- 
1.7.5.4

