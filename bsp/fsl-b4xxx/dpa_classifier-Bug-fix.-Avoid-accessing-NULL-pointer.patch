From ff58fa99fbe28659bd7075e2ed967a241f9686da Mon Sep 17 00:00:00 2001
From: Marian Chereji <marian.chereji@freescale.com>
Date: Mon, 17 Sep 2012 21:20:31 +0000
Subject: [PATCH 328/518] dpa_classifier: Bug fix. Avoid accessing NULL
 pointer

In the function dpa_classif_modify_insert_hm, if the PPP insert
parameters needed to be modified, a pointer (pdata) was used
uninitialized. This was replaced with the proper address from
the HM parameters.

Signed-off-by: Marian Chereji <marian.chereji@freescale.com>
[Grabbed from the branch, LINUX_IR5.2.0, of
https://git.freescale.com/git-private/cgit.cgi/ppc/alu-b4860/linux.git.]
Signed-off-by: Tiejun Chen <tiejun.chen@windriver.com>
---
 drivers/staging/fsl_dpa_offload/dpa_classifier.c |    3 ++-
 1 files changed, 2 insertions(+), 1 deletions(-)

diff --git a/drivers/staging/fsl_dpa_offload/dpa_classifier.c b/drivers/staging/fsl_dpa_offload/dpa_classifier.c
index 2fe4652..73d62b422 100644
--- a/drivers/staging/fsl_dpa_offload/dpa_classifier.c
+++ b/drivers/staging/fsl_dpa_offload/dpa_classifier.c
@@ -3939,7 +3939,8 @@ int dpa_classif_modify_insert_hm(int hmd,
 			break;
 
 		/* Copy the PPP PID */
-		memcpy(pdata, &pinsert_hm->insert_params.ppp_pid,
+		memcpy(hm_node->params.u.hdr.insrtParams.u.generic.p_Data,
+			&pinsert_hm->insert_params.ppp_pid,
 			PPP_HEADER_SIZE);
 		update = true;
 		break;
-- 
1.7.5.4

