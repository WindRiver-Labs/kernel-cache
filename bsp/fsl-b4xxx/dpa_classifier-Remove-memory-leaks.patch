From a89a793be6161bc399e42f4dde75fd76d5108e7b Mon Sep 17 00:00:00 2001
From: Marian Chereji <marian.chereji@freescale.com>
Date: Mon, 21 May 2012 23:08:15 +0000
Subject: [PATCH 201/518] dpa_classifier: Remove memory leaks

Removed the memory leaks for "ptable->entry" and
"ptable->int_cc_node".

Signed-off-by: Marian Chereji <marian.chereji@freescale.com>
[Grabbed from the branch, LINUX_IR5.2.0, of
https://git.freescale.com/git-private/cgit.cgi/ppc/alu-b4860/linux.git.]
Signed-off-by: Tiejun Chen <tiejun.chen@windriver.com>
---
 drivers/staging/fsl_dpa_offload/dpa_classifier.c |   17 ++++++++++++++---
 1 files changed, 14 insertions(+), 3 deletions(-)

diff --git a/drivers/staging/fsl_dpa_offload/dpa_classifier.c b/drivers/staging/fsl_dpa_offload/dpa_classifier.c
index a37da7c..8643cfd 100644
--- a/drivers/staging/fsl_dpa_offload/dpa_classifier.c
+++ b/drivers/staging/fsl_dpa_offload/dpa_classifier.c
@@ -193,6 +193,15 @@ dpa_classif_table_create_error:
 			xx_free(ptable->shadow_table);
 		}
 
+		free_table_management(ptable);
+
+		/* Free entry index management */
+		if (ptable->entry) {
+			xx_free(ptable->entry);
+			ptable->entry		= NULL;
+			ptable->entries_cnt	= 0;
+		}
+
 		xx_free(ptable);
 		put_table_descriptor(*td);
 	}
@@ -239,9 +248,11 @@ int dpa_classif_table_free(int td)
 	}
 
 	/* Free entry index management */
-	xx_free(ptable->entry);
-	ptable->entry		= NULL;
-	ptable->entries_cnt	= 0;
+	if (ptable->entry) {
+		xx_free(ptable->entry);
+		ptable->entry		= NULL;
+		ptable->entries_cnt	= 0;
+	}
 
 	free_table_management(ptable);
 
-- 
1.7.5.4

