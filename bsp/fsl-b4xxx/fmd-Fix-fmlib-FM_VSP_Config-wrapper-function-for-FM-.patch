From d40d90e9cffa0bc728f63c1466ca4d5af5fb786c Mon Sep 17 00:00:00 2001
From: Radu Bulie <radu.bulie@freescale.com>
Date: Fri, 11 Jan 2013 19:14:56 +0000
Subject: [PATCH 005/518] fmd: Fix fmlib FM_VSP_Config wrapper function for FM
 object member

When FM_VSP_Config is called from userspace, h_Fm parameter member
transmited to the function is not mapped in kernel with the Fm object.
h_Fm is a descriptor returned in userspace by FM_Open fmlib wrapper function.
Thus when copying this param from user to kernel the value transmited is actually
a descriptor instead of the FMAN handle. This patch fixes the above issue,
transmitting the FMAN handle to the FM_VSP_Config from FMD driver.

Signed-off-by: Radu Bulie <radu.bulie@freescale.com>
Acked-by: Madalin Bucur <madalin.bucur@freescale.com>
[Grabbed from the branch, LINUX_IR5.2.0, of
https://git.freescale.com/git-private/cgit.cgi/ppc/alu-b4860/linux.git.]
Signed-off-by: Tiejun Chen <tiejun.chen@windriver.com>
---
 .../dpa/NetCommSw/src/wrapper/lnxwrp_ioctls_fm.c   |    2 +-
 1 files changed, 1 insertions(+), 1 deletions(-)

diff --git a/drivers/net/ethernet/freescale/dpa/NetCommSw/src/wrapper/lnxwrp_ioctls_fm.c b/drivers/net/ethernet/freescale/dpa/NetCommSw/src/wrapper/lnxwrp_ioctls_fm.c
index eb36ea0..b8ce776 100644
--- a/drivers/net/ethernet/freescale/dpa/NetCommSw/src/wrapper/lnxwrp_ioctls_fm.c
+++ b/drivers/net/ethernet/freescale/dpa/NetCommSw/src/wrapper/lnxwrp_ioctls_fm.c
@@ -2791,7 +2791,7 @@ invalid_port_id:
 #endif
             if (copy_from_user(&param, (void *)arg, sizeof(param)))
                 RETURN_ERROR(MINOR, E_WRITE_FAILED, NO_MSG);
-
+	param.p_fm = p_LnxWrpFmDev->h_Dev;
         param.id = FM_VSP_Config((t_FmVspParams *)&param);
 
 #if defined(CONFIG_COMPAT)
-- 
1.7.5.4

