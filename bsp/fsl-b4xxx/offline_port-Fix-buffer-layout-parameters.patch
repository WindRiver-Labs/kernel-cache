From 6354c69fe0204b9a2b3b826237b2cff51c9eb363 Mon Sep 17 00:00:00 2001
From: Radu Bulie <radu.bulie@freescale.com>
Date: Mon, 25 Mar 2013 19:54:09 +0000
Subject: [PATCH 27/36] offline_port: Fix buffer layout parameters

Buffer layout parameters have to be set regardless of enabling or not the
fragmentation on an O/H port.

This patch relocates the oh_set_buffer_layout function to be called
before reading the buffer pool handle used for setting the external buffer
pools (necessary for fragmentation).

Signed-off-by: Radu Bulie <radu.bulie@freescale.com>
[Grabbed from the branch, LINUX_IR5.3.0_ALPHA, of
https://git.freescale.com/git-private/cgit.cgi/ppc/dpaa-offload/linux.git.]
Signed-off-by: Tiejun Chen <tiejun.chen@windriver.com>
---
 drivers/net/ethernet/freescale/dpa/offline_port.c |    4 +---
 1 files changed, 1 insertions(+), 3 deletions(-)

diff --git a/drivers/net/ethernet/freescale/dpa/offline_port.c b/drivers/net/ethernet/freescale/dpa/offline_port.c
index a8afc36..89b6125 100644
--- a/drivers/net/ethernet/freescale/dpa/offline_port.c
+++ b/drivers/net/ethernet/freescale/dpa/offline_port.c
@@ -297,6 +297,7 @@ oh_port_probe(struct platform_device *_of_dev)
 		goto return_kfree;
 	}
 
+	oh_set_buffer_layout(oh_config->oh_port, &buf_layout);
 	bpool_handle = of_get_property(dpa_oh_node,
 			"fsl,bman-buffer-pools", &lenp);
 
@@ -361,9 +362,6 @@ oh_port_probe(struct platform_device *_of_dev)
 
 	}
 
-	oh_set_buffer_layout(oh_config->oh_port, &buf_layout);
-
-
 	if (buf_layout.data_align != FRAG_DATA_ALIGN ||
 	    buf_layout.manip_extra_space != FRAG_MANIP_SPACE)
 		goto init_port;
-- 
1.7.5.4

