From b5595e84d83a518b28406b63fe91ee9d781cc367 Mon Sep 17 00:00:00 2001
From: Marian Chereji <marian.chereji@freescale.com>
Date: Mon, 12 Nov 2012 21:55:26 +0000
Subject: [PATCH 407/518] dpa_classifier: Optimization. For indexed tables
 don't check for MODIFY_KEY or MODIFY_KEY_AND_ACTION

In table_modify_entry_by_ref function the modify modes MODIFY_KEY and
MODIFY_KEY_AND_ACTION are not supported by indexed tables. It would be
useless to check for these modes when the type of the table is "indexed".
The check for MODIFY_KEY and MODIFY_KEY_AND_ACTION modes was moved to
the "else" branch of the identification of indexed tables.

Signed-off-by: Marian Chereji <marian.chereji@freescale.com>
[Grabbed from the branch, LINUX_IR5.2.0, of
https://git.freescale.com/git-private/cgit.cgi/ppc/alu-b4860/linux.git.]
Signed-off-by: Tiejun Chen <tiejun.chen@windriver.com>
---
 drivers/staging/fsl_dpa_offload/dpa_classifier.c |   20 ++++++++++----------
 1 files changed, 10 insertions(+), 10 deletions(-)

diff --git a/drivers/staging/fsl_dpa_offload/dpa_classifier.c b/drivers/staging/fsl_dpa_offload/dpa_classifier.c
index 0ed0e98..bcc1cb7 100644
--- a/drivers/staging/fsl_dpa_offload/dpa_classifier.c
+++ b/drivers/staging/fsl_dpa_offload/dpa_classifier.c
@@ -1174,18 +1174,18 @@ static int table_modify_entry_by_ref(struct dpa_cls_table	*ptable,
 				list_add(&shadow_entry->list_node,
 						new_bucket_list);
 			}
-		}
 
-		if ((mod_params->type == DPA_CLS_TBL_MODIFY_KEY) ||
-			(mod_params->type ==
-				DPA_CLS_TBL_MODIFY_KEY_AND_ACTION)) {
-			memcpy(key->byte,
-				mod_params->key->byte,
-				key->size);
-			if ((key->mask) && (mod_params->key->mask))
-				memcpy(key->mask,
-					mod_params->key->mask,
+			if ((mod_params->type == DPA_CLS_TBL_MODIFY_KEY) ||
+				(mod_params->type ==
+					DPA_CLS_TBL_MODIFY_KEY_AND_ACTION)) {
+				memcpy(key->byte,
+					mod_params->key->byte,
 					key->size);
+				if ((key->mask) && (mod_params->key->mask))
+					memcpy(key->mask,
+						mod_params->key->mask,
+						key->size);
+			}
 		}
 
 		if ((mod_params->type == DPA_CLS_TBL_MODIFY_ACTION) ||
-- 
1.7.5.4

