From b88b4bbe2d0b49086208f66af32646f8b3052034 Mon Sep 17 00:00:00 2001
From: Marian Chereji <marian.chereji@freescale.com>
Date: Tue, 11 Sep 2012 20:03:24 +0000
Subject: [PATCH 305/518] dpa_classifier: Added extra sanity checks to
 table_modify_entry_by_ref

Added some sanity checks to protect against invalid parameters
provided by the user.

Signed-off-by: Marian Chereji <marian.chereji@freescale.com>
[Grabbed from the branch, LINUX_IR5.2.0, of
https://git.freescale.com/git-private/cgit.cgi/ppc/alu-b4860/linux.git.]
Signed-off-by: Tiejun Chen <tiejun.chen@windriver.com>
---
 drivers/staging/fsl_dpa_offload/dpa_classifier.c |    8 ++++++++
 1 files changed, 8 insertions(+), 0 deletions(-)

diff --git a/drivers/staging/fsl_dpa_offload/dpa_classifier.c b/drivers/staging/fsl_dpa_offload/dpa_classifier.c
index 76b66cf..2db4a8d 100644
--- a/drivers/staging/fsl_dpa_offload/dpa_classifier.c
+++ b/drivers/staging/fsl_dpa_offload/dpa_classifier.c
@@ -555,6 +555,8 @@ static int table_modify_entry_by_ref(struct dpa_cls_table	*ptable,
 	cc_node	= (t_Handle)ptable->int_cc_node[cc_node_index].cc_node;
 	switch (mod_params->type) {
 	case DPA_CLS_TBL_MODIFY_ACTION:
+		xx_sanity_check_return_value(mod_params->action,
+			"mod_params.action", -EINVAL);
 		errno = action_to_next_engine_params(mod_params->action,
 						&next_engine_params);
 		if (errno < 0)
@@ -575,6 +577,8 @@ static int table_modify_entry_by_ref(struct dpa_cls_table	*ptable,
 		break;
 	case DPA_CLS_TBL_MODIFY_KEY:
 		/* Only exact match tables support this type of modification. */
+		xx_sanity_check_return_value(mod_params->key,
+			"mod_params.key", -EINVAL);
 
 		if (mod_params->key->size !=
 			ptable->params.exact_match_params.key_size) {
@@ -619,6 +623,10 @@ static int table_modify_entry_by_ref(struct dpa_cls_table	*ptable,
 		break;
 	case DPA_CLS_TBL_MODIFY_KEY_AND_ACTION:
 		/* Only exact match tables support this type of modification. */
+		xx_sanity_check_return_value(mod_params->key,
+			"mod_params.key", -EINVAL);
+		xx_sanity_check_return_value(mod_params->action,
+			"mod_params.action", -EINVAL);
 
 		if (mod_params->key->size !=
 			ptable->params.exact_match_params.key_size) {
-- 
1.7.5.4

