From 76a46b5962b584bf09cb7fccc77cb2a3912c6c6c Mon Sep 17 00:00:00 2001
From: Radu Bulie <radu.bulie@freescale.com>
Date: Fri, 11 Jan 2013 17:56:53 +0000
Subject: [PATCH 459/518] dpa_classifier: Add multicast VSP support

Update DPA Classifier multicast component to support
virtual storage profiles. Relative storage profile Id
parameter is transmitted to FMD driver.

Signed-off-by: Radu Bulie <radu.bulie@freescale.com>
[Grabbed from the branch, LINUX_IR5.2.0, of
https://git.freescale.com/git-private/cgit.cgi/ppc/alu-b4860/linux.git.]
Signed-off-by: Tiejun Chen <tiejun.chen@windriver.com>
---
 drivers/staging/fsl_dpa_offload/dpa_classifier.c   |    6 ++++++
 .../staging/fsl_dpa_offload/wrp_dpa_classifier.c   |    4 ++++
 2 files changed, 10 insertions(+), 0 deletions(-)

diff --git a/drivers/staging/fsl_dpa_offload/dpa_classifier.c b/drivers/staging/fsl_dpa_offload/dpa_classifier.c
index 61c6023..bf1c686 100644
--- a/drivers/staging/fsl_dpa_offload/dpa_classifier.c
+++ b/drivers/staging/fsl_dpa_offload/dpa_classifier.c
@@ -7019,6 +7019,9 @@ int dpa_classif_mcast_create_group(
 						member_params->override_fqid;
 			next_engine_params->params.enqueueParams.newFqid =
 						member_params->new_fqid;
+			next_engine_params->params.enqueueParams.
+						  newRelativeStorageProfileId =
+						  member_params->new_rel_vsp_id;
 		}
 		if (member_params->hmd != DPA_OFFLD_DESC_NONE) {
 			next_engine_params->h_Manip = (t_Handle)
@@ -7161,6 +7164,9 @@ int dpa_classif_mcast_add_member(int grpd,
 						member_params->override_fqid;
 		next_engine_params->params.enqueueParams.newFqid =
 						member_params->new_fqid;
+		next_engine_params->params.enqueueParams.
+						newRelativeStorageProfileId =
+						 member_params->new_rel_vsp_id;
 	}
 
 	if (member_params->hmd != DPA_OFFLD_DESC_NONE) {
diff --git a/drivers/staging/fsl_dpa_offload/wrp_dpa_classifier.c b/drivers/staging/fsl_dpa_offload/wrp_dpa_classifier.c
index 2642bc1..f4dc243 100644
--- a/drivers/staging/fsl_dpa_offload/wrp_dpa_classifier.c
+++ b/drivers/staging/fsl_dpa_offload/wrp_dpa_classifier.c
@@ -2883,6 +2883,8 @@ int dpa_cls_mcast_group_params_compatcpy(
 			uparam->mcast_grp_params.member_params.override_fqid;
 	kparam->mcast_grp_params.member_params.new_fqid =
 			uparam->mcast_grp_params.member_params.new_fqid;
+	kparam->mcast_grp_params.member_params.new_rel_vsp_id =
+			  uparam->mcast_grp_params.member_params.new_rel_vsp_id;
 	if (compat_ptr(uparam->mcast_grp_params.member_params.policer_params)) {
 		if (copy_from_user(kparam->mcast_grp_params.member_params.
 				policer_params,
@@ -2928,6 +2930,8 @@ int dpa_cls_mcast_member_params_compatcpy(
 	kparam->member_params.new_fqid = uparam->member_params.new_fqid;
 	kparam->member_params.override_fqid =
 					uparam->member_params.override_fqid;
+	kparam->member_params.new_rel_vsp_id =
+					uparam->member_params.new_rel_vsp_id;
 	if (compat_ptr(uparam->member_params.policer_params)) {
 		if (copy_from_user(kparam->member_params.policer_params,
 			compat_ptr(uparam->member_params.policer_params),
-- 
1.7.5.4

