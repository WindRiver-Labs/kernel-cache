From 4274e51cd2f60c268d86ae0f67fac8ce87af7ae8 Mon Sep 17 00:00:00 2001
From: Alexandru Badicioiu <alexandru.badicioiu@freescale.com>
Date: Tue, 13 Nov 2012 14:40:40 +0200
Subject: [PATCH 414/518] dpa_offload : dpa_ipsec header manipulation list
 cleanup

Signed-off-by: Alexandru Badicioiu <alexandru.badicioiu@freescale.com>
[Grabbed from the branch, LINUX_IR5.2.0, of
https://git.freescale.com/git-private/cgit.cgi/ppc/alu-b4860/linux.git.]
Signed-off-by: Tiejun Chen <tiejun.chen@windriver.com>
---
 drivers/staging/fsl_dpa_offload/dpa_ipsec.c |   10 ++++++++++
 1 files changed, 10 insertions(+), 0 deletions(-)

diff --git a/drivers/staging/fsl_dpa_offload/dpa_ipsec.c b/drivers/staging/fsl_dpa_offload/dpa_ipsec.c
index 87c4c4b..52466f3 100644
--- a/drivers/staging/fsl_dpa_offload/dpa_ipsec.c
+++ b/drivers/staging/fsl_dpa_offload/dpa_ipsec.c
@@ -1083,6 +1083,16 @@ static void free_sa_mng(struct dpa_ipsec *dpa_ipsec)
 		destroy_workqueue(sa_mng->sa_rekeying_wq);
 		sa_mng->sa_rekeying_wq = NULL;
 	}
+
+	/* cleanup hmanips */
+	struct list_head *pos, *n;
+	struct ipsec_manip_node *node;
+	list_for_each_safe(pos, n, &dpa_ipsec->sa_mng.ipsec_manip_node_list) {
+		node = container_of(pos, struct ipsec_manip_node, ipsec_manip_node_list);
+		list_del(&node->ipsec_manip_node_list);
+		kfree(node->hm);
+		kfree(node);
+	}
 }
 
 /* cleanup Ipsec */
-- 
1.7.5.4

