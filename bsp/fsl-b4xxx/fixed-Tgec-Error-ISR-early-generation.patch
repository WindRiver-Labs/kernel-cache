From dab287fe12e61b91531e4d66199427ac6684073b Mon Sep 17 00:00:00 2001
From: Mandy Lavi <mandy.lavi@freescale.com>
Date: Sun, 10 Feb 2013 19:38:24 +0200
Subject: [PATCH 053/518] fixed Tgec Error ISR early generation

Signed-off-by: Mandy Lavi <mandy.lavi@freescale.com>
[Grabbed from the branch, LINUX_IR5.2.0, of
https://git.freescale.com/git-private/cgit.cgi/ppc/alu-b4860/linux.git.]
Signed-off-by: Tiejun Chen <tiejun.chen@windriver.com>
---
 .../dpa/NetCommSw/Peripherals/FM/MAC/fman_tgec.c   |    7 ++++---
 1 files changed, 4 insertions(+), 3 deletions(-)

diff --git a/drivers/net/ethernet/freescale/dpa/NetCommSw/Peripherals/FM/MAC/fman_tgec.c b/drivers/net/ethernet/freescale/dpa/NetCommSw/Peripherals/FM/MAC/fman_tgec.c
index da0eb5d..fa80a36 100644
--- a/drivers/net/ethernet/freescale/dpa/NetCommSw/Peripherals/FM/MAC/fman_tgec.c
+++ b/drivers/net/ethernet/freescale/dpa/NetCommSw/Peripherals/FM/MAC/fman_tgec.c
@@ -336,9 +336,10 @@ int tgec_init(struct tgec_regs *regs, struct tgec_cfg *cfg,
 	iowrite32be((uint32_t)cfg->max_frame_length, &regs->maxfrm);
 	/* Pause Time */
 	iowrite32be(cfg->pause_quant, &regs->pause_quant);
-	/* 2 ERRATAs here ? */
-	iowrite32be(EVENTS_MASK, &regs->ievent);
-	iowrite32be(exception_mask, &regs->imask);
+
+	/* clear all pending events and set-up interrupts */
+	tgec_ack_event(regs, 0xffffffff);
+	tgec_enable_interrupt(regs, exception_mask);
 	return 0;
 }
 
-- 
1.7.5.4

