From d5d556f0da0bebd40b56235f0c34bd7557cfe371 Mon Sep 17 00:00:00 2001
From: Marian Chereji <marian.chereji@freescale.com>
Date: Tue, 4 Dec 2012 16:09:26 +0200
Subject: [PATCH 433/518] dpa_classifier: Bug fix. Enable "don't parse after
 header manipulation" setting for VLAN specific
 header manipulation to match FMC settings

When using the function "dpa_classif_set_vlan_hm" to import VLAN specific
header manipulation resources, FMan low level driver issues an error saying
that the header manipulation node replace failed because the "don't parse
after header manipulation" setting is different in the original manip node
and in the one that dpa_classifier is attempting to replace it with. As
FMC is setting this attribute to TRUE, dpa_classifier should also set it
to TRUE in order not to create conflict.

Signed-off-by: Marian Chereji <marian.chereji@freescale.com>
[Grabbed from the branch, LINUX_IR5.2.0, of
https://git.freescale.com/git-private/cgit.cgi/ppc/alu-b4860/linux.git.]
Signed-off-by: Tiejun Chen <tiejun.chen@windriver.com>
---
 drivers/staging/fsl_dpa_offload/dpa_classifier.c |    1 +
 1 files changed, 1 insertions(+), 0 deletions(-)

diff --git a/drivers/staging/fsl_dpa_offload/dpa_classifier.c b/drivers/staging/fsl_dpa_offload/dpa_classifier.c
index ed177e2..48d3a4b 100644
--- a/drivers/staging/fsl_dpa_offload/dpa_classifier.c
+++ b/drivers/staging/fsl_dpa_offload/dpa_classifier.c
@@ -5580,6 +5580,7 @@ static int vlan_hm_update_params(struct dpa_cls_hm *pvlan_hm)
 					e_FM_PCD_MANIP_RMV_BY_HDR_SPECIFIC_L2;
 		hm_node->params.u.hdr.rmvParams.u.byHdr.u.specificL2 =
 					e_FM_PCD_MANIP_HDR_RMV_STACKED_QTAGS;
+		hm_node->params.u.hdr.dontParseAfterManip = TRUE;
 
 		break;
 	case DPA_CLS_HM_VLAN_EGRESS:
-- 
1.7.5.4

