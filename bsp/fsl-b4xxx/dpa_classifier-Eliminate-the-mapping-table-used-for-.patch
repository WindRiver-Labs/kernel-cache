From ac987860dc5547d9ea898727deb20b398f9b9ed7 Mon Sep 17 00:00:00 2001
From: Radu-Andrei BULIE <radu.bulie@freescale.com>
Date: Thu, 28 Jun 2012 14:38:29 +0000
Subject: [PATCH 241/518] dpa_classifier: Eliminate the mapping table used for
 64 bit compatibility

Due to changes in fmlib, mapping tables are no longer necessary. Enums are
used instead.

Signed-off-by: Radu-Andrei BULIE <radu.bulie@freescale.com>
Acked-by: Marian Chereji <marian.chereji@freescale.com>
[Grabbed from the branch, LINUX_IR5.2.0, of
https://git.freescale.com/git-private/cgit.cgi/ppc/alu-b4860/linux.git.]
Signed-off-by: Tiejun Chen <tiejun.chen@windriver.com>
---
 .../staging/fsl_dpa_offload/wrp_dpa_classifier.c   |   15 +++------------
 1 files changed, 3 insertions(+), 12 deletions(-)

diff --git a/drivers/staging/fsl_dpa_offload/wrp_dpa_classifier.c b/drivers/staging/fsl_dpa_offload/wrp_dpa_classifier.c
index a8272ba..08aa808 100644
--- a/drivers/staging/fsl_dpa_offload/wrp_dpa_classifier.c
+++ b/drivers/staging/fsl_dpa_offload/wrp_dpa_classifier.c
@@ -69,15 +69,6 @@ static long do_ioctl_table_lookup_by_key(unsigned long args, bool compat_mode);
 static long do_ioctl_table_lookup_by_ref(unsigned long args, bool compat_mode);
 
 
-#ifdef CONFIG_COMPAT
-
-extern const unsigned char map_node_name[][ID_MAP_NAME_SIZE];
-
-#define FM_NODE			map_node_name[0]
-#define PORT_NODE		map_node_name[1]
-#define PCD_NODE		map_node_name[2]
-
-#endif /* CONFIG_COMPAT */
 
 static const struct file_operations dpa_classif_fops = {
 	.owner			= THIS_MODULE,
@@ -1047,7 +1038,7 @@ void dpa_cls_tbl_action_params_compatcpy(
 
 		if (uparam->enq_params.hm != 0) {
 			kparam->enq_params.hm = compat_get_id2ptr(
-				uparam->enq_params.hm, PCD_NODE);
+				uparam->enq_params.hm, FM_MAP_TYPE_PCD_NODE);
 		} else
 			kparam->enq_params.hm = NULL;
 
@@ -1081,7 +1072,7 @@ void dpa_cls_tbl_action_params_rcompatcpy(
 
 		if (kparam->enq_params.hm != NULL) {
 			uparam->enq_params.hm = compat_get_ptr2id(
-				kparam->enq_params.hm, PCD_NODE);
+				kparam->enq_params.hm, FM_MAP_TYPE_PCD_NODE);
 		} else
 			uparam->enq_params.hm = 0;
 
@@ -1106,7 +1097,7 @@ void dpa_cls_tbl_params_compatcpy(
 	kparam->table_params.fm_pcd = compat_ptr(uparam->table_params.fm_pcd);
 	kparam->table_params.cc_node = compat_get_id2ptr(
 					uparam->table_params.cc_node,
-					PCD_NODE);
+					FM_MAP_TYPE_PCD_NODE);
 
 	kparam->table_params.type	= uparam->table_params.type;
 	kparam->table_params.entry_mgmt	= uparam->table_params.entry_mgmt;
-- 
1.7.5.4

