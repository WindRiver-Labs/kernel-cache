From 5be544eb5c78228b96f36fab75c8e31b6954ed2b Mon Sep 17 00:00:00 2001
From: Marian Chereji <marian.chereji@freescale.com>
Date: Fri, 9 Nov 2012 19:05:03 +0000
Subject: [PATCH 377/518] dpa_classifier: Add virtual storage profile related
 parameters

In order to support virtual storage profiles (VSP) a new attribute
was added to the enqueue parameters structure
(dpa_cls_tbl_enq_action_desc). This attribute is the new relative
VSP identifier (new_rel_vsp_id).

The same attribute was also added for the 32bit user space /
64bit kernel compatibility mode parameters structure
"dpa_cls_compat_tbl_enq_action_desc".

Signed-off-by: Marian Chereji <marian.chereji@freescale.com>
[Grabbed from the branch, LINUX_IR5.2.0, of
https://git.freescale.com/git-private/cgit.cgi/ppc/alu-b4860/linux.git.]
Signed-off-by: Tiejun Chen <tiejun.chen@windriver.com>
---
 .../staging/fsl_dpa_offload/dpa_classifier_ioctl.h |    1 +
 .../staging/fsl_dpa_offload/wrp_dpa_classifier.c   |    2 ++
 include/linux/fsl_dpa_classifier.h                 |    7 +++++++
 3 files changed, 10 insertions(+), 0 deletions(-)

diff --git a/drivers/staging/fsl_dpa_offload/dpa_classifier_ioctl.h b/drivers/staging/fsl_dpa_offload/dpa_classifier_ioctl.h
index a402410..9dd3848 100644
--- a/drivers/staging/fsl_dpa_offload/dpa_classifier_ioctl.h
+++ b/drivers/staging/fsl_dpa_offload/dpa_classifier_ioctl.h
@@ -198,6 +198,7 @@ struct dpa_cls_compat_tbl_enq_action_desc {
 	uint32_t	new_fqid;
 	compat_uptr_t	policer_params;
 	int		hmd;
+	uint8_t		new_rel_vsp_id;
 };
 
 struct dpa_cls_compat_tbl_action {
diff --git a/drivers/staging/fsl_dpa_offload/wrp_dpa_classifier.c b/drivers/staging/fsl_dpa_offload/wrp_dpa_classifier.c
index 317c751..0cd8206 100644
--- a/drivers/staging/fsl_dpa_offload/wrp_dpa_classifier.c
+++ b/drivers/staging/fsl_dpa_offload/wrp_dpa_classifier.c
@@ -2142,6 +2142,8 @@ int dpa_cls_tbl_action_params_compatcpy(
 		kparam->enq_params.new_fqid =
 				uparam->enq_params.new_fqid;
 		kparam->enq_params.hmd = uparam->enq_params.hmd;
+		kparam->enq_params.new_rel_vsp_id =
+				uparam->enq_params.new_rel_vsp_id;
 		if (compat_ptr(uparam->enq_params.policer_params)) {
 			BUG_ON(!kparam->enq_params.policer_params);
 			if (copy_from_user(kparam->enq_params.policer_params,
diff --git a/include/linux/fsl_dpa_classifier.h b/include/linux/fsl_dpa_classifier.h
index 1b5a20a..96127cf 100644
--- a/include/linux/fsl_dpa_classifier.h
+++ b/include/linux/fsl_dpa_classifier.h
@@ -220,6 +220,13 @@ struct dpa_cls_tbl_enq_action_desc {
 	 * performed for this entry.
 	 */
 	int					hmd;
+
+	/*
+	 * New virtual storage profile Id. This parameter is mandatory when
+	 * [override_fqid] is set to [true] and the port has virtual storage
+	 * profiles defined. Otherwise it is not used.
+	 */
+	uint8_t					new_rel_vsp_id;
 };
 
 /* Action parameters to route to a new classifier table */
-- 
1.7.5.4

