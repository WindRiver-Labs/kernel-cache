From a7715538faee7842eab0345ad0d8042b5dd9fb9f Mon Sep 17 00:00:00 2001
From: Mihai Serb <mihai.serb@freescale.com>
Date: Wed, 7 Mar 2012 17:16:39 +0000
Subject: [PATCH 137/518] Add support for configuring data offset in output
 frames

- replaced hardcoded data offsets with values provided during
component initialization

Signed-off-by: Mihai Serb <mihai.serb@freescale.com>
[Grabbed from the branch, LINUX_IR5.2.0, of
https://git.freescale.com/git-private/cgit.cgi/ppc/alu-b4860/linux.git.]
Signed-off-by: Tiejun Chen <tiejun.chen@windriver.com>
---
 drivers/staging/fsl_dpa_offload/dpa_ipsec_desc.c |    6 ++++--
 1 files changed, 4 insertions(+), 2 deletions(-)

diff --git a/drivers/staging/fsl_dpa_offload/dpa_ipsec_desc.c b/drivers/staging/fsl_dpa_offload/dpa_ipsec_desc.c
index 375eeb7..a2a1799 100644
--- a/drivers/staging/fsl_dpa_offload/dpa_ipsec_desc.c
+++ b/drivers/staging/fsl_dpa_offload/dpa_ipsec_desc.c
@@ -202,8 +202,10 @@ int create_sec_descriptor(struct dpa_ipsec_sa *sa)
 	sec_desc->preheader.hi.field.idlen = desc_len((u32 *) sec_desc->desc);
 	sec_desc->preheader.lo.field.pool_id = sa->sa_bpid;
 	sec_desc->preheader.lo.field.pool_buffer_size = 0;
-	/* offset output by one burst size (64 bytes) */
-	sec_desc->preheader.lo.field.offset = 1;
+	sec_desc->preheader.lo.field.offset =
+		(sa->sa_dir == DPA_IPSEC_INBOUND) ?
+			sa->dpa_ipsec->config.post_sec_in_params.data_off :
+			sa->dpa_ipsec->config.post_sec_out_params.data_off;
 
 	dma_unmap_single(jrdev, auth_key_dma,
 			 sa->auth_data.split_key_pad_len, DMA_TO_DEVICE);
-- 
1.7.5.4

