From 947e69e4566a2a31b2d387082250cdd8a710f1a2 Mon Sep 17 00:00:00 2001
From: Radu-Andrei BULIE <radu.bulie@freescale.com>
Date: Tue, 30 Oct 2012 00:02:07 +0000
Subject: [PATCH 361/518] offload_use_case: Add fix for 64 bit compat mode

Added missing parameter in compat mode - cc_out_rx_pre_enc ccnode.
Fixed incorrect check for outbound pre and post encryption ccnodes.

Signed-off-by: Radu-Andrei BULIE <radu.bulie@freescale.com>
[Grabbed from the branch, LINUX_IR5.2.0, of
https://git.freescale.com/git-private/cgit.cgi/ppc/alu-b4860/linux.git.]
Signed-off-by: Tiejun Chen <tiejun.chen@windriver.com>
---
 .../staging/fsl_dpa_offload/usecases/genl_ctl.c    |    7 +++++--
 1 files changed, 5 insertions(+), 2 deletions(-)

diff --git a/drivers/staging/fsl_dpa_offload/usecases/genl_ctl.c b/drivers/staging/fsl_dpa_offload/usecases/genl_ctl.c
index 293569b..e645d8e 100644
--- a/drivers/staging/fsl_dpa_offload/usecases/genl_ctl.c
+++ b/drivers/staging/fsl_dpa_offload/usecases/genl_ctl.c
@@ -372,7 +372,7 @@ static int put_fm_params(struct sk_buff *skb_2, struct genl_info *info)
 				compat_get_id2ptr(compat_fm_params.cc_flow_id,
 						FM_MAP_TYPE_PCD_NODE);
 		for (i = 0; i <  DPA_IPSEC_MAX_SUPPORTED_PROTOS; i++) {
-			if (fm_params.cc_out_pre_enc[i] != NULL) {
+			if (compat_fm_params.cc_out_pre_enc[i]) {
 				ptr = compat_get_id2ptr(compat_fm_params.
 							cc_out_pre_enc[i],
 							  FM_MAP_TYPE_PCD_NODE);
@@ -381,13 +381,16 @@ static int put_fm_params(struct sk_buff *skb_2, struct genl_info *info)
 		}
 
 		for (i = 0; i <  MAX_POST_ENC_PROTOS; i++) {
-			if (fm_params.cc_out_post_enc[i] != NULL) {
+			if (compat_fm_params.cc_out_post_enc[i]) {
 				ptr = compat_get_id2ptr(compat_fm_params.
 							cc_out_post_enc[i],
 							  FM_MAP_TYPE_PCD_NODE);
 				fm_params.cc_out_post_enc[i] = ptr;
 			}
 		}
+		fm_params.cc_out_rx_pre_enc = compat_get_id2ptr(
+					     compat_fm_params.cc_out_rx_pre_enc,
+					     FM_MAP_TYPE_PCD_NODE);
 		fm_params.remove_eth_hm = compat_get_id2ptr(
 						compat_fm_params.remove_eth_hm,
 						FM_MAP_TYPE_PCD_NODE);
-- 
1.7.5.4

