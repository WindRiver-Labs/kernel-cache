From 0b55bef58248ba38667603c1b712320e4b5e7f3f Mon Sep 17 00:00:00 2001
From: Anca-Jeanina Floarea <anca.floarea@freescale.com>
Date: Mon, 17 Sep 2012 18:51:37 +0000
Subject: [PATCH 326/518] dpa_stats: Fix improper call to mutex_unlock

Function mutex_unlock should not be called if
the function mutex_trylock was not successful.

Signed-off-by: Anca Jeanina FLOAREA <anca.floarea@freescale.com>
[Grabbed from the branch, LINUX_IR5.2.0, of
https://git.freescale.com/git-private/cgit.cgi/ppc/alu-b4860/linux.git.]
Signed-off-by: Tiejun Chen <tiejun.chen@windriver.com>
---
 drivers/staging/fsl_dpa_offload/dpa_stats.c |    1 -
 1 files changed, 0 insertions(+), 1 deletions(-)

diff --git a/drivers/staging/fsl_dpa_offload/dpa_stats.c b/drivers/staging/fsl_dpa_offload/dpa_stats.c
index 3f75a59..7b794607 100644
--- a/drivers/staging/fsl_dpa_offload/dpa_stats.c
+++ b/drivers/staging/fsl_dpa_offload/dpa_stats.c
@@ -2881,7 +2881,6 @@ int dpa_stats_get_counters(struct dpa_stats_cnt_request_params params,
 		err = mutex_trylock(&cnt_cb->lock);
 		if (err == 0) {
 			pr_err("Counter %d is being used\n", cnt_id);
-			mutex_unlock(&cnt_cb->lock);
 			unblock_sched_cnts(dpa_stats, params.cnts_ids,
 					params.cnts_ids_len, 0);
 			return -EBUSY;
-- 
1.7.5.4

