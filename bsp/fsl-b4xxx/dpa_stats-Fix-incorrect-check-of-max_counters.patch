From fb40381997eb98e8199c566b402ccc3873c243de Mon Sep 17 00:00:00 2001
From: Anca-Jeanina Floarea <anca.floarea@freescale.com>
Date: Wed, 8 Aug 2012 18:19:10 +0000
Subject: [PATCH 268/518] dpa_stats: Fix incorrect check of max_counters

The maximum number of counters managed by the
DPA Stats instance should not exceed the define
DPA_STATS_MAX_NUM_OF_COUNTERS

Signed-off-by: Anca Jeanina FLOAREA <anca.floarea@freescale.com>
[Grabbed from the branch, LINUX_IR5.2.0, of
https://git.freescale.com/git-private/cgit.cgi/ppc/alu-b4860/linux.git.]
Signed-off-by: Tiejun Chen <tiejun.chen@windriver.com>
---
 drivers/staging/fsl_dpa_offload/dpa_stats.c |    5 +++--
 1 files changed, 3 insertions(+), 2 deletions(-)

diff --git a/drivers/staging/fsl_dpa_offload/dpa_stats.c b/drivers/staging/fsl_dpa_offload/dpa_stats.c
index 05dfb50..eadcaa4 100644
--- a/drivers/staging/fsl_dpa_offload/dpa_stats.c
+++ b/drivers/staging/fsl_dpa_offload/dpa_stats.c
@@ -60,9 +60,10 @@ static int check_dpa_stats_params(const struct dpa_stats_params *params)
 	}
 
 	/* There must be at least one counter */
-	if (!params->max_counters) {
+	if ((params->max_counters == 0) ||
+	   (params->max_counters > DPA_STATS_MAX_NUM_OF_COUNTERS)) {
 		pr_err("Invalid DPA Stats number of counters\n");
-		return -EINVAL;
+		return -EDOM;
 	}
 
 	if (!params->storage_area) {
-- 
1.7.5.4

