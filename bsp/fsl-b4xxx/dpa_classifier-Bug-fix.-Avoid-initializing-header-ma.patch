From c0c4b73ee97f0621a3f96efa1a68fff1455f05fd Mon Sep 17 00:00:00 2001
From: Marian Chereji <marian.chereji@freescale.com>
Date: Mon, 12 Nov 2012 21:54:43 +0000
Subject: [PATCH 404/518] dpa_classifier: Bug fix. Avoid initializing header
 manip descriptor to zero for indexed table entries

The header manipulation descriptor is stored for each table entry by
the dpa_classifier for a correct management of the header manipulation
chains attached to table entries. This descriptor is used when the
entry is modified or removed to release the header manipulation object
and allow the user to remove it afterwards.

For indexed tables, the header manipulation descriptor was incorrectly
initialized to zero (which is a valid descriptor) instead of using the
DPA_OFFLD_DESC_NONE value to designate an invalid header manipulation
descriptor.

Signed-off-by: Marian Chereji <marian.chereji@freescale.com>
[Grabbed from the branch, LINUX_IR5.2.0, of
https://git.freescale.com/git-private/cgit.cgi/ppc/alu-b4860/linux.git.]
Signed-off-by: Tiejun Chen <tiejun.chen@windriver.com>
---
 drivers/staging/fsl_dpa_offload/dpa_classifier.c |    1 +
 1 files changed, 1 insertions(+), 0 deletions(-)

diff --git a/drivers/staging/fsl_dpa_offload/dpa_classifier.c b/drivers/staging/fsl_dpa_offload/dpa_classifier.c
index 7d97ffc..31baa96 100644
--- a/drivers/staging/fsl_dpa_offload/dpa_classifier.c
+++ b/drivers/staging/fsl_dpa_offload/dpa_classifier.c
@@ -2073,6 +2073,7 @@ static int table_init_indexed(struct dpa_cls_table *cls_table)
 			sizeof(struct dpa_cls_tbl_entry));
 		cls_table->entry[i].flags	|= DPA_CLS_TBL_ENTRY_VALID;
 		cls_table->entry[i].entry_index	= i;
+		cls_table->entry[i].hmd		= DPA_OFFLD_DESC_NONE;
 	}
 
 	/*
-- 
1.7.5.4

