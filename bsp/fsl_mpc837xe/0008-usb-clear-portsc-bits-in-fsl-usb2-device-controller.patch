From 75027a60e579899ae3784c600858dfdec8d0fd32 Mon Sep 17 00:00:00 2001
From: Tiejun Chen <tiejun.chen@windriver.com>
Date: Fri, 28 Aug 2009 16:36:12 +0800
Subject: [PATCH 08/38] usb: clear portsc bits in fsl usb2 device controller

When Freescale DR usb module works in device mode, the OCA, OCC and
PP bits must always be 0. However, while running in OTG mode the host
controller is free to modify these bits. We therefor need to clear these bits
each time the DR controller is setup for proper operation.

Signed-off-by: Kevin Hao <kexin.hao@windriver.com>
---
 drivers/usb/gadget/fsl_usb2_udc.c |    4 +++-
 1 files changed, 3 insertions(+), 1 deletions(-)

diff --git a/drivers/usb/gadget/fsl_usb2_udc.c b/drivers/usb/gadget/fsl_usb2_udc.c
index c33a489..4155e37 100644
--- a/drivers/usb/gadget/fsl_usb2_udc.c
+++ b/drivers/usb/gadget/fsl_usb2_udc.c
@@ -233,7 +233,9 @@ static int dr_controller_setup(struct fsl_udc *udc)
 
 	/* Config PHY interface */
 	portctrl = fsl_readl(&dr_regs->portsc1);
-	portctrl &= ~(PORTSCX_PHY_TYPE_SEL | PORTSCX_PORT_WIDTH);
+	portctrl &= ~(PORTSCX_PHY_TYPE_SEL | PORTSCX_PORT_WIDTH | \
+			PORTSCX_OVER_CURRENT_ACT | PORTSCX_OVER_CURRENT_CHG | \
+			PORTSCX_PORT_POWER);
 	switch (udc->phy_mode) {
 	case FSL_USB2_PHY_ULPI:
 		portctrl |= PORTSCX_PTS_ULPI;
-- 
1.6.3.3

