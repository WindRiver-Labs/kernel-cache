From 3482af32a695273785a33cfa65c4371d32223dc9 Mon Sep 17 00:00:00 2001
From: Tiejun Chen <tiejun.chen@windriver.com>
Date: Fri, 28 Aug 2009 16:36:02 +0800
Subject: [PATCH 01/38] powerpc/83xx: Add and fix some device nodes on mpc837x dts file

1> Add 'dr_mode = "otg";' to support USB Host by default on mpc837[7 8 9]_rdb
2> Add nor flash partitions only on mpc8377_rdb
3> Fix eLBC range on mpc8377_rdb only on mpc8377_rdb
    - U-boot(1.3.3) set the eLBC CS1 physical address to 0xe2800000.
    So make the dts conform to the bootloader.

Signed-off-by: Kevin Hao <kexin.hao@windriver.com>
Signed-off-by: Tiejun Chen <tiejun.chen@windriver.com>
---
 arch/powerpc/boot/dts/mpc8377_mds.dts |    2 +-
 arch/powerpc/boot/dts/mpc8377_rdb.dts |   26 +++++++++++++++++++++++++-
 arch/powerpc/boot/dts/mpc8378_mds.dts |    8 ++++----
 arch/powerpc/boot/dts/mpc8378_rdb.dts |    1 +
 arch/powerpc/boot/dts/mpc8379_mds.dts |    2 +-
 arch/powerpc/boot/dts/mpc8379_rdb.dts |    1 +
 6 files changed, 33 insertions(+), 7 deletions(-)

diff --git a/arch/powerpc/boot/dts/mpc8377_mds.dts b/arch/powerpc/boot/dts/mpc8377_mds.dts
index 432782b..9f1c846 100644
--- a/arch/powerpc/boot/dts/mpc8377_mds.dts
+++ b/arch/powerpc/boot/dts/mpc8377_mds.dts
@@ -165,7 +165,7 @@
 			#size-cells = <0>;
 			interrupt-parent = <&ipic>;
 			interrupts = <38 0x8>;
-			dr_mode = "host";
+			dr_mode = "otg";
 			phy_type = "ulpi";
 		};
 
diff --git a/arch/powerpc/boot/dts/mpc8377_rdb.dts b/arch/powerpc/boot/dts/mpc8377_rdb.dts
index ed137aa..cf9f614 100644
--- a/arch/powerpc/boot/dts/mpc8377_rdb.dts
+++ b/arch/powerpc/boot/dts/mpc8377_rdb.dts
@@ -58,7 +58,7 @@
 		// booting from nand, but the
 		// addresses are the same.
 		ranges = <0x0 0x0 0xfe000000 0x00800000
-		          0x1 0x0 0xe0600000 0x00008000
+		          0x1 0x0 0xe2800000 0x00008000
 		          0x2 0x0 0xf0000000 0x00020000
 		          0x3 0x0 0xfa000000 0x00008000>;
 
@@ -69,8 +69,31 @@
 			reg = <0x0 0x0 0x800000>;
 			bank-width = <2>;
 			device-width = <1>;
+
+			u-boot@0 {
+				reg = <0x0 0x90000>;
+				read-only;
+			};
+
+			dtb@90000 {
+				reg = <0x90000 0x10000>;
+			};
+
+			kernel@a0000 {
+				reg = <0xa0000 0x300000>;
+			};
+
+			rootfs@3a0000 {
+				reg = <0x3a0000 0x450000>;
+			};
+
+			switch_firmware@7f0000 {
+				reg = <0x7f0000 0x10000>;
+				read-only;
+			};
 		};
 
+
 		nand@1,0 {
 			#address-cells = <1>;
 			#size-cells = <1>;
@@ -185,6 +208,7 @@
 			#size-cells = <0>;
 			interrupt-parent = <&ipic>;
 			interrupts = <38 0x8>;
+			dr_mode = "otg";
 			phy_type = "ulpi";
 		};
 
diff --git a/arch/powerpc/boot/dts/mpc8378_mds.dts b/arch/powerpc/boot/dts/mpc8378_mds.dts
index ed32c8d..6c93378 100644
--- a/arch/powerpc/boot/dts/mpc8378_mds.dts
+++ b/arch/powerpc/boot/dts/mpc8378_mds.dts
@@ -74,11 +74,11 @@
 			};
 
 			fs@100000 {
-				reg = <0x100000 0x800000>;
+				reg = <0x100000 0x1b00000>;
 			};
 
-			kernel@1d00000 {
-				reg = <0x1d00000 0x200000>;
+			kernel@1c00000 {
+				reg = <0x1c00000 0x300000>;
 			};
 
 			dtb@1f00000 {
@@ -200,7 +200,7 @@
 			#size-cells = <0>;
 			interrupt-parent = <&ipic>;
 			interrupts = <38 0x8>;
-			dr_mode = "host";
+			dr_mode = "otg";
 			phy_type = "ulpi";
 		};
 
diff --git a/arch/powerpc/boot/dts/mpc8378_rdb.dts b/arch/powerpc/boot/dts/mpc8378_rdb.dts
index 34a7f2f..85db2b9 100644
--- a/arch/powerpc/boot/dts/mpc8378_rdb.dts
+++ b/arch/powerpc/boot/dts/mpc8378_rdb.dts
@@ -185,6 +185,7 @@
 			#size-cells = <0>;
 			interrupt-parent = <&ipic>;
 			interrupts = <38 0x8>;
+			dr_mode = "otg";
 			phy_type = "ulpi";
 		};
 
diff --git a/arch/powerpc/boot/dts/mpc8379_mds.dts b/arch/powerpc/boot/dts/mpc8379_mds.dts
index f4db9ed..6156759 100644
--- a/arch/powerpc/boot/dts/mpc8379_mds.dts
+++ b/arch/powerpc/boot/dts/mpc8379_mds.dts
@@ -200,7 +200,7 @@
 			#size-cells = <0>;
 			interrupt-parent = <&ipic>;
 			interrupts = <38 0x8>;
-			dr_mode = "host";
+			dr_mode = "otg";
 			phy_type = "ulpi";
 		};
 
diff --git a/arch/powerpc/boot/dts/mpc8379_rdb.dts b/arch/powerpc/boot/dts/mpc8379_rdb.dts
index e4d7030..17c5abc 100644
--- a/arch/powerpc/boot/dts/mpc8379_rdb.dts
+++ b/arch/powerpc/boot/dts/mpc8379_rdb.dts
@@ -185,6 +185,7 @@
 			#size-cells = <0>;
 			interrupt-parent = <&ipic>;
 			interrupts = <38 0x8>;
+			dr_mode = "otg";
 			phy_type = "ulpi";
 		};
 
-- 
1.6.3.3

