From d3093c1f90eadffd7488c2b3060ba641fdcc0817 Mon Sep 17 00:00:00 2001
From: Tiejun Chen <tiejun.chen@windriver.com>
Date: Fri, 28 Aug 2009 16:36:13 +0800
Subject: [PATCH 09/38] usb/otg: stop device controller by default in otg mode

In otg mode after we register the device driver and before a gadget
driver is registered, the device driver will register irq handler and
begin to ack usb interrupt status. Because host and device controller
share the same interrupt status register, this will cause a conflict.
So set the stop flag in device driver to stop it processing usb interrupts
until a real gadget driver is register.

Signed-off-by: Kevin Hao <kexin.hao@windriver.com>
---
 drivers/usb/gadget/fsl_usb2_udc.c |    1 +
 1 files changed, 1 insertions(+), 0 deletions(-)

diff --git a/drivers/usb/gadget/fsl_usb2_udc.c b/drivers/usb/gadget/fsl_usb2_udc.c
index 4155e37..67b5184 100644
--- a/drivers/usb/gadget/fsl_usb2_udc.c
+++ b/drivers/usb/gadget/fsl_usb2_udc.c
@@ -2402,6 +2402,7 @@ static int __init fsl_udc_probe(struct platform_device *pdev)
 #if (defined(CONFIG_FSL_USB_OTG) || defined(CONFIG_FSL_USB_OTG_MODULE)) && (defined(CONFIG_USB_EHCI_HCD) \
                 || defined(CONFIG_USB_EHCI_HCD_MODULE))
         udc_controller->gadget.is_otg = 1;
+	udc_controller->stopped = 1;
 #endif
 
 	/* setup QH and epctrl for ep0 */
-- 
1.6.3.3

