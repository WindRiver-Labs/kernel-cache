From 47755315cd0b557209ebaebbe460649d93429b20 Mon Sep 17 00:00:00 2001
From: Tonyliu <Bo.Liu@windriver.com>
Date: Thu, 22 Oct 2009 16:57:44 +0800
Subject: [PATCH 13/14] PM: add suspend/resume for DaVinci HW watchdog

Add suspend/resume methods for PM.

Signed-off-by: Tonyliu <Bo.Liu@windriver.com>
---
 drivers/watchdog/davinci_wdt.c |   22 ++++++++++++++++++++++
 1 files changed, 22 insertions(+), 0 deletions(-)

diff --git a/drivers/watchdog/davinci_wdt.c b/drivers/watchdog/davinci_wdt.c
index efe7305..0119f2c 100644
--- a/drivers/watchdog/davinci_wdt.c
+++ b/drivers/watchdog/davinci_wdt.c
@@ -263,6 +263,26 @@ static int __devexit davinci_wdt_remove(struct platform_device *pdev)
 	return 0;
 }
 
+#ifdef CONFIG_PM
+static int davinci_wdt_suspend(struct platform_device *pdev,
+		pm_message_t state)
+{
+	clk_disable(wdt_clk);
+
+	return 0;
+}
+
+static int davinci_wdt_resume(struct platform_device *pdev)
+{
+	clk_enable(wdt_clk);
+
+	return 0;
+}
+#else
+#define davinci_wdt_suspend	NULL
+#define davinci_wdt_resume	NULL
+#endif
+
 static struct platform_driver platform_wdt_driver = {
 	.driver = {
 		.name = "watchdog",
@@ -270,6 +290,8 @@ static struct platform_driver platform_wdt_driver = {
 	},
 	.probe = davinci_wdt_probe,
 	.remove = __devexit_p(davinci_wdt_remove),
+	.suspend = davinci_wdt_suspend,
+	.resume = davinci_wdt_resume,
 };
 
 static int __init davinci_wdt_init(void)
-- 
1.6.5.2

