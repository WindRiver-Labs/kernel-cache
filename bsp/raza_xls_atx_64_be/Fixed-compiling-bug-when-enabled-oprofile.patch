From 612343ae8944ecf27e37a0e38ed2a07e9fabe28a Mon Sep 17 00:00:00 2001
From: changhui liu <cliu@pek-lpgbuild6.(none)>
Date: Wed, 3 Feb 2010 11:34:01 +0800
Subject: [PATCH] Fixed compiling bug when enabled oprofile

This BSP does not have a usable implementation of hardware performance
counters so OProfile must fall back to be used in timer mode. If you are
using OProfile you must add "oprofile.timer=1" to your kernel boot
options.

Some files from rmi SDK including macros and codes for rmi oprofile, if
we enabled oprofile it will be wrong when compiling the kernel. So remove
RMI specific oprofile code.

Signed-off-by: Liu Changhui <changhui.liu@windriver.com>
---
 arch/mips/rmi/phoenix/irq.c  |   13 -------------
 arch/mips/rmi/phoenix/time.c |    4 ----
 2 files changed, 0 insertions(+), 17 deletions(-)

diff --git a/arch/mips/rmi/phoenix/irq.c b/arch/mips/rmi/phoenix/irq.c
index 872c71e..bc831bb 100644
--- a/arch/mips/rmi/phoenix/irq.c
+++ b/arch/mips/rmi/phoenix/irq.c
@@ -412,9 +412,6 @@ void __init init_phoenix_irqs(void)
 	for(i=PIC_IRT_FIRST_IRQ;i<=PIC_IRT_LAST_IRQ();i++) 
 		phnx_irq_mask |= (1ULL << i);
 
-	#ifdef CONFIG_OPROFILE
-	phnx_irq_mask |= (1ULL<<IRQ_IPI_OPROFILE);
-	#endif
   
 #ifdef CONFIG_KGDB
 	phnx_irq_mask |= (1ULL << IRQ_IPI_SMP_KGDB);
@@ -425,10 +422,6 @@ void __init init_phoenix_irqs(void)
 #ifdef CONFIG_KGDB
 extern irqreturn_t xlr_kgdb_ipi_handler(int irq, struct pt_regs *regs);
 #endif
-#ifdef CONFIG_OPROFILE
-extern void phoenix_oprofile_int_handler(int irq, void * dev_id,
-		        struct pt_regs *regs);
-#endif
 void do_phnx_IRQ(unsigned int irq, struct pt_regs *regs)
 {
 
@@ -450,12 +443,6 @@ void do_phnx_IRQ(unsigned int irq, struct pt_regs *regs)
 	else if (irq == IRQ_IPI_SMP_KGDB) {
 	}
 #endif
-#ifdef CONFIG_OPROFILE
-	else if (irq == IRQ_IPI_OPROFILE) {
-		if(phoenix_thr_id() != 0)
-			phoenix_oprofile_int_handler (irq, NULL, regs);
-	}
-#endif
 	else
 		do_IRQ(irq);
 }
diff --git a/arch/mips/rmi/phoenix/time.c b/arch/mips/rmi/phoenix/time.c
index b97a5b6..c5fd770 100644
--- a/arch/mips/rmi/phoenix/time.c
+++ b/arch/mips/rmi/phoenix/time.c
@@ -81,10 +81,6 @@ void save_epc(unsigned long *epc)
 		      ".set pop\n"
 		      : "=r" (*epc) );
 }
-#ifdef CONFIG_OPROFILE
-extern void phoenix_oprofile_int_handler(int irq, void * dev_id,
-		        struct pt_regs *regs);
-#endif
 void phoenix_timer_interrupt(struct pt_regs *regs, int irq)
 {
 	int cpu = smp_processor_id();
-- 
1.6.0.4

