From a47f57a58cbd86247f2433bb845888ecd727e485 Mon Sep 17 00:00:00 2001
From: Stanley.Miao <stanley.miao@windriver.com>
Date: Fri, 30 Apr 2010 14:22:36 +0800
Subject: [PATCH 4/4] Add PM for tsc2004.

Add pm_ops for tsc2004 in order that the touchscreen can wake up the system.

Signed-off-by: Stanley.Miao <stanley.miao@windriver.com>
---
 drivers/input/touchscreen/tsc2004.c |   34 +++++++++++++++++++++++++++++++++-
 1 files changed, 33 insertions(+), 1 deletions(-)

diff --git a/drivers/input/touchscreen/tsc2004.c b/drivers/input/touchscreen/tsc2004.c
index ea2847f..c3ed5c2 100644
--- a/drivers/input/touchscreen/tsc2004.c
+++ b/drivers/input/touchscreen/tsc2004.c
@@ -462,6 +462,8 @@ static int __devinit tsc2004_probe(struct i2c_client *client,
 
 	i2c_set_clientdata(client, ts);
 
+	device_init_wakeup(&client->dev, 1);
+
 	return 0;
 
  err_free_irq:
@@ -490,6 +492,33 @@ static int __devexit tsc2004_remove(struct i2c_client *client)
 	return 0;
 }
 
+#ifdef CONFIG_PM
+static int tsc2004_rtc_suspend(struct device *dev)
+{
+	struct i2c_client *client;
+
+	client = container_of(dev, struct i2c_client, dev);
+
+	set_irq_wake(client->irq, 1);
+	return 0;
+}
+
+static int tsc2004_rtc_resume(struct device *dev)
+{
+	struct i2c_client *client;
+
+	client = container_of(dev, struct i2c_client, dev);
+
+	set_irq_wake(client->irq, 0);
+	return 0;
+}
+
+static const struct dev_pm_ops tsc2004_rtc_pm_ops = {
+	.suspend        = tsc2004_rtc_suspend,
+	.resume         = tsc2004_rtc_resume,
+};
+#endif
+
 static struct i2c_device_id tsc2004_idtable[] = {
 	{ "tsc2004", 0 },
 	{ }
@@ -500,7 +529,10 @@ MODULE_DEVICE_TABLE(i2c, tsc2004_idtable);
 static struct i2c_driver tsc2004_driver = {
 	.driver = {
 		.owner	= THIS_MODULE,
-		.name	= "tsc2004"
+		.name	= "tsc2004",
+#ifdef CONFIG_PM
+		.pm	= &tsc2004_rtc_pm_ops,
+#endif
 	},
 	.id_table	= tsc2004_idtable,
 	.probe		= tsc2004_probe,
-- 
1.6.5.2

