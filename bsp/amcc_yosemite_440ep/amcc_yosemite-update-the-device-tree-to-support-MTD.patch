From adbdd8f56daf692185489c143e6710272f8418fd Mon Sep 17 00:00:00 2001
From: Luo Chunbo <chunbo.luo@windriver.com>
Date: Thu, 4 Mar 2010 14:58:21 +0800
Subject: [PATCH 1/2] amcc_yosemite: update the device tree to support MTD

The of-flash cannot get IO address from device tree because the
node falsh should not be a child node EBC0, it should be an child
node of POB0.

And the YOSEMITE board has a 64M flash whitch start from address
Oxfc000000. Change the <reg > unit and the MTD partitions to fit
the 64M flash. We also change the filesystem maps because the
bootloader was located in the top address.

Signed-off-by: Luo Chunbo <chunbo.luo@windriver.com>
---
 arch/powerpc/boot/dts/yosemite.dts |   42 ++++++++++++++++++------------------
 1 files changed, 21 insertions(+), 21 deletions(-)

diff --git a/arch/powerpc/boot/dts/yosemite.dts b/arch/powerpc/boot/dts/yosemite.dts
index bb2c222..116b25b 100644
--- a/arch/powerpc/boot/dts/yosemite.dts
+++ b/arch/powerpc/boot/dts/yosemite.dts
@@ -138,27 +138,6 @@
 				clock-frequency = <0>; /* Filled in by zImage */
 				interrupts = <0x5 0x1>;
 				interrupt-parent = <&UIC1>;
-
-				flash@fc000000 {
-					compatible = "cfi-flash";
-					reg = <0x00000000 0xfc000000 0x02000000>;
-					bank-width = <2>;
-					#address-cells = <1>;
-					#size-cells = <1>;
-					partition@0 {
-						label = "bootloader";
-						reg = <0x00000000 0x00080000>; /* two 256KiB sectors */
-					};
-					partition@1 {
-						label = "kernel";
-						reg = <0x00080000 0x00200000>; /* 2 MiB */
-					};
-					partition@2 {
-						label = "rootfs";
-						reg = <0x00280000 0x1D80000>; /* 29.5 MiB */
-					};
-				};
-
 			};
 
 			UART0: serial@ef600300 {
@@ -277,6 +256,27 @@
 				interrupts = <0x8 0x4 0x9 0x4>;
 				interrupt-parent = < &UIC1 >;
 			};
+
+			flash@fc000000 {
+				compatible = "cfi-flash";
+				reg = <0xfc000000 0x04000000>;
+				bank-width = <2>;
+				#address-cells = <1>;
+				#size-cells = <1>;
+				partition@0 {
+					label = "kernel";
+					reg = <0x00000000 0x00400000>; /* 4 MiB */
+				};
+				partition@1 {
+					label = "rootfs";
+					reg = <0x00400000 0x03B80000>; /* 59.5 MiB */
+				};
+				partition@2 {
+					label = "bootloader";
+					reg = <0x03F80000 0x00080000>; /* two 256KiB sectors */
+					read-only;
+				};
+			};
 		};
 
 		PCI0: pci@ec000000 {
-- 
1.6.5.2

