From ff39c72f5df0804375f0e2c9f549a4e42d9030a3 Mon Sep 17 00:00:00 2001
From: Tian Le <le.tian@windriver.com>
Date: Mon, 19 Dec 2011 11:08:23 +0800
Subject: [PATCH 09/11] FSL P1010: Add power management support in DTS

The BSP supports features to minimize power consumption at several levels.
* Software controlled e500 core low power mode (DOZE, NAP)
* Software controlled system power state (SLEEP, HIBERNATION),
  Sleep mode where most of clocks in SoC are shut down,

Wake-up events source to exit low power mode, such as:
* eTSEC magic packet
* MPIC timer

Signed-off-by: Tian Le <le.tian@windriver.com>
---
 arch/powerpc/boot/dts/p1010rdb.dts     |   28 ++++++++++++++++++++++++++++
 arch/powerpc/boot/dts/p1010rdb_36b.dts |   28 ++++++++++++++++++++++++++++
 2 files changed, 56 insertions(+), 0 deletions(-)

diff --git a/arch/powerpc/boot/dts/p1010rdb.dts b/arch/powerpc/boot/dts/p1010rdb.dts
index a764f27..1597d85 100644
--- a/arch/powerpc/boot/dts/p1010rdb.dts
+++ b/arch/powerpc/boot/dts/p1010rdb.dts
@@ -374,6 +374,13 @@
 			};
 		};
 
+		timer@41100 {
+			compatible = "fsl,mpic-global-timer";
+			reg = <0x41100 0x204>;
+			interrupts = <0xf7 0x2>;
+			interrupt-parent = <&mpic>;
+		};
+
 		enet0: ethernet@b0000 {
 			#address-cells = <1>;
 			#size-cells = <1>;
@@ -388,6 +395,8 @@
 			phy-connection-type = "rgmii-id";
 
 			ptimer-handle = < &ptp_timer >;
+			fsl,magic-packet;
+			clk-handle = <&etsec1_clk>;
 			queue-group@0 {
 				#address-cells = <1>;
 				#size-cells = <1>;
@@ -414,6 +423,8 @@
 			phy-connection-type = "sgmii";
 
 			ptimer-handle = < &ptp_timer >;
+			fsl,magic-packet;
+			clk-handle = <&etsec2_clk>;
 			queue-group@0 {
 				#address-cells = <1>;
 				#size-cells = <1>;
@@ -440,6 +451,8 @@
 			phy-connection-type = "sgmii";
 
 			ptimer-handle = < &ptp_timer >;
+			fsl,magic-packet;
+			clk-handle = <&etsec3_clk>;
 			queue-group@0 {
 				#address-cells = <1>;
 				#size-cells = <1>;
@@ -474,6 +487,21 @@
 			device_type = "open-pic";
 		};
 
+		power@e0070{
+			compatible = "fsl,p2020-pmc", "fsl,mpc8548-pmc";
+			reg = <0xe0070 0x20>;
+
+			etsec1_clk: soc-clk@24{
+				fsl,pmcdr-mask = <0x00000080>;
+                        };
+			etsec2_clk: soc-clk@25{
+				fsl,pmcdr-mask = <0x00000040>;
+			};
+			etsec3_clk: soc-clk@26{
+				fsl,pmcdr-mask = <0x00000020>;
+			};
+		};
+
 		message@41400 {
 			compatible = "fsl,p1020-msg", "fsl,mpic-msg";
 			reg = <0x41400 0x200>;
diff --git a/arch/powerpc/boot/dts/p1010rdb_36b.dts b/arch/powerpc/boot/dts/p1010rdb_36b.dts
index 8d98980..29a7063 100644
--- a/arch/powerpc/boot/dts/p1010rdb_36b.dts
+++ b/arch/powerpc/boot/dts/p1010rdb_36b.dts
@@ -347,6 +347,13 @@
 			};
 		};
 
+		timer@41100 {
+			compatible = "fsl,mpic-global-timer";
+			reg = <0x41100 0x204>;
+			interrupts = <0xf7 0x2>;
+			interrupt-parent = <&mpic>;
+		};
+
 		enet0: ethernet@b0000 {
 			#address-cells = <1>;
 			#size-cells = <1>;
@@ -361,6 +368,8 @@
 			phy-connection-type = "rgmii-id";
 
 			ptimer-handle = < &ptp_timer >;
+			fsl,magic-packet;
+			clk-handle = <&etsec1_clk>;
 			queue-group@0 {
 				#address-cells = <1>;
 				#size-cells = <1>;
@@ -387,6 +396,8 @@
 			phy-connection-type = "sgmii";
 
 			ptimer-handle = < &ptp_timer >;
+			fsl,magic-packet;
+			clk-handle = <&etsec2_clk>;
 			queue-group@0 {
 				#address-cells = <1>;
 				#size-cells = <1>;
@@ -413,6 +424,8 @@
 			phy-connection-type = "sgmii";
 
 			ptimer-handle = < &ptp_timer >;
+			fsl,magic-packet;
+			clk-handle = <&etsec3_clk>;
 			queue-group@0 {
 				#address-cells = <1>;
 				#size-cells = <1>;
@@ -446,6 +459,21 @@
 			device_type = "open-pic";
 		};
 
+		power@e0070{
+			compatible = "fsl,p2020-pmc", "fsl,mpc8548-pmc";
+			reg = <0xe0070 0x20>;
+
+			etsec1_clk: soc-clk@24{
+				fsl,pmcdr-mask = <0x00000080>;
+                        };
+			etsec2_clk: soc-clk@25{
+				fsl,pmcdr-mask = <0x00000040>;
+			};
+			etsec3_clk: soc-clk@26{
+				fsl,pmcdr-mask = <0x00000020>;
+			};
+		};
+
 		message@41400 {
 			compatible = "fsl,p1020-msg", "fsl,mpic-msg";
 			reg = <0x41400 0x200>;
-- 
1.7.0

