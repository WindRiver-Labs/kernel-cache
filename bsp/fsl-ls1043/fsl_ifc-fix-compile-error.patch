From 6eda90a19d827cd8237d55f2ed418b7514a1ecf8 Mon Sep 17 00:00:00 2001
From: Shaohui Xie <Shaohui.Xie@freescale.com>
Date: Sat, 6 Jun 2015 15:12:40 +0800
Subject: [PATCH 184/451] fsl_ifc: fix compile error

1. fix header path for arm64
2. commented out PM related codes, the API used in PM codes are not
implmented in ARM64, need owner to look it.

Signed-off-by: Mingkai Hu <Mingkai.Hu@freescale.com>
[Xulin: Original patch taken from
Linux-LS1043A-SDK-V0.4-SOURCE-20150826-yocto.iso]
Signed-off-by: Xulin Sun <xulin.sun@windriver.com>
---
 drivers/memory/fsl_ifc.c |   13 +++++++++++++
 include/linux/fsl_ifc.h  |    2 ++
 2 files changed, 15 insertions(+), 0 deletions(-)

diff --git a/drivers/memory/fsl_ifc.c b/drivers/memory/fsl_ifc.c
index 8886854..3f69010 100644
--- a/drivers/memory/fsl_ifc.c
+++ b/drivers/memory/fsl_ifc.c
@@ -23,6 +23,7 @@
 #include <linux/kernel.h>
 #include <linux/compiler.h>
 #include <linux/spinlock.h>
+#include <linux/delay.h>
 #include <linux/types.h>
 #include <linux/slab.h>
 #include <linux/io.h>
@@ -35,10 +36,16 @@
 #include <linux/of_irq.h>
 #include <linux/platform_device.h>
 #include <linux/fsl_ifc.h>
+#ifdef CONFIG_ARM64
+#include "../../arch/arm/include/asm/prom.h"
+#else
 #include <asm/prom.h>
+#endif
 
 struct fsl_ifc_ctrl *fsl_ifc_ctrl_dev;
 EXPORT_SYMBOL(fsl_ifc_ctrl_dev);
+#define FSL_IFC_V1_3_0		0x01030000
+#define IFC_TIMEOUT_MSECS	100000 /* 100ms */
 
 /*
  * convert_ifc_address - convert the base address
@@ -304,6 +311,7 @@ err:
 	return ret;
 }
 
+#ifndef CONFIG_ARM64
 #ifdef CONFIG_PM_SLEEP
 /* save ifc registers */
 static int fsl_ifc_suspend(struct device *dev)
@@ -353,6 +361,7 @@ static int fsl_ifc_resume(struct device *dev)
 	return 0;
 }
 #endif /* CONFIG_PM_SLEEP */
+#endif
 
 static const struct of_device_id fsl_ifc_match[] = {
 	{
@@ -361,15 +370,19 @@ static const struct of_device_id fsl_ifc_match[] = {
 	{},
 };
 
+#ifndef CONFIG_ARM64
 static const struct dev_pm_ops ifc_pm_ops = {
 	SET_SYSTEM_SLEEP_PM_OPS(fsl_ifc_suspend, fsl_ifc_resume)
 };
+#endif
 
 static struct platform_driver fsl_ifc_ctrl_driver = {
 	.driver = {
 		.name	= "fsl-ifc",
 		.of_match_table = fsl_ifc_match,
+#ifndef CONFIG_ARM64
 		.pm = &ifc_pm_ops,
+#endif
 	},
 	.probe       = fsl_ifc_ctrl_probe,
 	.remove      = fsl_ifc_ctrl_remove,
diff --git a/include/linux/fsl_ifc.h b/include/linux/fsl_ifc.h
index 8ebd3ae..cbca5aa 100644
--- a/include/linux/fsl_ifc.h
+++ b/include/linux/fsl_ifc.h
@@ -270,6 +270,8 @@
  */
 /* Auto Boot Mode */
 #define IFC_NAND_NCFGR_BOOT		0x80000000
+/* SRAM INIT EN */
+#define IFC_NAND_SRAM_INIT_EN		0x20000000
 /* Addressing Mode-ROW0+n/COL0 */
 #define IFC_NAND_NCFGR_ADDR_MODE_RC0	0x00000000
 /* Addressing Mode-ROW0+n/COL0+n */
-- 
1.7.5.4

