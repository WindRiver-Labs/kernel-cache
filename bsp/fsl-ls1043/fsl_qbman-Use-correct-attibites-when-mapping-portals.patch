From 65b592d7fd859299ad532fd69eff3d1e365ea5c6 Mon Sep 17 00:00:00 2001
From: Roy Pledge <Roy.Pledge@freescale.com>
Date: Thu, 14 May 2015 17:17:42 -0400
Subject: [PATCH 139/451] fsl_qbman: Use correct attibites when mapping
 portals in USDPAA

Make sure portal area is cacheable for USDPAA

Signed-off-by: Roy Pledge <Roy.Pledge@freescale.com>
[Xulin: Original patch taken from
Linux-LS1043A-SDK-V0.4-SOURCE-20150826-yocto.iso]
Signed-off-by: Xulin Sun <xulin.sun@windriver.com>
---
 drivers/staging/fsl_qbman/dpa_sys_arm64.h |    1 -
 drivers/staging/fsl_qbman/fsl_usdpaa.c    |    2 +-
 2 files changed, 1 insertions(+), 2 deletions(-)

diff --git a/drivers/staging/fsl_qbman/dpa_sys_arm64.h b/drivers/staging/fsl_qbman/dpa_sys_arm64.h
index 5ae07e3..9ca2ab88 100644
--- a/drivers/staging/fsl_qbman/dpa_sys_arm64.h
+++ b/drivers/staging/fsl_qbman/dpa_sys_arm64.h
@@ -102,7 +102,6 @@ static inline void flush_dcache_range(unsigned long start, unsigned long stop)
 
 /* TBD - may need to deal with this for ARM */
 #define ioremap_prot(addr, sz, prot) ioremap(addr, sz)
-#define pgprot_cached_noncoherent(prot)  pgprot_dmacoherent(prot)
 
 #define hard_smp_processor_id() raw_smp_processor_id()
 
diff --git a/drivers/staging/fsl_qbman/fsl_usdpaa.c b/drivers/staging/fsl_qbman/fsl_usdpaa.c
index 7678db2..09d5b5c 100644
--- a/drivers/staging/fsl_qbman/fsl_usdpaa.c
+++ b/drivers/staging/fsl_qbman/fsl_usdpaa.c
@@ -705,7 +705,7 @@ static int check_mmap_portal(struct ctx *ctx, struct vm_area_struct *vma,
 					  match, pfn);
 		if (*match) {
 			vma->vm_page_prot =
-				pgprot_cached_noncoherent(vma->vm_page_prot);
+				pgprot_cached(vma->vm_page_prot);
 			return ret;
 		}
 		ret = check_mmap_resource(&portal->phys[DPA_PORTAL_CI], vma,
-- 
1.7.5.4

