From eeee825d4f4478eb404d661cc2c9a2a6ed77146d Mon Sep 17 00:00:00 2001
From: Mandy Lavi <mandy.lavi@freescale.com>
Date: Sat, 30 May 2015 01:43:34 +0300
Subject: [PATCH 172/451] fmd: ioctl compat layer adjustments

Signed-off-by: Mandy Lavi <mandy.lavi@freescale.com>
[Xulin: Original patch taken from
Linux-LS1043A-SDK-V0.4-SOURCE-20150826-yocto.iso]
Signed-off-by: Xulin Sun <xulin.sun@windriver.com>
---
 .../fman/src/wrapper/lnxwrp_ioctls_fm_compat.c     |   25 +-------------------
 .../fman/src/wrapper/lnxwrp_ioctls_fm_compat.h     |   10 --------
 .../fman/src/wrapper/lnxwrp_sysfs_fm_port.c        |   12 ++++----
 3 files changed, 7 insertions(+), 40 deletions(-)

diff --git a/drivers/net/ethernet/freescale/fman/src/wrapper/lnxwrp_ioctls_fm_compat.c b/drivers/net/ethernet/freescale/fman/src/wrapper/lnxwrp_ioctls_fm_compat.c
index 33cfb10..10aadad 100644
--- a/drivers/net/ethernet/freescale/fman/src/wrapper/lnxwrp_ioctls_fm_compat.c
+++ b/drivers/net/ethernet/freescale/fman/src/wrapper/lnxwrp_ioctls_fm_compat.c
@@ -53,7 +53,7 @@
 #include <linux/ioport.h>
 #include <asm/uaccess.h>
 #include <asm/errno.h>
-#include <sysdev/fsl_soc.h>
+/* #include <sysdev/fsl_soc.h> */
 
 #include "part_ext.h"
 #include "fm_ioctls.h"
@@ -1239,26 +1239,3 @@ void compat_copy_fm_vsp_prs_result_params(
     _fm_cpt_dbg (compat, " ...->}\n");
 }
 #endif /* (DPAA_VERSION >= 11) */
-
-void compat_copy_fm_port_prs_result_params(
-    ioc_compat_fm_port_prs_result_params_t *compat_param,
-    ioc_fm_port_prs_result_params_t *param,
-    uint8_t compat)
-{
-    _fm_cpt_dbg (compat, " {->...\n");
-
-    if (compat == COMPAT_US_TO_K)
-    {
-        param->p_fm_port = compat_pcd_id2ptr(compat_param->p_fm_port);
-        /* p_data is an user-space pointer that needs to remain unmodified */
-        param->p_data = (void *)(unsigned long long)compat_param->p_data;
-    }
-    else
-    {
-        compat_param->p_fm_port = compat_pcd_ptr2id(param->p_fm_port);
-        /* p_data is an user-space pointer that needs to remain unmodified */
-        compat_param->p_data = (compat_uptr_t)((unsigned long long)param->p_data & 0xFFFFFFFF);
-    }
-
-    _fm_cpt_dbg (compat, " ...->}\n");
-}
diff --git a/drivers/net/ethernet/freescale/fman/src/wrapper/lnxwrp_ioctls_fm_compat.h b/drivers/net/ethernet/freescale/fman/src/wrapper/lnxwrp_ioctls_fm_compat.h
index c374298..ae19b68 100644
--- a/drivers/net/ethernet/freescale/fman/src/wrapper/lnxwrp_ioctls_fm_compat.h
+++ b/drivers/net/ethernet/freescale/fman/src/wrapper/lnxwrp_ioctls_fm_compat.h
@@ -516,11 +516,6 @@ typedef struct ioc_compat_fm_vsp_prs_result_params_t {
 } ioc_compat_fm_vsp_prs_result_params_t;
 #endif /* (DPAA_VERSION >= 11) */
 
-typedef struct ioc_compat_fm_port_prs_result_params_t {
-    compat_uptr_t p_fm_port;
-    compat_uptr_t p_data;
-} ioc_compat_fm_port_prs_result_params_t;
-
 typedef struct ioc_compat_fm_ctrl_mon_counters_params_t {
     uint8_t     fm_ctrl_index;
     compat_uptr_t p_mon;
@@ -651,11 +646,6 @@ void compat_copy_fm_port_pcd_modify_tree(
         ioc_fm_obj_t *id,
         uint8_t compat);
 
-void compat_copy_fm_port_prs_result_params(
-	ioc_compat_fm_port_prs_result_params_t *compat_param,
-	ioc_fm_port_prs_result_params_t *param,
-	uint8_t compat);
-
 #if (DPAA_VERSION >= 11)
 void compat_copy_fm_pcd_frm_replic_group_params(
 	ioc_compat_fm_pcd_frm_replic_group_params_t *compat_param,
diff --git a/drivers/net/ethernet/freescale/fman/src/wrapper/lnxwrp_sysfs_fm_port.c b/drivers/net/ethernet/freescale/fman/src/wrapper/lnxwrp_sysfs_fm_port.c
index 98c3271..ad167ac 100644
--- a/drivers/net/ethernet/freescale/fman/src/wrapper/lnxwrp_sysfs_fm_port.c
+++ b/drivers/net/ethernet/freescale/fman/src/wrapper/lnxwrp_sysfs_fm_port.c
@@ -792,14 +792,14 @@ static ssize_t show_fm_port_qmi_regs(struct device *dev,
 #endif
 }
 
-static DEVICE_ATTR(fm_port_regs, 0x644, show_fm_port_regs, NULL);
-static DEVICE_ATTR(fm_port_qmi_regs, 0x644, show_fm_port_qmi_regs, NULL);
-static DEVICE_ATTR(fm_port_bmi_regs, 0x644, show_fm_port_bmi_regs, NULL);
+static DEVICE_ATTR(fm_port_regs, 0444, show_fm_port_regs, NULL);
+static DEVICE_ATTR(fm_port_qmi_regs, 0444, show_fm_port_qmi_regs, NULL);
+static DEVICE_ATTR(fm_port_bmi_regs, 0444, show_fm_port_bmi_regs, NULL);
 #if (DPAA_VERSION >= 11)
-static DEVICE_ATTR(fm_port_ipv4_opt, 0x644, show_fm_port_ipv4_options, NULL);
+static DEVICE_ATTR(fm_port_ipv4_opt, 0444, show_fm_port_ipv4_options, NULL);
 #endif
-static DEVICE_ATTR(fm_port_dsar_regs, 0x644, show_fm_port_dsar_regs, NULL);
-static DEVICE_ATTR(fm_port_dsar_mem, 0x644, show_fm_port_dsar_mem, NULL);
+static DEVICE_ATTR(fm_port_dsar_regs, 0444, show_fm_port_dsar_regs, NULL);
+static DEVICE_ATTR(fm_port_dsar_mem, 0444, show_fm_port_dsar_mem, NULL);
 
 int fm_port_sysfs_create(struct device *dev)
 {
-- 
1.7.5.4

