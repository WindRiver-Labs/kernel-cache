From 136304d4c6ea60195fd44ae6de2730ca3e29021c Mon Sep 17 00:00:00 2001
From: Zumeng Chen <zumeng.chen@windriver.com>
Date: Mon, 25 Jul 2016 19:19:35 -0700
Subject: [PATCH 01/18] Revert "drivers: dwc3 : Add support for USB snooping"

This patch was the leftover of node related updates, so I just revert it
to avoid the building halt, if this snooping action is necessary, then I
need to figure out the right way later.

This reverts commit 12a24f51c89eb1371466cd77c9450244fded834c.

Signed-off-by: Zumeng Chen <zumeng.chen@windriver.com>
---
 drivers/usb/dwc3/core.c | 7 -------
 drivers/usb/dwc3/core.h | 1 -
 drivers/usb/dwc3/host.c | 6 ------
 3 files changed, 14 deletions(-)

diff --git a/drivers/usb/dwc3/core.c b/drivers/usb/dwc3/core.c
index 2cc2877..a80d51c 100644
--- a/drivers/usb/dwc3/core.c
+++ b/drivers/usb/dwc3/core.c
@@ -1021,13 +1021,6 @@ static int dwc3_probe(struct platform_device *pdev)
 	dwc3_writel(dwc->regs, DWC3_GSBUSCFG1,
 		dwc3_readl(dwc->regs, DWC3_GSBUSCFG1) | 0xf00);
 
-	/* Enable Snooping */
-	if (node && of_dma_is_coherent(node)) {
-		dwc3_writel(dwc->regs, DWC3_GSBUSCFG0,
-				dwc3_readl(dwc->regs, DWC3_GSBUSCFG0) | 0x22220000);
-		dev_dbg(dev, "enabled snooping for usb\n");
-	}
-
 	if (IS_ENABLED(CONFIG_USB_DWC3_HOST))
 		dwc->dr_mode = USB_DR_MODE_HOST;
 	else if (IS_ENABLED(CONFIG_USB_DWC3_GADGET))
diff --git a/drivers/usb/dwc3/core.h b/drivers/usb/dwc3/core.h
index 5263c79..17347b3 100644
--- a/drivers/usb/dwc3/core.h
+++ b/drivers/usb/dwc3/core.h
@@ -26,7 +26,6 @@
 #include <linux/dma-mapping.h>
 #include <linux/mm.h>
 #include <linux/debugfs.h>
-#include <linux/of_address.h>
 
 #include <linux/usb/ch9.h>
 #include <linux/usb/gadget.h>
diff --git a/drivers/usb/dwc3/host.c b/drivers/usb/dwc3/host.c
index 4c597d2..c679f63 100644
--- a/drivers/usb/dwc3/host.c
+++ b/drivers/usb/dwc3/host.c
@@ -38,12 +38,6 @@ int dwc3_host_init(struct dwc3 *dwc)
 	xhci->dev.dma_mask	= dwc->dev->dma_mask;
 	xhci->dev.dma_parms	= dwc->dev->dma_parms;
 
-	/* set DMA operations */
-	if (dwc->dev->of_node && of_dma_is_coherent(dwc->dev->of_node)) {
-		xhci->dev.archdata.dma_ops = dwc->dev->archdata.dma_ops;
-		dev_dbg(dwc->dev, "set dma_ops for usb\n");
-	}
-
 	dwc->xhci = xhci;
 
 	ret = platform_device_add_resources(xhci, dwc->xhci_resources,
-- 
2.7.4

