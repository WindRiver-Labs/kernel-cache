From 9cdf98f0a13fd6f3d99c8d877e275bccf04c2058 Mon Sep 17 00:00:00 2001
From: Zumeng Chen <zumeng.chen@windriver.com>
Date: Tue, 6 Sep 2016 08:26:37 +0800
Subject: [PATCH 20/21] dpaa_eth: fix the potential memory leakage in case failure

Generally speaking, this hardly happens since pool seed memory alloc should
not be failed, so this patch is just in case of pool seed_cb failure to free
the allocated memory.

Signed-off-by: Zumeng Chen <zumeng.chen@windriver.com>
---
 drivers/net/ethernet/freescale/sdk_dpaa/dpaa_eth_common.c | 3 +++
 1 file changed, 3 insertions(+)

diff --git a/drivers/net/ethernet/freescale/sdk_dpaa/dpaa_eth_common.c b/drivers/net/ethernet/freescale/sdk_dpaa/dpaa_eth_common.c
index 283dca7..e9b718c 100644
--- a/drivers/net/ethernet/freescale/sdk_dpaa/dpaa_eth_common.c
+++ b/drivers/net/ethernet/freescale/sdk_dpaa/dpaa_eth_common.c
@@ -785,6 +785,9 @@ dpa_bp_alloc(struct dpa_bp *dpa_bp)
 	return 0;
 
 pool_seed_failed:
+	if (dpa_bp->free_buf_cb)
+		dpa_bp_drain(dpa_bp);
+
 pdev_mask_failed:
 	platform_device_unregister(pdev);
 pdev_register_failed:
-- 
2.9.3

