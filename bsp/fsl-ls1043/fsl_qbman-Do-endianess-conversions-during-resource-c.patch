From b1da2cb9fa1c58de848313f7fc2497a90694c4e1 Mon Sep 17 00:00:00 2001
From: Roy Pledge <Roy.Pledge@freescale.com>
Date: Tue, 19 May 2015 15:42:57 -0400
Subject: [PATCH 140/451] fsl_qbman: Do endianess conversions during resource
 cleanup

FQIDs need to be byteswapped before being given to hardware
during QMan resource recovery

Signed-off-by: Roy Pledge <Roy.Pledge@freescale.com>
[Xulin: Original patch taken from
Linux-LS1043A-SDK-V0.4-SOURCE-20150826-yocto.iso]
Signed-off-by: Xulin Sun <xulin.sun@windriver.com>
---
 drivers/staging/fsl_qbman/qman_low.h |    6 +++---
 1 files changed, 3 insertions(+), 3 deletions(-)

diff --git a/drivers/staging/fsl_qbman/qman_low.h b/drivers/staging/fsl_qbman/qman_low.h
index 5b50924..f7dd92a 100644
--- a/drivers/staging/fsl_qbman/qman_low.h
+++ b/drivers/staging/fsl_qbman/qman_low.h
@@ -1193,7 +1193,7 @@ static inline int qm_shutdown_fq(struct qm_portal **portal, int portal_count,
 
 	/* Determine the state of the FQID */
 	mcc = qm_mc_start(portal[0]);
-	mcc->queryfq_np.fqid = fqid;
+	mcc->queryfq_np.fqid = cpu_to_be32(fqid);
 	qm_mc_commit(portal[0], QM_MCC_VERB_QUERYFQ_NP);
 	while (!(mcr = qm_mc_result(portal[0])))
 		cpu_relax();
@@ -1204,7 +1204,7 @@ static inline int qm_shutdown_fq(struct qm_portal **portal, int portal_count,
 
 	/* Query which channel the FQ is using */
 	mcc = qm_mc_start(portal[0]);
-	mcc->queryfq.fqid = fqid;
+	mcc->queryfq.fqid = cpu_to_be32(fqid);
 	qm_mc_commit(portal[0], QM_MCC_VERB_QUERYFQ);
 	while (!(mcr = qm_mc_result(portal[0])))
 		cpu_relax();
@@ -1221,7 +1221,7 @@ static inline int qm_shutdown_fq(struct qm_portal **portal, int portal_count,
 	case QM_MCR_NP_STATE_PARKED:
 		orl_empty = 0;
 		mcc = qm_mc_start(portal[0]);
-		mcc->alterfq.fqid = fqid;
+		mcc->alterfq.fqid = cpu_to_be32(fqid);
 		qm_mc_commit(portal[0], QM_MCC_VERB_ALTER_RETIRE);
 		while (!(mcr = qm_mc_result(portal[0])))
 			cpu_relax();
-- 
1.7.5.4

