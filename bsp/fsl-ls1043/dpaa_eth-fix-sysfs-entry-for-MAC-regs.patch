From c5285d397b2b2ba4506b4c613bb30f9d2a8db68c Mon Sep 17 00:00:00 2001
From: Marian-Cristian Rotariu <marian.rotariu@freescale.com>
Date: Mon, 23 Feb 2015 18:02:56 +0200
Subject: [PATCH 153/451] dpaa_eth: fix sysfs entry for MAC regs

Signed-off-by: Marian-Cristian Rotariu <marian.rotariu@freescale.com>
Change-Id: I83b9741567b7db70088b1e6ca8de3ae7de4e78a8
Reviewed-on: http://git.am.freescale.net:8181/31580
Tested-by: Review Code-CDREVIEW <CDREVIEW@freescale.com>
Reviewed-by: Madalin-Cristian Bucur <madalin.bucur@freescale.com>
Reviewed-by: Mingkai Hu <Mingkai.Hu@freescale.com>
Reviewed-by: Yang Li <LeoLi@freescale.com>
[Xulin: Original patch taken from
Linux-LS1043A-SDK-V0.4-SOURCE-20150826-yocto.iso]
Signed-off-by: Xulin Sun <xulin.sun@windriver.com>
---
 drivers/net/ethernet/freescale/dpa/mac.c |    4 +---
 1 files changed, 1 insertions(+), 3 deletions(-)

diff --git a/drivers/net/ethernet/freescale/dpa/mac.c b/drivers/net/ethernet/freescale/dpa/mac.c
index a629960..d1384e9 100644
--- a/drivers/net/ethernet/freescale/dpa/mac.c
+++ b/drivers/net/ethernet/freescale/dpa/mac.c
@@ -45,6 +45,7 @@
 #include <linux/of_net.h>
 #include <linux/device.h>
 #include <linux/phy.h>
+#include <linux/io.h>
 
 #include <dpaa_eth.h>
 
@@ -220,8 +221,6 @@ static int __cold mac_probe(struct platform_device *_of_dev)
 		goto _return_dev_set_drvdata;
 	}
 
-#ifndef CONFIG_FSL_DPAA_DBG_EMULATOR
-	/* TODO: find out why devm_ioremap() call is not working */
 	mac_dev->vaddr = devm_ioremap(dev, mac_dev->res->start,
 				      mac_dev->res->end + 1
 				      - mac_dev->res->start);
@@ -230,7 +229,6 @@ static int __cold mac_probe(struct platform_device *_of_dev)
 		_errno = -EIO;
 		goto _return_dev_set_drvdata;
 	}
-#endif
 
 #define TBIPA_OFFSET		0x1c
 #define TBIPA_DEFAULT_ADDR	5 /* override if used as external PHY addr. */
-- 
1.7.5.4

