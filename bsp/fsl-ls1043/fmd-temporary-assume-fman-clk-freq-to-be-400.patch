From 26c4d195d8290f639634c85f4f1b9d3da210e85c Mon Sep 17 00:00:00 2001
From: Mandy Lavi <mandy.lavi@freescale.com>
Date: Wed, 1 Jul 2015 20:56:55 +0300
Subject: [PATCH 254/451] fmd: temporary assume fman clk freq to be 400

Signed-off-by: Mandy Lavi <mandy.lavi@freescale.com>
[Xulin: Original patch taken from
Linux-LS1043A-SDK-V0.4-SOURCE-20150826-yocto.iso]
Signed-off-by: Xulin Sun <xulin.sun@windriver.com>
---
 .../ethernet/freescale/fman/Peripherals/FM/fman.c  |   10 ++++------
 .../freescale/fman/src/wrapper/lnxwrp_fm.c         |    2 +-
 2 files changed, 5 insertions(+), 7 deletions(-)

diff --git a/drivers/net/ethernet/freescale/fman/Peripherals/FM/fman.c b/drivers/net/ethernet/freescale/fman/Peripherals/FM/fman.c
index 0df3fa2..e80982a 100755
--- a/drivers/net/ethernet/freescale/fman/Peripherals/FM/fman.c
+++ b/drivers/net/ethernet/freescale/fman/Peripherals/FM/fman.c
@@ -190,10 +190,10 @@ void fman_enable_time_stamp(struct fman_fpm_regs *fpm_rg,
 	/* we check remainder of the division in order to round up if not int */
 	if (((ts_freq << 16) - (intgr << 16)*fm_clk_freq) % fm_clk_freq)
 		frac++;
-#if 0 /* just a try */
+
 	tmp = (intgr << FPM_TS_INT_SHIFT) | (uint16_t)frac;
 	iowrite32be(tmp, &fpm_rg->fmfp_tsc2);
-#endif
+
 	/* enable timestamp with original clock */
 	iowrite32be(FPM_TS_CTL_EN, &fpm_rg->fmfp_tsc1);
 }
@@ -289,23 +289,21 @@ uint8_t fman_get_qmi_enq_th(struct fman_qmi_regs *qmi_rg)
 void fman_set_qmi_enq_th(struct fman_qmi_regs *qmi_rg, uint8_t val)
 {
 	uint32_t tmp_reg;
-#if 0
+
 	tmp_reg = ioread32be(&qmi_rg->fmqm_gc);
 	tmp_reg &= ~QMI_CFG_ENQ_MASK;
 	tmp_reg |= ((uint32_t)val << 8);
 	iowrite32be(tmp_reg, &qmi_rg->fmqm_gc);
-#endif
 }
 
 void fman_set_qmi_deq_th(struct fman_qmi_regs *qmi_rg, uint8_t val)
 {
 	uint32_t tmp_reg;
-#if 0
+
 	tmp_reg = ioread32be(&qmi_rg->fmqm_gc);
 	tmp_reg &= ~QMI_CFG_DEQ_MASK;
 	tmp_reg |= (uint32_t)val;
 	iowrite32be(tmp_reg, &qmi_rg->fmqm_gc);
-#endif
 }
 
 void fman_qmi_disable_dispatch_limit(struct fman_fpm_regs *fpm_rg)
diff --git a/drivers/net/ethernet/freescale/fman/src/wrapper/lnxwrp_fm.c b/drivers/net/ethernet/freescale/fman/src/wrapper/lnxwrp_fm.c
index 31e3e77..c4ab684 100755
--- a/drivers/net/ethernet/freescale/fman/src/wrapper/lnxwrp_fm.c
+++ b/drivers/net/ethernet/freescale/fman/src/wrapper/lnxwrp_fm.c
@@ -559,7 +559,7 @@ static t_LnxWrpFmDev * ReadFmDevTreeNode (struct platform_device *of_dev)
     p_LnxWrpFmDev->fmDevSettings.param.fmClkFreq = (tmp_prop + 500000)/1000000; /* In MHz, rounded */
 printk("\n DBG: CCCCCCCCCCCCCCC recv clk-feq %d \n",tmp_prop);
 #warning planting clock-frequency
-    p_LnxWrpFmDev->fmDevSettings.param.fmClkFreq = (699999993 + 500000)/1000000; /* In MHz, rounded */
+    p_LnxWrpFmDev->fmDevSettings.param.fmClkFreq = (400000000 + 500000)/1000000; /* In MHz, rounded */
 
     /* Get the MURAM base address and size */
     memset(&name, 0, sizeof(struct of_device_id));
-- 
1.7.5.4

