From 953bef1e6c9b190342df29722d747dd86139ddc6 Mon Sep 17 00:00:00 2001
From: Alex Porosanu <alexandru.porosanu@freescale.com>
Date: Fri, 7 Aug 2015 18:17:08 +0300
Subject: [PATCH 443/451] crypto/caam: fix conversion of SG entry address.

The structure qm_sg_entry was updated for LE systems (and BE
DPAA block). Thus the way the address is written in the conversion
function of the CAAM driver is no longer correct. This patch
corrects the writing of the address and uses the proper accessor
for writing it.

Signed-off-by: Alex Porosanu <alexandru.porosanu@freescale.com>
[Xulin: Original patch taken from
Linux-LS1043A-SDK-V0.4-SOURCE-20150826-yocto.iso]
Signed-off-by: Xulin Sun <xulin.sun@windriver.com>
---
 drivers/crypto/caam/sg_sw_qm.h |    5 ++---
 1 files changed, 2 insertions(+), 3 deletions(-)

diff --git a/drivers/crypto/caam/sg_sw_qm.h b/drivers/crypto/caam/sg_sw_qm.h
index e878c75..1e44a8a 100644
--- a/drivers/crypto/caam/sg_sw_qm.h
+++ b/drivers/crypto/caam/sg_sw_qm.h
@@ -37,10 +37,9 @@
 
 static inline void cpu_to_hw_sg(struct qm_sg_entry *qm_sg_ptr)
 {
-	dma_addr_t addr = qm_sg_ptr->addr;
+	dma_addr_t addr = qm_sg_ptr->opaque;
 
-	qm_sg_ptr->addr_hi = (uint8_t)upper_32_bits(addr);
-	qm_sg_ptr->addr_lo = wr_en_val32(lower_32_bits(addr));
+	qm_sg_ptr->opaque = wr_en_val64(addr);
 	qm_sg_ptr->sgt_efl = wr_en_val32(qm_sg_ptr->sgt_efl);
 }
 
-- 
1.7.5.4

