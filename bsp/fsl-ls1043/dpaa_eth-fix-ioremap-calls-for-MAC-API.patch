From 6eff927a908f26fbca541e3eae0e90dc7a7df3e0 Mon Sep 17 00:00:00 2001
From: Marian-Cristian Rotariu <marian.rotariu@freescale.com>
Date: Mon, 2 Feb 2015 15:09:29 +0200
Subject: [PATCH 151/451] dpaa_eth: fix ioremap calls for MAC API

These calls were intentionally commented in order to create a lightweight driver
to be tested in the simulator.

Signed-off-by: Marian-Cristian Rotariu <marian.rotariu@freescale.com>
Change-Id: I45c8cfb6c5c9125a7eedeaad07137a2844a9150b
Reviewed-on: http://git.am.freescale.net:8181/29734
Tested-by: Review Code-CDREVIEW <CDREVIEW@freescale.com>
Reviewed-by: Madalin-Cristian Bucur <madalin.bucur@freescale.com>
Reviewed-by: Yang Li <LeoLi@freescale.com>
[Xulin: Original patch taken from
Linux-LS1043A-SDK-V0.4-SOURCE-20150826-yocto.iso]
Signed-off-by: Xulin Sun <xulin.sun@windriver.com>
---
 drivers/net/ethernet/freescale/dpa/mac-api.c |    8 ++------
 1 files changed, 2 insertions(+), 6 deletions(-)

diff --git a/drivers/net/ethernet/freescale/dpa/mac-api.c b/drivers/net/ethernet/freescale/dpa/mac-api.c
index dcb6ff2..663de71 100644
--- a/drivers/net/ethernet/freescale/dpa/mac-api.c
+++ b/drivers/net/ethernet/freescale/dpa/mac-api.c
@@ -44,6 +44,7 @@
 #include <linux/of_mdio.h>
 #include <linux/phy.h>
 #include <linux/netdevice.h>
+#include <linux/io.h>
 
 #include "dpaa_eth.h"
 #include "mac.h"
@@ -132,11 +133,9 @@ static int __cold init(struct mac_device *mac_dev)
 	uint32_t			version;
 
 	priv = macdev_priv(mac_dev);
-#ifndef CONFIG_FSL_DPAA_DBG_EMULATOR
-	/* TODO find out why devm_ioremap is failing */
+
 	param.baseAddr =  (typeof(param.baseAddr))(uintptr_t)devm_ioremap(
 		mac_dev->dev, mac_dev->res->start, 0x2000);
-#endif
 	param.enetMode	= macdev2enetinterface(mac_dev);
 	memcpy(&param.addr, mac_dev->addr, min(sizeof(param.addr),
 		sizeof(mac_dev->addr)));
@@ -226,11 +225,8 @@ static int __cold memac_init(struct mac_device *mac_dev)
 
 	priv = macdev_priv(mac_dev);
 
-#ifndef CONFIG_FSL_DPAA_DBG_EMULATOR
-	/* TODO find out why devm_ioremap is failing */
 	param.baseAddr =  (typeof(param.baseAddr))(uintptr_t)devm_ioremap(
 		mac_dev->dev, mac_dev->res->start, 0x2000);
-#endif
 	param.enetMode	= macdev2enetinterface(mac_dev);
 	memcpy(&param.addr, mac_dev->addr, sizeof(mac_dev->addr));
 	param.macId		= mac_dev->cell_index;
-- 
1.7.5.4

