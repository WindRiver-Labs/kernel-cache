From a1ee6d613289dbb17c7057a1c423a443e48f7d12 Mon Sep 17 00:00:00 2001
From: Roy Pledge <Roy.Pledge@freescale.com>
Date: Thu, 4 Jun 2015 09:08:47 -0400
Subject: [PATCH 175/451] fsl_qbman: Byteswap depletion states

Byteswap the depeletion state data read from hardware. Restore
original test parameters.

Signed-off-by: Roy Pledge <Roy.Pledge@freescale.com>
[Xulin: Original patch taken from
Linux-LS1043A-SDK-V0.4-SOURCE-20150826-yocto.iso]
Signed-off-by: Xulin Sun <xulin.sun@windriver.com>
---
 drivers/staging/fsl_qbman/bman_high.c        |    2 ++
 drivers/staging/fsl_qbman/bman_test_thresh.c |   11 -----------
 2 files changed, 2 insertions(+), 11 deletions(-)

diff --git a/drivers/staging/fsl_qbman/bman_high.c b/drivers/staging/fsl_qbman/bman_high.c
index d6ec015..50163b4 100644
--- a/drivers/staging/fsl_qbman/bman_high.c
+++ b/drivers/staging/fsl_qbman/bman_high.c
@@ -460,6 +460,8 @@ static u32 __poll_portal_slow(struct bman_portal *p, u32 is)
 		while (!(mcr = bm_mc_result(&p->p)))
 			cpu_relax();
 		tmp = mcr->query.ds.state;
+		tmp.__state[0] = be32_to_cpu(tmp.__state[0]);
+		tmp.__state[1] = be32_to_cpu(tmp.__state[1]);
 		PORTAL_IRQ_UNLOCK(p, irqflags);
 		for (i = 0; i < 2; i++) {
 			int idx = i * 32;
diff --git a/drivers/staging/fsl_qbman/bman_test_thresh.c b/drivers/staging/fsl_qbman/bman_test_thresh.c
index 34e14bb..6709369 100644
--- a/drivers/staging/fsl_qbman/bman_test_thresh.c
+++ b/drivers/staging/fsl_qbman/bman_test_thresh.c
@@ -32,20 +32,9 @@
 #include "bman_test.h"
 
 /* Test constants */
-/* TODO: LS1043 - reduce counts for test until larger BMan areas
-   can be supported.
-
 #define TEST_NUMBUFS	129728
 #define TEST_EXIT	129536
 #define TEST_ENTRY	129024
-*/
-
-#define TEST_NUMBUFS	728
-#define TEST_EXIT	536
-#define TEST_ENTRY	024
-
-
-
 
 struct affine_test_data {
 	struct task_struct *t;
-- 
1.7.5.4

