From adc25729677bab70d9ab4c4cedf9b0738531c5c5 Mon Sep 17 00:00:00 2001
From: Shaohui Xie <Shaohui.Xie@freescale.com>
Date: Sun, 7 Jun 2015 19:04:28 +0800
Subject: [PATCH 186/451] i2c: added i2c support to ls1043ardb

1. fixed clocks
2. enabled I2C configs
3. added rtc

Signed-off-by: Mingkai Hu <Mingkai.Hu@freescale.com>
[Xulin: Original patch taken from
Linux-LS1043A-SDK-V0.4-SOURCE-20150826-yocto.iso]
Signed-off-by: Xulin Sun <xulin.sun@windriver.com>
---
 arch/arm64/boot/dts/freescale/fsl-ls1043a-rdb.dts |    5 +++++
 arch/arm64/boot/dts/freescale/fsl-ls1043a.dtsi    |    8 ++++----
 drivers/i2c/busses/Kconfig                        |    4 ++--
 3 files changed, 11 insertions(+), 6 deletions(-)

diff --git a/arch/arm64/boot/dts/freescale/fsl-ls1043a-rdb.dts b/arch/arm64/boot/dts/freescale/fsl-ls1043a-rdb.dts
index 6f0e5a0..9734042 100644
--- a/arch/arm64/boot/dts/freescale/fsl-ls1043a-rdb.dts
+++ b/arch/arm64/boot/dts/freescale/fsl-ls1043a-rdb.dts
@@ -53,6 +53,11 @@
 		compatible = "at24,24c512";
 		reg = <0x53>;
 	};
+
+	rtc@68 {
+		compatible = "pericom,pt7c4338";
+		reg = <0x69>;
+	};
 };
 
 &ifc {
diff --git a/arch/arm64/boot/dts/freescale/fsl-ls1043a.dtsi b/arch/arm64/boot/dts/freescale/fsl-ls1043a.dtsi
index ed3deec..a391492 100644
--- a/arch/arm64/boot/dts/freescale/fsl-ls1043a.dtsi
+++ b/arch/arm64/boot/dts/freescale/fsl-ls1043a.dtsi
@@ -582,7 +582,7 @@
 		reg = <0x0 0x2180000 0x0 0x10000>;
 		interrupts = <0 56 0x4>;
 		clock-names = "i2c";
-		clocks = <400000000>;
+		clocks = <&platform_clk 1>;
 	};
 
 	i2c1: i2c@2190000 {
@@ -592,7 +592,7 @@
 		reg = <0x0 0x2190000 0x0 0x10000>;
 		interrupts = <0 57 0x4>;
 		clock-names = "i2c";
-		clocks = <400000000>;
+		clocks = <&platform_clk 1>;
 		status = "disabled";
 	};
 
@@ -603,7 +603,7 @@
 		reg = <0x0 0x21a0000 0x0 0x10000>;
 		interrupts = <0 58 0x4>;
 		clock-names = "i2c";
-		clocks = <400000000>;
+		clocks = <&platform_clk 1>;
 		status = "disabled";
 	};
 
@@ -614,7 +614,7 @@
 		reg = <0x0 0x21b0000 0x0 0x10000>;
 		interrupts = <0 59 0x4>;
 		clock-names = "i2c";
-		clocks = <400000000>;
+		clocks = <&platform_clk 1>;
 		status = "disabled";
 	};
 
diff --git a/drivers/i2c/busses/Kconfig b/drivers/i2c/busses/Kconfig
index b99241b..e53aa65 100644
--- a/drivers/i2c/busses/Kconfig
+++ b/drivers/i2c/busses/Kconfig
@@ -488,10 +488,10 @@ config I2C_IBM_IIC
 
 config I2C_IMX
 	tristate "IMX I2C interface"
-	depends on ARCH_MXC || ARCH_FSL_LS2085A
+	depends on ARCH_MXC || ARCH_FSL_LS2085A || ARCH_FSL_LS1043A
 	help
 	  Say Y here if you want to use the IIC bus controller on
-	  the Freescale i.MX/MXC or LS2085A processors.
+	  the Freescale i.MX/MXC or LS2085A/LS1043A processors.
 
 	  This driver can also be built as a module.  If so, the module
 	  will be called i2c-imx.
-- 
1.7.5.4

