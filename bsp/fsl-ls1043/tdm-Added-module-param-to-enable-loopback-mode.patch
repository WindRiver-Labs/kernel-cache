From d870bcc2b00e27e030321e044a1e106bb4af6c6f Mon Sep 17 00:00:00 2001
From: Sandeep Singh <Sandeep@freescale.com>
Date: Mon, 2 Dec 2013 17:58:00 +0530
Subject: [PATCH 215/451] tdm: Added module param to enable loopback mode

module param "loopback" if set will configure tdm device
to initialize in loopback mode.

Signed-off-by: Sandeep Singh <Sandeep@freescale.com>
Change-Id: I74b19ea2dd07a15672d71a6da0273d9aba69ddd3
Reviewed-on: http://git.am.freescale.net:8181/7000
Tested-by: Review Code-CDREVIEW <CDREVIEW@freescale.com>
Reviewed-by: Poonam Aggrwal <poonam.aggrwal@freescale.com>
Reviewed-by: Jose Rivera <German.Rivera@freescale.com>
[Xulin: Original patch taken from
Linux-LS1043A-SDK-V0.4-SOURCE-20150826-yocto.iso]
Signed-off-by: Xulin Sun <xulin.sun@windriver.com>
---
 drivers/tdm/device/tdm_fsl.c |    7 +++++++
 1 files changed, 7 insertions(+), 0 deletions(-)

diff --git a/drivers/tdm/device/tdm_fsl.c b/drivers/tdm/device/tdm_fsl.c
index 69b535b..8140a06 100644
--- a/drivers/tdm/device/tdm_fsl.c
+++ b/drivers/tdm/device/tdm_fsl.c
@@ -50,6 +50,11 @@
 #define DRV_DESC "Freescale TDM Driver Adapter"
 #define DRV_NAME "fsl_tdm"
 
+int loopback;
+module_param(loopback, int, 0);
+MODULE_PARM_DESC(loopback, "Enable TDM in loopback mode."
+		" Enable=1, Disable=0(default)");
+
 static int tdmen = 1;
 
 module_param(tdmen, int, S_IRUSR);
@@ -419,6 +424,8 @@ static int tdm_fsl_reg_init(struct tdm_priv *priv)
 	tx_tcd_init(priv);
 	rx_tcd_init(priv);
 
+	adap->adapt_cfg.loopback = loopback;
+
 	/* TDM RD->TD loopback, Share T/R Fsync,Clock */
 	if (adap->adapt_cfg.loopback)
 		out_be32(&priv->tdm_regs->gir, GIR_LPBK | GIR_RTS);
-- 
1.7.5.4

