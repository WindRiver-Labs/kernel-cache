From 8e28eb618235e4a857920ca6fe99aa2dcb8314c1 Mon Sep 17 00:00:00 2001
From: Shaohui Xie <Shaohui.Xie@freescale.com>
Date: Tue, 16 Jun 2015 07:29:26 +0800
Subject: [PATCH 204/451] ls1043a: enabl dspi support

Signed-off-by: Shaohui Xie <Shaohui.Xie@freescale.com>
Signed-off-by: Mingkai Hu <Mingkai.Hu@freescale.com>
[Xulin: Original patch taken from
Linux-LS1043A-SDK-V0.4-SOURCE-20150826-yocto.iso]
Signed-off-by: Xulin Sun <xulin.sun@windriver.com>
---
 arch/arm64/boot/dts/freescale/fsl-ls1043a.dtsi |    6 +++---
 drivers/spi/Kconfig                            |    4 ++--
 2 files changed, 5 insertions(+), 5 deletions(-)

diff --git a/arch/arm64/boot/dts/freescale/fsl-ls1043a.dtsi b/arch/arm64/boot/dts/freescale/fsl-ls1043a.dtsi
index 29cf93d..8b46730 100644
--- a/arch/arm64/boot/dts/freescale/fsl-ls1043a.dtsi
+++ b/arch/arm64/boot/dts/freescale/fsl-ls1043a.dtsi
@@ -126,7 +126,7 @@
 		reg-names = "QuadSPI", "QuadSPI-memory";
 		interrupts = <0 99 0x4>;
 		clock-names = "qspi_en", "qspi";
-		clocks = <400000000>, <400000000>;
+		clocks = <&platform_clk 1>, <&platform_clk 1>;
 		big-endian;
 		amba-base = <0x40000000>;
 	};
@@ -582,7 +582,7 @@
 		reg = <0x0 0x2100000 0x0 0x10000>;
 		interrupts = <0 64 0x4>;
 		clock-names = "dspi";
-		clocks = <400000000>;
+		clocks = <&platform_clk 1>;
 		spi-num-chipselects = <5>;
 		big-endian;
 		tcfq-mode;
@@ -596,7 +596,7 @@
 		reg = <0x0 0x2110000 0x0 0x10000>;
 		interrupts = <0 65 0x4>;
 		clock-names = "dspi";
-		clocks = <400000000>;
+		clocks = <&platform_clk 1>;
 		spi-num-chipselects = <5>;
 		big-endian;
 		status = "disabled";
diff --git a/drivers/spi/Kconfig b/drivers/spi/Kconfig
index 64362e1..f5a34ed 100644
--- a/drivers/spi/Kconfig
+++ b/drivers/spi/Kconfig
@@ -269,8 +269,8 @@ config SPI_FSL_SPI
 
 config SPI_FSL_DSPI
 	tristate "Freescale DSPI controller"
-	select SPI_BITBANG
-	depends on SOC_VF610 || COMPILE_TEST
+	select REGMAP_MMIO
+	depends on SOC_VF610 || SOC_LS1021A || ARCH_FSL_LS1043A || COMPILE_TEST
 	help
 	  This enables support for the Freescale DSPI controller in master
 	  mode. VF610 platform uses the controller.
-- 
1.7.5.4

