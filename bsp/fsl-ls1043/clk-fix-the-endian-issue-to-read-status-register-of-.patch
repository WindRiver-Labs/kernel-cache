From 32d1f99eefd0d5a8d70a20bdb06ac29929f1537a Mon Sep 17 00:00:00 2001
From: Hou Zhiqiang <B48286@freescale.com>
Date: Fri, 29 May 2015 16:53:52 +0800
Subject: [PATCH 169/451] clk: fix the endian issue to read status register of
 ls1043a pll

Signed-off-by: Hou Zhiqiang <B48286@freescale.com>
Signed-off-by: Mingkai Hu <Mingkai.Hu@freescale.com>
[Xulin: Original patch taken from
Linux-LS1043A-SDK-V0.4-SOURCE-20150826-yocto.iso]
Signed-off-by: Xulin Sun <xulin.sun@windriver.com>
---
 drivers/clk/clk-qoriq.c |   10 +++++++++-
 1 files changed, 9 insertions(+), 1 deletions(-)

diff --git a/drivers/clk/clk-qoriq.c b/drivers/clk/clk-qoriq.c
index 56c761f..3959cad 100644
--- a/drivers/clk/clk-qoriq.c
+++ b/drivers/clk/clk-qoriq.c
@@ -181,7 +181,7 @@ static void __init core_pll_init(struct device_node *np)
 	}
 
 	/* get the multiple of PLL */
-#if defined(CONFIG_ARCH_FSL_LS2085A) || defined(CONFIG_ARCH_FSL_LS1043A)
+#ifdef CONFIG_ARCH_FSL_LS2085A
 	/* FIXME: Make this better */
 	mult = ioread32(base);
 	/* check if this PLL is disabled */
@@ -190,6 +190,14 @@ static void __init core_pll_init(struct device_node *np)
 		goto err_map;
 	}
 	mult = (mult >> 1) & 0xff;
+#elif CONFIG_ARCH_FSL_LS1043A
+	mult = ioread32be(base);
+	/* check if this PLL is disabled */
+	if (mult & PLL_KILL) {
+		pr_debug("PLL:%s is disabled\n", np->name);
+		goto err_map;
+	}
+	mult = (mult >> 1) & 0xff;
 #else
 	mult = ioread32be(base);
 	/* check if this PLL is disabled */
-- 
1.7.5.4

