From 98ed44413dc7af541d09cdd759a0d83c922f8a28 Mon Sep 17 00:00:00 2001
From: Roy Pledge <Roy.Pledge@freescale.com>
Date: Mon, 20 Jul 2015 17:04:01 -0400
Subject: [PATCH 427/451] fsl_qbman: Cleanup some leftover TODOs from ARM port

- Call dma_set_mask() on ARM - previous issue was resolved
- Do structure assignment now that alignment issue is resolved

Signed-off-by: Roy Pledge <Roy.Pledge@freescale.com>
[Xulin: Original patch taken from
Linux-LS1043A-SDK-V0.4-SOURCE-20150826-yocto.iso]
Signed-off-by: Xulin Sun <xulin.sun@windriver.com>
---
 drivers/staging/fsl_qbman/qman_high.c |   14 ++------------
 1 files changed, 2 insertions(+), 12 deletions(-)

diff --git a/drivers/staging/fsl_qbman/qman_high.c b/drivers/staging/fsl_qbman/qman_high.c
index 9413b81..7cee432c 100644
--- a/drivers/staging/fsl_qbman/qman_high.c
+++ b/drivers/staging/fsl_qbman/qman_high.c
@@ -610,13 +610,10 @@ struct qman_portal *qman_create_portal(
 		pr_err("qman_portal - platform_device_alloc() failed\n");
 		goto fail_devalloc;
 	}
-#if defined(CONFIG_PPC) || defined(CONFIG_PPC64)
-	/* TODO: Investigate if this needed for ARM */
 	if (dma_set_mask(&portal->pdev->dev, DMA_BIT_MASK(40))) {
 		pr_err("qman_portal - dma_set_mask() failed\n");
 		goto fail_devadd;
 	}
-#endif
 	portal->pdev->dev.pm_domain = &qman_portal_device_pm_domain;
 	portal->pdev->dev.platform_data = portal;
 	ret = platform_device_add(portal->pdev);
@@ -1643,15 +1640,8 @@ int qman_init_fq(struct qman_fq *fq, u32 flags, struct qm_mcc_initfq *opts)
 		return -EBUSY;
 	}
 	mcc = qm_mc_start(&p->p);
-	if (opts) {
-		/* TODO: work around ARM alignment issue */
-		/* mcc->initfq = *opts; */
-		int i;
-		u8 *dest = (u8 *) &mcc->initfq;
-		u8 *src = (u8 *) opts;
-		for (i = 0; i < sizeof(*opts); i++)
-			dest[i] = src[i];
-	}
+	if (opts)
+		mcc->initfq = *opts;
 	mcc->initfq.fqid = cpu_to_be32(fq->fqid);
 	mcc->initfq.count = 0;
 
-- 
1.7.5.4

