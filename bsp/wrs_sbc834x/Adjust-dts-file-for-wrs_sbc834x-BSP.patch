From 83fd6a579557ab9eae95d67a42be94279e4ed465 Mon Sep 17 00:00:00 2001
From: Liang Li <Liang.Li@windriver.com>
Date: Thu, 18 Sep 2008 15:53:45 +0800
Subject: [PATCH] Adjust dts file for wrs_sbc834x BSP

->Add pit definition for pit_hwtimer
->Adjust PCI resource definition
->Prune USB-dr module definition
->Add flash partition definition

Signed-off-by: Liang Li <Liang.Li@windriver.com>
---
 arch/powerpc/boot/dts/sbc8349.dts |   69 ++++++++++++++++++++++++++++---------
 1 files changed, 52 insertions(+), 17 deletions(-)

diff --git a/arch/powerpc/boot/dts/sbc8349.dts b/arch/powerpc/boot/dts/sbc8349.dts
index 45f789b..6a06c79 100644
--- a/arch/powerpc/boot/dts/sbc8349.dts
+++ b/arch/powerpc/boot/dts/sbc8349.dts
@@ -64,6 +64,14 @@
 			reg = <0x200 0x100>;
 		};
 
+		pit@400 {
+			device_type = "pit";
+			compatible = "mpc_pit";
+			reg = <0x400 0x100>;
+			interrupts = <65 0x8>;
+			interrupt-parent = < &ipic >;
+		};
+
 		i2c@3000 {
 			#address-cells = <1>;
 			#size-cells = <0>;
@@ -142,18 +150,6 @@
 			phy_type = "ulpi";
 			port1;
 		};
-		/* phy type (ULPI, UTMI, UTMI_WIDE, SERIAL) */
-		usb@23000 {
-			device_type = "usb";
-			compatible = "fsl-usb2-dr";
-			reg = <0x23000 0x1000>;
-			#address-cells = <1>;
-			#size-cells = <0>;
-			interrupt-parent = <&ipic>;
-			interrupts = <38 0x8>;
-			dr_mode = "otg";
-			phy_type = "ulpi";
-		};
 
 		mdio@24520 {
 			#address-cells = <1>;
@@ -253,16 +249,15 @@
 		interrupt-map = <
 
 				/* IDSEL 0x11 */
-				 0x8800 0x0 0x0 0x1 &ipic 20 0x8
-				 0x8800 0x0 0x0 0x2 &ipic 21 0x8
-				 0x8800 0x0 0x0 0x3 &ipic 22 0x8
-				 0x8800 0x0 0x0 0x4 &ipic 23 0x8>;
+				 0x8800 0x0 0x0 0x1 &ipic 48 0x8
+				 0x8800 0x0 0x0 0x2 &ipic 17 0x8
+				 0x8800 0x0 0x0 0x3 &ipic 18 0x8
+				 0x8800 0x0 0x0 0x4 &ipic 19 0x8>;
 
 		interrupt-parent = <&ipic>;
 		interrupts = <0x42 0x8>;
 		bus-range = <0 0>;
 		ranges = <0x02000000 0x0 0x90000000 0x90000000 0x0 0x10000000
-			  0x42000000 0x0 0x80000000 0x80000000 0x0 0x10000000
 			  0x01000000 0x0 0x00000000 0xe2000000 0x0 0x00100000>;
 		clock-frequency = <66666666>;
 		#interrupt-cells = <1>;
@@ -272,4 +267,44 @@
 		compatible = "fsl,mpc8349-pci";
 		device_type = "pci";
 	};
+
+	localbus@e0005000 {
+		#address-cells = <2>;
+		#size-cells = <1>;
+		compatible = "fsl,mpc8349-localbus", "simple-bus";
+		reg = <0xe0005000 0x1000>;
+		interrupts = <77 0x8>;
+		interrupt-parent = <&ipic>;
+
+		ranges = <0x0 0x0 0xff800000 0x00800000
+		          0x1 0x0 0xf8000000 0x00020000
+		          0x2 0x0 0x10000000 0x08000000>;
+
+		flash@0,0 {
+			#address-cells = <1>;
+			#size-cells = <1>;
+			compatible = "cfi-flash";
+			reg = <0x0 0x0 0x800000>;
+			bank-width = <2>;
+			device-width = <1>;
+
+			partition@0 {
+				label = "hrcw";
+				reg = <0x00000000 0x00040000>;
+				read-only;
+			};
+
+			partition@40000 {
+				label = "user";
+				reg = <0x00040000 0x006c0000>;
+			};
+
+			partition@700000 {
+				label = "u-boot";
+				reg = <0x00700000 0x00100000>;
+				read-only;
+			};
+
+		};
+	};
 };
-- 
1.5.5.1

