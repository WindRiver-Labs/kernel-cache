From 33610f8cfa089756ae80d98be89aa1c1ceb1c7bd Mon Sep 17 00:00:00 2001
From: Liang Li <Liang.Li@windriver.com>
Date: Thu, 18 Sep 2008 15:52:00 +0800
Subject: [PATCH] Implement cpu_info for wrs_sbc834x board

With this cpu_info function,kernel could output more infomation by
/proc/cpuinfo entry.

Signed-off-by: Liang Li <Liang.Li@windriver.com>
---
 arch/powerpc/platforms/83xx/sbc834x.c |   23 +++++++++++++++++++++++
 1 files changed, 23 insertions(+), 0 deletions(-)

diff --git a/arch/powerpc/platforms/83xx/sbc834x.c b/arch/powerpc/platforms/83xx/sbc834x.c
index 156c4e2..bc874ea 100644
--- a/arch/powerpc/platforms/83xx/sbc834x.c
+++ b/arch/powerpc/platforms/83xx/sbc834x.c
@@ -35,6 +35,7 @@
 #include <asm/ipic.h>
 #include <asm/irq.h>
 #include <asm/prom.h>
+#include <mm/mmu_decl.h>
 #include <asm/udbg.h>
 #include <sysdev/fsl_soc.h>
 #include <sysdev/fsl_pci.h>
@@ -104,11 +105,33 @@ static int __init sbc834x_probe(void)
 	return of_flat_dt_is_compatible(root, "SBC834x");
 }
 
+static void sbc834x_show_cpuinfo(struct seq_file *m)
+{
+	uint pvid, svid, phid1;
+	uint memsize = total_memory;
+
+	pvid = mfspr(SPRN_PVR);
+	svid = mfspr(SPRN_SVR);
+
+	seq_printf(m, "Vendor\t\t: Wind River.\n");
+	seq_printf(m, "Machine\t\t: SBC834x\n");
+	seq_printf(m, "PVR\t\t: 0x%x\n", pvid);
+	seq_printf(m, "SVR\t\t: 0x%x\n", svid);
+
+	/* Display cpu Pll setting */
+	phid1 = mfspr(SPRN_HID1);
+	seq_printf(m, "PLL setting\t: 0x%x\n", ((phid1 >> 24) & 0x3f));
+
+	/* Display the amount of memory */
+	seq_printf(m, "Memory\t\t: %d MB\n", memsize / (1024 * 1024));
+}
+
 define_machine(sbc834x) {
 	.name			= "SBC834x",
 	.probe			= sbc834x_probe,
 	.setup_arch		= sbc834x_setup_arch,
 	.init_IRQ		= sbc834x_init_IRQ,
+	.show_cpuinfo	= sbc834x_show_cpuinfo,
 	.get_irq		= ipic_get_irq,
 	.restart		= mpc83xx_restart,
 	.time_init		= mpc83xx_time_init,
-- 
1.5.5.1

