From 1903167d1e3d3937ea7f401d0475974194873abd Mon Sep 17 00:00:00 2001
From: Bin Jiang <bin.jiang@windriver.com>
Date: Tue, 16 Apr 2013 17:40:21 +0800
Subject: [PATCH 15/17] Cavium: add memory region for kernel text/data

Show "Kernel code" and "Kernel data" in "/proc/iomem" which is used
for kexec tool.

Signed-off-by: Bin Jiang <bin.jiang@windriver.com>
---
 arch/mips/cavium-octeon/setup.c |    8 ++++++++
 1 files changed, 8 insertions(+), 0 deletions(-)

diff --git a/arch/mips/cavium-octeon/setup.c b/arch/mips/cavium-octeon/setup.c
index 5358138..3347ccb 100644
--- a/arch/mips/cavium-octeon/setup.c
+++ b/arch/mips/cavium-octeon/setup.c
@@ -1082,6 +1082,14 @@ void __init plat_mem_setup(void)
 		goto mem_alloc_done;
 	}
 
+	/* Add Kernel text/data memory region. */
+	memory = __pa_symbol(&_text);
+	mem_alloc_size = (__pa_symbol(&_edata)) - memory;
+	if (mem_alloc_size > 0) {
+		add_memory_region(memory, mem_alloc_size, BOOT_MEM_RAM);
+		total += mem_alloc_size;
+	}
+
 	/*
 	 * The Mips memory init uses the first memory location for
 	 * some memory vectors. When SPARSEMEM is in use, it doesn't
-- 
1.7.5.4

