From b9298649ee95aa8027ddcc49e65b83d93e0bc312 Mon Sep 17 00:00:00 2001
From: Roy ZANG <tie-fei.zang@freescale.com>
Date: Fri, 25 May 2012 13:42:43 +0000
Subject: [PATCH 18/57] t4240: add pcie support for t4240qds board

commit 0cbc0270150e4f8789d225614345165c094d9913 from
https://git.freescale.com/git-private/cgit.cgi/ppc/t4240/linux.git

add corresponding compatible for t4240qds board pcie probe.

Signed-off-by: Roy Zang <tie-fei.zang@freescale.com>
---
 arch/powerpc/platforms/85xx/corenet_ds.c |    1 +
 arch/powerpc/platforms/85xx/t4240_qds.c  |    1 +
 arch/powerpc/sysdev/fsl_pci.c            |    1 +
 3 files changed, 3 insertions(+)

diff --git a/arch/powerpc/platforms/85xx/corenet_ds.c b/arch/powerpc/platforms/85xx/corenet_ds.c
index 2656264..d483da2 100644
--- a/arch/powerpc/platforms/85xx/corenet_ds.c
+++ b/arch/powerpc/platforms/85xx/corenet_ds.c
@@ -76,6 +76,7 @@ void __init corenet_ds_setup_arch(void)
 static struct of_device_id __initdata corenetds_pci_ids[] = {
 	{ .compatible = "fsl,p4080-pcie", },
 	{ .compatible = "fsl,qoriq-pcie-v2.2", },
+	{ .compatible = "fsl,qoriq-pcie-v3.0", },
 	{},
 };
 
diff --git a/arch/powerpc/platforms/85xx/t4240_qds.c b/arch/powerpc/platforms/85xx/t4240_qds.c
index ae29901..8fef1f5 100644
--- a/arch/powerpc/platforms/85xx/t4240_qds.c
+++ b/arch/powerpc/platforms/85xx/t4240_qds.c
@@ -66,6 +66,7 @@ define_machine(t4240_qds) {
 	.init_early		= corenet_ds_init_early,
 };
 
+machine_arch_initcall(t4240_qds, corenet_ds_publish_pci_device);
 machine_device_initcall(t4240_qds, declare_of_platform_devices);
 
 #ifdef CONFIG_SWIOTLB
diff --git a/arch/powerpc/sysdev/fsl_pci.c b/arch/powerpc/sysdev/fsl_pci.c
index b8e2632d..3bedcce 100644
--- a/arch/powerpc/sysdev/fsl_pci.c
+++ b/arch/powerpc/sysdev/fsl_pci.c
@@ -899,6 +899,7 @@ static const struct of_device_id pci_ids[] = {
 	{ .compatible = "fsl,p4080-pcie", },
 	{ .compatible = "fsl,qoriq-pcie-v2.3", },
 	{ .compatible = "fsl,qoriq-pcie-v2.2", },
+	{ .compatible = "fsl,qoriq-pcie-v3.0", },
 	{},
 };
 
-- 
1.7.9.7

