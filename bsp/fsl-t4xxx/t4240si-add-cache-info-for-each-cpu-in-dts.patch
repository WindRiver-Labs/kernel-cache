From a80e1ee8f4f6ff972c0c10cfb1f31d57938cb596 Mon Sep 17 00:00:00 2001
From: Hai-Ying Wang <Haiying.Wang@freescale.com>
Date: Thu, 17 May 2012 20:13:16 +0000
Subject: [PATCH 13/57] t4240si: add cache info for each cpu in dts

commit ff88d72e45a5428e58dd9fb3497f4dc1ca882c93 from
https://git.freescale.com/git-private/cgit.cgi/ppc/t4240/linux.git

The next-level-cache info is the dependency for u-boot to do l2 and l3 cache
fixup, this patch is the temp workaround to provide cache info to u-boot. It
can be reverted once the u-boot can create cpu node with cache info.

Signed-off-by: Haiying Wang <Haiying.Wang@freescale.com>
Signed-off-by: Andy Fleming <afleming@freescale.com>
---
 arch/powerpc/boot/dts/fsl/t4240si-post.dtsi |   15 +++++++++++++++
 arch/powerpc/boot/dts/fsl/t4240si-pre.dtsi  |   17 +++++++++++++++++
 2 files changed, 32 insertions(+)

diff --git a/arch/powerpc/boot/dts/fsl/t4240si-post.dtsi b/arch/powerpc/boot/dts/fsl/t4240si-post.dtsi
index 283506a..86334a6 100644
--- a/arch/powerpc/boot/dts/fsl/t4240si-post.dtsi
+++ b/arch/powerpc/boot/dts/fsl/t4240si-post.dtsi
@@ -91,4 +91,19 @@
 /include/ "qoriq-i2c-1.dtsi"
 /include/ "qoriq-duart-0.dtsi"
 /include/ "qoriq-duart-1.dtsi"
+
+	/*
+	 * Temporarily define cluster 1/2/3's L2 cache nodes in order to pass
+	 * next-level-cache info to uboot to do L3 cache fixup. This can be
+	 * removed once u-boot can create cpu node with cache info.
+	 */
+	L2_1: l2-cache-controller@c20000 {
+		next-level-cache = <&cpc>;
+	};
+	L2_2: l2-cache-controller@c60000 {
+		next-level-cache = <&cpc>;
+	};
+	L2_3: l2-cache-controller@ca0000 {
+		next-level-cache = <&cpc>;
+	};
 };
diff --git a/arch/powerpc/boot/dts/fsl/t4240si-pre.dtsi b/arch/powerpc/boot/dts/fsl/t4240si-pre.dtsi
index 9f9a9bc..18377dd 100644
--- a/arch/powerpc/boot/dts/fsl/t4240si-pre.dtsi
+++ b/arch/powerpc/boot/dts/fsl/t4240si-pre.dtsi
@@ -52,55 +52,72 @@
 		#address-cells = <1>;
 		#size-cells = <0>;
 
+		/*
+		 * Temporarily add next-level-cache info in each cpu node so
+		 * that uboot can do L2 cache fixup. This can be removed once
+		 * u-boot can create cpu node with cache info.
+		 */
 		PowerPC,e6500@0 {
 			device_type = "cpu";
 			reg = <0 1>;
+			next-level-cache = <&L2_1>;
 		};
 		PowerPC,e6500@1 {
 			device_type = "cpu";
 			reg = <2 3>;
+			next-level-cache = <&L2_1>;
 		};
 		PowerPC,e6500@2 {
 			device_type = "cpu";
 			reg = <4 5>;
+			next-level-cache = <&L2_1>;
 		};
 		PowerPC,e6500@3 {
 			device_type = "cpu";
 			reg = <6 7>;
+			next-level-cache = <&L2_1>;
 		};
 
 		PowerPC,e6500@4 {
 			device_type = "cpu";
 			reg = <8 9>;
+			next-level-cache = <&L2_2>;
 		};
 		PowerPC,e6500@5 {
 			device_type = "cpu";
 			reg = <10 11>;
+			next-level-cache = <&L2_2>;
 		};
 		PowerPC,e6500@6 {
 			device_type = "cpu";
 			reg = <12 13>;
+			next-level-cache = <&L2_2>;
 		};
 		PowerPC,e6500@7 {
 			device_type = "cpu";
 			reg = <14 15>;
+			next-level-cache = <&L2_2>;
 		};
 
 		PowerPC,e6500@8 {
 			device_type = "cpu";
 			reg = <16 17>;
+			next-level-cache = <&L2_3>;
 		};
 		PowerPC,e6500@9 {
 			device_type = "cpu";
 			reg = <18 19>;
+			next-level-cache = <&L2_3>;
 		};
 		PowerPC,e6500@10 {
 			device_type = "cpu";
 			reg = <20 21>;
+			next-level-cache = <&L2_3>;
 		};
 		PowerPC,e6500@11 {
 			device_type = "cpu";
 			reg = <22 23>;
+			next-level-cache = <&L2_3>;
 		};
 	};
 };
-- 
1.7.9.7

