From 042307b6820d002bc014fc701d19674954420cea Mon Sep 17 00:00:00 2001
From: Ioana Radulescu <ruxandra.radulescu@freescale.com>
Date: Tue, 10 Jul 2012 21:12:13 +0000
Subject: [PATCH 53/57] fmd: Add support for MEMAC compatible nodes

commit 9bc2a85fc89b69266b1b5c6fd995b69eb7fbf6c0 from
https://git.freescale.com/git-private/cgit.cgi/ppc/t4240/linux.git

Signed-off-by: Ioana Radulescu <ruxandra.radulescu@freescale.com>
Signed-off-by: Andy Fleming <afleming@freescale.com>
---
 .../dpa/NetCommSw/src/wrapper/fman_test.c          |    8 ++++++--
 .../dpa/NetCommSw/src/wrapper/lnxwrp_resources.c   |    4 ++--
 2 files changed, 8 insertions(+), 4 deletions(-)

diff --git a/drivers/net/ethernet/freescale/dpa/NetCommSw/src/wrapper/fman_test.c b/drivers/net/ethernet/freescale/dpa/NetCommSw/src/wrapper/fman_test.c
index 5762da92..8d8346f 100644
--- a/drivers/net/ethernet/freescale/dpa/NetCommSw/src/wrapper/fman_test.c
+++ b/drivers/net/ethernet/freescale/dpa/NetCommSw/src/wrapper/fman_test.c
@@ -1059,7 +1059,9 @@ static int fmt_port_init(
 						fm_port_get_handle(
 							fmt_port->p_rx_port);
 			} else if (of_device_is_compatible(fm_port_node,
-							     "fsl,fman-1g-mac"))
+							"fsl,fman-1g-mac") ||
+				   of_device_is_compatible(fm_port_node,
+							"fsl,fman-memac"))
 				fmt_port->p_mac_dev =
 						(typeof(fmt_port->p_mac_dev))
 						dev_get_drvdata(&of_dev->dev);
@@ -1094,7 +1096,9 @@ static int fmt_port_init(
 						fm_port_get_handle(
 							fmt_port->p_rx_port);
 			} else if (of_device_is_compatible(fm_port_node,
-							    "fsl,fman-10g-mac"))
+							"fsl,fman-10g-mac") ||
+				   of_device_is_compatible(fm_port_node,
+							"fsl,fman-memac"))
 				fmt_port->p_mac_dev =
 						(typeof(fmt_port->p_mac_dev))
 						dev_get_drvdata(&of_dev->dev);
diff --git a/drivers/net/ethernet/freescale/dpa/NetCommSw/src/wrapper/lnxwrp_resources.c b/drivers/net/ethernet/freescale/dpa/NetCommSw/src/wrapper/lnxwrp_resources.c
index e166225..dcb850d 100644
--- a/drivers/net/ethernet/freescale/dpa/NetCommSw/src/wrapper/lnxwrp_resources.c
+++ b/drivers/net/ethernet/freescale/dpa/NetCommSw/src/wrapper/lnxwrp_resources.c
@@ -107,8 +107,8 @@ static struct device_node *match_fman_port_to_mac(struct device_node *fm_node,
 	/* for all enet nodes (macs) check which one refers this FMan port. */
 	for_each_child_of_node(fm_node, fm_node_idx) {
 		if (of_device_is_compatible(fm_node_idx, "fsl,fman-1g-mac") ||
-		    of_device_is_compatible(fm_node_idx,
-					    "fsl,fman-10g-mac")) {
+		    of_device_is_compatible(fm_node_idx, "fsl,fman-10g-mac") ||
+		    of_device_is_compatible(fm_node_idx, "fsl,fman-memac")) {
 			struct device_node *fman_port_node_rx = NULL;
 			struct device_node *fman_port_node_tx = NULL;
 			/* RX is first */
-- 
1.7.9.7

