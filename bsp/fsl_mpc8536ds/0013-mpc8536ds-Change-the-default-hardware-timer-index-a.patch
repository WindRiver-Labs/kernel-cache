From 3e6107278f6d8461dd3e631f37beb0968bf8886b Mon Sep 17 00:00:00 2001
From: Thomas Tai <thomas.tai@windriver.com>
Date: Wed, 29 Apr 2009 10:30:22 -0400
Subject: [PATCH] mpc8536ds: Change the default hardware timer index and divisor

mpc8536ds may use hardware timer 0 as wakeup source, change
default hw_timer index to 1. According to MPC8536E PowerQUICC III
Integrated Processor Reference Manual, the default clock divisor is 64.

Signed-off-by: Thomas Tai <thomas.tai@windriver.com>
---
 arch/powerpc/sysdev/mpic.c |    8 ++++++++
 1 files changed, 8 insertions(+), 0 deletions(-)

diff --git a/arch/powerpc/sysdev/mpic.c b/arch/powerpc/sysdev/mpic.c
index f7ed652..b4099af 100644
--- a/arch/powerpc/sysdev/mpic.c
+++ b/arch/powerpc/sysdev/mpic.c
@@ -269,7 +269,11 @@ static inline void _mpic_irq_write(struct mpic *mpic, unsigned int src_no,
 #include <linux/hwtimer.h>
 #include <linux/delay.h>
 
+#ifdef CONFIG_MPC8536_DS
+#define TIMER_DEFAULT_DIVISOR 64
+#else
 #define TIMER_DEFAULT_DIVISOR 8
+#endif
 #ifdef CONFIG_MPC85xx
 static int pll_divisor[4]={1,2,1,2};
 static int pll_dividend[4]={2,5,3,7};
@@ -284,8 +288,12 @@ static unsigned long mpic_hwtimer_freq = 0;
 #ifdef CONFIG_ASMP
 #define mpic_hwtimer_index (raw_asmp_processor_id())
 #else
+#ifdef CONFIG_MPC8536_DS
+static int mpic_hwtimer_index = 1;
+#else
 static int mpic_hwtimer_index = 0;
 #endif
+#endif
 static int mpic_hwtimer_irq = 0;
 static DECLARE_HWTIMER_LOCK(mpic_hwtimer_lock);
 static struct hwtimer_data mpic_hwtimer_data;
-- 
1.6.0.4

