From f2a556697edcaba1455fb1266ed99dc1b9d8836d Mon Sep 17 00:00:00 2001
From: Jeff Skirvin <jeffrey.d.skirvin@intel.com>
Date: Thu, 8 Mar 2012 22:41:58 -0800
Subject: [PATCH 164/479] isci: Fix the terminated I/O to not call sas_task_abort().

commit 060c91daed322844bdbc59636e7ac6bca5769c7b from
git://git.kernel.org/pub/scm/linux/kernel/git/djbw/isci.git

This addresses a regression from the commit "isci: Redesign
device suspension, abort, cleanup." in which the sas_task end
condition for terminated I/Os was made to call back on
sas_task_abort()".
This commit will be rolled into the original.

Signed-off-by: Jeff Skirvin <jeffrey.d.skirvin@intel.com>
Signed-off-by: Dan Williams <dan.j.williams@intel.com>
---
 drivers/scsi/isci/request.c |    2 +-
 1 files changed, 1 insertions(+), 1 deletions(-)

diff --git a/drivers/scsi/isci/request.c b/drivers/scsi/isci/request.c
index 58404f8..cb302ce 100644
--- a/drivers/scsi/isci/request.c
+++ b/drivers/scsi/isci/request.c
@@ -2833,7 +2833,7 @@ static void isci_request_io_request_complete(struct isci_host *ihost,
 			__func__, request, task);
 
 		/* The request was terminated explicitly. */
-		clear_bit(IREQ_COMPLETE_IN_TARGET, &request->flags);
+		set_bit(IREQ_COMPLETE_IN_TARGET, &request->flags);
 		response = SAS_TASK_UNDELIVERED;
 
 		/* See if the device has been/is being stopped. Note
-- 
1.7.0

