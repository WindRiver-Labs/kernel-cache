From 984e5f9f181cfe983b697480c55b3064a5822555 Mon Sep 17 00:00:00 2001
From: Mauro Carvalho Chehab <mchehab@redhat.com>
Date: Tue, 10 Aug 2010 20:26:35 -0300
Subject: [PATCH 198/479] i7core_edac: move #if PAGE_SHIFT to edac_core.h

upstream: e9144601

Signed-off-by: Mauro Carvalho Chehab <mchehab@redhat.com>

Integrated-by: Hui Wang <Hui.Wang@windriver.com>
---
 drivers/edac/edac_core.h   |    2 ++
 drivers/edac/i7core_edac.c |    6 +-----
 2 files changed, 3 insertions(+), 5 deletions(-)

diff --git a/drivers/edac/edac_core.h b/drivers/edac/edac_core.h
index a5b0c97..6329687 100644
--- a/drivers/edac/edac_core.h
+++ b/drivers/edac/edac_core.h
@@ -42,8 +42,10 @@
 
 #if PAGE_SHIFT < 20
 #define PAGES_TO_MiB( pages )	( ( pages ) >> ( 20 - PAGE_SHIFT ) )
+#define MiB_TO_PAGES(mb)	((mb) >> (20 - PAGE_SHIFT))
 #else				/* PAGE_SHIFT > 20 */
 #define PAGES_TO_MiB( pages )	( ( pages ) << ( PAGE_SHIFT - 20 ) )
+#define MiB_TO_PAGES(mb)	((mb) >> (PAGE_SHIFT - 20))
 #endif
 
 #define edac_printk(level, prefix, fmt, arg...) \
diff --git a/drivers/edac/i7core_edac.c b/drivers/edac/i7core_edac.c
index 4d6ecf1..ef20037 100644
--- a/drivers/edac/i7core_edac.c
+++ b/drivers/edac/i7core_edac.c
@@ -616,11 +616,7 @@ static int get_dimm_config(struct mem_ctl_info *mci, int *csrow)
 				RANKOFFSET(dimm_dod[j]),
 				banks, ranks, rows, cols);
 
-#if PAGE_SHIFT > 20
-			npages = size >> (PAGE_SHIFT - 20);
-#else
-			npages = size << (20 - PAGE_SHIFT);
-#endif
+			npages = MiB_TO_PAGES(size);
 
 			csr = &mci->csrows[*csrow];
 			csr->first_page = last_page + 1;
-- 
1.7.0

