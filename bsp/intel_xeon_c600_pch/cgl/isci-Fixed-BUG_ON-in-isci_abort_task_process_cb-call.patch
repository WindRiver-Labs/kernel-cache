From be71495e76bf7ea77f52375536ce24dae2a0397e Mon Sep 17 00:00:00 2001
From: Jeff Skirvin <jeffrey.d.skirvin@intel.com>
Date: Fri, 4 Mar 2011 14:06:58 -0800
Subject: [PATCH 060/479] isci: Fixed BUG_ON in isci_abort_task_process_cb callback.

upstream: 70957a94d70cb82459bd3aea171c54d0a5cd6dbb

The request may be in the "aborted" or the "completed" state when
performing a task management operation on it.

Signed-off-by: Jeff Skirvin <jeffrey.d.skirvin@intel.com>
Signed-off-by: Dan Williams <dan.j.williams@intel.com>

Integrated-by: Hui Wang <Hui.Wang@windriver.com>
---
 drivers/scsi/isci/task.c |    3 ++-
 1 files changed, 2 insertions(+), 1 deletions(-)

diff --git a/drivers/scsi/isci/task.c b/drivers/scsi/isci/task.c
index c2d74c3..a1234e4 100644
--- a/drivers/scsi/isci/task.c
+++ b/drivers/scsi/isci/task.c
@@ -1116,7 +1116,8 @@ static void isci_abort_task_process_cb(
 		 * request state was already set to "aborted" by the abort
 		 * task function.
 		 */
-		BUG_ON(old_request->status != aborted);
+		BUG_ON((old_request->status != aborted)
+			&& (old_request->status != completed));
 		break;
 
 	case isci_tmf_timed_out:
-- 
1.7.0

