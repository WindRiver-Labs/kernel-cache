From e27651ebd1a14c4f84dff9f7d2985738d60f5f2f Mon Sep 17 00:00:00 2001
From: Weiwei Wang <weiwei.wang@windriver.com>
Date: Tue, 6 Mar 2012 17:28:44 +0800
Subject: [PATCH 436/479] cgl sparsemem: fix panic when CONFIG_MEMORY_HOTREMOVE enabled

function sparse_early_usemaps_alloc_pgdat_section will trigger a
kernel panic in cgl kernel, the reason is still unclear, but we
can just ignore sparse_early_usemaps_alloc_pgdat_section in cgl
kernel as  a workaround. And the side effect is one or two sections
has chance to not be able to do migration, but it is not a big deal
compare with kernel boot failure.

Signed-off-by: Weiwei Wang <weiwei.wang@windriver.com>
---
 mm/sparse.c |    2 +-
 1 files changed, 1 insertions(+), 1 deletions(-)

diff --git a/mm/sparse.c b/mm/sparse.c
index dc0cc4d..61e5767 100644
--- a/mm/sparse.c
+++ b/mm/sparse.c
@@ -270,7 +270,7 @@ static unsigned long *__kmalloc_section_usemap(void)
 }
 #endif /* CONFIG_MEMORY_HOTPLUG */
 
-#ifdef CONFIG_MEMORY_HOTREMOVE
+#if defined(CONFIG_MEMORY_HOTREMOVE) && !defined(CONFIG_GRKERNSEC)
 static unsigned long * __init
 sparse_early_usemaps_alloc_pgdat_section(struct pglist_data *pgdat,
 					 unsigned long count)
-- 
1.7.0

