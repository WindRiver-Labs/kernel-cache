From c8464b736d5ffd30fb8a07702d22dcbc6b295944 Mon Sep 17 00:00:00 2001
From: Tony Luck <tony.luck@intel.com>
Date: Thu, 6 Jan 2011 16:58:58 -0800
Subject: [PATCH 269/474] pstore: fix build warning for unused return value from sysfs_create_file

commit 168f2e14319aba3125946649604e858cbae85be6 upstream

fs/pstore/inode.c: In function 'init_pstore_fs':
fs/pstore/inode.c:266: warning: ignoring return value of 'sysfs_create_file', declared with attribute warn_unused_result

Reported-by: Stephen Rothwell <sfr@canb.auug.org.au>
Signed-off-by: Tony Luck <tony.luck@intel.com>
---
 fs/pstore/inode.c |   27 ++++++++++++++++-----------
 1 files changed, 16 insertions(+), 11 deletions(-)

diff --git a/fs/pstore/inode.c b/fs/pstore/inode.c
index 0e806aa..549d245 100644
--- a/fs/pstore/inode.c
+++ b/fs/pstore/inode.c
@@ -256,23 +256,28 @@ static struct file_system_type pstore_fs_type = {
 
 static int __init init_pstore_fs(void)
 {
-	int ret = 0;
+	int rc = 0;
 	struct kobject *pstorefs_kobj;
 
 	pstorefs_kobj = kobject_create_and_add("pstore", fs_kobj);
-	if (!pstorefs_kobj)
-		return -ENOMEM;
+	if (!pstorefs_kobj) {
+		rc = -ENOMEM;
+		goto done;
+	}
 
-	sysfs_create_file(pstorefs_kobj, &pstore_kmsg_bytes_attr.attr);
+	rc = sysfs_create_file(pstorefs_kobj, &pstore_kmsg_bytes_attr.attr);
+	if (rc)
+		goto done1;
 
-	ret = register_filesystem(&pstore_fs_type);
+	rc = register_filesystem(&pstore_fs_type);
+	if (rc == 0)
+		goto done;
 
-	if (ret) {
-		sysfs_remove_file(pstorefs_kobj, &pstore_kmsg_bytes_attr.attr);
-		kobject_put(pstorefs_kobj);
-	}
-
-	return ret;
+	sysfs_remove_file(pstorefs_kobj, &pstore_kmsg_bytes_attr.attr);
+done1:
+	kobject_put(pstorefs_kobj);
+done:
+	return rc;
 }
 module_init(init_pstore_fs)
 
-- 
1.7.0

