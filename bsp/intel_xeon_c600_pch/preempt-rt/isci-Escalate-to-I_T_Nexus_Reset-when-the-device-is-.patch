From 72f895351f8bbd482f2b02d9d64c34295e7b3410 Mon Sep 17 00:00:00 2001
From: Jeff Skirvin <jeffrey.d.skirvin@intel.com>
Date: Thu, 8 Mar 2012 22:41:53 -0800
Subject: [PATCH 155/478] isci: Escalate to I_T_Nexus_Reset when the device is gone.

commit 25ccd47b8ba4ac895da956943e9c580cb78987e3 from
git://git.kernel.org/pub/scm/linux/kernel/git/djbw/isci.git

If LUN reset sees that the device is gone, it returns TMF_RESP_FUNC_FAILED
to cause libsas to escalate to an I_T_Nexus_Reset.

Signed-off-by: Jeff Skirvin <jeffrey.d.skirvin@intel.com>
Signed-off-by: Dan Williams <dan.j.williams@intel.com>
---
 drivers/scsi/isci/task.c |    4 ++--
 1 files changed, 2 insertions(+), 2 deletions(-)

diff --git a/drivers/scsi/isci/task.c b/drivers/scsi/isci/task.c
index 9b8632f..26de06e 100644
--- a/drivers/scsi/isci/task.c
+++ b/drivers/scsi/isci/task.c
@@ -842,10 +842,10 @@ int isci_task_lu_reset(struct domain_device *dev, u8 *lun)
 		__func__, dev, ihost, isci_device);
 
 	if (!isci_device) {
-		/* If the device is gone, stop the escalations. */
+		/* If the device is gone, escalate to I_T_Nexus_Reset. */
 		dev_dbg(&ihost->pdev->dev, "%s: No dev\n", __func__);
 
-		ret = TMF_RESP_FUNC_COMPLETE;
+		ret = TMF_RESP_FUNC_FAILED;
 		goto out;
 	}
 	if (isci_remote_device_suspend(ihost, isci_device) != SCI_SUCCESS) {
-- 
1.7.0

