From a2991beb809e6dffd30e2938255dc9a0da2d54b5 Mon Sep 17 00:00:00 2001
From: Wang Hui <Hui.Wang@windriver.com>
Date: Fri, 18 Dec 2009 14:06:40 +0800
Subject: [PATCH 16/20] ti_omap3530/xceiv: add nop transcevier register on mach init

On omap3evm platform, the usb otg transciver is isp1504 which need
nop transceiver driver, so add transceiver device register on mach
init.

[Reference to upstream commit ID: e8e2ff4, from this commit, only
picking nop transceiver regisration related content.]

Signed-off-by: Wang Hui <Hui.Wang@windriver.com>
---
 arch/arm/mach-omap2/board-omap3evm.c |    5 +++++
 include/linux/usb/otg.h              |    4 ++++
 2 files changed, 9 insertions(+), 0 deletions(-)

diff --git a/arch/arm/mach-omap2/board-omap3evm.c b/arch/arm/mach-omap2/board-omap3evm.c
index 3538067..af4bcb4 100644
--- a/arch/arm/mach-omap2/board-omap3evm.c
+++ b/arch/arm/mach-omap2/board-omap3evm.c
@@ -25,6 +25,7 @@
 #include <linux/spi/spi.h>
 #include <linux/spi/ads7846.h>
 #include <linux/i2c/twl4030.h>
+#include <linux/usb/otg.h>
 
 #include <mach/hardware.h>
 #include <asm/mach-types.h>
@@ -246,6 +247,10 @@ static void __init omap3_evm_init(void)
 
 	omap_serial_init();
 	hsmmc_init();
+#ifdef CONFIG_NOP_USB_XCEIV
+	/* OMAP3EVM uses ISP1504 phy and so register nop transceiver */
+	usb_nop_xceiv_register();
+#endif
 	usb_musb_init();
 	usb_ehci_init();
 	omap3evm_flash_init();
diff --git a/include/linux/usb/otg.h b/include/linux/usb/otg.h
index 1db25d1..80e420a 100644
--- a/include/linux/usb/otg.h
+++ b/include/linux/usb/otg.h
@@ -81,6 +81,10 @@ struct otg_transceiver {
 /* for board-specific init logic */
 extern int otg_set_transceiver(struct otg_transceiver *);
 
+/* sometimes transceivers are accessed only through e.g. ULPI */
+extern void usb_nop_xceiv_register(void);
+extern void usb_nop_xceiv_unregister(void);
+
 
 /* for usb host and peripheral controller drivers */
 extern struct otg_transceiver *otg_get_transceiver(void);
-- 
1.6.5.2

