From 5c70d1a323b5f0d81309b443179de21a3c35f530 Mon Sep 17 00:00:00 2001
From: Jim Somerville <Jim.Somerville@windriver.com>
Date: Mon, 9 Mar 2009 23:17:19 -0400
Subject: [PATCH] Add omap_dispc_set_plane_base for graphics support

The routine omap_dispc_set_plane_base is added
to support graphics drivers.  Graphics SDKs from TI require
this to be present in order to build and function.

It is taken from Koen Kooi's commit
a61d3745d51ff8b2c7c8b307bfccea031cf99e30 to the open
embedded source tree.

Signed-off-by: Jim Somerville <Jim.Somerville@windriver.com>
---
 drivers/video/omap/dispc.c |   26 ++++++++++++++++++++++++++
 drivers/video/omap/dispc.h |    2 ++
 2 files changed, 28 insertions(+), 0 deletions(-)

diff --git a/drivers/video/omap/dispc.c b/drivers/video/omap/dispc.c
index 754f272..4f98ab2 100644
--- a/drivers/video/omap/dispc.c
+++ b/drivers/video/omap/dispc.c
@@ -231,6 +231,32 @@ void omap_dispc_enable_digit_out(int enable)
 }
 EXPORT_SYMBOL(omap_dispc_enable_digit_out);
 
+extern void omap_dispc_set_plane_base(int plane, u32 paddr)
+{
+	u32 reg;
+	u32 val;
+
+	switch (plane) {
+	case 0:
+		reg = DISPC_GFX_BA0;
+		break;
+	case 1:
+		reg = DISPC_VID_BA0(1);
+		break;
+	case 2:
+		reg = DISPC_VID_BA0(2);
+		break;
+	default:
+		BUG();
+		return;
+	}
+
+	dispc_write_reg(reg, paddr);
+	val = dispc_read_reg(DISPC_CONTROL) | (1 << 5); /* GOLCD */
+	dispc_write_reg(DISPC_CONTROL, val);
+}
+EXPORT_SYMBOL(omap_dispc_set_plane_base);
+
 static inline int _setup_plane(int plane, int channel_out,
 				  u32 paddr, int screen_width,
 				  int pos_x, int pos_y, int width, int height,
diff --git a/drivers/video/omap/dispc.h b/drivers/video/omap/dispc.h
index 3b279c9..e726eed 100644
--- a/drivers/video/omap/dispc.h
+++ b/drivers/video/omap/dispc.h
@@ -32,6 +32,8 @@
 #define DISPC_TFT_DATA_LINES_18		2
 #define DISPC_TFT_DATA_LINES_24		3
 
+extern void omap_dispc_set_plane_base(int plane, u32 paddr);
+
 extern void omap_dispc_set_lcd_size(int width, int height);
 
 extern void omap_dispc_enable_lcd_out(int enable);
-- 
1.6.0.4

