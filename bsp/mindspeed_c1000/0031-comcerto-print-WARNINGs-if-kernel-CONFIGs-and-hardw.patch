From f8a309d4d23897638042fdaf3e0f9e889d34c3a1 Mon Sep 17 00:00:00 2001
From: Stanley.Miao <stanley.miao@windriver.com>
Date: Fri, 26 Nov 2010 13:04:26 +0800
Subject: [PATCH 3/3] comcerto: print WARNINGs if kernel CONFIGs and hardware switch do not match

The hardware switch SW1-3 on the board decides if NOR or NAND is supported. If
it is not matched with the kernel CONFIGs, print a WARNING to notify it.

Signed-off-by: Stanley.Miao <stanley.miao@windriver.com>
---
 arch/arm/mach-comcerto/board-c1kmfcn_evm.c |   20 ++++++++++++++------
 1 files changed, 14 insertions(+), 6 deletions(-)

diff --git a/arch/arm/mach-comcerto/board-c1kmfcn_evm.c b/arch/arm/mach-comcerto/board-c1kmfcn_evm.c
index 0d0015b..9bb817e 100644
--- a/arch/arm/mach-comcerto/board-c1kmfcn_evm.c
+++ b/arch/arm/mach-comcerto/board-c1kmfcn_evm.c
@@ -103,7 +103,12 @@ static struct platform_device comcerto_nor = {
 
 static void comcerto_init_nor(void)
 {
-	platform_device_register(&comcerto_nor);
+	if (!EXP_NAND_SEL)
+		platform_device_register(&comcerto_nor);
+	else
+		printk(KERN_WARNING "CONFIG_MTD_COMCERTO_NOR is enabled but SW1-3 on "
+				"the board is at 1/OFF postion to support NAND Flash!\n"
+				"Please refer to README to support NOR Flash.\n");
 }
 #else
 static void comcerto_init_nor(void)
@@ -170,7 +175,12 @@ static struct platform_device comcerto_nand = {
 
 static void comcerto_init_nand(void)
 {
-	platform_device_register(&comcerto_nand);
+	if (EXP_NAND_SEL)
+		platform_device_register(&comcerto_nand);
+	else
+		printk(KERN_WARNING "CONFIG_MTD_NAND_COMCERTO is enabled but SW1-3 on "
+				"the board is at 0/ON postion to support NOR Flash!\n"
+				"Please refer to README to support NAND Flash.\n");
 }
 #else
 static void comcerto_init_nand(void)
@@ -554,10 +564,8 @@ static void __init platform_init(void)
 	device_init();
 	board_gpio_init();
 	platform_add_devices(comcerto_devices, ARRAY_SIZE(comcerto_devices));
-	if (EXP_NAND_SEL)
-		comcerto_init_nand();
-	else
-		comcerto_init_nor();
+	comcerto_init_nand();
+	comcerto_init_nor();
 
 #if defined(CONFIG_CONFIG_I2C_BOARDINFO)
 	i2c_register_board_info(0, comcerto_i2c_info,
-- 
1.5.4.3

