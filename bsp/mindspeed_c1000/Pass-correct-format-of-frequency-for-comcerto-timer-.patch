From 00220ec4b9b3eea64407dc68a63a4a2faaaf4420 Mon Sep 17 00:00:00 2001
From: Haiqing Bai <Haiqing.Bai@windriver.com>
Date: Fri, 12 Aug 2011 10:51:57 +0800
Subject: [PATCH 2/2] Pass correct format of frequency for comcerto timer init.

The unit for COMCERTO_DEFAULTAHBCLK is "MHZ", When passing this frequency value
into the comcerto timer initialize functions, it should be "COMCERTO_DEFAULTAHBCLK
* 1000000". Otherwise it will cause the system time run faster 1.8 times
than the actual time on mindspeed board.

Signed-off-by: Haiqing Bai <Haiqing.Bai@windriver.com>
---
 arch/arm/mach-comcerto/time.c |    4 ++--
 1 files changed, 2 insertions(+), 2 deletions(-)

diff --git a/arch/arm/mach-comcerto/time.c b/arch/arm/mach-comcerto/time.c
index d44d96c..2e748cf 100644
--- a/arch/arm/mach-comcerto/time.c
+++ b/arch/arm/mach-comcerto/time.c
@@ -154,7 +154,7 @@ static void __init comcerto_clocksource_init(void)
 	struct comcerto_gptimer *t = &timers[TID_CLOCKSOURCE];
 
 	gptimer_set_bound(t, 0, 0xffffffff);
-	clocksource.mult = clocksource_hz2mult(COMCERTO_DEFAULTAHBCLK, clocksource.shift);
+	clocksource.mult = clocksource_hz2mult(COMCERTO_DEFAULTAHBCLK * 1000000, clocksource.shift);
 	if (clocksource_register(&clocksource))
 		printk(KERN_ERR "%s: can't register clocksource!\n", clocksource.name);
 }
@@ -193,7 +193,7 @@ static void __init comcerto_clockevents_init(void)
 {
 	struct comcerto_gptimer *t = &timers[TID_CLOCKEVENT];
 
-	clockevent.mult = div_sc(COMCERTO_DEFAULTAHBCLK, NSEC_PER_SEC, clockevent.shift);
+	clockevent.mult = div_sc(COMCERTO_DEFAULTAHBCLK * 1000000, NSEC_PER_SEC, clockevent.shift);
 	clockevent.max_delta_ns = clockevent_delta2ns(0x3fffffff, &clockevent);
 	clockevent.min_delta_ns = clockevent_delta2ns(1, &clockevent);
 	clockevent.cpumask = cpumask_of(0);
-- 
1.7.0.2

