From db512ed3f67ccb6369e6634b6937d4f3ba969fa9 Mon Sep 17 00:00:00 2001
From: Sekhar Nori <nsekhar@ti.com>
Date: Sun, 10 Jan 2010 19:14:28 +0530
Subject: [PATCH 19/23] davinci: da850/omap-l138: keep async clock constant with cpufreq

Original codes from TI Linux Platform Support Package
DaVinci-PSP-SDK-03.20.00.12.tgz http://software-dl.ti.com/dsps/
dsps_public_sw/sdo_sb/targetcontent/psp/DaVinci-PSP-SDK/03_20/index_FDS.html

Signed-off-by: Sekhar Nori <nsekhar@ti.com>
Integrated-by: Stanley.Miao <stanley.miao@windriver.com>
---
 arch/arm/mach-davinci/da850.c |    4 ++++
 1 files changed, 4 insertions(+), 0 deletions(-)

diff --git a/arch/arm/mach-davinci/da850.c b/arch/arm/mach-davinci/da850.c
index 8416e1e..fa55583 100644
--- a/arch/arm/mach-davinci/da850.c
+++ b/arch/arm/mach-davinci/da850.c
@@ -85,6 +85,7 @@ static struct clk pll0_sysclk3 = {
 	.parent		= &pll0_clk,
 	.flags		= CLK_PLL,
 	.div_reg	= PLLDIV3,
+	.set_rate	= davinci_set_sysclk_rate,
 };
 
 static struct clk pll0_sysclk4 = {
@@ -1007,6 +1008,9 @@ static struct platform_device da850_cpufreq_device = {
 
 int __init da850_register_cpufreq(void)
 {
+	/* cpufreq driver can help "async" clock constant */
+	clk_add_alias("async", NULL, "pll0_sysclk3", NULL);
+
 	return platform_device_register(&da850_cpufreq_device);
 }
 
-- 
1.6.5.2

