From 09d8f35ab4866b11464843f5de013137bb66a64c Mon Sep 17 00:00:00 2001
From: Stanley.Miao <stanley.miao@windriver.com>
Date: Fri, 7 May 2010 10:31:45 +0800
Subject: [PATCH 01/23] L138: Fix a MMC/NOR pinmux problem

NOR has some pins multiplexed with MMC, but NAND doesn't. So, the NAND
register function should be taken out from if(!HAS_MMC) { }.

Signed-off-by: Stanley.Miao <stanley.miao@windriver.com>
---
 arch/arm/mach-davinci/board-da850-evm.c |   22 +++++++++++-----------
 1 files changed, 11 insertions(+), 11 deletions(-)

diff --git a/arch/arm/mach-davinci/board-da850-evm.c b/arch/arm/mach-davinci/board-da850-evm.c
index 411284d..8b4c943 100644
--- a/arch/arm/mach-davinci/board-da850-evm.c
+++ b/arch/arm/mach-davinci/board-da850-evm.c
@@ -205,21 +205,21 @@ static __init void da850_evm_setup_nor_nand(void)
 {
 	int ret = 0;
 
-	if (ui_card_detected & !HAS_MMC) {
+	if (ui_card_detected) {
+		if (!HAS_MMC) {
+			ret = da8xx_pinmux_setup(da850_nor_pins);
+			if (ret)
+				pr_warning("da850_evm_init: nor mux setup failed: %d\n",
+						ret);
+			da850_evm_init_nor();
+			platform_device_register(&da850_evm_norflash_device);
+		}
+
 		ret = da8xx_pinmux_setup(da850_nand_pins);
 		if (ret)
 			pr_warning("da850_evm_init: nand mux setup failed: "
 					"%d\n", ret);
-
-		ret = da8xx_pinmux_setup(da850_nor_pins);
-		if (ret)
-			pr_warning("da850_evm_init: nor mux setup failed: %d\n",
-				ret);
-
-		da850_evm_init_nor();
-
-		platform_add_devices(da850_evm_devices,
-					ARRAY_SIZE(da850_evm_devices));
+		platform_device_register(&da850_evm_nandflash_device);
 	}
 }
 
-- 
1.6.5.2

