From 61a480b945dcb647e5587fa9ebdc081db95a3c63 Mon Sep 17 00:00:00 2001
From: Stanley.Miao <stanley.miao@windriver.com>
Date: Tue, 1 Jun 2010 17:42:58 +0800
Subject: [PATCH 2/2] spi: modify da850 platform data for updated driver

These changes update the da850 platform data to match the modifications
that were done to the davinci spi controller driver.  The driver update
allowed per-device transfer settings, which are provided by this patch.

Signed-off-by: Stanley.Miao <stanley.miao@windriver.com>
---
 arch/arm/mach-davinci/board-da850-evm.c |   13 +++++++++++++
 arch/arm/mach-davinci/devices-da8xx.c   |   12 ------------
 2 files changed, 13 insertions(+), 12 deletions(-)

diff --git a/arch/arm/mach-davinci/board-da850-evm.c b/arch/arm/mach-davinci/board-da850-evm.c
index c329446..573397a 100644
--- a/arch/arm/mach-davinci/board-da850-evm.c
+++ b/arch/arm/mach-davinci/board-da850-evm.c
@@ -35,6 +35,7 @@
 #include <mach/nand.h>
 #include <mach/mux.h>
 #include <mach/flash.h>
+#include <mach/spi.h>
 
 #define DA850_EVM_PHY_MASK		0x1
 #define DA850_EVM_MDIO_FREQUENCY	2200000 /* PHY bus frequency */
@@ -232,10 +233,22 @@ static struct flash_platform_data spi_flash_data = {
 	.type = "m25p64",
 };
 
+struct davinci_spi_config spi_flash_cfg = {
+	.parity_enable	= 0,
+	.intr_level	= 0,
+	.io_type	= SPI_IO_TYPE_DMA,
+	.wdelay		= 0,
+	.timer_disable	= 0,
+	.c2t_delay       = 8,
+	.t2c_delay       = 8,
+	.odd_parity     = 0,
+};
+
 static struct spi_board_info da850_spi_board_info[] = {
 	[0] = {
 		.modalias = "m25p80",
 		.platform_data = &spi_flash_data,
+		.controller_data = &spi_flash_cfg,
 		.mode = SPI_MODE_0,
 		.max_speed_hz = 30000000,       /* max sample rate at 3V */
 		.bus_num = 1,
diff --git a/arch/arm/mach-davinci/devices-da8xx.c b/arch/arm/mach-davinci/devices-da8xx.c
index c2d1b1a..08825be 100644
--- a/arch/arm/mach-davinci/devices-da8xx.c
+++ b/arch/arm/mach-davinci/devices-da8xx.c
@@ -702,18 +702,6 @@ int __init da8xx_register_cpuidle(void)
 static struct davinci_spi_platform_data da850_spi1_pdata = {
 	.version	= SPI_VERSION_2,
 	.num_chipselect = 1,
-	.wdelay		= 0,
-	.odd_parity	= 0,
-	.parity_enable	= 0,
-	.wait_enable	= 0,
-	.timer_disable  = 0,
-	.clk_internal	= 1,
-	.cs_hold	= 1,
-	.intr_level	= 0,
-	.poll_mode	= 1,
-	.use_dma	= 1,
-	.c2tdelay	= 8,
-	.t2cdelay	= 8,
 };
 
 static struct resource da850_spi1_resources[] = {
-- 
1.6.5.2

