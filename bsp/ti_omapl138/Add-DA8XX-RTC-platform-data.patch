From 0f2fbd6b0963c7ace76d39c13a8d5a0a0296c32d Mon Sep 17 00:00:00 2001
From: Stanley.Miao <stanley.miao@windriver.com>
Date: Thu, 5 Nov 2009 17:53:21 +0800
Subject: [PATCH 14/43] Add DA8XX RTC platform data

Original codes from TI Linux Platform Support Package
DaVinci-PSP-SDK-03.20.00.05.tgz http://software-dl.ti.com/dsps/
dsps_public_sw/sdo_sb/targetcontent/psp/DaVinci-PSP-SDK/03_20/index_FDS.html

Add RTC support for the L138 processor.

Signed-off-by: Stanley.Miao <stanley.miao@windriver.com>
---
 arch/arm/mach-davinci/board-da850-evm.c    |    2 ++
 arch/arm/mach-davinci/devices.c            |   28 +++++++++++++++++++++++++++-
 arch/arm/mach-davinci/include/mach/da8xx.h |    1 +
 drivers/rtc/Kconfig                        |    4 ++--
 4 files changed, 32 insertions(+), 3 deletions(-)

diff --git a/arch/arm/mach-davinci/board-da850-evm.c b/arch/arm/mach-davinci/board-da850-evm.c
index 775f879..12d226b 100644
--- a/arch/arm/mach-davinci/board-da850-evm.c
+++ b/arch/arm/mach-davinci/board-da850-evm.c
@@ -305,6 +305,8 @@ static __init void da850_evm_init(void)
 	da850_init_spi1(NULL, 1, da850_spi_board_info0,
 			ARRAY_SIZE(da850_spi_board_info0));
 
+	da8xx_init_rtc();
+
 	da850_init_mcasp();
 
 	if (da850_evm_emac_pdata.rmii_en) {
diff --git a/arch/arm/mach-davinci/devices.c b/arch/arm/mach-davinci/devices.c
index f968ea4..00a9e0a 100644
--- a/arch/arm/mach-davinci/devices.c
+++ b/arch/arm/mach-davinci/devices.c
@@ -31,7 +31,8 @@
 #include "clock.h"
 
 
-#define DAVINCI_I2C_BASE	     0x01C21000
+#define DAVINCI_I2C_BASE		0x01C21000
+#define DA830_RTC_BASE			0x01C23000
 
 static struct resource i2c_resources[] = {
 	{
@@ -120,3 +121,28 @@ void __init davinci_init_i2c(struct davinci_i2c_platform_data *pdata)
 	}
 }
 
+static struct resource da8xx_rtc_resources[] = {
+	[0] = {		/* registers */
+		.start  = DA830_RTC_BASE,
+		.end    = DA830_RTC_BASE + SZ_4K - 1,
+		.flags  = IORESOURCE_MEM,
+	},
+	[1] = {		/* interrupt */
+		.start  = IRQ_DA8XX_RTC,
+		.end    = IRQ_DA8XX_RTC,
+		.flags  = IORESOURCE_IRQ,
+	},
+};
+
+static struct platform_device da8xx_rtc_device = {
+	.name		= "rtc-da830",
+	.id		= 0,
+	.num_resources	= ARRAY_SIZE(da8xx_rtc_resources),
+	.resource	= da8xx_rtc_resources,
+};
+
+void da8xx_init_rtc(void)
+{
+	(void) platform_device_register(&da8xx_rtc_device);
+}
+
diff --git a/arch/arm/mach-davinci/include/mach/da8xx.h b/arch/arm/mach-davinci/include/mach/da8xx.h
index d667093..a842a79 100644
--- a/arch/arm/mach-davinci/include/mach/da8xx.h
+++ b/arch/arm/mach-davinci/include/mach/da8xx.h
@@ -26,6 +26,7 @@
 #include <mach/emac.h>
 
 void __init da850_init(void);
+void da8xx_init_rtc(void);
 
 struct spi_board_info;
 void __init da850_init_spi1(unsigned char *chip_sel, unsigned int num_sel,
diff --git a/drivers/rtc/Kconfig b/drivers/rtc/Kconfig
index d4f01bd..aee9ad4 100644
--- a/drivers/rtc/Kconfig
+++ b/drivers/rtc/Kconfig
@@ -594,11 +594,11 @@ config RTC_DRV_PPC
 	 class.
 
 config RTC_DRV_DA830
-	tristate "TI DA830/OMAP-L137 RTC"
+	tristate "TI DA8XX/OMAP-L1XX RTC"
 	depends on RTC_CLASS
 	help
 	  If you say yes here you will get support for the
-	  TI RealTime Clock controller on DA830/OMAP-L137 SoC's.
+	  TI RealTime Clock controller on DA8XX/OMAP-L1XX SoC's.
 
 	  This driver can also be built as a module. If so, the module
 	  will be called rtc-da830.
-- 
1.6.5.2

