From 489e79e7e6e61190ba9ad2428e8ba4bc36330989 Mon Sep 17 00:00:00 2001
From: Stanley.Miao <stanley.miao@windriver.com>
Date: Thu, 5 Nov 2009 17:53:34 +0800
Subject: [PATCH 23/43] USB: otg: adding nop usb transceiver

commit f6d92a05c86754d62eabc84856d2035d0de3ddc3 in mainline.

NOP transceiver is used by all the usb transceiver which are mostly
autonomous and doesn't require any programming or which are built
into the usb ip itself.NOP transceiver only allocates the memory
for struct xceiv and calls otg_set_transceiver() so function call
to otg_get_transceiver() will return a valid transceiver.

NOP transceiver device should be registered by calling
usb_nop_xceiv_register() from platform files.

Signed-off-by: Ajay Kumar Gupta <ajay.gupta@ti.com>
Cc: Felipe Balbi <felipe.balbi@nokia.com>
Cc: David Brownell <dbrownell@users.sourceforge.net>
Signed-off-by: Greg Kroah-Hartman <gregkh@suse.de>
Signed-off-by: Stanley.Miao <stanley.miao@windriver.com>
---
 drivers/usb/otg/Kconfig  |    8 ++++++++
 drivers/usb/otg/Makefile |    1 +
 include/linux/usb/otg.h  |    4 ++++
 3 files changed, 13 insertions(+), 0 deletions(-)

diff --git a/drivers/usb/otg/Kconfig b/drivers/usb/otg/Kconfig
index 1adc647..5cad58d 100644
--- a/drivers/usb/otg/Kconfig
+++ b/drivers/usb/otg/Kconfig
@@ -12,3 +12,11 @@ config USB_OTG_UTILS
 	  Select this to make sure the build includes objects from
 	  the OTG infrastructure directory.
 
+config NOP_USB_XCEIV
+	tristate "NOP USB Transceiver Driver"
+	select USB_OTG_UTILS
+	help
+	 this driver is to be used by all the usb transceiver which are either
+	 built-in with usb ip or which are autonomous and doesn't require any
+	 phy programming such as ISP1x04 etc.
+
diff --git a/drivers/usb/otg/Makefile b/drivers/usb/otg/Makefile
index 270cc65..bc562e2 100644
--- a/drivers/usb/otg/Makefile
+++ b/drivers/usb/otg/Makefile
@@ -4,3 +4,4 @@
 
 # infrastructure
 obj-$(CONFIG_USB_OTG_UTILS)	+= otg.o
+obj-$(CONFIG_NOP_USB_XCEIV)	+= nop-usb-xceiv.o
diff --git a/include/linux/usb/otg.h b/include/linux/usb/otg.h
index 94df4fe..7df8bae 100644
--- a/include/linux/usb/otg.h
+++ b/include/linux/usb/otg.h
@@ -81,6 +81,10 @@ struct otg_transceiver {
 /* for board-specific init logic */
 extern int otg_set_transceiver(struct otg_transceiver *);
 
+/* sometimes transceivers are accessed only through e.g. ULPI */
+extern void usb_nop_xceiv_register(void);
+extern void usb_nop_xceiv_unregister(void);
+
 
 /* for usb host and peripheral controller drivers */
 extern struct otg_transceiver *otg_get_transceiver(void);
-- 
1.6.5.2

