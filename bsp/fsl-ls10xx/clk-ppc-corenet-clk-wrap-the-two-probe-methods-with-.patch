From 85310b186bee5e8cbd92af059a197e698ae85bce Mon Sep 17 00:00:00 2001
From: Kevin Hao <kexin.hao@windriver.com>
Date: Mon, 20 Oct 2014 09:27:07 +0800
Subject: [PATCH] clk: ppc-corenet-clk: wrap the two probe methods with the
 corresponding ifdef

In the current ppc-corenet-clk driver, we use two methods for the clk
device probe. The platform driver is used for the ppc target and
CLK_OF_DECLARE() for arm target. These two methods are exclusive. The
platform driver also cause udevadm malfunction and prevent login to
the target on arm board, so wrap them with corresponding ifdef.

Signed-off-by: Kevin Hao <kexin.hao@windriver.com>
---
 drivers/clk/clk-ppc-corenet.c |    4 ++++
 1 files changed, 4 insertions(+), 0 deletions(-)

diff --git a/drivers/clk/clk-ppc-corenet.c b/drivers/clk/clk-ppc-corenet.c
index bb8b5e0..88d4abe 100644
--- a/drivers/clk/clk-ppc-corenet.c
+++ b/drivers/clk/clk-ppc-corenet.c
@@ -244,6 +244,7 @@ static const struct of_device_id clk_match[] __initconst = {
 	{}
 };
 
+#ifdef CONFIG_PPC
 static int __init ppc_corenet_clk_probe(struct platform_device *pdev)
 {
 	struct device_node *np;
@@ -279,7 +280,9 @@ static int __init ppc_corenet_clk_init(void)
 	return platform_driver_register(&ppc_corenet_clk_driver);
 }
 subsys_initcall(ppc_corenet_clk_init);
+#endif
 
+#ifdef CONFIG_ARM
 static void __init ls1021a_clocks_init(struct device_node *np)
 {
 	base = of_iomap(np, 0);
@@ -289,3 +292,4 @@ static void __init ls1021a_clocks_init(struct device_node *np)
 	of_clk_init(clk_match);
 }
 CLK_OF_DECLARE(ls1021a, "fsl,ls1021a-clockgen", ls1021a_clocks_init);
+#endif
-- 
1.7.5.4

