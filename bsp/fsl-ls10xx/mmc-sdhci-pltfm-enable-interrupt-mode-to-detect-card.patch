From 1eefe0e936626add2cb16817cebbae20be06057e Mon Sep 17 00:00:00 2001
From: Yangbo Lu <yangbo.lu@freescale.com>
Date: Thu, 11 Jun 2015 14:57:53 +0800
Subject: [PATCH 099/129] mmc: sdhci-pltfm: enable interrupt mode to detect
 card

Enable interrupt mode to detect card instead of polling mode for
ls1021a by removing the quirk SDHCI_QUIRK_BROKEN_CARD_DETECTION.
This could improve data transferring performance and avoid the call
trace caused by polling card status sometime.

Signed-off-by: Yangbo Lu <yangbo.lu@freescale.com>
Change-Id: Id965cd89b16f3f4d8327f1ca3d7ba9ed146e7a44
Reviewed-on: http://git.am.freescale.net:8181/37819
Tested-by: Review Code-CDREVIEW <CDREVIEW@freescale.com>
Reviewed-by: Xiaobo Xie <X.Xie@freescale.com>
Reviewed-by: Zhengxiong Jin <Jason.Jin@freescale.com>
[Xulin:Original patch taken from
Freescale-Linux-SDK-for-LS1021A-IOT-Rev2-v0.4-SOURCE-20150907-yocto.iso]
Signed-off-by: Xulin Sun <xulin.sun@windriver.com>
---
 drivers/mmc/host/sdhci-pltfm.c |    3 ++-
 1 files changed, 2 insertions(+), 1 deletions(-)

diff --git a/drivers/mmc/host/sdhci-pltfm.c b/drivers/mmc/host/sdhci-pltfm.c
index 23ea68d..23673c7 100644
--- a/drivers/mmc/host/sdhci-pltfm.c
+++ b/drivers/mmc/host/sdhci-pltfm.c
@@ -118,7 +118,8 @@ void sdhci_get_of_property(struct platform_device *pdev)
 		of_device_is_compatible(np, "fsl,p4080-esdhc") ||
 		of_device_is_compatible(np, "fsl,t1040-esdhc") ||
 		of_device_is_compatible(np, "fsl,t2080-esdhc") ||
-		of_device_is_compatible(np, "fsl,p1020-esdhc"))
+		of_device_is_compatible(np, "fsl,p1020-esdhc") ||
+		of_device_is_compatible(np, "fsl,ls1021a-esdhc"))
 		host->quirks &= ~SDHCI_QUIRK_BROKEN_CARD_DETECTION;
 
 	clk = of_get_property(np, "clock-frequency", &size);
-- 
1.7.5.4

