From bd23f3ded82e50da1133f7211b8fe9a8f6fd11e1 Mon Sep 17 00:00:00 2001
From: Chao Fu <B44548@freescale.com>
Date: Wed, 4 Jun 2014 15:01:10 +0800
Subject: [PATCH 186/255] ls1021-qds:Add QSPI support for ls1021 platform and
 ls0121-qds board

Signed-off-by: Chao Fu <B44548@freescale.com>
[Kevin: Original patch taken from
LS1021A-SDK-V1.1-ARM-SOURCE-20140815-yocto.iso]
Signed-off-by: Kevin Hao <kexin.hao@windriver.com>
---
 arch/arm/boot/dts/ls1021a-qds.dts | 7 +++++--
 arch/arm/boot/dts/ls1021a.dtsi    | 3 +++
 2 files changed, 8 insertions(+), 2 deletions(-)

diff --git a/arch/arm/boot/dts/ls1021a-qds.dts b/arch/arm/boot/dts/ls1021a-qds.dts
index 1480266..14ccccf 100644
--- a/arch/arm/boot/dts/ls1021a-qds.dts
+++ b/arch/arm/boot/dts/ls1021a-qds.dts
@@ -406,12 +406,15 @@
 
 &qspi {
 	num-cs = <2>;
+	bus-num = <0>;
+	fsl,spi-num-chipselects = <2>;
+	fsl,spi-flash-chipselects = <0>;
 	status = "okay";
 
 	qflash0: s25fl128s@0 {
 		#address-cells = <1>;
 		#size-cells = <1>;
-		compatible = "spansion,s25fl128s";
+		compatible = "spansion,s25fl129p1";
 		spi-max-frequency = <20000000>;
 		reg = <0>;
 
@@ -424,7 +427,7 @@
 	qflash1: s25fl128s@1 {
 		#address-cells = <1>;
 		#size-cells = <1>;
-		compatible = "spansion,s25fl128s";
+		compatible = "spansion,s25fl129p1";
 		spi-max-frequency = <20000000>;
 		reg = <1>;
 
diff --git a/arch/arm/boot/dts/ls1021a.dtsi b/arch/arm/boot/dts/ls1021a.dtsi
index b86cdfa..f3ddb90 100644
--- a/arch/arm/boot/dts/ls1021a.dtsi
+++ b/arch/arm/boot/dts/ls1021a.dtsi
@@ -111,6 +111,9 @@
 			reg = <0x0 0x1550000 0x0 0x10000>;
 			interrupts = <GIC_SPI 131 IRQ_TYPE_LEVEL_HIGH>;
 			clock-names = "qspi_en", "qspi";
+			clocks = <&platform_clk 1>, <&platform_clk 1>;
+			big-endian;
+			amba-base = <0x40000000>;
 			status = "disabled";
 		};
 
-- 
2.0.2

