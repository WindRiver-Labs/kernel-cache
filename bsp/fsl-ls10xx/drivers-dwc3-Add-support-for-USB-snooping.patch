From dbff9727c6e09b864ed1444b311e35fd4a214863 Mon Sep 17 00:00:00 2001
From: Rajesh Bhagat <rajesh.bhagat@freescale.com>
Date: Fri, 20 Nov 2015 12:45:31 +0530
Subject: [PATCH 2/3] drivers: dwc3 : Add support for USB snooping

Add support for USB3 snooping by asserting bits
in register DWC3_GSBUSCFG0 for data and descriptor

Signed-off-by: Nikhil Badola <nikhil.badola@freescale.com>
Signed-off-by: Rajesh Bhagat <rajesh.bhagat@freescale.com>
[Quanyang:Original patch taken
from QorIQ-SDK-v1.9-SOURCE-20151210-yocto.iso.]
Signed-off-by: Quanyang Wang <quanyang.wang@windriver.com>
---
 drivers/usb/dwc3/core.c |    4 ++++
 1 files changed, 4 insertions(+), 0 deletions(-)

diff --git a/drivers/usb/dwc3/core.c b/drivers/usb/dwc3/core.c
index 643d840..409544c 100644
--- a/drivers/usb/dwc3/core.c
+++ b/drivers/usb/dwc3/core.c
@@ -1013,6 +1013,10 @@ static int dwc3_probe(struct platform_device *pdev)
 	dwc3_writel(dwc->regs, DWC3_GSBUSCFG1,
 		dwc3_readl(dwc->regs, DWC3_GSBUSCFG1) | 0xf00);
 
+	/* Enable Snooping */
+	dwc3_writel(dwc->regs, DWC3_GSBUSCFG0,
+			dwc3_readl(dwc->regs, DWC3_GSBUSCFG0) | 0x22220000);
+
 	if (IS_ENABLED(CONFIG_USB_DWC3_HOST))
 		dwc->dr_mode = USB_DR_MODE_HOST;
 	else if (IS_ENABLED(CONFIG_USB_DWC3_GADGET))
-- 
1.7.5.4

