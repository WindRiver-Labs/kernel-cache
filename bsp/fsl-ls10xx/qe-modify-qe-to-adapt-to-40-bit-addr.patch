From 03efb03be653c5e36b24344b8f46a3fdbfa45a20 Mon Sep 17 00:00:00 2001
From: Zhao Qiang <B45475@freescale.com>
Date: Wed, 4 Jun 2014 11:34:37 +0800
Subject: [PATCH 184/255] qe: modify qe to adapt to 40-bit addr

Signed-off-by: Zhao Qiang <B45475@freescale.com>
[Kevin: Original patch taken from
LS1021A-SDK-V1.1-ARM-SOURCE-20140815-yocto.iso]
Signed-off-by: Kevin Hao <kexin.hao@windriver.com>
---
 drivers/qe/qe.c | 13 ++++---------
 1 file changed, 4 insertions(+), 9 deletions(-)

diff --git a/drivers/qe/qe.c b/drivers/qe/qe.c
index 34e406f..0afd273 100644
--- a/drivers/qe/qe.c
+++ b/drivers/qe/qe.c
@@ -70,8 +70,8 @@ static phys_addr_t qebase = -1;
 phys_addr_t get_qe_base(void)
 {
 	struct device_node *qe;
-	u32 val;
 	int ret;
+	struct resource res;
 
 	if (qebase != -1)
 		return qebase;
@@ -82,14 +82,9 @@ phys_addr_t get_qe_base(void)
 		if (!qe)
 			return qebase;
 	}
-	ret = of_property_read_u32_index(qe, "reg", 0, &val);
-#ifdef CONFIG_ARM
-	if (ret == 0)
-		qebase = val;
-	return qebase;
-#endif
-	if (ret == 0)
-		qebase = of_translate_address(qe, &val);
+	ret = of_address_to_resource(qe, 0, &res);
+	if (!ret)
+		qebase = res.start;
 	of_node_put(qe);
 
 	return qebase;
-- 
2.0.2

