From 604247929a6196a845e22d23d2f266fa95d1b4e1 Mon Sep 17 00:00:00 2001
From: Ahmed Mansour <Ahmed.Mansour@freescale.com>
Date: Thu, 14 May 2015 12:09:05 -0400
Subject: [PATCH 48/70] qbman: Fix qman_ceetm_cscn_dcp_get()

Corrections to struct qm_mcr_ceetm_ccgr_query to match block guide
Corrections to qman_ceetm_cscn_dcp_get() bit manipulation to match
bit order in block guide

Signed-off-by: Ahmed Mansour <Ahmed.Mansour@freescale.com>
Change-Id: I78d730263495358c29be766933aceae9d5b36326
Reviewed-on: http://git.am.freescale.net:8181/36407
Tested-by: Review Code-CDREVIEW <CDREVIEW@freescale.com>
Reviewed-by: Haiying Wang <Haiying.Wang@freescale.com>
Reviewed-by: Roy Pledge <roy.pledge@freescale.com>
Reviewed-by: Honghua Yin <Hong-Hua.Yin@freescale.com>
[czou:Original patch taken from
LS1021A-IOT-Rev2-v0.4-20150907-yocto.iso]
Signed-off-by: zou cao <cao.zou@windriver.com>
---
 drivers/staging/fsl_qbman/qman_high.c |    2 +-
 include/linux/fsl_qman.h              |    4 ++--
 2 files changed, 3 insertions(+), 3 deletions(-)

diff --git a/drivers/staging/fsl_qbman/qman_high.c b/drivers/staging/fsl_qbman/qman_high.c
index a99e90fb..e7ffb3f 100644
--- a/drivers/staging/fsl_qbman/qman_high.c
+++ b/drivers/staging/fsl_qbman/qman_high.c
@@ -4905,7 +4905,7 @@ int qman_ceetm_cscn_dcp_get(struct qm_ceetm_ccg *ccg,
 
 	*vcgid = query_result.cm_query.cdv;
 	*cscn_enabled = (query_result.cm_query.cscn_targ_dcp >>
-							(7 - dcp_idx)) & 0x1;
+							dcp_idx) & 0x1;
 	return 0;
 }
 EXPORT_SYMBOL(qman_ceetm_cscn_dcp_get);
diff --git a/include/linux/fsl_qman.h b/include/linux/fsl_qman.h
index 25c2f0c..c4270fe 100644
--- a/include/linux/fsl_qman.h
+++ b/include/linux/fsl_qman.h
@@ -1245,8 +1245,8 @@ struct qm_mcr_ceetm_ccgr_query {
 			struct qm_cgr_wr_parm wr_parm_g;
 			struct qm_cgr_wr_parm wr_parm_y;
 			struct qm_cgr_wr_parm wr_parm_r;
-			u8 cscn_targ_dcp;
-			u16 dcp_lsn;
+			u16 cscn_targ_dcp;
+			u8 dcp_lsn;
 			u64 i_cnt:40;
 			u8 __reserved4[3];
 			u64 a_cnt:40;
-- 
1.7.5.4

