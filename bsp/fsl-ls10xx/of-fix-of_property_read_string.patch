From 1ad2dc7d1ac586d4ad16c792d289432c24e6a2e3 Mon Sep 17 00:00:00 2001
From: Shengzhou Liu <Shengzhou.Liu@freescale.com>
Date: Tue, 7 Apr 2015 17:01:32 +0800
Subject: [PATCH 37/70] of: fix of_property_read_string

in of_property_read_string function, strnlen(prop->value, prop->length)
is always less or equal to prop->length and we should allow the '=='
condition, so let's remove the original unreasonable condition, otherwise
it was causing kernel crash.

Signed-off-by: Shengzhou Liu <Shengzhou.Liu@freescale.com>
Change-Id: I4adf0d8ed7c3185b942d8da0f671faf7b5272720
Reviewed-on: http://git.am.freescale.net:8181/34543
Tested-by: Review Code-CDREVIEW <CDREVIEW@freescale.com>
Reviewed-by: Xiaobo Xie <X.Xie@freescale.com>
Reviewed-by: Honghua Yin <Hong-Hua.Yin@freescale.com>
[czou:Original patch taken from
LS1021A-IOT-Rev2-v0.4-20150907-yocto.iso]
Signed-off-by: zou cao <cao.zou@windriver.com>
---
 drivers/of/base.c |    2 --
 1 files changed, 0 insertions(+), 2 deletions(-)

diff --git a/drivers/of/base.c b/drivers/of/base.c
index d43b18e..3c81ebf 100644
--- a/drivers/of/base.c
+++ b/drivers/of/base.c
@@ -1142,8 +1142,6 @@ int of_property_read_string(struct device_node *np, const char *propname,
 		return -EINVAL;
 	if (!prop->value)
 		return -ENODATA;
-	if (strnlen(prop->value, prop->length) >= prop->length)
-		return -EILSEQ;
 	*out_string = prop->value;
 	return 0;
 }
-- 
1.7.5.4

