From 2d76ae8887ea02cb9ea11caa78c8f7e13a5b52e9 Mon Sep 17 00:00:00 2001
From: Shengzhou Liu <Shengzhou.Liu@freescale.com>
Date: Tue, 7 Apr 2015 17:01:32 +0800
Subject: [PATCH 092/129] of: fix of_property_read_string

in of_property_read_string function, strnlen(prop->value, prop->length)
is always less or equal to prop->length and we should allow the '=='
condition, so let's remove the original unreasonable condition, otherwise
it was causing kernel crash.

Signed-off-by: Shengzhou Liu <Shengzhou.Liu@freescale.com>
Change-Id: I4adf0d8ed7c3185b942d8da0f671faf7b5272720
Reviewed-on: http://git.am.freescale.net:8181/34543
Tested-by: Review Code-CDREVIEW <CDREVIEW@freescale.com>
Reviewed-by: Xiaobo Xie <X.Xie@freescale.com>
Reviewed-by: Honghua Yin <Hong-Hua.Yin@freescale.com>
[Xulin:Original patch taken from
Freescale-Linux-SDK-for-LS1021A-IOT-Rev2-v0.4-SOURCE-20150907-yocto.iso]
Signed-off-by: Xulin Sun <xulin.sun@windriver.com>
---
 drivers/of/base.c |    2 --
 1 files changed, 0 insertions(+), 2 deletions(-)

diff --git a/drivers/of/base.c b/drivers/of/base.c
index 5ed9724..b7a9d20 100644
--- a/drivers/of/base.c
+++ b/drivers/of/base.c
@@ -1352,8 +1352,6 @@ int of_property_read_string(struct device_node *np, const char *propname,
 		return -EINVAL;
 	if (!prop->value)
 		return -ENODATA;
-	if (strnlen(prop->value, prop->length) >= prop->length)
-		return -EILSEQ;
 	*out_string = prop->value;
 	return 0;
 }
-- 
1.7.5.4

