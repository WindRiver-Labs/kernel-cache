From 0f2be1340ffe9daea70a8cea34445bb0c05ea58b Mon Sep 17 00:00:00 2001
From: Jingchang Lu <jingchang.lu@freescale.com>
Date: Fri, 2 May 2014 09:28:21 +0800
Subject: [PATCH 074/255] arm: mxc: ls1021a: add DMA_ZONE option on LPAE
 enabled

This is to avoid dma coherence allocation error of
"coherent DMA mask 0xffffffff is smaller than
system GFP_DMA mask 0xffffffffffffffff".

Signed-off-by: Jingchang Lu <jingchang.lu@freescale.com>
[Kevin: Original patch taken from
LS1021A-SDK-V1.1-ARM-SOURCE-20140815-yocto.iso]
Signed-off-by: Kevin Hao <kexin.hao@windriver.com>
---
 arch/arm/mach-imx/Kconfig        | 1 +
 arch/arm/mach-imx/mach-ls1021a.c | 3 +++
 2 files changed, 4 insertions(+)

diff --git a/arch/arm/mach-imx/Kconfig b/arch/arm/mach-imx/Kconfig
index c6e140d..125d276 100644
--- a/arch/arm/mach-imx/Kconfig
+++ b/arch/arm/mach-imx/Kconfig
@@ -860,6 +860,7 @@ config SOC_LS1021A
 	select FSL_FTM_TIMER
 	select HAVE_SMP
 	select ARCH_LAYERSCAPE
+	select ZONE_DMA if ARM_LPAE
 
 	help
 	  This enable support for Freescale Layerscape LS1021A  processor.
diff --git a/arch/arm/mach-imx/mach-ls1021a.c b/arch/arm/mach-imx/mach-ls1021a.c
index e2fffe9..55e2db1 100644
--- a/arch/arm/mach-imx/mach-ls1021a.c
+++ b/arch/arm/mach-imx/mach-ls1021a.c
@@ -33,6 +33,9 @@ static const char *ls1021a_dt_compat[] __initdata = {
 };
 
 DT_MACHINE_START(ls1021a, "Freescale Layerscape LS1021A")
+#ifdef CONFIG_ZONE_DMA
+	.dma_zone_size	= SZ_128M,
+#endif
 	.smp		= smp_ops(ls1021a_smp_ops),
 	.init_time	= ls1021a_init_time,
 	.init_machine   = ls1021a_init_machine,
-- 
2.0.2

