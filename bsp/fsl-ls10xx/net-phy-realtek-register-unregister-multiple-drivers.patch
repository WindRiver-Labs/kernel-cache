From bc65f6dfeb78ea95d970a57c5b6417d32c59ce08 Mon Sep 17 00:00:00 2001
From: Jongsung Kim <neidhard.kim@lge.com>
Date: Tue, 10 Jun 2014 12:50:12 +0900
Subject: [PATCH 106/129] net: phy: realtek: register/unregister multiple
 drivers properly

Using phy_drivers_register/_unregister functions is proper way to
handle multiple PHY drivers registration. For Realtek PHY drivers
module, it fixes incomplete current error-handlings up and adds
missed unregistration for the RTL8201CP driver.

Signed-off-by: Jongsung Kim <neidhard.kim@lge.com>
Signed-off-by: David S. Miller <davem@davemloft.net>
(cherry picked from commit 71b9c4a8388f596b603a72c32404b39fe0f62588)
Signed-off-by: czou <cao.zou@windriver.com>
Singed-off-by: Xulin Sun <xulin.sun@windriver.com>
---
 drivers/net/phy/realtek.c |   22 ++++++++++------------
 1 files changed, 10 insertions(+), 12 deletions(-)

diff --git a/drivers/net/phy/realtek.c b/drivers/net/phy/realtek.c
index 0860685..53bef9d 100644
--- a/drivers/net/phy/realtek.c
+++ b/drivers/net/phy/realtek.c
@@ -88,18 +88,6 @@ static int rtl8211e_config_intr(struct phy_device *phydev)
 	return err;
 }
 
-/* RTL8201CP */
-static struct phy_driver rtl8201cp_driver = {
-	.phy_id         = 0x00008201,
-	.name           = "RTL8201CP Ethernet",
-	.phy_id_mask    = 0x0000ffff,
-	.features       = PHY_BASIC_FEATURES,
-	.flags          = PHY_HAS_INTERRUPT,
-	.config_aneg    = &genphy_config_aneg,
-	.read_status    = &genphy_read_status,
-	.driver         = { .owner = THIS_MODULE,},
-};
-
 static int rtl8211f_config_intr(struct phy_device *phydev)
 {
 	int err;
@@ -163,6 +151,16 @@ static int rtl8211f_config_init(struct phy_device *phydev)
 }
 
 static struct phy_driver realtek_drivers[] = {
+	{	/* RTL8201CP */
+		.phy_id         = 0x00008201,
+		.name           = "RTL8201CP Ethernet",
+		.phy_id_mask    = 0x0000ffff,
+		.features       = PHY_BASIC_FEATURES,
+		.flags          = PHY_HAS_INTERRUPT,
+		.config_aneg    = &genphy_config_aneg,
+		.read_status    = &genphy_read_status,
+		.driver         = { .owner = THIS_MODULE,},
+	},
 	{	/* RTL8211B */
 		.phy_id	 = 0x001cc912,
 		.name	   = "RTL8211B Gigabit Ethernet",
-- 
1.7.5.4

