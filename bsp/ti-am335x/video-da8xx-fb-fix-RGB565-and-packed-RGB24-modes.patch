From 31b3fad9bb86d0776f47bfcc999054326677276c Mon Sep 17 00:00:00 2001
From: Tomi Valkeinen <tomi.valkeinen@ti.com>
Date: Thu, 6 Feb 2014 18:14:44 +0000
Subject: [PATCH 65/71] video: da8xx-fb: fix RGB565 and packed RGB24 modes

This commit comes from branch ti-linux-3.12.y:
  git://git.ti.com/ti-linux-kernel/ti-linux-kernel.git

The driver does not clear LCD_V2_TFT_24BPP_MODE and
LCD_V2_TFT_24BPP_UNPACK bits properly, when those features are not in
use. This cases RGB565 and packed RGB24 to fail.

So clear the bits.

Signed-off-by: Tomi Valkeinen <tomi.valkeinen@ti.com>
Signed-off-by: Darren Etheridge <detheridge@ti.com>
(cherry picked from commit 3a552e412c41808cf374024af53fa0bbeecf5565)
Signed-off-by: Zumeng Chen <zumeng.chen@windriver.com>
---
 drivers/video/da8xx-fb.c |    5 +++++
 1 files changed, 5 insertions(+), 0 deletions(-)

diff --git a/drivers/video/da8xx-fb.c b/drivers/video/da8xx-fb.c
index a57bdcf..f301f70 100644
--- a/drivers/video/da8xx-fb.c
+++ b/drivers/video/da8xx-fb.c
@@ -620,6 +620,11 @@ static int lcd_cfg_frame_buffer(struct da8xx_fb_par *par, u32 width, u32 height,
 
 	par->palette_sz = 16 * 2;
 
+	if (lcd_revision == LCD_VERSION_2) {
+		reg &= ~LCD_V2_TFT_24BPP_MODE;
+		reg &= ~LCD_V2_TFT_24BPP_UNPACK;
+	}
+
 	switch (bpp) {
 	case 1:
 	case 2:
-- 
1.7.5.4

