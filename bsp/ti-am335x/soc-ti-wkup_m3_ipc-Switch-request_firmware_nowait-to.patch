From 22fed8d2ef84834961360258a3237617c96cb18d Mon Sep 17 00:00:00 2001
From: Dave Gerlach <d-gerlach@ti.com>
Date: Fri, 21 Aug 2015 11:12:37 -0500
Subject: [PATCH 496/800] soc: ti: wkup_m3_ipc: Switch request_firmware_nowait
 to GFP_ATOMIC

wkup_m3_init_scale_data gets called from noirq context after wkup_m3 is
booted which calls request_firmware_nowait so we must switch to use
GFP_ATOMIC context to make sure no sleeping occurs.

Signed-off-by: Dave Gerlach <d-gerlach@ti.com>
[zou: Original patch taken from PROCESSOR-SDK-LINUX-AM335X 02_00_01_07]
Signed-off-by: zou cao <cao.zou@windriver.com>
---
 drivers/soc/ti/wkup_m3_ipc.c |    2 +-
 1 files changed, 1 insertions(+), 1 deletions(-)

diff --git a/drivers/soc/ti/wkup_m3_ipc.c b/drivers/soc/ti/wkup_m3_ipc.c
index 0746570..2588036 100644
--- a/drivers/soc/ti/wkup_m3_ipc.c
+++ b/drivers/soc/ti/wkup_m3_ipc.c
@@ -183,7 +183,7 @@ static int wkup_m3_init_scale_data(struct device *dev)
 		return ret;
 
 	ret = request_firmware_nowait(THIS_MODULE, FW_ACTION_HOTPLUG,
-				      m3_ipc_state.sd_fw_name, dev, GFP_KERNEL,
+				      m3_ipc_state.sd_fw_name, dev, GFP_ATOMIC,
 				      dev, wkup_m3_scale_data_fw_cb);
 
 	return ret;
-- 
1.7.5.4

