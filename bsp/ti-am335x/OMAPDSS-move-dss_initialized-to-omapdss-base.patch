From e3ff3a59aca7c40cbf2e082ccd05f1cdff1baa05 Mon Sep 17 00:00:00 2001
From: Tomi Valkeinen <tomi.valkeinen@ti.com>
Date: Thu, 5 Nov 2015 17:23:14 +0200
Subject: [PATCH 698/800] OMAPDSS: move dss_initialized to omapdss-base

omapdss_is_initialized() is used to find out if omapdss has been probed
successfully. This patchs moves the related code to the common
omapdss-base module, so that the same support will be there for both
omapdss and omapdss6.

Signed-off-by: Tomi Valkeinen <tomi.valkeinen@ti.com>
Signed-off-by: Jyri Sarha <jsarha@ti.com>
[zou: Original patch taken from PROCESSOR-SDK-LINUX-AM335X 02_00_01_07]
Signed-off-by: zou cao <cao.zou@windriver.com>
---
 drivers/video/fbdev/omap2/dss/base.c       |   14 ++++++++++++++
 drivers/video/fbdev/omap2/dss/dss-common.h |    1 +
 drivers/video/fbdev/omap2/dss/dss.c        |   12 ++----------
 3 files changed, 17 insertions(+), 10 deletions(-)

diff --git a/drivers/video/fbdev/omap2/dss/base.c b/drivers/video/fbdev/omap2/dss/base.c
index 943030a..0394209 100644
--- a/drivers/video/fbdev/omap2/dss/base.c
+++ b/drivers/video/fbdev/omap2/dss/base.c
@@ -1,6 +1,20 @@
 #include <linux/kernel.h>
 #include <linux/module.h>
 
+static bool dss_initialized;
+
+void omapdss_set_is_initialized(bool set)
+{
+	dss_initialized = set;
+}
+EXPORT_SYMBOL(omapdss_set_is_initialized);
+
+bool omapdss_is_initialized(void)
+{
+	return dss_initialized;
+}
+EXPORT_SYMBOL(omapdss_is_initialized);
+
 MODULE_AUTHOR("Tomi Valkeinen <tomi.valkeinen@ti.com>");
 MODULE_DESCRIPTION("OMAP Display Subsystem Base");
 MODULE_LICENSE("GPL v2");
diff --git a/drivers/video/fbdev/omap2/dss/dss-common.h b/drivers/video/fbdev/omap2/dss/dss-common.h
index 9599b77..3e4a59a 100644
--- a/drivers/video/fbdev/omap2/dss/dss-common.h
+++ b/drivers/video/fbdev/omap2/dss/dss-common.h
@@ -1,5 +1,6 @@
 #ifndef __OMAP_DSS_COMMON_H
 #define __OMAP_DSS_COMMON_H
 
+void omapdss_set_is_initialized(bool set);
 
 #endif
diff --git a/drivers/video/fbdev/omap2/dss/dss.c b/drivers/video/fbdev/omap2/dss/dss.c
index 79c6b9e..09d937b 100644
--- a/drivers/video/fbdev/omap2/dss/dss.c
+++ b/drivers/video/fbdev/omap2/dss/dss.c
@@ -112,14 +112,6 @@ static const char * const dss_generic_clk_source_names[] = {
 	[OMAP_DSS_CLK_SRC_DSI2_PLL_HSDIV_DSI]	= "DSI_PLL2_HSDIV_DSI",
 };
 
-static bool dss_initialized;
-
-bool omapdss_is_initialized(void)
-{
-	return dss_initialized;
-}
-EXPORT_SYMBOL(omapdss_is_initialized);
-
 static inline void dss_write_reg(const struct dss_reg idx, u32 val)
 {
 	__raw_writel(val, dss.base + idx.idx);
@@ -1169,7 +1161,7 @@ static int dss_bind(struct device *dev)
 
 	pm_set_vt_switch(0);
 
-	dss_initialized = true;
+	omapdss_set_is_initialized(true);
 
 	return 0;
 
@@ -1193,7 +1185,7 @@ static void dss_unbind(struct device *dev)
 {
 	struct platform_device *pdev = to_platform_device(dev);
 
-	dss_initialized = false;
+	omapdss_set_is_initialized(false);
 
 	component_unbind_all(&pdev->dev, NULL);
 
-- 
1.7.5.4

