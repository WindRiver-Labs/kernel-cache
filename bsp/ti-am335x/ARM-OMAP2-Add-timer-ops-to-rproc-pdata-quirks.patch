From 5578b26ef9741c500beb1a00c14463abaaff69a8 Mon Sep 17 00:00:00 2001
From: Suman Anna <s-anna@ti.com>
Date: Thu, 6 Aug 2015 18:06:54 -0500
Subject: [PATCH 464/800] ARM: OMAP2+: Add timer ops to rproc pdata quirks

The OMAP remoteproc driver needs DMTimers to provide advanced
device management features, such as clock auto-gating to the
processor subsystem or remote processor suspend/resume.

The OMAP DMTimer API is limited to only the OMAP machine layers
in arch/arm/, so any DMTimer API needed by the OMAP remoteproc
driver should have to be accessed through some OMAP rproc specific
platform ops. Add the required timer ops to both the IPU and DSP
rproc platform data through pdata quirks.

Signed-off-by: Suman Anna <s-anna@ti.com>
[zou: Original patch taken from PROCESSOR-SDK-LINUX-AM335X 02_00_01_07]
Signed-off-by: zou cao <cao.zou@windriver.com>
---
 arch/arm/mach-omap2/pdata-quirks.c |    8 ++++++++
 1 files changed, 8 insertions(+), 0 deletions(-)

diff --git a/arch/arm/mach-omap2/pdata-quirks.c b/arch/arm/mach-omap2/pdata-quirks.c
index 6a40b2d..431eb15 100644
--- a/arch/arm/mach-omap2/pdata-quirks.c
+++ b/arch/arm/mach-omap2/pdata-quirks.c
@@ -253,9 +253,17 @@ static void __init omap3_tao3530_legacy_init(void)
 #endif /* CONFIG_ARCH_OMAP3 */
 
 #ifdef CONFIG_ARCH_OMAP4
+static struct omap_rproc_timer_ops omap_rproc_dmtimer_ops = {
+	.request_timer = omap_rproc_request_timer,
+	.release_timer = omap_rproc_release_timer,
+	.start_timer = omap_rproc_start_timer,
+	.stop_timer = omap_rproc_stop_timer,
+};
+
 static struct omap_rproc_pdata omap4_ipu_dsp_pdata = {
 	.device_enable = omap_rproc_device_enable,
 	.device_shutdown = omap_rproc_device_shutdown,
+	.timer_ops = &omap_rproc_dmtimer_ops,
 };
 #endif
 
-- 
1.7.5.4

