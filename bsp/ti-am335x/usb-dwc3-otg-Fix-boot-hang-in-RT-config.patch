From 9714c5b885b5454db2c857535b5c0e887c201b61 Mon Sep 17 00:00:00 2001
From: Roger Quadros <rogerq@ti.com>
Date: Tue, 15 Sep 2015 17:59:45 +0300
Subject: [PATCH 573/800] usb: dwc3: otg: Fix boot hang in RT config

Using spin_lock() in hard irq handler is pointless
and causes a BUG() in RT (real-time) configuration
so get rid of it.

Acked-by: Felipe Balbi <balbi@ti.com>
Signed-off-by: Roger Quadros <rogerq@ti.com>
Signed-off-by: Sekhar Nori <nsekhar@ti.com>
[zou: Original patch taken from PROCESSOR-SDK-LINUX-AM335X 02_00_01_07]
Signed-off-by: zou cao <cao.zou@windriver.com>
---
 drivers/usb/dwc3/core.c |    4 ----
 1 files changed, 0 insertions(+), 4 deletions(-)

diff --git a/drivers/usb/dwc3/core.c b/drivers/usb/dwc3/core.c
index eea057e..e1a7424 100644
--- a/drivers/usb/dwc3/core.c
+++ b/drivers/usb/dwc3/core.c
@@ -907,8 +907,6 @@ static irqreturn_t dwc3_otg_irq(int irq, void *_dwc)
 	irqreturn_t ret = IRQ_NONE;
 	u32 reg;
 
-	spin_lock(&dwc->lock);
-
 	reg = dwc3_readl(dwc->regs, DWC3_OEVT);
 	if (reg) {
 		dwc->oevt = reg;
@@ -917,8 +915,6 @@ static irqreturn_t dwc3_otg_irq(int irq, void *_dwc)
 		ret = IRQ_WAKE_THREAD;
 	}
 
-	spin_unlock(&dwc->lock);
-
 	return ret;
 }
 
-- 
1.7.5.4

