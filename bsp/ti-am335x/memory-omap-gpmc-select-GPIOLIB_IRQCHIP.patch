From bf66c8ba08e60838fbf77e6b5bcf0f9f6d2981ce Mon Sep 17 00:00:00 2001
From: Sekhar Nori <nsekhar@ti.com>
Date: Wed, 11 Nov 2015 08:51:33 -0600
Subject: [PATCH 798/800] memory: omap-gpmc: select GPIOLIB_IRQCHIP
MIME-Version: 1.0
Content-Type: text/plain; charset=UTF-8
Content-Transfer-Encoding: 8bit

OMAP GPMC driver uses irqchip in gpiolib but
does not select GPIOLIB_IRQCHIP. This can lead
to errors like below in randconfig builds.

  CC      drivers/memory/omap-gpmc.o
drivers/memory/omap-gpmc.c: In function ‘gpmc_handle_irq’:
drivers/memory/omap-gpmc.c:2007:43: error: ‘struct gpio_chip’ has no member named ‘irqdomain’
    virq = irq_find_mapping(gpmc->gpio_chip.irqdomain,
                                           ^
drivers/memory/omap-gpmc.c: In function ‘gpmc_gpio_init’:
drivers/memory/omap-gpmc.c:2088:2: error: implicit declaration of function ‘gpiochip_irqchip_add’ [-Werror=implicit-function-declaration]
  ret = gpiochip_irqchip_add(&gpmc->gpio_chip, &gpmc->irq_chip, 0,
  ^

Fixes: 8ec7ee22749e ("memory: omap-gpmc: Add irqchip support to the gpiochip")
Signed-off-by: Sekhar Nori <nsekhar@ti.com>
Signed-off-by: Kishon Vijay Abraham I <kishon@ti.com>
[zou: Original patch taken from PROCESSOR-SDK-LINUX-AM335X 02_00_01_07]
Signed-off-by: zou cao <cao.zou@windriver.com>
---
 drivers/memory/Kconfig |    1 +
 1 files changed, 1 insertions(+), 0 deletions(-)

diff --git a/drivers/memory/Kconfig b/drivers/memory/Kconfig
index 791d15c..2bfe598 100644
--- a/drivers/memory/Kconfig
+++ b/drivers/memory/Kconfig
@@ -43,6 +43,7 @@ config TI_EMIF
 
 config OMAP_GPMC
 	bool
+	select GPIOLIB_IRQCHIP
 	help
 	  This driver is for the General Purpose Memory Controller (GPMC)
 	  present on Texas Instruments SoCs (e.g. OMAP2+). GPMC allows
-- 
1.7.5.4

