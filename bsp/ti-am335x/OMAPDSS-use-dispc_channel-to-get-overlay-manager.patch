From 6036afc48dff188bacc1a057e03c49faa4a39ad0 Mon Sep 17 00:00:00 2001
From: Tomi Valkeinen <tomi.valkeinen@ti.com>
Date: Thu, 5 Nov 2015 10:02:29 +0200
Subject: [PATCH 690/800] OMAPDSS: use dispc_channel to get overlay manager

omapdss_find_mgr_from_display() needs to get the overlay manager for an
output device. It currently uses 'out->manager', but that is to be
removed.

This patch changes omapdss_find_mgr_from_display() to use
'out->dispc_channel' to get the overlay manager.

Signed-off-by: Tomi Valkeinen <tomi.valkeinen@ti.com>
Signed-off-by: Jyri Sarha <jsarha@ti.com>
[zou: Original patch taken from PROCESSOR-SDK-LINUX-AM335X 02_00_01_07]
Signed-off-by: zou cao <cao.zou@windriver.com>
---
 drivers/video/fbdev/omap2/dss/output.c |    7 ++++++-
 1 files changed, 6 insertions(+), 1 deletions(-)

diff --git a/drivers/video/fbdev/omap2/dss/output.c b/drivers/video/fbdev/omap2/dss/output.c
index dd5d487..d44aa3d 100644
--- a/drivers/video/fbdev/omap2/dss/output.c
+++ b/drivers/video/fbdev/omap2/dss/output.c
@@ -179,7 +179,12 @@ struct omap_overlay_manager *omapdss_find_mgr_from_display(struct omap_dss_devic
 	if (out == NULL)
 		return NULL;
 
-	mgr = out->manager;
+	if (!out->dispc_channel_connected) {
+		omap_dss_put_device(out);
+		return NULL;
+	}
+
+	mgr = omap_dss_get_overlay_manager(out->dispc_channel);
 
 	omap_dss_put_device(out);
 
-- 
1.7.5.4

