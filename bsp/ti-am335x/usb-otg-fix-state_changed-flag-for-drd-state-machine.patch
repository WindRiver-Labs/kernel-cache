From 097a8dfa7d1e61a6a8b677464f655b83b4012634 Mon Sep 17 00:00:00 2001
From: Roger Quadros <rogerq@ti.com>
Date: Sat, 12 Sep 2015 20:03:48 +0300
Subject: [PATCH 562/800] usb: otg: fix state_changed flag for drd state
 machine

state_change flag is never cleared so it will
not reflect the actal state.

Signed-off-by: Roger Quadros <rogerq@ti.com>
Signed-off-by: Sekhar Nori <nsekhar@ti.com>
[zou: Original patch taken from PROCESSOR-SDK-LINUX-AM335X 02_00_01_07]
Signed-off-by: zou cao <cao.zou@windriver.com>
---
 drivers/usb/common/usb-otg.c |    1 +
 1 files changed, 1 insertions(+), 0 deletions(-)

diff --git a/drivers/usb/common/usb-otg.c b/drivers/usb/common/usb-otg.c
index f1c10e4..7631176 100644
--- a/drivers/usb/common/usb-otg.c
+++ b/drivers/usb/common/usb-otg.c
@@ -384,6 +384,7 @@ static int drd_statemachine(struct otg_fsm *fsm)
 
 	mutex_lock(&fsm->lock);
 
+	fsm->state_changed = 0;
 	state = fsm->otg->state;
 
 	switch (state) {
-- 
1.7.5.4

