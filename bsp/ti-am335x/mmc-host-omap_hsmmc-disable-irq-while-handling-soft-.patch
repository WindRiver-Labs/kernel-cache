From d0384a19e8662795cad3bcd51dcf0323c3c5d613 Mon Sep 17 00:00:00 2001
From: Kishon Vijay Abraham I <kishon@ti.com>
Date: Mon, 30 Nov 2015 14:26:11 +0530
Subject: [PATCH 738/800] mmc: host: omap_hsmmc: disable irq while handling
 soft timeout

In order to avoid unnecessary interrupt handling while we are
already handling the software timeout, disable the irq in
software timeout handler.
For example there was a CRC error interrupt while software
timeout was being handled resulting in an abort.

Signed-off-by: Kishon Vijay Abraham I <kishon@ti.com>
Signed-off-by: Sekhar Nori <nsekhar@ti.com>
[zou: Original patch taken from PROCESSOR-SDK-LINUX-AM335X 02_00_01_07]
Signed-off-by: zou cao <cao.zou@windriver.com>
---
 drivers/mmc/host/omap_hsmmc.c |    1 +
 1 files changed, 1 insertions(+), 0 deletions(-)

diff --git a/drivers/mmc/host/omap_hsmmc.c b/drivers/mmc/host/omap_hsmmc.c
index 59f68f8..0a2a286 100644
--- a/drivers/mmc/host/omap_hsmmc.c
+++ b/drivers/mmc/host/omap_hsmmc.c
@@ -1358,6 +1358,7 @@ static void omap_hsmmc_soft_timeout(unsigned long data)
 {
 	struct omap_hsmmc_host *host = (struct omap_hsmmc_host *)data;
 
+	omap_hsmmc_disable_irq(host);
 	hsmmc_command_incomplete(host, -ETIMEDOUT, 0);
 }
 
-- 
1.7.5.4

