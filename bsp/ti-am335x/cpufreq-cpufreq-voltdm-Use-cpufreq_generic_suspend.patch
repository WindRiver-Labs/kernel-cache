From a7f3f45feaad58e9f3200ce6129266c9c367cb3a Mon Sep 17 00:00:00 2001
From: Dave Gerlach <d-gerlach@ti.com>
Date: Mon, 27 Jul 2015 15:11:33 -0500
Subject: [PATCH 308/800] cpufreq: cpufreq-voltdm: Use
 cpufreq_generic_suspend()

Use suspend support present in cpufreq core to let cpufreq-voltdm
driver set the suspend frequency to the first defined OPP in
order to achieve maximum power savings by suspending with the
lowest possible voltage on the MPU voltage rail.

Signed-off-by: Dave Gerlach <d-gerlach@ti.com>
Acked-by: Nishanth Menon <nm@ti.com>
[zou: Original patch taken from PROCESSOR-SDK-LINUX-AM335X 02_00_01_07]
Signed-off-by: zou cao <cao.zou@windriver.com>
---
 drivers/cpufreq/cpufreq-voltdm.c |    4 ++++
 1 files changed, 4 insertions(+), 0 deletions(-)

diff --git a/drivers/cpufreq/cpufreq-voltdm.c b/drivers/cpufreq/cpufreq-voltdm.c
index 68ab7e7..afe80ad 100644
--- a/drivers/cpufreq/cpufreq-voltdm.c
+++ b/drivers/cpufreq/cpufreq-voltdm.c
@@ -185,6 +185,7 @@ static int cpufreq_init(struct cpufreq_policy *policy)
 		transition_latency += voltage_latency;
 
 	policy->cpuinfo.transition_latency = transition_latency;
+	policy->suspend_freq = freq_table[0].frequency;
 
 	pd = cpufreq_get_driver_data();
 	if (!pd || !pd->independent_clocks)
@@ -258,6 +259,9 @@ static struct cpufreq_driver voltdm_cpufreq_driver = {
 	.ready = cpufreq_ready,
 	.name = "cpufreq-voltdm",
 	.attr = cpufreq_generic_attr,
+#ifdef CONFIG_PM
+	.suspend = cpufreq_generic_suspend,
+#endif
 };
 
 static int voltdm_cpufreq_probe(struct platform_device *pdev)
-- 
1.7.5.4

