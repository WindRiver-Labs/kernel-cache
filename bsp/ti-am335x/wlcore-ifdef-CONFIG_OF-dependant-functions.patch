From df3b6cd850d7428f4a57de9464a6dfae04a47343 Mon Sep 17 00:00:00 2001
From: Eyal Reizer <eyalr@ti.com>
Date: Sun, 15 Sep 2013 12:49:25 +0300
Subject: [PATCH 137/188] wlcore: ifdef CONFIG_OF-dependant functions

This commit comes from branch ti-linux-3.12.y:
  git://git.ti.com/ti-linux-kernel/ti-linux-kernel.git

some of_* functions are defined only if CONFIG_OF
is defined. make the relevant block dependant
on it.

make sure to handle invalid pdata now, as it might
not get overriden if CONFIG_OF is not defined.

Signed-off-by: Eyal Reizer <eyalr@ti.com>
Signed-off-by: Eliad Peller <eliad@wizery.com>
(cherry picked from commit 8bc48d900101e48a5f22f1f3563ef48ffcfa01cf)
---
 drivers/net/wireless/ti/wlcore/sdio.c |    5 +++++
 1 files changed, 5 insertions(+), 0 deletions(-)

diff --git a/drivers/net/wireless/ti/wlcore/sdio.c b/drivers/net/wireless/ti/wlcore/sdio.c
index 5748df2..cdc527a 100644
--- a/drivers/net/wireless/ti/wlcore/sdio.c
+++ b/drivers/net/wireless/ti/wlcore/sdio.c
@@ -233,6 +233,7 @@ static struct wl12xx_platform_data *get_platform_data(struct device *dev)
 	if (!IS_ERR(pdata))
 		return kmemdup(pdata, sizeof(*pdata), GFP_KERNEL);
 
+#ifdef CONFIG_OF
 	np = of_find_matching_node(NULL, wlcore_of_match);
 	if (!np) {
 		dev_err(dev, "No platform data set\n");
@@ -258,6 +259,10 @@ static struct wl12xx_platform_data *get_platform_data(struct device *dev)
 	of_property_read_u32(np, "board-ref-clock", &pdata->board_ref_clock);
 	of_property_read_u32(np, "board-tcxo-clock", &pdata->board_tcxo_clock);
 	of_property_read_u32(np, "platform-quirks", &pdata->platform_quirks);
+#endif
+
+	if (IS_ERR(pdata))
+		return NULL;
 
 	return pdata;
 }
-- 
1.7.5.4

