From 003b59944265e2473fc53d5155fa13634c3731b2 Mon Sep 17 00:00:00 2001
From: Jyri Sarha <jsarha@ti.com>
Date: Wed, 28 Oct 2015 14:00:42 +0200
Subject: [PATCH 629/800] drm/omapdrm: drm_atomic_get_plane_state() may return
 ERR_PTR

drm_atomic_get_plane_state() may return ERR_PTR. Handle
drm_atomic_get_plane_state() return values right in
omap_crtc_atomic_set_property().

Signed-off-by: Jyri Sarha <jsarha@ti.com>
Acked-by: Tomi Valkeinen <tomi.valkeinen@ti.com>
[zou: Original patch taken from PROCESSOR-SDK-LINUX-AM335X 02_00_01_07]
Signed-off-by: zou cao <cao.zou@windriver.com>
---
 drivers/gpu/drm/omapdrm/omap_crtc.c |    4 ++--
 1 files changed, 2 insertions(+), 2 deletions(-)

diff --git a/drivers/gpu/drm/omapdrm/omap_crtc.c b/drivers/gpu/drm/omapdrm/omap_crtc.c
index 9c26546..5b25d10 100644
--- a/drivers/gpu/drm/omapdrm/omap_crtc.c
+++ b/drivers/gpu/drm/omapdrm/omap_crtc.c
@@ -553,8 +553,8 @@ static int omap_crtc_atomic_set_property(struct drm_crtc *crtc,
 		 */
 
 		plane_state = drm_atomic_get_plane_state(state->state, plane);
-		if (!plane_state)
-			return -EINVAL;
+		if (IS_ERR(plane_state))
+			return PTR_ERR(plane_state);
 
 		return drm_atomic_plane_set_property(plane, plane_state,
 			property, val);
-- 
1.7.5.4

