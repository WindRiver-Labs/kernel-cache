From be435499e7fdfae0f75b19e646b27b34ce9bb982 Mon Sep 17 00:00:00 2001
From: Keerthy <j-keerthy@ti.com>
Date: Thu, 6 Aug 2015 11:40:12 -0500
Subject: [PATCH 419/800] ARM: OMAP: Check for clocks which do not have
 parents

Timer12 for example on DRA7 is fed by internal 32k oscillator clock has no
parent. So check for similar cases and proceed without erring out.

Signed-off-by: Keerthy <j-keerthy@ti.com>
Reviewed-by: Suman Anna <s-anna@ti.com>
[zou: Original patch taken from PROCESSOR-SDK-LINUX-AM335X 02_00_01_07]
Signed-off-by: zou cao <cao.zou@windriver.com>
---
 arch/arm/plat-omap/dmtimer.c |    5 +++++
 1 files changed, 5 insertions(+), 0 deletions(-)

diff --git a/arch/arm/plat-omap/dmtimer.c b/arch/arm/plat-omap/dmtimer.c
index 8ca94d3..ec0b35d 100644
--- a/arch/arm/plat-omap/dmtimer.c
+++ b/arch/arm/plat-omap/dmtimer.c
@@ -36,6 +36,7 @@
  */
 
 #include <linux/clk.h>
+#include <linux/clk-provider.h>
 #include <linux/module.h>
 #include <linux/io.h>
 #include <linux/device.h>
@@ -485,6 +486,10 @@ int omap_dm_timer_set_source(struct omap_dm_timer *timer, int source)
 	struct clk *parent;
 	struct dmtimer_platform_data *pdata;
 
+	/* Check if the clock has parents if not no point checking */
+	if (!__clk_get_num_parents(timer->fclk))
+		return 0;
+
 	if (unlikely(!timer))
 		return -EINVAL;
 
-- 
1.7.5.4

