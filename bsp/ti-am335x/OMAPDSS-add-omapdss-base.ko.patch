From 515fcc7424787be06a2b4b12d56ef9e5667393fc Mon Sep 17 00:00:00 2001
From: Tomi Valkeinen <tomi.valkeinen@ti.com>
Date: Thu, 5 Nov 2015 17:19:32 +0200
Subject: [PATCH 697/800] OMAPDSS: add omapdss-base.ko

We are working towards enabling omapdss6, which will consists of a new
dss, dispc and dpi drivers. omapdss6 will be a new module. The panel,
encoder and omapdrm will need to use either the current omapdss driver
or the new omapdss6 driver, depending on the platform.

This will be implemented with a common base module and function
pointers.

This patch adds a skeleton omapdss-base.ko module, to which we'll be
moving common dss functionality like registration of the panels.

Signed-off-by: Tomi Valkeinen <tomi.valkeinen@ti.com>
Signed-off-by: Jyri Sarha <jsarha@ti.com>
[zou: Original patch taken from PROCESSOR-SDK-LINUX-AM335X 02_00_01_07]
Signed-off-by: zou cao <cao.zou@windriver.com>
---
 drivers/video/fbdev/omap2/dss/Kconfig      |    4 ++++
 drivers/video/fbdev/omap2/dss/Makefile     |    4 ++++
 drivers/video/fbdev/omap2/dss/base.c       |    6 ++++++
 drivers/video/fbdev/omap2/dss/dss-common.h |    5 +++++
 drivers/video/fbdev/omap2/dss/dss.h        |    2 ++
 5 files changed, 21 insertions(+), 0 deletions(-)
 create mode 100644 drivers/video/fbdev/omap2/dss/base.c
 create mode 100644 drivers/video/fbdev/omap2/dss/dss-common.h

diff --git a/drivers/video/fbdev/omap2/dss/Kconfig b/drivers/video/fbdev/omap2/dss/Kconfig
index 65099b4..8628b4f 100644
--- a/drivers/video/fbdev/omap2/dss/Kconfig
+++ b/drivers/video/fbdev/omap2/dss/Kconfig
@@ -4,8 +4,12 @@ config OMAP2_DSS_INIT
 config OMAP2_DSS_COMPAT_SUPPORT
 	bool
 
+config OMAP_DSS_BASE
+	tristate
+
 menuconfig OMAP2_DSS
         tristate "OMAP2+ Display Subsystem support"
+	select OMAP_DSS_BASE
 	select VIDEOMODE_HELPERS
 	select OMAP2_DSS_INIT
 	select HDMI
diff --git a/drivers/video/fbdev/omap2/dss/Makefile b/drivers/video/fbdev/omap2/dss/Makefile
index aff556c..1804292 100644
--- a/drivers/video/fbdev/omap2/dss/Makefile
+++ b/drivers/video/fbdev/omap2/dss/Makefile
@@ -1,4 +1,8 @@
 obj-$(CONFIG_OMAP2_DSS_INIT) += omapdss-boot-init.o
+
+obj-$(CONFIG_OMAP_DSS_BASE) += omapdss-base.o
+omapdss-base-y := base.o
+
 obj-$(CONFIG_OMAP2_DSS) += omapdss.o
 # Core DSS files
 omapdss-y := core.o dss.o dss_features.o dispc.o dispc_coefs.o display.o \
diff --git a/drivers/video/fbdev/omap2/dss/base.c b/drivers/video/fbdev/omap2/dss/base.c
new file mode 100644
index 0000000..943030a
--- /dev/null
+++ b/drivers/video/fbdev/omap2/dss/base.c
@@ -0,0 +1,6 @@
+#include <linux/kernel.h>
+#include <linux/module.h>
+
+MODULE_AUTHOR("Tomi Valkeinen <tomi.valkeinen@ti.com>");
+MODULE_DESCRIPTION("OMAP Display Subsystem Base");
+MODULE_LICENSE("GPL v2");
diff --git a/drivers/video/fbdev/omap2/dss/dss-common.h b/drivers/video/fbdev/omap2/dss/dss-common.h
new file mode 100644
index 0000000..9599b77
--- /dev/null
+++ b/drivers/video/fbdev/omap2/dss/dss-common.h
@@ -0,0 +1,5 @@
+#ifndef __OMAP_DSS_COMMON_H
+#define __OMAP_DSS_COMMON_H
+
+
+#endif
diff --git a/drivers/video/fbdev/omap2/dss/dss.h b/drivers/video/fbdev/omap2/dss/dss.h
index 898f26e..456d612 100644
--- a/drivers/video/fbdev/omap2/dss/dss.h
+++ b/drivers/video/fbdev/omap2/dss/dss.h
@@ -25,6 +25,8 @@
 
 #include <linux/interrupt.h>
 
+#include "dss-common.h"
+
 #ifdef pr_fmt
 #undef pr_fmt
 #endif
-- 
1.7.5.4

