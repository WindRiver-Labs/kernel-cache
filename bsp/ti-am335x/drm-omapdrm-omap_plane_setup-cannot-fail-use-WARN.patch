From dd2b36514efabafc638608e43994e05c7150ddcf Mon Sep 17 00:00:00 2001
From: Tomi Valkeinen <tomi.valkeinen@ti.com>
Date: Fri, 29 May 2015 11:03:15 +0300
Subject: [PATCH 088/800] drm: omapdrm: omap_plane_setup() cannot fail, use
 WARN

commit d9157dfd045f27f376edeab164203f1a68ba3ba4 upstream

With atomic modesetting, omap_plane_setup()'s return value is ignored as
the functions using it cannot fail. dispc_ovl_setup(), called by
omap_plane_setup(), can fail (but shouldn't).

Instead of returning an error from omap_plane_setup() which gets
ignored, return void and use WARN if dispc_ovl_setup() fails.

Signed-off-by: Tomi Valkeinen <tomi.valkeinen@ti.com>
Acked-by: Laurent Pinchart <laurent.pinchart@ideasonboard.com>
---
 drivers/gpu/drm/omapdrm/omap_plane.c |   13 ++++---------
 1 files changed, 4 insertions(+), 9 deletions(-)

diff --git a/drivers/gpu/drm/omapdrm/omap_plane.c b/drivers/gpu/drm/omapdrm/omap_plane.c
index 4487076..a8e617f 100644
--- a/drivers/gpu/drm/omapdrm/omap_plane.c
+++ b/drivers/gpu/drm/omapdrm/omap_plane.c
@@ -58,12 +58,11 @@ to_omap_plane_state(struct drm_plane_state *state)
 	return container_of(state, struct omap_plane_state, base);
 }
 
-static int omap_plane_setup(struct drm_plane *plane)
+static void omap_plane_setup(struct drm_plane *plane)
 {
 	struct omap_plane *omap_plane = to_omap_plane(plane);
 	struct drm_plane_state *state = plane->state;
 	struct omap_plane_state *omap_state = to_omap_plane_state(state);
-	struct drm_device *dev = plane->dev;
 	struct omap_overlay_info info;
 	struct omap_drm_window win;
 	int ret;
@@ -72,7 +71,7 @@ static int omap_plane_setup(struct drm_plane *plane)
 
 	if (!state->crtc) {
 		dispc_ovl_enable(omap_plane->id, false);
-		return 0;
+		return;
 	}
 
 	memset(&info, 0, sizeof(info));
@@ -123,14 +122,10 @@ static int omap_plane_setup(struct drm_plane *plane)
 	/* and finally, update omapdss: */
 	ret = dispc_ovl_setup(omap_plane->id, &info, false,
 			      omap_crtc_timings(state->crtc), false);
-	if (ret) {
-		dev_err(dev->dev, "dispc_ovl_setup failed: %d\n", ret);
-		return ret;
-	}
+	if (WARN_ON(ret))
+		return;
 
 	dispc_ovl_enable(omap_plane->id, true);
-
-	return 0;
 }
 
 static int omap_plane_prepare_fb(struct drm_plane *plane,
-- 
1.7.5.4

