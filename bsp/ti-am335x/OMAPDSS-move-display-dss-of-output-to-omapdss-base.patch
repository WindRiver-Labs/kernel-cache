From e111702fb84e6ed9fc7ede1c0d22782e09eb212f Mon Sep 17 00:00:00 2001
From: Tomi Valkeinen <tomi.valkeinen@ti.com>
Date: Thu, 5 Nov 2015 17:26:18 +0200
Subject: [PATCH 701/800] OMAPDSS: move display, dss-of, output to
 omapdss-base

This patchs moves the common parts of omapdss to omapdss-base so that
both the current omapdss driver and the new omapdss6 driver can use
them.

Signed-off-by: Tomi Valkeinen <tomi.valkeinen@ti.com>
Signed-off-by: Jyri Sarha <jsarha@ti.com>
[zou: Original patch taken from PROCESSOR-SDK-LINUX-AM335X 02_00_01_07]
Signed-off-by: zou cao <cao.zou@windriver.com>
---
 drivers/video/fbdev/omap2/dss/Makefile     |    6 +++---
 drivers/video/fbdev/omap2/dss/display.c    |    3 +--
 drivers/video/fbdev/omap2/dss/dss-common.h |    3 +++
 drivers/video/fbdev/omap2/dss/dss-of.c     |    4 +++-
 drivers/video/fbdev/omap2/dss/dss.h        |    4 ----
 drivers/video/fbdev/omap2/dss/output.c     |    2 +-
 6 files changed, 11 insertions(+), 11 deletions(-)

diff --git a/drivers/video/fbdev/omap2/dss/Makefile b/drivers/video/fbdev/omap2/dss/Makefile
index 1804292..9c30906 100644
--- a/drivers/video/fbdev/omap2/dss/Makefile
+++ b/drivers/video/fbdev/omap2/dss/Makefile
@@ -1,12 +1,12 @@
 obj-$(CONFIG_OMAP2_DSS_INIT) += omapdss-boot-init.o
 
 obj-$(CONFIG_OMAP_DSS_BASE) += omapdss-base.o
-omapdss-base-y := base.o
+omapdss-base-y := base.o display.o dss-of.o output.o
 
 obj-$(CONFIG_OMAP2_DSS) += omapdss.o
 # Core DSS files
-omapdss-y := core.o dss.o dss_features.o dispc.o dispc_coefs.o display.o \
-	output.o dss-of.o pll.o video-pll.o
+omapdss-y := core.o dss.o dss_features.o dispc.o dispc_coefs.o \
+	pll.o video-pll.o
 # DSS compat layer files
 omapdss-$(CONFIG_OMAP2_DSS_COMPAT_SUPPORT) += manager.o manager-sysfs.o \
 	overlay.o overlay-sysfs.o apply.o dispc-compat.o display-sysfs.o
diff --git a/drivers/video/fbdev/omap2/dss/display.c b/drivers/video/fbdev/omap2/dss/display.c
index 3efec188..fa90a29 100644
--- a/drivers/video/fbdev/omap2/dss/display.c
+++ b/drivers/video/fbdev/omap2/dss/display.c
@@ -29,8 +29,7 @@
 #include <linux/of.h>
 
 #include <video/omapdss.h>
-#include "dss.h"
-#include "dss_features.h"
+#include "dss-common.h"
 
 void omapdss_default_get_resolution(struct omap_dss_device *dssdev,
 			u16 *xres, u16 *yres)
diff --git a/drivers/video/fbdev/omap2/dss/dss-common.h b/drivers/video/fbdev/omap2/dss/dss-common.h
index 3e4a59a..c29aaa2 100644
--- a/drivers/video/fbdev/omap2/dss/dss-common.h
+++ b/drivers/video/fbdev/omap2/dss/dss-common.h
@@ -3,4 +3,7 @@
 
 void omapdss_set_is_initialized(bool set);
 
+struct device_node *dss_of_port_get_parent_device(struct device_node *port);
+u32 dss_of_port_get_port_number(struct device_node *port);
+
 #endif
diff --git a/drivers/video/fbdev/omap2/dss/dss-of.c b/drivers/video/fbdev/omap2/dss/dss-of.c
index 2480c51..8c6a848 100644
--- a/drivers/video/fbdev/omap2/dss/dss-of.c
+++ b/drivers/video/fbdev/omap2/dss/dss-of.c
@@ -20,7 +20,7 @@
 
 #include <video/omapdss.h>
 
-#include "dss.h"
+#include "dss-common.h"
 
 struct device_node *
 omapdss_of_get_next_port(const struct device_node *parent,
@@ -111,6 +111,7 @@ struct device_node *dss_of_port_get_parent_device(struct device_node *port)
 
 	return NULL;
 }
+EXPORT_SYMBOL_GPL(dss_of_port_get_parent_device);
 
 u32 dss_of_port_get_port_number(struct device_node *port)
 {
@@ -123,6 +124,7 @@ u32 dss_of_port_get_port_number(struct device_node *port)
 
 	return reg;
 }
+EXPORT_SYMBOL_GPL(dss_of_port_get_port_number);
 
 static struct device_node *omapdss_of_get_remote_port(const struct device_node *node)
 {
diff --git a/drivers/video/fbdev/omap2/dss/dss.h b/drivers/video/fbdev/omap2/dss/dss.h
index 3b52595..4684a3e 100644
--- a/drivers/video/fbdev/omap2/dss/dss.h
+++ b/drivers/video/fbdev/omap2/dss/dss.h
@@ -274,10 +274,6 @@ struct dss_pll *dss_video_pll_init(struct platform_device *pdev, int id,
 	struct regulator *regulator);
 void dss_video_pll_uninit(struct dss_pll *pll);
 
-/* dss-of */
-struct device_node *dss_of_port_get_parent_device(struct device_node *port);
-u32 dss_of_port_get_port_number(struct device_node *port);
-
 #if defined(CONFIG_OMAP2_DSS_DEBUGFS)
 void dss_debug_dump_clocks(struct seq_file *s);
 #endif
diff --git a/drivers/video/fbdev/omap2/dss/output.c b/drivers/video/fbdev/omap2/dss/output.c
index b40cc7b..4cde3cf 100644
--- a/drivers/video/fbdev/omap2/dss/output.c
+++ b/drivers/video/fbdev/omap2/dss/output.c
@@ -23,7 +23,7 @@
 
 #include <video/omapdss.h>
 
-#include "dss.h"
+#include "dss-common.h"
 
 static LIST_HEAD(output_list);
 static DEFINE_MUTEX(output_lock);
-- 
1.7.5.4

