From 5d31a64aad41fb844cd78e861b1b99501f5bc279 Mon Sep 17 00:00:00 2001
From: Zumeng Chen <zumeng.chen@windriver.com>
Date: Sat, 8 Mar 2014 13:55:59 +0800
Subject: [PATCH 184/188] arm: dts: am33xx: add wl12xx support for EVMSK board

Enable wl12xx by adding the related pin multiplexs in dts file.

Signed-off-by: Zumeng Chen <zumeng.chen@windriver.com>
---
 arch/arm/boot/dts/am335x-evmsk.dts |   47 ++++++++++++++++++++++++++++++++++++
 1 files changed, 47 insertions(+), 0 deletions(-)

diff --git a/arch/arm/boot/dts/am335x-evmsk.dts b/arch/arm/boot/dts/am335x-evmsk.dts
index 61b9477..b59fc5f 100644
--- a/arch/arm/boot/dts/am335x-evmsk.dts
+++ b/arch/arm/boot/dts/am335x-evmsk.dts
@@ -296,6 +296,26 @@
 			>;
 		};
 
+		/* wl12xx/wl18xx card on mmc2 */
+		mmc2_pins: pinmux_mmc2_pins {
+			pinctrl-single,pins = <
+                        0x0c 0x31 /* gpmc_ad3.mmc1_dat3 */
+                        0x08 0x31 /* gpmc_ad2.mmc1_dat2 */
+                        0x04 0x31 /* gpmc_ad1.mmc1_dat1 */
+                        0x00 0x31 /* gpmc_ad0.mmc1_dat0 */
+                        0x80 0x32 /* gpmc_csn1.mmc1_clk */
+                        0x84 0x32 /* gpmc_csn2.mmc1_cmd */
+			>;
+		};
+
+		/* wl12xx/wl18xx card enable/irq GPIOs. */
+		wlan_pins: pinmux_wlan_pins {
+			pinctrl-single,pins = <
+				0x75 0x07	/* casp0_ahclkx.gpio3_21, OUTPUT | MODE7 */
+				0x1f 0x2f	/* gpmc_wpn.gpio0_31", PIN_INPUT| MODE7 */
+				0x3d 0x17	/* mcasp0_ahclkr.gpio1_29, OUTPUT_PULLUP | MODE7 */
+			>;
+		};
 	};
 
 	ocp {
@@ -456,6 +476,17 @@
 		regulator-boot-on;
 	};
 
+	wlan_en_reg: fixedregulator@2 {
+		compatible = "regulator-fixed";
+		regulator-name = "wlan-en-regulator";
+		regulator-min-microvolt = <1800000>;
+		regulator-max-microvolt = <1800000>;
+		/* WLAN_EN GPIO for this board - Bank1, pin29 */
+		gpio = <&gpio1 29 0>;
+		startup-delay-us = <70000>;
+		enable-active-high;
+        };
+
 	leds {
 		pinctrl-names = "default", "sleep";
 		pinctrl-0 = <&user_leds_default>;
@@ -527,6 +558,12 @@
 		brightness-levels = <0 58 61 66 75 90 125 170 255>;
 		default-brightness-level = <8>;
 	};
+
+	wlcore {
+		compatible = "wlcore";
+		gpio = <175>; /* Bank0, pin31 */
+		board-ref-clock = <4>;
+	};
 };
 
 &wkup_m3 {
@@ -662,6 +699,16 @@
 	cd-gpios = <&gpio0 6 GPIO_ACTIVE_HIGH>;
 };
 
+&mmc2 {
+	status = "okay";
+	vmmc-supply = <&wlan_en_reg>;
+	bus-width = <4>;
+	ti,non-removable;
+	ti,needs-special-hs-handling;
+	cap-power-off-card;
+	keep-power-in-suspend;
+};
+
 &mcasp1 {
 		pinctrl-names = "default", "sleep";
 		pinctrl-0 = <&mcasp1_pins>;
-- 
1.7.5.4

