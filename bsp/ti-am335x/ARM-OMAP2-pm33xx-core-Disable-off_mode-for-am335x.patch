From 1d4816031fca9abc4aa3b6ccd0503c1281103c98 Mon Sep 17 00:00:00 2001
From: Dave Gerlach <d-gerlach@ti.com>
Date: Wed, 30 Sep 2015 15:49:47 -0500
Subject: [PATCH 574/800] ARM: OMAP2+: pm33xx-core: Disable off_mode for
 am335x

Currently using off mode is not supported on any TI am335x EVM platform
and using enable_off_mode under pm_debug will cause a suspend operation
to hang. Use the existing check_off_mode_enable functionality in
pm33xx-core to always return that off mode is disabled for am335x.

Signed-off-by: Dave Gerlach <d-gerlach@ti.com>
[zou: Original patch taken from PROCESSOR-SDK-LINUX-AM335X 02_00_01_07]
Signed-off-by: zou cao <cao.zou@windriver.com>
---
 arch/arm/mach-omap2/pm33xx-core.c |    8 +++++++-
 1 files changed, 7 insertions(+), 1 deletions(-)

diff --git a/arch/arm/mach-omap2/pm33xx-core.c b/arch/arm/mach-omap2/pm33xx-core.c
index 6ba7c85..fe1bb34 100644
--- a/arch/arm/mach-omap2/pm33xx-core.c
+++ b/arch/arm/mach-omap2/pm33xx-core.c
@@ -52,6 +52,12 @@ static int __init am43xx_map_scu(void)
 	return 0;
 }
 
+static int am33xx_check_off_mode_enable(void)
+{
+	/* off mode not supported on am335x so return 0 always */
+	return 0;
+}
+
 static int am43xx_check_off_mode_enable(void)
 {
 	return enable_off_mode;
@@ -260,7 +266,7 @@ static struct am33xx_pm_ops am33xx_ops = {
 	.restore_context = am33xx_restore_context,
 	.prepare_rtc_suspend = am43xx_prepare_rtc_suspend,
 	.prepare_rtc_resume = am43xx_prepare_rtc_resume,
-	.check_off_mode_enable = am43xx_check_off_mode_enable,
+	.check_off_mode_enable = am33xx_check_off_mode_enable,
 	.get_rtc_base_addr = am43xx_get_rtc_base_addr,
 };
 
-- 
1.7.5.4

