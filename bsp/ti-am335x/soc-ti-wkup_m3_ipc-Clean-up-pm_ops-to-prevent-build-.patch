From 655fb288021c0991fad583fab943ac443a02d9c7 Mon Sep 17 00:00:00 2001
From: Dave Gerlach <d-gerlach@ti.com>
Date: Thu, 5 Nov 2015 11:44:37 -0600
Subject: [PATCH 655/800] soc: ti: wkup_m3_ipc: Clean up pm_ops to prevent
 build warnings
MIME-Version: 1.0
Content-Type: text/plain; charset=UTF-8
Content-Transfer-Encoding: 8bit

Wrap wkup_m3_ipc_resume in CONFIG_PM_SLEEP instead of CONFIG_PM and move
the pm_ops struct outside of the ifdef to avoid the ifdef later in the
platform_driver definition. Otherwise we see this warning on build
with !CONFIG_SUSPEND:

drivers/soc/ti/wkup_m3_ipc.c:648:12: warning: ‘wkup_m3_ipc_resume’
defined but not used [-Wunused-function]
 static int wkup_m3_ipc_resume(struct device *dev)

Signed-off-by: Dave Gerlach <d-gerlach@ti.com>
[zou: Original patch taken from PROCESSOR-SDK-LINUX-AM335X 02_00_01_07]
Signed-off-by: zou cao <cao.zou@windriver.com>
---
 drivers/soc/ti/wkup_m3_ipc.c |    6 ++----
 1 files changed, 2 insertions(+), 4 deletions(-)

diff --git a/drivers/soc/ti/wkup_m3_ipc.c b/drivers/soc/ti/wkup_m3_ipc.c
index 2588036..bf26a21 100644
--- a/drivers/soc/ti/wkup_m3_ipc.c
+++ b/drivers/soc/ti/wkup_m3_ipc.c
@@ -644,7 +644,7 @@ static int wkup_m3_ipc_remove(struct platform_device *pdev)
 	return 0;
 }
 
-#ifdef CONFIG_PM
+#ifdef CONFIG_PM_SLEEP
 static int wkup_m3_ipc_resume(struct device *dev)
 {
 	if (m3_ipc_state.is_rtc_only) {
@@ -656,11 +656,11 @@ static int wkup_m3_ipc_resume(struct device *dev)
 
 	return 0;
 }
+#endif /* CONFIG_PM_SLEEP */
 
 static const struct dev_pm_ops wkup_m3_ipc_pm_ops = {
 	SET_SYSTEM_SLEEP_PM_OPS(NULL, wkup_m3_ipc_resume)
 };
-#endif
 
 static const struct of_device_id wkup_m3_ipc_of_match[] = {
 	{ .compatible = "ti,am3352-wkup-m3-ipc", },
@@ -674,9 +674,7 @@ static struct platform_driver wkup_m3_ipc_driver = {
 	.driver = {
 		.name = "wkup_m3_ipc",
 		.of_match_table = wkup_m3_ipc_of_match,
-#ifdef CONFIG_PM
 		.pm = &wkup_m3_ipc_pm_ops,
-#endif
 	},
 };
 
-- 
1.7.5.4

