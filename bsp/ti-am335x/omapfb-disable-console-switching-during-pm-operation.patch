From 176c0b96c473fdada5dc65dda9691e587d7c3ec4 Mon Sep 17 00:00:00 2001
From: Darren Etheridge <detheridge@ti.com>
Date: Wed, 6 Nov 2013 15:53:12 -0600
Subject: [PATCH 120/800] omapfb: disable console switching during pm
 operations

The default behavior of consoles during power management operations is:
On entry to suspend a new console is allocated and switched to. On
resume the original console is restored.

However this isn't the observed behavior and the original console is not
restored. This commit avoids the problem by disabling the switching of
consoles at suspend/resume. This works because the driver already
restores all necessary hardware context during such pm operations.

Signed-off-by: Darren Etheridge <detheridge@ti.com>
[zou: Original patch taken from PROCESSOR-SDK-LINUX-AM335X 02_00_01_07]
Signed-off-by: zou cao <cao.zou@windriver.com>
---
 drivers/video/fbdev/omap2/omapfb/omapfb-main.c |    9 +++++++++
 1 files changed, 9 insertions(+), 0 deletions(-)

diff --git a/drivers/video/fbdev/omap2/omapfb/omapfb-main.c b/drivers/video/fbdev/omap2/omapfb/omapfb-main.c
index 4f0cbb5..f03ec55 100644
--- a/drivers/video/fbdev/omap2/omapfb/omapfb-main.c
+++ b/drivers/video/fbdev/omap2/omapfb/omapfb-main.c
@@ -29,6 +29,7 @@
 #include <linux/device.h>
 #include <linux/platform_device.h>
 #include <linux/omapfb.h>
+#include <linux/suspend.h>
 
 #include <video/omapdss.h>
 #include <video/omapvrfb.h>
@@ -2608,6 +2609,14 @@ static int omapfb_probe(struct platform_device *pdev)
 			def_display->name, w, h);
 	}
 
+	/*
+	 * disable creation of new console during suspend.
+	 * this works around a problem where a ctrl-c is needed
+	 * to be entered on the VT to actually get the device
+	 * to continue into the suspend state.
+	 */
+	pm_set_vt_switch(0);
+
 	return 0;
 
 cleanup:
-- 
1.7.5.4

