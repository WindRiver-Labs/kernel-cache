From c33c588b7d834f30ce34d17fe1ce94586e1e2976 Mon Sep 17 00:00:00 2001
From: Zumeng Chen <zumeng.chen@windriver.com>
Date: Fri, 28 Feb 2014 11:25:52 +0800
Subject: [PATCH 141/188] ARM: AM437x: hwmod: add vpfe[0,1] hwmod entries

This commit comes from branch ti-linux-3.12.y:

  git://git.ti.com/ti-linux-kernel/ti-linux-kernel.git

HWMOD entries support for TI Dual Video Processing Front End (VPFE)
(aka Dual cam) of AM43xx platform

Signed-off-by: Benoit Parrot <bparrot@ti.com>
(cherry picked from commit e8efd25540a58153138fb11d1e4a2bb09b374874)
---
 arch/arm/mach-omap2/omap_hwmod_33xx_data.c |   56 ++++++++++++++++++++++++++++
 arch/arm/mach-omap2/prcm43xx.h             |    2 +
 2 files changed, 58 insertions(+), 0 deletions(-)

diff --git a/arch/arm/mach-omap2/omap_hwmod_33xx_data.c b/arch/arm/mach-omap2/omap_hwmod_33xx_data.c
index 4acc43c..3bd9d4e 100644
--- a/arch/arm/mach-omap2/omap_hwmod_33xx_data.c
+++ b/arch/arm/mach-omap2/omap_hwmod_33xx_data.c
@@ -2983,6 +2983,60 @@ static struct omap_hwmod_ocp_if am43xx_l4_ls__dss_rfbi = {
 	.user		= OCP_USER_MPU | OCP_USER_SDMA,
 };
 
+static struct omap_hwmod_class_sysconfig am43xx_vpfe_sysc = {
+	.rev_offs	= 0x0,
+	.sysc_offs	= 0x104,
+	.sysc_flags	= SYSC_HAS_MIDLEMODE | SYSC_HAS_SIDLEMODE,
+	.idlemodes	= (SIDLE_FORCE | SIDLE_NO | SIDLE_SMART |
+			  MSTANDBY_FORCE | MSTANDBY_SMART | MSTANDBY_NO),
+	.sysc_fields	= &omap_hwmod_sysc_type2,
+};
+
+static struct omap_hwmod_class am43xx_vpfe_hwmod_class = {
+	.name		= "vpfe",
+	.sysc		= &am43xx_vpfe_sysc,
+};
+
+static struct omap_hwmod am43xx_vpfe0_hwmod = {
+	.name		= "vpfe0",
+	.class		= &am43xx_vpfe_hwmod_class,
+	.clkdm_name	= "l3s_clkdm",
+	.prcm		= {
+		.omap4	= {
+			.modulemode	= MODULEMODE_SWCTRL,
+			.clkctrl_offs	= AM43XX_CM_PER_VPFE0_CLKCTRL_OFFSET,
+		},
+	},
+};
+
+static struct omap_hwmod_ocp_if am43xx_l3__vpfe0 = {
+	.master		= &am33xx_l3_main_hwmod,
+	.slave		= &am43xx_vpfe0_hwmod,
+	.clk		= "vpfe0_fck",
+	.flags		= OCPIF_SWSUP_IDLE,
+	.user		= OCP_USER_MPU,
+};
+
+static struct omap_hwmod am43xx_vpfe1_hwmod = {
+	.name		= "vpfe1",
+	.class		= &am43xx_vpfe_hwmod_class,
+	.clkdm_name	= "l3s_clkdm",
+	.prcm		= {
+		.omap4	= {
+			.modulemode	= MODULEMODE_SWCTRL,
+			.clkctrl_offs	= AM43XX_CM_PER_VPFE1_CLKCTRL_OFFSET,
+		},
+	},
+};
+
+static struct omap_hwmod_ocp_if am43xx_l3__vpfe1 = {
+	.master		= &am33xx_l3_main_hwmod,
+	.slave		= &am43xx_vpfe1_hwmod,
+	.clk		= "vpfe1_fck",
+	.flags		= OCPIF_SWSUP_IDLE,
+	.user		= OCP_USER_MPU,
+};
+
 #define CLKCTRL(oh, clkctrl) ((oh).prcm.omap4.clkctrl_offs = (clkctrl))
 
 static void am43xx_hwmod_clkctrl(void)
@@ -3220,6 +3274,8 @@ static struct omap_hwmod_ocp_if *am43xx_hwmod_ocp_ifs[] __initdata = {
 	&am43xx_l4_ls__dss,
 	&am43xx_l4_ls__dss_dispc,
 	&am43xx_l4_ls__dss_rfbi,
+	&am43xx_l3__vpfe0,
+	&am43xx_l3__vpfe1,
 	NULL,
 };
 
diff --git a/arch/arm/mach-omap2/prcm43xx.h b/arch/arm/mach-omap2/prcm43xx.h
index 8a081fe..942a64d 100644
--- a/arch/arm/mach-omap2/prcm43xx.h
+++ b/arch/arm/mach-omap2/prcm43xx.h
@@ -144,6 +144,8 @@
 #define AM43XX_CM_PER_SPI4_CLKCTRL_OFFSET		0x0520
 #define AM43XX_CM_PER_GPIO4_CLKCTRL_OFFSET		0x0490
 #define AM43XX_CM_PER_GPIO5_CLKCTRL_OFFSET		0x0498
+#define AM43XX_CM_PER_VPFE0_CLKCTRL_OFFSET		0x0068
+#define AM43XX_CM_PER_VPFE1_CLKCTRL_OFFSET		0x0070
 #define AM43XX_CM_PER_DSS_CLKCTRL_OFFSET		0x0a20
 
 #endif
-- 
1.7.5.4

