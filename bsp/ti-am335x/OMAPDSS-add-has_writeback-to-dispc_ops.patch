From 385e060b5efdd041c59568cfa5132f3477082193 Mon Sep 17 00:00:00 2001
From: Tomi Valkeinen <tomi.valkeinen@ti.com>
Date: Wed, 11 Nov 2015 14:28:02 -0600
Subject: [PATCH 710/800] OMAPDSS: add has_writeback() to dispc_ops

Add has_writeback() to dispc_ops so that omapdrm knows if the DSS HW has
writeback functionality.

Signed-off-by: Tomi Valkeinen <tomi.valkeinen@ti.com>
Signed-off-by: Jyri Sarha <jsarha@ti.com>
[zou: Original patch taken from PROCESSOR-SDK-LINUX-AM335X 02_00_01_07]
Signed-off-by: zou cao <cao.zou@windriver.com>
---
 drivers/video/fbdev/omap2/dss/dispc.c |    6 ++++++
 include/video/omapdss.h               |    1 +
 2 files changed, 7 insertions(+), 0 deletions(-)

diff --git a/drivers/video/fbdev/omap2/dss/dispc.c b/drivers/video/fbdev/omap2/dss/dispc.c
index 8978ba9..bed107b 100644
--- a/drivers/video/fbdev/omap2/dss/dispc.c
+++ b/drivers/video/fbdev/omap2/dss/dispc.c
@@ -2882,6 +2882,11 @@ static int dispc_wb_setup(const struct omap_dss_writeback_info *wi,
 	return r;
 }
 
+static bool dispc_has_writeback(void)
+{
+	return dispc.feat->has_writeback;
+}
+
 int dispc_ovl_enable(enum omap_plane plane, bool enable)
 {
 	DSSDBG("dispc_enable_plane %d, %d\n", plane, enable);
@@ -4089,6 +4094,7 @@ static const struct dispc_ops dispc_ops = {
 	.wb_get_framedone_irq = dispc_wb_get_framedone_irq,
 	.wb_set_channel_in = dispc_wb_set_channel_in,
 	.wb_setup = dispc_wb_setup,
+	.has_writeback = dispc_has_writeback,
 };
 
 /* DISPC HW IP initialisation */
diff --git a/include/video/omapdss.h b/include/video/omapdss.h
index 6ce4f5b..f6858fe 100644
--- a/include/video/omapdss.h
+++ b/include/video/omapdss.h
@@ -1021,6 +1021,7 @@ struct dispc_ops {
 	void (*wb_set_channel_in)(enum dss_writeback_channel channel);
 	int (*wb_setup)(const struct omap_dss_writeback_info *wi,
 		bool mem_to_mem, const struct omap_video_timings *mgr_timings);
+	bool (*has_writeback)(void);
 };
 
 const struct dispc_ops *dispc_get_ops(void);
-- 
1.7.5.4

