From 028a20448d7bdf1d0a5ee61f5e8f7f6d1de0c482 Mon Sep 17 00:00:00 2001
From: Dave Gerlach <d-gerlach@ti.com>
Date: Wed, 8 Jan 2014 16:23:46 -0600
Subject: [PATCH 149/285] ARM: dts: AM4372: Add efuse device entry for OPP and
 add higher OPPs

Add an entry for device_attribute which configures OPPs on 43xx. Within
this, nodes are defined with the opp-modifier propety that are defined as
a list of frequency, revision, offset from base register, and efuse value.
The CPU node passes a phandle to the appropriate child node to get the
correct table.

This patch also adds higher eFused OPPs for AM4372.

Signed-off-by: Dave Gerlach <d-gerlach@ti.com>
[Kevin: The original patch taken from TI
ti-sdk-am437x-evm-07.01.00.00-Linux-x86-Install.bin]
Signed-off-by: Kevin Hao <kexin.hao@windriver.com>
---
 arch/arm/boot/dts/am4372.dtsi |   25 +++++++++++++++++++++++++
 1 files changed, 25 insertions(+), 0 deletions(-)

diff --git a/arch/arm/boot/dts/am4372.dtsi b/arch/arm/boot/dts/am4372.dtsi
index 68f749a..6f2151f 100644
--- a/arch/arm/boot/dts/am4372.dtsi
+++ b/arch/arm/boot/dts/am4372.dtsi
@@ -10,6 +10,7 @@
 
 #include <dt-bindings/gpio/gpio.h>
 #include <dt-bindings/interrupt-controller/arm-gic.h>
+#include <dt-bindings/opp/am33xx.h>
 
 #include "skeleton.dtsi"
 
@@ -42,8 +43,12 @@
 				300000	950000
 				600000	1100000
 				720000	1200000
+				800000	1260000
+				1000000 1325000
 			>;
 
+			platform-opp-modifier = <&mpu_opp_modifier>;
+
 			clocks = <&dpll_mpu_ck>;
 			clock-names = "cpu";
 
@@ -1065,6 +1070,26 @@
 			clocks = <&mcasp1_fck>;
 			clock-names = "fck";
 		};
+
+		dev_attribute: efuse@0x44e10610 {
+			compatible = "ti,opp-omap-am4372";
+			reg = <0x44e10610 0x04		/* EFUSE_SMA */
+			       0x44e10600 0x04>;	/* DEVICE_ID */
+
+			ti,efuse-bit-enable-low;
+
+			mpu_opp_modifier: mpu_opp_modifier {
+				opp-modifier = <
+				/* kHz	 Rev		offset	mask */
+				1000000	 OPP_REV(1,0)	0	AM43XX_EFUSE_SMA_OPP_NITRO_1GHZ_BIT
+				800000	 OPP_REV(1,0)	0	AM43XX_EFUSE_SMA_OPP_TURBO_800MHZ_BIT
+				720000	 OPP_REV(1,0)	0	AM43XX_EFUSE_SMA_OPP_120_720MHZ_BIT
+				600000	 OPP_REV(1,0)	0	AM43XX_EFUSE_SMA_OPP_100_600MHZ_BIT
+				300000	 OPP_REV(1,0)	0	AM43XX_EFUSE_SMA_OPP_50_300MHZ_BIT
+				>;
+			};
+		};
+
 	};
 
 	clocks {
-- 
1.7.5.4

