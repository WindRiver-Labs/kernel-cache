From cc05125bf0f134b0753cf50278e64a4ecac0b146 Mon Sep 17 00:00:00 2001
From: Sekhar Nori <nsekhar@ti.com>
Date: Sun, 24 Nov 2013 20:43:07 +0530
Subject: [PATCH 170/285] clk: ti: am437x: enable clkout2 by default

Add clk node for clkout2 and enable it by
default. clkout2 provides clock to onboard
peripherals like WLAN. This clock needs to
be enabled for WLAN to be probed. Enabling
clkout2 by default and leaving it enabled
does not affect entry into DeepSleep state
since it comes from power domain which is
expected to remain on during low power modes
(RTC domain and the PRCM itself).

This is similar to what is done on AM335x.

Signed-off-by: Sekhar Nori <nsekhar@ti.com>
[Kevin: The original patch taken from TI
ti-sdk-am437x-evm-07.01.00.00-Linux-x86-Install.bin]
Signed-off-by: Kevin Hao <kexin.hao@windriver.com>
---
 drivers/clk/ti/clk-43xx.c |    9 +++++++++
 1 files changed, 9 insertions(+), 0 deletions(-)

diff --git a/drivers/clk/ti/clk-43xx.c b/drivers/clk/ti/clk-43xx.c
index de68508..213f0bc 100644
--- a/drivers/clk/ti/clk-43xx.c
+++ b/drivers/clk/ti/clk-43xx.c
@@ -109,9 +109,15 @@ static struct omap_dt_clk am43xx_clks[] = {
 	DT_CLK(NULL, "usbphy_32khz_clkmux", "usbphy_32khz_clkmux"),
 	DT_CLK(NULL, "vpfe0_fck", "vpfe0_fck"),
 	DT_CLK(NULL, "vpfe1_fck", "vpfe1_fck"),
+	DT_CLK(NULL, "clkout2_ck", "clkout2_ck"),
 	{ .node_name = NULL },
 };
 
+static const char *enable_init_clks[] = {
+	/* Required for external peripherals like WL8 etc */
+	"clkout2_ck",
+};
+
 int __init am43xx_clk_init(void)
 {
 	struct clk *clk1, *clk2;
@@ -122,6 +128,9 @@ int __init am43xx_clk_init(void)
 
 	omap2_clk_disable_autoidle_all();
 
+	omap2_clk_enable_init_clocks(enable_init_clks,
+				     ARRAY_SIZE(enable_init_clks));
+
 	/*
 	 * The external 32KHz RTC clock source may not always be available
 	 * on board like in the case of ePOS EVM. By default sync timer, which
-- 
1.7.5.4

