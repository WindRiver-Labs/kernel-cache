From 263c569bbddf689f6ff43bae719d76ab4b6c9a2c Mon Sep 17 00:00:00 2001
From: Afzal Mohammed <afzal@ti.com>
Date: Wed, 30 Oct 2013 21:03:37 +0530
Subject: [PATCH 093/285] ARM: head.S: avoid ldm access crossing 1K page
 boundary

Due to a bug in an early internal version of AM43x engineering sample,
there is an issue with ldm access crossing 1K page in uncached memory.
This patch avoids it with a very negligible performance penalty.

The engineering sample having this issue is TI-internal, this patch is
used to enable internal development. The production version of AM43x
does not have this bug and this patch can be reverted at that time.

Signed-off-by: Afzal Mohammed <afzal@ti.com>
[Kevin: The original patch taken from TI
ti-sdk-am437x-evm-07.01.00.00-Linux-x86-Install.bin]
Signed-off-by: Kevin Hao <kexin.hao@windriver.com>
---
 arch/arm/kernel/head.S |    3 ++-
 1 files changed, 2 insertions(+), 1 deletions(-)

diff --git a/arch/arm/kernel/head.S b/arch/arm/kernel/head.S
index 7bdda34..103c017 100644
--- a/arch/arm/kernel/head.S
+++ b/arch/arm/kernel/head.S
@@ -531,7 +531,8 @@ smp_on_up:
 __do_fixup_smp_on_up:
 	cmp	r4, r5
 	movhs	pc, lr
-	ldmia	r4!, {r0, r6}
+	ldmia	r4!, {r0}
+	ldmia	r4!, {r6}
  ARM(	str	r6, [r0, r3]	)
  THUMB(	add	r0, r0, r3	)
 #ifdef __ARMEB__
-- 
1.7.5.4

