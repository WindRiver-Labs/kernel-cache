From 95483478d756029008e92d5bc1c9fd2d52b17107 Mon Sep 17 00:00:00 2001
From: Tomi Valkeinen <tomi.valkeinen@ti.com>
Date: Wed, 22 Jan 2014 12:38:36 +0200
Subject: [PATCH 183/285] OMAPDSS: SiI9022: disable D3 power state

The current driver sets the SiI9022 to D3 power state when disabling the
chip on module remove. To exit D3, the reset gpio must be used.
Unfortunately we don't have control for the reset GPIO.

To make the driver more usable as modules, comment the code out that
sets the chip to D3.

Signed-off-by: Tomi Valkeinen <tomi.valkeinen@ti.com>
Signed-off-by: Darren Etheridge <detheridge@ti.com>
[Kevin: The original patch taken from TI
ti-sdk-am437x-evm-07.01.00.00-Linux-x86-Install.bin]
Signed-off-by: Kevin Hao <kexin.hao@windriver.com>
---
 drivers/video/omap2/displays-new/encoder-sil9022.c |    4 +++-
 1 files changed, 3 insertions(+), 1 deletions(-)

diff --git a/drivers/video/omap2/displays-new/encoder-sil9022.c b/drivers/video/omap2/displays-new/encoder-sil9022.c
index a0f08a2..8d9b7f7 100644
--- a/drivers/video/omap2/displays-new/encoder-sil9022.c
+++ b/drivers/video/omap2/displays-new/encoder-sil9022.c
@@ -436,7 +436,6 @@ static void sil9022_disconnect(struct omap_dss_device *dssdev,
 {
 	struct panel_drv_data *ddata = to_panel_data(dssdev);
 	struct omap_dss_device *in = ddata->in;
-	int err;
 
 	WARN_ON(!omapdss_device_is_connected(dssdev));
 	if (!omapdss_device_is_connected(dssdev))
@@ -446,11 +445,14 @@ static void sil9022_disconnect(struct omap_dss_device *dssdev,
 	if (dst != dssdev->dst)
 		return;
 
+	/* XXX we don't control the RESET pin, so we can't wake up from D3 */
+#if 0
 	/* Move from ENABLED -> LOW Power state */
 	err = sil9022_write_reg(dssdev, HDMI_TPI_POWER_STATE_CTRL_REG,
 			TPI_AVI_POWER_STATE_D3);
 	if (err < 0)
 		dev_err(dssdev->dev, "ERROR: Setting device power state to D3\n");
+#endif
 
 	dst->src = NULL;
 	dssdev->dst = NULL;
-- 
1.7.5.4

