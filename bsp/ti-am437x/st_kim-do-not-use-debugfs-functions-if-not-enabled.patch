From 4493742cb87389798dcbb2293b44f20cc880bbb8 Mon Sep 17 00:00:00 2001
From: Eyal Reizer <eyalr@ti.com>
Date: Wed, 29 Jan 2014 09:24:06 +0200
Subject: [PATCH 135/188] st_kim: do not use debugfs functions if not enabled

This commit comes from branch ti-linux-3.12.y:
  git://git.ti.com/ti-linux-kernel/ti-linux-kernel.git

the probe function was using debugfs apis without checking if
CONFIG_DEBUG_FS was enabled resulting with runtime errors.
Fix this so these apis will only be used if the switch is active.

Signed-off-by: Eyal Reizer <eyalr@ti.com>
(cherry picked from commit e4f5ee7a1783d4a4acbd886a6be931c4ccf53999)
---
 drivers/misc/ti-st/st_kim.c |    2 ++
 1 files changed, 2 insertions(+), 0 deletions(-)

diff --git a/drivers/misc/ti-st/st_kim.c b/drivers/misc/ti-st/st_kim.c
index 479b483..e3900bf 100644
--- a/drivers/misc/ti-st/st_kim.c
+++ b/drivers/misc/ti-st/st_kim.c
@@ -833,6 +833,7 @@ static int kim_probe(struct platform_device *pdev)
 	kim_gdata->baud_rate = pdata->baud_rate;
 	pr_info("sysfs entries created\n");
 
+#ifdef CONFIG_DEBUG_FS
 	kim_debugfs_dir = debugfs_create_dir("ti-st", NULL);
 	if (IS_ERR(kim_debugfs_dir)) {
 		pr_err(" debugfs entries creation failed ");
@@ -849,6 +850,7 @@ static int kim_probe(struct platform_device *pdev)
 
 err_debugfs_dir:
 	sysfs_remove_group(&pdev->dev.kobj, &uim_attr_grp);
+#endif
 
 err_sysfs_group:
 	st_core_exit(kim_gdata->core_data);
-- 
1.7.5.4

