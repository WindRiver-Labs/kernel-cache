From 2eb0e3b81e5f29d2137b5dfee22185a3c8e48efa Mon Sep 17 00:00:00 2001
From: Rajendra Nayak <rnayak@ti.com>
Date: Thu, 14 Nov 2013 18:29:57 +0530
Subject: [PATCH 242/285] bus: omap_l3_noc: Add support for discountinous flag
 mux input numbers

On DRA7, unlike on OMAP4 and OMAP5, the flag mux input numbers used to indicate
the source of errors are not continous. Have a way in the driver to catch these
and WARN the user of the flag mux input thats either undocumented or wrong.

Signed-off-by: Rajendra Nayak <rnayak@ti.com>
[Kevin: The original patch taken from TI
ti-sdk-am437x-evm-07.01.00.00-Linux-x86-Install.bin]
Signed-off-by: Kevin Hao <kexin.hao@windriver.com>
---
 drivers/bus/omap_l3_noc.c |    6 ++++++
 1 files changed, 6 insertions(+), 0 deletions(-)

diff --git a/drivers/bus/omap_l3_noc.c b/drivers/bus/omap_l3_noc.c
index feeecae..ad43775 100644
--- a/drivers/bus/omap_l3_noc.c
+++ b/drivers/bus/omap_l3_noc.c
@@ -80,6 +80,12 @@ static irqreturn_t l3_interrupt_handler(int irq, void *_l3)
 			/* Identify the source from control status register */
 			err_src = __ffs(err_reg);
 
+			if (*(l3->l3_targets[i] + err_src) == 0xdeadbeef) {
+				WARN(true, "L3 error for UN IDENTIFIED TARGET: %d\n",
+				     err_src);
+				break;
+			}
+
 			/* Read the stderrlog_main_source from clk domain */
 			l3_targ_base = base + *(l3_targ[i] + err_src);
 			std_err_main =  __raw_readl(l3_targ_base +
-- 
1.7.5.4

