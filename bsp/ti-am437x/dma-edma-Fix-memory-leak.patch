From dc837d23bcf1ece56288c39a9c903de7648af03e Mon Sep 17 00:00:00 2001
From: Valentin Ilie <valentin.ilie@gmail.com>
Date: Thu, 24 Oct 2013 16:14:22 +0300
Subject: [PATCH 070/188] dma: edma: Fix memory leak

When it fails to allocate a slot, edesc should be free'd before return;

Signed-off-by: Valentin Ilie <valentin.ilie@gmail.com>
Signed-off-by: Vinod Koul <vinod.koul@intel.com>
(cherry picked from commit 4b6271a64463f4fcbaf8b2e1d84704b7eb8c407c)
---
 drivers/dma/edma.c |    1 +
 1 files changed, 1 insertions(+), 0 deletions(-)

diff --git a/drivers/dma/edma.c b/drivers/dma/edma.c
index ddcb69b..d3fee9c 100644
--- a/drivers/dma/edma.c
+++ b/drivers/dma/edma.c
@@ -420,6 +420,7 @@ static struct dma_async_tx_descriptor *edma_prep_slave_sg(
 				edma_alloc_slot(EDMA_CTLR(echan->ch_num),
 						EDMA_SLOT_ANY);
 			if (echan->slot[i] < 0) {
+				kfree(edesc);
 				dev_err(dev, "Failed to allocate slot\n");
 				kfree(edesc);
 				return NULL;
-- 
1.7.5.4

