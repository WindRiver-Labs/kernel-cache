From d96a98f4aaaec9dd64e16646089935c965eb9f3d Mon Sep 17 00:00:00 2001
From: Lokesh Vutla <lokeshvutla@ti.com>
Date: Thu, 19 Sep 2013 17:00:48 +0530
Subject: [PATCH 016/285] rtc: omap: Select clk source source for RTC

CLK source needs to be selected as part of the initialization sequence.
So selecting external 32kHz clk as the source. And also enabling
wakeup interrupts. This is as per the initialization sequence given in
TRM.

Signed-off-by: Lokesh Vutla <lokeshvutla@ti.com>
[Kevin: The original patch taken from TI
ti-sdk-am437x-evm-07.01.00.00-Linux-x86-Install.bin]
Signed-off-by: Kevin Hao <kexin.hao@windriver.com>
---
 drivers/rtc/rtc-omap.c |    4 ++++
 1 files changed, 4 insertions(+), 0 deletions(-)

diff --git a/drivers/rtc/rtc-omap.c b/drivers/rtc/rtc-omap.c
index 00b5590..ffe25127 100644
--- a/drivers/rtc/rtc-omap.c
+++ b/drivers/rtc/rtc-omap.c
@@ -395,6 +395,10 @@ static int __init omap_rtc_probe(struct platform_device *pdev)
 	 */
 	rtc_write(0, OMAP_RTC_INTERRUPTS_REG);
 
+	/* Selecting CLK cource for RTC */
+	rtc_writel((1 << 3) | (1 << 6), OMAP_RTC_OSC_REG);
+	rtc_writel(0x3, OMAP_RTC_IRQWAKEEN);
+
 	/* clear old status */
 	reg = rtc_read(OMAP_RTC_STATUS_REG);
 	if (reg & (u8) OMAP_RTC_STATUS_POWER_UP) {
-- 
1.7.5.4

