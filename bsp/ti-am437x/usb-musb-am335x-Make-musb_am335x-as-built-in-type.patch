From 970cf59f8c46369cd67fc1d6bbf27439d4762488 Mon Sep 17 00:00:00 2001
From: Roger Quadros <rogerq@ti.com>
Date: Fri, 13 Dec 2013 17:45:23 +0530
Subject: [PATCH 032/188] usb: musb: am335x: Make musb_am335x as built-in type

This commit comes from branch ti-linux-3.12.y:

git://git.ti.com/ti-linux-kernel/ti-linux-kernel.git

When the PHY device is deleted during rmmod musb_am335x,
all its managed resources are deleted in __device_release_driver()
after the driver's .remove() hook is called.

This means the usb_phy device structure will no longer be valid and
the usb_phy->ops cannot be called.

We avoid this situation by making the musb_am335x driver as
built-in, so that the PHY device can never be deleted.

A more proper fix would be to use a more reliable PHY framework
that takes care of such cases.

Fixes: D-01175: AM335x - rmmod musb_am335x causes crash

Signed-off-by: Roger Quadros <rogerq@ti.com>
(cherry picked from commit dbf82283e1801c10fbeabcdf602f2a84fcb2a4e3)
---
 drivers/usb/musb/Kconfig |    2 +-
 1 files changed, 1 insertions(+), 1 deletions(-)

diff --git a/drivers/usb/musb/Kconfig b/drivers/usb/musb/Kconfig
index f6a4c97..2a3f92c 100644
--- a/drivers/usb/musb/Kconfig
+++ b/drivers/usb/musb/Kconfig
@@ -97,7 +97,7 @@ config USB_MUSB_UX500
 endchoice
 
 config USB_MUSB_AM335X_CHILD
-	tristate
+	bool
 
 choice
 	prompt 'MUSB DMA mode'
-- 
1.7.5.4

