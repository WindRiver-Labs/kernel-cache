From a7f7b00e866961a559ff15b1f69c8982809a6a80 Mon Sep 17 00:00:00 2001
From: Balaji T K <balajitk@ti.com>
Date: Wed, 29 Jan 2014 21:22:23 +0530
Subject: [PATCH 176/285] mmc: omap_hsmmc: add eMMC DDR dt support

add support for enabling Dual data rate mode for Device tree boot.

Signed-off-by: Balaji T K <balajitk@ti.com>
[Kevin: The original patch taken from TI
ti-sdk-am437x-evm-07.01.00.00-Linux-x86-Install.bin]
Signed-off-by: Kevin Hao <kexin.hao@windriver.com>
---
 .../devicetree/bindings/mmc/ti-omap-hsmmc.txt      |    2 ++
 drivers/mmc/host/omap_hsmmc.c                      |    3 +++
 2 files changed, 5 insertions(+), 0 deletions(-)

diff --git a/Documentation/devicetree/bindings/mmc/ti-omap-hsmmc.txt b/Documentation/devicetree/bindings/mmc/ti-omap-hsmmc.txt
index 8c8908a..d4e3ce3 100644
--- a/Documentation/devicetree/bindings/mmc/ti-omap-hsmmc.txt
+++ b/Documentation/devicetree/bindings/mmc/ti-omap-hsmmc.txt
@@ -26,6 +26,8 @@ specifier is required.
 dma-names: List of DMA request names. These strings correspond
 1:1 with the DMA specifiers listed in dmas. The string naming is
 to be "rx" and "tx" for RX and TX DMA requests, respectively.
+cap-mmc-dual-data-rate: MMC High Speed Dual Data Rate mode supported at
+ 1.8V/3V signaling
 
 Examples:
 
diff --git a/drivers/mmc/host/omap_hsmmc.c b/drivers/mmc/host/omap_hsmmc.c
index 0afbb79..1cdda0f 100644
--- a/drivers/mmc/host/omap_hsmmc.c
+++ b/drivers/mmc/host/omap_hsmmc.c
@@ -2073,6 +2073,9 @@ static struct omap_mmc_platform_data *of_get_hsmmc_pdata(struct device *dev)
 	if (of_find_property(np, "cap-power-off-card", NULL))
 		pdata->slots[0].caps |= MMC_CAP_POWER_OFF_CARD;
 
+	if (of_find_property(np, "cap-mmc-dual-data-rate", NULL))
+		pdata->slots[0].caps |= MMC_CAP_1_8V_DDR;
+
 	if (of_find_property(np, "keep-power-in-suspend", NULL))
 		pdata->slots[0].pm_caps |= MMC_PM_KEEP_POWER;
 
-- 
1.7.5.4

