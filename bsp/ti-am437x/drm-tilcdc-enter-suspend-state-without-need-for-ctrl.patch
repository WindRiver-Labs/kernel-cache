From d6382639b2ec1f1a9c81d6663f6ddda90dc22a72 Mon Sep 17 00:00:00 2001
From: Darren Etheridge <detheridge@ti.com>
Date: Wed, 5 Feb 2014 11:36:11 -0600
Subject: [PATCH 19/71] drm/tilcdc: enter suspend state without need for
 ctrl-c on console

This commit comes from branch ti-linux-3.12.y:
  git://git.ti.com/ti-linux-kernel/ti-linux-kernel.git

A call to pm_set_vt_switch() is added to driver initialization to
allow the device to go into suspend without the need for VT interaction
(entering ctrl-c on the console).

Signed-off-by: Darren Etheridge <detheridge@ti.com>
(cherry picked from commit 20af044e0c498d1fa429d434348a9bec7536425b)
Signed-off-by: Zumeng Chen <zumeng.chen@windriver.com>
---
 drivers/gpu/drm/tilcdc/tilcdc_drv.c |    9 +++++++++
 1 files changed, 9 insertions(+), 0 deletions(-)

diff --git a/drivers/gpu/drm/tilcdc/tilcdc_drv.c b/drivers/gpu/drm/tilcdc/tilcdc_drv.c
index e046cca..8122a31 100644
--- a/drivers/gpu/drm/tilcdc/tilcdc_drv.c
+++ b/drivers/gpu/drm/tilcdc/tilcdc_drv.c
@@ -17,6 +17,7 @@
 
 /* LCDC DRM driver, based on da8xx-fb */
 
+#include <linux/suspend.h>
 #include "tilcdc_drv.h"
 #include "tilcdc_regs.h"
 #include "tilcdc_tfp410.h"
@@ -228,6 +229,14 @@ static int tilcdc_load(struct drm_device *dev, unsigned long flags)
 
 	pm_runtime_enable(dev->dev);
 
+	/*
+	 * disable creation of new console during suspend.
+	 * this works around a problem where a ctrl-c is needed
+	 * to be entered on the VT to actually get the device
+	 * to continue into the suspend state.
+	 */
+	pm_set_vt_switch(0);
+
 	/* Determine LCD IP Version */
 	pm_runtime_get_sync(dev->dev);
 	switch (tilcdc_read(dev, LCDC_PID_REG)) {
-- 
1.7.5.4

