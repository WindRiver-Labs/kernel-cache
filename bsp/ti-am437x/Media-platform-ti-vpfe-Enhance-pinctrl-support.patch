From 50e7f5848e7fe1754955479b516e66135d07a84a Mon Sep 17 00:00:00 2001
From: Dave Gerlach <d-gerlach@ti.com>
Date: Tue, 4 Feb 2014 03:52:49 +0000
Subject: [PATCH 213/285] Media: platform: ti-vpfe: Enhance pinctrl support

Update ti-vpfe driver to set the state of the pins to:
- "sleep" on suspend
- "default" on resume

By optionally putting the pins into sleep state in the suspend callback
we can accomplish two things.
- minimize current leakage from pins and thus save power,
- prevent the IP from driving pins output in an uncontrolled manner,
which may happen if the power domain drops the domain regulator.

Signed-off-by: Dave Gerlach <d-gerlach@ti.com>
Signed-off-by: Darren Etheridge <detheridge@ti.com>
[Kevin: The original patch taken from TI
ti-sdk-am437x-evm-07.01.00.00-Linux-x86-Install.bin]
Signed-off-by: Kevin Hao <kexin.hao@windriver.com>
---
 drivers/media/platform/ti-vpfe/vpfe_capture.c |    8 ++++++++
 1 files changed, 8 insertions(+), 0 deletions(-)

diff --git a/drivers/media/platform/ti-vpfe/vpfe_capture.c b/drivers/media/platform/ti-vpfe/vpfe_capture.c
index d256b77..dad46bc 100644
--- a/drivers/media/platform/ti-vpfe/vpfe_capture.c
+++ b/drivers/media/platform/ti-vpfe/vpfe_capture.c
@@ -2584,6 +2584,10 @@ static int vpfe_suspend(struct device *dev)
 	struct platform_device *pdev = to_platform_device(dev);
 	struct vpfe_device *vpfe_dev = platform_get_drvdata(pdev);
 	isif_suspend(&vpfe_dev->vpfe_isif, dev);
+
+	/* Select sleep pin state */
+	pinctrl_pm_select_sleep_state(dev);
+
 	return 0;
 }
 
@@ -2592,6 +2596,10 @@ static int vpfe_resume(struct device *dev)
 	struct platform_device *pdev = to_platform_device(dev);
 	struct vpfe_device *vpfe_dev = platform_get_drvdata(pdev);
 	isif_resume(&vpfe_dev->vpfe_isif, dev);
+
+	/* Select default pin state */
+	pinctrl_pm_select_default_state(dev);
+
 	return 0;
 }
 
-- 
1.7.5.4

