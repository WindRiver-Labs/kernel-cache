From 1a25adf7eae49b73340ad6845c2f6aa98c7f9df5 Mon Sep 17 00:00:00 2001
From: Xulin Sun <xulin.sun@windriver.com>
Date: Mon, 18 Jan 2016 02:25:57 +0000
Subject: [PATCH] arm: mach-axxia: kexec_reinit to set L3 CACHE shutdown

Shut down to flush L3 cache for KEXEC to avoid the hung issue for
capture kernel booting, since for ARM capture kernel just one CPU
allowed to boot, and no L3 cache coherency issue existed for SMP
situation, so just shut down the flush to L3 CACHE.

The function calling relationship like below:
kernel_kexec
	machine_kexec
	    kexec_reinit
		flush_l3

Signed-off-by: Xulin Sun <xulin.sun@windriver.com>
---
 arch/arm/mach-axxia/axxia.c |    6 ++----
 1 files changed, 2 insertions(+), 4 deletions(-)

diff --git a/arch/arm/mach-axxia/axxia.c b/arch/arm/mach-axxia/axxia.c
index 602b03e..025eef1 100644
--- a/arch/arm/mach-axxia/axxia.c
+++ b/arch/arm/mach-axxia/axxia.c
@@ -95,10 +95,8 @@ static void set_l3_pstate(u32 newstate)
 static void
 flush_l3(void)
 {
-	/* Switch to SFONLY to flush */
-	set_l3_pstate(1);
-	/* ...and then back up again */
-	set_l3_pstate(3);
+	/* Shutdown to flush */
+	set_l3_pstate(0);
 }
 
 #endif
-- 
1.7.5.4

