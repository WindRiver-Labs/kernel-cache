From 987bb8325fdd1c936856cad8a2b4d3e159ed7487 Mon Sep 17 00:00:00 2001
From: SangeethaRao <sangeetha.rao@intel.com>
Date: Wed, 19 Aug 2015 18:13:34 -0500
Subject: [PATCH 59/86] drivers/pci/host: XLF PCIe0 DW support for emulation
 (continue)

Signed-off-by: SangeethaRao <sangeetha.rao@intel.com>
[Original patch is from linux-yocto-4.1 axxia/base branch.]
Signed-off-by: Yanjiang Jin <yanjiang.jin@windriver.com>
Signed-off-by: Quanyang Wang <quanyang.wang@windriver.com>
---
 arch/arm64/boot/dts/intel/axc6704-emu.dts |    4 ++
 arch/arm64/boot/dts/intel/axc67xx.dtsi    |   60 +++++++++++++++++++++++------
 2 files changed, 52 insertions(+), 12 deletions(-)

diff --git a/arch/arm64/boot/dts/intel/axc6704-emu.dts b/arch/arm64/boot/dts/intel/axc6704-emu.dts
index c78424f..86e009e 100644
--- a/arch/arm64/boot/dts/intel/axc6704-emu.dts
+++ b/arch/arm64/boot/dts/intel/axc6704-emu.dts
@@ -46,3 +46,7 @@
 	    max-speed = <10>;
       };
 };
+
+&pci0 {
+	status = "okay";
+};
diff --git a/arch/arm64/boot/dts/intel/axc67xx.dtsi b/arch/arm64/boot/dts/intel/axc67xx.dtsi
index fb5606e..81341c0 100644
--- a/arch/arm64/boot/dts/intel/axc67xx.dtsi
+++ b/arch/arm64/boot/dts/intel/axc67xx.dtsi
@@ -325,21 +325,57 @@
 			status = "disabled";
 		};
 
-		pci0: pci@c000000000 {
-			compatible = "lsi,plb-pciex";
+		pci0: pcie@c000000000 {
+			compatible = "intel,axxia-pcie";
 			device_type = "pci";
+			reg = <0xa0 0x02000000 0x00100000 /* dbi */
+				0xa0 0x03000000 0x00008000 /* AXI gpreg */
+				0xa0 0x03008000 0x00008000>; /* CC gpreg */
+			reg-names = "dbi", "axi_gpreg", "cc_gpreg";
 			#interrupt-cells = <1>;
-			#size-cells = <2>;
 			#address-cells = <3>;
-			reg = <0xc0 0x38000000 0x01000000>,
-			      <0xa0 0x02000000 0x00008000>;
-			/* Outbound: <PCI addr (3)> <CPU addr (2)> <Size (2)>*/
-			ranges = <0x03000000 0x00000000 0x80000000
-				  0xc0 0x00000000 0x00 0x20000000>;
-			/* Inbound: <PCI addr (3)> <CPU addr (2)> <Size (2)>*/
-			dma-ranges = <0x03000000 0x00000000 0x00000000
-				      0x00 0x00000000 0x00 0x40000000>;
-			interrupts = <GIC_SPI 57 IRQ_TYPE_LEVEL_HIGH>;
+			#size-cells = <2>;
+			num-lanes = <1>;
+			ranges = <0x00000000 0x000000c0 0x40000000
+				0xc0 0x40000000
+				0x00 0x10000000         /* config space */
+				0x03000000 0x00000000 0xa0000000
+				0xc0 0x00000000
+				0x00 0x40000000>;       /* outbound mem */
+			interrupts = <GIC_SPI 91 IRQ_TYPE_LEVEL_HIGH>,
+				<GIC_SPI 94 IRQ_TYPE_LEVEL_HIGH>,
+				<GIC_SPI 97 IRQ_TYPE_LEVEL_HIGH>,
+				<GIC_SPI 98 IRQ_TYPE_LEVEL_HIGH>,
+				<GIC_SPI 99 IRQ_TYPE_LEVEL_HIGH>,
+				<GIC_SPI 100 IRQ_TYPE_LEVEL_HIGH>,
+				<GIC_SPI 101 IRQ_TYPE_LEVEL_HIGH>,
+				<GIC_SPI 102 IRQ_TYPE_LEVEL_HIGH>,
+				<GIC_SPI 103 IRQ_TYPE_LEVEL_HIGH>,
+				<GIC_SPI 104 IRQ_TYPE_LEVEL_HIGH>,
+				<GIC_SPI 105 IRQ_TYPE_LEVEL_HIGH>,
+				<GIC_SPI 106 IRQ_TYPE_LEVEL_HIGH>,
+				<GIC_SPI 107 IRQ_TYPE_LEVEL_HIGH>,
+				<GIC_SPI 108 IRQ_TYPE_LEVEL_HIGH>,
+				<GIC_SPI 109 IRQ_TYPE_LEVEL_HIGH>,
+				<GIC_SPI 110 IRQ_TYPE_LEVEL_HIGH>,
+				<GIC_SPI 111 IRQ_TYPE_LEVEL_HIGH>,
+				<GIC_SPI 112 IRQ_TYPE_LEVEL_HIGH>,
+				<GIC_SPI 113 IRQ_TYPE_LEVEL_HIGH>,
+				<GIC_SPI 114 IRQ_TYPE_LEVEL_HIGH>,
+				<GIC_SPI 115 IRQ_TYPE_LEVEL_HIGH>,
+				<GIC_SPI 116 IRQ_TYPE_LEVEL_HIGH>,
+				<GIC_SPI 117 IRQ_TYPE_LEVEL_HIGH>,
+				<GIC_SPI 118 IRQ_TYPE_LEVEL_HIGH>,
+				<GIC_SPI 119 IRQ_TYPE_LEVEL_HIGH>,
+				<GIC_SPI 120 IRQ_TYPE_LEVEL_HIGH>,
+				<GIC_SPI 121 IRQ_TYPE_LEVEL_HIGH>,
+				<GIC_SPI 122 IRQ_TYPE_LEVEL_HIGH>,
+				<GIC_SPI 123 IRQ_TYPE_LEVEL_HIGH>,
+				<GIC_SPI 124 IRQ_TYPE_LEVEL_HIGH>,
+				<GIC_SPI 125 IRQ_TYPE_LEVEL_HIGH>,
+				<GIC_SPI 126 IRQ_TYPE_LEVEL_HIGH>,
+				<GIC_SPI 127 IRQ_TYPE_LEVEL_HIGH>,
+				<GIC_SPI 128 IRQ_TYPE_LEVEL_HIGH>;
 			status = "disabled";
 		};
 
-- 
1.7.5.4

