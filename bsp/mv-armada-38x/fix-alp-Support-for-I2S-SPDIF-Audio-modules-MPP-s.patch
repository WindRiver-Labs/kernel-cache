From 6f1e58d023a3c044c52e85c62df8af78fe9102e4 Mon Sep 17 00:00:00 2001
From: Hanna Hawa <hannah@marvell.com>
Date: Thu, 2 Jan 2014 17:52:02 +0200
Subject: [PATCH 1264/1825] fix: alp: Support for I2S/SPDIF Audio modules
 MPP's

https://github.com/MISL-EBU-System-SW/misl-windriver.git linux-3.4.69-14t2-read
commit 670faa6297734033791d50a46063f7f52a6d7bc3

Signed-off-by: Hanna Hawa <hannah@marvell.com>

Change-Id: I19945d3ab535b98010247e49efc2e2561ab6e092
Reviewed-on: http://vgitil04.il.marvell.com:8080/5020
Tested-by: Star_Automation <star@marvell.com>
Reviewed-by: Omri Itach <omrii@marvell.com>
Tested-by: Omri Itach <omrii@marvell.com>
Signed-off-by: Zhong Hongbo <hongbo.zhong@windriver.com>
---
 .../avanta_lp_family/boardEnv/mvBoardEnvLib.c      |   11 ++++++-----
 .../avanta_lp_family/ctrlEnv/mvCtrlEnvSpec.h       |    4 ++--
 2 files changed, 8 insertions(+), 7 deletions(-)

diff --git a/arch/arm/mach-avantalp/avanta_lp_family/boardEnv/mvBoardEnvLib.c b/arch/arm/mach-avantalp/avanta_lp_family/boardEnv/mvBoardEnvLib.c
index f8200dee9..c463345 100644
--- a/arch/arm/mach-avantalp/avanta_lp_family/boardEnv/mvBoardEnvLib.c
+++ b/arch/arm/mach-avantalp/avanta_lp_family/boardEnv/mvBoardEnvLib.c
@@ -1193,10 +1193,11 @@ MV_BOARD_BOOT_SRC mvBoardBootDeviceGroupSet()
 		mvBoardMppTypeSet(1, NAND_BOOT_V2);
 		break;
 	case MSAR_0_BOOT_SPI_FLASH:
-		/* read SPDIF_AUDIO board configuration for DB-6660 board */
+		/* read SPDIF_AUDIO/I2S_AUDIO board configuration for DB-6660 board */
 		if ((mvBoardIdGet() == DB_6660_ID) &&
-			(mvCtrlSysConfigGet(MV_CONFIG_DEVICE_BUS_MODULE) == 0x2))	/* 0x2=SPDIF_AUDIO */
-			groupType = SPI0_BOOT_SPDIF_AUDIO;
+			((mvCtrlSysConfigGet(MV_CONFIG_DEVICE_BUS_MODULE) == 0x2) ||	/* 0x2=I2S_AUDIO   */
+			 (mvCtrlSysConfigGet(MV_CONFIG_DEVICE_BUS_MODULE) == 0x3)))	/* 0x3=SPDIF_AUDIO */
+			groupType = SPI0_BOOT_SPDIF_I2S_AUDIO;
 		else
 			groupType = SPI0_BOOT;
 
@@ -1209,8 +1210,8 @@ MV_BOARD_BOOT_SRC mvBoardBootDeviceGroupSet()
 			mvBoardMppTypeSet(4, SPI1_CPU_SMI_CTRL_TDM_LQ_UNIT);
 		else    /*REF_CLK_OUT*/
 			mvBoardMppTypeSet(4, SPI1_CPU_SMI_CTRL_REF_CLK_OUT);
-		mvBoardMppTypeSet(0, SPI0_BOOT_SPDIF_AUDIO);
-		mvBoardMppTypeSet(1, SPI0_BOOT_SPDIF_AUDIO);
+		mvBoardMppTypeSet(0, SPI0_BOOT_SPDIF_I2S_AUDIO);
+		mvBoardMppTypeSet(1, SPI0_BOOT_SPDIF_I2S_AUDIO);
 		break;
 	default:
 		return MV_ERROR;
diff --git a/arch/arm/mach-avantalp/avanta_lp_family/ctrlEnv/mvCtrlEnvSpec.h b/arch/arm/mach-avantalp/avanta_lp_family/ctrlEnv/mvCtrlEnvSpec.h
index 0c15e9c..f72ffdb 100755
--- a/arch/arm/mach-avantalp/avanta_lp_family/ctrlEnv/mvCtrlEnvSpec.h
+++ b/arch/arm/mach-avantalp/avanta_lp_family/ctrlEnv/mvCtrlEnvSpec.h
@@ -273,13 +273,13 @@ extern "C" {
 typedef enum {
 	NAND_BOOT_V2,
 	SPI0_BOOT,
-	SPI0_BOOT_SPDIF_AUDIO,
+	SPI0_BOOT_SPDIF_I2S_AUDIO,
 } MV_GROUP_0_TYPE;
 
 #define MPP_GROUP_1_TYPE { \
 	0x22555555,     /* NAND_V2_BOOT_DEVICE  */ \
 	0x22000022,     /* SPI_BOOT_DEVICE	*/ \
-	0x22044022,     /* SPI_BOOT_DEVICE & SPDIF Audio	*/ \
+	0x22044022,     /* SPI_BOOT_DEVICE & I2S Audio*/ \
 }
 
 #define MV_GROUP_1_TYPE         MV_GROUP_0_TYPE
-- 
1.7.5.4

