From 8eca96aa509f07c0b84eba99bfb2b3532441cd96 Mon Sep 17 00:00:00 2001
From: Uri Eliyahu <uriel@marvell.com>
Date: Thu, 23 Jan 2014 19:03:38 +0200
Subject: [PATCH 1303/1825] fix: pp2: bug in stop sequence in big endian

https://github.com/MISL-EBU-System-SW/misl-windriver.git linux-3.4.69-14t2-read
commit 1eee18a1fd8d50c63ab9921a71aa7341d48cfd2b

	- bug fix, too early rx descriptor swap
	  relevant only for BE mode

Change-Id: Id58d5c3ec814f0c768faed7160959286c502dfb0
Signed-off-by: Uri Eliyahu <uriel@marvell.com>
Reviewed-on: http://vgitil04.il.marvell.com:8080/5294
Tested-by: Star_Automation <star@marvell.com>
Reviewed-by: Yelena Krivosheev <yelena@marvell.com>
Reviewed-by: Dmitri Epshtein <dima@marvell.com>
Signed-off-by: Zhong Hongbo <hongbo.zhong@windriver.com>
---
 .../mv_drivers_lsp/mv_pp2/net_dev/mv_netdev.c      |    9 ++++-----
 1 files changed, 4 insertions(+), 5 deletions(-)

diff --git a/arch/arm/plat-armada/mv_drivers_lsp/mv_pp2/net_dev/mv_netdev.c b/arch/arm/plat-armada/mv_drivers_lsp/mv_pp2/net_dev/mv_netdev.c
index f9cdd1b..cc94534 100644
--- a/arch/arm/plat-armada/mv_drivers_lsp/mv_pp2/net_dev/mv_netdev.c
+++ b/arch/arm/plat-armada/mv_drivers_lsp/mv_pp2/net_dev/mv_netdev.c
@@ -2473,14 +2473,13 @@ static void mv_eth_rxq_drop_pkts(struct eth_port *pp, int rxq)
 
 		rx_desc = mvPp2RxqNextDescGet(rx_ctrl);
 
-		bm = mv_eth_bm_cookie_build(rx_desc);
-		pool = mv_eth_bm_cookie_pool_get(bm);
-		ppool = &mv_eth_pool[pool];
-
 #if defined(MV_CPU_BE)
-	mvPPv2RxqDescSwap(rx_desc);
+		mvPPv2RxqDescSwap(rx_desc);
 #endif /* MV_CPU_BE */
 
+		bm = mv_eth_bm_cookie_build(rx_desc);
+		pool = mv_eth_bm_cookie_pool_get(bm);
+		ppool = &mv_eth_pool[pool];
 
 		mv_eth_pool_refill(ppool, bm, rx_desc->bufPhysAddr, rx_desc->bufCookie);
 		mvOsCacheLineInv(NULL, rx_desc);
-- 
1.7.5.4

