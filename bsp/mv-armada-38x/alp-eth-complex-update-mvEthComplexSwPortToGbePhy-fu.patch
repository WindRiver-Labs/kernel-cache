From c372dc908cc88de296e05ea10f093c6ae8f8f029 Mon Sep 17 00:00:00 2001
From: Hanna Hawa <hannah@marvell.com>
Date: Mon, 17 Feb 2014 19:17:20 +0200
Subject: [PATCH 1361/1825] alp: eth complex: update
 mvEthComplexSwPortToGbePhy function

https://github.com/MISL-EBU-System-SW/misl-windriver.git linux-3.4.69-14t2-read
commit 33d8f580ec4afaf63f9d17fc6dce5c9b7efb61a8

	- Set the Gbe Phy/Switch port source only for phy 0,3
	   ** Gbe phy 1,2 are permanent and hardcoded to switch port 1,2 adaptively **
	- use correct arguments for all Switch ports

Change-Id: I2bd5e24eb967221568ced5a1dda199329e48986e
Signed-off-by: Hanna Hawa <hannah@marvell.com>
Reviewed-on: http://vgitil04.il.marvell.com:8080/5715
Reviewed-by: Omri Itach <omrii@marvell.com>
Tested-by: Omri Itach <omrii@marvell.com>
Signed-off-by: Zhong Hongbo <hongbo.zhong@windriver.com>
---
 .../avanta_lp_family/ctrlEnv/mvCtrlEthCompLib.c    |   12 ++++++++----
 1 files changed, 8 insertions(+), 4 deletions(-)

diff --git a/arch/arm/mach-avantalp/avanta_lp_family/ctrlEnv/mvCtrlEthCompLib.c b/arch/arm/mach-avantalp/avanta_lp_family/ctrlEnv/mvCtrlEthCompLib.c
index bc06539..b444706 100755
--- a/arch/arm/mach-avantalp/avanta_lp_family/ctrlEnv/mvCtrlEthCompLib.c
+++ b/arch/arm/mach-avantalp/avanta_lp_family/ctrlEnv/mvCtrlEthCompLib.c
@@ -387,8 +387,12 @@ static void mvEthComplexMacToRgmii(MV_U32 port, MV_U32 phy)
 
 static void mvEthComplexSwPortToGbePhy(MV_U32 swPort, MV_U32 phy)
 {
-	mvEthComplexSwPortSrcSet(swPort, 0x1);
-	mvEthComplexGbePhySrcSet(phy, 0x1);
+	/* For Phy 1 and 2, Sw port source and phy source are hardcoded */
+	if (phy == 0 || phy == 3)
+	{
+		mvEthComplexSwPortSrcSet(swPort, 0x1);
+		mvEthComplexGbePhySrcSet(phy, 0x1);
+	}
 	mvEthComplexGbePhyResetSet(MV_FALSE);
 	mvEthComplexGbePhyPowerCycle(phy);
 }
@@ -435,10 +439,10 @@ MV_STATUS mvEthComplexInit(MV_U32 ethCompConfig)
 		mvEthComplexSwPortToGbePhy(0, 0);
 
 	if (c & MV_ETHCOMP_SW_P1_2_GE_PHY_P1)
-		mvEthComplexSwPortToGbePhy(0, 0);
+		mvEthComplexSwPortToGbePhy(1, 1);
 
 	if (c & MV_ETHCOMP_SW_P2_2_GE_PHY_P2)
-		mvEthComplexSwPortToGbePhy(0, 0);
+		mvEthComplexSwPortToGbePhy(2, 2);
 
 	if (c & MV_ETHCOMP_SW_P3_2_GE_PHY_P3)
 		mvEthComplexSwPortToGbePhy(3, 3);
-- 
1.7.5.4

