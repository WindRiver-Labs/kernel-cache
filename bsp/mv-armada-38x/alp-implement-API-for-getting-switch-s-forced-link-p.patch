From f2a66db89c199ac431a72002b1334466fcfa89dc Mon Sep 17 00:00:00 2001
From: Yoni Farhadian <yonif@marvell.com>
Date: Tue, 30 Jul 2013 09:48:50 +0300
Subject: [PATCH 0896/1825] alp: implement API for getting switch's forced
 link ports

https://github.com/MISL-EBU-System-SW/misl-windriver.git linux-3.4.69-14t2-read
commit 60fe5bb9a911585df7e483304b2afeccda1e4ae2

	mvBoardSwitchPortForceLinkGet used to return board info's map in the past
	However, when configuring Eth Complex this value may not be right
	To fix it, switchforceLinkMap was removed from board info struct
	And lastly, the function returns a port map according to the Eth Complex configuration we got

Change-Id: I51dc9eb921bb2557162c678dfd041b648974a27a
Signed-off-by: Yoni Farhadian <yonif@marvell.com>
Reviewed-on: http://vgitil04.il.marvell.com:8080/2877
Reviewed-by: Nadav Haklai <nadavh@marvell.com>
Tested-by: Nadav Haklai <nadavh@marvell.com>
Signed-off-by: Zhong Hongbo <hongbo.zhong@windriver.com>
---
 .../avanta_lp_family/boardEnv/mvBoardEnvLib.c      |    9 ++++++++-
 .../avanta_lp_family/boardEnv/mvBoardEnvLib.h      |    3 ---
 .../avanta_lp_family/boardEnv/mvBoardEnvSpec.c     |   12 ------------
 3 files changed, 8 insertions(+), 16 deletions(-)

diff --git a/arch/arm/mach-avantalp/avanta_lp_family/boardEnv/mvBoardEnvLib.c b/arch/arm/mach-avantalp/avanta_lp_family/boardEnv/mvBoardEnvLib.c
index 1234a2c..0188113 100644
--- a/arch/arm/mach-avantalp/avanta_lp_family/boardEnv/mvBoardEnvLib.c
+++ b/arch/arm/mach-avantalp/avanta_lp_family/boardEnv/mvBoardEnvLib.c
@@ -1473,7 +1473,14 @@ MV_U32 mvBoardSwitchPortsMaskGet(MV_U32 switchIdx)
 *******************************************************************************/
 MV_U32 mvBoardSwitchPortForceLinkGet(MV_U32 switchIdx)
 {
-	return board->switchforceLinkMask;
+	MV_U32 mask = 0, c = mvBoardEthComplexConfigGet();
+
+	if (c & MV_ETHCOMP_GE_MAC1_2_SW_P4)
+		mask |= BIT4;
+	if (c & MV_ETHCOMP_GE_MAC0_2_SW_P6)
+		mask |= BIT6;
+
+	return mask;
 }
 
 /*******************************************************************************
diff --git a/arch/arm/mach-avantalp/avanta_lp_family/boardEnv/mvBoardEnvLib.h b/arch/arm/mach-avantalp/avanta_lp_family/boardEnv/mvBoardEnvLib.h
index 0f5dc2d..0def030 100644
--- a/arch/arm/mach-avantalp/avanta_lp_family/boardEnv/mvBoardEnvLib.h
+++ b/arch/arm/mach-avantalp/avanta_lp_family/boardEnv/mvBoardEnvLib.h
@@ -309,9 +309,6 @@ typedef struct _boardInfo {
 	MV_U32 gppPolarityValMid;
 	MV_U32 gppPolarityValHigh;
 
-	/* External Switch Configuration */
-	MV_U32 switchforceLinkMask;
-
 	/* PON configuration. */
 	MV_BOARD_PON_CONFIG ponConfigValue;
 	/* TDM configuration:
diff --git a/arch/arm/mach-avantalp/avanta_lp_family/boardEnv/mvBoardEnvSpec.c b/arch/arm/mach-avantalp/avanta_lp_family/boardEnv/mvBoardEnvSpec.c
index 828a552..b16530a 100644
--- a/arch/arm/mach-avantalp/avanta_lp_family/boardEnv/mvBoardEnvSpec.c
+++ b/arch/arm/mach-avantalp/avanta_lp_family/boardEnv/mvBoardEnvSpec.c
@@ -256,9 +256,6 @@ MV_BOARD_INFO db88f6660_board_info = {
 	.gppPolarityValMid		= DB_88F6660_GPP_POL_MID,
 	.gppPolarityValHigh		= DB_88F6660_GPP_POL_HIGH,
 
-	/* External Switch Configuration */
-	.switchforceLinkMask		= 0x0,
-
 	/* TDM */
 	.numBoardTdmInfo		= {1},
 	.pBoardTdmInt2CsInfo		= {db88f6660Tdm880},
@@ -374,9 +371,6 @@ MV_BOARD_INFO db88f6650_board_info = {
 	.gppPolarityValMid		= DB_88F6650_GPP_POL_MID,
 	.gppPolarityValHigh		= DB_88F6650_GPP_POL_HIGH,
 
-	/* External Switch Configuration */
-	.switchforceLinkMask		= 0x0,
-
 	/* TDM */
 	.numBoardTdmInfo		= {1},
 	.pBoardTdmInt2CsInfo		= {db88f6650Tdm880},
@@ -481,9 +475,6 @@ MV_BOARD_INFO rd88f6650_board_info = {
 	.gppPolarityValMid		= RD_88F6650_GPP_POL_MID,
 	.gppPolarityValHigh		= RD_88F6650_GPP_POL_HIGH,
 
-	/* External Switch Configuration */
-	.switchforceLinkMask		= 0x0,
-
 	/* TDM */
 	.numBoardTdmInfo		= {},
 	.pBoardTdmInt2CsInfo		= {},
@@ -579,9 +570,6 @@ MV_BOARD_INFO rd88f6660_board_info = {
 	.gppPolarityValMid		= RD_88F6660_GPP_POL_MID,
 	.gppPolarityValHigh		= RD_88F6660_GPP_POL_HIGH,
 
-	/* External Switch Configuration */
-	.switchforceLinkMask		= 0x0,
-
 	/* TDM */
 	.numBoardTdmInfo		= {},
 	.pBoardTdmInt2CsInfo		= {},
-- 
1.7.5.4

