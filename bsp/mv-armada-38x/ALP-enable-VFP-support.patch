From d19abfbaabb01711678d17f791e2b63868940fd8 Mon Sep 17 00:00:00 2001
From: Kosta Zertsekel <konszert@marvell.com>
Date: Mon, 29 Apr 2013 12:04:40 +0300
Subject: [PATCH 0608/1825] ALP: enable VFP support

https://github.com/MISL-EBU-System-SW/misl-windriver.git linux-3.4.69-14t2-read
commit 3468c197d829f71ac75aa3a0ff33139ca3cbee88

Signed-off-by: Kosta Zertsekel <konszert@marvell.com>
Change-Id: Ie1fb21c1b50a684eb0e5adeec23671b619100a6c
Reviewed-on: http://vgitil04.il.marvell.com:8080/1677
Reviewed-by: Eran Ben-Avi <benavi@marvell.com>
Tested-by: Eran Ben-Avi <benavi@marvell.com>
Signed-off-by: Zhong Hongbo <hongbo.zhong@windriver.com>
---
 arch/arm/configs/avanta_lp_defconfig     |    1 +
 arch/arm/configs/avanta_lp_smp_defconfig |    1 +
 arch/arm/vfp/vfpmodule.c                 |   21 ---------------------
 3 files changed, 2 insertions(+), 21 deletions(-)

diff --git a/arch/arm/configs/avanta_lp_defconfig b/arch/arm/configs/avanta_lp_defconfig
index b342a09..146140e 100644
--- a/arch/arm/configs/avanta_lp_defconfig
+++ b/arch/arm/configs/avanta_lp_defconfig
@@ -33,6 +33,7 @@ CONFIG_AEABI=y
 CONFIG_UACCESS_WITH_MEMCPY=y
 CONFIG_ZBOOT_ROM_TEXT=0x0
 CONFIG_ZBOOT_ROM_BSS=0x0
+CONFIG_VFP=y
 # CONFIG_CORE_DUMP_DEFAULT_ELF_HEADERS is not set
 # CONFIG_SUSPEND is not set
 CONFIG_NET=y
diff --git a/arch/arm/configs/avanta_lp_smp_defconfig b/arch/arm/configs/avanta_lp_smp_defconfig
index 2d110f4..ddb44f3 100644
--- a/arch/arm/configs/avanta_lp_smp_defconfig
+++ b/arch/arm/configs/avanta_lp_smp_defconfig
@@ -34,6 +34,7 @@ CONFIG_AEABI=y
 CONFIG_UACCESS_WITH_MEMCPY=y
 CONFIG_ZBOOT_ROM_TEXT=0x0
 CONFIG_ZBOOT_ROM_BSS=0x0
+CONFIG_VFP=y
 # CONFIG_CORE_DUMP_DEFAULT_ELF_HEADERS is not set
 # CONFIG_SUSPEND is not set
 CONFIG_NET=y
diff --git a/arch/arm/vfp/vfpmodule.c b/arch/arm/vfp/vfpmodule.c
index 8b57724..eede545 100644
--- a/arch/arm/vfp/vfpmodule.c
+++ b/arch/arm/vfp/vfpmodule.c
@@ -336,10 +336,6 @@ void VFP_bounce(u32 trigger, u32 fpexc, struct pt_regs *regs)
 {
 	u32 fpscr, orig_fpscr, fpsid, exceptions;
 
-	/* Adjust saved PC for thumb-2 user program */
-	if (regs->ARM_cpsr & PSR_T_BIT)
-		regs->ARM_pc += 2;
-
 	pr_debug("VFP: bounce: trigger %08x fpexc %08x\n", trigger, fpexc);
 
 	/*
@@ -652,23 +648,6 @@ static int vfp_hotplug(struct notifier_block *b, unsigned long action,
 	return NOTIFY_OK;
 }
 
-void vfp_save(void)
-{
-        struct pm_message temp;
-        /*
-         * if VFP was not initialized yet, then do nothing
-         */
-        if (VFP_arch)
-                vfp_pm_suspend();
-}
-
-void vfp_restore(void)
-{
-        if (VFP_arch)
-                vfp_pm_resume();
-}
-
-
 /*
  * VFP support code initialisation.
  */
-- 
1.7.5.4

