From f96d8eca601d1efb7371a2992cdf49c294ce8d77 Mon Sep 17 00:00:00 2001
From: Yoni Farhadia <yonif@marvell.com>
Date: Sun, 29 Sep 2013 15:49:14 +0200
Subject: [PATCH 0998/1825] alp,a375: Check if port connected to
 PHY/Switch/SGMII before init

https://github.com/MISL-EBU-System-SW/misl-windriver.git linux-3.4.69-14t2-read
commit 38a046626f5fb570ca357cd1570693bd30d0e0f5

	- Use mvBoardIsEthConnected to determine if port is connected
	- Skip initialization for not connected ports

Change-Id: I24f0c8bdae66047fd22254a298af16f4345f536d
Signed-off-by: Yoni Farhadia <yonif@marvell.com>
Reviewed-on: http://vgitil04.il.marvell.com:8080/3565
Tested-by: Star_Automation <star@marvell.com>
Reviewed-by: Dmitri Epshtein <dima@marvell.com>
Reviewed-by: Nadav Haklai <nadavh@marvell.com>
Signed-off-by: Zhong Hongbo <hongbo.zhong@windriver.com>
---
 arch/arm/mach-avantalp/core.c |    9 ++++++---
 1 files changed, 6 insertions(+), 3 deletions(-)

diff --git a/arch/arm/mach-avantalp/core.c b/arch/arm/mach-avantalp/core.c
index 1d9b108..5e7e479 100644
--- a/arch/arm/mach-avantalp/core.c
+++ b/arch/arm/mach-avantalp/core.c
@@ -667,9 +667,12 @@ static struct platform_device mv_pp2_ge3_plat = {
 
 static void __init eth_init(void)
 {
-	mv_pp2_giga_pdev_register(&mv_pp2_ge0_plat);
-	mv_pp2_giga_pdev_register(&mv_pp2_ge1_plat);
-	mv_pp2_giga_pdev_register(&mv_pp2_ge2_plat);
+	if ((mvBoardIsEthConnected(0) == MV_TRUE) && (mvCtrlPwrClckGet(ETH_GIG_UNIT_ID, 0)))
+		mv_pp2_giga_pdev_register(&mv_pp2_ge0_plat);
+	if ((mvBoardIsEthConnected(1) == MV_TRUE) && (mvCtrlPwrClckGet(ETH_GIG_UNIT_ID, 1)))
+		mv_pp2_giga_pdev_register(&mv_pp2_ge1_plat);
+	if ((mvBoardIsEthConnected(2) == MV_TRUE) && (mvCtrlPwrClckGet(ETH_GIG_UNIT_ID, 2)))
+		mv_pp2_giga_pdev_register(&mv_pp2_ge2_plat);
 #ifdef CONFIG_MV_INCLUDE_PON
 	mv_pp2_giga_pdev_register(&mv_pp2_ge3_plat);
 #endif
-- 
1.7.5.4

