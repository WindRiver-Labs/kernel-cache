From 24eaa0e3f792920e49565e7ab3bce0c8314edb4b Mon Sep 17 00:00:00 2001
From: Eran Ben-Avi <benavi@marvell.com>
Date: Wed, 1 May 2013 19:37:32 +0300
Subject: [PATCH 0629/1825] ALP:compilation fix

https://github.com/MISL-EBU-System-SW/misl-windriver.git linux-3.4.69-14t2-read
commit 8790c6c9c14dd6653bfc5e79499be301a330507d

Change-Id: I956ce7473b7e523b33b97731800a5c68bbde8fab
Signed-off-by: Eran Ben-Avi <benavi@marvell.com>
Reviewed-on: http://vgitil04.il.marvell.com:8080/1727
Signed-off-by: Zhong Hongbo <hongbo.zhong@windriver.com>
---
 arch/arm/mach-avantalp/Kconfig                     |    4 ++--
 .../arm/mach-avantalp/avanta_lp_family/cpu/mvCpu.c |    2 ++
 arch/arm/mach-avantalp/core.c                      |    4 +++-
 3 files changed, 7 insertions(+), 3 deletions(-)

diff --git a/arch/arm/mach-avantalp/Kconfig b/arch/arm/mach-avantalp/Kconfig
index c312a122..4230b11 100644
--- a/arch/arm/mach-avantalp/Kconfig
+++ b/arch/arm/mach-avantalp/Kconfig
@@ -30,12 +30,12 @@ config  AVANTA_LP_REV_XX
 endchoice
 
 config MACH_AVANTA_LP
-	bool "Marvell AvantaLP Development Board"
+	bool "Marvell Avanta-LP SoC Family"
 	default y
 	help
 	  No help currently.
 
-config MACH_GENERAL_FPGA
+config MACH_AVANTA_LP_FPGA
 	bool "Marvell FPGA Development Board"
 	default n
 	help
diff --git a/arch/arm/mach-avantalp/avanta_lp_family/cpu/mvCpu.c b/arch/arm/mach-avantalp/avanta_lp_family/cpu/mvCpu.c
index 701895e..a0bad30 100644
--- a/arch/arm/mach-avantalp/avanta_lp_family/cpu/mvCpu.c
+++ b/arch/arm/mach-avantalp/avanta_lp_family/cpu/mvCpu.c
@@ -97,8 +97,10 @@ MV_U32 mvCpuPclkGet(MV_VOID)
 {
 	MV_FREQ_MODE freqMode;
 
+#ifdef MACH_AVANTA_LP_FPGA
 	if (mvBoardIdGet() == MV_BOARD_ID_AVANTA_LP_FPGA)
 		return MV_FPGA_CORE_CLK; /* FPGA is limited to 12.5Mhz */
+#endif
 
 	if (MV_ERROR != mvCtrlCpuDdrL2FreqGet(&freqMode))
 		return (MV_U32)(1000000 * freqMode.cpuFreq);
diff --git a/arch/arm/mach-avantalp/core.c b/arch/arm/mach-avantalp/core.c
index 9be618f..49caaca 100644
--- a/arch/arm/mach-avantalp/core.c
+++ b/arch/arm/mach-avantalp/core.c
@@ -172,7 +172,7 @@ static int __init parse_tag_mv_uboot(const struct tag *tag)
 	mvIsUsbHost = read_tag(tag->u.mv_uboot.isUsbHost);
 #endif
 
-	mvBoardIdSet(mvUbootVer & 0xff);
+	mvBoardIdSet(mvBoardIdGet());
 
 #ifdef CONFIG_MV_INCLUDE_GIG_ETH
 	for (i = 0; i < MV_UBOOT_ETH_PORTS; i++) {
@@ -1127,6 +1127,7 @@ static struct platform_device alp_xor11_channel = {
 	},
 };
 
+#if 0
 static void __init alp_init_xor1(void)
 {
 	if (mvUnitMapIsMine(XOR1) != MV_TRUE)
@@ -1146,6 +1147,7 @@ static void __init alp_init_xor1(void)
 	platform_device_register(&alp_xor11_channel);
 }
 #endif
+#endif
 
 static void __init alp_init_xor(void)
 {
-- 
1.7.5.4

