From 253a2c7db9b9c00e618e2bca6eec22ddf697f7c4 Mon Sep 17 00:00:00 2001
From: Tawfik Bayouk <tawfik@marvell.com>
Date: Tue, 21 Aug 2012 17:34:22 +0300
Subject: [PATCH 0108/1825] DSMP fixed for PM support in Linux 3.2

https://github.com/MISL-EBU-System-SW/misl-windriver.git linux-3.4.69-14t2-read
commit fac8d383828879c167bfcd58af6f1d69a79af23b

Change-Id: I48dee46c0844f952dbebbdfbee05a2656127db0f
Signed-off-by: Tawfik Bayouk <tawfik@marvell.com>
Signed-off-by: Kosta Zertsekel <konszert@marvell.com>
Signed-off-by: Zhong Hongbo <hongbo.zhong@windriver.com>
---
 arch/arm/plat-armada/cpuidle.c |   10 ++++++----
 1 files changed, 6 insertions(+), 4 deletions(-)

diff --git a/arch/arm/plat-armada/cpuidle.c b/arch/arm/plat-armada/cpuidle.c
index fc062cf..a68f54f 100644
--- a/arch/arm/plat-armada/cpuidle.c
+++ b/arch/arm/plat-armada/cpuidle.c
@@ -435,15 +435,15 @@ int armadaxp_init_cpuidle(void)
 	cpu_idle_proc->write_proc = mv_cpu_idle_write;
 	cpu_idle_proc->nlink = 1;
 #endif
-	if (pm_support == 1)
+	if (pm_support == WFI)
 		printk(" (WFI)\n");
-	else if (pm_support == 2)
+	else if (pm_support == DEEP_IDLE)
 		printk(" (IDLE)\n");
-	else if (pm_support == 3)
+	else if (pm_support == SNOOZE)
 		printk(" (SNOOZE)\n");
 	else {
 		printk(" (DISABLED)\n");
-		device_registered = 0;
+		device_registered = DISABLED;
 	}
 	pm_mode = pm_support;
 
@@ -476,10 +476,12 @@ int armadaxp_init_cpuidle(void)
                 strcpy(driver->states[2].desc, "Snooze");
 
                 if(pm_mode) {
+			 cpuidle_register_driver(driver);
                         if (cpuidle_register_device(device)) {
                                 printk(KERN_ERR "armadaxp_init_cpuidle: Failed registering\n");
                                 return -EIO;
                         }
+			//			cpuidle_register_driver(driver);
 		}
 	}
 
-- 
1.7.5.4

