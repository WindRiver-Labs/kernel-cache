From d888aa684077e20a88fb3cbb4243f9b6fe63055d Mon Sep 17 00:00:00 2001
From: Kosta Zertsekel <konszert@marvell.com>
Date: Mon, 8 Apr 2013 10:44:57 +0300
Subject: [PATCH 0554/1825] ALP: IOCC: Remove IOCC initialization - default is
 ok

https://github.com/MISL-EBU-System-SW/misl-windriver.git linux-3.4.69-14t2-read
commit 5abb2ff95a66c57d240f8eb9c7e949fff39b7950

Signed-off-by: Kosta Zertsekel <konszert@marvell.com>
Change-Id: Id051ccb28410259973ffece08e0b21b7a9a50ae5
Reviewed-on: http://vgitil04.il.marvell.com:8080/1501
Reviewed-by: Eran Ben-Avi <benavi@marvell.com>
Tested-by: Eran Ben-Avi <benavi@marvell.com>
Signed-off-by: Zhong Hongbo <hongbo.zhong@windriver.com>
---
 arch/arm/mach-avantalp/core.c |   45 +++++-----------------------------------
 1 files changed, 6 insertions(+), 39 deletions(-)

diff --git a/arch/arm/mach-avantalp/core.c b/arch/arm/mach-avantalp/core.c
index 0099471..15a6229 100644
--- a/arch/arm/mach-avantalp/core.c
+++ b/arch/arm/mach-avantalp/core.c
@@ -600,64 +600,31 @@ void print_board_info(void)
 #endif
 	printk("  Detected Tclk %d, SysClk %d, FabricClk %d, PClk %d\n", mvTclk, mvSysclk, mvCpuL2ClkGet(), mvCpuPclkGet());
 	printk("  LSP version: %s\n", LSP_VERSION);
+#ifdef CONFIG_AURORA_IO_CACHE_COHERENCY
+	printk("  IOCC: Support IO coherency.\n");
+#endif
 #ifdef CONFIG_MV_AMP_ENABLE
 	mvUnitMapPrint();
 #endif
 	printk("\n");
 }
 
-/*
- * IOCC initialization
- */
-#ifdef CONFIG_AURORA_IO_CACHE_COHERENCY
-static void io_coherency_init(void)
-{
-	MV_U32 reg;
-
-#define CIB_CTRL_CFG			0x20280
-
-	/* Set CIB read snoop command to ReadUnique */
-	reg = MV_REG_READ(CIB_CTRL_CFG);
-	reg &= ~(7 << 16);
-	reg |= (7 << 16);
-	MV_REG_WRITE(CIB_CTRL_CFG, reg);
-}
-#endif
-
 #ifdef CONFIG_DEBUG_LL
 extern void printascii(const char *);
 #endif
 
 /*****************************************************************************
- * CPU and Fabric
- ****************************************************************************/
-static void cpu_fabric_common_init(void)
-{
-#ifdef CONFIG_CACHE_L2X0
-	void __iomem *l2x0_base = INTER_REGS_VIRT_BASE + MV_CA9X2_L2CC_OFFSET;
-	l2x0_init(l2x0_base, 0x00400000, 0xfe0fffff);
-#endif
-
-#ifdef CONFIG_AURORA_IO_CACHE_COHERENCY
-	printk("Support IO coherency.\n");
-	io_coherency_init();
-#endif
-}
-
-/*****************************************************************************
  * FPGA BOARD: Main Initialization
  ****************************************************************************/
 extern MV_TARGET_ATTRIB mvTargetDefaultsArray[];
 static void __init alp_fpga_init(void)
 {
-#if 1   /* kostaz: disabling l2+iocc init for SMP boot test */
-	cpu_fabric_common_init();
+#ifdef CONFIG_CACHE_L2X0
+	void __iomem *l2x0_base = INTER_REGS_VIRT_BASE + MV_CA9X2_L2CC_OFFSET;
+	l2x0_init(l2x0_base, 0x00400000, 0xfe0fffff);
 #endif
 
 #if 0
-	/* Call Aurora/cpu special configurations */
-	cpu_fabric_common_init();
-
 	/* Select appropriate Board ID for Machine */
 	gBoardId = MV_BOARD_ID_AVANTA_LP_FPGA;
 	/* Bypass serdes reconfiguration since already done at bootloader */
-- 
1.7.5.4

