From 0e218cccc86b27e2e1dee138eb766f7d82d27904 Mon Sep 17 00:00:00 2001
From: Uri Eliyahu <uriel@marvell.com>
Date: Tue, 29 Apr 2014 17:16:38 +0300
Subject: [PATCH 1604/1825] pp3: hmac vimd set for bm queues

https://github.com/MISL-EBU-System-SW/misl-windriver.git linux-3.4.69-14t2-read
commit 73dd5162ddce5b0b805b04c4eddfe18e6d96ed4e

	- set vmid to 0 in txqs that used for bm buf release

Change-Id: Ia978932369be1f3493a98bf5babf34504c4c638f
Signed-off-by: Uri Eliyahu <uriel@marvell.com>
Reviewed-on: http://vgitil04.il.marvell.com:8080/7762
Reviewed-by: Yelena Krivosheev <yelena@marvell.com>
Reviewed-by: Dmitri Epshtein <dima@marvell.com>
Tested-by: Dmitri Epshtein <dima@marvell.com>
Signed-off-by: Zhong Hongbo <hongbo.zhong@windriver.com>
---
 drivers/net/ethernet/marvell/pp3/hmac/mv_hmac.c |    2 ++
 drivers/net/ethernet/marvell/pp3/hmac/mv_hmac.h |    2 +-
 2 files changed, 3 insertions(+), 1 deletions(-)

diff --git a/drivers/net/ethernet/marvell/pp3/hmac/mv_hmac.c b/drivers/net/ethernet/marvell/pp3/hmac/mv_hmac.c
index 75fef19..e97dbaa 100644
--- a/drivers/net/ethernet/marvell/pp3/hmac/mv_hmac.c
+++ b/drivers/net/ethernet/marvell/pp3/hmac/mv_hmac.c
@@ -124,6 +124,8 @@ void mv_pp3_hmac_frame_cfg(u32 frame, u8 vm_id)
 	reg_data = mv_pp3_hmac_gl_reg_read(MV_HMAC_VMID_FRAME_REG(frame));
 	U32_SET_FIELD(reg_data, MV_HMAC_VMID_FRAME_CONTEXT_ID_MASK,
 		(vm_id & MV_HMAC_VMID_FRAME_CONTEXT_ID_MASK) << MV_HMAC_VMID_FRAME_CONTEXT_ID_OFFS);
+	U32_SET_FIELD(reg_data, MV_HMAC_VMID_FRAME_AXI_PROT_PRIVILEGE_MASK,
+			((vm_id >> 6) & 1) << MV_HMAC_VMID_FRAME_AXI_PROT_PRIVILEGE_OFFS);
 	mv_pp3_hmac_gl_reg_write(MV_HMAC_VMID_FRAME_REG(frame), reg_data);
 
 	reg_data = mv_pp3_hmac_gl_reg_read(MV_HMAC_AXI_PROT_SECURE_REG(frame));
diff --git a/drivers/net/ethernet/marvell/pp3/hmac/mv_hmac.h b/drivers/net/ethernet/marvell/pp3/hmac/mv_hmac.h
index bfa2108..66fc3f2 100644
--- a/drivers/net/ethernet/marvell/pp3/hmac/mv_hmac.h
+++ b/drivers/net/ethernet/marvell/pp3/hmac/mv_hmac.h
@@ -189,7 +189,7 @@ static inline int mv_pp3_hmac_rxq_occ_get(int frame, int queue)
 /* Write a number of processed datagram (16 bytes each) */
 static inline void mv_pp3_hmac_rxq_occ_set(int frame, int queue, int size)
 {
-	mv_pp3_hmac_frame_reg_write(frame, MV_HMAC_REC_Q_OCC_STATUS_UPDATE_REG(queue), size);
+	mv_pp3_hmac_frame_reg_write(frame, MV_PP3_HMAC_RQ_OCC_STATUS(queue), size);
 }
 
 /* Returns pointer to next recieved CFH buffer and it */
-- 
1.7.5.4

