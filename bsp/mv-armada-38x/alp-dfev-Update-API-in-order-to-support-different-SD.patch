From fed8f92450a55f4e9848b8dfd6062ec898e7a4c3 Mon Sep 17 00:00:00 2001
From: Piotr Ziecik <kosmo@semihalf.com>
Date: Tue, 21 Jan 2014 14:43:10 +0100
Subject: [PATCH 1376/1825] alp: dfev: Update API in order to support
 different SDD call rates.

https://github.com/MISL-EBU-System-SW/misl-windriver.git linux-3.4.69-14t2-read
commit 5c0a5f6d9a4f45b05444a64f5be0176fee1dae91

	The SDD Firmware supports variable call rate. This commit
	updates the sdd_if module allowing for call rate configuration.

Change-Id: I73c73a6a97e6b79ba65216e6d491baa80f7a04ed
Signed-off-by: Piotr Ziecik <kosmo@semihalf.com>
Reviewed-on: http://vgitil04.il.marvell.com:8080/5833
Tested-by: Star_Automation <star@marvell.com>
Reviewed-by: Yehuda Yitschak <yehuday@marvell.com>
Signed-off-by: Zhong Hongbo <hongbo.zhong@windriver.com>
---
 arch/arm/plat-armada/include/plat/sdd_if.h         |    2 +-
 .../mv_drivers_lsp/mv_phone/slic/sdd_if.c          |    4 ++--
 2 files changed, 3 insertions(+), 3 deletions(-)

diff --git a/arch/arm/plat-armada/include/plat/sdd_if.h b/arch/arm/plat-armada/include/plat/sdd_if.h
index fdcdea8..01af8fe 100644
--- a/arch/arm/plat-armada/include/plat/sdd_if.h
+++ b/arch/arm/plat-armada/include/plat/sdd_if.h
@@ -77,7 +77,7 @@ extern void sdd_if_peripheral_reset(void);
 extern unsigned long sdd_if_read(unsigned long addr);
 extern void sdd_if_write(unsigned long data, unsigned long addr);
 
-extern int sdd_if_timer_request(irq_handler_t tickfcn);
+extern int sdd_if_timer_request(irq_handler_t tickfcn, unsigned int tickrate);
 extern void sdd_if_timer_release(void);
 extern void sdd_if_timer_start(void);
 extern void sdd_if_timer_stop(void);
diff --git a/arch/arm/plat-armada/mv_drivers_lsp/mv_phone/slic/sdd_if.c b/arch/arm/plat-armada/mv_drivers_lsp/mv_phone/slic/sdd_if.c
index a200e8d..2a9abc6 100644
--- a/arch/arm/plat-armada/mv_drivers_lsp/mv_phone/slic/sdd_if.c
+++ b/arch/arm/plat-armada/mv_drivers_lsp/mv_phone/slic/sdd_if.c
@@ -164,7 +164,7 @@ void sdd_if_write(unsigned long data, unsigned long addr)
 }
 EXPORT_SYMBOL(sdd_if_write);
 
-int sdd_if_timer_request(irq_handler_t tickfcn)
+int sdd_if_timer_request(irq_handler_t tickfcn, unsigned int tickrate)
 {
 	unsigned long tv;
 	int r;
@@ -174,7 +174,7 @@ int sdd_if_timer_request(irq_handler_t tickfcn)
 
 	sdd_if_tick = tickfcn;
 
-	tv = alp_soc_timer_rate_get() / 8000;
+	tv = alp_soc_timer_rate_get() / tickrate;
 	MV_REG_WRITE(TIMER_VAL(DFEV_TIMER), tv);
 	MV_REG_WRITE(TIMER_RELOAD(DFEV_TIMER), tv);
 	MV_REG_WRITE(TIMER_CAUSE, TIMER_INT_CLR(DFEV_TIMER));
-- 
1.7.5.4

