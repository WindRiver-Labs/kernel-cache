From 79e36642c467ccf5d92d758a61db87bfcfefb623 Mon Sep 17 00:00:00 2001
From: Omri Itach <omrii@marvell.com>
Date: Tue, 2 Apr 2013 10:17:40 +0300
Subject: [PATCH 0529/1825] ALP : SMI Master ctrl: updated method to use
 original group types

https://github.com/MISL-EBU-System-SW/misl-windriver.git linux-3.4.69-14t2-read
commit f9efbac5a06835e2268569c0e83dcf065ade335d

Change-Id: I85b1e6cb96a5c397910ddb7ec5deca1745d4d897
Reviewed-on: http://vgitil04.il.marvell.com:8080/1393
Reviewed-by: Eran Ben-Avi <benavi@marvell.com>
Tested-by: Eran Ben-Avi <benavi@marvell.com>
Signed-off-by: Zhong Hongbo <hongbo.zhong@windriver.com>
---
 .../avanta_lp_family/ctrlEnv/mvCtrlEnvLib.c        |   16 ++++++++--------
 .../avanta_lp_family/ctrlEnv/mvCtrlEnvLib.h        |    2 +-
 .../avanta_lp_family/ctrlEnv/mvCtrlEnvSpec.h       |    6 ------
 3 files changed, 9 insertions(+), 15 deletions(-)

diff --git a/arch/arm/mach-avantalp/avanta_lp_family/ctrlEnv/mvCtrlEnvLib.c b/arch/arm/mach-avantalp/avanta_lp_family/ctrlEnv/mvCtrlEnvLib.c
index 624a05f..9f299f0 100755
--- a/arch/arm/mach-avantalp/avanta_lp_family/ctrlEnv/mvCtrlEnvLib.c
+++ b/arch/arm/mach-avantalp/avanta_lp_family/ctrlEnv/mvCtrlEnvLib.c
@@ -275,7 +275,7 @@ MV_U32 mvCtrlSatRRead(MV_SATR_TYPE_ID satrField)
 }
 
 /*******************************************************************************
-* mvCtrlSMISet - alter Group 4 MPP type, between CPU SMI control and SWITCH SMI control
+* mvCtrlSmiMasterSet - alter Group 4 MPP type, between CPU SMI control and SWITCH SMI control
 *
 * DESCRIPTION: Read board configuration which is relevant to MPP group 4 interfaces,
 * 		to derive the correct group type, and according to input SMI conrtol,
@@ -288,7 +288,7 @@ MV_U32 mvCtrlSatRRead(MV_SATR_TYPE_ID satrField)
 * RETURN: None
 *
 *******************************************************************************/
-MV_VOID mvCtrlSMISet(MV_SMI_CTRL smiCtrl)
+MV_VOID mvCtrlSmiMasterSet(MV_SMI_CTRL smiCtrl)
 {
 	MV_BOOL isSwSMICtrl   = (smiCtrl == SWITCH_SMI_CTRL ? MV_TRUE : MV_FALSE);
 	MV_BOOL isBootDevSPI1 = (MSAR_0_BOOT_SPI1_FLASH == mvBoardBootDeviceGet());
@@ -303,14 +303,14 @@ MV_VOID mvCtrlSMISet(MV_SMI_CTRL smiCtrl)
 	/* MPP settings :
 	 * Test board configuration relevant to MPP group 4, and derive the correct group type */
 
-	if (isRefClkOut)
-		groupTypeSelect += REF_CLK_OUT_GROUP_4_BASE;
+	if (isRefClkOut)	/* add first REF_CLK_OUT group type */
+		groupTypeSelect += GE1_CPU_SMI_CTRL_REF_CLK_OUT;
 
-	if (isSwSMICtrl)
-		groupTypeSelect += SW_SMI_GROUP_4_BASE;
+	if (isSwSMICtrl)	/* add first SW_SMI group type */
+		groupTypeSelect += GE1_SW_SMI_CTRL_TDM_LQ_UNIT;
 
-	if (isBootDevSPI1)
-		groupTypeSelect += SPI1_GROUP_4_BASE;
+	if (isBootDevSPI1)	/* add first SPI1 group type */
+		groupTypeSelect += SPI1_CPU_SMI_CTRL_TDM_LQ_UNIT;
 
 	mvBoardMppGroupWrite(4, groupTypeSelect);
 
diff --git a/arch/arm/mach-avantalp/avanta_lp_family/ctrlEnv/mvCtrlEnvLib.h b/arch/arm/mach-avantalp/avanta_lp_family/ctrlEnv/mvCtrlEnvLib.h
index 68c83b3..c4e3387 100644
--- a/arch/arm/mach-avantalp/avanta_lp_family/ctrlEnv/mvCtrlEnvLib.h
+++ b/arch/arm/mach-avantalp/avanta_lp_family/ctrlEnv/mvCtrlEnvLib.h
@@ -318,7 +318,7 @@ MV_U32    ctrlSizeRegRoundUp(MV_U32 size, MV_U32 alignment);
 MV_U32 mvCtrlSysRstLengthCounterGet(MV_VOID);
 MV_STATUS ctrlWinOverlapTest(MV_ADDR_WIN *pAddrWin1, MV_ADDR_WIN *pAddrWin2);
 MV_STATUS ctrlWinWithinWinTest(MV_ADDR_WIN *pAddrWin1, MV_ADDR_WIN *pAddrWin2);
-MV_VOID mvCtrlSMISet(MV_SMI_CTRL smiCtrl);
+MV_VOID mvCtrlSmiMasterSet(MV_SMI_CTRL smiCtrl);
 MV_VOID   mvCtrlPwrClckSet(MV_UNIT_ID unitId, MV_U32 index, MV_BOOL enable);
 MV_BOOL   mvCtrlPwrClckGet(MV_UNIT_ID unitId, MV_U32 index);
 MV_VOID   mvCtrlPwrMemSet(MV_UNIT_ID unitId, MV_U32 index, MV_BOOL enable);
diff --git a/arch/arm/mach-avantalp/avanta_lp_family/ctrlEnv/mvCtrlEnvSpec.h b/arch/arm/mach-avantalp/avanta_lp_family/ctrlEnv/mvCtrlEnvSpec.h
index 77c4d0b..950f637 100755
--- a/arch/arm/mach-avantalp/avanta_lp_family/ctrlEnv/mvCtrlEnvSpec.h
+++ b/arch/arm/mach-avantalp/avanta_lp_family/ctrlEnv/mvCtrlEnvSpec.h
@@ -337,12 +337,6 @@ typedef enum {
 	SPI1_SW_SMI_CTRL_REF_CLK_OUT,
 } MV_GROUP_4_TYPE;
 
-/*  this defines are used when changing a group type value,
- *  to select the correct group type, according to active interfaces */
-#define REF_CLK_OUT_GROUP_4_BASE 	GE1_CPU_SMI_CTRL_REF_CLK_OUT
-#define SW_SMI_GROUP_4_BASE 		GE1_SW_SMI_CTRL_TDM_LQ_UNIT
-#define SPI1_GROUP_4_BASE 		SPI1_CPU_SMI_CTRL_TDM_LQ_UNIT
-
 #define MPP_GROUP_5_TYPE { \
 		0x22122220,     /* GE0      , PON_TX_FAULT */ \
 		0x22122222,     /* GE0      , PON_CLK_OUT */ \
-- 
1.7.5.4

