From 9527b550c2e65246c7d6e7231fad3b8e572e57d4 Mon Sep 17 00:00:00 2001
From: Victor Gu <xigu@marvell.com>
Date: Wed, 28 May 2014 17:07:31 +0800
Subject: [PATCH 1695/1825] fix: alp: tdmmc: spi cs issue in tdmmc case

https://github.com/MISL-EBU-System-SW/misl-windriver.git linux-3.4.69-14t2-read
commit bc453f9e4f11ea9bf983659265ffe80518c75109

    1. enlarge tmd info array to support tdmmc
    2. correct the tdm info SPI CS array for VE886 module
Signed-off-by: Victor Gu <xigu@marvell.com>

Change-Id: I3924fd1e63dd7e9b472f3948b75ab510c0466ab1
Reviewed-on: http://vgitil04.il.marvell.com:8080/8271
Tested-by: Star_Automation <star@marvell.com>
Reviewed-by: Yehuda Yitschak <yehuday@marvell.com>
Signed-off-by: Zhong Hongbo <hongbo.zhong@windriver.com>
---
 .../avanta_lp_family/boardEnv/mvBoardEnvLib.c      |    1 -
 .../avanta_lp_family/boardEnv/mvBoardEnvLib.h      |   12 ++----------
 .../avanta_lp_family/boardEnv/mvBoardEnvSpec.c     |   17 +++++++++--------
 3 files changed, 11 insertions(+), 19 deletions(-)

diff --git a/arch/arm/mach-avantalp/avanta_lp_family/boardEnv/mvBoardEnvLib.c b/arch/arm/mach-avantalp/avanta_lp_family/boardEnv/mvBoardEnvLib.c
index 636a755..41fbab9 100644
--- a/arch/arm/mach-avantalp/avanta_lp_family/boardEnv/mvBoardEnvLib.c
+++ b/arch/arm/mach-avantalp/avanta_lp_family/boardEnv/mvBoardEnvLib.c
@@ -1808,7 +1808,6 @@ MV_U8 mvBoardTdmSpiCsGet(MV_U8 devId)
 	if (index == -1)
 		return 0;
 
-
 	if (devId >= board->numBoardTdmInfo[index])
 		return -1;
 
diff --git a/arch/arm/mach-avantalp/avanta_lp_family/boardEnv/mvBoardEnvLib.h b/arch/arm/mach-avantalp/avanta_lp_family/boardEnv/mvBoardEnvLib.h
index 67c35d7..8b37877 100644
--- a/arch/arm/mach-avantalp/avanta_lp_family/boardEnv/mvBoardEnvLib.h
+++ b/arch/arm/mach-avantalp/avanta_lp_family/boardEnv/mvBoardEnvLib.h
@@ -92,7 +92,8 @@ typedef enum _devBoardSlicType {
 	MV_BOARD_SLIC_ZSI_ID, /* Zarlink ZSI Bus */
 	MV_BOARD_SLIC_TDM2C_ID, /* Cross vendor external SLIC for TDM2C */
 	MV_BOARD_SLIC_TDMMC_ID, /* Cross vendor external SLIC for TDMMC */
-	MV_BOARD_SLIC_MAX_OPTION
+	BOARD_TDM_SLIC_COUNT,
+	MV_BOARD_SLIC_MAX_OPTION = BOARD_TDM_SLIC_COUNT,
 } MV_BOARD_SLIC_TYPE;
 
 typedef enum _devBoardOtherTypeClass {
@@ -252,15 +253,6 @@ typedef struct {
 	MV_U8 spiId;
 } MV_BOARD_TDM_SPI_INFO;
 
-typedef enum {
-	BOARD_SLIC_880 = 0,
-	BOARD_SLIC_792,
-	BOARD_SLIC_SSI,
-	BOARD_SLIC_ISI,
-	BOARD_SLIC_ZSI,
-	BOARD_TDM_SLIC_COUNT
-} MV_BOARD_TDM_SLIC_TYPE;
-
 /* Board specific initialization. Performed before initializing the SoC. */
 typedef struct {
 	MV_U32 reg;
diff --git a/arch/arm/mach-avantalp/avanta_lp_family/boardEnv/mvBoardEnvSpec.c b/arch/arm/mach-avantalp/avanta_lp_family/boardEnv/mvBoardEnvSpec.c
index 3656dc5..0a55709 100644
--- a/arch/arm/mach-avantalp/avanta_lp_family/boardEnv/mvBoardEnvSpec.c
+++ b/arch/arm/mach-avantalp/avanta_lp_family/boardEnv/mvBoardEnvSpec.c
@@ -107,7 +107,7 @@ MV_DEV_CS_INFO avanta_lp_customer_board_0_InfoBoardDeCsInfo[] = {
 #endif
 };
 
-MV_BOARD_TDM_INFO avanta_lp_customer_board_0_Tdm886[] = { {0} };
+MV_BOARD_TDM_INFO avanta_lp_customer_board_0_Tdm886[] = { {0}, {1} };
 
 MV_BOARD_TDM_SPI_INFO avanta_lp_customer_board_0_TdmSpiInfo[] = { {1} };
 
@@ -161,7 +161,7 @@ MV_BOARD_INFO avanta_lp_customer_board_0_info = {
 	.gppPolarityValHigh		= AVANTA_LP_CUSTOMER_GPP_POL_HIGH,
 
 	/* TDM */
-	.numBoardTdmInfo		= {1},
+	.numBoardTdmInfo		= {2},
 	.pBoardTdmInt2CsInfo		= {avanta_lp_customer_board_0_Tdm886},
 	.boardTdmInfoIndex		= 0,
 
@@ -241,15 +241,15 @@ MV_BOARD_MPP_INFO db88f6660InfoBoardMppConfigValue[] = {
 		  DB_88F6660_MPP64_67,
 	 } }
 };
-
-MV_BOARD_TDM_INFO db88f6660Tdm880[] = { {0} };
-
 MV_BOARD_TDM_INFO db88f6660TdmZSI[] = { {2} };
 
 MV_BOARD_TDM_INFO db88f6660TdmISI[] = { {2} };
 
+MV_BOARD_TDM_INFO db88f6660Tdm2c[] = { {0} };
+
+MV_BOARD_TDM_INFO db88f6660Tdmmc[] = { {0}, {1}, {2} };
 
-MV_BOARD_TDM_SPI_INFO db88f6660TdmSpiInfo[] = {{-1}, {-1}, {1}, {1}, {1} };
+MV_BOARD_TDM_SPI_INFO db88f6660TdmSpiInfo[] = { {-1}, {-1}, {1}, {1}, {1}, {1} };
 
 MV_BOARD_INFO db88f6660_board_info = {
 	.boardName			= "DB-88F6660",
@@ -287,8 +287,9 @@ MV_BOARD_INFO db88f6660_board_info = {
 	.gppPolarityValHigh		= DB_88F6660_GPP_POL_HIGH,
 
 	/* TDM */
-	.numBoardTdmInfo		= {-1, -1, -1, 1, 1},
-	.pBoardTdmInt2CsInfo		= {NULL, NULL,  db88f6660TdmISI, db88f6660TdmZSI, db88f6660Tdm880},
+	.numBoardTdmInfo		= {-1, -1, -1, 1, 1, 3},
+	.pBoardTdmInt2CsInfo		= {NULL, NULL, db88f6660TdmISI, db88f6660TdmZSI, db88f6660Tdm2c,
+						db88f6660Tdmmc},
 	.boardTdmInfoIndex		= 0,
 
 	.pBoardSpecInit			= NULL,
-- 
1.7.5.4

