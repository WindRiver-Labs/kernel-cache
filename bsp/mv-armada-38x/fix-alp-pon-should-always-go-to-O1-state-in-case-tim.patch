From 3a56f67b825f456c6d0bd9ad62372777bdb594f2 Mon Sep 17 00:00:00 2001
From: Victor Gu <xigu@marvell.com>
Date: Wed, 21 May 2014 15:27:20 +0800
Subject: [PATCH 1678/1825] fix: alp: pon: should always go to O1 state in
 case time2 expires

https://github.com/MISL-EBU-System-SW/misl-windriver.git linux-3.4.69-14t2-read
commit 5a29804656758d4fdd17e2d0bdd5b4bc4e43a7b1

    set GPON MAC state machine to O1 in case time2 expires
Signed-off-by: Victor Gu <xigu@marvell.com>

Change-Id: I3e79092d192ae5baa8f7181b53d512728c7ed068
Reviewed-on: http://vgitil04.il.marvell.com:8080/8158
Tested-by: Star_Automation <star@marvell.com>
Reviewed-by: Yehuda Yitschak <yehuday@marvell.com>
Signed-off-by: Zhong Hongbo <hongbo.zhong@windriver.com>
---
 .../mv_pon/core/gpon/gponOnuMngrStateMachine.c     |    5 +----
 1 files changed, 1 insertions(+), 4 deletions(-)

diff --git a/arch/arm/plat-armada/mv_drivers_lsp/mv_pon/core/gpon/gponOnuMngrStateMachine.c b/arch/arm/plat-armada/mv_drivers_lsp/mv_pon/core/gpon/gponOnuMngrStateMachine.c
index 4fe59e0..b9302f8 100644
--- a/arch/arm/plat-armada/mv_drivers_lsp/mv_pon/core/gpon/gponOnuMngrStateMachine.c
+++ b/arch/arm/plat-armada/mv_drivers_lsp/mv_pon/core/gpon/gponOnuMngrStateMachine.c
@@ -2626,10 +2626,7 @@ void onuGponPonMngTimerT02ExpireHndl(void)
 
 	/* state handling */
 	/* ============== */
-	if (onuGponAsicAlarmStatusGet() == ONU_GPON_ALARM_OFF)
-		rcode = onuGponPonMngrUpdateState((MV_U32)ONU_GPON_02_STANDBY);
-	else
-		rcode = onuGponPonMngrUpdateState((MV_U32)ONU_GPON_01_INIT);
+	rcode = onuGponPonMngrUpdateState((MV_U32)ONU_GPON_01_INIT);
 	if (rcode != MV_OK) {
 		mvPonPrint(PON_PRINT_ERROR, PON_SM_MODULE,
 			   "ERROR: (%s:%d) onuGponPonMngrUpdateState(1)\n", __FILE_DESC__, __LINE__);
-- 
1.7.5.4

