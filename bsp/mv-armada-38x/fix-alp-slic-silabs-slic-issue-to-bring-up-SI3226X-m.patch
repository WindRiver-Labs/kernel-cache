From 23c69925d8107d13591929ca4b80371360cf3cd4 Mon Sep 17 00:00:00 2001
From: Victor Gu <xigu@marvell.com>
Date: Tue, 10 Jun 2014 23:17:10 +0800
Subject: [PATCH 1707/1825] fix: alp: slic: silabs slic issue to bring up
 SI3226X module

https://github.com/MISL-EBU-System-SW/misl-windriver.git linux-3.4.69-14t2-read
commit a2c9187760548c2992d164f193d2e92190059b27

    change device name from 'tdm' to 'tal', add kernel config to define
silicon labs sub modules.
Signed-off-by: Victor Gu <xigu@marvell.com>

Change-Id: I76f2e2382642b4ec40af1c8e8c44805989037de0
Reviewed-on: http://vgitil04.il.marvell.com:8080/8465
Tested-by: Star_Automation <star@marvell.com>
Reviewed-by: Yehuda Yitschak <yehuday@marvell.com>
Signed-off-by: Zhong Hongbo <hongbo.zhong@windriver.com>
---
 arch/arm/mach-avantalp/config/mvSysTdmConfig.h |    8 +++-----
 drivers/staging/telephony/mv_tdm/Kconfig       |   24 +++++++++++++++++++++++-
 tools/voice/silabs/mv_voice_tool.c             |    4 ++--
 3 files changed, 28 insertions(+), 8 deletions(-)

diff --git a/arch/arm/mach-avantalp/config/mvSysTdmConfig.h b/arch/arm/mach-avantalp/config/mvSysTdmConfig.h
index a59c49a..1f27b23 100644
--- a/arch/arm/mach-avantalp/config/mvSysTdmConfig.h
+++ b/arch/arm/mach-avantalp/config/mvSysTdmConfig.h
@@ -99,11 +99,9 @@ SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.
 /* SLIC vendor */
 #if defined(CONFIG_SILABS_SLIC_SUPPORT)
 	#define SILABS_SLIC_SUPPORT
-	#if defined(CONFIG_SILABS_SLIC_3215)
-		#define SILABS_SLIC_3215
-	#elif defined(CONFIG_SILABS_SLIC_3217)
-		#define SILABS_SLIC_3217
-	#elif defined(CONFIG_SILAB_SLIC_SI3226)
+	#if defined(CONFIG_SILABS_SLIC_SI3217x)
+		#define SI3217x
+	#elif defined(CONFIG_SILABS_SLIC_SI3226x)
 		#define SI3226X
 	#endif
 #elif defined(CONFIG_ZARLINK_SLIC_SUPPORT)
diff --git a/drivers/staging/telephony/mv_tdm/Kconfig b/drivers/staging/telephony/mv_tdm/Kconfig
index bc7220e..cee2b3c 100644
--- a/drivers/staging/telephony/mv_tdm/Kconfig
+++ b/drivers/staging/telephony/mv_tdm/Kconfig
@@ -69,7 +69,7 @@ endchoice
 choice
 	prompt "Silicon Labs SLIC Type(Parallel/Serial)"
 	depends on MV_PHONE && SILABS_SLIC_SUPPORT
-	default SILABS_PARALLEL_SLIC_SUPPORT
+##	default SILABS_PARALLEL_SLIC_SUPPORT
 
 config  SILABS_PARALLEL_SLIC_SUPPORT
 	bool "Support Silicon Labs Parallel devices"
@@ -113,6 +113,28 @@ config ZARLINK_SERIAL_SLIC_SUPPORT
 endchoice
 
 choice
+	prompt "Silicon Labs SLIC Device"
+	depends on MV_PHONE && SILABS_SLIC_SUPPORT
+
+config SILABS_SLIC_SI3226x
+	bool "Support Silicon Labs 3226x device"
+	---help---
+	Choosing this option enables
+	Silicon Labs SI3226x SLIC module.
+	SI3226x generally support up to
+	2 voice ports
+
+config SILABS_SLIC_SI3217x
+	bool "Support Silicon Labs 3217x device"
+	---help---
+	Choosing this option enables
+	Silicon Labs SI3217x SLIC module.
+	SI3217x generally support up to
+	1voice port
+
+endchoice
+
+choice
 	prompt "ZARLINK SLIC Device"
 	depends on MV_PHONE && ZARLINK_SLIC_SUPPORT
 	default ZARLINK_SLIC_VE880
diff --git a/tools/voice/silabs/mv_voice_tool.c b/tools/voice/silabs/mv_voice_tool.c
index 8ee4a9f..52fb4bb 100644
--- a/tools/voice/silabs/mv_voice_tool.c
+++ b/tools/voice/silabs/mv_voice_tool.c
@@ -110,7 +110,7 @@ static unsigned short cal_lines = 0;
 #endif
 static unsigned char time_slot_table[MAX_LINES];
 static unsigned char hook_state[MAX_LINES];
-static char dev_name[] = "/dev/tdm";
+static const char dev_name[] = "/dev/tal";
 static int buff_size = 0;
 static unsigned char aud_buf[2][320 * MAX_LINES];
 static unsigned short f1Mem = 0;
@@ -1167,7 +1167,7 @@ static int silabs_init(void)
 		return -1;
 	}
 
-	/* Assert hardware Reset â€“ ensure VDD, PCLK, and FSYNC are present and stable before releasing reset */
+	/* Assert hardware Reset â€?ensure VDD, PCLK, and FSYNC are present and stable before releasing reset */
 	status = silabs_channel_operation(SI_CHANNEL_OP_RESET, 0);
 	if (status != RC_NONE) {
 		printf("## Error, silabs_channel_operation (SI_CHANNEL_OP_RESET) failed (status=%d) ##\n", status);
-- 
1.7.5.4

