From a9141b7eb6ff59abf039b92443045dae313ccfa4 Mon Sep 17 00:00:00 2001
From: Nadav Haklai <nadavh@marvell.com>
Date: Mon, 28 Oct 2013 16:37:37 +0200
Subject: [PATCH 1115/1825] l2: a38x: Enable l2 for a38x

https://github.com/MISL-EBU-System-SW/misl-windriver.git linux-3.4.69-14t2-read
commit 8725cf0e8ee83f37ead0224a8e8873371cbc3d44

	Set correct number of ways and size for the l2x0 init function

Change-Id: I832066bafc93527a378041316480882e37f0c8f8
Signed-off-by: Nadav Haklai <nadavh@marvell.com>
Reviewed-on: http://vgitil04.il.marvell.com:8080/3896
Signed-off-by: Zhong Hongbo <hongbo.zhong@windriver.com>
---
 arch/arm/configs/armada_380_v7up_defconfig |    1 -
 arch/arm/mach-armada38x/core.c             |    7 ++++++-
 2 files changed, 6 insertions(+), 2 deletions(-)

diff --git a/arch/arm/configs/armada_380_v7up_defconfig b/arch/arm/configs/armada_380_v7up_defconfig
index 8e23659..41d58df 100644
--- a/arch/arm/configs/armada_380_v7up_defconfig
+++ b/arch/arm/configs/armada_380_v7up_defconfig
@@ -26,7 +26,6 @@ CONFIG_MV_ETH_TXQ_DESC=1024
 CONFIG_MV_ETH_DEBUG_CODE=y
 CONFIG_MV_ETH_STAT_DBG=y
 CONFIG_MV_ETH_GROUP0_CPU=0x1
-# CONFIG_CACHE_L2X0 is not set
 CONFIG_PCI_DEBUG=y
 CONFIG_AEABI=y
 CONFIG_UACCESS_WITH_MEMCPY=y
diff --git a/arch/arm/mach-armada38x/core.c b/arch/arm/mach-armada38x/core.c
index 6b68b8c..8a997c1 100644
--- a/arch/arm/mach-armada38x/core.c
+++ b/arch/arm/mach-armada38x/core.c
@@ -1253,7 +1253,12 @@ static void __init a38x_init_l2x0_cache(void)
 #ifdef CONFIG_CACHE_L2X0
 	void __iomem *l2x0_base =
 	    (void __iomem *)(INTER_REGS_VIRT_BASE + MV_CA9X2_L2CC_OFFSET);
-	l2x0_init(l2x0_base, 0x00400000, 0xfe0fffff);
+
+	/* 88F6820 - 16 ways, 88F6810 - 8 ways */
+	if (mvCtrlGetCpuNum())
+		l2x0_init(l2x0_base, 0x00470000, 0xfe0fffff);
+	else
+		l2x0_init(l2x0_base, 0x00460000, 0xfe0fffff);
 #endif
 }
 
-- 
1.7.5.4

