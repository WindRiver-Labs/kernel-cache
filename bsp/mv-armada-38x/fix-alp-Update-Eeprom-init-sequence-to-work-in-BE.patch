From 5878382c8dae6346e3e380c539977b1a7e41c7e8 Mon Sep 17 00:00:00 2001
From: talc <talc@marvell.com>
Date: Mon, 19 May 2014 15:46:33 +0300
Subject: [PATCH 1677/1825] fix: alp: Update Eeprom init sequence to work in
 BE

https://github.com/MISL-EBU-System-SW/misl-windriver.git linux-3.4.69-14t2-read
commit 366ab54b15c8ec6423147d39b07621432f533f48

	bug reason: the current code read the 4-bytes eprom header,
	byte after byte and refer the value as it little endian.
	This patch solve the issue by converting the reading values to BE.
	SYSTEMSW-561 : Eeprom init not working in BE mode.

Change-Id: I1a2e9a66ef87d4c3ccb627c42b59179febe612bf
Signed-off-by: talc <talc@marvell.com>
Reviewed-on: http://vgitil04.il.marvell.com:8080/8122
Tested-by: Star_Automation <star@marvell.com>
Reviewed-by: Shadi Ammouri <shadi@marvell.com>
Reviewed-by: Hanna Hawa <hannah@marvell.com>
Reviewed-by: Yehuda Yitschak <yehuday@marvell.com>
Signed-off-by: Zhong Hongbo <hongbo.zhong@windriver.com>
---
 .../avanta_lp_family/boardEnv/mvBoardEnvLib.c      |    2 ++
 1 files changed, 2 insertions(+), 0 deletions(-)

diff --git a/arch/arm/mach-avantalp/avanta_lp_family/boardEnv/mvBoardEnvLib.c b/arch/arm/mach-avantalp/avanta_lp_family/boardEnv/mvBoardEnvLib.c
index 81eb0f6..636a755 100644
--- a/arch/arm/mach-avantalp/avanta_lp_family/boardEnv/mvBoardEnvLib.c
+++ b/arch/arm/mach-avantalp/avanta_lp_family/boardEnv/mvBoardEnvLib.c
@@ -3085,8 +3085,10 @@ MV_STATUS mvBoardEepromInit()
 			mvOsPrintf("%s: Error: Read pattern from EEPROM failed\n", __func__);
 			return MV_ERROR;
 		}
+		readValue = MV_32BIT_LE_FAST(readValue);
 		/* shift byte to correct location in 32bit pattern */
 		pattern |= (readValue & 0x000000FF) << (32 - 8*(i+1));
+		readValue = 0;
 	}
 
 	/* If EEPROM is initialized with magic pattern, continue and exit*/
-- 
1.7.5.4

