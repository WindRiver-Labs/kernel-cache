From ef361ff6903001b667a7596f2592b6c55bbc5dd7 Mon Sep 17 00:00:00 2001
From: Eli Nidam <elini@marvell.com>
Date: Wed, 3 Jul 2013 12:29:54 +0300
Subject: [PATCH 0763/1825] eth-phy: improve output debug message

https://github.com/MISL-EBU-System-SW/misl-windriver.git linux-3.4.69-14t2-read
commit 5daa7c2fed3ce9f45294bbea04d6a1f636511343

	Add print message when phy write failed
	In debug mode print the phy write value.

Change-Id: I57b4d265fb46f45fd578d3c03f03c2f7680c6ed1
Signed-off-by: Eli Nidam <elini@marvell.com>
Reviewed-on: http://vgitil04.il.marvell.com:8080/2400
Reviewed-by: Star_Automation <star@marvell.com>
Reviewed-by: Shadi Ammouri <shadi@marvell.com>
Reviewed-by: Nadav Haklai <nadavh@marvell.com>
Tested-by: Nadav Haklai <nadavh@marvell.com>
Signed-off-by: Zhong Hongbo <hongbo.zhong@windriver.com>
---
 arch/arm/plat-armada/mv_hal/eth-phy/mvEthPhy.c |   20 ++++++++++++++------
 1 files changed, 14 insertions(+), 6 deletions(-)

diff --git a/arch/arm/plat-armada/mv_hal/eth-phy/mvEthPhy.c b/arch/arm/plat-armada/mv_hal/eth-phy/mvEthPhy.c
index e3cb34f..832b87e 100644
--- a/arch/arm/plat-armada/mv_hal/eth-phy/mvEthPhy.c
+++ b/arch/arm/plat-armada/mv_hal/eth-phy/mvEthPhy.c
@@ -130,19 +130,25 @@ MV_STATUS mvEthPhyInit(MV_U32 ethPortNum, MV_BOOL eeeEnable)
 		phyAddr = ethphyHalData.phyAddr[ethPortNum];
 
 	/* Set page as 0 */
-	if (mvEthPhyRegWrite(phyAddr, 22, 0) != MV_OK)
+	if (mvEthPhyRegWrite(phyAddr, 22, 0) != MV_OK) {
+		mvOsPrintf("Port%d: phyAddr=0x%x -  phy set page 0 failed\n", ethPortNum, phyAddr);
 		return MV_ERROR;
+	}
 
 	/* Reads ID1 */
-	if (mvEthPhyRegRead(phyAddr, 2, &id1) != MV_OK)
+	if (mvEthPhyRegRead(phyAddr, 2, &id1) != MV_OK) {
+		mvOsPrintf("Port%d: phyAddr=0x%x -  phy read id1 failed\n", ethPortNum, phyAddr);
 		return MV_ERROR;
+	}
 
 	/* Reads ID2 */
-	if (mvEthPhyRegRead(phyAddr, 3, &id2) != MV_OK)
+	if (mvEthPhyRegRead(phyAddr, 3, &id2) != MV_OK) {
+		mvOsPrintf("Port%d: phyAddr=0x%x -  phy read id2 failed\n", ethPortNum, phyAddr);
 		return MV_ERROR;
+	}
 
 	if (!MV_IS_MARVELL_OUI(id1, id2)) {
-		mvOsPrintf("Not Marvell PHY id1 %x id2 %x\n", id1, id2);
+		mvOsPrintf("Port%d: phyAddr=0x%x, Not Marvell PHY id1 %x id2 %x\n", ethPortNum, phyAddr, id1, id2);
 		return MV_ERROR;
 	}
 
@@ -359,6 +365,8 @@ MV_STATUS mvEthPhyRegWrite(MV_U32 phyAddr, MV_U32 regOffs, MV_U16 data)
 	smiReg &= ~ETH_PHY_SMI_OPCODE_READ;
 
 	/* write the smi register */
+	DB(printf("%s: phyAddr=0x%x offset = 0x%x data=0x%x\n", __func__, phyAddr, regOffs, data));
+	DB(printf("%s: ethphyHalData.ethPhySmiReg = 0x%x smiReg=0x%x\n", __func__, ethphyHalData.ethPhySmiReg, smiReg));
 	MV_REG_WRITE(ethphyHalData.ethPhySmiReg, smiReg);
 
 	return MV_OK;
@@ -1762,7 +1770,7 @@ MV_VOID mvEth1540A1PhyBasicInit(MV_U32 ethPortNum, MV_BOOL eeeEnable)
 	mvEthPhyRegWrite(i, 0x10, reg);
 	mvEthPhyRegWrite(i, 0x16, 0x0);
 
-	DB2(printf("%s: configure jumbo QuadPhyPort=0x%x offset = 0x%x\n",__FUNCTION__,port0, offs));
+	DB2(printf("%s: configure jumbo QuadPhyPort=0x%x offset = 0x%x\n", __func__, port0, offs));
 	if (0 == initJumboPackets) {
 		int j;
 		initJumboPackets = 1;
@@ -1923,7 +1931,7 @@ MV_VOID mvEth1540A0PhyBasicInit(MV_U32 ethPortNum, MV_BOOL eeeEnable)
 	mvEthPhyRegWrite(i, 0x10, reg);
 	mvEthPhyRegWrite(i, 0x16, 0x0);
 
-	DB2(printf("%s: configure jumbo QuadPhyPort=0x%x offset = 0x%x\n",__FUNCTION__,port0, offs));
+	DB2(printf("%s: configure jumbo QuadPhyPort=0x%x offset = 0x%x\n", __func__, port0, offs));
 	if (0 == initJumboPackets) {
 		int j;
 		initJumboPackets = 1;
-- 
1.7.5.4

