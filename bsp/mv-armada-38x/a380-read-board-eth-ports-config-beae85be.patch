From 13cba3ac883dc33e1e4e113b77def076612d4a7d Mon Sep 17 00:00:00 2001
From: Shadi Ammouri <shadi@marvell.com>
Date: Tue, 10 Dec 2013 10:45:01 +0200
Subject: [PATCH 1201/1825] a380: read board eth ports config

https://github.com/MISL-EBU-System-SW/misl-windriver.git linux-3.4.69-14t2-read
commit 69dc3f3b7a0e2bd8b47b408f21d5a57cae10a138

	- Read eth porst daynamicly according to board configuration
	- mvBoardIsEthConnected currently return MV_TRUE for eth0 and eth1

Change-Id: Ifb3caf757355d645ff4b1bb9ce36561f1baef662
Signed-off-by: Uri Eliyahu <uriel@marvell.com>
Reviewed-on: http://vgitil04.il.marvell.com:8080/4571
Reviewed-by: Dmitri Epshtein <dima@marvell.com>
Reviewed-by: Nadav Haklai <nadavh@marvell.com>
Tested-by: Nadav Haklai <nadavh@marvell.com>
Signed-off-by: Shadi Ammouri <shadi@marvell.com>
Reviewed-on: http://vgitil04.il.marvell.com:8080/4694
Tested-by: Star_Automation <star@marvell.com>
Reviewed-by: Igor Patrik <igorp@marvell.com>
Signed-off-by: Zhong Hongbo <hongbo.zhong@windriver.com>
---
 arch/arm/mach-armada38x/core.c |   11 +++--------
 1 files changed, 3 insertions(+), 8 deletions(-)

diff --git a/arch/arm/mach-armada38x/core.c b/arch/arm/mach-armada38x/core.c
index 1ef5fce..79880ff 100644
--- a/arch/arm/mach-armada38x/core.c
+++ b/arch/arm/mach-armada38x/core.c
@@ -656,20 +656,15 @@ static void __init eth_init(void)
 
 	devId = mvCtrlModelGet();
 
-	if ((mvUnitMapIsMine(ETH0) == MV_TRUE) &&
+	if ((mvUnitMapIsMine(ETH0) == MV_TRUE) && (mvBoardIsEthConnected(0)) &&
 	    (mvCtrlPwrClckGet(ETH_GIG_UNIT_ID, 0))) {
 		mv_neta_giga_pdev_register(&mv_neta_ge0_plat);
 	}
-	if ((mvUnitMapIsMine(ETH1) == MV_TRUE) &&
+	if ((mvUnitMapIsMine(ETH1) == MV_TRUE) && (mvBoardIsEthConnected(1)) &&
 	    (mvCtrlPwrClckGet(ETH_GIG_UNIT_ID, 1))) {
 		mv_neta_giga_pdev_register(&mv_neta_ge1_plat);
 	}
-#if 0
-	if ((devId != MV_6810_DEV_ID) && (mvUnitMapIsMine(ETH2) == MV_TRUE) &&
-	    (mvCtrlPwrClckGet(ETH_GIG_UNIT_ID, 2))) {
-		mv_neta_giga_pdev_register(&mv_neta_ge2_plat);
-	}
-#endif
+
 #endif /* CONFIG_MV_ETH_NETA) || CONFIG_MV_ETH_NETA_MODULE */
 }
 #endif /* CONFIG_MV_ETHERNET */
-- 
1.7.5.4

