From 293d503e47ad69661d09b1c9cd5152a4faab4d5a Mon Sep 17 00:00:00 2001
From: Zbigniew Bodek <zbb@semihalf.com>
Date: Mon, 15 Oct 2012 17:38:12 +0200
Subject: [PATCH 0402/1825] NAND: Fix NAND and sflash compilation

https://github.com/MISL-EBU-System-SW/misl-windriver.git linux-3.4.69-14t2-read
commit 3e8e484a888e64cef440fd471c261a3ca511a3a4

Change-Id: I7c00f3115729ba033951adcf01d8f259c68c619f
Signed-off-by: Zbigniew Bodek <zbb@semihalf.com>
Signed-off-by: Kosta Zertsekel <konszert@marvell.com>
Signed-off-by: Zhong Hongbo <hongbo.zhong@windriver.com>
---
 .../arm/plat-armada/mv_drivers_lsp/mv_mtd/sflash.c |   21 ++++++++++---------
 drivers/mtd/nand/nand_bbt.c                        |    2 +-
 2 files changed, 12 insertions(+), 11 deletions(-)

diff --git a/arch/arm/plat-armada/mv_drivers_lsp/mv_mtd/sflash.c b/arch/arm/plat-armada/mv_drivers_lsp/mv_mtd/sflash.c
index 534e93d..8510676 100644
--- a/arch/arm/plat-armada/mv_drivers_lsp/mv_mtd/sflash.c
+++ b/arch/arm/plat-armada/mv_drivers_lsp/mv_mtd/sflash.c
@@ -161,19 +161,20 @@ static struct mtd_info *sflash_probe(struct map_info *map)
 	mtd->size = sflash->sectorSize * sflash->sectorNumber;
 	mtd->priv = map; /*sflash;*/
 	mtd->type = MTD_NORFLASH;
-	mtd->erase = sflash_erase;
-	mtd->read = sflash_read;
-	mtd->write = sflash_write;
-	mtd->sync = sflash_sync;
-	mtd->suspend = sflash_suspend;
-	mtd->resume = sflash_resume;	
-	mtd->lock = sflash_lock;
-	mtd->unlock = sflash_unlock;
-	mtd->block_isbad = sflash_block_isbad;
-	mtd->block_markbad = sflash_block_markbad;	
+	mtd->_erase = sflash_erase;
+	mtd->_read = sflash_read;
+	mtd->_write = sflash_write;
+	mtd->_sync = sflash_sync;
+	mtd->_suspend = sflash_suspend;
+	mtd->_resume = sflash_resume;	
+	mtd->_lock = sflash_lock;
+	mtd->_unlock = sflash_unlock;
+	mtd->_block_isbad = sflash_block_isbad;
+	mtd->_block_markbad = sflash_block_markbad;	
 	mtd->flags = (MTD_WRITEABLE | MTD_BIT_WRITEABLE); /* just like MTD_CAP_NORFLASH */
 	mtd->name = map->name;
 	mtd->writesize = 1;
+	mtd->ecc_strength = 1;
 	
 	map->fldrv = &sflash_chipdrv;
 	map->fldrv_priv = sflash;
diff --git a/drivers/mtd/nand/nand_bbt.c b/drivers/mtd/nand/nand_bbt.c
index fe6c38e..680c8ee 100644
--- a/drivers/mtd/nand/nand_bbt.c
+++ b/drivers/mtd/nand/nand_bbt.c
@@ -464,7 +464,7 @@ static int scan_block_custom(struct mtd_info *mtd, struct nand_bbt_descr *bd,
 	ops.datbuf = buf;
 	ops.len = mtd->writesize;
 
-	ret = mtd->read_oob(mtd, (offs + (mtd->writesize * page)), &ops);
+	ret = mtd_read_oob(mtd, (offs + (mtd->writesize * page)), &ops);
 	if (ret)
 		return ret;
 
-- 
1.7.5.4

