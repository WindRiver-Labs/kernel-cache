From 31a3c670b11e51cb7190f9e93c31f357fefc378e Mon Sep 17 00:00:00 2001
From: Kosta Zertsekel <konszert@marvell.com>
Date: Wed, 1 May 2013 11:24:46 +0300
Subject: [PATCH 0619/1825] ALP: Disregard first data abort

https://github.com/MISL-EBU-System-SW/misl-windriver.git linux-3.4.69-14t2-read
commit 2e99f09c3fdb1385fd437f6c32880fd67b7ff7d1

Supposedly, the first data abort happens before Linux (in bootrom or U-Boot),
but stays pending till Linux enables exception.
Will be investigated further.

Signed-off-by: Kosta Zertsekel <konszert@marvell.com>
Change-Id: I961cd54b3e721330b7dafa0f52566a836187fa8d
Reviewed-on: http://vgitil04.il.marvell.com:8080/1711
Reviewed-by: Eran Ben-Avi <benavi@marvell.com>
Tested-by: Eran Ben-Avi <benavi@marvell.com>
Signed-off-by: Zhong Hongbo <hongbo.zhong@windriver.com>
---
 arch/arm/mm/fault.c |    6 ++++++
 1 files changed, 6 insertions(+), 0 deletions(-)

diff --git a/arch/arm/mm/fault.c b/arch/arm/mm/fault.c
index 7fa436d..cf1e5e6 100644
--- a/arch/arm/mm/fault.c
+++ b/arch/arm/mm/fault.c
@@ -568,12 +568,18 @@ hook_fault_code(int nr, int (*fn)(unsigned long, unsigned int, struct pt_regs *)
 /*
  * Dispatch a data abort to the relevant handler.
  */
+static int alp_first;
 asmlinkage void __exception
 do_DataAbort(unsigned long addr, unsigned int fsr, struct pt_regs *regs)
 {
 	const struct fsr_info *inf = fsr_info + fsr_fs(fsr);
 	struct siginfo info;
 
+	if (alp_first == 0) {
+		alp_first = 1;
+		return;
+	}
+
 	if (!inf->fn(addr, fsr & ~FSR_LNX_PF, regs))
 		return;
 
-- 
1.7.5.4

