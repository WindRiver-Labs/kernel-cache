From 74f522403afc5ea0a9c38d5527920cf8cfc54970 Mon Sep 17 00:00:00 2001
From: Hanna Hawa <hannah@marvell.com>
Date: Thu, 27 Feb 2014 19:36:04 +0200
Subject: [PATCH 1423/1825] alp: eth complex: update external SMI PHY address
 of RGMII-0 for ALP-A0

https://github.com/MISL-EBU-System-SW/misl-windriver.git linux-3.4.69-14t2-read
commit 0f20372a867ac48efaef330fb96871906a609bd0

	External PHY SMI address with extenal module for Zx revision is 0x8,
	for A0 the module is on board with address 0x5

Change-Id: Iffe649e8901d31845d3384504573b5a40be5bbf2
Signed-off-by: Hanna Hawa <hannah@marvell.com>
Reviewed-on: http://vgitil04.il.marvell.com:8080/5994
Tested-by: Star_Automation <star@marvell.com>
Reviewed-by: Omri Itach <omrii@marvell.com>
Tested-by: Omri Itach <omrii@marvell.com>
Signed-off-by: Zhong Hongbo <hongbo.zhong@windriver.com>
---
 .../avanta_lp_family/boardEnv/mvBoardEnvLib.c      |   10 ++++++++--
 1 files changed, 8 insertions(+), 2 deletions(-)

diff --git a/arch/arm/mach-avantalp/avanta_lp_family/boardEnv/mvBoardEnvLib.c b/arch/arm/mach-avantalp/avanta_lp_family/boardEnv/mvBoardEnvLib.c
index dad9c17..cacae55 100644
--- a/arch/arm/mach-avantalp/avanta_lp_family/boardEnv/mvBoardEnvLib.c
+++ b/arch/arm/mach-avantalp/avanta_lp_family/boardEnv/mvBoardEnvLib.c
@@ -919,8 +919,14 @@ MV_VOID mvBoardInfoUpdate(MV_VOID)
 	ethComplex = mvBoardEthComplexConfigGet();
 	if (ethComplex & MV_ETHCOMP_GE_MAC0_2_GE_PHY_P0)
 		smiAddress = 0x0;
-	else if (ethComplex & MV_ETHCOMP_GE_MAC0_2_RGMII0)
-		smiAddress = 0x8;
+	else if (ethComplex & MV_ETHCOMP_GE_MAC0_2_RGMII0) {
+		/* External PHY SMI address (extenal module) for Zx revision is
+		** 0x8, for A0 the module is on board with address 0x5 */
+		if (mvCtrlRevGet() < MV_88F66X0_Z3_ID)
+			smiAddress = 0x8;
+		else
+			smiAddress = 0x5;
+	}
 	else {				/* else MAC0 is connected to SW port 6 */
 		smiAddress = -1;	/* no SMI address if connected to switch */
 		if (ethComplex & MV_ETHCOMP_P2P_MAC0_2_SW_SPEED_2G)
-- 
1.7.5.4

