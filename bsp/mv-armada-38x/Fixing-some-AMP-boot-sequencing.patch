From 106bb6975228588144e1e9774a8c74f095585202 Mon Sep 17 00:00:00 2001
From: Tawfik Bayouk <tawfik@marvell.com>
Date: Tue, 21 Aug 2012 17:36:21 +0300
Subject: [PATCH 0226/1825] Fixing some AMP boot sequencing.

https://github.com/MISL-EBU-System-SW/misl-windriver.git linux-3.4.69-14t2-read
commit 8501335c36c74ac79b60ba64037261f3d6f410b9

Change-Id: If734e1e3e556fd277c7d30becbda2579e98656d4
Signed-off-by: Tawfik Bayouk <tawfik@marvell.com>
Signed-off-by: Kosta Zertsekel <konszert@marvell.com>
Signed-off-by: Zhong Hongbo <hongbo.zhong@windriver.com>
---
 arch/arm/mach-armadaxp/platsmp.c |   18 +++++++-----------
 1 files changed, 7 insertions(+), 11 deletions(-)

diff --git a/arch/arm/mach-armadaxp/platsmp.c b/arch/arm/mach-armadaxp/platsmp.c
index 48feb4f..e82bf48 100644
--- a/arch/arm/mach-armadaxp/platsmp.c
+++ b/arch/arm/mach-armadaxp/platsmp.c
@@ -363,22 +363,18 @@ void __init platform_smp_prepare_cpus(unsigned int max_cpus)
 	if (max_cpus > ncores)
 		max_cpus = ncores;
 
-#ifdef CONFIG_LOCAL_TIMERS
-	/*
-	 * Enable the local timer for primary CPU. If the device is
-	 * dummy (!CONFIG_LOCAL_TIMERS), it was already registers in
-	 * aurora_time_init
-	 */
-//	local_timer_setup();
-#endif
-
+	for (i = 0; i < NR_CPUS; i++){
+                set_cpu_possible(i, false);
+		set_cpu_present (i, false);
+	}
 	/*
 	 * Initialise the present map, which describes the set of CPUs
 	 * actually populated at the present time.
 	 */
-	for (i = 0; i < max_cpus; i++)
+	for (i = 0; i < max_cpus; i++){
+		set_cpu_possible(i, true);
 		set_cpu_present(i, true);
-
+	}
 	if (max_cpus > 1) {	
 		flush_cache_all();
 		wakeup_cpus();		
-- 
1.7.5.4

