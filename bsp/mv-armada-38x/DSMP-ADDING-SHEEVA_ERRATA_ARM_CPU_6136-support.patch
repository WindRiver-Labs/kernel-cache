From af89f161003e45da30caa450e1a63ff205d503f3 Mon Sep 17 00:00:00 2001
From: Tawfik Bayouk <tawfik@marvell.com>
Date: Tue, 21 Aug 2012 17:33:44 +0300
Subject: [PATCH 0069/1825] DSMP ADDING SHEEVA_ERRATA_ARM_CPU_6136 support

https://github.com/MISL-EBU-System-SW/misl-windriver.git linux-3.4.69-14t2-read
commit d342ef6cb2beccd89c09c879bba80b85f491ecaa

Change-Id: Ie5b82ef564c134740f2814f1453c10703d74627b
Signed-off-by: Tawfik Bayouk <tawfik@marvell.com>
Signed-off-by: Kosta Zertsekel <konszert@marvell.com>
Signed-off-by: Zhong Hongbo <hongbo.zhong@windriver.com>
---
 arch/arm/mm/Kconfig |   14 ++++++++++++++
 1 files changed, 14 insertions(+), 0 deletions(-)

diff --git a/arch/arm/mm/Kconfig b/arch/arm/mm/Kconfig
index 3f1a707..5a2393e 100644
--- a/arch/arm/mm/Kconfig
+++ b/arch/arm/mm/Kconfig
@@ -1044,6 +1044,20 @@ config SHEEVA_ERRATA_ARM_CPU_6076
 		cache evictions to the same address.  If L1 locking is not used, this bug is unlikely to occur.
 		Fix
 		-
+config SHEEVA_ERRATA_ARM_CPU_6136
+
+        bool "Sheeva Errata 6136: Base value gets corrupted after a page-crossing, boundary-crossing Load-Store-Multiple (LDSTM)"
+        depends on  CPU_SHEEVA_PJ4B_V7 && ARMADA_XP_REV_A0
+        default y
+        help
+	The scenario required to hit the bug starts with an LDM which is a cross-boundary, cross-page address.  The first part
+	hits in the cache, while the second part suffers an MMU fault.  Under this scenario, the source register does not get
+	restored after the fault occurs, causing data corruption.  NOTE: This can only happen on an LDM whose source is also
+	one of the destinations.  This can also only happen if the LDM has two destination registers in the register list.
+	Workaround
+	Set the "ldstm_first Two Sgl" bit[12] in the Auxiliary Debug Modes Control 0 Register.  This effectively forces the first
+	issue of a LDSTM to be a single word, avoiding the buggy condition.
+
 config SHEEVA_ERRATA_ARM_CPU_PMU_RESET
 	bool "Sheeva Errata CPU Performance counters reset"
 	depends on CPU_SHEEVA_PJ4B_V6 || CPU_SHEEVA_PJ4B_V7
-- 
1.7.5.4

