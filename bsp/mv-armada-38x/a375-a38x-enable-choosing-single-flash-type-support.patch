From af07ca1cb5cf8ed203d6f4c77256a94c69e5a26a Mon Sep 17 00:00:00 2001
From: Nadav Haklai <nadavh@marvell.com>
Date: Wed, 22 Jan 2014 13:17:07 +0200
Subject: [PATCH 1310/1825] a375: a38x: enable choosing single flash type
 support

https://github.com/MISL-EBU-System-SW/misl-windriver.git linux-3.4.69-14t2-read
commit d7ba48f2cd3746ec15a59faa5ade2d6c35b92c6f

	- this feature prevents from choosing support for more than one type of
	  the flash interfaces that share same MPP on A375/A38X SoC's
	- update help descriptions with A38X information

Change-Id: I818dec14a6d6bf781ca89e68ae28ab6ff845bb3a
Signed-off-by: Marcin Wojtas <mw@semihalf.com>
Signed-off-by: Nadav Haklai <nadavh@marvell.com>
Reviewed-on: http://vgitil04.il.marvell.com:8080/5246
Tested-by: Star_Automation <star@marvell.com>
Reviewed-on: http://vgitil04.il.marvell.com:8080/5308
Reviewed-by: Tawfik Bayouk <tawfik@marvell.com>
Reviewed-by: Yehuda Yitschak <yehuday@marvell.com>
Tested-by: Yehuda Yitschak <yehuday@marvell.com>
Signed-off-by: Zhong Hongbo <hongbo.zhong@windriver.com>
---
 arch/arm/plat-armada/Kconfig |   56 ++++++++++++++++++++++++++++++++++++------
 1 files changed, 48 insertions(+), 8 deletions(-)

diff --git a/arch/arm/plat-armada/Kconfig b/arch/arm/plat-armada/Kconfig
index 64ae3c9..a45ec0d 100644
--- a/arch/arm/plat-armada/Kconfig
+++ b/arch/arm/plat-armada/Kconfig
@@ -97,18 +97,22 @@ config MV_INCLUDE_CESA
 
 config MV_INCLUDE_NFC
 	bool "Nand Flash Controller Support"
-	depends on MV88F6500 || ARMADA_XP || ARMADA_370 || AVANTA_LP || ARMADA_38X
+	depends on MV88F6500 || ARMADA_XP || ARMADA_370 || AVANTA_LP || (ARMADA_38X && MV_CM_NFC)
 	default y
         help
-        Please don't change this configs unless you know what you are doing.
+	For Armada38x, the NFC,	Legacy NAND,
+	SPI and NOR share the same MPP pins.
+	You can not select more	than 1 at a time.
 
 config MV_INCLUDE_LEGACY_NAND
 	bool "Legacy NAND Support"
 	depends on MV88F6500 || MV88F6281 || MV78XX0 \
-		|| ARMADA_XP || ARMADA_370 || AVANTA_LP || ARMADA_38X
+		|| ARMADA_XP || ARMADA_370 || AVANTA_LP || (ARMADA_38X && MV_CM_LEGACY_NAND)
 	default y
         help
-        Please don't change this configs unless you know what you are doing.
+	For Armada38x, the NFC,	Legacy NAND,
+	SPI and NOR share the same MPP pins.
+	You can not select more	than 1 at a time.
 
 config MV_INCLUDE_INTEG_SATA
 	bool "Integrated SATA Support"
@@ -136,18 +140,22 @@ config MV_INCLUDE_GIG_ETH
 config MV_INCLUDE_SPI
 	bool "SPI Support"
 	depends on MV88F6500 || MV88F6281 || (MV78XX0 && !MV78XX0_Z0) || \
-		   ARMADA_XP || ARMADA_370 || AVANTA_LP || ARMADA_38X
+		   ARMADA_XP || ARMADA_370 || AVANTA_LP || (ARMADA_38X && MV_CM_SPI)
 	default y
 	help
-	  Please don't change this configs unless you know what you are doing.
+	For Armada38x, the NFC,	Legacy NAND,
+	SPI and NOR share the same MPP pins.
+	You can not select more	than 1 at a time.
 
 config MV_INCLUDE_NOR
 	bool "NOR Support"
 	depends on MV88F6500 || MV88F6281 || (MV78XX0 && !MV78XX0_Z0) || \
-		   ARMADA_XP || AVANTA_LP || ARMADA_38X
+		   ARMADA_XP || AVANTA_LP || (ARMADA_38X && MV_CM_NOR)
 	default y
 	help
-	  Please don't change this configs unless you know what you are doing.
+	For Armada38x, the NFC,	Legacy NAND,
+	SPI and NOR share the same MPP pins.
+	You can not select more	than 1 at a time.
 
 config MV_INCLUDE_SDIO
 	bool "SDIO Support"
@@ -185,6 +193,38 @@ config MV_INCLUDE_SWITCH
 	help
 	  TBD
 
+config MV_SUPPORT_COMMON_MPP_FLASH
+	bool "Flash Support"
+	depends on ARMADA_38X
+	default n
+        ---help---
+	For Armada38x, the NFC,	Legacy NAND, SPI
+	and NOR share the same MPP pins. You can
+	not select more	than 1 at a time.
+
+choice
+	prompt "Supported flash type"
+	depends on MV_SUPPORT_COMMON_MPP_FLASH
+	default MV_INCLUDE_SPI
+
+config MV_CM_SPI
+	bool "SPI Support"
+	select MV_INCLUDE_SPI
+
+config MV_CM_NOR
+	bool "NOR Support"
+	select MV_INCLUDE_NOR
+
+config MV_CM_NFC
+	bool "Nand Flash Controller Support"
+	select MV_INCLUDE_NFC
+
+config MV_CM_LEGACY_NAND
+	bool "Legacy NAND Support"
+	select MV_INCLUDE_LEGACY_NAND
+
+endchoice
+
 endmenu
 
 
-- 
1.7.5.4

