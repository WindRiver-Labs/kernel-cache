From 7f34d06cb15eec58e2f49ad71de45dd181a70a27 Mon Sep 17 00:00:00 2001
From: Dmitri Epshtein <dima@marvell.com>
Date: Mon, 5 Aug 2013 17:30:01 -0400
Subject: [PATCH 0925/1825] pp2: add wmb() after napi_complete and before
 enabling interrupts

https://github.com/MISL-EBU-System-SW/misl-windriver.git linux-3.4.69-14t2-read
commit 75d1e920471029541ee205548ecd63f524e646e2

Change-Id: I9185882098e2bacf42cb059d64fdf14ea7d46666
Signed-off-by: Dmitri Epshtein <dima@marvell.com>
Reviewed-on: http://vgitil04.il.marvell.com:8080/2947
Tested-by: Star_Automation <star@marvell.com>
Reviewed-by: Jonatan Farhadian <yonif@marvell.com>
Reviewed-by: Igor Patrik <igorp@marvell.com>
Signed-off-by: Zhong Hongbo <hongbo.zhong@windriver.com>
---
 .../mv_drivers_lsp/mv_pp2/net_dev/mv_netdev.c      |    3 ++-
 1 files changed, 2 insertions(+), 1 deletions(-)

diff --git a/arch/arm/plat-armada/mv_drivers_lsp/mv_pp2/net_dev/mv_netdev.c b/arch/arm/plat-armada/mv_drivers_lsp/mv_pp2/net_dev/mv_netdev.c
index 3f2ef9a..e519786 100644
--- a/arch/arm/plat-armada/mv_drivers_lsp/mv_pp2/net_dev/mv_netdev.c
+++ b/arch/arm/plat-armada/mv_drivers_lsp/mv_pp2/net_dev/mv_netdev.c
@@ -2652,7 +2652,7 @@ irqreturn_t mv_eth_isr(int irq, void *dev_id)
 	} else {
 		STAT_INFO(pp->stats.irq_err[cpu]++);
 #ifdef CONFIG_MV_ETH_DEBUG_CODE
-		pr_debug("%s: IRQ=%d, port=%d, cpu=%d, cpu_mask=0x%x - NAPI already scheduled\n",
+		pr_warning("%s: IRQ=%d, port=%d, cpu=%d, cpu_mask=0x%x - NAPI already scheduled\n",
 			__func__, irq, pp->port, cpu, napi_group->cpu_mask);
 #endif /* CONFIG_MV_ETH_DEBUG_CODE */
 	}
@@ -2860,6 +2860,7 @@ int mv_eth_poll(struct napi_struct *napi, int budget)
 			mv_eth_adaptive_rx_update(pp);
 
 		/* Enable interrupts for all cpus belong to this group */
+		wmb();
 		mvPp2GbeCpuInterruptsEnable(pp->port, napi_group->cpu_mask);
 	}
 	napi_group->cause_rx_tx = causeRxTx;
-- 
1.7.5.4

