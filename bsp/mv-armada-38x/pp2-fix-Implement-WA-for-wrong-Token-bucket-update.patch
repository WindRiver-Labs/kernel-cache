From 525c3bfe37ce53dfaf5bb1874ad4b2b63e8b5b61 Mon Sep 17 00:00:00 2001
From: Dmitri Epshtein <dima@marvell.com>
Date: Thu, 8 Aug 2013 15:20:25 -0400
Subject: [PATCH 0936/1825] pp2: fix: Implement WA for wrong Token bucket
 update

https://github.com/MISL-EBU-System-SW/misl-windriver.git linux-3.4.69-14t2-read
commit feefecc898f6fd9629beda9276ce340644780847

	Set TXA_MTU register value 3 * real MTU value in bits

Change-Id: I3ae1ea5f01564e7948171faa9310f2a5a240f640
Signed-off-by: Dmitri Epshtein <dima@marvell.com>
Reviewed-on: http://vgitil04.il.marvell.com:8080/2989
Reviewed-by: Igor Patrik <igorp@marvell.com>
Tested-by: Igor Patrik <igorp@marvell.com>
Signed-off-by: Zhong Hongbo <hongbo.zhong@windriver.com>
---
 arch/arm/plat-armada/mv_hal/pp2/gbe/mvPp2Gbe.c |    3 +++
 1 files changed, 3 insertions(+), 0 deletions(-)

diff --git a/arch/arm/plat-armada/mv_hal/pp2/gbe/mvPp2Gbe.c b/arch/arm/plat-armada/mv_hal/pp2/gbe/mvPp2Gbe.c
index be7503f..1acd3b8 100644
--- a/arch/arm/plat-armada/mv_hal/pp2/gbe/mvPp2Gbe.c
+++ b/arch/arm/plat-armada/mv_hal/pp2/gbe/mvPp2Gbe.c
@@ -1587,6 +1587,9 @@ MV_STATUS   mvPp2TxpMaxTxSizeSet(int port, int txp, int maxTxSize)
 	if (mtu > MV_PP2_TXP_MTU_MAX)
 		mtu = MV_PP2_TXP_MTU_MAX;
 
+	/* WA for wrong Token bucket update: Set MTU value = 3*real MTU value */
+	mtu = 3 * mtu;
+
 	txPortNum = mvPp2EgressPort(port, txp);
 
 	mvPp2WrReg(MV_PP2_TXP_SCHED_PORT_INDEX_REG, txPortNum);
-- 
1.7.5.4

