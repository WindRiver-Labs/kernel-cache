From 5dd1eabc17d902ea422a1aa36039338a3c42d59a Mon Sep 17 00:00:00 2001
From: Eli Nidam <elini@marvell.com>
Date: Tue, 25 Jun 2013 15:00:04 +0300
Subject: [PATCH 0750/1825] usb: implement ERRATA_FE_215660 USB Host May
 Transmit Truncated Packet with Good CRC

https://github.com/MISL-EBU-System-SW/misl-windriver.git linux-3.4.69-14t2-read
commit 7b014b88344cb9b3a1b12c0850ea38abd649d33a

	Underruns can occur due to memory bandwidth limitations when a USB host transmits data.
	When an underrun occurs, the host that transmits a truncated packet corrupts the packet's
	CRC bytes. The receiving device ignores truncated packets with a corrupt CRC, and the host
	re-transmits the packet. The USB host calculates the CRC bytes during packet transmission.
	When a packet is truncated due to an underrun, the host must invert the CRC byte value that
	is to be transmitted. Due to a logic error, one extra data byte is transmitted between the
	first and second CRC bytes. In very rare cases, there is a chance that a corrupted packet is
	transmitted with a good CRC.
	To prevent underruns from occurring, set "Stream Disable" to Active by
	writing 0x1 to bit[4] at offset: Port0: 0x501A8, Port1: 0x511A8.

Change-Id: I361b585a98669913bec05dd33c87377b8ff3fb54
Signed-off-by: Eli Nidam <elini@marvell.com>
Reviewed-on: http://vgitil04.il.marvell.com:8080/2351
Reviewed-by: Star_Automation <star@marvell.com>
Reviewed-by: Yehuda Yitschak <yehuday@marvell.com>
Reviewed-by: Nadav Haklai <nadavh@marvell.com>
Signed-off-by: Zhong Hongbo <hongbo.zhong@windriver.com>
---
 arch/arm/plat-armada/mv_hal/usb/mvUsb.c |    2 +-
 1 files changed, 1 insertions(+), 1 deletions(-)

diff --git a/arch/arm/plat-armada/mv_hal/usb/mvUsb.c b/arch/arm/plat-armada/mv_hal/usb/mvUsb.c
index becfd5e..521b1e4 100755
--- a/arch/arm/plat-armada/mv_hal/usb/mvUsb.c
+++ b/arch/arm/plat-armada/mv_hal/usb/mvUsb.c
@@ -855,7 +855,7 @@ MV_STATUS mvUsbHalInit(int dev, MV_BOOL isHost, MV_USB_HAL_DATA *halData)
 	else
 		regVal = MV_USB_CORE_MODE_DEVICE | MV_USB_CORE_SETUP_LOCK_DISABLE_MASK;
 
-#if (MV_USB_VERSION == 0)
+#ifdef ERRATA_FE_215660
 	regVal |= MV_USB_CORE_STREAM_DISABLE_MASK;
 #endif
 
-- 
1.7.5.4

