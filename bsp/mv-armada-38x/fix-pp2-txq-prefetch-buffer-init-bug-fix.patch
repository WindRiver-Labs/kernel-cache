From 69e2f312cf4f84364ba54b54a0c75d7f963a0d50 Mon Sep 17 00:00:00 2001
From: Uri Eliyahu <uriel@marvell.com>
Date: Thu, 16 Jan 2014 14:28:22 +0200
Subject: [PATCH 1285/1825] fix: pp2: txq prefetch buffer init bug fix

https://github.com/MISL-EBU-System-SW/misl-windriver.git linux-3.4.69-14t2-read
commit 8c239a82f61f8783236e6e427aa1cc32ef422370

	- fix wrong init of txq prefetch buffer

Change-Id: Ie8ad2c7b32eec71f1180fcdcdbc6f1a0b6da34bd
Signed-off-by: Uri Eliyahu <uriel@marvell.com>
Reviewed-on: http://vgitil04.il.marvell.com:8080/5191
Tested-by: Star_Automation <star@marvell.com>
Reviewed-by: Dmitri Epshtein <dima@marvell.com>
Signed-off-by: Zhong Hongbo <hongbo.zhong@windriver.com>
---
 arch/arm/plat-armada/mv_hal/pp2/gbe/mvPp2Gbe.c |    3 ++-
 1 files changed, 2 insertions(+), 1 deletions(-)

diff --git a/arch/arm/plat-armada/mv_hal/pp2/gbe/mvPp2Gbe.c b/arch/arm/plat-armada/mv_hal/pp2/gbe/mvPp2Gbe.c
index bcb57e9..312d1eb 100644
--- a/arch/arm/plat-armada/mv_hal/pp2/gbe/mvPp2Gbe.c
+++ b/arch/arm/plat-armada/mv_hal/pp2/gbe/mvPp2Gbe.c
@@ -676,7 +676,8 @@ MV_PP2_PHYS_TXQ_CTRL *mvPp2TxqInit(int port, int txp, int txq, int descNum, int
 	if (MV_PON_PORT(port))
 		desc = ptxq * descPerTxq;
 	else
-		desc = (mvPp2HalData.maxTcont * MV_ETH_MAX_TXQ * descPerTxq) + (port * MV_ETH_MAX_TXQ * descPerTxq);
+		desc = (mvPp2HalData.maxTcont * MV_ETH_MAX_TXQ * descPerTxq) +
+			(port * MV_ETH_MAX_TXQ * descPerTxq) + (txq * descPerTxq);
 
 	mvPp2WrReg(MV_PP2_TXQ_PREF_BUF_REG, MV_PP2_PREF_BUF_PTR(desc) | MV_PP2_PREF_BUF_SIZE_16 |
 				MV_PP2_PREF_BUF_THRESH(descPerTxq/2));
-- 
1.7.5.4

