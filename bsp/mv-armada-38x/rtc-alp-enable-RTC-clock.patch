From 338b76cb80624065e32ce0e69c8a02dfaee65d68 Mon Sep 17 00:00:00 2001
From: Kosta Zertsekel <konszert@marvell.com>
Date: Thu, 1 Aug 2013 16:09:31 +0300
Subject: [PATCH 0917/1825] rtc: alp: enable RTC clock

https://github.com/MISL-EBU-System-SW/misl-windriver.git linux-3.4.69-14t2-read
commit 992c2aa48e3bf5543c4dfd1652484972a42aa2d5

	RTC was tested in U-Boot using date command and in Linux
	using hwclock utility.

Change-Id: I1f63bffd2365eeb46dacf56df6cb94bdf477777f
Signed-off-by: Kosta Zertsekel <konszert@marvell.com>
Reviewed-on: http://vgitil04.il.marvell.com:8080/2918
Reviewed-by: Igor Patrik <igorp@marvell.com>
Tested-by: Igor Patrik <igorp@marvell.com>
Signed-off-by: Zhong Hongbo <hongbo.zhong@windriver.com>
---
 arch/arm/configs/avanta_lp_defconfig |    1 +
 arch/arm/mach-avantalp/core.c        |    4 +++-
 drivers/rtc/Kconfig                  |    3 ++-
 3 files changed, 6 insertions(+), 2 deletions(-)

diff --git a/arch/arm/configs/avanta_lp_defconfig b/arch/arm/configs/avanta_lp_defconfig
index ca06cff..cd4eb00 100644
--- a/arch/arm/configs/avanta_lp_defconfig
+++ b/arch/arm/configs/avanta_lp_defconfig
@@ -132,6 +132,7 @@ CONFIG_USB_STORAGE_SDDR55=y
 CONFIG_USB_STORAGE_JUMPSHOT=y
 CONFIG_NEW_LEDS=y
 CONFIG_RTC_CLASS=y
+CONFIG_RTC_DRV_MV=y
 CONFIG_DMADEVICES=y
 CONFIG_MV_XOR=y
 CONFIG_DMATEST=m
diff --git a/arch/arm/mach-avantalp/core.c b/arch/arm/mach-avantalp/core.c
index 4ee3d99..1b0f4b7 100644
--- a/arch/arm/mach-avantalp/core.c
+++ b/arch/arm/mach-avantalp/core.c
@@ -822,7 +822,9 @@ static struct resource rtc_resource[] = {
 
 static void __init alp_rtc_init(void)
 {
+#ifdef CONFIG_RTC_DRV_MV
 	platform_device_register_simple("rtc-mv", -1, rtc_resource, 2);
+#endif
 }
 
 /*******************************************************************************
@@ -1454,10 +1456,10 @@ static void __init alp_board_init(void)
 	alp_xor_init();
 	alp_sata_init();
 	alp_nand_nfc_init();
+	alp_rtc_init();
 
 #if 0
 	alp_gpio_init();
-	alp_rtc_init();
 	alp_hwmon_init();
 	alp_i2c_init();
 	alp_sdio_init();
diff --git a/drivers/rtc/Kconfig b/drivers/rtc/Kconfig
index c00651a..7eda19e 100644
--- a/drivers/rtc/Kconfig
+++ b/drivers/rtc/Kconfig
@@ -979,7 +979,8 @@ config RTC_DRV_TX4939
 
 config RTC_DRV_MV
 	tristate "Marvell SoC RTC"
-	depends on ARCH_KIRKWOOD || ARCH_DOVE || ARCH_ARMADA_XP || ARCH_ARMADA370
+	depends on ARCH_KIRKWOOD || ARCH_DOVE || \
+		   ARCH_ARMADA_XP || ARCH_ARMADA370 || ARCH_AVANTA_LP
 	help
 	  If you say yes here you will get support for the in-chip RTC
 	  that can be found in some of Marvell's SoC devices, such as
-- 
1.7.5.4

