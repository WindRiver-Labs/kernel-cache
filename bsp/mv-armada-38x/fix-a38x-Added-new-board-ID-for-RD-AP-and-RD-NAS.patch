From fe531fe10335508680fa70a7880210083c16711b Mon Sep 17 00:00:00 2001
From: Eli Nidam <elini@marvell.com>
Date: Tue, 26 Nov 2013 14:57:11 +0200
Subject: [PATCH 1172/1825] fix: a38x: Added new board ID for RD-AP and RD-NAS

https://github.com/MISL-EBU-System-SW/misl-windriver.git linux-3.4.69-14t2-read
commit c651a4ea091c775781e7c8b63242e6b891888566

		1. Change the current RD board ID to RD-NAS board ID
		2. Added new board ID for RD-AP
		3. Remove S@R RD commands
		4. Update all board spec tablets depended on board ID
		5. Removed unused MPP module definitions
		6. Enable write board ID for RD board

Change-Id: I8b3f142567c05074be1027baf65ff846ab677d36
Signed-off-by: Eli Nidam <elini@marvell.com>
Reviewed-on: http://vgitil04.il.marvell.com:8080/4470
Tested-by: Star_Automation <star@marvell.com>
Reviewed-by: Omri Itach <omrii@marvell.com>
Reviewed-by: Tawfik Bayouk <tawfik@marvell.com>
Signed-off-by: Zhong Hongbo <hongbo.zhong@windriver.com>
---
 .../armada_38x_family/boardEnv/mvBoardEnvLib.c     |   14 ++---
 .../armada_38x_family/boardEnv/mvBoardEnvLib.h     |   53 +++++++-----------
 .../armada_38x_family/boardEnv/mvBoardEnvSpec.c    |   57 ++++++++++++++++++-
 .../armada_38x_family/boardEnv/mvBoardEnvSpec.h    |    7 ++-
 .../armada_38x_family/ctrlEnv/mvCtrlEnvLib.h       |    4 --
 5 files changed, 83 insertions(+), 52 deletions(-)

diff --git a/arch/arm/mach-armada38x/armada_38x_family/boardEnv/mvBoardEnvLib.c b/arch/arm/mach-armada38x/armada_38x_family/boardEnv/mvBoardEnvLib.c
index 3db0ac2..8d4a862 100644
--- a/arch/arm/mach-armada38x/armada_38x_family/boardEnv/mvBoardEnvLib.c
+++ b/arch/arm/mach-armada38x/armada_38x_family/boardEnv/mvBoardEnvLib.c
@@ -1208,17 +1208,13 @@ MV_VOID mvBoardMppModuleTypePrint(MV_VOID)
 {
 	int i;
 	char *moduleStr[MV_CONFIG_TYPE_MAX_MODULE] = { \
-		"SGMII",                                \
 		"MII",                                  \
 		"TDM",                                  \
-		"I2S",                                  \
-		"SPDIF",                                \
-		"SERDES PEX LANE1",                     \
-		"SERDES PEX LANE2",                     \
-		"NOR",                                  \
-		"NAND",                                 \
-		"SDIO",                                 \
-		"GIGA"
+		"AUDIO I2S",                     \
+		"AUDIO SPDIF",                   \
+		"NOR 16bit",                                  \
+		"NAND 16bit",                                 \
+		"SDIO 4bit",                                 \
 	};
 	mvOsOutput("Board configuration detected:\n");
 
diff --git a/arch/arm/mach-armada38x/armada_38x_family/boardEnv/mvBoardEnvLib.h b/arch/arm/mach-armada38x/armada_38x_family/boardEnv/mvBoardEnvLib.h
index dd3e491..b855e8f 100644
--- a/arch/arm/mach-armada38x/armada_38x_family/boardEnv/mvBoardEnvLib.h
+++ b/arch/arm/mach-armada38x/armada_38x_family/boardEnv/mvBoardEnvLib.h
@@ -165,10 +165,6 @@ typedef enum _mvSatRTypeID {
 	MV_SATR_DDR_BUS_WIDTH,
 	MV_SATR_DDR_ECC_ENABLE,
 	MV_SATR_NAND_DETECT,
-	MV_SATR_RD_LANE1_2_CFG,
-	MV_SATR_RD_LANE4_CFG,
-	MV_SATR_RD_LANE0_CFG,
-	MV_SATR_RD_APPS_CFG,
 	MV_SATR_BOOT_DEVICE,
 	MV_SATR_BOOT2_DEVICE,
 	MV_SATR_BOARD_ID,
@@ -363,19 +359,14 @@ typedef struct _boardInfo {
 
 /* {{MV_CONFIG_TYPE_ID ConfigID, twsi-ID,  Offset, ID,  isActiveForBoard[]}} */
 #define MV_BOARD_CONFIG_INFO { \
-{ MV_CONFIG_SGMII,		0x2,	0,	 0xD,	{ 0, 1, 0} }, \
-{ MV_CONFIG_MII,		0x1,	0,	 0x4,	{ 0, 1, 0} }, \
-{ MV_CONFIG_SLIC_TDM_DEVICE,	0x0,	0,	 0x1,	{ 0, 1, 0} }, \
-{ MV_CONFIG_I2S_DEVICE,		0x1,	0,	 0x3,	{ 0, 1, 0} }, \
-{ MV_CONFIG_SPDIF_DEVICE,	0x1,	0,	 0x2,	{ 0, 1, 0} }, \
-{ MV_CONFIG_SERDES_PEX_LAN1,	0x3,	0,	 0xC,	{ 0, 1, 0} }, \
-{ MV_CONFIG_SERDES_PEX_LAN2,	0x3,	0,	 0xD,	{ 0, 1, 0} }, \
-{ MV_CONFIG_NOR,		0x4,	0,	 0xF,	{ 0, 1, 0} }, \
-{ MV_CONFIG_NAND,		0x4,	0,	 0x1,	{ 0, 1, 0} }, \
-{ MV_CONFIG_SDIO,		0x4,	0,	 0x2,	{ 0, 1, 0} }, \
-{ MV_CONFIG_GIGA,		0x5,	0,	 0xE,	{ 0, 1, 0} }, \
+{ MV_CONFIG_MII,		0x1,	0,	 0x4,	{ 0, 1, 0, 0} }, \
+{ MV_CONFIG_SLIC_TDM_DEVICE,	0x0,	0,	 0x1,	{ 0, 1, 0, 0} }, \
+{ MV_CONFIG_I2S_DEVICE,		0x1,	0,	 0x3,	{ 0, 1, 0, 0} }, \
+{ MV_CONFIG_SPDIF_DEVICE,	0x1,	0,	 0x2,	{ 0, 1, 0, 0} }, \
+{ MV_CONFIG_NOR,		0x4,	0,	 0xF,	{ 0, 1, 0, 0} }, \
+{ MV_CONFIG_NAND,		0x4,	0,	 0x1,	{ 0, 1, 0, 0} }, \
+{ MV_CONFIG_SDIO,		0x4,	0,	 0x2,	{ 0, 1, 0, 0} }, \
 };
-
 struct _mvBoardMppModule {
 	MV_U32 group;
 	MV_U32 mppValue;
@@ -516,23 +507,19 @@ MV_STATUS mvBoardSatRWrite(MV_SATR_TYPE_ID satrWriteField, MV_U8 val);
 /*    SATR-ID                   Mask    bit    TWSI   Reg  board	*/
 /*    SATR-ID                   Mask  offset  devID  num  active	*/
 #define MV_SAR_INFO { \
-{ MV_SATR_CPU_DDR_L2_FREQ,	0x1F,	0,	1,	0,	{1, 1, 0}, BOARD_SATR_SWAP_BIT},\
-{ MV_SATR_CORE_CLK_SELECT,	0x04,	2,	3,	0,	{0, 1, 0}, 0},\
-{ MV_SATR_CPU1_ENABLE,		0x01,	0,	2,	0,	{0, 1, 0}, 0},\
-{ MV_SATR_SSCG_DISABLE,		0x08,	3,	3,	0,	{0, 1, 0}, 0},\
-{ MV_SATR_DDR4_SELECT,		0x20,	5,	4,	1,	{0, 1, 0}, BOARD_SATR_READ_ONLY},\
-{ MV_SATR_DDR_BUS_WIDTH,	0x02,	1,	4,	0,	{0, 1, 0}, BOARD_SATR_READ_ONLY},\
-{ MV_SATR_DDR_ECC_ENABLE,	0x04,	2,	4,	0,	{0, 1, 0}, 0},\
-{ MV_SATR_NAND_DETECT,		0x1,	0,	4,	1,	{0, 1, 0}, BOARD_SATR_READ_ONLY},\
-{ MV_SATR_RD_LANE1_2_CFG,	0x1,	0,	1,	1,	{1, 0, 0}, 0},\
-{ MV_SATR_RD_LANE4_CFG,		0x2,	1,	1,	1,	{1, 0, 0}, 0},\
-{ MV_SATR_RD_LANE0_CFG,		0x4,	2,	1,	1,	{1, 0, 0}, 0},\
-{ MV_SATR_RD_APPS_CFG,		0x8,	3,	1,	1,	{1, 0, 0}, 0},\
-{ MV_SATR_BOOT_DEVICE,		0x3,	0,	3,	0,	{0, 1, 0}, BOARD_SATR_SWAP_BIT},\
-{ MV_SATR_BOOT2_DEVICE,		0x1E,	1,	2,	0,	{0, 1, 0}, BOARD_SATR_SWAP_BIT},\
-{ MV_SATR_BOARD_ID,		0x7,	0,	0,	0,	{1, 1, 0}, BOARD_SATR_READ_ONLY},\
-{ MV_SATR_BOARD_ECO_VERSION,	0xff,	0,	0,	1,	{1, 1, 0}, BOARD_SATR_READ_ONLY},\
-{ MV_SATR_MAX_OPTION,		0x0,	0,	0,	0,	{0, 0, 0}, 0},\
+{ MV_SATR_CPU_DDR_L2_FREQ,	0x1F,	0,	1,	0,	{1, 1, 1, 0}, BOARD_SATR_SWAP_BIT},\
+{ MV_SATR_CORE_CLK_SELECT,	0x04,	2,	3,	0,	{0, 1, 0, 0}, 0},\
+{ MV_SATR_CPU1_ENABLE,		0x01,	0,	2,	0,	{0, 1, 0, 0}, 0},\
+{ MV_SATR_SSCG_DISABLE,		0x08,	3,	3,	0,	{0, 1, 0, 0}, 0},\
+{ MV_SATR_DDR4_SELECT,		0x20,	5,	4,	1,	{0, 1, 0, 0}, BOARD_SATR_READ_ONLY},\
+{ MV_SATR_DDR_BUS_WIDTH,	0x02,	1,	4,	0,	{0, 1, 0, 0}, BOARD_SATR_READ_ONLY},\
+{ MV_SATR_DDR_ECC_ENABLE,	0x04,	2,	4,	0,	{0, 1, 0, 0}, 0},\
+{ MV_SATR_NAND_DETECT,		0x1,	0,	4,	1,	{0, 1, 0, 0}, BOARD_SATR_READ_ONLY},\
+{ MV_SATR_BOOT_DEVICE,		0x3,	0,	3,	0,	{0, 1, 0, 0}, BOARD_SATR_SWAP_BIT},\
+{ MV_SATR_BOOT2_DEVICE,		0x1E,	1,	2,	0,	{0, 1, 0, 0}, BOARD_SATR_SWAP_BIT},\
+{ MV_SATR_BOARD_ID,		0x7,	0,	0,	0,	{1, 1, 1, 0}, 0},\
+{ MV_SATR_BOARD_ECO_VERSION,	0xff,	0,	0,	1,	{1, 1, 1, 0}, BOARD_SATR_READ_ONLY},\
+{ MV_SATR_MAX_OPTION,		0x0,	0,	0,	0,	{0, 0, 0, 0}, 0},\
 };
 
 
diff --git a/arch/arm/mach-armada38x/armada_38x_family/boardEnv/mvBoardEnvSpec.c b/arch/arm/mach-armada38x/armada_38x_family/boardEnv/mvBoardEnvSpec.c
index e82c1fb..e521226 100644
--- a/arch/arm/mach-armada38x/armada_38x_family/boardEnv/mvBoardEnvSpec.c
+++ b/arch/arm/mach-armada38x/armada_38x_family/boardEnv/mvBoardEnvSpec.c
@@ -224,8 +224,57 @@ MV_BOARD_MPP_INFO rd88f68XXInfoBoardMppConfigValue[] = {
 	} }
 };
 
-MV_BOARD_INFO rd88f68XX_board_info = {
-	.boardName			= "RD-88F6820-DDR3",
+MV_BOARD_INFO rdNas88f68XX_board_info = {
+	.boardName			= "RD-NAS-88F6820-DDR3",
+	.numBoardMppTypeValue	= ARRSZ(rd88f68XXInfoBoardMppConfigValue),
+	.pBoardModTypeValue		= NULL,
+	.pBoardMppConfigValue	= rd88f68XXInfoBoardMppConfigValue,
+	.intsGppMaskLow			= 0,
+	.intsGppMaskMid			= 0,
+	.intsGppMaskHigh		= 0,
+	.numBoardDeviceIf		= ARRSZ(rd88F68XXInfoBoardDeCsInfo),
+	.pDevCsInfo				= rd88F68XXInfoBoardDeCsInfo,
+	.numBoardTwsiDev		= ARRSZ(rd88F68XXInfoBoardTwsiDev),
+	.pBoardTwsiDev			= rd88F68XXInfoBoardTwsiDev,
+	.numBoardMacInfo		= ARRSZ(rd88F68XXInfoBoardMacInfo),
+	.pBoardMacInfo			= rd88F68XXInfoBoardMacInfo,
+	.numBoardGppInfo		= 0,
+	.pBoardGppInfo			= 0,
+	.activeLedsNumber		= 0,
+	.pLedGppPin			= NULL,
+	.ledsPolarity			= 0,
+
+	/* PMU Power */
+	.pmuPwrUpPolarity		= 0,
+	.pmuPwrUpDelay			= 80000,
+
+	/* GPP values */
+	.gppOutEnValLow			= RD_88F68XX_GPP_OUT_ENA_LOW,
+	.gppOutEnValMid			= RD_88F68XX_GPP_OUT_ENA_MID,
+	.gppOutValLow			= RD_88F68XX_GPP_OUT_VAL_LOW,
+	.gppOutValMid			= RD_88F68XX_GPP_OUT_VAL_MID,
+	.gppPolarityValLow		= RD_88F68XX_GPP_POL_LOW,
+	.gppPolarityValMid		= RD_88F68XX_GPP_POL_MID,
+
+	/* TDM */
+	.numBoardTdmInfo		= {},
+	.pBoardTdmInt2CsInfo		= {},
+	.boardTdmInfoIndex		= -1,
+
+	.pBoardSpecInit			= NULL,
+
+	/* NAND init params */
+	.nandFlashReadParams		= 0,
+	.nandFlashWriteParams		= 0,
+	.nandFlashControl		= 0,
+	/* NOR init params */
+	.norFlashReadParams		= 0,
+	.norFlashWriteParams		= 0,
+	/* Enable modules auto-detection. */
+	.configAutoDetect		= MV_FALSE
+};
+MV_BOARD_INFO rdAP88f68XX_board_info = {
+	.boardName			= "RD-AP-88F6820-DDR3",
 	.numBoardMppTypeValue	= ARRSZ(rd88f68XXInfoBoardMppConfigValue),
 	.pBoardModTypeValue		= NULL,
 	.pBoardMppConfigValue	= rd88f68XXInfoBoardMppConfigValue,
@@ -372,7 +421,9 @@ MV_BOARD_INFO A380_customer_board_info = {
  * All supported A380 boards
  */
 MV_BOARD_INFO *boardInfoTbl[] = {
-	&rd88f68XX_board_info,
+	&rdNas88f68XX_board_info,
 	&db88f68xx_board_info,
+	&rdAP88f68XX_board_info,
 	&A380_customer_board_info
 };
+
diff --git a/arch/arm/mach-armada38x/armada_38x_family/boardEnv/mvBoardEnvSpec.h b/arch/arm/mach-armada38x/armada_38x_family/boardEnv/mvBoardEnvSpec.h
index d021d63..23f7745 100644
--- a/arch/arm/mach-armada38x/armada_38x_family/boardEnv/mvBoardEnvSpec.h
+++ b/arch/arm/mach-armada38x/armada_38x_family/boardEnv/mvBoardEnvSpec.h
@@ -76,9 +76,10 @@
 /* boards ID numbers */
 #define BOARD_ID_BASE			0x0
 
-#define RD_68XX_ID			(BOARD_ID_BASE)
-#define DB_68XX_ID			(RD_68XX_ID + 1)
-#define A380_CUSTOMER_ID		(DB_68XX_ID + 1)
+#define RD_NAS_68XX_ID			(BOARD_ID_BASE)
+#define DB_68XX_ID			(BOARD_ID_BASE + 1)
+#define RD_AP_68XX_ID			(BOARD_ID_BASE + 2)
+#define A380_CUSTOMER_ID		(BOARD_ID_BASE + 3)
 #define MV_MAX_BOARD_ID			(A380_CUSTOMER_ID + 1)
 #define MV_INVALID_BOARD_ID		0xFFFFFFFF
 
diff --git a/arch/arm/mach-armada38x/armada_38x_family/ctrlEnv/mvCtrlEnvLib.h b/arch/arm/mach-armada38x/armada_38x_family/ctrlEnv/mvCtrlEnvLib.h
index a97e304..ef8954a 100644
--- a/arch/arm/mach-armada38x/armada_38x_family/ctrlEnv/mvCtrlEnvLib.h
+++ b/arch/arm/mach-armada38x/armada_38x_family/ctrlEnv/mvCtrlEnvLib.h
@@ -82,10 +82,6 @@ typedef enum _mvConfigTypeID {
 	MV_CONFIG_NOR,			/* NOR board SLM 1361	*/
 	MV_CONFIG_NAND,			/* NAND board SLM 1361	*/
 	MV_CONFIG_SDIO,			/* SDIO board SLM 1361	*/
-	MV_CONFIG_GIGA,			/* GIGA board SLM	*/
-	MV_CONFIG_SGMII,		/* SERDES module SGMII	*/
-	MV_CONFIG_SERDES_PEX_LAN1,	/* SERDES module PEX	*/
-	MV_CONFIG_SERDES_PEX_LAN2,	/* SERDES module PEX	*/
 	MV_CONFIG_TYPE_MAX_MODULE,
 	MV_CONFIG_NAND_ON_BOARD = MV_CONFIG_TYPE_MAX_MODULE,	/* ON board nand detect */
 	MV_CONFIG_TYPE_MAX_OPTION,
-- 
1.7.5.4

