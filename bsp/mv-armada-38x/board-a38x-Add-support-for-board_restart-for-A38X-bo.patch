From a00790161c04473d2b97b16bacf7e1e178d4921b Mon Sep 17 00:00:00 2001
From: Shadi Ammouri <shadi@marvell.com>
Date: Wed, 20 Nov 2013 16:33:44 +0200
Subject: [PATCH 1160/1825] board: a38x: Add support for board_restart for
 A38X boards

https://github.com/MISL-EBU-System-SW/misl-windriver.git linux-3.4.69-14t2-read
commit 265d7434acd9bd9c59ca63be54fa57855f935966

Change-Id: Id14f87c076309d08bd98e2f26ccae2a1d6944e7c
Signed-off-by: Shadi Ammouri <shadi@marvell.com>
Reviewed-on: http://vgitil04.il.marvell.com:8080/4386
Reviewed-by: Igor Patrik <igorp@marvell.com>
Tested-by: Igor Patrik <igorp@marvell.com>
Signed-off-by: Zhong Hongbo <hongbo.zhong@windriver.com>
---
 arch/arm/mach-armada38x/core.c                |   12 ++++++++++++
 arch/arm/mach-armada38x/include/mach/system.h |    9 ---------
 2 files changed, 12 insertions(+), 9 deletions(-)

diff --git a/arch/arm/mach-armada38x/core.c b/arch/arm/mach-armada38x/core.c
index 27bf34e..7434bbd 100644
--- a/arch/arm/mach-armada38x/core.c
+++ b/arch/arm/mach-armada38x/core.c
@@ -1235,6 +1235,17 @@ static void __init a38x_board_init(void)
 #endif
 }
 
+static void board_restart(char mode, const char *cmd)
+{
+	pr_notice("Reseting...\n");
+	mvBoardReset();
+
+	/* This should never be reached */
+	while (1)
+		;
+}
+
+
 MACHINE_START(ARMADA_38X, "Marvell Armada-38x Board")
 	.atag_offset = BOOT_PARAMS_OFFSET,
 	.map_io = a38x_map_io,
@@ -1242,4 +1253,5 @@ MACHINE_START(ARMADA_38X, "Marvell Armada-38x Board")
 	.timer = &a38x_timer,
 	.handle_irq     = gic_handle_irq,
 	.init_machine = a38x_board_init,
+	.restart = board_restart
 MACHINE_END
diff --git a/arch/arm/mach-armada38x/include/mach/system.h b/arch/arm/mach-armada38x/include/mach/system.h
index eef12f3..c8db080 100644
--- a/arch/arm/mach-armada38x/include/mach/system.h
+++ b/arch/arm/mach-armada38x/include/mach/system.h
@@ -22,13 +22,4 @@ static inline void arch_idle(void)
 	cpu_do_idle();
 }
 
-static inline void arch_reset(char mode, const char *cmd)
-{
-	printk(KERN_NOTICE "Reseting...\n");
-	mvBoardReset();
-	/* This should never be reached */
-	while (1)
-		;
-}
-
 #endif /* __MACH_SYSTEM_H */
-- 
1.7.5.4

