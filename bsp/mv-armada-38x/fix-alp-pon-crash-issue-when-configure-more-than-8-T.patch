From d056c9192a5f28bfcb234d36695e2c320bd26bc5 Mon Sep 17 00:00:00 2001
From: Victor Gu <xigu@marvell.com>
Date: Mon, 31 Mar 2014 15:41:08 +0800
Subject: [PATCH 1521/1825] fix: alp: pon: crash issue when configure more
 than 8 T-CCONTS

https://github.com/MISL-EBU-System-SW/misl-windriver.git linux-3.4.69-14t2-read
commit c79c386b84c7368164a244f4349cee740cca7055

Change-Id: I43ad745ce9153694af1b5ba4eb2976681c2c3373
Signed-off-by: Victor Gu <xigu@marvell.com>
Reviewed-on: http://vgitil04.il.marvell.com:8080/6786
Reviewed-by: Yehuda Yitschak <yehuday@marvell.com>
Tested-by: Yehuda Yitschak <yehuday@marvell.com>
Signed-off-by: Zhong Hongbo <hongbo.zhong@windriver.com>
---
 .../mv_drivers_lsp/mv_pon/core/gpon/gponOnuSrvc.h  |    4 ++--
 .../mv_pon/plat/gpon/gponOnuLnxKsOs.c              |    6 +++---
 .../mv_pon/plat/gpon/gponOnuLnxKsOs.h              |    4 ++--
 3 files changed, 7 insertions(+), 7 deletions(-)

diff --git a/arch/arm/plat-armada/mv_drivers_lsp/mv_pon/core/gpon/gponOnuSrvc.h b/arch/arm/plat-armada/mv_drivers_lsp/mv_pon/core/gpon/gponOnuSrvc.h
index cd86b43..c04b355 100644
--- a/arch/arm/plat-armada/mv_drivers_lsp/mv_pon/core/gpon/gponOnuSrvc.h
+++ b/arch/arm/plat-armada/mv_drivers_lsp/mv_pon/core/gpon/gponOnuSrvc.h
@@ -178,9 +178,9 @@ MV_STATUS     onuGponSrvcGenDbrTable(void);
 
 /* Global variables
    ------------------------------------------------------------------------------*/
-extern S_onuPonWork gponTcontCleanWork[8];
+extern S_onuPonWork gponTcontCleanWork[10];
 extern S_onuPonWork gponTcontCleanAllWork;
-extern S_onuPonWork gponTcontActiveWork[8];
+extern S_onuPonWork gponTcontActiveWork[10];
 extern S_onuPonWorkQueue gponTcontFlushWq;
 
 /* Global functions
diff --git a/arch/arm/plat-armada/mv_drivers_lsp/mv_pon/plat/gpon/gponOnuLnxKsOs.c b/arch/arm/plat-armada/mv_drivers_lsp/mv_pon/plat/gpon/gponOnuLnxKsOs.c
index 1e756b4..ec6e945 100644
--- a/arch/arm/plat-armada/mv_drivers_lsp/mv_pon/plat/gpon/gponOnuLnxKsOs.c
+++ b/arch/arm/plat-armada/mv_drivers_lsp/mv_pon/plat/gpon/gponOnuLnxKsOs.c
@@ -90,9 +90,9 @@ SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.
 
 /* Global Variables
    ------------------------------------------------------------------------------*/
-S_onuPonWork gponTcontCleanWork[8];
+S_onuPonWork gponTcontCleanWork[10];
 S_onuPonWork gponTcontCleanAllWork;
-S_onuPonWork gponTcontActiveWork[8];
+S_onuPonWork gponTcontActiveWork[10];
 S_onuPonWorkQueue gponTcontFlushWq;
 
 /* Global functions
@@ -128,7 +128,7 @@ MV_STATUS onuPonWqInit(void)
 
 	gponTcontFlushWq.ponWq = create_workqueue("gponTcontFlushWQ");
 	if (gponTcontFlushWq.ponWq) {
-		for (tcontIndex = 0; tcontIndex < 8; tcontIndex++) {
+		for (tcontIndex = 0; tcontIndex < 10; tcontIndex++) {
 			INIT_WORK((struct work_struct *)&gponTcontCleanWork[tcontIndex], onuGponWqTcontFunc);
 			gponTcontCleanWork[tcontIndex].action = TCONT_CLEAN_EVENT;
 			gponTcontCleanWork[tcontIndex].param  = tcontIndex;
diff --git a/arch/arm/plat-armada/mv_drivers_lsp/mv_pon/plat/gpon/gponOnuLnxKsOs.h b/arch/arm/plat-armada/mv_drivers_lsp/mv_pon/plat/gpon/gponOnuLnxKsOs.h
index 77bc3e9..b2e92d6 100644
--- a/arch/arm/plat-armada/mv_drivers_lsp/mv_pon/plat/gpon/gponOnuLnxKsOs.h
+++ b/arch/arm/plat-armada/mv_drivers_lsp/mv_pon/plat/gpon/gponOnuLnxKsOs.h
@@ -97,9 +97,9 @@ irqreturn_t onuGponDgIrqRoutine(int irq, void *arg);
 
 /* Global variables
    ------------------------------------------------------------------------------*/
-extern S_onuPonWork gponTcontCleanWork[8];
+extern S_onuPonWork gponTcontCleanWork[10];
 extern S_onuPonWork gponTcontCleanAllWork;
-extern S_onuPonWork gponTcontActiveWork[8];
+extern S_onuPonWork gponTcontActiveWork[10];
 extern S_onuPonWorkQueue gponTcontFlushWq;
 
 /* Global functions
-- 
1.7.5.4

