From c26a2043417b931dcb6efdc8359123651de751f0 Mon Sep 17 00:00:00 2001
From: Igor Patrik <igorp@marvell.com>
Date: Sun, 20 Oct 2013 11:29:51 +0200
Subject: [PATCH 1033/1825] ipc: alp: Small fix for IPC Linux<->freeRTOS demo

https://github.com/MISL-EBU-System-SW/misl-windriver.git linux-3.4.69-14t2-read
commit 8601fba199f58e558f7134b4dc0ab2457e20ea2c

	fixed shmem base address for ALP
	changed Kconfig to put freertos flag under general AMP flag

Change-Id: I39d4a33242c23a7fc28c3aabf6ec5c4c54e7d43a
Signed-off-by: Igor Patrik <igorp@marvell.com>
Reviewed-on: http://vgitil04.il.marvell.com:8080/3769
Signed-off-by: Zhong Hongbo <hongbo.zhong@windriver.com>
---
 arch/arm/plat-armada/Kconfig                       |   15 +++++----------
 .../mv_ipc/linux_freertos/mv_ipc_node.h            |   10 ++++++++--
 2 files changed, 13 insertions(+), 12 deletions(-)

diff --git a/arch/arm/plat-armada/Kconfig b/arch/arm/plat-armada/Kconfig
index 6304c62..97cb75a 100644
--- a/arch/arm/plat-armada/Kconfig
+++ b/arch/arm/plat-armada/Kconfig
@@ -179,16 +179,6 @@ config MV_INCLUDE_SWITCH
 
 endmenu
 
-menu "FreeRTOS IPC options"
-
-config MV_IPC_FREERTOS_DRIVER
-        bool "Enable freeRTOS IPC support"
-	depends on (ARMADA_XP || MV78XX0 || AVANTA_LP) && \
-		(!ARMADA_XP_REV_Z1) && (SMP) && (!MV_ETH_BM) && \
-		(!ARMADAXP_USE_IRQ_INDIRECT_MODE)
-	default n
-
-endmenu
 
 menu "AMP options"
 
@@ -229,6 +219,11 @@ config MV_IPC_NET
         depends on MV_IPC_LINUX_AMP_DRIVER
         default y
 
+config MV_IPC_FREERTOS_DRIVER
+        bool "Enable freeRTOS IPC support"
+        depends on   MV_AMP_ENABLE && !MV_IPC_LINUX_AMP_DRIVER
+	default n
+
 config MV_DRAM_BASE
        hex  "AMP build usage - Do not change"
        depends on MV_AMP_ENABLE
diff --git a/arch/arm/plat-armada/mv_drivers_lsp/mv_ipc/linux_freertos/mv_ipc_node.h b/arch/arm/plat-armada/mv_drivers_lsp/mv_ipc/linux_freertos/mv_ipc_node.h
index 46c7b9d..573384e 100644
--- a/arch/arm/plat-armada/mv_drivers_lsp/mv_ipc/linux_freertos/mv_ipc_node.h
+++ b/arch/arm/plat-armada/mv_drivers_lsp/mv_ipc/linux_freertos/mv_ipc_node.h
@@ -59,9 +59,15 @@ register channel is interrupt and channel enable function*/
 };
 
 /*Link info array*/
-	/*numOfChn		isMaster, remoteNodeId, shmemAddr,		shmemSize*/
+#ifdef CONFIG_ARCH_AVANTA_LP
+#define MV_IPC_SHARED_MEM_REGION_BASE 0x10000000
+#endif
+#ifdef CONFIG_ARCH_ARMADA_XP
+#define MV_IPC_SHARED_MEM_REGION_BASE 0x60000000
+#endif
+s/*numOfChn	isMaster, remoteNodeId, shmemAddr,						shmemSize*/
 #define MV_IPC_LINK_INFO_TABLE {\
-	{4,			MV_TRUE,	2,	NULL,		0x60000000,		0x100000},\
+	{4,		MV_TRUE,	2,		NULL,	MV_IPC_SHARED_MEM_REGION_BASE,	0x100000},\
 };
 
 
-- 
1.7.5.4

