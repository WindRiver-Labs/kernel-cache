From 322f113ec05b289dc61a128aab3310892eb9e210 Mon Sep 17 00:00:00 2001
From: Dmitri Epshtein <dima@marvell.com>
Date: Tue, 25 Mar 2014 15:25:53 -0400
Subject: [PATCH 1505/1825] fix: neta: Check input arguments in sysfs
 functions

https://github.com/MISL-EBU-System-SW/misl-windriver.git linux-3.4.69-14t2-read
commit e53f3b437ccb1681a661ac0ae3dfd3d3f5b0c9a7

	- fix JIRA bug: EBU System SW SYSTEMSW-414
	- check port, txp, txq values in the function mv_eth_ctrl_txq_size_set()
	- check port, rxq values in the function mv_eth_ctrl_rxq_size_set()

Change-Id: Ibd664e6ae3437d7edd1631c73eae3c8c5a06735f
Signed-off-by: Dmitri Epshtein <dima@marvell.com>
Signed-off-by: Zhong Hongbo <hongbo.zhong@windriver.com>
---
 .../mv_drivers_lsp/mv_neta/net_dev/mv_netdev.c     |   12 ++++++++++++
 1 files changed, 12 insertions(+), 0 deletions(-)

diff --git a/arch/arm/plat-armada/mv_drivers_lsp/mv_neta/net_dev/mv_netdev.c b/arch/arm/plat-armada/mv_drivers_lsp/mv_neta/net_dev/mv_netdev.c
index cb4ab10..26f41ad 100644
--- a/arch/arm/plat-armada/mv_drivers_lsp/mv_neta/net_dev/mv_netdev.c
+++ b/arch/arm/plat-armada/mv_drivers_lsp/mv_neta/net_dev/mv_netdev.c
@@ -685,6 +685,12 @@ int mv_eth_ctrl_rxq_size_set(int port, int rxq, int value)
 	struct eth_port *pp = mv_eth_port_by_id(port);
 	struct rx_queue	*rxq_ctrl;
 
+	if (mvNetaPortCheck(port))
+		return -EINVAL;
+
+	if (mvNetaMaxCheck(rxq, CONFIG_MV_ETH_RXQ, "rxq"))
+		return -EINVAL;
+
 	if (pp == NULL) {
 		printk(KERN_INFO "port doens not exist (%d) in %s\n" , port, __func__);
 		return -EINVAL;
@@ -713,6 +719,12 @@ int mv_eth_ctrl_txq_size_set(int port, int txp, int txq, int value)
 	struct tx_queue *txq_ctrl;
 	struct eth_port *pp = mv_eth_port_by_id(port);
 
+	if (mvNetaTxpCheck(port, txp))
+		return -EINVAL;
+
+	if (mvNetaMaxCheck(txq, CONFIG_MV_ETH_TXQ, "txq"))
+		return -EINVAL;
+
 	if (pp == NULL) {
 		printk(KERN_INFO "port doens not exist (%d) in %s\n" , port, __func__);
 		return -EINVAL;
-- 
1.7.5.4

