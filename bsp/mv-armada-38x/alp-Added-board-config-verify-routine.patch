From 2176d328fa2d95883eeadf572cde46f7c5c947e2 Mon Sep 17 00:00:00 2001
From: Hanna Hawa <hannah@marvell.com>
Date: Mon, 3 Mar 2014 16:03:21 +0200
Subject: [PATCH 1426/1825] alp: Added board config verify routine

https://github.com/MISL-EBU-System-SW/misl-windriver.git linux-3.4.69-14t2-read
commit 7b861c555f736698c40a360a8148a5003cf3a6b5

	Moved the board configuration verify sequence (when writing new value) from the cmd_boardCfg.c
	to the alp_family, as a preparation for a generic boardConfig command.

Change-Id: I8b69d97ed04875365de4a58345c0cbdd0649c06f
Signed-off-by: Hanna Hawa <hannah@marvell.com>
Reviewed-on: http://vgitil04.il.marvell.com:8080/6066
Tested-by: Star_Automation <star@marvell.com>
Reviewed-by: Omri Itach <omrii@marvell.com>
Tested-by: Omri Itach <omrii@marvell.com>
Signed-off-by: Zhong Hongbo <hongbo.zhong@windriver.com>
---
 .../avanta_lp_family/boardEnv/mvBoardEnvLib.c      |   30 ++++++++++++++++++++
 .../avanta_lp_family/boardEnv/mvBoardEnvLib.h      |    1 +
 2 files changed, 31 insertions(+), 0 deletions(-)

diff --git a/arch/arm/mach-avantalp/avanta_lp_family/boardEnv/mvBoardEnvLib.c b/arch/arm/mach-avantalp/avanta_lp_family/boardEnv/mvBoardEnvLib.c
index cacae55..b504d6c 100644
--- a/arch/arm/mach-avantalp/avanta_lp_family/boardEnv/mvBoardEnvLib.c
+++ b/arch/arm/mach-avantalp/avanta_lp_family/boardEnv/mvBoardEnvLib.c
@@ -3258,3 +3258,33 @@ MV_BOOL mvBoardConfigAutoDetectEnabled()
 {
 	return board->configAutoDetect;
 }
+
+/*******************************************************************************
+* mvBoardConfigurationConflicts
+*
+* DESCRIPTION:
+*       Check if there is any conflicts with the board configurations
+*
+* INPUT:
+*	field = Field name of configuration
+*	writeVal = option number
+*
+* OUTPUT:
+*       None.
+*
+* RETURN:
+*	MV_OK: if there is no conflicts
+*	MV_ERROR: conflict in one configuration
+*
+*******************************************************************************/
+MV_STATUS mvBoardConfigVerify(MV_CONFIG_TYPE_ID field, MV_U8 writeVal)
+{
+	/* 0x2 = SATA1, 0x3 = Unconnected are supported only for A0 */
+	if ((field == MV_CONFIG_LANE1 && (writeVal == 0x2 || writeVal == 0x3)) \
+			&& (mvCtrlRevGet() <= MV_88F66X0_Z3_ID)) {
+		mvOsPrintf("Error: this option is not supported in Z stepping revision\n");
+		return MV_ERROR;
+	}
+	return MV_OK;
+
+}
diff --git a/arch/arm/mach-avantalp/avanta_lp_family/boardEnv/mvBoardEnvLib.h b/arch/arm/mach-avantalp/avanta_lp_family/boardEnv/mvBoardEnvLib.h
index 9e23e5c..c23c082 100644
--- a/arch/arm/mach-avantalp/avanta_lp_family/boardEnv/mvBoardEnvLib.h
+++ b/arch/arm/mach-avantalp/avanta_lp_family/boardEnv/mvBoardEnvLib.h
@@ -586,6 +586,7 @@ MV_STATUS mvBoardConfIdSet(MV_U16 conf);
 MV_U16 mvBoardPexModeGet(MV_VOID);
 MV_STATUS mvBoardPexModeSet(MV_U16 conf);
 MV_U32 mvBoardLaneSelectorGet(MV_U32 laneNum);
+MV_STATUS mvBoardConfigVerify(MV_CONFIG_TYPE_ID field, MV_U8 writeVal);
 #ifdef __cplusplus
 }
 #endif  /* __cplusplus */
-- 
1.7.5.4

