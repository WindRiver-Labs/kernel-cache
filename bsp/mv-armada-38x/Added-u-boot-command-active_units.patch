From 89085f4f3bc3ce7a6378927fd84cf9efc82b82d2 Mon Sep 17 00:00:00 2001
From: Eli Nidam <elini@marvell.com>
Date: Mon, 12 Aug 2013 18:17:46 +0300
Subject: [PATCH 0954/1825] Added u-boot command active_units

https://github.com/MISL-EBU-System-SW/misl-windriver.git linux-3.4.69-14t2-read
commit 802d0d1ca9c0a0bfa8cf4d377758893538fd1050

	Scanning all SOC interface and prints all active interfaces.

Change-Id: I3539c7f9d78d2995d3750f950ddbcf2a474e3a11
Signed-off-by: Eli Nidam <elini@marvell.com>
Reviewed-on: http://vgitil04.il.marvell.com:8080/3012
Tested-by: Star_Automation <star@marvell.com>
Reviewed-by: Tawfik Bayouk <tawfik@marvell.com>
Signed-off-by: Zhong Hongbo <hongbo.zhong@windriver.com>
---
 .../armada_xp_family/ctrlEnv/mvCtrlEnvLib.c        |   72 ++++++++++++++++++++
 .../armada_xp_family/ctrlEnv/mvCtrlEnvLib.h        |    4 +
 2 files changed, 76 insertions(+), 0 deletions(-)

diff --git a/arch/arm/mach-armadaxp/armada_xp_family/ctrlEnv/mvCtrlEnvLib.c b/arch/arm/mach-armadaxp/armada_xp_family/ctrlEnv/mvCtrlEnvLib.c
index f9cc381..b2e33a0 100755
--- a/arch/arm/mach-armadaxp/armada_xp_family/ctrlEnv/mvCtrlEnvLib.c
+++ b/arch/arm/mach-armadaxp/armada_xp_family/ctrlEnv/mvCtrlEnvLib.c
@@ -2104,7 +2104,79 @@ err_cfg:
 	return MV_ERROR;
 
 }
+/*******************************************************************************
+* mvCtrlGetPexActive
+*
+* DESCRIPTION:
+*	fill input boolean array of pex interface
+*
+* INPUT:
+*       pPexActive - pointer to boolean array (size is max pex IF).
+*	size	   - array size
+*
+* OUTPUT:
+*        boolean array - true or false if pex exists
+*
+* RETURN:
+*       None
+*
+*******************************************************************************/
+void mvCtrlGetPexActive(MV_BOOL *pPexActive, int size)
+{
+	MV_U32	pexIf, i;
+	MV_BOARD_PEX_INFO	*boardPexInfo = mvBoardPexInfoGet();
+
+	if (size == 0)
+		return;
+
+	memset(pPexActive, MV_FALSE, size * sizeof(MV_BOOL));
+	for (i = 0; i < boardPexInfo->boardPexIfNum; i++) {
+		pexIf = boardPexInfo->pexMapping[i];
+		if (pexIf < size)
+			pPexActive[pexIf] = MV_TRUE;
+	}
+}
+#if defined(MV_INCLUDE_INTEG_SATA)
+/*******************************************************************************
+* mvCtrlGetSataActive
+*
+* DESCRIPTION:
+*	fill input boolean array of SATA interface
+*
+* INPUT:
+*       pSataAtive - pointer to boolean array.
+*	size	   - array size
+*
+* OUTPUT:
+*        boolean array - true or false if integrated SATA exists
+*
+* RETURN:
+*       None
+*
+*******************************************************************************/
+void mvCtrlGetSataActive(MV_BOOL *pSataAtive, int size)
+{
+	MV_U32	serdesLine0_7;
+	MV_U32	serdesLineCfg;
+	MV_U8	serdesLineNum;
 
+	if (size <= 0)
+		return;
+	pSataAtive[0] = MV_FALSE;
+	if (size > 1)
+		pSataAtive[1] = MV_FALSE;
+	serdesLine0_7 = MV_REG_READ(SERDES_LINE_MUX_REG_0_7);
+	for (serdesLineNum = 4; serdesLineNum < 7; serdesLineNum++) {
+		serdesLineCfg = (serdesLine0_7 >> (serdesLineNum << 2)) & 0xF;
+		if (serdesLineCfg == serdesCfg[serdesLineNum][SERDES_UNIT_SATA]) {
+			if ((serdesLineNum == 4) || (serdesLineNum == 6))
+				pSataAtive[0] = MV_TRUE;
+			else if ((serdesLineNum == 5) && (size > 1))
+				pSataAtive[1] = MV_TRUE;
+		}
+	}
+}
+#endif
 /*******************************************************************************
 * mvCtrlGetJuncTemp
 *
diff --git a/arch/arm/mach-armadaxp/armada_xp_family/ctrlEnv/mvCtrlEnvLib.h b/arch/arm/mach-armadaxp/armada_xp_family/ctrlEnv/mvCtrlEnvLib.h
index a3326a9..afee2d1 100755
--- a/arch/arm/mach-armadaxp/armada_xp_family/ctrlEnv/mvCtrlEnvLib.h
+++ b/arch/arm/mach-armadaxp/armada_xp_family/ctrlEnv/mvCtrlEnvLib.h
@@ -271,6 +271,10 @@ MV_BOOL	  mvCtrlPwrMemGet(MV_UNIT_ID unitId, MV_U32 index);
 
 MV_U32 mvCtrlSerdesMaxLinesGet(MV_VOID);
 MV_STATUS mvCtrlSerdesPhyConfig(MV_VOID);
+MV_U32 mvCtrlSataMaxPortGet(MV_VOID);
+
+void mvCtrlGetPexActive(MV_BOOL *pPexActive, int size);
+void mvCtrlGetSataActive(MV_BOOL *pSataAtive, int size);
 MV_U32 mvCtrlDDRBudWidth(MV_VOID);
 MV_BOOL mvCtrlDDRThruXbar(MV_VOID);
 MV_BOOL mvCtrlDDRECC(MV_VOID);
-- 
1.7.5.4

