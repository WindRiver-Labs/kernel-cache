From 88080fae4156661707614abd76950d1016add5f5 Mon Sep 17 00:00:00 2001
From: Tawfik Bayouk <tawfik@marvell.com>
Date: Tue, 21 Aug 2012 17:36:16 +0300
Subject: [PATCH 0220/1825] Armadaxp support sparse memory model

https://github.com/MISL-EBU-System-SW/misl-windriver.git linux-3.4.69-14t2-read
commit 67807164bb7ebac683734bb9ccfd0c16359d960f

Change-Id: Id551b7a22ff99c5d8b680f40db19363f18c4aa9a
Signed-off-by: Tawfik Bayouk <tawfik@marvell.com>
Signed-off-by: Kosta Zertsekel <konszert@marvell.com>
Signed-off-by: Zhong Hongbo <hongbo.zhong@windriver.com>
---
 arch/arm/mach-armadaxp/Kconfig               |    5 +++++
 arch/arm/mach-armadaxp/include/mach/memory.h |    5 +++++
 2 files changed, 10 insertions(+), 0 deletions(-)

diff --git a/arch/arm/mach-armadaxp/Kconfig b/arch/arm/mach-armadaxp/Kconfig
index bfb3705..ff58fa3 100644
--- a/arch/arm/mach-armadaxp/Kconfig
+++ b/arch/arm/mach-armadaxp/Kconfig
@@ -71,6 +71,11 @@ config CFU_DRAM_BYPASS
 	default n
 	help
 
+config ARMADA_XP_SPARSEMEM
+	bool "Use sparse memory model"
+	select ARCH_SPARSEMEM_ENABLE
+	default n
+
 config ARMADAXP_USE_IRQ_INDIRECT_MODE
        bool "Use indirect mode for handling interrupt controller"
        default n
diff --git a/arch/arm/mach-armadaxp/include/mach/memory.h b/arch/arm/mach-armadaxp/include/mach/memory.h
index 86fe350..6740ff2 100644
--- a/arch/arm/mach-armadaxp/include/mach/memory.h
+++ b/arch/arm/mach-armadaxp/include/mach/memory.h
@@ -17,6 +17,11 @@
 
 
 /* Override the ARM default */
+#ifdef CONFIG_SPARSEMEM
+#define MAX_PHYSMEM_BITS       35
+#define SECTION_SIZE_BITS      29
+#endif
+
 #if 0
 #ifdef CONFIG_FB_DOVE_CONSISTENT_DMA_SIZE
 
-- 
1.7.5.4

