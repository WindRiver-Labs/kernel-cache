From 639f312fe576e878fc30a39d9721f74603f955d9 Mon Sep 17 00:00:00 2001
From: Bin Jiang <bin.jiang@windriver.com>
Date: Fri, 13 Mar 2015 16:45:59 +0800
Subject: [PATCH 2/3] arm/armada: add SDHCI_QUIRK2_NO_1_8_V quirks

The SDHCI controller can't work in 1.8V power supply.
So add SDHCI_QUIRK2_NO_1_8_V to quirks.

Signed-off-by: Bin Jiang <bin.jiang@windriver.com>
---
 arch/arm/mach-armada38x/core.c          |    1 +
 drivers/mmc/host/sdhci-pxav3.c          |    2 ++
 include/linux/platform_data/pxa_sdhci.h |    1 +
 3 files changed, 4 insertions(+), 0 deletions(-)

diff --git a/arch/arm/mach-armada38x/core.c b/arch/arm/mach-armada38x/core.c
index 57409b3..1299205 100644
--- a/arch/arm/mach-armada38x/core.c
+++ b/arch/arm/mach-armada38x/core.c
@@ -473,6 +473,7 @@ static struct sdhci_pxa_platdata mv_sdhci_data = {
 	.clk_delay_cycles = 0x1f,
 	.quirks = SDHCI_QUIRK_INVERTED_WRITE_PROTECT
 		| SDHCI_QUIRK_BROKEN_CARD_DETECTION,
+	.quirks2 = SDHCI_QUIRK2_NO_1_8_V,
 	.host_caps = MMC_CAP_8_BIT_DATA,
 	.dram = &a38x_mbus_dram_info,
 };
diff --git a/drivers/mmc/host/sdhci-pxav3.c b/drivers/mmc/host/sdhci-pxav3.c
index e40c003..f9f7860 100644
--- a/drivers/mmc/host/sdhci-pxav3.c
+++ b/drivers/mmc/host/sdhci-pxav3.c
@@ -271,6 +271,8 @@ static int __devinit sdhci_pxav3_probe(struct platform_device *pdev)
 
 		if (pdata->quirks)
 			host->quirks |= pdata->quirks;
+		if (pdata->quirks2)
+			host->quirks2 |= pdata->quirks2;
 		if (pdata->host_caps)
 			host->mmc->caps |= pdata->host_caps;
 		if (pdata->pm_caps)
diff --git a/include/linux/platform_data/pxa_sdhci.h b/include/linux/platform_data/pxa_sdhci.h
index 893f1fd..52e0e96 100644
--- a/include/linux/platform_data/pxa_sdhci.h
+++ b/include/linux/platform_data/pxa_sdhci.h
@@ -52,6 +52,7 @@ struct sdhci_pxa_platdata {
 	unsigned int	max_speed;
 	unsigned int	host_caps;
 	unsigned int	quirks;
+	unsigned int	quirks2;
 	unsigned int	pm_caps;
 	struct		mbus_dram_target_info *dram;
 };
-- 
1.7.5.4

