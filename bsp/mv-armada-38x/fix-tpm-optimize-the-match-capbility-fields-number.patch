From d85d38f88182bff676f0205e7356cb16ec814961 Mon Sep 17 00:00:00 2001
From: Ken Ma <make@marvell.com>
Date: Tue, 1 Jul 2014 15:13:02 +0800
Subject: [PATCH 1759/1825] fix: tpm: optimize the match capbility fields
 number

https://github.com/MISL-EBU-System-SW/misl-windriver.git linux-3.4.69-14t2-read
commit df046220f17cef93a4273a5abecde4e9f25019c2

	IPV4_PKT and IPV6_PKT can be removed out from key match fileds
	number limitation so that we can save 1 capbility match field,
	then besides IPVx_PKT field, we can still add more 4 match fileds.
	No bug number now.

Signed-off-by: Ken Ma <make@marvell.com>

Change-Id: I5e33e08baa2ef435904d62e20d1a058b79b924be
Signed-off-by: Ken Ma <make@marvell.com>
Reviewed-on: http://vgitil04.il.marvell.com:8080/8843
Reviewed-by: Dmitri Epshtein <dima@marvell.com>
Reviewed-by: Hua Jing <jinghua@marvell.com>
Tested-by: Star_Automation <star@marvell.com>
Signed-off-by: Zhong Hongbo <hongbo.zhong@windriver.com>
---
 .../mv_drivers_lsp/mv_tpm/src/conf/tpm_utils.c     |    3 +++
 1 files changed, 3 insertions(+), 0 deletions(-)

diff --git a/arch/arm/plat-armada/mv_drivers_lsp/mv_tpm/src/conf/tpm_utils.c b/arch/arm/plat-armada/mv_drivers_lsp/mv_tpm/src/conf/tpm_utils.c
index 2324fc5..0d24a42 100644
--- a/arch/arm/plat-armada/mv_drivers_lsp/mv_tpm/src/conf/tpm_utils.c
+++ b/arch/arm/plat-armada/mv_drivers_lsp/mv_tpm/src/conf/tpm_utils.c
@@ -210,6 +210,9 @@ unsigned int int_bitmap_num_get(unsigned int bitmap)
 	unsigned int num = 0;
 	int index;
 
+	/*IPV4_PKT and IPV6_PKT can be removed out and not regarded as a match field*/
+	bitmap &= ~(TPM_MATCH_IPV4_PKT | TPM_MATCH_IPV6_PKT);
+
 	for (index = 0; index < 32; index++) {
 		if ((1 << index) & bitmap)
 			num++;
-- 
1.7.5.4

