From 3d428f7a6b0aa2ef58860215428b0a5e460df0b3 Mon Sep 17 00:00:00 2001
From: Tawfik Bayouk <tawfik@marvell.com>
Date: Tue, 21 Aug 2012 17:34:17 +0300
Subject: [PATCH 0103/1825] DSMP changes on top of 2.0.3 to fix BE8

https://github.com/MISL-EBU-System-SW/misl-windriver.git linux-3.4.69-14t2-read
commit 568d90b0a275995a0340bf18d532f2a49a63fcaf

Change-Id: I8fe302e957bffc77555a6ffc8c1628df95071cc8
Signed-off-by: Tawfik Bayouk <tawfik@marvell.com>
Signed-off-by: Kosta Zertsekel <konszert@marvell.com>
Signed-off-by: Zhong Hongbo <hongbo.zhong@windriver.com>
---
 arch/arm/mach-armadaxp/include/mach/entry-macro.S |   10 ++++------
 1 files changed, 4 insertions(+), 6 deletions(-)

diff --git a/arch/arm/mach-armadaxp/include/mach/entry-macro.S b/arch/arm/mach-armadaxp/include/mach/entry-macro.S
index 1ebac5a..bcb34c4 100644
--- a/arch/arm/mach-armadaxp/include/mach/entry-macro.S
+++ b/arch/arm/mach-armadaxp/include/mach/entry-macro.S
@@ -22,11 +22,8 @@
 #ifndef CONFIG_ARMADAXP_USE_IRQ_INTERRUPT_ACK
 
 #if defined(CONFIG_CPU_BIG_ENDIAN)
-        	.macro	HTOLL sr, tt		@ sr   = A  ,B  ,C  ,D    
-        	eor \tt, \sr, \sr, ror #16 ;    @ temp = A^C,B^	  
-        	bic \tt, \tt, #0xff0000 ;       @ temp = A^C,0  ,C^A,D^B
-        	mov \sr, \sr, ror #8 ;          @ sr   = D  ,A  ,B  ,C
-        	eor \sr, \sr, \tt, lsr #8       @ sr   = D  ,C  ,B  ,A
+		.macro	HTOLL sr, tt		@ sr   = A  ,B  ,C  ,D
+		rev \sr, \sr
         	.endm
 #else		
         	.macro	HTOLL sr, tt	
@@ -92,8 +89,9 @@
 	sub	\irqnr, \tmp, \irqnr
 	mov     \tmp, #1
 	lsl     \tmp, \irqnr
+	HTOLL 	\tmp, \tmp
 	mvn     \tmp, \tmp
-	strh   	\tmp, [\base, #AXP_IN_DOORBELL_CAUSE]	@ clean irq
+	str   	\tmp, [\base, #AXP_IN_DOORBELL_CAUSE]	@ clean irq
 1002:
 	.endm
 
-- 
1.7.5.4

