From 7d03914cd06a4eebfdbdfec62735e16386b730ef Mon Sep 17 00:00:00 2001
From: Uri Eliyahu <uriel@marvell.com>
Date: Thu, 8 May 2014 14:25:41 +0300
Subject: [PATCH 1639/1825] pp3: update gop according to HW changes

https://github.com/MISL-EBU-System-SW/misl-windriver.git linux-3.4.69-14t2-read
commit edaaa993d5373b1dd62ac789bb20aa7a0963894a

	- pp3 FPGA gop is taken from ALP A0
	- this patch add the necessary support to upgrade gop
	  driver from ALP Z1 to ALP A0.

Change-Id: I559285116e43f42bdf7e378d91f857e487901fc6
Signed-off-by: Uri Eliyahu <uriel@marvell.com>
Reviewed-on: http://vgitil04.il.marvell.com:8080/7887
Reviewed-by: Yelena Krivosheev <yelena@marvell.com>
Tested-by: Star_Automation <star@marvell.com>
Reviewed-by: Dmitri Epshtein <dima@marvell.com>
Tested-by: Dmitri Epshtein <dima@marvell.com>
Signed-off-by: Zhong Hongbo <hongbo.zhong@windriver.com>
---
 drivers/net/ethernet/marvell/pp3/gmac/mv_gmac.c    |    2 ++
 drivers/net/ethernet/marvell/pp3/gmac/mv_gmac.h    |   10 ++++++++++
 .../net/ethernet/marvell/pp3/gmac/mv_gmac_regs.h   |    7 +++++++
 3 files changed, 19 insertions(+), 0 deletions(-)

diff --git a/drivers/net/ethernet/marvell/pp3/gmac/mv_gmac.c b/drivers/net/ethernet/marvell/pp3/gmac/mv_gmac.c
index 09d1403..ebfd103 100644
--- a/drivers/net/ethernet/marvell/pp3/gmac/mv_gmac.c
+++ b/drivers/net/ethernet/marvell/pp3/gmac/mv_gmac.c
@@ -677,6 +677,8 @@ void pp3_gmac_port_regs(int port)
 
 	pp3_gmac_reg_print(port, "GMAC_PORT_ISR_CAUSE_REG", GMAC_PORT_ISR_CAUSE_REG);
 	pp3_gmac_reg_print(port, "GMAC_PORT_ISR_MASK_REG", GMAC_PORT_ISR_CAUSE_REG);
+	pp3_gmac_reg_print(port, "GMAC_PORT_ISR_SUM_CAUSE_REG", GMAC_PORT_ISR_SUM_CAUSE_REG);
+	pp3_gmac_reg_print(port, "GMAC_PORT_ISR_SUM_MASK_REG", GMAC_PORT_ISR_SUM_MASK_REG);
 }
 
 /******************************************************************************/
diff --git a/drivers/net/ethernet/marvell/pp3/gmac/mv_gmac.h b/drivers/net/ethernet/marvell/pp3/gmac/mv_gmac.h
index 2e27caa..7ac35cb 100644
--- a/drivers/net/ethernet/marvell/pp3/gmac/mv_gmac.h
+++ b/drivers/net/ethernet/marvell/pp3/gmac/mv_gmac.h
@@ -158,6 +158,16 @@ static inline void pp3_gmac_port_isr_unmask(int port)
 	pp3_gmac_reg_write(port, GMAC_PORT_ISR_MASK_REG, GMAC_PORT_LINK_CHANGE_MASK);
 }
 
+static inline void pp3_gmac_port_sum_isr_mask(int port)
+{
+	pp3_gmac_reg_write(port, GMAC_PORT_ISR_SUM_MASK_REG, 0);
+}
+
+static inline void pp3_gmac_port_sum_isr_unmask(int port)
+{
+	pp3_gmac_reg_write(port, GMAC_PORT_ISR_SUM_MASK_REG, GMAC_PORT_ISR_SUM_INTERN_MASK);
+}
+
 void pp3_gmac_def_set(int port);
 void pp3_gmac_port_enable(int port);
 void pp3_gmac_port_diable(int port);
diff --git a/drivers/net/ethernet/marvell/pp3/gmac/mv_gmac_regs.h b/drivers/net/ethernet/marvell/pp3/gmac/mv_gmac_regs.h
index 7b71d82..51aecf9 100644
--- a/drivers/net/ethernet/marvell/pp3/gmac/mv_gmac_regs.h
+++ b/drivers/net/ethernet/marvell/pp3/gmac/mv_gmac_regs.h
@@ -226,6 +226,13 @@ SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.
 #define GMAC_PORT_LINK_CHANGE_MASK		(1 << GMAC_PORT_LINK_CHANGE_BIT)
 
 #define GMAC_PORT_ISR_MASK_REG			(0x0024)
+
+#define GMAC_PORT_ISR_SUM_CAUSE_REG		(0x00A0)
+#define GMAC_PORT_ISR_SUM_MASK_REG		(0x00A4)
+
+#define GMAC_PORT_ISR_SUM_INTERN_BIT		0x1
+#define GMAC_PORT_ISR_SUM_INTERN_MASK		(1 << GMAC_PORT_ISR_SUM_INTERN_BIT)
+
 /*-------------------------------------------------------------------------------*/
 
 /****************************************/
-- 
1.7.5.4

