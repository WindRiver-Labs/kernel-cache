From 43a918e919611498c3080be36a5093c5a52cd467 Mon Sep 17 00:00:00 2001
From: Hanna Hawa <hannah@marvell.com>
Date: Wed, 5 Mar 2014 18:18:40 +0200
Subject: [PATCH 1434/1825] fix: Add print DLB status (enabled/disabled)

https://github.com/MISL-EBU-System-SW/misl-windriver.git linux-3.4.69-14t2-read
commit 99327ffc308521c55becd6e161f5bfedd6e264c2

	Issue: SYSTEMSW-344

Change-Id: I5661898a4f4c88b892d781a7c777e18fdd6f19fc
Signed-off-by: Hanna Hawa <hannah@marvell.com>
Reviewed-on: http://vgitil04.il.marvell.com:8080/6161
Tested-by: Star_Automation <star@marvell.com>
Reviewed-by: Omri Itach <omrii@marvell.com>
Tested-by: Omri Itach <omrii@marvell.com>
Signed-off-by: Zhong Hongbo <hongbo.zhong@windriver.com>
---
 .../armada_38x_family/ctrlEnv/mvCtrlEnvLib.c       |   20 ++++++++++++++++++++
 .../armada_38x_family/ctrlEnv/mvCtrlEnvLib.h       |    1 +
 .../mach-msys/msys_family/ctrlEnv/mvCtrlEnvLib.c   |   20 ++++++++++++++++++++
 .../mach-msys/msys_family/ctrlEnv/mvCtrlEnvLib.h   |    2 +-
 4 files changed, 42 insertions(+), 1 deletions(-)

diff --git a/arch/arm/mach-armada38x/armada_38x_family/ctrlEnv/mvCtrlEnvLib.c b/arch/arm/mach-armada38x/armada_38x_family/ctrlEnv/mvCtrlEnvLib.c
index 065060e..69aa1eb 100644
--- a/arch/arm/mach-armada38x/armada_38x_family/ctrlEnv/mvCtrlEnvLib.c
+++ b/arch/arm/mach-armada38x/armada_38x_family/ctrlEnv/mvCtrlEnvLib.c
@@ -1460,6 +1460,26 @@ MV_BOOL mvCtrlIsBootFromNAND(MV_VOID)
 	return MV_FALSE;
 }
 
+/*******************************************************************************
+ * mvCtrlIsDLBEnabled - Read DLB configuration
+ *
+ * DESCRIPTION: return True if DLB is enabled
+ *
+ * INPUT: None
+ *
+ * OUTPUT: None
+ *
+ * RETURN: MV_TRUE, if DLB is enabled
+ ******************************************************************************/
+MV_BOOL mvCtrlIsDLBEnabled(MV_VOID)
+{
+	MV_U32 reg;
+
+	reg = MV_REG_READ(REG_STATIC_DRAM_DLB_CONTROL);
+
+	return (reg & 0x1) ? MV_TRUE : MV_FALSE;
+}
+
 #if defined(MV_INCLUDE_CLK_PWR_CNTRL)
 /*******************************************************************************
 * mvCtrlPwrClckSet - Set Power State for specific Unit
diff --git a/arch/arm/mach-armada38x/armada_38x_family/ctrlEnv/mvCtrlEnvLib.h b/arch/arm/mach-armada38x/armada_38x_family/ctrlEnv/mvCtrlEnvLib.h
index 7ab7b02..c385e59 100644
--- a/arch/arm/mach-armada38x/armada_38x_family/ctrlEnv/mvCtrlEnvLib.h
+++ b/arch/arm/mach-armada38x/armada_38x_family/ctrlEnv/mvCtrlEnvLib.h
@@ -251,6 +251,7 @@ MV_BOOL mvCtrlPwrClckGet(MV_UNIT_ID unitId, MV_U32 index);
 MV_BOOL mvCtrlIsBootFromNOR(MV_VOID);
 MV_BOOL mvCtrlIsBootFromSPI(MV_VOID);
 MV_BOOL mvCtrlIsBootFromNAND(MV_VOID);
+MV_BOOL mvCtrlIsDLBEnabled(MV_VOID);
 MV_U32 mvCtrlDDRBudWidth(MV_VOID);
 MV_BOOL mvCtrlDDRThruXbar(MV_VOID);
 MV_BOOL mvCtrlDDRECC(MV_VOID);
diff --git a/arch/arm/mach-msys/msys_family/ctrlEnv/mvCtrlEnvLib.c b/arch/arm/mach-msys/msys_family/ctrlEnv/mvCtrlEnvLib.c
index ce9b42c..897600c 100644
--- a/arch/arm/mach-msys/msys_family/ctrlEnv/mvCtrlEnvLib.c
+++ b/arch/arm/mach-msys/msys_family/ctrlEnv/mvCtrlEnvLib.c
@@ -1004,6 +1004,26 @@ MV_BOOL mvCtrlIsBootFromNAND(MV_VOID)
 		return MV_FALSE;
 }
 
+/*******************************************************************************
+ * mvCtrlIsDLBEnabled - Read DLB configuration
+ *
+ * DESCRIPTION: return True if DLB is enabled
+ *
+ * INPUT: None
+ *
+ * OUTPUT: None
+ *
+ * RETURN: MV_TRUE, if DLB is enabled
+ ******************************************************************************/
+MV_BOOL mvCtrlIsDLBEnabled(MV_VOID)
+{
+	MV_U32 reg;
+
+	reg = MV_REG_READ(REG_STATIC_DRAM_DLB_CONTROL);
+
+	return (reg & 0x1) ? MV_TRUE : MV_FALSE;
+}
+
 #if defined(MV_INCLUDE_CLK_PWR_CNTRL)
 /*******************************************************************************
 * mvCtrlPwrClckSet - Set Power State for specific Unit
diff --git a/arch/arm/mach-msys/msys_family/ctrlEnv/mvCtrlEnvLib.h b/arch/arm/mach-msys/msys_family/ctrlEnv/mvCtrlEnvLib.h
index 82b3fce..5a64d11 100644
--- a/arch/arm/mach-msys/msys_family/ctrlEnv/mvCtrlEnvLib.h
+++ b/arch/arm/mach-msys/msys_family/ctrlEnv/mvCtrlEnvLib.h
@@ -191,7 +191,7 @@ MV_BOOL	  mvCtrlIsBootFromSPI(MV_VOID);
 MV_BOOL	  mvCtrlIsBootFromNAND(MV_VOID);
 MV_BOOL	  mvCtrlPwrMemGet(MV_UNIT_ID unitId, MV_U32 index);
 MV_STATUS mvCtrlSerdesPhyConfig(MV_VOID);
-
+MV_BOOL mvCtrlIsDLBEnabled(MV_VOID);
 MV_U32 mvCtrlDDRBudWidth(MV_VOID);
 MV_BOOL mvCtrlDDRThruXbar(MV_VOID);
 MV_BOOL mvCtrlDDRECC(MV_VOID);
-- 
1.7.5.4

