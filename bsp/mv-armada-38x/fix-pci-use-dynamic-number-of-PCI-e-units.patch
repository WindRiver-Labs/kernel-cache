From 5b069cb625032afa6212003593eccadf6b706366 Mon Sep 17 00:00:00 2001
From: Hanna Hawa <hannah@marvell.com>
Date: Thu, 26 Jun 2014 20:30:56 +0300
Subject: [PATCH 1745/1825] fix: pci: use dynamic number of PCI-e units

https://github.com/MISL-EBU-System-SW/misl-windriver.git linux-3.4.69-14t2-read
commit 28b4c1928c712fb8c2e93aa9ec1f057a4e5ddcb1

	Issue found when using "sp" command, the sp command print error message.
	The unit number of the PCI-e was defined by mistake to be 0.
	This patch updates the define to use mvCtrlPexMaxIfGet() function from the family code.

	SYSTEMSW-675: Command "sp" will report error info when testing PEX feature

Change-Id: I55f0cb7bfce9ee879c1d69119957ef22175e8d51
Signed-off-by: Hanna Hawa <hannah@marvell.com>
Reviewed-on: http://vgitil04.il.marvell.com:8080/8749
Reviewed-by: Omri Itach <omrii@marvell.com>
Tested-by: Omri Itach <omrii@marvell.com>
Signed-off-by: Zhong Hongbo <hongbo.zhong@windriver.com>
---
 .../armada_38x_family/ctrlEnv/mvCtrlEnvLib.h       |    4 ++--
 .../avanta_lp_family/ctrlEnv/mvCtrlEnvLib.h        |    2 +-
 2 files changed, 3 insertions(+), 3 deletions(-)

diff --git a/arch/arm/mach-armada38x/armada_38x_family/ctrlEnv/mvCtrlEnvLib.h b/arch/arm/mach-armada38x/armada_38x_family/ctrlEnv/mvCtrlEnvLib.h
index 4acf7e9..11b3399 100644
--- a/arch/arm/mach-armada38x/armada_38x_family/ctrlEnv/mvCtrlEnvLib.h
+++ b/arch/arm/mach-armada38x/armada_38x_family/ctrlEnv/mvCtrlEnvLib.h
@@ -211,9 +211,9 @@ MV_U32 mvCtrlPexMaxUnitGet(MV_VOID);
 MV_U32 mvCtrlPexActiveUnitNumGet(MV_VOID);
 
 #if defined(MV_INCLUDE_PCI)
-#define mvCtrlPciIfMaxIfGet()           3
+#define mvCtrlPciIfMaxIfGet()           1
 #else
-#define mvCtrlPciIfMaxIfGet()           3
+#define mvCtrlPciIfMaxIfGet()           (mvCtrlPexMaxIfGet())
 #endif
 
 MV_U32 mvCtrlEthMaxPortGet(MV_VOID);
diff --git a/arch/arm/mach-avantalp/avanta_lp_family/ctrlEnv/mvCtrlEnvLib.h b/arch/arm/mach-avantalp/avanta_lp_family/ctrlEnv/mvCtrlEnvLib.h
index 53575ba..fc08327 100755
--- a/arch/arm/mach-avantalp/avanta_lp_family/ctrlEnv/mvCtrlEnvLib.h
+++ b/arch/arm/mach-avantalp/avanta_lp_family/ctrlEnv/mvCtrlEnvLib.h
@@ -292,7 +292,7 @@ MV_U32 mvCtrlPexActiveUnitNumGet(MV_VOID);
 #if defined(MV_INCLUDE_PCI)
 #define mvCtrlPciIfMaxIfGet()           1
 #else
-#define mvCtrlPciIfMaxIfGet()           0
+#define mvCtrlPciIfMaxIfGet()           (mvCtrlPexMaxIfGet())
 #endif
 
 MV_U32 mvCtrlEthMaxPortGet(MV_VOID);
-- 
1.7.5.4

