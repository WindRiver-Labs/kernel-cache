From 1efd2caa289f039ecfb91eac7ee14e7c80fbb217 Mon Sep 17 00:00:00 2001
From: Zhong Hongbo <hongbo.zhong@windriver.com>
Date: Fri, 10 Oct 2014 16:29:57 +0800
Subject: [PATCH 1814/1825] armada-38x: Fix the compile warning for the mixed
 declarations

commit  2a264cab555e [a38x: improved support for customer board porting] from
https://github.com/MISL-EBU-System-SW/misl-windriver.git linux-3.4.69-14t2-read
introduces the following compile warning:

arch/arm/mach-armada38x/armada_38x_family/boardEnv/mvBoardEnvLib.c: In function 'mvBoardIdGet':
arch/arm/mach-armada38x/armada_38x_family/boardEnv/mvBoardEnvLib.c:1994:2: warning: ISO C90 forbids mixed declarations and code [-Wdeclaration-after-statement]

Signed-off-by: Zhong Hongbo <hongbo.zhong@windriver.com>
---
 .../armada_38x_family/boardEnv/mvBoardEnvLib.c     |    3 ++-
 .../armada_38x_family/ctrlEnv/mvCtrlEnvLib.c       |    9 ++++++---
 2 files changed, 8 insertions(+), 4 deletions(-)

diff --git a/arch/arm/mach-armada38x/armada_38x_family/boardEnv/mvBoardEnvLib.c b/arch/arm/mach-armada38x/armada_38x_family/boardEnv/mvBoardEnvLib.c
index 4e2b12c..e22ddb0 100644
--- a/arch/arm/mach-armada38x/armada_38x_family/boardEnv/mvBoardEnvLib.c
+++ b/arch/arm/mach-armada38x/armada_38x_family/boardEnv/mvBoardEnvLib.c
@@ -1978,6 +1978,8 @@ MV_VOID mvBoardSet(MV_U32 boardId)
 *******************************************************************************/
 MV_U32 mvBoardIdGet(MV_VOID)
 {
+	MV_U8 readValue;
+
 	if (gBoardId != -1)
 		return gBoardId;
 
@@ -1991,7 +1993,6 @@ MV_U32 mvBoardIdGet(MV_VOID)
 	/* For Marvell Boards: Temporarily set generic board struct pointer to
 	   use S@R TWSI address, and read board ID */
 	board = marvellBoardInfoTbl[mvBoardIdIndexGet(DB_68XX_ID)];
-	MV_U8 readValue;
 	if (mvBoardTwsiGet(BOARD_DEV_TWSI_SATR, 0, 0, &readValue) != MV_OK) {
 		mvOsPrintf("%s: Error: Read from TWSI failed\n", __func__);
 		mvOsPrintf("%s: Set default board ID to DB-88F6820-BP\n", __func__);
diff --git a/arch/arm/mach-armada38x/armada_38x_family/ctrlEnv/mvCtrlEnvLib.c b/arch/arm/mach-armada38x/armada_38x_family/ctrlEnv/mvCtrlEnvLib.c
index fec5955..2c3e3ea 100644
--- a/arch/arm/mach-armada38x/armada_38x_family/ctrlEnv/mvCtrlEnvLib.c
+++ b/arch/arm/mach-armada38x/armada_38x_family/ctrlEnv/mvCtrlEnvLib.c
@@ -454,8 +454,8 @@ MV_STATUS mvCtrlEnvInit(MV_VOID)
 *******************************************************************************/
 MV_STATUS mvCtrlCpuDdrL2FreqGet(MV_FREQ_MODE *freqMode)
 {
-	MV_FREQ_MODE freqTable[] = MV_SAR_FREQ_MODES;
 	MV_U32 freqModeSatRValue, satrVal, i;
+	MV_FREQ_MODE freqTable[] = MV_SAR_FREQ_MODES;
 
 	satrVal = MV_REG_READ(MPP_SAMPLE_AT_RESET);
 	freqModeSatRValue = (satrVal & SATR_CPU_FREQ_MASK) >> SATR_CPU_FREQ_OFFS;
@@ -1579,12 +1579,13 @@ MV_VOID mvCtrlPwrClckSet(MV_UNIT_ID unitId, MV_U32 index, MV_BOOL enable)
 MV_BOOL mvCtrlPwrClckGet(MV_UNIT_ID unitId, MV_U32 index)
 {
 	MV_BOOL state = MV_TRUE;
+	MV_U32 reg;
 
 	/* Clock gating is not supported on FPGA */
 	if (mvCtrlModelGet() == MV_FPGA_DEV_ID)
 		return MV_TRUE;
 
-	MV_U32 reg = MV_REG_READ(POWER_MNG_CTRL_REG);
+	reg = MV_REG_READ(POWER_MNG_CTRL_REG);
 	switch (unitId) {
 #if defined(MV_INCLUDE_PEX)
 	case PEX_UNIT_ID:
@@ -1734,10 +1735,12 @@ MV_U32 mvCtrlGetJuncTemp(MV_VOID)
 *******************************************************************************/
 void mvCtrlNandClkSet(int nClock)
 {
+	MV_U32 nVal;
+
 	if (nClock == 5)     /* Temporary WA for A38x: the divider by 5 is not stable */
 		nClock = 4;   /* Temorary divider by 4  is used */
 	/* Set the division ratio of ECC Clock 0x00018748[13:8] (by default it's double of core clock) */
-	MV_U32 nVal = MV_REG_READ(CORE_DIV_CLK_CTRL(1));
+	nVal = MV_REG_READ(CORE_DIV_CLK_CTRL(1));
 	nVal &= ~(NAND_ECC_DIVCKL_RATIO_MASK);
 	nVal |= (nClock << NAND_ECC_DIVCKL_RATIO_OFFS);
 	MV_REG_WRITE(CORE_DIV_CLK_CTRL(1), nVal);
-- 
1.7.5.4

