From 6d684fe8129a7a4eb00288e16b09e645ef0a678e Mon Sep 17 00:00:00 2001
From: Ofer Heifetz <oferh@marvell.com>
Date: Mon, 7 Apr 2014 11:58:24 +0300
Subject: [PATCH 1533/1825] fix: msys: clock: use 25MHz ref clock by timers

https://github.com/MISL-EBU-System-SW/misl-windriver.git linux-3.4.69-14t2-read
commit adb2713fea414f83ba6f976fa4fc51f56d1c0ceb

	This bugs caused the wrong ref clock to be used by
	msys, this caused the timer to be slowed by a factor
	of 8 (200MHz instead of 25MHz).

Change-Id: Ic18da951096c82f563d2ba427b21df3219617ad1
Signed-off-by: Ofer Heifetz <oferh@marvell.com>
Reviewed-on: http://vgitil04.il.marvell.com:8080/6931
Tested-by: Star_Automation <star@marvell.com>
Reviewed-by: Lior Amsalem <alior@marvell.com>
Signed-off-by: Zhong Hongbo <hongbo.zhong@windriver.com>
---
 arch/arm/mach-msys/time.c |    5 +++--
 1 files changed, 3 insertions(+), 2 deletions(-)

diff --git a/arch/arm/mach-msys/time.c b/arch/arm/mach-msys/time.c
index 9b90964..b3a0287 100644
--- a/arch/arm/mach-msys/time.c
+++ b/arch/arm/mach-msys/time.c
@@ -286,7 +286,7 @@ static irqreturn_t msys_localtimer_handler(int irq, void *dev_id)
  */
 int __cpuinit msys_local_timer_setup(struct clock_event_device *clk)
 {
-	unsigned int fabric_clk = mvCpuL2ClkGet();
+	unsigned int fabric_clk = MV_BOARD_REFCLK_25MHZ;
 	static int cpu0_flag = -1;
 	int cpu = smp_processor_id();
 	struct clock_event_device **this_cpu_clk;
@@ -400,5 +400,6 @@ void __init msys_time_init(unsigned int fabric_clk)
 
 void __init msys_timer_init(void)
 {
-	msys_time_init(mvCpuL2ClkGet());
+	msys_time_init(MV_BOARD_REFCLK_25MHZ);
 }
+
-- 
1.7.5.4

