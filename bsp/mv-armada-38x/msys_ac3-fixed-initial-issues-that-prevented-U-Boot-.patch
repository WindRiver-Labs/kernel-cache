From bdb8cae66b023379837e7b2d5a5517a29e5c7728 Mon Sep 17 00:00:00 2001
From: Omri Itach <omrii@marvell.com>
Date: Sun, 8 Jun 2014 16:45:55 +0300
Subject: [PATCH 1733/1825] msys_ac3: fixed initial issues that prevented
 U-Boot prompt

https://github.com/MISL-EBU-System-SW/misl-windriver.git linux-3.4.69-14t2-read
commit b85bceddf31365169b5a837eaba45f1e8a2163c1

	- Fixed Tclk routine to return static value of 200MHz
	- Updated PCIe IF count to be 1 for AC3
	- Added AC3 to the same arch number used for BC2 (will use the same LSP)

	** U-Boot reach prompt over Lauterbach initialization sequence**

Change-Id: Icf634a040d30b952c6e642e962560cc6da18fb9f
Signed-off-by: Omri Itach <omrii@marvell.com>
Reviewed-on: http://vgitil04.il.marvell.com:8080/8421
Tested-by: Star_Automation <star@marvell.com>
Reviewed-by: Kostya Porotchkin <kostap@marvell.com>
Reviewed-on: http://vgitil04.il.marvell.com:8080/8585
Reviewed-by: Hanna Hawa <hannah@marvell.com>
Signed-off-by: Zhong Hongbo <hongbo.zhong@windriver.com>
---
 .../mach-msys/msys_family/boardEnv/mvBoardEnvLib.c |    9 +--------
 .../mach-msys/msys_family/ctrlEnv/mvCtrlEnvLib.c   |    2 +-
 2 files changed, 2 insertions(+), 9 deletions(-)

diff --git a/arch/arm/mach-msys/msys_family/boardEnv/mvBoardEnvLib.c b/arch/arm/mach-msys/msys_family/boardEnv/mvBoardEnvLib.c
index 53fc416..af0dfec 100644
--- a/arch/arm/mach-msys/msys_family/boardEnv/mvBoardEnvLib.c
+++ b/arch/arm/mach-msys/msys_family/boardEnv/mvBoardEnvLib.c
@@ -457,14 +457,7 @@ MV_BOARD_MAC_SPEED mvBoardMacSpeedGet(MV_U32 ethPortNum)
 *******************************************************************************/
 MV_U32 mvBoardTclkGet(MV_VOID)
 {
-	MV_U16 family = mvCtrlDevFamilyIdGet(0);
-	MV_U8 tclkValue;
-
-	if (family == MV_ALLEYCAT3_DEV_ID && mvBoardCoreFreqGet(&tclkValue) == MV_OK)
-		return tclkValue;
-
-	/* BC2 use constant Tclock@200MHz (not sampled @ reset)  */
-	return 200000000;
+	return 200000000; /* constant Tclock @ 200MHz (not Sampled@Reset)  */
 }
 
 /*******************************************************************************
diff --git a/arch/arm/mach-msys/msys_family/ctrlEnv/mvCtrlEnvLib.c b/arch/arm/mach-msys/msys_family/ctrlEnv/mvCtrlEnvLib.c
index 5dadc28..828c1d0 100644
--- a/arch/arm/mach-msys/msys_family/ctrlEnv/mvCtrlEnvLib.c
+++ b/arch/arm/mach-msys/msys_family/ctrlEnv/mvCtrlEnvLib.c
@@ -103,7 +103,7 @@ SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.
 MV_UNIT_ID mvCtrlSocUnitNums[MAX_UNITS_ID][MV_MSYS_INDEX_MAX] = {
 /*			    BC2		AC3 */
 /* DRAM_UNIT_ID         */ { 1,		1, },
-/* PEX_UNIT_ID          */ { 1,		2, },
+/* PEX_UNIT_ID          */ { 1,		1, },
 /* ETH_GIG_UNIT_ID      */ { 2,		1, },
 /* XOR_UNIT_ID          */ { 1,		1, },
 /* UART_UNIT_ID         */ { 2,		2, },
-- 
1.7.5.4

