From 6248a8d2b1c19cf0b8cdd59957c10e10c33ee94c Mon Sep 17 00:00:00 2001
From: Dovrat <dovrat@marvell.com>
Date: Wed, 7 May 2014 12:46:28 +0300
Subject: [PATCH 1631/1825] pp3: bm: verifications in sysfs

https://github.com/MISL-EBU-System-SW/misl-windriver.git linux-3.4.69-14t2-read
commit 1d95da2edbe6018b46762312735b663a151d84a4

Change-Id: I9aa32669c47c702405fd4a3e72741a77fcd1c5e3
Signed-off-by: Dovrat <dovrat@marvell.com>
Reviewed-on: http://vgitil04.il.marvell.com:8080/7866
Tested-by: Star_Automation <star@marvell.com>
Reviewed-by: Yelena Krivosheev <yelena@marvell.com>
Reviewed-by: Dmitri Epshtein <dima@marvell.com>
Tested-by: Dmitri Epshtein <dima@marvell.com>
Signed-off-by: Zhong Hongbo <hongbo.zhong@windriver.com>
---
 drivers/net/ethernet/marvell/pp3/bm/mv_bm_sysfs.c |   11 +++++++++--
 1 files changed, 9 insertions(+), 2 deletions(-)

diff --git a/drivers/net/ethernet/marvell/pp3/bm/mv_bm_sysfs.c b/drivers/net/ethernet/marvell/pp3/bm/mv_bm_sysfs.c
index 4859332..f4bf81f 100644
--- a/drivers/net/ethernet/marvell/pp3/bm/mv_bm_sysfs.c
+++ b/drivers/net/ethernet/marvell/pp3/bm/mv_bm_sysfs.c
@@ -306,10 +306,17 @@ static ssize_t mv_bm_config(struct device *dev,
 			pr_err("problem: pool cache min&max fill level should be idenitcal\n");
 			return -1;
 		}
-		if ((rd_ptr != 0) || (wr_ptr != 0) || (fill_level_min != 0) || (fill_level_max != 0)) {
-			pr_err("problem: pool cache was never read/write/filled\n");
+		if ((fill_level_min != 0) || (fill_level_max != 0)) {
+			pr_err("problem: pool cache was never read/write/filled .. fill should be 0\n");
 			return -1;
 		}
+		if ((rd_ptr != 0) || (wr_ptr != 0)) {
+			if (rd_ptr != wr_ptr) {
+				pr_err("problem: pool cache was never read/write/filled should be identical\n");
+				return -1;
+			} else
+				pr_err("Note: since there are no buffer disregards rd/wr cache ptr\n");
+		}
 
 		bm_bank_intr_pool_fill_get(0, &ne, &ae, &af);
 		pr_info("bank 0 ne %x ae %x af %x\n", ne, ae, af);
-- 
1.7.5.4

