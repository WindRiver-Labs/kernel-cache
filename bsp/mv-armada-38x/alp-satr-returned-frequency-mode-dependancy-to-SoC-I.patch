From 10213f4c041db52792fe21720c62bfcdbdf5fbe9 Mon Sep 17 00:00:00 2001
From: Omri Itach <omrii@marvell.com>
Date: Wed, 21 Aug 2013 11:13:41 +0300
Subject: [PATCH 0963/1825] alp: satr: returned frequency mode dependancy, to
 SoC ID

https://github.com/MISL-EBU-System-SW/misl-windriver.git linux-3.4.69-14t2-read
commit a75056ad316c0838cd20c1981135d42b07219c39

	Before, the supported frequency mode was dependant on board ID.
	RD boards doesn't support altering sample at reset values,
	but They support the same frequency modes as their DB boards equivlent SoC.
	another motivation is to reduce boardID dependecies to minimum required
	- changed dependency to be according to SoC ID, instead of board ID

Change-Id: Idf65fd78a5307953f068d853e1cb7af6e84ce3c5
Signed-off-by: Omri Itach <omrii@marvell.com>
Reviewed-on: http://vgitil04.il.marvell.com:8080/3059
Signed-off-by: Zhong Hongbo <hongbo.zhong@windriver.com>
---
 .../avanta_lp_family/boardEnv/mvBoardEnvLib.c      |   20 +++++++++-----------
 .../avanta_lp_family/ctrlEnv/mvCtrlEnvLib.c        |    6 ++----
 .../avanta_lp_family/ctrlEnv/mvCtrlEnvSpec.h       |    6 +++---
 3 files changed, 14 insertions(+), 18 deletions(-)

diff --git a/arch/arm/mach-avantalp/avanta_lp_family/boardEnv/mvBoardEnvLib.c b/arch/arm/mach-avantalp/avanta_lp_family/boardEnv/mvBoardEnvLib.c
index 88721eb..51c6868 100644
--- a/arch/arm/mach-avantalp/avanta_lp_family/boardEnv/mvBoardEnvLib.c
+++ b/arch/arm/mach-avantalp/avanta_lp_family/boardEnv/mvBoardEnvLib.c
@@ -1525,8 +1525,7 @@ MV_U32 mvBoardSwitchPortForceLinkGet(MV_U32 switchIdx)
 /*******************************************************************************
 * mvBoardFreqModesNumGet
 *
-* DESCRIPTION:
-*      Return the number of supported frequency modes for this board
+* DESCRIPTION: Return the number of supported frequency modes for this SoC
 *
 *
 * INPUT:
@@ -1543,19 +1542,18 @@ MV_U32 mvBoardFreqModesNumGet()
 {
 	MV_U32 freqNum;
 
-	switch (mvBoardIdGet()) {
-	case DB_6650_ID:
-		freqNum = FREQ_MODES_NUM_DB_6650;
+	switch (mvCtrlModelGet()) {
+	case MV_6610_DEV_ID:
+		freqNum = FREQ_MODES_NUM_6610;
 		break;
-	case DB_6660_ID:
-		freqNum = FREQ_MODES_NUM_DB_6660;
+	case MV_6650_DEV_ID:
+		freqNum = FREQ_MODES_NUM_6650;
 		break;
-	case RD_6650_ID:
-	case RD_6660_ID:
-		freqNum = FREQ_MODES_NUM_RD_66X0;
+	case MV_6660_DEV_ID:
+		freqNum = FREQ_MODES_NUM_6660;
 		break;
 	default:
-		mvOsPrintf("%s: Error: IO Expander doesn't exists on board\n", __func__);
+		mvOsPrintf("%s: Error: failed to read ctrlModel (SoC ID)\n", __func__);
 		return MV_ERROR;
 	}
 
diff --git a/arch/arm/mach-avantalp/avanta_lp_family/ctrlEnv/mvCtrlEnvLib.c b/arch/arm/mach-avantalp/avanta_lp_family/ctrlEnv/mvCtrlEnvLib.c
index 6c15c5a..95b0cc9 100755
--- a/arch/arm/mach-avantalp/avanta_lp_family/ctrlEnv/mvCtrlEnvLib.c
+++ b/arch/arm/mach-avantalp/avanta_lp_family/ctrlEnv/mvCtrlEnvLib.c
@@ -279,10 +279,10 @@ MV_STATUS mvCtrlEnvInit(MV_VOID)
 
 	/* Set I2C MPP's(MPP Group 1), before reading board configuration, using TWSI read */
 	MV_REG_WRITE(mvCtrlMppRegGet(1), GROUP1_DEFAULT_MPP_SPI_I2C);
-
 	mvCtrlSatrInit();
 
-	/* If set to Auto detect, read board config info, update Eth-Complex config, MPP group types and switch info */
+	/* If set to Auto detect, read board config information,
+	 * Accordingly update Eth-Complex config, MPP group types and switch info */
 	if (mvBoardConfigAutoDetectEnabled()) {
 		mvCtrlSysConfigInit();
 		mvBoardInfoUpdate();
@@ -300,7 +300,6 @@ MV_STATUS mvCtrlEnvInit(MV_VOID)
 	/* clear all int */
 	for (i = 0; i < MV_GPP_MAX_GROUP; i++)
 		MV_REG_WRITE(GPP_INT_CAUSE_REG(i), 0x0);
-
 	/* Set gpp interrupts as needed */
 	for (i = 0; i < MV_GPP_MAX_GROUP; i++) {
 		gppMask = mvBoardGpioIntMaskGet(i);
@@ -309,7 +308,6 @@ MV_STATUS mvCtrlEnvInit(MV_VOID)
 	}
 
 	mvEthComplexInit(mvBoardEthComplexConfigGet());
-
 	/*
 	 * Enable NAND Flash PUP (Pack-Unpack)
 	 * HW machanism to accelerate transactions (controlled by SoC register)
diff --git a/arch/arm/mach-avantalp/avanta_lp_family/ctrlEnv/mvCtrlEnvSpec.h b/arch/arm/mach-avantalp/avanta_lp_family/ctrlEnv/mvCtrlEnvSpec.h
index 987a248..5c86ada 100755
--- a/arch/arm/mach-avantalp/avanta_lp_family/ctrlEnv/mvCtrlEnvSpec.h
+++ b/arch/arm/mach-avantalp/avanta_lp_family/ctrlEnv/mvCtrlEnvSpec.h
@@ -260,9 +260,9 @@ extern "C" {
 
 #define TBL_UNUSED      0       /* Used to mark unused entry */
 #define FREQ_MODES_NUM		29
-#define FREQ_MODES_NUM_RD_66X0	0
-#define FREQ_MODES_NUM_DB_6650	3
-#define FREQ_MODES_NUM_DB_6660	4
+#define FREQ_MODES_NUM_6610	0
+#define FREQ_MODES_NUM_6650	3
+#define FREQ_MODES_NUM_6660	4
 
 
 #define MPP_GROUP_0_TYPE { \
-- 
1.7.5.4

