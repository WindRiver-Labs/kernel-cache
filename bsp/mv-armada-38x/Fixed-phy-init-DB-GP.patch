From eaf00db9bb7cc42a5c069fa2ce719ca5bba45f4c Mon Sep 17 00:00:00 2001
From: Eli Nidam <elini@marvell.com>
Date: Mon, 7 Jan 2013 17:18:08 +0200
Subject: [PATCH 0424/1825] Fixed phy init DB/GP

https://github.com/MISL-EBU-System-SW/misl-windriver.git linux-3.4.69-14t2-read
commit 3cd29d05e882b1354a0cb71c47b80ef2cbfd0039

Change-Id: I0469b28ff46bbd197c36a26a676cdb1637b165a8
Signed-off-by: Eli Nidam <elini@marvell.com>
Signed-off-by: Zhong Hongbo <hongbo.zhong@windriver.com>
---
 arch/arm/plat-armada/mv_hal/eth-phy/mvEthPhy.c |   20 ++++++++++++--------
 1 files changed, 12 insertions(+), 8 deletions(-)

diff --git a/arch/arm/plat-armada/mv_hal/eth-phy/mvEthPhy.c b/arch/arm/plat-armada/mv_hal/eth-phy/mvEthPhy.c
index 7149295..fc21ba0 100755
--- a/arch/arm/plat-armada/mv_hal/eth-phy/mvEthPhy.c
+++ b/arch/arm/plat-armada/mv_hal/eth-phy/mvEthPhy.c
@@ -1675,6 +1675,7 @@ MV_VOID mvEth1540A1PhyBasicInit(MV_U32 ethPortNum, MV_BOOL eeeEnable)
 {
 	int i = ethphyHalData.phyAddr[ethPortNum];
 	MV_U16 reg;
+	int port0 = ethphyHalData.QuadPhyPort0[ethPortNum];
 
 	/* Enable QSGMII AN */
 	/* Set page to 4. */
@@ -1741,23 +1742,24 @@ MV_VOID mvEth1540A1PhyBasicInit(MV_U32 ethPortNum, MV_BOOL eeeEnable)
 	mvEthPhyRegWrite(i, 0x10, reg);
 	mvEthPhyRegWrite(i, 0x16, 0x0);
 
+	DB2(printf("%s: configure jumbo QuadPhyPort=0x%x offset = 0x%x\n",__FUNCTION__,port0, offs));
 	if (0 == initJumboPackets) {
 		int j;
 		initJumboPackets = 1;
 
-		mvEthPhyRegWrite(i, 0x16, 0x10);
+		mvEthPhyRegWrite(port0, 0x16, 0x10);
 		/* assume we want all ports to support jumbo*/
 		for(j = 0 ; j < MV_ETH_MAX_PORTS; j++)
 		{
-			mvEthPhyRegWrite(i, 0x01, ((0x800*j)+0x40)) ;
-			mvEthPhyRegWrite(i, 0x02, 0xFFF9);
-			mvEthPhyRegWrite(i, 0x03, 0x1);
+			mvEthPhyRegWrite(port0, 0x01, ((0x800*j)+0x40)) ;
+			mvEthPhyRegWrite(port0, 0x02, 0xFFF9);
+			mvEthPhyRegWrite(port0, 0x03, 0x1);
 
-			mvEthPhyRegWrite(i, 0x01,  ((0x800*j)+0x50));
-			mvEthPhyRegWrite(i, 0x02, 0xFFF9);
-			mvEthPhyRegWrite(i, 0x03, 0x1);
+			mvEthPhyRegWrite(port0, 0x01,  ((0x800*j)+0x50));
+			mvEthPhyRegWrite(port0, 0x02, 0xFFF9);
+			mvEthPhyRegWrite(port0, 0x03, 0x1);
 		}
-		mvEthPhyRegWrite(i, 0x16, 0x0);
+		mvEthPhyRegWrite(port0, 0x16, 0x0);
 	}
 
 	/* Configure LED */
@@ -1901,6 +1903,7 @@ MV_VOID mvEth1540A0PhyBasicInit(MV_U32 ethPortNum, MV_BOOL eeeEnable)
 	mvEthPhyRegWrite(i, 0x10, reg);
 	mvEthPhyRegWrite(i, 0x16, 0x0);
 
+	DB2(printf("%s: configure jumbo QuadPhyPort=0x%x offset = 0x%x\n",__FUNCTION__,port0, offs));
 	if (0 == initJumboPackets) {
 		int j;
 		initJumboPackets = 1;
@@ -1919,6 +1922,7 @@ MV_VOID mvEth1540A0PhyBasicInit(MV_U32 ethPortNum, MV_BOOL eeeEnable)
 		}
 		mvEthPhyRegWrite(port0, 0x16, 0x0);
 	}
+
 	/* Configure LED */
 	mvEthPhyRegWrite(i, 22, 3);
 	mvEthPhyRegWrite(i, 16, 0x1111);
-- 
1.7.5.4

