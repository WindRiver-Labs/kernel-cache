From d6711205edbb854fc5fbe4e1fe282b61bdd26e49 Mon Sep 17 00:00:00 2001
From: Ofer Heifetz <oferh@marvell.com>
Date: Tue, 4 Feb 2014 16:40:42 +0200
Subject: [PATCH 1331/1825] smi: msys: add GMAC PHY SMI support

https://github.com/MISL-EBU-System-SW/misl-windriver.git linux-3.4.69-14t2-read
commit f4d5803e20e17b12803f50b912623d9482576d25

        -removed MV_ETH_LEGACY support
        -added basic phy and neta support + phy init
        -added CPU interface address decode print during bc2 init
        -since HW issue the only UT for read/write of phy smi register
          was performed regarding correctness of register offset, only next
          HW spin will fix this limitation which then should be verified

Change-Id: I43b5f8b09e2ce761a9e88df5d727c030f706eb24
Signed-off-by: Ofer Heifetz <oferh@marvell.com>
Reviewed-on: http://vgitil04.il.marvell.com:8080/5454
Tested-by: Star_Automation <star@marvell.com>
Reviewed-by: Dmitri Epshtein <dima@marvell.com>
Signed-off-by: Zhong Hongbo <hongbo.zhong@windriver.com>
---
 arch/arm/configs/msys_defconfig                    |    2 +-
 arch/arm/mach-msys/Makefile                        |    6 +-
 arch/arm/mach-msys/config/mvSysEthConfig.h         |   84 ----------------
 arch/arm/mach-msys/core.c                          |   12 ++-
 .../mach-msys/msys_family/boardEnv/mvBoardEnvLib.c |    5 +
 .../mach-msys/msys_family/ctrlEnv/mvCtrlEnvLib.c   |   14 +--
 .../mach-msys/msys_family/ctrlEnv/mvCtrlEnvRegs.h  |    2 +
 .../mach-msys/msys_family/ctrlEnv/mvCtrlEnvSpec.h  |    7 +-
 arch/arm/mach-msys/mv_hal_if/mvSysEthPhy.c         |  102 ++++++++++++++++++++
 arch/arm/mach-msys/mv_hal_if/mvSysEthPhyApi.h      |   70 +++++++++++++
 arch/arm/plat-armada/Kconfig                       |    2 +-
 11 files changed, 201 insertions(+), 105 deletions(-)
 create mode 100644 arch/arm/mach-msys/mv_hal_if/mvSysEthPhy.c
 create mode 100644 arch/arm/mach-msys/mv_hal_if/mvSysEthPhyApi.h

diff --git a/arch/arm/configs/msys_defconfig b/arch/arm/configs/msys_defconfig
index a621f70..f603c14 100644
--- a/arch/arm/configs/msys_defconfig
+++ b/arch/arm/configs/msys_defconfig
@@ -18,12 +18,12 @@ CONFIG_MODULE_UNLOAD=y
 CONFIG_PARTITION_ADVANCED=y
 CONFIG_EFI_PARTITION=y
 CONFIG_ARCH_MSYS=y
-# CONFIG_MV_INCLUDE_GIG_ETH is not set
 CONFIG_MV_HAL_RULES_PATH="arch/arm/mach-armadaxp/mv_hal_support/mvRules.mk"
 # CONFIG_MV_INCLUDE_XOR is not set
 # CONFIG_MV_INCLUDE_NFC is not set
 # CONFIG_MV_INCLUDE_SDIO is not set
 CONFIG_MV_PMU_PROC=y
+CONFIG_MV_ETH_GROUP0_CPU=0x3
 # CONFIG_SWP_EMULATE is not set
 CONFIG_SHEEVA_ERRATA_ARM_CPU_PMU_RESET=y
 CONFIG_PCI_DEBUG=y
diff --git a/arch/arm/mach-msys/Makefile b/arch/arm/mach-msys/Makefile
index e310ee3..b1534ff 100644
--- a/arch/arm/mach-msys/Makefile
+++ b/arch/arm/mach-msys/Makefile
@@ -39,7 +39,7 @@ msys-objs  			:=$(LSP_OBJS) $(COMMON_OBJS) $(OSSERVICES_OBJS) $(HAL_OBJS) 	\
 
 msys-$(CONFIG_MV_INCLUDE_PEX) 	+= $(HAL_PEX_DIR)/mvPex.o					\
 					$(HAL_IF_DIR)/mvSysPex.o $(HAL_PEX_DIR)/mvPexAddrDec.o
-
+msys-y				+= $(HAL_ETHPHY_DIR)/mvEthPhy.o $(HAL_IF_DIR)/mvSysEthPhy.o
 msys-$(CONFIG_MV_INCLUDE_PCI) 	+= $(HAL_PCI_DIR)/mvPci.o $(HAL_IF_DIR)/mvSysPci.o
 
 msys-$(CONFIG_MV_INCLUDE_SPI) 	+= $(HAL_SPI_DIR)/mvSpi.o $(HAL_SPI_DIR)/mvSpiCmnd.o 			\
@@ -47,10 +47,10 @@ msys-$(CONFIG_MV_INCLUDE_SPI) 	+= $(HAL_SPI_DIR)/mvSpi.o $(HAL_SPI_DIR)/mvSpiCmn
 					   $(HAL_IF_DIR)/mvSysSpi.o
 msys-$(CONFIG_MV_CPU_L2_PERF_CNTRS) += $(HAL_CPU_DIR)/mvCpuL2Cntrs.o
 
-obj-$(CONFIG_MV_INCLUDE_SWITCH) 	+= $(QD_OBJS)
+obj-$(CONFIG_MV_ETH_NETA)		+= $(LSP_NETA_DIR)/
 
 # drivers part
-
+obj-$(CONFIG_MV_INCLUDE_GIG_ETH)	+= $(LSP_PHY_DIR)/phy_sysfs.o
 obj-$(CONFIG_ERROR_HANDLING)		+= $(LSP_ERR_DIR)/mv_error.o
 obj-y					+= $(PLAT_DRIVERS)/mv_gpio/
 obj-$(CONFIG_MV_DBG_TRACE)              += $(PLAT_DRIVERS)/mv_trace/
diff --git a/arch/arm/mach-msys/config/mvSysEthConfig.h b/arch/arm/mach-msys/config/mvSysEthConfig.h
index d19f3ca..0cac1d9 100644
--- a/arch/arm/mach-msys/config/mvSysEthConfig.h
+++ b/arch/arm/mach-msys/config/mvSysEthConfig.h
@@ -91,93 +91,9 @@ SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.
 
 #if defined(CONFIG_MV_INCLUDE_GIG_ETH)
 
-/* put descriptors in uncached memory */
-/* #define ETH_DESCR_UNCACHED */
-
 /* port's default queueus */
 #define ETH_DEF_RXQ         0
 
-#ifdef CONFIG_MV_ETH_LEGACY
-
-/* Default configuration for TX_EN workaround: 0 - Disabled, 1 - Enabled */
-#define MV_ETH_TX_EN_DEFAULT        0
-
-/* un-comment if you want to perform tx_done from within the poll function */
-/* #define ETH_TX_DONE_ISR */
-
-/* Descriptors location: DRAM/internal-SRAM */
-#define ETH_DESCR_IN_SDRAM
-#undef  ETH_DESCR_IN_SRAM    /* No integrated SRAM in 88Fxx81 devices */
-
-#if defined(ETH_DESCR_IN_SRAM)
-#if defined(ETH_DESCR_UNCACHED)
- #define ETH_DESCR_CONFIG_STR    "Uncached descriptors in integrated SRAM"
-#else
- #define ETH_DESCR_CONFIG_STR    "Cached descriptors in integrated SRAM"
-#endif
-#elif defined(ETH_DESCR_IN_SDRAM)
-#if defined(ETH_DESCR_UNCACHED)
- #define ETH_DESCR_CONFIG_STR    "Uncached descriptors in DRAM"
-#else
- #define ETH_DESCR_CONFIG_STR    "Cached descriptors in DRAM"
-#endif
-#else
- #error "Ethernet descriptors location undefined"
-#endif /* ETH_DESCR_IN_SRAM or ETH_DESCR_IN_SDRAM*/
-
-/* SW Sync-Barrier: not relevant for 88fxx81*/
-/* Reasnable to define this macro when descriptors in SRAM and buffers in DRAM */
-/* In RX the CPU theoretically might see himself as the descriptor owner,      */
-/* although the buffer hadn't been written to DRAM yet. Performance cost.      */
-/* #define INCLUDE_SYNC_BARR */
-
-/* Buffers cache coherency method (buffers in DRAM) */
-#ifndef MV_CACHE_COHER_SW
-/* Taken from mvCommon.h */
-/* Memory uncached, HW or SW cache coherency is not needed */
-#define MV_UNCACHED		0
-/* Memory cached, HW cache coherency supported in WriteThrough mode */
-#define MV_CACHE_COHER_HW_WT	1
-/* Memory cached, HW cache coherency supported in WriteBack mode */
-#define MV_CACHE_COHER_HW_WB	2
-/* Memory cached, No HW cache coherency, Cache coherency must be in SW */
-#define MV_CACHE_COHER_SW	3
-#endif
-
-#define ETHER_DRAM_COHER	MV_CACHE_COHER_SW   /* No HW coherency in 88Fxx81 devices */
-
-#if (ETHER_DRAM_COHER == MV_CACHE_COHER_HW_WB)
- #define ETH_SDRAM_CONFIG_STR		"DRAM HW cache coherency (write-back)"
-#elif (ETHER_DRAM_COHER == MV_CACHE_COHER_HW_WT)
- #define ETH_SDRAM_CONFIG_STR		"DRAM HW cache coherency (write-through)"
-#elif (ETHER_DRAM_COHER == MV_CACHE_COHER_SW)
- #define ETH_SDRAM_CONFIG_STR		"DRAM SW cache-coherency"
-#elif (ETHER_DRAM_COHER == MV_UNCACHED)
-#   define ETH_SDRAM_CONFIG_STR		"DRAM uncached"
-#else
- #error "Ethernet-DRAM undefined"
-#endif /* ETHER_DRAM_COHER */
-
-
-/****************************************************************/
-/************* Ethernet driver configuration ********************/
-/****************************************************************/
-
-/* port's default queueus */
-#define ETH_DEF_TXQ		0
-
-#define MV_ETH_RX_Q_NUM		CONFIG_MV_ETH_RXQ
-#define MV_ETH_TX_Q_NUM		CONFIG_MV_ETH_TXQ
-
-/* interrupt coalescing setting */
-#define ETH_TX_COAL		200
-#define ETH_RX_COAL		200
-
-/* Checksum offloading */
-#define				TX_CSUM_OFFLOAD
-#define				RX_CSUM_OFFLOAD
-#endif /* CONFIG_MV_ETH_LEGACY */
-
 #endif /* CONFIG_MV_INCLUDE_GIG_ETH */
 
 #endif /* __mvSysEthConfig_h__ */
diff --git a/arch/arm/mach-msys/core.c b/arch/arm/mach-msys/core.c
index fe36236..4f42f1d 100644
--- a/arch/arm/mach-msys/core.c
+++ b/arch/arm/mach-msys/core.c
@@ -80,6 +80,8 @@ disclaimer.
 #include "cpu/mvCpu.h"
 #include "include/mach/irqs.h"
 
+#include <linux/mv_neta.h>
+
 /* I2C */
 #include <linux/i2c.h>
 #include <linux/mv643xx_i2c.h>
@@ -89,6 +91,10 @@ disclaimer.
 /* SPI */
 #include "mvSysSpiApi.h"
 
+/* Eth Phy */
+#include "mvSysEthPhyApi.h"
+#include "eth-phy/mvEthPhy.h"
+
 /* for debug putstr */
 static char arr[256];
 
@@ -421,6 +427,8 @@ static void __init mv_gpio_init(void)
 }
 
 
+
+
 /*********************************************************************************/
 /**************                      Helper Routines                **************/
 /*********************************************************************************/
@@ -613,7 +621,7 @@ static void __init msys_bc2_rd_init(void)
 
 	/* At this point, the CPU windows are configured according to default definitions in mvSysHwConfig.h */
 	/* and cpuAddrWinMap table in mvCpuIf.c. Now it's time to change defaults for each platform.         */
-	/*mvCpuIfAddDecShow();*/
+	mvCpuIfAddDecShow();
 
 	print_board_info();
 
@@ -622,6 +630,8 @@ static void __init msys_bc2_rd_init(void)
 #ifdef CONFIG_MV_INCLUDE_SPI
 	mvSysSpiInit(0, _16M);
 #endif
+	/* ETH-PHY */
+	mvSysEthPhyInit();
 
 	return;
 }
diff --git a/arch/arm/mach-msys/msys_family/boardEnv/mvBoardEnvLib.c b/arch/arm/mach-msys/msys_family/boardEnv/mvBoardEnvLib.c
index 695c1e3..272cec6 100644
--- a/arch/arm/mach-msys/msys_family/boardEnv/mvBoardEnvLib.c
+++ b/arch/arm/mach-msys/msys_family/boardEnv/mvBoardEnvLib.c
@@ -73,6 +73,11 @@ SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.
 #include "pex/mvPex.h"
 #include "device/mvDevice.h"
 #include "neta/gbe/mvEthRegs.h"
+
+#if defined(CONFIG_MV_ETH_NETA)
+#include "neta/gbe/mvEthRegs.h"
+#endif
+
 #include "gpp/mvGppRegs.h"
 
 /* defines  */
diff --git a/arch/arm/mach-msys/msys_family/ctrlEnv/mvCtrlEnvLib.c b/arch/arm/mach-msys/msys_family/ctrlEnv/mvCtrlEnvLib.c
index 94a0924..120766d 100644
--- a/arch/arm/mach-msys/msys_family/ctrlEnv/mvCtrlEnvLib.c
+++ b/arch/arm/mach-msys/msys_family/ctrlEnv/mvCtrlEnvLib.c
@@ -76,11 +76,9 @@ SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.
 #include "pex/mvPexRegs.h"
 
 #if defined(MV_INCLUDE_GIG_ETH)
-#if defined(MV_ETH_LEGACY)
-#include "eth/mvEth.h"
-#else
+#if defined(CONFIG_MV_ETH_NETA)
 #include "neta/gbe/mvNeta.h"
-#endif /* MV_ETH_LEGACY or MV_ETH_NETA */
+#endif /* MV_ETH_NETA */
 #endif
 
 #if defined(MV_INCLUDE_XOR)
@@ -748,12 +746,10 @@ MV_VOID mvCtrlAddrDecShow(MV_VOID)
 #endif
 
 #if defined(MV_INCLUDE_GIG_ETH)
-#if defined(MV_ETH_LEGACY)
-	mvUnitAddrDecShow(mvCtrlEthMaxPortGet(), ETH_GIG_UNIT_ID, "ETH", mvEthWinRead);
-#else
+#if defined(CONFIG_MV_ETH_NETA)
 	mvUnitAddrDecShow(mvCtrlEthMaxPortGet(), ETH_GIG_UNIT_ID, "ETH", mvNetaWinRead);
-#endif /* MV_ETH_LEGACY */
-#endif /* MV_INCLUDE_GIG_ETH */
+#endif
+#endif
 
 #if defined(MV_INCLUDE_XOR)
 	mvUnitAddrDecShow(mvCtrlXorMaxChanGet(), XOR_UNIT_ID, "XOR", mvXorTargetWinRead);
diff --git a/arch/arm/mach-msys/msys_family/ctrlEnv/mvCtrlEnvRegs.h b/arch/arm/mach-msys/msys_family/ctrlEnv/mvCtrlEnvRegs.h
index cda0fe9..b88f3a4 100644
--- a/arch/arm/mach-msys/msys_family/ctrlEnv/mvCtrlEnvRegs.h
+++ b/arch/arm/mach-msys/msys_family/ctrlEnv/mvCtrlEnvRegs.h
@@ -151,6 +151,8 @@ extern "C" {
 #define PMC_GESTOPCLOCK_EN(port)		(1 << PMC_GESTOPCLOCK_OFFS(port))
 #define PMC_GESTOPCLOCK_STOP(port)		(0 << PMC_GESTOPCLOCK_OFFS(port))
 
+/* dummy defenition, used for SGMII capable interfaces */
+#define SGMII_SERDES_CFG_REG(port)		(0)
 
 /* Controler environment registers offsets */
 
diff --git a/arch/arm/mach-msys/msys_family/ctrlEnv/mvCtrlEnvSpec.h b/arch/arm/mach-msys/msys_family/ctrlEnv/mvCtrlEnvSpec.h
index 0e1276a..5e91cfa 100644
--- a/arch/arm/mach-msys/msys_family/ctrlEnv/mvCtrlEnvSpec.h
+++ b/arch/arm/mach-msys/msys_family/ctrlEnv/mvCtrlEnvSpec.h
@@ -104,12 +104,7 @@ extern "C" {
 #define MV_CPUIF_REGS_OFFSET(cpu)		(0x21800 + (cpu) * 0x100)
 #define MV_PMU_NFABRIC_UNIT_SERV_OFFSET		(0x22000)
 #define MV_CPU_PMU_UNIT_SERV_OFFSET(cpu)	(0x22100 + (cpu) * 0x100)
-
-#if defined(MV_ETH_LEGACY)
-	#define MV_ETH_BASE_ADDR		(0x72000)
-#else
-	#define MV_ETH_BASE_ADDR		(0x70000)
-#endif
+#define MV_ETH_BASE_ADDR			(0x70000)
 #define MV_ETH_REGS_OFFSET(port)		(MV_ETH_BASE_ADDR + (port)* 0x40000 )
 #define MV_PEX_IF_REGS_OFFSET(pexIf)\
 			(pexIf < 8 ? (0x40000 + ((pexIf) / 4) * 0x40000 + ((pexIf) % 4) * 0x4000)\
diff --git a/arch/arm/mach-msys/mv_hal_if/mvSysEthPhy.c b/arch/arm/mach-msys/mv_hal_if/mvSysEthPhy.c
new file mode 100644
index 0000000..58912d8
--- /dev/null
+++ b/arch/arm/mach-msys/mv_hal_if/mvSysEthPhy.c
@@ -0,0 +1,102 @@
+/*******************************************************************************
+Copyright (C) Marvell International Ltd. and its affiliates
+
+This software file (the "File") is owned and distributed by Marvell
+International Ltd. and/or its affiliates ("Marvell") under the following
+alternative licensing terms.  Once you have made an election to distribute the
+File under one of the following license alternatives, please (i) delete this
+introductory statement regarding license alternatives, (ii) delete the two
+license alternatives that you have not elected to use and (iii) preserve the
+Marvell copyright notice above.
+
+********************************************************************************
+Marvell Commercial License Option
+
+If you received this File from Marvell and you have entered into a commercial
+license agreement (a "Commercial License") with Marvell, the File is licensed
+to you under the terms of the applicable Commercial License.
+
+********************************************************************************
+Marvell GPL License Option
+
+If you received this File from Marvell, you may opt to use, redistribute and/or
+modify this File in accordance with the terms and conditions of the General
+Public License Version 2, June 1991 (the "GPL License"), a copy of which is
+available along with the File in the license.txt file or by writing to the Free
+Software Foundation, Inc., 59 Temple Place, Suite 330, Boston, MA 02111-1307 or
+on the worldwide web at http://www.gnu.org/licenses/gpl.txt.
+
+THE FILE IS DISTRIBUTED AS-IS, WITHOUT WARRANTY OF ANY KIND, AND THE IMPLIED
+WARRANTIES OF MERCHANTABILITY OR FITNESS FOR A PARTICULAR PURPOSE ARE EXPRESSLY
+DISCLAIMED.  The GPL License provides additional details about this warranty
+disclaimer.
+********************************************************************************
+Marvell BSD License Option
+
+If you received this File from Marvell, you may opt to use, redistribute and/or
+modify this File under the following licensing terms.
+Redistribution and use in source and binary forms, with or without modification,
+are permitted provided that the following conditions are met:
+
+    *   Redistributions of source code must retain the above copyright notice,
+	    this list of conditions and the following disclaimer.
+
+    *   Redistributions in binary form must reproduce the above copyright
+	notice, this list of conditions and the following disclaimer in the
+	documentation and/or other materials provided with the distribution.
+
+    *   Neither the name of Marvell nor the names of its contributors may be
+	used to endorse or promote products derived from this software without
+	specific prior written permission.
+
+THIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDERS AND CONTRIBUTORS "AS IS" AND
+ANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE IMPLIED
+WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE ARE
+DISCLAIMED. IN NO EVENT SHALL THE COPYRIGHT OWNER OR CONTRIBUTORS BE LIABLE FOR
+ANY DIRECT, INDIRECT, INCIDENTAL, SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES
+(INCLUDING, BUT NOT LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES;
+LOSS OF USE, DATA, OR PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND ON
+ANY THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT
+(INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE OF THIS
+SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.
+
+*******************************************************************************/
+
+#include "mvCommon.h"
+#include "mvOs.h"
+#include "ctrlEnv/mvCtrlEnvLib.h"
+#include "ctrlEnv/mvCtrlEnvSpec.h"
+#include "boardEnv/mvBoardEnvLib.h"
+#include "eth-phy/mvEthPhy.h"
+#include "neta/gbe/mvNeta.h"
+
+
+/*******************************************************************************
+* mvSysEthPhyInit - Initialize the EthPhy subsystem
+*
+* DESCRIPTION:
+*
+* INPUT:
+*       None
+* OUTPUT:
+*		None
+* RETURN:
+*       None
+*
+*******************************************************************************/
+MV_STATUS mvSysEthPhyInit(void)
+{
+	MV_ETHPHY_HAL_DATA halData;
+	MV_U32 port;
+
+	for (port = 0; port < mvCtrlEthMaxPortGet(); port++) {
+		halData.phyAddr[port] = mvBoardPhyAddrGet(port);
+		halData.boardSpecInit = MV_FALSE;
+	}
+
+	halData.ethPhySmiReg = ETH_SMI_REG(MV_ETH_SMI_PORT);
+	halData.ctrlModel = mvCtrlModelGet();
+	halData.ctrlFamily = mvCtrlDevFamilyIdGet(halData.ctrlModel);
+
+	return mvEthPhyHalInit(&halData);
+}
diff --git a/arch/arm/mach-msys/mv_hal_if/mvSysEthPhyApi.h b/arch/arm/mach-msys/mv_hal_if/mvSysEthPhyApi.h
new file mode 100644
index 0000000..02bd8db
--- /dev/null
+++ b/arch/arm/mach-msys/mv_hal_if/mvSysEthPhyApi.h
@@ -0,0 +1,70 @@
+/*******************************************************************************
+Copyright (C) Marvell International Ltd. and its affiliates
+
+This software file (the "File") is owned and distributed by Marvell
+International Ltd. and/or its affiliates ("Marvell") under the following
+alternative licensing terms.  Once you have made an election to distribute the
+File under one of the following license alternatives, please (i) delete this
+introductory statement regarding license alternatives, (ii) delete the two
+license alternatives that you have not elected to use and (iii) preserve the
+Marvell copyright notice above.
+
+********************************************************************************
+Marvell Commercial License Option
+
+If you received this File from Marvell and you have entered into a commercial
+license agreement (a "Commercial License") with Marvell, the File is licensed
+to you under the terms of the applicable Commercial License.
+
+********************************************************************************
+Marvell GPL License Option
+
+If you received this File from Marvell, you may opt to use, redistribute and/or
+modify this File in accordance with the terms and conditions of the General
+Public License Version 2, June 1991 (the "GPL License"), a copy of which is
+available along with the File in the license.txt file or by writing to the Free
+Software Foundation, Inc., 59 Temple Place, Suite 330, Boston, MA 02111-1307 or
+on the worldwide web at http://www.gnu.org/licenses/gpl.txt.
+
+THE FILE IS DISTRIBUTED AS-IS, WITHOUT WARRANTY OF ANY KIND, AND THE IMPLIED
+WARRANTIES OF MERCHANTABILITY OR FITNESS FOR A PARTICULAR PURPOSE ARE EXPRESSLY
+DISCLAIMED.  The GPL License provides additional details about this warranty
+disclaimer.
+********************************************************************************
+Marvell BSD License Option
+
+If you received this File from Marvell, you may opt to use, redistribute and/or
+modify this File under the following licensing terms.
+Redistribution and use in source and binary forms, with or without modification,
+are permitted provided that the following conditions are met:
+
+    *   Redistributions of source code must retain the above copyright notice,
+	    this list of conditions and the following disclaimer.
+
+    *   Redistributions in binary form must reproduce the above copyright
+	notice, this list of conditions and the following disclaimer in the
+	documentation and/or other materials provided with the distribution.
+
+    *   Neither the name of Marvell nor the names of its contributors may be
+	used to endorse or promote products derived from this software without
+	specific prior written permission.
+
+THIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDERS AND CONTRIBUTORS "AS IS" AND
+ANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE IMPLIED
+WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE ARE
+DISCLAIMED. IN NO EVENT SHALL THE COPYRIGHT OWNER OR CONTRIBUTORS BE LIABLE FOR
+ANY DIRECT, INDIRECT, INCIDENTAL, SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES
+(INCLUDING, BUT NOT LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES;
+LOSS OF USE, DATA, OR PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND ON
+ANY THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT
+(INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE OF THIS
+SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.
+
+*******************************************************************************/
+
+#ifndef __MV_SYS_ETHPHY_API_H__
+#define __MV_SYS_ETHPHY_API_H__
+
+MV_STATUS mvSysEthPhyInit(void);
+
+#endif
diff --git a/arch/arm/plat-armada/Kconfig b/arch/arm/plat-armada/Kconfig
index 815c962..b85551e 100644
--- a/arch/arm/plat-armada/Kconfig
+++ b/arch/arm/plat-armada/Kconfig
@@ -537,7 +537,7 @@ endif
 
 config MV_ETH_NETA
 	tristate "NETA driver"
-	depends on ARCH_FEROCEON_KW2 || ARCH_ARMADA_XP || ARCH_ARMADA370 || ARCH_ARMADA38X
+	depends on ARCH_FEROCEON_KW2 || ARCH_ARMADA_XP || ARCH_ARMADA370 || ARCH_ARMADA38X || ARCH_MSYS
 	default y
 	help
 	  Use NETA network driver
-- 
1.7.5.4

