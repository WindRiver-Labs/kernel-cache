From 4e53afc96d8107142762d0353e5506c151098a71 Mon Sep 17 00:00:00 2001
From: Grzegorz Jaszczyk <jaz@semihalf.com>
Date: Sun, 8 Jun 2014 16:49:23 +0300
Subject: [PATCH 1700/1825] fix: prestera: msys: release dma region only once

https://github.com/MISL-EBU-System-SW/misl-windriver.git linux-3.4.69-14t2-read
commit 8a7e4a4cfa6b200c208642e8e2b89a859f710044

Change-Id: I9b8538cb10c213ad02687d131b88bd1df0096d0d
Signed-off-by: Grzegorz Jaszczyk <jaz@semihalf.com>
Reviewed-on: http://vgitil04.il.marvell.com:8080/8420
Tested-by: Star_Automation <star@marvell.com>
Reviewed-by: Ofer Heifetz <oferh@marvell.com>
Signed-off-by: Zhong Hongbo <hongbo.zhong@windriver.com>
---
 .../mv_drivers_lsp/mv_prestera/mv_prestera.c       |    1 -
 .../mv_drivers_lsp/mv_prestera/mv_pss_api.c        |   25 --------------------
 .../mv_drivers_lsp/mv_prestera/mv_pss_api.h        |   22 -----------------
 3 files changed, 0 insertions(+), 48 deletions(-)

diff --git a/arch/arm/plat-armada/mv_drivers_lsp/mv_prestera/mv_prestera.c b/arch/arm/plat-armada/mv_drivers_lsp/mv_prestera/mv_prestera.c
index 7fdf1ec..ed40ebb 100644
--- a/arch/arm/plat-armada/mv_drivers_lsp/mv_prestera/mv_prestera.c
+++ b/arch/arm/plat-armada/mv_drivers_lsp/mv_prestera/mv_prestera.c
@@ -1133,7 +1133,6 @@ static void prestera_cleanup(void)
 				  GFP_DMA | GFP_KERNEL);
 		dma_area = NULL;
 	}
-	bspCacheDmaFree(dma_area);
 
 #ifdef PRESTERA_SYSCALLS
 	prestera_syscall_restore();
diff --git a/arch/arm/plat-armada/mv_drivers_lsp/mv_prestera/mv_pss_api.c b/arch/arm/plat-armada/mv_drivers_lsp/mv_prestera/mv_pss_api.c
index d4f7935..a3b069a 100644
--- a/arch/arm/plat-armada/mv_drivers_lsp/mv_prestera/mv_pss_api.c
+++ b/arch/arm/plat-armada/mv_drivers_lsp/mv_prestera/mv_pss_api.c
@@ -397,31 +397,6 @@ void *bspCacheDmaMalloc(size_t bytes)
 	return dma_area;
 }
 
-/*******************************************************************************
-* bspCacheDmaFree
-*
-* DESCRIPTION:
-*       free a cache free area back to pool.
-*
-* INPUTS:
-*       size_t bytes - number of bytes to allocate
-*
-* OUTPUTS:
-*       None.
-*
-* RETURNS:
-*       MV_OK   - on success
-*       MV_FAIL - on error
-*
-* COMMENTS:
-*       None
-*
-*******************************************************************************/
-MV_STATUS bspCacheDmaFree(void *pBuf)
-{
-	STUB_FAIL;
-}
-
 /*** PCI ***/
 /*******************************************************************************
 * bspPciConfigWriteReg
diff --git a/arch/arm/plat-armada/mv_drivers_lsp/mv_prestera/mv_pss_api.h b/arch/arm/plat-armada/mv_drivers_lsp/mv_prestera/mv_pss_api.h
index a069edc..83f4c0b 100644
--- a/arch/arm/plat-armada/mv_drivers_lsp/mv_prestera/mv_pss_api.h
+++ b/arch/arm/plat-armada/mv_drivers_lsp/mv_prestera/mv_pss_api.h
@@ -585,28 +585,6 @@ int bspDmaRead(unsigned long	address,
 *******************************************************************************/
 void *bspCacheDmaMalloc(size_t bytes);
 
-/*******************************************************************************
-* bspCacheDmaFree
-*
-* DESCRIPTION:
-*       free a cache free area back to pool.
-*
-* INPUTS:
-*       size_t bytes - number of bytes to allocate
-*
-* OUTPUTS:
-*       None.
-*
-* RETURNS:
-*       MV_OK   - on success
-*       MV_FAIL - on error
-*
-* COMMENTS:
-*       None
-*
-*******************************************************************************/
-int bspCacheDmaFree(void	*pBuf);
-
 /*** SMI ***/
 /*******************************************************************************
 * bspSmiInitDriver
-- 
1.7.5.4

