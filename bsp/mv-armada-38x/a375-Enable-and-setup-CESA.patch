From ebdfcc02c6eb663845224709e289b9deccc3860a Mon Sep 17 00:00:00 2001
From: Nadav Haklai <nadavh@marvell.com>
Date: Sun, 29 Jun 2014 13:51:42 +0300
Subject: [PATCH 1749/1825] a375: Enable and setup CESA.

https://github.com/MISL-EBU-System-SW/misl-windriver.git linux-3.4.69-14t2-read
commit 5a438c91f078cac55c57a8a356d0a2aa8a7698b1

	- Add crypto and cesa-sram nodes to DTS.
	- Define Model ID 6720 for A375 in mvCesaHalInit()

Change-Id: Ic48c36bfd5ec5b3201a8fd33adf20a1519d74d7d
Signed-off-by: Michal Mazur <arg@semihalf.com>
Signed-off-by: Nadav Haklai <nadavh@marvell.com>
Reviewed-on: http://vgitil04.il.marvell.com:8080/8847
Tested-by: Star_Automation <star@marvell.com>
Signed-off-by: Zhong Hongbo <hongbo.zhong@windriver.com>
---
 arch/arm/plat-armada/mv_hal/cesa/mvCesa.c |   10 ++++++++--
 1 files changed, 8 insertions(+), 2 deletions(-)

diff --git a/arch/arm/plat-armada/mv_hal/cesa/mvCesa.c b/arch/arm/plat-armada/mv_hal/cesa/mvCesa.c
index 838d59a..9fc0ae2 100644
--- a/arch/arm/plat-armada/mv_hal/cesa/mvCesa.c
+++ b/arch/arm/plat-armada/mv_hal/cesa/mvCesa.c
@@ -432,8 +432,14 @@ MV_STATUS mvCesaHalInit(int numOfSession, int queueDepth, void *osHandle, MV_CES
 			}
 			break;
 		case 0x6700: /* A370 */
-			/* Support maximum of 4 outstanding read transactions */
-			MV_REG_BIT_SET(MV_CESA_TDMA_CTRL_REG(chan), MV_CESA_TDMA_OUTSTAND_NEW_MODE_BIT);
+			if (ctrlModel == 0x6720) {
+				MV_REG_BIT_SET(MV_CESA_TDMA_CTRL_REG(chan),
+					       MV_CESA_TDMA_OUTSTAND_OUT_OF_ORDER_3TRANS_BIT);
+				sha2CmdVal = BIT31;
+			} else {
+				/* Support maximum of 4 outstanding read transactions */
+				MV_REG_BIT_SET(MV_CESA_TDMA_CTRL_REG(chan), MV_CESA_TDMA_OUTSTAND_NEW_MODE_BIT);
+			}
 			break;
 		case 0x6800: /* A38x */
 			MV_REG_BIT_SET(MV_CESA_TDMA_CTRL_REG(chan), MV_CESA_TDMA_OUTSTAND_OUT_OF_ORDER_3TRANS_BIT);
-- 
1.7.5.4

