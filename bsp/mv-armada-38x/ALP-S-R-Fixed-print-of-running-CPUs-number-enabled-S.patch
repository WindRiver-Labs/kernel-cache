From 6bb87c92e58b0781a7e423af690c0eaa4329eef3 Mon Sep 17 00:00:00 2001
From: Omri Itach <omrii@marvell.com>
Date: Wed, 29 May 2013 18:09:46 +0300
Subject: [PATCH 0701/1825] ALP: S@R: Fixed print of running CPUs number
 (enabled S@R read for mvCtrlGetCpuNum)

https://github.com/MISL-EBU-System-SW/misl-windriver.git linux-3.4.69-14t2-read
commit 90d1fa668d564c9ec848aeda2e190273e26f595a

Change-Id: I7a8e3629d15fd42520ec5a1791b521ce3a24343b
Signed-off-by: Omri Itach <omrii@marvell.com>
Reviewed-on: http://vgitil04.il.marvell.com:8080/2026
Reviewed-by: Star_Automation <star@marvell.com>
Reviewed-by: Eran Ben-Avi <benavi@marvell.com>
Tested-by: Eran Ben-Avi <benavi@marvell.com>
Signed-off-by: Zhong Hongbo <hongbo.zhong@windriver.com>
---
 .../avanta_lp_family/ctrlEnv/mvCtrlEnvLib.c        |    9 ++++++++-
 1 files changed, 8 insertions(+), 1 deletions(-)

diff --git a/arch/arm/mach-avantalp/avanta_lp_family/ctrlEnv/mvCtrlEnvLib.c b/arch/arm/mach-avantalp/avanta_lp_family/ctrlEnv/mvCtrlEnvLib.c
index e72df09..8d5a9bb 100755
--- a/arch/arm/mach-avantalp/avanta_lp_family/ctrlEnv/mvCtrlEnvLib.c
+++ b/arch/arm/mach-avantalp/avanta_lp_family/ctrlEnv/mvCtrlEnvLib.c
@@ -128,7 +128,14 @@ MV_U32 boardOptionsConfig[MV_CONFIG_TYPE_MAX_OPTION];
 
 MV_U32 mvCtrlGetCpuNum(MV_VOID)
 {
-	return 0;
+	MV_U32 cpu1Enabled;
+
+	cpu1Enabled = mvCtrlSatRRead(MV_SATR_CPU1_ENABLE);
+	if (cpu1Enabled == MV_ERROR) {
+		DB(mvOsPrintf("%s: Error: MV_SATR_CPU1_ENABLE is not active for board (using default)\n", __func__));
+		return 0;
+	} else
+		return cpu1Enabled;
 }
 
 MV_BOOL mvCtrlIsValidSatR(MV_VOID)
-- 
1.7.5.4

