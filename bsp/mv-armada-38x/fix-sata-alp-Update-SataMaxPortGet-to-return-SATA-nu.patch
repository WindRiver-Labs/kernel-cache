From 10d6857588c17225a06720698cf5dd175f2be512 Mon Sep 17 00:00:00 2001
From: Hanna Hawa <hannah@marvell.com>
Date: Thu, 6 Feb 2014 17:22:08 +0200
Subject: [PATCH 1344/1825] fix: sata: alp: Update SataMaxPortGet to return
 SATA number per board revision

https://github.com/MISL-EBU-System-SW/misl-windriver.git linux-3.4.69-14t2-read
commit c60088baa58d0b31f7c3eb5f19da21af92520016

	For RD-6660 the function returned 2, which was wrong
	RD-660 has 1 SATA port, which is muxed between internal/external

Signed-off-by: Hanna Hawa <hannah@marvell.com>
Change-Id: Ib339f2c7c08d2d452bb30d114b70c79224980f58
Reviewed-on: http://vgitil04.il.marvell.com:8080/5484
Reviewed-by: Omri Itach <omrii@marvell.com>
Reviewed-by: Shadi Ammouri <shadi@marvell.com>
Tested-by: Star_Automation <star@marvell.com>
Signed-off-by: Zhong Hongbo <hongbo.zhong@windriver.com>
---
 .../avanta_lp_family/ctrlEnv/mvCtrlEnvLib.c        |   10 ++++++----
 1 files changed, 6 insertions(+), 4 deletions(-)

diff --git a/arch/arm/mach-avantalp/avanta_lp_family/ctrlEnv/mvCtrlEnvLib.c b/arch/arm/mach-avantalp/avanta_lp_family/ctrlEnv/mvCtrlEnvLib.c
index 34552f0..0f62313 100644
--- a/arch/arm/mach-avantalp/avanta_lp_family/ctrlEnv/mvCtrlEnvLib.c
+++ b/arch/arm/mach-avantalp/avanta_lp_family/ctrlEnv/mvCtrlEnvLib.c
@@ -1011,11 +1011,13 @@ MV_U32 mvCtrlEthMaxPortGet(MV_VOID)
 *******************************************************************************/
 MV_U32 mvCtrlSataMaxPortGet(MV_VOID)
 {
-	/* Typical HW setup for DB-6660 is is with 1 SATA only*/
-	if (mvBoardIdGet() == DB_6660_ID)
-		return 1;
+	MV_U32 sata_ports = mvCtrlSocUnitInfoNumGet(SATA_UNIT_ID);
+	MV_U32 revID = mvCtrlRevGet();
+	/* Z1, Z2, Z3 support 1 SATA port */
+	if (revID <= MV_88F66X0_Z3_ID)
+		return sata_ports - 1;
 	else
-		return mvCtrlSocUnitInfoNumGet(SATA_UNIT_ID);
+		return sata_ports;
 }
 
 #endif
-- 
1.7.5.4

