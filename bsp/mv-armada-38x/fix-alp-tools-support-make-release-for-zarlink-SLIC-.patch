From f23f033f54b8ce50c9bffc50b467f06f06041e28 Mon Sep 17 00:00:00 2001
From: Victor Gu <xigu@marvell.com>
Date: Sun, 15 Jun 2014 16:24:58 +0800
Subject: [PATCH 1715/1825] fix: alp: tools: support make release for zarlink
 SLIC build script

https://github.com/MISL-EBU-System-SW/misl-windriver.git linux-3.4.69-14t2-read
commit bb71077a5578c73a8546595fa8364062c190df18

Change-Id: Idf19888239c963432d2ca744a4029640508d5227
Signed-off-by: Victor Gu <xigu@marvell.com>
Reviewed-on: http://vgitil04.il.marvell.com:8080/8527
Reviewed-by: Yehuda Yitschak <yehuday@marvell.com>
Tested-by: Yehuda Yitschak <yehuday@marvell.com>
Signed-off-by: Zhong Hongbo <hongbo.zhong@windriver.com>
---
 tools/voice/build-zarlink.sh |   45 +++++++++++++++++++++++++++++++++++++++++-
 1 files changed, 44 insertions(+), 1 deletions(-)

diff --git a/tools/voice/build-zarlink.sh b/tools/voice/build-zarlink.sh
index a8e84ad..e32cbb9 100755
--- a/tools/voice/build-zarlink.sh
+++ b/tools/voice/build-zarlink.sh
@@ -9,6 +9,7 @@ mod_path="${1}/kernel/slic"
 kernel_path=$2
 org_path=`pwd`
 bin_path=$3
+release_path="${4}/slic"
 
 # Create directory for build
 rm -rf /tmp/slic
@@ -33,7 +34,6 @@ mkdir -p $mod_path/zarlink_vpapi
 find ./ -name "*.ko" | xargs cp -t $mod_path/zarlink_vpapi
 cd -
 
-
 # Zarlink voice tool
 cd $kernel_path
 cd tools/voice/zarlink/kernel/
@@ -47,5 +47,48 @@ mkdir -p $bin_path
 cp mv_voice_tool-* $bin_path/.
 cd -
 
+if [ ! -n "$4" ]; then
+	leave 1
+fi
+
+if [ ! -n "$5" ]; then
+	verion_str="zarlink_vpapi"
+else
+	verion_str="zarlink_vpapi-${5}"
+fi
+
+# Clear Zarlink SLIC
+rm -rf /tmp/slic
+mkdir -p /tmp/slic
+cd /tmp/slic
+
+# Clone Zarlink SLIC moduel again
+git clone git://vgitil04/slic/zarlink_vpapi
+if [ $? != 0 ]; then
+	echo "Failed to clone Zarlink SLIC"
+	leave 1
+fi
+
+# Make internal version
+mkdir -p $release_path/zarlink_vpapi
+cd /tmp/slic
+mv zarlink_vpapi ${verion_str}
+tar czf ${verion_str}_internal.tgz ${verion_str}
+mv ${verion_str}_internal.tgz $release_path/zarlink_vpapi
+
+# make Zarlink SLIC release
+mv ${verion_str} zarlink_vpapi
+cd zarlink_vpapi
+make KDIR=$kernel_path release
+if [ $? != 0 ]; then
+	echo "Failed to build Zarlink SLIC"
+	leave 1
+fi
+
+cd /tmp/slic
+mv zarlink_vpapi ${verion_str}
+tar czf ${verion_str}.tgz ${verion_str}
+mv ${verion_str}.tgz $release_path/zarlink_vpapi
+cd ${org_path}
 
 leave 0
-- 
1.7.5.4

