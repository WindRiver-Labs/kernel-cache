From 4321801ccc34b9d3cac917f1401d91f4523d36b6 Mon Sep 17 00:00:00 2001
From: Tawfik Bayouk <tawfik@marvell.com>
Date: Tue, 21 Aug 2012 17:32:56 +0300
Subject: [PATCH 0024/1825] Port in CC changes: - Counters hal fixes -
 Controller environment lib

https://github.com/MISL-EBU-System-SW/misl-windriver.git linux-3.4.69-14t2-read
commit f8a309965b199484c4bf9e01adc0cf45307313cc

Change-Id: I08750177ab988e7b715a37e0f08fdba1e194fa6a
Signed-off-by: Tawfik Bayouk <tawfik@marvell.com>
Signed-off-by: Zhong Hongbo <hongbo.zhong@windriver.com>
---
 arch/arm/plat-armada/mv_hal/cntmr/mvCntmr.c |   19 ++++++++++++-------
 1 files changed, 12 insertions(+), 7 deletions(-)

diff --git a/arch/arm/plat-armada/mv_hal/cntmr/mvCntmr.c b/arch/arm/plat-armada/mv_hal/cntmr/mvCntmr.c
index 3eda4aa..9b606aa 100644
--- a/arch/arm/plat-armada/mv_hal/cntmr/mvCntmr.c
+++ b/arch/arm/plat-armada/mv_hal/cntmr/mvCntmr.c
@@ -429,12 +429,17 @@ MV_STATUS mvCntmrIntClear(MV_U32 cntmrNum)
 *******************************************************************************/
 MV_U32 mvCntmrFrqGet(MV_U32 cntmrNum)
 {
-/*#ifndef MV88F78X60_Z1
-	if (INVALID_CNTMR(cntmrNum))
-		return MV_ERROR;
+#ifndef MV88F78X60_Z1
+                if (INVALID_CNTMR(cntmrNum))
+                                return MV_ERROR;
+                {
+                                MV_U32 cntmrCtrl;
+                                cntmrCtrl = MV_REG_READ(CNTMR_CTRL_REG(cntmrNum));
 
-	if (cntmrCtrl & CTCR_ARM_TIMER_25MhzFRQ_MASK(cntmrNum))
-		return MV_BOARD_REFCLK_25MHZ;
-#endif*/
-	return mvCpuL2ClkGet();
+
+                                if (cntmrCtrl & CTCR_ARM_TIMER_25MhzFRQ_MASK(cntmrNum))
+                                                return MV_BOARD_REFCLK_25MHZ;
+                }
+#endif
+                return mvCpuL2ClkGet();
 }
-- 
1.7.5.4

