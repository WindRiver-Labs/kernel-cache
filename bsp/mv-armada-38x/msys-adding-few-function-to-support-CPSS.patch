From 5aca1aaf215ae9ee9e04441c3513ad7d73b1a16e Mon Sep 17 00:00:00 2001
From: Eli Nidam <elini@marvell.com>
Date: Thu, 13 Mar 2014 14:10:26 +0200
Subject: [PATCH 1515/1825] msys: adding few function to support CPSS

https://github.com/MISL-EBU-System-SW/misl-windriver.git linux-3.4.69-14t2-read
commit fddace129d995e1eb2e7c888cbea56cfdc063bd3

	   1. Added device ID to S@R command
	   2. Added switching Services code include:
     		a. print_spi_part - Print u-boot partitions on SPI flash
		b. cpss_env - Save CPSS environment on flash
		c. mtdburn_spi - save a Linux/VxWorks image image on the spi flash.
		d. mtdburn_nand - save a Linux/VxWorks image image on the NAND flash. save a Linux/VxWorks image image on the spi flash.
		e. smiscan - Scan for Marvell smi devices.
		f. qsgmii_sel - Select SFP or QSGMII modes on BC2
	    3. Added mvBoardDeviceIdGet and mvBoardDeviceIdSet for S@R

Change-Id: I9d9c449b0039ea9ed691f6cf458f15894264763c
Signed-off-by: Eli Nidam <elini@marvell.com>
Reviewed-on: http://vgitil04.il.marvell.com:8080/6397
Tested-by: Star_Automation <star@marvell.com>
Reviewed-by: Omri Itach <omrii@marvell.com>
Signed-off-by: Zhong Hongbo <hongbo.zhong@windriver.com>
---
 .../mach-msys/msys_family/boardEnv/mvBoardEnvLib.c |   34 ++++++++++++++++++++
 .../mach-msys/msys_family/boardEnv/mvBoardEnvLib.h |    3 ++
 2 files changed, 37 insertions(+), 0 deletions(-)

diff --git a/arch/arm/mach-msys/msys_family/boardEnv/mvBoardEnvLib.c b/arch/arm/mach-msys/msys_family/boardEnv/mvBoardEnvLib.c
index a299c95..9cc7f7c 100644
--- a/arch/arm/mach-msys/msys_family/boardEnv/mvBoardEnvLib.c
+++ b/arch/arm/mach-msys/msys_family/boardEnv/mvBoardEnvLib.c
@@ -1518,6 +1518,40 @@ MV_STATUS mvBoardBootDevSet(MV_U8 val)
 	DB(mvOsPrintf("Board: Write BootDev S@R succeeded\n"));
 	return MV_OK;
 }
+/*******************************************************************************/
+MV_STATUS mvBoardDeviceIdGet(MV_U8 *value)
+{
+	MV_U8 sar;
+	MV_STATUS rc;
+
+	rc = mvBoardTwsiSatRGet(0, 0, &sar);
+	if (MV_ERROR == rc)
+		return MV_ERROR;
+
+	*value = (sar & 0x1F);
+	return MV_OK;
+}
+
+/*******************************************************************************/
+MV_STATUS mvBoardDeviceIdSet(MV_U8 val)
+{
+	MV_U8 sar;
+	MV_STATUS rc;
+
+	rc = mvBoardTwsiSatRGet(0, 0, &sar);
+	if (MV_ERROR == rc)
+		return MV_ERROR;
+
+	sar &= ~(0x1F);
+	sar |= (val & 0x1F);
+	if (MV_OK != mvBoardTwsiSatRSet(0, 0, sar)) {
+		DB1(mvOsPrintf("Board: Write device-id S@R fail\n"));
+		return MV_ERROR;
+	}
+
+	DB(mvOsPrintf("Board: Write deviceid S@R succeeded\n"));
+	return MV_OK;
+}
 /*******************************************************************************
 * End of SatR Configuration functions
 *******************************************************************************/
diff --git a/arch/arm/mach-msys/msys_family/boardEnv/mvBoardEnvLib.h b/arch/arm/mach-msys/msys_family/boardEnv/mvBoardEnvLib.h
index 3063cf2..b87b91f 100644
--- a/arch/arm/mach-msys/msys_family/boardEnv/mvBoardEnvLib.h
+++ b/arch/arm/mach-msys/msys_family/boardEnv/mvBoardEnvLib.h
@@ -292,6 +292,7 @@ MV_32 mvBoardNandWidthGet(void);
 MV_U32 mvBoardIdGet(MV_VOID);
 MV_U32 mvBoardSledCpuNumGet(MV_VOID);
 
+MV_STATUS mvBoardTwsiWrite(MV_BOARD_TWSI_CLASS twsiClass, MV_U8 devNum, MV_U8 regNum, MV_U8 regVal);
 MV_STATUS mvBoardTwsiRead(MV_BOARD_TWSI_CLASS class1, MV_U8 devNum, MV_U8 regNum, MV_U8 *pData);
 MV_STATUS mvBoardTwsiSatRGet(MV_U8 devNum, MV_U8 regNum, MV_U8 *pData);
 MV_STATUS mvBoardTwsiSatRSet(MV_U8 devNum, MV_U8 regNum, MV_U8 regVal);
@@ -301,6 +302,8 @@ MV_U8 mvBoardCpuFreqModeGet(MV_VOID);
 MV_STATUS mvBoardCpuFreqModeSet(MV_U8 freqVal);
 MV_STATUS mvBoardBootDevGet(MV_U8 *value);
 MV_STATUS mvBoardBootDevSet(MV_U8 val);
+MV_STATUS mvBoardDeviceIdGet(MV_U8 *value);
+MV_STATUS mvBoardDeviceIdSet(MV_U8 val);
 MV_U8 mvBoardCpuCoresNumGet(MV_VOID);
 MV_STATUS mvBoardCpuCoresNumSet(MV_U8 val);
 MV_STATUS mvBoardConIdSet(MV_U16 conf);
-- 
1.7.5.4

