From d825fecec5e468123ea537a48193332d8f075fe8 Mon Sep 17 00:00:00 2001
From: Eli Nidam <elini@marvell.com>
Date: Mon, 28 Oct 2013 15:38:49 +0200
Subject: [PATCH 1125/1825] fix: a38x: Fixed default general purpose register
 to enable EGIGA0

https://github.com/MISL-EBU-System-SW/misl-windriver.git linux-3.4.69-14t2-read
commit de11617fd24f3229aaf38ca1eb1eced1c56c3f2c

Change-Id: I1d7e1fb6380540b82e05c39696be9f11d4baf21e
Signed-off-by: Eli Nidam <elini@marvell.com>
Reviewed-on: http://vgitil04.il.marvell.com:8080/3885
Reviewed-by: Nadav Haklai <nadavh@marvell.com>
Tested-by: Nadav Haklai <nadavh@marvell.com>
Signed-off-by: Zhong Hongbo <hongbo.zhong@windriver.com>
---
 .../armada_38x_family/ctrlEnv/mvCtrlEnvLib.c       |    3 +++
 .../armada_38x_family/ctrlEnv/mvCtrlEnvRegs.h      |    5 +++++
 2 files changed, 8 insertions(+), 0 deletions(-)

diff --git a/arch/arm/mach-armada38x/armada_38x_family/ctrlEnv/mvCtrlEnvLib.c b/arch/arm/mach-armada38x/armada_38x_family/ctrlEnv/mvCtrlEnvLib.c
index a89a8e2..c73f69f 100644
--- a/arch/arm/mach-armada38x/armada_38x_family/ctrlEnv/mvCtrlEnvLib.c
+++ b/arch/arm/mach-armada38x/armada_38x_family/ctrlEnv/mvCtrlEnvLib.c
@@ -363,6 +363,9 @@ MV_STATUS mvCtrlEnvInit(MV_VOID)
 	/*Enable PUP bit for NOR*/
 	MV_REG_BIT_SET(PUP_EN_REG, BIT6);
 #endif
+	/* change default because Egiga0 is not alive by default */
+	MV_REG_WRITE(GENERAL_PURPOSE_RESERVED1_REG, GENERAL_PURPOSE_RESERVED1_DEFAULT_VALUE);
+
 	/* XXX: Following setting should be configured by u-boot */
 	/* Disable arbitration between device and NAND */
 	MV_REG_BIT_RESET(SOC_DEV_MUX_REG, BIT27);
diff --git a/arch/arm/mach-armada38x/armada_38x_family/ctrlEnv/mvCtrlEnvRegs.h b/arch/arm/mach-armada38x/armada_38x_family/ctrlEnv/mvCtrlEnvRegs.h
index ecd3390..04732a8 100644
--- a/arch/arm/mach-armada38x/armada_38x_family/ctrlEnv/mvCtrlEnvRegs.h
+++ b/arch/arm/mach-armada38x/armada_38x_family/ctrlEnv/mvCtrlEnvRegs.h
@@ -188,6 +188,11 @@ extern "C" {
 /* PUP registers */
 /*****************/
 #define PUP_EN_REG                              0x1864C
+/*****************/
+/* General Purpose registers */
+/*****************/
+#define GENERAL_PURPOSE_RESERVED1_REG		0x182E4
+#define GENERAL_PURPOSE_RESERVED1_DEFAULT_VALUE	(~BIT17)
 
 /* Extract CPU, L2, DDR clocks SAR value from
 ** SAR bits 24-27
-- 
1.7.5.4

