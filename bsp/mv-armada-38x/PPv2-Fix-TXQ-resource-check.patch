From febd7345fa33c82d43dc4b4a8d56eb1662e4cb3c Mon Sep 17 00:00:00 2001
From: Yoni Farhadian <yonif@marvell.com>
Date: Sun, 26 May 2013 13:06:58 +0300
Subject: [PATCH 0680/1825] PPv2: Fix TXQ resource check

https://github.com/MISL-EBU-System-SW/misl-windriver.git linux-3.4.69-14t2-read
commit e6126e6dc09a7f03be7bbcc3a68478beb8e4541e

Change-Id: I9cb9a63d3c820d9e46d1fda82ff44d6bfd5ecade
Signed-off-by: Yoni Farhadian <yonif@marvell.com>
Reviewed-on: http://vgitil04.il.marvell.com:8080/1972
Reviewed-by: Star_Automation <star@marvell.com>
Reviewed-by: Eran Ben-Avi <benavi@marvell.com>
Tested-by: Eran Ben-Avi <benavi@marvell.com>
Signed-off-by: Zhong Hongbo <hongbo.zhong@windriver.com>
---
 .../mv_drivers_lsp/mv_pp2/net_dev/mv_netdev.h      |    6 +++---
 1 files changed, 3 insertions(+), 3 deletions(-)

diff --git a/arch/arm/plat-armada/mv_drivers_lsp/mv_pp2/net_dev/mv_netdev.h b/arch/arm/plat-armada/mv_drivers_lsp/mv_pp2/net_dev/mv_netdev.h
index 251c1a7..ba964e0 100644
--- a/arch/arm/plat-armada/mv_drivers_lsp/mv_pp2/net_dev/mv_netdev.h
+++ b/arch/arm/plat-armada/mv_drivers_lsp/mv_pp2/net_dev/mv_netdev.h
@@ -535,7 +535,7 @@ static inline int mv_eth_ctrl_is_tx_enabled(struct eth_port *pp)
 */
 static inline int mv_eth_phys_desc_num_check(struct txq_cpu_ctrl *txq_ctrl, int num)
 {
-	if ((txq_ctrl->txq_count + num) >= txq_ctrl->txq_size) {
+	if ((txq_ctrl->txq_count + num) > txq_ctrl->txq_size) {
 		/*
 		printk(KERN_ERR "eth_tx: txq_ctrl->txq=%d - no_resource: txq_count=%d, txq_size=%d, num=%d\n",
 			txq_ctrl->txq, txq_ctrl->txq_count, txq_ctrl->txq_size, num);
@@ -555,12 +555,12 @@ static inline int mv_eth_phys_desc_num_check(struct txq_cpu_ctrl *txq_ctrl, int
 static inline int mv_eth_aggr_desc_num_check(struct aggr_tx_queue *aggr_txq_ctrl, int num)
 {
 	/* Is enough aggregated TX descriptors to send packet */
-	if ((aggr_txq_ctrl->txq_count + num) >= aggr_txq_ctrl->txq_size) {
+	if ((aggr_txq_ctrl->txq_count + num) > aggr_txq_ctrl->txq_size) {
 		/* update number of available aggregated TX descriptors */
 		aggr_txq_ctrl->txq_count = mvPp2AggrTxqPendDescNumGet(smp_processor_id());
 	}
 	/* Is enough aggregated descriptors */
-	if ((aggr_txq_ctrl->txq_count + num) >= aggr_txq_ctrl->txq_size) {
+	if ((aggr_txq_ctrl->txq_count + num) > aggr_txq_ctrl->txq_size) {
 		/*
 		printk(KERN_ERR "eth_tx: txq_ctrl->txq=%d - no_resource: txq_count=%d, txq_size=%d, num=%d\n",
 			txq_ctrl->txq, txq_ctrl->txq_count, txq_ctrl->txq_size, num);
-- 
1.7.5.4

