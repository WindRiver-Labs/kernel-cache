From 6a36a89c755df43703e6340ec32ff35ba2627e13 Mon Sep 17 00:00:00 2001
From: Dmitri Epshtein <dima@marvell.com>
Date: Tue, 7 Jan 2014 12:00:59 -0500
Subject: [PATCH 1273/1825] neta: Fix warnings, remove debug messages

https://github.com/MISL-EBU-System-SW/misl-windriver.git linux-3.4.69-14t2-read
commit 7ceb9f678647e9828a944f35df287bf05eb11307

	- in function mv_eth_txq_cpu_clean and mv_eth_txq_hwf_clean
	print number of released buffers only if not zero
	- fix warnings when function on_each_cpu used

Change-Id: I49ff23317197a18c321c127e4e2e3c77442e8af8
Signed-off-by: Dmitri Epshtein <dima@marvell.com>
Signed-off-by: Zhong Hongbo <hongbo.zhong@windriver.com>
---
 .../mv_drivers_lsp/mv_neta/net_dev/mv_netdev.c     |   15 ++++++++-------
 .../mv_drivers_lsp/mv_neta/net_dev/mv_netdev.h     |    8 ++++++--
 2 files changed, 14 insertions(+), 9 deletions(-)

diff --git a/arch/arm/plat-armada/mv_drivers_lsp/mv_neta/net_dev/mv_netdev.c b/arch/arm/plat-armada/mv_drivers_lsp/mv_neta/net_dev/mv_netdev.c
index c1b332c..693820d 100644
--- a/arch/arm/plat-armada/mv_drivers_lsp/mv_neta/net_dev/mv_netdev.c
+++ b/arch/arm/plat-armada/mv_drivers_lsp/mv_neta/net_dev/mv_netdev.c
@@ -1455,10 +1455,12 @@ static inline void mv_eth_txq_cpu_clean(struct eth_port *pp, struct tx_queue *tx
 		i = MV_NETA_QUEUE_NEXT_DESC(&txq_ctrl->q->queueCtrl, i);
 		count++;
 	}
-	printk(KERN_INFO "\n%s: port=%d, txp=%d, txq=%d, mode=CPU\n",
+	if (count > 0) {
+		pr_info("\n%s: port=%d, txp=%d, txq=%d, mode=CPU\n",
 			__func__, pp->port, txq_ctrl->txp, txq_ctrl->txq);
-	printk(KERN_INFO "Free %d buffers: from desc=%d to desc=%d, tx_count=%d\n",
+		pr_info("Free %d buffers: from desc=%d to desc=%d, tx_count=%d\n",
 			count, hw_txq_i, last_txq_i, txq_ctrl->txq_count);
+	}
 }
 
 #ifdef CONFIG_MV_ETH_HWF
@@ -1488,10 +1490,12 @@ static inline void mv_eth_txq_hwf_clean(struct eth_port *pp, struct tx_queue *tx
 		}
 		i = MV_NETA_QUEUE_NEXT_DESC(&txq_ctrl->q->queueCtrl, i);
 	}
-	printk(KERN_INFO "\n%s: port=%d, txp=%d, txq=%d, mode=HWF-%d\n",
+	if (count > 0) {
+		pr_info("\n%s: port=%d, txp=%d, txq=%d, mode=HWF-%d\n",
 			__func__, pp->port, txq_ctrl->txp, txq_ctrl->txq, rx_port);
-	printk(KERN_INFO "Free %d buffers to BM: from desc=%d to desc=%d\n",
+		pr_info("Free %d buffers to BM: from desc=%d to desc=%d\n",
 			count, hw_txq_i, last_txq_i);
+	}
 }
 #endif /* CONFIG_MV_ETH_HWF */
 
@@ -1520,9 +1524,6 @@ int mv_eth_txq_clean(int port, int txp, int txq)
 	else if (mode == MV_ETH_TXQ_HWF)
 		mv_eth_txq_hwf_clean(pp, txq_ctrl, rx_port);
 #endif /* CONFIG_MV_ETH_HWF */
-	else
-		printk(KERN_ERR "%s: port=%d, txp=%d, txq=%d is not in use\n",
-			__func__, pp->port, txp, txq);
 
 	return 0;
 }
diff --git a/arch/arm/plat-armada/mv_drivers_lsp/mv_neta/net_dev/mv_netdev.h b/arch/arm/plat-armada/mv_drivers_lsp/mv_neta/net_dev/mv_netdev.h
index 0ee7921..e59cb36 100644
--- a/arch/arm/plat-armada/mv_drivers_lsp/mv_neta/net_dev/mv_netdev.h
+++ b/arch/arm/plat-armada/mv_drivers_lsp/mv_neta/net_dev/mv_netdev.h
@@ -507,8 +507,10 @@ void mv_eth_stack_print(int port, MV_BOOL isPrintElements);
 extern struct bm_pool mv_eth_pool[MV_ETH_BM_POOLS];
 extern struct eth_port **mv_eth_ports;
 
-static inline void mv_eth_interrupts_unmask(struct eth_port *pp)
+static inline void mv_eth_interrupts_unmask(void *arg)
 {
+	struct eth_port *pp = arg;
+
 	/* unmask interrupts */
 	if (!test_bit(MV_ETH_F_FORCE_LINK_BIT, &(pp->flags)))
 		MV_REG_WRITE(NETA_INTR_MISC_MASK_REG(pp->port), NETA_CAUSE_LINK_CHANGE_MASK);
@@ -519,8 +521,10 @@ static inline void mv_eth_interrupts_unmask(struct eth_port *pp)
 		MV_ETH_RX_INTR_MASK));
 }
 
-static inline void mv_eth_interrupts_mask(struct eth_port *pp)
+static inline void mv_eth_interrupts_mask(void *arg)
 {
+	struct eth_port *pp = arg;
+
 	/* clear all ethernet port interrupts */
 	MV_REG_WRITE(NETA_INTR_MISC_CAUSE_REG(pp->port), 0);
 	MV_REG_WRITE(NETA_INTR_OLD_CAUSE_REG(pp->port), 0);
-- 
1.7.5.4

