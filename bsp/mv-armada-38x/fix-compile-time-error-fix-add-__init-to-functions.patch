From e05285dcd5097cb2f2232f4a1cbc9f9b78f99fd0 Mon Sep 17 00:00:00 2001
From: Kosta Zertsekel <konszert@marvell.com>
Date: Sun, 20 Oct 2013 13:49:41 +0200
Subject: [PATCH 1045/1825] fix: compile time error fix - add __init to
 functions

https://github.com/MISL-EBU-System-SW/misl-windriver.git linux-3.4.69-14t2-read
commit 3e714f6e46780f696c5f1b24372ac9b0040c4fa4

If not fixed, then section mismatches are shouted by gcc when
compiled with flag CONFIG_DEBUG_SECTION_MISMATCH=y:

WARNING: vmlinux.o(.text+0x130f4): Section mismatch in reference from the function alp_smp_cpu1_enable_wa() to the variable .init.text:alp_smp_cpu1_enable_code_start
The function alp_smp_cpu1_enable_wa() references
the variable __init alp_smp_cpu1_enable_code_start.
This is often because alp_smp_cpu1_enable_wa lacks a __init
annotation or the annotation of alp_smp_cpu1_enable_code_start is wrong.

WARNING: vmlinux.o(.text+0x130f8): Section mismatch in reference from the function alp_smp_cpu1_enable_wa() to the function .init.text:alp_smp_cpu1_enable_code_end()
The function alp_smp_cpu1_enable_wa() references
the function __init alp_smp_cpu1_enable_code_end().
This is often because alp_smp_cpu1_enable_wa lacks a __init
annotation or the annotation of alp_smp_cpu1_enable_code_end is wrong.

WARNING: vmlinux.o(.text+0x26804): Section mismatch in reference from the function mv_pex_scan_bus() to the function .devinit.text:pci_scan_root_bus()
The function mv_pex_scan_bus() references
the function __devinit pci_scan_root_bus().
This is often because mv_pex_scan_bus lacks a __devinit
annotation or the annotation of pci_scan_root_bus is wrong.

Change-Id: Ia48843d1a787dfb2cfb576e268b68eaabdf55b22
Signed-off-by: Kosta Zertsekel <konszert@marvell.com>
Reviewed-on: http://vgitil04.il.marvell.com:8080/3779
Tested-by: Star_Automation <star@marvell.com>
Reviewed-by: Omri Itach <omrii@marvell.com>
Reviewed-by: Eran Ben-Avi <benavi@marvell.com>
Tested-by: Eran Ben-Avi <benavi@marvell.com>
Signed-off-by: Zhong Hongbo <hongbo.zhong@windriver.com>
---
 arch/arm/mach-armadaxp/pex.c  |    2 +-
 arch/arm/mach-avantalp/core.c |    4 ++--
 arch/arm/mach-avantalp/pex.c  |    2 +-
 3 files changed, 4 insertions(+), 4 deletions(-)

diff --git a/arch/arm/mach-armadaxp/pex.c b/arch/arm/mach-armadaxp/pex.c
index d433eb9..19ab041 100644
--- a/arch/arm/mach-armadaxp/pex.c
+++ b/arch/arm/mach-armadaxp/pex.c
@@ -426,7 +426,7 @@ int __init mv_pex_setup(int nr, struct pci_sys_data *sys)
 }
 
 
-struct pci_bus *mv_pex_scan_bus(int nr, struct pci_sys_data *sys)
+struct pci_bus * __devinit mv_pex_scan_bus(int nr, struct pci_sys_data *sys)
 {
 	struct pci_ops *ops = &mv_pci_ops;	
 	struct pci_bus *bus;
diff --git a/arch/arm/mach-avantalp/core.c b/arch/arm/mach-avantalp/core.c
index 730557f9..dab91c9 100644
--- a/arch/arm/mach-avantalp/core.c
+++ b/arch/arm/mach-avantalp/core.c
@@ -1385,7 +1385,7 @@ extern MV_TARGET_ATTRIB mvTargetDefaultsArray[];
  */
 #if defined(CONFIG_SMP) && defined(CONFIG_ALP_CPU1_ENABLE_WA)
 
-void alp_smp_cpu1_enable_wa(void)
+void __init alp_smp_cpu1_enable_wa(void)
 {
 	MV_AHB_TO_MBUS_DEC_WIN mbus_win;
 	u32 code_len, win_num, sram_phys_base = 0xFFFF0000;
@@ -1415,7 +1415,7 @@ void alp_smp_cpu1_enable_wa(void)
 	memcpy(sram_virt_base, &alp_smp_cpu1_enable_code_start, code_len);
 }
 #else
-void alp_smp_cpu1_enable_wa(void)
+void __init alp_smp_cpu1_enable_wa(void)
 {
 	/* nothing */
 }
diff --git a/arch/arm/mach-avantalp/pex.c b/arch/arm/mach-avantalp/pex.c
index 4f01f25..eb9a4a8 100644
--- a/arch/arm/mach-avantalp/pex.c
+++ b/arch/arm/mach-avantalp/pex.c
@@ -270,7 +270,7 @@ static int __init mv_pex_setup(int nr, struct pci_sys_data *sys)
 }
 
 
-struct pci_bus *mv_pex_scan_bus(int nr, struct pci_sys_data *sys)
+struct pci_bus * __devinit mv_pex_scan_bus(int nr, struct pci_sys_data *sys)
 {
 	return pci_scan_root_bus(NULL, sys->busnr, &mv_pci_ops, sys, &sys->resources);
 }
-- 
1.7.5.4

