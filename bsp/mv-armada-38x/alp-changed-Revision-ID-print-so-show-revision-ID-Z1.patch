From 6397b514ea02d2838f73e8401280b2ece9e93b59 Mon Sep 17 00:00:00 2001
From: Omri Itach <omrii@marvell.com>
Date: Sun, 14 Jul 2013 12:02:31 +0300
Subject: [PATCH 0819/1825] alp: changed Revision ID print so show revision ID
 (Z1,Z2,..)

https://github.com/MISL-EBU-System-SW/misl-windriver.git linux-3.4.69-14t2-read
commit 7298213143dba876e4c4a2fb64254228a4063e99

	- Added routine to print Revision ID (Z1,Z2,..) insted of revision numbers (0,1,..)
	- Cleaned unneceasery returns of MV_STATUS

Change-Id: I8c428b3eb50f829fb66d29dcac1c5e40870d145c
Signed-off-by: Omri Itach <omrii@marvell.com>
Reviewed-on: http://vgitil04.il.marvell.com:8080/2607
Reviewed-by: Kosta Zertsekel <konszert@marvell.com>
Tested-by: Star_Automation <star@marvell.com>
Signed-off-by: Zhong Hongbo <hongbo.zhong@windriver.com>
---
 .../avanta_lp_family/ctrlEnv/mvCtrlEnvLib.c        |   56 +++++++++++++++++---
 .../avanta_lp_family/ctrlEnv/mvCtrlEnvLib.h        |    3 +-
 arch/arm/plat-armada/common/mvDeviceId.h           |   12 ++++
 3 files changed, 62 insertions(+), 9 deletions(-)

diff --git a/arch/arm/mach-avantalp/avanta_lp_family/ctrlEnv/mvCtrlEnvLib.c b/arch/arm/mach-avantalp/avanta_lp_family/ctrlEnv/mvCtrlEnvLib.c
index 97a2ff2..855b399 100755
--- a/arch/arm/mach-avantalp/avanta_lp_family/ctrlEnv/mvCtrlEnvLib.c
+++ b/arch/arm/mach-avantalp/avanta_lp_family/ctrlEnv/mvCtrlEnvLib.c
@@ -1130,7 +1130,17 @@ MV_U32 mvCtrlRevGet(MV_VOID)
 	MV_U32 value;
 
 	value = MV_REG_READ(DEV_VERSION_ID_REG);
-	return  ((value & (REVISON_ID_MASK) ) >> REVISON_ID_OFFS);
+	value = (value & REVISON_ID_MASK) >> REVISON_ID_OFFS;
+
+	switch (value) {
+	case MV_88F66X0_Z1_ID:
+	case MV_88F66X0_Z2_ID:
+	case MV_88F66X0_Z3_ID:
+			return value;
+	default:
+			mvOsPrintf("%s: Error: Failed to read Revision ID\n", __func__);
+			return 0x0;
+	}
 }
 
 /*******************************************************************************
@@ -1149,10 +1159,43 @@ MV_U32 mvCtrlRevGet(MV_VOID)
 *
 *       MV_ERROR if informantion can not be read.
 *******************************************************************************/
-MV_STATUS mvCtrlNameGet(char *pNameBuff)
+MV_VOID mvCtrlNameGet(char *pNameBuff)
 {
-	mvOsSPrintf(pNameBuff, "%s%x Rev %d", SOC_NAME_PREFIX, mvCtrlModelGet(), mvCtrlRevGet());
-	return MV_OK;
+	mvOsSPrintf(pNameBuff, "%s%x", SOC_NAME_PREFIX, mvCtrlModelGet());
+}
+
+/*******************************************************************************
+* mvCtrlRevNameGet - Get Marvell controller name
+*
+* DESCRIPTION:
+*       This function returns a string describing the revision id.
+*
+* INPUT:
+*       None.
+*
+* OUTPUT:
+*       pNameBuff - Buffer to contain revision name string. Minimum size 30 chars.
+*
+* RETURN:
+*
+*       MV_ERROR if informantion can not be read.
+*******************************************************************************/
+MV_VOID mvCtrlRevNameGet(char *pNameBuff)
+{
+	MV_U32 revId;
+	char *revArray[] = MV_88FX66X0_ID_ARRAY;
+
+	revId = mvCtrlRevGet();
+
+	switch (revId) {
+	case MV_88F66X0_Z1_ID:
+	case MV_88F66X0_Z2_ID:
+	case MV_88F66X0_Z3_ID:
+			mvOsSPrintf(pNameBuff, " Rev %s", revArray[revId]);
+			return;
+	default:
+		mvOsPrintf("%s: Error: Failed to read Revision ID\n", __func__);
+	}
 }
 
 /*******************************************************************************
@@ -1195,11 +1238,10 @@ MV_U32 mvCtrlModelRevGet(MV_VOID)
 *
 *       MV_ERROR if informantion can not be read.
 *******************************************************************************/
-MV_STATUS mvCtrlModelRevNameGet(char *pNameBuff)
+MV_VOID mvCtrlModelRevNameGet(char *pNameBuff)
 {
-	/* mvCtrlModelRevGet(); */
 	mvCtrlNameGet(pNameBuff);
-	return MV_OK;
+	mvCtrlRevNameGet(pNameBuff + strlen(pNameBuff));
 }
 
 static const char *cntrlName[] = TARGETS_NAME_ARRAY;
diff --git a/arch/arm/mach-avantalp/avanta_lp_family/ctrlEnv/mvCtrlEnvLib.h b/arch/arm/mach-avantalp/avanta_lp_family/ctrlEnv/mvCtrlEnvLib.h
index 34cc3c4..207e617 100755
--- a/arch/arm/mach-avantalp/avanta_lp_family/ctrlEnv/mvCtrlEnvLib.h
+++ b/arch/arm/mach-avantalp/avanta_lp_family/ctrlEnv/mvCtrlEnvLib.h
@@ -317,9 +317,8 @@ MV_U32 mvCtrlTdmUnitIrqGet(MV_VOID);
 MV_U32 mvCtrlDevFamilyIdGet(MV_U16 ctrlModel);
 MV_U16 mvCtrlModelGet(MV_VOID);
 MV_U32 mvCtrlRevGet(MV_VOID);
-MV_STATUS mvCtrlNameGet(char *pNameBuff);
 MV_U32 mvCtrlModelRevGet(MV_VOID);
-MV_STATUS mvCtrlModelRevNameGet(char *pNameBuff);
+MV_VOID mvCtrlModelRevNameGet(char *pNameBuff);
 MV_VOID mvCtrlAddrDecShow(MV_VOID);
 const MV_8 *mvCtrlTargetNameGet(MV_TARGET target);
 MV_U32    ctrlSizeToReg(MV_U32 size, MV_U32 alignment);
diff --git a/arch/arm/plat-armada/common/mvDeviceId.h b/arch/arm/plat-armada/common/mvDeviceId.h
index c954083..fc1126d 100644
--- a/arch/arm/plat-armada/common/mvDeviceId.h
+++ b/arch/arm/plat-armada/common/mvDeviceId.h
@@ -354,6 +354,18 @@ extern "C" {
 #define MV_6660_DEV_ID		0x6660
 #define MV_6650_DEV_ID		0x6650
 #define MV_6610_DEV_ID		0x6610
+#define MV_88F66X0_Z1_ID	0x0
+#define MV_88F66X0_Z1_NAME      "Z1"
+#define MV_88F66X0_Z2_ID	0x1
+#define MV_88F66X0_Z2_NAME      "Z2"
+#define MV_88F66X0_Z3_ID	0x2
+#define MV_88F66X0_Z3_NAME      "Z3"
+
+#define MV_88FX66X0_ID_ARRAY { \
+	MV_88F66X0_Z1_NAME,\
+	MV_88F66X0_Z2_NAME,\
+	MV_88F66X0_Z3_NAME \
+};
 
 /* Armada 375 Family */
 #define MV_88F67X0			0x6700
-- 
1.7.5.4

