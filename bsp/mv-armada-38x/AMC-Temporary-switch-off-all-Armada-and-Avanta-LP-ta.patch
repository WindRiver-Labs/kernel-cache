From 789369136a6f94dcbaba2761f2e045779f730d76 Mon Sep 17 00:00:00 2001
From: Eran Ben-Avi <benavi@marvell.com>
Date: Wed, 10 Jul 2013 19:10:35 +0300
Subject: [PATCH 0776/1825] AMC: Temporary switch off all Armada and Avanta LP
 targets from config.

https://github.com/MISL-EBU-System-SW/misl-windriver.git linux-3.4.69-14t2-read
commit db2a04a1e58b8b269fd1a69f9e264bafcd44daf7

	This work-arounds problems with multiple instances of the various symbols
 	while parsing Kconfig tree.
 	The patch is intended to be fixed and reverted in the future.

Change-Id: I35f65ffb4806c5bc69063c3a6aa0fe7a73c6bcb3
Signed-off-by: Zbigniew Bodek <zbb@semihalf.com>
Signed-off-by: Eran Ben-Avi <benavi@marvell.com>
Signed-off-by: Zhong Hongbo <hongbo.zhong@windriver.com>
---
 arch/arm/Kconfig  |   35 +++++++++++++++++++++++++++++------
 arch/arm/Makefile |   12 ++++++++++++
 2 files changed, 41 insertions(+), 6 deletions(-)

diff --git a/arch/arm/Kconfig b/arch/arm/Kconfig
index 8c0b39e..fa49ac5 100644
--- a/arch/arm/Kconfig
+++ b/arch/arm/Kconfig
@@ -679,6 +679,20 @@ config ARCH_ORION5X
 	  Orion-1 (5181), Orion-VoIP (5181L), Orion-NAS (5182),
 	  Orion-2 (5281), Orion-1-90 (6183).
 
+config ARCH_FEROCEON_KW2
+        bool "Feroceon-KW2 based"
+	depends on MMU
+	select CPU_FEROCEON
+	select ARCH_FEROCEON
+	select ARCH_HAS_CPUFREQ
+	select PCI
+	select ARCH_SUPPORTS_MSI
+	select GENERIC_GPIO
+	select ARCH_REQUIRE_GPIOLIB
+	select GENERIC_TIME
+        select GENERIC_CLOCKEVENTS
+	select NEED_MACH_IO_H
+
 config ARCH_AVANTA_LP
 	bool "Marvell Avanta LP"
 	select PCI
@@ -1142,8 +1156,8 @@ source "arch/arm/mach-ixp2000/Kconfig"
 
 source "arch/arm/mach-ixp23xx/Kconfig"
 
-source "arch/arm/mach-kirkwood/Kconfig"
-source "arch/arm/plat-orion/Kconfig"
+# source "arch/arm/mach-kirkwood/Kconfig"
+# source "arch/arm/plat-orion/Kconfig"
 
 source "arch/arm/mach-ks8695/Kconfig"
 
@@ -1179,10 +1193,11 @@ source "arch/arm/mach-realview/Kconfig"
 
 source "arch/arm/mach-sa1100/Kconfig"
 
-source "arch/arm/mach-armada370/Kconfig"
-source "arch/arm/mach-armadaxp/Kconfig"
-source "arch/arm/mach-avantalp/Kconfig"
-source "arch/arm/plat-armada/Kconfig"
+# source "arch/arm/mach-armada370/Kconfig"
+# source "arch/arm/mach-armadaxp/Kconfig"
+# source "arch/arm/mach-avantalp/Kconfig"
+# source "arch/arm/plat-armada/Kconfig"
+source "arch/arm/plat-feroceon/Kconfig"
 
 source "arch/arm/plat-samsung/Kconfig"
 source "arch/arm/plat-s3c24xx/Kconfig"
@@ -2279,6 +2294,14 @@ config CPU_FREQ_S3C
 	help
 	  Internal configuration node for common cpufreq on Samsung SoC
 
+config CPU_FREQ_FEROCEON_KW2
+	tristate "CPUfreq driver for Kirkwood2 SoC"
+	depends on CPU_FREQ && ARCH_FEROCEON_KW2
+	default n
+	help
+	  This enables the CPUfreq driver for Kirkwood SoC.
+	  If in doubt, say N.
+
 config CPU_FREQ_S3C24XX
 	bool "CPUfreq driver for Samsung S3C24XX series CPUs (EXPERIMENTAL)"
 	depends on ARCH_S3C24XX && CPU_FREQ && EXPERIMENTAL
diff --git a/arch/arm/Makefile b/arch/arm/Makefile
index 8abb999..5e271e7 100644
--- a/arch/arm/Makefile
+++ b/arch/arm/Makefile
@@ -16,6 +16,8 @@ LDFLAGS_vmlinux	+= --be8
 LDFLAGS_MODULE += --be8
 endif
 
+NFPLIBCMD=$(AR) rcs arch/arm/plat-feroceon/mv_drivers_lsp/mv_neta/nfplib.a arch/arm/plat-feroceon/mv_hal/neta/nfp/*.o arch/arm/plat-feroceon/mv_drivers_lsp/mv_neta/nfp_mgr/*.o
+
 OBJCOPYFLAGS	:=-O binary -R .comment -S
 GZFLAGS		:=-9
 last_kallsyms	:= 3
@@ -156,6 +158,9 @@ machine-$(CONFIG_ARCH_IXP2000)		:= ixp2000
 machine-$(CONFIG_ARCH_IXP23XX)		:= ixp23xx
 machine-$(CONFIG_ARCH_IXP4XX)		:= ixp4xx
 machine-$(CONFIG_ARCH_KIRKWOOD)		:= kirkwood
+machine-$(CONFIG_ARCH_FEROCEON_KW2)	:= feroceon-kw2
+plat-$(CONFIG_ARCH_FEROCEON_KW2)	:= feroceon
+
 machine-$(CONFIG_ARCH_KS8695)		:= ks8695
 machine-$(CONFIG_ARCH_LPC32XX)		:= lpc32xx
 machine-$(CONFIG_ARCH_MMP)		:= mmp
@@ -314,6 +319,13 @@ archclean:
 bp:;	$(Q)$(MAKE) $(build)=$(boot) MACHINE=$(MACHINE) $(boot)/bootpImage
 i zi:;	$(Q)$(MAKE) $(build)=$(boot) MACHINE=$(MACHINE) $@
 
+nfplib:
+ifeq ($(CONFIG_MV_ETH_NFP_LIB),y)
+	make -f scripts/Makefile.build NFPLIB=y obj=$(PWD)/arch/arm/mach-feroceon-kw2/
+	$(NFPLIBCMD)
+else
+	@echo "CONFIG_MV_ETH_NFP_LIB must be set for creating nfplib.a; exiting"
+endif
 
 define archhelp
   echo  '* zImage        - Compressed kernel image (arch/$(ARCH)/boot/zImage)'
-- 
1.7.5.4

