From 748d4ff3fdc6b12b4e7c307129303d2e652bc637 Mon Sep 17 00:00:00 2001
From: Yehuda Yitschak <yehuday@marvell.com>
Date: Tue, 18 Feb 2014 15:14:03 +0200
Subject: [PATCH 1372/1825] tools: voice: Added scripts to build external
 SLICs

https://github.com/MISL-EBU-System-SW/misl-windriver.git linux-3.4.69-14t2-read
commit 8f285ec8b352d0de32a0429bd642154d05cd4271

Change-Id: I7d026de2af775196d9f6da93ead49d3d47e5d516
Signed-off-by: Yehuda Yitschak <yehuday@marvell.com>
Reviewed-on: http://vgitil04.il.marvell.com:8080/5780
Tested-by: Star_Automation <star@marvell.com>
Signed-off-by: Zhong Hongbo <hongbo.zhong@windriver.com>
---
 tools/voice/build-lantiq-dfev.sh |  133 ++++++++++++++++++++++++++++++++++++++
 tools/voice/build-silabs.sh      |   56 ++++++++++++++++
 tools/voice/build-zarlink.sh     |   50 ++++++++++++++
 3 files changed, 239 insertions(+), 0 deletions(-)
 create mode 100755 tools/voice/build-lantiq-dfev.sh
 create mode 100755 tools/voice/build-silabs.sh
 create mode 100755 tools/voice/build-zarlink.sh

diff --git a/tools/voice/build-lantiq-dfev.sh b/tools/voice/build-lantiq-dfev.sh
new file mode 100755
index 0000000..4134480
--- /dev/null
+++ b/tools/voice/build-lantiq-dfev.sh
@@ -0,0 +1,133 @@
+#!/bin/bash
+leave() {
+	cd $org_path
+#	rm -rf /tmp/slic
+	exit $1
+}
+
+mod_path="${1}/kernel/slic"
+kernel_path=$2
+org_path=`pwd`
+bin_path=$3
+
+# Create directory for build
+rm -rf /tmp/slic
+mkdir -p /tmp/slic
+cd /tmp/slic
+
+
+# Make Lantiq DFEV SLIC
+compiler=`echo "${CROSS_COMPILE%?}"`
+
+git clone git://vgitil04/slic/lantiq
+if [ $? != 0 ]; then
+	echo "Failed to clone Lantiq SLIC"
+	leave 1
+fi
+
+# lib_ifxos
+cd lantiq/dfev/lib_ifxos
+./configure							\
+		--host=$compiler				\
+		--enable-linux-26				\
+		--enable-kernelbuild=$kernel_path		\
+		--enable-kernelincl="$kernel_path/include"	\
+		--with-kernel-module
+make
+if [ $? != 0 ]; then
+	echo "Failed to build Lantiq lib_ifxos"
+	leave 1
+fi
+cd -
+
+# drv_tapi
+cd lantiq/dfev/drv_tapi
+./configure									\
+		--host=$compiler						\
+		--enable-linux-26						\
+		--with-kernel-build=$kernel_path				\
+		--with-kernel-incl="$kernel_path/include" 			\
+		--with-kernel-module						\
+		--with-ifxos-incl=/tmp/slic/lantiq/dfev/lib_ifxos/src/include	\
+		--enable-module							\
+		--enable-tapi4							\
+		--enable-cont-measurement					\
+		--enable-dtmf							\
+		--enable-hsm							\
+		--enable-metering						\
+		--enable-nlt							\
+		--enable-pcm							\
+		--enable-phone-detection					\
+		--enable-voice
+make
+if [ $? != 0 ]; then
+	echo "Failed to build Lantiq drv_tapi"
+	leave 1
+fi
+cd -
+
+# drv_sdd
+cd lantiq/dfev/drv_sdd
+./configure									\
+		--host=$compiler						\
+		--enable-linux-26						\
+		--with-kernel-build=$kernel_path				\
+		--with-kernel-incl="$kernel_path/include" 			\
+		--with-ifxos-incl=/tmp/slic/lantiq/dfev/lib_ifxos/src/include	\
+		--with-tapi-incl=/tmp/slic/lantiq/dfev/drv_tapi/include
+
+make
+if [ $? != 0 ]; then
+	echo "Failed to build Lantiq drv_sdd"
+	leave 1
+fi
+cd -
+
+
+# drv_dfev
+cd lantiq/dfev/drv_dfev
+make -C $kernel_path M=$PWD						\
+		DRV_SDD=/tmp/slic/lantiq/dfev/drv_sdd			\
+		LIB_IFXOS=/tmp/slic/lantiq/dfev/lib_ifxos
+
+if [ $? != 0 ]; then
+	echo "Failed to build Lantiq drv_dfev"
+	leave 1
+fi
+cd -
+
+
+# vmmc_if
+cd lantiq/dfev/vmmc_if
+make -C $kernel_path M=$PWD						\
+		DRV_SDD=/tmp/slic/lantiq/dfev/drv_sdd			\
+		LIB_IFXOS=/tmp/slic/lantiq/dfev/lib_ifxos
+
+if [ $? != 0 ]; then
+	echo "Failed to build Lantiq vmmc_if"
+	leave 1
+fi
+cd -
+
+# Copy objects
+mkdir -p $mod_path/lantiq/dfev/
+find ./lantiq/dfev/ -name "*.ko" | xargs cp -t $mod_path/lantiq/dfev
+
+
+# Zarlink voice tool
+cd $kernel_path
+cd tools/voice/lantiq/kernel/
+make EXTRA_CFLAGS="-I/tmp/slic/lantiq/dfev/lib_ifxos/src/include	\
+		-I/tmp/slic/lantiq/dfev/drv_tapi/include		\
+		-I/tmp/slic/lantiq/dfev/drv_sdd/include			\
+		-I/$kernel_path/arch/arm/plat-armada/mv_drivers_lsp/mv_phone"
+
+if [ $? != 0 ]; then
+	echo "Failed to build Lantiq DFEV voice tool"
+	leave 1
+fi
+mkdir -p $bin_path
+cp mv_voice_tool-* $bin_path/.
+cd -
+
+leave 0
diff --git a/tools/voice/build-silabs.sh b/tools/voice/build-silabs.sh
new file mode 100755
index 0000000..4dd7e54
--- /dev/null
+++ b/tools/voice/build-silabs.sh
@@ -0,0 +1,56 @@
+#!/bin/bash
+leave() {
+	cd $org_path
+	rm -rf /tmp/slic
+	exit $1
+}
+
+mod_path="${1}/kernel/slic"
+kernel_path=$2
+org_path=`pwd`
+bin_path=$3
+
+# Create directory for build
+rm -rf /tmp/slic
+mkdir -p /tmp/slic
+cd /tmp/slic
+
+# Make Silabs SLIC
+git clone git://vgitil04/slic/silabs_proslic_api
+if [ $? != 0 ]; then
+	echo "Failed to clone Silabs SLIC"
+	leave 1
+fi
+
+cd silabs_proslic_api
+make release KDIR=$kernel_path
+if [ $? != 0 ]; then
+	echo "Failed to build Silabs release"
+	leave 1
+fi
+
+make modules KDIR=$kernel_path
+if [ $? != 0 ]; then
+	echo "Failed to build Silabs SLIC"
+	leave 1
+fi
+
+mkdir -p $mod_path/silabs_proslic_api
+find ./ -name "*.ko" | xargs cp -t $mod_path/silabs_proslic_api
+cd -
+
+
+# Silabs voice tool
+cd $kernel_path
+cd tools/voice/silabs
+make SILABS_SLIC=/tmp/slic/silabs_proslic_api
+if [ $? != 0 ]; then
+	echo "Failed to build Silabs voice tool"
+	leave 1
+fi
+mkdir -p $bin_path
+cp mv_voice_tool-* $bin_path/.
+cd -
+
+
+leave 0
diff --git a/tools/voice/build-zarlink.sh b/tools/voice/build-zarlink.sh
new file mode 100755
index 0000000..7ced15f
--- /dev/null
+++ b/tools/voice/build-zarlink.sh
@@ -0,0 +1,50 @@
+#!/bin/bash
+leave() {
+	cd $org_path
+	rm -rf /tmp/slic
+	exit $1
+}
+
+mod_path="${1}/kernel/slic"
+kernel_path=$2
+org_path=`pwd`
+bin_path=$3
+
+# Create directory for build
+rm -rf /tmp/slic
+mkdir -p /tmp/slic
+cd /tmp/slic
+
+# Make Zarlink SLIC
+git clone git://vgitil04/slic/zarlink_vpapi
+if [ $? != 0 ]; then
+	echo "Failed to clone Zarlink SLIC"
+	leave 1
+fi
+
+cd zarlink_vpapi
+make KDIR=$kernel_path
+if [ $? != 0 ]; then
+	echo "Failed to build Zarlink SLIC"
+	leave 1
+fi
+
+mkdir -p $mod_path/zarlink_vpapi
+find ./ -name "*.ko" | xargs cp -t $mod_path/zarlink_vpapi
+cd -
+
+
+# Zarlink voice tool
+cd $kernel_path
+cd tools/voice/zarlink/kernel/
+make ZARLINK_VPAPI=/tmp/slic/zarlink_vpapi
+if [ $? != 0 ]; then
+	echo "Failed to build Zarlink voice tool"
+	leave 1
+fi
+mkdir -p $bin_path
+cp mv_voice_tool-* $bin_path/.
+cd -
+
+
+leave 0
-- 
1.7.5.4

