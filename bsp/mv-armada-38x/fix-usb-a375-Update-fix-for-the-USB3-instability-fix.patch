From c1d26cc5c2cc2bef51f3ee6252bd230a6bf07fdb Mon Sep 17 00:00:00 2001
From: Nadav Haklai <nadavh@marvell.com>
Date: Tue, 19 Nov 2013 09:44:32 +0200
Subject: [PATCH 1152/1825] fix: usb: a375: Update fix for the USB3
 instability fix patch

https://github.com/MISL-EBU-System-SW/misl-windriver.git linux-3.4.69-14t2-read
commit a3a568639cb3d4bac389cd3ba5e32f1fb06a8009

	Make sure 150nm Phy init functions are not called when initializing Armada375 Phy

Signed-off-by: Nadav Haklai <nadavh@marvell.com>

Change-Id: Id92af18760bc3ba9a56d4adfa95fb7631b5265d0
Reviewed-on: http://vgitil04.il.marvell.com:8080/4354
Tested-by: Star_Automation <star@marvell.com>
Reviewed-by: Yehuda Yitschak <yehuday@marvell.com>
Signed-off-by: Zhong Hongbo <hongbo.zhong@windriver.com>
---
 arch/arm/plat-armada/mv_hal/usb/mvUsb.c |    9 +++++----
 1 files changed, 5 insertions(+), 4 deletions(-)

diff --git a/arch/arm/plat-armada/mv_hal/usb/mvUsb.c b/arch/arm/plat-armada/mv_hal/usb/mvUsb.c
index 1418f43..ecc7bdc 100755
--- a/arch/arm/plat-armada/mv_hal/usb/mvUsb.c
+++ b/arch/arm/plat-armada/mv_hal/usb/mvUsb.c
@@ -186,8 +186,6 @@ int mvUsbBackVoltageUpdate(int dev, MV_U8 gppNo)
 /* USB Phy init specific for 28nm (88F68XX) */
 MV_STATUS mvUsbPhy28nmInit(int dev)
 {
-	MV_U32 regVal;
-
 	/* Temporary init sequence until final init sequence is stable */
 	MV_REG_WRITE(0x18440, 0x62);
 	MV_REG_WRITE(0xC0000, 0x40605205);
@@ -831,10 +829,13 @@ MV_STATUS mvUsbUtmiPhyInit(int dev, MV_USB_HAL_DATA *usbHalData)
 			status = MV_NOT_READY;
 
 	} else if (usbHalData->ctrlFamily == MV_88F66X0) {
-		/* The below init flow is incorrect for MVF67X0 and disabled until updated */
-		/*    (usbHalData->ctrlFamily == MV_88F67X0)) */
+
 		status = mvUsbPhy40nmLpInit(dev);
 
+	} else if (usbHalData->ctrlFamily == MV_88F67X0) {
+		/* The below init flow is incorrect for MVF67X0 and disabled until updated */
+		/* status = mvUsbPhy40nmLpInit(dev); */
+
 	} else if (usbHalData->ctrlFamily == MV_88F68XX) {
 
 		status = mvUsbPhy28nmInit(dev);
-- 
1.7.5.4

