From 05960363137557de45f55eaf376f65896ca31c34 Mon Sep 17 00:00:00 2001
From: Nadav Haklai <nadavh@marvell.com>
Date: Sun, 7 Apr 2013 10:12:25 +0300
Subject: [PATCH 0537/1825] xp,cesa: Add config options to adjust int
 coalescing mode parameters.

https://github.com/MISL-EBU-System-SW/misl-windriver.git linux-3.4.69-14t2-read
commit 4a462afbe0b2e4aaab97b2da5718ea95c46bc08b

Threshold values used by interrupt coalescing mode were hardcoded
in mvCesa.c. This patch allows to change interrupt and time
thresholds from kernel menuconfig.

Change-Id: Ib37295a496af2d795f8fc75182241acde15dc747
Signed-off-by: Michal Mazur <arg@semihalf.com>
Signed-off-by: Nadav Haklai <nadavh@marvell.com>
Reviewed-on: http://vgitil04.il.marvell.com:8080/1439
Signed-off-by: Zhong Hongbo <hongbo.zhong@windriver.com>
---
 arch/arm/plat-armada/mv_hal/cesa/mvCesa.c |   11 ++---------
 1 files changed, 2 insertions(+), 9 deletions(-)

diff --git a/arch/arm/plat-armada/mv_hal/cesa/mvCesa.c b/arch/arm/plat-armada/mv_hal/cesa/mvCesa.c
index 2313f6e..05f983b 100644
--- a/arch/arm/plat-armada/mv_hal/cesa/mvCesa.c
+++ b/arch/arm/plat-armada/mv_hal/cesa/mvCesa.c
@@ -415,16 +415,9 @@ MV_STATUS mvCesaHalInit(int numOfSession, int queueDepth, void *osHandle, MV_CES
 
 #ifdef MV_CESA_INT_COALESCING_SUPPORT
 		configReg |= MV_CESA_CFG_CHAIN_MODE_MASK;
-#ifdef MV_CESA_TEST
-		/* Enable interrupt coalescing for test tool */
-		MV_REG_WRITE(MV_CESA_INT_COAL_TH_REG(chan), 0x1);
-		MV_REG_WRITE(MV_CESA_INT_TIME_TH_REG(chan), 0xff);
-
-#else
 		/* Enable interrupt coalescing */
-		MV_REG_WRITE(MV_CESA_INT_COAL_TH_REG(chan), 0x2);
-		MV_REG_WRITE(MV_CESA_INT_TIME_TH_REG(chan), 0xfffff);
-#endif
+		MV_REG_WRITE(MV_CESA_INT_COAL_TH_REG(chan), MV_CESA_INT_COAL_THRESHOLD);
+		MV_REG_WRITE(MV_CESA_INT_TIME_TH_REG(chan), MV_CESA_INT_COAL_TIME_THRESHOLD);
 #endif
 
 		/* Set CESA configuration registers */
-- 
1.7.5.4

