From d373e470ca6577eb34bb77731fbca5543df3036c Mon Sep 17 00:00:00 2001
From: Tawfik Bayouk <tawfik@marvell.com>
Date: Thu, 13 Dec 2012 19:43:48 +0200
Subject: [PATCH 0394/1825] Armada300,arm: Fix conflicts between Armada and
 Orion configurations.

https://github.com/MISL-EBU-System-SW/misl-windriver.git linux-3.4.69-14t2-read
commit baacc5eb1f62e374411902fc618de1c6e38593a9

Change-Id: I6e742c678fc717b105fc79355dc9bcb86bb90a1c
Signed-off-by: Tawfik Bayouk <tawfik@marvell.com>
Signed-off-by: Kosta Zertsekel <konszert@marvell.com>
Signed-off-by: Zhong Hongbo <hongbo.zhong@windriver.com>
---
 .../arm/plat-armada/mv_drivers_lsp/mv_cesa/Kconfig |   16 +++-
 .../plat-armada/mv_drivers_lsp/mv_phone/Kconfig    |   94 ++++++++++++++++---
 arch/arm/plat-armada/mv_drivers_lsp/mv_tsu/Kconfig |   48 ++++++++--
 .../plat-orion/mv_drivers_lsp/mv_network/Kconfig   |    2 +-
 .../arm/plat-orion/mv_drivers_lsp/mv_phone/Kconfig |   94 ++++++++++++++++----
 arch/arm/plat-orion/mv_drivers_lsp/mv_tsu/Kconfig  |   48 ++++++++--
 drivers/mtd/Makefile                               |    4 +-
 drivers/mtd/maps/Makefile                          |    2 +
 drivers/net/Makefile                               |    2 +
 sound/soc/Makefile                                 |    3 +
 10 files changed, 260 insertions(+), 53 deletions(-)

diff --git a/arch/arm/plat-armada/mv_drivers_lsp/mv_cesa/Kconfig b/arch/arm/plat-armada/mv_drivers_lsp/mv_cesa/Kconfig
index 749d3b0..0a802b0 100644
--- a/arch/arm/plat-armada/mv_drivers_lsp/mv_cesa/Kconfig
+++ b/arch/arm/plat-armada/mv_drivers_lsp/mv_cesa/Kconfig
@@ -29,23 +29,33 @@ config MV_CESA_CHAIN_MODE
 choice 
         prompt "CESA Mode"
         depends on MV_CESA
-        default MV_CESA_OCF
+        default MV_CESA_OCF_ARMADA
 
-config	MV_CESA_OCF
+config	MV_CESA_OCF_ARMADA
 	tristate "Support for Marvell CESA OCF driver"
 	depends on OCF_OCF
+	select MV_CESA_OCF
 	---help---
 	  Choosing this option will enable you to use the Marvell Cryptographic Engine and
 	  Security Accelerator, under the OCF package.
 
-config  MV_CESA_TEST
+config  MV_CESA_TEST_ARMADA
 	bool "Support for Marvell CESA test driver"
 	depends on MV_CESA_TOOL 
+	select MV_CESA_TEST
 	---help---
 	  Choosing this option will enable you to use the Marvell Cryptographic Engine and
 	  Security Accelerator, with the mv_cesa_tool in test mode.
 endchoice
 
+config	MV_CESA_OCF
+	depends on MV_CESA_OCF_ARMADA
+	tristate
+
+config  MV_CESA_TEST
+	depends on MV_CESA_TEST_ARMADA
+	bool
+
 endmenu
 
 
diff --git a/arch/arm/plat-armada/mv_drivers_lsp/mv_phone/Kconfig b/arch/arm/plat-armada/mv_drivers_lsp/mv_phone/Kconfig
index 2d21470..d2a7419 100644
--- a/arch/arm/plat-armada/mv_drivers_lsp/mv_phone/Kconfig
+++ b/arch/arm/plat-armada/mv_drivers_lsp/mv_phone/Kconfig
@@ -13,30 +13,50 @@ config  MV_PHONE
 choice
 	prompt "TDM Unit"
 	depends on MV_PHONE
-	default MV_TDM_SUPPORT
+	default MV_TDM_SUPPORT_ARMADA
 
-config MV_TDM_SUPPORT
+config MV_TDM_SUPPORT_ARMADA
 	bool "Support legacy TDM(2 channels)"
+	select MV_TDM_SUPPORT
 
-config MV_COMM_UNIT_SUPPORT
+config MV_COMM_UNIT_SUPPORT_ARMADA
 	depends on ARCH_FEROCEON_KW2 || ARCH_ARMADA_XP
 	bool "Support CommUnit(up to 32 channels)"
+	select MV_COMM_UNIT_SUPPORT
 
 endchoice
 
+config MV_TDM_SUPPORT
+	depends on MV_TDM_SUPPORT_ARMADA
+	bool
+
+config MV_COMM_UNIT_SUPPORT
+	depends on MV_COMM_UNIT_SUPPORT_ARMADA
+	bool
+
 choice
 	prompt "SLIC Vendor"
 	depends on MV_PHONE
-	default ZARLINK_SLIC_SUPPORT
+	default ZARLINK_SLIC_SUPPORT_ARMADA
 
-#config SILABS_SLIC_SUPPORT
+#config SILABS_SLIC_SUPPORT_ARMADA
 #	bool "Support Silicon Labs devices"
+#	select SILABS_SLIC_SUPPORT
 
-config ZARLINK_SLIC_SUPPORT
+config ZARLINK_SLIC_SUPPORT_ARMADA
 	bool "Support Zarlink/Legirity devices"
+	select ZARLINK_SLIC_SUPPORT
 
 endchoice
 
+#config SILABS_SLIC_SUPPORT
+#	depends on SILABS_SLIC_SUPPORT_ARMADA
+#	bool
+
+config ZARLINK_SLIC_SUPPORT
+	depends on ZARLINK_SLIC_SUPPORT_ARMADA
+	bool
+
 choice
 	prompt "SLIC Device"
 	depends on MV_PHONE && SILABS_SLIC_SUPPORT
@@ -52,43 +72,87 @@ endchoice
 choice
 	prompt "SLIC Device"
 	depends on MV_PHONE && ZARLINK_SLIC_SUPPORT
-	default ZARLINK_SLIC_VE880
+	default ZARLINK_SLIC_VE880_ARMADA
 
-config ZARLINK_SLIC_VE880
+config ZARLINK_SLIC_VE880_ARMADA
 	bool "Support Zarlink VE880 SLIC family"
+	select ZARLINK_SLIC_VE880
 
-config ZARLINK_SLIC_VE792
+config ZARLINK_SLIC_VE792_ARMADA
 	bool "Support Zarlink VE792 SLIC family"
+	select ZARLINK_SLIC_VE792
 
 endchoice
 
+config ZARLINK_SLIC_VE880
+	depends on ZARLINK_SLIC_VE880_ARMADA
+	bool
+
+config ZARLINK_SLIC_VE792
+	depends on ZARLINK_SLIC_VE792_ARMADA
+	bool
+
 choice
 	prompt "PCM Clock Frequency"
 	depends on MV_PHONE
-	default MV_TDM_PCM_CLK_8MHZ
+	default MV_TDM_PCM_CLK_8MHZ_ARMADA
 	---help---
 	This menu selects the PCM clock frequency generated by the TDM master.
 	SLIC should be configured accordingly in order to maintain bus coherency.
 
-config MV_TDM_PCM_CLK_8MHZ
+config MV_TDM_PCM_CLK_8MHZ_ARMADA
 	bool "Support 8MHz PCM clock"
+	select MV_TDM_PCM_CLK_8MHZ
 
-config MV_TDM_PCM_CLK_4MHZ
+config MV_TDM_PCM_CLK_4MHZ_ARMADA
 	bool "Support 4MHz PCM clock"
+	select MV_TDM_PCM_CLK_4MHZ
 
-config MV_TDM_PCM_CLK_2MHZ
+config MV_TDM_PCM_CLK_2MHZ_ARMADA
 	bool "Support 2MHz PCM clock"
+	select MV_TDM_PCM_CLK_2MHZ
 
 endchoice
 
-config MV_PHONE_USE_IRQ_PROCESSING
+config MV_TDM_PCM_CLK_8MHZ
+	depends on MV_TDM_PCM_CLK_8MHZ_ARMADA
+	bool
+
+config MV_TDM_PCM_CLK_4MHZ
+	depends on MV_TDM_PCM_CLK_4MHZ_ARMADA
+	bool
+
+config MV_TDM_PCM_CLK_2MHZ
+	depends on MV_TDM_PCM_CLK_2MHZ_ARMADA
+	bool
+
+choice 
+	prompt "TDM voice processing"
+	depends on MV_PHONE
+	default MV_TDM_DUMMY_ARMADA
+
+config MV_TDM_DUMMY_ARMADA
+	bool "Support TDM voice processing in softIRQ"
+	select MV_TDM_DUMMY
+
+config MV_PHONE_USE_IRQ_PROCESSING_ARMADA
 	bool "Support Rx/Tx processing in interrupt context"
 	depends on MV_PHONE
-	default n
+	select MV_PHONE_USE_IRQ_PROCESSING
 	---help---
 	Choosing this option supports Rx/Tx voice processing in interrupt context, otherwise
 	processing is performed in tasklet context.
 
+endchoice
+
+config MV_TDM_DUMMY
+	depends on MV_TDM_DUMMY_ARMADA
+	bool
+
+config MV_PHONE_USE_IRQ_PROCESSING
+	depends on MV_PHONE_USE_IRQ_PROCESSING_ARMADA
+	bool
+
 config MV_TDM_USE_EXTERNAL_PCLK_SOURCE
 	bool "Support PCLK from external source"
 	depends on MV_PHONE
diff --git a/arch/arm/plat-armada/mv_drivers_lsp/mv_tsu/Kconfig b/arch/arm/plat-armada/mv_drivers_lsp/mv_tsu/Kconfig
index 1656f68..1114788 100644
--- a/arch/arm/plat-armada/mv_drivers_lsp/mv_tsu/Kconfig
+++ b/arch/arm/plat-armada/mv_drivers_lsp/mv_tsu/Kconfig
@@ -8,38 +8,70 @@ config  MV_TSU
 choice
 	prompt "TSU interface type"
 	depends on MV_TSU
-	default TSU_PARALLEL_IF
+	default TSU_PARALLEL_IF_ARMADA
 
-config TSU_SERIAL_IF
+config TSU_SERIAL_IF_ARMADA
 	bool "Serial Interface"
+	select TSU_SERIAL_IF
 	---help---
 	The TSU will work in serial mode (2 ports).
 
-config TSU_PARALLEL_IF
+config TSU_PARALLEL_IF_ARMADA
 	bool "Parallel Interface"
+	select TSU_PARALLEL_IF
 	---help---
 	The TSU will work in parallel mode (1 port).
 endchoice
 
+config TSU_SERIAL_IF
+	depends on TSU_SERIAL_IF_ARMADA
+	bool
+
+config TSU_PARALLEL_IF
+	depends on TSU_PARALLEL_IF_ARMADA
+	bool
+
 
 choice
 	prompt "TSU Core-Clock"
 	depends on MV_TSU
-	default TSU_CORE_CLK_83MHZ
+	default TSU_CORE_CLK_83MHZ_ARMADA
 
-config TSU_CORE_CLK_71MHZ
+config TSU_CORE_CLK_71MHZ_ARMADA
 	bool "71 MHz TSU Core Clock"
+	select TSU_CORE_CLK_71MHZ
 
-config TSU_CORE_CLK_83MHZ
+config TSU_CORE_CLK_83MHZ_ARMADA
 	bool "83 MHz TSU Core Clock"
+	select TSU_CORE_CLK_83MHZ
 
-config TSU_CORE_CLK_91MHZ
+config TSU_CORE_CLK_91MHZ_ARMADA
 	bool "91 MHz TSU Core Clock"
-config TSU_CORE_CLK_100MHZ
+	select TSU_CORE_CLK_91MHZ
+
+config TSU_CORE_CLK_100MHZ_ARMADA
 	bool "100 MHz TSU Core Clock"
+	select TSU_CORE_CLK_100MHZ
 
 endchoice
 
+config TSU_CORE_CLK_71MHZ
+	depends on TSU_CORE_CLK_71MHZ_ARMADA
+	bool
+
+config TSU_CORE_CLK_83MHZ
+	depends on TSU_CORE_CLK_83MHZ_ARMADA
+	bool
+
+config TSU_CORE_CLK_91MHZ
+	depends on TSU_CORE_CLK_91MHZ_ARMADA
+	bool
+
+config TSU_CORE_CLK_100MHZ
+	depends on TSU_CORE_CLK_100MHZ_ARMADA
+	bool
+
+
 config  MV_TSU_PKT_SIZE
         int "TSU packet size"
         depends on MV_TSU
diff --git a/arch/arm/plat-orion/mv_drivers_lsp/mv_network/Kconfig b/arch/arm/plat-orion/mv_drivers_lsp/mv_network/Kconfig
index d63ee90..9f5e0d0 100644
--- a/arch/arm/plat-orion/mv_drivers_lsp/mv_network/Kconfig
+++ b/arch/arm/plat-orion/mv_drivers_lsp/mv_network/Kconfig
@@ -212,7 +212,7 @@ config NET_SKB_RECYCLE_DEF
         ---help---
 
 config  MV_ETH_NFP
-        bool "Use Network Fast Processing (NFP)"
+	tristate "Use Network Fast Processing (NFP)"
 	default y
         ---help---
         Choosing this option will include NFP support in the image.
diff --git a/arch/arm/plat-orion/mv_drivers_lsp/mv_phone/Kconfig b/arch/arm/plat-orion/mv_drivers_lsp/mv_phone/Kconfig
index 7293ca7..f843eea 100644
--- a/arch/arm/plat-orion/mv_drivers_lsp/mv_phone/Kconfig
+++ b/arch/arm/plat-orion/mv_drivers_lsp/mv_phone/Kconfig
@@ -13,30 +13,50 @@ config  MV_PHONE
 choice 
 	prompt "TDM Unit"
 	depends on MV_PHONE
-	default MV_TDM_SUPPORT
+	default MV_TDM_SUPPORT_ORION
 
-config MV_TDM_SUPPORT
+config MV_TDM_SUPPORT_ORION
 	bool "Support legacy TDM(2 channels)"
+	select MV_TDM_SUPPORT
 
-config MV_COMM_UNIT_SUPPORT
+config MV_COMM_UNIT_SUPPORT_ORION
 	depends on ARCH_FEROCEON_KW2
 	bool "Support CommUnit(up to 32 channels)"
+	select MV_COMM_UNIT_SUPPORT
 
 endchoice
 
+config MV_TDM_SUPPORT
+	depends on MV_TDM_SUPPORT_ORION
+	bool
+
+config MV_COMM_UNIT_SUPPORT
+	depends on MV_COMM_UNIT_SUPPORT_ORION
+	bool
+
 choice 
 	prompt "SLIC Vendor"
 	depends on MV_PHONE
-	default ZARLINK_SLIC_SUPPORT
+	default ZARLINK_SLIC_SUPPORT_ORION
 
-config SILABS_SLIC_SUPPORT
+config SILABS_SLIC_SUPPORT_ORION
 	bool "Support Silicon Labs devices"
+	select SILABS_SLIC_SUPPORT
 
-config ZARLINK_SLIC_SUPPORT
+config ZARLINK_SLIC_SUPPORT_ORION
 	bool "Support Zarlink/Legirity devices"
+	select ZARLINK_SLIC_SUPPORT
 
 endchoice
 
+config SILABS_SLIC_SUPPORT
+	depends on SILABS_SLIC_SUPPORT_ORION
+	bool
+
+config ZARLINK_SLIC_SUPPORT
+	depends on ZARLINK_SLIC_SUPPORT_ORION
+	bool
+
 choice 
 	prompt "SLIC Device"
 	depends on MV_PHONE && SILABS_SLIC_SUPPORT
@@ -52,35 +72,60 @@ endchoice
 choice 
 	prompt "SLIC Device"
 	depends on MV_PHONE && ZARLINK_SLIC_SUPPORT
-	default ZARLINK_SLIC_VE880
+	default ZARLINK_SLIC_VE880_ORION
 
-config ZARLINK_SLIC_VE880
+config ZARLINK_SLIC_VE880_ORION
 	bool "Support Zarlink VE880 SLIC family"
+	select ZARLINK_SLIC_VE880
 
-config ZARLINK_SLIC_VE792
+config ZARLINK_SLIC_VE792_ORION
 	bool "Support Zarlink VE792 SLIC family"
+	select ZARLINK_SLIC_VE792
 
 endchoice
 
+config ZARLINK_SLIC_VE880
+	depends on ZARLINK_SLIC_VE880_ORION
+	bool
+
+config ZARLINK_SLIC_VE792
+	depends on ZARLINK_SLIC_VE792_ORION
+	bool
+
 choice 
 	prompt "PCM Clock Frequency"
 	depends on MV_PHONE
-	default MV_TDM_PCM_CLK_8MHZ
+	default MV_TDM_PCM_CLK_8MHZ_ORION
 	---help---
 	This menu selects the PCM clock frequency generated by the TDM master.
 	SLIC should be configured accordingly in order to maintain bus coherency.
  
-config MV_TDM_PCM_CLK_8MHZ
+config MV_TDM_PCM_CLK_8MHZ_ORION
 	bool "Support 8MHz PCM clock"
+	select MV_TDM_PCM_CLK_8MHZ
 
-config MV_TDM_PCM_CLK_4MHZ
+config MV_TDM_PCM_CLK_4MHZ_ORION
 	bool "Support 4MHz PCM clock"
+	select MV_TDM_PCM_CLK_4MHZ
 
-config MV_TDM_PCM_CLK_2MHZ
+config MV_TDM_PCM_CLK_2MHZ_ORION
 	bool "Support 2MHz PCM clock"
+	select MV_TDM_PCM_CLK_2MHZ
 
 endchoice
 
+config MV_TDM_PCM_CLK_8MHZ
+	depends on MV_TDM_PCM_CLK_8MHZ_ORION
+	bool
+
+config MV_TDM_PCM_CLK_4MHZ
+	depends on MV_TDM_PCM_CLK_4MHZ_ORION
+	bool
+
+config MV_TDM_PCM_CLK_2MHZ
+	depends on MV_TDM_PCM_CLK_2MHZ_ORION
+	bool
+
 #choice 
 #	prompt "TDM Clock Source"
 #	depends on MV_PHONE
@@ -100,20 +145,35 @@ endchoice
 choice 
 	prompt "TDM voice processing"
 	depends on MV_PHONE
-	default MV_TDM_DUMMY
+	default MV_TDM_DUMMY_ORION
 
-config MV_TDM_DUMMY
+config MV_TDM_DUMMY_ORION
 	bool "Support TDM voice processing in softIRQ"
+	select MV_TDM_DUMMY
 
-config MV_PHONE_USE_IRQ_PROCESSING
+config MV_PHONE_USE_IRQ_PROCESSING_ORION
 	bool "Support TDM voice processing in IRQ"
+	select MV_PHONE_USE_IRQ_PROCESSING
 
-config MV_PHONE_USE_FIQ_PROCESSING
+config MV_PHONE_USE_FIQ_PROCESSING_ORION
 	depends on ARCH_FEROCEON_KW2
 	bool "Support TDM voice processing in FIQ"
+	select MV_PHONE_USE_FIQ_PROCESSING
 
 endchoice
 
+config MV_TDM_DUMMY
+	depends on MV_TDM_DUMMY_ORION
+	bool
+
+config MV_PHONE_USE_IRQ_PROCESSING
+	depends on MV_PHONE_USE_IRQ_PROCESSING_ORION
+	bool
+
+config MV_PHONE_USE_FIQ_PROCESSING
+	depends on MV_PHONE_USE_FIQ_PROCESSING_ORION
+	bool
+
 config MV_PHONE_USE_SLIC_LIBS
 	bool "Use binary SLIC drivers"
 	depends on MV_PHONE
diff --git a/arch/arm/plat-orion/mv_drivers_lsp/mv_tsu/Kconfig b/arch/arm/plat-orion/mv_drivers_lsp/mv_tsu/Kconfig
index 1656f68..f031da3 100644
--- a/arch/arm/plat-orion/mv_drivers_lsp/mv_tsu/Kconfig
+++ b/arch/arm/plat-orion/mv_drivers_lsp/mv_tsu/Kconfig
@@ -8,38 +8,70 @@ config  MV_TSU
 choice
 	prompt "TSU interface type"
 	depends on MV_TSU
-	default TSU_PARALLEL_IF
+	default TSU_PARALLEL_IF_ORION
 
-config TSU_SERIAL_IF
+config TSU_SERIAL_IF_ORION
 	bool "Serial Interface"
+	select TSU_SERIAL_IF
 	---help---
 	The TSU will work in serial mode (2 ports).
 
-config TSU_PARALLEL_IF
+config TSU_PARALLEL_IF_ORION
 	bool "Parallel Interface"
+	select TSU_PARALLEL_IF
 	---help---
 	The TSU will work in parallel mode (1 port).
 endchoice
 
+config TSU_SERIAL_IF
+	depends on TSU_SERIAL_IF_ORION
+	bool
+
+config TSU_PARALLEL_IF
+	depends on TSU_PARALLEL_IF_ORION
+	bool
+
 
 choice
 	prompt "TSU Core-Clock"
 	depends on MV_TSU
-	default TSU_CORE_CLK_83MHZ
+	default TSU_CORE_CLK_83MHZ_ORION
 
-config TSU_CORE_CLK_71MHZ
+config TSU_CORE_CLK_71MHZ_ORION
 	bool "71 MHz TSU Core Clock"
+	select TSU_CORE_CLK_71MHZ
 
-config TSU_CORE_CLK_83MHZ
+config TSU_CORE_CLK_83MHZ_ORION
 	bool "83 MHz TSU Core Clock"
+	select TSU_CORE_CLK_83MHZ
 
-config TSU_CORE_CLK_91MHZ
+config TSU_CORE_CLK_91MHZ_ORION
 	bool "91 MHz TSU Core Clock"
-config TSU_CORE_CLK_100MHZ
+	select TSU_CORE_CLK_91MHZ
+
+config TSU_CORE_CLK_100MHZ_ORION
 	bool "100 MHz TSU Core Clock"
+	select TSU_CORE_CLK_100MHZ
 
 endchoice
 
+config TSU_CORE_CLK_71MHZ
+	depends on TSU_CORE_CLK_71MHZ_ORION
+	bool
+
+config TSU_CORE_CLK_83MHZ
+	depends on TSU_CORE_CLK_83MHZ_ORION
+	bool
+
+config TSU_CORE_CLK_91MHZ
+	depends on TSU_CORE_CLK_91MHZ_ORION
+	bool
+
+config TSU_CORE_CLK_100MHZ
+	depends on TSU_CORE_CLK_100MHZ_ORION
+	bool
+
+
 config  MV_TSU_PKT_SIZE
         int "TSU packet size"
         depends on MV_TSU
diff --git a/drivers/mtd/Makefile b/drivers/mtd/Makefile
index 0b2d280..8dfb927 100644
--- a/drivers/mtd/Makefile
+++ b/drivers/mtd/Makefile
@@ -33,5 +33,7 @@ inftl-objs		:= inftlcore.o inftlmount.o
 obj-y		+= chips/ lpddr/ maps/ devices/ nand/ onenand/ tests/
 
 obj-$(CONFIG_MTD_UBI)		+= ubi/
-obj-$(CONFIG_MTD)		+= ../../arch/arm/plat-armada/mv_drivers_lsp/mv_mtd/
 
+ifeq ($(CONFIG_PLAT_ARMADA),y)
+obj-$(CONFIG_MTD)		+= ../../arch/arm/plat-armada/mv_drivers_lsp/mv_mtd/
+endif
diff --git a/drivers/mtd/maps/Makefile b/drivers/mtd/maps/Makefile
index 252f334..e9840b7 100644
--- a/drivers/mtd/maps/Makefile
+++ b/drivers/mtd/maps/Makefile
@@ -58,7 +58,9 @@ obj-$(CONFIG_MTD_GPIO_ADDR)	+= gpio-addr-flash.o
 obj-$(CONFIG_MTD_LATCH_ADDR)	+= latch-addr-flash.o
 obj-$(CONFIG_MTD_LANTIQ)	+= lantiq-flash.o
 
+ifeq ($(CONFIG_PLAT_ARMADA),y)
 ifeq ($(CONFIG_MV_INCLUDE_SPI),y)
 	include $(srctree)/$(MACHINE)/config/mvRules.mk
 	obj-$(CONFIG_MV_INCLUDE_SPI) += ../../../$(MACHINE)/flashmap.o
 endif
+endif
diff --git a/drivers/net/Makefile b/drivers/net/Makefile
index 7ad029b..ebfc779 100644
--- a/drivers/net/Makefile
+++ b/drivers/net/Makefile
@@ -1,8 +1,10 @@
 #
 # Makefile for the Linux network device drivers.
 #
+ifeq ($(CONFIG_PLAT_ARMADA),y)
 obj-$(CONFIG_MV_ETH_LEGACY) += ../../arch/arm/plat-armada/mv_drivers_lsp/mv_network/mv_ethernet/
 obj-$(CONFIG_MV_ETH_NETA) += ../../arch/arm/plat-armada/mv_drivers_lsp/mv_neta/net_dev/
+endif
 
 #
 # Networking Core Drivers
diff --git a/sound/soc/Makefile b/sound/soc/Makefile
index d3b0ddd..1248bcf 100644
--- a/sound/soc/Makefile
+++ b/sound/soc/Makefile
@@ -28,4 +28,7 @@ obj-$(CONFIG_SND_SOC)	+= sh/
 obj-$(CONFIG_SND_SOC)   += spear/
 obj-$(CONFIG_SND_SOC)	+= tegra/
 obj-$(CONFIG_SND_SOC)	+= txx9/
+
+ifeq ($(CONFIG_PLAT_ARMADA),y)
 obj-$(CONFIG_SND_MRVL_AUDIO)  += ../../arch/arm/plat-armada/mv_drivers_lsp/mv_audio_soc/
+endif
-- 
1.7.5.4

