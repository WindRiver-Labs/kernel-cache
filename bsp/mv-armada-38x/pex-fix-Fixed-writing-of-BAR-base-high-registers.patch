From d36dae3dc02e90c82f963a44adef0e48b314f275 Mon Sep 17 00:00:00 2001
From: Yehuda Yitschak <yehuday@marvell.com>
Date: Sun, 30 Jun 2013 17:50:27 +0300
Subject: [PATCH 0766/1825] pex:fix: Fixed writing of BAR base high registers

https://github.com/MISL-EBU-System-SW/misl-windriver.git linux-3.4.69-14t2-read
commit ea95d696564ad0d9340d7e29f990c10914b9dbb7

	The function mvPexBarSet wrote the base high value
	to the BAR registers only when the high value was non-zero
	assuming the register contains defualt value. In case
	the base high register was modified before linux boot, the
	base high will have an invalid value.
	fix - integrate to stable branch.

Change-Id: If58dd900b7c12d6db647e89a4b06624bb2efc39c
Signed-off-by: Yehuda Yitschak <yehuday@marvell.com>
Reviewed-on: http://vgitil04.il.marvell.com:8080/2418
Tested-by: Star_Automation <star@marvell.com>
Reviewed-by: Lior Amsalem <alior@marvell.com>
Signed-off-by: Zhong Hongbo <hongbo.zhong@windriver.com>
---
 arch/arm/plat-armada/mv_hal/pex/mvPexAddrDec.c |    8 +++-----
 1 files changed, 3 insertions(+), 5 deletions(-)

diff --git a/arch/arm/plat-armada/mv_hal/pex/mvPexAddrDec.c b/arch/arm/plat-armada/mv_hal/pex/mvPexAddrDec.c
index 8f12bf6..f415ea7 100644
--- a/arch/arm/plat-armada/mv_hal/pex/mvPexAddrDec.c
+++ b/arch/arm/plat-armada/mv_hal/pex/mvPexAddrDec.c
@@ -747,11 +747,9 @@ MV_STATUS mvPexBarSet(MV_U32 pexIf, MV_U32 barNum, MV_PEX_BAR *pAddrWin)
 	/* write base low */
 	MV_REG_WRITE(PEX_CFG_DIRECT_ACCESS(pexIf, PEX_MV_BAR_BASE(barNum)), regBaseLow);
 
-	if (pAddrWin->addrWin.baseHigh != 0) {
-		/* Read base address high */
-		MV_REG_WRITE(PEX_CFG_DIRECT_ACCESS(pexIf, PEX_MV_BAR_BASE_HIGH(barNum)),
-			     pAddrWin->addrWin.baseHigh);
-	}
+	/* Write base address high */
+	MV_REG_WRITE(PEX_CFG_DIRECT_ACCESS(pexIf, PEX_MV_BAR_BASE_HIGH(barNum)),
+		     pAddrWin->addrWin.baseHigh);
 
 	/* lastly enable the Bar */
 	if (pAddrWin->enable == MV_TRUE) {
-- 
1.7.5.4

