From e9e11c4547656c1e15121828939c6f48554abc4c Mon Sep 17 00:00:00 2001
From: Tawfik Bayouk <tawfik@marvell.com>
Date: Tue, 21 Aug 2012 17:33:02 +0300
Subject: [PATCH 0034/1825] DSMP Port in CC changes: - Rd-NAS porting - Serdes
 configuation to enable PEX, Sata, SGMII (
 originaly by Tawfik B. )

https://github.com/MISL-EBU-System-SW/misl-windriver.git linux-3.4.69-14t2-read
commit f676fb481f2410422b93f68b90c42fad54711ae6

Change-Id: Idf74e552961f3ccc5483966158ea7055520a4de3
Signed-off-by: Tawfik Bayouk <tawfik@marvell.com>
Signed-off-by: Zhong Hongbo <hongbo.zhong@windriver.com>
---
 arch/arm/plat-armada/mv_hal/ddr2_3/mvDramIfRegs.h |    4 ++++
 arch/arm/plat-armada/mv_hal/neta/gbe/mvNeta.c     |    7 ++++++-
 arch/arm/plat-armada/mv_hal/neta/gbe/mvNetaRegs.h |    3 +++
 3 files changed, 13 insertions(+), 1 deletions(-)

diff --git a/arch/arm/plat-armada/mv_hal/ddr2_3/mvDramIfRegs.h b/arch/arm/plat-armada/mv_hal/ddr2_3/mvDramIfRegs.h
index 33de7d6..7b921e9 100644
--- a/arch/arm/plat-armada/mv_hal/ddr2_3/mvDramIfRegs.h
+++ b/arch/arm/plat-armada/mv_hal/ddr2_3/mvDramIfRegs.h
@@ -149,6 +149,10 @@ extern "C" {
 #define ECC_SUPPORT
 #define REG_SDRAM_CONFIG_ADDR                                   0x1400
 #define REG_SDRAM_CONFIG_ECC_OFFS                               18
+#define REG_STATIC_DRAM_DLB_CONTROL                             0x1700
+#define DLB_ENABLE 0x1
+#define DLB_WRITE_COALESING 0x4
+#define DLB_AXI_PREFETCH_EN 0x8
 
 #ifdef __cplusplus
 }
diff --git a/arch/arm/plat-armada/mv_hal/neta/gbe/mvNeta.c b/arch/arm/plat-armada/mv_hal/neta/gbe/mvNeta.c
index 612ddcb..b881542 100644
--- a/arch/arm/plat-armada/mv_hal/neta/gbe/mvNeta.c
+++ b/arch/arm/plat-armada/mv_hal/neta/gbe/mvNeta.c
@@ -524,9 +524,14 @@ MV_STATUS       mvEthGmacRgmiiSet(int port, int enable)
 
 static void mvNetaPortSgmiiConfig(int port)
 {
-	/* FIXME */
+        MV_U32 regVal;
+
+        regVal = MV_REG_READ(NETA_GMAC_CTRL_2_REG(port));
+        regVal |= (NETA_GMAC_PSC_ENABLE_MASK);
+        MV_REG_WRITE(NETA_GMAC_CTRL_2_REG(port), regVal);
 }
 
+
 void mvNetaPortPowerUp(int port, MV_BOOL isSgmii, MV_BOOL isRgmii)
 {
 	MV_U32 regVal;
diff --git a/arch/arm/plat-armada/mv_hal/neta/gbe/mvNetaRegs.h b/arch/arm/plat-armada/mv_hal/neta/gbe/mvNetaRegs.h
index 1ae714a..4b6b62b 100644
--- a/arch/arm/plat-armada/mv_hal/neta/gbe/mvNetaRegs.h
+++ b/arch/arm/plat-armada/mv_hal/neta/gbe/mvNetaRegs.h
@@ -553,6 +553,9 @@ extern "C" {
 
 #define NETA_GMAC_CTRL_2_REG(p)             (NETA_REG_BASE(p) + 0x2C08)
 
+#define NETA_GMAC_PSC_ENABLE_BIT            3
+#define NETA_GMAC_PSC_ENABLE_MASK           (1 << NETA_GMAC_PSC_ENABLE_BIT)
+
 #define NETA_GMAC_PORT_RGMII_BIT            4
 #define NETA_GMAC_PORT_RGMII_MASK           (1 << NETA_GMAC_PORT_RGMII_BIT)
 
-- 
1.7.5.4

