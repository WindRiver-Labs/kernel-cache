From 24971990e025f0d44bdb827a5519243fec467d02 Mon Sep 17 00:00:00 2001
From: xigu <xigu@marvell.com>
Date: Mon, 24 Mar 2014 11:27:24 +0200
Subject: [PATCH 1495/1825] fix: alp: slic: timing issue which causes failure
 of calibration

https://github.com/MISL-EBU-System-SW/misl-windriver.git linux-3.4.69-14t2-read
commit 5cb87c631fb294142e6716baf8c3071435dc2f5c

Change-Id: I3279c927271168d3244e6857a2af4785d488f5a3
Signed-off-by: xigu <xigu@marvell.com>
Reviewed-on: http://vgitil04.il.marvell.com:8080/6621
Tested-by: Star_Automation <star@marvell.com>
Reviewed-by: Yehuda Yitschak <yehuday@marvell.com>
Signed-off-by: Zhong Hongbo <hongbo.zhong@windriver.com>
---
 .../mv_drivers_lsp/mv_phone/slic/sdd_if.c          |    4 +++-
 1 files changed, 3 insertions(+), 1 deletions(-)

diff --git a/arch/arm/plat-armada/mv_drivers_lsp/mv_phone/slic/sdd_if.c b/arch/arm/plat-armada/mv_drivers_lsp/mv_phone/slic/sdd_if.c
index f886f95..e410068 100644
--- a/arch/arm/plat-armada/mv_drivers_lsp/mv_phone/slic/sdd_if.c
+++ b/arch/arm/plat-armada/mv_drivers_lsp/mv_phone/slic/sdd_if.c
@@ -81,6 +81,7 @@ SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.
 #define	TIMER_CTRL		(MV_CPUIF_REGS_OFFSET(whoAmI()) + 0x40)
 #define  TIMER_EN(x)		(1 << (2 * x))
 #define  TIMER_RELOAD_EN(x)	(2 << (2 * x))
+#define  TIMER_25MHZ_EN(x)	(1 << (x + 11))
 #define TIMER_CAUSE		(MV_CPUIF_REGS_OFFSET(whoAmI()) + 0x68)
 #define  TIMER_INT_CLR(x)	(~(1 << (8 * x)))
 #define TIMER_RELOAD(x)		(MV_CPUIF_REGS_OFFSET(whoAmI()) + 0x50 + (8 * x))
@@ -95,6 +96,7 @@ SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.
 #define TIMER_CTRL		(MV_CNTMR_REGS_OFFSET + 0x0000)
 #define  TIMER_EN(x)		(1 << (2 * x))
 #define  TIMER_RELOAD_EN(x)	(2 << (2 * x))
+#define  TIMER_25MHZ_EN(x)	(1 << (x + 11))
 #define TIMER_CAUSE		(MV_CNTMR_REGS_OFFSET + 0x0004)
 #define  TIMER_INT_CLR(x)	(~(1 << (8 * x)))
 #define TIMER_RELOAD(x)		(MV_CNTMR_REGS_OFFSET + 0x0010 + (8 * x))
@@ -191,7 +193,7 @@ void sdd_if_timer_start(void)
 	unsigned long reg;
 
 	reg = MV_REG_READ(TIMER_CTRL);
-	reg |= TIMER_EN(DFEV_TIMER) | TIMER_RELOAD_EN(DFEV_TIMER);
+	reg |= TIMER_EN(DFEV_TIMER) | TIMER_RELOAD_EN(DFEV_TIMER) | TIMER_25MHZ_EN(DFEV_TIMER);
 	MV_REG_WRITE(TIMER_CTRL, reg);
 }
 EXPORT_SYMBOL(sdd_if_timer_start);
-- 
1.7.5.4

