From 11e9b90614c32fe57b4bf025e75de936e99f2448 Mon Sep 17 00:00:00 2001
From: kostap <kostap@marvell.com>
Date: Sun, 22 Jun 2014 14:27:08 +0300
Subject: [PATCH 1790/1825] fix: msys_ac3: Correct the CPU and DDR clock write
 function

https://github.com/MISL-EBU-System-SW/misl-windriver.git linux-3.4.69-14t2-read
commit 813528348b101652a4bed2a8e48db5d96ea7b1cb

    - Fix the mvBoardCpuFreqSet function for AC3 platform
    - Add entry to MV_CPU_DDR_CLK_TBL_AC3 for PLL bypass (7)

Change-Id: I1b3f9c35e8bb1134349bf11187e39a0eb39cc9df
Signed-off-by: kostap <kostap@marvell.com>
Reviewed-on: http://vgitil04.il.marvell.com:8080/8666
Reviewed-by: Omri Itach <omrii@marvell.com>
Tested-by: Omri Itach <omrii@marvell.com>
Reviewed-on: http://vgitil04.il.marvell.com:8080/9171
Tested-by: Star_Automation <star@marvell.com>
Signed-off-by: Zhong Hongbo <hongbo.zhong@windriver.com>
---
 .../mach-msys/msys_family/boardEnv/mvBoardEnvLib.c |    4 ++--
 .../mach-msys/msys_family/ctrlEnv/mvCtrlEnvRegs.h  |    1 +
 2 files changed, 3 insertions(+), 2 deletions(-)

diff --git a/arch/arm/mach-msys/msys_family/boardEnv/mvBoardEnvLib.c b/arch/arm/mach-msys/msys_family/boardEnv/mvBoardEnvLib.c
index bc6c649..32e6c4d 100644
--- a/arch/arm/mach-msys/msys_family/boardEnv/mvBoardEnvLib.c
+++ b/arch/arm/mach-msys/msys_family/boardEnv/mvBoardEnvLib.c
@@ -1424,8 +1424,8 @@ MV_STATUS mvBoardCpuFreqSet(MV_U8 freqVal)
 		if (MV_ERROR == mvBoardTwsiSatRGet(3, 0, &sar))
 			return MV_ERROR;
 
-		sar  &= ~(0x7 << 2);
-		sar  |= (freqVal & 0x7) << 2;
+		sar  &= ~(0x7);
+		sar  |= (freqVal & 0x7);
 
 		if (MV_OK != mvBoardTwsiSatRSet(3, 0, sar)) {
 			DB(mvOsPrintf("Board: Write CpuFreq S@R fail\n"));
diff --git a/arch/arm/mach-msys/msys_family/ctrlEnv/mvCtrlEnvRegs.h b/arch/arm/mach-msys/msys_family/ctrlEnv/mvCtrlEnvRegs.h
index 4e29b4a..c7f529a 100644
--- a/arch/arm/mach-msys/msys_family/ctrlEnv/mvCtrlEnvRegs.h
+++ b/arch/arm/mach-msys/msys_family/ctrlEnv/mvCtrlEnvRegs.h
@@ -349,6 +349,7 @@ typedef struct {
 		{   0,   0, MV_TRUE},	\
 		{ 800, 400, MV_FALSE},	\
 		{ 800, 400, MV_TRUE},	\
+		{ 0,     0, MV_TRUE}	\
 }
 
 #define MV_TM_CLK_TBL	{	\
-- 
1.7.5.4

