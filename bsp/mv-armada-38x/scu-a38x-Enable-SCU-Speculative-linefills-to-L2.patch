From 4b50d8e4eedb5283cd9c2e24114f2e8a7087b39a Mon Sep 17 00:00:00 2001
From: Yehuda Yitschak <yehuday@marvell.com>
Date: Sun, 9 Mar 2014 13:47:48 +0200
Subject: [PATCH 1479/1825] scu: a38x: Enable SCU Speculative linefills to L2

https://github.com/MISL-EBU-System-SW/misl-windriver.git linux-3.4.69-14t2-read
commit dfb04d11dab009bee9d54243bbf6fbb387ae0ad7

	When set, coherent linefill requests are sent speculatively to the L2C-310
	in parallel with the tag look-up. If the tag look-up misses, the confirmed
	linefill is sent to the L2C-310 and gets RDATA earlier because the data
	request was already initiated by the speculative request.

	This feature may improve overall system performance.

Change-Id: I794e6482ca8d1aa0f95635f2d480848dc7b74ee9
Signed-off-by: Yehuda Yitschak <yehuday@marvell.com>
Reviewed-on: http://vgitil04.il.marvell.com:8080/6257
Tested-by: Star_Automation <star@marvell.com>
Signed-off-by: Zhong Hongbo <hongbo.zhong@windriver.com>
---
 arch/arm/kernel/smp_scu.c |    3 +++
 arch/arm/mm/Kconfig       |   11 +++++++++++
 2 files changed, 14 insertions(+), 0 deletions(-)

diff --git a/arch/arm/kernel/smp_scu.c b/arch/arm/kernel/smp_scu.c
index e8fbfa3..3704c4f 100644
--- a/arch/arm/kernel/smp_scu.c
+++ b/arch/arm/kernel/smp_scu.c
@@ -54,6 +54,9 @@ void scu_enable(void __iomem *scu_base)
 		return;
 
 	scu_ctrl |= 1;
+#ifdef CONFIG_SCU_SPECULATIVE_LINEFILLS_ENABLE
+	scu_ctrl |= (1 << 3);
+#endif
 	writel_relaxed(scu_ctrl, scu_base + SCU_CTRL);
 
 	/*
diff --git a/arch/arm/mm/Kconfig b/arch/arm/mm/Kconfig
index 593f284..05948d1 100644
--- a/arch/arm/mm/Kconfig
+++ b/arch/arm/mm/Kconfig
@@ -822,6 +822,17 @@ config PL310_CACHE_PREF_ENABLE
 	  PL310 L2 cache prefetch-related features may improve
 	  overall system performance.
 
+config SCU_SPECULATIVE_LINEFILLS_ENABLE
+	bool "Enable SCU Speculative linefills to L2"
+	depends on CACHE_PL310 && HAVE_ARM_SCU
+	default y if ARCH_ARMADA38X
+	help
+	  Say Y here to enable SCU Speculative linefills to L2.
+	  If unsure, say N.
+	  When set, coherent linefill requests are sent speculatively
+	  to the L2C-310 in parallel with the tag look-up.
+	  This feature may improve overall system performance.
+
 config TLS_REG_EMUL
 	bool
 	help
-- 
1.7.5.4

