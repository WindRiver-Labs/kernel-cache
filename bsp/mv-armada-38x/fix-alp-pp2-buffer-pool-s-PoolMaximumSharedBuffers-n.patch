From d250def5e253c47edda9e08f8c95698bb105b91d Mon Sep 17 00:00:00 2001
From: Jing Hua <jinghua@marvell.com>
Date: Mon, 7 Jul 2014 10:43:07 +0800
Subject: [PATCH 1766/1825] fix: alp: pp2: buffer pool's
 PoolMaximumSharedBuffers number is not correct

https://github.com/MISL-EBU-System-SW/misl-windriver.git linux-3.4.69-14t2-read
commit adc9921cbfeb3f23292ff766cbfde5d53ccc4082

	when shared/guaranteed buffer number of QSet is updated, its buffer
	pool's PoolMaximumSharedBuffers number is updated not correctly.
	according to FS, it should be:
	PoolMaximumSharedBuffers = pool_buf_num - sum(guaranteed)
	but in code it is:
	PoolMaximumSharedBuffers = pool_buf_num + sum(guaranteed).
	SYSTEMSW-814 - <buffer pool's PoolMaximumSharedBuffers number is not correct>

Change-Id: Ic142d9ada340ddb613a892a6351c8969fbb25dfc
Signed-off-by: Jing Hua <jinghua@marvell.com>
Reviewed-on: http://vgitil04.il.marvell.com:8080/9005
Reviewed-by: Dmitri Epshtein <dima@marvell.com>
Reviewed-by: Uri Eliyahu <uriel@marvell.com>
Tested-by: Yehuda Yitschak <yehuday@marvell.com>
Signed-off-by: Zhong Hongbo <hongbo.zhong@windriver.com>
---
 arch/arm/plat-armada/mv_hal/pp2/bm/mvBm.c |    2 +-
 1 files changed, 1 insertions(+), 1 deletions(-)

diff --git a/arch/arm/plat-armada/mv_hal/pp2/bm/mvBm.c b/arch/arm/plat-armada/mv_hal/pp2/bm/mvBm.c
index 83f3f32..ede84ec 100644
--- a/arch/arm/plat-armada/mv_hal/pp2/bm/mvBm.c
+++ b/arch/arm/plat-armada/mv_hal/pp2/bm/mvBm.c
@@ -689,7 +689,7 @@ MV_STATUS mvBmQsetBuffMaxSet(int qset, int maxGrntd, int maxShared)
 	}
 
 	/* Update BM pool shared buffers num */
-	mvBmPoolBuffNumSet(pool, pBmPool->maxShared + delta);
+	mvBmPoolBuffNumSet(pool, pBmPool->maxShared - delta);
 
 	pQset->maxShared = maxShared;
 	pQset->maxGrntd = maxGrntd;
-- 
1.7.5.4

