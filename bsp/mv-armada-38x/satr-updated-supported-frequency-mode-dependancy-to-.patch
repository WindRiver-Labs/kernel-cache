From 9619e657b2832e9ad96b5b8491ee788cea5d19d7 Mon Sep 17 00:00:00 2001
From: Omri Itach <omrii@marvell.com>
Date: Tue, 13 Aug 2013 11:44:53 +0300
Subject: [PATCH 0956/1825] satr: updated supported frequency mode dependancy,
 to board ID

https://github.com/MISL-EBU-System-SW/misl-windriver.git linux-3.4.69-14t2-read
commit d3e5582e1b3ac1a8cc5baa9e7d17a9bd69a850e5

	Before, the supported frequency mode was dependant on SoC ID.
	This is wrong, because RD boards does not support altering frequency mode using S@R.
	we can't use the same supported freq modes for RD-6660 and also for DB-6660, even though they use the same SoC
	- changed dependency to be according to board ID, instead of SoC ID

Change-Id: I4f7cfe51231745fd9045f4181ce62761bda720c0
Signed-off-by: Omri Itach <omrii@marvell.com>
Reviewed-on: http://vgitil04.il.marvell.com:8080/3020
Reviewed-by: Kosta Zertsekel <konszert@marvell.com>
Tested-by: Star_Automation <star@marvell.com>
Signed-off-by: Zhong Hongbo <hongbo.zhong@windriver.com>
---
 .../avanta_lp_family/boardEnv/mvBoardEnvLib.c      |   26 +++++++++++++-------
 .../avanta_lp_family/ctrlEnv/mvCtrlEnvSpec.h       |    7 +++--
 2 files changed, 21 insertions(+), 12 deletions(-)

diff --git a/arch/arm/mach-avantalp/avanta_lp_family/boardEnv/mvBoardEnvLib.c b/arch/arm/mach-avantalp/avanta_lp_family/boardEnv/mvBoardEnvLib.c
index d7dfc2c..0cd13cd 100644
--- a/arch/arm/mach-avantalp/avanta_lp_family/boardEnv/mvBoardEnvLib.c
+++ b/arch/arm/mach-avantalp/avanta_lp_family/boardEnv/mvBoardEnvLib.c
@@ -1535,17 +1535,25 @@ MV_U32 mvBoardSwitchPortForceLinkGet(MV_U32 switchIdx)
 *******************************************************************************/
 MV_U32 mvBoardFreqModesNumGet()
 {
-	MV_U16 ctrlModel = mvCtrlModelGet();
+	MV_U32 freqNum;
 
-	if (ctrlModel == MV_6610_DEV_ID)
-		return FREQ_MODES_NUM_6610;
-	else if (ctrlModel == MV_6650_DEV_ID)
-		return FREQ_MODES_NUM_6650;
-	else if (ctrlModel == MV_6660_DEV_ID)
-		return FREQ_MODES_NUM_6660;
+	switch (mvBoardIdGet()) {
+	case DB_6650_ID:
+		freqNum = FREQ_MODES_NUM_DB_6650;
+		break;
+	case DB_6660_ID:
+		freqNum = FREQ_MODES_NUM_DB_6660;
+		break;
+	case RD_6650_ID:
+	case RD_6660_ID:
+		freqNum = FREQ_MODES_NUM_RD_66X0;
+		break;
+	default:
+		mvOsPrintf("%s: Error: IO Expander doesn't exists on board\n", __func__);
+		return MV_ERROR;
+	}
 
-	mvOsPrintf("%s: Error: Illegal ctrl Model (%x)\n", __func__, ctrlModel);
-	return MV_ERROR;
+	return freqNum;
 }
 
 
diff --git a/arch/arm/mach-avantalp/avanta_lp_family/ctrlEnv/mvCtrlEnvSpec.h b/arch/arm/mach-avantalp/avanta_lp_family/ctrlEnv/mvCtrlEnvSpec.h
index 56df8e5..987a248 100755
--- a/arch/arm/mach-avantalp/avanta_lp_family/ctrlEnv/mvCtrlEnvSpec.h
+++ b/arch/arm/mach-avantalp/avanta_lp_family/ctrlEnv/mvCtrlEnvSpec.h
@@ -260,9 +260,10 @@ extern "C" {
 
 #define TBL_UNUSED      0       /* Used to mark unused entry */
 #define FREQ_MODES_NUM		29
-#define FREQ_MODES_NUM_6610	1
-#define FREQ_MODES_NUM_6650	3
-#define FREQ_MODES_NUM_6660	4
+#define FREQ_MODES_NUM_RD_66X0	0
+#define FREQ_MODES_NUM_DB_6650	3
+#define FREQ_MODES_NUM_DB_6660	4
+
 
 #define MPP_GROUP_0_TYPE { \
 	0x55555555,     /* NAND_V2_BOOT_DEVICE  */ \
-- 
1.7.5.4

