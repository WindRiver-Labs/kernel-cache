From ed914c6068aeefa64cfc5604efe1da23eab157c0 Mon Sep 17 00:00:00 2001
From: Tawfik Bayouk <tawfik@marvell.com>
Date: Tue, 21 Aug 2012 17:35:54 +0300
Subject: [PATCH 0205/1825] Fix compilation errors in PPPoE NFP hooks

https://github.com/MISL-EBU-System-SW/misl-windriver.git linux-3.4.69-14t2-read
commit 5589806375c79b3e8ed2beb93d354b3a81aeb402

Change-Id: I00c6d257c6e8af3d62a32623671b364c8663aab4
Signed-off-by: Tawfik Bayouk <tawfik@marvell.com>
Signed-off-by: Kosta Zertsekel <konszert@marvell.com>
Signed-off-by: Zhong Hongbo <hongbo.zhong@windriver.com>
---
 drivers/net/ppp/ppp_generic.c |    1 +
 drivers/net/ppp/pppoe.c       |   13 ++++++++-----
 2 files changed, 9 insertions(+), 5 deletions(-)

diff --git a/drivers/net/ppp/ppp_generic.c b/drivers/net/ppp/ppp_generic.c
index ce9e6c1..bfb62cc 100644
--- a/drivers/net/ppp/ppp_generic.c
+++ b/drivers/net/ppp/ppp_generic.c
@@ -51,6 +51,7 @@
 #include <linux/atomic.h>
 
 #include <linux/nsproxy.h>
+#include <linux/mv_nfp.h>
 #include <net/net_namespace.h>
 #include <net/netns/generic.h>
 
diff --git a/drivers/net/ppp/pppoe.c b/drivers/net/ppp/pppoe.c
index 86ad69c..7c921f0 100644
--- a/drivers/net/ppp/pppoe.c
+++ b/drivers/net/ppp/pppoe.c
@@ -79,6 +79,8 @@
 #include <linux/seq_file.h>
 
 #include <linux/nsproxy.h>
+#include <linux/mv_nfp.h>
+
 #include <net/net_namespace.h>
 #include <net/netns/generic.h>
 #include <net/sock.h>
@@ -589,14 +591,15 @@ static int pppoe_release(struct socket *sock)
 	net = sock_net(sk);
 	pn = pppoe_pernet(net);
 
+#if defined(CONFIG_MV_ETH_NFP_LEARN) || defined(CONFIG_MV_ETH_NFP_LEARN_MODULE)
+	if (nfp_mgr_p->nfp_hook_ppp_info_del)
+		nfp_mgr_p->nfp_hook_ppp_info_del((u32)&po->chan);
+#endif /* CONFIG_MV_ETH_NFP_LEARN || CONFIG_MV_ETH_NFP_LEARN_MODULE */
+
 	/*
 	 * protect "po" from concurrent updates
 	 * on pppoe_flush_dev
 	 */
-#if defined(CONFIG_MV_ETH_NFP_LEARN) || defined(CONFIG_MV_ETH_NFP_LEARN_MODULE)
-	f (nfp_mgr_p->nfp_hook_ppp_info_del)
-		p_mgr_p->nfp_hook_ppp_info_del((u32)&po->chan);
-#endif
 
 	delete_item(pn, po->pppoe_pa.sid, po->pppoe_pa.remote,
 		    po->pppoe_ifindex);
@@ -701,7 +704,7 @@ static int pppoe_connect(struct socket *sock, struct sockaddr *uservaddr,
 
 #if defined(CONFIG_MV_ETH_NFP_LEARN) || defined(CONFIG_MV_ETH_NFP_LEARN_MODULE)
 	if (nfp_mgr_p->nfp_hook_ppp_half_set)
-		p_mgr_p->nfp_hook_ppp_half_set(sp->sa_addr.pppoe.sid, (u32)&po->chan, dev, po->pppoe_pa.remote);
+		nfp_mgr_p->nfp_hook_ppp_half_set(sp->sa_addr.pppoe.sid, (u32)&po->chan, dev, po->pppoe_pa.remote);
 #endif /* CONFIG_MV_ETH_NFP_LEARN || CONFIG_MV_ETH_NFP_LEARN_MODULE */
 
 	}
-- 
1.7.5.4

