From 96e657defc387262eec0bf4a358494013563c6d5 Mon Sep 17 00:00:00 2001
From: Victor Gu <xigu@marvell.com>
Date: Thu, 8 May 2014 16:39:30 +0800
Subject: [PATCH 1644/1825] alp: ppv2: restore the code to support
 non-promiscous GBE port mode

https://github.com/MISL-EBU-System-SW/misl-windriver.git linux-3.4.69-14t2-read
commit 7fc5ef2691b9b8746a2e0714e11f3d80c523c6d1

    In non-promiscous, all unknown unicast and multicast packet will
be dropped.
Signed-off-by: Victor Gu <xigu@marvell.com>

Change-Id: I18004d91b1499ff81ee761da829889d697ce3ab4
Reviewed-on: http://vgitil04.il.marvell.com:8080/7882
Tested-by: Star_Automation <star@marvell.com>
Reviewed-by: Uri Eliyahu <uriel@marvell.com>
Reviewed-by: Dmitri Epshtein <dima@marvell.com>
Signed-off-by: Zhong Hongbo <hongbo.zhong@windriver.com>
---
 arch/arm/plat-armada/mv_hal/pp2/prs/mvPp2Prs.c |   10 +++++-----
 1 files changed, 5 insertions(+), 5 deletions(-)

diff --git a/arch/arm/plat-armada/mv_hal/pp2/prs/mvPp2Prs.c b/arch/arm/plat-armada/mv_hal/pp2/prs/mvPp2Prs.c
index 0aabb58..ea5f1c5 100644
--- a/arch/arm/plat-armada/mv_hal/pp2/prs/mvPp2Prs.c
+++ b/arch/arm/plat-armada/mv_hal/pp2/prs/mvPp2Prs.c
@@ -1054,12 +1054,11 @@ static int mvPp2PrsMacInit(void)
 	/* Non-promiscous mode for all ports - DROP unknown packets */
 	pe.index = PE_MAC_NON_PROMISCOUS;
 	mvPp2PrsSwTcamLuSet(&pe, PRS_LU_MAC);
-	/*	mvPp2PrsSwSramRiSetBit(&pe, RI_DROP_BIT); */
-	/*	mvPp2PrsSwSramLuDoneSet(&pe);*/
+	mvPp2PrsSwSramRiSetBit(&pe, RI_DROP_BIT);
+	/* mvPp2PrsSwSramLuDoneSet(&pe);*/
 
-	/*	mvPp2PrsSwSramFlowidGenSet(&pe);*/
-	mvPp2PrsSwSramNextLuSet(&pe, PRS_LU_DSA);
-	mvPp2PrsSwSramShiftSet(&pe, 2 * MV_MAC_ADDR_SIZE, SRAM_OP_SEL_SHIFT_ADD);
+	mvPp2PrsSwSramFlowidGenSet(&pe);
+	mvPp2PrsSwSramNextLuSet(&pe, PRS_LU_FLOWS);
 
 	/* Update mvPrsShadowTbl */
 	mvPp2PrsShadowSet(pe.index, PRS_LU_MAC, "non-promisc");
@@ -1070,6 +1069,7 @@ static int mvPp2PrsMacInit(void)
 	/* place holders only - no ports */
 	mvPrsMacDropAllSet(0, 0);
 	mvPrsMacPromiscousSet(0, 0);
+	mvPrsMacAllMultiSet(0, 0);
 
 	return MV_OK;
 }
-- 
1.7.5.4

