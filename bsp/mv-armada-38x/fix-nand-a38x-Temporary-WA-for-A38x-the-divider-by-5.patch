From 1b40c7200a1102795e3f89241421ecbbe4e3f02e Mon Sep 17 00:00:00 2001
From: Eli Nidam <elini@marvell.com>
Date: Wed, 8 Jan 2014 16:20:22 +0200
Subject: [PATCH 1279/1825] fix: nand: a38x: Temporary WA for A38x: the
 divider by 5 is not stable

https://github.com/MISL-EBU-System-SW/misl-windriver.git linux-3.4.69-14t2-read
commit f904a995da8c2d58adb5b2313b7642c60548bc44

	Temorary divider by 4  is used

Change-Id: Ia4f2df788fa6a5b1301f54bff6ac31995a88c79b
Signed-off-by: Eli Nidam <elini@marvell.com>
Reviewed-on: http://vgitil04.il.marvell.com:8080/5056
Reviewed-by: Omri Itach <omrii@marvell.com>
Tested-by: Star_Automation <star@marvell.com>
Signed-off-by: Zhong Hongbo <hongbo.zhong@windriver.com>
---
 .../armada_38x_family/ctrlEnv/mvCtrlEnvLib.c       |    2 ++
 1 files changed, 2 insertions(+), 0 deletions(-)

diff --git a/arch/arm/mach-armada38x/armada_38x_family/ctrlEnv/mvCtrlEnvLib.c b/arch/arm/mach-armada38x/armada_38x_family/ctrlEnv/mvCtrlEnvLib.c
index 74d8142..38c1da8 100644
--- a/arch/arm/mach-armada38x/armada_38x_family/ctrlEnv/mvCtrlEnvLib.c
+++ b/arch/arm/mach-armada38x/armada_38x_family/ctrlEnv/mvCtrlEnvLib.c
@@ -1658,6 +1658,8 @@ MV_U32 mvCtrlGetJuncTemp(MV_VOID)
 *******************************************************************************/
 void mvCtrlNandClkSet(int nClock)
 {
+	if (nClock == 5)     /* Temporary WA for A38x: the divider by 5 is not stable */
+		nClock = 4;   /* Temorary divider by 4  is used */
 	/* Set the division ratio of ECC Clock 0x00018748[13:8] (by default it's double of core clock) */
 	MV_U32 nVal = MV_REG_READ(CORE_DIV_CLK_CTRL(1));
 	nVal &= ~(NAND_ECC_DIVCKL_RATIO_MASK);
-- 
1.7.5.4

