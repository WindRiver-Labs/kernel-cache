From f645b3d2fe1592e8a01bd62b49c59750f25d1c74 Mon Sep 17 00:00:00 2001
From: Nadav Haklai <nadavh@marvell.com>
Date: Tue, 9 Apr 2013 11:33:55 +0300
Subject: [PATCH 0544/1825] AXP, HAL: Introduce new way of accessing device
 registers and adjust drivers.

https://github.com/MISL-EBU-System-SW/misl-windriver.git linux-3.4.69-14t2-read
commit c02988f022c483cf21bbe91a93c12ef849991c7d

- Each device supported by HAL-based driver has it's own unique devID
  Definitions of base registers are now redefined to devID.
  During driver's probe, ioremapped registers' VA is passed to the
  array containing registers' VAs per device if the driver matches the one
  defined in table of device supported by HAL driver. Match process is
  perfomed basing on 'compatible' property.
  When write or read is issued then the passed devID + offset are
  decoded to proper address acquired from the higher level driver.
- Adjust NFC driver to support the method.

Change-Id: I466836d250ae4f5c4c7af246ca96c560fe430a36
Signed-off-by: Zbigniew Bodek <zbb@semihalf.com>
Signed-off-by: Nadav Haklai <nadavh@marvell.com>
Reviewed-on: http://vgitil04.il.marvell.com:8080/1488
Reviewed-by: Shadi Ammouri <shadi@marvell.com>
Tested-by: Shadi Ammouri <shadi@marvell.com>
Signed-off-by: Zhong Hongbo <hongbo.zhong@windriver.com>
---
 arch/arm/plat-armada/mv_hal/nfc/mvNfc.h     |    4 ++++
 arch/arm/plat-armada/mv_hal/nfc/mvNfcRegs.h |    2 ++
 2 files changed, 6 insertions(+), 0 deletions(-)

diff --git a/arch/arm/plat-armada/mv_hal/nfc/mvNfc.h b/arch/arm/plat-armada/mv_hal/nfc/mvNfc.h
index 5d7e9e5..227127d 100644
--- a/arch/arm/plat-armada/mv_hal/nfc/mvNfc.h
+++ b/arch/arm/plat-armada/mv_hal/nfc/mvNfc.h
@@ -144,8 +144,12 @@ SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.
 extern "C" {
 #endif
 
+#if !defined(CONFIG_OF)
 #include "ctrlEnv/mvCtrlEnvSpec.h"
 #include "mvSysNfcConfig.h"
+#else
+#include "mvSysHwConfig.h"
+#endif
 
 /********************************/
 /* Enums and structures 	*/
diff --git a/arch/arm/plat-armada/mv_hal/nfc/mvNfcRegs.h b/arch/arm/plat-armada/mv_hal/nfc/mvNfcRegs.h
index 213b0ce..63adcb1 100644
--- a/arch/arm/plat-armada/mv_hal/nfc/mvNfcRegs.h
+++ b/arch/arm/plat-armada/mv_hal/nfc/mvNfcRegs.h
@@ -69,7 +69,9 @@ SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.
 extern "C" {
 #endif
 
+#if !defined(CONFIG_OF)
 #include "mvSysNfcConfig.h"
+#endif
 
 /* NAND Flash Control Register */
 #define	NFC_CONTROL_REG			(MV_NFC_REGS_BASE + 0x0)
-- 
1.7.5.4

