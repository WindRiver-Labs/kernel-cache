From 6b3e6136e435d65ae7e21d2144a6ecc1e008469d Mon Sep 17 00:00:00 2001
From: Yehuda Yitschak <yehuday@marvell.com>
Date: Thu, 15 Aug 2013 14:17:36 +0300
Subject: [PATCH 0971/1825] usb: a375: Initial USB2 support

https://github.com/MISL-EBU-System-SW/misl-windriver.git linux-3.4.69-14t2-read
commit 90f6e26520cd5b202256540a032a62f3a17ed9ed

	This patch adds initial USB2 support for armada 375.
	It includes a new PHY initialization routine and a
	code that enables using either legacy USB2 or new
	USB3 IP.

Change-Id: I06a733c2b245725bacbc6f42efc09dcbfcafcff3
Signed-off-by: Yehuda Yitschak <yehuday@marvell.com>
Reviewed-on: http://vgitil04.il.marvell.com:8080/3050
Reviewed-by: Nadav Haklai <nadavh@marvell.com>
Tested-by: Nadav Haklai <nadavh@marvell.com>
Signed-off-by: Zhong Hongbo <hongbo.zhong@windriver.com>
---
 arch/arm/plat-armada/mv_hal/usb/mvUsb.c |    7 ++++---
 1 files changed, 4 insertions(+), 3 deletions(-)

diff --git a/arch/arm/plat-armada/mv_hal/usb/mvUsb.c b/arch/arm/plat-armada/mv_hal/usb/mvUsb.c
index 4e92b71..9c5c080 100755
--- a/arch/arm/plat-armada/mv_hal/usb/mvUsb.c
+++ b/arch/arm/plat-armada/mv_hal/usb/mvUsb.c
@@ -228,10 +228,12 @@ MV_STATUS mvUsbPhy40nmLpInit(int dev)
 	/* Check if the PHY is ready */
 	regVal = MV_REG_READ(MV_USB_PHY_CHANNEL_REG(dev, 2));
 	if ((regVal & BIT15) == 0) {
-		mvOsPrintf("Error: USB2 Phy NOT ready\n");
+		mvOsPrintf("Error: USB2 UTMI PHY not ready\n");
 		return MV_NOT_READY;
 	}
 
+	mvOsPrintf("USB2 UTMI PHY initialized succesfully\n");
+
 	return MV_OK;
 }
 
@@ -808,7 +810,7 @@ MV_STATUS mvUsbUtmiPhyInit(int dev, MV_USB_HAL_DATA *usbHalData)
 
 		mvUsbPhy65nmNewInit(dev);
 
-	} else if ((usbHalData->ctrlFamily == MV_67XX) ||
+	} else if ((usbHalData->ctrlModel == MV_6710_DEV_ID) ||
 		(usbHalData->ctrlFamily == MV_78XX0)) {
 
 		if (mvUsbPhy40nmInit(dev))
@@ -816,7 +818,6 @@ MV_STATUS mvUsbUtmiPhyInit(int dev, MV_USB_HAL_DATA *usbHalData)
 
 	} else if ((usbHalData->ctrlFamily == MV_88F66X0) ||
 		   (usbHalData->ctrlFamily == MV_88F67X0)) {
-
 		status = mvUsbPhy40nmLpInit(dev);
 
 	} else
-- 
1.7.5.4

