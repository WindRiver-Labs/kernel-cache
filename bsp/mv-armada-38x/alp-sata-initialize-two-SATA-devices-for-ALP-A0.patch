From 91de5f143b03ccb90f5138a16ced9e753e94a366 Mon Sep 17 00:00:00 2001
From: Joe Zhou <shjzhou@marvell.com>
Date: Tue, 18 Feb 2014 14:10:17 +0800
Subject: [PATCH 1375/1825] alp: sata: initialize two SATA devices for ALP A0

https://github.com/MISL-EBU-System-SW/misl-windriver.git linux-3.4.69-14t2-read
commit 5f803895a933f4acb1d766d4c1942c06887e2b08

	The number of SATA port was hardcoded to 1
	Correction: get the correct SATA port number before initialization

Signed-off-by: Joe Zhou <shjzhou@marvell.com>

Change-Id: I44156ad23b13ccb057d3f12fbd7dd4b96123caba
Reviewed-on: http://vgitil04.il.marvell.com:8080/5756
Reviewed-by: Yehuda Yitschak <yehuday@marvell.com>
Tested-by: Star_Automation <star@marvell.com>
Signed-off-by: Zhong Hongbo <hongbo.zhong@windriver.com>
---
 arch/arm/mach-avantalp/core.c |    7 +++++--
 1 files changed, 5 insertions(+), 2 deletions(-)

diff --git a/arch/arm/mach-avantalp/core.c b/arch/arm/mach-avantalp/core.c
index 2e46d06..6ae2c24 100644
--- a/arch/arm/mach-avantalp/core.c
+++ b/arch/arm/mach-avantalp/core.c
@@ -1073,8 +1073,11 @@ static void __init alp_sata_init(void)
 	if (mvUnitMapIsMine(SATA) != MV_TRUE)
 		return;
 
-	alp_sata.dev.platform_data = &alp_sata_data;
-	platform_device_register(&alp_sata);
+	alp_sata_data.n_ports = mvCtrlSataMaxPortGet();
+	if (alp_sata_data.n_ports > 0) {
+		alp_sata.dev.platform_data = &alp_sata_data;
+		platform_device_register(&alp_sata);
+	}
 #endif
 }
 
-- 
1.7.5.4

