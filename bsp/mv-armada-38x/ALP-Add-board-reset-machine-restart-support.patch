From cc4630edcdca4de4ff25d13f247177c5f5532b76 Mon Sep 17 00:00:00 2001
From: Kosta Zertsekel <konszert@marvell.com>
Date: Wed, 20 Mar 2013 20:29:12 +0200
Subject: [PATCH 0540/1825] ALP: Add board reset (machine restart) support

https://github.com/MISL-EBU-System-SW/misl-windriver.git linux-3.4.69-14t2-read
commit 4803545f261ab2bfc2b47fd27e57b12ca5604627

Signed-off-by: Kosta Zertsekel <konszert@marvell.com>
Change-Id: I5557a0d2f6fcc39076666ed96e8ed606f14d3a61
Reviewed-on: http://vgitil04.il.marvell.com:8080/1495
Reviewed-by: Eran Ben-Avi <benavi@marvell.com>
Tested-by: Eran Ben-Avi <benavi@marvell.com>
Signed-off-by: Zhong Hongbo <hongbo.zhong@windriver.com>
---
 arch/arm/mach-avantalp/core.c                |   10 ++++++++++
 arch/arm/mach-avantalp/include/mach/system.h |   17 -----------------
 2 files changed, 10 insertions(+), 17 deletions(-)

diff --git a/arch/arm/mach-avantalp/core.c b/arch/arm/mach-avantalp/core.c
index 61415ff..e621ae7 100755
--- a/arch/arm/mach-avantalp/core.c
+++ b/arch/arm/mach-avantalp/core.c
@@ -852,6 +852,15 @@ static void __init alp_fpga_init(void)
 }
 }
 
+static void alp_restart(char mode, const char *cmd)
+{
+	printk("Reseting...\n");
+	mvBoardReset();
+
+	/* This should never be reached */
+	while (1);
+}
+
 extern void __init alp_init_irq(void);
 
 MACHINE_START(AVANTA_LP_FPGA, "Marvell Avanta LP FPGA Board")
@@ -861,4 +870,5 @@ MACHINE_START(AVANTA_LP_FPGA, "Marvell Avanta LP FPGA Board")
 	.timer		= &alp_timer,
 	.handle_irq	= gic_handle_irq,
 	.init_machine	= alp_fpga_init,
+	.restart	= alp_restart,
 MACHINE_END
diff --git a/arch/arm/mach-avantalp/include/mach/system.h b/arch/arm/mach-avantalp/include/mach/system.h
index 50087a6..4913f0f 100644
--- a/arch/arm/mach-avantalp/include/mach/system.h
+++ b/arch/arm/mach-avantalp/include/mach/system.h
@@ -7,11 +7,6 @@
 #ifndef __MACH_SYSTEM_H
 #define __MACH_SYSTEM_H
 
-#include <asm/proc-fns.h>
-#include <mach/hardware.h>
-
-#include "boardEnv/mvBoardEnvLib.h"
-
 #ifdef CONFIG_MV_SUPPORT_64KB_PAGE_SIZE
 #define LSP_PG_SZ_VER  " (Large Page)"
 #else
@@ -20,16 +15,4 @@
 
 #define LSP_VERSION "linux-3.4.y-2013_Q2.0_eng_drop" LSP_PG_SZ_VER
 
-static inline void arch_idle(void)
-{
-	cpu_do_idle();
-}
-
-static inline void arch_reset(char mode, const char *cmd)
-{
-	printk("Reseting...\n");
-	mvBoardReset();
-	while (1);/* This should never be reached */
-}
-
 #endif /* __MACH_SYSTEM_H */
-- 
1.7.5.4

