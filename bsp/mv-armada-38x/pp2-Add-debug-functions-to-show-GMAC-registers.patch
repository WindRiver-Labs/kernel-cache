From 8a2c8976711fdb4e777aca75912500ca263138c4 Mon Sep 17 00:00:00 2001
From: Dmitri Epshtein <dima@marvell.com>
Date: Thu, 24 Oct 2013 09:35:35 -0400
Subject: [PATCH 1049/1825] pp2: Add debug functions to show GMAC registers

https://github.com/MISL-EBU-System-SW/misl-windriver.git linux-3.4.69-14t2-read
commit 25edd16bf509eadd2d3499666fd1c37160fbdb82

Signed-off-by: Dmitri Epshtein <dima@marvell.com>

Change-Id: Ifbf2d9c428fede175c8f91d41aa9d8c2ad81d4b2
Reviewed-on: http://vgitil04.il.marvell.com:8080/3840
Reviewed-by: Jonatan Farhadian <yonif@marvell.com>
Tested-by: Star_Automation <star@marvell.com>
Signed-off-by: Zhong Hongbo <hongbo.zhong@windriver.com>
---
 .../arm/plat-armada/mv_hal/pp2/gmac/mvEthGmacApi.c |   42 ++++++++++++++++++++
 .../arm/plat-armada/mv_hal/pp2/gmac/mvEthGmacApi.h |    2 +
 2 files changed, 44 insertions(+), 0 deletions(-)

diff --git a/arch/arm/plat-armada/mv_hal/pp2/gmac/mvEthGmacApi.c b/arch/arm/plat-armada/mv_hal/pp2/gmac/mvEthGmacApi.c
index 7cf4206ac..74344b4 100644
--- a/arch/arm/plat-armada/mv_hal/pp2/gmac/mvEthGmacApi.c
+++ b/arch/arm/plat-armada/mv_hal/pp2/gmac/mvEthGmacApi.c
@@ -620,6 +620,48 @@ int mvEthPhyAddrGet(int port)
 	return ((regData & ETH_PHY_ADDR_MASK(port)) >> ETH_PHY_ADDR_OFFS(port));
 }
 
+void mvGmacPrintReg(unsigned int reg_addr, char *reg_name)
+{
+	mvOsPrintf("  %-32s: 0x%x = 0x%08x\n", reg_name, reg_addr, MV_REG_READ(reg_addr));
+}
+
+void mvGmacLmsRegs(void)
+{
+	mvOsPrintf("\n[GoP LMS registers]\n");
+
+	mvGmacPrintReg(ETH_PHY_ADDR_REG, "MV_GOP_LMS_PHY_ADDR_REG");
+	mvGmacPrintReg(ETH_PHY_AN_CFG0_REG, "MV_GOP_LMS_PHY_AN_CFG0_REG");
+}
+
+void mvGmacPortRegs(int port)
+{
+	if (mvPp2PortCheck(port))
+		return;
+
+	if (MV_PON_PORT(port)) {
+		mvOsPrintf("Not supported for PON port\n");
+		return;
+	}
+
+	port = MV_PPV2_PORT_PHYS(port);
+
+	mvOsPrintf("\n[GoP MAC #%d registers]\n", port);
+
+	mvGmacPrintReg(ETH_GMAC_CTRL_0_REG(port), "MV_GMAC_CTRL_0_REG");
+	mvGmacPrintReg(ETH_GMAC_CTRL_1_REG(port), "MV_GMAC_CTRL_1_REG");
+	mvGmacPrintReg(ETH_GMAC_CTRL_2_REG(port), "MV_GMAC_CTRL_2_REG");
+
+	mvGmacPrintReg(ETH_GMAC_AN_CTRL_REG(port), "MV_GMAC_AN_CTRL_REG");
+	mvGmacPrintReg(ETH_GMAC_STATUS_REG(port), "MV_GMAC_STATUS_REG");
+
+	mvGmacPrintReg(GMAC_PORT_FIFO_CFG_0_REG(port), "MV_GMAC_PORT_FIFO_CFG_0_REG");
+	mvGmacPrintReg(GMAC_PORT_FIFO_CFG_1_REG(port), "MV_GMAC_PORT_FIFO_CFG_1_REG");
+
+	mvGmacPrintReg(ETH_PORT_ISR_CAUSE_REG(port), "MV_GMAC_ISR_CAUSE_REG");
+	mvGmacPrintReg(ETH_PORT_ISR_MASK_REG(port), "MV_GMAC_ISR_MASK_REG");
+}
+
+
 /******************************************************************************/
 /*                      MIB Counters functions                                */
 /******************************************************************************/
diff --git a/arch/arm/plat-armada/mv_hal/pp2/gmac/mvEthGmacApi.h b/arch/arm/plat-armada/mv_hal/pp2/gmac/mvEthGmacApi.h
index 30c83f8..44021c6 100644
--- a/arch/arm/plat-armada/mv_hal/pp2/gmac/mvEthGmacApi.h
+++ b/arch/arm/plat-armada/mv_hal/pp2/gmac/mvEthGmacApi.h
@@ -175,5 +175,7 @@ int mvEthPhyAddrGet(int port);
 MV_U32 mvEthMibCounterRead(int port, unsigned int mibOffset, MV_U32 *pHigh32);
 void mvEthMibCountersClear(int port);
 void mvEthMibCountersShow(int port);
+void mvGmacPortRegs(int port);
+void mvGmacLmsRegs(void);
 
 #endif /* __mvEthGmac_h__ */
-- 
1.7.5.4

