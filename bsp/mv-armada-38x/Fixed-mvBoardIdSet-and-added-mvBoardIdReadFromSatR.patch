From 6c4a75fe74fc913e4281438cdb8cd1f92e25f5fb Mon Sep 17 00:00:00 2001
From: Omri Itach <omrii@marvell.com>
Date: Wed, 13 Mar 2013 14:39:57 +0200
Subject: [PATCH 0487/1825] - Fixed mvBoardIdSet - and added
 mvBoardIdReadFromSatR

https://github.com/MISL-EBU-System-SW/misl-windriver.git linux-3.4.69-14t2-read
commit 0461a87e8d39a792084b71e3cbfa795b0572ed7b

- removed mvBoardIsOurPciSlot from mvBoardEnvlib (exists already in pci-if HAL)

Change-Id: Ic74df7f7335744d266055992f910b9f54a88c6c2
Reviewed-on: http://vgitil04.il.marvell.com:8080/1275
Reviewed-by: Eran Ben-Avi <benavi@marvell.com>
Tested-by: Eran Ben-Avi <benavi@marvell.com>
Signed-off-by: Zhong Hongbo <hongbo.zhong@windriver.com>
---
 .../avanta_lp_family/boardEnv/mvBoardEnvLib.c      |   26 ++++---------------
 1 files changed, 6 insertions(+), 20 deletions(-)

diff --git a/arch/arm/mach-avantalp/avanta_lp_family/boardEnv/mvBoardEnvLib.c b/arch/arm/mach-avantalp/avanta_lp_family/boardEnv/mvBoardEnvLib.c
index a92954a..22d04e0 100755
--- a/arch/arm/mach-avantalp/avanta_lp_family/boardEnv/mvBoardEnvLib.c
+++ b/arch/arm/mach-avantalp/avanta_lp_family/boardEnv/mvBoardEnvLib.c
@@ -683,24 +683,6 @@ MV_32 mvBoardUSBVbusEnGpioPinGet(MV_32 devId)
 	return mvBoarGpioPinNumGet(BOARD_GPP_USB_VBUS_EN, devId);
 }
 
-#ifdef CONFIG_MACH_AVANTA_LP_FPGA
-MV_BOOL mvBoardIsOurPciSlot(MV_U32 busNum, MV_U32 slotNum)
-{
-	MV_U32 localBusNum = mvPciLocalBusNumGet(PCI_DEFAULT_IF);
-
-	/* Our device number */
-	if (slotNum == mvPciLocalDevNumGet(PCI_DEFAULT_IF))
-		return MV_TRUE;
-
-	if (localBusNum != busNum) {
-		DB(mvOsPrintf("%s:: localBusNum %x != busNum %x.\n",
-			      __func__, localBusNum, busNum));
-		return MV_FALSE;
-	}
-
-	return MV_FALSE;
-}
-#endif
 /*******************************************************************************
 * mvBoardGpioIntMaskGet - Get GPIO mask for interrupt pins
 *
@@ -1653,12 +1635,16 @@ MV_32 mvBoardNandWidthGet(void)
 MV_U32 mvBoardIdReadFromSatR(void)
 {
 	MV_U32 boardId;
+	MV_BOARD_SAR_INFO sInfo;
+	MV_U8 tempVal;
 
 #ifdef CONFIG_MACH_AVANTA_LP_FPGA
 	boardId = MV_BOARD_ID_AVANTA_LP_FPGA;
 #else
-	boardId = MV_REG_READ(MPP_SAMPLE_AT_RESET(1);
-	boardId &= (boardId & SAR1_BOARD_ID_MASK) >> SAR1_BOARD_ID_OFFSET;
+	if ( MV_OK == mvBoardSarInfoGet(MV_SATR_BOARD_ID, &sInfo)) {
+		tempVal = MV_REG_READ(MPP_SAMPLE_AT_RESET(sInfo.regNum));
+		boardId = ((tempVal & (sInfo.mask)) >> sInfo.offset);
+	}
 #endif
 
 	if (boardId >= MV_MAX_BOARD_ID) {
-- 
1.7.5.4

