From a5c0f35806dff3ecfc1c9448984f952ea60f6e3f Mon Sep 17 00:00:00 2001
From: Kosta Zertsekel <konszert@marvell.com>
Date: Mon, 20 May 2013 17:41:59 +0300
Subject: [PATCH 0660/1825] ALP: EthComp: Update MAC0 and MAC1 PHY address

https://github.com/MISL-EBU-System-SW/misl-windriver.git linux-3.4.69-14t2-read
commit 1c951cf3b3d19cab65bef2a63d0cc02b3c20f69c

Signed-off-by: Kosta Zertsekel <konszert@marvell.com>
Change-Id: I552fb03e2d5d42e76e82e53390a894dbdcae2b93
Reviewed-on: http://vgitil04.il.marvell.com:8080/1878
Reviewed-by: Omri Itach <omrii@marvell.com>
Reviewed-by: Star_Automation <star@marvell.com>
Reviewed-by: Eran Ben-Avi <benavi@marvell.com>
Tested-by: Eran Ben-Avi <benavi@marvell.com>
Signed-off-by: Zhong Hongbo <hongbo.zhong@windriver.com>
---
 .../avanta_lp_family/ctrlEnv/mvCtrlEthCompLib.c    |    6 ++++--
 1 files changed, 4 insertions(+), 2 deletions(-)

diff --git a/arch/arm/mach-avantalp/avanta_lp_family/ctrlEnv/mvCtrlEthCompLib.c b/arch/arm/mach-avantalp/avanta_lp_family/ctrlEnv/mvCtrlEthCompLib.c
index 46606df..69ed9ad 100755
--- a/arch/arm/mach-avantalp/avanta_lp_family/ctrlEnv/mvCtrlEthCompLib.c
+++ b/arch/arm/mach-avantalp/avanta_lp_family/ctrlEnv/mvCtrlEthCompLib.c
@@ -379,6 +379,7 @@ static void mvEthComplexMacToGbePhy(MV_U32 port, MV_U32 phy, MV_U32 phyAddr)
 	mvEthComplexGbePhyResetSet(MV_FALSE);
 	mvEthComplexComPhySelectorSet(2, 0x1);
 	mvEthComplexGopInit(port, MV_FALSE, MV_FALSE, MV_TRUE);
+	mvEthPhyAddrSet(port, phy);
 }
 
 static void mvEthComplexMacToComPhy(MV_U32 port, MV_U32 comPhy)
@@ -397,6 +398,7 @@ static void mvEthComplexMacToRgmii(MV_U32 port, MV_U32 phy)
 	mvEthComplexPortDpClkSrcSet(port, 0x1);
 	mvEthComplexGopDevEnable();
 	mvEthComplexGopInit(port, MV_FALSE, MV_FALSE, MV_TRUE);
+	mvEthPhyAddrSet(port, phy);
 }
 
 static void mvEthComplexSwPortToGbePhy(MV_U32 swPort, MV_U32 phy)
@@ -420,7 +422,7 @@ MV_STATUS mvEthComplexInit(MV_U32 ethCompConfig)
 		mvEthComplexMacToGbePhy(0, 0, mvBoardPhyAddrGet(0));
 
 	if (c & MV_ETHCOMP_GE_MAC0_2_RGMII0)
-		mvEthComplexMacToRgmii(0, 0);
+		mvEthComplexMacToRgmii(0, mvBoardPhyAddrGet(0));
 
 	if (c & MV_ETHCOMP_GE_MAC0_2_COMPHY_1)
 		mvEthComplexMacToComPhy(0, 1);
@@ -438,7 +440,7 @@ MV_STATUS mvEthComplexInit(MV_U32 ethCompConfig)
 		mvEthComplexMacToGbePhy(1, 3, mvBoardPhyAddrGet(1));
 
 	if (c & MV_ETHCOMP_GE_MAC1_2_RGMII1)
-		mvEthComplexMacToRgmii(1, 1);
+		mvEthComplexMacToRgmii(1, mvBoardPhyAddrGet(1));
 
 	if (c & MV_ETHCOMP_GE_MAC1_2_PON_ETH_SERDES)
 		mvEthComplexMac1ToPonSerdes(1);
-- 
1.7.5.4

