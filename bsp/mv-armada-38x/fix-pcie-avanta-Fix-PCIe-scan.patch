From 56b5bb066333a51bd5da1583609e372ef4823894 Mon Sep 17 00:00:00 2001
From: Yehuda Yitschak <yehuday@marvell.com>
Date: Mon, 30 Dec 2013 09:45:59 +0200
Subject: [PATCH 1247/1825] fix: pcie: avanta: Fix PCIe scan

https://github.com/MISL-EBU-System-SW/misl-windriver.git linux-3.4.69-14t2-read
commit 8436e50c09d300c52c4526e38c83bb41b68e0211

	Linux 3.4 the correct function to call should be:
	pci_scan_root_bus().

Change-Id: I8eca8094beef7688f3d02913633f6190d95e9f60
Signed-off-by: Kosta Zertsekel <konszert@marvell.com>
Signed-off-by: Yehuda Yitschak <yehuday@marvell.com>
Reviewed-on: http://vgitil04.il.marvell.com:8080/4934
Tested-by: Star_Automation <star@marvell.com>
Signed-off-by: Zhong Hongbo <hongbo.zhong@windriver.com>
---
 arch/arm/mach-feroceon-kw2/pci.c |   11 +----------
 1 files changed, 1 insertions(+), 10 deletions(-)

diff --git a/arch/arm/mach-feroceon-kw2/pci.c b/arch/arm/mach-feroceon-kw2/pci.c
index de8bcf6..4214b1e 100644
--- a/arch/arm/mach-feroceon-kw2/pci.c
+++ b/arch/arm/mach-feroceon-kw2/pci.c
@@ -331,16 +331,7 @@ int __init mv_pci_setup(int nr, struct pci_sys_data *sys)
 
 struct pci_bus __devinit *mv_pci_scan_bus(int nr, struct pci_sys_data *sys)
 {
-   struct pci_ops *ops = &mv_pci_ops;
-   struct pci_bus *bus;
-
-         bus = pci_scan_bus(sys->busnr, ops, sys);
-
-   if(sys->mv_controller_num == 0)
-           mvPexLocalBusNumSet(1,
-                   bus->number + bus->subordinate - bus->secondary + 1);
-
-        return bus;
+	return pci_scan_root_bus(NULL, sys->busnr, &mv_pci_ops, sys, &sys->resources);
 }
 
 /**
-- 
1.7.5.4

