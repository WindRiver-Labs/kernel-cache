From accc600865519c039aaf1c9a2402cbe9c3a75a52 Mon Sep 17 00:00:00 2001
From: Neta Zur <neta@marvell.com>
Date: Thu, 21 Feb 2013 17:09:25 +0200
Subject: [PATCH 0481/1825] Bug Fix - IPC: Check if channel is already open on
 RX interrupt. Before start to process messages
 check that the channel is not closed.

https://github.com/MISL-EBU-System-SW/misl-windriver.git linux-3.4.69-14t2-read
commit 033f89c9433ece4ee1819c7421032b0687fcee85

Change-Id: Id39accc35a48abca0c4a2280f4f03157d0f26545
Signed-off-by: Neta Zur <neta@marvell.com>
Reviewed-on: http://vgitil04.il.marvell.com:8080/1176
Reviewed-by: Kosta Zertsekel <konszert@marvell.com>
Reviewed-by: Yehuda Yitschak <yehuday@marvell.com>
Reviewed-by: Nadav Haklai <nadavh@marvell.com>
Tested-by: Nadav Haklai <nadavh@marvell.com>
Signed-off-by: Zhong Hongbo <hongbo.zhong@windriver.com>
---
 arch/arm/plat-armada/common/mvIpc.c |    3 +++
 1 files changed, 3 insertions(+), 0 deletions(-)

diff --git a/arch/arm/plat-armada/common/mvIpc.c b/arch/arm/plat-armada/common/mvIpc.c
index a8a5be7..3deb0e1 100644
--- a/arch/arm/plat-armada/common/mvIpc.c
+++ b/arch/arm/plat-armada/common/mvIpc.c
@@ -901,6 +901,9 @@ MV_BOOL mvIpcRxMsg(MV_U32 *outChnId, MV_IPC_MSG **outMsg, MV_U32 drblNum)
 
 	chn = &ipcChannels[chnId];
 
+	if (chn->state == MV_CHN_CLOSED)
+		return MV_FALSE;
+
 	/* First process control messages like attach, detach, close */
 	if(isCtrlMsg(chn) == MV_TRUE){
 		mvIpcRxCtrlMsg(chnId, chn->rxCtrlMsg);
-- 
1.7.5.4

