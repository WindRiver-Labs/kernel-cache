From e2afdaccb13cb6ed9c08337f662758d584a291da Mon Sep 17 00:00:00 2001
From: Dmitri Epshtein <dima@marvell.com>
Date: Sun, 21 Apr 2013 12:45:26 -0400
Subject: [PATCH 0604/1825] PPv2: Remove MV_ETH_PORTS_NUM and update Kconfig

https://github.com/MISL-EBU-System-SW/misl-windriver.git linux-3.4.69-14t2-read
commit b94cd7d860cb4290feaccc9cd24e6a94ecd08437

Change-Id: I19ba6a22a6f4b781e0441049a6e24a5e9877b91a
Reviewed-on: http://vgitil04.il.marvell.com:8080/1622
Tested-by: Dmitri Epshtein <dima@marvell.com>
Reviewed-by: Dmitri Epshtein <dima@marvell.com>
Signed-off-by: Zhong Hongbo <hongbo.zhong@windriver.com>
---
 arch/arm/plat-armada/mv_drivers_lsp/mv_pp2/Kconfig |  235 ++++++++++----------
 1 files changed, 113 insertions(+), 122 deletions(-)
 mode change 100644 => 100755 arch/arm/plat-armada/mv_drivers_lsp/mv_pp2/Kconfig

diff --git a/arch/arm/plat-armada/mv_drivers_lsp/mv_pp2/Kconfig b/arch/arm/plat-armada/mv_drivers_lsp/mv_pp2/Kconfig
old mode 100644
new mode 100755
index 8b768f1..9330464
--- a/arch/arm/plat-armada/mv_drivers_lsp/mv_pp2/Kconfig
+++ b/arch/arm/plat-armada/mv_drivers_lsp/mv_pp2/Kconfig
@@ -1,8 +1,3 @@
-config MV_ETH_PORTS_NUM
-	int
-	default 4
-	---help---
-
 config MV_ETH_PP2_CLS2
 	bool
 	default y
@@ -23,6 +18,11 @@ config MV_ETH_PP2_CLS_MC
 	default y
 	---help---
 
+config MV_ETH_HWF
+	bool "Enable Harware Forwarding"
+	default y
+	---help---
+
 menu "BM configuration"
 
 config MV_ETH_BM_0_PKT_SIZE
@@ -36,7 +36,7 @@ config MV_ETH_BM_0_PKT_SIZE
 config MV_ETH_BM_1_PKT_SIZE
 	depends on MV_ETH_PP2
 	int "Packet size [bytes] can use buffers from pool #1"
-	default 256
+	default 0
         ---help---
         0 - means that packet size for the pool will be defined accordingly
         with MTU of the port that use this pool.
@@ -68,7 +68,7 @@ config MV_ETH_BM_4_PKT_SIZE
 config MV_ETH_BM_5_PKT_SIZE
 	depends on MV_ETH_PP2
 	int "Packet size [bytes] can use buffers from pool #5"
-	default 256
+	default 0
 	---help---
         0 - means that packet size for the pool will be defined accordingly
         with MTU of the port that use this pool.
@@ -89,313 +89,313 @@ config MV_ETH_BM_7_PKT_SIZE
         0 - means that packet size for the pool will be defined accordingly
         with MTU of the port that use this pool.
 
-menuconfig  MV_ETH_BM_HWF_PORT_0
-        depends on (MV_ETH_PP2 && (MV_ETH_PORTS_NUM != 0))
-        bool "BM HWF configuration for GbE #0"
+menuconfig  MV_ETH_BM_PORT_0
+        depends on MV_ETH_PP2
+        bool "BM configuration for GbE #0"
         default y
         ---help---
 
-config  MV_ETH_BM_HWF_PORT_0_LONG_POOL
+config  MV_ETH_BM_PORT_0_LONG_POOL
 	int "Long BM pool for GbE #0"
-	depends on MV_ETH_BM_HWF_PORT_0
+	depends on MV_ETH_BM_PORT_0
 	range -1 7
-	default 4
+	default 0
 	---help---
 	BM pool to be used for GbE #0 port to process long packets
 	-1 means that port will choose BM pool closest to required buffers size.
 
-config  MV_ETH_BM_HWF_PORT_0_SHORT_POOL
+config  MV_ETH_BM_PORT_0_SHORT_POOL
         int "Short BM pool for GbE #0"
-        depends on MV_ETH_BM_HWF_PORT_0
+        depends on MV_ETH_BM_PORT_0
         range 0 7
-        default 5
+        default 3
 	---help---
 	BM pool to be used for GbE #0 port to process short packets
 
-config  MV_ETH_BM_HWF_PORT_0_LONG_BUF_NUM
+config  MV_ETH_BM_PORT_0_LONG_BUF_NUM
         int "Number of buffers for Long pool of GbE #0"
-        depends on MV_ETH_BM_HWF_PORT_0
+        depends on MV_ETH_BM_PORT_0
         range 128 16384
         default 2048
         ---help---
 	Number of long buffers allocated for this port.
 
-config  MV_ETH_BM_HWF_PORT_0_SHORT_BUF_NUM
+config  MV_ETH_BM_PORT_0_SHORT_BUF_NUM
         int "Number of buffers for Short pool of GbE #0"
-        depends on MV_ETH_BM_HWF_PORT_0 && (MV_ETH_BM_HWF_PORT_0_LONG_POOL != MV_ETH_BM_HWF_PORT_0_SHORT_POOL)
+        depends on MV_ETH_BM_PORT_0 && (MV_ETH_BM_PORT_0_LONG_POOL != MV_ETH_BM_PORT_0_SHORT_POOL)
         range 128 16384
         default 3072
 	---help---
         Number of short buffers allocated for this port.
 
-menuconfig  MV_ETH_BM_HWF_PORT_1
-        depends on (MV_ETH_PP2 && (MV_ETH_PORTS_NUM != 0) && (MV_ETH_PORTS_NUM != 1))
-        bool "BM HWF configuration for GbE #1"
+menuconfig  MV_ETH_BM_PORT_1
+        depends on MV_ETH_PP2
+        bool "BM configuration for GbE #1"
         default y
         ---help---
 
-config  MV_ETH_BM_HWF_PORT_1_LONG_POOL
+config  MV_ETH_BM_PORT_1_LONG_POOL
         int "Long BM pool for GbE #1"
-        depends on MV_ETH_BM_HWF_PORT_1
+        depends on MV_ETH_BM_PORT_1
 	range -1 7
-        default 7
+        default 1
         ---help---
         BM pool to be used for GbE #1 port to process long packets.
 	-1 means that port will choose BM pool closest to required buffers size.
 
-config  MV_ETH_BM_HWF_PORT_1_SHORT_POOL
+config  MV_ETH_BM_PORT_1_SHORT_POOL
         int "Short BM pool for GbE #1"
-        depends on MV_ETH_BM_HWF_PORT_1
+        depends on MV_ETH_BM_PORT_1
         range 0 7
-        default 7
+        default 3
         ---help---
         BM pool to be used for GbE #1 port to process short packets.
 
-config  MV_ETH_BM_HWF_PORT_1_LONG_BUF_NUM
+config  MV_ETH_BM_PORT_1_LONG_BUF_NUM
         int "Number of buffers for Long pool of GbE #1"
-        depends on MV_ETH_BM_HWF_PORT_1
+        depends on MV_ETH_BM_PORT_1
         range 128 16384
         default 2048
         ---help---
 	Number of long buffers allocated for this port.
 
-config  MV_ETH_BM_HWF_PORT_1_SHORT_BUF_NUM
+config  MV_ETH_BM_PORT_1_SHORT_BUF_NUM
         int "Number of buffers for Short pool of GbE #1"
-        depends on MV_ETH_BM_HWF_PORT_1 && (MV_ETH_BM_HWF_PORT_1_LONG_POOL != MV_ETH_BM_HWF_PORT_1_SHORT_POOL)
+        depends on MV_ETH_BM_PORT_1 && (MV_ETH_BM_PORT_1_LONG_POOL != MV_ETH_BM_PORT_1_SHORT_POOL)
         range 128 16384
         default 3072
         ---help---
 	Number of short buffers allocated for this port.
 
-menuconfig  MV_ETH_BM_HWF_PORT_2
-        depends on (MV_ETH_PP2 && (MV_ETH_PORTS_NUM != 0) && (MV_ETH_PORTS_NUM != 1) &&  (MV_ETH_PORTS_NUM != 2))
-        bool "BM HWF configuration for GbE #2"
+menuconfig  MV_ETH_BM_PORT_2
+        depends on MV_ETH_PP2
+        bool "BM configuration for GbE #2"
         default y
         ---help---
 
-config  MV_ETH_BM_HWF_PORT_2_LONG_POOL
+config  MV_ETH_BM_PORT_2_LONG_POOL
         int "Long BM pool for GbE #2"
-        depends on MV_ETH_BM_HWF_PORT_2
+        depends on MV_ETH_BM_PORT_2
         range -1 7
-        default 7
+        default 2
         ---help---
         BM pool to be used for GbE #2 port to process long packets.
 	-1 means that port will choose BM pool closest to required buffers size.
 
-config  MV_ETH_BM_HWF_PORT_2_SHORT_POOL
+config  MV_ETH_BM_PORT_2_SHORT_POOL
         int "Short BM pool for GbE #2"
-        depends on MV_ETH_BM_HWF_PORT_2
+        depends on MV_ETH_BM_PORT_2
         range 0 7
-        default 7
+        default 3
         ---help---
 	BM pool to be used for GbE #2 port to process short packets.
 
-config  MV_ETH_BM_HWF_PORT_2_LONG_BUF_NUM
+config  MV_ETH_BM_PORT_2_LONG_BUF_NUM
         int "Number of buffers for Long pool of GbE #2"
-        depends on MV_ETH_BM_HWF_PORT_2
+        depends on MV_ETH_BM_PORT_2
         range 128 16384
         default 2048
         ---help---
         Number of long buffers allocated for this port.
 
-config  MV_ETH_BM_HWF_PORT_2_SHORT_BUF_NUM
+config  MV_ETH_BM_PORT_2_SHORT_BUF_NUM
         int "Number of buffers for Short pool of GbE #2"
-        depends on MV_ETH_BM_HWF_PORT_2 && (MV_ETH_BM_HWF_PORT_2_LONG_POOL != MV_ETH_BM_HWF_PORT_2_SHORT_POOL)
+        depends on MV_ETH_BM_PORT_2 && (MV_ETH_BM_PORT_2_LONG_POOL != MV_ETH_BM_PORT_2_SHORT_POOL)
         range 128 16384
         default 3072
         ---help---
         Number of short buffers allocated for this port.
 
-menuconfig  MV_ETH_BM_HWF_PORT_3
-        depends on (MV_ETH_PP2 && (MV_ETH_PORTS_NUM != 0) && (MV_ETH_PORTS_NUM != 1) && (MV_ETH_PORTS_NUM != 2) && (MV_ETH_PORTS_NUM != 3))
-        bool "BM HWF configuration for GbE #3"
+menuconfig  MV_ETH_BM_PORT_3
+        depends on MV_ETH_PP2
+        bool "BM configuration for GbE #3"
         default y
         ---help---
 
-config  MV_ETH_BM_HWF_PORT_3_LONG_POOL
+config  MV_ETH_BM_PORT_3_LONG_POOL
         int "Long BM pool for GbE #3"
-        depends on MV_ETH_BM_HWF_PORT_3
+        depends on MV_ETH_BM_PORT_3
         range -1 7
-        default 6
+        default 2
         ---help---
         BM pool to be used for GbE #3 port to process long packets.
 	-1 means that port will choose BM pool closest to required buffers size.
 
-config  MV_ETH_BM_HWF_PORT_3_SHORT_POOL
+config  MV_ETH_BM_PORT_3_SHORT_POOL
         int "Short BM pool for GbE #3"
-        depends on MV_ETH_BM_HWF_PORT_3
+        depends on MV_ETH_BM_PORT_3
         range 0 7
-        default 7
+        default 3
         ---help---
 	BM pool to be used for GbE #3 port to process short packets.
 
-config  MV_ETH_BM_HWF_PORT_3_LONG_BUF_NUM
+config  MV_ETH_BM_PORT_3_LONG_BUF_NUM
         int "Number of buffers for Long pool of GbE #3"
-        depends on MV_ETH_BM_HWF_PORT_3
+        depends on MV_ETH_BM_PORT_3
         range 128 16384
         default 2048
         ---help---
         Number of long buffers allocated for this port.
 
-config  MV_ETH_BM_HWF_PORT_3_SHORT_BUF_NUM
+config  MV_ETH_BM_PORT_3_SHORT_BUF_NUM
         int "Number of buffers for Short pool of GbE #3"
-        depends on MV_ETH_BM_HWF_PORT_3 && (MV_ETH_BM_HWF_PORT_3_LONG_POOL != MV_ETH_BM_HWF_PORT_3_SHORT_POOL)
+        depends on MV_ETH_BM_PORT_3 && (MV_ETH_BM_PORT_3_LONG_POOL != MV_ETH_BM_PORT_3_SHORT_POOL)
         range 128 16384
         default 3072
         ---help---
         Number of short buffers allocated for this port.
 
-menuconfig  MV_ETH_BM_PORT_0
-        depends on (MV_ETH_PP2 && (MV_ETH_PORTS_NUM != 0))
-        bool "BM configuration for GbE #0"
+menuconfig  MV_ETH_BM_HWF_PORT_0
+        depends on (MV_ETH_PP2 && MV_ETH_HWF)
+        bool "BM HWF configuration for GbE #0"
         default y
         ---help---
 
-config  MV_ETH_BM_PORT_0_LONG_POOL
+config  MV_ETH_BM_HWF_PORT_0_LONG_POOL
 	int "Long BM pool for GbE #0"
-	depends on MV_ETH_BM_PORT_0
+	depends on MV_ETH_BM_HWF_PORT_0
 	range -1 7
-	default 2
+	default 4
 	---help---
 	BM pool to be used for GbE #0 port to process long packets
 	-1 means that port will choose BM pool closest to required buffers size.
 
-config  MV_ETH_BM_PORT_0_SHORT_POOL
+config  MV_ETH_BM_HWF_PORT_0_SHORT_POOL
         int "Short BM pool for GbE #0"
-        depends on MV_ETH_BM_PORT_0
+        depends on MV_ETH_BM_HWF_PORT_0
         range 0 7
-        default 3
+        default 7
 	---help---
 	BM pool to be used for GbE #0 port to process short packets
 
-config  MV_ETH_BM_PORT_0_LONG_BUF_NUM
+config  MV_ETH_BM_HWF_PORT_0_LONG_BUF_NUM
         int "Number of buffers for Long pool of GbE #0"
-        depends on MV_ETH_BM_PORT_0
+        depends on MV_ETH_BM_HWF_PORT_0
         range 128 16384
         default 2048
         ---help---
 	Number of long buffers allocated for this port.
 
-config  MV_ETH_BM_PORT_0_SHORT_BUF_NUM
+config  MV_ETH_BM_HWF_PORT_0_SHORT_BUF_NUM
         int "Number of buffers for Short pool of GbE #0"
-        depends on MV_ETH_BM_PORT_0 && (MV_ETH_BM_PORT_0_LONG_POOL != MV_ETH_BM_PORT_0_SHORT_POOL)
+        depends on MV_ETH_BM_HWF_PORT_0 && (MV_ETH_BM_HWF_PORT_0_LONG_POOL != MV_ETH_BM_HWF_PORT_0_SHORT_POOL)
         range 128 16384
         default 3072
 	---help---
         Number of short buffers allocated for this port.
 
-menuconfig  MV_ETH_BM_PORT_1
-        depends on (MV_ETH_PP2 && (MV_ETH_PORTS_NUM != 0) && (MV_ETH_PORTS_NUM != 1))
-        bool "BM configuration for GbE #1"
+menuconfig  MV_ETH_BM_HWF_PORT_1
+        depends on (MV_ETH_PP2 && MV_ETH_HWF)
+        bool "BM HWF configuration for GbE #1"
         default y
         ---help---
 
-config  MV_ETH_BM_PORT_1_LONG_POOL
+config  MV_ETH_BM_HWF_PORT_1_LONG_POOL
         int "Long BM pool for GbE #1"
-        depends on MV_ETH_BM_PORT_1
+        depends on MV_ETH_BM_HWF_PORT_1
 	range -1 7
-        default 7
+        default 5
         ---help---
         BM pool to be used for GbE #1 port to process long packets.
 	-1 means that port will choose BM pool closest to required buffers size.
 
-config  MV_ETH_BM_PORT_1_SHORT_POOL
+config  MV_ETH_BM_HWF_PORT_1_SHORT_POOL
         int "Short BM pool for GbE #1"
-        depends on MV_ETH_BM_PORT_1
+        depends on MV_ETH_BM_HWF_PORT_1
         range 0 7
         default 7
         ---help---
         BM pool to be used for GbE #1 port to process short packets.
 
-config  MV_ETH_BM_PORT_1_LONG_BUF_NUM
+config  MV_ETH_BM_HWF_PORT_1_LONG_BUF_NUM
         int "Number of buffers for Long pool of GbE #1"
-        depends on MV_ETH_BM_PORT_1
+        depends on MV_ETH_BM_HWF_PORT_1
         range 128 16384
         default 2048
         ---help---
 	Number of long buffers allocated for this port.
 
-config  MV_ETH_BM_PORT_1_SHORT_BUF_NUM
+config  MV_ETH_BM_HWF_PORT_1_SHORT_BUF_NUM
         int "Number of buffers for Short pool of GbE #1"
-        depends on MV_ETH_BM_PORT_1 && (MV_ETH_BM_PORT_1_LONG_POOL != MV_ETH_BM_PORT_1_SHORT_POOL)
+        depends on MV_ETH_BM_HWF_PORT_1 && (MV_ETH_BM_HWF_PORT_1_LONG_POOL != MV_ETH_BM_HWF_PORT_1_SHORT_POOL)
         range 128 16384
         default 3072
         ---help---
 	Number of short buffers allocated for this port.
 
-menuconfig  MV_ETH_BM_PORT_2
-        depends on (MV_ETH_PP2 && (MV_ETH_PORTS_NUM != 0) && (MV_ETH_PORTS_NUM != 1) &&  (MV_ETH_PORTS_NUM != 2))
-        bool "BM configuration for GbE #2"
+menuconfig  MV_ETH_BM_HWF_PORT_2
+        depends on (MV_ETH_PP2 && MV_ETH_HWF)
+        bool "BM HWF configuration for GbE #2"
         default y
         ---help---
 
-config  MV_ETH_BM_PORT_2_LONG_POOL
+config  MV_ETH_BM_HWF_PORT_2_LONG_POOL
         int "Long BM pool for GbE #2"
-        depends on MV_ETH_BM_PORT_2
+        depends on MV_ETH_BM_HWF_PORT_2
         range -1 7
-        default 7
+        default 6
         ---help---
         BM pool to be used for GbE #2 port to process long packets.
 	-1 means that port will choose BM pool closest to required buffers size.
 
-config  MV_ETH_BM_PORT_2_SHORT_POOL
+config  MV_ETH_BM_HWF_PORT_2_SHORT_POOL
         int "Short BM pool for GbE #2"
-        depends on MV_ETH_BM_PORT_2
+        depends on MV_ETH_BM_HWF_PORT_2
         range 0 7
         default 7
         ---help---
 	BM pool to be used for GbE #2 port to process short packets.
 
-config  MV_ETH_BM_PORT_2_LONG_BUF_NUM
+config  MV_ETH_BM_HWF_PORT_2_LONG_BUF_NUM
         int "Number of buffers for Long pool of GbE #2"
-        depends on MV_ETH_BM_PORT_2
+        depends on MV_ETH_BM_HWF_PORT_2
         range 128 16384
         default 2048
         ---help---
         Number of long buffers allocated for this port.
 
-config  MV_ETH_BM_PORT_2_SHORT_BUF_NUM
+config  MV_ETH_BM_HWF_PORT_2_SHORT_BUF_NUM
         int "Number of buffers for Short pool of GbE #2"
-        depends on MV_ETH_BM_PORT_2 && (MV_ETH_BM_PORT_2_LONG_POOL != MV_ETH_BM_PORT_2_SHORT_POOL)
+        depends on MV_ETH_BM_HWF_PORT_2 && (MV_ETH_BM_HWF_PORT_2_LONG_POOL != MV_ETH_BM_HWF_PORT_2_SHORT_POOL)
         range 128 16384
         default 3072
         ---help---
         Number of short buffers allocated for this port.
 
-menuconfig  MV_ETH_BM_PORT_3
-        depends on (MV_ETH_PP2 && (MV_ETH_PORTS_NUM != 0) && (MV_ETH_PORTS_NUM != 1) && (MV_ETH_PORTS_NUM != 2) && (MV_ETH_PORTS_NUM != 3))
-        bool "BM configuration for GbE #3"
+menuconfig  MV_ETH_BM_HWF_PORT_3
+        depends on (MV_ETH_PP2 && MV_ETH_HWF)
+        bool "BM HWF configuration for GbE #3"
         default y
         ---help---
 
-config  MV_ETH_BM_PORT_3_LONG_POOL
+config  MV_ETH_BM_HWF_PORT_3_LONG_POOL
         int "Long BM pool for GbE #3"
-        depends on MV_ETH_BM_PORT_3
+        depends on MV_ETH_BM_HWF_PORT_3
         range -1 7
-        default 0
+        default 6
         ---help---
         BM pool to be used for GbE #3 port to process long packets.
 	-1 means that port will choose BM pool closest to required buffers size.
 
-config  MV_ETH_BM_PORT_3_SHORT_POOL
+config  MV_ETH_BM_HWF_PORT_3_SHORT_POOL
         int "Short BM pool for GbE #3"
-        depends on MV_ETH_BM_PORT_3
+        depends on MV_ETH_BM_HWF_PORT_3
         range 0 7
-        default 1
+        default 7
         ---help---
 	BM pool to be used for GbE #3 port to process short packets.
 
-config  MV_ETH_BM_PORT_3_LONG_BUF_NUM
+config  MV_ETH_BM_HWF_PORT_3_LONG_BUF_NUM
         int "Number of buffers for Long pool of GbE #3"
-        depends on MV_ETH_BM_PORT_3
+        depends on MV_ETH_BM_HWF_PORT_3
         range 128 16384
         default 2048
         ---help---
         Number of long buffers allocated for this port.
 
-config  MV_ETH_BM_PORT_3_SHORT_BUF_NUM
+config  MV_ETH_BM_HWF_PORT_3_SHORT_BUF_NUM
         int "Number of buffers for Short pool of GbE #3"
-        depends on MV_ETH_BM_PORT_3 && (MV_ETH_BM_PORT_3_LONG_POOL != MV_ETH_BM_PORT_3_SHORT_POOL)
+        depends on MV_ETH_BM_HWF_PORT_3 && (MV_ETH_BM_HWF_PORT_3_LONG_POOL != MV_ETH_BM_HWF_PORT_3_SHORT_POOL)
         range 128 16384
         default 3072
         ---help---
@@ -419,7 +419,7 @@ config  MV_ETH_TXQ
 
 config MV_ETH_RXQ_DESC
 	int "Number of Rx descriptors"
-	depends on (MV_ETH_PORTS_NUM != 0)
+	depends on MV_ETH_PP2
 	default 128
         ---help---
 	The number of Rx descriptors in each Rx queue.
@@ -431,7 +431,7 @@ config MV_ETH_RXQ_DEF
 
 config MV_ETH_TXQ_DESC
 	int "Number of Tx descriptors"
-	depends on (MV_ETH_PORTS_NUM != 0)
+	depends on MV_ETH_PP2
 	default 532
         ---help---
 	The number of Tx descriptors in each Tx queue.
@@ -443,14 +443,14 @@ config MV_ETH_TXQ_DEF
 
 config MV_ETH_TXQ_HWF_DESC
 	int "Number of HWF Tx descriptors"
-	depends on (MV_ETH_PORTS_NUM != 0)
+	depends on MV_ETH_PP2
 	default 16
         ---help---
 	The number of HWF dedicated Tx descriptors in each Tx queue.
 
 config MV_ETH_AGGR_TXQ_SIZE
 	int "Number of aggregated Tx descriptors"
-	depends on (MV_ETH_PORTS_NUM != 0)
+	depends on MV_ETH_PP2
 	default 256
         ---help---
 	The number of Tx descriptors in each aggregated Tx queue.
@@ -716,15 +716,6 @@ config MV_PON_TXQ_DEF
 
 endmenu
 
-menu "HWF support"
-
-config MV_ETH_HWF
-	bool "Enable Harware Forwarding"
-	default y
-	---help---
-
-endmenu
-
 menu "Switch support"
 
 config MV_ETH_SWITCH
-- 
1.7.5.4

