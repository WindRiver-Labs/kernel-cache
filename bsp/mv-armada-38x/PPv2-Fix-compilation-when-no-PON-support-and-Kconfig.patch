From 35ae7d8333364e7f9ff4ff965fe41bf35a18ff4c Mon Sep 17 00:00:00 2001
From: Yoni Farhadian <yonif@marvell.com>
Date: Thu, 18 Apr 2013 10:21:15 +0300
Subject: [PATCH 0597/1825] PPv2: Fix compilation when no PON support and
 Kconfig fix

https://github.com/MISL-EBU-System-SW/misl-windriver.git linux-3.4.69-14t2-read
commit 545622431f8722195936733acf7de65cde30495e

Change-Id: Iac1c6a346d516d064c2b7b755ba1265a62ad080f
Reviewed-on: http://vgitil04.il.marvell.com:8080/1608
Reviewed-by: Eran Ben-Avi <benavi@marvell.com>
Tested-by: Eran Ben-Avi <benavi@marvell.com>
Signed-off-by: Zhong Hongbo <hongbo.zhong@windriver.com>
---
 arch/arm/plat-armada/mv_drivers_lsp/mv_pp2/Kconfig |    5 +++++
 .../mv_drivers_lsp/mv_pp2/net_dev/mv_netdev.c      |    4 ++++
 arch/arm/plat-armada/mv_hal/pp2/gbe/mvPp2Gbe.c     |    4 ++++
 .../arm/plat-armada/mv_hal/pp2/gbe/mvPp2GbeDebug.c |    2 ++
 4 files changed, 15 insertions(+), 0 deletions(-)

diff --git a/arch/arm/plat-armada/mv_drivers_lsp/mv_pp2/Kconfig b/arch/arm/plat-armada/mv_drivers_lsp/mv_pp2/Kconfig
index 0a10b05..8b768f1 100644
--- a/arch/arm/plat-armada/mv_drivers_lsp/mv_pp2/Kconfig
+++ b/arch/arm/plat-armada/mv_drivers_lsp/mv_pp2/Kconfig
@@ -1,3 +1,8 @@
+config MV_ETH_PORTS_NUM
+	int
+	default 4
+	---help---
+
 config MV_ETH_PP2_CLS2
 	bool
 	default y
diff --git a/arch/arm/plat-armada/mv_drivers_lsp/mv_pp2/net_dev/mv_netdev.c b/arch/arm/plat-armada/mv_drivers_lsp/mv_pp2/net_dev/mv_netdev.c
index 3732fbd..bed1d1b 100644
--- a/arch/arm/plat-armada/mv_drivers_lsp/mv_pp2/net_dev/mv_netdev.c
+++ b/arch/arm/plat-armada/mv_drivers_lsp/mv_pp2/net_dev/mv_netdev.c
@@ -3565,8 +3565,10 @@ int mv_eth_start_internals(struct eth_port *pp, int mtu)
 
 	if (!MV_PON_PORT(pp->port))
 		mvEthMaxRxSizeSet(pp->port, RX_PKT_SIZE(mtu));
+#ifdef CONFIG_MV_PON
 	else
 		mv_pon_mtu_config(RX_PKT_SIZE(mtu));
+#endif
 
 #ifdef CONFIG_MV_ETH_HWF
 	mv_eth_hwf_bm_pool_init(pp, mtu);
@@ -3855,8 +3857,10 @@ int mv_eth_change_mtu_internals(struct net_device *dev, int mtu)
 
 	if (!MV_PON_PORT(pp->port))
 		mvEthMaxRxSizeSet(pp->port, pkt_size);
+#ifdef CONFIG_MV_PON
 	else
 		mv_pon_mtu_config(pkt_size);
+#endif
 
 #ifdef CONFIG_MV_ETH_HWF
 	port_pool = pp->hwf_pool_long;
diff --git a/arch/arm/plat-armada/mv_hal/pp2/gbe/mvPp2Gbe.c b/arch/arm/plat-armada/mv_hal/pp2/gbe/mvPp2Gbe.c
index 6757124..97750e2 100644
--- a/arch/arm/plat-armada/mv_hal/pp2/gbe/mvPp2Gbe.c
+++ b/arch/arm/plat-armada/mv_hal/pp2/gbe/mvPp2Gbe.c
@@ -842,7 +842,11 @@ void *mvPp2PortInit(int port, int firstRxq, int numRxqs, void *osHandle)
 	pCtrl->osHandle = osHandle;
 
 	/* associate TXQs to this port */
+#ifdef CONFIG_MV_PON
 	pCtrl->txpNum = MV_PON_PORT(port) ? CONFIG_MV_PON_TCONTS : 1;
+#else
+	pCtrl->txpNum = 1;
+#endif
 	pCtrl->txqNum = CONFIG_MV_ETH_TXQ;
 	status = mvPp2PortTxqsInit(port);
 	if (status != MV_OK)
diff --git a/arch/arm/plat-armada/mv_hal/pp2/gbe/mvPp2GbeDebug.c b/arch/arm/plat-armada/mv_hal/pp2/gbe/mvPp2GbeDebug.c
index 2054517..a0234ce 100644
--- a/arch/arm/plat-armada/mv_hal/pp2/gbe/mvPp2GbeDebug.c
+++ b/arch/arm/plat-armada/mv_hal/pp2/gbe/mvPp2GbeDebug.c
@@ -501,10 +501,12 @@ void mvPp2DropCntrs(int port)
 	mvEthRegPrint(MV_PP2_CLS_DROP_REG(MV_PPV2_PORT_PHYS(port)), "MV_PP2_CLS_DROP_REG");
 
 	if (MV_PON_PORT(port)) {
+#ifdef CONFIG_MV_PON
 		for (i = 0; i < CONFIG_MV_PON_TCONTS; i++) {
 			mvEthRegPrint2(MV_PP2_TX_EARLY_DROP_REG(i), "MV_PP2_TX_EARLY_DROP_REG", i);
 			mvEthRegPrint2(MV_PP2_TX_DESC_DROP_REG(i), "MV_PP2_TX_DESC_DROP_REG", i);
 		}
+#endif
 	} else {
 		i = MV_ETH_MAX_TCONT + port;
 		mvEthRegPrint2(MV_PP2_TX_EARLY_DROP_REG(i), "MV_PP2_TX_EARLY_DROP_REG", i);
-- 
1.7.5.4

