From b10a702664813dcc58a5d4c69c9fda999dfdfc2b Mon Sep 17 00:00:00 2001
From: Neta Zur <neta@marvell.com>
Date: Mon, 22 Jul 2013 11:09:51 +0300
Subject: [PATCH 0865/1825] l2 cache: add boot command parameter - l2_ways

https://github.com/MISL-EBU-System-SW/misl-windriver.git linux-3.4.69-14t2-read
commit 44c032b8f8efcf962a2455d53e86414210423615

	This parameter is a bitmap parameter used by the auroraL2_inv_all & auroraL2_flush_all
	function to indicate which ways are used as l2$, those function should
	invalidate/flush only the l2$ ways and not the SRAM memory ways.
	By default the l2_ways = 0xffffffff - all 32 ways are l2$.

Change-Id: I7e719e121944232248db1e6e80fd9cd9f723dec8
Signed-off-by: Neta Zur <neta@marvell.com>
Reviewed-on: http://vgitil04.il.marvell.com:8080/2747
Tested-by: Star_Automation <star@marvell.com>
Reviewed-by: Igor Patrik <igorp@marvell.com>
Signed-off-by: Zhong Hongbo <hongbo.zhong@windriver.com>
---
 arch/arm/mm/cache-aurora-l2.c |   15 ++++++++++-----
 1 files changed, 10 insertions(+), 5 deletions(-)

diff --git a/arch/arm/mm/cache-aurora-l2.c b/arch/arm/mm/cache-aurora-l2.c
index 6988f82..26691a9 100644
--- a/arch/arm/mm/cache-aurora-l2.c
+++ b/arch/arm/mm/cache-aurora-l2.c
@@ -564,24 +564,29 @@ void __init aurora_l2_lockdown(u32 cpuId, u32 lock_mask)
 	writel(lock_mask, auroraL2_base+L2_LOCKDOWN_IO_BRG);
 }
 
+static u32 l2_ways = 0xffffffff; /* all ways init to L2$ ways */
 
 void auroraL2_inv_all(void)
 {
-	u32 u   = 0xffff; // all ways
-	writel(u, auroraL2_base+L2_INVAL_WAY_REG);
+	writel(l2_ways, auroraL2_base+L2_INVAL_WAY_REG);
 }
 
 void auroraL2_flush_all(void)
 {
-	u32 u   = 0xffff; // all ways
-
     	if (!auroraL2_enable)
 		return;
 
-	writel(u, auroraL2_base + L2_FLUSH_WAY_REG);
+	writel(l2_ways, auroraL2_base + L2_FLUSH_WAY_REG);
 	cache_sync();
 }
 
+/* get the L2$ ways - to enable invalidate of only the L2$ ways */
+static int __init early_l2_ways(char *arg)
+{
+	l2_ways = memparse(arg, NULL);
+	return 0;
+}
+early_param("l2_ways", early_l2_ways);
 
 struct regs_entry {
 	u32             reg_address;
-- 
1.7.5.4

