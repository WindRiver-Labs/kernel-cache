From 227eceaf1c5071c5fe58c8aeb96d27b1245f66a7 Mon Sep 17 00:00:00 2001
From: Eran Ben-Avi <benavi@marvell.com>
Date: Thu, 15 Aug 2013 12:10:12 +0300
Subject: [PATCH 0967/1825] tdm: kw2: fix tal symbols export

https://github.com/MISL-EBU-System-SW/misl-windriver.git linux-3.4.69-14t2-read
commit c374804eac0a0fcefd27ce069a15a0028ff4a260

        Adapt TAL symbols exporting to linux
        kernel v3.4

Change-Id: I68d464629b958a0bfb22aca5266fa871eecb6ea2
Signed-off-by: Eran Ben-Avi <benavi@marvell.com>
Reviewed-on: http://vgitil04.il.marvell.com:8080/3046
Signed-off-by: Zhong Hongbo <hongbo.zhong@windriver.com>
---
 arch/arm/plat-feroceon/linux_oss/mvOs.h            |    2 +-
 .../mv_drivers_lsp/mv_phone/tdm/tal.c              |   20 ++++++++------------
 2 files changed, 9 insertions(+), 13 deletions(-)

diff --git a/arch/arm/plat-feroceon/linux_oss/mvOs.h b/arch/arm/plat-feroceon/linux_oss/mvOs.h
index 7990c3d..9c37935 100644
--- a/arch/arm/plat-feroceon/linux_oss/mvOs.h
+++ b/arch/arm/plat-feroceon/linux_oss/mvOs.h
@@ -55,7 +55,7 @@ disclaimer.
 #include <asm/hardirq.h>
 #include <asm/dma.h>
 #include <asm/io.h>
-
+#include <linux/module.h>
 #include <linux/random.h>
 
 #include "dbg-trace.h"
diff --git a/arch/arm/plat-feroceon/mv_drivers_lsp/mv_phone/tdm/tal.c b/arch/arm/plat-feroceon/mv_drivers_lsp/mv_phone/tdm/tal.c
index ec1cd84..34cbdab 100644
--- a/arch/arm/plat-feroceon/mv_drivers_lsp/mv_phone/tdm/tal.c
+++ b/arch/arm/plat-feroceon/mv_drivers_lsp/mv_phone/tdm/tal.c
@@ -83,7 +83,7 @@ tal_stat_t tal_init(tal_params_t* tal_params, tal_mmp_ops_t* mmp_ops)
 
 	return TAL_STAT_OK;
 }
-
+EXPORT_SYMBOL(tal_init);
 
 /*---------------------------------------------------------------------------*
  * tal_pcm_tx_completion
@@ -114,6 +114,7 @@ tal_stat_t tal_pcm_start(void)
 	tal_tdm_if_register_ops.tdm_if_ctl_ops.ctl_pcm_start();
 	return TAL_STAT_OK;
 }
+EXPORT_SYMBOL(tal_pcm_start);
 
 /*---------------------------------------------------------------------------*
  * tal_pcm_stop
@@ -124,6 +125,7 @@ tal_stat_t tal_pcm_stop(void)
 	tal_tdm_if_register_ops.tdm_if_ctl_ops.ctl_pcm_stop();
 	return TAL_STAT_OK;
 }
+EXPORT_SYMBOL(tal_pcm_stop);
 
 /*---------------------------------------------------------------------------*
  * tal_exit
@@ -134,6 +136,7 @@ tal_stat_t tal_exit(void)
 	tdm_if_exit();
 	return TAL_STAT_OK;
 }
+EXPORT_SYMBOL(tal_exit);
 
 /*---------------------------------------------------------------------------*
  * tal_stats_get
@@ -148,6 +151,7 @@ tal_stat_t tal_stats_get(tal_stats_t* tal_stats)
 
 	return TAL_STAT_OK;
 }
+EXPORT_SYMBOL(tal_stats_get);
 
 /*---------------------------------------------------------------------------*
  * tal_tdm_clk_config
@@ -157,6 +161,7 @@ void tal_tdm_clk_config(void)
 {
 	mvCtrlTdmClkCtrlConfig();
 }
+EXPORT_SYMBOL(tal_tdm_clk_config);
 
 #if defined(MV_TDM_USE_DCO)
 /*---------------------------------------------------------------------------*
@@ -167,6 +172,7 @@ int tal_tdm_clk_get(void)
 {
 	return mvCtrlTdmClkCtrlGet();
 }
+EXPORT_SYMBOL(tal_tdm_clk_get);
 
 /*---------------------------------------------------------------------------*
  * tal_tdm_clk_set
@@ -176,16 +182,6 @@ void tal_tdm_clk_set(int correction)
 {
 	return mvCtrlTdmClkCtrlSet(correction);
 }
-#endif
-
-/* EXPORTS */
-EXPORT_SYMBOL(tal_init);
-EXPORT_SYMBOL(tal_pcm_start);
-EXPORT_SYMBOL(tal_pcm_stop);
-EXPORT_SYMBOL(tal_exit);
-EXPORT_SYMBOL(tal_stats_get);
-EXPORT_SYMBOL(tal_tdm_clk_config);
-#if defined(MV_TDM_USE_DCO)
-EXPORT_SYMBOL(tal_tdm_clk_get);
 EXPORT_SYMBOL(tal_tdm_clk_set);
+
 #endif
-- 
1.7.5.4

