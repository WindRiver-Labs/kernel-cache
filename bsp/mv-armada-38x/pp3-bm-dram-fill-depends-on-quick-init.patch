From d7a06cdc373d10639477b3e2c925795862875240 Mon Sep 17 00:00:00 2001
From: Dovrat <dovrat@marvell.com>
Date: Mon, 21 Apr 2014 19:52:57 +0300
Subject: [PATCH 1561/1825] pp3: bm: dram fill depends on quick init

https://github.com/MISL-EBU-System-SW/misl-windriver.git linux-3.4.69-14t2-read
commit 7a2d2213b3a773227c1172bb1da1ac9718baf169

Change-Id: I967e06afdf3f5ce285dedb3ed8607da7baae9006
Signed-off-by: Dovrat <dovrat@marvell.com>
Reviewed-on: http://vgitil04.il.marvell.com:8080/7146
Tested-by: Star_Automation <star@marvell.com>
Reviewed-by: Eliezer Ben Zeev <eliezerb@marvell.com>
Reviewed-by: Dmitri Epshtein <dima@marvell.com>
Tested-by: Dmitri Epshtein <dima@marvell.com>
Signed-off-by: Zhong Hongbo <hongbo.zhong@windriver.com>
---
 drivers/net/ethernet/marvell/pp3/bm/mv_bm.c |    5 ++++-
 1 files changed, 4 insertions(+), 1 deletions(-)

diff --git a/drivers/net/ethernet/marvell/pp3/bm/mv_bm.c b/drivers/net/ethernet/marvell/pp3/bm/mv_bm.c
index a03957b..ccea47b 100644
--- a/drivers/net/ethernet/marvell/pp3/bm/mv_bm.c
+++ b/drivers/net/ethernet/marvell/pp3/bm/mv_bm.c
@@ -2727,7 +2727,10 @@ int bm_pool_fill_level_set(u32 pool, u32 num_of_buffers, u32 pe_size, u32 quick_
 		dram_fill	= BM_QM_PE_UNITS_TO_BYTES(num_of_buffers);
 	if (bid != 0)
 		dram_fill	= BM_GP_PE_UNITS_TO_BYTES(num_of_buffers, pe_size);
-	tab_tpr_drw_mng_ball_dyn.dram_fill	= dram_fill/UNIT_OF__8_BYTES;
+	if (quick_init == 1) /* quick init is on */
+		tab_tpr_drw_mng_ball_dyn.dram_fill	= dram_fill/UNIT_OF__8_BYTES;
+	else /* quick init is off */
+		tab_tpr_drw_mng_ball_dyn.dram_fill	= 0;
 	rc = bm_register_write(reg_base_address, reg_offset, reg_size, (u32 *)&tab_tpr_drw_mng_ball_dyn);
 	return rc;
 }
-- 
1.7.5.4

