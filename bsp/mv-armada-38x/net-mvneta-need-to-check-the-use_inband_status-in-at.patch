From d948a72cff9cc0632bcb94ce89e5d93537370462 Mon Sep 17 00:00:00 2001
From: czou <cao.zou@windriver.com>
Date: Sat, 8 Oct 2016 16:34:12 +0800
Subject: [PATCH] net: mvneta: need to check the use_inband_status in atuoneg

It is error to enable band Auto-Negotiation in default, not all platform
use inband, here check that inband is enabled, otherwise mvneta will
halt.

Signed-off-by: czou <cao.zou@windriver.com>
---
 drivers/net/ethernet/marvell/mvneta.c |    8 ++++++--
 1 files changed, 6 insertions(+), 2 deletions(-)

diff --git a/drivers/net/ethernet/marvell/mvneta.c b/drivers/net/ethernet/marvell/mvneta.c
index 74e1b25..1171aa2 100644
--- a/drivers/net/ethernet/marvell/mvneta.c
+++ b/drivers/net/ethernet/marvell/mvneta.c
@@ -1012,8 +1012,12 @@ static void mvneta_set_autoneg(struct mvneta_port *pp, int enable)
 		val &= ~(MVNETA_GMAC_FORCE_LINK_PASS |
 			 MVNETA_GMAC_FORCE_LINK_DOWN |
 			 MVNETA_GMAC_AN_FLOW_CTRL_EN);
-		val |= MVNETA_GMAC_INBAND_AN_ENABLE |
-		       MVNETA_GMAC_AN_SPEED_EN |
+
+		if (pp->use_inband_status) {
+			val |= MVNETA_GMAC_INBAND_AN_ENABLE;
+		}
+
+		val |= MVNETA_GMAC_AN_SPEED_EN |
 		       MVNETA_GMAC_AN_DUPLEX_EN;
 		mvreg_write(pp, MVNETA_GMAC_AUTONEG_CONFIG, val);
 
-- 
1.7.5.4

