From 6d5d6aa8966d343b2fe8cfcaabb601e0302d9940 Mon Sep 17 00:00:00 2001
From: kostap <kostap@marvell.com>
Date: Mon, 27 Jan 2014 18:44:51 +0200
Subject: [PATCH 1314/1825] bc2: hal: pex: Add PCIe to DRAM access WA for BC2
 (Jira - BOBCAT2-348)

https://github.com/MISL-EBU-System-SW/misl-windriver.git linux-3.4.69-14t2-read
commit cd6e14710881a94322cbeac5dc9364ebecebe6b4

	Modify the default attribute in PCIe to DRAM window as a WA
	for BC2 platform (shared transaction instead of default
	non-shared one).
	Jira reference: BOBCAT2-348

Change-Id: I98444adf51bbd013b57e8d4b1ec4eb609b6d00af
Signed-off-by: kostap <kostap@marvell.com>
Reviewed-on: http://vgitil04.il.marvell.com:8080/5318
Tested-by: Star_Automation <star@marvell.com>
Reviewed-by: Yehuda Yitschak <yehuday@marvell.com>
Signed-off-by: Zhong Hongbo <hongbo.zhong@windriver.com>
---
 arch/arm/plat-armada/mv_hal/pex/mvPexAddrDec.c |    7 ++++++-
 1 files changed, 6 insertions(+), 1 deletions(-)

diff --git a/arch/arm/plat-armada/mv_hal/pex/mvPexAddrDec.c b/arch/arm/plat-armada/mv_hal/pex/mvPexAddrDec.c
index f415ea7..f1c8dbb 100644
--- a/arch/arm/plat-armada/mv_hal/pex/mvPexAddrDec.c
+++ b/arch/arm/plat-armada/mv_hal/pex/mvPexAddrDec.c
@@ -597,8 +597,13 @@ MV_STATUS mvPexTargetWinEnable(MV_U32 pexIf, MV_U32 winNum, MV_BOOL enable)
 
 		/* this is not relevant to default and expantion rom windows */
 		if (winRegInfo.sizeRegOffs) {
-			if ((MV_PEX_WIN_DEFAULT != winNum) && (MV_PEX_WIN_EXP_ROM != winNum))
+			if ((MV_PEX_WIN_DEFAULT != winNum) && (MV_PEX_WIN_EXP_ROM != winNum)) {
 				MV_REG_BIT_SET(winRegInfo.sizeRegOffs, PXWCR_WIN_EN);
+#ifdef MV_BOBCAT2
+				/* TODO: remove this WA once PCi to DRAM access fixed - JIRA BOBCAT2-348 */
+				MV_REG_BIT_SET(winRegInfo.sizeRegOffs, 0x1UL << (PXWCR_ATTRIB_OFFS + 4));
+#endif
+			}
 		}
 	}
 
-- 
1.7.5.4

