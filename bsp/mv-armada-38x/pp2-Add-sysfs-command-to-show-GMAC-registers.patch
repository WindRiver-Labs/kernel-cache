From 22f94856dbea4dfb0c5df0b4d60337403ad60434 Mon Sep 17 00:00:00 2001
From: Dmitri Epshtein <dima@marvell.com>
Date: Thu, 31 Oct 2013 13:04:00 -0400
Subject: [PATCH 1064/1825] pp2: Add sysfs command to show GMAC registers

https://github.com/MISL-EBU-System-SW/misl-windriver.git linux-3.4.69-14t2-read
commit 17612dc8e445c4359dbdde6712c712dad26db191

Change-Id: Iabcc0e665e94246e9bca1264dad8afe3335dc802
Signed-off-by: Dmitri Epshtein <dima@marvell.com>
Reviewed-on: http://vgitil04.il.marvell.com:8080/4207
Reviewed-by: Yelena Krivosheev <yelena@marvell.com>
Reviewed-by: Jonatan Farhadian <yonif@marvell.com>
Tested-by: Star_Automation <star@marvell.com>
Reviewed-by: Igor Patrik <igorp@marvell.com>
Signed-off-by: Zhong Hongbo <hongbo.zhong@windriver.com>
---
 .../mv_drivers_lsp/mv_pp2/net_dev/mv_eth_sysfs.c   |    9 ++++++++-
 1 files changed, 8 insertions(+), 1 deletions(-)

diff --git a/arch/arm/plat-armada/mv_drivers_lsp/mv_pp2/net_dev/mv_eth_sysfs.c b/arch/arm/plat-armada/mv_drivers_lsp/mv_pp2/net_dev/mv_eth_sysfs.c
index 579850d..ca272db 100644
--- a/arch/arm/plat-armada/mv_drivers_lsp/mv_pp2/net_dev/mv_eth_sysfs.c
+++ b/arch/arm/plat-armada/mv_drivers_lsp/mv_pp2/net_dev/mv_eth_sysfs.c
@@ -33,6 +33,7 @@ disclaimer.
 #include <linux/netdevice.h>
 
 #include "gbe/mvPp2Gbe.h"
+#include "gmac/mvEthGmacApi.h"
 #include "prs/mvPp2Prs.h"
 #include "mv_netdev.h"
 #include "mv_eth_sysfs.h"
@@ -59,7 +60,8 @@ static ssize_t mv_eth_help(char *buf)
 	off += sprintf(buf+off, "echo [if_name]   > netdev      - show [if_name] net_device status\n");
 	off += sprintf(buf+off, "echo [p]         > cntrs       - show port [p] MIB counters\n");
 	off += sprintf(buf+off, "echo [p]         > stats       - show port [p] statistics\n");
-	off += sprintf(buf+off, "echo [p]         > isrRegs     - show ISR registers for port i[p]\n");
+	off += sprintf(buf+off, "echo [p]         > gmacRegs    - show GMAC registers for port [p]\n");
+	off += sprintf(buf+off, "echo [p]         > isrRegs     - show ISR registers for port [p]\n");
 	off += sprintf(buf+off, "echo [p]         > dropCntrs   - show drop counters for port [p]\n");
 
 	off += sprintf(buf+off, "echo [0|1]       > pnc         - enable / disable Parser and Classifier access\n");
@@ -113,6 +115,9 @@ static ssize_t mv_eth_port_store(struct device *dev,
 		mvEthMibCountersShow(p);
 	} else if (!strcmp(name, "isrRegs")) {
 		mvPp2IsrRegs(p);
+	} else if (!strcmp(name, "gmacRegs")) {
+		mvGmacLmsRegs();
+		mvGmacPortRegs(p);
 	} else if (!strcmp(name, "dropCntrs")) {
 		mvPp2DropCntrs(p);
 	} else if (!strcmp(name, "stats")) {
@@ -205,6 +210,7 @@ static DEVICE_ATTR(help,	S_IRUSR, mv_eth_show, NULL);
 static DEVICE_ATTR(debug,	S_IWUSR, NULL, mv_eth_2_hex_store);
 #endif
 static DEVICE_ATTR(isrRegs,	S_IWUSR, NULL, mv_eth_port_store);
+static DEVICE_ATTR(gmacRegs,	S_IWUSR, NULL, mv_eth_port_store);
 static DEVICE_ATTR(dropCntrs,	S_IWUSR, NULL, mv_eth_port_store);
 static DEVICE_ATTR(stats,       S_IWUSR, NULL, mv_eth_port_store);
 static DEVICE_ATTR(pnc,		S_IWUSR, NULL, mv_eth_port_store);
@@ -222,6 +228,7 @@ static struct attribute *mv_eth_attrs[] = {
 	&dev_attr_cntrs.attr,
 	&dev_attr_netdev.attr,
 	&dev_attr_isrRegs.attr,
+	&dev_attr_gmacRegs.attr,
 	&dev_attr_dropCntrs.attr,
 	&dev_attr_stats.attr,
 	&dev_attr_pnc.attr,
-- 
1.7.5.4

