From a813341ba3c49bc68e774f1aaf3259ac9f1316eb Mon Sep 17 00:00:00 2001
From: Nadav Haklai <nadavh@marvell.com>
Date: Wed, 19 Feb 2014 15:11:49 +0200
Subject: [PATCH 1449/1825] l2: a38x: Enable L2 dynamic high-level
 clock-gating feature

https://github.com/MISL-EBU-System-SW/misl-windriver.git linux-3.4.69-14t2-read
commit 89cdf800c16949771b6d7fe497c793a96c578917

	With this feature enabled, the cache controller stops its clock when it is idle
	and saves power

Change-Id: I3e836410b67c1134cc232f8798f673252da7537e
Signed-off-by: Nadav Haklai <nadavh@marvell.com>
Reviewed-on: http://vgitil04.il.marvell.com:8080/5796
Tested-by: Star_Automation <star@marvell.com>
Reviewed-on: http://vgitil04.il.marvell.com:8080/6253
Reviewed-by: Yehuda Yitschak <yehuday@marvell.com>
Signed-off-by: Zhong Hongbo <hongbo.zhong@windriver.com>
---
 arch/arm/mach-armada38x/core.c |    3 +++
 1 files changed, 3 insertions(+), 0 deletions(-)

diff --git a/arch/arm/mach-armada38x/core.c b/arch/arm/mach-armada38x/core.c
index 5babc91..4f27bc5 100644
--- a/arch/arm/mach-armada38x/core.c
+++ b/arch/arm/mach-armada38x/core.c
@@ -1219,6 +1219,9 @@ static void __init a38x_init_l2x0_cache(void)
 	void __iomem *l2x0_base =
 	    (void __iomem *)(INTER_REGS_VIRT_BASE + MV_CA9X2_L2CC_OFFSET);
 
+	/* L2X0 Power Control */
+	__raw_writel(L2X0_DYNAMIC_CLK_GATING_EN, l2x0_base + L2X0_POWER_CTRL);
+
 	/* 88F6820 - 16 ways, 88F6810 - 8 ways */
 	if (mvCtrlGetCpuNum())
 		l2x0_init(l2x0_base, 0x00470000, 0xfe0fffff);
-- 
1.7.5.4

