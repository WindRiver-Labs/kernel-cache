From b1a24e87893c8e25d91637324fb8fa8b1214338c Mon Sep 17 00:00:00 2001
From: Yoni Farhadian <yonif@marvell.com>
Date: Sun, 21 Jul 2013 13:16:31 +0300
Subject: [PATCH 0857/1825] PPv2: fix: update PPv2 with new buff size after
 MTU change

https://github.com/MISL-EBU-System-SW/misl-windriver.git linux-3.4.69-14t2-read
commit ee3824d9f056b31c8961e20590e2c16effa153be

	When changing MTU, BM pools buffer size ischanged as well
	The fix that is done, is notify the PPv2 HW with the new size (update Pool Buffer Size register)
	This will enable working with MTU > 1500

Change-Id: Id9f658f6bbdf4bc0fefbee4bfd467c4a26c905ff
Signed-off-by: Yoni Farhadian <yonif@marvell.com>
Reviewed-on: http://vgitil04.il.marvell.com:8080/2735
Reviewed-by: Dmitri Epshtein <dima@marvell.com>
Reviewed-by: Nadav Haklai <nadavh@marvell.com>
Tested-by: Nadav Haklai <nadavh@marvell.com>
Signed-off-by: Zhong Hongbo <hongbo.zhong@windriver.com>
---
 .../mv_drivers_lsp/mv_pp2/net_dev/mv_netdev.c      |    2 ++
 1 files changed, 2 insertions(+), 0 deletions(-)

diff --git a/arch/arm/plat-armada/mv_drivers_lsp/mv_pp2/net_dev/mv_netdev.c b/arch/arm/plat-armada/mv_drivers_lsp/mv_pp2/net_dev/mv_netdev.c
index d5efdd6..65d46a0 100644
--- a/arch/arm/plat-armada/mv_drivers_lsp/mv_pp2/net_dev/mv_netdev.c
+++ b/arch/arm/plat-armada/mv_drivers_lsp/mv_pp2/net_dev/mv_netdev.c
@@ -4240,6 +4240,7 @@ int mv_eth_change_mtu_internals(struct net_device *dev, int mtu)
 			MV_ETH_UNLOCK(&port_pool->lock, flags);
 			return -1;
 		}
+		mvPp2BmPoolBufSizeSet(port_pool->pool, RX_BUF_SIZE(port_pool->pkt_size));
 		MV_ETH_UNLOCK(&port_pool->lock, flags);
 	}
 
@@ -4260,6 +4261,7 @@ int mv_eth_change_mtu_internals(struct net_device *dev, int mtu)
 			MV_ETH_UNLOCK(&port_pool->lock, flags);
 			return -1;
 		}
+		mvPp2BmPoolBufSizeSet(port_pool->pool, RX_HWF_BUF_SIZE(port_pool->pkt_size));
 		MV_ETH_UNLOCK(&port_pool->lock, flags);
 	}
 #endif /* CONFIG_MV_ETH_HWF */
-- 
1.7.5.4

