From 305e6f4a610b052e56d0fa3cfb1d4e7c8f9f5370 Mon Sep 17 00:00:00 2001
From: Yehuda Yitschak <yehuday@marvell.com>
Date: Thu, 15 Nov 2012 15:20:32 +0200
Subject: [PATCH 0370/1825] PM: Added Giga phy initialization in axp restore
 routine

https://github.com/MISL-EBU-System-SW/misl-windriver.git linux-3.4.69-14t2-read
commit c4927b1c7e62cf65235e93d515fd838eb175c0d6

Change-Id: Iec1be82e4840812bb9aa755c3740db445553a55e
Signed-off-by: Yehuda Yitschak <yehuday@marvell.com>
Signed-off-by: Kosta Zertsekel <konszert@marvell.com>
Signed-off-by: Zhong Hongbo <hongbo.zhong@windriver.com>
---
 arch/arm/mach-armadaxp/core.c |    8 +++++++-
 1 files changed, 7 insertions(+), 1 deletions(-)

diff --git a/arch/arm/mach-armadaxp/core.c b/arch/arm/mach-armadaxp/core.c
index 2a67aca..8678b7b 100644
--- a/arch/arm/mach-armadaxp/core.c
+++ b/arch/arm/mach-armadaxp/core.c
@@ -63,6 +63,7 @@
 #include "plat/gpio.h"
 #include "cpu/mvCpu.h"
 
+
 #if defined(CONFIG_MV_INCLUDE_SDIO)
 #include "sdmmc/mvSdmmc.h"
 #include <plat/mvsdio.h>
@@ -84,6 +85,7 @@
 
 /* Eth Phy */
 #include "mvSysEthPhyApi.h"
+#include "eth-phy/mvEthPhy.h"
 
 /* LCD */
 #include <video/dovefb.h>
@@ -1456,6 +1458,7 @@ static int mvAmpInitCpuIf()
  * ****************************************************************************/
 void axp_db_restore(void)
 {
+	int maxPorts, port;
 
 	/* init the Board environment */
 	mvBoardEnvInit();
@@ -1484,7 +1487,10 @@ void axp_db_restore(void)
 #ifdef CONFIG_MV_INCLUDE_USB
 	mvUsbPllInit();
 #endif
-	mvSysEthPhyInit();
+	maxPorts =  mvCtrlEthMaxPortGet();
+
+	for (port = 0; port < maxPorts; port++)
+		mvEthPhyInit(port, MV_FALSE);
 
 	/* TODO - timer should be restored by kernel hook */
 	axp_timer_resume();
-- 
1.7.5.4

