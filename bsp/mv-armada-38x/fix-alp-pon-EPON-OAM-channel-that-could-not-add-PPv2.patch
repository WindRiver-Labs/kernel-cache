From ddd4d307c3d073d0e3f396c1f33d5cbb72a9d1c9 Mon Sep 17 00:00:00 2001
From: Victor Gu <xigu@marvell.com>
Date: Wed, 21 May 2014 15:03:49 +0800
Subject: [PATCH 1671/1825] fix: alp: pon: EPON OAM channel that could not add
 PPv2 parsing rule

https://github.com/MISL-EBU-System-SW/misl-windriver.git linux-3.4.69-14t2-read
commit 37303c56c8d3f7e7acb04a86271284cd81bf967e

Signed-off-by: Victor Gu <xigu@marvell.com>

Change-Id: I43f07f105e35e8214b5d0d6c7bd6ed2b91acdac7
Reviewed-on: http://vgitil04.il.marvell.com:8080/8155
Tested-by: Star_Automation <star@marvell.com>
Reviewed-by: Yehuda Yitschak <yehuday@marvell.com>
Signed-off-by: Zhong Hongbo <hongbo.zhong@windriver.com>
---
 .../mv_drivers_lsp/mv_pon/core/epon/eponOnuMngr.c  |    9 ++++++---
 1 files changed, 6 insertions(+), 3 deletions(-)

diff --git a/arch/arm/plat-armada/mv_drivers_lsp/mv_pon/core/epon/eponOnuMngr.c b/arch/arm/plat-armada/mv_drivers_lsp/mv_pon/core/epon/eponOnuMngr.c
index 2fc4d41..cdb5c8b 100644
--- a/arch/arm/plat-armada/mv_drivers_lsp/mv_pon/core/epon/eponOnuMngr.c
+++ b/arch/arm/plat-armada/mv_drivers_lsp/mv_pon/core/epon/eponOnuMngr.c
@@ -110,7 +110,8 @@ extern MV_U8 fixMacAddrs[8][6];
 
 /* Local Variables
    ------------------------------------------------------------------------------*/
-static MV_U8 oam_dmac[6] = {0x01, 0x80, 0xC2, 0x00, 0x00, 0x01};
+static MV_U8 oam_dmac[6]  = {0x01, 0x80, 0xC2, 0x00, 0x00, 0x01};
+static MV_U8 dmac_mask[6] = {0xff, 0xff, 0xff, 0xff, 0xff, 0xff};
 
 /* SW DBA params */
 MV_U32 llidDbaRprtCount = 0;
@@ -2993,7 +2994,8 @@ MV_STATUS onuEponEoamChannelAdd(MV_U8 rxCpuQueue)
 	}
 
 	/* Set EPON OAM MAC parsing rule in PP parser */
-	rcode = mvPrsMacDaAccept(MV_PP2_PON_PORT_BM | MV_PP2_GMAC0_PORT_BM | MV_PP2_GMAC1_PORT_BM, oam_dmac, 1);
+	rcode = mvPrsMacDaRangeSet(MV_PP2_PON_PORT_BM | MV_PP2_GMAC0_PORT_BM | MV_PP2_GMAC1_PORT_BM,
+				oam_dmac, dmac_mask, 0, 0, 0);
 	if (rcode) {
 		printk(KERN_ERR "Failed to add EOAM MAC parser rule\n");
 		return MV_ERROR;
@@ -3094,7 +3096,8 @@ MV_STATUS onuEponEoamChannelDel(void)
 	}
 
 	/* Delete EPON OAM MAC parsing rule in PP parser */
-	rcode = mvPrsMacDaAccept(MV_PP2_PON_PORT_BM | MV_PP2_GMAC0_PORT_BM | MV_PP2_GMAC1_PORT_BM, oam_dmac, 0);
+	rcode = mvPrsMacDaRangeDel(MV_PP2_PON_PORT_BM | MV_PP2_GMAC0_PORT_BM | MV_PP2_GMAC1_PORT_BM,
+				oam_dmac, dmac_mask);
 	if (rcode) {
 		printk(KERN_ERR "Failed to delete EOAM MAC parser rule\n");
 		return MV_ERROR;
-- 
1.7.5.4

