From 3fb9d4ef6dd40bca06aeb6faff5db887e217b6c3 Mon Sep 17 00:00:00 2001
From: Zhong Hongbo <hongbo.zhong@windriver.com>
Date: Tue, 21 Oct 2014 11:38:52 +0800
Subject: [PATCH 1823/1825] 38x: Remove the unuse code

Signed-off-by: Zhong Hongbo <hongbo.zhong@windriver.com>
---
 arch/arm/kernel/hw_breakpoint.c |    2 +-
 arch/arm/mach-armada38x/core.c  |   56 +++------------------------------------
 2 files changed, 5 insertions(+), 53 deletions(-)

diff --git a/arch/arm/kernel/hw_breakpoint.c b/arch/arm/kernel/hw_breakpoint.c
index b7decaf..18d39ea 100644
--- a/arch/arm/kernel/hw_breakpoint.c
+++ b/arch/arm/kernel/hw_breakpoint.c
@@ -1049,7 +1049,7 @@ static int __init arch_hw_breakpoint_init(void)
 	register_cpu_notifier(&dbg_reset_nb);
 	return 0;
 }
-//arch_initcall(arch_hw_breakpoint_init);
+arch_initcall(arch_hw_breakpoint_init);
 
 void hw_breakpoint_pmu_read(struct perf_event *bp)
 {
diff --git a/arch/arm/mach-armada38x/core.c b/arch/arm/mach-armada38x/core.c
index fa91ff3..35a1788 100644
--- a/arch/arm/mach-armada38x/core.c
+++ b/arch/arm/mach-armada38x/core.c
@@ -332,31 +332,6 @@ static struct platform_device a38x_i2c0 = {
 		.platform_data = &a38x_i2c_pdata,
 	},
 };
-
-static struct resource a38x_i2c_1_resources[] = {
-	{
-		.name = "i2c base",
-		.start = INTER_REGS_PHYS_BASE + MV_TWSI_SLAVE_REGS_OFFSET(1),
-		.end = INTER_REGS_PHYS_BASE + MV_TWSI_SLAVE_REGS_OFFSET(1) + 0x20 - 1,
-		.flags = IORESOURCE_MEM,
-	},
-	{
-		.name = "i2c irq",
-		.start = IRQ_GLOBAL_I2C1,
-		.end = IRQ_GLOBAL_I2C1,
-		.flags = IORESOURCE_IRQ,
-	},
-};
-
-static struct platform_device a38x_i2c1 = {
-	.name = MV64XXX_I2C_CTLR_NAME,
-	.id = 1,
-	.num_resources = ARRAY_SIZE(a38x_i2c_1_resources),
-	.resource = a38x_i2c_1_resources,
-	.dev = {
-		.platform_data = &a38x_i2c_pdata,
-	},
-};
 #endif
 
 static void __init a38x_i2c_init(void)
@@ -364,10 +339,6 @@ static void __init a38x_i2c_init(void)
 #ifdef CONFIG_I2C_MV64XXX
 	if (mvUnitMapIsMine(I2C0) == MV_TRUE)
 		platform_device_register(&a38x_i2c0);
-
-	if (mvCtrlSocUnitInfoNumGet(I2C_UNIT_ID) >= 1 &&
-	    mvUnitMapIsMine(I2C1) == MV_TRUE)
-		platform_device_register(&a38x_i2c1);
 #endif
 }
 
@@ -744,7 +715,10 @@ static void __init eth_init(void)
 	    (mvCtrlPwrClckGet(ETH_GIG_UNIT_ID, 1))) {
 		mv_neta_giga_pdev_register(&mv_neta_ge1_plat);
 	}
-
+	if ((mvUnitMapIsMine(ETH2) == MV_TRUE) && (mvBoardIsEthConnected(2)) &&
+	    (mvCtrlPwrClckGet(ETH_GIG_UNIT_ID, 2))) {
+		mv_neta_giga_pdev_register(&mv_neta_ge2_plat);
+	}
 #endif /* CONFIG_MV_ETH_NETA) || CONFIG_MV_ETH_NETA_MODULE */
 }
 #endif /* CONFIG_MV_ETHERNET */
@@ -777,25 +751,6 @@ static void __init a38x_gpio_init(void)
 }
 
 /*******************************************************************************
- * RTC
- */
-static struct resource rtc_resource[] = {
-	{
-	 .start = INTER_REGS_PHYS_BASE + MV_RTC_REGS_OFFSET,
-	 .end = INTER_REGS_PHYS_BASE + MV_RTC_REGS_OFFSET + 32 - 1,
-	 .flags = IORESOURCE_MEM,
-	 }, {
-	     .start = IRQ_GLOBAL_RTC,
-	     .flags = IORESOURCE_IRQ,
-	     }
-};
-
-static void __init a38x_rtc_init(void)
-{
-	platform_device_register_simple("rtc-mv", -1, rtc_resource, 2);
-}
-
-/*******************************************************************************
  * SATA
  */
 #ifdef CONFIG_SATA_AHCI_MV
@@ -1342,11 +1297,8 @@ static void __init a38x_board_init(void)
 	a38x_i2c_init();
 	a38x_sdhci_init();
 	a38x_nand_nfc_init();
-#if 0
-	a38x_rtc_init();
 	a38x_gpio_init();
 	a38x_hwmon_init();
-#endif
 }
 
 static void board_restart(char mode, const char *cmd)
-- 
1.7.5.4

