From be11d7188e81383c6eff5633f719738772d7053c Mon Sep 17 00:00:00 2001
From: Eli Nidam <elini@marvell.com>
Date: Mon, 30 Dec 2013 18:40:29 +0200
Subject: [PATCH 1251/1825] a38x: Added auto detect NOR definitions and skip
 SW hang when NOR detect failed

https://github.com/MISL-EBU-System-SW/misl-windriver.git linux-3.4.69-14t2-read
commit 9fd3c31ac8ab32f0bff18c7100b58ffa4b7e42b4

Change-Id: If6b0dc31e39a620f1e2b4f37376453a80488a7c6
Signed-off-by: Eli Nidam <elini@marvell.com>
Reviewed-on: http://vgitil04.il.marvell.com:8080/4959
Tested-by: Star_Automation <star@marvell.com>
Reviewed-by: Omri Itach <omrii@marvell.com>
Tested-by: Omri Itach <omrii@marvell.com>
Signed-off-by: Zhong Hongbo <hongbo.zhong@windriver.com>
---
 .../armada_38x_family/boardEnv/mvBoardEnvLib.c     |   22 ++++++++++++++++++++
 .../armada_38x_family/boardEnv/mvBoardEnvLib.h     |    1 +
 2 files changed, 23 insertions(+), 0 deletions(-)

diff --git a/arch/arm/mach-armada38x/armada_38x_family/boardEnv/mvBoardEnvLib.c b/arch/arm/mach-armada38x/armada_38x_family/boardEnv/mvBoardEnvLib.c
index 46ee299..34c5e0a 100644
--- a/arch/arm/mach-armada38x/armada_38x_family/boardEnv/mvBoardEnvLib.c
+++ b/arch/arm/mach-armada38x/armada_38x_family/boardEnv/mvBoardEnvLib.c
@@ -2459,3 +2459,25 @@ MV_STATUS mvBoardSatRWrite(MV_SATR_TYPE_ID satrWriteField, MV_U8 val)
 	}
 	return MV_OK;
 }
+/*******************************************************************************
+* mvBoardNorFlashConnect
+*
+* DESCRIPTION:
+*	This routine returns MV_TRUE for NOR module detected
+*
+* INPUT:
+*
+* OUTPUT:
+*       None.
+*
+* RETURN:
+*       MV_TRUE - port in GMII.
+*       MV_FALSE - other.
+*
+*******************************************************************************/
+int mvBoardNorFlashConnect(void)
+{
+	if (mvBoardIsModuleConnected(MV_CONFIG_NOR))
+		return MV_TRUE;
+	return MV_FALSE;
+}
diff --git a/arch/arm/mach-armada38x/armada_38x_family/boardEnv/mvBoardEnvLib.h b/arch/arm/mach-armada38x/armada_38x_family/boardEnv/mvBoardEnvLib.h
index 47d64ea..77bae7b 100644
--- a/arch/arm/mach-armada38x/armada_38x_family/boardEnv/mvBoardEnvLib.h
+++ b/arch/arm/mach-armada38x/armada_38x_family/boardEnv/mvBoardEnvLib.h
@@ -535,6 +535,7 @@ MV_STATUS mvBoardTwsiSatRGet(MV_U8 devNum, MV_U8 regNum, MV_U8 *pData);
 MV_STATUS mvBoardTwsiSatRSet(MV_U8 devNum, MV_U8 regNum, MV_U8 regVal);
 MV_U32 mvBoardSatRRead(MV_SATR_TYPE_ID satrField);
 MV_STATUS mvBoardSatRWrite(MV_SATR_TYPE_ID satrWriteField, MV_U8 val);
+int mvBoardNorFlashConnect(void);
 
 /*						bit    TWSI           Reg	board	*/
 /*   name		SATR-ID			Mask  offset  devID   num	active	*/
-- 
1.7.5.4

