From 9c8d0a76c058d984e951a7d879dc4058559eacf7 Mon Sep 17 00:00:00 2001
From: Hanna Hawa <hannah@marvell.com>
Date: Tue, 20 Nov 2012 13:32:32 +0200
Subject: [PATCH 0320/1825] Added pmu_request_irq function to support Code
 Performance Analyzer (Pixiu)

https://github.com/MISL-EBU-System-SW/misl-windriver.git linux-3.4.69-14t2-read
commit ddbbbb3a7e59e1048145fa87362d172311e3d9c6

Change-Id: I6c88dcc6e87c9c40addc0f3a1cc02f1637d5a25b

Signed-off-by: Kosta Zertsekel <konszert@marvell.com>
Signed-off-by: Zhong Hongbo <hongbo.zhong@windriver.com>
---
 arch/arm/mach-armadaxp/irq.c |   25 +++++++++++++++++++++++++
 1 files changed, 25 insertions(+), 0 deletions(-)

diff --git a/arch/arm/mach-armadaxp/irq.c b/arch/arm/mach-armadaxp/irq.c
index ee2597f..51b9a41 100644
--- a/arch/arm/mach-armadaxp/irq.c
+++ b/arch/arm/mach-armadaxp/irq.c
@@ -358,5 +358,30 @@ void __init axp_init_irq(void)
 
 }
 
+/*
+ * This functions used by Pixiu driver under tools/pixiu.
+ */
+int pmu_request_irq(int irq, irq_handler_t handler)
+{
+        int i;
+        int ret = request_irq(irq, handler, IRQF_DISABLED | IRQF_NOBALANCING, "armpmu", NULL);
+        if (!ret) {
+                for_each_online_cpu(i) {
+                        axp_unmask_fabric_interrupt(i);
+                }
+        }
+        return ret;
+}
+EXPORT_SYMBOL(pmu_request_irq);
+
+void pmu_free_irq(int irq)
+{
+        int i;
+        for_each_online_cpu(i) {
+                axp_mask_fabric_interrupt(i);
+        }
+        free_irq(irq, NULL);
+}
+EXPORT_SYMBOL(pmu_free_irq);
 
 
-- 
1.7.5.4

