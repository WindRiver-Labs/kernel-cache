From e5e9ed142696e446b2b6de9cd6bf5c8dbb122f02 Mon Sep 17 00:00:00 2001
From: Omri Itach <omrii@marvell.com>
Date: Sun, 17 Mar 2013 11:09:17 +0200
Subject: [PATCH 0516/1825] Avanta LP: NAND: Legacy NAND support removed

https://github.com/MISL-EBU-System-SW/misl-windriver.git linux-3.4.69-14t2-read
commit 3bc2dfa053a6eb3fe47988aa48e97b79558551e0

Change-Id: I92aaa609104baea7311ea367450a0b83b12f383e
Reviewed-on: http://vgitil04.il.marvell.com:8080/1329
Reviewed-by: Omri Itach <omrii@marvell.com>
Tested-by: Omri Itach <omrii@marvell.com>
Signed-off-by: Zhong Hongbo <hongbo.zhong@windriver.com>
---
 .../avanta_lp_family/boardEnv/mvBoardEnvLib.c      |    4 -
 .../avanta_lp_family/ctrlEnv/mvCtrlEnvLib.c        |   23 --------
 .../avanta_lp_family/ctrlEnv/mvCtrlEnvLib.h        |    3 -
 .../avanta_lp_family/ctrlEnv/mvCtrlEnvRegs.h       |   60 +++++++++-----------
 .../avanta_lp_family/ctrlEnv/mvCtrlEnvSpec.h       |    3 -
 5 files changed, 26 insertions(+), 67 deletions(-)
 mode change 100644 => 100755 arch/arm/mach-avantalp/avanta_lp_family/.gitignore

diff --git a/arch/arm/mach-avantalp/avanta_lp_family/.gitignore b/arch/arm/mach-avantalp/avanta_lp_family/.gitignore
old mode 100644
new mode 100755
diff --git a/arch/arm/mach-avantalp/avanta_lp_family/boardEnv/mvBoardEnvLib.c b/arch/arm/mach-avantalp/avanta_lp_family/boardEnv/mvBoardEnvLib.c
index e386f3c..6960325 100755
--- a/arch/arm/mach-avantalp/avanta_lp_family/boardEnv/mvBoardEnvLib.c
+++ b/arch/arm/mach-avantalp/avanta_lp_family/boardEnv/mvBoardEnvLib.c
@@ -865,10 +865,6 @@ MV_BOARD_BOOT_SRC mvBoardBootDeviceGroupSet(MV_U32 sarBootDeviceValue)
 		mvBoardMppTypeSet(0, NAND_BOOT_V2);
 		mvBoardMppTypeSet(1, NAND_BOOT_V2);
 		break;
-	case MSAR_0_BOOT_NAND_LEGACY:
-		mvBoardMppTypeSet(0, NAND_BOOT_V1);
-		mvBoardMppTypeSet(1, NAND_BOOT_V1);
-		break;
 	case MSAR_0_BOOT_SPI_FLASH:
 		groupType = ((mvCtrlConfigGet(MV_CONFIG_DEVICE_BUS_MODULE) == 0x2) ? SPI0_BOOT_SPDIF_AUDIO : SPI0_BOOT);
 		mvBoardMppTypeSet(0, groupType);
diff --git a/arch/arm/mach-avantalp/avanta_lp_family/ctrlEnv/mvCtrlEnvLib.c b/arch/arm/mach-avantalp/avanta_lp_family/ctrlEnv/mvCtrlEnvLib.c
index 2287476..2650dab 100755
--- a/arch/arm/mach-avantalp/avanta_lp_family/ctrlEnv/mvCtrlEnvLib.c
+++ b/arch/arm/mach-avantalp/avanta_lp_family/ctrlEnv/mvCtrlEnvLib.c
@@ -656,29 +656,6 @@ MV_U32 mvCtrlUsbMaxGet(void)
 
 #endif
 
-#if defined(MV_INCLUDE_LEGACY_NAND)
-/*******************************************************************************
-* mvCtrlNandSupport - Return if this controller has integrated NAND flash support
-*
-* DESCRIPTION:
-*
-* INPUT:
-*       None.
-*
-* OUTPUT:
-*       None.
-*
-* RETURN:
-*       MV_TRUE if NAND is supported and MV_FALSE otherwise
-*
-*******************************************************************************/
-MV_U32 mvCtrlNandSupport(MV_VOID)
-{
-	return 0; /* kostaz: what's that ??? */
-}
-
-#endif
-
 #if defined(MV_INCLUDE_SDIO)
 /*******************************************************************************
 * mvCtrlSdioSupport - Return if this controller has integrated SDIO flash support
diff --git a/arch/arm/mach-avantalp/avanta_lp_family/ctrlEnv/mvCtrlEnvLib.h b/arch/arm/mach-avantalp/avanta_lp_family/ctrlEnv/mvCtrlEnvLib.h
index 5007178..845a4b5 100644
--- a/arch/arm/mach-avantalp/avanta_lp_family/ctrlEnv/mvCtrlEnvLib.h
+++ b/arch/arm/mach-avantalp/avanta_lp_family/ctrlEnv/mvCtrlEnvLib.h
@@ -264,9 +264,6 @@ MV_U32 mvCtrlXorMaxUnitGet(MV_VOID);
 #if defined(MV_INCLUDE_USB)
 MV_U32 mvCtrlUsbMaxGet(MV_VOID);
 #endif
-#if defined(MV_INCLUDE_LEGACY_NAND)
-MV_U32 mvCtrlNandSupport(MV_VOID);
-#endif
 #if defined(MV_INCLUDE_SDIO)
 MV_U32 mvCtrlSdioSupport(MV_VOID);
 #endif
diff --git a/arch/arm/mach-avantalp/avanta_lp_family/ctrlEnv/mvCtrlEnvRegs.h b/arch/arm/mach-avantalp/avanta_lp_family/ctrlEnv/mvCtrlEnvRegs.h
index e4c149f..31aa595 100644
--- a/arch/arm/mach-avantalp/avanta_lp_family/ctrlEnv/mvCtrlEnvRegs.h
+++ b/arch/arm/mach-avantalp/avanta_lp_family/ctrlEnv/mvCtrlEnvRegs.h
@@ -379,7 +379,6 @@ extern "C" {
 #define MSAR_BOOT_NOR                           (0x0 << MSAR_BOOT_MODE_OFFS)
 #define MSAR_BOOT_SPI                           (0x3 << MSAR_BOOT_MODE_OFFS)
 #define MSAR_BOOT_DOVE_NAND                     (0x1 << MSAR_BOOT_MODE_OFFS)
-#define MSAR_BOOT_LEGACY_NAND                   (0x6 << MSAR_BOOT_MODE_OFFS)
 
 #define MSAR_TCLK_OFFS                          28
 #define MSAR_TCLK_MASK                          (0x1 << MSAR_TCLK_OFFS)
@@ -410,7 +409,6 @@ typedef enum {
 	MSAR_0_BOOT_SPI_FLASH,
 	MSAR_0_BOOT_PEX,
 	MSAR_0_BOOT_SATA,
-	MSAR_0_BOOT_NAND_LEGACY,
 	MSAR_0_BOOT_PROMPT,
 	MSAR_0_BOOT_SPI1_FLASH
 } MV_BOARD_BOOT_SRC;
@@ -455,38 +453,32 @@ typedef struct _mvSARBootTable {
 /*29*/ { MSAR_0_BOOT_NAND_NEW, MSAR_0_BOOT_DEV_BUS_WIDTH_8BIT, MSAR_0_NAND_PAGE_SZ_8KB, MSAR_0_NAND_ECC_16BIT }, \
 /*30*/ { 0,           5,            60,          60           }, \
 /*31*/ { 0,           2,            40,          40           }, \
-/*32*/ { MSAR_0_BOOT_NAND_LEGACY, MSAR_0_BOOT_DEV_BUS_WIDTH_8BIT, MSAR_0_NAND_PAGE_SZ_512B,     2                }, \
-/*33*/ { MSAR_0_BOOT_NAND_LEGACY, MSAR_0_BOOT_DEV_BUS_WIDTH_8BIT, MSAR_0_NAND_PAGE_SZ_8KB,       2                }, \
-/*34*/ { MSAR_0_BOOT_NAND_LEGACY, MSAR_0_BOOT_DEV_BUS_WIDTH_8BIT, MSAR_0_NAND_PAGE_SZ_512B,     3                }, \
-/*35*/ { MSAR_0_BOOT_NAND_LEGACY, MSAR_0_BOOT_DEV_BUS_WIDTH_8BIT, MSAR_0_NAND_PAGE_SZ_8KB,       3                }, \
-/*36*/ { MSAR_0_BOOT_NAND_LEGACY, MSAR_0_BOOT_DEV_BUS_WIDTH_8BIT, MSAR_0_NAND_PAGE_SZ_512B,     3                }, \
-/*37*/ { MSAR_0_BOOT_NAND_LEGACY, MSAR_0_BOOT_DEV_BUS_WIDTH_8BIT, MSAR_0_NAND_PAGE_SZ_8KB,       2                }, \
-/*38*/ { 0,           1,            2,            2              }, \
-/*39*/ { 0,           3,            6,            6              }, \
-/*40*/ { 0,           3,            5,            5              }, \
-/*41*/ { 0,           2,            6,            3              }, \
-/*42*/ { 0,           4,            10,          5              }, \
-/*43*/ { 0,           3,            6,            6              }, \
-/*44*/ { 0,           2,            4,            4              }, \
-/*45*/ { 0,           3,            6,            3              }, \
-/*46*/ { 0,           2,            5,            5              }, \
-/*47*/ { MSAR_0_BOOT_PROMPT,         2,            5,            5              }, \
-/*48*/ { MSAR_0_BOOT_UART,               1,            3,            3              }, \
-/*49*/ { MSAR_0_BOOT_SATA,                5,            10,          10           }, \
-/*50*/ { MSAR_0_BOOT_PEX,   3,            8,            4              }, \
-/*51*/ { MSAR_0_BOOT_PEX,   1,            2,            1              }, \
-/*52*/ { 0,           3,            6,            3              }, \
-/*53*/ { 0,           2,            8,            4              }, \
-/*54*/ { 0,           5,            10,          5              }, \
-/*55*/ { 0,           1,            20,          20           }, \
-/*56*/ { MSAR_0_BOOT_SPI_FLASH,     MSAR_0_SPI0, MSAR_0_BOOT_DEV_BUS_WIDTH_SPI_24_16BIT, 60        }, \
-/*57*/ { MSAR_0_BOOT_SPI_FLASH,     MSAR_0_SPI0, MSAR_0_BOOT_DEV_BUS_WIDTH_SPI_32BIT, 60               }, \
-/*58*/ { MSAR_0_BOOT_SPI_FLASH,     MSAR_0_SPI1, MSAR_0_BOOT_DEV_BUS_WIDTH_SPI_24_16BIT, 60        }, \
-/*59*/ { MSAR_0_BOOT_SPI_FLASH,     MSAR_0_SPI1, MSAR_0_BOOT_DEV_BUS_WIDTH_SPI_32BIT, 60               }, \
-/*60*/ { MSAR_0_BOOT_SPI_FLASH,     MSAR_0_SPI0, MSAR_0_BOOT_DEV_BUS_WIDTH_SPI_24_16BIT, 60        }, \
-/*61*/ { MSAR_0_BOOT_SPI_FLASH,     MSAR_0_SPI0, MSAR_0_BOOT_DEV_BUS_WIDTH_SPI_32BIT, 60               }, \
-/*62*/ { MSAR_0_BOOT_SPI_FLASH,     MSAR_0_SPI1, MSAR_0_BOOT_DEV_BUS_WIDTH_SPI_24_16BIT, 60        }, \
-/*63*/ { MSAR_0_BOOT_SPI_FLASH,     MSAR_0_SPI1, MSAR_0_BOOT_DEV_BUS_WIDTH_SPI_32BIT, 40               } \
+/*32*/ { 0,           1,            2,            2              }, \
+/*33*/ { 0,           3,            6,            6              }, \
+/*34*/ { 0,           3,            5,            5              }, \
+/*35*/ { 0,           2,            6,            3              }, \
+/*36*/ { 0,           4,            10,          5              }, \
+/*37*/ { 0,           3,            6,            6              }, \
+/*38*/ { 0,           2,            4,            4              }, \
+/*39*/ { 0,           3,            6,            3              }, \
+/*40*/ { 0,           2,            5,            5              }, \
+/*41*/ { MSAR_0_BOOT_PROMPT,         2,            5,            5              }, \
+/*42*/ { MSAR_0_BOOT_UART,               1,            3,            3              }, \
+/*43*/ { MSAR_0_BOOT_SATA,                5,            10,          10           }, \
+/*44*/ { MSAR_0_BOOT_PEX,   3,            8,            4              }, \
+/*45*/ { MSAR_0_BOOT_PEX,   1,            2,            1              }, \
+/*46*/ { 0,           3,            6,            3              }, \
+/*47*/ { 0,           2,            8,            4              }, \
+/*48*/ { 0,           5,            10,          5              }, \
+/*49*/ { 0,           1,            20,          20           }, \
+/*50*/ { MSAR_0_BOOT_SPI_FLASH,     MSAR_0_SPI0, MSAR_0_BOOT_DEV_BUS_WIDTH_SPI_24_16BIT, 60        }, \
+/*51*/ { MSAR_0_BOOT_SPI_FLASH,     MSAR_0_SPI0, MSAR_0_BOOT_DEV_BUS_WIDTH_SPI_32BIT, 60               }, \
+/*52*/ { MSAR_0_BOOT_SPI_FLASH,     MSAR_0_SPI1, MSAR_0_BOOT_DEV_BUS_WIDTH_SPI_24_16BIT, 60        }, \
+/*53*/ { MSAR_0_BOOT_SPI_FLASH,     MSAR_0_SPI1, MSAR_0_BOOT_DEV_BUS_WIDTH_SPI_32BIT, 60               }, \
+/*54*/ { MSAR_0_BOOT_SPI_FLASH,     MSAR_0_SPI0, MSAR_0_BOOT_DEV_BUS_WIDTH_SPI_24_16BIT, 60        }, \
+/*55*/ { MSAR_0_BOOT_SPI_FLASH,     MSAR_0_SPI0, MSAR_0_BOOT_DEV_BUS_WIDTH_SPI_32BIT, 60               }, \
+/*56*/ { MSAR_0_BOOT_SPI_FLASH,     MSAR_0_SPI1, MSAR_0_BOOT_DEV_BUS_WIDTH_SPI_24_16BIT, 60        }, \
+/*57*/ { MSAR_0_BOOT_SPI_FLASH,     MSAR_0_SPI1, MSAR_0_BOOT_DEV_BUS_WIDTH_SPI_32BIT, 40               } \
 }
 
 typedef struct {
diff --git a/arch/arm/mach-avantalp/avanta_lp_family/ctrlEnv/mvCtrlEnvSpec.h b/arch/arm/mach-avantalp/avanta_lp_family/ctrlEnv/mvCtrlEnvSpec.h
index 966a206..de0c942 100755
--- a/arch/arm/mach-avantalp/avanta_lp_family/ctrlEnv/mvCtrlEnvSpec.h
+++ b/arch/arm/mach-avantalp/avanta_lp_family/ctrlEnv/mvCtrlEnvSpec.h
@@ -296,21 +296,18 @@ extern "C" {
 		0x11111111,     /* NAND_V2_BOOT_DEVICE  */ \
 		0x00020020,     /* SPI_BOOT_DEVICE	*/ \
 		0x44024420,     /* SPI_BOOT_DEVICE & SPDIF Audio	*/ \
-		0x55555555,     /* NAND_V1_BOOT_DEVICE	*/ \
 }
 
 typedef enum {
 	NAND_BOOT_V2,
 	SPI0_BOOT,
 	SPI0_BOOT_SPDIF_AUDIO,
-	NAND_BOOT_V1
 } MV_GROUP_0_TYPE;
 
 #define MPP_GROUP_1_TYPE { \
 		0x22111111,     /* NAND_V2_BOOT_DEVICE  */ \
 		0x22000022,     /* SPI_BOOT_DEVICE	*/ \
 		0x22044022,     /* SPI_BOOT_DEVICE & SPDIF Audio	*/ \
-		0x22555555,     /* NAND_V1_BOOT_DEVICE	*/ \
 }
 
 #define MV_GROUP_1_TYPE         MV_GROUP_0_TYPE
-- 
1.7.5.4

