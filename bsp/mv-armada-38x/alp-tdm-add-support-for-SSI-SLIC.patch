From ee8bd5f1a81e60e49447af51ea2426de70206dfa Mon Sep 17 00:00:00 2001
From: Hanna Hawa <hannah@marvell.com>
Date: Wed, 12 Feb 2014 21:34:03 +0200
Subject: [PATCH 1355/1825] alp: tdm: add support for SSI SLIC

https://github.com/MISL-EBU-System-SW/misl-windriver.git linux-3.4.69-14t2-read
commit 495a1e88d105ef0ea1eca4c6edc6a71cb86be1f3

	- Add TDM register configuration for SSI
	- Update the MPPs of the SLIC SSI
	- Set TDM Active unit field by 1 when using SLIC SSI option

Change-Id: I80334f0ffe6a68db85ecee602541b1715e1f378b
Signed-off-by: Hanna Hawa <hannah@marvell.com>
Reviewed-on: http://vgitil04.il.marvell.com:8080/5629
Reviewed-by: Omri Itach <omrii@marvell.com>
Tested-by: Star_Automation <star@marvell.com>
Signed-off-by: Zhong Hongbo <hongbo.zhong@windriver.com>
---
 .../avanta_lp_family/ctrlEnv/mvCtrlEnvLib.c        |    4 +++-
 .../avanta_lp_family/ctrlEnv/mvCtrlEnvRegs.h       |    5 +++++
 .../avanta_lp_family/ctrlEnv/mvCtrlEnvSpec.h       |    2 +-
 3 files changed, 9 insertions(+), 2 deletions(-)

diff --git a/arch/arm/mach-avantalp/avanta_lp_family/ctrlEnv/mvCtrlEnvLib.c b/arch/arm/mach-avantalp/avanta_lp_family/ctrlEnv/mvCtrlEnvLib.c
index e1eb1c4..d652e87 100644
--- a/arch/arm/mach-avantalp/avanta_lp_family/ctrlEnv/mvCtrlEnvLib.c
+++ b/arch/arm/mach-avantalp/avanta_lp_family/ctrlEnv/mvCtrlEnvLib.c
@@ -1171,8 +1171,10 @@ static MV_VOID mvCtrlTdmCtrlRegSet(MV_VOID)
 
 	switch (mvBoardSlicUnitTypeGet()) {
 	case MV_BOARD_SLIC_DISABLED:
-	case MV_BOARD_SLIC_SSI_ID:
 		return;
+	case MV_BOARD_SLIC_SSI_ID:
+		tdmCtrl = TDM_TYPE_SSI_LANTIQ;
+		break;
 	case MV_BOARD_SLIC_ISI_ID:
 		tdmCtrl = (ISI_MODE | ISI_MODE_CS_DEASSERT_BIT_COUNT_VAL | SPI_B_MODE_ISI_ENABLE_MASK);
 		break;
diff --git a/arch/arm/mach-avantalp/avanta_lp_family/ctrlEnv/mvCtrlEnvRegs.h b/arch/arm/mach-avantalp/avanta_lp_family/ctrlEnv/mvCtrlEnvRegs.h
index f6cf159..49ecc87 100644
--- a/arch/arm/mach-avantalp/avanta_lp_family/ctrlEnv/mvCtrlEnvRegs.h
+++ b/arch/arm/mach-avantalp/avanta_lp_family/ctrlEnv/mvCtrlEnvRegs.h
@@ -105,6 +105,11 @@ extern "C" {
 #define SPI_B_MODE_ISI_ENABLE_OFFS		14
 #define SPI_B_MODE_ISI_ENABLE_MASK		(1 << SPI_B_MODE_ISI_ENABLE_OFFS)
 
+#define TDM_TYPE_OFFS				0
+#define TDM_TYPE_MASK				(1 << TDM_TYPE_OFFS)
+#define TDM_TYPE_TDM_VUNIT			(0 << TDM_TYPE_OFFS)
+#define TDM_TYPE_SSI_LANTIQ			(1 << TDM_TYPE_OFFS)
+
 /*
  * SoC Device Multiplex Register
  */
diff --git a/arch/arm/mach-avantalp/avanta_lp_family/ctrlEnv/mvCtrlEnvSpec.h b/arch/arm/mach-avantalp/avanta_lp_family/ctrlEnv/mvCtrlEnvSpec.h
index 70b8e88..4066ad6 100644
--- a/arch/arm/mach-avantalp/avanta_lp_family/ctrlEnv/mvCtrlEnvSpec.h
+++ b/arch/arm/mach-avantalp/avanta_lp_family/ctrlEnv/mvCtrlEnvSpec.h
@@ -288,7 +288,7 @@ typedef enum {
 
 #define MPP_GROUP_2_TYPE { \
 	0x00002222,     /* SLIC_DISABLED  */ \
-	0x33032222,     /* SLIC_SSI_DEV  */ \
+	0x11112222,     /* SLIC_SSI_DEV  */ \
 	0x33030222,     /* SLIC_ISI_DEV  */ \
 	0x44442222,     /* SLIC_ZSI_DEV  */ \
 	0x22222222,     /* SLIC_EXTERNAL_DEV	*/ \
-- 
1.7.5.4

