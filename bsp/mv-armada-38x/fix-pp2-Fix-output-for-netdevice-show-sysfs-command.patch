From 86c6a8fcb799ebb2ee83a9fa0f56d5ece24abf8b Mon Sep 17 00:00:00 2001
From: Dmitri Epshtein <dima@marvell.com>
Date: Mon, 12 May 2014 18:21:27 -0400
Subject: [PATCH 1657/1825] fix: pp2: Fix output for netdevice show sysfs
 command

https://github.com/MISL-EBU-System-SW/misl-windriver.git linux-3.4.69-14t2-read
commit 6fcc5c5981bac741e5cf657f3f9852cdda1459e9

	echo [if_name]  > pp3/gbe/netdev
	Check if interface is MUX interface
	Show MUX interfaces for each physical interface

Change-Id: I06066d20deeb2f532575ddf19871bed8a656debd
Signed-off-by: Dmitri Epshtein <dima@marvell.com>
Reviewed-on: http://vgitil04.il.marvell.com:8080/7963
Tested-by: Star_Automation <star@marvell.com>
Reviewed-by: Uri Eliyahu <uriel@marvell.com>
Signed-off-by: Zhong Hongbo <hongbo.zhong@windriver.com>
---
 .../mv_drivers_lsp/mv_pp2/net_dev/mv_netdev.c      |   20 +++++++++++---------
 1 files changed, 11 insertions(+), 9 deletions(-)

diff --git a/arch/arm/plat-armada/mv_drivers_lsp/mv_pp2/net_dev/mv_netdev.c b/arch/arm/plat-armada/mv_drivers_lsp/mv_pp2/net_dev/mv_netdev.c
index d919f58..17c8a5f 100644
--- a/arch/arm/plat-armada/mv_drivers_lsp/mv_pp2/net_dev/mv_netdev.c
+++ b/arch/arm/plat-armada/mv_drivers_lsp/mv_pp2/net_dev/mv_netdev.c
@@ -5121,7 +5121,7 @@ void mv_eth_ext_pool_print(struct eth_port *pp)
  ***********************************************************************************/
 void mv_eth_netdev_print(struct net_device *dev)
 {
-	printk(KERN_ERR "%s net_device status: dev=%p\n\n", dev->name, dev);
+	printk(KERN_ERR "%s net_device status:\n\n", dev->name);
 	printk(KERN_ERR "ifIdx=%d, mtu=%u, pkt_size=%d, buf_size=%d, MAC=" MV_MACQUAD_FMT "\n",
 		dev->ifindex, dev->mtu, RX_PKT_SIZE(dev->mtu),
 		(int)RX_BUF_SIZE(RX_PKT_SIZE(dev->mtu)), MV_MACQUAD(dev->dev_addr));
@@ -5135,17 +5135,19 @@ void mv_eth_netdev_print(struct net_device *dev)
 		 (unsigned int)(dev->features), (unsigned int)(dev->vlan_features));
 #endif
 
-	printk(KERN_ERR "flags=0x%x, gflags=0x%x: running=%d, oper_up=%d\n",
-			(unsigned int)(dev->flags), (unsigned int)(dev->flags), netif_running(dev), netif_oper_up(dev));
+	pr_info("flags=0x%x, gflags=0x%x: running=%d, oper_up=%d\n",
+		(unsigned int)(dev->flags), (unsigned int)(dev->flags), netif_running(dev), netif_oper_up(dev));
+	pr_info("uc_promisc=%d, promiscuity=%d, allmulti=%d\n", dev->uc_promisc, dev->promiscuity, dev->allmulti);
 
 	if (mv_eth_netdev_find(dev->ifindex)) {
 		struct eth_port *pp = MV_ETH_PRIV(dev);
-
-		if (pp)
-			printk(KERN_ERR "pp=%p\n", pp);
-	} else
-		/* mux net device */
-		mv_mux_netdev_print(dev);
+		if (pp->tagged)
+			mv_mux_netdev_print_all(pp->port);
+	} else {
+		/* Check if this is mux netdevice */
+		if (mv_mux_netdev_find(dev->ifindex) != -1)
+			mv_mux_netdev_print(dev);
+	}
 }
 
 void mv_eth_status_print(void)
-- 
1.7.5.4

