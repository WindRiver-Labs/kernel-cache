From 404a3957deb8dcbaffa2bc764ea68eaafab3f7e5 Mon Sep 17 00:00:00 2001
From: Tawfik Bayouk <tawfik@marvell.com>
Date: Tue, 21 Aug 2012 17:34:07 +0300
Subject: [PATCH 0095/1825] DSMP: Enabling Wake on Lan feature in Neta driver

https://github.com/MISL-EBU-System-SW/misl-windriver.git linux-3.4.69-14t2-read
commit c6a6e1d8182f5c1d9c669f465cffc9bfa790c0de

Change-Id: I3ccbadd1fae3a59fa6a5fb1cd22e3e0ca120a3fc
Signed-off-by: Tawfik Bayouk <tawfik@marvell.com>
Signed-off-by: Kosta Zertsekel <konszert@marvell.com>
Signed-off-by: Zhong Hongbo <hongbo.zhong@windriver.com>
---
 arch/arm/mach-armadaxp/pm.c |   14 ++++++++------
 1 files changed, 8 insertions(+), 6 deletions(-)

diff --git a/arch/arm/mach-armadaxp/pm.c b/arch/arm/mach-armadaxp/pm.c
index 63b98e3..86faefd 100644
--- a/arch/arm/mach-armadaxp/pm.c
+++ b/arch/arm/mach-armadaxp/pm.c
@@ -42,7 +42,8 @@ static int armadaxp_pm_valid(suspend_state_t state)
  */
 static int armadaxp_pm_enter(suspend_state_t state)
 {
-	unsigned int reg;
+
+	MV_U32 reg;
 
 	switch (state)	{
 	case PM_SUSPEND_STANDBY:
@@ -58,7 +59,8 @@ static int armadaxp_pm_enter(suspend_state_t state)
 		reg &= ~0x1;
 		MV_REG_WRITE(CPU_INT_SOURCE_CONTROL_REG(IRQ_AURORA_IN_DRBL_LOW), reg);
 
-#if 0
+#ifdef CONFIG_MV_ETH_PNC_WOL
+
 		printk(KERN_INFO "Entering Wol Mode (Neta IRQs 8,10,12,14 are enabled now)...\n");
 
 		/* Reenable the NETA IRQ in order to wake from it */
@@ -77,7 +79,8 @@ static int armadaxp_pm_enter(suspend_state_t state)
 		reg = MV_REG_READ(CPU_INT_SOURCE_CONTROL_REG(IRQ_AURORA_GBE3_FIC));
 		reg |= 0x1;
 		MV_REG_WRITE(CPU_INT_SOURCE_CONTROL_REG(IRQ_AURORA_GBE3_FIC), reg);
-#endif
+#endif /* CONFIG_MV_ETH_PNC_WOL */
+
 		armadaxp_deepidle(SNOOZE);
 
 		/* Enable IPI IRQs - return to original state */
@@ -89,8 +92,7 @@ static int armadaxp_pm_enter(suspend_state_t state)
 		reg = MV_REG_READ(CPU_INT_SOURCE_CONTROL_REG(IRQ_AURORA_UART0));
 		reg &= ~0x1;
 		MV_REG_WRITE(CPU_INT_SOURCE_CONTROL_REG(IRQ_AURORA_UART0), reg);
-
-#if 0
+#ifdef CONFIG_MV_ETH_PNC_WOL
 		reg = MV_REG_READ(CPU_INT_SOURCE_CONTROL_REG(IRQ_AURORA_GBE0_FIC));
 		reg &= ~0x1;
 		MV_REG_WRITE(CPU_INT_SOURCE_CONTROL_REG(IRQ_AURORA_GBE0_FIC), reg);
@@ -108,7 +110,7 @@ static int armadaxp_pm_enter(suspend_state_t state)
 		MV_REG_WRITE(CPU_INT_SOURCE_CONTROL_REG(IRQ_AURORA_GBE3_FIC), reg);
 
 		printk(KERN_INFO "Exiting Wol Mode (Neta IRQs 8,10,12,14 are disabled now)...\n");
-#endif
+#endif /* CONFIG_MV_ETH_PNC_WOL */
 		break;
 	default:
 		return -EINVAL;
-- 
1.7.5.4

