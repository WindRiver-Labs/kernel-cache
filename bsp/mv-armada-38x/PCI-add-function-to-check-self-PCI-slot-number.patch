From 8308c6bc9134aa0e29740898ebb824db26ee9404 Mon Sep 17 00:00:00 2001
From: Kosta Zertsekel <konszert@marvell.com>
Date: Tue, 12 Mar 2013 11:13:33 +0200
Subject: [PATCH 0483/1825] PCI: add function to check self PCI slot number

https://github.com/MISL-EBU-System-SW/misl-windriver.git linux-3.4.69-14t2-read
commit 8dafdd27921e9b6c506f18943e4d0f4548f737eb

PCI HAL is must-have for every SoC that is tested on FPGA board.
For example: ArmadaXP, AvantaLP, etc.
Rationale: FPGA images usually use old PCI unit (from Disco-5/6 world).

Signed-off-by: Kosta Zertsekel <konszert@marvell.com>
Change-Id: I0efb449cd5a8eb9625c3532c083d30becfcb8ff2
Reviewed-on: http://vgitil04.il.marvell.com:8080/1255
Reviewed-by: Nadav Haklai <nadavh@marvell.com>
Tested-by: Nadav Haklai <nadavh@marvell.com>
Signed-off-by: Zhong Hongbo <hongbo.zhong@windriver.com>
---
 .../mv_hal/pci-if/pci_util/mvPciUtils.c            |   19 +++++++++++++++++++
 1 files changed, 19 insertions(+), 0 deletions(-)

diff --git a/arch/arm/plat-armada/mv_hal/pci-if/pci_util/mvPciUtils.c b/arch/arm/plat-armada/mv_hal/pci-if/pci_util/mvPciUtils.c
index 85360a3..71c4cd4 100644
--- a/arch/arm/plat-armada/mv_hal/pci-if/pci_util/mvPciUtils.c
+++ b/arch/arm/plat-armada/mv_hal/pci-if/pci_util/mvPciUtils.c
@@ -85,6 +85,25 @@ static MV_STATUS pciDetectDevice(MV_U32 pciIf, MV_U32 bus, MV_U32 dev, MV_U32 fu
 
 static MV_U32 pciDetectDeviceBars(MV_U32 pciIf, MV_U32 bus, MV_U32 dev, MV_U32 func, MV_PCI_DEVICE *pPciAgent);
 
+#ifdef MV_INCLUDE_PCI
+MV_BOOL mvBoardIsOurPciSlot(MV_U32 busNum, MV_U32 slotNum)
+{
+	MV_U32 localBusNum = mvPciLocalBusNumGet(PCI_DEFAULT_IF);
+
+	/* Our device number */
+	if (slotNum == mvPciLocalDevNumGet(PCI_DEFAULT_IF))
+		return MV_TRUE;
+
+	if (localBusNum != busNum) {
+		DB(mvOsPrintf("%s:: localBusNum %x != busNum %x.\n",
+			      __func__, localBusNum, busNum));
+		return MV_FALSE;
+	}
+
+	return MV_FALSE;
+}
+#endif
+
 /*******************************************************************************
 * mvPciScan - Scan a PCI interface bus
 *
-- 
1.7.5.4

