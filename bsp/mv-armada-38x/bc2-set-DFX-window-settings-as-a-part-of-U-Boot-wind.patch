From 0028a289afc77b1758c1f21cf5dd35c3f9f64e1e Mon Sep 17 00:00:00 2001
From: Omri Itach <omrii@marvell.com>
Date: Sun, 26 Jan 2014 18:49:27 +0200
Subject: [PATCH 1318/1825] bc2: set DFX window settings as a part of U-Boot
 windows management

https://github.com/MISL-EBU-System-SW/misl-windriver.git linux-3.4.69-14t2-read
commit 713fcaa3c17610982a797d37a2f3e278906e3f38

	- Added early init routine to set hardcoded DFX window configuration
	  (DFX registers are needed in early stage of U-Boot boot sequence)
	- Added DFX window configuration settings to U-Boot windows table
	- Removed mvBoardDfxConfig() routine

Change-Id: If626a60ed79c4a88c5f6cefb0f21aef56c5ad77f
Signed-off-by: Omri Itach <omrii@marvell.com>
Reviewed-on: http://vgitil04.il.marvell.com:8080/5309
Reviewed-by: Ofer Heifetz <oferh@marvell.com>
Reviewed-by: Kostya Porotchkin <kostap@marvell.com>
Tested-by: Star_Automation <star@marvell.com>
Signed-off-by: Zhong Hongbo <hongbo.zhong@windriver.com>
---
 .../mach-msys/msys_family/boardEnv/mvBoardEnvLib.c |   17 -----------------
 .../mach-msys/msys_family/boardEnv/mvBoardEnvLib.h |    1 -
 .../mach-msys/msys_family/ctrlEnv/mvCtrlEnvRegs.h  |   13 +++++++------
 .../mach-msys/msys_family/ctrlEnv/mvCtrlEnvSpec.h  |    2 +-
 4 files changed, 8 insertions(+), 25 deletions(-)

diff --git a/arch/arm/mach-msys/msys_family/boardEnv/mvBoardEnvLib.c b/arch/arm/mach-msys/msys_family/boardEnv/mvBoardEnvLib.c
index b5c7e25..695c1e3 100644
--- a/arch/arm/mach-msys/msys_family/boardEnv/mvBoardEnvLib.c
+++ b/arch/arm/mach-msys/msys_family/boardEnv/mvBoardEnvLib.c
@@ -150,23 +150,6 @@ MV_VOID mvBoardEnvInit(MV_VOID)
 
 }
 
-MV_U32 mvBoardDfxConfig(MV_VOID)
-{
-	MV_U32 I2C_conf;
-
-	/* set acess to DFX */
-	I2C_conf = MV_REG_READ(I2C_CONFIC_DEBUG_REG);
-	I2C_conf &= ICDR_UINIT_ID_MASK;
-	I2C_conf |= 8; /* acess to DFX */
-	MV_REG_WRITE(I2C_CONFIC_DEBUG_REG,I2C_conf);
-
-	/* open windows to DFX */
-	MV_REG_WRITE(AHB_TO_MBUS_WIN_CTRL_REG(1), 0x000f0081);
-	MV_REG_WRITE(AHB_TO_MBUS_WIN_BASE_REG(1), 0xF5000000);
-
-	return 0;
-}
-
 /*******************************************************************************
 * mvBoardModelGet - Get Board model
 *
diff --git a/arch/arm/mach-msys/msys_family/boardEnv/mvBoardEnvLib.h b/arch/arm/mach-msys/msys_family/boardEnv/mvBoardEnvLib.h
index 5521ebd..0fa4e51 100644
--- a/arch/arm/mach-msys/msys_family/boardEnv/mvBoardEnvLib.h
+++ b/arch/arm/mach-msys/msys_family/boardEnv/mvBoardEnvLib.h
@@ -253,7 +253,6 @@ typedef struct _boardInfo {
 } MV_BOARD_INFO;
 
 MV_VOID mvBoardEnvInit(MV_VOID);
-MV_U32 mvBoardDfxConfig(MV_VOID);
 MV_U16 mvBoardModelGet(MV_VOID);
 MV_U16 mvBoardRevGet(MV_VOID);
 MV_STATUS mvBoardNameGet(char *pNameBuff);
diff --git a/arch/arm/mach-msys/msys_family/ctrlEnv/mvCtrlEnvRegs.h b/arch/arm/mach-msys/msys_family/ctrlEnv/mvCtrlEnvRegs.h
index eb39ae4..cda0fe9 100644
--- a/arch/arm/mach-msys/msys_family/ctrlEnv/mvCtrlEnvRegs.h
+++ b/arch/arm/mach-msys/msys_family/ctrlEnv/mvCtrlEnvRegs.h
@@ -276,12 +276,13 @@ extern "C" {
 
 /* This enumerator defines the Marvell controller target ID  (see Address map) */
 typedef enum _mvTargetId {
-    DRAM_TARGET_ID	= 0,	/* Port 0 -> DRAM interface		*/
-    DEV_TARGET_ID	= 1,	/* Port 1 -> Device port, BootROM, SPI	*/
-    PEX0_TARGET_ID	= 4,	/* Port 4 -> PCI Express 0 		*/
-    CRYPT_TARGET_ID	= 9,	/* Port 9 --> Crypto Engine SRAM	*/
-    PNC_BM_TARGET_ID	= 12,  	/* Port 12 -> PNC + BM Unit		*/
-    MAX_TARGETS_ID
+	DRAM_TARGET_ID   = 0,	/* Port 0 -> DRAM interface		*/
+	DEV_TARGET_ID    = 1,	/* Port 1 -> Device port, BootROM, SPI	*/
+	PEX0_TARGET_ID   = 4,	/* Port 4 -> PCI Express 0		*/
+	DFX_TARGET_ID    = 8,	/* Port 8 -> DFX Server			*/
+	CRYPT_TARGET_ID  = 9,	/* Port 9 --> Crypto Engine SRAM	*/
+	PNC_BM_TARGET_ID = 12,	/* Port 12 -> PNC + BM Unit		*/
+	MAX_TARGETS_ID
 } MV_TARGET_ID;
 
 
diff --git a/arch/arm/mach-msys/msys_family/ctrlEnv/mvCtrlEnvSpec.h b/arch/arm/mach-msys/msys_family/ctrlEnv/mvCtrlEnvSpec.h
index 97e4add..0e1276a 100644
--- a/arch/arm/mach-msys/msys_family/ctrlEnv/mvCtrlEnvSpec.h
+++ b/arch/arm/mach-msys/msys_family/ctrlEnv/mvCtrlEnvSpec.h
@@ -312,7 +312,7 @@ typedef enum _mvTarget {
 	{0xE8, PEX0_TARGET_ID	},		/*  8 PEX0_LANE0_MEM */	\
 	{0xE0, PEX0_TARGET_ID	},		/*  9 PEX0_LANE0_IO */	\
 	{0xFF, 0xFF             },		/* 10 INTER_REGS */	\
-	{0x00, 8		},		/* 11 DFX_INTER_REGS */	\
+	{0x00, DFX_TARGET_ID	},		/* 11 DFX_INTER_REGS */	\
 	{0x01, DEV_TARGET_ID    },		/* 12 DMA_UART */	\
 	{0x1E, DEV_TARGET_ID    },		/* 13 SPI_CS0 */	\
 	{0x5E, DEV_TARGET_ID    },		/* 14 SPI_CS1 */	\
-- 
1.7.5.4

