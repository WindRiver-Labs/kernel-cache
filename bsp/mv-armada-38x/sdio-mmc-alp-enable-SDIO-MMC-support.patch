From d426b547304d9a59cb80da07a68f0e8323118aa6 Mon Sep 17 00:00:00 2001
From: Kosta Zertsekel <konszert@marvell.com>
Date: Thu, 8 Aug 2013 17:48:10 +0300
Subject: [PATCH 0938/1825] sdio/mmc: alp: enable SDIO/MMC support

https://github.com/MISL-EBU-System-SW/misl-windriver.git linux-3.4.69-14t2-read
commit 7845e68ebb6c0d629e395c8e6b8c914918659e4e

Change-Id: Iae201250a7a16bd229c0f4ac09bb1c63db68a43c
Signed-off-by: Kosta Zertsekel <konszert@marvell.com>
Reviewed-on: http://vgitil04.il.marvell.com:8080/2993
Reviewed-by: Igor Patrik <igorp@marvell.com>
Tested-by: Igor Patrik <igorp@marvell.com>
Signed-off-by: Zhong Hongbo <hongbo.zhong@windriver.com>
---
 arch/arm/configs/avanta_lp_defconfig |    2 ++
 arch/arm/mach-avantalp/core.c        |    2 +-
 drivers/mmc/card/queue.c             |    2 +-
 3 files changed, 4 insertions(+), 2 deletions(-)

diff --git a/arch/arm/configs/avanta_lp_defconfig b/arch/arm/configs/avanta_lp_defconfig
index 4f9ba6c..659aa18 100644
--- a/arch/arm/configs/avanta_lp_defconfig
+++ b/arch/arm/configs/avanta_lp_defconfig
@@ -131,6 +131,8 @@ CONFIG_USB_STORAGE_FREECOM=y
 CONFIG_USB_STORAGE_SDDR09=y
 CONFIG_USB_STORAGE_SDDR55=y
 CONFIG_USB_STORAGE_JUMPSHOT=y
+CONFIG_MMC=y
+CONFIG_MMC_MVSDIO=y
 CONFIG_NEW_LEDS=y
 CONFIG_RTC_CLASS=y
 CONFIG_RTC_DRV_MV=y
diff --git a/arch/arm/mach-avantalp/core.c b/arch/arm/mach-avantalp/core.c
index 4119198..b1b631d 100644
--- a/arch/arm/mach-avantalp/core.c
+++ b/arch/arm/mach-avantalp/core.c
@@ -1448,12 +1448,12 @@ static void __init alp_board_init(void)
 	alp_sata_init();
 	alp_nand_nfc_init();
 	alp_rtc_init();
+	alp_sdio_init();
 
 #if 0
 	alp_gpio_init();
 	alp_hwmon_init();
 	alp_i2c_init();
-	alp_sdio_init();
 #endif
 }
 
diff --git a/drivers/mmc/card/queue.c b/drivers/mmc/card/queue.c
index 8ed391a..be8773e 100644
--- a/drivers/mmc/card/queue.c
+++ b/drivers/mmc/card/queue.c
@@ -20,7 +20,7 @@
 #include <linux/mmc/host.h>
 #include "queue.h"
 
-#ifdef CONFIG_ARCH_FEROCEON
+#if defined(CONFIG_ARCH_FEROCEON) || defined(CONFIG_AVANTA_LP)
 #define MMC_QUEUE_BOUNCESZ	(65536 << 2)
 #else
 #define MMC_QUEUE_BOUNCESZ	65536
-- 
1.7.5.4

