From 1a9d68497d7db3e3c9dd4b48deab074281d92216 Mon Sep 17 00:00:00 2001
From: Omri Itach <omrii@marvell.com>
Date: Tue, 4 Mar 2014 18:01:20 +0200
Subject: [PATCH 1455/1825] msys: add initial support for RD-MTL board

https://github.com/MISL-EBU-System-SW/misl-windriver.git linux-3.4.69-14t2-read
commit 92aad5f4b55680bf2a509d47cf3ece093411bb56

	- Added new compilation sequence for MSYS RD-MTL board, controlled by bobcat2_rd_mtl
	- added new board environment structures for RD-MTL
	- Updated board ID defines in tools/marvell/src_phy_msys
	- Updated mvBoardIdGet routine to distinct between boards (pre-compiled distintion)
	  (in tools/bin_hdr/src_phy_msys & in msys_family/boardenv/)

Change-Id: Idbd24ac3d074d804d20dbef7a7349dad34bbbbf5
Signed-off-by: Omri Itach <omrii@marvell.com>
Reviewed-on: http://vgitil04.il.marvell.com:8080/6124
Reviewed-by: Ofer Heifetz <oferh@marvell.com>
Tested-by: Star_Automation <star@marvell.com>
Signed-off-by: Zhong Hongbo <hongbo.zhong@windriver.com>
---
 .../mach-msys/msys_family/boardEnv/mvBoardEnvLib.c |    2 +
 .../msys_family/boardEnv/mvBoardEnvSpec.c          |   83 +++++++++++++++++++-
 .../msys_family/boardEnv/mvBoardEnvSpec.h          |   34 +++++++--
 3 files changed, 112 insertions(+), 7 deletions(-)

diff --git a/arch/arm/mach-msys/msys_family/boardEnv/mvBoardEnvLib.c b/arch/arm/mach-msys/msys_family/boardEnv/mvBoardEnvLib.c
index 1fefff7..a299c95 100644
--- a/arch/arm/mach-msys/msys_family/boardEnv/mvBoardEnvLib.c
+++ b/arch/arm/mach-msys/msys_family/boardEnv/mvBoardEnvLib.c
@@ -1219,6 +1219,8 @@ MV_U32 mvBoardIdGet(MV_VOID)
 		gBoardId = DB_DX_BC2_ID;
 #elif defined(RD_BOBCAT2)
 		gBoardId = RD_DX_BC2_ID;
+#elif defined(RD_MTL_BOBCAT2)
+		gBoardId = RD_MTL_BC2;
 #else
 		mvOsPrintf("mvBoardIdSet: Board ID must be defined!\n");
 		while (1)
diff --git a/arch/arm/mach-msys/msys_family/boardEnv/mvBoardEnvSpec.c b/arch/arm/mach-msys/msys_family/boardEnv/mvBoardEnvSpec.c
index bf6e931..8ad9a7d 100644
--- a/arch/arm/mach-msys/msys_family/boardEnv/mvBoardEnvSpec.c
+++ b/arch/arm/mach-msys/msys_family/boardEnv/mvBoardEnvSpec.c
@@ -257,9 +257,90 @@ MV_BOARD_INFO rd_dx_bc2Info = {
 	.nandFlashControl		= RD_DX_BC2_BOARD_NAND_CONTROL
 };
 
+/*****************************/
+/* BobCat2 RD BC2_MTL BOARD */
+/*****************************/
+#define RD_MTL_BC2_BOARD_NAND_READ_PARAMS		0x000C0282
+#define RD_MTL_BC2_BOARD_NAND_WRITE_PARAMS	0x00010305
+/*NAND care support for small page chips*/
+#define RD_MTL_BC2_BOARD_NAND_CONTROL			0x01c00543
+
+MV_BOARD_MAC_INFO bc2_rd_mtlInfoBoardMacInfo[] = {
+	/* {{MV_BOARD_MAC_SPEED	boardMacSpeed, MV_U8 boardEthSmiAddr}} */
+	{BOARD_MAC_SPEED_1000M, 0x0, 0x0, 0x0},
+	{BOARD_MAC_SPEED_1000M, 0x1, 0x0, 0x1},
+};
+
+MV_BOARD_MODULE_TYPE_INFO bc2_rd_mtlInfoBoardModTypeInfo[] = {
+	{
+		.boardMppMod		= MV_BOARD_AUTO,
+	}
+};
+
+MV_DEV_CS_INFO bc2_rd_mtlInfoBoardDeCsInfo[] = {
+	/*{deviceCS, params, devType, devWidth}*/
+#if defined(MV_INCLUDE_SPI)
+	{SPI_CS0, N_A, BOARD_DEV_SPI_FLASH, 8} /* SPI DEV */
+#endif
+};
+
+MV_BOARD_MPP_INFO bc2_rd_mtlInfoBoardMppConfigValue[] = {
+	{ {
+		RD_MTL_BC2_MPP0_7,
+		RD_MTL_BC2_MPP8_15,
+		RD_MTL_BC2_MPP16_23,
+		RD_MTL_BC2_MPP24_31,
+		RD_MTL_BC2_MPP32_39,
+	} }
+};
+
+MV_BOARD_INFO bc2_rd_mtlInfo = {
+	.boardName			= "RD-BC2-MTL-PoE-2QSFP-6SFP",
+	.numBoardMppTypeValue		= ARRSZ(bc2_rd_mtlInfoBoardModTypeInfo),
+	.pBoardModTypeValue		= bc2_rd_mtlInfoBoardModTypeInfo,
+	.numBoardMppConfigValue		= ARRSZ(bc2_rd_mtlInfoBoardMppConfigValue),
+	.pBoardMppConfigValue		= bc2_rd_mtlInfoBoardMppConfigValue,
+	.intsGppMaskLow			= 0,
+	.intsGppMaskMid			= 0,
+	.intsGppMaskHigh		= 0,
+	.numBoardDeviceIf		= ARRSZ(bc2_rd_mtlInfoBoardDeCsInfo),
+	.pDevCsInfo			= bc2_rd_mtlInfoBoardDeCsInfo,
+	.numBoardTwsiDev		= 0,
+	.pBoardTwsiDev			= NULL,
+	.numBoardMacInfo		= ARRSZ(bc2_rd_mtlInfoBoardMacInfo),
+	.pBoardMacInfo			= bc2_rd_mtlInfoBoardMacInfo,
+	.numBoardGppInfo		= 0,
+	.pBoardGppInfo			= NULL,
+	.activeLedsNumber		= 0,
+	.pLedGppPin			= NULL,
+	.ledsPolarity			= 0,
+
+	/* GPP values */
+	.gppOutEnValLow			= RD_MTL_BC2_GPP_OUT_ENA_LOW,
+	.gppOutEnValMid			= RD_MTL_BC2_GPP_OUT_ENA_MID,
+	.gppOutEnValHigh		= 0,
+	.gppOutValLow			= RD_MTL_BC2_GPP_OUT_VAL_LOW,
+	.gppOutValMid			= RD_MTL_BC2_GPP_OUT_VAL_MID,
+	.gppOutValHigh			= 0,
+	.gppPolarityValLow		= RD_MTL_BC2_GPP_POL_LOW,
+	.gppPolarityValMid		= RD_MTL_BC2_GPP_POL_MID,
+	.gppPolarityValHigh		= 0,
+
+	/* External Switch Configuration */
+	.pSwitchInfo = NULL,
+	.switchInfoNum = 0,
+
+	/* NAND init params */
+	.nandFlashReadParams		= RD_MTL_BC2_BOARD_NAND_READ_PARAMS,
+	.nandFlashWriteParams		= RD_MTL_BC2_BOARD_NAND_WRITE_PARAMS,
+	.nandFlashControl		= RD_MTL_BC2_BOARD_NAND_CONTROL
+};
+
 /*********************************************************************************/
 
 MV_BOARD_INFO *boardInfoTbl[] = {
 	&db_dx_bc2Info,
-	&rd_dx_bc2Info
+	&rd_dx_bc2Info,
+	&bc2_rd_mtlInfo
 };
+
diff --git a/arch/arm/mach-msys/msys_family/boardEnv/mvBoardEnvSpec.h b/arch/arm/mach-msys/msys_family/boardEnv/mvBoardEnvSpec.h
index c8f0d18..397e581 100644
--- a/arch/arm/mach-msys/msys_family/boardEnv/mvBoardEnvSpec.h
+++ b/arch/arm/mach-msys/msys_family/boardEnv/mvBoardEnvSpec.h
@@ -78,8 +78,9 @@ SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.
 /* New board ID numbers */
 #define DB_DX_BC2_ID		(BOARD_ID_BASE)
 #define RD_DX_BC2_ID		(DB_DX_BC2_ID + 1)
+#define RD_MTL_BC2		(RD_DX_BC2_ID + 1)
 
-#define MV_MAX_BOARD_ID		(RD_DX_BC2_ID + 1)
+#define MV_MAX_BOARD_ID		(RD_MTL_BC2 + 1)
 #define INVALID_BAORD_ID	0xFFFF
 
 /******************/
@@ -144,11 +145,11 @@ MPP#	NAME			IN/OUT
 /*******************/
 /* RD_DX_BC2 */
 /*******************/
-#define RD_DX_BC2_MPP0_7			0x22242222
-#define RD_DX_BC2_MPP8_15			0x11022222
-#define RD_DX_BC2_MPP16_23			0x44440004
-#define RD_DX_BC2_MPP24_31			0x34444444
-#define RD_DX_BC2_MPP32_39			0x00000003
+#define RD_DX_BC2_MPP0_7		0x22242222
+#define RD_DX_BC2_MPP8_15		0x11022222
+#define RD_DX_BC2_MPP16_23		0x44440004
+#define RD_DX_BC2_MPP24_31		0x34444444
+#define RD_DX_BC2_MPP32_39		0x00000003
 
 /* GPPs
 MPP#	NAME		IN/OUT
@@ -200,4 +201,25 @@ MPP#	NAME		IN/OUT
 #define RD_DX_BC2_GPP_POL_LOW		0x0
 #define RD_DX_BC2_GPP_POL_MID		0x0
 
+/*******************/
+/* RD_MTL_BC2 */
+/*******************/
+#define RD_MTL_BC2_MPP0_7		0x22242222
+#define RD_MTL_BC2_MPP8_15		0x11022222
+#define RD_MTL_BC2_MPP16_23		0x44440004
+#define RD_MTL_BC2_MPP24_31		0x34444444
+#define RD_MTL_BC2_MPP32_39		0x00000003
+
+#define RD_MTL_BC2_GPP_OUT_ENA_LOW	(~(BIT1 | BIT2 | BIT3 | BIT4 | BIT6 | BIT12\
+					| BIT16 | BIT20 | BIT29 | BIT30 | BIT31))
+#define RD_MTL_BC2_GPP_OUT_ENA_MID		(~(0))
+
+#define RD_MTL_BC2_GPP_OUT_VAL_LOW	(BIT1 | BIT2 | BIT3 | BIT4 | BIT6 | BIT12\
+					| BIT16 | BIT20 | BIT29 | BIT30 | BIT31)
+#define RD_MTL_BC2_GPP_OUT_VAL_MID	(0)
+
+#define RD_MTL_BC2_GPP_POL_LOW		0x0
+#define RD_MTL_BC2_GPP_POL_MID		0x0
+
 #endif /* __INCmvBoardEnvSpech */
+
-- 
1.7.5.4

