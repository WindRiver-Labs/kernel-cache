From 03995e6926a9c897f0821fb798f96e020c630e22 Mon Sep 17 00:00:00 2001
From: Tawfik Bayouk <tawfik@marvell.com>
Date: Tue, 21 Aug 2012 17:33:06 +0300
Subject: [PATCH 0037/1825] DAMP: skip SERDES config, assume boot loader did
 it

https://github.com/MISL-EBU-System-SW/misl-windriver.git linux-3.4.69-14t2-read
commit 8657a96dba9fcd8a8a6e6de83ad4cdc2e35a2c36

Adding support for an option to skip SERDES config.
If we do end up skipping the configuration,
we assume the bootloader configuration is done correctly.

Change-Id: I676f54b38820da626ce07e2daf2aa9411089dad7
Signed-off-by: Tawfik Bayouk <tawfik@marvell.com>
Signed-off-by: Kosta Zertsekel <konszert@marvell.com>
Signed-off-by: Zhong Hongbo <hongbo.zhong@windriver.com>
---
 arch/arm/mach-armadaxp/core.c |   21 ++++++++++++++++++++-
 1 files changed, 20 insertions(+), 1 deletions(-)

diff --git a/arch/arm/mach-armadaxp/core.c b/arch/arm/mach-armadaxp/core.c
index 5bd1785..cbf855a 100644
--- a/arch/arm/mach-armadaxp/core.c
+++ b/arch/arm/mach-armadaxp/core.c
@@ -306,6 +306,7 @@ __setup("sp_enable", spec_prefesth_setup);
 #else
 	MV_U32 support_wait_for_interrupt = 0x1;
 #endif
+
 static int __init noWFI_setup(char *__unused)
 {
      support_wait_for_interrupt = 0;
@@ -314,6 +315,15 @@ static int __init noWFI_setup(char *__unused)
 
 __setup("noWFI", noWFI_setup);
 
+MV_U32 serdes_reconfig = 0x0;
+static int __init serdes_reconfig_setup(char *__unused)
+{
+     printk("Re-configuring Serdes,bootloader configuration will be overwritten !!!\n");
+     serdes_reconfig = 1;
+     return 1;
+}
+__setup("serdes_reconfigure", serdes_reconfig_setup);
+
 MV_U32 support_Z1A_serdes_cfg = 0x0;
 static int __init serdesZ1A_setup(char *__unused)
 {
@@ -1188,7 +1198,10 @@ static void __init axp_db_init(void)
 	/* Before initializing the HAL, select Z1A serdes cfg if needed */
 	if (support_Z1A_serdes_cfg)
 		mvBoardSerdesZ1ASupport();
-
+	/*A0 we don't want to overwrite the Serdes configuration done by the bootloader */
+#ifdef CONFIG_ARMADA_XP_REV_A0
+        mvBoardSerdesConfigurationEnableSet(MV_FALSE);
+#endif
 	/* init the Board environment */
 	mvBoardEnvInit();
 
@@ -1365,6 +1378,9 @@ static void __init axp_rdsrv_init(void)
 	/* Select appropriate Board ID for Machine */
 	gBoardId = RD_78460_SERVER_ID;
 
+#ifdef CONFIG_ARMADA_XP_REV_A0
+        mvBoardSerdesConfigurationEnableSet(MV_FALSE);
+#endif
 	/* init the Board environment */
 	mvBoardEnvInit();
 
@@ -1469,6 +1485,9 @@ static void __init axp_fpga_init(void)
 	/* Select appropriate Board ID for Machine */
 	gBoardId = FPGA_88F78XX0_ID;
 
+#ifdef CONFIG_ARMADA_XP_REV_A0
+        mvBoardSerdesConfigurationEnableSet(MV_FALSE);
+#endif
         /* init the Board environment */
        	mvBoardEnvInit();
 
-- 
1.7.5.4

