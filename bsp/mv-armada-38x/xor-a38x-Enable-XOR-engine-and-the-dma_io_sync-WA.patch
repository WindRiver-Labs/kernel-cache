From 82cd1e6fa162c517ebf6fb8fb61ca50f1a78d0b7 Mon Sep 17 00:00:00 2001
From: Nadav Haklai <nadavh@marvell.com>
Date: Wed, 30 Oct 2013 11:29:07 +0200
Subject: [PATCH 1136/1825] xor: a38x: Enable XOR engine and the dma_io_sync
 WA

https://github.com/MISL-EBU-System-SW/misl-windriver.git linux-3.4.69-14t2-read
commit 43907fbada15575d72fa7096351502d338990e9c

        Enable the XOR engine and the dma_io_sync WA

Change-Id: I21c2fa08e22cbf119ae33b7af98d3607623d2a9d
Signed-off-by: Nadav Haklai <nadavh@marvell.com>
Reviewed-on: http://vgitil04.il.marvell.com:8080/3911
Reviewed-by: Lior Amsalem <alior@marvell.com>
Signed-off-by: Zhong Hongbo <hongbo.zhong@windriver.com>
---
 arch/arm/configs/armada_385_v7smp_defconfig |    1 -
 arch/arm/mach-armada38x/core.c              |    7 ++-----
 2 files changed, 2 insertions(+), 6 deletions(-)

diff --git a/arch/arm/configs/armada_385_v7smp_defconfig b/arch/arm/configs/armada_385_v7smp_defconfig
index 0d38acc..61ac4ac 100644
--- a/arch/arm/configs/armada_385_v7smp_defconfig
+++ b/arch/arm/configs/armada_385_v7smp_defconfig
@@ -18,7 +18,6 @@ CONFIG_MV_ETH_PORTS_NUM=2
 CONFIG_MV_ETH_TXQ=8
 # CONFIG_NET_SKB_RECYCLE is not set
 # CONFIG_MV_INCLUDE_USB is not set
-# CONFIG_MV_INCLUDE_XOR is not set
 # CONFIG_MV_INCLUDE_INTEG_SATA is not set
 # CONFIG_MV_INCLUDE_SDIO is not set
 CONFIG_MV_ETH_TXQ_DESC=1024
diff --git a/arch/arm/mach-armada38x/core.c b/arch/arm/mach-armada38x/core.c
index 2a613cc..bc51185 100644
--- a/arch/arm/mach-armada38x/core.c
+++ b/arch/arm/mach-armada38x/core.c
@@ -1126,9 +1126,6 @@ void dma_io_sync(void)
 	int idx = smp_processor_id();
 	volatile u32 data;
 
-	/* interrupts bug WA */
-	return 0;
-
 	/* Write '1' to the first word of the buffer */
 	*dma_io_sync_buff_virt[idx] = 0x1;
 
@@ -1196,7 +1193,7 @@ static void __init a38x_init_iocc(void)
 	scu_enable(scu_base);
 #endif
 
-/*	dma_io_sync_wa_init(); */
+	dma_io_sync_wa_init();
 
 	return;
 }
@@ -1303,12 +1300,12 @@ static void __init a38x_board_init(void)
 	print_board_info();
 
 	a38x_init_eth();
+	a38x_xor_init();
 
 #if 0
 	a38x_rtc_init();
 	a38x_i2c_init();
 	a38x_sata_init(&a38x_sata_data);
-	a38x_xor_init();
 	a38x_spi_init();
 	a38x_sdio_init();
 	a38x_nand_nfc_init();
-- 
1.7.5.4

