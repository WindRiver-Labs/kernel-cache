From b34a3d459ba99cf05253167b2c416c9d012d0e55 Mon Sep 17 00:00:00 2001
From: Dmitri Epshtein <dima@marvell.com>
Date: Tue, 1 Oct 2013 17:41:58 -0400
Subject: [PATCH 1011/1825] fix: pp2: Change TX FIFO threshold to 58 bytes

https://github.com/MISL-EBU-System-SW/misl-windriver.git linux-3.4.69-14t2-read
commit 13185c99c155c5eff68ccafdbe7acab10dc3cf61

	For ALP and A375 Zx threshold should be less than min packet.
	For ALP and A375 A0 it can be more than min packet.

Change-Id: I4cadb7eaaf0545f26a40de2352c447898bdcb6aa
Signed-off-by: Dmitri Epshtein <dima@marvell.com>
Reviewed-on: http://vgitil04.il.marvell.com:8080/3585
Reviewed-by: Jonatan Farhadian <yonif@marvell.com>
Tested-by: Star_Automation <star@marvell.com>
Signed-off-by: Zhong Hongbo <hongbo.zhong@windriver.com>
---
 arch/arm/plat-armada/mv_hal/pp2/gbe/mvPp2Gbe.c     |    1 -
 .../arm/plat-armada/mv_hal/pp2/gmac/mvEthGmacApi.c |    3 ++-
 2 files changed, 2 insertions(+), 2 deletions(-)

diff --git a/arch/arm/plat-armada/mv_hal/pp2/gbe/mvPp2Gbe.c b/arch/arm/plat-armada/mv_hal/pp2/gbe/mvPp2Gbe.c
index 3f8b49a..0b248fd8 100644
--- a/arch/arm/plat-armada/mv_hal/pp2/gbe/mvPp2Gbe.c
+++ b/arch/arm/plat-armada/mv_hal/pp2/gbe/mvPp2Gbe.c
@@ -231,7 +231,6 @@ MV_STATUS mvPp2DefaultsSet(int port)
 	int txp, queue, txPortNum, i;
 	MV_PP2_PORT_CTRL *pPortCtrl = mvPp2PortHndlGet(port);
 
-
 	if (!MV_PON_PORT(port))
 		mvGmacDefaultsSet(port);
 
diff --git a/arch/arm/plat-armada/mv_hal/pp2/gmac/mvEthGmacApi.c b/arch/arm/plat-armada/mv_hal/pp2/gmac/mvEthGmacApi.c
index c0a2547..08f3919 100644
--- a/arch/arm/plat-armada/mv_hal/pp2/gmac/mvEthGmacApi.c
+++ b/arch/arm/plat-armada/mv_hal/pp2/gmac/mvEthGmacApi.c
@@ -177,7 +177,8 @@ void mvGmacDefaultsSet(int port)
 	/* Update TX FIFO MIN Threshold */
 	regVal = MV_REG_READ(GMAC_PORT_FIFO_CFG_1_REG(port));
 	regVal &= ~GMAC_TX_FIFO_MIN_TH_ALL_MASK;
-	regVal |= GMAC_TX_FIFO_MIN_TH_MASK(0x40);
+	/* Minimal TX threshold must be less than minimal packet length */
+	regVal |= GMAC_TX_FIFO_MIN_TH_MASK(64 - 4 - 2);
 	MV_REG_WRITE(GMAC_PORT_FIFO_CFG_1_REG(port), regVal);
 }
 
-- 
1.7.5.4

