From c3efe40985fab59e9568fb83c26672f3e38bbd5d Mon Sep 17 00:00:00 2001
From: Kosta Zertsekel <konszert@marvell.com>
Date: Mon, 29 Apr 2013 11:38:10 +0300
Subject: [PATCH 0607/1825] ALP: Fix XOR engine offset, update defconfigs

https://github.com/MISL-EBU-System-SW/misl-windriver.git linux-3.4.69-14t2-read
commit 02e064507537f4aa5ed74ac33a88525e02e08e01

Signed-off-by: Kosta Zertsekel <konszert@marvell.com>
Change-Id: I1c17d04e7b77266a6870fb4012152a60f694036a
Reviewed-on: http://vgitil04.il.marvell.com:8080/1676
Reviewed-by: Eran Ben-Avi <benavi@marvell.com>
Tested-by: Eran Ben-Avi <benavi@marvell.com>
Signed-off-by: Zhong Hongbo <hongbo.zhong@windriver.com>
---
 arch/arm/configs/avanta_lp_defconfig           |    1 +
 arch/arm/configs/avanta_lp_smp_defconfig       |    1 +
 arch/arm/mach-avantalp/core.c                  |    4 +++-
 arch/arm/mach-avantalp/include/mach/avantalp.h |    4 ++--
 4 files changed, 7 insertions(+), 3 deletions(-)

diff --git a/arch/arm/configs/avanta_lp_defconfig b/arch/arm/configs/avanta_lp_defconfig
index a39afd6..b342a09 100644
--- a/arch/arm/configs/avanta_lp_defconfig
+++ b/arch/arm/configs/avanta_lp_defconfig
@@ -131,6 +131,7 @@ CONFIG_USB_STORAGE_JUMPSHOT=y
 CONFIG_NEW_LEDS=y
 CONFIG_RTC_CLASS=y
 CONFIG_DMADEVICES=y
+CONFIG_MV_XOR=y
 CONFIG_EXT2_FS=y
 CONFIG_EXT3_FS=y
 # CONFIG_EXT3_DEFAULTS_TO_ORDERED is not set
diff --git a/arch/arm/configs/avanta_lp_smp_defconfig b/arch/arm/configs/avanta_lp_smp_defconfig
index afc47b1..2d110f4 100644
--- a/arch/arm/configs/avanta_lp_smp_defconfig
+++ b/arch/arm/configs/avanta_lp_smp_defconfig
@@ -132,6 +132,7 @@ CONFIG_USB_STORAGE_JUMPSHOT=y
 CONFIG_NEW_LEDS=y
 CONFIG_RTC_CLASS=y
 CONFIG_DMADEVICES=y
+CONFIG_MV_XOR=y
 CONFIG_EXT2_FS=y
 CONFIG_EXT3_FS=y
 # CONFIG_EXT3_DEFAULTS_TO_ORDERED is not set
diff --git a/arch/arm/mach-avantalp/core.c b/arch/arm/mach-avantalp/core.c
index 200aa20..1fce02d 100644
--- a/arch/arm/mach-avantalp/core.c
+++ b/arch/arm/mach-avantalp/core.c
@@ -1128,8 +1128,10 @@ static void __init alp_init_xor1(void)
 
 static void __init alp_init_xor(void)
 {
+#ifdef CONFIG_MV_INCLUDE_XOR
 	alp_init_xor0();
-	alp_init_xor1();
+	/* alp_init_xor1(); */
+#endif
 }
 
 /*******************************************************************************
diff --git a/arch/arm/mach-avantalp/include/mach/avantalp.h b/arch/arm/mach-avantalp/include/mach/avantalp.h
index 3f478e7..e97c8d8 100644
--- a/arch/arm/mach-avantalp/include/mach/avantalp.h
+++ b/arch/arm/mach-avantalp/include/mach/avantalp.h
@@ -64,9 +64,9 @@
 #define CRYPT_ENG_PHYS_BASE(chan)	((chan == 0) ? 0xC8010000 : 0xF4480000)
 #define CRYPT_ENG_SIZE			_64K
 
-#define XOR0_PHYS_BASE			(INTER_REGS_PHYS_BASE | 0x60900)
+#define XOR0_PHYS_BASE			(INTER_REGS_PHYS_BASE | 0x60800)
 #define XOR1_PHYS_BASE			(INTER_REGS_PHYS_BASE | 0xF0900)
-#define XOR0_HIGH_PHYS_BASE		(INTER_REGS_PHYS_BASE | 0x60B00)
+#define XOR0_HIGH_PHYS_BASE		(INTER_REGS_PHYS_BASE | 0x60A00)
 #define XOR1_HIGH_PHYS_BASE		(INTER_REGS_PHYS_BASE | 0xF0B00)
 
 #define PNC_BM_PHYS_BASE		0xF4500000
-- 
1.7.5.4

