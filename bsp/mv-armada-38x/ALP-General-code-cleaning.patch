From 7e806b07f8eaca70ac989ac2e77b5ab9eabfe948 Mon Sep 17 00:00:00 2001
From: Kosta Zertsekel <konszert@marvell.com>
Date: Wed, 20 Mar 2013 19:06:04 +0200
Subject: [PATCH 0511/1825] ALP: General code cleaning

https://github.com/MISL-EBU-System-SW/misl-windriver.git linux-3.4.69-14t2-read
commit 4c7f8a2212732bee06864d722e794f0107d04059

Signed-off-by: Kosta Zertsekel <konszert@marvell.com>
Change-Id: Iadb8429fecb5398df0bd1ba10b5b9f2029d2bd36
Reviewed-on: http://vgitil04.il.marvell.com:8080/1358
Reviewed-by: Eran Ben-Avi <benavi@marvell.com>
Tested-by: Eran Ben-Avi <benavi@marvell.com>
Signed-off-by: Zhong Hongbo <hongbo.zhong@windriver.com>
---
 arch/arm/boot/compressed/head.S                |    6 -
 arch/arm/kernel/head.S                         |    6 -
 arch/arm/mach-avantalp/ca9x2.h                 |   80 +----------------
 arch/arm/mach-avantalp/config/mvSysUsbConfig.h |   15 +---
 arch/arm/mach-avantalp/dump_cp15_regs.c        |   15 +--
 arch/arm/mach-avantalp/export.c                |    5 +-
 arch/arm/mach-avantalp/headsmp.S               |   11 --
 arch/arm/mach-avantalp/include/mach/gpio.h     |   12 +--
 arch/arm/mach-avantalp/include/mach/irqs.h     |    9 --
 arch/arm/mach-avantalp/include/mach/memory.h   |   32 ++-----
 arch/arm/mach-avantalp/include/mach/system.h   |    4 +-
 arch/arm/mach-avantalp/mv_hal_if/mvSysUsb.c    |  101 ++++++++++----------
 arch/arm/mach-avantalp/platsmp.c               |   25 +-----
 arch/arm/mach-avantalp/time.c                  |   10 +--
 arch/arm/mach-avantalp/usb.c                   |  118 +++++++++++-------------
 arch/arm/plat-armada/include/plat/gpio.h       |    3 +-
 16 files changed, 129 insertions(+), 323 deletions(-)

diff --git a/arch/arm/boot/compressed/head.S b/arch/arm/boot/compressed/head.S
index 7b7cf98..86f7762 100644
--- a/arch/arm/boot/compressed/head.S
+++ b/arch/arm/boot/compressed/head.S
@@ -195,12 +195,6 @@ not_angel:
 
 		.text
 
-		/*
-		 * kostaz: Exit from ARMv7 Debug state
-		 */
-		mov	r7, #2
-		mcr	p14, 0, r7, c0, c4, 2
-
 #ifdef CONFIG_AUTO_ZRELADDR
 		@ determine final kernel image address
 		mov	r4, pc
diff --git a/arch/arm/kernel/head.S b/arch/arm/kernel/head.S
index a6790c0..97ecf78 100644
--- a/arch/arm/kernel/head.S
+++ b/arch/arm/kernel/head.S
@@ -91,12 +91,6 @@ ENTRY(stext)
  THUMB(	.thumb			)	@ switch to Thumb now.
  THUMB(1:			)
 
-	/*
-	 * kostaz: Exit from ARMv7 Debug state
-	 */
-	mov	r7, #2
-	mcr	p14, 0, r7, c0, c4, 2
-
 	setmode	PSR_F_BIT | PSR_I_BIT | SVC_MODE, r9 @ ensure svc mode
 						@ and irqs disabled
 	mrc	p15, 0, r9, c0, c0		@ get processor id
diff --git a/arch/arm/mach-avantalp/ca9x2.h b/arch/arm/mach-avantalp/ca9x2.h
index 68ddc38..5e4a738 100644
--- a/arch/arm/mach-avantalp/ca9x2.h
+++ b/arch/arm/mach-avantalp/ca9x2.h
@@ -4,29 +4,6 @@
 /*
  * Physical base addresses
  */
-#if 0
-#define MV_CA9X2_CLCDC		(0x10020000)
-#define MV_CA9X2_AXIRAM		(0x10060000)
-#define MV_CA9X2_DMC		(0x100e0000)
-#define MV_CA9X2_SMC		(0x100e1000)
-#define MV_CA9X2_SCC		(0x100e2000)
-
-#define MV_CA9X2_SP805_WDT	(0x100e5000)
-#define MV_CA9X2_TZPC		(0x100e6000)
-#define MV_CA9X2_GPIO		(0x100e8000)
-#define MV_CA9X2_FASTAXI	(0x100e9000)
-#define MV_CA9X2_SLOWAXI	(0x100ea000)
-#define MV_CA9X2_TZASC		(0x100ec000)
-#define MV_CA9X2_CORESIGHT	(0x10200000)
-
-#define MV_CA9X2_SYSTIMER	(0x1e004000)
-#define MV_CA9X2_SYSWDT		(0x1e007000)
-
-#define MV_CA9X2_SP804_TIMER	(0x100e4000)
-#define MV_CA9X2_TIMER0		(MV_CA9X2_SP804_TIMER + 0x000)
-#define MV_CA9X2_TIMER1		(MV_CA9X2_SP804_TIMER + 0x020)
-#endif
-
 #define MV_CA9X2_L2CC_OFFSET	(0x8000)
 
 #define MV_CA9X2_MPIC		(0xC000)
@@ -36,59 +13,4 @@
 #define A9_MPCORE_TWD		(MV_CA9X2_MPIC + 0x0600)
 #define A9_MPCORE_GIC_DIST	(MV_CA9X2_MPIC + 0x1000)
 
-/*
- * Interrupts.  Those in {} are for AMBA devices
- */
-#define IRQ_MV_CA9X2_CLCDC	{ 76 }
-#define IRQ_MV_CA9X2_DMC	{ -1 }
-#define IRQ_MV_CA9X2_SMC	{ 77, 78 }
-#define IRQ_MV_CA9X2_TIMER0	80
-#define IRQ_MV_CA9X2_TIMER1	81
-#define IRQ_MV_CA9X2_GPIO	{ 82 }
-#define IRQ_MV_CA9X2_PMU_CPU0	92
-#define IRQ_MV_CA9X2_PMU_CPU1	93
-#define IRQ_MV_CA9X2_PMU_CPU2	94
-#define IRQ_MV_CA9X2_PMU_CPU3	95
-
-/*
- * Core tile IDs
- */
-#define V2M_CT_ID_CA9		0x0c000191
-#define V2M_CT_ID_UNSUPPORTED	0xff000191
-#define V2M_CT_ID_MASK		0xff000fff
-
-struct ct_desc {
-	u32			id;
-	const char		*name;
-	void			(*map_io)(void);
-	void			(*init_early)(void);
-	void			(*init_irq)(void);
-	void			(*init_tile)(void);
-#ifdef CONFIG_SMP
-	void			(*init_cpu_map)(void);
-	void			(*smp_enable)(unsigned int);
-#endif
-};
-
-extern struct ct_desc *ct_desc;
-
-extern struct ct_desc ct_ca9x4_desc;
-
-#define AMBA_DEVICE(name,busid,base,plat)	\
-struct amba_device name##_device = {		\
-	.dev		= {			\
-		.coherent_dma_mask = ~0UL,	\
-		.init_name = busid,		\
-		.platform_data = plat,		\
-	},					\
-	.res		= {			\
-		.start	= base,			\
-		.end	= base + SZ_4K - 1,	\
-		.flags	= IORESOURCE_MEM,	\
-	},					\
-	.dma_mask	= ~0UL,			\
-	.irq		= IRQ_##base,		\
-	/* .dma		= DMA_##base,*/		\
-}
-
-#endif
+#endif /* __MACH_MV_CA9X2_H */
diff --git a/arch/arm/mach-avantalp/config/mvSysUsbConfig.h b/arch/arm/mach-avantalp/config/mvSysUsbConfig.h
index 7c82f5c..4600193 100644
--- a/arch/arm/mach-avantalp/config/mvSysUsbConfig.h
+++ b/arch/arm/mach-avantalp/config/mvSysUsbConfig.h
@@ -17,20 +17,7 @@ DISCLAIMED.  The GPL License provides additional details about this warranty
 disclaimer.
 
 *******************************************************************************/
-/*******************************************************************************
-* mvSysUsbConfig.h - Marvell USB unit specific configurations
-*
-* DESCRIPTION:
-*       None.
-*
-* DEPENDENCIES:
-*       None.
-*
-*******************************************************************************/
 
 #include "mvSysHwConfig.h"
 
-/*
-** Base address for USB registers.
-*/
-#define MV_USB_REGS_BASE(unit) 		(MV_USB_REGS_OFFSET(unit))
+#define MV_USB_REGS_BASE(unit)		MV_USB_REGS_OFFSET(unit)
diff --git a/arch/arm/mach-avantalp/dump_cp15_regs.c b/arch/arm/mach-avantalp/dump_cp15_regs.c
index bc4901e..69406c3 100644
--- a/arch/arm/mach-avantalp/dump_cp15_regs.c
+++ b/arch/arm/mach-avantalp/dump_cp15_regs.c
@@ -1,6 +1,4 @@
 /*
- * arch/arm/mach-dove/dump_cp15_regs.c
- *
  * This file is licensed under the terms of the GNU General Public
  * License version 2.  This program is licensed "as is" without any
  * warranty of any kind, whether express or implied.
@@ -15,9 +13,8 @@
 #include <linux/types.h>
 #include <linux/proc_fs.h>
 
-static int
-proc_dump_cp15_read(char *page, char **start, off_t off, int count, int *eof,
-			void *data)
+static int proc_dump_cp15_read(char *page, char **start, off_t off, int count,
+			       int *eof, void *data)
 {
 	char *p = page;
 	int len;
@@ -83,6 +80,7 @@ proc_dump_cp15_read(char *page, char **start, off_t off, int count, int *eof,
 	
 	asm volatile("mrc p15, 0, %0, c0, c2, 5": "=r"(value));
 	p += sprintf(p, "Set Attribute 5: 0x%08x\n", value);
+
 #ifdef CONFIG_CPU_V7
 	asm volatile("mrc p15, 1, %0, c0, c0, 0": "=r"(value));
 	p += sprintf(p, "Current Cache Size ID: 0x%08x\n", value);
@@ -95,7 +93,6 @@ proc_dump_cp15_read(char *page, char **start, off_t off, int count, int *eof,
 
 	asm volatile("mrc p15, 2, %0, c0, c0, 0": "=r"(value));
 	p += sprintf(p, "Cache Size Selection: 0x%08x\n", value);
-
 #endif
 	asm volatile("mrc p15, 0, %0, c1, c0, 0": "=r"(value));
 	p += sprintf(p, "Control : 0x%08x\n", value);
@@ -145,7 +142,6 @@ proc_dump_cp15_read(char *page, char **start, off_t off, int count, int *eof,
 	asm volatile("mrc p15, 1, %0, c15, c1, 1": "=r"(value));
 	p += sprintf(p, "Auxiliary Debug Modes Control 1: 0x%08x\n", value);
 
-#if 1
 	asm volatile("mrc p15, 1, %0, c15, c1, 0": "=r"(value));
 	p += sprintf(p, "Control Configuration: 0x%08x\n", value);
 	p += sprintf(p, "    Write Buffer Coalescing\t: %s\n", (value & (1 << 8)) ?
@@ -161,7 +157,7 @@ proc_dump_cp15_read(char *page, char **start, off_t off, int count, int *eof,
 
 	p += sprintf(p, "    Streaming\t: %s\n", (value & (1 << 29)) ?
 		     "Enabled" : "Disabled");
-#endif	
+
 	asm volatile("mrc p15, 1, %0, c15, c12, 0": "=r"(value));
 	p += sprintf(p, "CPU ID Code Extension: 0x%08x\n", value);
 	
@@ -192,6 +188,7 @@ proc_dump_cp15_read(char *page, char **start, off_t off, int count, int *eof,
 
 	return len;
 }
+
 int dump_init_module(void)
 {
 #ifdef CONFIG_PROC_FS
@@ -199,7 +196,6 @@ int dump_init_module(void)
 	res = create_proc_entry("mv_dump_cp15", S_IRUSR, NULL);
 	if (!res)
 		return -ENOMEM;
-
 	res->read_proc = proc_dump_cp15_read;
 #endif
 
@@ -216,4 +212,3 @@ module_exit(dump_cleanup_module);
 
 MODULE_AUTHOR("Saeed Bishara");
 MODULE_LICENSE("GPL");
-
diff --git a/arch/arm/mach-avantalp/export.c b/arch/arm/mach-avantalp/export.c
index 1d01e61..22ccc3a 100644
--- a/arch/arm/mach-avantalp/export.c
+++ b/arch/arm/mach-avantalp/export.c
@@ -13,6 +13,7 @@
  * along with this program; if not, write to the Free Software
  * Foundation, Inc., 59 Temple Place, Suite 330, Boston, MA  02111-1307  USA
  */
+
 #include <linux/types.h>
 #include <linux/kernel.h>
 #include <linux/export.h>
@@ -26,7 +27,6 @@
 #include "ctrlEnv/mvCtrlEnvLib.h"
 #include "mvOs.h"
 
-
 /*************************************************************************************************************
  * Environment 
  *************************************************************************************************************/
@@ -112,7 +112,7 @@ EXPORT_SYMBOL(mvUsbGetCapRegAddr);
 EXPORT_SYMBOL(mvUsbGppInit);
 EXPORT_SYMBOL(mvUsbBackVoltageUpdate);
 #endif
-#endif /* CONFIG_MV_INCLUDE_USB */
+#endif
 
 /*************************************************************************************************************
  * CESA
@@ -174,7 +174,6 @@ EXPORT_SYMBOL(mvSFlashPowerSaveExit);
 EXPORT_SYMBOL(mvSFlashModelGet);
 #endif
 
-
 /*************************************************************************************************************
  * SATA
  *************************************************************************************************************/
diff --git a/arch/arm/mach-avantalp/headsmp.S b/arch/arm/mach-avantalp/headsmp.S
index 87fef0e..4c6042c 100644
--- a/arch/arm/mach-avantalp/headsmp.S
+++ b/arch/arm/mach-avantalp/headsmp.S
@@ -1,20 +1,9 @@
-/*
- *  linux/arch/arm/plat-versatile/headsmp.S
- *
- *  Copyright (c) 2003 ARM Limited
- *  All Rights Reserved
- *
- * This program is free software; you can redistribute it and/or modify
- * it under the terms of the GNU General Public License version 2 as
- * published by the Free Software Foundation.
- */
 #include <linux/linkage.h>
 #include <linux/init.h>
 
 	__INIT
 
 /*
- * Realview/Versatile Express specific entry point for secondary CPUs.
  * This provides a "holding pen" into which all secondary cores are held
  * until we're ready for them to initialise.
  */
diff --git a/arch/arm/mach-avantalp/include/mach/gpio.h b/arch/arm/mach-avantalp/include/mach/gpio.h
index 7ca789d..8ab7429 100644
--- a/arch/arm/mach-avantalp/include/mach/gpio.h
+++ b/arch/arm/mach-avantalp/include/mach/gpio.h
@@ -1,20 +1,16 @@
 /*
- * include/asm-arm/arch-dove/gpio.h
- *
- * Author: Tzachi Perelstein <tzachi@marvell.com>
- *
  * This file is licensed under the terms of the GNU General Public
  * License version 2.  This program is licensed "as is" without any
  * warranty of any kind, whether express or implied.
  */
 
-#ifndef __ASM_ARCH_GPIO_H
-#define __ASM_ARCH_GPIO_H
+#ifndef __MACH_GPIO_H__
+#define __MACH_GPIO_H__
 
 #include <asm/errno.h>
 #include <mach/irqs.h>
 #include <plat/gpio.h>
-#include <asm-generic/gpio.h>		/* cansleep wrappers */
+#include <asm-generic/gpio.h>
 
 #define gpio_get_value	__gpio_get_value
 #define gpio_set_value	__gpio_set_value
@@ -52,4 +48,4 @@ static inline int irq_to_gpio(int irq)
 	return -EINVAL;
 }
 
-#endif
+#endif /* __MACH_GPIO_H__ */
diff --git a/arch/arm/mach-avantalp/include/mach/irqs.h b/arch/arm/mach-avantalp/include/mach/irqs.h
index 4906f3f..51c9c1a 100644
--- a/arch/arm/mach-avantalp/include/mach/irqs.h
+++ b/arch/arm/mach-avantalp/include/mach/irqs.h
@@ -1,10 +1,4 @@
 /*
- * include/asm-arm/arch-aurora/irqs.h
- *
- * IRQ definitions for Marvell Dove MV88F6781 SoC
- *
- * Author: Tzachi Perelstein <tzachi@marvell.com>
- *
  * This file is licensed under the terms of the GNU General Public
  * License version 2.  This program is licensed "as is" without any
  * warranty of any kind, whether express or implied.
@@ -13,9 +7,6 @@
 #ifndef __ASM_ARCH_IRQS_H
 #define __ASM_ARCH_IRQS_H
 
-/*
- * Aurora Low Interrupt Controller
- */
 
 
 #define IRQ_LOCALTIMER		29
diff --git a/arch/arm/mach-avantalp/include/mach/memory.h b/arch/arm/mach-avantalp/include/mach/memory.h
index 6740ff2..a298765 100644
--- a/arch/arm/mach-avantalp/include/mach/memory.h
+++ b/arch/arm/mach-avantalp/include/mach/memory.h
@@ -1,5 +1,7 @@
 /*
- * include/asm-arm/arch-mv78xx0/memory.h
+ * This file is licensed under the terms of the GNU General Public
+ * License version 2.  This program is licensed "as is" without any
+ * warranty of any kind, whether express or implied.
  */
 
 #ifndef __ASM_ARCH_MEMORY_H
@@ -11,34 +13,16 @@
 #define PLAT_PHYS_OFFSET		UL(0x00000000)
 #endif
 
-#define BOOT_PARAMS_OFFSET      PLAT_PHYS_OFFSET + 0x100
-/* #define __virt_to_bus(x)	__virt_to_phys(x) */
-/* #define __bus_to_virt(x)	__phys_to_virt(x) */
-
+#define BOOT_PARAMS_OFFSET		PLAT_PHYS_OFFSET + 0x100
 
 /* Override the ARM default */
 #ifdef CONFIG_SPARSEMEM
-#define MAX_PHYSMEM_BITS       35
-#define SECTION_SIZE_BITS      29
-#endif
-
-#if 0
-#ifdef CONFIG_FB_DOVE_CONSISTENT_DMA_SIZE
-
-#if (CONFIG_FB_DOVE_CONSISTENT_DMA_SIZE == 0)
-#undef CONFIG_FB_DOVE_CONSISTENT_DMA_SIZE
-#define CONFIG_FB_DOVE_CONSISTENT_DMA_SIZE 2
-#endif
-
-#define CONSISTENT_DMA_SIZE \
-	(((CONFIG_FB_DOVE_CONSISTENT_DMA_SIZE + 1) & ~1) * 1024 * 1024)
-
-#endif
+#define MAX_PHYSMEM_BITS		35
+#define SECTION_SIZE_BITS		29
 #endif
 
 #ifdef CONFIG_AURORA_IO_CACHE_COHERENCY
-#define arch_is_coherent()  1  
+#define arch_is_coherent()		1
 #endif
 
-
-#endif
+#endif /* __ASM_ARCH_MEMORY_H */
diff --git a/arch/arm/mach-avantalp/include/mach/system.h b/arch/arm/mach-avantalp/include/mach/system.h
index ebcd141..50087a6 100644
--- a/arch/arm/mach-avantalp/include/mach/system.h
+++ b/arch/arm/mach-avantalp/include/mach/system.h
@@ -1,6 +1,4 @@
 /*
- * include/mach/system.h
- *
  * This file is licensed under the terms of the GNU General Public
  * License version 2. This program is licensed "as is" without any
  * warranty of any kind, whether express or implied.
@@ -34,4 +32,4 @@ static inline void arch_reset(char mode, const char *cmd)
 	while (1);/* This should never be reached */
 }
 
-#endif
+#endif /* __MACH_SYSTEM_H */
diff --git a/arch/arm/mach-avantalp/mv_hal_if/mvSysUsb.c b/arch/arm/mach-avantalp/mv_hal_if/mvSysUsb.c
index f84e065..59a8de7 100644
--- a/arch/arm/mach-avantalp/mv_hal_if/mvSysUsb.c
+++ b/arch/arm/mach-avantalp/mv_hal_if/mvSysUsb.c
@@ -1,64 +1,64 @@
 /*******************************************************************************
-Copyright (C) Marvell International Ltd. and its affiliates
+   Copyright (C) Marvell International Ltd. and its affiliates
 
-This software file (the "File") is owned and distributed by Marvell
-International Ltd. and/or its affiliates ("Marvell") under the following
-alternative licensing terms.  Once you have made an election to distribute the
-File under one of the following license alternatives, please (i) delete this
-introductory statement regarding license alternatives, (ii) delete the two
-license alternatives that you have not elected to use and (iii) preserve the
-Marvell copyright notice above.
+   This software file (the "File") is owned and distributed by Marvell
+   International Ltd. and/or its affiliates ("Marvell") under the following
+   alternative licensing terms.  Once you have made an election to distribute the
+   File under one of the following license alternatives, please (i) delete this
+   introductory statement regarding license alternatives, (ii) delete the two
+   license alternatives that you have not elected to use and (iii) preserve the
+   Marvell copyright notice above.
 
 ********************************************************************************
-Marvell Commercial License Option
+   Marvell Commercial License Option
 
-If you received this File from Marvell and you have entered into a commercial
-license agreement (a "Commercial License") with Marvell, the File is licensed
-to you under the terms of the applicable Commercial License.
+   If you received this File from Marvell and you have entered into a commercial
+   license agreement (a "Commercial License") with Marvell, the File is licensed
+   to you under the terms of the applicable Commercial License.
 
 ********************************************************************************
-Marvell GPL License Option
-
-If you received this File from Marvell, you may opt to use, redistribute and/or
-modify this File in accordance with the terms and conditions of the General
-Public License Version 2, June 1991 (the "GPL License"), a copy of which is
-available along with the File in the license.txt file or by writing to the Free
-Software Foundation, Inc., 59 Temple Place, Suite 330, Boston, MA 02111-1307 or
-on the worldwide web at http://www.gnu.org/licenses/gpl.txt.
-
-THE FILE IS DISTRIBUTED AS-IS, WITHOUT WARRANTY OF ANY KIND, AND THE IMPLIED
-WARRANTIES OF MERCHANTABILITY OR FITNESS FOR A PARTICULAR PURPOSE ARE EXPRESSLY
-DISCLAIMED.  The GPL License provides additional details about this warranty
-disclaimer.
+   Marvell GPL License Option
+
+   If you received this File from Marvell, you may opt to use, redistribute and/or
+   modify this File in accordance with the terms and conditions of the General
+   Public License Version 2, June 1991 (the "GPL License"), a copy of which is
+   available along with the File in the license.txt file or by writing to the Free
+   Software Foundation, Inc., 59 Temple Place, Suite 330, Boston, MA 02111-1307 or
+   on the worldwide web at http://www.gnu.org/licenses/gpl.txt.
+
+   THE FILE IS DISTRIBUTED AS-IS, WITHOUT WARRANTY OF ANY KIND, AND THE IMPLIED
+   WARRANTIES OF MERCHANTABILITY OR FITNESS FOR A PARTICULAR PURPOSE ARE EXPRESSLY
+   DISCLAIMED.  The GPL License provides additional details about this warranty
+   disclaimer.
 ********************************************************************************
-Marvell BSD License Option
+   Marvell BSD License Option
 
-If you received this File from Marvell, you may opt to use, redistribute and/or
-modify this File under the following licensing terms.
-Redistribution and use in source and binary forms, with or without modification,
-are permitted provided that the following conditions are met:
+   If you received this File from Marvell, you may opt to use, redistribute and/or
+   modify this File under the following licensing terms.
+   Redistribution and use in source and binary forms, with or without modification,
+   are permitted provided that the following conditions are met:
 
-    *   Redistributions of source code must retain the above copyright notice,
-	    this list of conditions and the following disclaimer.
+*   Redistributions of source code must retain the above copyright notice,
+            this list of conditions and the following disclaimer.
 
-    *   Redistributions in binary form must reproduce the above copyright
+*   Redistributions in binary form must reproduce the above copyright
         notice, this list of conditions and the following disclaimer in the
         documentation and/or other materials provided with the distribution.
 
-    *   Neither the name of Marvell nor the names of its contributors may be
+*   Neither the name of Marvell nor the names of its contributors may be
         used to endorse or promote products derived from this software without
         specific prior written permission.
 
-THIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDERS AND CONTRIBUTORS "AS IS" AND
-ANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE IMPLIED
-WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE ARE
-DISCLAIMED. IN NO EVENT SHALL THE COPYRIGHT OWNER OR CONTRIBUTORS BE LIABLE FOR
-ANY DIRECT, INDIRECT, INCIDENTAL, SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES
-(INCLUDING, BUT NOT LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES;
-LOSS OF USE, DATA, OR PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND ON
-ANY THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT
-(INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE OF THIS
-SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.
+   THIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDERS AND CONTRIBUTORS "AS IS" AND
+   ANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE IMPLIED
+   WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE ARE
+   DISCLAIMED. IN NO EVENT SHALL THE COPYRIGHT OWNER OR CONTRIBUTORS BE LIABLE FOR
+   ANY DIRECT, INDIRECT, INCIDENTAL, SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES
+   (INCLUDING, BUT NOT LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES;
+   LOSS OF USE, DATA, OR PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND ON
+   ANY THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT
+   (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE OF THIS
+   SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.
 
 *******************************************************************************/
 
@@ -75,24 +75,24 @@ SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.
 * DESCRIPTION:
 *
 * INPUT:
-*       None
+*	None
 * OUTPUT:
-*		None
+*	None
 * RETURN:
-*       None
+*	None
 *
 *******************************************************************************/
-MV_STATUS   mvSysUsbInit(MV_U32 dev, MV_BOOL isHost)
+MV_STATUS mvSysUsbInit(MV_U32 dev, MV_BOOL isHost)
 {
 	MV_USB_HAL_DATA halData;
 	MV_UNIT_WIN_INFO addrWinMap[MAX_TARGETS + 1];
 	MV_STATUS status;
 
 	status = mvCtrlAddrWinMapBuild(addrWinMap, MAX_TARGETS + 1);
-	if(status == MV_OK)
+	if (status == MV_OK)
 		status = mvUsbWinInit(dev, addrWinMap);
 
-	if(status == MV_OK) {
+	if (status == MV_OK) {
 		halData.ctrlModel = mvCtrlModelGet();
 		halData.ctrlRev = mvCtrlRevGet();
 		status = mvUsbHalInit(dev, isHost, &halData);
@@ -100,4 +100,3 @@ MV_STATUS   mvSysUsbInit(MV_U32 dev, MV_BOOL isHost)
 
 	return status;
 }
-
diff --git a/arch/arm/mach-avantalp/platsmp.c b/arch/arm/mach-avantalp/platsmp.c
index cd4f350..8b5fbaa 100644
--- a/arch/arm/mach-avantalp/platsmp.c
+++ b/arch/arm/mach-avantalp/platsmp.c
@@ -1,13 +1,9 @@
 /*
- *  linux/arch/arm/mach-vexpress/platsmp.c
- *
- *  Copyright (C) 2002 ARM Ltd.
- *  All Rights Reserved
- *
  * This program is free software; you can redistribute it and/or modify
  * it under the terms of the GNU General Public License version 2 as
  * published by the Free Software Foundation.
  */
+
 #include <linux/init.h>
 #include <linux/errno.h>
 #include <linux/smp.h>
@@ -22,8 +18,6 @@
 #include <asm/cacheflush.h>
 #include <asm/hardware/gic.h>
 #include "ca9x2.h"
-//#include <mach/motherboard.h>
-//#define V2M_PA_CS7 0x10000000
 
 #include "core.h"
 
@@ -71,11 +65,6 @@ void __init platform_smp_prepare_cpus(unsigned int max_cpus)
 	MV_REG_WRITE(AXP_CPU_RESUME_ADDR_REG(cpu),
 			virt_to_phys(axp_secondary_startup));
 #endif
-#if 0
-	writel(~0, MMIO_P2V(V2M_SYS_FLAGSCLR));
-	writel(BSYM(virt_to_phys(avantalp_secondary_startup)),
-		MMIO_P2V(V2M_SYS_FLAGSSET));
-#endif
 }
 
 /*
@@ -130,8 +119,6 @@ int __cpuinit boot_secondary(unsigned int cpu, struct task_struct *idle)
 	 * and the secondary one
 	 */
 
-early_printk("oooooooo: %s:%d ^^^^^^^^^^^^^^^^^^^^^ \n", __func__, __LINE__);
-
 	spin_lock(&boot_lock);
 
 	/*
@@ -166,13 +153,3 @@ early_printk("oooooooo: %s:%d ^^^^^^^^^^^^^^^^^^^^^ \n", __func__, __LINE__);
 
 	return pen_release != -1 ? -ENOSYS : 0;
 }
-#if 0
-void __init set_core_count(unsigned int cpu_count)
-{
-	/* Update cpu count */
-	mv_cpu_count = cpu_count;
-
-	/* Update group mask as well */
-	group_cpu_mask = ((1 << cpu_count) - 1) << (hard_smp_processor_id());
-}
-#endif
diff --git a/arch/arm/mach-avantalp/time.c b/arch/arm/mach-avantalp/time.c
index 568ab89..b2b611f 100644
--- a/arch/arm/mach-avantalp/time.c
+++ b/arch/arm/mach-avantalp/time.c
@@ -1,7 +1,7 @@
 /*
  * arch/arm/mach-avantalp/time.c
  *
- * Marvell Aurora SoC timer handling.
+ * Marvell SoC timer handling.
  *
  * This file is licensed under the terms of the GNU General Public
  * License version 2.  This program is licensed "as is" without any
@@ -248,7 +248,6 @@ static void alp_setup_clockevent(int irq, long rate)
 
 	setup_irq(irq, &alp_timer_irq);
 	clockevents_config_and_register(evt, rate, 0xf, 0xffffffff);
-	/* clockevents_register_device(evt); */
 }
 
 static void __init alp_timer_init(void)
@@ -264,15 +263,8 @@ static void __init alp_timer_init(void)
 	printk("Initializing AvantaLP SoC Timers\n");
 	ticks_per_jiffy = (rate + HZ/2) / HZ;
 
-printk("oooooooo: %s:%d: ~~~~~~~~~~~~~~~\n", __func__, __LINE__);
 	alp_setup_clocksource(0, rate);
-
-printk("oooooooo: %s:%d: ~~~~~~~~~~~~~~~\n", __func__, __LINE__);
-
-	alp_setup_clockevent(IRQ_AURORA_GLOB_TIMER1, rate);
-printk("oooooooo: %s:%d: ~~~~~~~~~~~~~~~\n", __func__, __LINE__);
 	alp_twd_init();
-printk("oooooooo: %s:%d: ~~~~~~~~~~~~~~~\n", __func__, __LINE__);
 }
 
 struct sys_timer alp_timer = {
diff --git a/arch/arm/mach-avantalp/usb.c b/arch/arm/mach-avantalp/usb.c
index 8e74eaf..6fbba75 100644
--- a/arch/arm/mach-avantalp/usb.c
+++ b/arch/arm/mach-avantalp/usb.c
@@ -1,32 +1,31 @@
 /*******************************************************************************
-Copyright (C) Marvell International Ltd. and its affiliates
+   Copyright (C) Marvell International Ltd. and its affiliates
 
-This software file (the "File") is owned and distributed by Marvell
-International Ltd. and/or its affiliates ("Marvell") under the following
-alternative licensing terms.  Once you have made an election to distribute the
-File under one of the following license alternatives, please (i) delete this
-introductory statement regarding license alternatives, (ii) delete the two
-license alternatives that you have not elected to use and (iii) preserve the
-Marvell copyright notice above.
+   This software file (the "File") is owned and distributed by Marvell
+   International Ltd. and/or its affiliates ("Marvell") under the following
+   alternative licensing terms.  Once you have made an election to distribute the
+   File under one of the following license alternatives, please (i) delete this
+   introductory statement regarding license alternatives, (ii) delete the two
+   license alternatives that you have not elected to use and (iii) preserve the
+   Marvell copyright notice above.
 
 
 ********************************************************************************
-Marvell GPL License Option
-
-If you received this File from Marvell, you may opt to use, redistribute and/or
-modify this File in accordance with the terms and conditions of the General
-Public License Version 2, June 1991 (the "GPL License"), a copy of which is
-available along with the File in the license.txt file or by writing to the Free
-Software Foundation, Inc., 59 Temple Place, Suite 330, Boston, MA 02111-1307 or
-on the worldwide web at http://www.gnu.org/licenses/gpl.txt.
-
-THE FILE IS DISTRIBUTED AS-IS, WITHOUT WARRANTY OF ANY KIND, AND THE IMPLIED
-WARRANTIES OF MERCHANTABILITY OR FITNESS FOR A PARTICULAR PURPOSE ARE EXPRESSLY
-DISCLAIMED.  The GPL License provides additional details about this warranty
-disclaimer.
+   Marvell GPL License Option
+
+   If you received this File from Marvell, you may opt to use, redistribute and/or
+   modify this File in accordance with the terms and conditions of the General
+   Public License Version 2, June 1991 (the "GPL License"), a copy of which is
+   available along with the File in the license.txt file or by writing to the Free
+   Software Foundation, Inc., 59 Temple Place, Suite 330, Boston, MA 02111-1307 or
+   on the worldwide web at http://www.gnu.org/licenses/gpl.txt.
+
+   THE FILE IS DISTRIBUTED AS-IS, WITHOUT WARRANTY OF ANY KIND, AND THE IMPLIED
+   WARRANTIES OF MERCHANTABILITY OR FITNESS FOR A PARTICULAR PURPOSE ARE EXPRESSLY
+   DISCLAIMED.  The GPL License provides additional details about this warranty
+   disclaimer.
 *******************************************************************************/
 
-//#include <linux/autoconf.h>
 #include <linux/kernel.h>
 #include <linux/pci.h>
 #include <linux/ptrace.h>
@@ -36,7 +35,7 @@ disclaimer.
 #include <linux/spinlock.h>
 #include <linux/init.h>
 #include <linux/platform_device.h>
-                                                                                                                             
+
 #include <asm/io.h>
 #include <asm/irq.h>
 
@@ -50,25 +49,24 @@ disclaimer.
 
 u32 mvIsUsbHost = 0x03;
 
-#define MV_USB_DMA_MASK		0xffffffff
-#define MAX_USB_PORTS		3
+#define MV_USB_DMA_MASK         0xffffffff
+#define MAX_USB_PORTS           3
 
 static char usb_dev_name[]  = "mv_udc";
 static char usb_host_name[] = "ehci_marvell";
 static char usb_bus_name[]  = "platform";
 
-
 static void mv_usb_release(struct device *dev)
 {
-    struct platform_device  *pdev = to_platform_device(dev); 
+	struct platform_device  *pdev = to_platform_device(dev);
 
-    /* normally not freed */
-    printk("mv_usb_release\n");
+	/* normally not freed */
+	printk("mv_usb_release\n");
 
-    kfree(pdev->resource);
-    kfree(pdev->dev.dma_mask);
-    kfree(pdev);
-} 
+	kfree(pdev->resource);
+	kfree(pdev->dev.dma_mask);
+	kfree(pdev);
+}
 
 int mv_usb_resume(int dev)
 {
@@ -81,7 +79,7 @@ int mv_usb_resume(int dev)
 	}
 
 	/* Check if this USB is mapped to this AMP group - YY */
-	if(MV_FALSE == mvUnitMapIsMine(USB0 + dev))
+	if (MV_FALSE == mvUnitMapIsMine(USB0 + dev))
 		return -EINVAL;
 
 	isHost = mvIsUsbHost & (1 << dev);
@@ -95,48 +93,43 @@ int mv_usb_resume(int dev)
 
 static int __init   mv_usb_init(void)
 {
-	int                     status, dev, num, isHost;
+	int status, dev, num, isHost;
 	char*                   name_ptr;
 	struct platform_device* mv_usb_dev_ptr;
-	int 			irq_num[3] = {	IRQ_AURORA_USB0,
-						IRQ_AURORA_USB1,
-						IRQ_AURORA_USB2};
+	int irq_num[3] = { IRQ_AURORA_USB0,
+			   IRQ_AURORA_USB1,
+			   IRQ_AURORA_USB2 };
 
-	num = mvCtrlUsbMaxGet(); 
+	num = mvCtrlUsbMaxGet();
 	if (num > MAX_USB_PORTS) {
 		printk("WARNING: Limited USB ports number to %d\n", MAX_USB_PORTS);
 		num = MAX_USB_PORTS;
 	}
 
-	for(dev=0; dev<num; dev++)
-	{
-		if (MV_FALSE == mvCtrlPwrClckGet(USB_UNIT_ID, dev))
-		{
-			printk("\nWarning Integrated USB %d is Powered Off\n",dev);
+	for (dev = 0; dev < num; dev++) {
+		if (MV_FALSE == mvCtrlPwrClckGet(USB_UNIT_ID, dev)) {
+			printk("\nWarning Integrated USB %d is Powered Off\n", dev);
 			continue;
 		}
 
-		/* Check if this USB is mapped to this AMP group - YY */
-		if(MV_FALSE == mvUnitMapIsMine(USB0 + dev))
-		{
+		/* Check if this USB is mapped to this AMP group */
+		if (MV_FALSE == mvUnitMapIsMine(USB0 + dev))
 			continue;
-		}
 
 		isHost = mvIsUsbHost & (1 << dev);
 
-		if(isHost)
+		if (isHost)
 			name_ptr = usb_host_name;
 		else
 			name_ptr = usb_dev_name;
 
-		printk("registered dev#%d asa %s\n",dev,name_ptr);
+		printk("registered dev#%d asa %s\n", dev, name_ptr);
 		status = mvSysUsbInit(dev, isHost);
 
 		mv_usb_dev_ptr = kmalloc(sizeof(struct platform_device), GFP_KERNEL);
-		if(mv_usb_dev_ptr == NULL)
-		{
+		if (mv_usb_dev_ptr == NULL) {
 			printk("Can't allocate platform_device structure - %d bytes\n",
-					sizeof(struct platform_device) );
+			       sizeof(struct platform_device) );
 			return 1;
 		}
 		memset(mv_usb_dev_ptr, 0, sizeof(struct platform_device) );
@@ -146,15 +139,14 @@ static int __init   mv_usb_init(void)
 
 		mv_usb_dev_ptr->num_resources  = 2;
 
-		mv_usb_dev_ptr->resource = (struct resource*)kmalloc(2*sizeof(struct resource), GFP_KERNEL);
-		if(mv_usb_dev_ptr->resource == NULL)
-		{
+		mv_usb_dev_ptr->resource = (struct resource*)kmalloc(2 * sizeof(struct resource), GFP_KERNEL);
+		if (mv_usb_dev_ptr->resource == NULL) {
 			printk("Can't allocate 2 resource structure - %d bytes\n",
-					2*sizeof(struct resource) );
+			       2 * sizeof(struct resource) );
 			kfree(mv_usb_dev_ptr);
 			return 1;
 		}
-		memset(mv_usb_dev_ptr->resource, 0, 2*sizeof(struct resource));
+		memset(mv_usb_dev_ptr->resource, 0, 2 * sizeof(struct resource));
 
 		mv_usb_dev_ptr->resource[0].start =
 			( INTER_REGS_BASE | MV_USB_CORE_CAP_LENGTH_REG(dev));
@@ -173,13 +165,12 @@ static int __init   mv_usb_init(void)
 		dev_set_name(&mv_usb_dev_ptr->dev, "%s", usb_bus_name);
 
 		printk("Marvell USB %s controller #%d: %p\n",
-				isHost ? "EHCI Host" : "Gadget", dev, mv_usb_dev_ptr);
+		       isHost ? "EHCI Host" : "Gadget", dev, mv_usb_dev_ptr);
 
 		status = platform_device_register(mv_usb_dev_ptr);
-		if (status)
-		{
-			printk("Can't register Marvell USB EHCI controller #%d, status=%d\n", 
-					dev, status);
+		if (status) {
+			printk("Can't register Marvell USB EHCI controller #%d, status=%d\n",
+			       dev, status);
 			return status;
 		}
 	}
@@ -187,4 +178,3 @@ static int __init   mv_usb_init(void)
 }
 
 subsys_initcall(mv_usb_init);
-
diff --git a/arch/arm/plat-armada/include/plat/gpio.h b/arch/arm/plat-armada/include/plat/gpio.h
index 28c6bd1..b37c1ba 100644
--- a/arch/arm/plat-armada/include/plat/gpio.h
+++ b/arch/arm/plat-armada/include/plat/gpio.h
@@ -20,5 +20,4 @@
 #define GPIO_INPUT_OK		(1 << 0)
 #define GPIO_OUTPUT_OK		(1 << 1)
 
-
-#endif
+#endif /* __PLAT_GPIO_H */
-- 
1.7.5.4

