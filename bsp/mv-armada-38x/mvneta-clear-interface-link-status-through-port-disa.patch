From 38eb79f5ce26ab6ff614c5f51c18f6f73981207d Mon Sep 17 00:00:00 2001
From: Liu Haitao <haitao.liu@windriver.com>
Date: Thu, 27 Jul 2017 14:30:57 +0800
Subject: [PATCH 5/5] mvneta: clear interface link status through port disable

Issue: LIN8-7049

Fix SYSTEMSW-2883:run nas_init.sh on an enabled eth will cause
eth connection down

When port connect to PHY in polling mode (1 sec), port and pny
link status must be synchronize in order don't loss link change event.

The patch was imported from the Marvell git hub :
(https://github.com/MarvellEmbeddedProcessors/linux-marvell/commit/1e6ce89e6c35292d5224967b5c8698bbb3a85eed)
as of commit id 1e6ce89e6c35292d5224967b5c8698bbb3a85eed

Change-Id: I6fa4048e5791cf56a6f7acbcbde7e02b7723fa5a
Signed-off-by: Yelena <yelena@marvell.com>
Reviewed-on: http://vgitil04.il.marvell.com:8080/34596
Tested-by: iSoC Platform CI <ykjenk@marvell.com>
Tested-by: Star_Automation <star@marvell.com>
Reviewed-by: Wilson Ding <dingwei@marvell.com>
Reviewed-by: Dmitri Epshtein <dima@marvell.com>
Reviewed-by: Neta Zur Hershkovits <neta@marvell.com>

Signed-off-by: Liu Haitao <haitao.liu@windriver.com>
---
 drivers/net/ethernet/marvell/mvneta.c |    4 ++++
 1 files changed, 4 insertions(+), 0 deletions(-)

diff --git a/drivers/net/ethernet/marvell/mvneta.c b/drivers/net/ethernet/marvell/mvneta.c
index 6ea0427..88c6c21 100644
--- a/drivers/net/ethernet/marvell/mvneta.c
+++ b/drivers/net/ethernet/marvell/mvneta.c
@@ -958,6 +958,10 @@ static void mvneta_port_disable(struct mvneta_port *pp)
 	val &= ~MVNETA_GMAC0_PORT_ENABLE;
 	mvreg_write(pp, MVNETA_GMAC_CTRL_0, val);
 
+	pp->link = 0;
+	pp->duplex = -1;
+	pp->speed = 0;
+
 	udelay(200);
 }
 
-- 
1.7.5.4

