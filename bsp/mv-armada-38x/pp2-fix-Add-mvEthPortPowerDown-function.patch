From 6bf37331233281b0307e19e320d3c92120e9a3c3 Mon Sep 17 00:00:00 2001
From: Dmitri Epshtein <dima@marvell.com>
Date: Wed, 23 Oct 2013 13:53:50 -0400
Subject: [PATCH 1048/1825] pp2: fix: Add mvEthPortPowerDown function

https://github.com/MISL-EBU-System-SW/misl-windriver.git linux-3.4.69-14t2-read
commit da062648de93b99786dce13a97b67fcf8a53edd1

Change-Id: I93b5c01e80f16f144b5a0a52054f71b729c3c0f3
Signed-off-by: Dmitri Epshtein <dima@marvell.com>
Reviewed-on: http://vgitil04.il.marvell.com:8080/3839
Reviewed-by: Jonatan Farhadian <yonif@marvell.com>
Tested-by: Star_Automation <star@marvell.com>
Signed-off-by: Zhong Hongbo <hongbo.zhong@windriver.com>
---
 .../arm/plat-armada/mv_hal/pp2/gmac/mvEthGmacApi.c |    4 ++++
 1 files changed, 4 insertions(+), 0 deletions(-)

diff --git a/arch/arm/plat-armada/mv_hal/pp2/gmac/mvEthGmacApi.c b/arch/arm/plat-armada/mv_hal/pp2/gmac/mvEthGmacApi.c
index 3b392f1..7cf4206ac 100644
--- a/arch/arm/plat-armada/mv_hal/pp2/gmac/mvEthGmacApi.c
+++ b/arch/arm/plat-armada/mv_hal/pp2/gmac/mvEthGmacApi.c
@@ -70,6 +70,7 @@ void mvEthPortEnable(int port)
 
 	regVal = MV_REG_READ(ETH_GMAC_CTRL_0_REG(port));
 	regVal |= ETH_GMAC_PORT_EN_MASK;
+	regVal |= ETH_GMAC_MIB_CNTR_EN_MASK;
 
 	MV_REG_WRITE(ETH_GMAC_CTRL_0_REG(port), regVal);
 }
@@ -184,6 +185,9 @@ void mvGmacDefaultsSet(int port)
 
 void mvEthPortPowerDown(int port)
 {
+	mvEthPortDisable(port);
+	mvEthMibCountersClear(port);
+	mvEthPortResetSet(port, MV_TRUE);
 }
 
 MV_BOOL mvEthPortIsLinkUp(int port)
-- 
1.7.5.4

