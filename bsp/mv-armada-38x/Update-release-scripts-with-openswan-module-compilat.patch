From 491a91193427e58fee2f9dd5b490f6ef75ecf30a Mon Sep 17 00:00:00 2001
From: Nadav Haklai <nadavh@marvell.com>
Date: Wed, 9 Jan 2013 13:39:16 +0200
Subject: [PATCH 0434/1825] Update release scripts with openswan module
 compilation

https://github.com/MISL-EBU-System-SW/misl-windriver.git linux-3.4.69-14t2-read
commit 11f82e6448093dfaeddb0f220a56952f30aac7f5

Change-Id: I4915f976fa63885c0aa95cbe2f184647c0765154
Reviewed-on: http://vgitil04.il.marvell.com:8080/905
Reviewed-by: Tawfik Bayouk <tawfik@marvell.com>
Tested-by: Tawfik Bayouk <tawfik@marvell.com>
Signed-off-by: Zhong Hongbo <hongbo.zhong@windriver.com>
---
 release/build_release.sh |    6 ++++++
 release/make_release     |    5 +++++
 2 files changed, 11 insertions(+), 0 deletions(-)

diff --git a/release/build_release.sh b/release/build_release.sh
index ab7f3cc..b749fed 100644
--- a/release/build_release.sh
+++ b/release/build_release.sh
@@ -24,6 +24,12 @@ zip -r -q ../linux-${2}-${1}_release.zip ./linux-${2}-${1}/
 cd ../../
 echo "DSMP LSP - Copy release config files"
 cp ./configs/* ./${1}/linux-${2}-${1}/arch/arm/configs
+cd ./${1}/linux-${2}-${1}/cesa/openswan/
+wget http://download.openswan.org/openswan/openswan-2.6.37.tar.gz
+tar -zxvf openswan-2.6.37.tar.gz
+cd openswan-2.6.37
+patch -p1 < ../0001-mv_openswan_2_6_37.patch
+cd ../../../../../
 echo "DSMP LSP - Compile external binaries"
 source ./make_release ${1} $2 binaries_external 370_v7up 370_v7up_nat 370_v7up_nas 370_v7up_stat xp_v7smp xp_v7smp_nat xp_v7smp_lpae xp_v7smp_stat xp_v7smp_nas xp_v7smp_be8 xp_amp_g1 xp_amp_g0
 echo "DSMP LSP - Remove third party SLIC source code"
diff --git a/release/make_release b/release/make_release
index 190d63e..e5e209f 100644
--- a/release/make_release
+++ b/release/make_release
@@ -27,6 +27,11 @@ do
 	cp ./System.map ../${FLDR}/$i/
 	cp .config ../${FLDR}/$i/
 	make modules_install INSTALL_MOD_PATH=../${FLDR}/$i/
+	cd cesa/openswan/openswan-2.6.37/
+	make KERNELSRC=../../../ module ARCH=arm
+	mkdir -p ../../../../${FLDR}/$i/lib/modules/${2}/kernel/ipsec
+	cp modobj26/ipsec.ko ../../../../${FLDR}/$i/lib/modules/${2}/kernel/ipsec
+	cd ../../../
 	rm -fr ../${FLDR}/$i/lib/modules/${2}/source
 	rm -fr ../${FLDR}/$i/lib/modules/${2}/build
 
-- 
1.7.5.4

