From cc0e2d071c49880d5256bbc73e3d23dab71a610a Mon Sep 17 00:00:00 2001
From: Yoni Farhadian <yonif@marvell.com>
Date: Mon, 15 Jul 2013 09:46:47 +0300
Subject: [PATCH 0852/1825] PPv2: fix: mvEthPhyAddrSet - mask phy address

https://github.com/MISL-EBU-System-SW/misl-windriver.git linux-3.4.69-14t2-read
commit d6a3bdb79d0ca22a9c17bb8e27f4044acc9bc07c

	- PHY address given as parameter is from type int
	- Port's PHY address register is using 5 bits per PHY address
	- mask PHY address parameter according to register

Change-Id: I124249e6e261b654e5b4ebab5f506c7818c5c710
Signed-off-by: Yoni Farhadian <yonif@marvell.com>
Reviewed-on: http://vgitil04.il.marvell.com:8080/2620
Reviewed-by: Dmitri Epshtein <dima@marvell.com>
Reviewed-by: Nadav Haklai <nadavh@marvell.com>
Tested-by: Nadav Haklai <nadavh@marvell.com>
Signed-off-by: Zhong Hongbo <hongbo.zhong@windriver.com>
---
 .../arm/plat-armada/mv_hal/pp2/gmac/mvEthGmacApi.c |    2 +-
 1 files changed, 1 insertions(+), 1 deletions(-)

diff --git a/arch/arm/plat-armada/mv_hal/pp2/gmac/mvEthGmacApi.c b/arch/arm/plat-armada/mv_hal/pp2/gmac/mvEthGmacApi.c
index a34ba50..d09726c 100644
--- a/arch/arm/plat-armada/mv_hal/pp2/gmac/mvEthGmacApi.c
+++ b/arch/arm/plat-armada/mv_hal/pp2/gmac/mvEthGmacApi.c
@@ -588,7 +588,7 @@ void mvEthPhyAddrSet(int port, int phyAddr)
 	regData = MV_REG_READ(ETH_PHY_ADDR_REG);
 
 	regData &= ~ETH_PHY_ADDR_MASK(port);
-	regData |= (phyAddr << ETH_PHY_ADDR_OFFS(port));
+	regData |= ((phyAddr << ETH_PHY_ADDR_OFFS(port)) & ETH_PHY_ADDR_MASK(port));
 
 	MV_REG_WRITE(ETH_PHY_ADDR_REG, regData);
 
-- 
1.7.5.4

