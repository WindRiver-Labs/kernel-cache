From 2ec63d55a91a01dc39ca2f63aad75ba483a00808 Mon Sep 17 00:00:00 2001
From: Evan <xswang@marvell.com>
Date: Tue, 27 May 2014 12:56:46 +0800
Subject: [PATCH 1683/1825] fix:alp:tpm: pbit modification fail for multicast
 packets

https://github.com/MISL-EBU-System-SW/misl-windriver.git linux-3.4.69-14t2-read
commit 69b321c7b9d91357cc0fb4257c141d114cd85d8a

	bug reason: the current swicth port egress mode is not correct.
	This patch solve the issue by changing egress mode to AS-IS.
	SYSTEMSW-657 : pbit modification fail for multicast packets.

Signed-off-by: Evan <xswang@marvell.com>

Change-Id: Icbeca883437e58de2ed3178d7d5d79b87fb7b5dc
Reviewed-on: http://vgitil04.il.marvell.com:8080/8231
Reviewed-by: Yehuda Yitschak <yehuday@marvell.com>
Tested-by: Star_Automation <star@marvell.com>
Reviewed-by: Dmitri Epshtein <dima@marvell.com>
Signed-off-by: Zhong Hongbo <hongbo.zhong@windriver.com>
---
 .../mv_drivers_lsp/mv_tpm/src/conf/tpm_mng.c       |    4 ++--
 1 files changed, 2 insertions(+), 2 deletions(-)

diff --git a/arch/arm/plat-armada/mv_drivers_lsp/mv_tpm/src/conf/tpm_mng.c b/arch/arm/plat-armada/mv_drivers_lsp/mv_tpm/src/conf/tpm_mng.c
index d8c6751..f30e90b 100644
--- a/arch/arm/plat-armada/mv_drivers_lsp/mv_tpm/src/conf/tpm_mng.c
+++ b/arch/arm/plat-armada/mv_drivers_lsp/mv_tpm/src/conf/tpm_mng.c
@@ -7029,12 +7029,12 @@ int tpm_mng_mc_switch_vtu_set(struct tpm_pkt_key_t *match_key,
 				tpm_ret = tpm_sw_port_vlan_set(port_id_tmp,
 							       vid_tmp,
 							       vid_tmp,
-							       TPM_SW_VLAN_EGRESS_KEEP_VLAN);
+							       TPM_SW_VLAN_EGRESS_ASIS);
 				IF_ERROR_STR(TPM_MNG_MOD, tpm_ret, "Switch vlan set fail\n");
 				/* Record to DB */
 				tpm_ret = tpm_db_mng_mc_vtu_set(port_id_tmp,
 								vid_tmp,
-								TPM_SW_VLAN_EGRESS_KEEP_VLAN);
+								TPM_SW_VLAN_EGRESS_ASIS);
 				IF_ERROR_STR(TPM_MNG_MOD, tpm_ret, "Set VTU to DB fail\n");
 			} else {
 				/* Del record from MNG DB */
-- 
1.7.5.4

