From d8ad7885d5f787fa6600b9171f8ef3730e4f64c0 Mon Sep 17 00:00:00 2001
From: Omri Itach <omrii@marvell.com>
Date: Wed, 10 Apr 2013 13:29:02 +0300
Subject: [PATCH 0563/1825] ALP: Updated interface base registers & removed
 unnecessary defines

https://github.com/MISL-EBU-System-SW/misl-windriver.git linux-3.4.69-14t2-read
commit 9396e36f5540f5423b27b916dc57b4a4413d11a9

Change-Id: I581553b737925ffff06ae709ea9c3ab36583f29b
Reviewed-on: http://vgitil04.il.marvell.com:8080/1530
Reviewed-by: Eran Ben-Avi <benavi@marvell.com>
Tested-by: Eran Ben-Avi <benavi@marvell.com>
Signed-off-by: Zhong Hongbo <hongbo.zhong@windriver.com>
---
 .../avanta_lp_family/boardEnv/mvBoardEnvLib.c      |    3 -
 .../avanta_lp_family/ctrlEnv/mvCtrlEnvRegs.h       |   94 --------------------
 .../avanta_lp_family/ctrlEnv/mvCtrlEnvSpec.h       |   37 ++------
 .../avanta_lp_family/ctrlEnv/sys/mvCpuIf.c         |    1 -
 4 files changed, 10 insertions(+), 125 deletions(-)

diff --git a/arch/arm/mach-avantalp/avanta_lp_family/boardEnv/mvBoardEnvLib.c b/arch/arm/mach-avantalp/avanta_lp_family/boardEnv/mvBoardEnvLib.c
index 06939ec..cbe066a 100755
--- a/arch/arm/mach-avantalp/avanta_lp_family/boardEnv/mvBoardEnvLib.c
+++ b/arch/arm/mach-avantalp/avanta_lp_family/boardEnv/mvBoardEnvLib.c
@@ -143,9 +143,6 @@ MV_VOID mvBoardEnvInit(MV_VOID)
 		MV_REG_WRITE(DEV_BUS_SYNC_CTRL, 0x11);
 	}
 
-	MV_REG_WRITE(MV_RUNIT_PMU_REGS_OFFSET + 0x4, board->pmuPwrUpPolarity);
-	MV_REG_WRITE(MV_RUNIT_PMU_REGS_OFFSET + 0x14, board->pmuPwrUpDelay);
-
 	/* Set GPP Out value */
 	MV_REG_WRITE(GPP_DATA_OUT_REG(0), board->gppOutValLow);
 	MV_REG_WRITE(GPP_DATA_OUT_REG(1), board->gppOutValMid);
diff --git a/arch/arm/mach-avantalp/avanta_lp_family/ctrlEnv/mvCtrlEnvRegs.h b/arch/arm/mach-avantalp/avanta_lp_family/ctrlEnv/mvCtrlEnvRegs.h
index c061648..01a007d 100644
--- a/arch/arm/mach-avantalp/avanta_lp_family/ctrlEnv/mvCtrlEnvRegs.h
+++ b/arch/arm/mach-avantalp/avanta_lp_family/ctrlEnv/mvCtrlEnvRegs.h
@@ -86,32 +86,6 @@ extern "C" {
 /* CIB registers offsets */
 #define MV_CIB_CTRL_CFG_REG                     (MV_COHERENCY_FABRIC_OFFSET + 0x80)
 
-/* PMU_NFABRIC PMU_NFABRIC PMU_UNIT_SERVICE Units */
-#define MV_L2C_NFABRIC_PM_CTRL_CFG_REG          (MV_PMU_NFABRIC_UNIT_SERV_OFFSET + 0x4)
-#define MV_L2C_NFABRIC_PM_CTRL_CFG_PWR_DOWN     (1 << 20)
-
-#define MV_L2C_NFABRIC_PWR_DOWN_FLOW_CTRL_REG   (MV_PMU_NFABRIC_UNIT_SERV_OFFSET + 0x8)
-
-#define PM_CONTROL_AND_CONFIG_REG(cpu)          (MV_CPU_PMU_UNIT_SERV_OFFSET(cpu) + 0x4)
-#define PM_CONTROL_AND_CONFIG_DFS_REQ           (1 << 18)
-#define PM_CONTROL_AND_CONFIG_PWDDN_REQ         (1 << 16)
-#define PM_CONTROL_AND_CONFIG_L2_PWDDN          (1 << 20)
-
-#define PM_STATUS_AND_MASK_REG(cpu)             (MV_CPU_PMU_UNIT_SERV_OFFSET(cpu) + 0xc)
-#define PM_STATUS_AND_MASK_CPU_IDLE_WAIT        (1 << 16)
-#define PM_STATUS_AND_MASK_SNP_Q_EMPTY_WAIT     (1 << 17)
-#define PM_STATUS_AND_MASK_IRQ_WAKEUP           (1 << 20)
-#define PM_STATUS_AND_MASK_FIQ_WAKEUP           (1 << 21)
-#define PM_STATUS_AND_MASK_DBG_WAKEUP           (1 << 22)
-#define PM_STATUS_AND_MASK_IRQ_MASK             (1 << 24)
-#define PM_STATUS_AND_MASK_FIQ_MASK             (1 << 25)
-
-#define PM_EVENT_STATUS_AND_MASK_REG(cpu)               (MV_CPU_PMU_UNIT_SERV_OFFSET(cpu) + 0x20)
-#define PM_EVENT_STATUS_AND_MASK_DFS_DONE_OFFS                  1
-#define PM_EVENT_STATUS_AND_MASK_DFS_DONE_MASK_OFFS             17
-
-#define PM_CPU_BOOT_ADDR_REDIRECT(cpu)          (MV_CPU_PMU_UNIT_SERV_OFFSET(cpu) + 0x24)
-
 /* Power Management Memory Power Down Registers 1 - 6 */
 #define POWER_MNG_MEM_CTRL_REG(num)             ((num) < 6 ? 0x1820C + (num) * 4 : 0x18228)
 #define PMC_MCR_NUM_COMM                        6
@@ -247,7 +221,6 @@ extern "C" {
 #define L2C_MTCMOS_CONTROL_0_REG    0x22F00
 #define L2C_MTCMOS_CONTROL_1_REG    0x22F04
 
-#define PMU_DFS_CTRL_REG(cpu)                   (MV_RUNIT_PMU_REGS_OFFSET + 0x54 + ((cpu) * 0x4))
 #define PMU_DFS_CTRL_INIT_RATIO_OFFS    24
 #define PMU_DFS_CTRL_INIT_RATIO_MASK    0x3F
 #define PMU_DFS_CTRL_RATIO_OFFS                 16
@@ -318,19 +291,6 @@ extern "C" {
 #define PMC_DDRSTOPCLOCK_EN                     (1 << PMC_DDRSTOPCLOCK_OFFS)
 #define PMC_DDRSTOPCLOCK_STOP                   (0 << PMC_DDRSTOPCLOCK_OFFS)
 
-#define SATA_IMP_TX_SSC_CTRL_REG(port)          (0xA2810 + (port) * 0x2000)
-#define SATA_GEN_1_SET_0_REG(port)                      (0xA2834 + (port) * 0x2000)
-#define SATA_GEN_1_SET_1_REG(port)                      (0xA2838 + (port) * 0x2000)
-#define SATA_GEN_2_SET_0_REG(port)                      (0xA283C + (port) * 0x2000)
-#define SATA_GEN_2_SET_1_REG(port)                      (0xA2840 + (port) * 0x2000)
-
-#define SATA_PWR_PLL_CTRL_REG(port)                     (0xA2804 + (port) * 0x2000)
-#define SATA_DIG_LP_ENA_REG(port)                       (0xA288C + (port) * 0x2000)
-#define SATA_REF_CLK_SEL_REG(port)                      (0xA2918 + (port) * 0x2000)
-#define SATA_COMPHY_CTRL_REG(port)                      (0xA2920 + (port) * 0x2000)
-#define SATA_LP_PHY_EXT_CTRL_REG(port)          (0xA2058 + (port) * 0x2000)
-#define SATA_LP_PHY_EXT_STAT_REG(port)          (0xA205C + (port) * 0x2000)
-
 #define SGMII_PWR_PLL_CTRL_REG(port)            (0x72E04 + ((port) % 2) * 0x4000 - ((port) / 2) * 0x40000)
 #define SGMII_DIG_LP_ENA_REG(port)              (0x72E8C + ((port) % 2) * 0x4000 - ((port) / 2) * 0x40000)
 #define SGMII_REF_CLK_SEL_REG(port)             (0x72F18 + ((port) % 2) * 0x4000 - ((port) / 2) * 0x40000)
@@ -339,12 +299,6 @@ extern "C" {
 #define SGMII_COMPHY_CTRL_REG(port)             (0x72F20 + ((port) % 2) * 0x4000 - ((port) / 2) * 0x40000)
 #define QSGMII_GEN_1_SETTING_REG(port)          (0x72E38 + ((port) % 2) * 0x4000 - ((port) / 2) * 0x40000)
 
-#define SERDES_LINE_MUX_REG_0_7                 0x18270
-#define SERDES_LINE_MUX_REG_8_15                0x18274
-#define QSGMII_CONTROL_1_REG                    0x18404
-/* Controler environment registers offsets */
-#define GEN_PURP_RES_1_REG                      0x182F4
-#define GEN_PURP_RES_2_REG                      0x182F8
 
 #define MPP_CONTROL_REG(id)                     (0x18000 + (id * 4))
 
@@ -362,23 +316,6 @@ extern "C" {
 #define CHIP_BOND_REG                           0x18238
 #define PCKG_OPT_MASK                           0x3
 
-#define MPP_OUTPUT_DRIVE_REG                    0x184E4
-#define MPP_GE_A_OUTPUT_DRIVE_OFFS              6
-#define MPP_GE_A_1_8_OUTPUT_DRIVE               (0x1 << MPP_GE_A_OUTPUT_DRIVE_OFFS)
-#define MPP_GE_A_2_5_OUTPUT_DRIVE               (0x2 << MPP_GE_A_OUTPUT_DRIVE_OFFS)
-#define MPP_GE_B_OUTPUT_DRIVE_OFFS              14
-#define MPP_GE_B_1_8_OUTPUT_DRIVE               (0x1 << MPP_GE_B_OUTPUT_DRIVE_OFFS)
-#define MPP_GE_B_2_5_OUTPUT_DRIVE               (0x2 << MPP_GE_B_OUTPUT_DRIVE_OFFS)
-
-#define MSAR_BOOT_MODE_OFFS                     5
-#define MSAR_BOOT_MODE_MASK                     (0xF << MSAR_BOOT_MODE_OFFS)
-#define MSAR_BOOT_NOR                           (0x0 << MSAR_BOOT_MODE_OFFS)
-#define MSAR_BOOT_SPI                           (0x3 << MSAR_BOOT_MODE_OFFS)
-#define MSAR_BOOT_DOVE_NAND                     (0x1 << MSAR_BOOT_MODE_OFFS)
-
-#define MSAR_TCLK_OFFS                          28
-#define MSAR_TCLK_MASK                          (0x1 << MSAR_TCLK_OFFS)
-
 /*****************/
 /* PUP registers */
 /*****************/
@@ -387,16 +324,9 @@ extern "C" {
 /* Extract CPU, L2, DDR clocks SAR value from
 ** SAR bits 24-27
 */
-#define MSAR_CPU_CLK_IDX(sar0, sar1)            ((((sar0) >> 21) & 0x7) + ((((sar1) >> 20) & 1) << 3))
-#define MSAR_CPU_CLK_TWSI(sar0, sar1)           ((((sar0) >> 2)  & 0x7) + (((sar1) & 1) << 3))
-#define MSAR_DDR_L2_CLK_RATIO_IDX(sar0, sar1)   ((((sar0) >> 24) & 0xF) + ((((sar1) >> 19) & 1) << 4))
-#define MSAR_DDR_L2_CLK_RATIO_TWSI(sar0)        (((sar0) >> 1)  & 0xF)
 
 #ifndef MV_ASMLANGUAGE
 
-#define MV_CPU_CLK_TBL { 1000, 1066, 1200, 1333, 1500, 1666, 1800, 2000, \
-			 600,  667,  800, 1600, 2133, 2200, 2400, 0 }
-
 typedef enum {
 	MSAR_0_BOOT_NOR_FLASH,
 	MSAR_0_BOOT_NAND_NEW,
@@ -545,36 +475,12 @@ typedef struct {
 
 #define MV_TARGET_IS_DEVICE(target)     ((target >= DEVICE_CS0) && (target <= DEVICE_CS3))
 
-#define MV_PCI_DRAM_BAR_TO_DRAM_TARGET(bar)   0
-
 #define MV_CHANGE_BOOT_CS(target) target
 
-#define TCLK_TO_COUNTER_RATIO   1   /* counters running in Tclk */
-
-#define BOOT_TARGETS_NAME_ARRAY {	\
-		BOOT_ROM_CS,			\
-		BOOT_ROM_CS,			\
-		BOOT_ROM_CS,			\
-		BOOT_ROM_CS,			\
-		BOOT_ROM_CS,			\
-		BOOT_ROM_CS,			\
-		BOOT_ROM_CS,			\
-		BOOT_ROM_CS,			\
-		TBL_TERM,			\
-		TBL_TERM,			\
-		TBL_TERM,			\
-		TBL_TERM,			\
-		TBL_TERM,			\
-		TBL_TERM,			\
-		TBL_TERM,			\
-		BOOT_ROM_CS			\
-}
-
 #define START_DEV_CS            DEV_CS0
 #define DEV_TO_TARGET(dev)      ((dev) + START_DEV_CS)
 
 #define PCI_IF0_MEM0            PEX0_MEM
-#define PCI_IF0_IO              PEX0_IO
 
 /* This enumerator defines the Marvell controller target ID  (see Address map) */
 typedef enum _mvTargetId {
diff --git a/arch/arm/mach-avantalp/avanta_lp_family/ctrlEnv/mvCtrlEnvSpec.h b/arch/arm/mach-avantalp/avanta_lp_family/ctrlEnv/mvCtrlEnvSpec.h
index 16bdd13..1ebad8c 100755
--- a/arch/arm/mach-avantalp/avanta_lp_family/ctrlEnv/mvCtrlEnvSpec.h
+++ b/arch/arm/mach-avantalp/avanta_lp_family/ctrlEnv/mvCtrlEnvSpec.h
@@ -87,27 +87,23 @@ extern "C" {
 #define MV_SPI_REGS_OFFSET(unit)                (0x10600 + (unit * 0x80))
 #define MV_TWSI_SLAVE_REGS_OFFSET(chanNum)      (0x11000 + (chanNum * 0x100))
 #define MV_UART_REGS_OFFSET(chanNum)            (0x12000 + (chanNum * 0x100))
-#define MV_RUNIT_PMU_REGS_OFFSET                (0x1C000)
 #define MV_MPP_REGS_OFFSET                      (0x18000)
 #define MV_GPP_REGS_OFFSET(unit)                (0x18100 + ((unit) * 0x40))
 #define MV_MISC_REGS_OFFSET                     (0x18200)
-#define MV_CLK_CMPLX_REGS_OFFSET        		(0x18700)
-#define MV_ETH_COMPLEX_OFFSET			0x18900
+#define MV_CLK_CMPLX_REGS_OFFSET        	(0x18700)
+#define MV_ETH_COMPLEX_OFFSET			(0x18900)
 #define MV_MBUS_REGS_OFFSET                     (0x20000)
 #define CPU_GLOBAL_BASE                         (MV_MBUS_REGS_OFFSET)
-#define MV_COHERENCY_FABRIC_OFFSET              (0x20200)
+#define MV_COHERENCY_FABRIC_OFFSET              (0x20200) /* ??? IO Error Control Register = Offset: 0x00020200 */
 #define MV_CIB_CTRL_STATUS_OFFSET               (0x20280)
 #define MV_CNTMR_REGS_OFFSET                    (0x20300)
-#define MV_CPUIF_LOCAL_REGS_OFFSET              (0x21000)
+#define MV_CPUIF_LOCAL_REGS_OFFSET              (0x21000) /**** ????? */
 #define MV_CPUIF_REGS_OFFSET(cpu)               (0x21800 + (cpu) * 0x100)
-#define MV_PMU_NFABRIC_UNIT_SERV_OFFSET         (0x22000)
-#define MV_CPU_PMU_UNIT_SERV_OFFSET(cpu)        (0x22100 + (cpu) * 0x100)
 #define MV_CPU_HW_SEM_OFFSET                    (0x20500)
 
 #if defined(MV_ETH_PP2)
-
-#define MV_PP2_REG_BASE                         (0x80000)
-#define MV_ETH_BASE_ADDR                        (0x50000)
+#define MV_PP2_REG_BASE                         (0xF0000)
+#define MV_ETH_BASE_ADDR                        (0xC0000)
 #define LMS_REG_BASE                            (MV_ETH_BASE_ADDR)
 #define MIB_COUNTERS_REG_BASE                   (MV_ETH_BASE_ADDR + 0x1000)
 #define GOP_MNG_REG_BASE                        (MV_ETH_BASE_ADDR + 0x3000)
@@ -118,37 +114,29 @@ extern "C" {
 #define MV_PON_PORT_ID                          7
 #define MV_ETH_RXQ_TOTAL_NUM                    32
 #define MV_VLAN_1_TYPE                          0x88A8
-
-#elif defined(MV_ETH_LEGACY)
-	#define MV_ETH_BASE_ADDR                (0x72000)
 #else
 	#define MV_ETH_BASE_ADDR                (0x70000)
-#endif
+#endif /*MV_ETH_PP2*/
+
 #define MV_ETH_REGS_OFFSET(port)                (MV_ETH_BASE_ADDR - ((port) / 2) * 0x40000 + ((port) % 2) * 0x4000)
 
 #define MV_PEX_IF_REGS_OFFSET(pexIf)            (pexIf < 8 ? (0x40000 + ((pexIf) / 4) * 0x40000 + ((pexIf) % 4) * 0x4000) \
 						 : (0x42000 + ((pexIf) % 8) * 0x40000))
-#define MV_USB_REGS_OFFSET(dev)                 (0x50000 + (dev * 0x1000))
-#define MV_XOR_REGS_OFFSET(unit)                (unit ? 0xF0900 : 0x60900)
+#define MV_USB_REGS_OFFSET(dev)                 (0x50000)
+#define MV_XOR_REGS_OFFSET(unit)                (0x60800)
 #define MV_CESA_TDMA_REGS_OFFSET(chanNum)       (0x90000 + (chanNum * 0x2000))
 #define MV_CESA_REGS_OFFSET(chanNum)            (0x9D000 + (chanNum * 0x2000))
 #define MV_SATA_REGS_OFFSET                     (0xA0000)
 #define MV_COMM_UNIT_REGS_OFFSET                (0xB0000)
 #define MV_NFC_REGS_OFFSET                      (0xD0000)
-#define MV_BM_REGS_OFFSET                       (0xC0000)
-#define MV_PNC_REGS_OFFSET                      (0xC8000)
 #define MV_SDMMC_REGS_OFFSET                    (0xD4000)
 
 #define MV_ETH_SMI_PORT   0
 
-#define MV_SERDES_NUM_TO_PEX_NUM(sernum)        ((sernum < 8) ? (sernum) : (8 + (sernum / 12)))
 /*
  * Miscellanuous Controller Configurations
  */
 
-#define AVS_CONTROL2_REG                        0x20868
-#define AVS_LOW_VDD_LIMIT                       0x20860
-
 #define INTER_REGS_SIZE                         _1M
 
 /* This define describes the TWSI interrupt bit and location */
@@ -231,7 +219,6 @@ extern "C" {
 #define MV_ETH_MAX_RXQ                          8
 #define MV_ETH_MAX_TXQ                          8
 #define MV_ETH_TX_CSUM_MAX_SIZE                 9800
-#define MV_PNC_TCAM_LINES                       1024    /* TCAM num of entries */
 
 #endif /* CONFIG_MV_ETH_PP2 */
 
@@ -241,10 +228,6 @@ extern "C" {
 #define MV_ETH_WRR_NEW
 /* IPv6 parsing support for Legacy parser */
 #define MV_ETH_LEGACY_PARSER_IPV6
-/* New PNC module - extra fields */
-#define MV_ETH_PNC_NEW
-/* PNC Load Balancing support */
-#define MV_ETH_PNC_LB
 
 #define MV_FPGA_ETH_MAX_PORT                    4
 
diff --git a/arch/arm/mach-avantalp/avanta_lp_family/ctrlEnv/sys/mvCpuIf.c b/arch/arm/mach-avantalp/avanta_lp_family/ctrlEnv/sys/mvCpuIf.c
index 0fc00e1..561e262 100644
--- a/arch/arm/mach-avantalp/avanta_lp_family/ctrlEnv/sys/mvCpuIf.c
+++ b/arch/arm/mach-avantalp/avanta_lp_family/ctrlEnv/sys/mvCpuIf.c
@@ -86,7 +86,6 @@ SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.
 /* static functions */
 static MV_BOOL cpuTargetWinOverlap(MV_TARGET target, MV_ADDR_WIN *pAddrWin);
 
-MV_TARGET sampleAtResetTargetArray[] = BOOT_TARGETS_NAME_ARRAY;
 MV_STATUS mvCpuIfVerify(MV_CPU_DEC_WIN *cpuAddrWinMap)
 {
 	MV_CPU_DEC_WIN win;
-- 
1.7.5.4

