From 4632601cfb5261197e45c568d7d0812d680e6711 Mon Sep 17 00:00:00 2001
From: Uri Eliyahu <uriel@marvell.com>
Date: Thu, 6 Feb 2014 13:26:20 +0200
Subject: [PATCH 1342/1825] pp2: add txqDef command params validation

https://github.com/MISL-EBU-System-SW/misl-windriver.git linux-3.4.69-14t2-read
commit 1787ad3a29558779920cb2f7a0ad6d4f94dcd714

	- validate that given txq number is valid

Change-Id: I3230be100181670e52f162e6d0923a8272ee674a
Signed-off-by: Uri Eliyahu <uriel@marvell.com>
Reviewed-on: http://vgitil04.il.marvell.com:8080/5478
Tested-by: Star_Automation <star@marvell.com>
Reviewed-by: Dmitri Epshtein <dima@marvell.com>
Signed-off-by: Zhong Hongbo <hongbo.zhong@windriver.com>
---
 .../mv_drivers_lsp/mv_pp2/net_dev/mv_netdev.c      |    5 +++++
 1 files changed, 5 insertions(+), 0 deletions(-)

diff --git a/arch/arm/plat-armada/mv_drivers_lsp/mv_pp2/net_dev/mv_netdev.c b/arch/arm/plat-armada/mv_drivers_lsp/mv_pp2/net_dev/mv_netdev.c
index 9c2567d..5dc3d07 100644
--- a/arch/arm/plat-armada/mv_drivers_lsp/mv_pp2/net_dev/mv_netdev.c
+++ b/arch/arm/plat-armada/mv_drivers_lsp/mv_pp2/net_dev/mv_netdev.c
@@ -1061,6 +1061,11 @@ int mv_eth_ctrl_txq_cpu_def(int port, int txp, int txq, int cpu)
 		return -EINVAL;
 	}
 
+	if (txq >= CONFIG_MV_ETH_TXQ) {
+		pr_err("txq #%d is out of range: from 0 to %d\n", txq, CONFIG_MV_ETH_TXQ - 1);
+		return -EINVAL;
+	}
+
 	if (mvPp2TxpCheck(port, txp))
 		return -EINVAL;
 
-- 
1.7.5.4

