From dcb619688ccf3e9b7ffac1759a39c57f7b65da43 Mon Sep 17 00:00:00 2001
From: Yehuda Yitschak <yehuday@marvell.com>
Date: Mon, 17 Feb 2014 13:13:02 +0200
Subject: [PATCH 1385/1825] fix: usb: alp: Disabled UTMI PHY (USB2) init to
 enable USB3 functionality

https://github.com/MISL-EBU-System-SW/misl-windriver.git linux-3.4.69-14t2-read
commit b0db76996219db99b39edd1dbede11ffa37020b6

    the UTMI PHY has HW bug in Z1 and is therefore preventing the USB3
    MAC to complete initialization. To avoid that UTMI PHY init was
    disabled.

Change-Id: I1e8b6cfe421d3f009c2f46359b9c9abd3ebc5028
Signed-off-by: Yehuda Yitschak <yehuday@marvell.com>
Reviewed-on: http://vgitil04.il.marvell.com:8080/5694
Tested-by: Star_Automation <star@marvell.com>
Reviewed-by: Nadav Haklai <nadavh@marvell.com>
Signed-off-by: Zhong Hongbo <hongbo.zhong@windriver.com>
---
 arch/arm/mach-avantalp/usb.c |    6 ++++++
 1 files changed, 6 insertions(+), 0 deletions(-)

diff --git a/arch/arm/mach-avantalp/usb.c b/arch/arm/mach-avantalp/usb.c
index b3e9899..2497bf4 100644
--- a/arch/arm/mach-avantalp/usb.c
+++ b/arch/arm/mach-avantalp/usb.c
@@ -290,15 +290,21 @@ void __init mv_usb_init(struct mbus_dram_target_info *dram)
 	MV_STATUS status;
 
 	/* Enable USB3 only for 6660 devices */
+	/*
+	 * Temporarily disable the USB2 PHY init since it disrupts
+	 * USB3 functionality
+	 */
 #ifndef CONFIG_AVANTA_LP_USE_LEGACY_USB2
 	if (mvCtrlModelGet() == MV_6660_DEV_ID) {
 		use_usb3_ip = 1;
+#if 0
 		/* Initialize the USB2 PHY needed for USB3 functionality */
 		status = mvSysUsbInit(0, 1);
 		if (status != MV_OK) {
 			pr_info("Error: mvSysUsbInit failed with code %d\n", status);
 			return;
 		}
+#endif
 	}
 #endif
 
-- 
1.7.5.4

