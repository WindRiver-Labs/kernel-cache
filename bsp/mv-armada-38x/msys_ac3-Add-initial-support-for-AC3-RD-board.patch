From 1f3f7c7fd8219a112bd5288459860c649d5edcf2 Mon Sep 17 00:00:00 2001
From: kostap <kostap@marvell.com>
Date: Mon, 7 Jul 2014 13:54:31 +0300
Subject: [PATCH 1779/1825] msys_ac3: Add initial support for AC3 RD board

https://github.com/MISL-EBU-System-SW/misl-windriver.git linux-3.4.69-14t2-read
commit e5d9a7284a6e40ab6201755cded8a9a585520e07

     - Add initial support for AC3 RD board
     - Still missing correct MPP & SatR configurations

Change-Id: Ia1a7cf9c0b57da5b95dc2e9601067c6094ae0032
Signed-off-by: kostap <kostap@marvell.com>
Reviewed-on: http://vgitil04.il.marvell.com:8080/9018
Reviewed-by: Omri Itach <omrii@marvell.com>
Tested-by: Omri Itach <omrii@marvell.com>
Reviewed-on: http://vgitil04.il.marvell.com:8080/9154
Tested-by: Star_Automation <star@marvell.com>
Signed-off-by: Zhong Hongbo <hongbo.zhong@windriver.com>
---
 .../msys_family/boardEnv/mvBoardEnvSpec.c          |  103 +++++++++++++++++++-
 .../msys_family/boardEnv/mvBoardEnvSpec.h          |   61 +++++++++++-
 2 files changed, 162 insertions(+), 2 deletions(-)

diff --git a/arch/arm/mach-msys/msys_family/boardEnv/mvBoardEnvSpec.c b/arch/arm/mach-msys/msys_family/boardEnv/mvBoardEnvSpec.c
index d51b515..efbbbaa 100644
--- a/arch/arm/mach-msys/msys_family/boardEnv/mvBoardEnvSpec.c
+++ b/arch/arm/mach-msys/msys_family/boardEnv/mvBoardEnvSpec.c
@@ -673,6 +673,106 @@ MV_BOARD_INFO db_dx_ac3Info = {
 };
 
 /*********************************************************************************/
+/***********************/
+/* ALLEYCAT3-RD-DX BOARD */
+/***********************/
+#define RD_DX_AC3_BOARD_NAND_READ_PARAMS	0x000C0282
+#define RD_DX_AC3_BOARD_NAND_WRITE_PARAMS	0x00010305
+/*NAND care support for small page chips*/
+#define RD_DX_AC3_BOARD_NAND_CONTROL		0x01c00543
+
+#define RD_DX_AC3_BOARD_NOR_READ_PARAMS		0x403E07CF
+#define RD_DX_AC3_BOARD_NOR_WRITE_PARAMS	0x000F0F0F
+
+MV_BOARD_TWSI_INFO	rd_dx_ac3InfoBoardTwsiDev[] = {
+/* {{MV_BOARD_DEV_CLASS	devClass, MV_U8	twsiDevAddr, MV_U8 twsiDevAddrType}} */
+	{BOARD_DEV_TWSI_PLD, 0x30, ADDR7_BIT},	/* Access to control PLD reg file */
+	{BOARD_DEV_TWSI_ZARLINK, 0x18, ADDR7_BIT},	/* Access to Zarlink	*/
+	{BOARD_DEV_TWSI_SATR, 0x4C, ADDR7_BIT},	/* SatR bios 0		*/
+	{BOARD_DEV_TWSI_SATR, 0x4D, ADDR7_BIT},	/* SatR bios 1		*/
+	{BOARD_DEV_TWSI_SATR, 0x4E, ADDR7_BIT},	/* SatR bios 2		*/
+	{BOARD_DEV_TWSI_SATR, 0x4F, ADDR7_BIT},	/* SatR bios 3		*/
+	{BOARD_DEV_TWSI_INIT_EPROM, 0x50, ADDR7_BIT},	/* Serial Ini EPROM	*/
+	{BOARD_DEV_TWSI_PCA9555_IO_EXPANDER, 0x20, ADDR7_BIT},	/* Qsgmii/sfp mux control PCA9555 IO expander */
+	{BOARD_DEV_TWSI_PCA9548_IO_MUX,	0x70, ADDR7_BIT},	/* PCA9548 I2C mux 0	*/
+	{BOARD_DEV_TWSI_PCA9548_IO_MUX,	0x71, ADDR7_BIT},	/* PCA9548 I2C mux 1	*/
+	{BOARD_DEV_TWSI_PCA9548_IO_MUX,	0x75, ADDR7_BIT}	/* PCA9548 I2C mux 2	*/
+};
+
+MV_BOARD_MAC_INFO rd_dx_ac3InfoBoardMacInfo[] = {
+	/* {{MV_BOARD_MAC_SPEED	boardMacSpeed, MV_U8 boardEthSmiAddr}} */
+	{BOARD_MAC_SPEED_AUTO, 0 },
+};
+
+MV_BOARD_MODULE_TYPE_INFO rd_dx_ac3InfoBoardModTypeInfo[] = {
+	{
+		.boardMppMod		= MV_BOARD_AUTO,
+	}
+};
+
+MV_DEV_CS_INFO rd_dx_ac3InfoBoardDeCsInfo[] = {
+	/*{deviceCS, params, devType, devWidth, busWidth }*/
+#if defined(MV_INCLUDE_SPI)
+	{SPI_CS0, N_A, BOARD_DEV_SPI_FLASH, 8, 8}, /* SPI DEV */
+#endif
+};
+
+MV_BOARD_MPP_INFO rd_dx_ac3InfoBoardMppConfigValue[] = {
+	{ {
+	RD_DX_AC3_MPP0_7,
+	RD_DX_AC3_MPP8_15,
+	RD_DX_AC3_MPP16_23,
+	RD_DX_AC3_MPP24_31,
+	RD_DX_AC3_MPP32_39,
+	} },
+};
+
+MV_BOARD_INFO rd_dx_ac3Info = {
+	.boardName				= "RD-DXAC3-MM",
+	.numBoardMppTypeValue	= ARRSZ(rd_dx_ac3InfoBoardModTypeInfo),
+	.pBoardModTypeValue		= rd_dx_ac3InfoBoardModTypeInfo,
+	.numBoardMppConfigValue	= ARRSZ(rd_dx_ac3InfoBoardMppConfigValue),
+	.pBoardMppConfigValue	= rd_dx_ac3InfoBoardMppConfigValue,
+	.intsGppMaskLow			= 0,
+	.intsGppMaskMid			= 0,
+	.intsGppMaskHigh		= 0,
+	.numBoardDeviceIf		= ARRSZ(rd_dx_ac3InfoBoardDeCsInfo),
+	.pDevCsInfo				= rd_dx_ac3InfoBoardDeCsInfo,
+	.numBoardTwsiDev		= ARRSZ(rd_dx_ac3InfoBoardTwsiDev),
+	.pBoardTwsiDev			= rd_dx_ac3InfoBoardTwsiDev,
+	.numBoardMacInfo		= ARRSZ(rd_dx_ac3InfoBoardMacInfo),
+	.pBoardMacInfo			= rd_dx_ac3InfoBoardMacInfo,
+	.numBoardGppInfo		= 0,
+	.pBoardGppInfo			= NULL,
+	.activeLedsNumber		= 0,
+	.pLedGppPin				= NULL,
+	.ledsPolarity			= 0,
+
+	/* GPP values */
+	.gppOutEnValLow			= RD_DX_AC3_GPP_OUT_ENA_LOW,
+	.gppOutEnValMid			= RD_DX_AC3_GPP_OUT_ENA_MID,
+	.gppOutEnValHigh		= 0,
+	.gppOutValLow			= RD_DX_AC3_GPP_OUT_VAL_LOW,
+	.gppOutValMid			= RD_DX_AC3_GPP_OUT_VAL_MID,
+	.gppOutValHigh			= 0,
+	.gppPolarityValLow		= RD_DX_AC3_GPP_POL_LOW,
+	.gppPolarityValMid		= RD_DX_AC3_GPP_POL_MID,
+	.gppPolarityValHigh		= 0,
+
+	/* External Switch Configuration */
+	.pSwitchInfo = NULL,
+	.switchInfoNum = 0,
+
+	/* NAND init params */
+	.nandFlashReadParams	= RD_DX_AC3_BOARD_NAND_READ_PARAMS,
+	.nandFlashWriteParams	= RD_DX_AC3_BOARD_NAND_WRITE_PARAMS,
+	.nandFlashControl		= RD_DX_AC3_BOARD_NAND_CONTROL,
+	/* NOR init params */
+	.norFlashReadParams		= RD_DX_AC3_BOARD_NOR_READ_PARAMS,
+	.norFlashWriteParams	= RD_DX_AC3_BOARD_NOR_WRITE_PARAMS
+};
+
+/*********************************************************************************/
 
 MV_BOARD_INFO *marvellBC2BoardInfoTbl[] = {
 	&db_dx_bc2Info,
@@ -681,5 +781,6 @@ MV_BOARD_INFO *marvellBC2BoardInfoTbl[] = {
 };
 
 MV_BOARD_INFO *marvellAC3BoardInfoTbl[] = {
-	&db_dx_ac3Info
+	&db_dx_ac3Info,
+	&rd_dx_ac3Info
 };
diff --git a/arch/arm/mach-msys/msys_family/boardEnv/mvBoardEnvSpec.h b/arch/arm/mach-msys/msys_family/boardEnv/mvBoardEnvSpec.h
index 8d318a7..1880d7a 100644
--- a/arch/arm/mach-msys/msys_family/boardEnv/mvBoardEnvSpec.h
+++ b/arch/arm/mach-msys/msys_family/boardEnv/mvBoardEnvSpec.h
@@ -97,7 +97,8 @@ SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.
 /* AlleyCat3 Marvell boards */
 #define AC3_MARVELL_BOARD_ID_BASE	0x30
 #define DB_AC3_ID					(AC3_MARVELL_BOARD_ID_BASE + 0)
-#define AC3_MARVELL_MAX_BOARD_ID	(AC3_MARVELL_BOARD_ID_BASE + 1)
+#define RD_AC3_ID					(AC3_MARVELL_BOARD_ID_BASE + 1)
+#define AC3_MARVELL_MAX_BOARD_ID	(AC3_MARVELL_BOARD_ID_BASE + 2)
 #define AC3_MARVELL_BOARD_NUM		(AC3_MARVELL_MAX_BOARD_ID - AC3_MARVELL_BOARD_ID_BASE)
 
 #define INVALID_BOARD_ID			0xFFFF
@@ -357,6 +358,64 @@ MPP#	NAME			IN/OUT
 #define DB_DX_AC3_GPP_POL_LOW		0x0
 #define DB_DX_AC3_GPP_POL_MID		0x0
 
+/******************/
+/*   RD_DX_AC3    */
+/******************/
+#define RD_DX_AC3_MPP0_7		0x00042222 /* 0-3:SPI, 4:NF_CEn, 5:CPU Awake, 6-7:GPIO */
+#define RD_DX_AC3_MPP8_15		0x11122000 /* 8-12:GPIO, TODO: set to 0 bits 11-12 13:INTERRUPT_OUT, 14-15:I2C*/
+#define RD_DX_AC3_MPP16_23		0x44444004 /* 16:NF_REn, 17-18:GPIO, 19-23:NF_[RBn,EWn,IO[0,2,3]]*/
+#define RD_DX_AC3_MPP24_31		0x14444444 /* 24-30: NF_[IO{4,5,6,7],CLE,ALE], 31: SLV_MDC(SMI) */
+#define RD_DX_AC3_MPP32_39		0x00000001 /* 31: SLV_MDIO(SMI) */
+
+/* GPPs
+MPP#	NAME			IN/OUT
+----------------------------------------------
+0	SPI_MOSI		(out)
+1	SPI_MISO		(in)
+2	SPI_SCK			(out)
+3	SPI_CS0n		(out)
+4	NF_CEn			(out) DEV_CSn[0]
+5	PEX_RSTOUTn		(out) DEV_BOOTCSn
+6	GPIO[6]			(in/out)
+7	GPIO[7]			(in/out)
+8	GPIO[8]			(in/out)
+9	GPIO[9]			(in/out)
+10	GPIO[10]		(in/out)
+11	UART1_RXD		(in)
+12	UART1_TXD		(out)
+13	INTERRUPT_OUTn	(out)
+14	I2C_SCL			(in/out)
+15	I2C_SDA			(in/out)
+
+16	DEV_Oen_NF_Ren	(out)
+17	GPIO[17]		(out) DEV_CLK_OUT
+18	GPIO[18]		(in/out) INT_in / SD_WP / VC2_GPP
+19	NF_RBn			(in)
+20	NF_WEn			(out)    DEV_WEn[0]
+21	NF_IO[0]		(in/out) DEV_AD[0]
+22	NF_IO[1]		(in/out) DEV_AD[1]
+23	NF_IO[2]		(in/out) DEV_AD[2]
+24	NF_IO[3]		(in/out) DEV_AD[3]
+25	NF_IO[4]		(in/out) DEV_AD[4]
+26	NF_IO[5]		(in/out) DEV_AD[5]
+27	NF_IO[6]		(in/out) DEV_AD[6]
+28	NF_IO[7]		(in/out) DEV_AD[7]
+29	NF_CLE			(out) DEV_A[0]
+30	NF_ALE			(out) DEV_A[1]
+31	SLV_SMI_MDC		(in)
+32	SLV_SMI_MDIO	(in/out)
+
+*/
+#define RD_DX_AC3_GPP_OUT_ENA_LOW	(~(BIT0 | BIT2 | BIT3 | BIT4 | BIT6 | BIT12 \
+		| BIT13 | BIT16 | BIT17 | BIT20 | BIT29  | BIT30))
+#define RD_DX_AC3_GPP_OUT_ENA_MID	(~(0))
+
+#define RD_DX_AC3_GPP_OUT_VAL_LOW	(BIT0 | BIT2 | BIT3 | BIT4 | BIT6 | BIT12 \
+		| BIT13 | BIT16 | BIT17 | BIT20 | BIT29  | BIT30)
+#define RD_DX_AC3_GPP_OUT_VAL_MID	0x0
+
+#define RD_DX_AC3_GPP_POL_LOW		0x0
+#define RD_DX_AC3_GPP_POL_MID		0x0
 
 #endif /* __INCmvBoardEnvSpech */
 
-- 
1.7.5.4

