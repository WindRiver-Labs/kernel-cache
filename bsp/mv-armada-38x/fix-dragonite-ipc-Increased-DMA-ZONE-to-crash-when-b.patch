From 63d7da53be3e3702818eb7e726793ce872be781a Mon Sep 17 00:00:00 2001
From: Yehuda Yitschak <yehuday@marvell.com>
Date: Mon, 26 May 2014 16:03:58 +0300
Subject: [PATCH 1679/1825] fix: dragonite: ipc: Increased DMA ZONE to crash
 when booting with RAMFS

https://github.com/MISL-EBU-System-SW/misl-windriver.git linux-3.4.69-14t2-read
commit 8be646d681c13ffeac9280427177efd6d6c6167c

	When using RAM FS the effective size of DMA ZONE is decreased so
	allcations form that aread fail causing kernel boot failures.
	THis patch increases the size of DMA ZONE and the size of DDR
	mapped by dragonite to overcome this issue

Signed-off-by: Yehuda Yitschak <yehuday@marvell.com>

Change-Id: I21cea7f4824d190b018a3be60371f22cf7f00512
Reviewed-on: http://vgitil04.il.marvell.com:8080/8220
Tested-by: Star_Automation <star@marvell.com>
Reviewed-by: Yehuda Yitschak <yehuday@marvell.com>
Signed-off-by: Zhong Hongbo <hongbo.zhong@windriver.com>
---
 arch/arm/mach-avantalp/core.c                      |    4 ++--
 .../mv_drivers_lsp/mv_dragonite/dragonite.c        |    2 +-
 2 files changed, 3 insertions(+), 3 deletions(-)

diff --git a/arch/arm/mach-avantalp/core.c b/arch/arm/mach-avantalp/core.c
index b5dd259..5434645 100644
--- a/arch/arm/mach-avantalp/core.c
+++ b/arch/arm/mach-avantalp/core.c
@@ -1866,7 +1866,7 @@ MACHINE_START(AVANTA_LP, "Marvell AvantaLP 88f66xx Board")
 	.handle_irq     = gic_handle_irq,
 	.init_machine   = alp_board_init,
 	.restart        = board_restart,
-	.dma_zone_size	= SZ_16M,
+	.dma_zone_size	= SZ_64M,
 MACHINE_END
 
 #if defined(CONFIG_MACH_AVANTA_LP_FPGA)
@@ -1878,6 +1878,6 @@ MACHINE_START(AVANTA_LP_FPGA, "Marvell AvantaLP 88f66xx FPGA Board")
 	.handle_irq     = gic_handle_irq,
 	.init_machine   = alp_board_init,
 	.restart        = board_restart,
-	.dma_zone_size	= SZ_16M,
+	.dma_zone_size	= SZ_64M,
 MACHINE_END
 #endif
diff --git a/arch/arm/plat-armada/mv_drivers_lsp/mv_dragonite/dragonite.c b/arch/arm/plat-armada/mv_drivers_lsp/mv_dragonite/dragonite.c
index a7c5aa4..8d80641 100644
--- a/arch/arm/plat-armada/mv_drivers_lsp/mv_dragonite/dragonite.c
+++ b/arch/arm/plat-armada/mv_drivers_lsp/mv_dragonite/dragonite.c
@@ -53,7 +53,7 @@ struct dragonite_win_cfg {
 };
 
 static struct dragonite_win_cfg dragonite_win_cfg[] = {
-	{ 0x00, 0x0E, 0, SZ_16M,  DRAGONITE_DRAM_BASE}, /* DDR (first 16MB only) */
+	{ 0x00, 0x0E, 0, SZ_64M,  DRAGONITE_DRAM_BASE}, /* DDR (first 16MB only) */
 	{ 0x0B, 0x00, 0, SZ_1M,   DRAGONITE_DFEV_BASE},	 /* Lantiq */
 	{ 0x01,	0x00, 1, SZ_1M,   DRAGONITE_RUNIT_BASE}, /* R-Unit */
 };
-- 
1.7.5.4

