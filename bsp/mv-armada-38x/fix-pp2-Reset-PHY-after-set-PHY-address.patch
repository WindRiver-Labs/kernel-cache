From f6414778d3348449549fa7cd6975ae8f8484917f Mon Sep 17 00:00:00 2001
From: Dmitri Epshtein <dima@marvell.com>
Date: Tue, 26 Nov 2013 08:41:22 -0500
Subject: [PATCH 1156/1825] fix: pp2: Reset PHY after set PHY address

https://github.com/MISL-EBU-System-SW/misl-windriver.git linux-3.4.69-14t2-read
commit 16edd8d7746ba545842a1cf416afa2906ec0e8a3

	- Fix link fail for 100 Mbps connections on Boot
	- JIRA: EBU System SW / SYSTEMSW-90

Change-Id: I195a8fe4094328ea3e870a87d8763c5ddf660b78
Signed-off-by: Dmitri Epshtein <dima@marvell.com>
Reviewed-on: http://vgitil04.il.marvell.com:8080/4453
Reviewed-by: Yelena Krivosheev <yelena@marvell.com>
Tested-by: Star_Automation <star@marvell.com>
Reviewed-by: Nadav Haklai <nadavh@marvell.com>
Signed-off-by: Zhong Hongbo <hongbo.zhong@windriver.com>
---
 .../mv_drivers_lsp/mv_pp2/net_dev/mv_netdev.c      |    4 +++-
 1 files changed, 3 insertions(+), 1 deletions(-)

diff --git a/arch/arm/plat-armada/mv_drivers_lsp/mv_pp2/net_dev/mv_netdev.c b/arch/arm/plat-armada/mv_drivers_lsp/mv_pp2/net_dev/mv_netdev.c
index 3b76ebe..cf895a3 100644
--- a/arch/arm/plat-armada/mv_drivers_lsp/mv_pp2/net_dev/mv_netdev.c
+++ b/arch/arm/plat-armada/mv_drivers_lsp/mv_pp2/net_dev/mv_netdev.c
@@ -3692,8 +3692,10 @@ static int mv_eth_probe(struct platform_device *pdev)
 
 		/* Set the board information regarding PHY address */
 		phyAddr = plat_data->phy_addr;
-		if (phyAddr != -1)
+		if (phyAddr != -1) {
 			mvGmacPhyAddrSet(port, phyAddr);
+			mvEthPhyReset(phyAddr, 1000);
+		}
 
 		is_sgmii = (plat_data->flags & MV_PP2_PDATA_F_SGMII) ? 1 : 0;
 		is_rgmii = (plat_data->flags & MV_PP2_PDATA_F_RGMII) ? 1 : 0;
-- 
1.7.5.4

