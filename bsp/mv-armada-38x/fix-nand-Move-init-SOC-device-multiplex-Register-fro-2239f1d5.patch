From 61206be88ce4cb2ff3145f89c9f179408e4bbf3e Mon Sep 17 00:00:00 2001
From: Eli Nidam <elini@marvell.com>
Date: Tue, 12 Nov 2013 19:10:04 +0200
Subject: [PATCH 1131/1825] fix: nand: Move init SOC device multiplex Register
 from board_nand_init to SOC controler

https://github.com/MISL-EBU-System-SW/misl-windriver.git linux-3.4.69-14t2-read
commit 68ab01ce73514317fc6a90120d6e31f94c830bf5

               Initial SOC device multiplex register (bit0 & bit27) in SOC Initial
               1. bit0 - Configure NAND flush enabled
               2. Set NfArbiterEn to NAND Flash (Bootrom accidently Set NfArbiterEn to Device)
                  (alp/a375 - disable, a38x-enable)

Change-Id: I00abdbcac3dec1550c911e948dbb7165aece62c2
Signed-off-by: Eli Nidam <elini@marvell.com>
Reviewed-on: http://vgitil04.il.marvell.com:8080/4307
Reviewed-by: Omri Itach <omrii@marvell.com>
Tested-by: Omri Itach <omrii@marvell.com>
Signed-off-by: Zhong Hongbo <hongbo.zhong@windriver.com>
---
 .../armada_38x_family/ctrlEnv/mvCtrlEnvLib.c       |   12 +++++++-----
 1 files changed, 7 insertions(+), 5 deletions(-)

diff --git a/arch/arm/mach-armada38x/armada_38x_family/ctrlEnv/mvCtrlEnvLib.c b/arch/arm/mach-armada38x/armada_38x_family/ctrlEnv/mvCtrlEnvLib.c
index b7f3fa6..2356c3b 100644
--- a/arch/arm/mach-armada38x/armada_38x_family/ctrlEnv/mvCtrlEnvLib.c
+++ b/arch/arm/mach-armada38x/armada_38x_family/ctrlEnv/mvCtrlEnvLib.c
@@ -381,6 +381,9 @@ MV_STATUS mvCtrlEnvInit(MV_VOID)
 
 	MV_REG_BIT_SET(TSEN_CONF_REG, BIT8); /* init Tsen */
 
+	/* change default because Egiga0 is not alive by default */
+	MV_REG_WRITE(GENERAL_PURPOSE_RESERVED1_REG, GENERAL_PURPOSE_RESERVED1_DEFAULT_VALUE);
+
 	/*
 	 * Enable NAND Flash PUP (Pack-Unpack)
 	 * HW machanism to accelerate transactions (controlled by SoC register)
@@ -391,12 +394,11 @@ MV_STATUS mvCtrlEnvInit(MV_VOID)
 	/*Enable PUP bit for NOR*/
 	MV_REG_BIT_SET(PUP_EN_REG, BIT6);
 #endif
-	/* change default because Egiga0 is not alive by default */
-	MV_REG_WRITE(GENERAL_PURPOSE_RESERVED1_REG, GENERAL_PURPOSE_RESERVED1_DEFAULT_VALUE);
-
 	/* XXX: Following setting should be configured by u-boot */
-	/* Disable arbitration between device and NAND */
-	MV_REG_BIT_RESET(SOC_DEV_MUX_REG, BIT27);
+	MV_REG_BIT_SET(SOC_DEV_MUX_REG, BIT0); /* Configure NAND flush enabled */
+
+	/* Enable arbitration between device and NAND */
+	MV_REG_BIT_SET(SOC_DEV_MUX_REG, BIT27);
 
 	return MV_OK;
 }
-- 
1.7.5.4

