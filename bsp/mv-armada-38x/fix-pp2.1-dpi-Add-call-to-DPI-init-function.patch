From 44a3ee8986327f9f29de21ca6b337947c524b702 Mon Sep 17 00:00:00 2001
From: Dmitri Epshtein <dima@marvell.com>
Date: Sun, 11 May 2014 15:33:09 -0400
Subject: [PATCH 1658/1825] fix: pp2.1: dpi: Add call to DPI init function

https://github.com/MISL-EBU-System-SW/misl-windriver.git linux-3.4.69-14t2-read
commit 4b3b4faaf3022702c85f936202a69853c32f203d

	Fix JIRA SYSTEMSW-575: "DPI test script failed on ALP-A0"

Signed-off-by: Dmitri Epshtein <dima@marvell.com>

Change-Id: If9a17d0191fca4c83984a48e29396eb792323ad2
Reviewed-on: http://vgitil04.il.marvell.com:8080/7961
Reviewed-by: Uri Eliyahu <uriel@marvell.com>
Tested-by: Yehuda Yitschak <yehuday@marvell.com>
Signed-off-by: Zhong Hongbo <hongbo.zhong@windriver.com>
---
 .../mv_drivers_lsp/mv_pp2/net_dev/mv_netdev.c      |   15 ++++++++++++++-
 1 files changed, 14 insertions(+), 1 deletions(-)

diff --git a/arch/arm/plat-armada/mv_drivers_lsp/mv_pp2/net_dev/mv_netdev.c b/arch/arm/plat-armada/mv_drivers_lsp/mv_pp2/net_dev/mv_netdev.c
index 17c8a5f..e74973f 100644
--- a/arch/arm/plat-armada/mv_drivers_lsp/mv_pp2/net_dev/mv_netdev.c
+++ b/arch/arm/plat-armada/mv_drivers_lsp/mv_pp2/net_dev/mv_netdev.c
@@ -49,6 +49,7 @@ disclaimer.
 #include "prs/mvPp2Prs.h"
 #include "prs/mvPp2PrsHw.h"
 #include "cls/mvPp2Classifier.h"
+#include "dpi/mvPp2DpiHw.h"
 
 #include "mv_mux_netdev.h"
 #include "mv_netdev.h"
@@ -3676,8 +3677,12 @@ static void mv_eth_sysfs_exit(void)
 #ifdef CONFIG_MV_ETH_L2FW
 	mv_pp2_l2fw_sysfs_exit(&pd->kobj);
 #endif
-	mv_pp2_wol_sysfs_exit(&pd->kobj);
+
+#ifdef CONFIG_MV_ETH_PP2_1
 	mv_pp2_dpi_sysfs_exit(&pd->kobj);
+#endif
+
+	mv_pp2_wol_sysfs_exit(&pd->kobj);
 	mv_pp2_pme_sysfs_exit(&pd->kobj);
 	mv_pp2_plcr_sysfs_exit(&pd->kobj);
 	mv_pp2_mc_sysfs_exit(&pd->kobj);
@@ -3719,7 +3724,11 @@ static int mv_eth_sysfs_init(void)
 	mv_pp2_pme_sysfs_init(&pd->kobj);
 	mv_pp2_dbg_sysfs_init(&pd->kobj);
 	mv_pp2_wol_sysfs_init(&pd->kobj);
+
+#ifdef CONFIG_MV_ETH_PP2_1
 	mv_pp2_dpi_sysfs_init(&pd->kobj);
+#endif
+
 #ifdef CONFIG_MV_ETH_L2FW
 	mv_pp2_l2fw_sysfs_init(&pd->kobj);
 #endif
@@ -3780,6 +3789,10 @@ static int	mv_eth_shared_probe(struct mv_pp2_pdata *plat_data)
 			printk(KERN_ERR "%s: Warning Classifier defauld init failed\n", __func__);
 	}
 
+#ifdef CONFIG_MV_ETH_PP2_1
+	mvPp2DpiInit();
+#endif
+
 	/* Initialize tasklet for handle link events */
 	tasklet_init(&link_tasklet, mv_eth_link_tasklet, 0);
 
-- 
1.7.5.4

