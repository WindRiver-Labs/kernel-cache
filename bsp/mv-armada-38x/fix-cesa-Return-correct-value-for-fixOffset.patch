From 29d143723cee5ea9c7c7d23417884dd2e8f1319d Mon Sep 17 00:00:00 2001
From: Dmitri Epshtein <dima@marvell.com>
Date: Sun, 22 Jun 2014 13:47:06 -0400
Subject: [PATCH 1741/1825] fix: cesa: Return correct value for fixOffset

https://github.com/MISL-EBU-System-SW/misl-windriver.git linux-3.4.69-14t2-read
commit 1509340f5ed0b29169a4a1d18e354c8605e11396

	- Fix bug that occurs when all offsets are 4 bytes aligned.
	- In such case fixOffset must be 4

Change-Id: I62c0eb9bdf14eeb9729bb22cfe50084089a69930
Signed-off-by: Dmitri Epshtein <dima@marvell.com>
Reviewed-on: http://vgitil04.il.marvell.com:8080/8662
Reviewed-by: Eran Ben-Avi <benavi@marvell.com>
Tested-by: Star_Automation <star@marvell.com>
Reviewed-by: Nadav Haklai <nadavh@marvell.com>
Signed-off-by: Zhong Hongbo <hongbo.zhong@windriver.com>
---
 arch/arm/plat-armada/mv_hal/cesa/mvCesa.c |   10 ++++++++++
 1 files changed, 10 insertions(+), 0 deletions(-)

diff --git a/arch/arm/plat-armada/mv_hal/cesa/mvCesa.c b/arch/arm/plat-armada/mv_hal/cesa/mvCesa.c
index eae8b37..838d59a 100644
--- a/arch/arm/plat-armada/mv_hal/cesa/mvCesa.c
+++ b/arch/arm/plat-armada/mv_hal/cesa/mvCesa.c
@@ -3074,6 +3074,16 @@ static MV_STATUS mvCesaParamCheck(MV_CESA_SA *pSA, MV_CESA_COMMAND *pCmd, MV_U8
 			}
 		}
 	}
+/*
+	if (fixOffset != 0) {
+		mvOsPrintf("%s: fixOffset = %d\n", __func__, fixOffset);
+		mvOsPrintf("macOff=%d digestOff=%d cryptoOff=%d ivOff=%d cryptoLen=%d cryptoBlockSize=%d mbufSize=%d\n",
+			pCmd->macOffset, pCmd->digestOffset, pCmd->cryptoOffset, pCmd->ivOffset,
+			pCmd->cryptoLength, pSA->cryptoBlockSize, pCmd->pSrc->mbufSize);
+	}
+*/
+	*pFixOffset = fixOffset;
+
 	return MV_OK;
 }
 
-- 
1.7.5.4

