From 00e370b32d227c3ee050963bf7eb05e50ae4cb20 Mon Sep 17 00:00:00 2001
From: Dmitri Epshtein <dima@marvell.com>
Date: Sun, 30 Jun 2013 16:19:53 -0400
Subject: [PATCH 0743/1825] PPv2: Add local Makefile for ppv2 driver
 compilation

https://github.com/MISL-EBU-System-SW/misl-windriver.git linux-3.4.69-14t2-read
commit a950f51aff76804e96b0e717cc26ff0af3f5cba3

	Delete most of PPv2 driver definitions from global Makefile
	Add Makefile to ppv2 driver directory

Change-Id: I46aee6eb856b60127f79870421720c7334e53a8c
Reviewed-on: http://vgitil04.il.marvell.com:8080/2372
Reviewed-by: Star_Automation <star@marvell.com>
Reviewed-by: Uri Eliyahu <uriel@marvell.com>
Reviewed-by: Igor Patrik <igorp@marvell.com>
Tested-by: Igor Patrik <igorp@marvell.com>
Signed-off-by: Zhong Hongbo <hongbo.zhong@windriver.com>
---
 arch/arm/mach-avantalp/Makefile                    |   90 +-------------------
 arch/arm/mach-avantalp/config/mvRules.mk           |   21 +----
 .../arm/plat-armada/mv_drivers_lsp/mv_pp2/Makefile |   51 +++++++++++
 3 files changed, 56 insertions(+), 106 deletions(-)
 create mode 100644 arch/arm/plat-armada/mv_drivers_lsp/mv_pp2/Makefile

diff --git a/arch/arm/mach-avantalp/Makefile b/arch/arm/mach-avantalp/Makefile
index ea83d71..02aaf7c 100644
--- a/arch/arm/mach-avantalp/Makefile
+++ b/arch/arm/mach-avantalp/Makefile
@@ -68,20 +68,7 @@ avantalp-$(CONFIG_MV_INCLUDE_USB) 	+= $(HAL_USB_DIR)/mvUsb.o $(HAL_USB_DIR)/mvUs
 					   $(HAL_IF_DIR)/mvSysUsb.o
 avantalp-$(CONFIG_MV_INCLUDE_ETH_PHY)	+= $(HAL_ETHPHY_DIR)/mvEthPhy.o $(HAL_IF_DIR)/mvSysEthPhy.o
 
-ifeq ($(CONFIG_MV_ETH_PP2),y)
-avantalp-$(CONFIG_MV_ETH_PP2)		+= $(HAL_ETH_GMAC_DIR)/mvEthGmacApi.o
-avantalp-$(CONFIG_MV_ETH_PP2)		+= $(HAL_ETH_GBE_DIR)/mvPp2Gbe.o $(HAL_ETH_GBE_DIR)/mvPp2GbeDebug.o \
-					   $(HAL_ETH_GBE_DIR)/mvPp2AddrDec.o
-avantalp-$(CONFIG_MV_ETH_PP2)		+= $(HAL_ETH_BM_DIR)/mvBm.o
-avantalp-$(CONFIG_MV_ETH_PP2)		+= $(HAL_ETH_PRS_DIR)/mvPp2PrsHw.o $(HAL_ETH_PRS_DIR)/mvPp2Prs.o
-avantalp-$(CONFIG_MV_ETH_PP2)		+= $(HAL_ETH_CLS_DIR)/mvPp2ClsHw.o $(HAL_ETH_CLS_DIR)/mvPp2Cls2Hw.o \
-					   $(HAL_ETH_CLS_DIR)/mvPp2Cls3Hw.o $(HAL_ETH_CLS_DIR)/mvPp2Cls4Hw.o \
-					   $(HAL_ETH_CLS_DIR)/mvPp2ClsMcHw.o $(HAL_ETH_CLS_DIR)/mvPp2Classifier.o
-avantalp-$(CONFIG_MV_ETH_PP2)		+= $(HAL_ETH_PME_DIR)/mvPp2PmeHw.o
-avantalp-$(CONFIG_MV_ETH_PP2)		+= $(HAL_ETH_PLCR_DIR)/mvPp2PlcrHw.o
-avantalp-$(CONFIG_MV_ETH_PP2)		+= $(HAL_ETH_BM_DIR)/mvBm.o
-avantalp-$(CONFIG_MV_ETH_PP2)		+= $(HAL_ETH_COMMON)/mvPp2Common.o
-endif
+obj-$(CONFIG_MV_ETH_PP2)                += $(LSP_PP2_DIR)/
 
 avantalp-$(CONFIG_MV_INCLUDE_CESA) 	+= $(HAL_CESA_DIR)/mvCesa.o					\
 					   $(HAL_CESA_DIR)/mvCesaDebug.o 				\
@@ -108,31 +95,6 @@ obj-$(CONFIG_MV_INCLUDE_SWITCH) 	+= $(QD_OBJS)
 # drivers part
 
 ################################################################################
-ifeq ($(CONFIG_MV_ETH_PP2),y)
-obj-$(CONFIG_MV_ETH_PP2)		+= $(LSP_NET_DEV_DIR)/mv_netdev.o \
-					   $(LSP_NET_DEV_DIR)/mv_ethernet.o \
-					   $(LSP_NET_DEV_DIR)/mv_eth_sysfs.o \
-					   $(LSP_NET_DEV_DIR)/mv_eth_bm_sysfs.o \
-					   $(LSP_NET_DEV_DIR)/mv_eth_napi_sysfs.o \
-					   $(LSP_NET_DEV_DIR)/mv_eth_rx_sysfs.o \
-					   $(LSP_NET_DEV_DIR)/mv_eth_tx_sysfs.o \
-					   $(LSP_NET_DEV_DIR)/mv_eth_tx_sched_sysfs.o \
-					   $(LSP_NET_DEV_DIR)/mv_eth_qos_sysfs.o \
-					   $(LSP_NET_DEV_DIR)/mv_eth_pon_sysfs.o \
-					   $(LSP_NET_DEV_DIR)/mv_eth_pme_sysfs.o
-obj-$(CONFIG_MV_ETH_PP2)		+= $(LSP_BM_DIR)/mv_eth_bm.o
-obj-$(CONFIG_MV_ETH_PP2)		+= $(LSP_PRS_DIR)/prs_low_sysfs.o $(LSP_PRS_DIR)/prs_high_sysfs.o
-obj-$(CONFIG_MV_ETH_PP2)		+= $(LSP_CLS_DIR)/cls_sysfs.o \
-					   $(LSP_CLS_DIR)/cls2_sysfs.o \
-					   $(LSP_CLS_DIR)/cls3_sysfs.o \
-					   $(LSP_CLS_DIR)/cls4_sysfs.o
-obj-$(CONFIG_MV_ETH_PP2)		+= $(LSP_CLS_DIR)/cls_mc_sysfs.o
-obj-$(CONFIG_MV_ETH_PP2)		+= $(LSP_PME_DIR)/pme_sysfs.o
-obj-$(CONFIG_MV_ETH_PP2)		+= $(LSP_PLCR_DIR)/plcr_sysfs.o
-obj-$(CONFIG_MV_ETH_PP2)		+= $(LSP_NET_DEV_DIR)/mv_eth_tool.o
-obj-$(CONFIG_MV_ETH_PP2)		+= $(LSP_NET_DEV_DIR)/mv_mux_netdev.o $(LSP_NET_DEV_DIR)/mv_mux_sysfs.o
-obj-$(CONFIG_MV_INCLUDE_SWITCH)		+= $(LSP_NET_DEV_DIR)/mv_gw_mgr.o
-endif
 
 obj-$(CONFIG_MV_INCLUDE_GIG_ETH)	+= $(LSP_PHY_DIR)/phy_sysfs.o
 
@@ -144,6 +106,7 @@ obj-$(CONFIG_MV_IPC_NET)		+= $(PLAT_DRIVERS)/mv_ipc_net/
 obj-y					+= $(PLAT_DRIVERS)/mv_gpio/
 obj-$(CONFIG_MV_DBG_TRACE)              += $(PLAT_DRIVERS)/mv_trace/
 obj-$(CONFIG_MV_INCLUDE_SWITCH)         += $(LSP_SWITCH_DIR)/
+
 obj-$(CONFIG_SENSORS_ALP)		+= hwmon.o
 # The rest of the drivers are compiled through the driver dir directly.
 
@@ -159,52 +122,3 @@ avantalp-$(CONFIG_MV_AMP_ENABLE)	+= $(SOC_ENV_DIR)/mvSemaphore.o
 avantalp-$(CONFIG_PROC_FS)		+= dump_cp15_regs.o
 obj-$(CONFIG_FB_DOVE_CLCD)		+= clcd.o
 
-
-ifdef CONFIG_MV_ETH_NFP
-NFP_OBJS += $(LSP_NFP_MGR_DIR)/mv_nfp_mgr.o $(LSP_NFP_MGR_DIR)/nfp_sysfs.o
-NFP_OBJS += $(LSP_NET_DEV_DIR)/mv_eth_nfp.o $(HAL_ETH_NFP_DIR)/mvNfp.o
-endif
-
-ifdef CONFIG_MV_ETH_NFP_FIB
-NFP_OBJS += $(LSP_NFP_MGR_DIR)/nfp_fib_arp_sysfs.o
-NFP_OBJS += $(HAL_ETH_NFP_DIR)/mvNfpFib.o
-ifdef CONFIG_IPV6
-NFP_OBJS += $(LSP_NFP_MGR_DIR)/ipv6_parsing.o $(LSP_NFP_MGR_DIR)/nfp_fib6_arp_sysfs.o
-endif
-endif
-
-ifdef CONFIG_MV_ETH_NFP_CT
-NFP_OBJS += $(LSP_NFP_MGR_DIR)/nfp_ct_sysfs.o
-NFP_OBJS += $(HAL_ETH_NFP_DIR)/mvNfpCt.o
-ifdef CONFIG_IPV6
-NFP_OBJS += $(LSP_NFP_MGR_DIR)/nfp_ct6_sysfs.o
-endif
-endif
-
-ifdef CONFIG_MV_ETH_NFP_CLASSIFY
-NFP_OBJS += $(LSP_NFP_MGR_DIR)/nfp_classification_sysfs.o $(LSP_NFP_MGR_DIR)/nfp_exact_classification_sysfs.o \
-	   $(LSP_NFP_MGR_DIR)/nfp_prio_classification_sysfs.o
-endif
-
-ifdef CONFIG_MV_ETH_NFP_BRIDGE
-NFP_OBJS += $(LSP_NFP_MGR_DIR)/nfp_bridge_sysfs.o
-ifdef CONFIG_MV_ETH_NFP_FDB_MODE
-NFP_OBJS += $(HAL_ETH_NFP_DIR)/mvNfpFdb.o
-else
-NFP_OBJS += $(HAL_ETH_NFP_DIR)/mvNfpBridge.o
-endif
-endif
-
-ifdef CONFIG_MV_ETH_NFP_VLAN
-NFP_OBJS += $(LSP_NFP_MGR_DIR)/nfp_vlan_sysfs.o
-endif
-
-ifdef CONFIG_MV_ETH_NFP_PPP
-NFP_OBJS += $(LSP_NFP_MGR_DIR)/nfp_ppp_sysfs.o
-endif
-
-nfp-objs = $(NFP_OBJS)
-obj-$(CONFIG_MV_ETH_NFP) += nfp.o
-
-nfp_learn-objs = $(LSP_NFP_MGR_DIR)/mv_nfp_hooks.o
-obj-$(CONFIG_MV_ETH_NFP_LEARN) += nfp_learn.o
diff --git a/arch/arm/mach-avantalp/config/mvRules.mk b/arch/arm/mach-avantalp/config/mvRules.mk
index db43461..fd909cc 100644
--- a/arch/arm/mach-avantalp/config/mvRules.mk
+++ b/arch/arm/mach-avantalp/config/mvRules.mk
@@ -42,23 +42,8 @@ HAL_TWSI_DIR      = $(HAL_DIR)/twsi
 HAL_TWSI_ARCH_DIR = $(SOC_TWSI_DIR)/Arch$(CPU_ARCH)
 HAL_UART_DIR      = $(HAL_DIR)/uart
 
-HAL_ETH_DIR	  = $(HAL_DIR)/pp2
-HAL_ETH_GMAC_DIR  = $(HAL_DIR)/pp2/gmac
-HAL_ETH_GBE_DIR   = $(HAL_DIR)/pp2/gbe
-HAL_ETH_BM_DIR    = $(HAL_DIR)/pp2/bm
-HAL_ETH_PRS_DIR   = $(HAL_DIR)/pp2/prs
-HAL_ETH_CLS_DIR   = $(HAL_DIR)/pp2/cls
-HAL_ETH_PME_DIR   = $(HAL_DIR)/pp2/pme
-HAL_ETH_PLCR_DIR  = $(HAL_DIR)/pp2/plcr
-HAL_ETH_COMMON    = $(HAL_DIR)/pp2/common
+HAL_PP2_DIR	  = $(HAL_DIR)/pp2
 LSP_PP2_DIR       = $(PLAT_DRIVERS)/mv_pp2
-LSP_NET_DEV_DIR   = $(LSP_PP2_DIR)/net_dev
-LSP_BM_DIR        = $(LSP_PP2_DIR)/bm
-LSP_PRS_DIR       = $(LSP_PP2_DIR)/prs
-LSP_CLS_DIR       = $(LSP_PP2_DIR)/cls
-LSP_PME_DIR       = $(LSP_PP2_DIR)/pme
-LSP_PLCR_DIR      = $(LSP_PP2_DIR)/plcr
-LSP_MUX_DIR       = $(LSP_PP2_DIR)/mux
 
 HAL_CPU_DIR       = $(HAL_DIR)/cpu
 HAL_SDMMC_DIR	  = $(HAL_DIR)/sdmmc
@@ -121,9 +106,9 @@ COMMON_PATH   	= -I$(PLAT_PATH_I)/$(COMMON_DIR) -I$(srctree)
 OSSERV_PATH     = -I$(PLAT_PATH_I)/$(OSSERV_DIR)
 LSP_PATH        = -I$(LSP_PATH_I)
 CONFIG_PATH     = -I$(LSP_PATH_I)/$(CONFIG_DIR)
-HAL_IF_PATH	= -I$(LSP_PATH_I)/$(HAL_IF)
+HAL_IF_PATH	= -I$(LSP_PATH_I)/$(HAL_IF) -I$(LSP_PATH_I)/$(HAL_PP2_DIR)
 DRIVERS_LSP_PATH = -I$(PLAT_PATH_I)/$(PLAT_DRIVERS) -I$(PLAT_PATH_I)/$(LSP_PP2_DIR) -I$(PLAT_PATH_I)/$(LSP_SWITCH_DIR) \
-		 -I$(PLAT_PATH_I)/$(LSP_TRACE_DIR) -I$(PLAT_PATH_I)/$(LSP_PP2_DIR)
+		 -I$(PLAT_PATH_I)/$(LSP_TRACE_DIR)
 
 EXTRA_INCLUDE  	= $(OSSERV_PATH) $(COMMON_PATH) $(HAL_PATH)  $(ALP_FAM_PATH) \
                   $(LSP_PATH) $(CONFIG_PATH) $(DRIVERS_LSP_PATH) $(HAL_IF_PATH)
diff --git a/arch/arm/plat-armada/mv_drivers_lsp/mv_pp2/Makefile b/arch/arm/plat-armada/mv_drivers_lsp/mv_pp2/Makefile
new file mode 100644
index 0000000..9b7ba1c
--- /dev/null
+++ b/arch/arm/plat-armada/mv_drivers_lsp/mv_pp2/Makefile
@@ -0,0 +1,51 @@
+#
+# Makefile for the Marvell Gigabit Ethernet driver
+#
+
+ifneq ($(MACHINE),)
+include $(srctree)/$(MACHINE)/config/mvRules.mk
+endif
+
+PP2_DIR       = ../../mv_hal/pp2
+PP2_GMAC_DIR  = ../../mv_hal/pp2/gmac
+PP2_GBE_DIR   = ../../mv_hal/pp2/gbe
+PP2_BM_DIR    = ../../mv_hal/pp2/bm
+PP2_PRS_DIR   = ../../mv_hal/pp2/prs
+PP2_CLS_DIR   = ../../mv_hal/pp2/cls
+PP2_PME_DIR   = ../../mv_hal/pp2/pme
+PP2_PLCR_DIR  = ../../mv_hal/pp2/plcr
+PP2_COMMON_DIR= ../../mv_hal/pp2/common
+
+mv_pp2-objs +=	$(PP2_GMAC_DIR)/mvEthGmacApi.o
+mv_pp2-objs +=	$(PP2_GBE_DIR)/mvPp2Gbe.o $(PP2_GBE_DIR)/mvPp2GbeDebug.o \
+		$(PP2_GBE_DIR)/mvPp2AddrDec.o
+mv_pp2-objs +=	$(PP2_BM_DIR)/mvBm.o
+mv_pp2-objs += 	$(PP2_PRS_DIR)/mvPp2PrsHw.o $(PP2_PRS_DIR)/mvPp2Prs.o
+mv_pp2-objs += 	$(PP2_CLS_DIR)/mvPp2ClsHw.o $(PP2_CLS_DIR)/mvPp2Cls2Hw.o \
+		$(PP2_CLS_DIR)/mvPp2Cls3Hw.o $(PP2_CLS_DIR)/mvPp2Cls4Hw.o \
+		$(PP2_CLS_DIR)/mvPp2ClsMcHw.o $(PP2_CLS_DIR)/mvPp2Classifier.o
+mv_pp2-objs += 	$(PP2_PME_DIR)/mvPp2PmeHw.o
+mv_pp2-objs += 	$(PP2_PLCR_DIR)/mvPp2PlcrHw.o
+mv_pp2-objs +=	$(PP2_BM_DIR)/mvBm.o
+mv_pp2-objs +=  $(PP2_COMMON_DIR)/mvPp2Common.o
+
+mv_pp2-objs += net_dev/mv_netdev.o net_dev/mv_ethernet.o net_dev/mv_eth_sysfs.o net_dev/mv_eth_tool.o
+mv_pp2-objs += net_dev/mv_eth_rx_sysfs.o net_dev/mv_eth_tx_sysfs.o net_dev/mv_eth_tx_sched_sysfs.o
+mv_pp2-objs += net_dev/mv_eth_napi_sysfs.o net_dev/mv_eth_pme_sysfs.o net_dev/mv_eth_pon_sysfs.o
+mv_pp2-objs += net_dev/mv_eth_bm_sysfs.o net_dev/mv_eth_qos_sysfs.o
+
+mv_pp2-objs += bm/mv_eth_bm.o
+mv_pp2-objs += prs/prs_low_sysfs.o prs/prs_high_sysfs.o
+mv_pp2-objs += cls/cls_sysfs.o cls/cls2_sysfs.o cls/cls3_sysfs.o cls/cls4_sysfs.o cls/cls_mc_sysfs.o
+mv_pp2-objs += pme/pme_sysfs.o
+mv_pp2-objs += plcr/plcr_sysfs.o
+
+mv_pp2-objs +=net_dev/mv_mux_netdev.o net_dev/mv_mux_sysfs.o
+
+ifeq ($(CONFIG_MV_INCLUE_SWITCH), y)
+mv_pp2-objs += net_dev/mv_gw_mgr.o
+endif
+
+ccflags-y       += -I$(PLAT_PATH_I)/$(HAL_PP2_DIR)
+
+obj-$(CONFIG_MV_ETH_PP2) += mv_pp2.o
-- 
1.7.5.4

