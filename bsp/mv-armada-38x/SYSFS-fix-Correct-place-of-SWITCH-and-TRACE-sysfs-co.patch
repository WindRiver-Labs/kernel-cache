From 508fa8099f3450867a8861c21aa802c8b994d157 Mon Sep 17 00:00:00 2001
From: Dmitri Epshtein <dima@marvell.com>
Date: Wed, 26 Jun 2013 10:57:10 -0400
Subject: [PATCH 0737/1825] SYSFS: fix: Correct place of SWITCH and TRACE
 sysfs commands in device tree.

https://github.com/MISL-EBU-System-SW/misl-windriver.git linux-3.4.69-14t2-read
commit cd2eb4744a76cdebbbdd3936ab496cf1a26c88ce

        old place: /sys/devices/platform/pp2/switch
		   /sys/devices/platform/neta/trace
        new place: /sys/devices/platform/mv_switch
		   /sys/devices/platform/mv_trace

Change-Id: I897fc8b40048c564c56cc78f605e91091ec98913
Reviewed-on: http://vgitil04.il.marvell.com:8080/2356
Reviewed-by: Igor Patrik <igorp@marvell.com>
Tested-by: Igor Patrik <igorp@marvell.com>
Signed-off-by: Zhong Hongbo <hongbo.zhong@windriver.com>
---
 .../mv_drivers_lsp/mv_switch/mv_switch_sysfs.c     |   22 ++++-------------
 .../mv_drivers_lsp/mv_trace/dbg-trace.c            |   25 ++++---------------
 2 files changed, 11 insertions(+), 36 deletions(-)

diff --git a/arch/arm/plat-armada/mv_drivers_lsp/mv_switch/mv_switch_sysfs.c b/arch/arm/plat-armada/mv_drivers_lsp/mv_switch/mv_switch_sysfs.c
index c2e7ddf..6788f26 100644
--- a/arch/arm/plat-armada/mv_drivers_lsp/mv_switch/mv_switch_sysfs.c
+++ b/arch/arm/plat-armada/mv_drivers_lsp/mv_switch/mv_switch_sysfs.c
@@ -148,7 +148,7 @@ static struct attribute *mv_switch_attrs[] = {
 };
 
 static struct attribute_group mv_switch_group = {
-	.name = "switch",
+	.name = "mv_switch",
 	.attrs = mv_switch_attrs,
 };
 
@@ -157,23 +157,11 @@ int __devinit mv_switch_sysfs_init(void)
 	int err;
 	struct device *pd;
 
-	pd = bus_find_device_by_name(&platform_bus_type, NULL, "pp2");
-	if (!pd) {
-		platform_device_register_simple("pp2", -1, NULL, 0);
-		pd = bus_find_device_by_name(&platform_bus_type, NULL, "pp2");
-	}
-
-	if (!pd) {
-		printk(KERN_ERR "%s: cannot find pp2 device\n", __func__);
-		pd = &platform_bus;
-	}
-
+	pd = &platform_bus;
 	err = sysfs_create_group(&pd->kobj, &mv_switch_group);
-	if (err) {
-		printk(KERN_INFO "sysfs group failed %d\n", err);
-		goto out;
-	}
-out:
+	if (err)
+		pr_err("Init sysfs group %s failed %d\n", mv_switch_group.name, err);
+
 	return err;
 }
 
diff --git a/arch/arm/plat-armada/mv_drivers_lsp/mv_trace/dbg-trace.c b/arch/arm/plat-armada/mv_drivers_lsp/mv_trace/dbg-trace.c
index 3d9e415..2c197df 100644
--- a/arch/arm/plat-armada/mv_drivers_lsp/mv_trace/dbg-trace.c
+++ b/arch/arm/plat-armada/mv_drivers_lsp/mv_trace/dbg-trace.c
@@ -300,7 +300,7 @@ static struct attribute *mv_trace_attrs[] = {
 };
 
 static struct attribute_group mv_trace_group = {
-	.name = "trace",
+	.name = "mv_trace",
 	.attrs = mv_trace_attrs,
 };
 
@@ -311,27 +311,14 @@ int __devinit mv_trace_init(void)
 
 	err = TRC_INIT();
 	if (err) {
-		printk(KERN_INFO "sysfs group failed %d\n", err);
-		goto out;
-	}
-
-	pd = bus_find_device_by_name(&platform_bus_type, NULL, "neta");
-	if (!pd) {
-		platform_device_register_simple("neta", -1, NULL, 0);
-		pd = bus_find_device_by_name(&platform_bus_type, NULL, "neta");
-	}
-
-	if (!pd) {
-		printk(KERN_ERR"%s: cannot find neta device\n", __func__);
-		pd = &platform_bus;
+		pr_err("Trace initialization failed %d\n", err);
+		return err;
 	}
 
+	pd = &platform_bus;
 	err = sysfs_create_group(&pd->kobj, &mv_trace_group);
-	if (err) {
-		printk(KERN_INFO "sysfs group failed %d\n", err);
-		goto out;
-	}
-out:
+	if (err)
+		pr_err("Init sysfs group %s failed %d\n", mv_trace_group.name, err);
 
 	return err;
 }
-- 
1.7.5.4

