From 1601256d0f93231b52905f539c875199e348d70a Mon Sep 17 00:00:00 2001
From: Eran Ben-Avi <benavi@marvell.com>
Date: Thu, 11 Jul 2013 17:52:56 +0300
Subject: [PATCH 0797/1825] silabs: Added slic_port_id parameter to silabs_dev
 module.

https://github.com/MISL-EBU-System-SW/misl-windriver.git linux-3.4.69-14t2-read
commit 102ef4d26d794707d271c71a38a7561f47e89c34

	The slic_port_id module parameter could be used to select
	SPI channel used to communicate with SLIC. By default first
	channel (slic_port_id = 0) is used.

Change-Id: I01bb8c571ccc150a9378a81357e1fe53a64900ba
Signed-off-by: Piotr Ziecik <kosmo@semihalf.com>
Signed-off-by: Eran Ben-Avi <benavi@marvell.com>
Signed-off-by: Zhong Hongbo <hongbo.zhong@windriver.com>
---
 arch/arm/plat-feroceon/include/plat/silabs_if.h    |    1 -
 .../mv_drivers_lsp/mv_phone/slic/silabs_dev.c      |    6 +++++-
 .../mv_drivers_lsp/mv_phone/slic/silabs_if.c       |    6 ------
 3 files changed, 5 insertions(+), 8 deletions(-)

diff --git a/arch/arm/plat-feroceon/include/plat/silabs_if.h b/arch/arm/plat-feroceon/include/plat/silabs_if.h
index 76d8352..7e2c7d3 100644
--- a/arch/arm/plat-feroceon/include/plat/silabs_if.h
+++ b/arch/arm/plat-feroceon/include/plat/silabs_if.h
@@ -73,7 +73,6 @@ SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.
 extern void silabs_if_enable_irq(unsigned int device);
 extern void silabs_if_disable_irq(unsigned int device);
 
-unsigned int silabs_spi_get_line(void);
 extern void silabs_if_spi_init(unsigned int line);
 extern void silabs_if_spi_read(unsigned int line,
 		unsigned char *cmd, unsigned char cmd_size,
diff --git a/arch/arm/plat-feroceon/mv_drivers_lsp/mv_phone/slic/silabs_dev.c b/arch/arm/plat-feroceon/mv_drivers_lsp/mv_phone/slic/silabs_dev.c
index 0ddb695..369bc27 100644
--- a/arch/arm/plat-feroceon/mv_drivers_lsp/mv_phone/slic/silabs_dev.c
+++ b/arch/arm/plat-feroceon/mv_drivers_lsp/mv_phone/slic/silabs_dev.c
@@ -181,6 +181,10 @@ static struct miscdevice silabs_misc_dev = {
 	.fops = &silabs_fops,
 };
 
+static int slic_port_id = 0;
+module_param(slic_port_id, int, 0);
+MODULE_PARM_DESC(slic_port_id, "TDM SPI Port ID");
+
 static ssize_t silabs_read(struct file *file, char __user *buf, size_t size, loff_t * ppos)
 {
 	return 0;
@@ -910,7 +914,7 @@ int __init silabs_module_init(void)
 	/* Clear event queue */
 	memset(event_queue, 0, (MAX_EVENT_QUEUE_SIZE * sizeof(silabs_event)));
 
-	spiGciObj.portID = mvBoardTdmSpiIdGet();
+	spiGciObj.portID = slic_port_id;
 	SPI_Init (&spiGciObj);
 
 	return 0;
diff --git a/arch/arm/plat-feroceon/mv_drivers_lsp/mv_phone/slic/silabs_if.c b/arch/arm/plat-feroceon/mv_drivers_lsp/mv_phone/slic/silabs_if.c
index cebe699..070bddc 100644
--- a/arch/arm/plat-feroceon/mv_drivers_lsp/mv_phone/slic/silabs_if.c
+++ b/arch/arm/plat-feroceon/mv_drivers_lsp/mv_phone/slic/silabs_if.c
@@ -83,12 +83,6 @@ void silabs_if_disable_irq(unsigned int device)
 }
 EXPORT_SYMBOL(silabs_if_disable_irq);
 
-unsigned int silabs_spi_get_line(void)
-{
-	return mvBoardTdmSpiIdGet();
-}
-EXPORT_SYMBOL(silabs_spi_get_line);
-
 void silabs_if_spi_init(unsigned int line)
 {
 	MV_SPI_IF_PARAMS ifParams;
-- 
1.7.5.4

