From 5a9546601b7b3e37a0103f1dae582a42366db08d Mon Sep 17 00:00:00 2001
From: kostap <kostap@marvell.com>
Date: Wed, 25 Jun 2014 14:38:39 +0300
Subject: [PATCH 1752/1825] msys: Add support for BoardID Get/Set
 functionality

https://github.com/MISL-EBU-System-SW/misl-windriver.git linux-3.4.69-14t2-read
commit 9867f0ec5916ea047175816c77b504e38e3b874e

    - Add ability to set/get BoardId for MSYS boards
      Use bit[2:0] in register 1 of i2c device 0x4D for storage

Change-Id: I056813c799dbd5738c6090c1bb6d161cb629b47e
Signed-off-by: kostap <kostap@marvell.com>
Reviewed-on: http://vgitil04.il.marvell.com:8080/8722
Tested-by: Star_Automation <star@marvell.com>
Reviewed-by: Omri Itach <omrii@marvell.com>
Tested-by: Omri Itach <omrii@marvell.com>
Signed-off-by: Zhong Hongbo <hongbo.zhong@windriver.com>
---
 .../mach-msys/msys_family/boardEnv/mvBoardEnvLib.c |   44 ++++++++++++++++++++
 .../mach-msys/msys_family/boardEnv/mvBoardEnvLib.h |    2 +
 2 files changed, 46 insertions(+), 0 deletions(-)

diff --git a/arch/arm/mach-msys/msys_family/boardEnv/mvBoardEnvLib.c b/arch/arm/mach-msys/msys_family/boardEnv/mvBoardEnvLib.c
index 0791774..bc6c649 100644
--- a/arch/arm/mach-msys/msys_family/boardEnv/mvBoardEnvLib.c
+++ b/arch/arm/mach-msys/msys_family/boardEnv/mvBoardEnvLib.c
@@ -1757,6 +1757,50 @@ MV_STATUS mvBoardPllClockSet(MV_U8 val)
 	DB(mvOsPrintf("Board: Write pcllclock S@R succeeded\n"));
 	return MV_OK;
 }
+/*******************************************************************************/
+MV_STATUS mvBoardSarBoardIdGet(MV_U8 *value)
+{
+	MV_U8		sar;
+	MV_U16		family = mvCtrlDevFamilyIdGet(0);
+
+	if (family != MV_ALLEYCAT3_DEV_ID) {
+		DB(mvOsPrintf("%s: Controller family (0x%04x) is not supported\n", __func__, family));
+		return MV_ERROR;
+	}
+
+	if (MV_ERROR == mvBoardTwsiSatRGet(1, 1, &sar))
+		return MV_ERROR;
+
+	*value = (sar & 0x7);
+
+	return MV_OK;
+}
+
+/*******************************************************************************/
+MV_STATUS mvBoardSarBoardIdSet(MV_U8 val)
+{
+	MV_U8		sar;
+	MV_U16		family = mvCtrlDevFamilyIdGet(0);
+
+	if (family != MV_ALLEYCAT3_DEV_ID) {
+		DB(mvOsPrintf("%s: Controller family (0x%04x) is not supported\n", __func__, family));
+		return MV_ERROR;
+	}
+
+	if (MV_ERROR == mvBoardTwsiSatRGet(1, 1, &sar))
+		return MV_ERROR;
+
+	sar &= ~(0x7);
+	sar |= (val & 0x7);
+
+	if (MV_OK != mvBoardTwsiSatRSet(1, 1, sar)) {
+		DB(mvOsPrintf("Board: Write boardid S@R fail\n"));
+		return MV_ERROR;
+	}
+
+	DB(mvOsPrintf("Board: Write boardid S@R succeeded\n"));
+	return MV_OK;
+}
 
 /*******************************************************************************
 * End of SatR Configuration functions
diff --git a/arch/arm/mach-msys/msys_family/boardEnv/mvBoardEnvLib.h b/arch/arm/mach-msys/msys_family/boardEnv/mvBoardEnvLib.h
index 668dc6d..895f8fa 100644
--- a/arch/arm/mach-msys/msys_family/boardEnv/mvBoardEnvLib.h
+++ b/arch/arm/mach-msys/msys_family/boardEnv/mvBoardEnvLib.h
@@ -309,6 +309,8 @@ MV_STATUS mvBoardPcieClockGet(MV_U8 *val);
 MV_STATUS mvBoardPcieClockSet(MV_U8 val);
 MV_STATUS mvBoardPllClockGet(MV_U8 *val);
 MV_STATUS mvBoardPllClockSet(MV_U8 val);
+MV_STATUS mvBoardSarBoardIdGet(MV_U8 *val);
+MV_STATUS mvBoardSarBoardIdSet(MV_U8 val);
 
 MV_U8 mvBoardCpuCoresNumGet(MV_VOID);
 MV_STATUS mvBoardCpuCoresNumSet(MV_U8 val);
-- 
1.7.5.4

