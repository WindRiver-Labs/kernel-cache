From 77a4210bccd3f4fa359bb0e0bb478d3efcec674d Mon Sep 17 00:00:00 2001
From: Eli Nidam <elini@marvell.com>
Date: Tue, 31 Dec 2013 17:36:26 +0200
Subject: [PATCH 1271/1825] fix: a38x: s@R: Enable cpusnum for RD boards and
 SERDES4 configuration for RD-AP.

https://github.com/MISL-EBU-System-SW/misl-windriver.git linux-3.4.69-14t2-read
commit 13ee683255872c9c46edd1b6974e763f1a36fdc7

	1. Enable change number cpu (cpusnum) for RD boards
	2. Change SERDES4 configuration to RD board.

Change-Id: I31c8c804b6079bee8b2475c0ddf3dda97ee5b969
Signed-off-by: Eli Nidam <elini@marvell.com>
Reviewed-on: http://vgitil04.il.marvell.com:8080/4982
Reviewed-by: Omri Itach <omrii@marvell.com>
Tested-by: Omri Itach <omrii@marvell.com>
Signed-off-by: Zhong Hongbo <hongbo.zhong@windriver.com>
---
 .../armada_38x_family/boardEnv/mvBoardEnvLib.c     |    2 +-
 .../armada_38x_family/boardEnv/mvBoardEnvLib.h     |    6 +++---
 2 files changed, 4 insertions(+), 4 deletions(-)

diff --git a/arch/arm/mach-armada38x/armada_38x_family/boardEnv/mvBoardEnvLib.c b/arch/arm/mach-armada38x/armada_38x_family/boardEnv/mvBoardEnvLib.c
index 020b1a4..e02b8dc 100644
--- a/arch/arm/mach-armada38x/armada_38x_family/boardEnv/mvBoardEnvLib.c
+++ b/arch/arm/mach-armada38x/armada_38x_family/boardEnv/mvBoardEnvLib.c
@@ -1124,7 +1124,7 @@ MV_STATUS mvBoardIoExpanderUpdate(MV_VOID)
 
 	if (mvBoardIoExpanderGet(0, 2, &ioValue) == MV_ERROR)
 		return MV_OK; /* ignore for boards not supported IO expander */
-	tmp = mvBoardSatRRead(MV_SATR_RD_NAS_SERDES4_CFG);
+	tmp = mvBoardSatRRead(MV_SATR_RD_SERDES4_CFG);
 	if (tmp != MV_ERROR) { /* ignore for none RD_NAS board */
 		if (tmp == 0) /* 0 = USB3.  1 = SGMII. */
 			ioValue |= 1 ;	/* Setting USB3.0 interface: configure IO as output '1' */
diff --git a/arch/arm/mach-armada38x/armada_38x_family/boardEnv/mvBoardEnvLib.h b/arch/arm/mach-armada38x/armada_38x_family/boardEnv/mvBoardEnvLib.h
index 5f08429..5d1301e 100644
--- a/arch/arm/mach-armada38x/armada_38x_family/boardEnv/mvBoardEnvLib.h
+++ b/arch/arm/mach-armada38x/armada_38x_family/boardEnv/mvBoardEnvLib.h
@@ -171,7 +171,7 @@ typedef enum _mvSatRTypeID {
 	MV_SATR_BOARD_ECO_VERSION,
 	MV_SATR_DB_USB3_PORT0,
 	MV_SATR_DB_USB3_PORT1,
-	MV_SATR_RD_NAS_SERDES4_CFG,
+	MV_SATR_RD_SERDES4_CFG,
 	MV_SATR_MAX_OPTION,
 } MV_SATR_TYPE_ID;
 
@@ -546,7 +546,7 @@ int mvBoardNorFlashConnect(void);
 #define MV_SAR_INFO { \
 { "freq",	MV_SATR_CPU_DDR_L2_FREQ,	0x1F,   0,      1,      0,      {1, 1, 1, 0}, BOARD_SATR_SWAP_BIT},\
 { "coreclock",	MV_SATR_CORE_CLK_SELECT,	0x04,   2,      3,      0,      {0, 1, 0, 0}, 0},\
-{ "cpusnum",	MV_SATR_CPU1_ENABLE,		0x01,	0,	2,	0,	{0, 1, 0, 0}, 0},\
+{ "cpusnum",	MV_SATR_CPU1_ENABLE,		0x01,	0,	2,	0,	{1, 1, 1, 0}, 0},\
 { "sscg",	MV_SATR_SSCG_DISABLE,		0x08,	3,	3,	0,	{0, 1, 0, 0}, 0},\
 { "ddr4select",	MV_SATR_DDR4_SELECT,		0x20,	5,	4,	1,	{0, 1, 0, 0}, BOARD_SATR_READ_ONLY},\
 { "ddrbuswidth",  MV_SATR_DDR_BUS_WIDTH,	0x02,	1,	4,	0,	{0, 1, 0, 0}, BOARD_SATR_READ_ONLY},\
@@ -557,7 +557,7 @@ int mvBoardNorFlashConnect(void);
 { "ecoversion",	MV_SATR_BOARD_ECO_VERSION,	0xff,	0,	0,	1,	{1, 1, 1, 0}, BOARD_SATR_READ_ONLY},\
 { "usb3port0",	MV_SATR_DB_USB3_PORT0,		0x1,	0,	1,	1,	{0, 1, 0, 0}, 0},\
 { "usb3port1",	MV_SATR_DB_USB3_PORT1,		0x2,	1,	1,	1,	{0, 1, 0, 0}, 0},\
-{ "rdserdes4",	MV_SATR_RD_NAS_SERDES4_CFG,	0x4,	2,	1,	1,	{1, 0, 0, 0}, 0},\
+{ "rdserdes4",	MV_SATR_RD_SERDES4_CFG,		0x4,	2,	1,	1,	{1, 0, 1, 0}, 0},\
 { "max_option",	MV_SATR_MAX_OPTION,		0x0,	0,	0,	0,	{0, 0, 0, 0}, 0},\
 };
 
-- 
1.7.5.4

