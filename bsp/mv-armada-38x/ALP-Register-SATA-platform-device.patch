From 73f67d53853c0c4a5d5f387755898e71488f8515 Mon Sep 17 00:00:00 2001
From: Kosta Zertsekel <konszert@marvell.com>
Date: Sun, 14 Apr 2013 11:39:33 +0300
Subject: [PATCH 0580/1825] ALP: Register SATA platform device

https://github.com/MISL-EBU-System-SW/misl-windriver.git linux-3.4.69-14t2-read
commit b6c99dfa603aebabc245c10c73c346e8604b2bb2

Signed-off-by: Kosta Zertsekel <konszert@marvell.com>
Change-Id: I451cc8fe006f56e02cc72e37154a0a103cb65b60
Reviewed-on: http://vgitil04.il.marvell.com:8080/1550
Reviewed-by: Eran Ben-Avi <benavi@marvell.com>
Tested-by: Eran Ben-Avi <benavi@marvell.com>
Signed-off-by: Zhong Hongbo <hongbo.zhong@windriver.com>
---
 arch/arm/mach-avantalp/core.c |   45 +++++++++++++++++++++++++++++++++++++++++
 1 files changed, 45 insertions(+), 0 deletions(-)

diff --git a/arch/arm/mach-avantalp/core.c b/arch/arm/mach-avantalp/core.c
index 607179d..f634ec7 100644
--- a/arch/arm/mach-avantalp/core.c
+++ b/arch/arm/mach-avantalp/core.c
@@ -16,6 +16,7 @@
 
 #include <linux/types.h>
 #include <linux/kernel.h>
+#include <linux/ata_platform.h>
 #include <linux/ethtool.h>
 #include <linux/device.h>
 #include <linux/string.h>
@@ -547,6 +548,50 @@ static void __init rtc_init(void)
 	platform_device_register_simple("rtc-mv", -1, rtc_resource, 2);
 }
 
+/********
+ * SATA *
+ ********/
+#ifdef CONFIG_SATA_MV
+#define SATA_PHYS_BASE (INTER_REGS_PHYS_BASE | 0xA0000)
+
+static struct mv_sata_platform_data alp_sata_data = {
+	.n_ports	= 1,
+};
+
+static struct resource armadaxp_sata_resources[] = {
+	{
+		.name	= "sata base",
+		.start	= SATA_PHYS_BASE,
+		.end	= SATA_PHYS_BASE + 0x5000 - 1,
+		.flags	= IORESOURCE_MEM,
+	}, {
+		.name	= "sata irq",
+		.start	= IRQ_GLOBAL_SATA0,
+		.end	= IRQ_GLOBAL_SATA0,
+		.flags	= IORESOURCE_IRQ,
+	},
+};
+
+static struct platform_device armadaxp_sata = {
+	.name		= "sata_mv",
+	.id		= 0,
+	.dev		= {
+		.coherent_dma_mask	= 0xffffffff,
+	},
+	.num_resources	= ARRAY_SIZE(armadaxp_sata_resources),
+	.resource	= armadaxp_sata_resources,
+};
+
+void __init armadaxp_sata_init(struct mv_sata_platform_data *sata_data)
+{
+	if (mvUnitMapIsMine(SATA) != MV_TRUE)
+		return;
+
+	armadaxp_sata.dev.platform_data = sata_data;
+	platform_device_register(&armadaxp_sata);
+}
+#endif
+
 /*******************************************************************************
  * Helper Routines
  */
-- 
1.7.5.4

