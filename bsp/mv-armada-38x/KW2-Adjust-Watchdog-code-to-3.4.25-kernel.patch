From 799f2d01dcbaa9d7dd60235bebed6908eaca6afd Mon Sep 17 00:00:00 2001
From: Eran Ben-Avi <benavi@marvell.com>
Date: Thu, 11 Jul 2013 18:08:30 +0300
Subject: [PATCH 0807/1825] KW2: Adjust Watchdog code to 3.4.25 kernel.

https://github.com/MISL-EBU-System-SW/misl-windriver.git linux-3.4.69-14t2-read
commit 2aa07cd6bc46dee6925bb9d6f1b1e0ef933dd0db

Change-Id: I7327fb20a036ca3ddad6020c72cf22002cd57c8e
Signed-off-by: Grzegorz Jaszczyk <jaz@semihalf.com>
Signed-off-by: Eran Ben-Avi <benavi@marvell.com>
Signed-off-by: Zhong Hongbo <hongbo.zhong@windriver.com>
---
 arch/arm/mach-feroceon-kw2/core.c |   12 +++++++++++-
 1 files changed, 11 insertions(+), 1 deletions(-)

diff --git a/arch/arm/mach-feroceon-kw2/core.c b/arch/arm/mach-feroceon-kw2/core.c
index 9b30af9..75412f6 100644
--- a/arch/arm/mach-feroceon-kw2/core.c
+++ b/arch/arm/mach-feroceon-kw2/core.c
@@ -73,6 +73,7 @@
 
 /* WD */
 #include <plat/orion_wdt.h>
+#include <mach/bridge-regs.h>
 
 /* I2C */
 #include <linux/i2c.h>
@@ -556,6 +557,14 @@ static struct platform_device mv88fx_neta = {
  * WATCHDOG
  ****************************************************************************/
 
+static struct resource mv_wdt_resources[] = {
+	[0] = {
+		.start	= TIMER_VIRT_BASE,
+		.end	= TIMER_VIRT_BASE + SZ_1K -1,
+		.flags	= IORESOURCE_MEM,
+	},
+};
+
 /* the orion watchdog device data structure */
 static struct orion_wdt_platform_data mv_wdt_data = {
        .tclk           = 0,
@@ -568,7 +577,8 @@ static struct platform_device mv_wdt_device = {
        .dev            = {
                .platform_data  = &mv_wdt_data,
        },
-       .num_resources  = 0,
+       .num_resources  = ARRAY_SIZE(mv_wdt_resources),
+       .resource = mv_wdt_resources,
 };
 
 /* init the watchdog device */
-- 
1.7.5.4

