From b59984ef785e0d9dad687d35c89e3abe3483542b Mon Sep 17 00:00:00 2001
From: Yoni Farhadian <yonif@marvell.com>
Date: Mon, 12 Aug 2013 15:55:12 +0300
Subject: [PATCH 0950/1825] pp2: change PON callback registration function

https://github.com/MISL-EBU-System-SW/misl-windriver.git linux-3.4.69-14t2-read
commit e1e4195894e3d213544e40a8ff48e1659e0a5683

	- change mv_eth_ext_mac_ops_register prototype to match PON team's

Change-Id: I0f7ee3ebe01754c9d9ad35efb35be938ca6449e5
Signed-off-by: Yoni Farhadian <yonif@marvell.com>
Reviewed-on: http://vgitil04.il.marvell.com:8080/3010
Reviewed-by: Nadav Haklai <nadavh@marvell.com>
Tested-by: Nadav Haklai <nadavh@marvell.com>
Signed-off-by: Zhong Hongbo <hongbo.zhong@windriver.com>
---
 .../mv_drivers_lsp/mv_pp2/net_dev/mv_netdev.c      |   14 ++++++++++++--
 .../mv_drivers_lsp/mv_pp2/net_dev/mv_netdev.h      |    2 +-
 2 files changed, 13 insertions(+), 3 deletions(-)

diff --git a/arch/arm/plat-armada/mv_drivers_lsp/mv_pp2/net_dev/mv_netdev.c b/arch/arm/plat-armada/mv_drivers_lsp/mv_pp2/net_dev/mv_netdev.c
index 6b8dbcb..9fe10f1 100644
--- a/arch/arm/plat-armada/mv_drivers_lsp/mv_pp2/net_dev/mv_netdev.c
+++ b/arch/arm/plat-armada/mv_drivers_lsp/mv_pp2/net_dev/mv_netdev.c
@@ -5136,12 +5136,22 @@ void pon_link_status_notify(int port_id, MV_BOOL link_state)
 
 /* called by PON module */
 void mv_eth_ext_mac_ops_register(int port_id,
-		struct mv_eth_ext_mac_ops *ext_mac_ops, struct mv_netdev_notify_ops **netdev_ops)
+		struct mv_eth_ext_mac_ops **ext_mac_ops, struct mv_netdev_notify_ops **netdev_ops)
 {
+	if (*netdev_ops == NULL) {
+		pr_err("%s: netdev_ops is uninitialized\n", __func__);
+		return;
+	}
+
 	mv_netdev_callbacks.link_notify = pon_link_status_notify;
 	*netdev_ops = &mv_netdev_callbacks;
 
-	mv_pon_callbacks = ext_mac_ops;
+	if (*ext_mac_ops == NULL) {
+		pr_err("%s: netdev_ops is uninitialized\n", __func__);
+		return;
+	}
+
+	mv_pon_callbacks = *ext_mac_ops;
 }
 
 MV_BOOL mv_pon_link_status(void)
diff --git a/arch/arm/plat-armada/mv_drivers_lsp/mv_pp2/net_dev/mv_netdev.h b/arch/arm/plat-armada/mv_drivers_lsp/mv_pp2/net_dev/mv_netdev.h
index 5dd034d..65d11f8 100644
--- a/arch/arm/plat-armada/mv_drivers_lsp/mv_pp2/net_dev/mv_netdev.h
+++ b/arch/arm/plat-armada/mv_drivers_lsp/mv_pp2/net_dev/mv_netdev.h
@@ -876,7 +876,7 @@ struct mv_netdev_notify_ops {
 
 /* Called by external MAC module */
 void mv_eth_ext_mac_ops_register(int port_id,
-		struct mv_eth_ext_mac_ops *extern_mac_ops, struct mv_netdev_notify_ops **netdev_ops);
+		struct mv_eth_ext_mac_ops **extern_mac_ops, struct mv_netdev_notify_ops **netdev_ops);
 
 #ifdef CONFIG_MV_INCLUDE_PON
 MV_BOOL mv_pon_link_status(void);
-- 
1.7.5.4

