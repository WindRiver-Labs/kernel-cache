From 11dd90559f3dbf447a2234a66ffaa3532a397539 Mon Sep 17 00:00:00 2001
From: kostap <kostap@marvell.com>
Date: Sun, 19 Jan 2014 07:06:35 +0200
Subject: [PATCH 1290/1825] fix: bc2: msys: dram Adjust hardcoded DRAM init
 settings

https://github.com/MISL-EBU-System-SW/misl-windriver.git linux-3.4.69-14t2-read
commit 56a14af277a719a48a6b464f39fe2813d6992c85

	Fixes in mvCpuIfDramInit function
	Remove code setting 4 DRAM windows 4GB each
	Setup single window of 1GB instead

Change-Id: Ifdc4647221da93636645a61e002053d1d61e14b7
Signed-off-by: kostap <kostap@marvell.com>
Reviewed-on: http://vgitil04.il.marvell.com:8080/5203
Tested-by: Star_Automation <star@marvell.com>
Reviewed-by: Omri Itach <omrii@marvell.com>
Tested-by: Omri Itach <omrii@marvell.com>
Signed-off-by: Zhong Hongbo <hongbo.zhong@windriver.com>
---
 .../mach-msys/msys_family/ctrlEnv/sys/mvCpuIf.c    |   14 +++++++-------
 1 files changed, 7 insertions(+), 7 deletions(-)

diff --git a/arch/arm/mach-msys/msys_family/ctrlEnv/sys/mvCpuIf.c b/arch/arm/mach-msys/msys_family/ctrlEnv/sys/mvCpuIf.c
index 0963d75..1fc5644 100644
--- a/arch/arm/mach-msys/msys_family/ctrlEnv/sys/mvCpuIf.c
+++ b/arch/arm/mach-msys/msys_family/ctrlEnv/sys/mvCpuIf.c
@@ -290,13 +290,19 @@ MV_STATUS mvCpuIfInit(MV_CPU_DEC_WIN *cpuAddrWinMap)
 *       None.
 *
 *******************************************************************************/
-int DramCount = -1;
 MV_STATUS mvCpuIfDramInit()
 {
 	MV_U64 base = 0;
 	MV_U32 size, cs, temp;
 
 	for (cs = 0; cs < SDRAM_MAX_CS; cs++) {
+		if (cs == 0) {
+			printf("%s: TODO when ddr training is ready:\n", __func__);
+			printf("fix SDRAM_SIZE_REG(%d) (currently hard-coded value is 0x3FFFFFE1)\n", cs);
+			MV_REG_WRITE(SDRAM_SIZE_REG(cs), 0x3FFFFFE1 | ((cs << SDRAMWCR_CS_OFFS) & SDRAMWCR_CS_MASK));
+		} else
+			MV_REG_WRITE(SDRAM_SIZE_REG(cs), 0x00FFFFE0 | ((cs << SDRAMWCR_CS_OFFS) & SDRAMWCR_CS_MASK));
+
 		size = MV_REG_READ(SDRAM_SIZE_REG(cs)) & SDRAM_ADDR_MASK;
 		if (size != 0) {
 			size |= ~(SDRAM_ADDR_MASK);
@@ -309,12 +315,6 @@ MV_STATUS mvCpuIfDramInit()
 			temp = (MV_REG_READ(SDRAM_WIN_CTRL_REG(cs)) & ~(SDRAM_ADDR_MASK)) | (1<<SDRAM_WIN_CTRL_WIN_ENA_OFFS);
 			temp |= (size & SDRAM_ADDR_MASK);
 
-			temp = 0x7FFFFFE1;
-			if (DramCount++ < 0) {
-				printf("%s: TODO when ddr training is ready:\n", __func__);
-				printf("fix SDRAM_WIN_CTRL_REG (currently hard-coded value 0x7FFFFFE1)\n");
-			}
-
 			MV_REG_WRITE(SDRAM_WIN_CTRL_REG(cs), temp);
 			base += ((MV_U64)size + 1);
 		}
-- 
1.7.5.4

