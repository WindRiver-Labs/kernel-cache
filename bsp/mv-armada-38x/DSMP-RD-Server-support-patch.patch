From 29093e832f29005adb90b5d8891957f3c46e111b Mon Sep 17 00:00:00 2001
From: Tawfik Bayouk <tawfik@marvell.com>
Date: Mon, 3 Sep 2012 19:03:55 +0300
Subject: [PATCH 0232/1825] DSMP RD Server support patch

https://github.com/MISL-EBU-System-SW/misl-windriver.git linux-3.4.69-14t2-read
commit e226008ce8c1a91fe3b343852b26a46facce7569

Change-Id: I44a306d8efe259944cb5f276ba1ef3bf43f53b5e
Signed-off-by: Tawfik Bayouk <tawfik@marvell.com>
Signed-off-by: Kosta Zertsekel <konszert@marvell.com>
Signed-off-by: Zhong Hongbo <hongbo.zhong@windriver.com>
---
 arch/arm/mach-armadaxp/core.c |   22 ++++++++++++----------
 1 files changed, 12 insertions(+), 10 deletions(-)

diff --git a/arch/arm/mach-armadaxp/core.c b/arch/arm/mach-armadaxp/core.c
index 023a86f..eecdcb5 100644
--- a/arch/arm/mach-armadaxp/core.c
+++ b/arch/arm/mach-armadaxp/core.c
@@ -1765,7 +1765,11 @@ static void __init axp_rdsrv_init(void)
 	cpu_fabric_common_init();
 
 	/* Select appropriate Board ID for Machine */
+#if defined(CONFIG_ARMADA_XP_REV_A0) || defined(CONFIG_ARMADA_XP_REV_B0)
+	gBoardId = RD_78460_SERVER_ID;
+#else
 	gBoardId = RD_78460_SERVER_ID;
+#endif
 	/* Bypass serdes reconfiguration since already done at bootloader */
         mvBoardSerdesConfigurationEnableSet(MV_FALSE);
 
@@ -1850,16 +1854,14 @@ static void __init axp_rdsrv_init(void)
 	return;
 }
 
-/*MACHINE_START(ARMADA_XP_RDSRV, "Marvell Armada XP Server Board")
-		/ MAINTAINER("MARVELL") 
-		.phys_io	= INTER_REGS_PHYS_BASE,
-  .io_pg_offst	= ((INTER_REGS_BASE) >> 18) & 0xfffc,
-					.boot_params	= 0x00000100,
-	 .map_io		= axp_map_io,
-  .init_irq	= axp_init_irq,
-  .timer		= &axp_timer,
-  .init_machine	= axp_rdsrv_init,
-  MACHINE_END */
+MACHINE_START(ARMADA_XP_RDSRV, "Marvell Armada XP Server Board")
+		/* MAINTAINER("MARVELL") */
+	.atag_offset	= BOOT_PARAMS_OFFSET,
+	 .map_io	= axp_map_io,
+  	.init_irq	= axp_init_irq,
+  	.timer		= &axp_timer,
+  	.init_machine	= axp_rdsrv_init,
+  MACHINE_END
 
 /*****************************************************************************
  * FPGA BOARD: Main Initialization
-- 
1.7.5.4

