From bdd6a5760f39d884522cbbccb7c8149254054941 Mon Sep 17 00:00:00 2001
From: Tawfik Bayouk <tawfik@marvell.com>
Date: Tue, 21 Aug 2012 17:33:08 +0300
Subject: [PATCH 0040/1825] DSMP Port in CC changes done in Uboot

https://github.com/MISL-EBU-System-SW/misl-windriver.git linux-3.4.69-14t2-read
commit 85013393fa0f79093a6b438ed5c1f738ca291e68

Change-Id: I3292e2833c0a6ed6dcc489537ade58d7f26da902
Signed-off-by: Tawfik Bayouk <tawfik@marvell.com>
Signed-off-by: Kosta Zertsekel <konszert@marvell.com>
Signed-off-by: Zhong Hongbo <hongbo.zhong@windriver.com>
---
 arch/arm/mach-armadaxp/core.c               |   24 ++++++------------------
 arch/arm/plat-armada/common/mvDeviceId.h    |   17 +++++++++++++++++
 arch/arm/plat-armada/mv_hal/pex/mvPexRegs.h |    5 ++++-
 arch/arm/plat-armada/mv_hal/uart/mvUart.h   |    6 +-----
 4 files changed, 28 insertions(+), 24 deletions(-)

diff --git a/arch/arm/mach-armadaxp/core.c b/arch/arm/mach-armadaxp/core.c
index cbf855a..7322744 100644
--- a/arch/arm/mach-armadaxp/core.c
+++ b/arch/arm/mach-armadaxp/core.c
@@ -315,15 +315,6 @@ static int __init noWFI_setup(char *__unused)
 
 __setup("noWFI", noWFI_setup);
 
-MV_U32 serdes_reconfig = 0x0;
-static int __init serdes_reconfig_setup(char *__unused)
-{
-     printk("Re-configuring Serdes,bootloader configuration will be overwritten !!!\n");
-     serdes_reconfig = 1;
-     return 1;
-}
-__setup("serdes_reconfigure", serdes_reconfig_setup);
-
 MV_U32 support_Z1A_serdes_cfg = 0x0;
 static int __init serdesZ1A_setup(char *__unused)
 {
@@ -1198,10 +1189,9 @@ static void __init axp_db_init(void)
 	/* Before initializing the HAL, select Z1A serdes cfg if needed */
 	if (support_Z1A_serdes_cfg)
 		mvBoardSerdesZ1ASupport();
-	/*A0 we don't want to overwrite the Serdes configuration done by the bootloader */
-#ifdef CONFIG_ARMADA_XP_REV_A0
+	/* Bypass serdes reconfiguration since already done at bootloader */
         mvBoardSerdesConfigurationEnableSet(MV_FALSE);
-#endif
+
 	/* init the Board environment */
 	mvBoardEnvInit();
 
@@ -1377,10 +1367,9 @@ static void __init axp_rdsrv_init(void)
 
 	/* Select appropriate Board ID for Machine */
 	gBoardId = RD_78460_SERVER_ID;
-
-#ifdef CONFIG_ARMADA_XP_REV_A0
+	/* Bypass serdes reconfiguration since already done at bootloader */
         mvBoardSerdesConfigurationEnableSet(MV_FALSE);
-#endif
+
 	/* init the Board environment */
 	mvBoardEnvInit();
 
@@ -1484,10 +1473,9 @@ static void __init axp_fpga_init(void)
 
 	/* Select appropriate Board ID for Machine */
 	gBoardId = FPGA_88F78XX0_ID;
-
-#ifdef CONFIG_ARMADA_XP_REV_A0
+	/* Bypass serdes reconfiguration since already done at bootloader */
         mvBoardSerdesConfigurationEnableSet(MV_FALSE);
-#endif
+
         /* init the Board environment */
        	mvBoardEnvInit();
 
diff --git a/arch/arm/plat-armada/common/mvDeviceId.h b/arch/arm/plat-armada/common/mvDeviceId.h
index a5b9fe1..90e9b56 100644
--- a/arch/arm/plat-armada/common/mvDeviceId.h
+++ b/arch/arm/plat-armada/common/mvDeviceId.h
@@ -286,6 +286,23 @@ extern "C" {
 #define MV_78460_Z1_ID		((MV_78460_DEV_ID << 16) | MV_78XX0_Z1_REV)
 #define MV_78460_Z1_NAME	"MV78460 Z1"
 
+#define MV_78XX0_A0_REV		0x1
+
+#define MV_78130_A0_ID         ((MV_78130_DEV_ID << 16) | MV_78XX0_A0_REV)
+#define MV_78130_A0_NAME       "MV78130 A0"
+
+#define MV_78160_A0_ID         ((MV_78160_DEV_ID << 16) | MV_78XX0_A0_REV)
+#define MV_78160_A0_NAME       "MV78160 A0"
+
+#define MV_78230_A0_ID         ((MV_78230_DEV_ID << 16) | MV_78XX0_A0_REV)
+#define MV_78230_A0_NAME       "MV78230 A0"
+
+#define MV_78260_A0_ID         ((MV_78260_DEV_ID << 16) | MV_78XX0_A0_REV)
+#define MV_78260_A0_NAME       "MV78260 A0"
+
+#define MV_78460_A0_ID         ((MV_78460_DEV_ID << 16) | MV_78XX0_A0_REV)
+#define MV_78460_A0_NAME       "MV78460 A0"
+
 #ifdef __cplusplus
 }
 #endif	/* __cplusplus */
diff --git a/arch/arm/plat-armada/mv_hal/pex/mvPexRegs.h b/arch/arm/plat-armada/mv_hal/pex/mvPexRegs.h
index 73a4a3d..f883d84 100644
--- a/arch/arm/plat-armada/mv_hal/pex/mvPexRegs.h
+++ b/arch/arm/plat-armada/mv_hal/pex/mvPexRegs.h
@@ -173,7 +173,7 @@ extern "C" {
 /* PCI Express Control and Status Registers */
 /********************************************/
 #define PEX_CTRL_REG(pexIf)				((MV_PEX_IF_REGS_BASE(pexIf)) + 0x1A00)
-#define PEX_LINK_CAPABILITIES_REG(pexIf)			((MV_PEX_IF_REGS_BASE(pexIf)) + 0x6C)
+#define PEX_LINK_CAPABILITIES_REG(pexIf)		((MV_PEX_IF_REGS_BASE(pexIf)) + 0x6C)
 #define PEX_STATUS_REG(pexIf)				((MV_PEX_IF_REGS_BASE(pexIf)) + 0x1A04)
 #define PEX_COMPLT_TMEOUT_REG(pexIf)			((MV_PEX_IF_REGS_BASE(pexIf)) + 0x1A10)
 #define PEX_PWR_MNG_EXT_REG(pexIf)			((MV_PEX_IF_REGS_BASE(pexIf)) + 0x1A18)
@@ -184,6 +184,9 @@ extern "C" {
 #define PEX_TL_CTRL_REG(pexIf)				(MV_PEX_IF_REGS_BASE(pexIf) - (pexIf)*0x10000)
 #define PEX_RAM_PARITY_CTRL_REG(pexIf) 			((MV_PEX_IF_REGS_BASE(pexIf)) + 0x1A50)
 #define PEX_DBG_CTRL_REG(pexIf) 			((MV_PEX_IF_REGS_BASE(pexIf)) + 0x1A60)
+
+#define PEX_LINK_CTRL_STATUS_REG(pexIf) 		((MV_PEX_IF_REGS_BASE(pexIf)) + 0x70)
+
 /* PCI Express Control Register */
 
 /* PEX_CTRL_REG (PXCR) */
diff --git a/arch/arm/plat-armada/mv_hal/uart/mvUart.h b/arch/arm/plat-armada/mv_hal/uart/mvUart.h
index 07cb5fb..b5ce5af 100644
--- a/arch/arm/plat-armada/mv_hal/uart/mvUart.h
+++ b/arch/arm/plat-armada/mv_hal/uart/mvUart.h
@@ -100,13 +100,9 @@ extern "C" {
 		MV_U8 pad8[3];
 	} MV_UART_PORT;
 
-#if defined(MV_UART_OVER_PEX_WA) || defined(MV_UART_OVER_PCI_WA)
-#define mvUartBase(port)  \
-                ((MV_UART_PORT *)(0xF2000000 + MV_UART_REGS_OFFSET(port)))
-#else
+
 #define mvUartBase(port)  \
                 ((MV_UART_PORT *)(INTER_REGS_BASE + MV_UART_REGS_OFFSET(port)))
-#endif
 
 /* aliases - for registers which has the same offsets */
 #define thr rbr
-- 
1.7.5.4

