From d6451ca6a386fc0ab3b5e1ee2ea42b4255adba00 Mon Sep 17 00:00:00 2001
From: Yoni Farhadian <yonif@marvell.com>
Date: Wed, 12 Jun 2013 15:27:48 +0300
Subject: [PATCH 0725/1825] PPv2: Disable snoop in uboot

https://github.com/MISL-EBU-System-SW/misl-windriver.git linux-3.4.69-14t2-read
commit 29023b597182320634eb9a3a219ffffb0dc2eddb

Change-Id: Ie75cfa0b2287baa15ffdb1cc4b27653e8173be86
Signed-off-by: Yoni Farhadian <yonif@marvell.com>
Reviewed-on: http://vgitil04.il.marvell.com:8080/2235
Reviewed-by: Star_Automation <star@marvell.com>
Reviewed-by: Eran Ben-Avi <benavi@marvell.com>
Tested-by: Eran Ben-Avi <benavi@marvell.com>
Signed-off-by: Zhong Hongbo <hongbo.zhong@windriver.com>
---
 arch/arm/plat-armada/mv_hal/pp2/gbe/mvPp2Gbe.c |   12 +++++++-----
 1 files changed, 7 insertions(+), 5 deletions(-)

diff --git a/arch/arm/plat-armada/mv_hal/pp2/gbe/mvPp2Gbe.c b/arch/arm/plat-armada/mv_hal/pp2/gbe/mvPp2Gbe.c
index 83dbc80..78ac983 100644
--- a/arch/arm/plat-armada/mv_hal/pp2/gbe/mvPp2Gbe.c
+++ b/arch/arm/plat-armada/mv_hal/pp2/gbe/mvPp2Gbe.c
@@ -187,7 +187,8 @@ MV_STATUS mvPp2HalInit(MV_PP2_HAL_DATA *halData)
 	MV_REG_WRITE(ETH_MNG_EXTENDED_GLOBAL_CTRL_REG, 0x27);
 
 	/* Allow cache snoop when transmiting packets */
-	mvPp2WrReg(MV_PP2_TX_SNOOP_REG, 0x1);
+	if (mvPp2HalData.iocc)
+		mvPp2WrReg(MV_PP2_TX_SNOOP_REG, 0x1);
 
 	return MV_OK;
 }
@@ -242,10 +243,11 @@ MV_STATUS mvPp2DefaultsSet(int port)
 	}
 
 	/* Enable Rx cache snoop */
-	for (i = 0; i < pPortCtrl->rxqNum; i++) {
-		queue = mvPp2LogicRxqToPhysRxq(port, i);
-		mvPp2WrReg(MV_PP2_RXQ_SNOOP_REG(queue), MV_PP2_SNOOP_PKT_SIZE_MASK | MV_PP2_SNOOP_BUF_HDR_MASK);
-	}
+	if (mvPp2HalData.iocc)
+		for (i = 0; i < pPortCtrl->rxqNum; i++) {
+			queue = mvPp2LogicRxqToPhysRxq(port, i);
+			mvPp2WrReg(MV_PP2_RXQ_SNOOP_REG(queue), MV_PP2_SNOOP_PKT_SIZE_MASK | MV_PP2_SNOOP_BUF_HDR_MASK);
+		}
 
 	/* At default, mask all interrupts to all cpus */
 	for (i = 0; i < mvPp2HalData.maxCPUs; i++)
-- 
1.7.5.4

