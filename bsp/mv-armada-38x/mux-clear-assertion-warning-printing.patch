From 6be42a5844c638feb57819b648481ec3ffedb8f0 Mon Sep 17 00:00:00 2001
From: Ken Ma <make@marvell.com>
Date: Wed, 7 May 2014 10:17:01 +0800
Subject: [PATCH 1630/1825] mux: clear assertion warning printing

https://github.com/MISL-EBU-System-SW/misl-windriver.git linux-3.4.69-14t2-read
commit e8df7e99e91cfd96ef7fcf2df67e2ef42cda5aae

	add rtnl_lock() and rtnl_unlock() for dev_set_promiscuity() in
	mv_mux_mgr_probe() to pass the assertion of RTNL at net/core/
	dev.c (4483)

Signed-off-by: Ken Ma <make@marvell.com>

Change-Id: I761d93b43e1acf81cf74d4499eb91e64b0d8eadf
Signed-off-by: Ken Ma <make@marvell.com>
Reviewed-on: http://vgitil04.il.marvell.com:8080/7848
Tested-by: Star_Automation <star@marvell.com>
Reviewed-by: Uri Eliyahu <uriel@marvell.com>
Reviewed-by: Dmitri Epshtein <dima@marvell.com>
Signed-off-by: Zhong Hongbo <hongbo.zhong@windriver.com>
---
 .../mv_drivers_lsp/mv_mux/mv_mux_netdev.c          |    5 ++++-
 1 files changed, 4 insertions(+), 1 deletions(-)

diff --git a/arch/arm/plat-armada/mv_drivers_lsp/mv_mux/mv_mux_netdev.c b/arch/arm/plat-armada/mv_drivers_lsp/mv_mux/mv_mux_netdev.c
index abf3cec..eb4e66b 100644
--- a/arch/arm/plat-armada/mv_drivers_lsp/mv_mux/mv_mux_netdev.c
+++ b/arch/arm/plat-armada/mv_drivers_lsp/mv_mux/mv_mux_netdev.c
@@ -151,8 +151,11 @@ static int mv_mux_mgr_probe(int gbe_port)
 	/* config mux interfaces according to preset mode */
 	mv_mux_mgr_init(preset, vid, tag_mode, gbe_port);
 
-	if (tag_mode != MV_TAG_TYPE_NONE)
+	if (tag_mode != MV_TAG_TYPE_NONE) {
+		rtnl_lock();
 		dev_set_promiscuity(mux_eth_shadow[gbe_port].root, 1);
+		rtnl_unlock();
+	}
 
 	if (switch_ops && switch_ops->interrupt_unmask)
 		switch_ops->interrupt_unmask();
-- 
1.7.5.4

