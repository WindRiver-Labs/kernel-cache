From 0130d4b0217a5aadc0c03127f40f098b47e5728e Mon Sep 17 00:00:00 2001
From: Zhong Hongbo <hongbo.zhong@windriver.com>
Date: Thu, 16 Oct 2014 10:10:24 +0800
Subject: [PATCH 1822/1825] dmaengine: remove the second argument of
 k[un]map_atomic()

The upstream commit 980c19e3f8ca [highmem: mark k[un]map_atomic() with
two arguments as deprecated] will warn the users if they still use the
deprecated one.

But the commit b1e212fd2e59 [DMSP Splice & NetDMA support (by Lior A. )] from
https://github.com/MISL-EBU-System-SW/misl-windriver.git linux-3.4.69-14t2-read
use the deprecated one. So remove the second argument.

Signed-off-by: Zhong Hongbo <hongbo.zhong@windriver.com>
---
 drivers/dma/dmaengine.c |   12 ++++++------
 1 files changed, 6 insertions(+), 6 deletions(-)

diff --git a/drivers/dma/dmaengine.c b/drivers/dma/dmaengine.c
index 56772c7..5a3a9e6 100644
--- a/drivers/dma/dmaengine.c
+++ b/drivers/dma/dmaengine.c
@@ -924,7 +924,7 @@ dma_async_memcpy_buf_to_pg(struct dma_chan *chan, struct page *page,
 	unsigned long flags;
 
 	if (!page) {
-		printk(KERN_ERR "%s page %x\n", __FUNCTION__, (void*)page);
+		printk(KERN_ERR "%s page %p\n", __FUNCTION__, (void*)page);
 		return -EFAULT;
 	}
 	/*
@@ -935,9 +935,9 @@ dma_async_memcpy_buf_to_pg(struct dma_chan *chan, struct page *page,
 	*/
 	if (len < DMA_ENGINE_MIN_OP_SIZE)
 	{
-		void * dst = kmap_atomic(page, KM_USER0) + offset;
+		void * dst = kmap_atomic(page) + offset;
 		memcpy(dst, kdata, len);
-		kunmap_atomic(dst, KM_USER0);
+		kunmap_atomic(dst);
 
 		dma_src = dma_map_page(dev->dev, temp_page, 0, PAGE_SIZE, DMA_TO_DEVICE);
 		dma_dest = dma_map_page(dev->dev, temp_page, 0, PAGE_SIZE, DMA_FROM_DEVICE);
@@ -1006,7 +1006,7 @@ dma_async_memcpy_pg_to_pg(struct dma_chan *chan, struct page *dest_pg,
 	unsigned long flags;
 
 	if (!dest_pg || !src_pg) {
-		printk(KERN_ERR "%s dest_pg %x src_pg %x\n", __FUNCTION__, (void*)dest_pg, (void*)src_pg);
+		printk(KERN_ERR "%s dest_pg %p src_pg %p\n", __FUNCTION__, (void*)dest_pg, (void*)src_pg);
 		return -EFAULT;
 	}
 
@@ -1018,9 +1018,9 @@ dma_async_memcpy_pg_to_pg(struct dma_chan *chan, struct page *dest_pg,
 	*/
 	if (len < DMA_ENGINE_MIN_OP_SIZE)
 	{
-		void * dst = kmap_atomic(dest_pg, KM_USER0) + dest_off;
+		void * dst = kmap_atomic(dest_pg) + dest_off;
 		memcpy(dst, src_pg+src_off, len);
-		kunmap_atomic(dst, KM_USER0);
+		kunmap_atomic(dst);
 
 		dma_src = dma_map_page(dev->dev, temp_page, 0, PAGE_SIZE, DMA_TO_DEVICE);
 		dma_dest = dma_map_page(dev->dev, temp_page, 0, PAGE_SIZE, DMA_FROM_DEVICE);
-- 
1.7.5.4

