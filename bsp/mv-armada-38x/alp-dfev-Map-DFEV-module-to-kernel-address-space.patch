From ddf41e15734b3ae8dfa135b62fe64144cefe5d70 Mon Sep 17 00:00:00 2001
From: Yehuda Yitschak <yehuday@marvell.com>
Date: Wed, 15 Jan 2014 13:35:28 +0200
Subject: [PATCH 1281/1825] alp: dfev: Map DFEV module to kernel address
 space.

https://github.com/MISL-EBU-System-SW/misl-windriver.git linux-3.4.69-14t2-read
commit f34a99d1510f8e06023997af5ebc2327ffe65b24

	This commit maps the DFEV unit registers into kernel address space.

Change-Id: If6d81a9822b959df5cf2222d01f678b60c718656
Signed-off-by: Piotr Ziecik <kosmo@semihalf.com>
Signed-off-by: Yehuda Yitschak <yehuday@marvell.com>
Reviewed-on: http://vgitil04.il.marvell.com:8080/5143
Signed-off-by: Zhong Hongbo <hongbo.zhong@windriver.com>
---
 .../avanta_lp_family/ctrlEnv/mvCtrlEnvRegs.h       |    1 +
 .../avanta_lp_family/ctrlEnv/mvCtrlEnvSpec.h       |    5 ++++-
 arch/arm/mach-avantalp/include/mach/avantalp.h     |    4 ++++
 arch/arm/mach-avantalp/sysmap.c                    |    2 ++
 4 files changed, 11 insertions(+), 1 deletions(-)

diff --git a/arch/arm/mach-avantalp/avanta_lp_family/ctrlEnv/mvCtrlEnvRegs.h b/arch/arm/mach-avantalp/avanta_lp_family/ctrlEnv/mvCtrlEnvRegs.h
index e2c1784..2ff954f 100644
--- a/arch/arm/mach-avantalp/avanta_lp_family/ctrlEnv/mvCtrlEnvRegs.h
+++ b/arch/arm/mach-avantalp/avanta_lp_family/ctrlEnv/mvCtrlEnvRegs.h
@@ -377,6 +377,7 @@ typedef enum _mvTargetId {
 	USB3_TARGET_ID   = 5,  /* Port 5  -> USB3 Unit,			*/
 	PEX_TARGET_ID    = 4,  /* Port 4  -> PCI Express 0 and 1        */
 	CRYPT_TARGET_ID  = 9,  /* Port 9  -> Crypto Engine SRAM         */
+	DFEV_TARGET_ID   = 11, /* Port 11 -> DFEV Unit			*/
 	PP2_TARGET_ID = 15,    /* Port 12 -> PP2 Unit                   */
 	MAX_TARGETS_ID
 } MV_TARGET_ID;
diff --git a/arch/arm/mach-avantalp/avanta_lp_family/ctrlEnv/mvCtrlEnvSpec.h b/arch/arm/mach-avantalp/avanta_lp_family/ctrlEnv/mvCtrlEnvSpec.h
index f72ffdb..a355e65 100755
--- a/arch/arm/mach-avantalp/avanta_lp_family/ctrlEnv/mvCtrlEnvSpec.h
+++ b/arch/arm/mach-avantalp/avanta_lp_family/ctrlEnv/mvCtrlEnvSpec.h
@@ -484,6 +484,7 @@ typedef enum _mvTarget {
 	CRYPT0_ENG,	/* 25 Crypto0 Engine		*/
 	PP2_CPU0,	/* 26 PP2 - CPU 0		*/
 	PP2_CPU1,	/* 27 PP2 - CPU 1		*/
+	DFEV,		/* 28 DFEV Unit			*/
 	MAX_TARGETS
 } MV_TARGET;
 
@@ -536,6 +537,7 @@ typedef enum _mvTarget {
 	{ 0x01, CRYPT_TARGET_ID	},		/* CRYPT_ENG0            */ \
 	{ 0x00, PP2_TARGET_ID	},		/* PP2 - CPU 0           */ \
 	{ 0x01, PP2_TARGET_ID	},		/* PP2 - CPU 1           */ \
+	{ 0x00, DFEV_TARGET_ID },		/* DFEV			 */ \
 }
 
 #define CESA_TARGET_NAME_DEF	("CRYPT_ENG0", "CRYPT_ENG1")
@@ -567,7 +569,8 @@ typedef enum _mvTarget {
 	"USB3",                 /* USB3 */		\
 	"CRYPT1_ENG",		/* CRYPT1_ENG */	\
 	"PP2 - CPU 0",		/* PP2 - CPU 0 */	\
-	"PP2 - CPU 1"		/* PP2 - CPU 1 */	\
+	"PP2 - CPU 1",		/* PP2 - CPU 1 */	\
+	"DFEV"			/* DFEV */		\
 }
 
 
diff --git a/arch/arm/mach-avantalp/include/mach/avantalp.h b/arch/arm/mach-avantalp/include/mach/avantalp.h
index dd70877..924409a 100644
--- a/arch/arm/mach-avantalp/include/mach/avantalp.h
+++ b/arch/arm/mach-avantalp/include/mach/avantalp.h
@@ -71,6 +71,9 @@
 #define PP2_CPU1_PHYS_BASE		0xF4510000
 #define PP2_SIZE			_64K
 
+#define DFEV_PHYS_BASE			0xF4600000
+#define DFEV_SIZE			_1M
+
 #define BOOTROM_PHYS_BASE		0xFFF00000
 #define BOOTROM_SIZE			_1M
 
@@ -112,6 +115,7 @@
 #define PP2_CPU0_VIRT_BASE		0xFEC00000
 #define PP2_CPU1_VIRT_BASE		0xFEC10000
 #define BOOTROM_VIRT_BASE		0xFED00000
+#define DFEV_VIRT_BASE			0xFEE00000
 #define LEGACY_NAND_VIRT_BASE		0xFEF00000
 
 /*
diff --git a/arch/arm/mach-avantalp/sysmap.c b/arch/arm/mach-avantalp/sysmap.c
index e2887a0..043dd02 100644
--- a/arch/arm/mach-avantalp/sysmap.c
+++ b/arch/arm/mach-avantalp/sysmap.c
@@ -35,6 +35,7 @@ struct map_desc MEM_TABLE[] = {
 #endif
 	{ CRYPT_ENG_VIRT_BASE(0),	__phys_to_pfn(CRYPT_ENG_PHYS_BASE(0)),	CRYPT_ENG_SIZE,	MT_DEVICE },
 	{ IOCC_WA_WIN0_VIRT_BASE,	__phys_to_pfn(IOCC_WA_WIN0_PHYS_BASE),	SZ_64K,		MT_DEVICE },
+	{ DFEV_VIRT_BASE,		__phys_to_pfn(DFEV_PHYS_BASE),		SZ_1M,		MT_DEVICE },
 };
 
 MV_CPU_DEC_WIN SYSMAP_ALP_6660[] = {
@@ -71,6 +72,7 @@ MV_CPU_DEC_WIN SYSMAP_ALP_6660[] = {
 #else
 	{{TBL_UNUSED,			0,	TBL_UNUSED,		},	TBL_UNUSED,		DIS},	/* PP2 */
 #endif
+	{{DFEV_PHYS_BASE,		0,	DFEV_SIZE,		},	7,			EN},	/* VOICE */
 	{{TBL_TERM,			TBL_TERM,	TBL_TERM	},	TBL_TERM,		TBL_TERM}
 };
 
-- 
1.7.5.4

