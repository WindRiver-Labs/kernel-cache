From 15bb0fa83526f88a8e898db9ff66cc3704748cad Mon Sep 17 00:00:00 2001
From: Jerry Huang <Chang-Ming.Huang@freescale.com>
Date: Fri, 15 Jan 2010 14:59:04 +0800
Subject: [PATCH 09/23] SDHCI: add abort to multiple block transfer

extract from vendor drop _QorIQ_SDK_V1_0x_systembuilder.iso.

ABORT command has to be send to stop multiblock transfer.

Signed-off-by: Jerry Huang <Chang-Ming.Huang@freescale.com>
Signed-off-by: Dipen Dudhat <dipen.dudhat@freescale.com>
---
 drivers/mmc/host/sdhci.c |    3 +++
 1 file changed, 3 insertions(+)

diff --git a/drivers/mmc/host/sdhci.c b/drivers/mmc/host/sdhci.c
index e1019db..44626a6 100644
--- a/drivers/mmc/host/sdhci.c
+++ b/drivers/mmc/host/sdhci.c
@@ -1023,6 +1023,9 @@ static void sdhci_send_command(struct sdhci_host *host, struct mmc_command *cmd)
 	    cmd->opcode == MMC_SEND_TUNING_BLOCK_HS200)
 		flags |= SDHCI_CMD_DATA;
 
+	if (host->mrq->data && (cmd == host->mrq->data->stop))
+		flags = flags |  SDHCI_CMD_ABORTCMD;
+
 	sdhci_writew(host, SDHCI_MAKE_CMD(cmd->opcode, flags), SDHCI_COMMAND);
 }
 
-- 
1.7.9.7

