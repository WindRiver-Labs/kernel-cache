From 87cce4bb7f4aeefba12d05c08d23249a6869e7ea Mon Sep 17 00:00:00 2001
From: Takeshi Kihara <takeshi.kihara.df@renesas.com>
Date: Thu, 2 Feb 2017 21:35:35 +0900
Subject: [PATCH 1701/2066] Revert "watchdog: renesas-wdt: Support DDR backup"

This reverts commit 6e20081e24fb ("watchdog: renesas-wdt: Support DDR
backup").

Since a timer count is re-setup with a timeout value by resume, backup
of a register is unnecessary.

Signed-off-by: Takeshi Kihara <takeshi.kihara.df@renesas.com>
[zou:Original patch taken from
git://git.kernel.org/pub/scm/linux/kernel/git/horms/renesas-bsp.git
 v4.9/rcar-3.5.1]
Signed-off-by: zou cao <cao.zou@windriver.com>
---
 drivers/watchdog/renesas_wdt.c |   46 ----------------------------------------
 1 files changed, 0 insertions(+), 46 deletions(-)

diff --git a/drivers/watchdog/renesas_wdt.c b/drivers/watchdog/renesas_wdt.c
index d14ac2c..83b513f 100644
--- a/drivers/watchdog/renesas_wdt.c
+++ b/drivers/watchdog/renesas_wdt.c
@@ -16,7 +16,6 @@
 #include <linux/of.h>
 #include <linux/platform_device.h>
 #include <linux/pm_runtime.h>
-#include <linux/soc/renesas/s2ram_ddr_backup.h>
 #include <linux/watchdog.h>
 
 #define RWTCNT		0
@@ -27,19 +26,6 @@
 
 #define RWDT_DEFAULT_TIMEOUT 60U
 
-#ifdef CONFIG_RCAR_DDR_BACKUP
-static struct hw_register rwdt_ip_regs[] = {
-	{"RWTCNT",   0x00, 16, 0},
-	{"RWTCSRA",  0x04, 8, 0},
-};
-
-static struct rcar_ip rwdt_ip = {
-	.ip_name = "RWDT",
-	.reg_count = ARRAY_SIZE(rwdt_ip_regs),
-	.ip_reg = rwdt_ip_regs,
-};
-#endif /* CONFIG_RCAR_DDR_BACKUP*/
-
 static const unsigned int clk_divs[] = { 1, 4, 16, 32, 64, 128, 1024 };
 
 static bool nowayout = WATCHDOG_NOWAYOUT;
@@ -222,41 +208,9 @@ static const struct of_device_id rwdt_ids[] = {
 };
 MODULE_DEVICE_TABLE(of, rwdt_ids);
 
-#ifdef CONFIG_PM_SLEEP
-static int rwdt_suspend(struct device *dev)
-{
-	int ret = 0;
-#ifdef CONFIG_RCAR_DDR_BACKUP
-	struct rwdt_priv *priv = dev_get_drvdata(dev);
-
-	if (!rwdt_ip.virt_addr)
-		rwdt_ip.virt_addr = priv->base;
-
-	ret = handle_registers(&rwdt_ip, DO_BACKUP);
-#endif /* CONFIG_RCAR_DDR_BACKUP */
-	return ret;
-}
-
-static int rwdt_resume(struct device *dev)
-{
-	int ret = 0;
-#ifdef CONFIG_RCAR_DDR_BACKUP
-	ret = handle_registers(&rwdt_ip, DO_RESTORE);
-#endif /* CONFIG_RCAR_DDR_BACKUP */
-	return ret;
-}
-
-static SIMPLE_DEV_PM_OPS(rwdt_pm_ops,
-			rwdt_suspend, rwdt_resume);
-#define DEV_PM_OPS (&rwdt_pm_ops)
-#else
-#define DEV_PM_OPS NULL
-#endif /* CONFIG_PM_SLEEP */
-
 static struct platform_driver rwdt_driver = {
 	.driver = {
 		.name = "renesas_wdt",
-		.pm	= DEV_PM_OPS,
 		.of_match_table = rwdt_ids,
 	},
 	.probe = rwdt_probe,
-- 
1.7.5.4

