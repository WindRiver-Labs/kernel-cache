From 33a33327203e06f7c51658089391694dfa5155fe Mon Sep 17 00:00:00 2001
From: Hien Dang <hien.dang.eb@rvc.renesas.com>
Date: Tue, 23 Feb 2016 16:57:42 +0700
Subject: [PATCH 1286/2066] thermal: rcar_gen3_thermal: Split up temp
 converter formula

Without this patch, converted temperature will be incorrect in some cases.

Signed-off-by: Hien Dang <hien.dang.eb@rvc.renesas.com>
[zou:Original patch taken from
git://git.kernel.org/pub/scm/linux/kernel/git/horms/renesas-bsp.git
 v4.9/rcar-3.5.1]
Signed-off-by: zou cao <cao.zou@windriver.com>
---
 drivers/thermal/rcar_gen3_thermal.c |    8 ++++----
 1 files changed, 4 insertions(+), 4 deletions(-)

diff --git a/drivers/thermal/rcar_gen3_thermal.c b/drivers/thermal/rcar_gen3_thermal.c
index 8761644..3fcf696 100644
--- a/drivers/thermal/rcar_gen3_thermal.c
+++ b/drivers/thermal/rcar_gen3_thermal.c
@@ -310,10 +310,10 @@ int _quadratic_temp_converter(struct equation_coefs coef, int temp_code)
 	delta = coef.b * coef.b - 4 * coef.a * (coef.c - 10000 * temp_code);
 
 	/* Multiply temp with 1000 to convert to Mili-Celsius */
-	temp1 = (CODETSD(-coef.b) + int_sqrt(1000000 * delta))
-				/ (2 * coef.a);
-	temp2 = (CODETSD(-coef.b) - int_sqrt(1000000 * delta))
-				/ (2 * coef.a);
+	temp1 = (CODETSD(-coef.b) + int_sqrt(1000000 * delta)) / 2;
+	temp1 = temp1 / coef.a;
+	temp2 = (CODETSD(-coef.b) - int_sqrt(1000000 * delta)) / 2;
+	temp2 = temp2 / coef.a;
 
 	if (temp1 > -45000000)
 		temp = temp1;
-- 
1.7.5.4

