From f06e1b097f253c4c9de986ecf3df2edd3d1630e2 Mon Sep 17 00:00:00 2001
From: Geert Uytterhoeven <geert+renesas@glider.be>
Date: Tue, 7 Jul 2015 15:06:34 +0200
Subject: [PATCH 1050/2066] ARM: shmobile: rcar-gen2: Stop passing mode pins
 state to clock driver

Now the R-Car Gen2 CPG clock driver obtains the state of the mode pins
from the R-Car RST driver, there's no longer a need to pass this state
explicitly. Hence we can just call of_clk_init() instead.

Signed-off-by: Geert Uytterhoeven <geert+renesas@glider.be>
Acked-by: Dirk Behme <dirk.behme@de.bosch.com>
[zou:Original patch taken from
git://git.kernel.org/pub/scm/linux/kernel/git/horms/renesas-bsp.git
 v4.9/rcar-3.5.1]
Signed-off-by: zou cao <cao.zou@windriver.com>
---
 arch/arm/mach-shmobile/setup-rcar-gen2.c |   15 +++------------
 1 files changed, 3 insertions(+), 12 deletions(-)

diff --git a/arch/arm/mach-shmobile/setup-rcar-gen2.c b/arch/arm/mach-shmobile/setup-rcar-gen2.c
index 468d4ee..82bef0f 100644
--- a/arch/arm/mach-shmobile/setup-rcar-gen2.c
+++ b/arch/arm/mach-shmobile/setup-rcar-gen2.c
@@ -16,7 +16,7 @@
  */
 
 #include <linux/clk-provider.h>
-#include <linux/clk/renesas.h>
+#include <linux/clk-provider.h>
 #include <linux/clocksource.h>
 #include <linux/device.h>
 #include <linux/dma-contiguous.h>
@@ -72,7 +72,6 @@ static unsigned int __init get_extal_freq(void)
 
 void __init rcar_gen2_timer_init(void)
 {
-	u32 mode = rcar_gen2_read_mode_pins();
 #ifdef CONFIG_ARM_ARCH_TIMER
 	void __iomem *base;
 	u32 freq;
@@ -131,16 +130,8 @@ void __init rcar_gen2_timer_init(void)
 	iounmap(base);
 #endif /* CONFIG_ARM_ARCH_TIMER */
 
-	if (IS_ENABLED(CONFIG_ARCH_R8A7790) ||
-	    IS_ENABLED(CONFIG_ARCH_R8A7791) ||
-	    IS_ENABLED(CONFIG_ARCH_R8A7792) ||
-	    IS_ENABLED(CONFIG_ARCH_R8A7793) ||
-	    IS_ENABLED(CONFIG_ARCH_R8A7794))
-		rcar_gen2_clocks_init(mode);
-	else
-		of_clk_init(NULL);
-
-	clocksource_of_init();
+	of_clk_init(NULL);
+	clocksource_probe();
 }
 
 struct memory_reserve_config {
-- 
1.7.5.4

