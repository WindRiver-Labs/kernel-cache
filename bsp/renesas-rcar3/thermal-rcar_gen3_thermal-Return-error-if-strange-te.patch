From 1c4a9005315ffc2e43538ac9bb35af3009e5d202 Mon Sep 17 00:00:00 2001
From: Hien Dang <hien.dang.eb@rvc.renesas.com>
Date: Thu, 17 Dec 2015 12:52:35 +0700
Subject: [PATCH 1277/2066] thermal: rcar_gen3_thermal: Return error if
 strange temperature

Signed-off-by: Hien Dang <hien.dang.eb@rvc.renesas.com>
[zou:Original patch taken from
git://git.kernel.org/pub/scm/linux/kernel/git/horms/renesas-bsp.git
 v4.9/rcar-3.5.1]
Signed-off-by: zou cao <cao.zou@windriver.com>
---
 drivers/thermal/rcar_gen3_thermal.c |    8 ++++++++
 1 files changed, 8 insertions(+), 0 deletions(-)

diff --git a/drivers/thermal/rcar_gen3_thermal.c b/drivers/thermal/rcar_gen3_thermal.c
index a559ed6..520bc4e 100644
--- a/drivers/thermal/rcar_gen3_thermal.c
+++ b/drivers/thermal/rcar_gen3_thermal.c
@@ -375,6 +375,14 @@ static int rcar_gen3_thermal_get_temp(void *devdata, int *temp)
 	ctemp = thermal_temp_converter(priv->coef, priv->ctemp);
 	spin_unlock_irqrestore(&priv->lock, flags);
 
+	if ((ctemp < MCELSIUS(-40)) || (ctemp > MCELSIUS(125))) {
+		struct device *dev = rcar_priv_to_dev(priv);
+
+		dev_err(dev, "Temperature is not measured correclty!\n");
+
+		return -EIO;
+	}
+
 	*temp = ctemp;
 
 	return 0;
-- 
1.7.5.4

