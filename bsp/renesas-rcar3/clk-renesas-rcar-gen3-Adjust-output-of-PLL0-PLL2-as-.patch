From 59a9a478d552d1ed3ad14bc7ae60a1d2c9bfb759 Mon Sep 17 00:00:00 2001
From: Dien Pham <dien.pham.ry@rvc.renesas.com>
Date: Fri, 20 May 2016 14:27:21 +0900
Subject: [PATCH 1256/2066] clk: renesas: rcar-gen3: Adjust output of PLL0,
 PLL2 as SYSC-CPUs input

In HWM, PLL0CR register part has below description:
PLL0 output: (PLL0VCO) = (PLL0 reference clock) * (setting+1) * 2
Sys-cpu clk input: (SYS-CPU divider 1 input) = PLL0VCO * 1/2

So, this patch modifies output of PLL0 driver is as
input of sys-cpu(s). And it is also similar for PLL2.

Signed-off-by: Dien Pham <dien.pham.ry@rvc.renesas.com>
Signed-off-by: Takeshi Kihara <takeshi.kihara.df@renesas.com>
[zou:Original patch taken from
git://git.kernel.org/pub/scm/linux/kernel/git/horms/renesas-bsp.git
 v4.9/rcar-3.5.1]
Signed-off-by: zou cao <cao.zou@windriver.com>
---
 drivers/clk/renesas/rcar-gen3-cpg.c |    4 ++--
 1 files changed, 2 insertions(+), 2 deletions(-)

diff --git a/drivers/clk/renesas/rcar-gen3-cpg.c b/drivers/clk/renesas/rcar-gen3-cpg.c
index d94d787..47d037c 100644
--- a/drivers/clk/renesas/rcar-gen3-cpg.c
+++ b/drivers/clk/renesas/rcar-gen3-cpg.c
@@ -531,7 +531,7 @@ struct clk * __init rcar_gen3_cpg_clk_register(struct device *dev,
 		 * the multiplier value.
 		 */
 		value = readl(base + CPG_PLL0CR);
-		mult = (((value >> 24) & 0x7f) + 1) * 2;
+		mult = ((value >> 24) & 0x7f) + 1;
 		/* Start clock issue W/A (for H3 WS1.0) */
 		if (soc_device_match(r8a7795es10))
 			mult *= 2; /* PLL0 output multiplied by 2 */
@@ -550,7 +550,7 @@ struct clk * __init rcar_gen3_cpg_clk_register(struct device *dev,
 		 * the multiplier value.
 		 */
 		value = readl(base + CPG_PLL2CR);
-		mult = (((value >> 24) & 0x7f) + 1) * 2;
+		mult = ((value >> 24) & 0x7f) + 1;
 		/* Start clock issue W/A (for H3 WS1.0) */
 		if (soc_device_match(r8a7795es10))
 			mult *= 2; /* PLL0 output multiplied by 2 */
-- 
1.7.5.4

