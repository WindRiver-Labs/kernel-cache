From 4d5d8fd6b097cbd82f69b15c2daded5cab048256 Mon Sep 17 00:00:00 2001
From: Hien Dang <hien.dang.eb@rvc.renesas.com>
Date: Thu, 2 Jun 2016 10:35:26 +0700
Subject: [PATCH 1317/2066] soc: renesas: rcar_ems_ctrl: Exclude A53 out of
 targeted frequency scaled CPU

Signed-off-by: Hien Dang <hien.dang.eb@rvc.renesas.com>
[zou:Original patch taken from
git://git.kernel.org/pub/scm/linux/kernel/git/horms/renesas-bsp.git
 v4.9/rcar-3.5.1]
Signed-off-by: zou cao <cao.zou@windriver.com>
---
 drivers/soc/renesas/rcar_ems_ctrl.c |    7 +++++--
 1 files changed, 5 insertions(+), 2 deletions(-)

diff --git a/drivers/soc/renesas/rcar_ems_ctrl.c b/drivers/soc/renesas/rcar_ems_ctrl.c
index ff63cb1..341c128 100644
--- a/drivers/soc/renesas/rcar_ems_ctrl.c
+++ b/drivers/soc/renesas/rcar_ems_ctrl.c
@@ -248,7 +248,7 @@ static struct notifier_block ems_cpufreq_notifier_block = {
 static int __init rcar_ems_cpu_shutdown_init(void)
 {
 	int cpu;
-	struct device_node *cpu_node, *ems_node;
+	struct device_node *cpu_node, *ems_node, *tmp_node;
 	int total_target_cpu, i;
 
 	if (!IS_ENABLED(CONFIG_RCAR_THERMAL_EMS_ENABLED))
@@ -266,9 +266,12 @@ static int __init rcar_ems_cpu_shutdown_init(void)
 						"target_cpus", 0);
 
 	for_each_online_cpu(cpu) {
+		tmp_node  = of_get_cpu_node(cpu, NULL);
+		if (!of_device_is_compatible(tmp_node, "arm,cortex-a57"))
+			continue;
 		for (i = 0; i < total_target_cpu; i++) {
 			cpu_node = of_parse_phandle(ems_node, "target_cpus", i);
-			if (of_get_cpu_node(cpu, NULL) == cpu_node) {
+			if (tmp_node == cpu_node) {
 				cpumask_set_cpu(cpu, &target_cpus);
 				break;
 			}
-- 
1.7.5.4

