From 8a647c1b5e6c1396529439c0b2ead1d87460b2bf Mon Sep 17 00:00:00 2001
From: Hien Dang <hien.dang.eb@rvc.renesas.com>
Date: Thu, 18 Feb 2016 18:33:14 +0700
Subject: [PATCH 1510/2066] arm64: dts: r8a7795: Create thermal zone to
 support IPA

Setup a thermal zone driven by SoC temperature sensor.
Create passive trip points and bind them to CPUFreq cooling
device that supports power extension.

Signed-off-by: Keita Kobayashi <keita.kobayashi.ym@renesas.com>
[gaku.inami.xw: fix the trip temperature for cooling-device]
[gaku.inami.xw: fix the power coefficient]
Signed-off-by: Gaku Inami <gaku.inami.xw@bp.renesas.com>
Signed-off-by: Hien Dang <hien.dang.eb@rvc.renesas.com>
Signed-off-by: Takeshi Kihara <takeshi.kihara.df@renesas.com>
[zou:Original patch taken from
git://git.kernel.org/pub/scm/linux/kernel/git/horms/renesas-bsp.git
 v4.9/rcar-3.5.1]
Signed-off-by: zou cao <cao.zou@windriver.com>
---
 arch/arm64/boot/dts/renesas/r8a7795.dtsi |   38 ++++++++++++++++++++++++++----
 1 files changed, 33 insertions(+), 5 deletions(-)

diff --git a/arch/arm64/boot/dts/renesas/r8a7795.dtsi b/arch/arm64/boot/dts/renesas/r8a7795.dtsi
index 501b8fa..16ec9ae 100644
--- a/arch/arm64/boot/dts/renesas/r8a7795.dtsi
+++ b/arch/arm64/boot/dts/renesas/r8a7795.dtsi
@@ -64,6 +64,10 @@
 			next-level-cache = <&L2_CA57>;
 			enable-method = "psci";
 			cpu-idle-states = <&CPU_SLEEP_0>;
+			#cooling-cells = <2>;
+			dynamic-power-coefficient = <854>;
+			cooling-min-level = <0>;
+			cooling-max-level = <2>;
 		};
 
 		a57_1: cpu@1 {
@@ -101,6 +105,7 @@
 			reg = <0x100>;
 			device_type = "cpu";
 			enable-method = "psci";
+			dynamic-power-coefficient = <277>;
 		};
 
 		a53_1: cpu@101 {
@@ -2487,14 +2492,14 @@
 			sensor_thermal1: sensor-thermal1 {
 				polling-delay-passive = <250>;
 				polling-delay = <0>;
-				sustainable-power = <2000>;
+				sustainable-power = <6313>;
 
 				/* sensor ID */
 				thermal-sensors = <&tsc1>;
 
 				trips {
 					sensor1_crit: sensor1-crit {
-						temperature = <90000>;
+						temperature = <120000>;
 						hysteresis = <2000>;
 						type = "critical";
 					};
@@ -2504,14 +2509,14 @@
 			sensor_thermal2: sensor-thermal2 {
 				polling-delay-passive = <250>;
 				polling-delay = <0>;
-				sustainable-power = <2000>;
+				sustainable-power = <6313>;
 
 				/* sensor ID */
 				thermal-sensors = <&tsc2>;
 
 				trips {
 					sensor2_crit: sensor2-crit {
-						temperature = <90000>;
+						temperature = <120000>;
 						hysteresis = <2000>;
 						type = "critical";
 					};
@@ -2521,17 +2526,40 @@
 			sensor_thermal3: sensor-thermal3 {
 				polling-delay-passive = <250>;
 				polling-delay = <0>;
+				sustainable-power = <6313>;
 
 				/* sensor ID */
 				thermal-sensors = <&tsc3>;
 
 				trips {
-					sensor3_crit: sensor3-crit {
+					threshold: trip-point@0 {
+						/* miliCelsius  */
 						temperature = <90000>;
 						hysteresis = <2000>;
+						type = "passive";
+					};
+
+					target: trip-point@1 {
+						/* miliCelsius  */
+						temperature = <100000>;
+						hysteresis = <2000>;
+						type = "passive";
+					};
+
+					sensor3_crit: sensor3-crit {
+						temperature = <120000>;
+						hysteresis = <2000>;
 						type = "critical";
 					};
 				};
+
+				cooling-maps {
+					map0 {
+						trip = <&target>;
+						cooling-device = <&a57_0 0 2>;
+						contribution = <1024>;
+					};
+				};
 			};
 		};
 	};
-- 
1.7.5.4

