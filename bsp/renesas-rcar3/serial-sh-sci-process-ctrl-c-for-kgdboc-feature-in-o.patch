From 5052d605dbc0aa50f7d915e853de50d60ddfcd31 Mon Sep 17 00:00:00 2001
From: zou cao <cao.zou@windriver.com>
Date: Fri, 21 Jul 2017 17:27:23 +0800
Subject: [PATCH] serial: sh-sci: process ctrl+c for kgdboc feature in others
 port type

Add to process ctrl+c for kgdboc feature in others port type, not only
PORT_SCI

Signed-off-by: zou cao <cao.zou@windriver.com>
---
 drivers/tty/serial/sh-sci.c |    9 +++++++++
 1 files changed, 9 insertions(+), 0 deletions(-)

diff --git a/drivers/tty/serial/sh-sci.c b/drivers/tty/serial/sh-sci.c
index 9a3e78b..df0ca95 100644
--- a/drivers/tty/serial/sh-sci.c
+++ b/drivers/tty/serial/sh-sci.c
@@ -1194,6 +1194,15 @@ static void sci_receive_chars(struct uart_port *port)
 					}
 				}
 #endif /* CONFIG_CPU_SH3 */
+
+#ifdef CONFIG_CONSOLE_POLL
+				if (port->poll_rx_cb && port->poll_rx_cb(c & 255)) {
+					serial_port_in(port, SCxSR); /* dummy read */
+					sci_clear_SCxSR(port, SCxSR_RDxF_CLEAR(port));
+					continue;
+				}
+#endif
+
 				if (uart_handle_sysrq_char(port, c)) {
 					count--; i--;
 					continue;
-- 
1.7.5.4

