From e81c2419149f65e57592d94876b05a8e2238bfea Mon Sep 17 00:00:00 2001
From: Khiem Nguyen <khiem.nguyen.xt@rvc.renesas.com>
Date: Thu, 5 Nov 2015 22:08:25 +0700
Subject: [PATCH 22/26] firmware: psci: Let CPU0 handle Trusted OS by default

Since CPU0 will handle DDR training periodically, it's not allowed
to be turned off via CPU Hotplug processing. While DDR training is
considered as Trusted OS service, the firmware should notify that
information to Linux kernel.

While the firmware is not supported that information yet, let
hard-code that configuration to Linux kernel side.
This is quick hack for current situation. It will be reverted
in future.

Not for upstream merge.

Signed-off-by: Khiem Nguyen <khiem.nguyen.xt@rvc.renesas.com>
(cherry picked from commit b6427ead9fb1aa59aabc34f90c9a4b367979186c)
---
 drivers/firmware/psci.c |    7 +++++++
 1 files changed, 7 insertions(+), 0 deletions(-)

diff --git a/drivers/firmware/psci.c b/drivers/firmware/psci.c
index b9bea27..2a3ccbc 100644
--- a/drivers/firmware/psci.c
+++ b/drivers/firmware/psci.c
@@ -485,6 +485,13 @@ static int __init psci_probe(void)
 	psci_0_2_set_functions();
 
 	psci_init_migrate();
+	/*
+	 * psci_init_migrate() might fail to get needed information due to
+	 * incomplete firmware support.
+	 * FIXME: Let's assume that Trusted OS services (e.g DDR training)
+	 * always run in CPU0.
+	 */
+	resident_cpu = 0;
 
 	if (PSCI_VERSION_MAJOR(ver) >= 1) {
 		psci_init_cpu_suspend();
-- 
1.7.5.4

