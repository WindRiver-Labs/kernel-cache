From 73cac91ba9b211f1c10ffd023692ecac2c4273a3 Mon Sep 17 00:00:00 2001
From: Hien Dang <hien.dang.eb@renesas.com>
Date: Wed, 17 Aug 2016 15:18:26 +0700
Subject: [PATCH 1669/2066] i2c: sh_mobile: Use pm_runtime_get/put when
 suspend

Due to the commit '39dd0f234fc37d ("PM / Domains: Allow runtime PM during
system PM phases")', runtime PM status might be suspended when back up
module registers. Therefore, it is necessary to ensure device is
on during suspend by using pm_runtime_get/put.

Signed-off-by: Hien Dang <hien.dang.eb@renesas.com>
[zou:Original patch taken from
git://git.kernel.org/pub/scm/linux/kernel/git/horms/renesas-bsp.git
 v4.9/rcar-3.5.1]
Signed-off-by: zou cao <cao.zou@windriver.com>
---
 drivers/i2c/busses/i2c-sh_mobile.c |    2 ++
 1 files changed, 2 insertions(+), 0 deletions(-)

diff --git a/drivers/i2c/busses/i2c-sh_mobile.c b/drivers/i2c/busses/i2c-sh_mobile.c
index 4556f63..4339d45 100644
--- a/drivers/i2c/busses/i2c-sh_mobile.c
+++ b/drivers/i2c/busses/i2c-sh_mobile.c
@@ -1042,7 +1042,9 @@ static int sh_mobile_i2c_suspend(struct device *dev)
 
 	if (!i2c_dvfs_ip.virt_addr)
 		i2c_dvfs_ip.virt_addr = i2c_data->reg;
+	pm_runtime_get_sync(dev);
 	ret = rcar_handle_registers(&i2c_dvfs_ip, DO_BACKUP);
+	pm_runtime_put(dev);
 #endif /* CONFIG_RCAR_DDR_BACKUP  */
 	return ret;
 }
-- 
1.7.5.4

