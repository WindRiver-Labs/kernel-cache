From 110a1869e74c2a6548ea5d37deb8576a0c910985 Mon Sep 17 00:00:00 2001
From: Hien Dang <hien.dang.eb@renesas.com>
Date: Wed, 17 Aug 2016 16:13:54 +0700
Subject: [PATCH 1671/2066] spi: sh-msiof: Use pm_runtime_get/put when suspend

Due to the commit '39dd0f234fc37d ("PM / Domains: Allow runtime PM during
system PM phases")', runtime PM status might be suspended when back up
module registers. Therefore, it is necessary to ensure device is
on during suspend by using pm_runtime_get/put.

Signed-off-by: Keita Kobayashi <keita.kobayashi.ym@renesas.com>
Signed-off-by: Hien Dang <hien.dang.eb@renesas.com>
[zou:Original patch taken from
git://git.kernel.org/pub/scm/linux/kernel/git/horms/renesas-bsp.git
 v4.9/rcar-3.5.1]
Signed-off-by: zou cao <cao.zou@windriver.com>
---
 drivers/spi/spi-sh-msiof.c |    2 ++
 1 files changed, 2 insertions(+), 0 deletions(-)

diff --git a/drivers/spi/spi-sh-msiof.c b/drivers/spi/spi-sh-msiof.c
index 3f8abe0..e488c2e 100644
--- a/drivers/spi/spi-sh-msiof.c
+++ b/drivers/spi/spi-sh-msiof.c
@@ -1573,7 +1573,9 @@ static int sh_msiof_spi_suspend(struct device *dev)
 #ifdef CONFIG_RCAR_DDR_BACKUP
 	struct platform_device *pdev = to_platform_device(dev);
 
+	pm_runtime_get_sync(dev);
 	ret = msiof_save_regs(pdev);
+	pm_runtime_put(dev);
 #endif /* CONFIG_RCAR_DDR_BACKUP */
 	return ret;
 }
-- 
1.7.5.4

