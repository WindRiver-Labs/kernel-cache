From 91454fa94a7dcff2fa5ac9bdb73c5321714df8b1 Mon Sep 17 00:00:00 2001
From: Hien Dang <hien.dang.eb@rvc.renesas.com>
Date: Fri, 18 Mar 2016 13:25:16 +0700
Subject: [PATCH 1606/2066] arm64: dts: r8a7796: Create thermal zone to
 support IPA

Setup a thermal zone driven by SoC temperature sensor.
Create passive trip points and bind them to CPUFreq cooling
device that supports power extension.

Signed-off-by: Hien Dang <hien.dang.eb@rvc.renesas.com>
Signed-off-by: Takeshi Kihara <takeshi.kihara.df@renesas.com>
[zou:Original patch taken from
git://git.kernel.org/pub/scm/linux/kernel/git/horms/renesas-bsp.git
 v4.9/rcar-3.5.1]
Signed-off-by: zou cao <cao.zou@windriver.com>
---
 arch/arm64/boot/dts/renesas/r8a7796.dtsi |   39 ++++++++++++++++++++++++++----
 1 files changed, 34 insertions(+), 5 deletions(-)

diff --git a/arch/arm64/boot/dts/renesas/r8a7796.dtsi b/arch/arm64/boot/dts/renesas/r8a7796.dtsi
index 7bb7d99..cb83997 100644
--- a/arch/arm64/boot/dts/renesas/r8a7796.dtsi
+++ b/arch/arm64/boot/dts/renesas/r8a7796.dtsi
@@ -62,6 +62,10 @@
 			next-level-cache = <&L2_CA57>;
 			enable-method = "psci";
 			cpu-idle-states = <&CPU_SLEEP_0>;
+			#cooling-cells = <2>;
+			dynamic-power-coefficient = <854>;
+			cooling-min-level = <0>;
+			cooling-max-level = <2>;
 		};
 
 		a57_1: cpu@1 {
@@ -79,6 +83,7 @@
 			reg = <0x100>;
 			device_type = "cpu";
 			enable-method = "psci";
+			dynamic-power-coefficient = <277>;
 		};
 
 		a53_1: cpu@101 {
@@ -2094,14 +2099,14 @@
 			sensor_thermal1: sensor-thermal1 {
 				polling-delay-passive = <250>;
 				polling-delay = <0>;
-				sustainable-power = <2000>;
+				sustainable-power = <3874>;
 
 				/* sensor ID */
 				thermal-sensors = <&tsc1>;
 
 				trips {
 					sensor1_crit: sensor1-crit {
-						temperature = <90000>;
+						temperature = <120000>;
 						hysteresis = <2000>;
 						type = "critical";
 					};
@@ -2111,14 +2116,14 @@
 			sensor_thermal2: sensor-thermal2 {
 				polling-delay-passive = <250>;
 				polling-delay = <0>;
-				sustainable-power = <2000>;
+				sustainable-power = <3874>;
 
 				/* sensor ID */
 				thermal-sensors = <&tsc2>;
 
 				trips {
 					sensor2_crit: sensor2-crit {
-						temperature = <90000>;
+						temperature = <120000>;
 						hysteresis = <2000>;
 						type = "critical";
 					};
@@ -2128,15 +2133,39 @@
 			sensor_thermal3: sensor-thermal3 {
 				polling-delay-passive = <250>;
 				polling-delay = <0>;
+				sustainable-power = <3874>;
 
 				/* sensor ID */
 				thermal-sensors = <&tsc3>;
 
 				trips {
-					sensor3_crit: sensor3-crit {
+					threshold: trip-point@0 {
+						/* miliCelsius  */
 						temperature = <90000>;
 						hysteresis = <2000>;
+						type = "passive";
+					};
+
+					target: trip-point@1 {
+						/* miliCelsius  */
+						temperature = <100000>;
+						hysteresis = <2000>;
+						type = "passive";
+					};
+
+					sensor3_crit: sensor3-crit {
+						temperature = <120000>;
+						hysteresis = <2000>;
 						type = "critical";
+					};
+				};
+
+				cooling-maps {
+					map0 {
+						trip = <&target>;
+						cooling-device = <&a57_0 0 2>;
+						contribution = <1024>;
+					};
 				};
 			};
 		};
-- 
1.7.5.4

