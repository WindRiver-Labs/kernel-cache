From d09608f967572be0981c140692fd9f02663dfcea Mon Sep 17 00:00:00 2001
From: Koji Matsuoka <koji.matsuoka.xm@renesas.com>
Date: Thu, 29 Oct 2015 16:59:14 +0900
Subject: [PATCH 1894/2066] media: i2c: adv7482: Fix saturation control for
 CVBS input

Signed-off-by: Koji Matsuoka <koji.matsuoka.xm@renesas.com>
[zou:Original patch taken from
git://git.kernel.org/pub/scm/linux/kernel/git/horms/renesas-bsp.git
 v4.9/rcar-3.5.1]
Signed-off-by: zou cao <cao.zou@windriver.com>
---
 drivers/media/i2c/adv7482.c |   23 +++++++++++++++++------
 1 files changed, 17 insertions(+), 6 deletions(-)

diff --git a/drivers/media/i2c/adv7482.c b/drivers/media/i2c/adv7482.c
index 8893948..f6997b4 100644
--- a/drivers/media/i2c/adv7482.c
+++ b/drivers/media/i2c/adv7482.c
@@ -1420,6 +1420,11 @@ static int adv7482_sdp_s_ctrl(struct v4l2_ctrl *ctrl, struct i2c_client *client)
 {
 	int ret;
 
+	ret = adv7482_write_register(client, ADV7482_I2C_SDP,
+			ADV7482_SDP_REG_CTRL, ADV7482_SDP_MAIN_MAP_RW);
+	if (ret < 0)
+		return ret;
+
 	switch (ctrl->id) {
 	case V4L2_CID_BRIGHTNESS:
 		if ((ctrl->val < ADV7482_SDP_BRI_MIN) ||
@@ -1446,18 +1451,24 @@ static int adv7482_sdp_s_ctrl(struct v4l2_ctrl *ctrl, struct i2c_client *client)
 			ret = adv7482_write_register(client, ADV7482_I2C_SDP,
 					ADV7482_SDP_REG_CON, ctrl->val);
 		break;
-#if 0 /* [FIXME] */
 	case V4L2_CID_SATURATION:
 		/*
 		 *This could be V4L2_CID_BLUE_BALANCE/V4L2_CID_RED_BALANCE
 		 *Let's not confuse the user, everybody understands saturation
 		 */
-		ret = adv7180_write(state, ADV7180_REG_SD_SAT_CB, val);
-		if (ret < 0)
-			break;
-		ret = adv7180_write(state, ADV7180_REG_SD_SAT_CR, val);
+		if ((ctrl->val < ADV7482_SDP_SAT_MIN) ||
+					(ctrl->val > ADV7482_SDP_SAT_MAX))
+			ret = -ERANGE;
+		else {
+			ret = adv7482_write_register(client, ADV7482_I2C_SDP,
+					ADV7482_SDP_REG_SD_SAT_CB, ctrl->val);
+			if (ret < 0)
+				break;
+
+			ret = adv7482_write_register(client, ADV7482_I2C_SDP,
+					ADV7482_SDP_REG_SD_SAT_CR, ctrl->val);
+		}
 		break;
-#endif
 	default:
 		ret = -EINVAL;
 	}
-- 
1.7.5.4

