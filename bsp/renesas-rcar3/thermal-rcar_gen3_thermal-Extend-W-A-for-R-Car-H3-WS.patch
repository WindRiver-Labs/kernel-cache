From a25d58cbd4a3289d322083c022d37e2e5e8ed026 Mon Sep 17 00:00:00 2001
From: Thao Nguyen <thao.nguyen.yb@rvc.renesas.com>
Date: Mon, 21 Dec 2015 17:46:53 +0700
Subject: [PATCH 1279/2066] thermal: rcar_gen3_thermal: Extend W/A for R-Car
 H3 WS1.1

Signed-off-by: Thao Nguyen <thao.nguyen.yb@rvc.renesas.com>
[zou:Original patch taken from
git://git.kernel.org/pub/scm/linux/kernel/git/horms/renesas-bsp.git
 v4.9/rcar-3.5.1]
Signed-off-by: zou cao <cao.zou@windriver.com>
---
 drivers/thermal/rcar_gen3_thermal.c |    8 +++++---
 1 files changed, 5 insertions(+), 3 deletions(-)

diff --git a/drivers/thermal/rcar_gen3_thermal.c b/drivers/thermal/rcar_gen3_thermal.c
index 2b04baf..46826d7 100644
--- a/drivers/thermal/rcar_gen3_thermal.c
+++ b/drivers/thermal/rcar_gen3_thermal.c
@@ -61,7 +61,8 @@
 #define TEMPD_IRQ_SHIFT(tsc_id)	(0x1 << (tsc_id + 3))
 #define GEN3_FUSE_MASK	0xFFF
 
-#define RCAR_H3_WS1		0x4F00
+#define RCAR_H3_WS10		0x4F00
+#define RCAR_H3_WS11		0x4F01
 
 /* Product register */
 #define GEN3_PRR	0xFFF00044
@@ -163,11 +164,12 @@ static void thermal_read_fuse_factor(struct rcar_thermal_priv *priv)
 	u32  lsi_id;
 	void __iomem *product_register = ioremap_nocache(GEN3_PRR, 4);
 
-	/* For H3 WS1, these registers have not been programmed yet.
+	/* For H3 WS1.0 and H3 WS1.1,
+	 * these registers have not been programmed yet.
 	 * We will use fixed value as temporary solution.
 	 */
 	lsi_id = ioread32(product_register) & GEN3_PRR_MASK;
-	if (lsi_id != RCAR_H3_WS1) {
+	if ((lsi_id != RCAR_H3_WS10) && (lsi_id != RCAR_H3_WS11)) {
 		priv->factor.fthcode_h = rcar_thermal_read(priv,
 						REG_GEN3_FTHCODEH)
 				& GEN3_FUSE_MASK;
-- 
1.7.5.4

