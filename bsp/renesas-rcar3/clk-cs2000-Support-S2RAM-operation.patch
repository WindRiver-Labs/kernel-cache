From 236172fbaed2c8ebfd35db497fc85e57f423e62a Mon Sep 17 00:00:00 2001
From: Khiem Nguyen <khiem.nguyen.xt@rvc.renesas.com>
Date: Fri, 26 Feb 2016 23:06:04 +0700
Subject: [PATCH 1651/2066] clk: cs2000: Support S2RAM operation

This driver must be resumed soon so that other module can use.

Signed-off-by: Hien Dang <hien.dang.eb@rvc.renesas.com>
Signed-off-by: Takeshi Kihara <takeshi.kihara.df@renesas.com>
[zou:Original patch taken from
git://git.kernel.org/pub/scm/linux/kernel/git/horms/renesas-bsp.git
 v4.9/rcar-3.5.1]
Signed-off-by: zou cao <cao.zou@windriver.com>
---
 drivers/clk/clk-cs2000-cp.c |   33 +++++++++++++++++++++++++++++++++
 1 files changed, 33 insertions(+), 0 deletions(-)

diff --git a/drivers/clk/clk-cs2000-cp.c b/drivers/clk/clk-cs2000-cp.c
index 7379de8..5aaf588 100644
--- a/drivers/clk/clk-cs2000-cp.c
+++ b/drivers/clk/clk-cs2000-cp.c
@@ -493,9 +493,42 @@ probe_err:
 	return ret;
 }
 
+#ifdef CONFIG_PM_SLEEP
+static int cs2000_suspend(struct device *dev)
+{
+	/* Empty function for now */
+	return 0;
+}
+
+static int cs2000_resume(struct device *dev)
+{
+	struct cs2000_priv *priv = dev_get_drvdata(dev);
+	int rate;
+	int ret;
+
+	/* Setting is referred from cs2000_clk_register */
+	rate = clk_get_rate(priv->ref_clk);
+	ret = __cs2000_set_rate(priv, 0, rate, rate);
+
+	if (ret < 0)
+		return ret;
+
+	return 0;
+}
+
+static const struct dev_pm_ops cs2000_pm_ops = {
+	.suspend = cs2000_suspend,
+	.resume_early = cs2000_resume,
+};
+#define DEV_PM_OPS (&cs2000_pm_ops)
+#else
+#define DEV_PM_OPS NULL
+#endif /* CONFIG_PM_SLEEP */
+
 static struct i2c_driver cs2000_driver = {
 	.driver = {
 		.name = "cs2000-cp",
+		.pm	= DEV_PM_OPS,
 		.of_match_table = cs2000_of_match,
 	},
 	.probe		= cs2000_probe,
-- 
1.7.5.4

