From 0e44a4a9f1277800031bf606a9a9437ef88227a9 Mon Sep 17 00:00:00 2001
From: Chandrakala Chavva <cchavva@cavium.com>
Date: Tue, 29 Nov 2011 12:36:47 -0800
Subject: [PATCH 180/238] MIPS: Octeon: Enable RED after interface is initialized

Source: Cavium SDK 2.3-427

Signed-off-by: Chandrakala Chavva <cchavva@cavium.com>
Integrated-by: Jiang Bin <bin.jiang@windriver.com>
---
 drivers/net/octeon/ethernet.c |   10 ++++++----
 1 files changed, 6 insertions(+), 4 deletions(-)

diff --git a/drivers/net/octeon/ethernet.c b/drivers/net/octeon/ethernet.c
index c980eb8..7c53c48 100644
--- a/drivers/net/octeon/ethernet.c
+++ b/drivers/net/octeon/ethernet.c
@@ -173,10 +173,6 @@ static __init void cvm_oct_configure_common_hw(void)
 				     CVMX_FPA_OUTPUT_BUFFER_POOL_SIZE, cvm_oct_num_output_buffers);
 	}
 
-	if (USE_RED)
-		cvmx_helper_setup_red(num_packet_buffers / 4,
-				      num_packet_buffers / 8);
-
 }
 
 /**
@@ -782,6 +778,12 @@ static int __init cvm_oct_init_module(void)
 
 	cvmx_helper_initialize_packet_io_global();
 
+	/* Enable red after interface is initialized */
+	if (USE_RED)
+		cvmx_helper_setup_red(num_packet_buffers / 4,
+				      num_packet_buffers / 8);
+
+
 	/* Change the input group for all ports before input is enabled */
 	num_interfaces = cvmx_helper_get_number_of_interfaces();
 	for (interface = 0; interface < num_interfaces; interface++) {
-- 
1.7.0

