From 6864c53c73ae68a5685c85f48bfc14ec86b70b32 Mon Sep 17 00:00:00 2001
From: Weiguang Shi <Weiguang.Shi@caviumnetworks.com>
Date: Wed, 15 Feb 2012 17:01:17 -0800
Subject: [PATCH 216/238] NET: octeon-ethernet: Handle up to 32 tx queues per port.

Source: Cavium SDK 2.3-427

Signed-off-by: Weiguang Shi <Weiguang.Shi@caviumnetworks.com>
Signed-off-by: David Daney <david.daney@cavium.com>
Integrated-by: Jiang Bin <bin.jiang@windriver.com>
---
 drivers/net/octeon/ethernet.c        |    4 ++++
 drivers/net/octeon/octeon-ethernet.h |    2 +-
 2 files changed, 5 insertions(+), 1 deletions(-)

diff --git a/drivers/net/octeon/ethernet.c b/drivers/net/octeon/ethernet.c
index 3f80437..f3c601f 100644
--- a/drivers/net/octeon/ethernet.c
+++ b/drivers/net/octeon/ethernet.c
@@ -897,6 +897,10 @@ static int __init cvm_oct_init_module(void)
 				base_queue = cvmx_pko_get_base_queue(priv->ipd_port);
 				priv->num_tx_queues = cvmx_pko_get_num_queues(priv->ipd_port);
 			}
+
+			BUG_ON(priv->num_tx_queues < 1);
+			BUG_ON(priv->num_tx_queues > 32);
+
 			if (octeon_has_feature(OCTEON_FEATURE_PKND))
 				priv->ipd_pkind = cvmx_helper_get_pknd(interface, interface_port);
 			else
diff --git a/drivers/net/octeon/octeon-ethernet.h b/drivers/net/octeon/octeon-ethernet.h
index 35d9ee4..abdcb77 100644
--- a/drivers/net/octeon/octeon-ethernet.h
+++ b/drivers/net/octeon/octeon-ethernet.h
@@ -81,7 +81,7 @@ struct octeon_ethernet {
 		int	queue;
 		/* Hardware fetch and add to count outstanding tx buffers */
 		int	fau;
-	} tx_queue[16];
+	} tx_queue[32];
 
 	struct phy_device *phydev;
 	/* MII bus the PHY is connected to */
-- 
1.7.0

