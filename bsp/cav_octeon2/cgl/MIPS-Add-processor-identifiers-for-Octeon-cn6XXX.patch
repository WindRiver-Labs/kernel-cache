From d4d17019e154be80c613b461fe82dd908633be41 Mon Sep 17 00:00:00 2001
From: David Daney <ddaney@caviumnetworks.com>
Date: Tue, 23 Nov 2010 14:44:34 -0800
Subject: [PATCH 018/238] MIPS: Add processor identifiers for Octeon cn6XXX

Source: Cavium SDK 2.1.0-407

Add new Processor IDs and add the code in the probe routine to look for
them.

Increase default NR_CPUS to 32 to accommodate CN68xx's 32 cores.

Signed-off-by: David Daney <ddaney@caviumnetworks.com>
Integrated-by: Phil Staub <Phil.Staub@windriver.com>
---
 arch/mips/Kconfig            |    2 +-
 arch/mips/include/asm/cpu.h  |    3 +++
 arch/mips/kernel/cpu-probe.c |    3 +++
 3 files changed, 7 insertions(+), 1 deletions(-)

diff --git a/arch/mips/Kconfig b/arch/mips/Kconfig
index 28303d5..f892b38 100644
--- a/arch/mips/Kconfig
+++ b/arch/mips/Kconfig
@@ -1342,7 +1342,7 @@ config CPU_CAVIUM_OCTEON
 	select CPU_HAS_PREFETCH
 	select CPU_SUPPORTS_64BIT_KERNEL
 	select SYS_SUPPORTS_SMP
-	select NR_CPUS_DEFAULT_16
+	select NR_CPUS_DEFAULT_32
 	select WEAK_ORDERING
 	select CPU_SUPPORTS_HIGHMEM
 	select CPU_SUPPORTS_HUGEPAGES
diff --git a/arch/mips/include/asm/cpu.h b/arch/mips/include/asm/cpu.h
index b6734f7..8e4daa2 100644
--- a/arch/mips/include/asm/cpu.h
+++ b/arch/mips/include/asm/cpu.h
@@ -132,6 +132,9 @@
 #define PRID_IMP_CAVIUM_CN50XX 0x0600
 #define PRID_IMP_CAVIUM_CN52XX 0x0700
 #define PRID_IMP_CAVIUM_CN63XX 0x9000
+#define PRID_IMP_CAVIUM_CN68XX 0x9100
+#define PRID_IMP_CAVIUM_CN66XX 0x9200
+#define PRID_IMP_CAVIUM_CN61XX 0x9300
 
 /*
  * Definitions for 7:0 on legacy processors
diff --git a/arch/mips/kernel/cpu-probe.c b/arch/mips/kernel/cpu-probe.c
index c69b17e..fd02269 100644
--- a/arch/mips/kernel/cpu-probe.c
+++ b/arch/mips/kernel/cpu-probe.c
@@ -938,7 +938,10 @@ platform:
 		if (cpu == 0)
 			__elf_platform = "octeon";
 		break;
+	case PRID_IMP_CAVIUM_CN61XX:
 	case PRID_IMP_CAVIUM_CN63XX:
+	case PRID_IMP_CAVIUM_CN66XX:
+	case PRID_IMP_CAVIUM_CN68XX:
 		c->cputype = CPU_CAVIUM_OCTEON2;
 		__cpu_name[cpu] = "Cavium Octeon II";
 		if (cpu == 0)
-- 
1.7.0

