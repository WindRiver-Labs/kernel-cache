From deb809a24b0f0ecde111a2ad62dde5bae919373b Mon Sep 17 00:00:00 2001
From: David Daney <ddaney@caviumnetworks.com>
Date: Wed, 27 Apr 2011 10:54:22 -0700
Subject: [PATCH 009/238] usb: Configure octeon2 glue logic for proper uSOF cycle period.

The reset value of the uSOF cycle period is incorrect.  Set it to
60,000 bits.  Without this, several commercial USB flash memory
devices and hubs fail to work properly.

Signed-off-by: David Daney <ddaney@caviumnetworks.com>
Signed-off-by: Greg Kroah-Hartman <gregkh@suse.de>
(cherry picked from commit 14be249c969817e05c4f1ce042906e1c5be68873 upstream)

Signed-off-by: Phil Staub <Phil.Staub@windriver.com>
---
 drivers/usb/host/octeon2-common.c |    3 +++
 1 files changed, 3 insertions(+), 0 deletions(-)

diff --git a/drivers/usb/host/octeon2-common.c b/drivers/usb/host/octeon2-common.c
index 15474a6..5a8e759 100644
--- a/drivers/usb/host/octeon2-common.c
+++ b/drivers/usb/host/octeon2-common.c
@@ -183,6 +183,9 @@ end_clock:
 		cvmx_write_csr(CVMX_UCTLX_UPHY_PORTX_CTL_STATUS(i, 0),
 			       port_ctl_status.u64);
 	}
+
+	/* Set uSOF cycle period to 60,000 bits. */
+	cvmx_write_csr(CVMX_UCTLX_EHCI_FLA(0), 0x20ull);
 exit:
 	mutex_unlock(&octeon2_usb_clocks_mutex);
 }
-- 
1.7.0

