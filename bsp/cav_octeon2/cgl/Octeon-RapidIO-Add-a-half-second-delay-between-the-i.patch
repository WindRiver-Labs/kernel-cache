From 477374e4469e39eca915100165ce04a5fa96e68d Mon Sep 17 00:00:00 2001
From: Chad Reese <kreese@caviumnetworks.com>
Date: Mon, 22 Nov 2010 10:29:32 -0800
Subject: [PATCH 044/238] Octeon: RapidIO: Add a half second delay between the initialization of SRIO and when Linux starts enumeration.

Source: Cavium SDK 2.1.0-407

The SRIO links on CN63XX pass 2 take a little longer than pass 1 to
come up. This delay gives them time to settle before Linux tries to
enumerate. The kernel currently doesn't support hotplug after the
initial enumeration fails.

Signed-off-by: Chad Reese <kreese@caviumnetworks.com>
Integrated-by: Phil Staub <Phil.Staub@windriver.com>
---
 arch/mips/cavium-octeon/octeon-rapidio.c |    4 ++++
 1 files changed, 4 insertions(+), 0 deletions(-)

diff --git a/arch/mips/cavium-octeon/octeon-rapidio.c b/arch/mips/cavium-octeon/octeon-rapidio.c
index a799c5b..a8c552d 100644
--- a/arch/mips/cavium-octeon/octeon-rapidio.c
+++ b/arch/mips/cavium-octeon/octeon-rapidio.c
@@ -770,6 +770,10 @@ static int __init octeon_rio_init(void)
 		cvmx_dma_engine_initialize();
 	}
 
+	/* The links sometimes take a little bit to come up. Delay a half
+	   second. Linux currently doesn't ever try to enumerate if the
+	   links come up after this call */
+	msleep(500);
 	return rio_init_mports();
 }
 
-- 
1.7.0

