From 6d081c2cefa4a1329c71844e0d60e903f2fea3fd Mon Sep 17 00:00:00 2001
From: Roy Franz <rfranz@rfranz-v430.caveonetworks.com>
Date: Wed, 1 Sep 2010 12:39:10 -0700
Subject: [PATCH 034/238] PCI: Cavium: Add 'disable' parameter to pcie_octeon module.

Source: Cavium SDK 2.1.0-407

This allows all PCIe probing to be disabled at boot time, which
significantly speeds kernel boot time. This helps reduce test times
for automated tests that do many kernel boots.

Signed-off-by: Roy Franz <roy.franz@caviumnetworks.com>
Integrated-by: Phil Staub <Phil.Staub@windriver.com>
---
 arch/mips/pci/pcie-octeon.c |    8 ++++++++
 1 files changed, 8 insertions(+), 0 deletions(-)

diff --git a/arch/mips/pci/pcie-octeon.c b/arch/mips/pci/pcie-octeon.c
index 0b27758..53886fb 100644
--- a/arch/mips/pci/pcie-octeon.c
+++ b/arch/mips/pci/pcie-octeon.c
@@ -22,6 +22,10 @@
 
 #include <dma-coherence.h>
 
+/* Module parameter to disable PCI probing */
+int disable;
+module_param(disable, int, S_IRUGO);
+
 /**
  * Map a PCI device to the appropriate interrupt line
  *
@@ -390,6 +394,10 @@ static int __init octeon_pcie_setup(void)
 	if (octeon_is_simulation())
 		return 0;
 
+	/* Disable PCI if instructed on the command line */
+	if (disable)
+		return 0;
+
 	/* Point pcibios_map_irq() to the PCIe version of it */
 	octeon_pcibios_map_irq = octeon_pcie_pcibios_map_irq;
 
-- 
1.7.0

