From add719c1b27206848ee8ccf3803f74ab370523f4 Mon Sep 17 00:00:00 2001
From: David Daney <ddaney@caviumnetworks.com>
Date: Fri, 1 Oct 2010 13:27:33 -0700
Subject: [PATCH 005/238] MIPS: Add a platform hook for swiotlb setup.

This allows platforms that are using the swiotlb to initialize it.

Signed-off-by: David Daney <ddaney@caviumnetworks.com>
Patchwork: http://patchwork.linux-mips.org/patch/1638/
Signed-off-by: Ralf Baechle <ralf@linux-mips.org>
(cherry picked from commit ee71b7d2f834d5e4b3a43001b2fa88743ed71a2c upstream)

Signed-off-by: Phil Staub <Phil.Staub@windriver.com>
---
 arch/mips/include/asm/bootinfo.h |   12 ++++++++++++
 arch/mips/kernel/setup.c         |    1 +
 2 files changed, 13 insertions(+), 0 deletions(-)

diff --git a/arch/mips/include/asm/bootinfo.h b/arch/mips/include/asm/bootinfo.h
index 5b68067..892de38 100644
--- a/arch/mips/include/asm/bootinfo.h
+++ b/arch/mips/include/asm/bootinfo.h
@@ -123,4 +123,16 @@ extern void plat_kexec_setup(void);
  */
 extern void plat_mem_setup(void);
 
+#ifdef CONFIG_SWIOTLB
+/*
+ * Optional platform hook to call swiotlb_setup().
+ */
+extern void plat_swiotlb_setup(void);
+
+#else
+
+static inline void plat_swiotlb_setup(void) {}
+
+#endif /* CONFIG_SWIOTLB */
+
 #endif /* _ASM_BOOTINFO_H */
diff --git a/arch/mips/kernel/setup.c b/arch/mips/kernel/setup.c
index 7332550..d3eb2b7 100644
--- a/arch/mips/kernel/setup.c
+++ b/arch/mips/kernel/setup.c
@@ -527,6 +527,7 @@ static void __init arch_mem_init(char **cmdline_p)
 			crashk_res.end - crashk_res.start + 1, 0);
 #endif
 	sparse_init();
+	plat_swiotlb_setup();
 	paging_init();
 }
 
-- 
1.7.0

