From db87cda2b089f084eb05522693e659b17b170744 Mon Sep 17 00:00:00 2001
From: Yang Shi <yang.shi@windriver.com>
Date: Thu, 10 Nov 2011 13:53:32 -0800
Subject: [PATCH 106/238] MIPS: Octeon: Make autodetected console match bootloader console

Source: Cavium SDK 2.2-414

The default console is always ttyS0, which is the name given to the
UART used by the bootloader as its console.  This allows the
bootloader to change consoles and have the same device be used by the
kernel.

Signed-off-by: David Daney <david.daney@cavium.com>
Integrated-by: Yang Shi <yang.shi@windriver.com>
---
 arch/mips/cavium-octeon/serial.c |    4 ----
 arch/mips/cavium-octeon/setup.c  |   14 +-------------
 2 files changed, 1 insertions(+), 17 deletions(-)

diff --git a/arch/mips/cavium-octeon/serial.c b/arch/mips/cavium-octeon/serial.c
index 1ad2149..3c17b20 100644
--- a/arch/mips/cavium-octeon/serial.c
+++ b/arch/mips/cavium-octeon/serial.c
@@ -30,11 +30,7 @@ static int __init opt_cavium_gdb(char *p)
 early_param("cavium_gdb", opt_cavium_gdb);
 
 
-#ifdef CONFIG_GDB_CONSOLE
-#define DEBUG_UART 0
-#else
 #define DEBUG_UART 1
-#endif
 
 static irqreturn_t interrupt_debug_char(int cpl, void *dev_id)
 {
diff --git a/arch/mips/cavium-octeon/setup.c b/arch/mips/cavium-octeon/setup.c
index 576124b..8cd3aca 100644
--- a/arch/mips/cavium-octeon/setup.c
+++ b/arch/mips/cavium-octeon/setup.c
@@ -821,20 +821,8 @@ void __init native_prom_init(void)
 	if (strstr(arcs_cmdline, "console=pci"))
 		pci_console_init(strstr(arcs_cmdline, "console=pci") + 8);
 
-	if (strstr(arcs_cmdline, "console=") == NULL) {
-#ifdef CONFIG_GDB_CONSOLE
-		strcat(arcs_cmdline, " console=gdb");
-#else
-#ifdef CONFIG_CAVIUM_OCTEON_2ND_KERNEL
+	if (strstr(arcs_cmdline, "console=") == NULL)
 		strcat(arcs_cmdline, " console=ttyS0,115200");
-#else
-		if (octeon_uart == 1)
-			strcat(arcs_cmdline, " console=ttyS1,115200");
-		else
-			strcat(arcs_cmdline, " console=ttyS0,115200");
-#endif
-#endif
-	}
 
 	if (octeon_is_simulation()) {
 		/*
-- 
1.7.0

