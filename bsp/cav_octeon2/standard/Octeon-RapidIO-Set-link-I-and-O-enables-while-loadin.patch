From 9377161cf63acb193a486da55bb22e363240d36c Mon Sep 17 00:00:00 2001
From: Chad Reese <kreese@caviumnetworks.com>
Date: Mon, 29 Nov 2010 15:09:57 -0800
Subject: [PATCH 045/236] Octeon: RapidIO: Set link I and O enables while loading the test driver

Source: Cavium SDK 2.1.0-407

Signed-off-by: Chad Reese <kreese@caviumnetworks.com>
Integrated-by: Phil Staub <Phil.Staub@windriver.com>
---
 drivers/rapidio/devices/cn6xxx.c |   11 +++++++++++
 1 files changed, 11 insertions(+), 0 deletions(-)

diff --git a/drivers/rapidio/devices/cn6xxx.c b/drivers/rapidio/devices/cn6xxx.c
index 068addd..3ccf308 100644
--- a/drivers/rapidio/devices/cn6xxx.c
+++ b/drivers/rapidio/devices/cn6xxx.c
@@ -61,6 +61,7 @@ static int cn6xxx_probe(struct rio_dev *dev, const struct rio_device_id *id)
 	cvmx_sriomaintx_m2s_bar0_start1_t sriomaintx_m2s_bar0_start1;
 	cvmx_sriomaintx_core_enables_t sriomaintx_core_enables;
 	cvmx_sriomaintx_port_gen_ctl_t sriomaintx_port_gen_ctl;
+	cvmx_sriomaintx_port_0_ctl_t sriomaintx_port_0_ctl;
 	const char *state;
 	int index;
 
@@ -185,6 +186,16 @@ static int cn6xxx_probe(struct rio_dev *dev, const struct rio_device_id *id)
 		sriomaintx_port_gen_ctl.u32))
 		return -1;
 
+	/* Set link I/O enabled */
+	if (rio_read_config_32(dev, CVMX_SRIOMAINTX_PORT_0_CTL(0),
+		&sriomaintx_port_0_ctl.u32))
+		return -1;
+	sriomaintx_port_0_ctl.s.o_enable = 1;
+	sriomaintx_port_0_ctl.s.i_enable = 1;
+	if (rio_write_config_32(dev, CVMX_SRIOMAINTX_PORT_0_CTL(0),
+		sriomaintx_port_0_ctl.u32))
+		return -1;
+
 	if (rio_request_inb_dbell(dev->net->hport, dev, 0, 1,
 		cn6xxx_doorbell)) {
 		dev_err(&dev->dev, "Register for incomming doorbells failed\n");
-- 
1.7.0

