From 3e18f358104ee48c23e9e4749bf90c80a534fd31 Mon Sep 17 00:00:00 2001
From: David Daney <ddaney@caviumnetworks.com>
Date: Mon, 11 Apr 2011 11:20:56 -0700
Subject: [PATCH 058/236] netdev: octeon-ethernet: Don't truncate pointer values when freeing SSO memory

Source: Cavium SDK 2.1.0-407

Signed-off-by: David Daney <ddaney@caviumnetworks.com>
Integrated-by: Phil Staub <Phil.Staub@windriver.com>
---
 drivers/net/octeon/ethernet-rx.c |    4 ++--
 1 files changed, 2 insertions(+), 2 deletions(-)

diff --git a/drivers/net/octeon/ethernet-rx.c b/drivers/net/octeon/ethernet-rx.c
index 0c3cf3d..399a15f 100644
--- a/drivers/net/octeon/ethernet-rx.c
+++ b/drivers/net/octeon/ethernet-rx.c
@@ -521,7 +521,7 @@ void cvm_oct_rx_shutdown(int num_wqe)
 				pop_fptr.u64 = cvmx_read_csr(CVMX_SSO_RWQ_POP_FPTR);
 			} while (!pop_fptr.s.val);
 
-			mem = phys_to_virt(pop_fptr.s.fptr << 7);
+			mem = phys_to_virt(((u64)pop_fptr.s.fptr) << 7);
 			kmem_cache_free(cvm_oct_kmem_sso, mem);
 			count--;
 		}
@@ -531,7 +531,7 @@ void cvm_oct_rx_shutdown(int num_wqe)
 			void *mem;
 
 			head_ptr.u64 = cvmx_read_csr(CVMX_SSO_RWQ_HEAD_PTRX(i));
-			mem = phys_to_virt(head_ptr.s.ptr << 7);
+			mem = phys_to_virt(((u64)head_ptr.s.ptr) << 7);
 			kmem_cache_free(cvm_oct_kmem_sso, mem);
 		}
 		sso_cfg.s.rwen = 0;
-- 
1.7.0

