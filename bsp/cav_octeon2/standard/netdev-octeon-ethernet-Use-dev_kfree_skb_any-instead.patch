From 97fc8c873b31f4e555e7eed1dfbe57286e0a0d2e Mon Sep 17 00:00:00 2001
From: David Daney <david.daney@cavium.com>
Date: Wed, 6 Jul 2011 09:49:02 -0700
Subject: [PATCH 076/236] netdev: octeon-ethernet: Use dev_kfree_skb_any instead of dev_kfree_skb_irq.

Soruce: Cavium SDK 2.1.0-407

The only time this code could be run from interrupt context is when
called from cvm_oct_poll_controller().

Signed-off-by: David Daney <david.daney@cavium.com>
Integrated-by: Phil Staub <Phil.Staub@windriver.com>
---
 drivers/net/octeon/ethernet-napi.c |    8 ++++----
 1 files changed, 4 insertions(+), 4 deletions(-)

diff --git a/drivers/net/octeon/ethernet-napi.c b/drivers/net/octeon/ethernet-napi.c
index d97c3d8..2564d13 100644
--- a/drivers/net/octeon/ethernet-napi.c
+++ b/drivers/net/octeon/ethernet-napi.c
@@ -338,7 +338,7 @@ static int CVM_OCT_NAPI_POLL(struct napi_struct *napi, int budget)
 						rx_count++;
 						break;
 					case CVM_OCT_DROP:
-						dev_kfree_skb_irq(skb);
+						dev_kfree_skb_any(skb);
 						atomic64_add(1, (atomic64_t *)&priv->netdev->stats.rx_dropped);
 						break;
 					case CVM_OCT_TAKE_OWNERSHIP_WORK:
@@ -355,7 +355,7 @@ static int CVM_OCT_NAPI_POLL(struct napi_struct *napi, int budget)
 							 * do anything
 							 */
 						} else {
-							dev_kfree_skb_irq(skb);
+							dev_kfree_skb_any(skb);
 						}
 						break;
 					case CVM_OCT_TAKE_OWNERSHIP_SKB:
@@ -374,7 +374,7 @@ static int CVM_OCT_NAPI_POLL(struct napi_struct *napi, int budget)
 					   dev->name);
 				*/
 				atomic64_add(1, (atomic64_t *)&priv->netdev->stats.rx_dropped);
-				dev_kfree_skb_irq(skb);
+				dev_kfree_skb_any(skb);
 				callback_result = CVM_OCT_DROP;
 			}
 		} else {
@@ -384,7 +384,7 @@ static int CVM_OCT_NAPI_POLL(struct napi_struct *napi, int budget)
 			 */
 			DEBUGPRINT("Port %d not controlled by Linux, packet dropped\n",
 				   port);
-			dev_kfree_skb_irq(skb);
+			dev_kfree_skb_any(skb);
 			callback_result = CVM_OCT_DROP;
 		}
 		/* We only need to free the work if the interceptor didn't
-- 
1.7.0

