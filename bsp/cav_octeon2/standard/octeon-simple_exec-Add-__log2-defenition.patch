From eb41122424cf07ce498a52a9f9ca5a68e575b1bf Mon Sep 17 00:00:00 2001
From: Yang Shi <yang.shi@windriver.com>
Date: Fri, 16 Dec 2011 11:23:29 -0800
Subject: [PATCH 165/236] octeon/simple_exec: Add __log2 defenition

Add __log2 definition instead of using C lib.

Signed-off-by: Yang Shi <yang.shi@windriver.com>
---
 simple_exec/cvmx-tlb.c |    2 --
 simple_exec/cvmx-tlb.h |   16 ++++++++++++++++
 2 files changed, 16 insertions(+), 2 deletions(-)

diff --git a/simple_exec/cvmx-tlb.c b/simple_exec/cvmx-tlb.c
index 0741a58..7185f7b 100644
--- a/simple_exec/cvmx-tlb.c
+++ b/simple_exec/cvmx-tlb.c
@@ -51,9 +51,7 @@
 #include "cvmx.h"
 #include "cvmx-tlb.h"
 #include "cvmx-core.h"
-#include <math.h>
 
-extern __uint32_t  __log2(__uint32_t);
 //#define DEBUG
 
 /**
diff --git a/simple_exec/cvmx-tlb.h b/simple_exec/cvmx-tlb.h
index 44a1627..fe5e438 100644
--- a/simple_exec/cvmx-tlb.h
+++ b/simple_exec/cvmx-tlb.h
@@ -168,6 +168,22 @@ static inline int __is_power_of_two(uint64_t v)
 	return (num_of_1s  ==  1 );
 }
 
+/**
+ * @INTERNAL
+ * Compute  log2(v), only works if v is power of two.
+ *
+ * @param v  the input value
+ * @return  log2(v)
+ */
+static inline uint32_t __log2(uint64_t v)
+{
+	uint32_t log2 = 0 ;
+
+	if (v) log2 =  __fls64(v);
+
+	return log2;
+}
+
 #ifdef	__cplusplus
 }
 #endif
-- 
1.7.0

