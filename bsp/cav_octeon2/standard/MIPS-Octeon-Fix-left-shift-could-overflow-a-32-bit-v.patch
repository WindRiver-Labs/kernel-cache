From 322b4874ff71cdb897bef34799a5547cfbeeada7 Mon Sep 17 00:00:00 2001
From: Jiang Bin <bin.jiang@windriver.com>
Date: Tue, 22 May 2012 19:25:51 +0800
Subject: [PATCH 231/236] MIPS: Octeon: Fix left-shift could overflow a 32-bit variable.

The dram_size is a 32-bit variable which saves DRAM size in megabytes.
Left shifts the value of dram_size by the number of 20 to get the DRAM
size in bytes.

But If dram_size is greater than 4096 which represents 4G DRAM, the
left-shift with 20 will overflow the variable.

Signed-off-by: Jiang Bin <bin.jiang@windriver.com>
---
 arch/mips/cavium-octeon/setup.c |    2 +-
 1 files changed, 1 insertions(+), 1 deletions(-)

diff --git a/arch/mips/cavium-octeon/setup.c b/arch/mips/cavium-octeon/setup.c
index 3b92b89..ce063a3 100644
--- a/arch/mips/cavium-octeon/setup.c
+++ b/arch/mips/cavium-octeon/setup.c
@@ -703,7 +703,7 @@ void __init native_prom_init(void)
 
 	sysinfo = cvmx_sysinfo_get();
 	memset(sysinfo, 0, sizeof(*sysinfo));
-	sysinfo->system_dram_size = octeon_bootinfo->dram_size << 20;
+	sysinfo->system_dram_size = (uint64_t)octeon_bootinfo->dram_size << 20;
 	sysinfo->phy_mem_desc_addr =
 		(u64)phys_to_virt(octeon_bootinfo->phy_mem_desc_addr);
 	sysinfo->core_mask = octeon_bootinfo->core_mask;
-- 
1.7.0

