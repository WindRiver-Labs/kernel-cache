From d701fb2c13ec8cdc29bd399438e9ceecf66ebf63 Mon Sep 17 00:00:00 2001
From: Chad Reese <kreese@caviumnetworks.com>
Date: Thu, 30 Sep 2010 09:32:23 -0700
Subject: [PATCH 042/236] MIPS: Octeon: RapidIO: Correct checksum calculation for extra 8 byte header.

Source: Cavium SDK 2.1.0-407

SRIO packets have an extra 8 bytes before the L2 and IP header. These need to
be accounted for in telling the hardware to checksum.

Signed-off-by: Chad Reese <kreese@caviumnetworks.com>
Integrated-by: Phil Staub <Phil.Staub@windriver.com>
---
 drivers/net/octeon/ethernet-xmit.c |    2 ++
 1 files changed, 2 insertions(+), 0 deletions(-)

diff --git a/drivers/net/octeon/ethernet-xmit.c b/drivers/net/octeon/ethernet-xmit.c
index 2f9e775..eaad15f 100644
--- a/drivers/net/octeon/ethernet-xmit.c
+++ b/drivers/net/octeon/ethernet-xmit.c
@@ -287,6 +287,8 @@ dont_put_skbuff_in_hw:
 	    && ((ip_hdr(skb)->protocol == IPPROTO_TCP) || (ip_hdr(skb)->protocol == IPPROTO_UDP))) {
 		/* Use hardware checksum calc */
 		pko_command.s.ipoffp1 = sizeof(struct ethhdr) + 1;
+		if (unlikely(priv->imode == CVMX_HELPER_INTERFACE_MODE_SRIO))
+			pko_command.s.ipoffp1 += 8;
 	}
 
 	if (USE_ASYNC_IOBDMA) {
-- 
1.7.0

