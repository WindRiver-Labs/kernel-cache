From 0eaa9c31224b2e84a8f57a888e7c58df9071c8a7 Mon Sep 17 00:00:00 2001
From: Yang Shi <yang.shi@windriver.com>
Date: Fri, 11 Nov 2011 11:55:11 -0800
Subject: [PATCH 139/236] MIPS: Octeon: Disable some devices when CAVIUM_OCTEON_2ND_KERNEL selected

Source: Cavium SDK 2.2-414

This keeps the second kernel from trying to control things controlled
by the first kernel.

Signed-off-by: David Daney <david.daney@cavium.com>
Integrated-by: Yang Shi <yang.shi@windriver.com>
---
 arch/mips/Kconfig               |    2 +-
 arch/mips/cavium-octeon/Kconfig |    6 +++---
 drivers/ata/Kconfig             |    2 +-
 drivers/i2c/busses/Kconfig      |    2 +-
 4 files changed, 6 insertions(+), 6 deletions(-)

diff --git a/arch/mips/Kconfig b/arch/mips/Kconfig
index 42e437a..774083b 100644
--- a/arch/mips/Kconfig
+++ b/arch/mips/Kconfig
@@ -675,7 +675,7 @@ config CAVIUM_OCTEON_REFERENCE_BOARD
 	select SYS_HAS_EARLY_PRINTK
 	select SYS_HAS_CPU_CAVIUM_OCTEON
 	select SWAP_IO_SPACE
-	select HW_HAS_PCI
+	select HW_HAS_PCI if !CAVIUM_OCTEON_2ND_KERNEL
 	select ARCH_SUPPORTS_MSI
 	select ZONE_DMA32 if !WRHV
 	select HOLES_IN_ZONE
diff --git a/arch/mips/cavium-octeon/Kconfig b/arch/mips/cavium-octeon/Kconfig
index 58bfa9f..889979a 100644
--- a/arch/mips/cavium-octeon/Kconfig
+++ b/arch/mips/cavium-octeon/Kconfig
@@ -289,14 +289,14 @@ config CAVIUM_OCTEON_TRA
 
 config CAVIUM_DECODE_RSL
        bool "Decode RSL interrupt conditions."
-       depends on CPU_CAVIUM_OCTEON
+       depends on CPU_CAVIUM_OCTEON && !CAVIUM_OCTEON_2ND_KERNEL
        default y
        help
          Detect, decode and display on-chip error conditions.
 
 config CAVIUM_OCTEON_NAND
        tristate "Octeon NAND driver"
-       depends on MTD_NAND && CPU_CAVIUM_OCTEON
+       depends on MTD_NAND && CPU_CAVIUM_OCTEON && !CAVIUM_OCTEON_2ND_KERNEL
        default m
        help
          This option enables a MTD driver for the NAND controller introduced
@@ -305,7 +305,7 @@ config CAVIUM_OCTEON_NAND
 
 config CAVIUM_OCTEON_RAPIDIO
 	bool "Enable support for Octeon Serial Rapid IO"
-	depends on CPU_CAVIUM_OCTEON
+	depends on CPU_CAVIUM_OCTEON && !CAVIUM_OCTEON_2ND_KERNEL
 	default y
 	select RAPIDIO
 	help
diff --git a/drivers/ata/Kconfig b/drivers/ata/Kconfig
index 978d7f2..c7b05df 100644
--- a/drivers/ata/Kconfig
+++ b/drivers/ata/Kconfig
@@ -769,7 +769,7 @@ config PATA_IXP4XX_CF
 
 config PATA_OCTEON_CF
 	tristate "OCTEON Boot Bus Compact Flash support"
-	depends on CPU_CAVIUM_OCTEON
+	depends on CPU_CAVIUM_OCTEON && !CAVIUM_OCTEON_2ND_KERNEL
 	select HIGH_RES_TIMERS
 	help
 	  This option enables a polled compact flash driver for use with
diff --git a/drivers/i2c/busses/Kconfig b/drivers/i2c/busses/Kconfig
index 6833516..2bcce50 100644
--- a/drivers/i2c/busses/Kconfig
+++ b/drivers/i2c/busses/Kconfig
@@ -582,7 +582,7 @@ config I2C_VERSATILE
 
 config I2C_OCTEON
 	tristate "Cavium OCTEON I2C bus support"
-	depends on CPU_CAVIUM_OCTEON
+	depends on CPU_CAVIUM_OCTEON && !CAVIUM_OCTEON_2ND_KERNEL
 	help
 	  Say yes if you want to support the I2C serial bus on Cavium
 	  OCTEON SOC.
-- 
1.7.0

